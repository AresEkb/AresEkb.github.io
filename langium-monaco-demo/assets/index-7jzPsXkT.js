const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./main-DpNEsd99.js","./react-B5nPjNA6.js","./main-xd0e82CV.js"])))=>i.map(i=>d[i]);
import{D as z,a5 as ve,jE as Le,jU as de,h1 as x,rQ as _e,jP as Ce,hw as Ie,i$ as Me,wa as ze,hc as Ee,wb as ue,iK as xe,jA as Pe,dp as Y,h as A,wc as De,ix as ke,U as Ne,t as Ae,_ as q,o as m,$ as ne,r as ie,bo as re,il as Te,cV as U,l as g,eQ as Re,kR as je,gy as Q,aS as Se,ed as v,bf as Oe,bt as Fe,dX as $e,wd as Be,bM as Ve,we as Ge,T as le,nA as We,hY as He,gM as F,aP as qe,bj as Ue,bA as Je,I as ye,dz as Qe,dA as Ke,fQ as Ye,fn as Xe,S as Ze,wf as et,hQ as tt,C as nt,lS as it,iI as ge,h7 as rt,lR as p,mo as ot,wg as st,h2 as O,gz as at,eq as ct,er as dt,jH as ut,ee as he,jM as lt,da as gt,cG as ht,bz as mt,cx as ft,cs as pt}from"./monaco-vscode-base-service-override-BYqBQsid.js";import{gG as be,gQ as _t,gR as oe,gS as kt}from"./monaco-vscode-api-DkhVdw0_.js";import{cs as X,C as me,cf as Tt,ct as St}from"./monaco-vscode-configuration-service-override-DGcvGpAH.js";import{m as yt}from"./monaco-vscode-editor-api-BYa5i2YN.js";import{I as we}from"./workbenchThemeService.service-B8QZVqmt.js";import{t as R,g as bt,S as wt}from"./tokenClassificationRegistry-DZtAbFYe.js";class vt extends z{constructor(e,t,n,r,i,s,o){super(),this._grammar=e,this._initialState=t,this._containsEmbeddedLanguages=n,this._createBackgroundTokenizer=r,this._backgroundTokenizerShouldOnlyVerifyTokens=i,this._reportTokenizationTime=s,this._reportSlowTokenization=o,this._seenLanguages=[],this._onDidEncounterLanguage=this._register(new ve),this.onDidEncounterLanguage=this._onDidEncounterLanguage.event}get backgroundTokenizerShouldOnlyVerifyTokens(){return this._backgroundTokenizerShouldOnlyVerifyTokens()}getInitialState(){return this._initialState}tokenize(e,t,n){throw new Error("Not supported!")}createBackgroundTokenizer(e,t){if(this._createBackgroundTokenizer)return this._createBackgroundTokenizer(e,t)}tokenizeEncoded(e,t,n){const r=Math.random()*1e4<1,i=this._reportSlowTokenization||r,s=i?new Le(!0):void 0,o=this._grammar.tokenizeLine2(e,n,500);if(i){const a=s.elapsed();(r||a>32)&&this._reportTokenizationTime(a,e.length,r)}if(o.stoppedEarly)return console.warn(`Time limit reached when tokenizing line: ${e.substring(0,100)}`),new de(o.tokens,n);if(this._containsEmbeddedLanguages){const a=this._seenLanguages,u=o.tokens;for(let h=0,k=u.length>>>1;h<k;h++){const w=u[(h<<1)+1],y=x.getLanguageId(w);a[y]||(a[y]=!0,this._onDidEncounterLanguage.fire(y))}}let c;return n.equals(o.ruleStack)?c=n:c=o.ruleStack,new de(o.tokens,c)}}class Lt extends z{get backgroundTokenizerShouldOnlyVerifyTokens(){return this._actual.backgroundTokenizerShouldOnlyVerifyTokens}constructor(e,t,n,r){super(),this._encodedLanguageId=e,this._actual=t,this._maxTokenizationLineLength=r,this._register(_e(this._maxTokenizationLineLength)),this._register(n)}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,n){throw new Error("Not supported!")}tokenizeEncoded(e,t,n){return e.length>=this._maxTokenizationLineLength.get()?Ce(this._encodedLanguageId,n):this._actual.tokenizeEncoded(e,t,n)}createBackgroundTokenizer(e,t){if(this._actual.createBackgroundTokenizer)return this._actual.createBackgroundTokenizer(e,t)}}class V{static{this.CHANNEL_NAME="textMateWorkerHost"}static getChannel(e){return e.getChannel(V.CHANNEL_NAME)}static setChannel(e,t){e.setChannel(V.CHANNEL_NAME,t)}}class Ct{constructor(e){this.edits=e.slice().sort(Ie(t=>t.offset,Me))}applyToArray(e){for(let t=this.edits.length-1;t>=0;t--){const n=this.edits[t];e.splice(n.offset,n.length,...new Array(n.newLength))}}}class It{constructor(e,t,n){this.offset=e,this.length=t,this.newLength=n}toString(){return`[${this.offset}, +${this.length}) -> +${this.newLength}}`}}class G{static fromMany(e){const t=e.map(n=>new G(n));return new Mt(t)}constructor(e){this.transformation=e,this.idx=0,this.offset=0}transform(e){let t=this.transformation.edits[this.idx];for(;t&&t.offset+t.length<=e;)this.offset+=t.newLength-t.length,this.idx++,t=this.transformation.edits[this.idx];if(!(t&&t.offset<=e))return e+this.offset}}class Mt{constructor(e){this.transformers=e}transform(e){for(const t of this.transformers){const n=t.transform(e);if(n===void 0)return;e=n}return e}}class se extends z{static{this._id=0}constructor(e,t,n,r,i,s){super(),this._model=e,this._worker=t,this._languageIdCodec=n,this._backgroundTokenizationStore=r,this._configurationService=i,this._maxTokenizationLineLength=s,this.controllerId=se._id++,this._pendingChanges=[],this._states=new ze,this._loggingEnabled=yt("editor.experimental.asyncTokenizationLogging",!1,this._configurationService),this._register(_e(this._loggingEnabled)),this._register(this._model.onDidChangeContent(a=>{this._shouldLog&&console.log("model change",{fileName:this._model.uri.fsPath.split("\\").pop(),changes:K(a.changes)}),this._worker.$acceptModelChanged(this.controllerId,a),this._pendingChanges.push(a)})),this._register(this._model.onDidChangeLanguage(a=>{const u=this._model.getLanguageId(),h=this._languageIdCodec.encodeLanguageId(u);this._worker.$acceptModelLanguageChanged(this.controllerId,u,h)}));const o=this._model.getLanguageId(),c=this._languageIdCodec.encodeLanguageId(o);this._worker.$acceptNewModel({uri:this._model.uri,versionId:this._model.getVersionId(),lines:this._model.getLinesContent(),EOL:this._model.getEOL(),languageId:o,encodedLanguageId:c,maxTokenizationLineLength:this._maxTokenizationLineLength.get(),controllerId:this.controllerId}),this._register(Ee(a=>{const u=this._maxTokenizationLineLength.read(a);this._worker.$acceptMaxTokenizationLineLength(this.controllerId,u)}))}dispose(){super.dispose(),this._worker.$acceptRemovedModel(this.controllerId)}requestTokens(e,t){this._worker.$retokenize(this.controllerId,e,t)}async setTokensAndStates(e,t,n,r){if(this.controllerId!==e)return;let i=ue.deserialize(new Uint8Array(n));if(this._shouldLog&&console.log("received background tokenization result",{fileName:this._model.uri.fsPath.split("\\").pop(),updatedTokenLines:i.map(o=>o.getLineRange()).join(" & "),updatedStateLines:r.map(o=>new xe(o.startLineNumber,o.startLineNumber+o.stateDeltas.length).toString()).join(" & ")}),this._shouldLog){const o=this._pendingChanges.filter(c=>c.versionId<=t).map(c=>c.changes).map(c=>K(c)).join(" then ");console.log("Applying changes to local states",o)}for(;this._pendingChanges.length>0&&this._pendingChanges[0].versionId<=t;){const o=this._pendingChanges.shift();this._states.acceptChanges(o.changes)}if(this._pendingChanges.length>0){if(this._shouldLog){const a=this._pendingChanges.map(u=>u.changes).map(u=>K(u)).join(" then ");console.log("Considering non-processed changes",a)}const o=G.fromMany(this._pendingChanges.map(a=>fe(a.changes))),c=new ue;for(const a of i)for(let u=a.startLineNumber;u<=a.endLineNumber;u++)o.transform(u-1)!==void 0&&c.add(u,a.getLineTokens(u));i=c.finalize();for(const a of this._pendingChanges)for(const u of a.changes)for(let h=0;h<i.length;h++)i[h].applyEdit(u.range,u.text)}const s=G.fromMany(this._pendingChanges.map(o=>fe(o.changes)));if(!this._applyStateStackDiffFn||!this._initialState){const{applyStateStackDiff:o,INITIAL:c}=await X(async()=>{const{applyStateStackDiff:a,INITIAL:u}=await import("./main-DpNEsd99.js").then(h=>h.m);return{applyStateStackDiff:a,INITIAL:u}},__vite__mapDeps([0,1]),import.meta.url).then(a=>a.default??a);this._applyStateStackDiffFn=o,this._initialState=c}for(const o of r){let c=o.startLineNumber<=1?this._initialState:this._states.getEndState(o.startLineNumber-1);for(let a=0;a<o.stateDeltas.length;a++){const u=o.stateDeltas[a];let h;u?(h=this._applyStateStackDiffFn(c,u),this._states.setEndState(o.startLineNumber+a,h)):h=this._states.getEndState(o.startLineNumber+a);const k=s.transform(o.startLineNumber+a-1);k!==void 0&&this._backgroundTokenizationStore.setEndState(k+1,h),o.startLineNumber+a>=this._model.getLineCount()-1&&this._backgroundTokenizationStore.backgroundTokenizationFinished(),c=h}}this._backgroundTokenizationStore.setTokens(i)}get _shouldLog(){return this._loggingEnabled.get()}}function fe(l){return new Ct(l.map(e=>new It(e.range.startLineNumber-1,e.range.endLineNumber-e.range.startLineNumber+1,Pe(e.text)[0]+1)))}function K(l){return l.map(e=>Y.lift(e.range).toString()+" => "+e.text).join(" & ")}var $;let Z=class{static{$=this}static{this._reportedMismatchingTokens=!1}constructor(e,t,n,r,i,s,o){this._reportTokenizationTime=e,this._shouldTokenizeAsync=t,this._extensionResourceLoaderService=n,this._configurationService=r,this._languageService=i,this._notificationService=s,this._telemetryService=o,this._workerProxyPromise=null,this._worker=null,this._workerProxy=null,this._workerTokenizerControllers=new Map,this._currentTheme=null,this._currentTokenColorMap=null,this._grammarDefinitions=[]}dispose(){this._disposeWorker()}createBackgroundTokenizer(e,t,n){if(!this._shouldTokenizeAsync()||e.isTooLargeForSyncing())return;const r=new A,i=this._getWorkerProxy().then(s=>{if(r.isDisposed||!s)return;const o={controller:void 0,worker:this._worker};return r.add(zt(e,()=>{const c=new se(e,s,this._languageService.languageIdCodec,t,this._configurationService,n);return o.controller=c,this._workerTokenizerControllers.set(c.controllerId,c),Ae(()=>{o.controller=void 0,this._workerTokenizerControllers.delete(c.controllerId),c.dispose()})})),o});return{dispose(){r.dispose()},requestTokens:async(s,o)=>{const c=await i;c?.controller&&c.worker===this._worker&&c.controller.requestTokens(s,o)},reportMismatchingTokens:s=>{$._reportedMismatchingTokens||($._reportedMismatchingTokens=!0,this._notificationService.error({message:"Async Tokenization Token Mismatch in line "+s,name:"Async Tokenization Token Mismatch"}),this._telemetryService.publicLog2("asyncTokenizationMismatchingTokens",{}))}}}setGrammarDefinitions(e){this._grammarDefinitions=e,this._disposeWorker()}acceptTheme(e,t){this._currentTheme=e,this._currentTokenColorMap=t,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap)}_getWorkerProxy(){return this._workerProxyPromise||(this._workerProxyPromise=this._createWorkerProxy()),this._workerProxyPromise}async _createWorkerProxy(){const e={grammarDefinitions:this._grammarDefinitions,onigurumaWASMUri:new URL(""+new URL("onig-Du5pRr7Y.wasm",import.meta.url).href,import.meta.url).href},t=this._worker=De(ke.asBrowserUri("vs/workbench/services/textMate/browser/backgroundTokenization/worker/textMateTokenizationWorker.workerMain.js"),"TextMateWorker");return V.setChannel(t,{$readFile:async n=>{const r=Ne.revive(n);return this._extensionResourceLoaderService.readExtensionResource(r)},$setTokensAndStates:async(n,r,i,s)=>{const o=this._workerTokenizerControllers.get(n);o&&o.setTokensAndStates(n,r,i,s)},$reportTokenizationTime:(n,r,i,s,o)=>{this._reportTokenizationTime(n,r,i,s,o)}}),await t.proxy.$init(e),this._worker!==t?null:(this._workerProxy=t.proxy,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap),t.proxy)}_disposeWorker(){for(const e of this._workerTokenizerControllers.values())e.dispose();this._workerTokenizerControllers.clear(),this._worker&&(this._worker.dispose(),this._worker=null),this._workerProxy=null,this._workerProxyPromise=null}};Z=$=q([m(2,be),m(3,ne),m(4,ie),m(5,re),m(6,Te)],Z);function zt(l,e){const t=new A,n=t.add(new A);function r(){l.isAttachedToEditor()?n.add(e()):n.clear()}return r(),t.add(l.onDidChangeAttached(()=>{r()})),t}class Et{constructor(){this._scopeNameToLanguageRegistration=Object.create(null)}reset(){this._scopeNameToLanguageRegistration=Object.create(null)}register(e){this._scopeNameToLanguageRegistration[e.scopeName]=e}getGrammarDefinition(e){return this._scopeNameToLanguageRegistration[e]||null}}const B="No TM Grammar registered for this language.";class xt extends z{constructor(e,t,n,r){super(),this._host=e,this._initialState=n.INITIAL,this._scopeRegistry=new Et,this._injections={},this._injectedEmbeddedLanguages={},this._languageToScope=new Map,this._grammarRegistry=this._register(new n.Registry({onigLib:r,loadGrammar:async i=>{const s=this._scopeRegistry.getGrammarDefinition(i);if(!s)return this._host.logTrace(`No grammar found for scope ${i}`),null;const o=s.location;try{const c=await this._host.readFile(o);return n.parseRawGrammar(c,o.path)}catch(c){return this._host.logError(`Unable to load and parse grammar for scope ${i} from ${o}`,c),null}},getInjections:i=>{const s=i.split(".");let o=[];for(let c=1;c<=s.length;c++){const a=s.slice(0,c).join(".");o=[...o,...this._injections[a]||[]]}return o}}));for(const i of t){if(this._scopeRegistry.register(i),i.injectTo){for(const s of i.injectTo){let o=this._injections[s];o||(this._injections[s]=o=[]),o.push(i.scopeName)}if(i.embeddedLanguages)for(const s of i.injectTo){let o=this._injectedEmbeddedLanguages[s];o||(this._injectedEmbeddedLanguages[s]=o=[]),o.push(i.embeddedLanguages)}}i.language&&this._languageToScope.set(i.language,i.scopeName)}}has(e){return this._languageToScope.has(e)}setTheme(e,t){this._grammarRegistry.setTheme(e,t)}getColorMap(){return this._grammarRegistry.getColorMap()}async createGrammar(e,t){const n=this._languageToScope.get(e);if(typeof n!="string")throw new Error(B);const r=this._scopeRegistry.getGrammarDefinition(n);if(!r)throw new Error(B);const i=r.embeddedLanguages;if(this._injectedEmbeddedLanguages[n]){const c=this._injectedEmbeddedLanguages[n];for(const a of c)for(const u of Object.keys(a))i[u]=a[u]}const s=Object.keys(i).length>0;let o;try{o=await this._grammarRegistry.loadGrammarWithConfiguration(n,t,{embeddedLanguages:i,tokenTypes:r.tokenTypes,balancedBracketSelectors:r.balancedBracketSelectors,unbalancedBracketSelectors:r.unbalancedBracketSelectors})}catch(c){throw c.message&&c.message.startsWith("No grammar provided for")?new Error(B):c}return{languageId:e,grammar:o,initialState:this._initialState,containsEmbeddedLanguages:s,sourceExtensionId:r.sourceExtensionId}}}const M=U.registerExtensionPoint({extensionPoint:"grammars",deps:[_t],jsonSchema:{description:g(12579,"Contributes textmate tokenizers."),type:"array",defaultSnippets:[{body:[{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}}],properties:{language:{description:g(12580,"Language identifier for which this syntax is contributed to."),type:"string"},scopeName:{description:g(12581,"Textmate scope name used by the tmLanguage file."),type:"string"},path:{description:g(12582,"Path of the tmLanguage file. The path is relative to the extension folder and typically starts with './syntaxes/'."),type:"string"},embeddedLanguages:{description:g(12583,"A map of scope name to language id if this grammar contains embedded languages."),type:"object"},tokenTypes:{description:g(12584,"A map of scope name to token types."),type:"object",additionalProperties:{enum:["string","comment","other"]}},injectTo:{description:g(12585,"List of language scope names to which this grammar is injected to."),type:"array",items:{type:"string"}},balancedBracketScopes:{description:g(12586,"Defines which scope names contain balanced brackets."),type:"array",items:{type:"string"},default:["*"]},unbalancedBracketScopes:{description:g(12587,"Defines which scope names do not contain balanced brackets."),type:"array",items:{type:"string"},default:[]}},required:["scopeName","path"]}}});var P;let ee=class extends z{static{P=this}static{this.reportTokenizationTimeCounter={sync:0,async:0}}constructor(e,t,n,r,i,s,o,c,a,u){super(),this._languageService=e,this._themeService=t,this._extensionResourceLoaderService=n,this._notificationService=r,this._logService=i,this._configurationService=s,this._progressService=o,this._environmentService=c,this._instantiationService=a,this._telemetryService=u,this._createdModes=[],this._encounteredLanguages=[],this._debugMode=!1,this._debugModePrintFunc=()=>{},this._grammarDefinitions=null,this._grammarFactory=null,this._tokenizersRegistrations=this._register(new A),this._currentTheme=null,this._currentTokenColorMap=null,this._threadedBackgroundTokenizerFactory=this._instantiationService.createInstance(Z,(h,k,w,y,T)=>this._reportTokenizationTime(h,k,w,y,!0,T),()=>this.getAsyncTokenizationEnabled()),this._vscodeOniguruma=null,this._styleElement=Re(),this._styleElement.className="vscode-tokens-styles",M.setHandler(h=>this._handleGrammarsExtPoint(h)),this._updateTheme(this._themeService.getColorTheme(),!0),this._register(this._themeService.onDidColorThemeChange(()=>{this._updateTheme(this._themeService.getColorTheme(),!1)})),this._register(this._languageService.onDidRequestRichLanguageFeatures(h=>{this._createdModes.push(h)}))}getAsyncTokenizationEnabled(){return!!this._configurationService.getValue("editor.experimental.asyncTokenization")}getAsyncTokenizationVerification(){return!!this._configurationService.getValue("editor.experimental.asyncTokenizationVerification")}_handleGrammarsExtPoint(e){this._grammarDefinitions=null,this._grammarFactory&&(this._grammarFactory.dispose(),this._grammarFactory=null),this._tokenizersRegistrations.clear(),this._grammarDefinitions=[];for(const t of e){const n=t.value;for(const r of n){const i=this._validateGrammarDefinition(t,r);if(i&&(this._grammarDefinitions.push(i),i.language)){const s=new je(()=>this._createTokenizationSupport(i.language));this._tokenizersRegistrations.add(s),this._tokenizersRegistrations.add(Q.registerFactory(i.language,s))}}}this._threadedBackgroundTokenizerFactory.setGrammarDefinitions(this._grammarDefinitions);for(const t of this._createdModes)Q.getOrCreate(t)}_validateGrammarDefinition(e,t){if(!Nt(e.description.extensionLocation,t,e.collector,this._languageService))return null;const n=Se(e.description.extensionLocation,t.path),r=Object.create(null);if(t.embeddedLanguages){const c=Object.keys(t.embeddedLanguages);for(let a=0,u=c.length;a<u;a++){const h=c[a],k=t.embeddedLanguages[h];typeof k=="string"&&this._languageService.isRegisteredLanguageId(k)&&(r[h]=this._languageService.languageIdCodec.encodeLanguageId(k))}}const i=Object.create(null);if(t.tokenTypes){const c=Object.keys(t.tokenTypes);for(const a of c)switch(t.tokenTypes[a]){case"string":i[a]=v.String;break;case"other":i[a]=v.Other;break;case"comment":i[a]=v.Comment;break}}const s=t.language&&this._languageService.isRegisteredLanguageId(t.language)?t.language:void 0;function o(c,a){return!Array.isArray(c)||!c.every(u=>typeof u=="string")?a:c}return{location:n,language:s,scopeName:t.scopeName,embeddedLanguages:r,tokenTypes:i,injectTo:t.injectTo,balancedBracketSelectors:o(t.balancedBracketScopes,["*"]),unbalancedBracketSelectors:o(t.unbalancedBracketScopes,[]),sourceExtensionId:e.description.id}}startDebugMode(e,t){if(this._debugMode){this._notificationService.error(g(12568,"Already Logging."));return}this._debugModePrintFunc=e,this._debugMode=!0,this._debugMode&&this._progressService.withProgress({location:Oe.Notification,buttons:[g(12569,"Stop")]},n=>(n.report({message:g(12570,"Preparing to log TM Grammar parsing. Press Stop when finished.")}),this._getVSCodeOniguruma().then(r=>(r.setDefaultDebugCall(!0),n.report({message:g(12571,"Now logging TM Grammar parsing. Press Stop when finished.")}),new Promise((i,s)=>{})))),n=>{this._getVSCodeOniguruma().then(r=>{this._debugModePrintFunc=()=>{},this._debugMode=!1,r.setDefaultDebugCall(!1),t()})})}_canCreateGrammarFactory(){return!!this._grammarDefinitions}async _getOrCreateGrammarFactory(){if(this._grammarFactory)return this._grammarFactory;const[e,t]=await Promise.all([X(()=>import("./main-DpNEsd99.js").then(r=>r.m),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default??r),this._getVSCodeOniguruma()]),n=Promise.resolve({createOnigScanner:r=>t.createOnigScanner(r),createOnigString:r=>t.createOnigString(r)});return this._grammarFactory?this._grammarFactory:(this._grammarFactory=new xt({logTrace:r=>this._logService.trace(r),logError:(r,i)=>this._logService.error(r,i),readFile:r=>this._extensionResourceLoaderService.readExtensionResource(r)},this._grammarDefinitions||[],e,n),this._updateTheme(this._themeService.getColorTheme(),!0),this._grammarFactory)}async _createTokenizationSupport(e){if(!this._languageService.isRegisteredLanguageId(e)||!this._canCreateGrammarFactory())return null;try{const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const n=this._languageService.languageIdCodec.encodeLanguageId(e),r=await t.createGrammar(e,n);if(!r.grammar)return null;const i=At("editor.maxTokenizationLineLength",e,-1,this._configurationService),s=new A,o=s.add(new vt(r.grammar,r.initialState,r.containsEmbeddedLanguages,(c,a)=>this._threadedBackgroundTokenizerFactory.createBackgroundTokenizer(c,a,i),()=>this.getAsyncTokenizationVerification(),(c,a,u)=>{this._reportTokenizationTime(c,e,r.sourceExtensionId,a,!1,u)},!0));return s.add(o.onDidEncounterLanguage(c=>{if(!this._encounteredLanguages[c]){const a=this._languageService.languageIdCodec.decodeLanguageId(c);this._encounteredLanguages[c]=!0,this._languageService.requestBasicLanguageFeatures(a)}})),new Lt(n,o,s,i)}catch(t){return t.message&&t.message===B||Fe(t),null}}_updateTheme(e,t){if(!t&&this._currentTheme&&this._currentTokenColorMap&&Dt(this._currentTheme.settings,e.tokenColors)&&$e(this._currentTokenColorMap,e.tokenColorMap))return;this._currentTheme={name:e.label,settings:e.tokenColors},this._currentTokenColorMap=e.tokenColorMap,this._grammarFactory?.setTheme(this._currentTheme,this._currentTokenColorMap);const n=Pt(this._currentTokenColorMap),r=Be(n);this._styleElement.textContent=r,Q.setColorMap(n),this._currentTheme&&this._currentTokenColorMap&&this._threadedBackgroundTokenizerFactory.acceptTheme(this._currentTheme,this._currentTokenColorMap)}async createTokenizer(e){if(!this._languageService.isRegisteredLanguageId(e))return null;const t=await this._getOrCreateGrammarFactory();if(!t.has(e))return null;const n=this._languageService.languageIdCodec.encodeLanguageId(e),{grammar:r}=await t.createGrammar(e,n);return r}_getVSCodeOniguruma(){return this._vscodeOniguruma||(this._vscodeOniguruma=(async()=>{const[e,t]=await Promise.all([X(()=>import("./main-xd0e82CV.js").then(n=>n.m),__vite__mapDeps([2,1]),import.meta.url).then(n=>n.default??n),this._loadVSCodeOnigurumaWASM()]);return await e.loadWASM({data:t,print:n=>{this._debugModePrintFunc(n)}}),e})()),this._vscodeOniguruma}async _loadVSCodeOnigurumaWASM(){return Ve?await(await fetch(new URL(""+new URL("onig-Du5pRr7Y.wasm",import.meta.url).href,import.meta.url).href)).arrayBuffer():await fetch(ke.asBrowserUri(`${Ge}/vscode-oniguruma/release/onig.wasm`).toString(!0))}_reportTokenizationTime(e,t,n,r,i,s){const o=i?"async":"sync";P.reportTokenizationTimeCounter[o]>50||(P.reportTokenizationTimeCounter[o]===0&&setTimeout(()=>{P.reportTokenizationTimeCounter[o]=0},1e3*60*60),P.reportTokenizationTimeCounter[o]++,this._telemetryService.publicLog2("editor.tokenizedLine",{timeMs:e,languageId:t,lineLength:r,fromWorker:i,sourceExtensionId:n,isRandomSample:s,tokenizationSetting:this.getAsyncTokenizationEnabled()?this.getAsyncTokenizationVerification()?2:1:0}))}};ee=P=q([m(0,ie),m(1,we),m(2,be),m(3,re),m(4,qe),m(5,ne),m(6,Ue),m(7,Je),m(8,ye),m(9,Te)],ee);function Pt(l){const e=[null];for(let t=1,n=l.length;t<n;t++)e[t]=F.fromHex(l[t]);return e}function Dt(l,e){if(!e||!l||e.length!==l.length)return!1;for(let t=e.length-1;t>=0;t--){const n=e[t],r=l[t];if(n.scope!==r.scope)return!1;const i=n.settings,s=r.settings;if(i&&s){if(i.fontStyle!==s.fontStyle||i.foreground!==s.foreground||i.background!==s.background)return!1}else if(!i||!s)return!1}return!0}function Nt(l,e,t,n){if(e.language&&(typeof e.language!="string"||!n.isRegisteredLanguageId(e.language)))return t.error(g(12572,"Unknown language in `contributes.{0}.language`. Provided value: {1}",M.name,String(e.language))),!1;if(!e.scopeName||typeof e.scopeName!="string")return t.error(g(12573,"Expected string in `contributes.{0}.scopeName`. Provided value: {1}",M.name,String(e.scopeName))),!1;if(!e.path||typeof e.path!="string")return t.error(g(12574,"Expected string in `contributes.{0}.path`. Provided value: {1}",M.name,String(e.path))),!1;if(e.injectTo&&(!Array.isArray(e.injectTo)||e.injectTo.some(i=>typeof i!="string")))return t.error(g(12575,"Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}",M.name,JSON.stringify(e.injectTo))),!1;if(e.embeddedLanguages&&!le(e.embeddedLanguages))return t.error(g(12576,"Invalid value in `contributes.{0}.embeddedLanguages`. Must be an object map from scope name to language. Provided value: {1}",M.name,JSON.stringify(e.embeddedLanguages))),!1;if(e.tokenTypes&&!le(e.tokenTypes))return t.error(g(12577,"Invalid value in `contributes.{0}.tokenTypes`. Must be an object map from scope name to token type. Provided value: {1}",M.name,JSON.stringify(e.tokenTypes))),!1;const r=Se(l,e.path);return We(r,l)||t.warn(g(12578,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",M.name,r.path,l.path)),!0}function At(l,e,t,n){return He(r=>n.onDidChangeConfiguration(i=>{i.affectsConfiguration(l,{overrideIdentifier:e})&&r(i)}),()=>n.getValue(l,{overrideIdentifier:e})??t)}const I=bt(),Rt=U.registerExtensionPoint({extensionPoint:"semanticTokenTypes",jsonSchema:{description:g(12775,"Contributes semantic token types."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(12776,"The identifier of the semantic token type"),pattern:R,patternErrorMessage:g(12777,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},superType:{type:"string",description:g(12778,"The super type of the semantic token type"),pattern:R,patternErrorMessage:g(12779,"Super types should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(12780,"The description of the semantic token type")}}}}}),jt=U.registerExtensionPoint({extensionPoint:"semanticTokenModifiers",jsonSchema:{description:g(12781,"Contributes semantic token modifiers."),type:"array",items:{type:"object",properties:{id:{type:"string",description:g(12782,"The identifier of the semantic token modifier"),pattern:R,patternErrorMessage:g(12783,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:g(12784,"The description of the semantic token modifier")}}}}}),Ot=U.registerExtensionPoint({extensionPoint:"semanticTokenScopes",jsonSchema:{description:g(12785,"Contributes semantic token scope maps."),type:"array",items:{type:"object",properties:{language:{description:g(12786,"Lists the languge for which the defaults are."),type:"string"},scopes:{description:g(12787,"Maps a semantic token (described by semantic token selector) to one or more textMate scopes used to represent that token."),type:"object",additionalProperties:{type:"array",items:{type:"string"}}}}}}});class Ft{constructor(){function e(t,n,r){if(typeof t.id!="string"||t.id.length===0)return r.error(g(12788,"'configuration.{0}.id' must be defined and can not be empty",n)),!1;if(!t.id.match(R))return r.error(g(12789,"'configuration.{0}.id' must follow the pattern letterOrDigit[-_letterOrDigit]*",n)),!1;const i=t.superType;return i&&!i.match(R)?(r.error(g(12790,"'configuration.{0}.superType' must follow the pattern letterOrDigit[-_letterOrDigit]*",n)),!1):typeof t.description!="string"||t.id.length===0?(r.error(g(12791,"'configuration.{0}.description' must be defined and can not be empty",n)),!1):!0}Rt.setHandler((t,n)=>{for(const r of n.added){const i=r.value,s=r.collector;if(!i||!Array.isArray(i)){s.error(g(12792,"'configuration.semanticTokenType' must be an array"));return}for(const o of i)e(o,"semanticTokenType",s)&&I.registerTokenType(o.id,o.description,o.superType)}for(const r of n.removed){const i=r.value;for(const s of i)I.deregisterTokenType(s.id)}}),jt.setHandler((t,n)=>{for(const r of n.added){const i=r.value,s=r.collector;if(!i||!Array.isArray(i)){s.error(g(12793,"'configuration.semanticTokenModifier' must be an array"));return}for(const o of i)e(o,"semanticTokenModifier",s)&&I.registerTokenModifier(o.id,o.description)}for(const r of n.removed){const i=r.value;for(const s of i)I.deregisterTokenModifier(s.id)}}),Ot.setHandler((t,n)=>{for(const r of n.added){const i=r.value,s=r.collector;if(!i||!Array.isArray(i)){s.error(g(12794,"'configuration.semanticTokenScopes' must be an array"));return}for(const o of i){if(o.language&&typeof o.language!="string"){s.error(g(12795,"'configuration.semanticTokenScopes.language' must be a string"));continue}if(!o.scopes||typeof o.scopes!="object"){s.error(g(12796,"'configuration.semanticTokenScopes.scopes' must be defined as an object"));continue}for(const c in o.scopes){const a=o.scopes[c];if(!Array.isArray(a)||a.some(u=>typeof u!="string")){s.error(g(12797,"'configuration.semanticTokenScopes.scopes' values must be an array of strings"));continue}try{const u=I.parseTokenSelector(c,o.language);I.registerTokenStyleDefault(u,{scopesToProbe:a.map(h=>h.split(" "))})}catch{s.error(g(12798,"configuration.semanticTokenScopes.scopes': Problems parsing selector {0}.",c))}}}}for(const r of n.removed){const i=r.value;for(const s of i)for(const o in s.scopes){const c=s.scopes[o];try{const a=I.parseTokenSelector(o,s.language);I.registerTokenStyleDefault(a,{scopesToProbe:c.map(u=>u.split(" "))})}catch{}}}})}}let W=class{static{this.ID="workbench.contrib.tokenClassificationExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(Ft)}};W=q([m(0,ye)],W);Qe(W.ID,W,Ke.BlockStartup);const $t=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function Bt(l,e,t=!0){for(let n=e.length-1;n>=0;n--){const r=e.slice(0,n),i=e[n],s=Vt(l,i,r,t);if(s)return s}return null}function Vt(l,e,t,n){let r=null;for(let i=l.tokenColors.length-1;i>=0;i--){const s=l.tokenColors[i];if(n&&!s.settings.foreground)continue;let o;if(typeof s.scope=="string")o=s.scope.split(/,/).map(c=>c.trim());else if(Array.isArray(s.scope))o=s.scope;else continue;for(let c=0,a=o.length;c<a;c++){const u=o[c],h=new H(u,s.settings);h.matches(e,t)&&h.isMoreSpecific(r)&&(r=h)}}return r}class H{constructor(e,t){this.rawSelector=e,this.settings=t;const n=this.rawSelector.split(/ /);this.scope=n[n.length-1],this.parentScopes=n.slice(0,n.length-1)}matches(e,t){return H._matches(this.scope,this.parentScopes,e,t)}static _cmp(e,t){if(e===null&&t===null)return 0;if(e===null)return-1;if(t===null)return 1;if(e.scope.length!==t.scope.length)return e.scope.length-t.scope.length;const n=e.parentScopes.length,r=t.parentScopes.length;if(n!==r)return n-r;for(let i=0;i<n;i++){const s=e.parentScopes[i].length,o=t.parentScopes[i].length;if(s!==o)return s-o}return 0}isMoreSpecific(e){return H._cmp(this,e)>0}static _matchesOne(e,t){const n=e+".";return e===t||t.substring(0,n.length)===n}static _matches(e,t,n,r){if(!this._matchesOne(e,n))return!1;let i=t.length-1,s=r.length-1;for(;i>=0&&s>=0;)this._matchesOne(t[i],r[s])&&i--,s--;return i===-1}}var te;Ye($t);const d=rt;let D=class extends z{static{te=this}static{this.ID="editor.contrib.inspectEditorTokens"}static get(e){return e.getContribution(te.ID)}constructor(e,t,n,r,i,s,o,c){super(),this._editor=e,this._textMateService=t,this._treeSitterService=n,this._themeService=i,this._languageService=r,this._notificationService=s,this._configurationService=o,this._languageFeaturesService=c,this._widget=null,this._register(this._editor.onDidChangeModel(a=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(a=>this.stop())),this._register(this._editor.onKeyUp(a=>a.keyCode===Xe.Escape&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&this._editor.getModel().uri.scheme!==Ze.vscodeNotebookCell&&(this._widget=new ae(this._editor,this._textMateService,this._treeSitterService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}toggle(){this._widget?this.stop():this.launch()}};D=te=q([m(1,oe),m(2,et),m(3,ie),m(4,we),m(5,re),m(6,ne),m(7,tt)],D);class Gt extends lt{constructor(){super({id:"editor.action.inspectTMScopes",label:gt(5154,"Developer: Inspect Editor Tokens and Scopes"),precondition:void 0})}run(e,t){D.get(t)?.toggle()}}function pe(l){l.length>40&&(l=l.substr(0,20)+"…"+l.substr(l.length-20));let e="";for(let t=0,n=l.length;t<n;t++){const r=l.charCodeAt(t);switch(r){case he.Tab:e+="→";break;case he.Space:e+="·";break;default:e+=String.fromCharCode(r)}}return e}class ae extends z{static{this._ID="editor.contrib.inspectEditorTokensWidget"}constructor(e,t,n,r,i,s,o,c){super(),this.allowEditorOverflow=!0,this._isDisposed=!1,this._editor=e,this._languageService=r,this._themeService=i,this._textMateService=t,this._treeSitterService=n,this._notificationService=s,this._configurationService=o,this._languageFeaturesService=c,this._model=this._editor.getModel(),this._domNode=document.createElement("div"),this._domNode.className="token-inspect-widget",this._currentRequestCancellationTokenSource=new nt,this._beginCompute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(a=>this._beginCompute(this._editor.getPosition()))),this._register(i.onDidColorThemeChange(a=>this._beginCompute(this._editor.getPosition()))),this._register(o.onDidChangeConfiguration(a=>a.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._isDisposed=!0,this._editor.removeContentWidget(this),this._currentRequestCancellationTokenSource.cancel(),super.dispose()}getId(){return ae._ID}_beginCompute(e){const t=this._textMateService.createTokenizer(this._model.getLanguageId()),n=this._computeSemanticTokens(e),r=this._treeSitterService.getParseResult(this._model);it(this._domNode),this._domNode.appendChild(document.createTextNode(g(5155,"Loading..."))),Promise.all([t,n]).then(([i,s])=>{this._isDisposed||(this._compute(i,s,r,e),this._domNode.style.maxWidth=`${Math.max(this._editor.getLayoutInfo().width*.66,500)}px`,this._editor.layoutContentWidget(this))},i=>{this._notificationService.warn(i),setTimeout(()=>{D.get(this._editor)?.stop()})})}_isSemanticColoringEnabled(){const e=this._configurationService.getValue(kt,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri})?.enabled;return typeof e=="boolean"?e:this._themeService.getColorTheme().semanticHighlighting}_compute(e,t,n,r){const i=e&&this._getTokensAtPosition(e,r),s=t&&this._getSemanticTokenAtPosition(t,r),o=n&&this._getTreeSitterTokenAtPosition(n,r);if(!i&&!s&&!o){ge(this._domNode,"No grammar or semantic tokens available.");return}const c=i?.metadata,a=s?.metadata,u=s&&pe(this._model.getValueInRange(s.range)),h=i&&pe(this._model.getLineContent(r.lineNumber).substring(i.token.startIndex,i.token.endIndex)),k=u||h||"";if(ge(this._domNode,d("h2.tiw-token",void 0,k,d("span.tiw-token-length",void 0,`${k.length} ${k.length===1?"char":"chars"}`))),p(this._domNode,d("hr.tiw-metadata-separator",{style:"clear:both"})),p(this._domNode,d("table.tiw-metadata-table",void 0,d("tbody",void 0,d("tr",void 0,d("td.tiw-metadata-key",void 0,"language"),d("td.tiw-metadata-value",void 0,c?.languageId||"")),d("tr",void 0,d("td.tiw-metadata-key",void 0,"standard token type"),d("td.tiw-metadata-value",void 0,this._tokenTypeToString(c?.tokenType||v.Other))),...this._formatMetadata(a,c)))),s){p(this._domNode,d("hr.tiw-metadata-separator"));const w=p(this._domNode,d("table.tiw-metadata-table",void 0)),y=p(w,d("tbody",void 0,d("tr",void 0,d("td.tiw-metadata-key",void 0,"semantic token type"),d("td.tiw-metadata-value",void 0,s.type))));if(s.modifiers.length&&p(y,d("tr",void 0,d("td.tiw-metadata-key",void 0,"modifiers"),d("td.tiw-metadata-value",void 0,s.modifiers.join(" ")))),s.metadata){const T=["foreground","bold","italic","underline","strikethrough"],S={},b=new Array;for(const f of T)if(s.metadata[f]!==void 0){const _=s.definitions[f],L=this._renderTokenStyleDefinition(_,f),C=L.map(j=>ot(j)?j.outerHTML:j).join();let N=S[C];N||(S[C]=N=[],b.push([L,C])),N.push(f)}for(const[f,_]of b)p(y,d("tr",void 0,d("td.tiw-metadata-key",void 0,S[_].join(", ")),d("td.tiw-metadata-value",void 0,...f)))}}if(i){const w=this._themeService.getColorTheme();p(this._domNode,d("hr.tiw-metadata-separator"));const y=p(this._domNode,d("table.tiw-metadata-table")),T=p(y,d("tbody"));h&&h!==k&&p(T,d("tr",void 0,d("td.tiw-metadata-key",void 0,"textmate token"),d("td.tiw-metadata-value",void 0,`${h} (${h.length})`)));const S=new Array;for(let _=i.token.scopes.length-1;_>=0;_--)S.push(i.token.scopes[_]),_>0&&S.push(d("br"));p(T,d("tr",void 0,d("td.tiw-metadata-key",void 0,"textmate scopes"),d("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...S)));const b=Bt(w,i.token.scopes,!1),f=s?.metadata?.foreground;if(b){if(f!==i.metadata.foreground){let _=d("code.tiw-theme-selector",void 0,b.rawSelector,d("br"),JSON.stringify(b.settings,null,"	"));f&&(_=d("s",void 0,_)),p(T,d("tr",void 0,d("td.tiw-metadata-key",void 0,"foreground"),d("td.tiw-metadata-value",void 0,_)))}}else f||p(T,d("tr",void 0,d("td.tiw-metadata-key",void 0,"foreground"),d("td.tiw-metadata-value",void 0,"No theme selector")))}if(o){const w=o[o.length-1];p(this._domNode,d("hr.tiw-metadata-separator"));const y=p(this._domNode,d("table.tiw-metadata-table")),T=p(y,d("tbody"));p(T,d("tr",void 0,d("td.tiw-metadata-key",void 0,`tree-sitter token ${w.id}`),d("td.tiw-metadata-value",void 0,`${w.text}`)));const S=new Array;let b=o.length-1,f=o[b];for(;f.parent||b>0;)S.push(f.type),f=f.parent??o[--b],f&&S.push(d("br"));p(T,d("tr",void 0,d("td.tiw-metadata-key",void 0,"tree-sitter tree"),d("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...S)));const L=st.get(this._model.getLanguageId())?.captureAtPosition(r.lineNumber,r.column,this._model);L&&L.length>0&&p(T,d("tr",void 0,d("td.tiw-metadata-key",void 0,"foreground"),d("td.tiw-metadata-value",void 0,L.map(C=>C.name).join(" "))))}}_formatMetadata(e,t){const n=new Array;function r(a){const u=e?.[a]||t?.[a];if(u!==void 0){const h=e?.[a]?"tiw-metadata-semantic":"";n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,a),d(`td.tiw-metadata-value.${h}`,void 0,u)))}return u}const i=r("foreground"),s=r("background");if(i&&s){const a=F.fromHex(s),u=F.fromHex(i);a.isOpaque()?n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,"contrast ratio"),d("td.tiw-metadata-value",void 0,a.getContrastRatio(u.makeOpaque(a)).toFixed(2)))):n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),d("td.tiw-metadata-value")))}const o=new Array;function c(a){let u;e&&e[a]?u=d("span.tiw-metadata-semantic",void 0,a):t&&t[a]&&(u=a),u&&(o.length&&o.push(" "),o.push(u))}return c("bold"),c("italic"),c("underline"),c("strikethrough"),o.length&&n.push(d("tr",void 0,d("td.tiw-metadata-key",void 0,"font style"),d("td.tiw-metadata-value",void 0,...o))),n}_decodeMetadata(e){const t=this._themeService.getColorTheme().tokenColorMap,n=x.getLanguageId(e),r=x.getTokenType(e),i=x.getFontStyle(e),s=x.getForeground(e),o=x.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(n),tokenType:r,bold:i&O.Bold?!0:void 0,italic:i&O.Italic?!0:void 0,underline:i&O.Underline?!0:void 0,strikethrough:i&O.Strikethrough?!0:void 0,foreground:t[s],background:t[o]}}_tokenTypeToString(e){switch(e){case v.Other:return"Other";case v.Comment:return"Comment";case v.String:return"String";case v.RegEx:return"RegEx";default:return"??"}}_getTokensAtPosition(e,t){const n=t.lineNumber,r=this._getStateBeforeLine(e,n),i=e.tokenizeLine(this._model.getLineContent(n),r),s=e.tokenizeLine2(this._model.getLineContent(n),r);let o=0;for(let a=i.tokens.length-1;a>=0;a--){const u=i.tokens[a];if(t.column-1>=u.startIndex){o=a;break}}let c=0;for(let a=s.tokens.length>>>1;a>=0;a--)if(t.column-1>=s.tokens[a<<1]){c=a;break}return{token:i.tokens[o],metadata:this._decodeMetadata(s.tokens[(c<<1)+1])}}_getStateBeforeLine(e,t){let n=null;for(let r=1;r<t;r++)n=e.tokenizeLine(this._model.getLineContent(r),n).ruleStack;return n}isSemanticTokens(e){return e&&e.data}async _computeSemanticTokens(e){if(!this._isSemanticColoringEnabled())return null;const t=this._languageFeaturesService.documentSemanticTokensProvider.ordered(this._model);if(t.length){const r=t[0],i=await Promise.resolve(r.provideDocumentSemanticTokens(this._model,null,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(i))return{tokens:i,legend:r.getLegend()}}const n=this._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(this._model);if(n.length){const r=n[0],i=e.lineNumber,s=new Y(i,1,i,this._model.getLineMaxColumn(i)),o=await Promise.resolve(r.provideDocumentRangeSemanticTokens(this._model,s,this._currentRequestCancellationTokenSource.token));if(this.isSemanticTokens(o))return{tokens:o,legend:r.getLegend()}}return null}_getSemanticTokenAtPosition(e,t){const n=e.tokens.data,r=this._model.getLanguageId();let i=0,s=0;const o=t.lineNumber-1,c=t.column-1;for(let a=0;a<n.length;a+=5){const u=n[a],h=n[a+1],k=n[a+2],w=n[a+3],y=n[a+4],T=i+u,S=u===0?s+h:h;if(o===T&&S<=c&&c<S+k){const b=e.legend.tokenTypes[w]||"not in legend (ignored)",f=[];let _=y;for(let J=0;_>0&&J<e.legend.tokenModifiers.length;J++)_&1&&f.push(e.legend.tokenModifiers[J]),_=_>>1;_>0&&f.push("not in legend (ignored)");const L=new Y(T+1,S+1,T+1,S+1+k),C={},N=this._themeService.getColorTheme().tokenColorMap,E=this._themeService.getColorTheme().getTokenStyleMetadata(b,f,r,!0,C);let ce;return E&&(ce={languageId:void 0,tokenType:v.Other,bold:E?.bold,italic:E?.italic,underline:E?.underline,strikethrough:E?.strikethrough,foreground:N[E?.foreground||at.None],background:void 0}),{type:b,modifiers:f,range:L,metadata:ce,definitions:C}}i=T,s=S}return null}_walkTreeforPosition(e,t){const n=this._model.getOffsetAt(t);e.gotoFirstChild();let r=!1,i=null;do e.currentNode.startIndex<=n&&n<e.currentNode.endIndex?(r=!0,i=e.currentNode):r=!1;while(r?e.gotoFirstChild():e.gotoNextSibling());return i}_getTreeSitterTokenAtPosition(e,t){let n=e.parseResult;if(!n?.tree)return null;const r=[];do{const i=n.tree.walk(),s=this._walkTreeforPosition(i,t);s?(r.push(s),n=e.getInjection(s.startIndex,n.languageId)):n=void 0}while(n?.tree);return r.length>0?r:null}_renderTokenStyleDefinition(e,t){const n=new Array;if(e===void 0)return n;const r=this._themeService.getColorTheme();if(Array.isArray(e)){const i={};r.resolveScopes(e,i);const s=i[t];if(s&&i.scope){const o=d("ul.tiw-metadata-values"),c=Array.isArray(s.scope)?s.scope:[String(s.scope)];for(const a of c)o.appendChild(d("li.tiw-metadata-value.tiw-metadata-scopes",void 0,a));return n.push(i.scope.join(" "),o,d("code.tiw-theme-selector",void 0,JSON.stringify(s.settings,null,"	"))),n}return n}else if(wt.is(e)){const i=r.getTokenStylingRuleScope(e);return i==="setting"?(n.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),n):(i==="theme"&&n.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),n)}else{const i=r.resolveTokenStyleValue(e);return n.push(`Default: ${i?this._renderStyleProperty(i,t):""}`),n}}_renderStyleProperty(e,t){switch(t){case"foreground":return e.foreground?F.Format.CSS.formatHexA(e.foreground,!0):"";default:return e[t]!==void 0?String(e[t]):""}}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[me.BELOW,me.ABOVE]}}}ct(D.ID,D,dt.Lazy);ut(Gt);St(async l=>{l.get(mt).when(ft.Ready).then(()=>{pt.get(oe)})});function en(){return{...Tt(),[oe.toString()]:new ht(ee,[],!1)}}export{oe as ITextMateTokenizationService,en as default};

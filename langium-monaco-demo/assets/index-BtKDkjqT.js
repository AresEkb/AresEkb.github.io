import{cG as W,bc as U,cs as Q,_ as z,o as ee,I as te,bz as ie,d6 as oe,aP as re,bU as ne,a0 as se,$ as ae,q as le,bX as de,ac as p,ae as M,df as T,U as ue,w as K,Y as ce,cp as fe,lB as pe,bM as ge}from"./monaco-vscode-base-service-override-BYqBQsid.js";import{iH as Xe,m3 as qe}from"./monaco-vscode-base-service-override-BYqBQsid.js";import{gY as Pe,gZ as we,g_ as u}from"./monaco-vscode-api-DkhVdw0_.js";import{h2 as Je,h3 as je,g$ as Qe,h1 as ze,dO as et,h0 as tt}from"./monaco-vscode-api-DkhVdw0_.js";import{g as me,a as ve,E as ye,S as Re,P as Se,A as he}from"./views-BeMLbGuH.js";import{b as ot}from"./views-BeMLbGuH.js";import{f as L,c9 as Te,e as be,I as Ae,q as Ce,b0 as g,bZ as O,c2 as V,a5 as Ee,cb as x,L as E}from"./monaco-vscode-configuration-service-override-DGcvGpAH.js";import{J as nt,K as st,G as at}from"./monaco-vscode-configuration-service-override-DGcvGpAH.js";import{M as Ie,a as Be}from"./editor-CStWgq9P.js";import"./monaco-vscode-editor-api-BYa5i2YN.js";import"./files.contribution._fileEditorFactory-Ck0whLBb.js";import"./workbenchThemeService.service-B8QZVqmt.js";import"./monaco-vscode-extension-api-D9foA0bl.js";function Oe(t,r,d){const P=document.createElement(r==="status"?"footer":"div");return P.classList.add("part","monaco-workbench-part",...d),P.id=t,P.setAttribute("role",r),r==="status"&&P.setAttribute("aria-live","off"),P}function Ve(t){const r=t.getContainer()?.parentNode;r!=null&&t.layout(Math.max(t.minimumWidth,Math.min(t.maximumWidth,r.offsetWidth)),Math.max(t.minimumHeight,Math.min(t.maximumHeight,r.offsetHeight)),r.offsetTop,r.offsetLeft)}function xe(t,r){t.oncontextmenu=()=>!1;function d(){Ve(r)}r.onDidVisibilityChange(P=>{P&&d()}),d()}function De(t){return t.isConnected?t.checkVisibility!=null?t.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}):t.offsetHeight>0&&t.offsetWidth>0:!1}function I(){const t=Q.get(L).mainPart.getContainer();return t!=null&&De(t)}let D=class extends Be{constructor(r){super(r.createInstance(ye),!1,r),this.restoreGroup=(...d)=>this.delegate.restoreGroup(...d)}getId(){return"standalone"}updateStyles(){}registerPart(r){return this.delegate.registerPart(r)}bind(r,d){return this.delegate.bind(r,d)}get activePart(){return this.delegate.activePart}};D=z([ee(0,te)],D);let H=t=>t;Te(async t=>{const r=t.get(be),d=t.get(we),P=t.get(ie),y=t.get(oe),R=t.get(L),N=t.get(U),S=t.get(re),Y=t.get(Ae),b=t.get(ne),k=t.get(se),_=t.get(ae),F=t.get(le),$=t.get(Ce),c=t.get(de);function X(){const e=b.options?.defaultLayout;if((e?.editors!=null&&e.editors.length>0||e?.layout?.editors!=null)&&((e.force??!1)||y.isNew(T.WORKSPACE)))return{layout:e.layout?.editors,filesToOpenOrCreate:e.editors?.map(i=>({viewColumn:i.viewColumn,fileUri:ue.revive(i.uri),openOnlyIfExists:i.openOnlyIfExists,options:i.options}))};const{filesToOpenOrCreate:l,filesToDiff:o,filesToMerge:a}=b;if(l!=null||o!=null||a!=null)return{filesToOpenOrCreate:l,filesToDiff:o,filesToMerge:a}}function q(e,l){const o=e.options?.defaultLayout;if(o==null||!(o.force??!1)&&!l.isNew(T.WORKSPACE))return;const{views:a}=o;if(a!=null&&a.length>0)return a.map(i=>i.id)}function Z(e,l){return fe(e.getWorkspace())?!1:!!(_.getValue("window.restoreWindows")==="preserve")||l===void 0}async function J(e,l){if(l!=null){const o=K(await x(l.filesToMerge,e,S));if(o.length===4&&E(o[0])&&E(o[1])&&E(o[2])&&E(o[3]))return[{editor:{input1:{resource:o[0].resource},input2:{resource:o[1].resource},base:{resource:o[2].resource},result:{resource:o[3].resource},options:{pinned:!0}}}];const a=K(await x(l.filesToDiff,e,S));if(a.length===2)return[{editor:{original:{resource:a[0].resource},modified:{resource:a[1].resource},options:{pinned:!0}}}];const i=[],f=await x(l.filesToOpenOrCreate,e,S);for(let s=0;s<f.length;s++){const w=f[s];w!=null&&i.push({editor:w,viewColumn:l.filesToOpenOrCreate?.[s].viewColumn})}return i}else if(k.getWorkbenchState()===ce.EMPTY&&_.getValue("workbench.startupEditor")==="newUntitledFile")return R.mainPart.hasRestorableState?[]:await $.hasBackups()?[]:[{editor:{resource:void 0}}];return[]}const h=X();h!=null&&S.info("Initial editor state",h);let n={layout:{editors:h?.layout},editor:{restoreEditors:Z(k,h),editorsToOpen:J(F,h)},views:{defaults:q(b,y),containerToRestore:{}}};function m(e){return d.getDefaultViewContainer(e)??d.getViewContainersByLocation(e)[0]}function j(){if(c.isVisible(g.SIDEBAR_PART)){let e;!b.isBuilt||P.startupKind===pe.ReloadedWindow||ge?e=y.get(Re.activeViewletSettingsKey,T.WORKSPACE,m(u.Sidebar)?.id):e=m(u.Sidebar)?.id,n.views.containerToRestore.sideBar=e}if(c.isVisible(g.PANEL_PART)){const e=y.get(Se.activePanelSettingsKey,T.WORKSPACE,m(u.Panel)?.id);n.views.containerToRestore.panel=e}if(c.isVisible(g.AUXILIARYBAR_PART)){const e=y.get(he.activeViewSettingsKey,T.WORKSPACE,m(u.AuxiliaryBar)?.id);n.views.containerToRestore.auxiliaryBar=e}}j(),n=H(n),n.views.containerToRestore.sideBar==null&&c.setPartHidden(!0,g.SIDEBAR_PART),n.views.containerToRestore.panel==null&&c.setPartHidden(!0,g.PANEL_PART),n.views.containerToRestore.auxiliaryBar==null&&c.setPartHidden(!0,g.AUXILIARYBAR_PART);const B=document.createElement("div");B.style.display="none",document.body.append(B);for(const{id:e,role:l,classes:o,options:a,getPosition:i,onDidChangePosition:f}of[{id:g.TITLEBAR_PART,role:"none",classes:["titlebar"]},{id:g.BANNER_PART,role:"banner",classes:["banner"]},{id:g.ACTIVITYBAR_PART,role:"none",classes:["activitybar"],getPosition:()=>c.getSideBarPosition(),onDidChangePosition:c.onDidChangeSideBarPosition},{id:g.SIDEBAR_PART,role:"none",classes:["sidebar"],getPosition:()=>c.getSideBarPosition(),onDidChangePosition:c.onDidChangeSideBarPosition},{id:g.EDITOR_PART,role:"main",classes:["editor"],options:{restorePreviousState:n.editor.restoreEditors}},{id:g.PANEL_PART,role:"none",classes:["panel","basepanel"],getPosition:()=>c.getPanelPosition(),onDidChangePosition:c.onDidChangePanelPosition},{id:g.AUXILIARYBAR_PART,role:"none",classes:["auxiliarybar","basepanel"],getPosition:()=>c.getSideBarPosition()===O.LEFT?O.RIGHT:O.LEFT,onDidChangePosition:c.onDidChangeSideBarPosition},{id:g.STATUSBAR_PART,role:"status",classes:["statusbar"]}]){const s=c.getPart(e);if(s!=null){const w=Oe(e,l,o);if(s.create(w,a),xe(w,s),s.layout(9999,9999,0,0),B.append(w),i!=null){let C=i();s.element.classList.add(V(C)),f?.(()=>{s.element.classList.remove(V(C)),C=i(),s.element.classList.add(V(C))})}}}const v=[],G=[];v.push((async()=>{p("code/willRestoreEditors"),await R.mainPart.whenReady,p("code/restoreEditors/editorGroupsReady"),n.layout?.editors!=null&&R.applyLayout(n.layout.editors);const e=await n.editor.editorsToOpen;p("code/restoreEditors/editorsToOpenResolved");let l;if(e.length>0){const o=R.getGroups(Ee.GRID_APPEARANCE),a=new Map;for(const i of e){const f=o[(i.viewColumn??1)-1];let s=a.get(f.id);s==null&&(s=new Set,a.set(f.id,s)),s.add(i.editor)}l=Promise.all(Array.from(a).map(async([i,f])=>{try{await N.openEditors(Array.from(f),i,{validateTrust:!0})}catch(s){S.error(s)}}))}G.push(Promise.all([l?.finally(()=>p("code/restoreEditors/editorsOpened")),R.mainPart.whenRestored.finally(()=>p("code/restoreEditors/editorGroupsRestored"))]).finally(()=>{p("code/didRestoreEditors")}))})());const A=(async()=>{if(n.views.defaults!=null&&n.views.defaults.length>0){p("code/willOpenDefaultViews");const e=[],l=i=>{const f=d.getViewLocationById(i.id);if(f!==null){const s=d.getViewContainerByViewId(i.id);if(s!=null){i.order>=(e[f]?.order??0)&&(e[f]={id:s.id,order:i.order});const w=d.getViewContainerModel(s);return w.setCollapsed(i.id,!1),w.setVisible(i.id,!0),!0}}return!1},o=[...n.views.defaults].reverse().map((i,f)=>({id:i,order:f}));let a=o.length;for(;a>0;)a--,l(o[a])&&o.splice(a,1);if(o.length>0){await Y.whenInstalledExtensionsRegistered();let i=o.length;for(;i>0;)i--,l(o[i])&&o.splice(i,1)}e[u.Sidebar]!=null&&(n.views.containerToRestore.sideBar=e[u.Sidebar].id),e[u.Panel]!=null&&(n.views.containerToRestore.panel=e[u.Panel].id),e[u.AuxiliaryBar]!=null&&(n.views.containerToRestore.auxiliaryBar=e[u.AuxiliaryBar].id),p("code/didOpenDefaultViews")}})();v.push(A),v.push((async()=>{if(await A,n.views.containerToRestore.sideBar==null)return;p("code/willRestoreViewlet"),await r.openPaneComposite(n.views.containerToRestore.sideBar,u.Sidebar)==null&&await r.openPaneComposite(m(u.Sidebar)?.id,u.Sidebar),p("code/didRestoreViewlet")})()),v.push((async()=>{if(await A,n.views.containerToRestore.panel==null)return;p("code/willRestorePanel"),await r.openPaneComposite(n.views.containerToRestore.panel,u.Panel)==null&&await r.openPaneComposite(m(u.Panel)?.id,u.Panel),p("code/didRestorePanel")})()),v.push((async()=>{if(await A,n.views.containerToRestore.auxiliaryBar==null)return;p("code/willRestoreAuxiliaryBar"),await r.openPaneComposite(n.views.containerToRestore.auxiliaryBar,u.AuxiliaryBar)==null&&await r.openPaneComposite(m(u.AuxiliaryBar)?.id,u.AuxiliaryBar),p("code/didRestoreAuxiliaryBar")})()),await M.settled(v),await M.settled(G)});function Ye(t,r,d){return d!=null&&(H=typeof d=="boolean"?P=>({...P,editor:{...P.editor,restoreEditors:d}}):d),{...ve(r),...Pe({isKeybindingConfigurationVisible:I,shouldUseGlobalPicker:I}),...me({shouldUseGlobalKeybindings:I}),[L.toString()]:new W(D,[],!1),[U.toString()]:new W(Ie,[t,I],!1)}}export{Je as AbstractResourceEditorInput,je as AbstractTextResourceEditorInput,ot as ActivityService,Qe as ActivitybarPart,ze as ConfirmResult,Xe as DomScrollableElement,nt as EditorInput,st as EditorInputCapabilities,at as GroupOrientation,Se as PanelPart,g as Parts,O as Position,et as RegisteredEditorPriority,Re as SidebarPart,qe as SplitView,u as ViewContainerLocation,tt as ViewPaneContainer,Ye as default,I as isEditorPartVisible,xe as renderPart};

import{cI as G,bc as U,cu as Z,_ as z,o as ee,I as te,bA as ie,d7 as oe,aP as re,bV as ne,a0 as se,$ as ae,q as le,bY as de,ac as p,ae as M,dg as T,U as ue,w as K,Y as ce,cr as fe,lA as pe,bN as ge}from"./monaco-vscode-base-service-override-DWrDktfJ.js";import{iL as Xe,m2 as qe}from"./monaco-vscode-base-service-override-DWrDktfJ.js";import{g$ as Pe,h0 as we,h1 as u}from"./monaco-vscode-api-CfKh107e.js";import{h5 as je,h6 as Qe,h2 as Ze,h4 as ze,dU as et,h3 as tt}from"./monaco-vscode-api-CfKh107e.js";import{g as me,a as ve,E as ye,S as Re,P as Se,A as he}from"./views-Dn8IhvUj.js";import{b as ot}from"./views-Dn8IhvUj.js";import{f as D,ca as Te,e as Ae,I as Ce,q as be,b0 as g,b_ as V,c3 as O,a3 as Ee,cc as x,L as E}from"./monaco-vscode-configuration-service-override-CUpVvDQd.js";import{J as nt,K as st,G as at}from"./monaco-vscode-configuration-service-override-CUpVvDQd.js";import{M as Ie,a as Be}from"./editor-DzBfATXm.js";import"./monaco-vscode-editor-api-CKn10-dZ.js";import"./files.contribution._fileEditorFactory-CgbrRMSP.js";import"./workbenchThemeService.service-DfpJQoWP.js";import"./monaco-vscode-extension-api-Bjm93krH.js";function Ve(t,r,d){const P=document.createElement(r==="status"?"footer":"div");return P.classList.add("part","monaco-workbench-part",...d),P.id=t,P.setAttribute("role",r),r==="status"&&P.setAttribute("aria-live","off"),P}function Oe(t){const r=t.getContainer()?.parentNode;r!=null&&t.layout(Math.max(t.minimumWidth,Math.min(t.maximumWidth,r.offsetWidth)),Math.max(t.minimumHeight,Math.min(t.maximumHeight,r.offsetHeight)),r.offsetTop,r.offsetLeft)}function xe(t,r){t.oncontextmenu=()=>!1;function d(){Oe(r)}r.onDidVisibilityChange(P=>{P&&d()}),d()}function Le(t){return t.isConnected?t.checkVisibility!=null?t.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}):t.offsetHeight>0&&t.offsetWidth>0:!1}function I(){const t=Z.get(D).mainPart.getContainer();return t!=null&&Le(t)}let L=class extends Be{constructor(r){super(r.createInstance(ye),!1,r),this.restoreGroup=(...d)=>this.delegate.restoreGroup(...d)}getId(){return"standalone"}updateStyles(){}registerPart(r){return this.delegate.registerPart(r)}bind(r,d){return this.delegate.bind(r,d)}get activePart(){return this.delegate.activePart}};L=z([ee(0,te)],L);let N=t=>t;Te(async t=>{const r=t.get(Ae),d=t.get(we),P=t.get(ie),y=t.get(oe),R=t.get(D),H=t.get(U),S=t.get(re),Y=t.get(Ce),A=t.get(ne),k=t.get(se),_=t.get(ae),F=t.get(le),$=t.get(be),c=t.get(de);function X(){const e=A.options?.defaultLayout;if((e?.editors!=null&&e.editors.length>0||e?.layout?.editors!=null)&&((e.force??!1)||y.isNew(T.WORKSPACE)))return{layout:e.layout?.editors,filesToOpenOrCreate:e.editors?.map(i=>({viewColumn:i.viewColumn,fileUri:ue.revive(i.uri),openOnlyIfExists:i.openOnlyIfExists,options:i.options}))};const{filesToOpenOrCreate:l,filesToDiff:o,filesToMerge:a}=A;if(l!=null||o!=null||a!=null)return{filesToOpenOrCreate:l,filesToDiff:o,filesToMerge:a}}function q(e,l){const o=e.options?.defaultLayout;if(o==null||!(o.force??!1)&&!l.isNew(T.WORKSPACE))return;const{views:a}=o;if(a!=null&&a.length>0)return a.map(i=>i.id)}function J(e,l){return fe(e.getWorkspace())?!1:!!(_.getValue("window.restoreWindows")==="preserve")||l===void 0}async function j(e,l){if(l!=null){const o=K(await x(l.filesToMerge,e,S));if(o.length===4&&E(o[0])&&E(o[1])&&E(o[2])&&E(o[3]))return[{editor:{input1:{resource:o[0].resource},input2:{resource:o[1].resource},base:{resource:o[2].resource},result:{resource:o[3].resource},options:{pinned:!0}}}];const a=K(await x(l.filesToDiff,e,S));if(a.length===2)return[{editor:{original:{resource:a[0].resource},modified:{resource:a[1].resource},options:{pinned:!0}}}];const i=[],f=await x(l.filesToOpenOrCreate,e,S);for(let s=0;s<f.length;s++){const w=f[s];w!=null&&i.push({editor:w,viewColumn:l.filesToOpenOrCreate?.[s].viewColumn})}return i}else if(k.getWorkbenchState()===ce.EMPTY&&_.getValue("workbench.startupEditor")==="newUntitledFile")return R.mainPart.hasRestorableState?[]:await $.hasBackups()?[]:[{editor:{resource:void 0}}];return[]}const h=X();h!=null&&S.info("Initial editor state",h);let n={layout:{editors:h?.layout},editor:{restoreEditors:J(k,h),editorsToOpen:j(F,h)},views:{defaults:q(A,y),containerToRestore:{}}};function m(e){return d.getDefaultViewContainer(e)??d.getViewContainersByLocation(e)[0]}function Q(){if(c.isVisible(g.SIDEBAR_PART)){let e;!A.isBuilt||P.startupKind===pe.ReloadedWindow||ge?e=y.get(Re.activeViewletSettingsKey,T.WORKSPACE,m(u.Sidebar)?.id):e=m(u.Sidebar)?.id,n.views.containerToRestore.sideBar=e}if(c.isVisible(g.PANEL_PART)){const e=y.get(Se.activePanelSettingsKey,T.WORKSPACE,m(u.Panel)?.id);n.views.containerToRestore.panel=e}if(c.isVisible(g.AUXILIARYBAR_PART)){const e=y.get(he.activeViewSettingsKey,T.WORKSPACE,m(u.AuxiliaryBar)?.id);n.views.containerToRestore.auxiliaryBar=e}}Q(),n=N(n),n.views.containerToRestore.sideBar==null&&c.setPartHidden(!0,g.SIDEBAR_PART),n.views.containerToRestore.panel==null&&c.setPartHidden(!0,g.PANEL_PART),n.views.containerToRestore.auxiliaryBar==null&&c.setPartHidden(!0,g.AUXILIARYBAR_PART);const B=document.createElement("div");B.style.display="none",document.body.append(B);for(const{id:e,role:l,classes:o,options:a,getPosition:i,onDidChangePosition:f}of[{id:g.TITLEBAR_PART,role:"none",classes:["titlebar"]},{id:g.BANNER_PART,role:"banner",classes:["banner"]},{id:g.ACTIVITYBAR_PART,role:"none",classes:["activitybar"],getPosition:()=>c.getSideBarPosition(),onDidChangePosition:c.onDidChangeSideBarPosition},{id:g.SIDEBAR_PART,role:"none",classes:["sidebar"],getPosition:()=>c.getSideBarPosition(),onDidChangePosition:c.onDidChangeSideBarPosition},{id:g.EDITOR_PART,role:"main",classes:["editor"],options:{restorePreviousState:n.editor.restoreEditors}},{id:g.PANEL_PART,role:"none",classes:["panel","basepanel"],getPosition:()=>c.getPanelPosition(),onDidChangePosition:c.onDidChangePanelPosition},{id:g.AUXILIARYBAR_PART,role:"none",classes:["auxiliarybar","basepanel"],getPosition:()=>c.getSideBarPosition()===V.LEFT?V.RIGHT:V.LEFT,onDidChangePosition:c.onDidChangeSideBarPosition},{id:g.STATUSBAR_PART,role:"status",classes:["statusbar"]}]){const s=c.getPart(e);if(s!=null){const w=Ve(e,l,o);if(s.create(w,a),xe(w,s),s.layout(9999,9999,0,0),B.append(w),i!=null){let b=i();s.element.classList.add(O(b)),f?.(()=>{s.element.classList.remove(O(b)),b=i(),s.element.classList.add(O(b))})}}}const v=[],W=[];v.push((async()=>{p("code/willRestoreEditors"),await R.mainPart.whenReady,p("code/restoreEditors/editorGroupsReady"),n.layout?.editors!=null&&R.applyLayout(n.layout.editors);const e=await n.editor.editorsToOpen;p("code/restoreEditors/editorsToOpenResolved");let l;if(e.length>0){const o=R.getGroups(Ee.GRID_APPEARANCE),a=new Map;for(const i of e){const f=o[(i.viewColumn??1)-1];let s=a.get(f.id);s==null&&(s=new Set,a.set(f.id,s)),s.add(i.editor)}l=Promise.all(Array.from(a).map(async([i,f])=>{try{await H.openEditors(Array.from(f),i,{validateTrust:!0})}catch(s){S.error(s)}}))}W.push(Promise.all([l?.finally(()=>p("code/restoreEditors/editorsOpened")),R.mainPart.whenRestored.finally(()=>p("code/restoreEditors/editorGroupsRestored"))]).finally(()=>{p("code/didRestoreEditors")}))})());const C=(async()=>{if(n.views.defaults!=null&&n.views.defaults.length>0){p("code/willOpenDefaultViews");const e=[],l=i=>{const f=d.getViewLocationById(i.id);if(f!==null){const s=d.getViewContainerByViewId(i.id);if(s!=null){i.order>=(e[f]?.order??0)&&(e[f]={id:s.id,order:i.order});const w=d.getViewContainerModel(s);return w.setCollapsed(i.id,!1),w.setVisible(i.id,!0),!0}}return!1},o=[...n.views.defaults].reverse().map((i,f)=>({id:i,order:f}));let a=o.length;for(;a>0;)a--,l(o[a])&&o.splice(a,1);if(o.length>0){await Y.whenInstalledExtensionsRegistered();let i=o.length;for(;i>0;)i--,l(o[i])&&o.splice(i,1)}e[u.Sidebar]!=null&&(n.views.containerToRestore.sideBar=e[u.Sidebar].id),e[u.Panel]!=null&&(n.views.containerToRestore.panel=e[u.Panel].id),e[u.AuxiliaryBar]!=null&&(n.views.containerToRestore.auxiliaryBar=e[u.AuxiliaryBar].id),p("code/didOpenDefaultViews")}})();v.push(C),v.push((async()=>{if(await C,n.views.containerToRestore.sideBar==null)return;p("code/willRestoreViewlet"),await r.openPaneComposite(n.views.containerToRestore.sideBar,u.Sidebar)==null&&await r.openPaneComposite(m(u.Sidebar)?.id,u.Sidebar),p("code/didRestoreViewlet")})()),v.push((async()=>{if(await C,n.views.containerToRestore.panel==null)return;p("code/willRestorePanel"),await r.openPaneComposite(n.views.containerToRestore.panel,u.Panel)==null&&await r.openPaneComposite(m(u.Panel)?.id,u.Panel),p("code/didRestorePanel")})()),v.push((async()=>{if(await C,n.views.containerToRestore.auxiliaryBar==null)return;p("code/willRestoreAuxiliaryBar"),await r.openPaneComposite(n.views.containerToRestore.auxiliaryBar,u.AuxiliaryBar)==null&&await r.openPaneComposite(m(u.AuxiliaryBar)?.id,u.AuxiliaryBar),p("code/didRestoreAuxiliaryBar")})()),await M.settled(v),await M.settled(W)});function Ye(t,r,d){return d!=null&&(N=typeof d=="boolean"?P=>({...P,editor:{...P.editor,restoreEditors:d}}):d),{...ve(r),...Pe({isKeybindingConfigurationVisible:I,shouldUseGlobalPicker:I}),...me({shouldUseGlobalKeybindings:I}),[D.toString()]:new G(L,[],!1),[U.toString()]:new G(Ie,[t,I],!1)}}export{je as AbstractResourceEditorInput,Qe as AbstractTextResourceEditorInput,ot as ActivityService,Ze as ActivitybarPart,ze as ConfirmResult,Xe as DomScrollableElement,nt as EditorInput,st as EditorInputCapabilities,at as GroupOrientation,Se as PanelPart,g as Parts,V as Position,et as RegisteredEditorPriority,Re as SidebarPart,qe as SplitView,u as ViewContainerLocation,tt as ViewPaneContainer,Ye as default,I as isEditorPartVisible,xe as renderPart};

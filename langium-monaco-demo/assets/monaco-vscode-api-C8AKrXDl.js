import{A as hr,k$ as Xx,V as Re,S as ae,l0 as nq,fD as Ii,g as O,_ as f,jK as Mt,ed as Dn,l1 as wie,l2 as sd,fh as Ja,W as It,aa as cr,U as R,l3 as Kfe,dY as ns,d1 as Ni,is as Sie,bs as wn,kW as cw,l4 as Nn,fa as u7,l5 as Es,T as oa,l6 as Cie,l as h,c as Z,R as Ge,a5 as M,l7 as mF,o as p,q as Xe,h as U,E as D,l8 as jfe,l9 as Yfe,an as ph,iN as H,k0 as ts,gO as be,jv as Je,la as et,lb as g7,lc as Sr,ld as kT,le as Eie,lf as LM,lg as RD,lh as vr,li as Qfe,hW as mE,gH as ao,lj as p7,hV as TT,lk as bk,ll as sq,lm as f7,ln as ey,lo as xie,lp as Xfe,hT as Iie,lq as yk,lr as $,ls as G,lt as Zfe,lu as ec,aK as cc,t as Ee,lv as Ke,w as Vt,bX as Die,lw as vF,lx as Jfe,ly as eme,D as F,cz as mc,lz as Zx,dg as he,e1 as pt,lA as X1,lB as Cb,ac as or,lC as tme,ct as Np,aP as Pe,d7 as tt,$ as ne,cZ as Cr,lD as ime,bB as mn,a0 as Tt,bC as Qt,p as me,aO as ye,cX as _l,I as J,a6 as ma,ae as Op,db as I,iE as Ae,bx as j,cJ as x,lE as Cm,bc as de,h6 as ft,lF as nme,j as Dt,fr as ji,aU as oq,lG as ch,lH as Au,kT as vc,ip as li,iQ as sme,iI as Go,iT as rq,jD as zn,hS as Ne,s as ai,bO as Bm,C as ri,B as dn,jC as kn,dq as P,cV as _e,fE as rf,lI as AT,cB as fn,ak as kie,lJ as MM,lK as NM,jJ as Ce,kS as St,dV as Tie,aV as $i,bE as Ot,e2 as qe,bp as At,b2 as Tr,fj as rs,lL as zu,fS as Be,lM as Vm,fx as Eh,hJ as Yt,ey as L,ja as H_,jb as wt,jc as Vd,lN as ome,lO as m7,lP as OM,hw as Di,er as Rt,es as vt,h9 as Y,eP as co,lQ as ee,ii as Er,id as Kt,ik as Te,ie as xa,iv as dw,lR as Yi,lS as Ho,lT as Hs,bW as FM,hD as rme,lU as RT,bl as aq,bU as Mn,H as qt,fp as S,bo as $s,aF as vE,aJ as Qe,k as je,bu as mt,lV as ame,eT as dc,dn as yi,hg as Ve,bb as di,lW as lw,lX as cq,lY as Aie,lZ as Rie,m as hs,l_ as cme,l$ as _E,m0 as _F,m1 as bs,m2 as PT,m3 as ty,b0 as WM,m4 as bE,m5 as el,m6 as dq,jE as En,fy as Le,jI as lt,fl as W,fo as E,fn as V,ci as dme,m7 as Si,m8 as af,m9 as Pie,ma as Lie,aZ as kt,mb as ta,mc as lq,md as Mie,me as Ku,ck as re,cl as pe,kw as hi,fw as No,fm as Ue,f4 as Jx,mf as Ar,mg as hq,jY as ge,da as N,mh as Rr,js as ju,bn as xh,mi as lme,d8 as K,ca as Ru,io as mi,mj as Nie,iq as va,it as is,b as Me,eN as Ms,mk as LT,ml as Hm,mm as Oie,kU as xn,dr as Ki,mn as Mh,mo as uq,eA as BM,jy as es,mp as hme,hr as zf,mq as v7,mr as ume,ms as gme,mt as pme,mu as fme,mv as mme,mw as vme,mx as cf,bY as df,my as VM,e0 as Yu,eS as gt,mz as AS,mA as Dv,mB as _me,eu as bt,mC as gq,d9 as X,cn as Po,dy as Lo,mD as bF,aW as ba,mE as bme,mF as yme,mG as wme,cy as wi,mH as Sme,mI as HM,mJ as Cme,aR as Eb,mK as Eme,mL as eI,br as Zi,ba as Ds,bq as mg,bj as _c,c6 as Fn,bA as wd,mM as xme,bV as po,ea as Ime,mN as UM,mO as Fie,a4 as Nh,mP as Dme,mQ as kme,bi as Ns,b9 as vg,bF as kv,bD as js,dQ as Tme,mR as pq,mS as Wie,mT as Bie,mU as fq,mV as $M,mW as Vie,mX as Ame,mY as mq,mZ as Rme,m_ as Pme,cu as Ya,m$ as Lme,aS as xt,n0 as Mme,bI as Fp,di as tI,iC as GM,hc as oi,be as Ia,n1 as Xs,n2 as cn,f1 as bi,n3 as Hie,n4 as MT,h_ as On,n5 as Nme,n6 as Uie,n7 as yE,n8 as wu,hq as ad,n9 as NT,na as Ome,nb as Fme,nc as Et,nd as De,ee as Xc,ne as PD,nf as _7,ng as Wme,nh as yF,ni as _a,nj as OT,nk as dh,gx as cs,hm as LD,bg as qo,jF as v_,dv as FT,gh as ya,nl as Bo,gD as hw,G as pn,nm as xb,nn as Wp,no as $ie,y as _p,np as wF,nq as Gie,nr as Bme,O as qM,bH as Um,ns as Vme,nt as Hme,Z as ur,bJ as iy,c$ as ko,cT as Zc,kV as Ume,nu as wE,dU as wk,af as $me,a as Gt,nv as SF,nw as Gme,nx as qme,ny as zme,nz as $m,Y as zo,ej as ny,nA as qie,bh as gs,a8 as Ib,nB as CF,ef as st,h2 as Ht,ff as WT,nC as zie,nD as cd,nE as Kme,nF as EF,h$ as aC,i4 as fe,nG as ja,a3 as qs,nH as Sk,nI as Kie,nJ as Bp,nK as jme,nL as Ck,cI as _r,nM as Fl,nN as jie,nO as Yme,nP as Ek,nQ as Yie,nR as fh,bt as ho,nS as Qme,nT as Xme,nU as Zme,nV as Qie,dz as Tv,bN as $t,e4 as b7,cr as zM,nW as Jme,cN as xF,cO as eve,e8 as cC,dP as SE,nX as uw,dm as y7,nY as tve,nZ as du,bL as Qu,n_ as IF,n$ as lf,o0 as ive,o1 as nve,iz as tc,o2 as sve,o3 as ove,o4 as BT,o5 as Xie,o6 as sl,a9 as w7,F as dC,o7 as mS,o8 as Qa,o9 as rve,oa as ave,ob as lC,oc as xk,od as cve,oe as vq,of as dve,bm as Zie,cA as hf,og as Pn,oh as nu,as as Kf,z as $n,d3 as Gm,dp as lve,oi as hve,oj as uve,L as Sn,ok as gve,cQ as Db,ol as hC,om as pve,on as fve,a$ as mve,oo as vve,op as _ve,oq as _q,b8 as Xo,or as bve,os as yve,ot as Fo,ou as wve,ov as VT,ow as Sve,ox as gw,oy as Jie,oz as ic,hu as ei,a1 as Zo,oA as ene,oB as HT,c2 as ra,oC as tne,oD as ine,oE as DF,k1 as Xu,oF as KM,fv as bq,iW as Is,d6 as zt,bk as bl,oG as uC,oH as dt,j0 as rn,he as ki,im as tn,oI as qm,oJ as yq,oK as Cve,iw as zm,iB as Da,oL as zc,jd as Av,oM as Eve,oN as S7,fT as Zu,oO as nne,oP as U_,oQ as xve,oR as $a,oS as Ive,oT as yr,r as fi,oU as CE,oV as Ps,hy as ul,j1 as Oh,cw as Dve,jn as kF,oW as kve,oX as Tve,oY as Rv,gX as iI,eO as sne,oZ as Ik,o_ as C7,o$ as uf,fR as ln,gA as Ave,p0 as UT,fZ as TF,p1 as Rve,jG as ue,jL as we,p2 as Pve,p3 as one,p4 as Li,p5 as rne,p6 as Lve,p7 as gf,M as wq,ep as to,fk as Ih,p8 as Mve,bG as E7,P as $T,ds as at,p9 as Nve,pa as ane,pb as Sq,pc as Ove,pd as RS,pe as Fve,pf as Wve,hn as Bve,eW as Vve,pg as GT,ph as Hve,pi as Kn,iL as nI,pj as Cq,pk as Hi,pl as qT,pm as Uve,pn as cne,po as $ve,pp as dne,pq as lne,pr as Gve,ps as AF,i7 as Eq,pt as hne,f0 as sy,fq as Kc,hp as x7,pu as om,pv as Dk,n as jM,pw as une,jk as _g,ih as Km,il as Dh,px as YM,ij as gC,fG as zs,cE as gne,X as Bt,f3 as qve,ir as kh,fL as EE,py as zve,co as Vp,N as QM,pz as Kve,pA as jve,pB as Yve,pC as Qve,pD as Xve,pE as Zve,pF as Jve,aQ as mh,hQ as xE,fU as Pv,pG as e_e,pH as RF,pI as pne,jw as fne,f5 as Ju,pJ as Z1,pK as t_e,pL as i_e,b$ as jc,pM as zT,c0 as Hc,d as Ci,em as mne,pN as Yc,eM as us,pO as sI,pP as ze,pQ as lc,pR as xq,pS as n_e,v as s_e,pT as o_e,b3 as vne,bz as Iq,jp as _ne,h8 as r_e,K as KT,pU as a_e,J as vh,pV as J1,pW as Dq,pX as c_e,pY as I7,pZ as pw,eH as kq,p_ as d_e,p$ as l_e,q0 as bne,q1 as IE,kZ as h_e,q2 as yne,q3 as D7,aB as u_e,q4 as DE,q5 as jT,q6 as g_e,q7 as p_e,q8 as f_e,q9 as Tq,qa as k7,aD as m_e,qb as v_e,u as __e,qc as fw,qd as b_e,qe as Aq,qf as Rq,qg as wne,qh as y_e,de as Pq,cb as eg,ha as Kd,cj as Em,qi as w_e,hR as Hp,fH as Wo,fO as Th,fP as Vo,eG as XM,qj as ZM,qk as S_e,dC as tg,ql as YT,qm as Sne,qn as JM,qo as Lq,hP as pf,qp as C_e,qq as oy,qr as E_e,qs as Cne,qt as Ene,qu as Mq,qv as QT,hF as dd,qw as x_e,qx as XT,jo as Lv,iM as ig,qy as Nq,qz as rm,qA as I_e,qB as eN,qC as D_e,cs as xne,qD as k_e,qE as Ine,eR as tN,qF as T_e,qG as T7,qH as A_e,qI as Dne,qJ as kne,qK as PF,dT as ng,qL as R_e,qM as Tne,qN as Ane,qO as kb,qP as hp,qQ as P_e,qR as Rne,qS as L_e,et as kE,qT as LF,eK as M_e,qU as N_e,qV as O_e,qW as Pne,qX as MF,aG as A7,qY as Lne,qZ as NF,q_ as R7,q$ as $_,r0 as jr,r1 as am,r2 as OF,r3 as F_e,r4 as Mv,r5 as e0,r6 as W_e,r7 as B_e,r8 as iN,hb as Oq,r9 as Mne,ra as V_e,ig as H_e,rb as U_e,rc as MD,rd as $_e,re as G_e,rf as ND,rg as cm,rh as q_e,ri as z_e,rj as K_e,rk as j_e,rl as Y_e,rm as Q_e,rn as X_e,ro as Z_e,rp as J_e,rq as ebe,rr as tbe,rs as ibe,rt as nbe,ru as Nne,rv as P7,rw as sbe,fC as FF,rx as obe,ry as rbe,i8 as One,rz as Fne,ia as ys,rA as abe,rB as oI,rC as L7,ez as rI,rD as Wne,rE as Fq,rF as cbe,rG as M7,rH as dbe,aX as lbe,rI as hbe,ap as ga,rJ as ube,gV as gbe,ic as Fi,rK as t0,i2 as Jl,rL as pbe,rM as Bne,rN as WF,rO as fbe,iD as nc,rP as aI,rQ as nN,rR as Vne,i5 as jd,f_ as Hne,rS as TE,i6 as mbe,iY as vbe,rT as i0,iA as _be,rU as bbe,rV as Wq,rW as ybe,rX as Bq,rY as wbe,rZ as Sbe,jt as ZT,iZ as Une,gP as Cbe,r_ as N7,r$ as Ebe,s0 as BF,s1 as pC,am as xbe,x as Ibe,aj as Dbe,s2 as Vq,s3 as kbe,s4 as VF,s5 as Tbe,a_ as Abe,s6 as kk,s7 as Rbe,s8 as Pbe,e6 as Lbe,s9 as O7,sa as F7,sb as ld,sc as Mbe,sd as $ne,se as Gne,sf as qne,sg as zne,sh as Nbe,si as W7,sj as ol,sk as B7,sl as Obe,sm as Jc,iG as cI,sn as n0,so as Fbe,jB as Wbe,sp as Kne,bf as PS,sq as Bbe,hl as Vbe,sr as Hbe,jm as hc,ss as Cs,hf as ry,st as Ube,su as $be,iF as Tk,sv as Gbe,sw as qbe,jz as zbe,sx as wa,sy as jm,sz as jne,sA as Kbe,sB as jbe,sC as G_,fF as Hq,sD as Ybe,sE as Qbe,sF as Xbe,sG as Zbe,sH as vS,sI as _S,sJ as V7,sK as Jbe,sL as eye,hz as tye,sM as iye,i0 as Yne,sN as Qne,sO as H7,i1 as U7,eX as HF,f2 as nye,sP as sye,k3 as oye,kx as rye,fi as mw,eZ as Xne,eV as aye,eU as Zne,eC as cye,ex as Jne,fQ as ese,iH as dye,j8 as dm,j5 as q_,sQ as OD,sR as Uq,sS as lye,sT as hye,ix as uye,sU as $7,hx as gye,sV as pye,jq as ay,sW as fye,sX as mye,sY as vye,sZ as _ye,s_ as tse,s$ as G7,hd as fC,t0 as bye,t1 as sN,t2 as yye,t3 as UF,t4 as q7,t5 as z7,t6 as wye,jl as $F,t7 as Sye,t8 as K7,hG as Cye,fY as Eye,t9 as xye,ta as Iye,tb as JT,dA as sc,dB as oc,tc as Dye,td as kye,te as sr,tf as Tye,tg as Aye,th as Rye,ti as Pye,tj as Lye,tk as Mye,f as Nye,jA as ise,tl as dI,bd as Oye,aw as FD,aA as Fye,i as Wye,ax as Bye,tm as WD,tn as Vye,to as Hye,tp as Uye,tq as $ye,tr as Gye,ts as _n,tt as nse,tu as sse,eY as Tb,cG as Nv,tv as qye,tw as ose,tx as rse,ty as GF,tz as zye,tA as Kye,tB as ase,gM as Ym,tC as j7,tD as jye,tE as Yye,tF as Qye,tG as Xye,tH as cse,tI as dse,tJ as Zye,tK as Y7,tL as lse,tM as Jye,eE as hse,tN as ewe,tO as twe,tP as iwe,tQ as use,tR as gse,tS as pse,tT as nwe,tU as lI,tV as swe,tW as $q,tX as owe,tY as rwe,tZ as awe,eq as cwe,t_ as Q7,f7 as dwe,ei as fse,t$ as lwe,f8 as hwe,u0 as Gq,u1 as mse,u2 as oN,u3 as uwe,u4 as eA,u5 as bp,u6 as gwe,u7 as qF,u8 as pwe,gN as X7,u9 as vse,fd as Z7,ua as s0,ub as _se,uc as sg,ud as lm,ue as bse,uf as J7,c9 as rN,fg as Ov,ug as fwe,uh as mwe,ui as tA,uj as qq,uk as Qg,ul as yse,um as wse,un as vwe,uo as _we,up as bwe,uq as e6,ur as t6,us as ywe,ut as aN,uu as wwe,uv as Swe,uw as Cwe,ux as Ewe,uy as i6,uz as xwe,uA as Iwe,uB as Dwe,uC as kwe,uD as Twe,uE as zF,uF as Awe,uG as Rwe,uH as Pwe,uI as Qm,uJ as Lwe,uK as Mwe,k_ as Nwe,uL as Sse,ec as Owe,uM as Fwe,cH as Wwe,uN as Bwe,iu as Vwe,uO as Qr,uP as n6,uQ as s6,uR as o6,uS as jf,uT as o0,bZ as Cse,uU as Hwe,uV as Uwe,uW as $we,uX as mC,uY as Gwe,cf as qwe,uZ as zwe,cc as Kwe,c5 as Ab,u_ as jwe,c1 as Ywe,u$ as Og,v0 as Qwe,fK as Xwe,cm as Zwe,v1 as Jwe,v2 as eSe,v3 as tSe,v4 as iSe,v5 as nSe,v6 as sSe,v7 as oSe,v8 as rSe,cp as aSe,v9 as cSe,ev as r6,c4 as dSe,va as lSe,vb as hSe,vc as r0,vd as uSe,e9 as gSe,ve as pSe,vf as a6,vg as fSe,vh as mSe,vi as vSe}from"./monaco-vscode-base-service-override-DWrDktfJ.js";import{I as Sd,C as hI,o as xs,E as Xm,a as ds,D as Ese,S as cy,L as _Se,b as bSe,c as ySe,d as wSe,e as xse,f as AE,g as SSe,h as cN,W as zq,P as Ise,i as Ls,A as Up,j as dN,k as og,M as z_,H as Ak,l as CSe,m as Dse,w as Rk,n as ESe,p as xSe,V as ISe,R as DSe,T as kSe,q as kse,r as TSe,s as RE,t as dy,u as Tse,v as Ase,x as Rb,y as Su,z as ASe,B as RSe,F as PSe,G as LSe,J as Kq,K as MSe,N as NSe,O as OSe,Q as lN,U as hN,X as uN,Y as Pk,Z as FSe,_ as c6,$ as Lk,a0 as KF,a1 as WSe,a2 as d6,a3 as gN,a4 as Pu,a5 as jF,a6 as BSe,a7 as l6,a8 as Rse,a9 as VSe,aa as HSe,ab as a0,ac as uI,ad as USe,ae as $Se,af as h6,ag as Pse,ah as PE,ai as GSe,aj as qSe,ak as BD,al as zSe,am as KSe,an as jSe,ao as ly,ap as vC,aq as Lse,ar as Mse,as as jq,at as VD,au as c0,av as YSe,aw as QSe,ax as Nse,ay as XSe,az as Ose,aA as Fse,aB as Wse,aC as An,aD as gI,aE as ZSe,aF as pN,aG as JSe,aH as eCe,aI as Bse}from"./monaco-vscode-editor-api-Cjp3CvRF.js";import{I as hn,a as Yq,b as Vse,i as Ao,c as $p,d as iA,g as vw,C as Oi,M as Ei,e as aa,f as Ie,h as Wn,j as Hse,k as Fh,l as Fv,m as Wv,N as tCe,n as Use,o as uc,p as Qq,q as Xq,r as $se,s as Wh,t as Gse,u as qse,v as iCe,w as _,G as rc,x as nCe,S as ui,D as od,y as fN,E as _w,z as sCe,A as zse,B as nA,F as oCe,H as rCe,J as gl,K as Ze,V as Nt,L as eh,W as LE,P as aCe,Q as bc,T as Io,U as si,X as Zq,Y as sA,Z as Gp,_ as mN,R as pi,$ as YF,a0 as Pb,a1 as Kse,a2 as Ai,a3 as Ko,a4 as xi,a5 as Ut,a6 as K_,a7 as d0,a8 as LS,a9 as _C,aa as bC,ab as cCe,ac as Zm,ad as dCe,ae as u6,af as j_,ag as Yd,ah as bS,ai as Bv,aj as lCe,ak as Jq,al as hCe,am as jse,an as Vv,ao as QF,ap as Lb,aq as Yse,ar as g6,as as XF,at as Xa,au as Xt,av as ez,aw as vN,ax as tz,ay as uCe,az as oA,aA as rA,aB as yC,aC as Cu,aD as gCe,aE as hd,aF as Lu,aG as bw,aH as pI,aI as _N,aJ as Qse,aK as pCe,aL as Mk,aM as fCe,aN as mCe,aO as Xse,aP as aA,aQ as Gn,aR as yw,aS as yl,aT as wl,aU as bN,aV as cA,aW as yN,aX as MS,aY as Zse,aZ as xm,a_ as yp,a$ as vi,b0 as ot,b1 as fI,b2 as Sl,b3 as ME,b4 as vCe,b5 as ct,b6 as wC,b7 as Jse,b8 as eoe,b9 as toe,ba as ioe,bb as iz,bc as nz,bd as _Ce,be as bCe,bf as noe,bg as soe,bh as ooe,bi as yCe,bj as roe,bk as wCe,bl as aoe,bm as NE,bn as SCe,bo as Aa,bp as uo,bq as mI,br as sz,bs as oz,bt as Cd,bu as Bh,bv as vI,bw as coe,bx as rz,by as doe,bz as loe,bA as Jm,bB as CCe,bC as _I,bD as wN,bE as hoe,bF as uoe,bG as ECe,bH as xCe,bI as ICe,bJ as DCe,bK as kCe,bL as TCe,bM as ACe,bN as pl,O as bI,bO as goe,bP as RCe,bQ as PCe,bR as p6,bS as f6,bT as rl,bU as lo,bV as LCe,bW as m6,bX as MCe,bY as jo,bZ as SN,b_ as lh,b$ as NCe,c0 as up,c1 as Y_,c2 as ev,c3 as dA,c4 as poe,c5 as OCe,c6 as ud,c7 as hy,c8 as Nk,c9 as ZF,ca as FCe,cb as HD,cc as l0,cd as WCe,ce as BCe,cf as VCe,cg as HCe,ch as UCe}from"./monaco-vscode-configuration-service-override-COq0Cpay.js";var uy;(function(s){s[s.WebSocket=0]="WebSocket",s[s.Managed=1]="Managed"})(uy||(uy={}));class $Ce{constructor(e){this.id=e,this.type=uy.Managed}toString(){return`Managed(${this.id})`}}class GCe{constructor(e,t){this.host=e,this.port=t,this.type=uy.WebSocket}toString(){return`WebSocket(${this.host}:${this.port})`}}var gr;(function(s){s.Unknown="Unknown",s.NotAvailable="NotAvailable",s.TemporarilyNotAvailable="TemporarilyNotAvailable",s.NoResolverFound="NoResolverFound",s.InvalidAuthority="InvalidAuthority"})(gr||(gr={}));let wp=class Ff extends hr{static isNotAvailable(e){return e instanceof Ff&&e._code===gr.NotAvailable}static isTemporarilyNotAvailable(e){return e instanceof Ff&&e._code===gr.TemporarilyNotAvailable}static isNoResolverFound(e){return e instanceof Ff&&e._code===gr.NoResolverFound}static isInvalidAuthority(e){return e instanceof Ff&&e._code===gr.InvalidAuthority}static isHandled(e){return e instanceof Ff&&e.isHandled}constructor(e,t=gr.Unknown,i){super(e),this._message=e,this._code=t,this._detail=i,this.isHandled=t===gr.NotAvailable&&i===!0,Object.setPrototypeOf(this,Ff.prototype)}};function foe(s){const e=s.indexOf("+");return e===-1?s:s.substring(0,e)}const JF=["W","X","Y","Z","a","b","c","d","e","f"],qCe=new RegExp(`^[${JF.join("")}]+`),moe=7;function voe(s){if(s.scheme!==ae.vscodeNotebookCell)return;const e=s.fragment.indexOf("s");if(e<0)return;const t=parseInt(s.fragment.substring(0,e).replace(qCe,""),moe),i=nq(s.fragment.substring(e+1)).toString();if(!isNaN(t))return{handle:t,notebook:s.with({scheme:i,fragment:null})}}function zCe(s,e){const t=e.toString(moe),n=`${t.length<JF.length?JF[t.length-1]:"z"}${t}s${Xx(Re.fromString(s.scheme),!0,!0)}`;return s.with({scheme:ae.vscodeNotebookCell,fragment:n})}function KCe(s){if(s.scheme!==ae.vscodeNotebookMetadata)return;const e=nq(s.fragment).toString();return s.with({scheme:e,fragment:null})}function jCe(s){const e=`${Xx(Re.fromString(s.scheme),!0,!0)}`;return s.with({scheme:ae.vscodeNotebookMetadata,fragment:e})}function _oe(s){if(s.scheme!==ae.vscodeNotebookCellOutput)return;const e=new URLSearchParams(s.query),t=e.get("openIn");if(!t)return;const i=e.get("outputId")??void 0,n=voe(s.with({scheme:ae.vscodeNotebookCell,query:null})),o=e.get("outputIndex")?parseInt(e.get("outputIndex")||"",10):void 0,r=n?n.notebook:s.with({scheme:e.get("notebookScheme")||ae.file,fragment:null,query:null}),a=e.get("cellIndex")?parseInt(e.get("cellIndex")||"",10):void 0;return{notebook:r,openIn:t,outputId:i,outputIndex:o,cellHandle:n?.handle,cellFragment:s.fragment,cellIndex:a}}const boe="workbench.editor.notebook",YCe="workbench.editor.notebookTextDiffEditor",QCe="workbench.editor.interactive",XCe="workbench.editor.repl";var gp;(function(s){s[s.Markup=1]="Markup",s[s.Code=2]="Code"})(gp||(gp={}));Ii.latex,Ii.markdown,Ii.text;Ii.latex,Ii.markdown,Ii.text;var v6;(function(s){s[s.Running=1]="Running",s[s.Idle=2]="Idle"})(v6||(v6={}));var _6;(function(s){s[s.Unconfirmed=1]="Unconfirmed",s[s.Pending=2]="Pending",s[s.Executing=3]="Executing"})(_6||(_6={}));var b6;(function(s){s[s.Unconfirmed=1]="Unconfirmed",s[s.Pending=2]="Pending",s[s.Executing=3]="Executing"})(b6||(b6={}));var y6;(function(s){s[s.WithHardKernelDependency=0]="WithHardKernelDependency",s[s.WithOptionalKernelDependency=1]="WithOptionalKernelDependency",s[s.Pure=2]="Pure",s[s.Never=3]="Never"})(y6||(y6={}));var w6;(function(s){s.Always="always",s.Never="never",s.Optional="optional"})(w6||(w6={}));var Fc;(function(s){s[s.ModelChange=1]="ModelChange",s[s.Move=2]="Move",s[s.ChangeCellLanguage=5]="ChangeCellLanguage",s[s.Initialize=6]="Initialize",s[s.ChangeCellMetadata=7]="ChangeCellMetadata",s[s.Output=8]="Output",s[s.OutputItem=9]="OutputItem",s[s.ChangeCellContent=10]="ChangeCellContent",s[s.ChangeDocumentMetadata=11]="ChangeDocumentMetadata",s[s.ChangeCellInternalMetadata=12]="ChangeCellInternalMetadata",s[s.ChangeCellMime=13]="ChangeCellMime",s[s.Unknown=100]="Unknown"})(Fc||(Fc={}));var eW;(function(s){s[s.Handle=0]="Handle",s[s.Index=1]="Index"})(eW||(eW={}));var al;(function(s){s[s.Replace=1]="Replace",s[s.Output=2]="Output",s[s.Metadata=3]="Metadata",s[s.CellLanguage=4]="CellLanguage",s[s.DocumentMetadata=5]="DocumentMetadata",s[s.Move=6]="Move",s[s.OutputItems=7]="OutputItems",s[s.PartialMetadata=8]="PartialMetadata",s[s.PartialInternalMetadata=9]="PartialInternalMetadata"})(al||(al={}));var S6;(function(s){s.scheme=ae.vscodeNotebookMetadata;function e(i){return jCe(i)}s.generate=e;function t(i){return KCe(i)}s.parse=t})(S6||(S6={}));var fl;(function(s){s.scheme=ae.vscodeNotebookCell;function e(d,l){return zCe(d,l)}s.generate=e;function t(d){return voe(d)}s.parse=t;function i(d,l){return d.with({scheme:ae.vscodeNotebookCellOutput,query:new URLSearchParams({openIn:"editor",outputId:l??"",notebookScheme:d.scheme!==ae.file?d.scheme:""}).toString()})}s.generateCellOutputUriWithId=i;function n(d,l,u){return d.with({scheme:ae.vscodeNotebookCellOutput,fragment:l.fragment,query:new URLSearchParams({openIn:"notebook",outputIndex:String(u)}).toString()})}s.generateCellOutputUriWithIndex=n;function o(d,l,u,g,m){return d.with({scheme:ae.vscodeNotebookCellOutput,query:new URLSearchParams({openIn:"notebookOutputEditor",notebook:d.toString(),cellIndex:String(u),outputId:g,outputIndex:String(m)}).toString()})}s.generateOutputEditorUri=o;function r(d){return _oe(d)}s.parseCellOutputUri=r;function a(d,l,u){return s.generate(d,l).with({scheme:u})}s.generateCellPropertyUri=a;function c(d,l){if(d.scheme===l)return s.parse(d.with({scheme:s.scheme}))}s.parseCellPropertyUri=c})(fl||(fl={}));new O("notebookEditorCursorAtBoundary","none");new O("notebookEditorCursorAtLineBoundary","none");var C6;(function(s){s.default="default",s.option="option"})(C6||(C6={}));var E6;(function(s){s.Cells="cells",s.Text="text",s.None="none"})(E6||(E6={}));const yoe={remoteSaving:"notebook.experimental.remoteSave",InteractiveWindowPromptToSave:"interactiveWindow.promptToSaveOnClose"};var lA;(function(s){s[s.Left=1]="Left",s[s.Right=2]="Right"})(lA||(lA={}));function az(s){return["application/vnd.code.notebook.stdout","application/vnd.code.notebook.stderr"].includes(s)}const ZCe=new TextDecoder;function qKe(s){const e=[];let t=!1;for(const r of s)(e.length===0||t)&&(e.push(r),t=!0);let i=eEe(e);const n=Re.concat(e.map(r=>Re.wrap(r))),o=oEe(n);return i=i||o.byteLength!==n.byteLength,{data:o,didCompression:i}}const Ok="\x1B[A",h0=Ok.split("").map(s=>s.charCodeAt(0)),JCe=10;function eEe(s){let e=!1;return s.forEach((t,i)=>{if(i===0||t.length<Ok.length)return;const n=s[i-1],o=t.subarray(0,Ok.length);if(o[0]===h0[0]&&o[1]===h0[1]&&o[2]===h0[2]){const r=n.lastIndexOf(JCe);if(r===-1)return;e=!0,s[i-1]=n.subarray(0,r),s[i]=t.subarray(Ok.length)}}),e}function tEe(s){let e=s;do s=e,e=s.replace(/[^\n]\x08/gm,"");while(e.length<s.length);return s}function iEe(s){for(s=s.replace(/\r+\n/gm,`
`);s.search(/\r[^$]/g)>-1;){const e=s.match(/^(.*)\r+/m)[1];let t=s.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),s=s.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return s}const nEe=8,sEe=13;function oEe(s){return!s.buffer.includes(nEe)&&!s.buffer.includes(sEe)?s:Re.fromString(iEe(tEe(ZCe.decode(s.buffer))))}var tW,Wf,ou,iW,Bf,Vg,Vf,nW,sW,Fk,NS,oW,Wl,Bl,rW,$r,aW;function nt(s){return Object.assign(s,{apply:function(...t){if(t.length===0)return Reflect.construct(s,[]);{const i=t.length===1?[]:t[1];return Reflect.construct(s,i,t[0].constructor)}},call:function(...t){if(t.length===0)return Reflect.construct(s,[]);{const[i,...n]=t;return Reflect.construct(s,n,i.constructor)}}})}var x6;(function(s){s[s.Top=0]="Top",s[s.Bottom=1]="Bottom"})(x6||(x6={}));var I6;(function(s){s[s.TerminalCommand=0]="TerminalCommand",s[s.Opener=1]="Opener",s[s.Command=3]="Command"})(I6||(I6={}));let cW=tW=class{static from(...e){let t=e;return new tW(function(){if(t){for(const i of t)i&&typeof i.dispose=="function"&&i.dispose();t=void 0}})}#e;constructor(e){this.#e=e}dispose(){typeof this.#e=="function"&&(this.#e(),this.#e=void 0)}};cW=tW=f([nt],cW);let en=Wf=class{static Min(...e){if(e.length===0)throw new TypeError;let t=e[0];for(let i=1;i<e.length;i++){const n=e[i];n.isBefore(t)&&(t=n)}return t}static Max(...e){if(e.length===0)throw new TypeError;let t=e[0];for(let i=1;i<e.length;i++){const n=e[i];n.isAfter(t)&&(t=n)}return t}static isPosition(e){if(!e)return!1;if(e instanceof Wf)return!0;const{line:t,character:i}=e;return typeof t=="number"&&typeof i=="number"}static of(e){if(e instanceof Wf)return e;if(this.isPosition(e))return new Wf(e.line,e.character);throw new Error("Invalid argument, is NOT a position-like object")}get line(){return this._line}get character(){return this._character}constructor(e,t){if(e<0)throw Mt("line must be non-negative");if(t<0)throw Mt("character must be non-negative");this._line=e,this._character=t}isBefore(e){return this._line<e._line?!0:e._line<this._line?!1:this._character<e._character}isBeforeOrEqual(e){return this._line<e._line?!0:e._line<this._line?!1:this._character<=e._character}isAfter(e){return!this.isBeforeOrEqual(e)}isAfterOrEqual(e){return!this.isBefore(e)}isEqual(e){return this._line===e._line&&this._character===e._character}compareTo(e){return this._line<e._line?-1:this._line>e.line?1:this._character<e._character?-1:this._character>e._character?1:0}translate(e,t=0){if(e===null||t===null)throw Mt();let i;return typeof e>"u"?i=0:typeof e=="number"?i=e:(i=typeof e.lineDelta=="number"?e.lineDelta:0,t=typeof e.characterDelta=="number"?e.characterDelta:0),i===0&&t===0?this:new Wf(this.line+i,this.character+t)}with(e,t=this.character){if(e===null||t===null)throw Mt();let i;return typeof e>"u"?i=this.line:typeof e=="number"?i=e:(i=typeof e.line=="number"?e.line:this.line,t=typeof e.character=="number"?e.character:this.character),i===this.line&&t===this.character?this:new Wf(i,t)}toJSON(){return{line:this.line,character:this.character}}[Symbol.for("debug.description")](){return`(${this.line}:${this.character})`}};en=Wf=f([nt],en);let ls=ou=class{static isRange(e){return e instanceof ou?!0:e?en.isPosition(e.start)&&en.isPosition(e.end):!1}static of(e){if(e instanceof ou)return e;if(this.isRange(e))return new ou(e.start,e.end);throw new Error("Invalid argument, is NOT a range-like object")}get start(){return this._start}get end(){return this._end}constructor(e,t,i,n){let o,r;if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"?(o=new en(e,t),r=new en(i,n)):en.isPosition(e)&&en.isPosition(t)&&(o=en.of(e),r=en.of(t)),!o||!r)throw new Error("Invalid arguments");o.isBefore(r)?(this._start=o,this._end=r):(this._start=r,this._end=o)}contains(e){return ou.isRange(e)?this.contains(e.start)&&this.contains(e.end):en.isPosition(e)?!(en.of(e).isBefore(this._start)||this._end.isBefore(e)):!1}isEqual(e){return this._start.isEqual(e._start)&&this._end.isEqual(e._end)}intersection(e){const t=en.Max(e.start,this._start),i=en.Min(e.end,this._end);if(!t.isAfter(i))return new ou(t,i)}union(e){if(this.contains(e))return this;if(e.contains(this))return e;const t=en.Min(e.start,this._start),i=en.Max(e.end,this.end);return new ou(t,i)}get isEmpty(){return this._start.isEqual(this._end)}get isSingleLine(){return this._start.line===this._end.line}with(e,t=this.end){if(e===null||t===null)throw Mt();let i;return e?en.isPosition(e)?i=e:(i=e.start||this.start,t=e.end||this.end):i=this.start,i.isEqual(this._start)&&t.isEqual(this.end)?this:new ou(i,t)}toJSON(){return[this.start,this.end]}[Symbol.for("debug.description")](){return woe(this)}};ls=ou=f([nt],ls);let dW=iW=class extends ls{static isSelection(e){return e instanceof iW?!0:e?ls.isRange(e)&&en.isPosition(e.anchor)&&en.isPosition(e.active)&&typeof e.isReversed=="boolean":!1}get anchor(){return this._anchor}get active(){return this._active}constructor(e,t,i,n){let o,r;if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"?(o=new en(e,t),r=new en(i,n)):en.isPosition(e)&&en.isPosition(t)&&(o=en.of(e),r=en.of(t)),!o||!r)throw new Error("Invalid arguments");super(o,r),this._anchor=o,this._active=r}get isReversed(){return this._anchor===this._end}toJSON(){return{start:this.start,end:this.end,active:this.active,anchor:this.anchor}}[Symbol.for("debug.description")](){return rEe(this)}};dW=iW=f([nt],dW);function woe(s){return s.isEmpty?`[${s.start.line}:${s.start.character})`:`[${s.start.line}:${s.start.character} -> ${s.end.line}:${s.end.character})`}function rEe(s){let e=woe(s);return s.isEmpty||(s.active.isEqual(s.start)?e=`|${e}`:e=`${e}|`),e}const Soe=s=>{if(typeof s!="string"||s.length===0||!/^[0-9A-Za-z_\-]+$/.test(s))throw Mt("connectionToken")};class QKe{static isResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.host=="string"&&typeof e.port=="number"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t,i){if(typeof e!="string"||e.length===0)throw Mt("host");if(typeof t!="number"||t===0||Math.round(t)!==t)throw Mt("port");typeof i<"u"&&Soe(i),this.host=e,this.port=Math.round(t),this.connectionToken=i}}class XKe{static isManagedResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.makeConnection=="function"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t){this.makeConnection=e,this.connectionToken=t,typeof t<"u"&&Soe(t)}}class Wk extends Error{static NotAvailable(e,t){return new Wk(e,gr.NotAvailable,t)}static TemporarilyNotAvailable(e){return new Wk(e,gr.TemporarilyNotAvailable)}constructor(e,t=gr.Unknown,i){super(e),this._message=e,this._code=t,this._detail=i,Object.setPrototypeOf(this,Wk.prototype)}}var Q_;(function(s){s[s.LF=1]="LF",s[s.CRLF=2]="CRLF"})(Q_||(Q_={}));var D6;(function(s){s[s.Replace=1]="Replace",s[s.Append=2]="Append",s[s.Prepend=3]="Prepend"})(D6||(D6={}));let gy=Bf=class{static isTextEdit(e){return e instanceof Bf?!0:e?ls.isRange(e)&&typeof e.newText=="string":!1}static replace(e,t){return new Bf(e,t)}static insert(e,t){return Bf.replace(new ls(e,e),t)}static delete(e){return Bf.replace(e,"")}static setEndOfLine(e){const t=new Bf(new ls(new en(0,0),new en(0,0)),"");return t.newEol=e,t}get range(){return this._range}set range(e){if(e&&!ls.isRange(e))throw Mt("range");this._range=e}get newText(){return this._newText||""}set newText(e){if(e&&typeof e!="string")throw Mt("newText");this._newText=e}get newEol(){return this._newEol}set newEol(e){if(e&&typeof e!="number")throw Mt("newEol");this._newEol=e}constructor(e,t){this._range=e,this._newText=t}toJSON(){return{range:this.range,newText:this.newText,newEol:this._newEol}}};gy=Bf=f([nt],gy);let lW=Vg=class{static isNotebookCellEdit(e){return e instanceof Vg?!0:e?OS.isNotebookRange(e)&&Array.isArray(e.newCells):!1}static replaceCells(e,t){return new Vg(e,t)}static insertCells(e,t){return new Vg(new OS(e,e),t)}static deleteCells(e){return new Vg(e,[])}static updateCellMetadata(e,t){const i=new Vg(new OS(e,e),[]);return i.newCellMetadata=t,i}static updateNotebookMetadata(e){const t=new Vg(new OS(0,0),[]);return t.newNotebookMetadata=e,t}constructor(e,t){this.range=e,this.newCells=t}};lW=Vg=f([nt],lW);class Mb{static isSnippetTextEdit(e){return e instanceof Mb?!0:e?ls.isRange(e.range)&&OE.isSnippetString(e.snippet):!1}static replace(e,t){return new Mb(e,t)}static insert(e,t){return Mb.replace(new ls(e,e),t)}constructor(e,t){this.range=e,this.snippet=t}}var Zn;(function(s){s[s.File=1]="File",s[s.Text=2]="Text",s[s.Cell=3]="Cell",s[s.CellReplace=5]="CellReplace",s[s.Snippet=6]="Snippet"})(Zn||(Zn={}));let hA=class{constructor(){this._edits=[]}_allEntries(){return this._edits}renameFile(e,t,i,n){this._edits.push({_type:Zn.File,from:e,to:t,options:i,metadata:n})}createFile(e,t,i){this._edits.push({_type:Zn.File,from:void 0,to:e,options:t,metadata:i})}deleteFile(e,t,i){this._edits.push({_type:Zn.File,from:e,to:void 0,options:t,metadata:i})}replaceNotebookMetadata(e,t,i){this._edits.push({_type:Zn.Cell,metadata:i,uri:e,edit:{editType:al.DocumentMetadata,metadata:t}})}replaceNotebookCells(e,t,i,n){const o=t.start,r=t.end;(o!==r||i.length>0)&&this._edits.push({_type:Zn.CellReplace,uri:e,index:o,count:r-o,cells:i,metadata:n})}replaceNotebookCellMetadata(e,t,i,n){this._edits.push({_type:Zn.Cell,metadata:n,uri:e,edit:{editType:al.Metadata,index:t,metadata:i}})}replace(e,t,i,n){this._edits.push({_type:Zn.Text,uri:e,edit:new gy(t,i),metadata:n})}insert(e,t,i,n){this.replace(e,new ls(t,t),i,n)}delete(e,t,i){this.replace(e,t,"",i)}has(e){return this._edits.some(t=>t._type===Zn.Text&&t.uri.toString()===e.toString())}set(e,t){if(t)for(const i of t){if(!i)continue;let n,o;Array.isArray(i)?(n=i[0],o=i[1]):n=i,lW.isNotebookCellEdit(n)?n.newCellMetadata?this.replaceNotebookCellMetadata(e,n.range.start,n.newCellMetadata,o):n.newNotebookMetadata?this.replaceNotebookMetadata(e,n.newNotebookMetadata,o):this.replaceNotebookCells(e,n.range,n.newCells,o):Mb.isSnippetTextEdit(n)?this._edits.push({_type:Zn.Snippet,uri:e,range:n.range,edit:n.snippet,metadata:o,keepWhitespace:n.keepWhitespace}):this._edits.push({_type:Zn.Text,uri:e,edit:n,metadata:o})}else{for(let i=0;i<this._edits.length;i++){const n=this._edits[i];switch(n._type){case Zn.Text:case Zn.Snippet:case Zn.Cell:case Zn.CellReplace:n.uri.toString()===e.toString()&&(this._edits[i]=void 0);break}}Sie(this._edits)}}get(e){const t=[];for(const i of this._edits)i._type===Zn.Text&&i.uri.toString()===e.toString()&&t.push(i.edit);return t}entries(){const e=new wn;for(const t of this._edits)if(t._type===Zn.Text){let i=e.get(t.uri);i||(i=[t.uri,[]],e.set(t.uri,i)),i[1].push(t.edit)}return[...e.values()]}get size(){return this.entries().length}toJSON(){return this.entries()}};hA=f([nt],hA);let OE=Vf=class{static isSnippetString(e){return e instanceof Vf?!0:e?typeof e.value=="string":!1}static _escape(e){return e.replace(/\$|}|\\/g,"\\$&")}constructor(e){this._tabstop=1,this.value=e||""}appendText(e){return this.value+=Vf._escape(e),this}appendTabstop(e=this._tabstop++){return this.value+="$",this.value+=e,this}appendPlaceholder(e,t=this._tabstop++){if(typeof e=="function"){const i=new Vf;i._tabstop=this._tabstop,e(i),this._tabstop=i._tabstop,e=i.value}else e=Vf._escape(e);return this.value+="${",this.value+=t,this.value+=":",this.value+=e,this.value+="}",this}appendChoice(e,t=this._tabstop++){const i=e.map(n=>n.replaceAll(/[|\\,]/g,"\\$&")).join(",");return this.value+="${",this.value+=t,this.value+="|",this.value+=i,this.value+="|}",this}appendVariable(e,t){if(typeof t=="function"){const i=new Vf;i._tabstop=this._tabstop,t(i),this._tabstop=i._tabstop,t=i.value}else typeof t=="string"&&(t=t.replace(/\$|}/g,"\\$&"));return this.value+="${",this.value+=e,t&&(this.value+=":",this.value+=t),this.value+="}",this}};OE=Vf=f([nt],OE);var X_;(function(s){s[s.Unnecessary=1]="Unnecessary",s[s.Deprecated=2]="Deprecated"})(X_||(X_={}));var Ga;(function(s){s[s.Hint=3]="Hint",s[s.Information=2]="Information",s[s.Warning=1]="Warning",s[s.Error=0]="Error"})(Ga||(Ga={}));let tv=nW=class{static isLocation(e){return e instanceof nW?!0:e?ls.isRange(e.range)&&R.isUri(e.uri):!1}constructor(e,t){if(this.uri=e,t)if(ls.isRange(t))this.range=ls.of(t);else if(en.isPosition(t))this.range=new ls(t,t);else throw new Error("Illegal argument")}toJSON(){return{uri:this.uri,range:this.range}}};tv=nW=f([nt],tv);let uA=class{static is(e){return e?typeof e.message=="string"&&e.location&&ls.isRange(e.location.range)&&R.isUri(e.location.uri):!1}constructor(e,t){this.location=e,this.message=t}static isEqual(e,t){return e===t?!0:!e||!t?!1:e.message===t.message&&e.location.range.isEqual(t.location.range)&&e.location.uri.toString()===t.location.uri.toString()}};uA=f([nt],uA);let hW=class{constructor(e,t,i=Ga.Error){if(!ls.isRange(e))throw new TypeError("range must be set");if(!t)throw new TypeError("message must be set");this.range=e,this.message=t,this.severity=i}toJSON(){return{severity:Ga[this.severity],message:this.message,range:this.range,source:this.source,code:this.code}}static isEqual(e,t){return e===t?!0:!e||!t?!1:e.message===t.message&&e.severity===t.severity&&e.code===t.code&&e.severity===t.severity&&e.source===t.source&&e.range.isEqual(t.range)&&ns(e.tags,t.tags)&&ns(e.relatedInformation,t.relatedInformation,uA.isEqual)}};hW=f([nt],hW);let uW=class{constructor(e,t){if(!e)throw new Error("Illegal argument, contents must be defined");Array.isArray(e)?this.contents=e:this.contents=[e],this.range=t}};uW=f([nt],uW);let gW=class extends uW{constructor(e,t,i,n){super(e,t),this.canIncreaseVerbosity=i,this.canDecreaseVerbosity=n}};gW=f([nt],gW);var k6;(function(s){s[s.Increase=0]="Increase",s[s.Decrease=1]="Decrease"})(k6||(k6={}));var gA;(function(s){s[s.Text=0]="Text",s[s.Read=1]="Read",s[s.Write=2]="Write"})(gA||(gA={}));let pW=class{constructor(e,t=gA.Text){this.range=e,this.kind=t}toJSON(){return{range:this.range,kind:gA[this.kind]}}};pW=f([nt],pW);let fW=class{constructor(e,t){this.uri=e,this.highlights=t}toJSON(){return{uri:this.uri,highlights:this.highlights.map(e=>e.toJSON())}}};fW=f([nt],fW);var on;(function(s){s[s.File=0]="File",s[s.Module=1]="Module",s[s.Namespace=2]="Namespace",s[s.Package=3]="Package",s[s.Class=4]="Class",s[s.Method=5]="Method",s[s.Property=6]="Property",s[s.Field=7]="Field",s[s.Constructor=8]="Constructor",s[s.Enum=9]="Enum",s[s.Interface=10]="Interface",s[s.Function=11]="Function",s[s.Variable=12]="Variable",s[s.Constant=13]="Constant",s[s.String=14]="String",s[s.Number=15]="Number",s[s.Boolean=16]="Boolean",s[s.Array=17]="Array",s[s.Object=18]="Object",s[s.Key=19]="Key",s[s.Null=20]="Null",s[s.EnumMember=21]="EnumMember",s[s.Struct=22]="Struct",s[s.Event=23]="Event",s[s.Operator=24]="Operator",s[s.TypeParameter=25]="TypeParameter"})(on||(on={}));var pA;(function(s){s[s.Deprecated=1]="Deprecated"})(pA||(pA={}));let mW=sW=class{static validate(e){if(!e.name)throw new Error("name must not be falsy")}constructor(e,t,i,n,o){this.name=e,this.kind=t,this.containerName=o,typeof i=="string"&&(this.containerName=i),n instanceof tv?this.location=n:i instanceof ls&&(this.location=new tv(n,i)),sW.validate(this)}toJSON(){return{name:this.name,kind:on[this.kind],location:this.location,containerName:this.containerName}}};mW=sW=f([nt],mW);let vW=Fk=class{static validate(e){if(!e.name)throw new Error("name must not be falsy");if(!e.range.contains(e.selectionRange))throw new Error("selectionRange must be contained in fullRange");e.children?.forEach(Fk.validate)}constructor(e,t,i,n,o){this.name=e,this.detail=t,this.kind=i,this.range=n,this.selectionRange=o,this.children=[],Fk.validate(this)}};vW=Fk=f([nt],vW);var fA;(function(s){s[s.Invoke=1]="Invoke",s[s.Automatic=2]="Automatic"})(fA||(fA={}));let T6=class{constructor(e,t){this.title=e,this.kind=t}};T6=f([nt],T6);let ss=class{static{NS=this}static{this.sep="."}constructor(e){this.value=e}append(e){return new NS(this.value?this.value+NS.sep+e:e)}intersects(e){return this.contains(e)||e.contains(this)}contains(e){return this.value===e.value||e.value.startsWith(this.value+NS.sep)}};ss=NS=f([nt],ss);ss.Empty=new ss("");ss.QuickFix=ss.Empty.append("quickfix");ss.Refactor=ss.Empty.append("refactor");ss.RefactorExtract=ss.Refactor.append("extract");ss.RefactorInline=ss.Refactor.append("inline");ss.RefactorMove=ss.Refactor.append("move");ss.RefactorRewrite=ss.Refactor.append("rewrite");ss.Source=ss.Empty.append("source");ss.SourceOrganizeImports=ss.Source.append("organizeImports");ss.SourceFixAll=ss.Source.append("fixAll");ss.Notebook=ss.Empty.append("notebook");let _W=class{constructor(e,t){if(this.range=e,this.parent=t,t&&!t.range.contains(this.range))throw new Error("Invalid argument: parent must contain this range")}};_W=f([nt],_W);let aEe=class{constructor(e,t,i,n,o,r){this.kind=e,this.name=t,this.detail=i,this.uri=n,this.range=o,this.selectionRange=r}},cEe=class{constructor(e,t){this.fromRanges=t,this.from=e}},dEe=class{constructor(e,t){this.fromRanges=t,this.to=e}};var A6;(function(s){s[s.Information=0]="Information",s[s.Warning=1]="Warning",s[s.Error=2]="Error"})(A6||(A6={}));let R6=class{constructor(e,t){this.range=e,this.command=t}get isResolved(){return!!this.command}};R6=f([nt],R6);let qp=oW=class{#e;static isMarkdownString(e){return e instanceof oW?!0:e&&e.appendCodeblock&&e.appendMarkdown&&e.appendText&&e.value!==void 0}constructor(e,t=!1){this.#e=new Ni(e,{supportThemeIcons:t})}get value(){return this.#e.value}set value(e){this.#e.value=e}get isTrusted(){return this.#e.isTrusted}set isTrusted(e){this.#e.isTrusted=e}get supportThemeIcons(){return this.#e.supportThemeIcons}set supportThemeIcons(e){this.#e.supportThemeIcons=e}get supportHtml(){return this.#e.supportHtml}set supportHtml(e){this.#e.supportHtml=e}get baseUri(){return this.#e.baseUri}set baseUri(e){this.#e.baseUri=e}appendText(e){return this.#e.appendText(e),this}appendMarkdown(e){return this.#e.appendMarkdown(e),this}appendCodeblock(e,t){return this.#e.appendCodeblock(t??"",e),this}};qp=oW=f([nt],qp);let P6=class{constructor(e,t){this.label=e,this.documentation=t}};P6=f([nt],P6);let L6=class{constructor(e,t){this.label=e,this.documentation=t,this.parameters=[]}};L6=f([nt],L6);let M6=class{constructor(){this.activeSignature=0,this.activeParameter=0,this.signatures=[]}};M6=f([nt],M6);var N6;(function(s){s[s.Invoke=1]="Invoke",s[s.TriggerCharacter=2]="TriggerCharacter",s[s.ContentChange=3]="ContentChange"})(N6||(N6={}));var O6;(function(s){s[s.Type=1]="Type",s[s.Parameter=2]="Parameter"})(O6||(O6={}));let bW=class{constructor(e){this.value=e}};bW=f([nt],bW);let yW=class{constructor(e,t,i){this.position=e,this.label=t,this.kind=i}};yW=f([nt],yW);var SC;(function(s){s[s.Invoke=0]="Invoke",s[s.TriggerCharacter=1]="TriggerCharacter",s[s.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(SC||(SC={}));var _t;(function(s){s[s.Text=0]="Text",s[s.Method=1]="Method",s[s.Function=2]="Function",s[s.Constructor=3]="Constructor",s[s.Field=4]="Field",s[s.Variable=5]="Variable",s[s.Class=6]="Class",s[s.Interface=7]="Interface",s[s.Module=8]="Module",s[s.Property=9]="Property",s[s.Unit=10]="Unit",s[s.Value=11]="Value",s[s.Enum=12]="Enum",s[s.Keyword=13]="Keyword",s[s.Snippet=14]="Snippet",s[s.Color=15]="Color",s[s.File=16]="File",s[s.Reference=17]="Reference",s[s.Folder=18]="Folder",s[s.EnumMember=19]="EnumMember",s[s.Constant=20]="Constant",s[s.Struct=21]="Struct",s[s.Event=22]="Event",s[s.Operator=23]="Operator",s[s.TypeParameter=24]="TypeParameter",s[s.User=25]="User",s[s.Issue=26]="Issue"})(_t||(_t={}));var mA;(function(s){s[s.Deprecated=1]="Deprecated"})(mA||(mA={}));let wW=class{constructor(e,t){this.label=e,this.kind=t}toJSON(){return{label:this.label,kind:this.kind&&_t[this.kind],detail:this.detail,documentation:this.documentation,sortText:this.sortText,filterText:this.filterText,preselect:this.preselect,insertText:this.insertText,textEdit:this.textEdit}}};wW=f([nt],wW);let F6=class{constructor(e=[],t=!1){this.items=e,this.isIncomplete=t}};F6=f([nt],F6);let W6=class{constructor(e,t,i){this.insertText=e,this.range=t,this.command=i}};W6=f([nt],W6);let B6=class{constructor(e){this.commands=void 0,this.suppressSuggestions=void 0,this.items=e}};B6=f([nt],B6);var Z_;(function(s){s[s.Unknown=0]="Unknown",s[s.Word=1]="Word",s[s.Line=2]="Line",s[s.Suggest=3]="Suggest"})(Z_||(Z_={}));var CC;(function(s){s[s.Accepted=0]="Accepted",s[s.Rejected=1]="Rejected",s[s.Ignored=2]="Ignored"})(CC||(CC={}));var vA;(function(s){s[s.Active=-1]="Active",s[s.Beside=-2]="Beside",s[s.One=1]="One",s[s.Two=2]="Two",s[s.Three=3]="Three",s[s.Four=4]="Four",s[s.Five=5]="Five",s[s.Six=6]="Six",s[s.Seven=7]="Seven",s[s.Eight=8]="Eight",s[s.Nine=9]="Nine"})(vA||(vA={}));var V6;(function(s){s[s.Left=1]="Left",s[s.Right=2]="Right"})(V6||(V6={}));function k4e(s,e){return`${Es.toKey(s)}.${e}`}var Ul;(function(s){s[s.Off=0]="Off",s[s.On=1]="On",s[s.Relative=2]="Relative",s[s.Interval=3]="Interval"})(Ul||(Ul={}));var EC;(function(s){s[s.Manual=1]="Manual",s[s.AfterDelay=2]="AfterDelay",s[s.FocusOut=3]="FocusOut"})(EC||(EC={}));var H6;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(H6||(H6={}));var _A;(function(s){s[s.Keyboard=1]="Keyboard",s[s.Mouse=2]="Mouse",s[s.Command=3]="Command"})(_A||(_A={}));var U6;(function(s){s[s.Addition=1]="Addition",s[s.Deletion=2]="Deletion",s[s.Modification=3]="Modification"})(U6||(U6={}));var $6;(function(s){s[s.Undo=1]="Undo",s[s.Redo=2]="Redo"})($6||($6={}));var J_;(function(s){s[s.OpenOpen=0]="OpenOpen",s[s.ClosedClosed=1]="ClosedClosed",s[s.OpenClosed=2]="OpenClosed",s[s.ClosedOpen=3]="ClosedOpen"})(J_||(J_={}));(function(s){function e(t){switch(t){case"keyboard":return s.Keyboard;case"mouse":return s.Mouse;case sd.PROGRAMMATIC:case sd.JUMP:case sd.NAVIGATION:return s.Command}}s.fromValue=e})(_A||(_A={}));var bA;(function(s){s[s.Other=0]="Other",s[s.Comment=1]="Comment",s[s.String=2]="String",s[s.RegEx=3]="RegEx"})(bA||(bA={}));(function(s){function e(t){switch(t){case s.Other:return"other";case s.Comment:return"comment";case s.String:return"string";case s.RegEx:return"regex"}return"other"}s.toString=e})(bA||(bA={}));let SW=class{constructor(e,t){if(t&&!R.isUri(t))throw Mt("target");if(!ls.isRange(e)||e.isEmpty)throw Mt("range");this.range=e,this.target=t}};SW=f([nt],SW);let yA=class{constructor(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n}};yA=f([nt],yA);let G6=class{constructor(e,t){if(t&&!(t instanceof yA))throw Mt("color");if(!ls.isRange(e)||e.isEmpty)throw Mt("range");this.range=e,this.color=t}};G6=f([nt],G6);let CW=class{constructor(e){if(!e||typeof e!="string")throw Mt("label");this.label=e}};CW=f([nt],CW);var q6;(function(s){s[s.RGB=0]="RGB",s[s.HEX=1]="HEX",s[s.HSL=2]="HSL"})(q6||(q6={}));var z6;(function(s){s[s.Error=0]="Error",s[s.Warning=1]="Warning",s[s.Information=2]="Information"})(z6||(z6={}));var K6;(function(s){s[s.Unknown=0]="Unknown",s[s.Shutdown=1]="Shutdown",s[s.Process=2]="Process",s[s.User=3]="User",s[s.Extension=4]="Extension"})(K6||(K6={}));var xC;(function(s){s[s.Low=0]="Low",s[s.Medium=1]="Medium",s[s.High=2]="High"})(xC||(xC={}));var j6;(function(s){s[s.Sh=1]="Sh",s[s.Bash=2]="Bash",s[s.Fish=3]="Fish",s[s.Csh=4]="Csh",s[s.Ksh=5]="Ksh",s[s.Zsh=6]="Zsh",s[s.CommandPrompt=7]="CommandPrompt",s[s.GitBash=8]="GitBash",s[s.PowerShell=9]="PowerShell",s[s.Python=10]="Python",s[s.Julia=11]="Julia",s[s.NuShell=12]="NuShell",s[s.Node=13]="Node"})(j6||(j6={}));class L4e{constructor(e,t,i){if(this.startIndex=e,this.length=t,this.tooltip=i,typeof e!="number"||e<0)throw Mt("startIndex");if(typeof t!="number"||t<1)throw Mt("length");if(i!==void 0&&typeof i!="string")throw Mt("tooltip")}}class M4e{constructor(e){this.uri=e}}class N4e{constructor(e){this.terminalCommand=e}}var Y6;(function(s){s[s.Panel=1]="Panel",s[s.Editor=2]="Editor"})(Y6||(Y6={}));class O4e{constructor(e){if(this.options=e,typeof e!="object")throw Mt("options")}}var Q6;(function(s){s[s.File=0]="File",s[s.Folder=1]="Folder",s[s.Method=2]="Method",s[s.Alias=3]="Alias",s[s.Argument=4]="Argument",s[s.Option=5]="Option",s[s.OptionValue=6]="OptionValue",s[s.Flag=7]="Flag"})(Q6||(Q6={}));class F4e{constructor(e,t,i,n,o,r,a,c,d){this.label=e,this.icon=t,this.detail=i,this.documentation=n,this.isFile=o,this.isDirectory=r,this.isKeyword=a,this.replacementIndex=c??0,this.replacementLength=d??0}}let W4e=class{constructor(e,t){this.items=e??[],this.resourceRequestConfig=t}};var X6;(function(s){s[s.Always=1]="Always",s[s.Silent=2]="Silent",s[s.Never=3]="Never"})(X6||(X6={}));var Z6;(function(s){s.Changed="changed",s.ProcessStarted="processStarted",s.ProcessEnded="processEnded",s.Terminated="terminated",s.Start="start",s.AcquiredInput="acquiredInput",s.DependsOnStarted="dependsOnStarted",s.Active="active",s.Inactive="inactive",s.End="end",s.ProblemMatcherStarted="problemMatcherStarted",s.ProblemMatcherEnded="problemMatcherEnded",s.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(Z6||(Z6={}));var J6;(function(s){s[s.Shared=1]="Shared",s[s.Dedicated=2]="Dedicated",s[s.New=3]="New"})(J6||(J6={}));let e9=class{static{Wl=this}static{this.Clean=new Wl("clean","Clean")}static{this.Build=new Wl("build","Build")}static{this.Rebuild=new Wl("rebuild","Rebuild")}static{this.Test=new Wl("test","Test")}static from(e){switch(e){case"clean":return Wl.Clean;case"build":return Wl.Build;case"rebuild":return Wl.Rebuild;case"test":return Wl.Test;default:return}}constructor(e,t){if(this.label=t,typeof e!="string")throw Mt("name");if(typeof t!="string")throw Mt("name");this._id=e}get id(){return this._id}};e9=Wl=f([nt],e9);function Coe(s){let e="";for(let t=0;t<s.length;t++)e+=s[t].replace(/,/g,",,")+",";return e}let EW=class{constructor(e,t,i){if(typeof e!="string")throw Mt("process");this._args=[],this._process=e,t!==void 0&&(Array.isArray(t)?(this._args=t,this._options=i):this._options=t)}get process(){return this._process}set process(e){if(typeof e!="string")throw Mt("process");this._process=e}get args(){return this._args}set args(e){Array.isArray(e)||(e=[]),this._args=e}get options(){return this._options}set options(e){this._options=e}computeId(){const e=[];if(e.push("process"),this._process!==void 0&&e.push(this._process),this._args&&this._args.length>0)for(const t of this._args)e.push(t);return Coe(e)}};EW=f([nt],EW);let xW=class{constructor(e,t,i){if(this._args=[],Array.isArray(t)){if(!e)throw Mt("command can't be undefined or null");if(typeof e!="string"&&typeof e.value!="string")throw Mt("command");this._command=e,t&&(this._args=t),this._options=i}else{if(typeof e!="string")throw Mt("commandLine");this._commandLine=e,this._options=t}}get commandLine(){return this._commandLine}set commandLine(e){if(typeof e!="string")throw Mt("commandLine");this._commandLine=e}get command(){return this._command?this._command:""}set command(e){if(typeof e!="string"&&typeof e.value!="string")throw Mt("command");this._command=e}get args(){return this._args}set args(e){this._args=e||[]}get options(){return this._options}set options(e){this._options=e}computeId(){const e=[];if(e.push("shell"),this._commandLine!==void 0&&e.push(this._commandLine),this._command!==void 0&&e.push(typeof this._command=="string"?this._command:this._command.value),this._args&&this._args.length>0)for(const t of this._args)e.push(typeof t=="string"?t:t.value);return Coe(e)}};xW=f([nt],xW);var t9;(function(s){s[s.Escape=1]="Escape",s[s.Strong=2]="Strong",s[s.Weak=3]="Weak"})(t9||(t9={}));var wA;(function(s){s[s.Global=1]="Global",s[s.Workspace=2]="Workspace"})(wA||(wA={}));class lEe{constructor(e){this._callback=e}computeId(){return"customExecution"+Dn()}set callback(e){this._callback=e}get callback(){return this._callback}}let i9=class{static{Bl=this}static{this.ExtensionCallbackType="customExecution"}static{this.ProcessType="process"}static{this.ShellType="shell"}static{this.EmptyType="$empty"}constructor(e,t,i,n,o,r){this.__deprecated=!1,this._definition=this.definition=e;let a;typeof t=="string"?(this._name=this.name=t,this._source=this.source=i,this.execution=n,a=o,this.__deprecated=!0):t===wA.Global||t===wA.Workspace?(this.target=t,this._name=this.name=i,this._source=this.source=n,this.execution=o,a=r):(this.target=t,this._name=this.name=i,this._source=this.source=n,this.execution=o,a=r),typeof a=="string"?(this._problemMatchers=[a],this._hasDefinedMatchers=!0):Array.isArray(a)?(this._problemMatchers=a,this._hasDefinedMatchers=!0):(this._problemMatchers=[],this._hasDefinedMatchers=!1),this._isBackground=!1,this._presentationOptions=Object.create(null),this._runOptions=Object.create(null)}get _id(){return this.__id}set _id(e){this.__id=e}get _deprecated(){return this.__deprecated}clear(){this.__id!==void 0&&(this.__id=void 0,this._scope=void 0,this.computeDefinitionBasedOnExecution())}computeDefinitionBasedOnExecution(){this._execution instanceof EW?this._definition={type:Bl.ProcessType,id:this._execution.computeId()}:this._execution instanceof xW?this._definition={type:Bl.ShellType,id:this._execution.computeId()}:this._execution instanceof lEe?this._definition={type:Bl.ExtensionCallbackType,id:this._execution.computeId()}:this._definition={type:Bl.EmptyType,id:Dn()}}get definition(){return this._definition}set definition(e){if(e==null)throw Mt("Kind can't be undefined or null");this.clear(),this._definition=e}get scope(){return this._scope}set target(e){this.clear(),this._scope=e}get name(){return this._name}set name(e){if(typeof e!="string")throw Mt("name");this.clear(),this._name=e}get execution(){return this._execution}set execution(e){e===null&&(e=void 0),this.clear(),this._execution=e;const t=this._definition.type;(Bl.EmptyType===t||Bl.ProcessType===t||Bl.ShellType===t||Bl.ExtensionCallbackType===t)&&this.computeDefinitionBasedOnExecution()}get problemMatchers(){return this._problemMatchers}set problemMatchers(e){if(Array.isArray(e))this.clear(),this._problemMatchers=e,this._hasDefinedMatchers=!0;else{this.clear(),this._problemMatchers=[],this._hasDefinedMatchers=!1;return}}get hasDefinedMatchers(){return this._hasDefinedMatchers}get isBackground(){return this._isBackground}set isBackground(e){e!==!0&&e!==!1&&(e=!1),this.clear(),this._isBackground=e}get source(){return this._source}set source(e){if(typeof e!="string"||e.length===0)throw Mt("source must be a string of length > 0");this.clear(),this._source=e}get group(){return this._group}set group(e){e===null&&(e=void 0),this.clear(),this._group=e}get detail(){return this._detail}set detail(e){e===null&&(e=void 0),this._detail=e}get presentationOptions(){return this._presentationOptions}set presentationOptions(e){e==null&&(e=Object.create(null)),this.clear(),this._presentationOptions=e}get runOptions(){return this._runOptions}set runOptions(e){e==null&&(e=Object.create(null)),this.clear(),this._runOptions=e}};i9=Bl=f([nt],i9);var IC;(function(s){s[s.SourceControl=1]="SourceControl",s[s.Window=10]="Window",s[s.Notification=15]="Notification"})(IC||(IC={}));var n9;(function(s){function e(t){const i=t;return Ja(i.value)?i.tooltip&&!It(i.tooltip)?(console.log("INVALID view badge, invalid tooltip",i.tooltip),!1):!0:(console.log("INVALID view badge, invalid value",i.value),!1)}s.isViewBadge=e})(n9||(n9={}));let s9=rW=class{static isTreeItem(e,t){const i=e;if(i.checkboxState!==void 0){const n=Ja(i.checkboxState)?i.checkboxState:oa(i.checkboxState)&&Ja(i.checkboxState.state)?i.checkboxState.state:void 0,o=!Ja(i.checkboxState)&&oa(i.checkboxState)?i.checkboxState.tooltip:void 0;if(n===void 0||n!==SA.Checked&&n!==SA.Unchecked||o!==void 0&&!It(o))return console.log("INVALID tree item, invalid checkboxState",i.checkboxState),!1}if(e instanceof rW)return!0;if(i.label!==void 0&&!It(i.label)&&!i.label?.label)return console.log("INVALID tree item, invalid label",i.label),!1;if(i.id!==void 0&&!It(i.id))return console.log("INVALID tree item, invalid id",i.id),!1;if(i.iconPath!==void 0&&!It(i.iconPath)&&!R.isUri(i.iconPath)&&(!i.iconPath||!It(i.iconPath.id))){const n=i.iconPath;if(!n||!It(n.light)&&!R.isUri(n.light)&&!It(n.dark)&&!R.isUri(n.dark))return console.log("INVALID tree item, invalid iconPath",i.iconPath),!1}return i.description!==void 0&&!It(i.description)&&typeof i.description!="boolean"?(console.log("INVALID tree item, invalid description",i.description),!1):i.resourceUri!==void 0&&!R.isUri(i.resourceUri)?(console.log("INVALID tree item, invalid resourceUri",i.resourceUri),!1):i.tooltip!==void 0&&!It(i.tooltip)&&!(i.tooltip instanceof qp)?(console.log("INVALID tree item, invalid tooltip",i.tooltip),!1):i.command!==void 0&&!i.command.command?(console.log("INVALID tree item, invalid command",i.command),!1):i.collapsibleState!==void 0&&i.collapsibleState<DC.None&&i.collapsibleState>DC.Expanded?(console.log("INVALID tree item, invalid collapsibleState",i.collapsibleState),!1):i.contextValue!==void 0&&!It(i.contextValue)?(console.log("INVALID tree item, invalid contextValue",i.contextValue),!1):i.accessibilityInformation!==void 0&&!i.accessibilityInformation?.label?(console.log("INVALID tree item, invalid accessibilityInformation",i.accessibilityInformation),!1):!0}constructor(e,t=DC.None){this.collapsibleState=t,R.isUri(e)?this.resourceUri=e:this.label=e}};s9=rW=f([nt],s9);var DC;(function(s){s[s.None=0]="None",s[s.Collapsed=1]="Collapsed",s[s.Expanded=2]="Expanded"})(DC||(DC={}));var SA;(function(s){s[s.Unchecked=0]="Unchecked",s[s.Checked=1]="Checked"})(SA||(SA={}));let IW=class{async asString(){return typeof this.value=="string"?this.value:JSON.stringify(this.value)}asFile(){}constructor(e){this.value=e}};IW=f([nt],IW);class DW extends IW{}class hEe extends DW{#e;constructor(e){super(""),this.#e=e}asFile(){return this.#e}}class uEe{constructor(e,t,i,n){this.name=e,this.uri=t,this._itemId=i,this._getData=n}data(){return this._getData()}}let kW=class{#e=new Map;constructor(e){for(const[t,i]of e??[]){const n=this.#e.get(this.#t(t));n?n.push(i):this.#e.set(this.#t(t),[i])}}get(e){return this.#e.get(this.#t(e))?.[0]}set(e,t){this.#e.set(this.#t(e),[t])}forEach(e,t){for(const[i,n]of this.#e)for(const o of n)e.call(t,o,i,this)}*[Symbol.iterator](){for(const[e,t]of this.#e)for(const i of t)yield[e,i]}#t(e){return e.toLowerCase()}};kW=f([nt],kW);let o9=class{constructor(e,t,i){this.insertText=e,this.title=t,this.kind=i}};o9=f([nt],o9);var r9;(function(s){s[s.Automatic=0]="Automatic",s[s.PasteAs=1]="PasteAs"})(r9||(r9={}));class _h{static{this.sep="."}constructor(e){this.value=e}append(...e){return new _h((this.value?[this.value,...e]:e).join(_h.sep))}intersects(e){return this.contains(e)||e.contains(this)}contains(e){return this.value===e.value||e.value.startsWith(this.value+_h.sep)}}_h.Empty=new _h("");_h.Text=new _h("text");_h.TextUpdateImports=_h.Text.append("updateImports");class j4e{constructor(e,t,i){this.title=t,this.insertText=e,this.kind=i}}let zp=class{constructor(e,t){this.id=e,this.color=t}static isThemeIcon(e){return typeof e.id!="string"?(console.log("INVALID ThemeIcon, invalid id",e.id),!1):!0}};zp=f([nt],zp);zp.File=new zp("file");zp.Folder=new zp("folder");let a9=class{constructor(e){this.id=e}};a9=f([nt],a9);var c9;(function(s){s[s.Global=1]="Global",s[s.Workspace=2]="Workspace",s[s.WorkspaceFolder=3]="WorkspaceFolder"})(c9||(c9={}));let kC=class{get base(){return this._base}set base(e){this._base=e,this._baseUri=R.file(e)}get baseUri(){return this._baseUri}set baseUri(e){this._baseUri=e,this._base=e.fsPath}constructor(e,t){if(typeof e!="string"&&(!e||!R.isUri(e)&&!R.isUri(e.uri)))throw Mt("base");if(typeof t!="string")throw Mt("pattern");typeof e=="string"?this.baseUri=R.file(e):R.isUri(e)?this.baseUri=e:this.baseUri=e.uri,this.pattern=t}toJSON(){return{pattern:this.pattern,base:this.base,baseUri:this.baseUri.toJSON()}}};kC=f([nt],kC);const Eoe=new WeakMap;function Z4e(s,e){Eoe.set(s,e)}let FE=class{constructor(e,t,i,n,o){this.enabled=typeof e=="boolean"?e:!0,typeof t=="string"&&(this.condition=t),typeof i=="string"&&(this.hitCondition=i),typeof n=="string"&&(this.logMessage=n),typeof o=="string"&&(this.mode=o)}get id(){return this._id||(this._id=Eoe.get(this)??Dn()),this._id}};FE=f([nt],FE);let d9=class extends FE{constructor(e,t,i,n,o,r){if(super(t,i,n,o,r),e===null)throw Mt("location");this.location=e}};d9=f([nt],d9);let l9=class extends FE{constructor(e,t,i,n,o,r){super(t,i,n,o,r),this.functionName=e}};l9=f([nt],l9);let h9=class extends FE{constructor(e,t,i,n,o,r,a,c){if(super(n,o,r,a,c),!t)throw Mt("dataId");this.label=e,this.dataId=t,this.canPersist=i}};h9=f([nt],h9);let u9=class{constructor(e,t,i){this.command=e,this.args=t||[],this.options=i}};u9=f([nt],u9);let g9=class{constructor(e,t){this.port=e,this.host=t}};g9=f([nt],g9);let p9=class{constructor(e){this.path=e}};p9=f([nt],p9);let f9=class{constructor(e){this.implementation=e}};f9=f([nt],f9);class a5e{constructor(e,t,i){this.session=e,this.threadId=t,this.frameId=i}}class c5e{constructor(e,t){this.session=e,this.threadId=t}}let TW=class{constructor(e,t){this.range=e,this.expression=t}};TW=f([nt],TW);var m9;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(m9||(m9={}));let AW=class{constructor(e,t){this.range=e,this.text=t}};AW=f([nt],AW);let RW=class{constructor(e,t,i=!0){this.range=e,this.variableName=t,this.caseSensitiveLookup=i}};RW=f([nt],RW);let PW=class{constructor(e,t){this.range=e,this.expression=t}};PW=f([nt],PW);let LW=class{constructor(e,t){this.frameId=e,this.stoppedLocation=t}};LW=f([nt],LW);var v9;(function(s){s[s.AIGenerated=1]="AIGenerated"})(v9||(v9={}));var _9;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(_9||(_9={}));class p5e{constructor(e,t){this.newSymbolName=e,this.tags=t}}var b9;(function(s){s[s.Changed=1]="Changed",s[s.Created=2]="Created",s[s.Deleted=3]="Deleted"})(b9||(b9={}));let y9=$r=class extends Error{static FileExists(e){return new $r(e,cr.FileExists,$r.FileExists)}static FileNotFound(e){return new $r(e,cr.FileNotFound,$r.FileNotFound)}static FileNotADirectory(e){return new $r(e,cr.FileNotADirectory,$r.FileNotADirectory)}static FileIsADirectory(e){return new $r(e,cr.FileIsADirectory,$r.FileIsADirectory)}static NoPermissions(e){return new $r(e,cr.NoPermissions,$r.NoPermissions)}static Unavailable(e){return new $r(e,cr.Unavailable,$r.Unavailable)}constructor(e,t=cr.Unknown,i){super(R.isUri(e)?e.toString(!0):e),this.code=i?.name??"Unknown",Kfe(this,t),Object.setPrototypeOf(this,$r.prototype),typeof Error.captureStackTrace=="function"&&typeof i=="function"&&Error.captureStackTrace(this,i)}};y9=$r=f([nt],y9);let w9=class{constructor(e,t,i){this.start=e,this.end=t,this.kind=i}};w9=f([nt],w9);var Xg;(function(s){s[s.Comment=1]="Comment",s[s.Imports=2]="Imports",s[s.Region=3]="Region"})(Xg||(Xg={}));var S9;(function(s){s[s.Collapsed=0]="Collapsed",s[s.Expanded=1]="Expanded"})(S9||(S9={}));var C9;(function(s){s[s.Editing=0]="Editing",s[s.Preview=1]="Preview"})(C9||(C9={}));var E9;(function(s){s[s.Published=0]="Published",s[s.Draft=1]="Draft"})(E9||(E9={}));var x9;(function(s){s[s.Unresolved=0]="Unresolved",s[s.Resolved=1]="Resolved"})(x9||(x9={}));var I9;(function(s){s[s.Current=0]="Current",s[s.Outdated=1]="Outdated"})(I9||(I9={}));var D9;(function(s){s[s.Reply=1]="Reply",s[s.Comment=2]="Comment"})(D9||(D9={}));class v5e{constructor(e,t=[]){this.tokenTypes=e,this.tokenModifiers=t}}function gEe(s){return typeof s>"u"||Cie(s)}class xoe{constructor(e){if(this._prevLine=0,this._prevChar=0,this._dataIsSortedAndDeltaEncoded=!0,this._data=[],this._dataLen=0,this._tokenTypeStrToInt=new Map,this._tokenModifierStrToInt=new Map,this._hasLegend=!1,e){this._hasLegend=!0;for(let t=0,i=e.tokenTypes.length;t<i;t++)this._tokenTypeStrToInt.set(e.tokenTypes[t],t);for(let t=0,i=e.tokenModifiers.length;t<i;t++)this._tokenModifierStrToInt.set(e.tokenModifiers[t],t)}}push(e,t,i,n,o){if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"&&(typeof o=="number"||typeof o>"u"))return typeof o>"u"&&(o=0),this._pushEncoded(e,t,i,n,o);if(ls.isRange(e)&&typeof t=="string"&&gEe(i))return this._push(e,t,i);throw Mt()}_push(e,t,i){if(!this._hasLegend)throw new Error("Legend must be provided in constructor");if(e.start.line!==e.end.line)throw new Error("`range` cannot span multiple lines");if(!this._tokenTypeStrToInt.has(t))throw new Error("`tokenType` is not in the provided legend");const n=e.start.line,o=e.start.character,r=e.end.character-e.start.character,a=this._tokenTypeStrToInt.get(t);let c=0;if(i)for(const d of i){if(!this._tokenModifierStrToInt.has(d))throw new Error("`tokenModifier` is not in the provided legend");const l=this._tokenModifierStrToInt.get(d);c|=1<<l>>>0}this._pushEncoded(n,o,r,a,c)}_pushEncoded(e,t,i,n,o){if(this._dataIsSortedAndDeltaEncoded&&(e<this._prevLine||e===this._prevLine&&t<this._prevChar)){this._dataIsSortedAndDeltaEncoded=!1;const c=this._data.length/5|0;let d=0,l=0;for(let u=0;u<c;u++){let g=this._data[5*u],m=this._data[5*u+1];g===0?(g=d,m+=l):g+=d,this._data[5*u]=g,this._data[5*u+1]=m,d=g,l=m}}let r=e,a=t;this._dataIsSortedAndDeltaEncoded&&this._dataLen>0&&(r-=this._prevLine,r===0&&(a-=this._prevChar)),this._data[this._dataLen++]=r,this._data[this._dataLen++]=a,this._data[this._dataLen++]=i,this._data[this._dataLen++]=n,this._data[this._dataLen++]=o,this._prevLine=e,this._prevChar=t}static _sortAndDeltaEncode(e){const t=[],i=e.length/5|0;for(let a=0;a<i;a++)t[a]=a;t.sort((a,c)=>{const d=e[5*a],l=e[5*c];if(d===l){const u=e[5*a+1],g=e[5*c+1];return u-g}return d-l});const n=new Uint32Array(e.length);let o=0,r=0;for(let a=0;a<i;a++){const c=5*t[a],d=e[c+0],l=e[c+1],u=e[c+2],g=e[c+3],m=e[c+4],v=d-o,y=v===0?l-r:l,w=5*a;n[w+0]=v,n[w+1]=y,n[w+2]=u,n[w+3]=g,n[w+4]=m,o=d,r=l}return n}build(e){return this._dataIsSortedAndDeltaEncoded?new k9(new Uint32Array(this._data),e):new k9(xoe._sortAndDeltaEncode(this._data),e)}}class k9{constructor(e,t){this.resultId=t,this.data=e}}class _5e{constructor(e,t,i){this.start=e,this.deleteCount=t,this.data=i}}class b5e{constructor(e,t){this.resultId=t,this.edits=e}}var T9;(function(s){s[s.Separate=0]="Separate",s[s.MergeWithParent=1]="MergeWithParent"})(T9||(T9={}));class y5e{constructor(e){this.name=e}}var A9;(function(s){s[s.Title=1]="Title",s[s.Inline=2]="Inline"})(A9||(A9={}));let R9=class{static{this.Back={iconPath:new zp("arrow-left")}}constructor(){}};R9=f([nt],R9);var P9;(function(s){s[s.Separator=-1]="Separator",s[s.Default=0]="Default"})(P9||(P9={}));var L9;(function(s){s[s.Info=1]="Info",s[s.Warning=2]="Warning",s[s.Error=3]="Error"})(L9||(L9={}));var M9;(function(s){s[s.UI=1]="UI",s[s.Workspace=2]="Workspace"})(M9||(M9={}));class S5e{static validate(e){if(typeof e.badge=="string"){let t=u7(e.badge,0);if(t<e.badge.length&&(t+=u7(e.badge,t)),e.badge.length>t)throw new Error("The 'badge'-property must be undefined or a short character")}else if(e.badge&&!zp.isThemeIcon(e.badge))throw new Error("The 'badge'-property is not a valid ThemeIcon");if(!e.color&&!e.badge&&!e.tooltip)throw new Error("The decoration is empty");return!0}constructor(e,t,i){this.badge=e,this.tooltip=t,this.color=i}}let N9=class{constructor(e){this.kind=e}};N9=f([nt],N9);var O9;(function(s){s[s.Light=1]="Light",s[s.Dark=2]="Dark",s[s.HighContrast=3]="HighContrast",s[s.HighContrastLight=4]="HighContrastLight"})(O9||(O9={}));let OS=class MW{static isNotebookRange(e){return e instanceof MW?!0:e?typeof e.start=="number"&&typeof e.end=="number":!1}get start(){return this._start}get end(){return this._end}get isEmpty(){return this._start===this._end}constructor(e,t){if(e<0)throw Mt("start must be positive");if(t<0)throw Mt("end must be positive");e<=t?(this._start=e,this._end=t):(this._start=t,this._end=e)}with(e){let t=this._start,i=this._end;return e.start!==void 0&&(t=e.start),e.end!==void 0&&(i=e.end),t===this._start&&i===this._end?this:new MW(t,i)}},Ioe=class NW{static validate(e){if(typeof e.kind!="number")throw new Error("NotebookCellData MUST have 'kind' property");if(typeof e.value!="string")throw new Error("NotebookCellData MUST have 'value' property");if(typeof e.languageId!="string")throw new Error("NotebookCellData MUST have 'languageId' property")}static isNotebookCellDataArray(e){return Array.isArray(e)&&e.every(t=>NW.isNotebookCellData(t))}static isNotebookCellData(e){return!0}constructor(e,t,i,n,o,r,a){this.kind=e,this.value=t,this.languageId=i,this.mime=n,this.outputs=o??[],this.metadata=r,this.executionSummary=a,NW.validate(this)}},pEe=class{constructor(e){this.cells=e}},fEe=class ru{static isNotebookCellOutputItem(e){return e instanceof ru?!0:e?typeof e.mime=="string"&&e.data instanceof Uint8Array:!1}static error(e){const t={name:e.name,message:e.message,stack:e.stack};return ru.json(t,"application/vnd.code.notebook.error")}static stdout(e){return ru.text(e,"application/vnd.code.notebook.stdout")}static stderr(e){return ru.text(e,"application/vnd.code.notebook.stderr")}static bytes(e,t="application/octet-stream"){return new ru(e,t)}static#e=new TextEncoder;static text(e,t=Ii.text){const i=ru.#e.encode(String(e));return new ru(i,t)}static json(e,t="text/x-json"){const i=JSON.stringify(e,void 0,"	");return ru.text(i,t)}constructor(e,t){this.data=e,this.mime=t;const i=wie(t,!0);if(!i)throw new Error(`INVALID mime type: ${t}. Must be in the format "type/subtype[;optionalparameter]"`);this.mime=i}},mEe=class OW{static isNotebookCellOutput(e){return e instanceof OW?!0:!e||typeof e!="object"?!1:typeof e.id=="string"&&Array.isArray(e.items)}static ensureUniqueMimeTypes(e,t=!1){const i=new Set,n=new Set;for(let o=0;o<e.length;o++){const r=e[o],a=wie(r.mime);if(!i.has(a)||az(a)){i.add(a);continue}n.add(o),t&&console.warn(`DUPLICATED mime type '${r.mime}' will be dropped`)}return n.size===0?e:e.filter((o,r)=>!n.has(r))}constructor(e,t,i){this.items=OW.ensureUniqueMimeTypes(e,!0),typeof t=="string"?(this.id=t,this.metadata=i):(this.id=Dn(),this.metadata=t??i)}};class x5e{constructor(e,t,i){this.label=e,this.uri=t,this.position=i}}var eb;(function(s){s[s.Markup=1]="Markup",s[s.Code=2]="Code"})(eb||(eb={}));var F9;(function(s){s[s.Idle=1]="Idle",s[s.Pending=2]="Pending",s[s.Executing=3]="Executing"})(F9||(F9={}));var FW;(function(s){s[s.Left=1]="Left",s[s.Right=2]="Right"})(FW||(FW={}));var W9;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(W9||(W9={}));class I5e{constructor(e,t){this.text=e,this.alignment=t}}var B9;(function(s){s[s.Default=1]="Default",s[s.Preferred=2]="Preferred"})(B9||(B9={}));var V9;(function(s){s[s.Default=1]="Default",s[s.Preferred=2]="Preferred",s[s.Hidden=-1]="Hidden"})(V9||(V9={}));let vEe=class{constructor(e,t=[]){this.uri=e,this.provides=cw(t)}},k5e=class{constructor(e){this.label=e}};var H9;(function(s){s[s.Named=1]="Named",s[s.Indexed=2]="Indexed"})(H9||(H9={}));let U9=class{constructor(e,t){this.label=e,this.timestamp=t}};U9=f([nt],U9);var $9;(function(s){s[s.Production=1]="Production",s[s.Development=2]="Development",s[s.Test=3]="Test"})($9||($9={}));var G9;(function(s){s[s.Node=1]="Node",s[s.Webworker=2]="Webworker"})(G9||(G9={}));var tb;(function(s){s[s.Other=0]="Other",s[s.Comment=1]="Comment",s[s.String=2]="String",s[s.RegEx=3]="RegEx"})(tb||(tb={}));class R5e{constructor(e,t){this.ranges=e,this.wordPattern=t}}class P5e{constructor(e){this._autoForwardAction=e}get autoForwardAction(){return this._autoForwardAction}}var q9;(function(s){s[s.Queued=1]="Queued",s[s.Running=2]="Running",s[s.Passed=3]="Passed",s[s.Failed=4]="Failed",s[s.Skipped=5]="Skipped",s[s.Errored=6]="Errored"})(q9||(q9={}));var TC;(function(s){s[s.Run=1]="Run",s[s.Debug=2]="Debug",s[s.Coverage=3]="Coverage"})(TC||(TC={}));class L5e{constructor(e,t,i){this.controllerId=e,this.profileId=t,this.kind=i}}let z9=class{constructor(e=void 0,t=void 0,i=void 0,n=!1,o=!0){this.include=e,this.exclude=t,this.profile=i,this.continuous=n,this.preserveFocus=o}};z9=f([nt],z9);let WW=aW=class{static diff(e,t,i){const n=new aW(e);return n.expectedOutput=t,n.actualOutput=i,n}constructor(e){this.message=e}};WW=aW=f([nt],WW);let CA=class{constructor(e){this.id=e}};CA=f([nt],CA);class F5e{constructor(e,t,i){this.label=e,this.uri=t,this.position=i}}class u0{constructor(e,t){this.covered=e,this.total=t,Bk(this)}}function Bk(s){if(s){if(s.covered>s.total)throw new Error(`The total number of covered items (${s.covered}) cannot be greater than the total (${s.total})`);if(s.total<0)throw new Error(`The number of covered items (${s.total}) cannot be negative`)}}let _Ee=class Doe{static fromDetails(e,t){const i=new u0(0,0),n=new u0(0,0),o=new u0(0,0);for(const a of t)if("branches"in a){i.total+=1,i.covered+=a.executed?1:0;for(const c of a.branches)n.total+=1,n.covered+=c.executed?1:0}else o.total+=1,o.covered+=a.executed?1:0;const r=new Doe(e,i,n.total>0?n:void 0,o.total>0?o:void 0);return r.detailedCoverage=t,r}constructor(e,t,i,n,o=[]){this.uri=e,this.statementCoverage=t,this.branchCoverage=i,this.declarationCoverage=n,this.includesTests=o}};class bEe{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i=[]){this.executed=e,this.location=t,this.branches=i}}class yEe{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i){this.executed=e,this.location=t,this.label=i}}class wEe{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i){this.name=e,this.executed=t,this.location=i}}var K9;(function(s){s[s.None=0]="None",s[s.Option=1]="Option",s[s.Default=2]="Default",s[s.Preferred=3]="Preferred"})(K9||(K9={}));var j9;(function(s){s[s.Untrusted=0]="Untrusted",s[s.Trusted=1]="Trusted",s[s.Unspecified=2]="Unspecified"})(j9||(j9={}));var Y9;(function(s){s[s.Notify=1]="Notify",s[s.OpenBrowser=2]="OpenBrowser",s[s.OpenPreview=3]="OpenPreview",s[s.Silent=4]="Silent",s[s.Ignore=5]="Ignore",s[s.OpenBrowserOnce=6]="OpenBrowserOnce"})(Y9||(Y9={}));let SEe=class{constructor(e,t,i,n,o,r){this.kind=e,this.name=t,this.detail=i,this.uri=n,this.range=o,this.selectionRange=r}};class B5e{constructor(e){this.uri=e}}class V5e{constructor(e,t){this.original=e,this.modified=t}}class H5e{constructor(e,t,i,n){this.base=e,this.input1=t,this.input2=i,this.result=n}}class U5e{constructor(e,t){this.uri=e,this.viewType=t}}class $5e{constructor(e){this.viewType=e}}class G5e{constructor(e,t){this.uri=e,this.notebookType=t}}class q5e{constructor(e,t,i){this.original=e,this.modified=t,this.notebookType=i}}class z5e{constructor(){}}class K5e{constructor(e,t){this.uri=e,this.inputBoxUri=t}}class j5e{constructor(){}}class Y5e{constructor(e){this.textDiffs=e}}var Q9;(function(s){s[s.Down=0]="Down",s[s.Up=1]="Up"})(Q9||(Q9={}));var X9;(function(s){s[s.Action=1]="Action",s[s.Toolbar=2]="Toolbar"})(X9||(X9={}));var Z9;(function(s){s[s.Short=1]="Short",s[s.Medium=2]="Medium",s[s.Full=3]="Full"})(Z9||(Z9={}));class Q5e{constructor(e,t,i){this.id=e,this.label=t,this.values=i}}var ib;(function(s){s[s.Accepted=1]="Accepted",s[s.Rejected=2]="Rejected",s[s.Saved=3]="Saved"})(ib||(ib={}));var J9;(function(s){s[s.Keep=1]="Keep",s[s.Undo=2]="Undo",s[s.UserModification=3]="UserModification"})(J9||(J9={}));var e8;(function(s){s[s.Unhelpful=0]="Unhelpful",s[s.Helpful=1]="Helpful",s[s.Undone=2]="Undone",s[s.Accepted=3]="Accepted",s[s.Bug=4]="Bug"})(e8||(e8={}));var t8;(function(s){s[s.Unhelpful=0]="Unhelpful",s[s.Helpful=1]="Helpful"})(t8||(t8={}));let koe=class{constructor(e){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new qp(e):e}},Toe=class{constructor(e,t){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new qp(e):e,this.vulnerabilities=t}},CEe=class{constructor(e,t,i,n){this.title=e,this.message=t,this.data=i,this.buttons=n}};class Aoe{constructor(e,t){this.value=e,this.baseUri=t}}let Roe=class{constructor(e,t){this.value=e,this.value2=e,this.title=t}},Poe=class{constructor(e){this.value=e}};class i7e{constructor(e,t){this.value=e,this.task=t}}let Loe=class{constructor(e){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new qp(e):e}},Moe=class{constructor(e){this.value=e}},Noe=class{constructor(e,t,i){this.value=e,this.iconPath=t,this.options=i}},Ooe=class{constructor(e,t){this.value=e,this.isEdit=t}},EEe=class{constructor(e,t,i){this.value=e,this.license=t,this.snippet=i}},Foe=class{constructor(e,t){this.uri=e,this.range=t}},xEe=class{constructor(e){this.extensions=e}},Woe=class{constructor(e,t){this.uri=e,t===!0?(this.isDone=!0,this.edits=[]):this.edits=Array.isArray(t)?t:[t]}},IEe=class{constructor(e,t){this.uri=e,t===!0?(this.isDone=!0,this.edits=[]):this.edits=Array.isArray(t)?t:[t]}},Boe=class{constructor(e){this.toolName=e}};class g7e{constructor(e,t,i,n,o,r){this.prompt=e,this.command=t,this.references=i,this.participant=n,this.toolReferences=o,this.editedFileEvents=r}}class p7e{constructor(e,t,i,n){this.response=e,this.result=t,this.participant=i,this.command=n}}var $l;(function(s){s[s.Panel=1]="Panel",s[s.Terminal=2]="Terminal",s[s.Notebook=3]="Notebook",s[s.Editor=4]="Editor"})($l||($l={}));var i8;(function(s){s[s.Complete=1]="Complete",s[s.Partial=2]="Partial",s[s.Omitted=3]="Omitted"})(i8||(i8={}));class f7e{constructor(e,t,i){this.document=e,this.selection=t,this.wholeRange=i}}class m7e{constructor(e){this.cell=e}}class DEe{constructor(e,t,i){this.mimeType=e,this.data=t,this.reference=i}}class kEe{constructor(e){this.diagnostics=e}}var Gc;(function(s){s[s.User=1]="User",s[s.Assistant=2]="Assistant",s[s.System=3]="System"})(Gc||(Gc={}));class BW{constructor(e,t,i){this.callId=e,this.content=t,this.isError=i??!1}}class n8{constructor(e,t,i){this.callId=e,this.content=t,this.isError=i??!1}}class v7e{constructor(e,t,i,n){this.command=e,this.language=t,this.confirmationMessages=i,this.presentation=n}}var s8;(function(s){s[s.Info=0]="Info",s[s.Warning=1]="Warning",s[s.Error=2]="Error"})(s8||(s8={}));let TEe=class VW{static User(e,t){return new VW(Gc.User,e,t)}static Assistant(e,t){return new VW(Gc.Assistant,e,t)}set content(e){typeof e=="string"?this._content=[new oo(e)]:this._content=e}get content(){return this._content}constructor(e,t,i){this._content=[],this.role=e,this.content=t,this.name=i}},AEe=class HW{static User(e,t){return new HW(Gc.User,e,t)}static Assistant(e,t){return new HW(Gc.Assistant,e,t)}set content(e){typeof e=="string"?this._content=[new oo(e)]:this._content=e}get content(){return this._content}set content2(e){e&&(this.content=e.map(t=>typeof t=="string"?new oo(t):t))}get content2(){return this.content.map(e=>e instanceof oo?e.value:e)}constructor(e,t,i){this._content=[],this.role=e,this.content=t,this.name=i}};class EA{constructor(e,t,i){this.callId=e,this.name=t,this.input=i}}class oo{constructor(e){this.value=e}toJSON(){return{$mid:Nn.LanguageModelTextPart,value:this.value}}}class Qd{constructor(e,t){this.mimeType=t,this.data=e}static image(e,t){return new Qd(e,t)}static json(e,t="text/x-json"){const i=JSON.stringify(e,void 0,"	");return new Qd(Re.fromString(i).buffer,t)}static text(e,t=Ii.text){return new Qd(Re.fromString(e).buffer,t)}toJSON(){return{$mid:Nn.LanguageModelDataPart,mimeType:this.mimeType,data:this.data}}}var op;(function(s){s.PNG="image/png",s.JPEG="image/jpeg",s.GIF="image/gif",s.WEBP="image/webp",s.BMP="image/bmp"})(op||(op={}));class rg{constructor(e){this.value=e}toJSON(){return{$mid:Nn.LanguageModelPromptTsxPart,value:this.value}}}class Nd extends Error{static#e="LanguageModelError";static NotFound(e){return new Nd(e,Nd.NotFound.name)}static NoPermissions(e){return new Nd(e,Nd.NoPermissions.name)}static Blocked(e){return new Nd(e,Nd.Blocked.name)}static tryDeserialize(e){if(e.name===Nd.#e)return new Nd(e.message,e.code,e.cause)}constructor(e,t,i){super(e,{cause:i}),this.name=Nd.#e,this.code=t??""}}let cz=class{constructor(e){this.content=e}toJSON(){return{$mid:Nn.LanguageModelToolResult,content:this.content}}},REe=class{constructor(e){this.content=e}toJSON(){return{$mid:Nn.LanguageModelToolResult,content:this.content}}};class y7e extends cz{}var o8;(function(s){s[s.Auto=1]="Auto",s[s.Required=2]="Required"})(o8||(o8={}));var r8;(function(s){s[s.SymbolInformation=1]="SymbolInformation",s[s.CommandInformation=2]="CommandInformation",s[s.SearchInformation=3]="SearchInformation",s[s.SettingInformation=4]="SettingInformation"})(r8||(r8={}));var a8;(function(s){s[s.EMBEDDED=1]="EMBEDDED",s[s.LLM_RANKED=2]="LLM_RANKED",s[s.CANCELED=3]="CANCELED"})(a8||(a8={}));var c8;(function(s){s[s.Started=1]="Started",s[s.Recognizing=2]="Recognizing",s[s.Recognized=3]="Recognized",s[s.Stopped=4]="Stopped",s[s.Error=5]="Error"})(c8||(c8={}));var d8;(function(s){s[s.Started=1]="Started",s[s.Stopped=2]="Stopped",s[s.Error=3]="Error"})(d8||(d8={}));var l8;(function(s){s[s.Recognized=1]="Recognized",s[s.Stopped=2]="Stopped"})(l8||(l8={}));let w7e=class{constructor(e,t){this.text=e,this.range=t}};var h8;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(h8||(h8={}));class C7e{constructor(e,t,i,n={},o){this.label=e,this.command=t,this.args=i,this.env=n,this.version=o}}class E7e{constructor(e,t,i={},n){this.label=e,this.uri=t,this.headers=i,this.version=n}}class CN{static{this.count=0}constructor(e){this._proxyIdentifierBrand=void 0,this.sid=e,this.nid=++CN.count}}const Voe=[];function le(s){const e=new CN(s);return Voe[e.nid]=e,e}function UD(s){return Voe[s].sid}class Jr{constructor(e){this.value=e}}var nb;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(nb||(nb={}));var Oo;(function(s){s[s.UnknownInput=0]="UnknownInput",s[s.TextInput=1]="TextInput",s[s.TextDiffInput=2]="TextDiffInput",s[s.TextMergeInput=3]="TextMergeInput",s[s.NotebookInput=4]="NotebookInput",s[s.NotebookDiffInput=5]="NotebookDiffInput",s[s.CustomEditorInput=6]="CustomEditorInput",s[s.WebviewEditorInput=7]="WebviewEditorInput",s[s.TerminalEditorInput=8]="TerminalEditorInput",s[s.InteractiveEditorInput=9]="InteractiveEditorInput",s[s.ChatEditorInput=10]="ChatEditorInput",s[s.MultiDiffEditorInput=11]="MultiDiffEditorInput"})(Oo||(Oo={}));var Od;(function(s){s[s.TAB_OPEN=0]="TAB_OPEN",s[s.TAB_CLOSE=1]="TAB_CLOSE",s[s.TAB_UPDATE=2]="TAB_UPDATE",s[s.TAB_MOVE=3]="TAB_MOVE"})(Od||(Od={}));var u8;(function(s){s[s.Editable=0]="Editable",s[s.SupportsHotExit=1]="SupportsHotExit"})(u8||(u8={}));var Jn;(function(s){s[s.Int8Array=1]="Int8Array",s[s.Uint8Array=2]="Uint8Array",s[s.Uint8ClampedArray=3]="Uint8ClampedArray",s[s.Int16Array=4]="Int16Array",s[s.Uint16Array=5]="Uint16Array",s[s.Int32Array=6]="Int32Array",s[s.Uint32Array=7]="Uint32Array",s[s.Float32Array=8]="Float32Array",s[s.Float64Array=9]="Float64Array",s[s.BigInt64Array=10]="BigInt64Array",s[s.BigUint64Array=11]="BigUint64Array"})(Jn||(Jn={}));var g8;(function(s){s[s.Text=1]="Text",s[s.Error=2]="Error",s[s.Rich=3]="Rich"})(g8||(g8={}));var sb;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(sb||(sb={}));var AC;(function(s){s[s.None=0]="None",s[s.Process=1]="Process",s[s.Output=2]="Output",s[s.Hybrid=3]="Hybrid"})(AC||(AC={}));var yo;(function(s){s.label="a",s.kind="b",s.detail="c",s.documentation="d",s.sortText="e",s.filterText="f",s.preselect="g",s.insertText="h",s.insertTextRules="i",s.range="j",s.commitCharacters="k",s.additionalTextEdits="l",s.kindModifier="m",s.commandIdent="n",s.commandId="o",s.commandArguments="p"})(yo||(yo={}));var ob;(function(s){s.defaultRanges="a",s.completions="b",s.isIncomplete="c",s.duration="d"})(ob||(ob={}));var p8;(function(s){s[s.Workspace=0]="Workspace",s[s.TextDocument=1]="TextDocument"})(p8||(p8={}));const $e={MainThreadAuthentication:le("MainThreadAuthentication"),MainThreadBulkEdits:le("MainThreadBulkEdits"),MainThreadLanguageModels:le("MainThreadLanguageModels"),MainThreadEmbeddings:le("MainThreadEmbeddings"),MainThreadChatAgents2:le("MainThreadChatAgents2"),MainThreadCodeMapper:le("MainThreadCodeMapper"),MainThreadLanguageModelTools:le("MainThreadChatSkills"),MainThreadClipboard:le("MainThreadClipboard"),MainThreadCommands:le("MainThreadCommands"),MainThreadComments:le("MainThreadComments"),MainThreadConfiguration:le("MainThreadConfiguration"),MainThreadConsole:le("MainThreadConsole"),MainThreadDebugService:le("MainThreadDebugService"),MainThreadDecorations:le("MainThreadDecorations"),MainThreadDiagnostics:le("MainThreadDiagnostics"),MainThreadDialogs:le("MainThreadDiaglogs"),MainThreadDocuments:le("MainThreadDocuments"),MainThreadDocumentContentProviders:le("MainThreadDocumentContentProviders"),MainThreadTextEditors:le("MainThreadTextEditors"),MainThreadEditorInsets:le("MainThreadEditorInsets"),MainThreadEditorTabs:le("MainThreadEditorTabs"),MainThreadErrors:le("MainThreadErrors"),MainThreadTreeViews:le("MainThreadTreeViews"),MainThreadDownloadService:le("MainThreadDownloadService"),MainThreadLanguageFeatures:le("MainThreadLanguageFeatures"),MainThreadLanguages:le("MainThreadLanguages"),MainThreadLogger:le("MainThreadLogger"),MainThreadMessageService:le("MainThreadMessageService"),MainThreadOutputService:le("MainThreadOutputService"),MainThreadProgress:le("MainThreadProgress"),MainThreadQuickDiff:le("MainThreadQuickDiff"),MainThreadQuickOpen:le("MainThreadQuickOpen"),MainThreadStatusBar:le("MainThreadStatusBar"),MainThreadSecretState:le("MainThreadSecretState"),MainThreadStorage:le("MainThreadStorage"),MainThreadSpeech:le("MainThreadSpeechProvider"),MainThreadTelemetry:le("MainThreadTelemetry"),MainThreadTerminalService:le("MainThreadTerminalService"),MainThreadTerminalShellIntegration:le("MainThreadTerminalShellIntegration"),MainThreadWebviews:le("MainThreadWebviews"),MainThreadWebviewPanels:le("MainThreadWebviewPanels"),MainThreadWebviewViews:le("MainThreadWebviewViews"),MainThreadCustomEditors:le("MainThreadCustomEditors"),MainThreadUrls:le("MainThreadUrls"),MainThreadUriOpeners:le("MainThreadUriOpeners"),MainThreadProfileContentHandlers:le("MainThreadProfileContentHandlers"),MainThreadWorkspace:le("MainThreadWorkspace"),MainThreadFileSystem:le("MainThreadFileSystem"),MainThreadFileSystemEventService:le("MainThreadFileSystemEventService"),MainThreadExtensionService:le("MainThreadExtensionService"),MainThreadSCM:le("MainThreadSCM"),MainThreadSearch:le("MainThreadSearch"),MainThreadShare:le("MainThreadShare"),MainThreadTask:le("MainThreadTask"),MainThreadWindow:le("MainThreadWindow"),MainThreadLabelService:le("MainThreadLabelService"),MainThreadNotebook:le("MainThreadNotebook"),MainThreadNotebookDocuments:le("MainThreadNotebookDocumentsShape"),MainThreadNotebookEditors:le("MainThreadNotebookEditorsShape"),MainThreadNotebookKernels:le("MainThreadNotebookKernels"),MainThreadNotebookRenderers:le("MainThreadNotebookRenderers"),MainThreadInteractive:le("MainThreadInteractive"),MainThreadTheming:le("MainThreadTheming"),MainThreadTunnelService:le("MainThreadTunnelService"),MainThreadManagedSockets:le("MainThreadManagedSockets"),MainThreadTimeline:le("MainThreadTimeline"),MainThreadTesting:le("MainThreadTesting"),MainThreadLocalization:le("MainThreadLocalizationShape"),MainThreadMcp:le("MainThreadMcpShape"),MainThreadAiRelatedInformation:le("MainThreadAiRelatedInformation"),MainThreadAiEmbeddingVector:le("MainThreadAiEmbeddingVector"),MainThreadChatStatus:le("MainThreadChatStatus"),MainThreadAiSettingsSearch:le("MainThreadAiSettingsSearch")},Ye={ExtHostCodeMapper:le("ExtHostCodeMapper"),ExtHostCommands:le("ExtHostCommands"),ExtHostConfiguration:le("ExtHostConfiguration"),ExtHostDiagnostics:le("ExtHostDiagnostics"),ExtHostDebugService:le("ExtHostDebugService"),ExtHostDecorations:le("ExtHostDecorations"),ExtHostDocumentsAndEditors:le("ExtHostDocumentsAndEditors"),ExtHostDocuments:le("ExtHostDocuments"),ExtHostDocumentContentProviders:le("ExtHostDocumentContentProviders"),ExtHostDocumentSaveParticipant:le("ExtHostDocumentSaveParticipant"),ExtHostEditors:le("ExtHostEditors"),ExtHostTreeViews:le("ExtHostTreeViews"),ExtHostFileSystem:le("ExtHostFileSystem"),ExtHostFileSystemInfo:le("ExtHostFileSystemInfo"),ExtHostFileSystemEventService:le("ExtHostFileSystemEventService"),ExtHostLanguages:le("ExtHostLanguages"),ExtHostLanguageFeatures:le("ExtHostLanguageFeatures"),ExtHostQuickOpen:le("ExtHostQuickOpen"),ExtHostQuickDiff:le("ExtHostQuickDiff"),ExtHostStatusBar:le("ExtHostStatusBar"),ExtHostShare:le("ExtHostShare"),ExtHostExtensionService:le("ExtHostExtensionService"),ExtHostLogLevelServiceShape:le("ExtHostLogLevelServiceShape"),ExtHostTerminalService:le("ExtHostTerminalService"),ExtHostTerminalShellIntegration:le("ExtHostTerminalShellIntegration"),ExtHostSCM:le("ExtHostSCM"),ExtHostSearch:le("ExtHostSearch"),ExtHostTask:le("ExtHostTask"),ExtHostWorkspace:le("ExtHostWorkspace"),ExtHostWindow:le("ExtHostWindow"),ExtHostWebviews:le("ExtHostWebviews"),ExtHostWebviewPanels:le("ExtHostWebviewPanels"),ExtHostCustomEditors:le("ExtHostCustomEditors"),ExtHostWebviewViews:le("ExtHostWebviewViews"),ExtHostEditorInsets:le("ExtHostEditorInsets"),ExtHostEditorTabs:le("ExtHostEditorTabs"),ExtHostProgress:le("ExtHostProgress"),ExtHostComments:le("ExtHostComments"),ExtHostSecretState:le("ExtHostSecretState"),ExtHostStorage:le("ExtHostStorage"),ExtHostUrls:le("ExtHostUrls"),ExtHostUriOpeners:le("ExtHostUriOpeners"),ExtHostProfileContentHandlers:le("ExtHostProfileContentHandlers"),ExtHostOutputService:le("ExtHostOutputService"),ExtHostLabelService:le("ExtHostLabelService"),ExtHostNotebook:le("ExtHostNotebook"),ExtHostNotebookDocuments:le("ExtHostNotebookDocuments"),ExtHostNotebookEditors:le("ExtHostNotebookEditors"),ExtHostNotebookKernels:le("ExtHostNotebookKernels"),ExtHostNotebookRenderers:le("ExtHostNotebookRenderers"),ExtHostNotebookDocumentSaveParticipant:le("ExtHostNotebookDocumentSaveParticipant"),ExtHostInteractive:le("ExtHostInteractive"),ExtHostChatAgents2:le("ExtHostChatAgents"),ExtHostLanguageModelTools:le("ExtHostChatSkills"),ExtHostChatProvider:le("ExtHostChatProvider"),ExtHostSpeech:le("ExtHostSpeech"),ExtHostEmbeddings:le("ExtHostEmbeddings"),ExtHostAiRelatedInformation:le("ExtHostAiRelatedInformation"),ExtHostAiEmbeddingVector:le("ExtHostAiEmbeddingVector"),ExtHostAiSettingsSearch:le("ExtHostAiSettingsSearch"),ExtHostTheming:le("ExtHostTheming"),ExtHostTunnelService:le("ExtHostTunnelService"),ExtHostManagedSockets:le("ExtHostManagedSockets"),ExtHostAuthentication:le("ExtHostAuthentication"),ExtHostTimeline:le("ExtHostTimeline"),ExtHostTesting:le("ExtHostTesting"),ExtHostTelemetry:le("ExtHostTelemetry"),ExtHostLocalization:le("ExtHostLocalization"),ExtHostMcp:le("ExtHostMcp")},x7e="workbench.view.debug",f8="workbench.panel.repl.view";new O("debugType",void 0,{type:"string",description:h(6109,"Debug type of the active debug session. For example 'python'.")});new O("debugConfigurationType",void 0,{type:"string",description:h(6110,"Debug type of the selected launch configuration. For example 'python'.")});new O("debugState","inactive",{type:"string",description:h(6111,"State that the focused debug session is in. One of the following: 'inactive', 'initializing', 'stopped' or 'running'.")});const PEe="debugUx";new O(PEe,"default",{type:"string",description:h(6112,"Debug UX state. When there are no debug configurations it is 'simple', otherwise 'default'. Used to decide when to show welcome views in the debug viewlet.")});new O("hasDebugged",!1,{type:"boolean",description:h(6113,"True when a debug session has been started at least once, false otherwise.")});new O("inDebugMode",!1,{type:"boolean",description:h(6114,"True when debugging, false otherwise.")});new O("inDebugRepl",!1,{type:"boolean",description:h(6115,"True when focus is in the debug console, false otherwise.")});new O("breakpointWidgetVisible",!1,{type:"boolean",description:h(6116,"True when breakpoint editor zone widget is visible, false otherwise.")});new O("inBreakpointWidget",!1,{type:"boolean",description:h(6117,"True when focus is in the breakpoint editor zone widget, false otherwise.")});new O("breakpointsFocused",!0,{type:"boolean",description:h(6118,"True when the BREAKPOINTS view is focused, false otherwise.")});new O("watchExpressionsFocused",!0,{type:"boolean",description:h(6119,"True when the WATCH view is focused, false otherwise.")});new O("watchExpressionsExist",!1,{type:"boolean",description:h(6120,"True when at least one watch expression exists, false otherwise.")});new O("variablesFocused",!0,{type:"boolean",description:h(6121,"True when the VARIABLES views is focused, false otherwise")});new O("expressionSelected",!1,{type:"boolean",description:h(6122,"True when an expression input box is open in either the WATCH or the VARIABLES view, false otherwise.")});new O("breakpointInputFocused",!1,{type:"boolean",description:h(6123,"True when the input box has focus in the BREAKPOINTS view.")});new O("callStackItemType",void 0,{type:"string",description:h(6124,"Represents the item type of the focused element in the CALL STACK view. For example: 'session', 'thread', 'stackFrame'")});new O("callStackSessionIsAttach",!1,{type:"boolean",description:h(6125,"True when the session in the CALL STACK view is attach, false otherwise. Used internally for inline menus in the CALL STACK view.")});new O("callStackItemStopped",!1,{type:"boolean",description:h(6126,"True when the focused item in the CALL STACK is stopped. Used internaly for inline menus in the CALL STACK view.")});new O("callStackSessionHasOneThread",!1,{type:"boolean",description:h(6127,"True when the focused session in the CALL STACK view has exactly one thread. Used internally for inline menus in the CALL STACK view.")});new O("callStackFocused",!0,{type:"boolean",description:h(6128,"True when the CALLSTACK view is focused, false otherwise.")});new O("watchItemType",void 0,{type:"string",description:h(6129,"Represents the item type of the focused element in the WATCH view. For example: 'expression', 'variable'")});new O("canViewMemory",void 0,{type:"boolean",description:h(6130,"Indicates whether the item in the view has an associated memory refrence.")});new O("breakpointItemType",void 0,{type:"string",description:h(6131,"Represents the item type of the focused element in the BREAKPOINTS view. For example: 'breakpoint', 'exceptionBreakppint', 'functionBreakpoint', 'dataBreakpoint'")});new O("breakpointItemBytes",void 0,{type:"boolean",description:h(6132,"Whether the breakpoint item is a data breakpoint on a byte range.")});new O("breakpointHasModes",!1,{type:"boolean",description:h(6133,"Whether the breakpoint has multiple modes it can switch to.")});new O("breakpointSupportsCondition",!1,{type:"boolean",description:h(6134,"True when the focused breakpoint supports conditions.")});new O("loadedScriptsSupported",!1,{type:"boolean",description:h(6135,"True when the focused sessions supports the LOADED SCRIPTS view")});new O("loadedScriptsItemType",void 0,{type:"string",description:h(6136,"Represents the item type of the focused element in the LOADED SCRIPTS view.")});new O("focusedSessionIsAttach",!1,{type:"boolean",description:h(6137,"True when the focused session is 'attach'.")});new O("focusedSessionIsNoDebug",!1,{type:"boolean",description:h(6138,"True when the focused session is run without debugging.")});new O("stepBackSupported",!1,{type:"boolean",description:h(6139,"True when the focused session supports 'stepBack' requests.")});new O("restartFrameSupported",!1,{type:"boolean",description:h(6140,"True when the focused session supports 'restartFrame' requests.")});new O("stackFrameSupportsRestart",!1,{type:"boolean",description:h(6141,"True when the focused stack frame supports 'restartFrame'.")});new O("jumpToCursorSupported",!1,{type:"boolean",description:h(6142,"True when the focused session supports 'jumpToCursor' request.")});new O("stepIntoTargetsSupported",!1,{type:"boolean",description:h(6143,"True when the focused session supports 'stepIntoTargets' request.")});new O("breakpointsExist",!1,{type:"boolean",description:h(6144,"True when at least one breakpoint exists.")});new O("debuggersAvailable",!1,{type:"boolean",description:h(6145,"True when there is at least one debug extensions active.")});new O("debugExtensionAvailable",!0,{type:"boolean",description:h(6146,"True when there is at least one debug extension installed and enabled.")});new O("debugProtocolVariableMenuContext",void 0,{type:"string",description:h(6147,"Represents the context the debug adapter sets on the focused variable in the VARIABLES view.")});new O("debugSetVariableSupported",!1,{type:"boolean",description:h(6148,"True when the focused session supports 'setVariable' request.")});new O("debugSetDataBreakpointAddressSupported",!1,{type:"boolean",description:h(6149,"True when the focused session supports 'getBreakpointInfo' request on an address.")});new O("debugSetExpressionSupported",!1,{type:"boolean",description:h(6150,"True when the focused session supports 'setExpression' request.")});new O("breakWhenValueChangesSupported",!1,{type:"boolean",description:h(6151,"True when the focused session supports to break when value changes.")});new O("breakWhenValueIsAccessedSupported",!1,{type:"boolean",description:h(6152,"True when the focused breakpoint supports to break when value is accessed.")});new O("breakWhenValueIsReadSupported",!1,{type:"boolean",description:h(6153,"True when the focused breakpoint supports to break when value is read.")});new O("terminateDebuggeeSupported",!1,{type:"boolean",description:h(6154,"True when the focused session supports the terminate debuggee capability.")});new O("suspendDebuggeeSupported",!1,{type:"boolean",description:h(6155,"True when the focused session supports the suspend debuggee capability.")});new O("variableEvaluateNamePresent",!1,{type:"boolean",description:h(6156,"True when the focused variable has an 'evalauteName' field set.")});new O("variableIsReadonly",!1,{type:"boolean",description:h(6157,"True when the focused variable is read-only.")});new O("variableValue",!1,{type:"string",description:h(6158,"Value of the variable, present for debug visualization clauses.")});new O("variableType",!1,{type:"string",description:h(6159,"Type of the variable, present for debug visualization clauses.")});new O("variableInterfaces",!1,{type:"array",description:h(6160,"Any interfaces or contracts that the variable satisfies, present for debug visualization clauses.")});new O("variableName",!1,{type:"string",description:h(6161,"Name of the variable, present for debug visualization clauses.")});new O("variableLanguage",!1,{type:"string",description:h(6162,"Language of the variable source, present for debug visualization clauses.")});new O("variableExtensionId",!1,{type:"string",description:h(6163,"Extension ID of the variable source, present for debug visualization clauses.")});new O("exceptionWidgetVisible",!1,{type:"boolean",description:h(6164,"True when the exception widget is visible.")});new O("multiSessionRepl",!1,{type:"boolean",description:h(6165,"True when there is more than 1 debug console.")});new O("multiSessionDebug",!1,{type:"boolean",description:h(6166,"True when there is more than 1 active debug session.")});new O("disassembleRequestSupported",!1,{type:"boolean",description:h(6167,"True when the focused sessions supports disassemble request.")});new O("disassemblyViewFocus",!1,{type:"boolean",description:h(6168,"True when the Disassembly View is focused.")});new O("languageSupportsDisassembleRequest",!1,{type:"boolean",description:h(6169,"True when the language in the current editor supports disassemble request.")});new O("focusedStackFrameHasInstructionReference",!1,{type:"boolean",description:h(6170,"True when the focused stack frame has instruction pointer reference.")});h(6172,"Controls when the internal Debug Console should open.");var m8;(function(s){s[s.Inactive=0]="Inactive",s[s.Initializing=1]="Initializing",s[s.Stopped=2]="Stopped",s[s.Running=3]="Running"})(m8||(m8={}));var v8;(function(s){s[s.Valid=0]="Valid",s[s.Unreadable=1]="Unreadable",s[s.Error=2]="Error"})(v8||(v8={}));var xA;(function(s){s[s.Variable=0]="Variable",s[s.Address=1]="Address"})(xA||(xA={}));var _8;(function(s){s[s.Initial=1]="Initial",s[s.Dynamic=2]="Dynamic"})(_8||(_8={}));var b8;(function(s){s.UnverifiedBreakpoints="unverifiedBreakpoints"})(b8||(b8={}));var y8;(function(s){s[s.CONDITION=0]="CONDITION",s[s.HIT_COUNT=1]="HIT_COUNT",s[s.LOG_MESSAGE=2]="LOG_MESSAGE",s[s.TRIGGER_POINT=3]="TRIGGER_POINT"})(y8||(y8={}));var w8;(function(s){s[s.Command=0]="Command",s[s.Tree=1]="Tree"})(w8||(w8={}));var UW;(function(s){s[s.None=0]="None",s[s.Collapsed=1]="Collapsed",s[s.Expanded=2]="Expanded"})(UW||(UW={}));var S8;(function(s){s.deserialize=e=>e,s.serialize=e=>e})(S8||(S8={}));var $W;(function(s){s.deserialize=e=>({id:e.id,name:e.name,iconPath:e.iconPath&&{light:R.revive(e.iconPath.light),dark:R.revive(e.iconPath.dark)},iconClass:e.iconClass,visualization:e.visualization}),s.serialize=e=>e})($W||($W={}));var py;(function(s){s[s.Desktop=1]="Desktop",s[s.Web=2]="Web"})(py||(py={}));var RC;(function(s){s[s.VersionMismatch=55]="VersionMismatch",s[s.UnexpectedError=81]="UnexpectedError"})(RC||(RC={}));var Sa;(function(s){s[s.Initialized=0]="Initialized",s[s.Ready=1]="Ready",s[s.Terminate=2]="Terminate"})(Sa||(Sa={}));function Hoe(s){const e=Re.alloc(1);switch(s){case Sa.Initialized:e.writeUInt8(1,0);break;case Sa.Ready:e.writeUInt8(2,0);break;case Sa.Terminate:e.writeUInt8(3,0);break}return e}function IA(s,e){if(s.byteLength!==1)return!1;switch(s.readUInt8(0)){case 1:return e===Sa.Initialized;case 2:return e===Sa.Ready;case 3:return e===Sa.Terminate;default:return!1}}var C8;(function(s){s.Start="START_NATIVE_LOG",s.End="END_NATIVE_LOG"})(C8||(C8={}));class I7e{constructor(e,t,i){this.uri=e,this.ranges=t,this.previewText=i}}class D7e{constructor(e,t,i){this.uri=e,this.text=t,this.lineNumber=i}}class k7e{constructor(e){this.keyword=e}}var E8;(function(s){s[s.None=1]="None",s[s.FilesExclude=2]="FilesExclude",s[s.SearchAndFilesExclude=3]="SearchAndFilesExclude"})(E8||(E8={}));var x8;(function(s){s[s.Information=1]="Information",s[s.Warning=2]="Warning"})(x8||(x8={}));const Vh=Z("accessibleViewService"),Uoe=Z("extensionHostDebugService"),LEe="diagnosticsService";class MEe{async getPerformanceInfo(e,t){return{}}async getSystemInfo(e,t){return{processArgs:"nullProcessArgs",gpuStatus:"nullGpuStatus",screenReader:"nullScreenReader",remoteData:[],os:"nullOs",memory:"nullMemory",vmHint:"nullVmHint"}}async getDiagnostics(e,t){return""}async getWorkspaceFileExtensions(e){return{extensions:[]}}async reportWorkspaceStats(e){}}const NEe=Z(LEe),OEe=Z("encryptionService"),dz=Z("extensionGalleryService"),yI=Z("extensionManagementService"),$oe=Z("IGlobalExtensionEnablementService"),FEe=Z("IExtensionTipsService"),WEe=Z("IAllowedExtensionsService"),lz=Z("IExtensionStorageService"),EN=Z("IExtensionsProfileScannerService"),BEe=Z("IExtensionsScannerService"),VEe=Z("IExtensionRecommendationNotificationService"),hz=Z("extensionResourceLoaderService"),HEe=Z("IBuiltinExtensionsScannerService"),UEe=Z("keyboardLayoutService"),Goe=Z("languagePackService"),Hh=Z("remoteAuthorityResolverService"),xN=Z("IRemoteExtensionsScannerService"),uz=Z("remoteSocketFactoryService"),IN=Z("secretStorageService"),$Ee="signService",qoe=Z($Ee);var I8;(function(s){s.AutomationProfile="terminal.integrated.automationProfile.",s.DefaultProfile="terminal.integrated.defaultProfile.",s.Profiles="terminal.integrated.profiles."})(I8||(I8={}));var qc;(function(s){s.SendKeybindingsToShell="terminal.integrated.sendKeybindingsToShell",s.AutomationProfileLinux="terminal.integrated.automationProfile.linux",s.AutomationProfileMacOs="terminal.integrated.automationProfile.osx",s.AutomationProfileWindows="terminal.integrated.automationProfile.windows",s.ProfilesWindows="terminal.integrated.profiles.windows",s.ProfilesMacOs="terminal.integrated.profiles.osx",s.ProfilesLinux="terminal.integrated.profiles.linux",s.DefaultProfileLinux="terminal.integrated.defaultProfile.linux",s.DefaultProfileMacOs="terminal.integrated.defaultProfile.osx",s.DefaultProfileWindows="terminal.integrated.defaultProfile.windows",s.UseWslProfiles="terminal.integrated.useWslProfiles",s.TabsDefaultColor="terminal.integrated.tabs.defaultColor",s.TabsDefaultIcon="terminal.integrated.tabs.defaultIcon",s.TabsEnabled="terminal.integrated.tabs.enabled",s.TabsEnableAnimation="terminal.integrated.tabs.enableAnimation",s.TabsHideCondition="terminal.integrated.tabs.hideCondition",s.TabsShowActiveTerminal="terminal.integrated.tabs.showActiveTerminal",s.TabsShowActions="terminal.integrated.tabs.showActions",s.TabsLocation="terminal.integrated.tabs.location",s.TabsFocusMode="terminal.integrated.tabs.focusMode",s.MacOptionIsMeta="terminal.integrated.macOptionIsMeta",s.MacOptionClickForcesSelection="terminal.integrated.macOptionClickForcesSelection",s.AltClickMovesCursor="terminal.integrated.altClickMovesCursor",s.CopyOnSelection="terminal.integrated.copyOnSelection",s.EnableMultiLinePasteWarning="terminal.integrated.enableMultiLinePasteWarning",s.DrawBoldTextInBrightColors="terminal.integrated.drawBoldTextInBrightColors",s.FontFamily="terminal.integrated.fontFamily",s.FontSize="terminal.integrated.fontSize",s.LetterSpacing="terminal.integrated.letterSpacing",s.LineHeight="terminal.integrated.lineHeight",s.MinimumContrastRatio="terminal.integrated.minimumContrastRatio",s.TabStopWidth="terminal.integrated.tabStopWidth",s.FastScrollSensitivity="terminal.integrated.fastScrollSensitivity",s.MouseWheelScrollSensitivity="terminal.integrated.mouseWheelScrollSensitivity",s.BellDuration="terminal.integrated.bellDuration",s.FontWeight="terminal.integrated.fontWeight",s.FontWeightBold="terminal.integrated.fontWeightBold",s.CursorBlinking="terminal.integrated.cursorBlinking",s.CursorStyle="terminal.integrated.cursorStyle",s.CursorStyleInactive="terminal.integrated.cursorStyleInactive",s.CursorWidth="terminal.integrated.cursorWidth",s.Scrollback="terminal.integrated.scrollback",s.DetectLocale="terminal.integrated.detectLocale",s.DefaultLocation="terminal.integrated.defaultLocation",s.GpuAcceleration="terminal.integrated.gpuAcceleration",s.TerminalTitleSeparator="terminal.integrated.tabs.separator",s.TerminalTitle="terminal.integrated.tabs.title",s.TerminalDescription="terminal.integrated.tabs.description",s.RightClickBehavior="terminal.integrated.rightClickBehavior",s.MiddleClickBehavior="terminal.integrated.middleClickBehavior",s.Cwd="terminal.integrated.cwd",s.ConfirmOnExit="terminal.integrated.confirmOnExit",s.ConfirmOnKill="terminal.integrated.confirmOnKill",s.EnableBell="terminal.integrated.enableBell",s.EnableVisualBell="terminal.integrated.enableVisualBell",s.CommandsToSkipShell="terminal.integrated.commandsToSkipShell",s.AllowChords="terminal.integrated.allowChords",s.AllowMnemonics="terminal.integrated.allowMnemonics",s.TabFocusMode="terminal.integrated.tabFocusMode",s.EnvMacOs="terminal.integrated.env.osx",s.EnvLinux="terminal.integrated.env.linux",s.EnvWindows="terminal.integrated.env.windows",s.EnvironmentChangesIndicator="terminal.integrated.environmentChangesIndicator",s.EnvironmentChangesRelaunch="terminal.integrated.environmentChangesRelaunch",s.ShowExitAlert="terminal.integrated.showExitAlert",s.SplitCwd="terminal.integrated.splitCwd",s.WindowsEnableConpty="terminal.integrated.windowsEnableConpty",s.WindowsUseConptyDll="terminal.integrated.windowsUseConptyDll",s.WordSeparators="terminal.integrated.wordSeparators",s.EnableFileLinks="terminal.integrated.enableFileLinks",s.AllowedLinkSchemes="terminal.integrated.allowedLinkSchemes",s.UnicodeVersion="terminal.integrated.unicodeVersion",s.EnablePersistentSessions="terminal.integrated.enablePersistentSessions",s.PersistentSessionReviveProcess="terminal.integrated.persistentSessionReviveProcess",s.HideOnStartup="terminal.integrated.hideOnStartup",s.HideOnLastClosed="terminal.integrated.hideOnLastClosed",s.CustomGlyphs="terminal.integrated.customGlyphs",s.RescaleOverlappingGlyphs="terminal.integrated.rescaleOverlappingGlyphs",s.PersistentSessionScrollback="terminal.integrated.persistentSessionScrollback",s.InheritEnv="terminal.integrated.inheritEnv",s.ShowLinkHover="terminal.integrated.showLinkHover",s.IgnoreProcessNames="terminal.integrated.ignoreProcessNames",s.ShellIntegrationEnabled="terminal.integrated.shellIntegration.enabled",s.ShellIntegrationShowWelcome="terminal.integrated.shellIntegration.showWelcome",s.ShellIntegrationDecorationsEnabled="terminal.integrated.shellIntegration.decorationsEnabled",s.ShellIntegrationEnvironmentReporting="terminal.integrated.shellIntegration.environmentReporting",s.EnableImages="terminal.integrated.enableImages",s.SmoothScrolling="terminal.integrated.smoothScrolling",s.IgnoreBracketedPasteMode="terminal.integrated.ignoreBracketedPasteMode",s.FocusAfterRun="terminal.integrated.focusAfterRun",s.FontLigaturesEnabled="terminal.integrated.fontLigatures.enabled",s.FontLigaturesFeatureSettings="terminal.integrated.fontLigatures.featureSettings",s.FontLigaturesFallbackLigatures="terminal.integrated.fontLigatures.fallbackLigatures",s.DeveloperPtyHostLatency="terminal.integrated.developer.ptyHost.latency",s.DeveloperPtyHostStartupDelay="terminal.integrated.developer.ptyHost.startupDelay",s.DevMode="terminal.integrated.developer.devMode"})(qc||(qc={}));var D8;(function(s){s.Bash="bash",s.Fish="fish",s.Sh="sh",s.Csh="csh",s.Ksh="ksh",s.Zsh="zsh"})(D8||(D8={}));var k8;(function(s){s.CommandPrompt="cmd",s.Wsl="wsl",s.GitBash="gitbash"})(k8||(k8={}));var T8;(function(s){s.PowerShell="pwsh",s.Python="python",s.Julia="julia",s.NuShell="nu",s.Node="node"})(T8||(T8={}));var A8;(function(s){s[s.Api=0]="Api",s[s.Process=1]="Process",s[s.Sequence=2]="Sequence",s[s.Config=3]="Config"})(A8||(A8={}));var R8;(function(s){s.LocalPty="localPty",s.PtyHost="ptyHost",s.PtyHostWindow="ptyHostWindow",s.Logger="logger",s.Heartbeat="heartbeat"})(R8||(R8={}));var Hd;(function(s){s.Cwd="cwd",s.InitialCwd="initialCwd",s.FixedDimensions="fixedDimensions",s.Title="title",s.ShellType="shellType",s.HasChildProcesses="hasChildProcesses",s.ResolvedShellLaunchConfig="resolvedShellLaunchConfig",s.OverrideDimensions="overrideDimensions",s.FailedShellIntegrationActivation="failedShellIntegrationActivation",s.UsedShellIntegrationInjection="usedShellIntegrationInjection",s.ShellIntegrationInjectionFailureReason="shellIntegrationInjectionFailureReason"})(Hd||(Hd={}));var P8;(function(s){s[s.BeatInterval=5e3]="BeatInterval",s[s.ConnectingBeatInterval=2e4]="ConnectingBeatInterval",s[s.FirstWaitMultiplier=1.2]="FirstWaitMultiplier",s[s.SecondWaitMultiplier=1]="SecondWaitMultiplier",s[s.CreateProcessTimeout=5e3]="CreateProcessTimeout"})(P8||(P8={}));var fy;(function(s){s[s.Panel=1]="Panel",s[s.Editor=2]="Editor"})(fy||(fy={}));var L8;(function(s){s.TerminalView="view",s.Editor="editor"})(L8||(L8={}));var M8;(function(s){s[s.GraceTime=6e4]="GraceTime",s[s.ShortGraceTime=6e3]="ShortGraceTime"})(M8||(M8={}));var N8;(function(s){s[s.HighWatermarkChars=1e5]="HighWatermarkChars",s[s.LowWatermarkChars=5e3]="LowWatermarkChars",s[s.CharCountAckSize=5e3]="CharCountAckSize"})(N8||(N8={}));var O8;(function(s){s.GitBash="Git Bash",s.Pwsh="PowerShell"})(O8||(O8={}));var F8;(function(s){s[s.Off=0]="Off",s[s.FinalTerm=1]="FinalTerm",s[s.VSCode=2]="VSCode"})(F8||(F8={}));var W8;(function(s){s.InjectionSettingDisabled="injectionSettingDisabled",s.NoExecutable="noExecutable",s.FeatureTerminal="featureTerminal",s.IgnoreShellIntegrationFlag="ignoreShellIntegrationFlag",s.Winpty="winpty",s.UnsupportedArgs="unsupportedArgs",s.UnsupportedShell="unsupportedShell",s.FailedToSetStickyBit="failedToSetStickyBit",s.FailedToCreateTmpDir="failedToCreateTmpDir"})(W8||(W8={}));var Im;(function(s){s[s.Unknown=0]="Unknown",s[s.Shutdown=1]="Shutdown",s[s.Process=2]="Process",s[s.User=3]="User",s[s.Extension=4]="Extension"})(Im||(Im={}));const GEe={Backend:"workbench.contributions.terminal.processBackend"};function GW(s){return s?.toLowerCase()??""}class qEe{constructor(e){this.remoteAuthority=e}affects(e){return GW(e)===this.remoteAuthority}}class zEe{constructor(){this._backends=new Map,this._onDidChangeBackends=new M,this.onDidChangeBackends=this._onDidChangeBackends.event}get backends(){return this._backends}registerTerminalBackend(e){const t=GW(e.remoteAuthority);if(this._backends.has(t))throw new Error(`A terminal backend with remote authority '${t}' was already registered.`);this._backends.set(t,e),this._onDidChangeBackends.fire(new qEe(t))}getTerminalBackend(e){return this._backends.get(GW(e))}}Ge.add(GEe.Backend,new zEe);const KEe=Z("terminalLogService"),DN=Z("tunnelService");var qd;(function(s){s.Uninitialized="uninitialized",s.Idle="idle",s.Disabled="disabled",s.CheckingForUpdates="checking for updates",s.AvailableForDownload="available for download",s.Downloading="downloading",s.Downloaded="downloaded",s.Updating="updating",s.Ready="ready"})(qd||(qd={}));var B8;(function(s){s[s.Setup=0]="Setup",s[s.Archive=1]="Archive",s[s.Snap=2]="Snap"})(B8||(B8={}));var V8;(function(s){s[s.NotBuilt=0]="NotBuilt",s[s.DisabledByEnvironment=1]="DisabledByEnvironment",s[s.ManuallyDisabled=2]="ManuallyDisabled",s[s.MissingConfiguration=3]="MissingConfiguration",s[s.InvalidConfiguration=4]="InvalidConfiguration",s[s.RunningAsAdmin=5]="RunningAsAdmin"})(V8||(V8={}));const jEe={Uninitialized:mF({type:qd.Uninitialized}),Downloading:mF({type:qd.Downloading})},zoe=Z("updateService");var H8;let g0=class{constructor(e,t,i){this.level=e,this.key=t,this.value=i,this.forward=[]}};const yS=void 0;class Yf{constructor(e,t=2**16){this.comparator=e,this[H8]="SkipList",this._level=0,this._size=0,this._maxLevel=Math.max(1,Math.log2(t)|0),this._header=new g0(this._maxLevel,yS,yS)}get size(){return this._size}clear(){this._header=new g0(this._maxLevel,yS,yS),this._size=0}has(e){return!!Yf._search(this,e,this.comparator)}get(e){return Yf._search(this,e,this.comparator)?.value}set(e,t){return Yf._insert(this,e,t,this.comparator)&&(this._size+=1),this}delete(e){const t=Yf._delete(this,e,this.comparator);return t&&(this._size-=1),t}forEach(e,t){let i=this._header.forward[0];for(;i;)e.call(t,i.value,i.key,this),i=i.forward[0]}[(H8=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}*entries(){let e=this._header.forward[0];for(;e;)yield[e.key,e.value],e=e.forward[0]}*keys(){let e=this._header.forward[0];for(;e;)yield e.key,e=e.forward[0]}*values(){let e=this._header.forward[0];for(;e;)yield e.value,e=e.forward[0]}toString(){let e="[SkipList]:",t=this._header.forward[0];for(;t;)e+=`node(${t.key}, ${t.value}, lvl:${t.level})`,t=t.forward[0];return e}static _search(e,t,i){let n=e._header;for(let o=e._level-1;o>=0;o--)for(;n.forward[o]&&i(n.forward[o].key,t)<0;)n=n.forward[o];if(n=n.forward[0],n&&i(n.key,t)===0)return n}static _insert(e,t,i,n){const o=[];let r=e._header;for(let a=e._level-1;a>=0;a--){for(;r.forward[a]&&n(r.forward[a].key,t)<0;)r=r.forward[a];o[a]=r}if(r=r.forward[0],r&&n(r.key,t)===0)return r.value=i,!1;{const a=Yf._randomLevel(e);if(a>e._level){for(let c=e._level;c<a;c++)o[c]=e._header;e._level=a}r=new g0(a,t,i);for(let c=0;c<a;c++)r.forward[c]=o[c].forward[c],o[c].forward[c]=r;return!0}}static _randomLevel(e,t=.5){let i=1;for(;Math.random()<t&&i<e._maxLevel;)i+=1;return i}static _delete(e,t,i){const n=[];let o=e._header;for(let r=e._level-1;r>=0;r--){for(;o.forward[r]&&i(o.forward[r].key,t)<0;)o=o.forward[r];n[r]=o}if(o=o.forward[0],!o||i(o.key,t)!==0)return!1;for(let r=0;r<e._level&&n[r].forward[r]===o;r++)n[r].forward[r]=o.forward[r];for(;e._level>0&&e._header.forward[e._level-1]===yS;)e._level-=1;return!0}}class WE{static{this._clock=0}constructor(e){this.uri=e,this.time=WE._clock++}touch(){return this.time=WE._clock++,this}}let qW=class{constructor(e){this._fileService=e,this._dispooables=new U,this._limit=2**16;const t=new Map,i=n=>{let o=t.get(n.scheme);return o===void 0&&(o=e.hasProvider(n)&&!this._fileService.hasCapability(n,ph.PathCaseSensitive),t.set(n.scheme,o)),o};this._dispooables.add(D.any(e.onDidChangeFileSystemProviderRegistrations,e.onDidChangeFileSystemProviderCapabilities)(n=>{t.delete(n.scheme)})),this.extUri=new jfe(i),this._canonicalUris=new Yf((n,o)=>this.extUri.compare(n,o,!0),this._limit)}dispose(){this._dispooables.dispose(),this._canonicalUris.clear()}asCanonicalUri(e){this._fileService.hasProvider(e)&&(e=Yfe(e));const t=this._canonicalUris.get(e);return t?t.touch().uri.with({fragment:e.fragment}):(this._canonicalUris.set(e,new WE(e)),this._checkTrim(),e)}_checkTrim(){if(this._canonicalUris.size<this._limit)return;const e=[...this._canonicalUris.entries()].sort((i,n)=>i[1].time<n[1].time?1:i[1].time>n[1].time?-1:0);WE._clock=0,this._canonicalUris.clear();const t=this._limit*.5;for(let i=0;i<t;i++)this._canonicalUris.set(e[i][0],e[i][1].touch())}};qW=f([p(0,Xe)],qW);const YEe=Z("IUserDataProfileStorageService"),QEe=Z("IIgnoredExtensionsManagementService");var Gl;(function(s){s.Settings="settings",s.Keybindings="keybindings",s.Snippets="snippets",s.Prompts="prompts",s.Tasks="tasks",s.Extensions="extensions",s.GlobalState="globalState",s.Profiles="profiles",s.WorkspaceState="workspaceState"})(Gl||(Gl={}));Gl.Settings,Gl.Keybindings,Gl.Snippets,Gl.Prompts,Gl.Tasks,Gl.Extensions,Gl.GlobalState,Gl.Profiles;var zW;(function(s){s.Unauthorized="Unauthorized",s.Forbidden="Forbidden",s.NotFound="NotFound",s.MethodNotFound="MethodNotFound",s.Conflict="Conflict",s.Gone="Gone",s.PreconditionFailed="PreconditionFailed",s.TooLarge="TooLarge",s.UpgradeRequired="UpgradeRequired",s.PreconditionRequired="PreconditionRequired",s.TooManyRequests="RemoteTooManyRequests",s.TooManyRequestsAndRetryAfter="TooManyRequestsAndRetryAfter",s.RequestFailed="RequestFailed",s.RequestCanceled="RequestCanceled",s.RequestTimeout="RequestTimeout",s.RequestProtocolNotSupported="RequestProtocolNotSupported",s.RequestPathNotEscaped="RequestPathNotEscaped",s.RequestHeadersNotObject="RequestHeadersNotObject",s.NoCollection="NoCollection",s.NoRef="NoRef",s.EmptyResponse="EmptyResponse",s.TurnedOff="TurnedOff",s.SessionExpired="SessionExpired",s.ServiceChanged="ServiceChanged",s.DefaultServiceChanged="DefaultServiceChanged",s.LocalTooManyProfiles="LocalTooManyProfiles",s.LocalTooManyRequests="LocalTooManyRequests",s.LocalPreconditionFailed="LocalPreconditionFailed",s.LocalInvalidContent="LocalInvalidContent",s.LocalError="LocalError",s.IncompatibleLocalContent="IncompatibleLocalContent",s.IncompatibleRemoteContent="IncompatibleRemoteContent",s.Unknown="Unknown"})(zW||(zW={}));class U8 extends Error{constructor(e,t,i,n){super(e),this.code=t,this.resource=i,this.operationId=n,this.name=`${this.code} (UserDataSyncError) syncResource:${this.resource||"unknown"} operationId:${this.operationId||"unknown"}`}}(function(s){function e(t){if(t instanceof s)return t;const i=/^(.+) \(UserDataSyncError\) syncResource:(.+) operationId:(.+)$/.exec(t.name);if(i&&i[1]){const n=i[2]==="unknown"?void 0:i[2],o=i[3]==="unknown"?void 0:i[3];return new s(t.message,i[1],n,o)}return new s(t.message,zW.Unknown)}s.toUserDataSyncError=e})(U8||(U8={}));var BE;(function(s){s.Uninitialized="uninitialized",s.Idle="idle",s.Syncing="syncing",s.HasConflicts="hasConflicts"})(BE||(BE={}));var $8;(function(s){s[s.None=0]="None",s[s.Added=1]="Added",s[s.Modified=2]="Modified",s[s.Deleted=3]="Deleted"})($8||($8={}));var G8;(function(s){s.Preview="preview",s.Conflict="conflict",s.Accepted="accepted"})(G8||(G8={}));const XEe=Z("IUserDataSyncStoreManagementService"),ZEe=Z("IUserDataSyncStoreService"),JEe=Z("IUserDataSyncLocalStoreService"),exe=Z("IUserDataSyncEnablementService"),txe=Z("IUserDataSyncService"),ixe=Z("IUserDataSyncResourceProviderService"),nxe=Z("IUserDataAutoSyncService"),sxe=Z("IUserDataSyncUtilService"),oxe=Z("IUserDataSyncLogService"),rxe=Z("IUserDataSyncAccountService"),axe=Z("IUserDataSyncMachinesService"),gz=Z("editSessionIdentityService");var q8;(function(s){s[s.Local=0]="Local",s[s.Remote=1]="Remote"})(q8||(q8={}));var Ud;(function(s){s[s.Open=1]="Open",s[s.OpenInNewWindow=2]="OpenInNewWindow",s[s.Cancel=3]="Cancel"})(Ud||(Ud={}));var iv;(function(s){s[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT"})(iv||(iv={}));function cxe(s){const e=s;return typeof e?.location?.id=="string"&&typeof e.alignment=="number"}function R7e(s){const e=s;return(typeof e?.primary=="number"||cxe(e?.primary))&&typeof e?.secondary=="number"}const P7e={id:"statusBar.entry.showTooltip",title:""},L7e=["standard","warning","error","prominent","remote","offline"];function M7e(s){const e=s;return!!e?.content&&Array.isArray(e?.commands)}const kN=Z("statusbarService");function dxe(s){switch(s.type){case yk.LIGHT:return be.fromHex("#F3F3F3");case yk.HIGH_CONTRAST_LIGHT:return be.fromHex("#FFFFFF");case yk.HIGH_CONTRAST_DARK:return be.fromHex("#000000");default:return be.fromHex("#252526")}}const pz=H("tab.activeBackground",ts,h(3884,"Active tab background color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),lxe=H("tab.unfocusedActiveBackground",pz,h(3885,"Active tab background color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),Koe=H("tab.inactiveBackground",{dark:"#2D2D2D",light:"#ECECEC",hcDark:null,hcLight:null},h(3886,"Inactive tab background color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),hxe=H("tab.unfocusedInactiveBackground",Koe,h(3887,"Inactive tab background color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),Kp=H("tab.activeForeground",{dark:be.white,light:"#333333",hcDark:be.white,hcLight:"#292929"},h(3888,"Active tab foreground color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),z8=H("tab.inactiveForeground",{dark:Je(Kp,.5),light:Je(Kp,.7),hcDark:be.white,hcLight:"#292929"},h(3889,"Inactive tab foreground color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),uxe=H("tab.unfocusedActiveForeground",{dark:Je(Kp,.5),light:Je(Kp,.7),hcDark:be.white,hcLight:"#292929"},h(3890,"Active tab foreground color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.unfocusedInactiveForeground",{dark:Je(z8,.5),light:Je(z8,.5),hcDark:be.white,hcLight:"#292929"},h(3891,"Inactive tab foreground color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));const KW=H("tab.hoverBackground",null,h(3892,"Tab background color when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),gxe=H("tab.unfocusedHoverBackground",{dark:Je(KW,.5),light:Je(KW,.7),hcDark:null,hcLight:null},h(3893,"Tab background color in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),jW=H("tab.hoverForeground",null,h(3894,"Tab foreground color when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),pxe=H("tab.unfocusedHoverForeground",{dark:Je(jW,.5),light:Je(jW,.5),hcDark:null,hcLight:null},h(3895,"Tab foreground color in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),YW=H("tab.border",{dark:"#252526",light:"#F3F3F3",hcDark:et,hcLight:et},h(3896,"Border to separate tabs from each other. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),fxe=H("tab.lastPinnedBorder",{dark:g7,light:g7,hcDark:et,hcLight:et},h(3897,"Border to separate pinned tabs from other tabs. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),DA=H("tab.activeBorder",null,h(3898,"Border on the bottom of an active tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),mxe=H("tab.unfocusedActiveBorder",{dark:Je(DA,.5),light:Je(DA,.7),hcDark:null,hcLight:null},h(3899,"Border on the bottom of an active tab in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),kA=H("tab.activeBorderTop",{dark:null,light:null,hcDark:null,hcLight:"#B5200D"},h(3900,"Border to the top of an active tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),vxe=H("tab.unfocusedActiveBorderTop",{dark:Je(kA,.5),light:Je(kA,.7),hcDark:null,hcLight:"#B5200D"},h(3901,"Border to the top of an active tab in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),_xe=H("tab.selectedBorderTop",kA,h(3902,"Border to the top of a selected tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.selectedBackground",pz,h(3903,"Background of a selected tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.selectedForeground",Kp,h(3904,"Foreground of a selected tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));const QW=H("tab.hoverBorder",null,h(3905,"Border to highlight tabs when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),bxe=H("tab.unfocusedHoverBorder",{dark:Je(QW,.5),light:Je(QW,.7),hcDark:null,hcLight:et},h(3906,"Border to highlight tabs in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.dragAndDropBorder",{dark:Kp,light:Kp,hcDark:Sr,hcLight:Sr},h(3907,"Border between tabs to indicate that a tab can be inserted between two tabs. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));const VE=H("tab.activeModifiedBorder",{dark:"#3399CC",light:"#33AAEE",hcDark:null,hcLight:et},h(3908,"Border on the top of modified active tabs in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),XW=H("tab.inactiveModifiedBorder",{dark:Je(VE,.5),light:Je(VE,.5),hcDark:be.white,hcLight:et},h(3909,"Border on the top of modified inactive tabs in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),yxe=H("tab.unfocusedActiveModifiedBorder",{dark:Je(VE,.5),light:Je(VE,.7),hcDark:be.white,hcLight:et},h(3910,"Border on the top of modified active tabs in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),wxe=H("tab.unfocusedInactiveModifiedBorder",{dark:Je(XW,.5),light:Je(XW,.5),hcDark:be.white,hcLight:et},h(3911,"Border on the top of modified inactive tabs in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),N7e=H("editorPane.background",ts,h(3912,"Background color of the editor pane visible on the left and right side of the centered editor layout.")),Sxe=H("editorGroup.emptyBackground",null,h(3913,"Background color of an empty editor group. Editor groups are the containers of editors."));H("editorGroup.focusedEmptyBorder",{dark:null,light:null,hcDark:kT,hcLight:kT},h(3914,"Border color of an empty editor group that is focused. Editor groups are the containers of editors."));const joe=H("editorGroupHeader.tabsBackground",{dark:"#252526",light:"#F3F3F3",hcDark:null,hcLight:null},h(3915,"Background color of the editor group title header when tabs are enabled. Editor groups are the containers of editors.")),Cxe=H("editorGroupHeader.tabsBorder",null,h(3916,"Border color of the editor group title header when tabs are enabled. Editor groups are the containers of editors.")),Exe=H("editorGroupHeader.noTabsBackground",ts,h(3917,'Background color of the editor group title header when (`"workbench.editor.showTabs": "single"`). Editor groups are the containers of editors.')),xxe=H("editorGroupHeader.border",{dark:null,light:null,hcDark:et,hcLight:et},h(3918,"Border color of the editor group title header. Editor groups are the containers of editors.")),Yoe=H("editorGroup.border",{dark:"#444444",light:"#E7E7E7",hcDark:et,hcLight:et},h(3919,"Color to separate multiple editor groups from each other. Editor groups are the containers of editors.")),TN=H("editorGroup.dropBackground",{dark:be.fromHex("#53595D").transparent(.5),light:be.fromHex("#2677CB").transparent(.18),hcDark:null,hcLight:be.fromHex("#0F4A85").transparent(.5)},h(3920,"Background color when dragging editors around. The color should have transparency so that the editor contents can still shine through.")),O7e=H("editorGroup.dropIntoPromptForeground",Eie,h(3921,"Foreground color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),F7e=H("editorGroup.dropIntoPromptBackground",LM,h(3922,"Background color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),W7e=H("editorGroup.dropIntoPromptBorder",{dark:null,light:null,hcDark:et,hcLight:et},h(3923,"Border color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),Ixe=H("sideBySideEditor.horizontalBorder",Yoe,h(3924,"Color to separate two editors from each other when shown side by side in an editor group from top to bottom.")),Dxe=H("sideBySideEditor.verticalBorder",Yoe,h(3925,"Color to separate two editors from each other when shown side by side in an editor group from left to right.")),kxe=H("outputView.background",null,h(3926,"Output view background color."));H("outputViewStickyScroll.background",kxe,h(3927,"Output view sticky scroll background color."));H("banner.background",{dark:RD,light:vr(RD,.3),hcDark:RD,hcLight:RD},h(3928,"Banner background color. The banner is shown under the title bar of the window."));H("banner.foreground",Qfe,h(3929,"Banner foreground color. The banner is shown under the title bar of the window."));H("banner.iconForeground",mE,h(3930,"Banner icon color. The banner is shown under the title bar of the window."));const Sp=H("statusBar.foreground",{dark:"#FFFFFF",light:"#FFFFFF",hcDark:"#FFFFFF",hcLight:ao},h(3931,"Status bar foreground color when a workspace or folder is opened. The status bar is shown in the bottom of the window.")),B7e=H("statusBar.noFolderForeground",Sp,h(3932,"Status bar foreground color when no folder is opened. The status bar is shown in the bottom of the window.")),V7e=H("statusBar.background",{dark:"#007ACC",light:"#007ACC",hcDark:null,hcLight:null},h(3933,"Status bar background color when a workspace or folder is opened. The status bar is shown in the bottom of the window.")),H7e=H("statusBar.noFolderBackground",{dark:"#68217A",light:"#68217A",hcDark:null,hcLight:null},h(3934,"Status bar background color when no folder is opened. The status bar is shown in the bottom of the window.")),Txe=H("statusBar.border",{dark:null,light:null,hcDark:et,hcLight:et},h(3935,"Status bar border color separating to the sidebar and editor. The status bar is shown in the bottom of the window.")),U7e=H("statusBar.focusBorder",{dark:Sp,light:Sp,hcDark:null,hcLight:Sp},h(3936,"Status bar border color when focused on keyboard navigation. The status bar is shown in the bottom of the window.")),$7e=H("statusBar.noFolderBorder",Txe,h(3937,"Status bar border color separating to the sidebar and editor when no folder is opened. The status bar is shown in the bottom of the window."));H("statusBarItem.activeBackground",{dark:be.white.transparent(.18),light:be.white.transparent(.18),hcDark:be.white.transparent(.18),hcLight:be.black.transparent(.18)},h(3938,"Status bar item background color when clicking. The status bar is shown in the bottom of the window."));const G7e=H("statusBarItem.focusBorder",{dark:Sp,light:Sp,hcDark:null,hcLight:Sr},h(3939,"Status bar item border color when focused on keyboard navigation. The status bar is shown in the bottom of the window.")),Mu=H("statusBarItem.hoverBackground",{dark:be.white.transparent(.12),light:be.white.transparent(.12),hcDark:be.white.transparent(.12),hcLight:be.black.transparent(.12)},h(3940,"Status bar item background color when hovering. The status bar is shown in the bottom of the window.")),wI=H("statusBarItem.hoverForeground",Sp,h(3941,"Status bar item foreground color when hovering. The status bar is shown in the bottom of the window.")),q7e=H("statusBarItem.compactHoverBackground",{dark:be.white.transparent(.2),light:be.white.transparent(.2),hcDark:be.white.transparent(.2),hcLight:be.black.transparent(.2)},h(3942,"Status bar item background color when hovering an item that contains two hovers. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentForeground",Sp,h(3943,"Status bar prominent items foreground color. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentBackground",be.black.transparent(.5),h(3944,"Status bar prominent items background color. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentHoverForeground",wI,h(3945,"Status bar prominent items foreground color when hovering. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentHoverBackground",Mu,h(3946,"Status bar prominent items background color when hovering. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));const K8=H("statusBarItem.errorBackground",{dark:vr(p7,.4),light:vr(p7,.4),hcDark:null,hcLight:"#B5200D"},h(3947,"Status bar error items background color. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.errorForeground",be.white,h(3948,"Status bar error items foreground color. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.errorHoverForeground",wI,h(3949,"Status bar error items foreground color when hovering. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.errorHoverBackground",Mu,h(3950,"Status bar error items background color when hovering. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));const Axe=H("statusBarItem.warningBackground",{dark:vr(TT,.4),light:vr(TT,.4),hcDark:null,hcLight:"#895503"},h(3951,"Status bar warning items background color. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.warningForeground",be.white,h(3952,"Status bar warning items foreground color. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.warningHoverForeground",wI,h(3953,"Status bar warning items foreground color when hovering. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.warningHoverBackground",Mu,h(3954,"Status bar warning items background color when hovering. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));const Rxe=H("activityBar.background",{dark:"#333333",light:"#2C2C2C",hcDark:"#000000",hcLight:"#FFFFFF"},h(3955,"Activity bar background color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),nv=H("activityBar.foreground",{dark:be.white,light:be.white,hcDark:be.white,hcLight:ao},h(3956,"Activity bar item foreground color when it is active. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Pxe=H("activityBar.inactiveForeground",{dark:Je(nv,.4),light:Je(nv,.4),hcDark:be.white,hcLight:ao},h(3957,"Activity bar item foreground color when it is inactive. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Lxe=H("activityBar.border",{dark:null,light:null,hcDark:et,hcLight:et},h(3958,"Activity bar border color separating to the side bar. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Qoe=H("activityBar.activeBorder",{dark:nv,light:nv,hcDark:et,hcLight:et},h(3959,"Activity bar border color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Mxe=H("activityBar.activeFocusBorder",{dark:null,light:null,hcDark:null,hcLight:"#B5200D"},h(3960,"Activity bar focus border color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Xoe=H("activityBar.activeBackground",null,h(3961,"Activity bar background color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Nxe=H("activityBar.dropBorder",{dark:nv,light:nv,hcDark:null,hcLight:null},h(3962,"Drag and drop feedback color for the activity bar items. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),ww=H("activityBarBadge.background",{dark:"#007ACC",light:"#007ACC",hcDark:"#000000",hcLight:"#0F4A85"},h(3963,"Activity notification badge background color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Sw=H("activityBarBadge.foreground",be.white,h(3964,"Activity notification badge foreground color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),HE=H("activityBarTop.foreground",{dark:"#E7E7E7",light:"#424242",hcDark:be.white,hcLight:ao},h(3965,"Active foreground color of the item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar.")),z7e=H("activityBarTop.activeBorder",{dark:HE,light:HE,hcDark:et,hcLight:"#B5200D"},h(3966,"Focus border color for the active item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar."));H("activityBarTop.activeBackground",null,h(3967,"Background color for the active item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar."));const K7e=H("activityBarTop.inactiveForeground",{dark:Je(HE,.6),light:Je(HE,.75),hcDark:be.white,hcLight:ao},h(3968,"Inactive foreground color of the item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar.")),j7e=H("activityBarTop.dropBorder",HE,h(3969,"Drag and drop feedback color for the items in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar."));H("activityBarTop.background",null,h(3970,"Background color of the activity bar when set to top / bottom."));const Zoe=H("panel.background",ts,h(3971,"Panel background color. Panels are shown below the editor area and contain views like output and integrated terminal.")),UE=H("panel.border",{dark:be.fromHex("#808080").transparent(.35),light:be.fromHex("#808080").transparent(.35),hcDark:et,hcLight:et},h(3972,"Panel border color to separate the panel from the editor. Panels are shown below the editor area and contain views like output and integrated terminal.")),Y7e=H("panelTitle.border",{dark:null,light:null,hcDark:UE,hcLight:UE},h(3973,"Panel title border color on the bottom, separating the title from the views. Panels are shown below the editor area and contain views like output and integrated terminal.")),$E=H("panelTitle.activeForeground",{dark:"#E7E7E7",light:"#424242",hcDark:be.white,hcLight:ao},h(3974,"Title color for the active panel. Panels are shown below the editor area and contain views like output and integrated terminal.")),Q7e=H("panelTitle.inactiveForeground",{dark:Je($E,.6),light:Je($E,.75),hcDark:be.white,hcLight:ao},h(3975,"Title color for the inactive panel. Panels are shown below the editor area and contain views like output and integrated terminal.")),X7e=H("panelTitle.activeBorder",{dark:$E,light:$E,hcDark:et,hcLight:"#B5200D"},h(3976,"Border color for the active panel title. Panels are shown below the editor area and contain views like output and integrated terminal.")),Z7e=H("panelTitleBadge.background",ww,h(3977,"Panel title badge background color. Panels are shown below the editor area and contain views like output and integrated terminal.")),J7e=H("panelTitleBadge.foreground",Sw,h(3978,"Panel title badge foreground color. Panels are shown below the editor area and contain views like output and integrated terminal."));H("panelInput.border",{dark:bk,light:be.fromHex("#ddd"),hcDark:bk,hcLight:bk},h(3979,"Input box border for inputs in the panel."));const e6e=H("panel.dropBorder",$E,h(3980,"Drag and drop feedback color for the panel titles. Panels are shown below the editor area and contain views like output and integrated terminal.")),fz=H("panelSection.dropBackground",TN,h(3981,"Drag and drop feedback color for the panel sections. The color should have transparency so that the panel sections can still shine through. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Oxe=H("panelSectionHeader.background",{dark:be.fromHex("#808080").transparent(.2),light:be.fromHex("#808080").transparent(.2),hcDark:null,hcLight:null},h(3982,"Panel section header background color. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Fxe=H("panelSectionHeader.foreground",null,h(3983,"Panel section header foreground color. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Wxe=H("panelSectionHeader.border",et,h(3984,"Panel section header border color used when multiple views are stacked vertically in the panel. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Bxe=H("panelSection.border",UE,h(3985,"Panel section border color used when multiple views are stacked horizontally in the panel. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Vxe=H("panelStickyScroll.background",Zoe,h(3986,"Background color of sticky scroll in the panel.")),Hxe=H("panelStickyScroll.border",null,h(3987,"Border color of sticky scroll in the panel.")),Uxe=H("panelStickyScroll.shadow",sq,h(3988,"Shadow color of sticky scroll in the panel."));H("profileBadge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:be.white,hcLight:be.black},h(3989,"Profile badge background color. The profile badge shows on top of the settings gear icon in the activity bar."));H("profileBadge.foreground",{dark:be.white,light:"#333333",hcDark:be.black,hcLight:be.white},h(3990,"Profile badge foreground color. The profile badge shows on top of the settings gear icon in the activity bar."));const t6e=H("statusBarItem.remoteBackground",ww,h(3991,"Background color for the remote indicator on the status bar.")),$xe=H("statusBarItem.remoteForeground",Sw,h(3992,"Foreground color for the remote indicator on the status bar."));H("statusBarItem.remoteHoverForeground",wI,h(3993,"Foreground color for the remote indicator on the status bar when hovering."));H("statusBarItem.remoteHoverBackground",{dark:Mu,light:Mu,hcDark:Mu,hcLight:null},h(3994,"Background color for the remote indicator on the status bar when hovering."));H("statusBarItem.offlineBackground","#6c1717",h(3995,"Status bar item background color when the workbench is offline."));H("statusBarItem.offlineForeground",$xe,h(3996,"Status bar item foreground color when the workbench is offline."));H("statusBarItem.offlineHoverForeground",wI,h(3997,"Status bar item foreground hover color when the workbench is offline."));H("statusBarItem.offlineHoverBackground",{dark:Mu,light:Mu,hcDark:Mu,hcLight:null},h(3998,"Status bar item background hover color when the workbench is offline."));H("extensionBadge.remoteBackground",ww,h(3999,"Background color for the remote badge in the extensions view."));H("extensionBadge.remoteForeground",Sw,h(4e3,"Foreground color for the remote badge in the extensions view."));const mz=H("sideBar.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#000000",hcLight:"#FFFFFF"},h(4001,"Side bar background color. The side bar is the container for views like explorer and search.")),Joe=H("sideBar.foreground",null,h(4002,"Side bar foreground color. The side bar is the container for views like explorer and search.")),j8=H("sideBar.border",{dark:null,light:null,hcDark:et,hcLight:et},h(4003,"Side bar border color on the side separating to the editor. The side bar is the container for views like explorer and search."));H("sideBarTitle.background",mz,h(4004,"Side bar title background color. The side bar is the container for views like explorer and search."));const i6e=H("sideBarTitle.foreground",Joe,h(4005,"Side bar title foreground color. The side bar is the container for views like explorer and search.")),n6e=H("sideBarTitle.border",{dark:null,light:null,hcDark:j8,hcLight:j8},h(4006,"Side bar title border color on the bottom, separating the title from the views. The side bar is the container for views like explorer and search.")),vz=H("sideBar.dropBackground",TN,h(4007,"Drag and drop feedback color for the side bar sections. The color should have transparency so that the side bar sections can still shine through. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),Gxe=H("sideBarSectionHeader.background",{dark:be.fromHex("#808080").transparent(.2),light:be.fromHex("#808080").transparent(.2),hcDark:null,hcLight:null},h(4008,"Side bar section header background color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),qxe=H("sideBarSectionHeader.foreground",Joe,h(4009,"Side bar section header foreground color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),ere=H("sideBarSectionHeader.border",et,h(4010,"Side bar section header border color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar."));H("sideBarActivityBarTop.border",ere,h(4011,"Border color between the activity bar at the top/bottom and the views."));const zxe=H("sideBarStickyScroll.background",mz,h(4012,"Background color of sticky scroll in the side bar.")),Kxe=H("sideBarStickyScroll.border",null,h(4013,"Border color of sticky scroll in the side bar.")),jxe=H("sideBarStickyScroll.shadow",sq,h(4014,"Shadow color of sticky scroll in the side bar.")),hh=H("titleBar.activeForeground",{dark:"#CCCCCC",light:"#333333",hcDark:"#FFFFFF",hcLight:"#292929"},h(4015,"Title bar foreground when the window is active.")),tre=H("titleBar.inactiveForeground",{dark:Je(hh,.6),light:Je(hh,.6),hcDark:null,hcLight:"#292929"},h(4016,"Title bar foreground when the window is inactive.")),Y8=H("titleBar.activeBackground",{dark:"#3C3C3C",light:"#DDDDDD",hcDark:"#000000",hcLight:"#FFFFFF"},h(4017,"Title bar background when the window is active.")),s6e=H("titleBar.inactiveBackground",{dark:Je(Y8,.6),light:Je(Y8,.6),hcDark:null,hcLight:null},h(4018,"Title bar background when the window is inactive.")),o6e=H("titleBar.border",{dark:null,light:null,hcDark:et,hcLight:et},h(4019,"Title bar border color.")),Yxe=H("menubar.selectionForeground",hh,h(4020,"Foreground color of the selected menu item in the menubar.")),Q8=H("menubar.selectionBackground",{dark:f7,light:f7,hcDark:null,hcLight:null},h(4021,"Background color of the selected menu item in the menubar."));H("menubar.selectionBorder",{dark:null,light:null,hcDark:Sr,hcLight:Sr},h(4022,"Border color of the selected menu item in the menubar."));H("commandCenter.foreground",hh,h(4023,"Foreground color of the command center"),!1);H("commandCenter.activeForeground",Yxe,h(4024,"Active foreground color of the command center"),!1);H("commandCenter.inactiveForeground",tre,h(4025,"Foreground color of the command center when the window is inactive"),!1);H("commandCenter.background",{dark:be.white.transparent(.05),hcDark:null,light:be.black.transparent(.05),hcLight:null},h(4026,"Background color of the command center"),!1);H("commandCenter.activeBackground",{dark:be.white.transparent(.08),hcDark:Q8,light:be.black.transparent(.08),hcLight:Q8},h(4027,"Active background color of the command center"),!1);H("commandCenter.border",{dark:Je(hh,.2),hcDark:et,light:Je(hh,.2),hcLight:et},h(4028,"Border color of the command center"),!1);H("commandCenter.activeBorder",{dark:Je(hh,.3),hcDark:hh,light:Je(hh,.3),hcLight:hh},h(4029,"Active border color of the command center"),!1);H("commandCenter.inactiveBorder",Je(tre,.25),h(4030,"Border color of the command center when the window is inactive"),!1);const r6e=H("notificationCenter.border",{dark:ey,light:ey,hcDark:et,hcLight:et},h(4031,"Notifications center border color. Notifications slide in from the bottom right of the window.")),a6e=H("notificationToast.border",{dark:ey,light:ey,hcDark:et,hcLight:et},h(4032,"Notification toast border color. Notifications slide in from the bottom right of the window."));H("notifications.foreground",Eie,h(4033,"Notifications foreground color. Notifications slide in from the bottom right of the window."));const $D=H("notifications.background",LM,h(4034,"Notifications background color. Notifications slide in from the bottom right of the window."));H("notificationLink.foreground",xie,h(4035,"Notification links foreground color. Notifications slide in from the bottom right of the window."));const c6e=H("notificationCenterHeader.foreground",null,h(4036,"Notifications center header foreground color. Notifications slide in from the bottom right of the window.")),Qxe=H("notificationCenterHeader.background",{dark:Xfe($D,.3),light:vr($D,.05),hcDark:$D,hcLight:$D},h(4037,"Notifications center header background color. Notifications slide in from the bottom right of the window."));H("notifications.border",Qxe,h(4038,"Notifications border color separating from other notifications in the notifications center. Notifications slide in from the bottom right of the window."));H("notificationsErrorIcon.foreground",Iie,h(4039,"The color used for the icon of error notifications. Notifications slide in from the bottom right of the window."));H("notificationsWarningIcon.foreground",TT,h(4040,"The color used for the icon of warning notifications. Notifications slide in from the bottom right of the window."));H("notificationsInfoIcon.foreground",mE,h(4041,"The color used for the icon of info notifications. Notifications slide in from the bottom right of the window."));const d6e=H("window.activeBorder",{dark:null,light:null,hcDark:et,hcLight:et},h(4042,"The color used for the border of the window when it is active on macOS or Linux. Requires custom title bar style and custom or hidden window controls on Linux.")),l6e=H("window.inactiveBorder",{dark:null,light:null,hcDark:et,hcLight:et},h(4043,"The color used for the border of the window when it is inactive on macOS or Linux. Requires custom title bar style and custom or hidden window controls on Linux.")),_z=Z("IExtensionStatusBarItemService");var my;(function(s){s[s.DidDefine=0]="DidDefine",s[s.DidUpdate=1]="DidUpdate"})(my||(my={}));let ZW=class{constructor(e){this._statusbarService=e,this._entries=new Map,this._onDidChange=new M,this.onDidChange=this._onDidChange.event}dispose(){this._entries.forEach(e=>e.accessor.dispose()),this._entries.clear(),this._onDidChange.dispose()}setOrUpdateEntry(e,t,i,n,o,r,a,c,d,l,u,g){let m,v;if(g)m=g.label,v=g.role;else if(m=Zfe(o),typeof r=="string"||ec(r)){const k=typeof r=="string"?r:r.value;m+=`, ${k}`}let y;switch(d?.id){case K8:case Axe:y=d.id===K8?"error":"warning",c=void 0,d=void 0}const w={name:n,text:o,tooltip:r,command:a,color:c,backgroundColor:d,ariaLabel:m,role:v,kind:y,extensionId:i};typeof u>"u"&&(u=0);let C=l?iv.LEFT:iv.RIGHT;const T=this._entries.get(e);if(T&&(C=T.alignment,u=T.priority),T)return T.accessor.update(w),T.entry=w,my.DidUpdate;{let k;typeof i=="string"?k={primary:u,secondary:cc(i)}:k=u;const A=this._statusbarService.addEntry(w,t,C,k);return this._entries.set(e,{accessor:A,entry:w,alignment:C,priority:u,disposable:Ee(()=>{A.dispose(),this._entries.delete(e),this._onDidChange.fire({removed:e})})}),this._onDidChange.fire({added:[e,{entry:w,alignment:C,priority:u}]}),my.DidDefine}}unsetEntry(e){this._entries.get(e)?.disposable.dispose(),this._entries.delete(e)}getEntries(){return this._entries.entries()}};ZW=f([p(0,kN)],ZW);$(_z,ZW,G.Delayed);const Uh=Z("IEditorBreadcrumbsService");class SI{constructor(e){this.defaultValue=e}verify(e){return this.isType(e)?e:this.defaultValue}}class Vn extends SI{isType(e){return typeof e=="boolean"}}class p0 extends SI{isType(e){return typeof e=="number"}}class Xxe extends SI{isType(e){return e instanceof Set}}class da extends SI{constructor(e,t){super(e),this.allowedValues=t}isType(e){return this.allowedValues.includes(e)}}class X8 extends SI{constructor(e,t){super(e),this.verifier=t}verify(e){return this.isType(e)?ire(this.verifier,e):this.defaultValue}isType(e){return oa(e)}}function ire(s,e){const t=Object.create(null);for(const i in s)if(Object.hasOwnProperty.call(s,i)){const n=s[i];t[i]=n.verify(e[i])}return t}const pp=new Ke(220,70),TA=new Ke(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Wt={showTabs:"multiple",highlightModifiedTabs:!1,tabActionLocation:"right",tabActionCloseVisibility:!0,tabActionUnpinVisibility:!0,alwaysShowEditorActions:!1,tabSizing:"fit",tabSizingFixedMinWidth:50,tabSizingFixedMaxWidth:160,pinnedTabSizing:"normal",pinnedTabsOnSeparateRow:!1,tabHeight:"default",preventPinnedEditorClose:"keyboardAndMouse",titleScrollbarSizing:"default",focusRecentEditorAfterClose:!0,showIcons:!0,hasIcons:!0,enablePreview:!0,openPositioning:"right",openSideBySideDirection:"right",closeEmptyGroups:!0,labelFormat:"default",splitSizing:"auto",splitOnDragAndDrop:!0,dragToOpenWindow:!0,centeredLayoutFixedWidth:!1,doubleClickTabToToggleEditorGroupSizes:"expand",editorActionsLocation:"default",wrapTabs:!1,enablePreviewFromQuickOpen:!1,scrollToSwitchTabs:!1,enablePreviewFromCodeNavigation:!1,closeOnFileDelete:!1,mouseBackForwardToNavigate:!0,restoreViewState:!0,splitInGroupLayout:"horizontal",revealIfOpen:!1,get limit(){return{enabled:!1,value:10,perEditorGroup:!1,excludeDirty:!1}},get decorations(){return{badges:!0,colors:!0}},get autoLockGroups(){return new Set}};function u6e(s){return s.affectsConfiguration("workbench.editor")||s.affectsConfiguration("workbench.iconTheme")||s.affectsConfiguration("window.density")}function g6e(s,e){const t={...Wt,hasIcons:e.getFileIconTheme().hasFileIcons},i=s.getValue();if(i?.workbench?.editor)if(Object.assign(t,i.workbench.editor),oa(i.workbench.editor.autoLockGroups)){t.autoLockGroups=Wt.autoLockGroups;for(const[o,r]of Object.entries(i.workbench.editor.autoLockGroups))r===!0&&t.autoLockGroups.add(o)}else t.autoLockGroups=Wt.autoLockGroups;const n=s.getValue();return n?.window?.density?.editorTabHeight&&(t.tabHeight=n.window.density.editorTabHeight),Zxe(t)}function Zxe(s){return typeof s.showTabs=="boolean"&&(s.showTabs=s.showTabs?"multiple":"single"),ire({wrapTabs:new Vn(Wt.wrapTabs),scrollToSwitchTabs:new Vn(Wt.scrollToSwitchTabs),highlightModifiedTabs:new Vn(Wt.highlightModifiedTabs),tabActionCloseVisibility:new Vn(Wt.tabActionCloseVisibility),tabActionUnpinVisibility:new Vn(Wt.tabActionUnpinVisibility),alwaysShowEditorActions:new Vn(Wt.alwaysShowEditorActions),pinnedTabsOnSeparateRow:new Vn(Wt.pinnedTabsOnSeparateRow),focusRecentEditorAfterClose:new Vn(Wt.focusRecentEditorAfterClose),showIcons:new Vn(Wt.showIcons),enablePreview:new Vn(Wt.enablePreview),enablePreviewFromQuickOpen:new Vn(Wt.enablePreviewFromQuickOpen),enablePreviewFromCodeNavigation:new Vn(Wt.enablePreviewFromCodeNavigation),closeOnFileDelete:new Vn(Wt.closeOnFileDelete),closeEmptyGroups:new Vn(Wt.closeEmptyGroups),revealIfOpen:new Vn(Wt.revealIfOpen),mouseBackForwardToNavigate:new Vn(Wt.mouseBackForwardToNavigate),restoreViewState:new Vn(Wt.restoreViewState),splitOnDragAndDrop:new Vn(Wt.splitOnDragAndDrop),dragToOpenWindow:new Vn(Wt.dragToOpenWindow),centeredLayoutFixedWidth:new Vn(Wt.centeredLayoutFixedWidth),hasIcons:new Vn(Wt.hasIcons),tabSizingFixedMinWidth:new p0(Wt.tabSizingFixedMinWidth),tabSizingFixedMaxWidth:new p0(Wt.tabSizingFixedMaxWidth),showTabs:new da(Wt.showTabs,["multiple","single","none"]),tabActionLocation:new da(Wt.tabActionLocation,["left","right"]),tabSizing:new da(Wt.tabSizing,["fit","shrink","fixed"]),pinnedTabSizing:new da(Wt.pinnedTabSizing,["normal","compact","shrink"]),tabHeight:new da(Wt.tabHeight,["default","compact"]),preventPinnedEditorClose:new da(Wt.preventPinnedEditorClose,["keyboardAndMouse","keyboard","mouse","never"]),titleScrollbarSizing:new da(Wt.titleScrollbarSizing,["default","large"]),openPositioning:new da(Wt.openPositioning,["left","right","first","last"]),openSideBySideDirection:new da(Wt.openSideBySideDirection,["right","down"]),labelFormat:new da(Wt.labelFormat,["default","short","medium","long"]),splitInGroupLayout:new da(Wt.splitInGroupLayout,["vertical","horizontal"]),splitSizing:new da(Wt.splitSizing,["distribute","split","auto"]),doubleClickTabToToggleEditorGroupSizes:new da(Wt.doubleClickTabToToggleEditorGroupSizes,["maximize","expand","off"]),editorActionsLocation:new da(Wt.editorActionsLocation,["default","titleBar","hidden"]),autoLockGroups:new Xxe(Wt.autoLockGroups),limit:new X8(Wt.limit,{enabled:new Vn(Wt.limit.enabled),value:new p0(Wt.limit.value),perEditorGroup:new Vn(Wt.limit.perEditorGroup),excludeDirty:new Vn(Wt.limit.excludeDirty)}),decorations:new X8(Wt.decorations,{badges:new Vn(Wt.decorations.badges),colors:new Vn(Wt.decorations.colors)})},s)}function Z8(s,e,t){return!e||!s.activeEditor||e.matches(s.activeEditor)?{...t,viewState:s.activeEditorPane?.getViewState()}:t||Object.create(null)}function bz(s,e,t){if(e.length===0)return[];const i=[];let n;const o=[];for(const a of e)!n&&s.isActive(a)?n=a:o.push(a);n||(n=o.shift()),o.sort((a,c)=>s.getIndexOfEditor(c)-s.getIndexOfEditor(a));const r=Vt([n,...o]);for(let a=0;a<r.length;a++){const c=r[a];i.push({editor:c,options:{pinned:!0,sticky:s.isSticky(c),inactive:a>0,preserveFocus:t}})}return i}const Os=Z("viewDescriptorService"),Pr=Z("chatWidgetService"),Jxe=Z("quickChatService"),eIe=Z("chatAccessibilityService"),tIe=Z("chatCodeBlockContextProviderService"),ff=Z("chatAgentService"),nre=Z("chatAgentNameService"),sre=Z("codeMapperService"),bg=Z("chatEditingService"),mf=Z("IChatService"),ore=Z("chatSlashCommandService"),yz=Z("IChatVariablesService"),rre=Z("IChatWidgetHistoryService"),wz=Z("languageModelIgnoredFilesService"),are=Z("ILanguageModelStatsService"),CI=Z("ILanguageModelToolsService"),Cw=Z("ILanguageModelsService"),yg=Z("commentService"),Sz=Z("customEditorService"),Cz=Z("debugService"),cre=Z("debugVisualizerService"),iIe=Z("IEditSessionsStorageService"),nIe=Z("IEditSessionsLogService"),EI=Z("extensionsWorkbenchService"),dre=Z("externalUriOpenerService"),Qi=Z("explorerService"),Ez=Z("IInlineChatSessionService"),xz=Z("IInteractiveDocumentService"),lre=Z("IInteractiveHistoryService"),sIe=Z("ITroubleshootIssueService"),oIe=Z("issueFormService"),rIe=Z("workbenchIssueService"),aIe=Z("IDefaultLogLevelsService"),hre=Z("multiDiffSourceResolverService"),cIe=Z("INotebookOriginalCellModelFactory"),dIe=Z("INotebookOriginalModelReferenceFactory"),AN=Z("INotebookEditorWidgetService"),ure=Z("notebookCellStatusBarService"),xI=Z("INotebookModelResolverService"),lIe=Z("INotebookExecutionService"),gre=Z("INotebookExecutionStateService"),pre=Z("INotebookKernelService"),hIe=Z("INotebookKernelHistoryService"),uIe=Z("notebookKeymapService"),fre=Z("INotebookLoggingService"),mre=Z("INotebookRendererMessagingService"),$h=Z("notebookService"),gIe="notebookEditorWorkerService",pIe=Z(gIe),fIe=Z("preferencesSearchService"),Iz=Z("IQuickDiffModelService"),RN=Z("quickDiff"),vre=Z("scm"),_re=Z("scmView"),mIe=Z("replaceService"),vIe=Z("searchViewModelWorkbenchService"),_Ie=Z("notebookSearchService"),bIe=Z("searchHistoryService"),bre=Z("shareService"),PN=Z("snippetService"),LN=Z("speechService");class yIe{getTags(){return Promise.resolve({})}async getTelemetryWorkspaceId(e,t){}getHashedRemotesFromUri(e,t){return Promise.resolve([])}}const wIe=Z("workspaceTagsService"),yre=Z("taskService");var J8;(function(s){s[s.Left=0]="Left",s[s.Right=1]="Right",s[s.Up=2]="Up",s[s.Down=3]="Down"})(J8||(J8={}));var JW;(function(s){s[s.Connecting=0]="Connecting",s[s.Connected=1]="Connected"})(JW||(JW={}));const ej="terminalEditor";var tj;(function(s){s[s.SearchHighlightLimit=2e4]="SearchHighlightLimit"})(tj||(tj={}));var ij;(function(s){s[s.Unknown=1]="Unknown",s[s.Fedora=2]="Fedora",s[s.Ubuntu=3]="Ubuntu"})(ij||(ij={}));var nj;(function(s){s.Terminals="Terminals"})(nj||(nj={}));const Ew=Z("terminalService"),SIe=Z("terminalConfigurationService"),wre=Z("terminalEditorService"),Dz=Z("terminalGroupService"),Sre=Z("terminalInstanceService"),Cre=Z("environmentVariableService"),Ere=Z("terminalProfileResolverService"),xre=Z("terminalProfileService"),CIe=Z("terminalContributionsService"),Ire=Z("terminalLinkProviderService"),Dre=Z("terminalQuickFixService"),kre=Z("terminalCompletionService"),EIe=Z("testCoverageService"),xIe=Z("testingFilterState"),Tre=Z("testProfileService"),Are=Z("testResultService"),IIe=Z("ITestResultStorage"),Rre=Z("testService"),DIe=Z("testingContinuousRunService"),kIe=Z("testingDecorationService"),TIe=Z("testingPeekOpener"),AIe="timeline",Pre=Z(AIe),MN=Z("webviewService"),II=Z("webviewEditorService"),Lre=Z("webviewViewService"),RIe=Z("walkthroughsService"),PIe=Z("accessibleViewInformationService"),Hv=Z("activityService"),Mre=Z("IAiEmbeddingVectorService"),kz=Z("IAiRelatedInformationService"),NN=Z("IAuthenticationAccessService"),Nre=Z("IAuthenticationUsageService"),Uv=Z("IAuthenticationService"),Tz=Z("IAuthenticationExtensionsService"),Ore=Z("auxiliaryWindowService"),LIe=Z("bannerService"),wg=Z("ICustomEditorLabelService"),vf=Z("editorResolverService"),xw=Z("IExtensionBisectService"),Fre=Z("IExtensionFeaturesManagementService");var sj;(function(s){s[s.Local=1]="Local",s[s.Remote=2]="Remote",s[s.Web=3]="Web"})(sj||(sj={}));var bu;(function(s){s[s.DisabledByTrustRequirement=0]="DisabledByTrustRequirement",s[s.DisabledByExtensionKind=1]="DisabledByExtensionKind",s[s.DisabledByEnvironment=2]="DisabledByEnvironment",s[s.EnabledByEnvironment=3]="EnabledByEnvironment",s[s.DisabledByMalicious=4]="DisabledByMalicious",s[s.DisabledByVirtualWorkspace=5]="DisabledByVirtualWorkspace",s[s.DisabledByInvalidExtension=6]="DisabledByInvalidExtension",s[s.DisabledByAllowlist=7]="DisabledByAllowlist",s[s.DisabledByExtensionDependency=8]="DisabledByExtensionDependency",s[s.DisabledGlobally=9]="DisabledGlobally",s[s.DisabledWorkspace=10]="DisabledWorkspace",s[s.EnabledGlobally=11]="EnabledGlobally",s[s.EnabledWorkspace=12]="EnabledWorkspace"})(bu||(bu={}));const MIe=Die(yI),Wre=Z("extensionManagementServerService"),ON=Die(MIe),gd=Z("extensionEnablementService"),Az=Z("IWebExtensionsScannerService"),NIe=Z("extensionRecommendationsService"),OIe=Z("IExtensionIgnoredRecommendationsService"),FIe=Z("IWorkspaceExtensionsConfigService"),Bre=Z("extensionUrlHandler"),$v=Z("extensionManifestPropertiesService"),fo=Z("historyService"),WIe=Z("integrityService");class BIe{constructor(e,t){this._mapAltGrToCtrlAlt=e,this._OS=t}dumpDebugInfo(){return"FallbackKeyboardMapper dispatching on keyCode"}resolveKeyboardEvent(e){const t=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,i=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,n=new vF(t,e.shiftKey,i,e.metaKey,e.keyCode);return this.resolveKeybinding(new Jfe([n]))[0]}resolveKeybinding(e){return eme.resolveKeybinding(e,this._OS)}}const VIe=Z("keybindingEditingService"),Rz=Z("ILanguageStatusService");var FS;let eB=class extends F{static{FS=this}static{this.LAST_SHUTDOWN_REASON_KEY="lifecyle.lastShutdownReason"}get startupKind(){return this._startupKind}get phase(){return this._phase}get willShutdown(){return this._willShutdown}constructor(e,t){super(),this.logService=e,this.storageService=t,this._onBeforeShutdown=this._register(new M),this.onBeforeShutdown=this._onBeforeShutdown.event,this._onWillShutdown=this._register(new M),this.onWillShutdown=this._onWillShutdown.event,this._onDidShutdown=this._register(new M),this.onDidShutdown=this._onDidShutdown.event,this._onBeforeShutdownError=this._register(new M),this.onBeforeShutdownError=this._onBeforeShutdownError.event,this._onShutdownVeto=this._register(new M),this.onShutdownVeto=this._onShutdownVeto.event,this._phase=mc.Starting,this._willShutdown=!1,this.phaseWhen=new Map,this._startupKind=this.resolveStartupKind(),this._register(this.storageService.onWillSaveState(i=>{i.reason===Zx.SHUTDOWN&&this.storageService.store(FS.LAST_SHUTDOWN_REASON_KEY,this.shutdownReason,he.WORKSPACE,pt.MACHINE)}))}resolveStartupKind(){const e=this.doResolveStartupKind()??X1.NewWindow;return this.logService.trace(`[lifecycle] starting up (startup kind: ${e})`),e}doResolveStartupKind(){const e=this.storageService.getNumber(FS.LAST_SHUTDOWN_REASON_KEY,he.WORKSPACE);this.storageService.remove(FS.LAST_SHUTDOWN_REASON_KEY,he.WORKSPACE);let t;switch(e){case Cb.RELOAD:t=X1.ReloadedWindow;break;case Cb.LOAD:t=X1.ReopenedWindow;break}return t}set phase(e){if(e<this.phase)throw new Error("Lifecycle cannot go backwards");if(this._phase===e)return;this.logService.trace(`lifecycle: phase changed (value: ${e})`),this._phase=e,or(`code/LifecyclePhase/${tme(e)}`);const t=this.phaseWhen.get(this._phase);t&&(t.open(),this.phaseWhen.delete(this._phase))}async when(e){if(e<=this._phase)return;let t=this.phaseWhen.get(e);t||(t=new Np,this.phaseWhen.set(e,t)),await t.wait()}};eB=FS=f([p(0,Pe),p(1,tt)],eB);const HIe=Z("localizationService"),UIe=Z("activeLanguageService"),Vre=Z("notebookDocumentService"),Pz=Z("IOutlineService"),FN=Z("outputService");var Va;(function(s){s.Http="http",s.Https="https"})(Va||(Va={}));var Eu;(function(s){s.ConstantPrivate="constantPrivate",s.Private="private",s.Public="public"})(Eu||(Eu={}));var Zg;(function(s){s[s.Notify=1]="Notify",s[s.OpenBrowser=2]="OpenBrowser",s[s.OpenPreview=3]="OpenPreview",s[s.Silent=4]="Silent",s[s.Ignore=5]="Ignore",s[s.OpenBrowserOnce=6]="OpenBrowserOnce"})(Zg||(Zg={}));function $Ie(s){if(s.scheme!=="http"&&s.scheme!=="https")return;const e=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(s.authority);if(e)return{address:e[1],port:+e[2]}}const GE=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function qE(s){return GE.indexOf(s)>=0}const AA=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function zE(s){return AA.indexOf(s)>=0}class GIe{constructor(e,t,i){this.remoteAddress=e,this.localAddress=t,this._dispose=i,this._onDispose=new M,this.onDidDispose=this._onDispose.event}dispose(){return this._onDispose.fire(),this._dispose()}}let oj=class extends F{constructor(e,t){super(),this.logService=e,this.configurationService=t,this._onTunnelOpened=new M,this.onTunnelOpened=this._onTunnelOpened.event,this._onTunnelClosed=new M,this.onTunnelClosed=this._onTunnelClosed.event,this._onAddedTunnelProvider=new M,this.onAddedTunnelProvider=this._onAddedTunnelProvider.event,this._tunnels=new Map,this._canElevate=!1,this._canChangeProtocol=!0,this._privacyOptions=[],this._factoryInProgress=new Set}get hasTunnelProvider(){return!!this._tunnelProvider}get defaultTunnelHost(){const e=this.configurationService.getValue("remote.localPortHost");return!e||e==="localhost"?"127.0.0.1":"0.0.0.0"}setTunnelProvider(e){return this._tunnelProvider=e,e?(this._onAddedTunnelProvider.fire(),{dispose:()=>{this._tunnelProvider=void 0,this._canElevate=!1,this._privacyOptions=[]}}):(this._canElevate=!1,this._privacyOptions=[],this._onAddedTunnelProvider.fire(),{dispose:()=>{}})}setTunnelFeatures(e){this._canElevate=e.elevation,this._privacyOptions=e.privacyOptions,this._canChangeProtocol=e.protocol}get canChangeProtocol(){return this._canChangeProtocol}get canElevate(){return this._canElevate}get canChangePrivacy(){return this._privacyOptions.length>0}get privacyOptions(){return this._privacyOptions}get tunnels(){return this.getTunnels()}async getTunnels(){const e=[],t=Array.from(this._tunnels.values());for(const i of t){const n=Array.from(i.values());for(const o of n){const r=await o.value;r&&typeof r!="string"&&e.push(r)}}return e}async dispose(){super.dispose();for(const e of this._tunnels.values()){for(const{value:t}of e.values())await t.then(i=>typeof i!="string"?i?.dispose():void 0);e.clear()}this._tunnels.clear()}setEnvironmentTunnel(e,t,i,n,o){this.addTunnelToMap(e,t,Promise.resolve({tunnelRemoteHost:e,tunnelRemotePort:t,localAddress:i,privacy:n,protocol:o,dispose:()=>Promise.resolve()}))}async getExistingTunnel(e,t){(zE(e)||qE(e))&&(e=GE[0]);const i=this.getTunnelFromMap(e,t);if(i)return++i.refcount,i.value}openTunnel(e,t,i,n,o,r=!1,a,c){this.logService.trace(`ForwardedPorts: (TunnelService) openTunnel request for ${t}:${i} on local port ${o}.`);const d=this._tunnelProvider??e;if(!d)return;if(t||(t="localhost"),n||(n=this.defaultTunnelHost),this._tunnelProvider&&this._factoryInProgress.has(i)){this.logService.debug("ForwardedPorts: (TunnelService) Another call to create a tunnel with the same address has occurred before the last one completed. This call will be ignored.");return}const l=this.retainOrCreateTunnel(d,t,i,n,o,r,a,c);return l?l.then(u=>{if(u){if(typeof u=="string")return this.logService.trace("ForwardedPorts: (TunnelService) The tunnel provider returned an error when creating the tunnel."),this.removeEmptyOrErrorTunnelFromMap(t,i),u}else{this.logService.trace("ForwardedPorts: (TunnelService) New tunnel is undefined."),this.removeEmptyOrErrorTunnelFromMap(t,i);return}this.logService.trace("ForwardedPorts: (TunnelService) New tunnel established.");const g=this.makeTunnel(u);return(u.tunnelRemoteHost!==t||u.tunnelRemotePort!==i)&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Host or port mismatch."),a&&u.privacy!==a&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Privacy mismatch."),this._onTunnelOpened.fire(g),g}):(this.logService.trace("ForwardedPorts: (TunnelService) Tunnel was not created."),l)}makeTunnel(e){return{tunnelRemotePort:e.tunnelRemotePort,tunnelRemoteHost:e.tunnelRemoteHost,tunnelLocalPort:e.tunnelLocalPort,localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol,dispose:async()=>{this.logService.trace(`ForwardedPorts: (TunnelService) dispose request for ${e.tunnelRemoteHost}:${e.tunnelRemotePort} `);const t=this._tunnels.get(e.tunnelRemoteHost);if(t){const i=t.get(e.tunnelRemotePort);i&&(i.refcount--,await this.tryDisposeTunnel(e.tunnelRemoteHost,e.tunnelRemotePort,i))}}}}async tryDisposeTunnel(e,t,i){if(i.refcount<=0){this.logService.trace(`ForwardedPorts: (TunnelService) Tunnel is being disposed ${e}:${t}.`);const n=i.value.then(async o=>{o&&typeof o!="string"&&(await o.dispose(!0),this._onTunnelClosed.fire({host:o.tunnelRemoteHost,port:o.tunnelRemotePort}))});return this._tunnels.has(e)&&this._tunnels.get(e).delete(t),n}}async closeTunnel(e,t){this.logService.trace(`ForwardedPorts: (TunnelService) close request for ${e}:${t} `);const i=this._tunnels.get(e);if(i&&i.has(t)){const n=i.get(t);n.refcount=0,await this.tryDisposeTunnel(e,t,n)}}addTunnelToMap(e,t,i){this._tunnels.has(e)||this._tunnels.set(e,new Map),this._tunnels.get(e).set(t,{refcount:1,value:i})}async removeEmptyOrErrorTunnelFromMap(e,t){const i=this._tunnels.get(e);if(i){const n=i.get(t),o=n?await n.value:void 0;(!o||typeof o=="string")&&i.delete(t),i.size===0&&this._tunnels.delete(e)}}getTunnelFromMap(e,t){const i=[e];qE(e)?(i.push(...GE),i.push(...AA)):zE(e)&&i.push(...AA);const n=i.map(o=>this._tunnels.get(o));for(const o of n){const r=o?.get(t);if(r)return r}}canTunnel(e){return!!$Ie(e)}createWithProvider(e,t,i,n,o,r,a){this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel with provider ${t}:${i} on local port ${n}.`);const c=i;this._factoryInProgress.add(c);const d=n===void 0?i:n,l={elevationRequired:o?this.isPortPrivileged(d):!1},u={remoteAddress:{host:t,port:i},localAddressPort:n,privacy:r,public:r?r!==Eu.Private:void 0,protocol:a},g=e.forwardPort(u,l);return g?(this.addTunnelToMap(t,i,g),g.finally(()=>{this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created by provider."),this._factoryInProgress.delete(c)})):this._factoryInProgress.delete(c),g}};oj=f([p(0,Pe),p(1,ne)],oj);const qIe=10*1e3,GD="remote.tunnels.toRestore",f0="remote.tunnels.toRestoreExpiration",zIe=1e3*60*60*24*14,rj="onTunnel",KIe=new O("forwardedPortsViewEnabled",!1,h(12831,"Whether the Ports view is enabled.")),jIe=new O("forwardedPortsViewOnlyEnabled",!1,h(12831,"Whether the Ports view is enabled."));function YIe(s){const e=s.match(/^([a-zA-Z0-9_-]+(?:\.[a-zA-Z0-9_-]+)*:)?([0-9]+)$/);if(e)return{host:e[1]?.substring(0,e[1].length-1)||"localhost",port:Number(e[2])}}var Dm;(function(s){s.Other="Other",s.User="User",s.AutoForwardEnd="AutoForwardEnd"})(Dm||(Dm={}));var Xd;(function(s){s[s.User=0]="User",s[s.Auto=1]="Auto",s[s.Extension=2]="Extension"})(Xd||(Xd={}));const m0={source:Xd.User,description:h(12832,"User Forwarded")},m6e={source:Xd.Auto,description:h(12833,"Auto Forwarded")};function aj(s,e,t){const i=s.get(qr(e,t));if(i)return i;if(qE(e))for(const n of GE){const o=qr(n,t);if(s.has(o))return s.get(o)}else if(zE(e))for(const n of AA){const o=qr(n,t);if(s.has(o))return s.get(o)}}function Hr(s,e,t){const i=aj(s,e,t);if(i)return i;const n=zE(e)?"localhost":qE(e)?"0.0.0.0":void 0;if(n)return aj(s,n,t)}function qr(s,e){return s+":"+e}var Jg;(function(s){s.Notify="notify",s.OpenBrowser="openBrowser",s.OpenBrowserOnce="openBrowserOnce",s.OpenPreview="openPreview",s.Silent="silent",s.Ignore="ignore"})(Jg||(Jg={}));function QIe(s){return s&&"host"in s&&typeof s.host=="string"&&"port"in s&&typeof s.port=="number"&&(!("detail"in s)||typeof s.detail=="string")&&(!("pid"in s)||typeof s.pid=="string")}class Ha extends F{static{this.SETTING="remote.portsAttributes"}static{this.DEFAULTS="remote.otherPortsAttributes"}static{this.RANGE=/^(\d+)\-(\d+)$/}static{this.HOST_AND_PORT=/^([a-z0-9\-]+):(\d{1,5})$/}constructor(e){super(),this.configurationService=e,this.portsAttributes=[],this._onDidChangeAttributes=new M,this.onDidChangeAttributes=this._onDidChangeAttributes.event,this._register(e.onDidChangeConfiguration(t=>{(t.affectsConfiguration(Ha.SETTING)||t.affectsConfiguration(Ha.DEFAULTS))&&this.updateAttributes()})),this.updateAttributes()}updateAttributes(){this.portsAttributes=this.readSetting(),this._onDidChangeAttributes.fire()}getAttributes(e,t,i){let n=this.findNextIndex(e,t,i,this.portsAttributes,0);const o={label:void 0,onAutoForward:void 0,elevateIfNeeded:void 0,requireLocalPort:void 0,protocol:void 0};for(;n>=0;){const r=this.portsAttributes[n];r.key===e?(o.onAutoForward=r.onAutoForward??o.onAutoForward,o.elevateIfNeeded=r.elevateIfNeeded!==void 0?r.elevateIfNeeded:o.elevateIfNeeded,o.label=r.label??o.label,o.requireLocalPort=r.requireLocalPort,o.protocol=r.protocol):(o.onAutoForward=o.onAutoForward??r.onAutoForward,o.elevateIfNeeded=o.elevateIfNeeded!==void 0?o.elevateIfNeeded:r.elevateIfNeeded,o.label=o.label??r.label,o.requireLocalPort=o.requireLocalPort!==void 0?o.requireLocalPort:void 0,o.protocol=o.protocol??r.protocol),n=this.findNextIndex(e,t,i,this.portsAttributes,n+1)}return o.onAutoForward!==void 0||o.elevateIfNeeded!==void 0||o.label!==void 0||o.requireLocalPort!==void 0||o.protocol!==void 0?o:this.getOtherAttributes()}hasStartEnd(e){return e.start!==void 0&&e.end!==void 0}hasHostAndPort(e){return e.host!==void 0&&e.port!==void 0&&It(e.host)&&Ja(e.port)}findNextIndex(e,t,i,n,o){if(o>=n.length)return-1;const r=!qE(t)&&!zE(t),c=n.slice(o).findIndex(d=>Ja(d.key)?r?!1:d.key===e:this.hasStartEnd(d.key)?r?!1:e>=d.key.start&&e<=d.key.end:this.hasHostAndPort(d.key)?e===d.key.port&&t===d.key.host:i?d.key.test(i):!1);return c>=0?c+o:-1}readSetting(){const e=this.configurationService.getValue(Ha.SETTING);if(!e||!oa(e))return[];const t=[];for(const n in e){if(n===void 0)continue;const o=e[n];let r;if(Number(n))r=Number(n);else if(It(n))if(Ha.RANGE.test(n)){const a=n.match(Ha.RANGE);r={start:Number(a[1]),end:Number(a[2])}}else if(Ha.HOST_AND_PORT.test(n)){const a=n.match(Ha.HOST_AND_PORT);r={host:a[1],port:Number(a[2])}}else{let a;try{a=RegExp(n)}catch{}a&&(r=a)}r&&t.push({key:r,elevateIfNeeded:o.elevateIfNeeded,onAutoForward:o.onAutoForward,label:o.label,requireLocalPort:o.requireLocalPort,protocol:o.protocol})}const i=this.configurationService.getValue(Ha.DEFAULTS);return i&&(this.defaultPortAttributes={elevateIfNeeded:i.elevateIfNeeded,label:i.label,onAutoForward:i.onAutoForward,requireLocalPort:i.requireLocalPort,protocol:i.protocol}),this.sortAttributes(t)}sortAttributes(e){function t(i,n){return Ja(i.key)?i.key:n.hasStartEnd(i.key)?i.key.start:n.hasHostAndPort(i.key)?i.key.port:Number.MAX_VALUE}return e.sort((i,n)=>t(i,this)-t(n,this))}getOtherAttributes(){return this.defaultPortAttributes}static providedActionToAction(e){switch(e){case Zg.Notify:return Jg.Notify;case Zg.OpenBrowser:return Jg.OpenBrowser;case Zg.OpenBrowserOnce:return Jg.OpenBrowserOnce;case Zg.OpenPreview:return Jg.OpenPreview;case Zg.Silent:return Jg.Silent;case Zg.Ignore:return Jg.Ignore;default:return}}async addAttributes(e,t,i){const o=this.configurationService.inspect(Ha.SETTING).userRemoteValue;let r;!o||!oa(o)?r={}:r=Cr(o),r[`${e}`]||(r[`${e}`]={});for(const a in t)r[`${e}`][a]=t[a];return this.configurationService.updateValue(Ha.SETTING,r,i)}}let KE=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this.tunnelService=e,this.storageService=t,this.configurationService=i,this.environmentService=n,this.remoteAuthorityResolverService=o,this.workspaceContextService=r,this.logService=a,this.dialogService=c,this.extensionService=d,this.contextKeyService=l,this.inProgress=new Map,this._onForwardPort=new M,this.onForwardPort=this._onForwardPort.event,this._onClosePort=new M,this.onClosePort=this._onClosePort.event,this._onPortName=new M,this.onPortName=this._onPortName.event,this._onCandidatesChanged=new M,this.onCandidatesChanged=this._onCandidatesChanged.event,this._onEnvironmentTunnelsSet=new M,this.onEnvironmentTunnelsSet=this._onEnvironmentTunnelsSet.event,this._environmentTunnelsSet=!1,this.restoreListener=void 0,this.restoreComplete=!1,this.onRestoreComplete=new M,this.unrestoredExtensionTunnels=new Map,this.sessionCachedProperties=new Map,this.portAttributesProviders=[],this.hasCheckedExtensionsOnTunnelOpened=!1,this.mismatchCooldown=new Date,this.configPortsAttributes=new Ha(i),this.tunnelRestoreValue=this.getTunnelRestoreValue(),this._register(this.configPortsAttributes.onDidChangeAttributes(this.updateAttributes,this)),this.forwarded=new Map,this.remoteTunnels=new Map,this.tunnelService.tunnels.then(async u=>{const g=await this.getAttributes(u.map(m=>({port:m.tunnelRemotePort,host:m.tunnelRemoteHost})));for(const m of u)if(m.localAddress){const v=qr(m.tunnelRemoteHost,m.tunnelRemotePort),y=Hr(this._candidates??new Map,m.tunnelRemoteHost,m.tunnelRemotePort);this.forwarded.set(v,{remotePort:m.tunnelRemotePort,remoteHost:m.tunnelRemoteHost,localAddress:m.localAddress,protocol:g?.get(m.tunnelRemotePort)?.protocol??Va.Http,localUri:await this.makeLocalUri(m.localAddress,g?.get(m.tunnelRemotePort)),localPort:m.tunnelLocalPort,name:g?.get(m.tunnelRemotePort)?.label,runningProcess:y?.detail,hasRunningProcess:!!y,pid:y?.pid,privacy:m.privacy,source:m0}),this.remoteTunnels.set(v,m)}}),this.detected=new Map,this._register(this.tunnelService.onTunnelOpened(async u=>{const g=qr(u.tunnelRemoteHost,u.tunnelRemotePort);if(!Hr(this.forwarded,u.tunnelRemoteHost,u.tunnelRemotePort)&&!Hr(this.detected,u.tunnelRemoteHost,u.tunnelRemotePort)&&!Hr(this.inProgress,u.tunnelRemoteHost,u.tunnelRemotePort)&&u.localAddress){const m=Hr(this._candidates??new Map,u.tunnelRemoteHost,u.tunnelRemotePort),v=(await this.getAttributes([{port:u.tunnelRemotePort,host:u.tunnelRemoteHost}]))?.get(u.tunnelRemotePort);this.forwarded.set(g,{remoteHost:u.tunnelRemoteHost,remotePort:u.tunnelRemotePort,localAddress:u.localAddress,protocol:v?.protocol??Va.Http,localUri:await this.makeLocalUri(u.localAddress,v),localPort:u.tunnelLocalPort,name:v?.label,closeable:!0,runningProcess:m?.detail,hasRunningProcess:!!m,pid:m?.pid,privacy:u.privacy,source:m0})}await this.storeForwarded(),this.checkExtensionActivationEvents(!0),this.remoteTunnels.set(g,u),this._onForwardPort.fire(this.forwarded.get(g))})),this._register(this.tunnelService.onTunnelClosed(u=>this.onTunnelClosed(u,Dm.Other))),this.checkExtensionActivationEvents(!1)}extensionHasActivationEvent(){return this.extensionService.extensions.find(e=>e.activationEvents?.includes(rj))?(this.contextKeyService.createKey(jIe.key,!0),!0):!1}checkExtensionActivationEvents(e){if(this.hasCheckedExtensionsOnTunnelOpened||(e&&(this.hasCheckedExtensionsOnTunnelOpened=!0),this.environmentService.remoteAuthority!==void 0&&!e)||this.extensionHasActivationEvent())return;const i=this._register(this.extensionService.onDidRegisterExtensions(()=>{this.extensionHasActivationEvent()&&i.dispose()}))}async onTunnelClosed(e,t){const i=qr(e.host,e.port);this.forwarded.has(i)&&(this.forwarded.delete(i),await this.storeForwarded(),this._onClosePort.fire(e))}makeLocalUri(e,t){if(e.startsWith("http"))return R.parse(e);const i=t?.protocol??"http";return R.parse(`${i}://${e}`)}async addStorageKeyPostfix(e){const t=this.workspaceContextService.getWorkspace(),i=t.configuration?cc(t.configuration.path):t.folders.length>0?cc(t.folders[0].uri.path):void 0;if(i===void 0){this.logService.debug("Could not get workspace hash for forwarded ports storage key.");return}return`${e}.${this.environmentService.remoteAuthority}.${i}`}async getTunnelRestoreStorageKey(){return this.addStorageKeyPostfix(GD)}async getRestoreExpirationStorageKey(){return this.addStorageKeyPostfix(f0)}async getTunnelRestoreValue(){const e=this.storageService.get(GD,he.WORKSPACE);if(e)return this.storageService.remove(GD,he.WORKSPACE),await this.storeForwarded(),e;const t=await this.getTunnelRestoreStorageKey();if(t)return this.storageService.get(t,he.PROFILE)}async restoreForwarded(){if(this.cleanupExpiredTunnelsForRestore(),this.configurationService.getValue("remote.restoreForwardedPorts")){const e=await this.tunnelRestoreValue;if(e&&e!==this.knownPortsRestoreValue){const t=JSON.parse(e)??[];this.logService.trace(`ForwardedPorts: (TunnelModel) restoring ports ${t.map(i=>i.remotePort).join(", ")}`);for(const i of t){const n=Hr(this.detected,i.remoteHost,i.remotePort);i.source.source!==Xd.Extension&&!n||i.source.source===Xd.Extension&&n?await this.doForward({remote:{host:i.remoteHost,port:i.remotePort},local:i.localPort,name:i.name,elevateIfNeeded:!0,source:i.source}):i.source.source===Xd.Extension&&!n&&this.unrestoredExtensionTunnels.set(qr(i.remoteHost,i.remotePort),i)}}}if(this.restoreComplete=!0,this.onRestoreComplete.fire(),!this.restoreListener){const e=await this.getTunnelRestoreStorageKey();this.restoreListener=this._register(new U),this.restoreListener.add(this.storageService.onDidChangeValue(he.PROFILE,void 0,this.restoreListener)(async t=>{t.key===e&&(this.tunnelRestoreValue=Promise.resolve(this.storageService.get(e,he.PROFILE)),await this.restoreForwarded())}))}}cleanupExpiredTunnelsForRestore(){const e=this.storageService.keys(he.PROFILE,pt.USER).filter(t=>t.startsWith(f0));for(const t of e){const i=this.storageService.getNumber(t,he.PROFILE);if(i&&i<Date.now()){this.tunnelRestoreValue=Promise.resolve(void 0);const n=t.replace(f0,GD);this.storageService.remove(t,he.PROFILE),this.storageService.remove(n,he.PROFILE)}}}async storeForwarded(){if(this.configurationService.getValue("remote.restoreForwardedPorts")){const e=Array.from(this.forwarded.values()),t=e.map(r=>({remoteHost:r.remoteHost,remotePort:r.remotePort,localPort:r.localPort,name:r.name,localAddress:r.localAddress,localUri:r.localUri,protocol:r.protocol,source:r.source}));let i;e.length>0&&(i=JSON.stringify(t));const n=await this.getTunnelRestoreStorageKey(),o=await this.getRestoreExpirationStorageKey();!i&&n&&o?(this.storageService.remove(n,he.PROFILE),this.storageService.remove(o,he.PROFILE)):i!==this.knownPortsRestoreValue&&n&&o&&(this.storageService.store(n,i,he.PROFILE,pt.USER),this.storageService.store(o,Date.now()+zIe,he.PROFILE,pt.USER)),this.knownPortsRestoreValue=i}}async showPortMismatchModalIfNeeded(e,t,i){if(!e.tunnelLocalPort||!i?.requireLocalPort||e.tunnelLocalPort===t)return;const n=new Date;if(this.mismatchCooldown.getTime()+qIe>n.getTime())return;this.mismatchCooldown=n;const o=h(12834,`Local port {0} could not be used for forwarding to remote port {1}.

This usually happens when there is already another process using local port {0}.

Port number {2} has been used instead.`,t,e.tunnelRemotePort,e.tunnelLocalPort);return this.dialogService.info(o)}async forward(e,t){return!this.restoreComplete&&this.environmentService.remoteAuthority&&await D.toPromise(this.onRestoreComplete.event),this.doForward(e,t)}async doForward(e,t){await this.extensionService.activateByEvent(rj);const i=Hr(this.forwarded,e.remote.host,e.remote.port);t=t??(t!==null?(await this.getAttributes([e.remote]))?.get(e.remote.port):void 0);const n=e.local!==void 0?e.local:e.remote.port;let o;if(i)return this.mergeAttributesIntoExistingTunnel(i,e,t);{const r=this.environmentService.remoteAuthority,a=r?{getAddress:async()=>(await this.remoteAuthorityResolverService.resolveAuthority(r)).authority}:void 0,c=qr(e.remote.host,e.remote.port);this.inProgress.set(c,!0),e=this.mergeCachedAndUnrestoredProperties(c,e);const d=await this.tunnelService.openTunnel(a,e.remote.host,e.remote.port,void 0,n,e.elevateIfNeeded?e.elevateIfNeeded:t?.elevateIfNeeded,e.privacy,t?.protocol);if(typeof d=="string")o=d;else if(d&&d.localAddress){const l=Hr(this._candidates??new Map,e.remote.host,e.remote.port),u=d.protocol?d.protocol===Va.Https?Va.Https:Va.Http:t?.protocol??Va.Http,g={remoteHost:d.tunnelRemoteHost,remotePort:d.tunnelRemotePort,localPort:d.tunnelLocalPort,name:t?.label??e.name,closeable:!0,localAddress:d.localAddress,protocol:u,localUri:await this.makeLocalUri(d.localAddress,t),runningProcess:l?.detail,hasRunningProcess:!!l,pid:l?.pid,source:e.source??m0,privacy:d.privacy};return this.forwarded.set(c,g),this.remoteTunnels.set(c,d),this.inProgress.delete(c),await this.storeForwarded(),await this.showPortMismatchModalIfNeeded(d,n,t),this._onForwardPort.fire(g),d}this.inProgress.delete(c)}return o}mergeCachedAndUnrestoredProperties(e,t){const i=this.unrestoredExtensionTunnels.has(e)?this.unrestoredExtensionTunnels:this.sessionCachedProperties.has(e)?this.sessionCachedProperties:void 0;if(i){const n=i.get(e);i.delete(e),n&&(t.name=n.name??t.name,t.local=("local"in n?n.local:"localPort"in n?n.localPort:void 0)??t.local,t.privacy=t.privacy)}return t}async mergeAttributesIntoExistingTunnel(e,t,i){const n=i?.label??t.name;let o;(function(a){a[a.None=0]="None",a[a.Fire=1]="Fire",a[a.Reopen=2]="Reopen"})(o||(o={}));let r=o.None;switch(n!==e.name&&(e.name=n,r=o.Fire),(i?.protocol||e.protocol!==Va.Http)&&i?.protocol!==e.protocol&&(t.source=e.source,r=o.Reopen),t.privacy&&e.privacy!==t.privacy&&(r=o.Reopen),r){case o.Fire:{this._onForwardPort.fire();break}case o.Reopen:await this.close(e.remoteHost,e.remotePort,Dm.User),await this.doForward(t,i)}return Hr(this.remoteTunnels,t.remote.host,t.remote.port)}async name(e,t,i){const n=Hr(this.forwarded,e,t),o=qr(e,t);if(n){n.name=i,await this.storeForwarded(),this._onPortName.fire({host:e,port:t});return}else this.detected.has(o)&&(this.detected.get(o).name=i,this._onPortName.fire({host:e,port:t}))}async close(e,t,i){const n=qr(e,t),o=this.forwarded.get(n);return i===Dm.AutoForwardEnd&&o&&o.source.source===Xd.Auto&&this.sessionCachedProperties.set(n,{local:o.localPort,name:o.name,privacy:o.privacy}),await this.tunnelService.closeTunnel(e,t),this.onTunnelClosed({host:e,port:t},i)}address(e,t){const i=qr(e,t);return(this.forwarded.get(i)||this.detected.get(i))?.localAddress}get environmentTunnelsSet(){return this._environmentTunnelsSet}addEnvironmentTunnels(e){if(e)for(const t of e){const i=Hr(this._candidates??new Map,t.remoteAddress.host,t.remoteAddress.port),n=typeof t.localAddress=="string"?t.localAddress:qr(t.localAddress.host,t.localAddress.port);this.detected.set(qr(t.remoteAddress.host,t.remoteAddress.port),{remoteHost:t.remoteAddress.host,remotePort:t.remoteAddress.port,localAddress:n,protocol:Va.Http,localUri:this.makeLocalUri(n),closeable:!1,runningProcess:i?.detail,hasRunningProcess:!!i,pid:i?.pid,privacy:Eu.ConstantPrivate,source:{source:Xd.Extension,description:h(12835,"Statically Forwarded")}}),this.tunnelService.setEnvironmentTunnel(t.remoteAddress.host,t.remoteAddress.port,n,Eu.ConstantPrivate,Va.Http)}this._environmentTunnelsSet=!0,this._onEnvironmentTunnelsSet.fire(),this._onForwardPort.fire()}setCandidateFilter(e){this._candidateFilter=e}async setCandidates(e){let t=e;this._candidateFilter&&(t=await this._candidateFilter(e));const i=this.updateInResponseToCandidates(t);this.logService.trace(`ForwardedPorts: (TunnelModel) removed candidates ${Array.from(i.values()).map(n=>n.port).join(", ")}`),this._onCandidatesChanged.fire(i)}updateInResponseToCandidates(e){const t=this._candidates??new Map,i=new Map;return this._candidates=i,e.forEach(n=>{const o=qr(n.host,n.port);i.set(o,{host:n.host,port:n.port,detail:n.detail,pid:n.pid}),t.has(o)&&t.delete(o);const r=Hr(this.forwarded,n.host,n.port);r&&(r.runningProcess=n.detail,r.hasRunningProcess=!0,r.pid=n.pid)}),t.forEach((n,o)=>{const r=YIe(o);if(!r)return;const a=Hr(this.forwarded,r.host,r.port);a&&(a.runningProcess=void 0,a.hasRunningProcess=!1,a.pid=void 0);const c=Hr(this.detected,r.host,r.port);c&&(c.runningProcess=void 0,c.hasRunningProcess=!1,c.pid=void 0)}),t}get candidates(){return this._candidates?Array.from(this._candidates.values()):[]}get candidatesOrUndefined(){return this._candidates?this.candidates:void 0}async updateAttributes(){const e=Array.from(this.forwarded.values()),t=await this.getAttributes(e.map(i=>({port:i.remotePort,host:i.remoteHost})),!1);if(t)for(const i of e){const n=t.get(i.remotePort);(n?.protocol||i.protocol!==Va.Http)&&n?.protocol!==i.protocol&&await this.doForward({remote:{host:i.remoteHost,port:i.remotePort},local:i.localPort,name:i.name,source:i.source},n),n&&n.label&&n.label!==i.name&&await this.name(i.remoteHost,i.remotePort,n.label)}}async getAttributes(e,t=!0){const i=new Map,n=new Map;e.forEach(d=>{const l=Hr(this._candidates??new Map,GE[0],d.port)??d;if(l){i.set(d.port,l);const u=QIe(l)?l.pid:void 0;n.has(u)||n.set(u,[]),n.get(u)?.push(d.port)}});const o=new Map;if(e.forEach(d=>{const l=this.configPortsAttributes.getAttributes(d.port,d.host,i.get(d.port)?.detail);l&&o.set(d.port,l)}),this.portAttributesProviders.length===0||!t)return o.size>0?o:void 0;const r=await Promise.all(this.portAttributesProviders.flatMap(d=>Array.from(n.entries()).map(l=>{const u=l[1],g=i.get(u[0]);return d.providePortAttributes(u,g?.pid,g?.detail,ye.None)}))),a=new Map;if(r.forEach(d=>d.forEach(l=>{l&&a.set(l.port,l)})),!o&&!a)return;const c=new Map;return e.forEach(d=>{const l=o.get(d.port),u=a.get(d.port);c.set(d.port,{elevateIfNeeded:l?.elevateIfNeeded,label:l?.label,onAutoForward:l?.onAutoForward??Ha.providedActionToAction(u?.autoForwardAction),requireLocalPort:l?.requireLocalPort,protocol:l?.protocol})}),c}addAttributesProvider(e){this.portAttributesProviders.push(e)}};KE.__decorator=f([ime(1e3)],KE.prototype,"storeForwarded",null);KE=f([p(0,DN),p(1,tt),p(2,ne),p(3,mn),p(4,Hh),p(5,Tt),p(6,Pe),p(7,Qt),p(8,hn),p(9,me)],KE);const cj="remote.explorerType",_6e="~remote.forwardedPorts",b6e="~remote.forwardedPortsContainer",dj="remote.autoForwardPorts",lj="remote.autoForwardPortsSource",y6e="remote.autoForwardPortsFallback",w6e="process",hj="output",XIe="hybrid";var uj;(function(s){s.Candidate="Candidate",s.Detected="Detected",s.Forwarded="Forwarded",s.Add="Add"})(uj||(uj={}));var gj;(function(s){s[s.None=0]="None",s[s.New=1]="New",s[s.Label=2]="Label",s[s.LocalPort=3]="LocalPort"})(gj||(gj={}));const ZIe={type:"object",required:["id"],properties:{id:{description:h(12823,"The ID of a Get Started walkthrough to open."),type:"string"}}},JIe=_l.registerExtensionPoint({extensionPoint:"remoteHelp",jsonSchema:{description:h(12824,"Contributes help information for Remote"),type:"object",properties:{getStarted:{description:h(12825,"The url, or a command that returns the url, to your project's Getting Started page, or a walkthrough ID contributed by your project's extension"),oneOf:[{type:"string"},ZIe]},documentation:{description:h(12826,"The url, or a command that returns the url, to your project's documentation page"),type:"string"},feedback:{description:h(12827,"The url, or a command that returns the url, to your project's feedback reporter"),type:"string",markdownDeprecationMessage:h(12828,"Use {0} instead","`reportIssue`")},reportIssue:{description:h(12829,"The url, or a command that returns the url, to your project's issue reporter"),type:"string"},issues:{description:h(12830,"The url, or a command that returns the url, to your project's issues list"),type:"string"}}}});var Nu;(function(s){s[s.Disabled=0]="Disabled",s[s.ViewOnly=1]="ViewOnly",s[s.AdditionalFeatures=2]="AdditionalFeatures"})(Nu||(Nu={}));let pj=class{constructor(e,t,i){this.storageService=e,this.tunnelService=t,this._targetType=[],this._onDidChangeTargetType=new M,this.onDidChangeTargetType=this._onDidChangeTargetType.event,this._onDidChangeHelpInformation=new M,this.onDidChangeHelpInformation=this._onDidChangeHelpInformation.event,this._helpInformation=[],this._onDidChangeEditable=new M,this.onDidChangeEditable=this._onDidChangeEditable.event,this._onEnabledPortsFeatures=new M,this.onEnabledPortsFeatures=this._onEnabledPortsFeatures.event,this._portsFeaturesEnabled=Nu.Disabled,this.namedProcesses=new Map,this._tunnelModel=i.createInstance(KE),JIe.setHandler(n=>{this._helpInformation.push(...n),this._onDidChangeHelpInformation.fire(n)})}get helpInformation(){return this._helpInformation}set targetType(e){const t=this._targetType.length>0?this._targetType[0]:"",i=e.length>0?e[0]:"";t!==i&&(this._targetType=e,this.storageService.store(cj,this._targetType.toString(),he.WORKSPACE,pt.MACHINE),this.storageService.store(cj,this._targetType.toString(),he.PROFILE,pt.USER),this._onDidChangeTargetType.fire(this._targetType))}get targetType(){return this._targetType}get tunnelModel(){return this._tunnelModel}forward(e,t){return this.tunnelModel.forward(e,t)}close(e,t){return this.tunnelModel.close(e.host,e.port,t)}setTunnelInformation(e){e?.features&&this.tunnelService.setTunnelFeatures(e.features),this.tunnelModel.addEnvironmentTunnels(e?.environmentTunnels)}setEditable(e,t,i){i?this._editable={tunnelItem:e,data:i,editId:t}:this._editable=void 0,this._onDidChangeEditable.fire(e?{tunnel:e,editId:t}:void 0)}getEditableData(e,t){return this._editable&&(!e&&e===this._editable.tunnelItem||e&&this._editable.tunnelItem?.remotePort===e.remotePort&&this._editable.tunnelItem.remoteHost===e.remoteHost&&this._editable.editId===t)?this._editable.data:void 0}setCandidateFilter(e){return e?(this.tunnelModel.setCandidateFilter(e),{dispose:()=>{this.tunnelModel.setCandidateFilter(void 0)}}):{dispose:()=>{}}}onFoundNewCandidates(e){this.tunnelModel.setCandidates(e)}restore(){return this.tunnelModel.restoreForwarded()}enablePortsFeatures(e){this._portsFeaturesEnabled=e?Nu.ViewOnly:Nu.AdditionalFeatures,this._onEnabledPortsFeatures.fire()}get portsFeaturesEnabled(){return this._portsFeaturesEnabled}};pj=f([p(0,tt),p(1,DN),p(2,J)],pj);const WN=Z("remoteExplorerService"),DI=Z("searchService"),eDe=Z("embedderTerminalService"),tDe=Z("textMateTokenizationFeature"),iDe=Z("textEditorService"),Hre=Z("hostColorSchemeService"),Ure=Z("timerService"),nDe=Z("titleService"),BN=Z("IUserDataInitializationService"),sDe=Z("IRemoteUserDataProfilesService");class oDe extends F{get currentProfile(){return this._currentProfile}constructor(e){super(),this._onDidChangeCurrentProfile=this._register(new M),this.onDidChangeCurrentProfile=this._onDidChangeCurrentProfile.event,this._currentProfile=e}async updateCurrentProfile(e){if(ma(this._currentProfile,e))return;const t=this._currentProfile;this._currentProfile=e;const i=[];this._onDidChangeCurrentProfile.fire({previous:t,profile:e,join(n){i.push(n)}}),await Op.settled(i)}}const te=Object.freeze({View:I(1685,"View"),Help:I(1686,"Help"),Test:I(1687,"Test"),File:I(1688,"File"),Preferences:I(1689,"Preferences"),Developer:I(1690,"Developer")});var jE;(function(s){s.Uninitialized="uninitialized",s.Unavailable="unavailable",s.Available="available"})(jE||(jE={}));I(13178,"Settings Sync");Ae("settings-sync-view-icon",j.sync,h(13179,"View icon of the Settings Sync view."));const rDe=new O("syncStatus",BE.Uninitialized);new O("syncEnabled",!1);const aDe=new O("userDataSyncAccountStatus",jE.Uninitialized);new O("enableSyncActivityViews",!1);new O("enableSyncConflictsView",!1);new O("hasConflicts",!1);I(13180,"Download Settings Sync Activity"),te.Developer,x.and(aDe.isEqualTo(jE.Available),rDe.notEqualsTo(BE.Uninitialized));const cDe=Z("IUserDataSyncWorkbenchService"),mo=Z("viewsService"),$re=Z("workingCopyEditorService"),dDe=Z("workingCopyHistoryService"),lDe=Z("IWorkspaceIdentityService"),hDe=Z("chatMarkdownAnchorService"),uDe={};let gDe;function Gre(s){return uDe[s]}function pDe(){return gDe}const VN=Z("chatEntitlementService"),HN=Z("IPromptsService"),UN=Z("ISuggestMemories"),$N=Z("semanticTokensStylingService"),kI=Z("IOutlineModelService"),qre=Z("IMarkerNavigationService"),zre=Z("ICodeLensCache"),Kre=Z("IInlayHintsCache"),GN=Z("ISymbolNavigationService"),jre=Z("IPeekViewService"),cl=-1,xr=-2,C6e=-3;function E6e(s){return typeof s=="number"||Yq(s)}function tB(s,e,t){let i=!1;const n=fDe(s);if(Vse(n)&&(e.restoreViewState(n),i=!0),s.selection){const o={startLineNumber:s.selection.startLineNumber,startColumn:s.selection.startColumn,endLineNumber:s.selection.endLineNumber??s.selection.startLineNumber,endColumn:s.selection.endColumn??s.selection.startColumn};e.setSelection(o,s.selectionSource??sd.NAVIGATION),s.selectionRevealType===Cm.NearTop?e.revealRangeNearTop(o,t):s.selectionRevealType===Cm.NearTopIfOutsideViewport?e.revealRangeNearTopIfOutsideViewport(o,t):s.selectionRevealType===Cm.CenterIfOutsideViewport?e.revealRangeInCenterIfOutsideViewport(o,t):e.revealRangeInCenter(o,t),i=!0}return i}function fDe(s){if(!s.selection||!s.viewState)return s.viewState;const e=s.viewState;if(e.modified)return e.modified.cursorState=[],e;const t=s.viewState;return t.cursorState&&(t.cursorState=[]),t}let iB=class extends nme{constructor(e,t,i){super(t),this.editorService=e,this.configurationService=i,this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditor.bind(this))),this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditorFromDiff.bind(this)))}getActiveCodeEditor(){const e=this.editorService.activeTextEditorControl;if(Ao(e))return e;if($p(e))return e.getModifiedEditor();const t=this.editorService.activeEditorPane?.getControl();return iA(t)&&Ao(t.activeCodeEditor)?t.activeCodeEditor:null}async doOpenCodeEditorFromDiff(e,t,i){const n=this.editorService.activeTextEditorControl;if(!i&&$p(n)&&e.options&&e.resource&&t===n.getModifiedEditor()&&n.getModel()&&Dt(e.resource,n.getModel()?.modified.uri)){const o=n.getModifiedEditor();return tB(e.options,o,ji.Smooth),o}return null}async doOpenCodeEditor(e,t,i){if(!this.configurationService.getValue().workbench?.editor?.enablePreviewFromCodeNavigation&&t&&!e.options?.pinned&&!i&&!Dt(t.getModel()?.uri,e.resource)){for(const r of this.editorService.visibleEditorPanes)if(vw(r.getControl())===t){r.group.pinEditor();break}}const o=await this.editorService.openEditor(e,i?xr:cl);if(o){const r=o.getControl();if(Ao(r))return r;if(iA(r)&&Ao(r.activeCodeEditor))return r.activeCodeEditor}return null}};iB=f([p(0,de),p(1,ft),p(2,ne)],iB);function qN(s,e,t,i,n,o){if(Array.isArray(s)){let r=0;for(const a of s){const c=qN(a,e,t,i,n,o);if(c===10)return c;c>r&&(r=c)}return r}else{if(typeof s=="string")return i?s==="*"?5:s===t?10:0:0;if(s){const{language:r,pattern:a,scheme:c,hasAccessToAllModels:d,notebookType:l}=s;if(!i&&!d)return 0;l&&n&&(e=n);let u=0;if(c)if(c===e.scheme)u=10;else if(c==="*")u=5;else return 0;if(r)if(r===t)u=10;else if(r==="*")u=Math.max(u,5);else return 0;if(l)if(l===o)u=10;else if(l==="*"&&o!==void 0)u=Math.max(u,5);else return 0;if(a){let g;if(typeof a=="string"?g=a:g={...a,base:oq(a.base)},g===e.fsPath||ch(g,e.fsPath))u=10;else return 0}return u}else return 0}}function mDe(s){return typeof s=="string"?!1:Array.isArray(s)?s.some(mDe):!!s.notebookType}function Yre(s){return typeof s=="string"?!1:Array.isArray(s)?s.every(Yre):!!s.exclusive}class fj{constructor(e,t,i,n,o){this.uri=e,this.languageId=t,this.notebookUri=i,this.notebookType=n,this.recursive=o}equals(e){return this.notebookType===e.notebookType&&this.languageId===e.languageId&&this.uri.toString()===e.uri.toString()&&this.notebookUri?.toString()===e.notebookUri?.toString()&&this.recursive===e.recursive}}class Pi{constructor(e){this._notebookInfoResolver=e,this._clock=0,this._entries=[],this._onDidChange=new M,this.onDidChange=this._onDidChange.event}register(e,t){let i={selector:e,provider:t,_score:-1,_time:this._clock++};return this._entries.push(i),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),Ee(()=>{if(i){const n=this._entries.indexOf(i);n>=0&&(this._entries.splice(n,1),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),i=void 0)}})}has(e){return this.all(e).length>0}all(e){if(!e)return[];this._updateScores(e,!1);const t=[];for(const i of this._entries)i._score>0&&t.push(i.provider);return t}allNoModel(){return this._entries.map(e=>e.provider)}ordered(e,t=!1){const i=[];return this._orderedForEach(e,t,n=>i.push(n.provider)),i}orderedGroups(e){const t=[];let i,n;return this._orderedForEach(e,!1,o=>{i&&n===o._score?i.push(o.provider):(n=o._score,i=[o.provider],t.push(i))}),t}_orderedForEach(e,t,i){this._updateScores(e,t);for(const n of this._entries)n._score>0&&i(n)}_updateScores(e,t){const i=this._notebookInfoResolver?.(e.uri),n=i?new fj(e.uri,e.getLanguageId(),i.uri,i.type,t):new fj(e.uri,e.getLanguageId(),void 0,void 0,t);if(!this._lastCandidate?.equals(n)){this._lastCandidate=n;for(const o of this._entries)if(o._score=qN(o.selector,n.uri,n.languageId,Au(e),n.notebookUri,n.notebookType),Yre(o.selector)&&o._score>0)if(t)o._score=0;else{for(const r of this._entries)r._score=0;o._score=1e3;break}this._entries.sort(Pi._compareByScoreAndTime)}}static _compareByScoreAndTime(e,t){return e._score<t._score?1:e._score>t._score?-1:WS(e.selector)&&!WS(t.selector)?1:!WS(e.selector)&&WS(t.selector)?-1:e._time<t._time?1:e._time>t._time?-1:0}}function WS(s){return typeof s=="string"?!1:Array.isArray(s)?s.some(WS):!!s.isBuiltin}class vDe{constructor(){this.referenceProvider=new Pi(this._score.bind(this)),this.renameProvider=new Pi(this._score.bind(this)),this.newSymbolNamesProvider=new Pi(this._score.bind(this)),this.codeActionProvider=new Pi(this._score.bind(this)),this.definitionProvider=new Pi(this._score.bind(this)),this.typeDefinitionProvider=new Pi(this._score.bind(this)),this.declarationProvider=new Pi(this._score.bind(this)),this.implementationProvider=new Pi(this._score.bind(this)),this.documentSymbolProvider=new Pi(this._score.bind(this)),this.inlayHintsProvider=new Pi(this._score.bind(this)),this.colorProvider=new Pi(this._score.bind(this)),this.codeLensProvider=new Pi(this._score.bind(this)),this.documentFormattingEditProvider=new Pi(this._score.bind(this)),this.documentRangeFormattingEditProvider=new Pi(this._score.bind(this)),this.onTypeFormattingEditProvider=new Pi(this._score.bind(this)),this.signatureHelpProvider=new Pi(this._score.bind(this)),this.hoverProvider=new Pi(this._score.bind(this)),this.documentHighlightProvider=new Pi(this._score.bind(this)),this.multiDocumentHighlightProvider=new Pi(this._score.bind(this)),this.selectionRangeProvider=new Pi(this._score.bind(this)),this.foldingRangeProvider=new Pi(this._score.bind(this)),this.linkProvider=new Pi(this._score.bind(this)),this.inlineCompletionsProvider=new Pi(this._score.bind(this)),this.inlineEditProvider=new Pi(this._score.bind(this)),this.completionProvider=new Pi(this._score.bind(this)),this.linkedEditingRangeProvider=new Pi(this._score.bind(this)),this.inlineValuesProvider=new Pi(this._score.bind(this)),this.evaluatableExpressionProvider=new Pi(this._score.bind(this)),this.documentRangeSemanticTokensProvider=new Pi(this._score.bind(this)),this.documentSemanticTokensProvider=new Pi(this._score.bind(this)),this.documentDropEditProvider=new Pi(this._score.bind(this)),this.documentPasteEditProvider=new Pi(this._score.bind(this))}setNotebookTypeResolver(e){this._notebookTypeResolver=e}_score(e){return this._notebookTypeResolver?.(e)}}var Hf;let nB=class{constructor(e){this.instantiationService=e}createDiffProvider(e){return this.instantiationService.createInstance(sB,e)}};nB=f([p(0,J)],nB);let sB=class{static{Hf=this}static{this.diffCache=new Map}constructor(e,t,i){this.editorWorkerService=t,this.telemetryService=i,this.onDidChangeEventEmitter=new M,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="advanced",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(e)}dispose(){this.diffAlgorithmOnDidChangeSubscription?.dispose()}async computeDiff(e,t,i,n){if(typeof this.diffAlgorithm!="string")return this.diffAlgorithm.computeDiff(e,t,i,n);if(e.isDisposed()||t.isDisposed())return{changes:[],identical:!0,quitEarly:!1,moves:[]};if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return t.getLineCount()===1&&t.getLineMaxColumn(1)===1?{changes:[],identical:!0,quitEarly:!1,moves:[]}:{changes:[new sme(new Go(1,2),new Go(1,t.getLineCount()+1),[new rq(e.getFullModelRange(),t.getFullModelRange())])],identical:!1,quitEarly:!1,moves:[]};const o=JSON.stringify([e.uri.toString(),t.uri.toString()]),r=JSON.stringify([e.id,t.id,e.getAlternativeVersionId(),t.getAlternativeVersionId(),JSON.stringify(i)]),a=Hf.diffCache.get(o);if(a&&a.context===r)return a.result;const c=zn.create(),d=await this.editorWorkerService.computeDiff(e.uri,t.uri,i,this.diffAlgorithm),l=c.elapsed();if(this.telemetryService.publicLog2("diffEditor.computeDiff",{timeMs:l,timedOut:d?.quitEarly??!0,detectedMoves:i.computeMoves?d?.moves.length??0:-1}),n.isCancellationRequested)return{changes:[],identical:!1,quitEarly:!0,moves:[]};if(!d)throw new Error("no diff result available");return Hf.diffCache.size>10&&Hf.diffCache.delete(Hf.diffCache.keys().next().value),Hf.diffCache.set(o,{result:d,context:r}),d}setOptions(e){let t=!1;e.diffAlgorithm&&this.diffAlgorithm!==e.diffAlgorithm&&(this.diffAlgorithmOnDidChangeSubscription?.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=e.diffAlgorithm,typeof e.diffAlgorithm!="string"&&(this.diffAlgorithmOnDidChangeSubscription=e.diffAlgorithm.onDidChange(()=>this.onDidChangeEventEmitter.fire())),t=!0),t&&this.onDidChangeEventEmitter.fire()}};sB=Hf=f([p(1,vc),p(2,li)],sB);class nh{remove(){this.parent?.children.delete(this.id)}static findId(e,t){let i;typeof e=="string"?i=`${t.id}/${e}`:(i=`${t.id}/${e.name}`,t.children.get(i)!==void 0&&(i=`${t.id}/${e.name}_${e.range.startLineNumber}_${e.range.startColumn}`));let n=i;for(let o=0;t.children.get(n)!==void 0;o++)n=`${i}_${o}`;return n}static getElementById(e,t){if(!e)return;const i=rf(e,t.id);if(i===e.length)return t;if(!(i<t.id.length))for(const[,n]of t.children){const o=nh.getElementById(e,n);if(o)return o}}static size(e){let t=1;for(const[,i]of e.children)t+=nh.size(i);return t}static empty(e){return e.children.size===0}}class RA extends nh{constructor(e,t,i){super(),this.id=e,this.parent=t,this.symbol=i,this.children=new Map}}class oB extends nh{constructor(e,t,i,n){super(),this.id=e,this.parent=t,this.label=i,this.order=n,this.children=new Map}getItemEnclosingPosition(e){return e?this._getItemEnclosingPosition(e,this.children):void 0}_getItemEnclosingPosition(e,t){for(const[,i]of t)if(!(!i.symbol.range||!P.containsPosition(i.symbol.range,e)))return this._getItemEnclosingPosition(e,i.children)||i}updateMarker(e){for(const[,t]of this.children)this._updateMarker(e,t)}_updateMarker(e,t){t.marker=void 0;const i=AT(e,t.symbol.range,P.compareRangesUsingStarts);let n;i<0?(n=~i,n>0&&P.areIntersecting(e[n-1],t.symbol.range)&&(n-=1)):n=i;const o=[];let r;for(;n<e.length&&P.areIntersecting(t.symbol.range,e[n]);n++){const a=e[n];o.push(a),e[n]=void 0,(!r||a.severity>r)&&(r=a.severity)}for(const[,a]of t.children)this._updateMarker(o,a);r&&(t.marker={count:o.length,topSev:r}),Sie(e)}}class Yl extends nh{static create(e,t,i){const n=new ri(i),o=new Yl(t.uri),r=e.ordered(t),a=r.map((d,l)=>{const u=nh.findId(`provider_${l}`,o),g=new oB(u,o,d.displayName??"Unknown Outline Provider",l);return Promise.resolve(d.provideDocumentSymbols(t,n.token)).then(m=>{for(const v of m||[])Yl._makeOutlineElement(v,g);return g},m=>(kn(m),g)).then(m=>{nh.empty(m)?m.remove():o._groups.set(u,m)})}),c=e.onDidChange(()=>{const d=e.ordered(t);ns(d,r)||n.cancel()});return Promise.all(a).then(()=>n.token.isCancellationRequested&&!i.isCancellationRequested?Yl.create(e,t,i):o._compact()).finally(()=>{n.dispose(),c.dispose(),n.dispose()})}static _makeOutlineElement(e,t){const i=nh.findId(e,t),n=new RA(i,t,e);if(e.children)for(const o of e.children)Yl._makeOutlineElement(o,n);t.children.set(n.id,n)}static get(e){for(;e;){if(e instanceof Yl)return e;e=e.parent}}constructor(e){super(),this.uri=e,this.id="root",this.parent=void 0,this._groups=new Map,this.children=new Map,this.id="root",this.parent=void 0}_compact(){let e=0;for(const[t,i]of this._groups)i.children.size===0?this._groups.delete(t):e+=1;if(e!==1)this.children=this._groups;else{const t=dn.first(this._groups.values());for(const[,i]of t.children)i.parent=this,this.children.set(i.id,i)}return this}merge(e){return this.uri.toString()!==e.uri.toString()||this._groups.size!==e._groups.size?!1:(this._groups=e._groups,this.children=e.children,!0)}getItemEnclosingPosition(e,t){let i;if(t){let o=t.parent;for(;o&&!i;)o instanceof oB&&(i=o),o=o.parent}let n;for(const[,o]of this._groups)if(n=o.getItemEnclosingPosition(e),n&&(!i||i===o))break;return n}getItemById(e){return nh.getElementById(e,this)}updateMarker(e){e.sort(P.compareRangesUsingStarts);for(const[,t]of this._groups)t.updateMarker(e.slice(0))}getTopLevelSymbols(){const e=[];for(const t of this.children.values())t instanceof RA?e.push(t.symbol):e.push(...dn.map(t.children.values(),i=>i.symbol));return e.sort((t,i)=>P.compareRangesUsingStarts(t.range,i.range))}asListOfDocumentSymbols(){const e=this.getTopLevelSymbols(),t=[];return Yl._flattenDocumentSymbols(t,e,""),t.sort((i,n)=>_e.compare(P.getStartPosition(i.range),P.getStartPosition(n.range))||_e.compare(P.getEndPosition(n.range),P.getEndPosition(i.range)))}static _flattenDocumentSymbols(e,t,i){for(const n of t)e.push({kind:n.kind,tags:n.tags,name:n.name,detail:n.detail,containerName:n.containerName||i,range:n.range,selectionRange:n.selectionRange,children:void 0}),n.children&&Yl._flattenDocumentSymbols(e,n.children,n.name)}}let rB=class{constructor(e,t,i){this._languageFeaturesService=e,this._disposables=new U,this._cache=new Bm(15,.7),this._debounceInformation=t.for(e.documentSymbolProvider,"DocumentSymbols",{min:350}),this._disposables.add(i.onModelRemoved(n=>{this._cache.delete(n.id)}))}dispose(){this._disposables.dispose()}async getOrCreate(e,t){const i=this._languageFeaturesService.documentSymbolProvider,n=i.ordered(e);let o=this._cache.get(e.id);if(!o||o.versionId!==e.getVersionId()||!ns(o.provider,n)){const a=new ri;o={versionId:e.getVersionId(),provider:n,promiseCnt:0,source:a,promise:Yl.create(i,e,a.token),model:void 0},this._cache.set(e.id,o);const c=Date.now();o.promise.then(d=>{o.model=d,this._debounceInformation.update(e,Date.now()-c)}).catch(d=>{this._cache.delete(e.id)})}if(o.model)return o.model;o.promiseCnt+=1;const r=t.onCancellationRequested(()=>{--o.promiseCnt===0&&(o.source.cancel(),this._cache.delete(e.id))});try{return await o.promise}finally{r.dispose()}}getDebounceValue(e){return this._debounceInformation.get(e)}getCachedModels(){return dn.filter(dn.map(this._cache.values(),e=>e.model),e=>e!==void 0)}};rB=f([p(0,Ne),p(1,Sd),p(2,ai)],rB);var BS;class Lz{constructor(e){this.name=e}select(e,t,i){if(i.length===0)return 0;const n=i[0].score[0];for(let o=0;o<i.length;o++){const{score:r,completion:a}=i[o];if(r[0]!==n)break;if(a.preselect)return o}return 0}}class mj extends Lz{constructor(){super("first")}memorize(e,t,i){}toJSON(){}fromJSON(){}}class _De extends Lz{constructor(){super("recentlyUsed"),this._cache=new Bm(300,.66),this._seq=0}memorize(e,t,i){const n=`${e.getLanguageId()}/${i.textLabel}`;this._cache.set(n,{touch:this._seq++,type:i.completion.kind,insertText:i.completion.insertText})}select(e,t,i){if(i.length===0)return 0;const n=e.getLineContent(t.lineNumber).substr(t.column-10,t.column-1);if(/\s$/.test(n))return super.select(e,t,i);const o=i[0].score[0];let r=-1,a=-1,c=-1;for(let d=0;d<i.length&&i[d].score[0]===o;d++){const l=`${e.getLanguageId()}/${i[d].textLabel}`,u=this._cache.peek(l);if(u&&u.touch>c&&u.type===i[d].completion.kind&&u.insertText===i[d].completion.insertText&&(c=u.touch,a=d),i[d].completion.preselect&&r===-1)return r=d}return a!==-1?a:r!==-1?r:0}toJSON(){return this._cache.toJSON()}fromJSON(e){this._cache.clear();const t=0;for(const[i,n]of e)n.touch=t,n.type=typeof n.type=="number"?n.type:MM.fromString(n.type),this._cache.set(i,n);this._seq=this._cache.size}}class bDe extends Lz{constructor(){super("recentlyUsedByPrefix"),this._trie=kie.forStrings(),this._seq=0}memorize(e,t,i){const{word:n}=e.getWordUntilPosition(t),o=`${e.getLanguageId()}/${n}`;this._trie.set(o,{type:i.completion.kind,insertText:i.completion.insertText,touch:this._seq++})}select(e,t,i){const{word:n}=e.getWordUntilPosition(t);if(!n)return super.select(e,t,i);const o=`${e.getLanguageId()}/${n}`;let r=this._trie.get(o);if(r||(r=this._trie.findSubstr(o)),r)for(let a=0;a<i.length;a++){const{kind:c,insertText:d}=i[a].completion;if(c===r.type&&d===r.insertText)return a}return super.select(e,t,i)}toJSON(){const e=[];return this._trie.forEach((t,i)=>e.push([i,t])),e.sort((t,i)=>-(t[1].touch-i[1].touch)).forEach((t,i)=>t[1].touch=i),e.slice(0,200)}fromJSON(e){if(this._trie.clear(),e.length>0){this._seq=e[0][1].touch+1;for(const[t,i]of e)i.type=typeof i.type=="number"?i.type:MM.fromString(i.type),this._trie.set(t,i)}}}let aB=class{static{BS=this}static{this._strategyCtors=new Map([["recentlyUsedByPrefix",bDe],["recentlyUsed",_De],["first",mj]])}static{this._storagePrefix="suggest/memories"}constructor(e,t){this._storageService=e,this._configService=t,this._disposables=new U,this._persistSoon=new fn(()=>this._saveState(),500),this._disposables.add(e.onWillSaveState(i=>{i.reason===Zx.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(e,t,i){this._withStrategy(e,t).memorize(e,t,i),this._persistSoon.schedule()}select(e,t,i){return this._withStrategy(e,t).select(e,t,i)}_withStrategy(e,t){const i=this._configService.getValue("editor.suggestSelection",{overrideIdentifier:e.getLanguageIdAtPosition(t.lineNumber,t.column),resource:e.uri});if(this._strategy?.name!==i){this._saveState();const n=BS._strategyCtors.get(i)||mj;this._strategy=new n;try{const r=this._configService.getValue("editor.suggest.shareSuggestSelections")?he.PROFILE:he.WORKSPACE,a=this._storageService.get(`${BS._storagePrefix}/${i}`,r);a&&this._strategy.fromJSON(JSON.parse(a))}catch{}}return this._strategy}_saveState(){if(this._strategy){const t=this._configService.getValue("editor.suggest.shareSuggestSelections")?he.PROFILE:he.WORKSPACE,i=JSON.stringify(this._strategy);this._storageService.store(`${BS._storagePrefix}/${this._strategy.name}`,i,t,pt.MACHINE)}}};aB=BS=f([p(0,tt),p(1,ne)],aB);class vy{constructor(){this.lenses=[]}static{this.Empty=new vy}dispose(){this._store?.dispose()}get isDisposed(){return this._store?.isDisposed??!1}add(e,t){NM(e)&&(this._store??=new U,this._store.add(e));for(const i of e.lenses)this.lenses.push({symbol:i,provider:t})}}async function Qre(s,e,t){const i=s.ordered(e),n=new Map,o=new vy,r=i.map(async(a,c)=>{n.set(a,c);try{const d=await Promise.resolve(a.provideCodeLenses(e,t));d&&o.add(d,a)}catch(d){kn(d)}});return await Promise.all(r),t.isCancellationRequested?(o.dispose(),vy.Empty):(o.lenses=o.lenses.sort((a,c)=>a.symbol.range.startLineNumber<c.symbol.range.startLineNumber?-1:a.symbol.range.startLineNumber>c.symbol.range.startLineNumber?1:n.get(a.provider)<n.get(c.provider)?-1:n.get(a.provider)>n.get(c.provider)?1:a.symbol.range.startColumn<c.symbol.range.startColumn?-1:a.symbol.range.startColumn>c.symbol.range.startColumn?1:0),o)}Ce.registerCommand("_executeCodeLensProvider",function(s,...e){let[t,i]=e;St(R.isUri(t)),St(typeof i=="number"||!i);const{codeLensProvider:n}=s.get(Ne),o=s.get(ai).getModel(t);if(!o)throw Mt();const r=[],a=new U;return Qre(n,o,ye.None).then(c=>{a.add(c);const d=[];for(const l of c.lenses)i==null||l.symbol.command?r.push(l.symbol):i-- >0&&l.provider.resolveCodeLens&&d.push(Promise.resolve(l.provider.resolveCodeLens(o,l.symbol,ye.None)).then(u=>r.push(u||l.symbol)));return Promise.all(d)}).then(()=>r).finally(()=>{setTimeout(()=>a.dispose(),100)})});class vj{constructor(e,t){this.lineCount=e,this.data=t}}let cB=class{constructor(e){this._fakeProvider=new class{provideCodeLenses(){throw new Error("not supported")}},this._cache=new Bm(20,.75);const t="codelens/cache";Tie($i,()=>e.remove(t,he.WORKSPACE));const i="codelens/cache2",n=e.get(i,he.WORKSPACE,"{}");this._deserialize(n);const o=D.filter(e.onWillSaveState,r=>r.reason===Zx.SHUTDOWN);D.once(o)(r=>{e.store(i,this._serialize(),he.WORKSPACE,pt.MACHINE)})}put(e,t){const i=t.lenses.map(r=>({range:r.symbol.range,command:r.symbol.command&&{id:"",title:r.symbol.command?.title}})),n=new vy;n.add({lenses:i},this._fakeProvider);const o=new vj(e.getLineCount(),n);this._cache.set(e.uri.toString(),o)}get(e){const t=this._cache.get(e.uri.toString());return t&&t.lineCount===e.getLineCount()?t.data:void 0}delete(e){this._cache.delete(e.uri.toString())}_serialize(){const e=Object.create(null);for(const[t,i]of this._cache){const n=new Set;for(const o of i.data.lenses)n.add(o.symbol.range.startLineNumber);e[t]={lineCount:i.lineCount,lines:[...n.values()]}}return JSON.stringify(e)}_deserialize(e){try{const t=JSON.parse(e);for(const i in t){const n=t[i],o=[];for(const a of n.lines)o.push({range:new P(a,1,a,11)});const r=new vy;r.add({lenses:o},this._fakeProvider),this._cache.set(i,new vj(n.lineCount,r))}}catch{}}};cB=f([p(0,tt)],cB);const yDe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let pd=class extends hI{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(e,{...n.getRawOptions(),overflowWidgetsDomNode:n.getOverflowWidgetsDomNode()},i,o,r,a,c,d,l,u,g,m),this._parentEditor=n,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(n.onDidChangeConfiguration(v=>this._onParentConfigurationChanged(v)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){zu(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};pd=f([p(4,J),p(5,Ot),p(6,qe),p(7,me),p(8,ft),p(9,At),p(10,Tr),p(11,rs),p(12,Ne)],pd);function Xre(s){const e=s.get(Ot).getFocusedCodeEditor();return e instanceof pd?e.getParentEditor():e}const wDe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(wDe);const _j=new be(new Vm(0,122,204)),SDe={showArrow:!0,showFrame:!0,className:"",frameColor:_j,arrowColor:_j,keepEditorSelection:!1},CDe="vs.editor.contrib.zoneWidget";class EDe{constructor(e,t,i,n,o,r,a,c){this.id="",this.domNode=e,this.afterLineNumber=t,this.afterColumn=i,this.heightInLines=n,this.showInHiddenAreas=a,this.ordinal=c,this._onDomNodeTop=o,this._onComputedHeight=r}onDomNodeTop(e){this._onDomNodeTop(e)}onComputedHeight(e){this._onComputedHeight(e)}}class xDe{constructor(e,t){this._id=e,this._domNode=t}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}}class Mz{static{this._IdGenerator=new ome(".arrow-decoration-")}constructor(e){this._editor=e,this._ruleName=Mz._IdGenerator.nextId(),this._color=null,this._height=-1,this._decorations=this._editor.createDecorationsCollection()}dispose(){this.hide(),m7(this._ruleName)}set color(e){this._color!==e&&(this._color=e,this._updateStyle())}set height(e){this._height!==e&&(this._height=e,this._updateStyle())}_updateStyle(){m7(this._ruleName),OM(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `)}show(e){e.column===1&&(e={lineNumber:e.lineNumber,column:2}),this._decorations.set([{range:P.fromPositions(e),options:{description:"zone-widget-arrow",className:this._ruleName,stickiness:Di.NeverGrowsWhenTypingAtEdges}}])}hide(){this._decorations.clear()}}class Zre{constructor(e,t={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._isSashResizeHeight=!1,this._viewZone=null,this._disposables=new U,this.container=null,this._isShowing=!1,this.editor=e,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=Cr(t),zu(this.options,SDe,!1),this.domNode=document.createElement("div"),this.options.isAccessible||(this.domNode.setAttribute("aria-hidden","true"),this.domNode.setAttribute("role","presentation")),this._disposables.add(this.editor.onDidLayoutChange(i=>{const n=this._getWidth(i);this.domNode.style.width=n+"px",this.domNode.style.left=this._getLeft(i)+"px",this._onWidth(n)}))}dispose(){this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._viewZone&&this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add("zone-widget"),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement("div"),this.container.classList.add("zone-widget-container"),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new Mz(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(e){e.frameColor&&(this.options.frameColor=e.frameColor),e.arrowColor&&(this.options.arrowColor=e.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){const e=this.options.frameColor.toString();this.container.style.borderTopColor=e,this.container.style.borderBottomColor=e}if(this._arrow&&this.options.arrowColor){const e=this.options.arrowColor.toString();this._arrow.color=e}}_getWidth(e){return e.width-e.minimap.minimapWidth-e.verticalScrollbarWidth}_getLeft(e){return e.minimap.minimapWidth>0&&e.minimap.minimapLeft===0?e.minimap.minimapWidth:0}_onViewZoneTop(e){this.domNode.style.top=e+"px"}_onViewZoneHeight(e){if(this.domNode.style.height=`${e}px`,this.container){const t=e-this._decoratingElementsHeight();this.container.style.height=`${t}px`;const i=this.editor.getLayoutInfo();this._doLayout(t,this._getWidth(i))}this._resizeSash?.layout()}get position(){const e=this._positionMarkerId.getRange(0);if(e)return e.getStartPosition()}hasFocus(){return this.domNode.contains(Eh())}show(e,t){const i=P.isIRange(e)?P.lift(e):P.fromPositions(e);this._isShowing=!0,this._showImpl(i,t),this._isShowing=!1,this._positionMarkerId.set([{range:i,options:Yt.EMPTY}])}updatePositionAndHeight(e,t){this._viewZone&&(e=P.isIRange(e)?P.getStartPosition(e):e,this._viewZone.afterLineNumber=e.lineNumber,this._viewZone.afterColumn=e.column,this._viewZone.heightInLines=t??this._viewZone.heightInLines,this.editor.changeViewZones(i=>{i.layoutZone(this._viewZone.id)}),this._positionMarkerId.set([{range:P.isIRange(e)?e:P.fromPositions(e),options:Yt.EMPTY}]),this._updateSashEnablement())}hide(){this._viewZone&&(this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id)}),this._viewZone=null),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._arrow?.hide(),this._positionMarkerId.clear(),this._isSashResizeHeight=!1}_decoratingElementsHeight(){const e=this.editor.getOption(L.lineHeight);let t=0;if(this.options.showArrow){const i=Math.round(e/3);t+=2*i}if(this.options.showFrame){const i=this.options.frameWidth??Math.round(e/9);t+=2*i}return t}_getMaximumHeightInLines(){return Math.max(12,this.editor.getLayoutInfo().height/this.editor.getOption(L.lineHeight)*.8)}_showImpl(e,t){const i=e.getStartPosition(),n=this.editor.getLayoutInfo(),o=this._getWidth(n);this.domNode.style.width=`${o}px`,this.domNode.style.left=this._getLeft(n)+"px";const r=document.createElement("div");r.style.overflow="hidden";const a=this.editor.getOption(L.lineHeight),c=this._getMaximumHeightInLines();c!==void 0&&(t=Math.min(t,c));let d=0,l=0;if(this._arrow&&this.options.showArrow&&(d=Math.round(a/3),this._arrow.height=d,this._arrow.show(i)),this.options.showFrame&&(l=Math.round(a/9)),this.editor.changeViewZones(m=>{this._viewZone&&m.removeZone(this._viewZone.id),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this.domNode.style.top="-1000px",this._viewZone=new EDe(r,i.lineNumber,i.column,t,v=>this._onViewZoneTop(v),v=>this._onViewZoneHeight(v),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=m.addZone(this._viewZone),this._overlayWidget=new xDe(CDe+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this._updateSashEnablement(),this.container&&this.options.showFrame){const m=this.options.frameWidth?this.options.frameWidth:l;this.container.style.borderTopWidth=m+"px",this.container.style.borderBottomWidth=m+"px"}const u=t*a-this._decoratingElementsHeight();this.container&&(this.container.style.top=d+"px",this.container.style.height=u+"px",this.container.style.overflow="hidden"),this._doLayout(u,o),this.options.keepEditorSelection||this.editor.setSelection(e);const g=this.editor.getModel();if(g){const m=g.validateRange(new P(e.startLineNumber,1,e.endLineNumber+1,1));this.revealRange(m,m.startLineNumber===g.getLineCount())}}revealRange(e,t){t?this.editor.revealLineNearTop(e.endLineNumber,ji.Smooth):this.editor.revealRange(e,ji.Smooth)}setCssClass(e,t){this.container&&(t&&this.container.classList.remove(t),this.container.classList.add(e))}_onWidth(e){}_doLayout(e,t){}_relayout(e,t){const i=this._getMaximumHeightInLines(),n=t&&i!==void 0?Math.min(i,e):e;this._viewZone&&this._viewZone.heightInLines!==n&&(this.editor.changeViewZones(o=>{this._viewZone&&(this._viewZone.heightInLines=n,o.layoutZone(this._viewZone.id))}),this._updateSashEnablement())}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new H_(this.domNode,this,{orientation:wt.HORIZONTAL})),this.options.isResizeable||(this._resizeSash.state=Vd.Disabled);let e;this._disposables.add(this._resizeSash.onDidStart(t=>{this._viewZone&&(e={startY:t.startY,heightInLines:this._viewZone.heightInLines,...this._getResizeBounds()})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{e=void 0})),this._disposables.add(this._resizeSash.onDidChange(t=>{if(e){const i=(t.currentY-e.startY)/this.editor.getOption(L.lineHeight),n=i<0?Math.ceil(i):Math.floor(i),o=e.heightInLines+n;o>e.minLines&&o<e.maxLines&&(this._isSashResizeHeight=!0,this._relayout(o))}}))}_updateSashEnablement(){if(this._resizeSash){const{minLines:e,maxLines:t}=this._getResizeBounds();this._resizeSash.state=e===t?Vd.Disabled:Vd.Enabled}}get _usesResizeHeight(){return this._isSashResizeHeight}_getResizeBounds(){return{minLines:5,maxLines:35}}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){const e=this.editor.getLayoutInfo();return e.width-e.minimap.minimapWidth}}Be(yDe);class IDe{constructor(){this._widgets=new Map}addExclusiveWidget(e,t){const i=this._widgets.get(e);i&&(i.listener.dispose(),i.widget.dispose());const n=()=>{const o=this._widgets.get(e);o&&o.widget===t&&(o.listener.dispose(),this._widgets.delete(e))};this._widgets.set(e,{widget:t,listener:t.onDidClose(n)})}}var Ir;(function(s){s.inPeekEditor=new O("inReferenceSearchEditor",!0,h(1374,"Whether the current code editor is embedded inside peek")),s.notInPeekEditor=s.inPeekEditor.toNegated()})(Ir||(Ir={}));let PA=class{static{this.ID="editor.contrib.referenceController"}constructor(e,t){e instanceof pd&&Ir.inPeekEditor.bindTo(t)}dispose(){}};PA=f([p(1,me)],PA);Rt(PA.ID,PA,vt.Eager);const DDe={headerBackgroundColor:be.white,primaryHeadingColor:be.fromHex("#333333"),secondaryHeadingColor:be.fromHex("#6c6c6cb3")};let LA=class extends Zre{constructor(e,t,i){super(e,t),this.instantiationService=i,this._onDidClose=new M,this.onDidClose=this._onDidClose.event,zu(this.options,DDe,!1);const n=xs(this.editor);n.openedPeekWidgets.set(n.openedPeekWidgets.get()+1,void 0)}dispose(){if(!this.disposed){this.disposed=!0,super.dispose(),this._onDidClose.fire(this);const e=xs(this.editor);e.openedPeekWidgets.set(e.openedPeekWidgets.get()-1,void 0)}}style(e){const t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();const e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass("peekview-widget"),this._headElement=Y(".head"),this._bodyElement=Y(".body"),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){this._titleElement=Y(".peekview-title"),this.options.supportOnTitleClick&&(this._titleElement.classList.add("clickable"),co(this._titleElement,"click",o=>this._onTitleClick(o))),ee(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=Y("span.filename"),this._secondaryHeading=Y("span.dirname"),this._metaHeading=Y("span.meta"),ee(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);const i=Y(".peekview-actions");ee(this._headElement,i);const n=this._getActionBarOptions();this._actionbarWidget=new Er(i,n),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(this._disposables.add(new Kt("peekview.close",h(1375,"Close"),Te.asClassName(j.close),!0,()=>(this.dispose(),Promise.resolve()))),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:dw.bind(void 0,this.instantiationService),orientation:xa.HORIZONTAL}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute("title",e),t?this._secondaryHeading.innerText=t:Yi(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,Ho(this._metaHeading)):Hs(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0){this.dispose();return}const i=Math.ceil(this.editor.getOption(L.lineHeight)*1.2),n=Math.round(e-(i+1));this._doLayoutHead(i,t),this._doLayoutBody(n,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=`${e}px`)}};LA=f([p(2,J)],LA);const Jre=H("peekViewTitle.background",{dark:"#252526",light:"#F3F3F3",hcDark:be.black,hcLight:be.white},h(1376,"Background color of the peek view title area.")),eae=H("peekViewTitleLabel.foreground",{dark:be.white,light:be.black,hcDark:be.white,hcLight:ao},h(1377,"Color of the peek view title.")),tae=H("peekViewTitleDescription.foreground",{dark:"#ccccccb3",light:"#616161",hcDark:"#FFFFFF99",hcLight:"#292929"},h(1378,"Color of the peek view title info.")),iae=H("peekView.border",{dark:mE,light:mE,hcDark:et,hcLight:et},h(1379,"Color of the peek view borders and arrow.")),kDe=H("peekViewResult.background",{dark:"#252526",light:"#F3F3F3",hcDark:be.black,hcLight:be.white},h(1380,"Background color of the peek view result list."));H("peekViewResult.lineForeground",{dark:"#bbbbbb",light:"#646465",hcDark:be.white,hcLight:ao},h(1381,"Foreground color for line nodes in the peek view result list."));H("peekViewResult.fileForeground",{dark:be.white,light:"#1E1E1E",hcDark:be.white,hcLight:ao},h(1382,"Foreground color for file nodes in the peek view result list."));H("peekViewResult.selectionBackground",{dark:"#3399ff33",light:"#3399ff33",hcDark:null,hcLight:null},h(1383,"Background color of the selected entry in the peek view result list."));H("peekViewResult.selectionForeground",{dark:be.white,light:"#6C6C6C",hcDark:be.white,hcLight:ao},h(1384,"Foreground color of the selected entry in the peek view result list."));const nae=H("peekViewEditor.background",{dark:"#001F33",light:"#F2F8FC",hcDark:be.black,hcLight:be.white},h(1385,"Background color of the peek view editor."));H("peekViewEditorGutter.background",nae,h(1386,"Background color of the gutter in the peek view editor."));H("peekViewEditorStickyScroll.background",nae,h(1387,"Background color of sticky scroll in the peek view editor."));H("peekViewResult.matchHighlightBackground",{dark:"#ea5c004d",light:"#ea5c004d",hcDark:null,hcLight:null},h(1388,"Match highlight color in the peek view result list."));const M6e=H("peekViewEditor.matchHighlightBackground",{dark:"#ff8f0099",light:"#f5d802de",hcDark:null,hcLight:null},h(1389,"Match highlight color in the peek view editor."));H("peekViewEditor.matchHighlightBorder",{dark:null,light:null,hcDark:Sr,hcLight:Sr},h(1390,"Match highlight border in the peek view editor."));class bj{constructor(e,t,i){this.marker=e,this.index=t,this.total=i}}let dB=class{constructor(e,t,i){this._markerService=t,this._configService=i,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._dispoables=new U,this._markers=[],this._nextIdx=-1,R.isUri(e)?this._resourceFilter=a=>a.toString()===e.toString():e&&(this._resourceFilter=e);const n=this._configService.getValue("problems.sortOrder"),o=(a,c)=>{let d=RT(a.resource.toString(),c.resource.toString());return d===0&&(n==="position"?d=P.compareRangesUsingStarts(a,c)||Mn.compare(a.severity,c.severity):d=Mn.compare(a.severity,c.severity)||P.compareRangesUsingStarts(a,c)),d},r=()=>{let a=this._markerService.read({resource:R.isUri(e)?e:void 0,severities:Mn.Error|Mn.Warning|Mn.Info});return typeof e=="function"&&(a=a.filter(c=>this._resourceFilter(c.resource))),a.sort(o),ns(a,this._markers,(c,d)=>c.resource.toString()===d.resource.toString()&&c.startLineNumber===d.startLineNumber&&c.startColumn===d.startColumn&&c.endLineNumber===d.endLineNumber&&c.endColumn===d.endColumn&&c.severity===d.severity&&c.message===d.message)?!1:(this._markers=a,!0)};r(),this._dispoables.add(t.onMarkerChanged(a=>{(!this._resourceFilter||a.some(c=>this._resourceFilter(c)))&&r()&&(this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e?!0:!this._resourceFilter||!e?!1:this._resourceFilter(e)}get selected(){const e=this._markers[this._nextIdx];return e&&new bj(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,i){let n=this._markers.findIndex(o=>Dt(o.resource,e.uri));if(n<0)n=rme(this._markers.length,o=>RT(this._markers[o].resource.toString(),e.uri.toString())),n<0&&(n=~n),i?this._nextIdx=n:this._nextIdx=(this._markers.length+n-1)%this._markers.length;else{let o=!1,r=!1;for(let a=n;a<this._markers.length;a++){let c=P.lift(this._markers[a]);if(c.isEmpty()){const d=e.getWordAtPosition(c.getStartPosition());d&&(c=new P(c.startLineNumber,d.startColumn,c.startLineNumber,d.endColumn))}if(t&&(c.containsPosition(t)||t.isBeforeOrEqual(c.getStartPosition()))){this._nextIdx=a,o=!0,r=!c.containsPosition(t);break}if(this._markers[a].resource.toString()!==e.uri.toString())break}o?r&&!i&&(this._nextIdx-=1):this._nextIdx=i?0:this._markers.length-1}this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,i){if(this._markers.length===0)return!1;const n=this._nextIdx;return this._nextIdx===-1?this._initIdx(t,i,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),n!==this._nextIdx}find(e,t){let i=this._markers.findIndex(n=>n.resource.toString()===e.toString());if(!(i<0)){for(;i<this._markers.length;i++)if(P.containsPosition(this._markers[i],t))return new bj(this._markers[i],i+1,this._markers.length)}}};dB=f([p(1,FM),p(2,ne)],dB);let lB=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new aq}registerProvider(e){const t=this._provider.unshift(e);return Ee(()=>t())}getMarkerList(e){for(const t of this._provider){const i=t.getMarkerList(e);if(i)return i}return new dB(e,this._markerService,this._configService)}};lB=f([p(0,FM),p(1,ne)],lB);function hB(s,e){return!!s[e]}class v0{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.hasTriggerModifier=hB(e.event,t.triggerModifier),this.hasSideBySideModifier=hB(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}}class yj{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=hB(e,t.triggerModifier)}}class qD{constructor(e,t,i,n){this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=i,this.triggerSideBySideModifier=n}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}}function wj(s){return s==="altKey"?qt?new qD(S.Meta,"metaKey",S.Alt,"altKey"):new qD(S.Ctrl,"ctrlKey",S.Alt,"altKey"):qt?new qD(S.Alt,"altKey",S.Meta,"metaKey"):new qD(S.Alt,"altKey",S.Ctrl,"ctrlKey")}class zN extends F{constructor(e,t){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new M),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new M),this.onExecute=this._onExecute.event,this._onCancel=this._register(new M),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=t?.extractLineNumberFromMouseEvent??(i=>i.target.position?i.target.position.lineNumber:0),this._opts=wj(this._editor.getOption(L.multiCursorModifier)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(i=>{if(i.hasChanged(L.multiCursorModifier)){const n=wj(this._editor.getOption(L.multiCursorModifier));if(this._opts.equals(n))return;this._opts=n,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(i=>this._onEditorMouseMove(new v0(i,this._opts)))),this._register(this._editor.onMouseDown(i=>this._onEditorMouseDown(new v0(i,this._opts)))),this._register(this._editor.onMouseUp(i=>this._onEditorMouseUp(new v0(i,this._opts)))),this._register(this._editor.onKeyDown(i=>this._onEditorKeyDown(new yj(i,this._opts)))),this._register(this._editor.onKeyUp(i=>this._onEditorKeyUp(new yj(i,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(i=>this._onDidChangeCursorSelection(i))),this._register(this._editor.onDidChangeModel(i=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(i=>{(i.scrollTopChanged||i.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){const t=this._extractLineNumberFromMouseEvent(e);this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}class sae{constructor(e,t){this.range=e,this.direction=t}}class Nz{constructor(e,t,i){this.hint=e,this.anchor=t,this.provider=i,this._isResolved=!1}with(e){const t=new Nz(this.hint,e.anchor,this.provider);return t._isResolved=this._isResolved,t._currentResolve=this._currentResolve,t}async resolve(e){if(typeof this.provider.resolveInlayHint=="function"){if(this._currentResolve)return await this._currentResolve,e.isCancellationRequested?void 0:this.resolve(e);this._isResolved||(this._currentResolve=this._doResolve(e).finally(()=>this._currentResolve=void 0)),await this._currentResolve}}async _doResolve(e){try{const t=await Promise.resolve(this.provider.resolveInlayHint(this.hint,e));this.hint.tooltip=t?.tooltip??this.hint.tooltip,this.hint.label=t?.label??this.hint.label,this.hint.textEdits=t?.textEdits??this.hint.textEdits,this._isResolved=!0}catch(t){kn(t),this._isResolved=!1}}}class Nb{static{this._emptyInlayHintList=Object.freeze({dispose(){},hints:[]})}static async create(e,t,i,n){const o=[],r=e.ordered(t).reverse().map(a=>i.map(async c=>{try{const d=await a.provideInlayHints(t,c,n);(d?.hints.length||a.onDidChangeInlayHints)&&o.push([d??Nb._emptyInlayHintList,a])}catch(d){kn(d)}}));if(await Promise.all(r.flat()),n.isCancellationRequested||t.isDisposed())throw new $s;return new Nb(i,o,t)}constructor(e,t,i){this._disposables=new U,this.ranges=e,this.provider=new Set;const n=[];for(const[o,r]of t){this._disposables.add(o),this.provider.add(r);for(const a of o.hints){const c=i.validatePosition(a.position);let d="before";const l=Nb._getRangeAtPosition(i,c);let u;l.getStartPosition().isBefore(c)?(u=P.fromPositions(l.getStartPosition(),c),d="after"):(u=P.fromPositions(c,l.getEndPosition()),d="before"),n.push(new Nz(a,new sae(u,d),r))}}this.items=n.sort((o,r)=>_e.compare(o.hint.position,r.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(e,t){const i=t.lineNumber,n=e.getWordAtPosition(t);if(n)return new P(i,n.startColumn,i,n.endColumn);e.tokenization.tokenizeIfCheap(i);const o=e.tokenization.getLineTokens(i),r=t.column-1,a=o.findTokenIndexAtOffset(r);let c=o.getStartOffset(a),d=o.getEndOffset(a);return d-c===1&&(c===r&&a>1?(c=o.getStartOffset(a-1),d=o.getEndOffset(a-1)):d===r&&a<o.getCount()-1&&(c=o.getStartOffset(a+1),d=o.getEndOffset(a+1))),new P(i,c+1,i,d+1)}}function oae(s){return R.from({scheme:ae.command,path:s.id,query:s.arguments&&encodeURIComponent(JSON.stringify(s.arguments))}).toString()}class ag{constructor(e,t,i,n){this.isProviderFirst=e,this.parent=t,this.link=i,this._rangeCallback=n,this.id=ame.nextId()}get uri(){return this.link.uri}get range(){return this._range??this.link.targetSelectionRange??this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){const e=this.parent.getPreview(this)?.preview(this.range);return e?h(1149,"{0} in {1} on line {2} at column {3}",e.value,je(this.uri),this.range.startLineNumber,this.range.startColumn):h(1148,"in {0} on line {1} at column {2}",je(this.uri),this.range.startLineNumber,this.range.startColumn)}}class TDe{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){const i=this._modelReference.object.textEditorModel;if(!i)return;const{startLineNumber:n,startColumn:o,endLineNumber:r,endColumn:a}=e,c=i.getWordUntilPosition({lineNumber:n,column:o-t}),d=new P(n,c.startColumn,n,o),l=new P(r,a,r,dc.MAX_SAFE_SMALL_INTEGER),u=i.getValueInRange(d).replace(/^\s+/,""),g=i.getValueInRange(e),m=i.getValueInRange(l).replace(/\s+$/,"");return{value:u+g+m,highlight:{start:u.length,end:u.length+g.length}}}}class _y{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new wn}dispose(){Qe(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){const e=this.children.length;return e===1?h(1150,"1 symbol in {0}, full path {1}",je(this.uri),this.uri.fsPath):h(1151,"{0} symbols in {1}, full path {2}",e,je(this.uri),this.uri.fsPath)}async resolve(e){if(this._previews.size!==0)return this;for(const t of this.children)if(!this._previews.has(t.uri))try{const i=await e.createModelReference(t.uri);this._previews.set(t.uri,new TDe(i))}catch(i){mt(i)}return this}}class ia{constructor(e,t){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new M,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=e,this._title=t;const[i]=e;e.sort(ia._compareReferences);let n;for(const o of e)if((!n||!vE.isEqual(n.uri,o.uri,!0))&&(n=new _y(this,o.uri),this.groups.push(n)),n.children.length===0||ia._compareReferences(o,n.children[n.children.length-1])!==0){const r=new ag(i===o,n,o,a=>this._onDidChangeReferenceRange.fire(a));this.references.push(r),n.children.push(r)}}dispose(){Qe(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new ia(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?h(1152,"No results found"):this.references.length===1?h(1153,"Found 1 symbol in {0}",this.references[0].uri.fsPath):this.groups.length===1?h(1154,"Found {0} symbols in {1}",this.references.length,this.groups[0].uri.fsPath):h(1155,"Found {0} symbols in {1} files",this.references.length,this.groups.length)}nextOrPreviousReference(e,t){const{parent:i}=e;let n=i.children.indexOf(e);const o=i.children.length,r=i.parent.groups.length;return r===1||t&&n+1<o||!t&&n>0?(t?n=(n+1)%o:n=(n+o-1)%o,i.children[n]):(n=i.parent.groups.indexOf(i),t?(n=(n+1)%r,i.parent.groups[n].children[0]):(n=(n+r-1)%r,i.parent.groups[n].children[i.parent.groups[n].children.length-1]))}nearestReference(e,t){const i=this.references.map((n,o)=>({idx:o,prefixLen:rf(n.uri.toString(),e.toString()),offsetDist:Math.abs(n.range.startLineNumber-t.lineNumber)*100+Math.abs(n.range.startColumn-t.column)})).sort((n,o)=>n.prefixLen>o.prefixLen?-1:n.prefixLen<o.prefixLen?1:n.offsetDist<o.offsetDist?-1:n.offsetDist>o.offsetDist?1:0)[0];if(i)return this.references[i.idx]}referenceAt(e,t){for(const i of this.references)if(i.uri.toString()===e.toString()&&P.containsPosition(i.range,t))return i}firstReference(){for(const e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return vE.compare(e.uri,t.uri)||P.compareRangesUsingStarts(e.range,t.range)}}const ADe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var uB;let gB=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof ia||e instanceof _y}getChildren(e){if(e instanceof ia)return e.groups;if(e instanceof _y)return e.resolve(this._resolverService).then(t=>t.children);throw new Error("bad tree")}};gB=f([p(0,yi)],gB);class RDe{getHeight(){return 23}getTemplateId(e){return e instanceof _y?MA.id:KN.id}}let pB=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){if(e instanceof ag){const t=e.parent.getPreview(e)?.preview(e.range);if(t)return t.value}return je(e.uri)}mightProducePrintableCharacter(e){return this._keybindingService.mightProducePrintableCharacter(e)}};pB=f([p(0,Ve)],pB);class PDe{getId(e){return e instanceof ag?e.id:e.uri}}let fB=class extends F{constructor(e,t){super(),this._labelService=t;const i=document.createElement("div");i.classList.add("reference-file"),this.file=this._register(new cq(i,{supportHighlights:!0})),this.badge=this._register(new Aie(ee(i,Y(".count")),{},Rie)),e.appendChild(i)}set(e,t){const i=hs(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(i,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});const n=e.children.length;this.badge.setCount(n),n>1?this.badge.setTitleFormat(h(1142,"{0} references",n)):this.badge.setTitleFormat(h(1143,"{0} reference",n))}};fB=f([p(1,di)],fB);let MA=class{static{uB=this}static{this.id="FileReferencesRenderer"}constructor(e){this._instantiationService=e,this.templateId=uB.id}renderTemplate(e){return this._instantiationService.createInstance(fB,e)}renderElement(e,t,i){i.set(e.element,lw(e.filterData))}disposeTemplate(e){e.dispose()}};MA=uB=f([p(0,J)],MA);class LDe extends F{constructor(e){super(),this.label=this._register(new cme(e))}set(e,t){const i=e.parent.getPreview(e)?.preview(e.range);if(!i||!i.value)this.label.set(`${je(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`);else{const{value:n,highlight:o}=i;t&&!_E.isDefault(t)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(n,lw(t))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(n,[o]))}}}class KN{constructor(){this.templateId=KN.id}static{this.id="OneReferenceRenderer"}renderTemplate(e){return new LDe(e)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}}class MDe{getWidgetAriaLabel(){return h(1144,"References")}getAriaLabel(e){return e.ariaMessage}}Be(ADe);class Oz{static{this.DecorationOptions=Yt.register({description:"reference-decoration",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"reference-decoration"})}constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new U,this._callOnModelChange=new U,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();const e=this._editor.getModel();if(e){for(const t of this._model.references)if(t.uri.toString()===e.uri.toString()){this._addDecorations(t.parent);return}}}_addDecorations(e){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));const t=[],i=[];for(let n=0,o=e.children.length;n<o;n++){const r=e.children[n];this._decorationIgnoreSet.has(r.id)||r.uri.toString()===this._editor.getModel().uri.toString()&&(t.push({range:r.range,options:Oz.DecorationOptions}),i.push(n))}this._editor.changeDecorations(n=>{const o=n.deltaDecorations([],t);for(let r=0;r<o.length;r++)this._decorations.set(o[r],e.children[i[r]])})}_onDecorationChanged(){const e=[],t=this._editor.getModel();if(t){for(const[i,n]of this._decorations){const o=t.getDecorationRange(i);if(!o)continue;let r=!1;if(!P.equalsRange(o,n.range)){if(P.spansMultipleLines(o))r=!0;else{const a=n.range.endColumn-n.range.startColumn,c=o.endColumn-o.startColumn;a!==c&&(r=!0)}r?(this._decorationIgnoreSet.add(n.id),e.push(i)):n.range=o}}for(let i=0,n=e.length;i<n;i++)this._decorations.delete(e[i]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}}class NDe{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,i;try{const n=JSON.parse(e);t=n.ratio,i=n.heightInLines}catch{}return{ratio:t||.7,heightInLines:i||18}}}class ODe extends dq{}let mB=class{constructor(e){this.labelService=e,this.disposables=new U}getDragURI(e){return e instanceof _y?e.uri.toString():e instanceof ag?_F(e.uri,e.range).toString():null}getDragLabel(e){return e.length===0?void 0:e.map(i=>this.labelService.getUriBasenameLabel(i.uri)).join(", ")}onDragStart(e,t){if(!t.dataTransfer)return;const n=e.elements.map(o=>this.getDragURI(o)).filter(Boolean);n.length&&(t.dataTransfer.setData(bs.RESOURCES,JSON.stringify(n)),t.dataTransfer.setData(bs.TEXT,n.join(`
`)))}onDragOver(){return!1}drop(){}dispose(){this.disposables.dispose()}};mB=f([p(0,di)],mB);let vB=class extends LA{constructor(e,t,i,n,o,r,a,c,d){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},r),this._defaultTreeKeyboardSupport=t,this.layoutData=i,this._textModelResolverService=o,this._instantiationService=r,this._peekViewService=a,this._uriLabel=c,this._keybindingService=d,this._disposeOnNewModel=new U,this._callOnDispose=new U,this._onDidSelectReference=new M,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new Ke(0,0),this._isClosing=!1,this._applyTheme(n.getColorTheme()),this._callOnDispose.add(n.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}get isClosing(){return this._isClosing}dispose(){this._isClosing=!0,this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),Qe(this._preview),Qe(this._previewNotAvailableMessage),Qe(this._tree),Qe(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){const t=e.getColor(iae)||be.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Jre)||be.transparent,primaryHeadingColor:e.getColor(eae),secondaryHeadingColor:e.getColor(tae)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?"side":"open",source:"title"})}_fillBody(e){this.setCssClass("reference-zone-widget"),this._messageContainer=ee(e,Y("div.messages")),Hs(this._messageContainer),this._splitView=new PT(e,{orientation:wt.HORIZONTAL}),this._previewContainer=ee(e,Y("div.preview.inline"));const t={scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}};this._preview=this._instantiationService.createInstance(pd,this._previewContainer,t,{},this.editor),Hs(this._previewContainer),this._previewNotAvailableMessage=this._instantiationService.createInstance(ty,h(1145,"no preview available"),WM,ty.DEFAULT_CREATION_OPTIONS,null),this._treeContainer=ee(e,Y("div.ref-tree.inline"));const i={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new MDe,keyboardNavigationLabelProvider:this._instantiationService.createInstance(pB),identityProvider:new PDe,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:kDe},dnd:this._instantiationService.createInstance(mB)};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(co(this._treeContainer,"keydown",o=>{o.equals(S.Escape)&&(this._keybindingService.dispatchEvent(o,o.target),o.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(ODe,"ReferencesWidget",this._treeContainer,new RDe,[this._instantiationService.createInstance(MA),this._instantiationService.createInstance(KN)],this._instantiationService.createInstance(gB),i),this._splitView.addView({onDidChange:D.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:o=>{this._preview.layout({height:this._dim.height,width:o})}},bE.Distribute),this._splitView.addView({onDidChange:D.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:o=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${o}px`,this._tree.layout(this._dim.height,o)}},bE.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));const n=(o,r)=>{o instanceof ag&&(r==="show"&&this._revealReference(o,!1),this._onDidSelectReference.fire({element:o,kind:r,source:"tree"}))};this._disposables.add(this._tree.onDidOpen(o=>{o.sideBySide?n(o.element,"side"):o.editorOptions.pinned?n(o.element,"goto"):n(o.element,"show")})),Hs(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new Ke(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(""),this._messageContainer.innerText=h(1146,"No results"),Ho(this._messageContainer),Promise.resolve(void 0)):(Hs(this._messageContainer),this._decorationsManager=new Oz(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{const{event:t,target:i}=e;if(t.detail!==2)return;const n=this._getFocusedReference();n&&this._onDidSelectReference.fire({element:{uri:n.uri,range:i.range},kind:t.ctrlKey||t.metaKey||t.altKey?"side":"open",source:"editor"})})),this.container.classList.add("results-loaded"),Ho(this._treeContainer),Ho(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){const[e]=this._tree.getFocus();if(e instanceof ag)return e;if(e instanceof _y&&e.children.length>0)return e.children[0]}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:"goto",source:"tree"})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme!==ae.inMemory?this.setTitle(el(e.uri),this._uriLabel.getUriLabel(hs(e.uri))):this.setTitle(h(1147,"References"));const i=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent?this._tree.reveal(e):(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent),this._tree.reveal(e));const n=await i;if(!this._model){n.dispose();return}Qe(this._previewModelReference);const o=n.object;if(o){const r=this._preview.getModel()===o.textEditorModel?ji.Smooth:ji.Immediate,a=P.lift(e.range).collapseToStart();this._previewModelReference=n,this._preview.setModel(o.textEditorModel),this._preview.setSelection(a),this._preview.revealRangeInCenter(a,r)}else this._preview.setModel(this._previewNotAvailableMessage),n.dispose()}};vB=f([p(3,ft),p(4,yi),p(5,J),p(6,jre),p(7,di),p(8,Ve)],vB);var Vk;const Gv=new O("referenceSearchVisible",!1,h(1139,"Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));let sv=class{static{Vk=this}static{this.ID="editor.contrib.referencesController"}static get(e){return e.getContribution(Vk.ID)}constructor(e,t,i,n,o,r,a,c){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=n,this._notificationService=o,this._instantiationService=r,this._storageService=a,this._configurationService=c,this._disposables=new U,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=Gv.bindTo(i)}dispose(){this._referenceSearchVisible.reset(),this._disposables.dispose(),this._widget?.dispose(),this._model?.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,i){let n;if(this._widget&&(n=this._widget.position),this.closeWidget(),n&&e.containsPosition(n))return;this._peekMode=i,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));const o="peekViewLayout",r=NDe.fromJSON(this._storageService.get(o,he.PROFILE,"{}"));this._widget=this._instantiationService.createInstance(vB,this._editor,this._defaultTreeKeyboardSupport,r),this._widget.setTitle(h(1140,"Loading...")),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget?(this._storageService.store(o,JSON.stringify(this._widget.layoutData),he.PROFILE,pt.MACHINE),this._widget.isClosing||this.closeWidget(),this._widget=void 0):this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(c=>{const{element:d,kind:l}=c;if(d)switch(l){case"open":(c.source!=="editor"||!this._configurationService.getValue("editor.stablePeek"))&&this.openReference(d,!1,!1);break;case"side":this.openReference(d,!0,!1);break;case"goto":i?this._gotoReference(d,!0):this.openReference(d,!1,!0);break}}));const a=++this._requestIdPool;t.then(c=>{if(a!==this._requestIdPool||!this._widget){c.dispose();return}return this._model?.dispose(),this._model=c,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(h(1141,"{0} ({1})",this._model.title,this._model.references.length));const d=this._editor.getModel().uri,l=new _e(e.startLineNumber,e.startColumn),u=this._model.nearestReference(d,l);if(u)return this._widget.setSelection(u).then(()=>{this._widget&&this._editor.getOption(L.peekWidgetDefaultFocus)==="editor"&&this._widget.focusOnPreviewEditor()})}})},c=>{this._notificationService.error(c)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;const t=this._widget.position;if(!t)return;const i=this._model.nearestReference(this._editor.getModel().uri,t);if(!i)return;const n=this._model.nextOrPreviousReference(i,e),o=this._editor.hasTextFocus(),r=this._widget.isPreviewEditorFocused();await this._widget.setSelection(n),await this._gotoReference(n,!1),o?this._editor.focus():this._widget&&r&&this._widget.focusOnPreviewEditor()}async revealReference(e){!this._editor.hasModel()||!this._model||!this._widget||await this._widget.revealReference(e)}closeWidget(e=!0){this._widget?.dispose(),this._model?.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){this._widget?.hide(),this._ignoreModelChangeEvent=!0;const i=P.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:i,selectionSource:sd.JUMP,pinned:t}},this._editor).then(n=>{if(this._ignoreModelChangeEvent=!1,!n||!this._widget){this.closeWidget();return}if(this._editor===n)this._widget.show(i),this._widget.focusOnReferenceTree();else{const o=Vk.get(n),r=this._model.clone();this.closeWidget(),n.focus(),o?.toggleWidget(i,En(a=>Promise.resolve(r)),this._peekMode??!1)}},n=>{this._ignoreModelChangeEvent=!1,mt(n)})}openReference(e,t,i){t||this.closeWidget();const{uri:n,range:o}=e;this._editorService.openCodeEditor({resource:n,options:{selection:o,selectionSource:sd.JUMP,pinned:i}},this._editor,t)}};sv=Vk=f([p(2,me),p(3,Ot),p(4,At),p(5,J),p(6,tt),p(7,ne)],sv);function qv(s,e){const t=Xre(s);if(!t)return;const i=sv.get(t);i&&e(i)}Le.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:W.EditorContrib,primary:lt(E.CtrlCmd|S.KeyK,S.F2),when:x.or(Gv,Ir.inPeekEditor),handler(s){qv(s,e=>{e.changeFocusBetweenPreviewAndReferences()})}});Le.registerCommandAndKeybindingRule({id:"goToNextReference",weight:W.EditorContrib-10,primary:S.F4,secondary:[S.F12],when:x.or(Gv,Ir.inPeekEditor),handler(s){qv(s,e=>{e.goToNextOrPreviousReference(!0)})}});Le.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:W.EditorContrib-10,primary:E.Shift|S.F4,secondary:[E.Shift|S.F12],when:x.or(Gv,Ir.inPeekEditor),handler(s){qv(s,e=>{e.goToNextOrPreviousReference(!1)})}});Ce.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference");Ce.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference");Ce.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch");Ce.registerCommand("closeReferenceSearch",s=>qv(s,e=>e.closeWidget()));Le.registerKeybindingRule({id:"closeReferenceSearch",weight:W.EditorContrib-101,primary:S.Escape,secondary:[E.Shift|S.Escape],when:x.and(Ir.inPeekEditor,x.not("config.editor.stablePeek"))});Le.registerKeybindingRule({id:"closeReferenceSearch",weight:W.WorkbenchContrib+50,primary:S.Escape,secondary:[E.Shift|S.Escape],when:x.and(Gv,x.not("config.editor.stablePeek"),x.or(V.editorTextFocus,dme.negate()))});Le.registerCommandAndKeybindingRule({id:"revealReference",weight:W.WorkbenchContrib,primary:S.Enter,mac:{primary:S.Enter,secondary:[E.CtrlCmd|S.DownArrow]},when:x.and(Gv,af,Pie.negate(),Lie.negate()),handler(s){const t=s.get(Si).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ag&&qv(s,i=>i.revealReference(t[0]))}});Le.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:W.EditorContrib,primary:E.CtrlCmd|S.Enter,mac:{primary:E.WinCtrl|S.Enter},when:x.and(Gv,af,Pie.negate(),Lie.negate()),handler(s){const t=s.get(Si).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ag&&qv(s,i=>i.openReference(t[0],!0,!0))}});Ce.registerCommand("openReference",s=>{const t=s.get(Si).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof ag&&qv(s,i=>i.openReference(t[0],!1,!0))});const FDe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Hk;Be(FDe);let wr=class{static{Hk=this}static{this.ID="editor.contrib.messageController"}static{this.MESSAGE_VISIBLE=new O("messageVisible",!1,h(1345,"Whether the editor is currently showing an inline message"))}static get(e){return e.getContribution(Hk.ID)}constructor(e,t,i){this._openerService=i,this._messageWidget=new kt,this._messageListeners=new U,this._mouseOverMessage=!1,this._editor=e,this._visible=Hk.MESSAGE_VISIBLE.bindTo(t)}dispose(){this._message?.dispose(),this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}isVisible(){return this._visible.get()}showMessage(e,t){ta(ec(e)?e.value:e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),this._message=ec(e)?lq(e,{actionHandler:{callback:n=>{this.closeMessage(),Mie(this._openerService,n,ec(e)?e.isTrusted:void 0)},disposables:this._messageListeners}}):void 0,this._messageWidget.value=new Sj(this._editor,t,typeof e=="string"?e:this._message.element),this._messageListeners.add(D.debounce(this._editor.onDidBlurEditorText,(n,o)=>o,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&Ku(Eh(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(re(this._messageWidget.value.getDomNode(),pe.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add(re(this._messageWidget.value.getDomNode(),pe.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let i;this._messageListeners.add(this._editor.onMouseMove(n=>{n.target.position&&(i?i.containsPosition(n.target.position)||this.closeMessage():i=new P(t.lineNumber-3,1,n.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(Sj.fadeOut(this._messageWidget.value))}};wr=Hk=f([p(1,me),p(2,hi)],wr);const WDe=No.bindToContribution(wr.get);Ue(new WDe({id:"leaveEditorMessage",precondition:wr.MESSAGE_VISIBLE,handler:s=>s.closeMessage(),kbOpts:{weight:W.EditorContrib+30,primary:S.Escape}}));let Sj=class{static fadeOut(e){const t=()=>{e.dispose(),clearTimeout(i),e.getDomNode().removeEventListener("animationend",t)},i=setTimeout(t,110);return e.getDomNode().addEventListener("animationend",t),e.getDomNode().classList.add("fadeOut"),{dispose:t}}constructor(e,{lineNumber:t,column:i},n){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,ji.Smooth),this._position={lineNumber:t,column:i},this._domNode=document.createElement("div"),this._domNode.classList.add("monaco-editor-overlaymessage"),this._domNode.style.marginLeft="-6px";const o=document.createElement("div");o.classList.add("anchor","top"),this._domNode.appendChild(o);const r=document.createElement("div");typeof n=="string"?(r.classList.add("message"),r.textContent=n):(n.classList.add("message"),r.appendChild(n)),this._domNode.appendChild(r);const a=document.createElement("div");a.classList.add("anchor","below"),this._domNode.appendChild(a),this._editor.addContentWidget(this),this._domNode.classList.add("fadeIn")}dispose(){this._editor.removeContentWidget(this)}getId(){return"messageoverlay"}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[Oi.ABOVE,Oi.BELOW],positionAffinity:Jx.Right}}afterRender(e){this._domNode.classList.toggle("below",e===Oi.BELOW)}};Rt(wr.ID,wr,vt.Lazy);function _B(s,e){return e.uri.scheme===s.uri.scheme?!0:!hq(e.uri,ae.walkThroughSnippet,ae.vscodeChatCodeBlock,ae.vscodeChatCodeCompareBlock)}async function TI(s,e,t,i,n){const r=t.ordered(s,i).map(c=>Promise.resolve(n(c,s,e)).then(void 0,d=>{kn(d)})),a=await Promise.all(r);return Vt(a.flat()).filter(c=>_B(s,c))}function AI(s,e,t,i,n){return TI(e,t,s,i,(o,r,a)=>o.provideDefinition(r,a,n))}function Fz(s,e,t,i,n){return TI(e,t,s,i,(o,r,a)=>o.provideDeclaration(r,a,n))}function Wz(s,e,t,i,n){return TI(e,t,s,i,(o,r,a)=>o.provideImplementation(r,a,n))}function Bz(s,e,t,i,n){return TI(e,t,s,i,(o,r,a)=>o.provideTypeDefinition(r,a,n))}function RI(s,e,t,i,n,o){return TI(e,t,s,n,async(r,a,c)=>{const d=(await r.provideReferences(a,c,{includeDeclaration:!0},o))?.filter(u=>_B(a,u));if(!i||!d||d.length!==2)return d;const l=(await r.provideReferences(a,c,{includeDeclaration:!1},o))?.filter(u=>_B(a,u));return l&&l.length===1?l:d})}async function Gh(s){const e=await s(),t=new ia(e,""),i=t.references.map(n=>n.link);return t.dispose(),i}Ar("_executeDefinitionProvider",(s,e,t)=>{const i=s.get(Ne),n=AI(i.definitionProvider,e,t,!1,ye.None);return Gh(()=>n)});Ar("_executeDefinitionProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=AI(i.definitionProvider,e,t,!0,ye.None);return Gh(()=>n)});Ar("_executeTypeDefinitionProvider",(s,e,t)=>{const i=s.get(Ne),n=Bz(i.typeDefinitionProvider,e,t,!1,ye.None);return Gh(()=>n)});Ar("_executeTypeDefinitionProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=Bz(i.typeDefinitionProvider,e,t,!0,ye.None);return Gh(()=>n)});Ar("_executeDeclarationProvider",(s,e,t)=>{const i=s.get(Ne),n=Fz(i.declarationProvider,e,t,!1,ye.None);return Gh(()=>n)});Ar("_executeDeclarationProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=Fz(i.declarationProvider,e,t,!0,ye.None);return Gh(()=>n)});Ar("_executeReferenceProvider",(s,e,t)=>{const i=s.get(Ne),n=RI(i.referenceProvider,e,t,!1,!1,ye.None);return Gh(()=>n)});Ar("_executeReferenceProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=RI(i.referenceProvider,e,t,!1,!0,ye.None);return Gh(()=>n)});Ar("_executeImplementationProvider",(s,e,t)=>{const i=s.get(Ne),n=Wz(i.implementationProvider,e,t,!1,ye.None);return Gh(()=>n)});Ar("_executeImplementationProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=Wz(i.implementationProvider,e,t,!0,ye.None);return Gh(()=>n)});ge.appendMenuItem(N.EditorContext,{submenu:N.EditorContextPeek,title:h(1103,"Peek"),group:"navigation",order:100});class by{static is(e){return!e||typeof e!="object"?!1:!!(e instanceof by||_e.isIPosition(e.position)&&e.model)}constructor(e,t){this.model=e,this.position=t}}class ar extends Rr{static{this._allSymbolNavigationCommands=new Map}static{this._activeAlternativeCommands=new Set}static all(){return ar._allSymbolNavigationCommands.values()}static _patchConfig(e){const t={...e,f1:!0};if(t.menu)for(const i of dn.wrap(t.menu))(i.id===N.EditorContext||i.id===N.EditorContextPeek)&&(i.when=x.and(e.precondition,i.when));return t}constructor(e,t){super(ar._patchConfig(t)),this.configuration=e,ar._allSymbolNavigationCommands.set(t.id,this)}runEditorCommand(e,t,i,n){if(!t.hasModel())return Promise.resolve(void 0);const o=e.get(At),r=e.get(Ot),a=e.get(ju),c=e.get(GN),d=e.get(Ne),l=e.get(J),u=t.getModel(),g=t.getPosition(),m=by.is(i)?i:new by(u,g),v=new Xm(t,ds.Value|ds.Position),y=xh(this._getLocationModel(d,m.model,m.position,v.token),v.token).then(async w=>{if(!w||v.token.isCancellationRequested)return;ta(w.ariaMessage);let C;if(w.referenceAt(u.uri,g)){const k=this._getAlternativeCommand(t);k!==void 0&&!ar._activeAlternativeCommands.has(k)&&ar._allSymbolNavigationCommands.has(k)&&(C=ar._allSymbolNavigationCommands.get(k))}const T=w.references.length;if(T===0){if(!this.configuration.muteMessage){const k=u.getWordAtPosition(g);wr.get(t)?.showMessage(this._getNoResultFoundMessage(k),g)}}else if(T===1&&C)ar._activeAlternativeCommands.add(this.desc.id),l.invokeFunction(k=>C.runEditorCommand(k,t,i,n).finally(()=>{ar._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(r,c,t,w,n)},w=>{o.error(w)}).finally(()=>{v.dispose()});return a.showWhile(y,250),y}async _onResult(e,t,i,n,o){const r=this._getGoToPreference(i);if(!(i instanceof pd)&&(this.configuration.openInPeek||r==="peek"&&n.references.length>1))this._openInPeek(i,n,o);else{const a=n.firstReference(),c=n.references.length>1&&r==="gotoAndPeek",d=await this._openReference(i,e,a,this.configuration.openToSide,!c);c&&d?this._openInPeek(d,n,o):n.dispose(),r==="goto"&&t.put(a)}}async _openReference(e,t,i,n,o){let r;if(lme(i)&&(r=i.targetSelectionRange),r||(r=i.range),!r)return;const a=await t.openCodeEditor({resource:i.uri,options:{selection:P.collapseToStart(r),selectionRevealType:Cm.NearTopIfOutsideViewport,selectionSource:sd.JUMP}},e,n);if(a){if(o){const c=a.getModel(),d=a.createDecorationsCollection([{range:r,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout(()=>{a.getModel()===c&&d.clear()},350)}return a}}_openInPeek(e,t,i){const n=sv.get(e);n&&e.hasModel()?n.toggleWidget(i??e.getSelection(),En(o=>Promise.resolve(t)),this.configuration.openInPeek):t.dispose()}}class PI extends ar{async _getLocationModel(e,t,i,n){return new ia(await AI(e.definitionProvider,t,i,!1,n),h(1104,"Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?h(1105,"No definition found for '{0}'",e.word):h(1106,"No definition found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleDefinitions}}K(class bB extends PI{static{this.id="editor.action.revealDefinition"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:bB.id,title:{...I(1107,"Go to Definition"),mnemonicTitle:h(1108,"Go to &&Definition")},precondition:V.hasDefinitionProvider,keybinding:[{when:V.editorTextFocus,primary:S.F12,weight:W.EditorContrib},{when:x.and(V.editorTextFocus,Ru),primary:E.CtrlCmd|S.F12,weight:W.EditorContrib}],menu:[{id:N.EditorContext,group:"navigation",order:1.1},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:2}]}),Ce.registerCommandAlias("editor.action.goToDeclaration",bB.id)}});K(class yB extends PI{static{this.id="editor.action.revealDefinitionAside"}constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:yB.id,title:I(1109,"Open Definition to the Side"),precondition:x.and(V.hasDefinitionProvider,V.isInEmbeddedEditor.toNegated()),keybinding:[{when:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,S.F12),weight:W.EditorContrib},{when:x.and(V.editorTextFocus,Ru),primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.F12),weight:W.EditorContrib}]}),Ce.registerCommandAlias("editor.action.openDeclarationToTheSide",yB.id)}});K(class wB extends PI{static{this.id="editor.action.peekDefinition"}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:wB.id,title:I(1110,"Peek Definition"),precondition:x.and(V.hasDefinitionProvider,Ir.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),keybinding:{when:V.editorTextFocus,primary:E.Alt|S.F12,linux:{primary:E.CtrlCmd|E.Shift|S.F10},weight:W.EditorContrib},menu:{id:N.EditorContextPeek,group:"peek",order:2}}),Ce.registerCommandAlias("editor.action.previewDeclaration",wB.id)}});class rae extends ar{async _getLocationModel(e,t,i,n){return new ia(await Fz(e.declarationProvider,t,i,!1,n),h(1111,"Declarations"))}_getNoResultFoundMessage(e){return e&&e.word?h(1112,"No declaration found for '{0}'",e.word):h(1113,"No declaration found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleDeclarations}}K(class aae extends rae{static{this.id="editor.action.revealDeclaration"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:aae.id,title:{...I(1114,"Go to Declaration"),mnemonicTitle:h(1115,"Go to &&Declaration")},precondition:x.and(V.hasDeclarationProvider,V.isInEmbeddedEditor.toNegated()),menu:[{id:N.EditorContext,group:"navigation",order:1.3},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?h(1112,"No declaration found for '{0}'",e.word):h(1113,"No declaration found")}});K(class extends rae{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.peekDeclaration",title:I(1116,"Peek Declaration"),precondition:x.and(V.hasDeclarationProvider,Ir.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),menu:{id:N.EditorContextPeek,group:"peek",order:3}})}});class cae extends ar{async _getLocationModel(e,t,i,n){return new ia(await Bz(e.typeDefinitionProvider,t,i,!1,n),h(1117,"Type Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?h(1118,"No type definition found for '{0}'",e.word):h(1119,"No type definition found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleTypeDefinitions}}K(class dae extends cae{static{this.ID="editor.action.goToTypeDefinition"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:dae.ID,title:{...I(1120,"Go to Type Definition"),mnemonicTitle:h(1121,"Go to &&Type Definition")},precondition:V.hasTypeDefinitionProvider,keybinding:{when:V.editorTextFocus,primary:0,weight:W.EditorContrib},menu:[{id:N.EditorContext,group:"navigation",order:1.4},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}});K(class lae extends cae{static{this.ID="editor.action.peekTypeDefinition"}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:lae.ID,title:I(1122,"Peek Type Definition"),precondition:x.and(V.hasTypeDefinitionProvider,Ir.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),menu:{id:N.EditorContextPeek,group:"peek",order:4}})}});class hae extends ar{async _getLocationModel(e,t,i,n){return new ia(await Wz(e.implementationProvider,t,i,!1,n),h(1123,"Implementations"))}_getNoResultFoundMessage(e){return e&&e.word?h(1124,"No implementation found for '{0}'",e.word):h(1125,"No implementation found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleImplementations}}K(class uae extends hae{static{this.ID="editor.action.goToImplementation"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:uae.ID,title:{...I(1126,"Go to Implementations"),mnemonicTitle:h(1127,"Go to &&Implementations")},precondition:V.hasImplementationProvider,keybinding:{when:V.editorTextFocus,primary:E.CtrlCmd|S.F12,weight:W.EditorContrib},menu:[{id:N.EditorContext,group:"navigation",order:1.45},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:4}]})}});K(class gae extends hae{static{this.ID="editor.action.peekImplementation"}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:gae.ID,title:I(1128,"Peek Implementations"),precondition:x.and(V.hasImplementationProvider,Ir.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),keybinding:{when:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.F12,weight:W.EditorContrib},menu:{id:N.EditorContextPeek,group:"peek",order:5}})}});class pae extends ar{_getNoResultFoundMessage(e){return e?h(1129,"No references found for '{0}'",e.word):h(1130,"No references found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleReferences}}K(class extends pae{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:"editor.action.goToReferences",title:{...I(1131,"Go to References"),mnemonicTitle:h(1132,"Go to &&References")},precondition:x.and(V.hasReferenceProvider,Ir.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),keybinding:{when:V.editorTextFocus,primary:E.Shift|S.F12,weight:W.EditorContrib},menu:[{id:N.EditorContext,group:"navigation",order:1.45},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:5}]})}async _getLocationModel(e,t,i,n){return new ia(await RI(e.referenceProvider,t,i,!0,!1,n),h(1133,"References"))}});K(class extends pae{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.referenceSearch.trigger",title:I(1134,"Peek References"),precondition:x.and(V.hasReferenceProvider,Ir.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),menu:{id:N.EditorContextPeek,group:"peek",order:6}})}async _getLocationModel(e,t,i,n){return new ia(await RI(e.referenceProvider,t,i,!1,!1,n),h(1133,"References"))}});class BDe extends ar{constructor(e,t,i){super(e,{id:"editor.action.goToLocation",title:I(1135,"Go to Any Symbol"),precondition:x.and(Ir.notInPeekEditor,V.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=i}async _getLocationModel(e,t,i,n){return new ia(this._references,h(1136,"Locations"))}_getNoResultFoundMessage(e){return e&&h(1137,"No results for '{0}'",e.word)||""}_getGoToPreference(e){return this._gotoMultipleBehaviour??e.getOption(L.gotoLocation).multipleReferences}_getAlternativeCommand(){}}Ce.registerCommand({id:"editor.action.goToLocations",metadata:{description:"Go to locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:R},{name:"position",description:"The position at which to start",constraint:_e.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:"noResultsMessage",description:"Human readable message that shows when locations is empty."}]},handler:async(s,e,t,i,n,o,r)=>{St(R.isUri(e)),St(_e.isIPosition(t)),St(Array.isArray(i)),St(typeof n>"u"||typeof n=="string"),St(typeof r>"u"||typeof r=="boolean");const a=s.get(Ot),c=await a.openCodeEditor({resource:e},a.getFocusedCodeEditor());if(Ao(c))return c.setPosition(t),c.revealPositionInCenterIfOutsideViewport(t,ji.Smooth),c.invokeWithinContext(d=>{const l=new class extends BDe{_getNoResultFoundMessage(u){return o||super._getNoResultFoundMessage(u)}}({muteMessage:!o,openInPeek:!!r,openToSide:!1},i,n);d.get(J).invokeFunction(l.run.bind(l),c)})}});Ce.registerCommand({id:"editor.action.peekLocations",metadata:{description:"Peek locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:R},{name:"position",description:"The position at which to start",constraint:_e.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(s,e,t,i,n)=>{s.get(qe).executeCommand("editor.action.goToLocations",e,t,i,n,void 0,!0)}});Ce.registerCommand({id:"editor.action.findReferences",handler:(s,e,t)=>{St(R.isUri(e)),St(_e.isIPosition(t));const i=s.get(Ne),n=s.get(Ot);return n.openCodeEditor({resource:e},n.getFocusedCodeEditor()).then(o=>{if(!Ao(o)||!o.hasModel())return;const r=sv.get(o);if(!r)return;const a=En(d=>RI(i.referenceProvider,o.getModel(),_e.lift(t),!1,!1,d).then(l=>new ia(l,h(1133,"References")))),c=new P(t.lineNumber,t.column,t.lineNumber,t.column);return Promise.resolve(r.toggleWidget(c,a,!1))})}});Ce.registerCommandAlias("editor.action.showReferences","editor.action.peekLocations");async function VDe(s,e,t,i){const n=s.get(yi),o=s.get(mi),r=s.get(qe),a=s.get(J),c=s.get(At);if(await i.item.resolve(ye.None),!i.part.location)return;const d=i.part.location,l=[],u=new Set(ge.getMenuItems(N.EditorContext).map(m=>Nie(m)?m.command.id:Dn()));for(const m of ar.all())u.has(m.desc.id)&&l.push(new Kt(m.desc.id,va.label(m.desc,{renderShortTitle:!0}),void 0,!0,async()=>{const v=await n.createModelReference(d.uri);try{const y=new by(v.object.textEditorModel,P.getStartPosition(d.range)),w=i.item.anchor.range;await a.invokeFunction(m.runEditorCommand.bind(m),e,y,w)}finally{v.dispose()}}));if(i.part.command){const{command:m}=i.part;l.push(new is),l.push(new Kt(m.id,m.title,void 0,!0,async()=>{try{await r.executeCommand(m.id,...m.arguments??[])}catch(v){c.notify({severity:Me.Error,source:i.item.provider.displayName,message:v})}}))}const g=e.getOption(L.useShadowDOM);o.showContextMenu({domForShadowRoot:g?e.getDomNode()??void 0:void 0,getAnchor:()=>{const m=Ms(t);return{x:m.left,y:m.top+m.height+8}},getActions:()=>l,onHide:()=>{e.focus()},autoSelectFirstItem:!0})}async function fae(s,e,t,i){const o=await s.get(yi).createModelReference(i.uri);await t.invokeWithinContext(async r=>{const a=e.hasSideBySideModifier,c=r.get(me),d=Ir.inPeekEditor.getValue(c),l=!a&&t.getOption(L.definitionLinkOpensInPeek)&&!d;return new PI({openToSide:a,openInPeek:l,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(r,new by(o.object.textEditorModel,P.getStartPosition(i.range)),P.lift(i.range))}),o.dispose()}var D_;class NA{constructor(){this._entries=new Bm(50)}get(e){const t=NA._key(e);return this._entries.get(t)}set(e,t){const i=NA._key(e);this._entries.set(i,t)}static _key(e){return`${e.uri.toString()}/${e.getVersionId()}`}}class SB{constructor(e,t){this.item=e,this.index=t}get part(){const e=this.item.hint.label;return typeof e=="string"?{label:e}:e[this.index]}}class HDe{constructor(e,t){this.part=e,this.hasTriggerModifier=t}}var lu;(function(s){s[s.Normal=0]="Normal",s[s.Invisible=1]="Invisible"})(lu||(lu={}));let yy=class{static{D_=this}static{this.ID="editor.contrib.InlayHints"}static{this._MAX_DECORATORS=1500}static{this._whitespaceData={}}static get(e){return e.getContribution(D_.ID)??void 0}constructor(e,t,i,n,o,r,a){this._editor=e,this._languageFeaturesService=t,this._inlayHintsCache=n,this._commandService=o,this._notificationService=r,this._instaService=a,this._disposables=new U,this._sessionDisposables=new U,this._decorationsMetadata=new Map,this._activeRenderMode=lu.Normal,this._ruleFactory=new Ese(this._editor),this._debounceInfo=i.for(t.inlayHintsProvider,"InlayHint",{min:25}),this._disposables.add(t.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(c=>{c.hasChanged(L.inlayHints)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();const e=this._editor.getOption(L.inlayHints);if(e.enabled==="off")return;const t=this._editor.getModel();if(!t||!this._languageFeaturesService.inlayHintsProvider.has(t))return;if(e.enabled==="on")this._activeRenderMode=lu.Normal;else{let c,d;e.enabled==="onUnlessPressed"?(c=lu.Normal,d=lu.Invisible):(c=lu.Invisible,d=lu.Normal),this._activeRenderMode=c,this._sessionDisposables.add(LT.getInstance().event(l=>{if(!this._editor.hasModel())return;const u=l.altKey&&l.ctrlKey&&!(l.shiftKey||l.metaKey)?d:c;if(u!==this._activeRenderMode){this._activeRenderMode=u;const g=this._editor.getModel(),m=this._copyInlayHintsWithCurrentAnchor(g);this._updateHintsDecorators([g.getFullModelRange()],m),r.schedule(0)}}))}const i=this._inlayHintsCache.get(t);i&&this._updateHintsDecorators([t.getFullModelRange()],i),this._sessionDisposables.add(Ee(()=>{t.isDisposed()||this._cacheHintsForFastRestore(t)}));let n;const o=new Set,r=new fn(async()=>{const c=Date.now();n?.dispose(!0),n=new ri;const d=t.onWillDispose(()=>n?.cancel());try{const l=n.token,u=await Nb.create(this._languageFeaturesService.inlayHintsProvider,t,this._getHintsRanges(),l);if(r.delay=this._debounceInfo.update(t,Date.now()-c),l.isCancellationRequested){u.dispose();return}for(const g of u.provider)typeof g.onDidChangeInlayHints=="function"&&!o.has(g)&&(o.add(g),this._sessionDisposables.add(g.onDidChangeInlayHints(()=>{r.isScheduled()||r.schedule()})));this._sessionDisposables.add(u),this._updateHintsDecorators(u.ranges,u.items),this._cacheHintsForFastRestore(t)}catch(l){mt(l)}finally{n.dispose(),d.dispose()}},this._debounceInfo.get(t));this._sessionDisposables.add(r),this._sessionDisposables.add(Ee(()=>n?.dispose(!0))),r.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(c=>{(c.scrollTopChanged||!r.isScheduled())&&r.schedule()}));const a=this._sessionDisposables.add(new kt);this._sessionDisposables.add(this._editor.onDidChangeModelContent(c=>{n?.cancel();const d=Math.max(r.delay,800);this._cursorInfo={position:this._editor.getPosition(),notEarlierThan:Date.now()+d},a.value=Hm(()=>r.schedule(0),d),r.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeConfiguration(c=>{c.hasChanged(L.inlayHints)&&r.schedule()})),this._sessionDisposables.add(this._installDblClickGesture(()=>r.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){const e=new U,t=e.add(new zN(this._editor)),i=new U;return e.add(i),e.add(t.onMouseMoveOrRelevantKeyDown(n=>{const[o]=n,r=this._getInlayHintLabelPart(o),a=this._editor.getModel();if(!r||!a){i.clear();return}const c=new ri;i.add(Ee(()=>c.dispose(!0))),r.item.resolve(c.token),this._activeInlayHintPart=r.part.command||r.part.location?new HDe(r,o.hasTriggerModifier):void 0;const d=a.validatePosition(r.item.hint.position).lineNumber,l=new P(d,1,d,a.getLineMaxColumn(d)),u=this._getInlineHintsForRange(l);this._updateHintsDecorators([l],u),i.add(Ee(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([l],u)}))})),e.add(t.onCancel(()=>i.clear())),e.add(t.onExecute(async n=>{const o=this._getInlayHintLabelPart(n);if(o){const r=o.part;r.location?this._instaService.invokeFunction(fae,n,this._editor,r.location):Oie.is(r.command)&&await this._invokeCommand(r.command,o.item)}})),e}_getInlineHintsForRange(e){const t=new Set;for(const i of this._decorationsMetadata.values())e.containsRange(i.item.anchor.range)&&t.add(i.item);return Array.from(t)}_installDblClickGesture(e){return this._editor.onMouseUp(async t=>{if(t.event.detail!==2)return;const i=this._getInlayHintLabelPart(t);if(i&&(t.event.preventDefault(),await i.item.resolve(ye.None),xn(i.item.hint.textEdits))){const n=i.item.hint.textEdits.map(o=>Ki.replace(P.lift(o.range),o.text));this._editor.executeEdits("inlayHint.default",n),e()}})}_installContextMenu(){return this._editor.onContextMenu(async e=>{if(!Mh(e.event.target))return;const t=this._getInlayHintLabelPart(e);t&&await this._instaService.invokeFunction(VDe,this._editor,e.event.target,t)})}_getInlayHintLabelPart(e){if(e.target.type!==Ei.CONTENT_TEXT)return;const t=e.target.detail.injectedText?.options;if(t instanceof uq&&t?.attachedData instanceof SB)return t.attachedData}async _invokeCommand(e,t){try{await this._commandService.executeCommand(e.id,...e.arguments??[])}catch(i){this._notificationService.notify({severity:Me.Error,source:t.provider.displayName,message:i})}}_cacheHintsForFastRestore(e){const t=this._copyInlayHintsWithCurrentAnchor(e);this._inlayHintsCache.set(e,t)}_copyInlayHintsWithCurrentAnchor(e){const t=new Map;for(const[i,n]of this._decorationsMetadata){if(t.has(n.item))continue;const o=e.getDecorationRange(i);if(o){const r=new sae(o,n.item.anchor.direction),a=n.item.with({anchor:r});t.set(n.item,a)}}return Array.from(t.values())}_getHintsRanges(){const t=this._editor.getModel(),i=this._editor.getVisibleRangesPlusViewportAboveBelow(),n=[];for(const o of i.sort(P.compareRangesUsingStarts)){const r=t.validateRange(new P(o.startLineNumber-30,o.startColumn,o.endLineNumber+30,o.endColumn));n.length===0||!P.areIntersectingOrTouching(n[n.length-1],r)?n.push(r):n[n.length-1]=P.plusRange(n[n.length-1],r)}return n}_updateHintsDecorators(e,t){const i=new Map;if(this._cursorInfo&&this._cursorInfo.notEarlierThan>Date.now()&&e.some(w=>w.containsPosition(this._cursorInfo.position))){const{position:w}=this._cursorInfo;this._cursorInfo=void 0;const C=new Map;for(const B of this._editor.getLineDecorations(w.lineNumber)??[]){const z=this._decorationsMetadata.get(B.id);if(B.range.startColumn>w.column)continue;const Q=z?.decoration.options[z.item.anchor.direction];if(Q&&Q.attachedData!==D_._whitespaceData){const ie=C.get(z.item)??0;C.set(z.item,ie+Q.content.length)}}const T=t.filter(B=>B.anchor.range.startLineNumber===w.lineNumber&&B.anchor.range.endColumn<=w.column),k=Array.from(C.values());let A;for(;;){const B=T.shift(),z=k.shift();if(!z&&!B)break;if(B)i.set(B,z??0),A=B;else if(A&&z){let Q=i.get(A);Q+=z,Q+=k.reduce((ie,oe)=>ie+oe,0),k.length=0;break}}}const n=[],o=(w,C,T,k,A)=>{const B={content:T,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:C.className,cursorStops:k,attachedData:A};n.push({item:w,classNameRef:C,decoration:{range:w.anchor.range,options:{description:"InlayHint",showIfCollapsed:w.anchor.range.isEmpty(),collapseOnReplaceEdit:!w.anchor.range.isEmpty(),stickiness:Di.AlwaysGrowsWhenTypingAtEdges,[w.anchor.direction]:this._activeRenderMode===lu.Normal?B:void 0}}})},r=(w,C)=>{const T=this._ruleFactory.createClassNameRef({width:`${a/3|0}px`,display:"inline-block"});o(w,T," ",C?zf.Right:zf.None,D_._whitespaceData)},{fontSize:a,fontFamily:c,padding:d,isUniform:l}=this._getLayoutInfo(),u=this._editor.getOption(L.inlayHints).maximumLength,g="--code-editorInlayHintsFontFamily";this._editor.getContainerDomNode().style.setProperty(g,c);let m={line:0,totalLen:0};for(let w=0;w<t.length;w++){const C=t[w];if(m.line!==C.anchor.range.startLineNumber&&(m={line:C.anchor.range.startLineNumber,totalLen:0}),u&&m.totalLen>u)continue;C.hint.paddingLeft&&r(C,!1);const T=typeof C.hint.label=="string"?[{label:C.hint.label}]:C.hint.label,k=i.get(C);let A=0;for(let B=0;B<T.length;B++){const z=T[B],Q=B===0,ie=B===T.length-1,oe={fontSize:`${a}px`,fontFamily:`var(${g}), ${BM.fontFamily}`,verticalAlign:l?"baseline":"middle",unicodeBidi:"isolate"};xn(C.hint.textEdits)&&(oe.cursor="default"),this._fillInColors(oe,C.hint),(z.command||z.location)&&this._activeInlayHintPart?.part.item===C&&this._activeInlayHintPart.part.index===B&&(oe.textDecoration="underline",this._activeInlayHintPart.hasTriggerModifier&&(oe.color=es(hme),oe.cursor="pointer"));let xe=z.label;m.totalLen+=xe.length;let Se=!1;const Ft=u!==0?m.totalLen-u:0;if(Ft>0&&(xe=xe.slice(0,-Ft)+"…",Se=!0),A+=xe.length,k!==void 0){const it=A-k;it>=0&&(A-=it,xe=xe.slice(0,-(1+it))+"…",Se=!0)}if(d&&(Q&&(ie||Se)?(oe.padding=`1px ${Math.max(1,a/4)|0}px`,oe.borderRadius=`${a/4|0}px`):Q?(oe.padding=`1px 0 1px ${Math.max(1,a/4)|0}px`,oe.borderRadius=`${a/4|0}px 0 0 ${a/4|0}px`):ie||Se?(oe.padding=`1px ${Math.max(1,a/4)|0}px 1px 0`,oe.borderRadius=`0 ${a/4|0}px ${a/4|0}px 0`):oe.padding="1px 0 1px 0"),o(C,this._ruleFactory.createClassNameRef(oe),UDe(xe),ie&&!C.hint.paddingRight?zf.Right:zf.None,new SB(C,B)),Se)break}if(k!==void 0&&A<k){const B=k-A;o(C,this._ruleFactory.createClassNameRef({})," ".repeat(B),zf.None)}if(C.hint.paddingRight&&r(C,!0),n.length>D_._MAX_DECORATORS)break}const v=[];for(const[w,C]of this._decorationsMetadata){const T=this._editor.getModel()?.getDecorationRange(w);T&&e.some(k=>k.containsRange(T))&&(v.push(w),C.classNameRef.dispose(),this._decorationsMetadata.delete(w))}const y=cy.capture(this._editor);this._editor.changeDecorations(w=>{const C=w.deltaDecorations(v,n.map(T=>T.decoration));for(let T=0;T<C.length;T++){const k=n[T];this._decorationsMetadata.set(C[T],k)}}),y.restore(this._editor)}_fillInColors(e,t){t.kind===v7.Parameter?(e.backgroundColor=es(ume),e.color=es(gme)):t.kind===v7.Type?(e.backgroundColor=es(pme),e.color=es(fme)):(e.backgroundColor=es(mme),e.color=es(vme))}_getLayoutInfo(){const e=this._editor.getOption(L.inlayHints),t=e.padding,i=this._editor.getOption(L.fontSize),n=this._editor.getOption(L.fontFamily);let o=e.fontSize;(!o||o<5||o>i)&&(o=i);const r=e.fontFamily||n;return{fontSize:o,fontFamily:r,padding:t,isUniform:!t&&r===n&&o===i}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(const e of this._decorationsMetadata.values())e.classNameRef.dispose();this._decorationsMetadata.clear()}getInlayHintsForLine(e){if(!this._editor.hasModel())return[];const t=new Set,i=[];for(const n of this._editor.getLineDecorations(e)){const o=this._decorationsMetadata.get(n.id);o&&!t.has(o.item.hint)&&(t.add(o.item.hint),i.push(o.item))}return i}};yy=D_=f([p(1,Ne),p(2,Sd),p(3,Kre),p(4,qe),p(5,At),p(6,J)],yy);function UDe(s){return s.replace(/[ \t]/g," ")}Ce.registerCommand("_executeInlayHintProvider",async(s,...e)=>{const[t,i]=e;St(R.isUri(t)),St(P.isIRange(i));const{inlayHintsProvider:n}=s.get(Ne),o=await s.get(yi).createModelReference(t);try{const r=await Nb.create(n,o.object.textEditorModel,[P.lift(i)],ye.None),a=r.items.map(c=>c.hint);return setTimeout(()=>r.dispose(),0),a}finally{o.dispose()}});const mae=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(mae);const vae="acceptSelectedCodeAction",_ae="previewSelectedCodeAction";var Uo;(function(s){s.Action="action",s.Header="header"})(Uo||(Uo={}));class $De{get templateId(){return Uo.Header}renderTemplate(e){e.classList.add("group-header");const t=document.createElement("span");return e.append(t),{container:e,text:t}}renderElement(e,t,i){i.text.textContent=e.group?.title??e.label??""}disposeTemplate(e){}}let CB=class{get templateId(){return Uo.Action}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);const t=document.createElement("div");t.className="icon",e.append(t);const i=document.createElement("span");i.className="title",e.append(i);const n=document.createElement("span");n.className="description",e.append(n);const o=new VM(e,Yu);return{container:e,icon:t,text:i,description:n,keybinding:o}}renderElement(e,t,i){if(e.group?.icon?(i.icon.className=Te.asClassName(e.group.icon),e.group.icon.color&&(i.icon.style.color=gt(e.group.icon.color.id))):(i.icon.className=Te.asClassName(j.lightBulb),i.icon.style.color="var(--vscode-editorLightBulb-foreground)"),!e.item||!e.label)return;AS(!e.hideIcon,i.icon),i.text.textContent=xB(e.label),e.keybinding?(i.description.textContent=e.keybinding.getLabel(),i.description.style.display="inline",i.description.style.letterSpacing="0.5px"):e.description?(i.description.textContent=xB(e.description),i.description.style.display="inline"):(i.description.textContent="",i.description.style.display="none");const n=this._keybindingService.lookupKeybinding(vae)?.getLabel(),o=this._keybindingService.lookupKeybinding(_ae)?.getLabel();i.container.classList.toggle("option-disabled",e.disabled),e.tooltip?i.container.title=e.tooltip:e.disabled?i.container.title=e.label:n&&o?this._supportsPreview&&e.canPreview?i.container.title=h(1691,"{0} to Apply, {1} to Preview",n,o):i.container.title=h(1692,"{0} to Apply",n):i.container.title=""}disposeTemplate(e){e.keybinding.dispose()}};CB=f([p(1,Ve)],CB);class GDe extends UIEvent{constructor(){super("acceptSelectedAction")}}class Cj extends UIEvent{constructor(){super("previewSelectedAction")}}function qDe(s){if(s.kind==="action")return s.label}let EB=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this._delegate=n,this._contextViewService=r,this._keybindingService=a,this._layoutService=c,this._actionLineHeight=24,this._headerLineHeight=26,this.cts=this._register(new ri),this.domNode=document.createElement("div"),this.domNode.classList.add("actionList");const d={getHeight:l=>l.kind===Uo.Header?this._headerLineHeight:this._actionLineHeight,getTemplateId:l=>l.kind};this._list=this._register(new Dv(e,this.domNode,d,[new CB(t,this._keybindingService),new $De],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:qDe},accessibilityProvider:{getAriaLabel:l=>{if(l.kind===Uo.Action){let u=l.label?xB(l?.label):"";return l.disabled&&(u=h(1693,"{0}, Disabled Reason: {1}",u,l.disabled)),u}return null},getWidgetAriaLabel:()=>h(1694,"Action Widget"),getRole:l=>l.kind===Uo.Action?"option":"separator",getWidgetRole:()=>"listbox",...o}})),this._list.style(_me),this._register(this._list.onMouseClick(l=>this.onListClick(l))),this._register(this._list.onMouseOver(l=>this.onListHover(l))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(l=>this.onListSelection(l))),this._allMenuItems=i,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&e.kind===Uo.Action}hide(e){this._delegate.onHide(e),this.cts.cancel(),this._contextViewService.hideContextView()}layout(e){const t=this._allMenuItems.filter(c=>c.kind==="header").length,n=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight;this._list.layout(n);let o=e;if(this._allMenuItems.length>=50)o=380;else{const c=this._allMenuItems.map((d,l)=>{const u=this.domNode.ownerDocument.getElementById(this._list.getElementID(l));if(u){u.style.width="auto";const g=u.getBoundingClientRect().width;return u.style.width="",g}return 0});o=Math.max(...c,e)}const a=Math.min(n,this._layoutService.getContainer(bt(this.domNode)).clientHeight*.7);return this._list.layout(a,o),this.domNode.style.height=`${a}px`,this._list.domFocus(),o}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){const t=this._list.getFocus();if(t.length===0)return;const i=t[0],n=this._list.element(i);if(!this.focusCondition(n))return;const o=e?new Cj:new GDe;this._list.setSelection([i],o)}onListSelection(e){if(!e.elements.length)return;const t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof Cj):this._list.setSelection([])}onFocus(){const e=this._list.getFocus();if(e.length===0)return;const t=e[0],i=this._list.element(t);this._delegate.onFocus?.(i.item)}async onListHover(e){const t=e.element;if(t&&t.item&&this.focusCondition(t)){if(this._delegate.onHover&&!t.disabled&&t.kind===Uo.Action){const i=await this._delegate.onHover(t.item,this.cts.token);t.canPreview=i?i.canPreview:void 0}e.index&&this._list.splice(e.index,1,[t])}this._list.setFocus(typeof e.index=="number"?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};EB=f([p(5,cf),p(6,Ve),p(7,df)],EB);function xB(s){return s.replace(/\r\n|\r|\n/g," ")}const Ed=Z("actionWidgetService");Be(mae);H("actionBar.toggledBackground",gq,h(1695,"Background color for toggled action items in action bar."));const ov={Visible:new O("codeActionMenuVisible",!1,h(1696,"Whether the action widget list is visible"))};let rv=class extends F{get isVisible(){return ov.Visible.getValue(this._contextKeyService)||!1}constructor(e,t,i){super(),this._contextViewService=e,this._contextKeyService=t,this._instantiationService=i,this._list=this._register(new kt)}show(e,t,i,n,o,r,a,c){const d=ov.Visible.bindTo(this._contextKeyService),l=this._instantiationService.createInstance(EB,e,t,i,n,c);this._contextViewService.showContextView({getAnchor:()=>o,render:u=>(d.set(!0),this._renderWidget(u,l,a??[])),onHide:u=>{d.reset(),this._onWidgetClosed(u)}},r,!1)}acceptSelected(e){this._list.value?.acceptSelected(e)}focusPrevious(){this._list?.value?.focusPrevious()}focusNext(){this._list?.value?.focusNext()}hide(e){this._list.value?.hide(e),this._list.clear()}clear(){this._list.clear()}_renderWidget(e,t,i){const n=document.createElement("div");if(n.classList.add("action-widget"),e.appendChild(n),this._list.value=t,this._list.value)n.appendChild(this._list.value.domNode);else throw new Error("List has no value");const o=new U,r=document.createElement("div"),a=e.appendChild(r);a.classList.add("context-view-block"),o.add(re(a,pe.MOUSE_DOWN,m=>m.stopPropagation()));const c=document.createElement("div"),d=e.appendChild(c);d.classList.add("context-view-pointerBlock"),o.add(re(d,pe.POINTER_MOVE,()=>d.remove())),o.add(re(d,pe.MOUSE_DOWN,()=>d.remove()));let l=0;if(i.length){const m=this._createActionBar(".action-widget-action-bar",i);m&&(n.appendChild(m.getContainer().parentElement),o.add(m),l=m.getContainer().offsetWidth)}const u=this._list.value?.layout(l);n.style.width=`${u}px`;const g=o.add(Po(e));return o.add(g.onDidBlur(()=>this.hide(!0))),o}_createActionBar(e,t){if(!t.length)return;const i=Y(e),n=new Er(i);return n.push(t,{icon:!1,label:!0}),n}_onWidgetClosed(e){this._list.value?.hide(e)}};rv=f([p(0,cf),p(1,me),p(2,J)],rv);const LI=W.EditorContrib+1e3;K(class extends X{constructor(){super({id:"hideCodeActionWidget",title:I(1697,"Hide action widget"),precondition:ov.Visible,keybinding:{weight:LI,primary:S.Escape,secondary:[E.Shift|S.Escape]}})}run(s){s.get(Ed).hide(!0)}});K(class extends X{constructor(){super({id:"selectPrevCodeAction",title:I(1698,"Select previous action"),precondition:ov.Visible,keybinding:{weight:LI,primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow],mac:{primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow,E.WinCtrl|S.KeyP]}}})}run(s){const e=s.get(Ed);e instanceof rv&&e.focusPrevious()}});K(class extends X{constructor(){super({id:"selectNextCodeAction",title:I(1699,"Select next action"),precondition:ov.Visible,keybinding:{weight:LI,primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow],mac:{primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow,E.WinCtrl|S.KeyN]}}})}run(s){const e=s.get(Ed);e instanceof rv&&e.focusNext()}});K(class extends X{constructor(){super({id:vae,title:I(1700,"Accept selected action"),precondition:ov.Visible,keybinding:{weight:LI,primary:S.Enter,secondary:[E.CtrlCmd|S.Period]}})}run(s){const e=s.get(Ed);e instanceof rv&&e.acceptSelected()}});K(class extends X{constructor(){super({id:_ae,title:I(1701,"Preview selected action"),precondition:ov.Visible,keybinding:{weight:LI,primary:E.CtrlCmd|S.Enter}})}run(s){const e=s.get(Ed);e instanceof rv&&e.acceptSelected(!0)}});const Vz=new O("hasSymbols",!1,h(1156,"Whether there are symbol locations that can be navigated via keyboard-only."));let IB=class{constructor(e,t,i,n){this._editorService=t,this._notificationService=i,this._keybindingService=n,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=Vz.bindTo(e)}reset(){this._ctxHasSymbols.reset(),this._currentState?.dispose(),this._currentMessage?.close(),this._currentModel=void 0,this._currentIdx=-1}put(e){const t=e.parent.parent;if(t.references.length<=1){this.reset();return}this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();const i=new DB(this._editorService),n=i.onDidChange(o=>{if(this._ignoreEditorChange)return;const r=this._editorService.getActiveCodeEditor();if(!r)return;const a=r.getModel(),c=r.getPosition();if(!a||!c)return;let d=!1,l=!1;for(const u of t.references)if(Dt(u.uri,a.uri))d=!0,l=l||P.containsPosition(u.range,c);else if(d)break;(!d||!l)&&this.reset()});this._currentState=Lo(i,n)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;const t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:P.collapseToStart(t.range),selectionRevealType:Cm.NearTopIfOutsideViewport}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){this._currentMessage?.close();const e=this._keybindingService.lookupKeybinding("editor.gotoNextSymbolFromResult"),t=e?h(1157,"Symbol {0} of {1}, {2} for next",this._currentIdx+1,this._currentModel.references.length,e.getLabel()):h(1158,"Symbol {0} of {1}",this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(t)}};IB=f([p(0,me),p(1,Ot),p(2,At),p(3,Ve)],IB);Ue(new class extends No{constructor(){super({id:"editor.gotoNextSymbolFromResult",precondition:Vz,kbOpts:{weight:W.EditorContrib,primary:S.F12}})}runEditorCommand(s,e){return s.get(GN).revealNext(e)}});Le.registerCommandAndKeybindingRule({id:"editor.gotoNextSymbolFromResult.cancel",weight:W.EditorContrib,when:Vz,primary:S.Escape,handler(s){s.get(GN).reset()}});let DB=class{constructor(e){this._listener=new Map,this._disposables=new U,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),Qe(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,Lo(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){this._listener.get(e)?.dispose(),this._listener.delete(e)}};DB=f([p(0,Ot)],DB);const zDe=Z("IMcpService"),bae=Z("IMcpWorkbenchService"),KDe=Z("IMcpServerSampling"),jDe=Z("IMcpConfigPathsService"),yae=Z("mcpRegistry"),wae=Z("IExtensionGalleryManifestService"),YDe=Z("IWebContentExtractorService"),jN=Z("ISharedWebContentExtractorService"),QDe=Z("defaultAccountService");class XDe{extract(e){throw new Error("Not implemented")}}class ZDe{readImage(e,t){throw new Error("Not implemented")}}var Ob;(function(s){s.Uninitialized="uninitialized",s.Unavailable="unavailable",s.Available="available"})(Ob||(Ob={}));const Ej=new O("defaultAccountStatus",Ob.Uninitialized);class JDe extends F{constructor(){super(...arguments),this.onDidChangeDefaultAccount=D.None}async getDefaultAccount(){return null}setDefaultAccount(e){}}(class extends F{static{this.ID="workbench.contributions.defaultAccountManagement"}constructor(e,t,i,n,o,r,a,c){super(),this.defaultAccountService=e,this.configurationService=t,this.authenticationService=i,this.extensionService=n,this.productService=o,this.requestService=r,this.logService=a,this.defaultAccount=null,this.accountStatusContext=Ej.bindTo(c),this.initialize()}async initialize(){if(!this.productService.defaultAccount)return;const{authenticationProvider:e,tokenEntitlementUrl:t,chatEntitlementUrl:i}=this.productService.defaultAccount;await this.extensionService.whenInstalledExtensionsRegistered();const n=this.authenticationService.declaredProviders.find(o=>o.id===e.id);if(!n){this.logService.info(`Default account authentication provider ${e} is not declared.`);return}this.registerSignInAction(e.id,n.label,e.enterpriseProviderId,e.enterpriseProviderConfig,e.scopes),this.setDefaultAccount(await this.getDefaultAccountFromAuthenticatedSessions(e.id,e.enterpriseProviderId,e.enterpriseProviderConfig,e.scopes,t,i)),this._register(this.authenticationService.onDidChangeSessions(async o=>{if(!(o.providerId!==e.id&&o.providerId!==e.enterpriseProviderId)){if(this.defaultAccount&&o.event.removed?.some(r=>r.id===this.defaultAccount?.sessionId)){this.setDefaultAccount(null);return}this.setDefaultAccount(await this.getDefaultAccountFromAuthenticatedSessions(e.id,e.enterpriseProviderId,e.enterpriseProviderConfig,e.scopes,t,i))}}))}setDefaultAccount(e){this.defaultAccount=e,this.defaultAccountService.setDefaultAccount(this.defaultAccount),this.defaultAccount?this.accountStatusContext.set(Ob.Available):this.accountStatusContext.set(Ob.Unavailable)}extractFromToken(e,t){const i=new Map,o=e?.split(":")[0]?.split(";");for(const r of o){const[a,c]=r.split("=");i.set(a,c)}return i.get(t)}async getDefaultAccountFromAuthenticatedSessions(e,t,i,n,o,r){const a=this.configurationService.getValue(i)===t?t:e,d=(await this.authenticationService.getSessions(a,void 0,void 0,!0)).find(g=>this.scopesMatch(g.scopes,n));if(!d)return null;const[l,u]=await Promise.all([this.getChatEntitlements(d.accessToken,r),this.getTokenEntitlements(d.accessToken,o)]);return{sessionId:d.id,enterprise:a===t||d.account.label.includes("_"),...l,...u}}scopesMatch(e,t){return e.length===t.length&&t.every(i=>e.includes(i))}async getTokenEntitlements(e,t){if(!t)return{};try{const i=await this.requestService.request({type:"GET",url:t,disableCache:!0,headers:{Authorization:`Bearer ${e}`}},ye.None),n=await bF(i);if(n)return{chat_preview_features_enabled:this.extractFromToken(n.token,"editor_preview_features")!=="0"};this.logService.error("Failed to fetch token entitlements","No data returned")}catch(i){this.logService.error("Failed to fetch token entitlements",ba(i))}return{}}async getChatEntitlements(e,t){if(!t)return{};try{const i=await this.requestService.request({type:"GET",url:t,disableCache:!0,headers:{Authorization:`Bearer ${e}`}},ye.None),n=await bF(i);if(n)return n;this.logService.error("Failed to fetch entitlements","No data returned")}catch(i){this.logService.error("Failed to fetch entitlements",ba(i))}return{}}registerSignInAction(e,t,i,n,o){const r=this;this._register(K(class extends X{constructor(){super({id:"workbench.accounts.actions.signin",title:h(12181,"Sign in to {0}",t),menu:{id:N.AccountsContext,when:x.and(Ej.isEqualTo(Ob.Unavailable),x.has("config.extensions.gallery.serviceUrl")),group:"0_signin"}})}run(){const a=r.configurationService.getValue(n)===i?i:e;return r.authenticationService.createSession(a,o)}}))}});const eke=Z("chatTransferService"),Sae=Z("IChatStatusItemService"),Cae=Z("IAiSettingsSearchService"),Eae=Z("dynamicAuthenticationProviderStorageService"),xae=Z("IAuthenticationMcpService"),Iae=Z("IAuthenticationMcpAccessService"),Dae=Z("IAuthenticationMcpUsageService"),tke=Z("browserElementsService"),ike=Z("gettingStartedExperimentService"),nke=Z("IContextPickService"),ske=Z("IMcpGalleryService"),oke=Z("IMcpManagementService");function b(s,e,t){function i(){throw new Error(`Unsupported: ${s.constructor.name}.${e} is not supported. You are using a feature without registering the corresponding service override.`)}t.value!=null?t.value=i:t.get!=null&&(t.get=i)}$(rs,_Se,G.Delayed);$($N,bme,G.Delayed);$(Sd,yme,G.Delayed);$(Ne,vDe,G.Delayed);$(Ot,iB,G.Delayed);$(bSe,nB,G.Delayed);$(GN,IB,G.Delayed);$(wSe,ySe,G.Delayed);$(jre,IDe,G.Delayed);$(kI,rB,G.Delayed);$(qre,lB,G.Delayed);$(UN,aB,G.Delayed);$(zre,cB,G.Delayed);$(wi,wme,G.Delayed);$(Kre,NA,G.Delayed);$(Ed,rv,G.Delayed);$(HM,Sme,G.Delayed);$(eI,class extends Cme{constructor(){super(Eb.Info,R.file("logs.log"))}doCreateLogger(){return new Eme}},G.Eager);class Hz{constructor(){this._serviceBrand=void 0,this.getVisibleTextEditorControls=()=>[],this.onWillOpenEditor=D.None,this.onDidActiveEditorChange=D.None,this.onDidVisibleEditorsChange=D.None,this.onDidEditorsChange=D.None,this.onDidCloseEditor=D.None,this.activeEditorPane=void 0,this.activeEditor=void 0,this.activeTextEditorLanguageId=void 0,this.visibleEditorPanes=[],this.visibleEditors=[],this.visibleTextEditorControls=[],this.editors=[],this.count=0,this.getEditors=()=>[],this.replaceEditors=async()=>{},this.isOpened=()=>!1,this.isVisible=()=>!1,this.closeEditor=async()=>{},this.closeEditors=async()=>{},this.findEditors=()=>[],this.save=async()=>({success:!1,editors:[]}),this.saveAll=async()=>({success:!1,editors:[]}),this.revert=async()=>!1,this.revertAll=async()=>!1}get activeTextEditorControl(){return Ya.get(Ot).getFocusedCodeEditor()??void 0}openEditor(){_()}openEditors(){_()}createScoped(){return this}}f([b],Hz.prototype,"openEditor",null);f([b],Hz.prototype,"openEditors",null);$(de,Hz,G.Eager);class kae{constructor(){this._serviceBrand=void 0,this.getPaneCompositeIds=()=>[],this.onDidPaneCompositeOpen=D.None,this.onDidPaneCompositeClose=D.None,this.openPaneComposite=async()=>{},this.getActivePaneComposite=()=>{},this.getPaneComposite=()=>{},this.getPaneComposites=()=>[],this.getPinnedPaneCompositeIds=()=>[],this.getVisiblePaneCompositeIds=()=>[],this.getProgressIndicator=()=>{},this.hideActivePaneComposite=()=>{},this.showActivity=()=>F.None}getLastActivePaneCompositeId(){_()}}f([b],kae.prototype,"getLastActivePaneCompositeId",null);$(aa,kae,G.Eager);$(Zi,qW,G.Delayed);class vo{resolveDecoding(){_()}resolveEncoding(){_()}validateDetectedEncoding(){_()}getEncoding(){_()}get files(){return _()}get untitled(){return _()}get encoding(){return _()}isDirty(){_()}save(){_()}saveAs(){_()}revert(){_()}read(){_()}readStream(){_()}write(){_()}create(){_()}getEncodedReadable(){_()}getDecodedStream(){_()}dispose(){_()}}f([b],vo.prototype,"resolveDecoding",null);f([b],vo.prototype,"resolveEncoding",null);f([b],vo.prototype,"validateDetectedEncoding",null);f([b],vo.prototype,"getEncoding",null);f([b],vo.prototype,"files",null);f([b],vo.prototype,"untitled",null);f([b],vo.prototype,"encoding",null);f([b],vo.prototype,"isDirty",null);f([b],vo.prototype,"save",null);f([b],vo.prototype,"saveAs",null);f([b],vo.prototype,"revert",null);f([b],vo.prototype,"read",null);f([b],vo.prototype,"readStream",null);f([b],vo.prototype,"write",null);f([b],vo.prototype,"create",null);f([b],vo.prototype,"getEncodedReadable",null);f([b],vo.prototype,"getDecodedStream",null);f([b],vo.prototype,"dispose",null);$(Ds,vo,G.Eager);class Ys{constructor(){this._serviceBrand=void 0,this.onDidChangeFileSystemProviderRegistrations=D.None,this.onDidChangeFileSystemProviderCapabilities=D.None,this.onWillActivateFileSystemProvider=D.None,this.getProvider=function(){},this.activateProvider=async()=>{},this.canHandleResource=async()=>!1,this.hasProvider=()=>!1,this.hasCapability=()=>!1,this.listCapabilities=()=>[],this.onDidFilesChange=D.None,this.onDidRunOperation=D.None,this.exists=async()=>!1,this.onDidWatchError=D.None}registerProvider(){_()}resolve(){_()}resolveAll(){_()}stat(){_()}readFile(){_()}readFileStream(){_()}writeFile(){_()}move(){_()}canMove(){_()}copy(){_()}canCopy(){_()}cloneFile(){_()}createFile(){_()}canCreateFile(){_()}createFolder(){_()}del(){_()}canDelete(){_()}watch(){_()}createWatcher(){_()}dispose(){}}f([b],Ys.prototype,"registerProvider",null);f([b],Ys.prototype,"resolve",null);f([b],Ys.prototype,"resolveAll",null);f([b],Ys.prototype,"stat",null);f([b],Ys.prototype,"readFile",null);f([b],Ys.prototype,"readFileStream",null);f([b],Ys.prototype,"writeFile",null);f([b],Ys.prototype,"move",null);f([b],Ys.prototype,"canMove",null);f([b],Ys.prototype,"copy",null);f([b],Ys.prototype,"canCopy",null);f([b],Ys.prototype,"cloneFile",null);f([b],Ys.prototype,"createFile",null);f([b],Ys.prototype,"canCreateFile",null);f([b],Ys.prototype,"createFolder",null);f([b],Ys.prototype,"del",null);f([b],Ys.prototype,"canDelete",null);f([b],Ys.prototype,"watch",null);f([b],Ys.prototype,"createWatcher",null);$(Xe,Ys,G.Eager);class jn{constructor(){this.selectedEditors=[],this.isSelected=()=>!1,this.isTransient=()=>!1,this.windowId=$i.vscodeWindowId,this.onDidFocus=D.None,this.onDidOpenEditorFail=D.None,this.whenRestored=Promise.resolve(),this.disposed=!1,this.minimumWidth=0,this.maximumWidth=Number.POSITIVE_INFINITY,this.minimumHeight=0,this.maximumHeight=Number.POSITIVE_INFINITY,this.onDidChange=D.None,this.onDidModelChange=D.None,this.onWillDispose=D.None,this.onDidActiveEditorChange=D.None,this.onWillCloseEditor=D.None,this.onDidCloseEditor=D.None,this.onWillMoveEditor=D.None,this.onWillOpenEditor=D.None,this.id=0,this.index=0,this.label="main",this.ariaLabel="main",this.activeEditorPane=void 0,this.activeEditor=null,this.previewEditor=null,this.count=0,this.isEmpty=!1,this.isLocked=!1,this.stickyCount=0,this.editors=[],this.getEditors=()=>[],this.findEditors=()=>[],this.getEditorByIndex=()=>{},this.isPinned=()=>!1,this.isSticky=()=>!1,this.isActive=()=>!1,this.contains=()=>!1,this.pinEditor=()=>{},this.stickEditor=()=>{},this.unstickEditor=()=>{},this.lock=()=>{}}setSelection(){_()}get groupsView(){return _()}notifyLabelChanged(){}createEditorActions(){_()}get titleHeight(){return _()}setActive(){_()}notifyIndexChanged(){_()}relayout(){_()}dispose(){_()}toJSON(){_()}get element(){return _()}layout(){_()}get scopedContextKeyService(){return Ya.get(me)}getIndexOfEditor(){_()}openEditor(){_()}openEditors(){_()}moveEditor(){_()}moveEditors(){_()}copyEditor(){_()}copyEditors(){_()}closeEditor(){_()}closeEditors(){_()}closeAllEditors(){_()}replaceEditors(){_()}focus(){}isFirst(){_()}isLast(){_()}}f([b],jn.prototype,"setSelection",null);f([b],jn.prototype,"groupsView",null);f([b],jn.prototype,"createEditorActions",null);f([b],jn.prototype,"titleHeight",null);f([b],jn.prototype,"setActive",null);f([b],jn.prototype,"notifyIndexChanged",null);f([b],jn.prototype,"relayout",null);f([b],jn.prototype,"dispose",null);f([b],jn.prototype,"toJSON",null);f([b],jn.prototype,"element",null);f([b],jn.prototype,"layout",null);f([b],jn.prototype,"getIndexOfEditor",null);f([b],jn.prototype,"openEditor",null);f([b],jn.prototype,"openEditors",null);f([b],jn.prototype,"moveEditor",null);f([b],jn.prototype,"moveEditors",null);f([b],jn.prototype,"copyEditor",null);f([b],jn.prototype,"copyEditors",null);f([b],jn.prototype,"closeEditor",null);f([b],jn.prototype,"closeEditors",null);f([b],jn.prototype,"closeAllEditors",null);f([b],jn.prototype,"replaceEditors",null);f([b],jn.prototype,"isFirst",null);f([b],jn.prototype,"isLast",null);const OA=new jn;class ks{constructor(){this.onWillDispose=D.None,this.windowId=$i.vscodeWindowId,this.hasMaximizedGroup=()=>!1,this.onDidLayout=D.None,this.onDidScroll=D.None,this.isReady=!0,this.whenReady=Promise.resolve(),this.whenRestored=Promise.resolve(),this.hasRestorableState=!1,this.onDidChangeActiveGroup=D.None,this.onDidAddGroup=D.None,this.onDidRemoveGroup=D.None,this.onDidMoveGroup=D.None,this.onDidActivateGroup=D.None,this.onDidChangeGroupIndex=D.None,this.onDidChangeGroupLocked=D.None,this.onDidChangeGroupMaximized=D.None,this.activeGroup=OA,this.groups=[OA],this.count=0,this.orientation=rc.HORIZONTAL,this.getGroups=()=>[],this.getGroup=()=>{},this.findGroup=()=>{},this.partOptions=Wt,this.onDidChangeEditorPartOptions=D.None}get contentDimension(){return _()}centerLayout(){_()}isLayoutCentered(){_()}enforcePartOptions(){_()}get sideGroup(){return _()}activateGroup(){_()}getSize(){_()}setSize(){_()}arrangeGroups(){_()}toggleMaximizeGroup(){_()}toggleExpandGroup(){_()}applyLayout(){_()}getLayout(){_()}setGroupOrientation(){_()}addGroup(){_()}removeGroup(){_()}moveGroup(){_()}mergeGroup(){_()}mergeAllGroups(){_()}copyGroup(){_()}createEditorDropTarget(){_()}}f([b],ks.prototype,"contentDimension",null);f([b],ks.prototype,"centerLayout",null);f([b],ks.prototype,"isLayoutCentered",null);f([b],ks.prototype,"enforcePartOptions",null);f([b],ks.prototype,"sideGroup",null);f([b],ks.prototype,"activateGroup",null);f([b],ks.prototype,"getSize",null);f([b],ks.prototype,"setSize",null);f([b],ks.prototype,"arrangeGroups",null);f([b],ks.prototype,"toggleMaximizeGroup",null);f([b],ks.prototype,"toggleExpandGroup",null);f([b],ks.prototype,"applyLayout",null);f([b],ks.prototype,"getLayout",null);f([b],ks.prototype,"setGroupOrientation",null);f([b],ks.prototype,"addGroup",null);f([b],ks.prototype,"removeGroup",null);f([b],ks.prototype,"moveGroup",null);f([b],ks.prototype,"mergeGroup",null);f([b],ks.prototype,"mergeAllGroups",null);f([b],ks.prototype,"copyGroup",null);f([b],ks.prototype,"createEditorDropTarget",null);class vn{constructor(){this.onDidCreateAuxiliaryEditorPart=D.None,this.mainPart=new ks,this.activePart=this.mainPart,this.parts=[this.mainPart],this.onDidChangeGroupMaximized=D.None,this.partOptions=Wt,this._serviceBrand=void 0,this.onDidChangeActiveGroup=D.None,this.onDidAddGroup=D.None,this.onDidRemoveGroup=D.None,this.onDidMoveGroup=D.None,this.onDidActivateGroup=D.None,this.onDidLayout=D.None,this.onDidScroll=D.None,this.onDidChangeGroupIndex=D.None,this.onDidChangeGroupLocked=D.None,this.activeGroup=OA,this.groups=[OA],this.count=0,this.orientation=rc.HORIZONTAL,this.isReady=!1,this.whenReady=Promise.resolve(),this.whenRestored=Promise.resolve(),this.hasRestorableState=!1,this.getGroups=()=>[],this.getGroup=()=>{},this.isLayoutCentered=()=>!1,this.findGroup=()=>{},this.onDidChangeEditorPartOptions=D.None}getScopedInstantiationService(){_()}registerContextKeyProvider(){_()}saveWorkingSet(){_()}getWorkingSets(){_()}applyWorkingSet(){_()}deleteWorkingSet(){_()}getPart(){_()}createAuxiliaryEditorPart(){_()}toggleMaximizeGroup(){_()}toggleExpandGroup(){_()}createEditorDropTarget(){_()}getLayout(){_()}get contentDimension(){return _()}get sideGroup(){return _()}activateGroup(){_()}getSize(){_()}setSize(){_()}arrangeGroups(){_()}applyLayout(){_()}centerLayout(){_()}setGroupOrientation(){_()}addGroup(){_()}removeGroup(){_()}moveGroup(){_()}mergeGroup(){_()}mergeAllGroups(){_()}copyGroup(){_()}enforcePartOptions(){_()}}f([b],vn.prototype,"getScopedInstantiationService",null);f([b],vn.prototype,"registerContextKeyProvider",null);f([b],vn.prototype,"saveWorkingSet",null);f([b],vn.prototype,"getWorkingSets",null);f([b],vn.prototype,"applyWorkingSet",null);f([b],vn.prototype,"deleteWorkingSet",null);f([b],vn.prototype,"getPart",null);f([b],vn.prototype,"createAuxiliaryEditorPart",null);f([b],vn.prototype,"toggleMaximizeGroup",null);f([b],vn.prototype,"toggleExpandGroup",null);f([b],vn.prototype,"createEditorDropTarget",null);f([b],vn.prototype,"getLayout",null);f([b],vn.prototype,"contentDimension",null);f([b],vn.prototype,"sideGroup",null);f([b],vn.prototype,"activateGroup",null);f([b],vn.prototype,"getSize",null);f([b],vn.prototype,"setSize",null);f([b],vn.prototype,"arrangeGroups",null);f([b],vn.prototype,"applyLayout",null);f([b],vn.prototype,"centerLayout",null);f([b],vn.prototype,"setGroupOrientation",null);f([b],vn.prototype,"addGroup",null);f([b],vn.prototype,"removeGroup",null);f([b],vn.prototype,"moveGroup",null);f([b],vn.prototype,"mergeGroup",null);f([b],vn.prototype,"mergeAllGroups",null);f([b],vn.prototype,"copyGroup",null);f([b],vn.prototype,"enforcePartOptions",null);$(Ie,vn,G.Eager);class rke{focus(){}focusNextAction(){}focusPreviousAction(){}hide(){}show(){}}$(LIe,rke,G.Eager);class YN{constructor(){this.onMenubarVisibilityChange=D.None,this.isCommandCenterVisible=!1,this.onDidChangeCommandCenterVisibility=D.None,this.registerVariables=()=>{}}getPart(){_()}createAuxiliaryTitlebarPart(){_()}dispose(){_()}updateProperties(){}}f([b],YN.prototype,"getPart",null);f([b],YN.prototype,"createAuxiliaryTitlebarPart",null);f([b],YN.prototype,"dispose",null);$(nDe,YN,G.Eager);class qh{constructor(){this.onWillRunWorkingCopyFileOperation=D.None,this.onDidFailWorkingCopyFileOperation=D.None,this.onDidRunWorkingCopyFileOperation=D.None,this.hasSaveParticipants=!1,this.getDirty=()=>[]}addFileOperationParticipant(){_()}addSaveParticipant(){_()}runSaveParticipants(){_()}create(){_()}createFolder(){_()}move(){_()}copy(){_()}delete(){_()}registerWorkingCopyProvider(){_()}}f([b],qh.prototype,"addFileOperationParticipant",null);f([b],qh.prototype,"addSaveParticipant",null);f([b],qh.prototype,"runSaveParticipants",null);f([b],qh.prototype,"create",null);f([b],qh.prototype,"createFolder",null);f([b],qh.prototype,"move",null);f([b],qh.prototype,"copy",null);f([b],qh.prototype,"delete",null);f([b],qh.prototype,"registerWorkingCopyProvider",null);$(mg,qh,G.Eager);class MI{constructor(){this.defaultUriScheme="file",this.resolvedUserHome=void 0}get path(){return _()}fileURI(){_()}userHome(){_()}hasValidBasename(){_()}}f([b],MI.prototype,"path",null);f([b],MI.prototype,"fileURI",null);f([b],MI.prototype,"userHome",null);f([b],MI.prototype,"hasValidBasename",null);$(_c,MI,G.Delayed);class ake{constructor(){this._serviceBrand=void 0,this.version="unknown",this.commit="unknown",this.quality="oss",this.nameShort="Code - OSS Dev",this.nameLong="Code - OSS Dev",this.applicationName="code-oss",this.dataFolderName=".vscode-oss",this.urlProtocol="code-oss",this.reportIssueUrl="https://github.com/microsoft/vscode/issues/new",this.licenseName="MIT",this.licenseUrl="https://github.com/microsoft/vscode/blob/main/LICENSE.txt",this.serverApplicationName="code-server-oss",this.extensionProperties={}}}$(Fn,ake,G.Eager);class cke{constructor(){this._serviceBrand=void 0,this.getConfigBasedTips=async()=>[],this.getImportantExecutableBasedTips=async()=>[],this.getOtherExecutableBasedTips=async()=>[]}}$(FEe,cke,G.Eager);class Uz{constructor(){this.onDidChange=D.None}addStatus(){_()}getLanguageStatus(){_()}}f([b],Uz.prototype,"addStatus",null);f([b],Uz.prototype,"getLanguageStatus",null);$(Rz,Uz,G.Delayed);class zh{constructor(){this.getElementData=async()=>{},this.getNativeWindowHandle=async()=>{},this.getScreenshot=async()=>{},this.getPathForFile=()=>{},this.onDidChangeFullScreen=D.None,this.onDidChangeFocus=D.None,this.hasFocus=!1,this.hadLastFocus=async()=>!1,this.onDidChangeActiveWindow=D.None}focus(){_()}openWindow(){_()}toggleFullScreen(){_()}moveTop(){_()}getCursorScreenPoint(){_()}restart(){_()}reload(){_()}close(){_()}withExpectedShutdown(){_()}}f([b],zh.prototype,"focus",null);f([b],zh.prototype,"openWindow",null);f([b],zh.prototype,"toggleFullScreen",null);f([b],zh.prototype,"moveTop",null);f([b],zh.prototype,"getCursorScreenPoint",null);f([b],zh.prototype,"restart",null);f([b],zh.prototype,"reload",null);f([b],zh.prototype,"close",null);f([b],zh.prototype,"withExpectedShutdown",null);$(Wn,zh,G.Eager);class Tae extends eB{shutdown(){_()}}f([b],Tae.prototype,"shutdown",null);$(wd,Tae,G.Eager);class dke{isEnabledForLanguage(){return!1}async detectLanguage(){}}$(Hse,dke,G.Eager);$(hn,xme,G.Eager);class lke{constructor(){this.onDidChangeKeyboardLayout=D.None,this.getRawKeyboardMapping=()=>null,this.getCurrentKeyboardLayout=()=>null,this.getAllKeyboardLayouts=()=>[],this.getKeyboardMapper=()=>new BIe(!1,Yu),this.validateCurrentKeyboardMapping=()=>{}}}$(UEe,lke,G.Delayed);class hke{async requiresInitialization(){return!1}async whenInitializationFinished(){}async initializeRequiredResources(){}async initializeInstalledExtensions(){}async initializeOtherResources(){}}$(BN,hke,G.Eager);class uke{constructor(){this.dark=!1,this.highContrast=!1,this.onDidChangeColorScheme=D.None}}$(Hre,uke,G.Eager);let go=class{constructor(e){this.profileService=e,this.onDidDefaultSettingsContentChanged=D.None,this.getDefaultSettingsContent=()=>{},this.hasDefaultSettingsContent=()=>!1,this.getSetting=()=>{},this.userSettingsResource=this.profileService.currentProfile.settingsResource,this.workspaceSettingsResource=null,this.openPreferences=async()=>{}}getFolderSettingsResource(){_()}createPreferencesEditorModel(){_()}resolveModel(){_()}createSettings2EditorModel(){_()}openRawDefaultSettings(){_()}openSettings(){_()}openUserSettings(){_()}openRemoteSettings(){_()}openWorkspaceSettings(){_()}openFolderSettings(){_()}openGlobalKeybindingSettings(){_()}openDefaultKeybindingsFile(){_()}getEditableSettingsURI(){_()}createSplitJsonEditorInput(){_()}openApplicationSettings(){_()}openLanguageSpecificSettings(){_()}};f([b],go.prototype,"getFolderSettingsResource",null);f([b],go.prototype,"createPreferencesEditorModel",null);f([b],go.prototype,"resolveModel",null);f([b],go.prototype,"createSettings2EditorModel",null);f([b],go.prototype,"openRawDefaultSettings",null);f([b],go.prototype,"openSettings",null);f([b],go.prototype,"openUserSettings",null);f([b],go.prototype,"openRemoteSettings",null);f([b],go.prototype,"openWorkspaceSettings",null);f([b],go.prototype,"openFolderSettings",null);f([b],go.prototype,"openGlobalKeybindingSettings",null);f([b],go.prototype,"openDefaultKeybindingsFile",null);f([b],go.prototype,"getEditableSettingsURI",null);f([b],go.prototype,"createSplitJsonEditorInput",null);f([b],go.prototype,"openApplicationSettings",null);f([b],go.prototype,"openLanguageSpecificSettings",null);go=f([p(0,Fh)],go);$(Fv,go,G.Eager);class QN{constructor(){this.onDidEncounterLanguage=D.None}createGrammar(){_()}startDebugMode(){_()}createTokenizer(){_()}}f([b],QN.prototype,"createGrammar",null);f([b],QN.prototype,"startDebugMode",null);f([b],QN.prototype,"createTokenizer",null);$(tDe,QN,G.Eager);let gc=class{constructor(e){this.profileService=e,this.onDidResetWorkspaces=D.None,this.isEnabled=()=>!1,this.defaultProfile=this.profileService.currentProfile,this.onDidChangeProfiles=D.None,this.profiles=[this.profileService.currentProfile],this.getProfile=()=>this.profileService.currentProfile}createNamedProfile(){_()}createTransientProfile(){_()}resetWorkspaces(){_()}cleanUp(){_()}cleanUpTransientProfiles(){_()}get profilesHome(){return _()}createProfile(){_()}updateProfile(){_()}setProfileForWorkspace(){_()}removeProfile(){_()}};f([b],gc.prototype,"createNamedProfile",null);f([b],gc.prototype,"createTransientProfile",null);f([b],gc.prototype,"resetWorkspaces",null);f([b],gc.prototype,"cleanUp",null);f([b],gc.prototype,"cleanUpTransientProfiles",null);f([b],gc.prototype,"profilesHome",null);f([b],gc.prototype,"createProfile",null);f([b],gc.prototype,"updateProfile",null);f([b],gc.prototype,"setProfileForWorkspace",null);f([b],gc.prototype,"removeProfile",null);gc=f([p(0,Fh)],gc);$(Wv,gc,G.Eager);class XN{constructor(){this.onDidChange=D.None}readStorageData(){_()}updateStorageData(){_()}withProfileScopedStorageService(){_()}}f([b],XN.prototype,"readStorageData",null);f([b],XN.prototype,"updateStorageData",null);f([b],XN.prototype,"withProfileScopedStorageService",null);$(YEe,XN,G.Eager);let kB=class extends oDe{constructor(e){super({...Lme("__default__profile__","Default",e.userRoamingDataHome,xt(e.cacheHome,"CachedProfilesData")),isDefault:!0})}};kB=f([p(0,po)],kB);$(Fh,kB,G.Eager);$(Ime,tCe,G.Eager);let Iw=class{constructor(){this.getSnippets=async()=>[]}getSnippetFiles(){_()}isEnabled(){_()}updateEnablement(){_()}updateUsageTimestamp(){_()}getSnippetsSync(){_()}};f([b],Iw.prototype,"getSnippetFiles",null);f([b],Iw.prototype,"isEnabled",null);f([b],Iw.prototype,"updateEnablement",null);f([b],Iw.prototype,"updateUsageTimestamp",null);f([b],Iw.prototype,"getSnippetsSync",null);$(PN,Iw,G.Eager);const gke={getSession:()=>{},getSessions:()=>[],getBreakpoints:()=>[],areBreakpointsActivated:()=>!1,getFunctionBreakpoints:()=>[],getDataBreakpoints:()=>[],getExceptionBreakpoints:()=>[],getExceptionBreakpointsForSession:()=>[],getInstructionBreakpoints:()=>[],getWatchExpressions:()=>[],onDidChangeBreakpoints:D.None,onDidChangeCallStack:D.None,onDidChangeWatchExpressions:D.None,fetchCallstack:_,getId:_,registerBreakpointModes:_,getBreakpointModes:()=>[],onDidChangeWatchExpressionValue:D.None};class _f{constructor(){this.getVisualizedExpression=()=>{},this.onDidChangeVisualization=D.None,this.focusedSession=void 0,this.focusedThread=void 0,this.focusedStackFrame=void 0,this.onDidFocusSession=D.None,this.onDidFocusStackFrame=D.None,this.onDidSelectExpression=D.None,this.onDidEvaluateLazyExpression=D.None,this.onWillUpdateViews=D.None,this.onDidFocusThread=D.None}setVisualizedExpression(){_()}getId(){_()}getSelectedExpression(){_()}setSelectedExpression(){_()}updateViews(){_()}isMultiSessionView(){_()}evaluateLazyExpression(){_()}}f([b],_f.prototype,"setVisualizedExpression",null);f([b],_f.prototype,"getId",null);f([b],_f.prototype,"getSelectedExpression",null);f([b],_f.prototype,"setSelectedExpression",null);f([b],_f.prototype,"updateViews",null);f([b],_f.prototype,"isMultiSessionView",null);f([b],_f.prototype,"evaluateLazyExpression",null);class Cl{constructor(){this.onDidRegisterDebugger=D.None,this.hasEnabledDebuggers=()=>!1,this.someDebuggerInterestedInLanguage=()=>!1,this.getDebugger=()=>{},this.registerDebugAdapterFactory=()=>F.None,this.onDidDebuggersExtPointRead=D.None}getDebugAdapterDescriptor(){_()}getDebuggerLabel(){_()}activateDebuggers(){_()}createDebugAdapter(){_()}registerDebugAdapterDescriptorFactory(){_()}unregisterDebugAdapterDescriptorFactory(){_()}substituteVariables(){_()}runInTerminal(){_()}getEnabledDebugger(){_()}guessDebugger(){_()}}f([b],Cl.prototype,"getDebugAdapterDescriptor",null);f([b],Cl.prototype,"getDebuggerLabel",null);f([b],Cl.prototype,"activateDebuggers",null);f([b],Cl.prototype,"createDebugAdapter",null);f([b],Cl.prototype,"registerDebugAdapterDescriptorFactory",null);f([b],Cl.prototype,"unregisterDebugAdapterDescriptorFactory",null);f([b],Cl.prototype,"substituteVariables",null);f([b],Cl.prototype,"runInTerminal",null);f([b],Cl.prototype,"getEnabledDebugger",null);f([b],Cl.prototype,"guessDebugger",null);class nn{constructor(){this.initializingOptions=void 0,this.onDidChangeState=D.None,this.onDidNewSession=D.None,this.onWillNewSession=D.None,this.onDidEndSession=D.None,this.getAdapterManager=()=>new Cl,this.getModel=()=>gke,this.getViewModel=()=>new _f}sendBreakpoints(){_()}updateDataBreakpoint(){_()}get state(){return _()}getConfigurationManager(){_()}focusStackFrame(){_()}canSetBreakpointsIn(){_()}addBreakpoints(){_()}updateBreakpoints(){_()}enableOrDisableBreakpoints(){_()}setBreakpointsActivated(){_()}removeBreakpoints(){_()}addFunctionBreakpoint(){_()}updateFunctionBreakpoint(){_()}removeFunctionBreakpoints(){_()}addDataBreakpoint(){_()}removeDataBreakpoints(){_()}addInstructionBreakpoint(){_()}removeInstructionBreakpoints(){_()}setExceptionBreakpointCondition(){_()}setExceptionBreakpointsForSession(){_()}sendAllBreakpoints(){_()}addWatchExpression(){_()}renameWatchExpression(){_()}moveWatchExpression(){_()}removeWatchExpressions(){_()}startDebugging(){_()}restartSession(){_()}stopSession(){_()}sourceIsNotAvailable(){_()}runTo(){_()}}f([b],nn.prototype,"sendBreakpoints",null);f([b],nn.prototype,"updateDataBreakpoint",null);f([b],nn.prototype,"state",null);f([b],nn.prototype,"getConfigurationManager",null);f([b],nn.prototype,"focusStackFrame",null);f([b],nn.prototype,"canSetBreakpointsIn",null);f([b],nn.prototype,"addBreakpoints",null);f([b],nn.prototype,"updateBreakpoints",null);f([b],nn.prototype,"enableOrDisableBreakpoints",null);f([b],nn.prototype,"setBreakpointsActivated",null);f([b],nn.prototype,"removeBreakpoints",null);f([b],nn.prototype,"addFunctionBreakpoint",null);f([b],nn.prototype,"updateFunctionBreakpoint",null);f([b],nn.prototype,"removeFunctionBreakpoints",null);f([b],nn.prototype,"addDataBreakpoint",null);f([b],nn.prototype,"removeDataBreakpoints",null);f([b],nn.prototype,"addInstructionBreakpoint",null);f([b],nn.prototype,"removeInstructionBreakpoints",null);f([b],nn.prototype,"setExceptionBreakpointCondition",null);f([b],nn.prototype,"setExceptionBreakpointsForSession",null);f([b],nn.prototype,"sendAllBreakpoints",null);f([b],nn.prototype,"addWatchExpression",null);f([b],nn.prototype,"renameWatchExpression",null);f([b],nn.prototype,"moveWatchExpression",null);f([b],nn.prototype,"removeWatchExpressions",null);f([b],nn.prototype,"startDebugging",null);f([b],nn.prototype,"restartSession",null);f([b],nn.prototype,"stopSession",null);f([b],nn.prototype,"sourceIsNotAvailable",null);f([b],nn.prototype,"runTo",null);$(Cz,nn,G.Eager);class Dw{lookupAuthorization(){_()}lookupKerberosAuthorization(){_()}request(){_()}resolveProxy(){_()}loadCertificates(){_()}}f([b],Dw.prototype,"lookupAuthorization",null);f([b],Dw.prototype,"lookupKerberosAuthorization",null);f([b],Dw.prototype,"request",null);f([b],Dw.prototype,"resolveProxy",null);f([b],Dw.prototype,"loadCertificates",null);$(UM,Dw,G.Eager);let ZN=class{constructor(){this.onDidInitiateOpenFilesTrustRequest=D.None,this.onDidInitiateWorkspaceTrustRequest=D.None,this.onDidInitiateWorkspaceTrustRequestOnStartup=D.None,this.requestOpenFilesTrust=async()=>Ud.Open,this.requestWorkspaceTrust=async()=>!0,this.requestWorkspaceTrustOnStartup=()=>null}completeOpenFilesTrustRequest(){_()}cancelWorkspaceTrustRequest(){_()}completeWorkspaceTrustRequest(){_()}};f([b],ZN.prototype,"completeOpenFilesTrustRequest",null);f([b],ZN.prototype,"cancelWorkspaceTrustRequest",null);f([b],ZN.prototype,"completeWorkspaceTrustRequest",null);$(Fie,ZN,G.Eager);class $z{constructor(){this.onDidChangeActivity=D.None,this.showViewContainerActivity=()=>F.None,this.showViewActivity=()=>F.None,this.showAccountsActivity=()=>F.None,this.showGlobalActivity=()=>F.None}getViewContainerActivities(){_()}getActivity(){_()}}f([b],$z.prototype,"getViewContainerActivities",null);f([b],$z.prototype,"getActivity",null);$(Hv,$z,G.Eager);class kw{constructor(){this.onReload=D.None,this.onClose=D.None,this.onAttachSession=D.None,this.onTerminateSession=D.None}reload(){_()}close(){_()}attachSession(){_()}terminateSession(){_()}openExtensionDevelopmentHostWindow(){_()}}f([b],kw.prototype,"reload",null);f([b],kw.prototype,"close",null);f([b],kw.prototype,"attachSession",null);f([b],kw.prototype,"terminateSession",null);f([b],kw.prototype,"openExtensionDevelopmentHostWindow",null);$(Uoe,kw,G.Eager);class Tw{constructor(){this.getFocusedView=()=>null,this.isViewContainerActive=()=>!1,this.onDidChangeFocusedView=D.None,this.onDidChangeViewContainerVisibility=D.None,this.isViewContainerVisible=()=>!1,this.getActiveViewPaneContainerWithId=()=>null,this.onDidChangeViewVisibility=D.None,this.isViewVisible=()=>!1,this.openView=async()=>null,this.getActiveViewWithId=()=>null,this.getViewWithId=()=>null,this.getViewProgressIndicator=()=>{}}getFocusedViewName(){_()}openViewContainer(){_()}closeViewContainer(){_()}getVisibleViewContainer(){_()}closeView(){_()}}f([b],Tw.prototype,"getFocusedViewName",null);f([b],Tw.prototype,"openViewContainer",null);f([b],Tw.prototype,"closeViewContainer",null);f([b],Tw.prototype,"getVisibleViewContainer",null);f([b],Tw.prototype,"closeView",null);$(mo,Tw,G.Eager);class zv{constructor(){this.viewContainers=[],this.onDidChangeViewContainers=D.None,this.getDefaultViewContainer=()=>{},this.getViewContainerById=()=>null,this.getDefaultViewContainerLocation=()=>null,this.getViewContainerLocation=()=>null,this.getViewContainerModel=()=>({onDidChangeAllViewDescriptors:D.None,visibleViewDescriptors:[]}),this.onDidChangeContainerLocation=D.None,this.getViewDescriptorById=()=>null,this.getViewContainerByViewId=()=>null,this.getDefaultContainerById=()=>null,this.getViewLocationById=()=>null,this.onDidChangeContainer=D.None,this.onDidChangeLocation=D.None,this.moveViewToLocation=()=>null,this.reset=()=>null}isViewContainerRemovedPermanently(){_()}getViewContainersByLocation(){_()}moveViewContainerToLocation(){_()}getViewContainerBadgeEnablementState(){_()}setViewContainerBadgeEnablementState(){_()}moveViewsToContainer(){_()}}f([b],zv.prototype,"isViewContainerRemovedPermanently",null);f([b],zv.prototype,"getViewContainersByLocation",null);f([b],zv.prototype,"moveViewContainerToLocation",null);f([b],zv.prototype,"getViewContainerBadgeEnablementState",null);f([b],zv.prototype,"setViewContainerBadgeEnablementState",null);f([b],zv.prototype,"moveViewsToContainer",null);$(Os,zv,G.Eager);class El{constructor(){this.suspendTracking=()=>({dispose(){}}),this.getHistory=()=>[],this.getLastActiveWorkspaceRoot=()=>{},this.getLastActiveFile=()=>{}}goForward(){_()}goBack(){_()}goPrevious(){_()}goLast(){_()}reopenLastClosedEditor(){_()}removeFromHistory(){_()}openNextRecentlyUsedEditor(){_()}openPreviouslyUsedEditor(){_()}clear(){_()}clearRecentlyOpened(){_()}}f([b],El.prototype,"goForward",null);f([b],El.prototype,"goBack",null);f([b],El.prototype,"goPrevious",null);f([b],El.prototype,"goLast",null);f([b],El.prototype,"reopenLastClosedEditor",null);f([b],El.prototype,"removeFromHistory",null);f([b],El.prototype,"openNextRecentlyUsedEditor",null);f([b],El.prototype,"openPreviouslyUsedEditor",null);f([b],El.prototype,"clear",null);f([b],El.prototype,"clearRecentlyOpened",null);$(fo,El,G.Eager);class _o{constructor(){this.onDidChangeTaskProviders=D.None,this.getKnownTasks=async()=>[],this.onDidChangeTaskConfig=D.None,this.onDidStateChange=D.None,this.supportsMultipleTaskExecutions=!1,this.inTerminal=()=>!1,this.getActiveTasks=async()=>[],this.registerTaskSystem=()=>{},this.onDidChangeTaskSystemInfo=D.None,this.hasTaskSystemInfo=!1,this.registerSupportedExecutions=()=>{},this.isReconnected=!1,this.onDidReconnectToTasks=D.None}configureAction(){_()}rerun(){_()}run(){_()}getBusyTasks(){_()}terminate(){_()}tasks(){_()}taskTypes(){_()}getWorkspaceTasks(){_()}getSavedTasks(){_()}removeRecentlyUsedTask(){_()}getTask(){_()}tryResolveTask(){_()}createSorter(){_()}getTaskDescription(){_()}customize(){_()}openConfig(){_()}registerTaskProvider(){_()}extensionCallbackTaskComplete(){_()}}f([b],_o.prototype,"configureAction",null);f([b],_o.prototype,"rerun",null);f([b],_o.prototype,"run",null);f([b],_o.prototype,"getBusyTasks",null);f([b],_o.prototype,"terminate",null);f([b],_o.prototype,"tasks",null);f([b],_o.prototype,"taskTypes",null);f([b],_o.prototype,"getWorkspaceTasks",null);f([b],_o.prototype,"getSavedTasks",null);f([b],_o.prototype,"removeRecentlyUsedTask",null);f([b],_o.prototype,"getTask",null);f([b],_o.prototype,"tryResolveTask",null);f([b],_o.prototype,"createSorter",null);f([b],_o.prototype,"getTaskDescription",null);f([b],_o.prototype,"customize",null);f([b],_o.prototype,"openConfig",null);f([b],_o.prototype,"registerTaskProvider",null);f([b],_o.prototype,"extensionCallbackTaskComplete",null);$(yre,_o,G.Eager);class bf{constructor(){this.resolvableVariables=new Set}resolveWithEnvironment(){_()}resolveAsync(){_()}resolveAnyAsync(){_()}resolveAnyMap(){_()}resolveWithInteractionReplace(){_()}resolveWithInteraction(){_()}contributeVariable(){_()}}f([b],bf.prototype,"resolveWithEnvironment",null);f([b],bf.prototype,"resolveAsync",null);f([b],bf.prototype,"resolveAnyAsync",null);f([b],bf.prototype,"resolveAnyMap",null);f([b],bf.prototype,"resolveWithInteractionReplace",null);f([b],bf.prototype,"resolveWithInteraction",null);f([b],bf.prototype,"contributeVariable",null);$(Use,bf,G.Eager);class Aae{constructor(){this.getConnection=()=>null,this.getEnvironment=async()=>null,this.getRawEnvironment=async()=>null,this.getExtensionHostExitInfo=async()=>null,this.getRoundTripTime=async()=>{},this.whenExtensionsReady=async()=>{},this.scanExtensions=async()=>[],this.scanSingleExtension=async()=>null,this.getDiagnosticInfo=async()=>{},this.updateTelemetryLevel=async()=>{},this.logTelemetry=async()=>{},this.flushTelemetry=async()=>{}}endConnection(){_()}}f([b],Aae.prototype,"endConnection",null);$(Nh,Aae,G.Eager);$(kme,Dme,G.Eager);let wy=class{constructor(e){this.modelService=e,this.schemeHasFileSearchProvider=()=>!1,this.getAIName=async()=>{}}aiTextSearch(){_()}textSearchSplitSyncAsync(){_()}async textSearch(){return{results:[],messages:[]}}async fileSearch(){return{results:this.modelService.getModels().map(e=>({resource:e.uri})),messages:[]}}async clearCache(){}registerSearchResultProvider(){_()}};f([b],wy.prototype,"aiTextSearch",null);f([b],wy.prototype,"textSearchSplitSyncAsync",null);f([b],wy.prototype,"registerSearchResultProvider",null);wy=f([p(0,ai)],wy);$(DI,wy,G.Eager);class pke{constructor(){this.registerEditSessionIdentityProvider=()=>F.None,this.getEditSessionIdentifier=async()=>{},this.provideEditSessionIdentityMatch=async()=>{},this.addEditSessionIdentityCreateParticipant=()=>F.None,this.onWillCreateEditSessionIdentity=async()=>{}}}$(gz,pke,G.Eager);class Sg{addFolders(){_()}removeFolders(){_()}updateFolders(){_()}enterWorkspace(){_()}createAndEnterWorkspace(){_()}saveAndEnterWorkspace(){_()}copyWorkspaceSettings(){_()}pickNewWorkspacePath(){_()}}f([b],Sg.prototype,"addFolders",null);f([b],Sg.prototype,"removeFolders",null);f([b],Sg.prototype,"updateFolders",null);f([b],Sg.prototype,"enterWorkspace",null);f([b],Sg.prototype,"createAndEnterWorkspace",null);f([b],Sg.prototype,"saveAndEnterWorkspace",null);f([b],Sg.prototype,"copyWorkspaceSettings",null);f([b],Sg.prototype,"pickNewWorkspacePath",null);$(uc,Sg,G.Eager);class Kv{constructor(){this.setPerformanceMarks=()=>{}}getStartTime(){_()}whenReady(){_()}get perfBaseline(){return _()}get startupMetrics(){return _()}getPerformanceMarks(){_()}getDuration(){_()}}f([b],Kv.prototype,"getStartTime",null);f([b],Kv.prototype,"whenReady",null);f([b],Kv.prototype,"perfBaseline",null);f([b],Kv.prototype,"startupMetrics",null);f([b],Kv.prototype,"getPerformanceMarks",null);f([b],Kv.prototype,"getDuration",null);$(Ure,Kv,G.Eager);class Ji{constructor(){this.getExtensionRuntimeStatus=()=>{},this.onDidChangeExtensionsNotification=D.None,this.getExtensionsNotification=()=>{},this.shouldRequireConsentToUpdate=async()=>{},this.whenInitialized=Promise.resolve(),this.onChange=D.None,this.onReset=D.None,this.preferPreReleases=!1,this.local=[],this.installed=[],this.outdated=[]}downloadVSIX(){_()}updateAutoUpdateForAllExtensions(){_()}openSearch(){_()}updateAutoUpdateValue(){_()}getResourceExtensions(){_()}updateRunningExtensions(){_()}togglePreRelease(){_()}isAutoUpdateEnabledFor(){_()}updateAutoUpdateEnablementFor(){_()}isAutoUpdateEnabled(){_()}getAutoUpdateValue(){_()}updateAll(){_()}toggleApplyExtensionToAllProfiles(){_()}queryLocal(){_()}queryGallery(){_()}getExtensions(){_()}canInstall(){_()}install(){_()}installInServer(){_()}uninstall(){_()}installVersion(){_()}reinstall(){_()}canSetLanguage(){_()}setLanguage(){_()}setEnablement(){_()}pinExtension(){_()}open(){_()}checkForUpdates(){_()}getExtensionStatus(){_()}isExtensionIgnoredToSync(){_()}toggleExtensionIgnoredToSync(){_()}}f([b],Ji.prototype,"downloadVSIX",null);f([b],Ji.prototype,"updateAutoUpdateForAllExtensions",null);f([b],Ji.prototype,"openSearch",null);f([b],Ji.prototype,"updateAutoUpdateValue",null);f([b],Ji.prototype,"getResourceExtensions",null);f([b],Ji.prototype,"updateRunningExtensions",null);f([b],Ji.prototype,"togglePreRelease",null);f([b],Ji.prototype,"isAutoUpdateEnabledFor",null);f([b],Ji.prototype,"updateAutoUpdateEnablementFor",null);f([b],Ji.prototype,"isAutoUpdateEnabled",null);f([b],Ji.prototype,"getAutoUpdateValue",null);f([b],Ji.prototype,"updateAll",null);f([b],Ji.prototype,"toggleApplyExtensionToAllProfiles",null);f([b],Ji.prototype,"queryLocal",null);f([b],Ji.prototype,"queryGallery",null);f([b],Ji.prototype,"getExtensions",null);f([b],Ji.prototype,"canInstall",null);f([b],Ji.prototype,"install",null);f([b],Ji.prototype,"installInServer",null);f([b],Ji.prototype,"uninstall",null);f([b],Ji.prototype,"installVersion",null);f([b],Ji.prototype,"reinstall",null);f([b],Ji.prototype,"canSetLanguage",null);f([b],Ji.prototype,"setLanguage",null);f([b],Ji.prototype,"setEnablement",null);f([b],Ji.prototype,"pinExtension",null);f([b],Ji.prototype,"open",null);f([b],Ji.prototype,"checkForUpdates",null);f([b],Ji.prototype,"getExtensionStatus",null);f([b],Ji.prototype,"isExtensionIgnoredToSync",null);f([b],Ji.prototype,"toggleExtensionIgnoredToSync",null);$(EI,Ji,G.Eager);class Gz{constructor(){this._serviceBrand=void 0,this.localExtensionManagementServer=null,this.remoteExtensionManagementServer=null,this.webExtensionManagementServer=null}getExtensionManagementServer(){_()}getExtensionInstallLocation(){_()}}f([b],Gz.prototype,"getExtensionManagementServer",null);f([b],Gz.prototype,"getExtensionInstallLocation",null);$(Wre,Gz,G.Eager);class fke{constructor(){this.onDidChangeRecommendations=D.None,this.getAllRecommendationsWithReason=()=>({}),this.getImportantRecommendations=async()=>[],this.getOtherRecommendations=async()=>[],this.getFileBasedRecommendations=()=>[],this.getExeBasedRecommendations=async()=>({important:[],others:[]}),this.getConfigBasedRecommendations=async()=>({important:[],others:[]}),this.getWorkspaceRecommendations=async()=>[],this.getKeymapRecommendations=()=>[],this.getLanguageRecommendations=()=>[],this.getRemoteRecommendations=()=>[]}}$(NIe,fke,G.Eager);class JN{constructor(){this.onError=D.None}turnOn(){_()}turnOff(){_()}triggerSync(){_()}}f([b],JN.prototype,"turnOn",null);f([b],JN.prototype,"turnOff",null);f([b],JN.prototype,"triggerSync",null);$(nxe,JN,G.Eager);class qz{constructor(){this.getIgnoredExtensions=()=>[],this.hasToNeverSyncExtension=()=>!1,this.hasToAlwaysSyncExtension=()=>!1}updateIgnoredExtensions(){_()}updateSynchronizedExtensions(){_()}}f([b],qz.prototype,"updateIgnoredExtensions",null);f([b],qz.prototype,"updateSynchronizedExtensions",null);$(QEe,qz,G.Eager);class zz{constructor(){this.ignoredRecommendations=[],this.hasToIgnoreRecommendationNotifications=()=>!1}promptImportantExtensionsInstallNotification(){_()}promptWorkspaceRecommendations(){_()}}f([b],zz.prototype,"promptImportantExtensionsInstallNotification",null);f([b],zz.prototype,"promptWorkspaceRecommendations",null);$(VEe,zz,G.Eager);class eO{constructor(){this.scanSystemExtensions=async()=>[],this.scanUserExtensions=async()=>[],this.scanExtensionsUnderDevelopment=async()=>[],this.scanExistingExtension=async()=>null,this.removeExtension=async()=>{},this.copyExtensions=async()=>{},this.scanExtensionManifest=async()=>null}addExtension(){_()}addExtensionFromGallery(){_()}updateMetadata(){_()}}f([b],eO.prototype,"addExtension",null);f([b],eO.prototype,"addExtensionFromGallery",null);f([b],eO.prototype,"updateMetadata",null);$(Az,eO,G.Eager);class Lr{constructor(){this.onDidChangeCache=D.None}get systemExtensionsLocation(){return _()}get userExtensionsLocation(){return _()}getTargetPlatform(){_()}scanAllExtensions(){_()}scanSystemExtensions(){_()}scanUserExtensions(){_()}scanExtensionsUnderDevelopment(){_()}scanExistingExtension(){_()}scanOneOrMultipleExtensions(){_()}scanMultipleExtensions(){_()}scanAllUserExtensions(){_()}scanMetadata(){_()}updateMetadata(){_()}initializeDefaultProfileExtensions(){_()}updateManifestMetadata(){_()}}f([b],Lr.prototype,"systemExtensionsLocation",null);f([b],Lr.prototype,"userExtensionsLocation",null);f([b],Lr.prototype,"getTargetPlatform",null);f([b],Lr.prototype,"scanAllExtensions",null);f([b],Lr.prototype,"scanSystemExtensions",null);f([b],Lr.prototype,"scanUserExtensions",null);f([b],Lr.prototype,"scanExtensionsUnderDevelopment",null);f([b],Lr.prototype,"scanExistingExtension",null);f([b],Lr.prototype,"scanOneOrMultipleExtensions",null);f([b],Lr.prototype,"scanMultipleExtensions",null);f([b],Lr.prototype,"scanAllUserExtensions",null);f([b],Lr.prototype,"scanMetadata",null);f([b],Lr.prototype,"updateMetadata",null);f([b],Lr.prototype,"initializeDefaultProfileExtensions",null);f([b],Lr.prototype,"updateManifestMetadata",null);$(BEe,Lr,G.Eager);class Aw{constructor(){this.onAddExtensions=D.None,this.onDidAddExtensions=D.None,this.onRemoveExtensions=D.None,this.onDidRemoveExtensions=D.None}scanProfileExtensions(){_()}addExtensionsToProfile(){_()}updateMetadata(){_()}removeExtensionFromProfile(){_()}removeExtensionsFromProfile(){_()}}f([b],Aw.prototype,"scanProfileExtensions",null);f([b],Aw.prototype,"addExtensionsToProfile",null);f([b],Aw.prototype,"updateMetadata",null);f([b],Aw.prototype,"removeExtensionFromProfile",null);f([b],Aw.prototype,"removeExtensionsFromProfile",null);$(EN,Aw,G.Eager);class Rae{constructor(){this.onDidChangeIgnoredRecommendations=D.None,this.ignoredRecommendations=[],this.onDidChangeGlobalIgnoredRecommendation=D.None,this.globalIgnoredRecommendations=[]}toggleGlobalIgnoredRecommendation(){_()}}f([b],Rae.prototype,"toggleGlobalIgnoredRecommendation",null);$(OIe,Rae,G.Eager);class Rw{constructor(){this.onDidChangeExtensionsConfigs=D.None}getExtensionsConfigs(){_()}getRecommendations(){_()}getUnwantedRecommendations(){_()}toggleRecommendation(){_()}toggleUnwantedRecommendation(){_()}}f([b],Rw.prototype,"getExtensionsConfigs",null);f([b],Rw.prototype,"getRecommendations",null);f([b],Rw.prototype,"getUnwantedRecommendations",null);f([b],Rw.prototype,"toggleRecommendation",null);f([b],Rw.prototype,"toggleUnwantedRecommendation",null);$(FIe,Rw,G.Eager);class Kz{constructor(){this.getEnablementStates=e=>e.map(()=>bu.EnabledGlobally),this.onEnablementChanged=D.None,this.getEnablementState=()=>bu.EnabledGlobally,this.getDependenciesEnablementStates=()=>[],this.canChangeEnablement=()=>!1,this.canChangeWorkspaceEnablement=()=>!1,this.isEnabled=()=>!0,this.isEnabledEnablementState=()=>!0,this.isDisabledGlobally=()=>!1}setEnablement(){_()}updateExtensionsEnablementsWhenWorkspaceTrustChanges(){_()}}f([b],Kz.prototype,"setEnablement",null);f([b],Kz.prototype,"updateExtensionsEnablementsWhenWorkspaceTrustChanges",null);$(gd,Kz,G.Eager);class Pw{constructor(){this.canChangeProtocol=!1,this.tunnels=Promise.resolve([]),this.canChangePrivacy=!1,this.privacyOptions=[],this.onTunnelOpened=D.None,this.onTunnelClosed=D.None,this.canElevate=!1,this.hasTunnelProvider=!1,this.onAddedTunnelProvider=D.None,this.canTunnel=()=>!1,this.getExistingTunnel=async()=>{},this.isPortPrivileged=()=>!1}openTunnel(){_()}setEnvironmentTunnel(){_()}closeTunnel(){_()}setTunnelProvider(){_()}setTunnelFeatures(){_()}}f([b],Pw.prototype,"openTunnel",null);f([b],Pw.prototype,"setEnvironmentTunnel",null);f([b],Pw.prototype,"closeTunnel",null);f([b],Pw.prototype,"setTunnelProvider",null);f([b],Pw.prototype,"setTunnelFeatures",null);$(DN,Pw,G.Eager);class Cg{constructor(){this.onDidChangeAutoSaveConfiguration=D.None,this.onDidChangeAutoSaveDisabled=D.None,this.hasShortAutoSaveDelay=()=>!1,this.onDidChangeReadonly=D.None,this.onDidChangeFilesAssociation=D.None,this.onAutoSaveConfigurationChange=D.None,this.onReadonlyChange=D.None,this.onFilesAssociationChange=D.None,this.isHotExitEnabled=!0,this.hotExitConfiguration=void 0}disableAutoSave(){_()}enableAutoSaveAfterShortDelay(){_()}getAutoSaveConfiguration(){_()}getAutoSaveMode(){_()}toggleAutoSave(){_()}isReadonly(){_()}updateReadonly(){_()}preventSaveConflicts(){_()}}f([b],Cg.prototype,"disableAutoSave",null);f([b],Cg.prototype,"enableAutoSaveAfterShortDelay",null);f([b],Cg.prototype,"getAutoSaveConfiguration",null);f([b],Cg.prototype,"getAutoSaveMode",null);f([b],Cg.prototype,"toggleAutoSave",null);f([b],Cg.prototype,"isReadonly",null);f([b],Cg.prototype,"updateReadonly",null);f([b],Cg.prototype,"preventSaveConflicts",null);$(Ns,Cg,G.Eager);class jz{constructor(){this.onDidSave=D.None,this.onDidCreate=D.None,this.canDispose=()=>!0,this.isUntitledWithAssociatedResource=()=>!1,this.onDidChangeDirty=D.None,this.onDidChangeEncoding=D.None,this.onDidChangeLabel=D.None,this.onWillDispose=D.None,this.get=()=>{},this.getValue=()=>{}}create(){_()}resolve(){_()}}f([b],jz.prototype,"create",null);f([b],jz.prototype,"resolve",null);$(Qq,jz,G.Eager);class mke{async hasBackups(){return!1}hasBackupSync(){return!1}async getBackups(){return[]}async resolve(){}async backup(){}async discardBackup(){}async discardBackups(){}}$(Xq,mke,G.Eager);class vke{constructor(){this.onDidRegister=D.None,this.onDidUnregister=D.None,this.onDidChangeDirty=D.None,this.onDidChangeContent=D.None,this.onDidSave=D.None,this.dirtyCount=0,this.dirtyWorkingCopies=[],this.modifiedCount=0,this.modifiedWorkingCopies=[],this.hasDirty=!1,this.isDirty=()=>!1,this.workingCopies=[],this.has=()=>!1,this.get=()=>{},this.getAll=()=>{}}registerWorkingCopy(){return F.None}}$(vg,vke,G.Eager);class Pae{constructor(){this.onDidChangeDecorations=D.None,this.getDecoration=()=>{}}registerDecorationsProvider(){_()}}f([b],Pae.prototype,"registerDecorationsProvider",null);$(kv,Pae,G.Eager);class Lae{constructor(){this.isSupported=()=>!1}writeFileElevated(){_()}}f([b],Lae.prototype,"writeFileElevated",null);$($se,Lae,G.Eager);class yc{preferredHome(){_()}defaultFilePath(){_()}defaultFolderPath(){_()}defaultWorkspacePath(){_()}pickFileFolderAndOpen(){_()}pickFileAndOpen(){_()}pickFolderAndOpen(){_()}pickWorkspaceAndOpen(){_()}pickFileToSave(){_()}showSaveDialog(){_()}showSaveConfirm(){_()}showOpenDialog(){_()}}f([b],yc.prototype,"preferredHome",null);f([b],yc.prototype,"defaultFilePath",null);f([b],yc.prototype,"defaultFolderPath",null);f([b],yc.prototype,"defaultWorkspacePath",null);f([b],yc.prototype,"pickFileFolderAndOpen",null);f([b],yc.prototype,"pickFileAndOpen",null);f([b],yc.prototype,"pickFolderAndOpen",null);f([b],yc.prototype,"pickWorkspaceAndOpen",null);f([b],yc.prototype,"pickFileToSave",null);f([b],yc.prototype,"showSaveDialog",null);f([b],yc.prototype,"showSaveConfirm",null);f([b],yc.prototype,"showOpenDialog",null);$(js,yc,G.Eager);class Mae{write(){_()}}f([b],Mae.prototype,"write",null);$(Tme,Mae,G.Delayed);class Kh{constructor(){this.onDidChangeRecentlyOpened=D.None}enterWorkspace(){_()}createUntitledWorkspace(){_()}deleteUntitledWorkspace(){_()}getWorkspaceIdentifier(){_()}addRecentlyOpened(){_()}removeRecentlyOpened(){_()}clearRecentlyOpened(){_()}getRecentlyOpened(){_()}getDirtyWorkspaces(){_()}}f([b],Kh.prototype,"enterWorkspace",null);f([b],Kh.prototype,"createUntitledWorkspace",null);f([b],Kh.prototype,"deleteUntitledWorkspace",null);f([b],Kh.prototype,"getWorkspaceIdentifier",null);f([b],Kh.prototype,"addRecentlyOpened",null);f([b],Kh.prototype,"removeRecentlyOpened",null);f([b],Kh.prototype,"clearRecentlyOpened",null);f([b],Kh.prototype,"getRecentlyOpened",null);f([b],Kh.prototype,"getDirtyWorkspaces",null);$(Wh,Kh,G.Delayed);class Yz{createTextEditor(){_()}resolveTextEditor(){_()}}f([b],Yz.prototype,"createTextEditor",null);f([b],Yz.prototype,"resolveTextEditor",null);$(iDe,Yz,G.Eager);class Lw{constructor(){this.onDidChangeEditorRegistrations=D.None,this.getEditors=()=>[]}getAllUserAssociations(){_()}getAssociationsForResource(){_()}updateUserAssociations(){_()}bufferChangeEvents(){_()}registerEditor(){return{dispose:()=>{}}}resolveEditor(){_()}}f([b],Lw.prototype,"getAllUserAssociations",null);f([b],Lw.prototype,"getAssociationsForResource",null);f([b],Lw.prototype,"updateUserAssociations",null);f([b],Lw.prototype,"bufferChangeEvents",null);f([b],Lw.prototype,"resolveEditor",null);$(vf,Lw,G.Eager);class tO{constructor(){this.canSetLogLevel=()=>!1,this.getLogLevel=()=>{},this.setLogLevel=()=>{},this.onActiveOutputChannel=D.None}get filters(){return _()}getChannel(){}registerCompoundLogChannel(){_()}saveOutputAs(){_()}getChannelDescriptor(){}getChannelDescriptors(){return[]}getActiveChannel(){}async showChannel(){}}f([b],tO.prototype,"filters",null);f([b],tO.prototype,"registerCompoundLogChannel",null);f([b],tO.prototype,"saveOutputAs",null);$(FN,tO,G.Delayed);let Qz=class{constructor(){this.supportsExtensionGalleryResources=async()=>!1,this.isExtensionGalleryResource=async()=>!1}readExtensionResource(){_()}getExtensionGalleryResourceURL(){_()}};f([b],Qz.prototype,"readExtensionResource",null);f([b],Qz.prototype,"getExtensionGalleryResourceURL",null);$(hz,Qz,G.Eager);class _ke{scanBuiltinExtensions(){return Promise.resolve([])}}$(HEe,_ke,G.Eager);class Mr{constructor(){this.roots=[]}get sortOrderConfiguration(){return _()}getContext(){_()}hasViewFocus(){_()}setEditable(){_()}getEditable(){_()}getEditableData(){_()}isEditable(){_()}findClosest(){_()}findClosestRoot(){_()}refresh(){_()}setToCopy(){_()}isCut(){_()}applyBulkEdit(){_()}select(){_()}registerView(){_()}}f([b],Mr.prototype,"sortOrderConfiguration",null);f([b],Mr.prototype,"getContext",null);f([b],Mr.prototype,"hasViewFocus",null);f([b],Mr.prototype,"setEditable",null);f([b],Mr.prototype,"getEditable",null);f([b],Mr.prototype,"getEditableData",null);f([b],Mr.prototype,"isEditable",null);f([b],Mr.prototype,"findClosest",null);f([b],Mr.prototype,"findClosestRoot",null);f([b],Mr.prototype,"refresh",null);f([b],Mr.prototype,"setToCopy",null);f([b],Mr.prototype,"isCut",null);f([b],Mr.prototype,"applyBulkEdit",null);f([b],Mr.prototype,"select",null);f([b],Mr.prototype,"registerView",null);$(Qi,Mr,G.Delayed);class iO{constructor(){this.getExtensionState=()=>{},this.getExtensionStateRaw=()=>{},this.onDidChangeExtensionStorageToSync=D.None,this.getKeysForSync=()=>{},this.getSourceExtensionToMigrate=()=>{}}setExtensionState(){_()}setKeysForSync(){_()}addToMigrationList(){_()}}f([b],iO.prototype,"setExtensionState",null);f([b],iO.prototype,"setKeysForSync",null);f([b],iO.prototype,"addToMigrationList",null);$(lz,iO,G.Delayed);class bke{constructor(){this.onDidChangeEnablement=D.None}getDisabledExtensions(){return[]}enableExtension(){return Promise.resolve(!0)}disableExtension(){return Promise.resolve(!0)}}$($oe,bke,G.Delayed);class yke{async getAvailableLanguages(){return[]}async getInstalledLanguages(){return[]}async getBuiltInExtensionTranslationsUri(e,t){const i=Gre(t)?.[e];return i!=null?R.parse(i):void 0}}$(Goe,yke,G.Delayed);class Xz{removeDragOperationTransfer(){_()}addDragOperationTransfer(){_()}}f([b],Xz.prototype,"removeDragOperationTransfer",null);f([b],Xz.prototype,"addDragOperationTransfer",null);$(pq,Xz,G.Delayed);let Nae=class{constructor(){this.getWidget=()=>{}}register(){_()}};f([b],Nae.prototype,"register",null);$(Uh,Nae,G.Eager);class Oae{constructor(){this.onDidChange=D.None,this.canCreateOutline=()=>!1,this.createOutline=async()=>{}}registerOutlineCreator(){_()}}f([b],Oae.prototype,"registerOutlineCreator",null);$(Pz,Oae,G.Eager);class Mw{constructor(){this.onStateChange=D.None,this.state=jEe.Uninitialized,this.isLatestVersion=async()=>!0}checkForUpdates(){_()}downloadUpdate(){_()}applyUpdate(){_()}quitAndInstall(){_()}_applySpecificUpdate(){_()}}f([b],Mw.prototype,"checkForUpdates",null);f([b],Mw.prototype,"downloadUpdate",null);f([b],Mw.prototype,"applyUpdate",null);f([b],Mw.prototype,"quitAndInstall",null);f([b],Mw.prototype,"_applySpecificUpdate",null);$(zoe,Mw,G.Eager);class Nw{constructor(){this.onDidChangeEntryVisibility=D.None,this.addEntry=()=>({dispose:()=>{},update:()=>{}}),this.isEntryVisible=()=>!1,this.updateEntryVisibility=()=>{},this.focus=()=>{},this.focusNextEntry=()=>{},this.focusPreviousEntry=()=>{},this.isEntryFocused=()=>!1,this.overrideStyle=()=>F.None}overrideEntry(){_()}getPart(){_()}createAuxiliaryStatusbarPart(){_()}createScoped(){_()}dispose(){_()}}f([b],Nw.prototype,"overrideEntry",null);f([b],Nw.prototype,"getPart",null);f([b],Nw.prototype,"createAuxiliaryStatusbarPart",null);f([b],Nw.prototype,"createScoped",null);f([b],Nw.prototype,"dispose",null);$(kN,Nw,G.Eager);class Ra{constructor(){this.isEnabled=()=>!1,this.getAllVersions=async()=>[]}query(){_()}getExtensions(){_()}isExtensionCompatible(){_()}getCompatibleExtension(){_()}getAllCompatibleVersions(){_()}download(){_()}downloadSignatureArchive(){_()}reportStatistic(){_()}getReadme(){_()}getManifest(){_()}getChangelog(){_()}getCoreTranslation(){_()}getExtensionsControlManifest(){_()}}f([b],Ra.prototype,"query",null);f([b],Ra.prototype,"getExtensions",null);f([b],Ra.prototype,"isExtensionCompatible",null);f([b],Ra.prototype,"getCompatibleExtension",null);f([b],Ra.prototype,"getAllCompatibleVersions",null);f([b],Ra.prototype,"download",null);f([b],Ra.prototype,"downloadSignatureArchive",null);f([b],Ra.prototype,"reportStatistic",null);f([b],Ra.prototype,"getReadme",null);f([b],Ra.prototype,"getManifest",null);f([b],Ra.prototype,"getChangelog",null);f([b],Ra.prototype,"getCoreTranslation",null);f([b],Ra.prototype,"getExtensionsControlManifest",null);$(dz,Ra,G.Eager);class Gi{constructor(){this.onAnyInstanceAddedCapabilityType=D.None,this.onAnyInstanceShellTypeChanged=D.None,this.onAnyInstanceData=D.None,this.detachedInstances=[],this.onAnyInstanceDataInput=D.None,this.onAnyInstanceIconChange=D.None,this.onAnyInstanceMaximumDimensionsChange=D.None,this.onAnyInstancePrimaryStatusChange=D.None,this.onAnyInstanceProcessIdReady=D.None,this.onAnyInstanceSelectionChange=D.None,this.onAnyInstanceTitleChange=D.None,this.onDidChangeSelection=D.None,this.detachedXterms=[],this.whenConnected=Promise.resolve(),this.restoredGroupCount=0,this.instances=[],this.isProcessSupportRegistered=!1,this.connectionState=JW.Connected,this.defaultLocation=fy.Panel,this.onDidChangeActiveGroup=D.None,this.onDidDisposeGroup=D.None,this.onDidCreateInstance=D.None,this.onDidReceiveProcessId=D.None,this.onDidChangeInstanceDimensions=D.None,this.onDidMaximumDimensionsChange=D.None,this.onDidRequestStartExtensionTerminal=D.None,this.onDidChangeInstanceTitle=D.None,this.onDidChangeInstanceIcon=D.None,this.onDidChangeInstanceColor=D.None,this.onDidChangeInstancePrimaryStatus=D.None,this.onDidInputInstanceData=D.None,this.onDidRegisterProcessSupport=D.None,this.onDidChangeConnectionState=D.None,this.getReconnectedTerminals=()=>{},this.registerProcessSupport=()=>{},this.activeInstance=void 0,this.onDidDisposeInstance=D.None,this.onDidFocusInstance=D.None,this.onDidChangeActiveInstance=D.None,this.onDidChangeInstances=D.None,this.onDidChangeInstanceCapability=D.None}revealTerminal(){_()}focusInstance(){_()}createOnInstanceCapabilityEvent(){return{event:D.None,dispose(){}}}moveIntoNewEditor(){_()}createOnInstanceEvent(e){return new Mme(this.instances,this.onDidCreateInstance,this.onDidDisposeInstance,e)}createDetachedTerminal(){_()}createDetachedXterm(){_()}get configHelper(){return _()}revealActiveTerminal(){_()}createTerminal(){_()}getInstanceFromId(){_()}getInstanceFromIndex(){_()}getActiveOrCreateInstance(){_()}moveToEditor(){_()}moveToTerminalView(){_()}getPrimaryBackend(){_()}refreshActiveGroup(){_()}showProfileQuickPick(){_()}setContainers(){_()}requestStartExtensionTerminal(){_()}isAttachedToTerminal(){_()}getEditableData(){_()}setEditable(){_()}isEditable(){_()}safeDisposeTerminal(){_()}getDefaultInstanceHost(){_()}getInstanceHost(){_()}resolveLocation(){_()}setNativeDelegate(){_()}toggleEscapeSequenceLogging(){_()}getEditingTerminal(){_()}setEditingTerminal(){_()}setActiveInstance(){_()}focusActiveInstance(){_()}getInstanceFromResource(){_()}}f([b],Gi.prototype,"revealTerminal",null);f([b],Gi.prototype,"focusInstance",null);f([b],Gi.prototype,"moveIntoNewEditor",null);f([b],Gi.prototype,"createDetachedTerminal",null);f([b],Gi.prototype,"createDetachedXterm",null);f([b],Gi.prototype,"configHelper",null);f([b],Gi.prototype,"revealActiveTerminal",null);f([b],Gi.prototype,"createTerminal",null);f([b],Gi.prototype,"getInstanceFromId",null);f([b],Gi.prototype,"getInstanceFromIndex",null);f([b],Gi.prototype,"getActiveOrCreateInstance",null);f([b],Gi.prototype,"moveToEditor",null);f([b],Gi.prototype,"moveToTerminalView",null);f([b],Gi.prototype,"getPrimaryBackend",null);f([b],Gi.prototype,"refreshActiveGroup",null);f([b],Gi.prototype,"showProfileQuickPick",null);f([b],Gi.prototype,"setContainers",null);f([b],Gi.prototype,"requestStartExtensionTerminal",null);f([b],Gi.prototype,"isAttachedToTerminal",null);f([b],Gi.prototype,"getEditableData",null);f([b],Gi.prototype,"setEditable",null);f([b],Gi.prototype,"isEditable",null);f([b],Gi.prototype,"safeDisposeTerminal",null);f([b],Gi.prototype,"getDefaultInstanceHost",null);f([b],Gi.prototype,"getInstanceHost",null);f([b],Gi.prototype,"resolveLocation",null);f([b],Gi.prototype,"setNativeDelegate",null);f([b],Gi.prototype,"toggleEscapeSequenceLogging",null);f([b],Gi.prototype,"getEditingTerminal",null);f([b],Gi.prototype,"setEditingTerminal",null);f([b],Gi.prototype,"setActiveInstance",null);f([b],Gi.prototype,"focusActiveInstance",null);f([b],Gi.prototype,"getInstanceFromResource",null);$(Ew,Gi,G.Delayed);class NI{constructor(){this.onConfigChanged=D.None}get config(){return _()}setPanelContainer(){_()}configFontIsMonospace(){_()}getFont(){_()}}f([b],NI.prototype,"config",null);f([b],NI.prototype,"setPanelContainer",null);f([b],NI.prototype,"configFontIsMonospace",null);f([b],NI.prototype,"getFont",null);$(SIe,NI,G.Delayed);class wc{constructor(){this.instances=[],this.activeInstance=void 0,this.onDidDisposeInstance=D.None,this.onDidFocusInstance=D.None,this.onDidChangeActiveInstance=D.None,this.onDidChangeInstances=D.None,this.onDidChangeInstanceCapability=D.None}focusInstance(){_()}openEditor(){_()}detachActiveEditorInstance(){_()}detachInstance(){_()}splitInstance(){_()}revealActiveEditor(){_()}resolveResource(){_()}reviveInput(){_()}getInputFromResource(){_()}setActiveInstance(){_()}focusActiveInstance(){_()}getInstanceFromResource(){_()}}f([b],wc.prototype,"focusInstance",null);f([b],wc.prototype,"openEditor",null);f([b],wc.prototype,"detachActiveEditorInstance",null);f([b],wc.prototype,"detachInstance",null);f([b],wc.prototype,"splitInstance",null);f([b],wc.prototype,"revealActiveEditor",null);f([b],wc.prototype,"resolveResource",null);f([b],wc.prototype,"reviveInput",null);f([b],wc.prototype,"getInputFromResource",null);f([b],wc.prototype,"setActiveInstance",null);f([b],wc.prototype,"focusActiveInstance",null);f([b],wc.prototype,"getInstanceFromResource",null);$(wre,wc,G.Delayed);class Yn{constructor(){this.lastAccessedMenu="inline-tab",this.instances=[],this.groups=[],this.activeGroup=void 0,this.activeGroupIndex=0,this.onDidChangeActiveGroup=D.None,this.onDidDisposeGroup=D.None,this.onDidChangeGroups=D.None,this.onDidShow=D.None,this.onDidChangePanelOrientation=D.None,this.onDidDisposeInstance=D.None,this.onDidFocusInstance=D.None,this.onDidChangeActiveInstance=D.None,this.onDidChangeInstances=D.None,this.onDidChangeInstanceCapability=D.None}focusInstance(){_()}createGroup(){_()}getGroupForInstance(){_()}moveGroup(){_()}moveGroupToEnd(){_()}moveInstance(){_()}unsplitInstance(){_()}joinInstances(){_()}instanceIsSplit(){_()}getGroupLabels(){_()}setActiveGroupByIndex(){_()}setActiveGroupToNext(){_()}setActiveGroupToPrevious(){_()}setActiveInstanceByIndex(){_()}setContainer(){_()}showPanel(){_()}hidePanel(){_()}focusTabs(){_()}focusHover(){_()}showTabs(){_()}updateVisibility(){_()}setActiveInstance(){_()}focusActiveInstance(){_()}getInstanceFromResource(){_()}}f([b],Yn.prototype,"focusInstance",null);f([b],Yn.prototype,"createGroup",null);f([b],Yn.prototype,"getGroupForInstance",null);f([b],Yn.prototype,"moveGroup",null);f([b],Yn.prototype,"moveGroupToEnd",null);f([b],Yn.prototype,"moveInstance",null);f([b],Yn.prototype,"unsplitInstance",null);f([b],Yn.prototype,"joinInstances",null);f([b],Yn.prototype,"instanceIsSplit",null);f([b],Yn.prototype,"getGroupLabels",null);f([b],Yn.prototype,"setActiveGroupByIndex",null);f([b],Yn.prototype,"setActiveGroupToNext",null);f([b],Yn.prototype,"setActiveGroupToPrevious",null);f([b],Yn.prototype,"setActiveInstanceByIndex",null);f([b],Yn.prototype,"setContainer",null);f([b],Yn.prototype,"showPanel",null);f([b],Yn.prototype,"hidePanel",null);f([b],Yn.prototype,"focusTabs",null);f([b],Yn.prototype,"focusHover",null);f([b],Yn.prototype,"showTabs",null);f([b],Yn.prototype,"updateVisibility",null);f([b],Yn.prototype,"setActiveInstance",null);f([b],Yn.prototype,"focusActiveInstance",null);f([b],Yn.prototype,"getInstanceFromResource",null);$(Dz,Yn,G.Delayed);class OI{constructor(){this.onDidRegisterBackend=D.None,this.getRegisteredBackends=()=>[].values(),this.onDidCreateInstance=D.None}convertProfileToShellLaunchConfig(){_()}createInstance(){_()}getBackend(){_()}didRegisterBackend(){_()}}f([b],OI.prototype,"convertProfileToShellLaunchConfig",null);f([b],OI.prototype,"createInstance",null);f([b],OI.prototype,"getBackend",null);f([b],OI.prototype,"didRegisterBackend",null);$(Sre,OI,G.Delayed);class jv{constructor(){this.availableProfiles=[],this.contributedProfiles=[],this.profilesReady=Promise.resolve(),this.getDefaultProfileName=()=>{},this.getDefaultProfile=()=>{},this.onDidChangeAvailableProfiles=D.None}getPlatformKey(){_()}refreshAvailableProfiles(){_()}getContributedDefaultProfile(){_()}registerContributedProfile(){_()}getContributedProfileProvider(){_()}registerTerminalProfileProvider(){_()}}f([b],jv.prototype,"getPlatformKey",null);f([b],jv.prototype,"refreshAvailableProfiles",null);f([b],jv.prototype,"getContributedDefaultProfile",null);f([b],jv.prototype,"registerContributedProfile",null);f([b],jv.prototype,"getContributedProfileProvider",null);f([b],jv.prototype,"registerTerminalProfileProvider",null);$(xre,jv,G.Delayed);class jh{constructor(){this.onDidChangeLogLevel=D.None}getLevel(){_()}setLevel(){_()}trace(){_()}debug(){_()}info(){_()}warn(){_()}error(){_()}flush(){_()}dispose(){_()}}f([b],jh.prototype,"getLevel",null);f([b],jh.prototype,"setLevel",null);f([b],jh.prototype,"trace",null);f([b],jh.prototype,"debug",null);f([b],jh.prototype,"info",null);f([b],jh.prototype,"warn",null);f([b],jh.prototype,"error",null);f([b],jh.prototype,"flush",null);f([b],jh.prototype,"dispose",null);$(KEe,jh,G.Delayed);class Fae{constructor(){this.linkProviders=new Set([]),this.onDidAddLinkProvider=D.None,this.onDidRemoveLinkProvider=D.None}registerLinkProvider(){_()}}f([b],Fae.prototype,"registerLinkProvider",null);$(Ire,Fae,G.Delayed);class wke{constructor(){this.terminalProfiles=[]}}$(CIe,wke,G.Delayed);class yf{constructor(){this.getDefaultProfile=async()=>({profileName:"bash",path:"/bin/bash",isDefault:!0})}resolveIcon(){_()}resolveShellLaunchConfig(){_()}getDefaultShell(){_()}getDefaultShellArgs(){_()}getDefaultIcon(){_()}getEnvironment(){_()}createProfileFromShellAndShellArgs(){_()}}f([b],yf.prototype,"resolveIcon",null);f([b],yf.prototype,"resolveShellLaunchConfig",null);f([b],yf.prototype,"getDefaultShell",null);f([b],yf.prototype,"getDefaultShellArgs",null);f([b],yf.prototype,"getDefaultIcon",null);f([b],yf.prototype,"getEnvironment",null);f([b],yf.prototype,"createProfileFromShellAndShellArgs",null);$(Ere,yf,G.Delayed);class Wae{constructor(){this.collections=new Map,this.onDidChangeCollections=D.None,this.set=()=>{},this.delete=()=>{}}get mergedCollection(){return _()}}f([b],Wae.prototype,"mergedCollection",null);$(Cre,Wae,G.Delayed);class Zz{constructor(){this.onDidRegisterProvider=D.None,this.onDidRegisterCommandSelector=D.None,this.onDidUnregisterProvider=D.None,this.extensionQuickFixes=Promise.resolve([]),this.providers=new Map}registerQuickFixProvider(){_()}registerCommandSelector(){_()}}f([b],Zz.prototype,"registerQuickFixProvider",null);f([b],Zz.prototype,"registerCommandSelector",null);$(Dre,Zz,G.Delayed);class xd{constructor(){this.onDidTurnOnSync=D.None,this.enabled=!1,this.authenticationProviders=[],this.all=[],this.current=void 0,this.accountStatus=jE.Unavailable,this.onDidChangeAccountStatus=D.None}turnOn(){_()}turnoff(){_()}signIn(){_()}resetSyncedData(){_()}showSyncActivity(){_()}syncNow(){_()}synchroniseUserDataSyncStoreType(){_()}showConflicts(){_()}accept(){_()}getAllLogResources(){_()}downloadSyncActivity(){_()}}f([b],xd.prototype,"turnOn",null);f([b],xd.prototype,"turnoff",null);f([b],xd.prototype,"signIn",null);f([b],xd.prototype,"resetSyncedData",null);f([b],xd.prototype,"showSyncActivity",null);f([b],xd.prototype,"syncNow",null);f([b],xd.prototype,"synchroniseUserDataSyncStoreType",null);f([b],xd.prototype,"showConflicts",null);f([b],xd.prototype,"accept",null);f([b],xd.prototype,"getAllLogResources",null);f([b],xd.prototype,"downloadSyncActivity",null);$(cDe,xd,G.Delayed);class Jz{constructor(){this.onDidChangeEnablement=D.None,this.isEnabled=()=>!1,this.canToggleEnablement=()=>!1,this.isResourceEnablementConfigured=()=>!1,this.onDidChangeResourceEnablement=D.None,this.isResourceEnabled=()=>!1,this.getResourceSyncStateVersion=()=>{}}setEnablement(){_()}setResourceEnablement(){_()}}f([b],Jz.prototype,"setEnablement",null);f([b],Jz.prototype,"setResourceEnablement",null);$(exe,Jz,G.Delayed);class FI{addKeybinding(){_()}editKeybinding(){_()}removeKeybinding(){_()}resetKeybinding(){_()}}f([b],FI.prototype,"addKeybinding",null);f([b],FI.prototype,"editKeybinding",null);f([b],FI.prototype,"removeKeybinding",null);f([b],FI.prototype,"resetKeybinding",null);$(VIe,FI,G.Delayed);class nO{getLocalSearchProvider(){_()}getRemoteSearchProvider(){_()}getAiSearchProvider(){_()}}f([b],nO.prototype,"getLocalSearchProvider",null);f([b],nO.prototype,"getRemoteSearchProvider",null);f([b],nO.prototype,"getAiSearchProvider",null);$(fIe,nO,G.Delayed);class Nr{constructor(){this.tryGetDataProviderSync=()=>{},this.canResolve=async()=>!1,this.onAddViewType=D.None,this.onWillRemoveViewType=D.None,this.onDidChangeOutputRenderers=D.None,this.onWillAddNotebookDocument=D.None,this.onDidAddNotebookDocument=D.None,this.onWillRemoveNotebookDocument=D.None,this.onDidRemoveNotebookDocument=D.None,this.getViewTypeProvider=()=>{},this.getRendererInfo=()=>{},this.getRenderers=()=>[],this.getNotebookTextModel=()=>{},this.listNotebookDocuments=()=>[],this.getContributedNotebookType=()=>{},this.getContributedNotebookTypes=()=>[],this.getNotebookProviderResourceRoots=()=>[]}createNotebookTextDocumentSnapshot(){_()}restoreNotebookTextModelFromSnapshot(){_()}hasSupportedNotebooks(){_()}registerNotebookSerializer(){_()}withNotebookDataProvider(){_()}getOutputMimeTypeInfo(){_()}getStaticPreloads(){_()}updateMimePreferredRenderer(){_()}saveMimeDisplayOrder(){_()}createNotebookTextModel(){_()}getNotebookTextModels(){_()}registerContributedNotebookType(){_()}setToCopy(){_()}getToCopy(){_()}clearEditorCache(){_()}}f([b],Nr.prototype,"createNotebookTextDocumentSnapshot",null);f([b],Nr.prototype,"restoreNotebookTextModelFromSnapshot",null);f([b],Nr.prototype,"hasSupportedNotebooks",null);f([b],Nr.prototype,"registerNotebookSerializer",null);f([b],Nr.prototype,"withNotebookDataProvider",null);f([b],Nr.prototype,"getOutputMimeTypeInfo",null);f([b],Nr.prototype,"getStaticPreloads",null);f([b],Nr.prototype,"updateMimePreferredRenderer",null);f([b],Nr.prototype,"saveMimeDisplayOrder",null);f([b],Nr.prototype,"createNotebookTextModel",null);f([b],Nr.prototype,"getNotebookTextModels",null);f([b],Nr.prototype,"registerContributedNotebookType",null);f([b],Nr.prototype,"setToCopy",null);f([b],Nr.prototype,"getToCopy",null);f([b],Nr.prototype,"clearEditorCache",null);$($h,Nr,G.Delayed);class sO{replace(){_()}openReplacePreview(){_()}updateReplacePreview(){_()}}f([b],sO.prototype,"replace",null);f([b],sO.prototype,"openReplacePreview",null);f([b],sO.prototype,"updateReplacePreview",null);$(mIe,sO,G.Delayed);class oO{constructor(){this.onDidClearHistory=D.None}clearHistory(){_()}load(){_()}save(){_()}}f([b],oO.prototype,"clearHistory",null);f([b],oO.prototype,"load",null);f([b],oO.prototype,"save",null);$(bIe,oO,G.Delayed);class WI{constructor(){this.retrieveExistingWidgetFromURI=()=>{},this.retrieveAllExistingWidgets=()=>[],this.onDidAddNotebookEditor=D.None,this.onDidRemoveNotebookEditor=D.None,this.getNotebookEditor=()=>{},this.listNotebookEditors=()=>[]}updateReplContextKey(){_()}retrieveWidget(){_()}addNotebookEditor(){_()}removeNotebookEditor(){_()}}f([b],WI.prototype,"updateReplContextKey",null);f([b],WI.prototype,"retrieveWidget",null);f([b],WI.prototype,"addNotebookEditor",null);f([b],WI.prototype,"removeNotebookEditor",null);$(AN,WI,G.Delayed);class Bae{get searchModel(){return _()}}f([b],Bae.prototype,"searchModel",null);$(vIe,Bae,G.Delayed);class rO{constructor(){this.onDidSaveNotebook=D.None,this.onDidChangeDirty=D.None,this.onWillFailWithConflict=D.None}createUntitledNotebookTextModel(){_()}isDirty(){_()}resolve(){_()}}f([b],rO.prototype,"createUntitledNotebookTextModel",null);f([b],rO.prototype,"isDirty",null);f([b],rO.prototype,"resolve",null);$(xI,rO,G.Delayed);class Ske{constructor(){this.onDidRegisterHandler=D.None,this.registerHandler=()=>F.None,this.findEditor=()=>{}}}$($re,Ske,G.Delayed);class Vae{constructor(){this.isActive=!1,this.onDidChangeIsActive=D.None}markActive(){_()}}f([b],Vae.prototype,"markActive",null);$(Wie,Vae,G.Delayed);class Hae{registerCanonicalUriProvider(){_()}}f([b],Hae.prototype,"registerCanonicalUriProvider",null);$(Bie,Hae,G.Delayed);class Cke{constructor(){this.onDidChange=D.None}setOrUpdateEntry(){return my.DidUpdate}unsetEntry(){}getEntries(){return[]}}$(_z,Cke,G.Delayed);class Eke{constructor(){this.getCurrentExperiments=async()=>[],this.getTreatment=async()=>{}}}$(Gse,Eke,G.Delayed);class Fs{constructor(){this.edits2Enabled=!1,this.isPersistedSessionEmpty=()=>!0,this.unifiedViewEnabled=!1,this.isEditingLocation=()=>!1,this.isEnabled=()=>!1,this.onDidSubmitAgent=D.None,this.hasSessions=()=>!1,this.onDidDisposeSession=D.None,this.transferredSessionData=void 0,this.onDidSubmitSlashCommand=D.None,this.getSessionId=()=>{},this.transferredSessionId=void 0,this.getProviderInfos=()=>[],this.getSession=()=>{},this.getOrRestoreSession=async()=>{},this.loadSessionFromContent=()=>{},this.getHistory=async()=>[],this.onDidPerformUserAction=D.None,this.onDidSubmitRequest=D.None}activateDefaultAgent(){_()}getChatStorageFolder(){_()}logChatIndex(){_()}setChatSessionTitle(){_()}adoptRequest(){_()}resendRequest(){_()}clearAllHistoryEntries(){_()}transferChatSession(){_()}registerSlashCommandProvider(){_()}startSession(){_()}sendRequest(){_()}removeRequest(){_()}cancelCurrentRequestForSession(){_()}getSlashCommands(){_()}clearSession(){_()}addRequest(){_()}addCompleteRequest(){_()}sendRequestToProvider(){_()}removeHistoryEntry(){_()}notifyUserAction(){_()}}f([b],Fs.prototype,"activateDefaultAgent",null);f([b],Fs.prototype,"getChatStorageFolder",null);f([b],Fs.prototype,"logChatIndex",null);f([b],Fs.prototype,"setChatSessionTitle",null);f([b],Fs.prototype,"adoptRequest",null);f([b],Fs.prototype,"resendRequest",null);f([b],Fs.prototype,"clearAllHistoryEntries",null);f([b],Fs.prototype,"transferChatSession",null);f([b],Fs.prototype,"registerSlashCommandProvider",null);f([b],Fs.prototype,"startSession",null);f([b],Fs.prototype,"sendRequest",null);f([b],Fs.prototype,"removeRequest",null);f([b],Fs.prototype,"cancelCurrentRequestForSession",null);f([b],Fs.prototype,"getSlashCommands",null);f([b],Fs.prototype,"clearSession",null);f([b],Fs.prototype,"addRequest",null);f([b],Fs.prototype,"addCompleteRequest",null);f([b],Fs.prototype,"sendRequestToProvider",null);f([b],Fs.prototype,"removeHistoryEntry",null);f([b],Fs.prototype,"notifyUserAction",null);$(mf,Fs,G.Delayed);class Uae{constructor(){this.lastFocusedAnchor=void 0}register(){_()}}f([b],Uae.prototype,"register",null);$(hDe,Uae,G.Delayed);let $ae=class{update(){_()}};f([b],$ae.prototype,"update",null);$(are,$ae,G.Delayed);class Ow{constructor(){this.focused=!1,this.onDidClose=D.None,this.enabled=!1}toggle(){_()}focus(){_()}open(){_()}close(){_()}openInChatView(){_()}}f([b],Ow.prototype,"toggle",null);f([b],Ow.prototype,"focus",null);f([b],Ow.prototype,"open",null);f([b],Ow.prototype,"close",null);f([b],Ow.prototype,"openInChatView",null);$(Jxe,Ow,G.Delayed);class Ws{constructor(){this._serviceBrand=void 0,this.hasToolsAgent=!1,this.onDidChangeToolsAgentModeEnabled=D.None,this.toolsAgentModeEnabled=!1,this.hasChatParticipantDetectionProviders=()=>!1,this.agentHasDupeName=()=>!1,this.getContributedDefaultAgent=()=>{},this.getActivatedAgents=()=>[],this.getAgentsByName=()=>[],this.getDefaultAgent=()=>{},this.onDidChangeAgents=D.None}toggleToolsAgentMode(){_()}setRequestPaused(){_()}registerChatParticipantDetectionProvider(){_()}detectAgentOrCommand(){_()}getChatTitle(){_()}registerAgentCompletionProvider(){_()}getAgentCompletionItems(){_()}getAgentByFullyQualifiedId(){_()}registerAgentImplementation(){_()}registerDynamicAgent(){_()}getFollowups(){_()}getSecondaryAgent(){_()}updateAgent(){_()}registerAgentData(){_()}registerAgentCallback(){_()}registerAgent(){_()}invokeAgent(){_()}getAgents(){_()}getAgent(){_()}hasAgent(){_()}}f([b],Ws.prototype,"toggleToolsAgentMode",null);f([b],Ws.prototype,"setRequestPaused",null);f([b],Ws.prototype,"registerChatParticipantDetectionProvider",null);f([b],Ws.prototype,"detectAgentOrCommand",null);f([b],Ws.prototype,"getChatTitle",null);f([b],Ws.prototype,"registerAgentCompletionProvider",null);f([b],Ws.prototype,"getAgentCompletionItems",null);f([b],Ws.prototype,"getAgentByFullyQualifiedId",null);f([b],Ws.prototype,"registerAgentImplementation",null);f([b],Ws.prototype,"registerDynamicAgent",null);f([b],Ws.prototype,"getFollowups",null);f([b],Ws.prototype,"getSecondaryAgent",null);f([b],Ws.prototype,"updateAgent",null);f([b],Ws.prototype,"registerAgentData",null);f([b],Ws.prototype,"registerAgentCallback",null);f([b],Ws.prototype,"registerAgent",null);f([b],Ws.prototype,"invokeAgent",null);f([b],Ws.prototype,"getAgents",null);f([b],Ws.prototype,"getAgent",null);f([b],Ws.prototype,"hasAgent",null);$(ff,Ws,G.Delayed);let xke=class{getAgentNameRestriction(){return!0}};$(nre,xke,G.Delayed);class Gae{constructor(){this.onDidCreateTerminal=D.None}createTerminal(){_()}}f([b],Gae.prototype,"createTerminal",null);$(eDe,Gae,G.Delayed);class Fw{constructor(){this.registerCustomEditorCapabilities=()=>F.None,this.getCustomEditorCapabilities=()=>{}}get models(){return _()}getCustomEditor(){_()}getAllCustomEditors(){_()}getContributedCustomEditors(){_()}getUserConfiguredCustomEditors(){_()}}f([b],Fw.prototype,"models",null);f([b],Fw.prototype,"getCustomEditor",null);f([b],Fw.prototype,"getAllCustomEditors",null);f([b],Fw.prototype,"getContributedCustomEditors",null);f([b],Fw.prototype,"getUserConfiguredCustomEditors",null);$(Sz,Fw,G.Delayed);class eK{constructor(){this.webviews=[],this.onDidChangeActiveWebview=D.None}createWebviewElement(){_()}createWebviewOverlay(){_()}}f([b],eK.prototype,"createWebviewElement",null);f([b],eK.prototype,"createWebviewOverlay",null);$(MN,eK,G.Delayed);class tK{constructor(){this.onNewResolverRegistered=D.None}register(){_()}resolve(){_()}}f([b],tK.prototype,"register",null);f([b],tK.prototype,"resolve",null);$(Lre,tK,G.Delayed);class qae{setLocale(){_()}clearLocalePreference(){return Promise.resolve()}}f([b],qae.prototype,"setLocale",null);$(HIe,qae,G.Delayed);class Yv{constructor(){this.onDidChangeActiveWebviewEditor=D.None,this.registerResolver=()=>F.None}get iconManager(){return _()}openWebview(){_()}openRevivedWebview(){_()}revealWebview(){_()}shouldPersist(){_()}resolveWebview(){_()}}f([b],Yv.prototype,"iconManager",null);f([b],Yv.prototype,"openWebview",null);f([b],Yv.prototype,"openRevivedWebview",null);f([b],Yv.prototype,"revealWebview",null);f([b],Yv.prototype,"shouldPersist",null);f([b],Yv.prototype,"resolveWebview",null);$(II,Yv,G.Delayed);class Eg{constructor(){this.onDidChangeConnectionData=D.None}resolveAuthority(){_()}getConnectionData(){_()}getCanonicalURI(){_()}_clearResolvedAuthority(){_()}_setResolvedAuthority(){_()}_setResolvedAuthorityError(){_()}_setAuthorityConnectionToken(){_()}_setCanonicalURIProvider(){_()}}f([b],Eg.prototype,"resolveAuthority",null);f([b],Eg.prototype,"getConnectionData",null);f([b],Eg.prototype,"getCanonicalURI",null);f([b],Eg.prototype,"_clearResolvedAuthority",null);f([b],Eg.prototype,"_setResolvedAuthority",null);f([b],Eg.prototype,"_setResolvedAuthorityError",null);f([b],Eg.prototype,"_setAuthorityConnectionToken",null);f([b],Eg.prototype,"_setCanonicalURIProvider",null);$(Hh,Eg,G.Delayed);class Ike{constructor(){this.registerExternalOpenerProvider=()=>F.None,this.getOpener=async()=>{}}}$(dre,Ike,G.Delayed);class Or{constructor(){this.getCodeBlockContext=()=>{}}configureKeybindings(){_()}openHelpLink(){_()}navigateToCodeBlock(){_()}showLastProvider(){_()}showAccessibleViewHelp(){_()}goToSymbol(){_()}disableHint(){_()}next(){_()}previous(){_()}getOpenAriaHint(){_()}show(){_()}registerProvider(){_()}getPosition(){_()}setPosition(){_()}getLastPosition(){_()}}f([b],Or.prototype,"configureKeybindings",null);f([b],Or.prototype,"openHelpLink",null);f([b],Or.prototype,"navigateToCodeBlock",null);f([b],Or.prototype,"showLastProvider",null);f([b],Or.prototype,"showAccessibleViewHelp",null);f([b],Or.prototype,"goToSymbol",null);f([b],Or.prototype,"disableHint",null);f([b],Or.prototype,"next",null);f([b],Or.prototype,"previous",null);f([b],Or.prototype,"getOpenAriaHint",null);f([b],Or.prototype,"show",null);f([b],Or.prototype,"registerProvider",null);f([b],Or.prototype,"getPosition",null);f([b],Or.prototype,"setPosition",null);f([b],Or.prototype,"getLastPosition",null);$(Vh,Or,G.Delayed);class Dke{constructor(){this.hasShownAccessibleView=()=>!1}}$(PIe,Dke,G.Delayed);class Rn{constructor(){this.preferPreReleases=!1,this.onProfileAwareDidInstallExtensions=D.None,this.onProfileAwareDidUninstallExtension=D.None,this.onProfileAwareDidUpdateExtensionMetadata=D.None,this.getInstalledWorkspaceExtensionLocations=()=>[],this.onDidEnableExtensions=D.None,this.isWorkspaceExtensionsSupported=()=>!1,this.getExtensions=async()=>[],this.getInstalledWorkspaceExtensions=async()=>[],this.toggleAppliationScope=async e=>e,this.onInstallExtension=D.None,this.onDidInstallExtensions=D.None,this.onUninstallExtension=D.None,this.onDidUninstallExtension=D.None,this.onDidChangeProfile=D.None,this.onDidUpdateExtensionMetadata=D.None,this.getInstalled=async()=>[],this.getInstallableServers=async()=>[],this.isPublisherTrusted=()=>!1,this.getTrustedPublishers=()=>[]}toggleApplicationScope(){_()}uninstallExtensions(){_()}resetPinnedStateForAllUserExtensions(){_()}installResourceExtension(){_()}installVSIX(){_()}installFromLocation(){_()}updateFromGallery(){_()}zip(){_()}unzip(){_()}getManifest(){_()}install(){_()}canInstall(){_()}installFromGallery(){_()}installGalleryExtensions(){_()}installExtensionsFromProfile(){_()}uninstall(){_()}reinstallFromGallery(){_()}getExtensionsControlManifest(){_()}copyExtensions(){_()}updateMetadata(){_()}download(){_()}registerParticipant(){_()}getTargetPlatform(){_()}cleanUp(){_()}requestPublisherTrust(){_()}trustPublishers(){_()}untrustPublishers(){_()}}f([b],Rn.prototype,"toggleApplicationScope",null);f([b],Rn.prototype,"uninstallExtensions",null);f([b],Rn.prototype,"resetPinnedStateForAllUserExtensions",null);f([b],Rn.prototype,"installResourceExtension",null);f([b],Rn.prototype,"installVSIX",null);f([b],Rn.prototype,"installFromLocation",null);f([b],Rn.prototype,"updateFromGallery",null);f([b],Rn.prototype,"zip",null);f([b],Rn.prototype,"unzip",null);f([b],Rn.prototype,"getManifest",null);f([b],Rn.prototype,"install",null);f([b],Rn.prototype,"canInstall",null);f([b],Rn.prototype,"installFromGallery",null);f([b],Rn.prototype,"installGalleryExtensions",null);f([b],Rn.prototype,"installExtensionsFromProfile",null);f([b],Rn.prototype,"uninstall",null);f([b],Rn.prototype,"reinstallFromGallery",null);f([b],Rn.prototype,"getExtensionsControlManifest",null);f([b],Rn.prototype,"copyExtensions",null);f([b],Rn.prototype,"updateMetadata",null);f([b],Rn.prototype,"download",null);f([b],Rn.prototype,"registerParticipant",null);f([b],Rn.prototype,"getTargetPlatform",null);f([b],Rn.prototype,"cleanUp",null);f([b],Rn.prototype,"requestPublisherTrust",null);f([b],Rn.prototype,"trustPublishers",null);f([b],Rn.prototype,"untrustPublishers",null);$(ON,Rn,G.Delayed);let xl=class{prefersExecuteOnUI(){_()}prefersExecuteOnWorkspace(){_()}prefersExecuteOnWeb(){_()}canExecuteOnUI(){_()}canExecuteOnWorkspace(){_()}canExecuteOnWeb(){_()}getExtensionKind(){_()}getUserConfiguredExtensionKind(){_()}getExtensionUntrustedWorkspaceSupportType(){_()}getExtensionVirtualWorkspaceSupportType(){_()}};f([b],xl.prototype,"prefersExecuteOnUI",null);f([b],xl.prototype,"prefersExecuteOnWorkspace",null);f([b],xl.prototype,"prefersExecuteOnWeb",null);f([b],xl.prototype,"canExecuteOnUI",null);f([b],xl.prototype,"canExecuteOnWorkspace",null);f([b],xl.prototype,"canExecuteOnWeb",null);f([b],xl.prototype,"getExtensionKind",null);f([b],xl.prototype,"getUserConfiguredExtensionKind",null);f([b],xl.prototype,"getExtensionUntrustedWorkspaceSupportType",null);f([b],xl.prototype,"getExtensionVirtualWorkspaceSupportType",null);$($v,xl,G.Delayed);let kke=class{isWorkspaceTrustEnabled(){return!1}};$(fq,kke,G.Delayed);class zae{whenExtensionsReady(){_()}async scanExtensions(){return[]}async scanSingleExtension(){return null}}f([b],zae.prototype,"whenExtensionsReady",null);$(xN,zae,G.Delayed);class iK{constructor(){this.open=async()=>!1}create(){_()}registerHandler(){_()}}f([b],iK.prototype,"create",null);f([b],iK.prototype,"registerHandler",null);$($M,iK,G.Delayed);class nK{register(){_()}connect(){_()}}f([b],nK.prototype,"register",null);f([b],nK.prototype,"connect",null);$(uz,nK,G.Delayed);let aO=class{constructor(){this.onDidChangeQuickDiffProviders=D.None,this.providers=[],this.isQuickDiffProviderVisible=()=>!1}addQuickDiffProvider(){_()}toggleQuickDiffProviderVisibility(){_()}getQuickDiffs(){_()}};f([b],aO.prototype,"addQuickDiffProvider",null);f([b],aO.prototype,"toggleQuickDiffProviderVisibility",null);f([b],aO.prototype,"getQuickDiffs",null);$(RN,aO,G.Delayed);class BI{constructor(){this.onDidChangeInputValueProviders=D.None,this.onDidAddRepository=D.None,this.onDidRemoveRepository=D.None,this.repositories=[],this.repositoryCount=0}getDefaultInputValueProvider(){_()}registerSCMInputValueProvider(){_()}registerSCMProvider(){_()}getRepository(){_()}}f([b],BI.prototype,"getDefaultInputValueProvider",null);f([b],BI.prototype,"registerSCMInputValueProvider",null);f([b],BI.prototype,"registerSCMProvider",null);f([b],BI.prototype,"getRepository",null);$(vre,BI,G.Delayed);class Kae{download(){_()}}f([b],Kae.prototype,"download",null);$(Vie,Kae,G.Delayed);let sK=class{registerExtensionHandler(){_()}unregisterExtensionHandler(){_()}};f([b],sK.prototype,"registerExtensionHandler",null);f([b],sK.prototype,"unregisterExtensionHandler",null);$(Bre,sK,G.Delayed);class fs{constructor(){this.lastActiveCommentcontroller=void 0,this.onResourceHasCommentingRanges=D.None,this.resourceHasCommentingRanges=()=>!1,this.onDidChangeActiveEditingCommentThread=D.None,this.onDidSetResourceCommentInfos=D.None,this.onDidSetAllCommentThreads=D.None,this.onDidUpdateCommentThreads=D.None,this.onDidUpdateNotebookCommentThreads=D.None,this.onDidChangeActiveCommentThread=D.None,this.onDidChangeCurrentCommentThread=D.None,this.onDidUpdateCommentingRanges=D.None,this.onDidChangeActiveCommentingRange=D.None,this.onDidSetDataProvider=D.None,this.onDidDeleteDataProvider=D.None,this.onDidChangeCommentingEnabled=D.None,this.isCommentingEnabled=!1,this.unregisterCommentController=()=>{},this.getDocumentComments=async()=>[],this.getNotebookComments=async()=>[]}get commentsModel(){return _()}setActiveEditingCommentThread(){_()}setActiveCommentAndThread(){_()}setDocumentComments(){_()}setWorkspaceComments(){_()}removeWorkspaceComments(){_()}registerCommentController(){_()}getCommentController(){_()}createCommentThreadTemplate(){_()}updateCommentThreadTemplate(){_()}getCommentMenus(){_()}updateComments(){_()}updateNotebookComments(){_()}disposeCommentThread(){_()}updateCommentingRanges(){_()}hasReactionHandler(){_()}toggleReaction(){_()}setActiveCommentThread(){_()}setCurrentCommentThread(){_()}enableCommenting(){_()}registerContinueOnCommentProvider(){_()}removeContinueOnComment(){_()}}f([b],fs.prototype,"commentsModel",null);f([b],fs.prototype,"setActiveEditingCommentThread",null);f([b],fs.prototype,"setActiveCommentAndThread",null);f([b],fs.prototype,"setDocumentComments",null);f([b],fs.prototype,"setWorkspaceComments",null);f([b],fs.prototype,"removeWorkspaceComments",null);f([b],fs.prototype,"registerCommentController",null);f([b],fs.prototype,"getCommentController",null);f([b],fs.prototype,"createCommentThreadTemplate",null);f([b],fs.prototype,"updateCommentThreadTemplate",null);f([b],fs.prototype,"getCommentMenus",null);f([b],fs.prototype,"updateComments",null);f([b],fs.prototype,"updateNotebookComments",null);f([b],fs.prototype,"disposeCommentThread",null);f([b],fs.prototype,"updateCommentingRanges",null);f([b],fs.prototype,"hasReactionHandler",null);f([b],fs.prototype,"toggleReaction",null);f([b],fs.prototype,"setActiveCommentThread",null);f([b],fs.prototype,"setCurrentCommentThread",null);f([b],fs.prototype,"enableCommenting",null);f([b],fs.prototype,"registerContinueOnCommentProvider",null);f([b],fs.prototype,"removeContinueOnComment",null);$(yg,fs,G.Delayed);class oK{constructor(){this.onDidChangeProviders=D.None,this.onDidChangeItems=D.None}registerCellStatusBarItemProvider(){_()}getStatusBarItemsForCell(){_()}}f([b],oK.prototype,"registerCellStatusBarItemProvider",null);f([b],oK.prototype,"getStatusBarItemsForCell",null);$(ure,oK,G.Delayed);class Pa{constructor(){this.onDidNotebookVariablesUpdate=D.None,this.onDidAddKernel=D.None,this.onDidRemoveKernel=D.None,this.onDidChangeSelectedNotebooks=D.None,this.onDidChangeNotebookAffinity=D.None,this.onDidChangeKernelDetectionTasks=D.None,this.onDidChangeSourceActions=D.None}notifyVariablesChange(){_()}registerKernel(){_()}getMatchingKernel(){_()}getSelectedOrSuggestedKernel(){_()}selectKernelForNotebook(){_()}preselectKernelForNotebook(){_()}updateKernelNotebookAffinity(){_()}registerNotebookKernelDetectionTask(){_()}getKernelDetectionTasks(){_()}getSourceActions(){_()}getRunningSourceActions(){_()}registerKernelSourceActionProvider(){_()}getKernelSourceActions2(){_()}}f([b],Pa.prototype,"notifyVariablesChange",null);f([b],Pa.prototype,"registerKernel",null);f([b],Pa.prototype,"getMatchingKernel",null);f([b],Pa.prototype,"getSelectedOrSuggestedKernel",null);f([b],Pa.prototype,"selectKernelForNotebook",null);f([b],Pa.prototype,"preselectKernelForNotebook",null);f([b],Pa.prototype,"updateKernelNotebookAffinity",null);f([b],Pa.prototype,"registerNotebookKernelDetectionTask",null);f([b],Pa.prototype,"getKernelDetectionTasks",null);f([b],Pa.prototype,"getSourceActions",null);f([b],Pa.prototype,"getRunningSourceActions",null);f([b],Pa.prototype,"registerKernelSourceActionProvider",null);f([b],Pa.prototype,"getKernelSourceActions2",null);$(pre,Pa,G.Delayed);class cO{constructor(){this.onShouldPostMessage=D.None}prepare(){_()}getScoped(){_()}receiveMessage(){_()}}f([b],cO.prototype,"prepare",null);f([b],cO.prototype,"getScoped",null);f([b],cO.prototype,"receiveMessage",null);$(mre,cO,G.Delayed);class Qv{constructor(){this.matchesCurrent=()=>!1}addToHistory(){_()}getPreviousValue(){_()}getNextValue(){_()}replaceLast(){_()}clearHistory(){_()}has(){_()}}f([b],Qv.prototype,"addToHistory",null);f([b],Qv.prototype,"getPreviousValue",null);f([b],Qv.prototype,"getNextValue",null);f([b],Qv.prototype,"replaceLast",null);f([b],Qv.prototype,"clearHistory",null);f([b],Qv.prototype,"has",null);$(lre,Qv,G.Delayed);class rK{constructor(){this.onWillAddInteractiveDocument=D.None,this.onWillRemoveInteractiveDocument=D.None}willCreateInteractiveDocument(){_()}willRemoveInteractiveDocument(){_()}}f([b],rK.prototype,"willCreateInteractiveDocument",null);f([b],rK.prototype,"willRemoveInteractiveDocument",null);$(xz,rK,G.Delayed);class Tke{async getExtensionIdProvidingCurrentLocale(){return pDe()}}$(UIe,Tke,G.Eager);class jae{constructor(){this.getRemoteProfiles=async()=>[]}getRemoteProfile(){_()}}f([b],jae.prototype,"getRemoteProfile",null);$(sDe,jae,G.Eager);let dO=class{constructor(){this.isDisabledByBisect=()=>!1,this.isActive=!1,this.disabledCount=0}start(){_()}next(){_()}reset(){_()}};f([b],dO.prototype,"start",null);f([b],dO.prototype,"next",null);f([b],dO.prototype,"reset",null);$(xw,dO,G.Eager);class Ake{constructor(){this.onTokenFailed=D.None,this.account=void 0,this.onDidChangeAccount=D.None}updateAccount(){return Promise.resolve()}}$(rxe,Ake,G.Eager);class aK{constructor(){this.getWidgetsByLocations=()=>[],this.onDidAddWidget=D.None,this.getAllWidgets=()=>[],this.getWidgetByLocation=()=>[],this.getWidgetBySessionId=()=>{},this.lastFocusedWidget=void 0}revealViewForProvider(){_()}getWidgetByInputUri(){_()}}f([b],aK.prototype,"revealViewForProvider",null);f([b],aK.prototype,"getWidgetByInputUri",null);$(Pr,aK,G.Delayed);class Id{constructor(){this.onDidChangeHelpInformation=D.None,this.onDidChangeTargetType=D.None,this.targetType=[],this.onDidChangeEditable=D.None,this.onEnabledPortsFeatures=D.None,this.portsFeaturesEnabled=Nu.Disabled,this.namedProcesses=new Map}get helpInformation(){return _()}get tunnelModel(){return _()}setEditable(){_()}getEditableData(){_()}forward(){_()}close(){_()}setTunnelInformation(){_()}setCandidateFilter(){_()}onFoundNewCandidates(){_()}restore(){_()}enablePortsFeatures(){_()}}f([b],Id.prototype,"helpInformation",null);f([b],Id.prototype,"tunnelModel",null);f([b],Id.prototype,"setEditable",null);f([b],Id.prototype,"getEditableData",null);f([b],Id.prototype,"forward",null);f([b],Id.prototype,"close",null);f([b],Id.prototype,"setTunnelInformation",null);f([b],Id.prototype,"setCandidateFilter",null);f([b],Id.prototype,"onFoundNewCandidates",null);f([b],Id.prototype,"restore",null);f([b],Id.prototype,"enablePortsFeatures",null);$(WN,Id,G.Delayed);let xg=class{constructor(){this.getAccounts=async()=>[],this.onDidRegisterAuthenticationProvider=D.None,this.onDidUnregisterAuthenticationProvider=D.None,this.onDidChangeSessions=D.None,this.onDidChangeDeclaredProviders=D.None,this.declaredProviders=[],this.isAuthenticationProviderRegistered=()=>!1,this.getProviderIds=()=>[],this.getOrActivateProviderIdForServer=async()=>{},this.registerAuthenticationProviderHostDelegate=()=>F.None,this.createDynamicAuthenticationProvider=async()=>{}}registerDeclaredAuthenticationProvider(){_()}unregisterDeclaredAuthenticationProvider(){_()}registerAuthenticationProvider(){_()}unregisterAuthenticationProvider(){_()}getProvider(){_()}getSessions(){_()}createSession(){_()}removeSession(){_()}};f([b],xg.prototype,"registerDeclaredAuthenticationProvider",null);f([b],xg.prototype,"unregisterDeclaredAuthenticationProvider",null);f([b],xg.prototype,"registerAuthenticationProvider",null);f([b],xg.prototype,"unregisterAuthenticationProvider",null);f([b],xg.prototype,"getProvider",null);f([b],xg.prototype,"getSessions",null);f([b],xg.prototype,"createSession",null);f([b],xg.prototype,"removeSession",null);$(Uv,xg,G.Delayed);class cK{constructor(){this.onDidChangeExtensionSessionAccess=D.None,this.isAccessAllowed=()=>!1,this.readAllowedExtensions=()=>[]}updateAllowedExtensions(){_()}removeAllowedExtensions(){_()}}f([b],cK.prototype,"updateAllowedExtensions",null);f([b],cK.prototype,"removeAllowedExtensions",null);$(NN,cK,G.Delayed);class wf{constructor(){this.onDidChangeAccountPreference=D.None,this.getAccountPreference=()=>{},this.getSessionPreference=()=>{}}updateAccountPreference(){_()}removeAccountPreference(){_()}updateSessionPreference(){_()}removeSessionPreference(){_()}selectSession(){_()}requestSessionAccess(){_()}requestNewSession(){_()}}f([b],wf.prototype,"updateAccountPreference",null);f([b],wf.prototype,"removeAccountPreference",null);f([b],wf.prototype,"updateSessionPreference",null);f([b],wf.prototype,"removeSessionPreference",null);f([b],wf.prototype,"selectSession",null);f([b],wf.prototype,"requestSessionAccess",null);f([b],wf.prototype,"requestNewSession",null);$(Tz,wf,G.Delayed);class VI{constructor(){this.extensionUsesAuth=async()=>!1}initializeExtensionUsageCache(){_()}readAccountUsages(){_()}removeAccountUsage(){_()}addAccountUsage(){_()}}f([b],VI.prototype,"initializeExtensionUsageCache",null);f([b],VI.prototype,"readAccountUsages",null);f([b],VI.prototype,"removeAccountUsage",null);f([b],VI.prototype,"addAccountUsage",null);$(Nre,VI,G.Delayed);class HI{constructor(){this.onDidChangeProviders=D.None,this.onDidChangeTimeline=D.None,this.onDidChangeUri=D.None,this.getSources=()=>[]}registerTimelineProvider(){_()}unregisterTimelineProvider(){_()}getTimeline(){_()}setUri(){_()}}f([b],HI.prototype,"registerTimelineProvider",null);f([b],HI.prototype,"unregisterTimelineProvider",null);f([b],HI.prototype,"getTimeline",null);f([b],HI.prototype,"setUri",null);$(Pre,HI,G.Delayed);class La{constructor(){this.getTestsRelatedToCode=async()=>[],this.getCodeRelatedToTest=async()=>[],this.registerExtHost=()=>F.None,this.onDidCancelTestRun=D.None,this.onWillProcessDiff=D.None,this.onDidProcessDiff=D.None,this.getTestController=()=>{}}provideTestFollowups(){_()}get excluded(){return _()}get collection(){return _()}get showInlineOutput(){return _()}registerTestController(){_()}refreshTests(){_()}cancelRefreshTests(){_()}startContinuousRun(){_()}runTests(){_()}runResolvedTests(){_()}syncTests(){_()}cancelTestRun(){_()}publishDiff(){_()}}f([b],La.prototype,"provideTestFollowups",null);f([b],La.prototype,"excluded",null);f([b],La.prototype,"collection",null);f([b],La.prototype,"showInlineOutput",null);f([b],La.prototype,"registerTestController",null);f([b],La.prototype,"refreshTests",null);f([b],La.prototype,"cancelRefreshTests",null);f([b],La.prototype,"startContinuousRun",null);f([b],La.prototype,"runTests",null);f([b],La.prototype,"runResolvedTests",null);f([b],La.prototype,"syncTests",null);f([b],La.prototype,"cancelTestRun",null);f([b],La.prototype,"publishDiff",null);$(Rre,La,G.Delayed);class dK{constructor(){this.onDidChangeSecret=D.None,this.type="in-memory",this.get=async()=>{}}set(){_()}delete(){_()}}f([b],dK.prototype,"set",null);f([b],dK.prototype,"delete",null);$(IN,dK,G.Delayed);class Yae{constructor(){this.getShareActions=()=>[],this.provideShare=async()=>{}}registerShareProvider(){_()}}f([b],Yae.prototype,"registerShareProvider",null);$(bre,Yae,G.Delayed);class Il{constructor(){this.createProfileFromTemplate=async()=>{},this.resolveProfileTemplate=async()=>null,this.registerProfileContentHandler=()=>F.None,this.unregisterProfileContentHandler=()=>{}}exportProfile2(){_()}createFromProfile(){_()}createProfile(){_()}editProfile(){_()}exportProfile(){_()}importProfile(){_()}showProfileContents(){_()}createFromCurrentProfile(){_()}createTroubleshootProfile(){_()}setProfile(){_()}}f([b],Il.prototype,"exportProfile2",null);f([b],Il.prototype,"createFromProfile",null);f([b],Il.prototype,"createProfile",null);f([b],Il.prototype,"editProfile",null);f([b],Il.prototype,"exportProfile",null);f([b],Il.prototype,"importProfile",null);f([b],Il.prototype,"showProfileContents",null);f([b],Il.prototype,"createFromCurrentProfile",null);f([b],Il.prototype,"createTroubleshootProfile",null);f([b],Il.prototype,"setProfile",null);$(qse,Il,G.Delayed);class UI{registerIssueDataProvider(){_()}openReporter(){_()}openProcessExplorer(){_()}registerIssueUriRequestHandler(){_()}}f([b],UI.prototype,"registerIssueDataProvider",null);f([b],UI.prototype,"openReporter",null);f([b],UI.prototype,"openProcessExplorer",null);f([b],UI.prototype,"registerIssueUriRequestHandler",null);$(rIe,UI,G.Delayed);class Xv{constructor(){this.repositories=[],this.onDidChangeRepositories=D.None,this.visibleRepositories=[],this.onDidChangeVisibleRepositories=D.None,this.isVisible=()=>!1,this.focusedRepository=void 0,this.onDidFocusRepository=D.None}get activeRepository(){return _()}get menus(){return _()}toggleVisibility(){_()}toggleSortKey(){_()}focus(){_()}pinActiveRepository(){_()}}f([b],Xv.prototype,"activeRepository",null);f([b],Xv.prototype,"menus",null);f([b],Xv.prototype,"toggleVisibility",null);f([b],Xv.prototype,"toggleSortKey",null);f([b],Xv.prototype,"focus",null);f([b],Xv.prototype,"pinActiveRepository",null);$(_re,Xv,G.Delayed);class Ig{constructor(){this.getLastCompletedCellForNotebook=()=>{},this.onDidChangeExecution=D.None,this.onDidChangeLastRunFailState=D.None}forceCancelNotebookExecutions(){_()}getCellExecutionsForNotebook(){_()}getCellExecutionsByHandleForNotebook(){_()}getCellExecution(){_()}createCellExecution(){_()}getExecution(){_()}createExecution(){_()}getLastFailedCellForNotebook(){_()}}f([b],Ig.prototype,"forceCancelNotebookExecutions",null);f([b],Ig.prototype,"getCellExecutionsForNotebook",null);f([b],Ig.prototype,"getCellExecutionsByHandleForNotebook",null);f([b],Ig.prototype,"getCellExecution",null);f([b],Ig.prototype,"createCellExecution",null);f([b],Ig.prototype,"getExecution",null);f([b],Ig.prototype,"createExecution",null);f([b],Ig.prototype,"getLastFailedCellForNotebook",null);$(gre,Ig,G.Delayed);class Zv{constructor(){this.getDefaultProfileForTest=()=>{},this.onDidChange=D.None,this.all=()=>[],this.getGroupDefaultProfiles=()=>[],this.getControllerProfiles=()=>[]}addProfile(){_()}updateProfile(){_()}removeProfile(){_()}capabilitiesForTest(){_()}configure(){_()}setGroupDefaultProfiles(){_()}}f([b],Zv.prototype,"addProfile",null);f([b],Zv.prototype,"updateProfile",null);f([b],Zv.prototype,"removeProfile",null);f([b],Zv.prototype,"capabilitiesForTest",null);f([b],Zv.prototype,"configure",null);f([b],Zv.prototype,"setGroupDefaultProfiles",null);$(Tre,Zv,G.Delayed);class Ww{setUsePlainTextEncryption(){_()}getKeyStorageProvider(){_()}encrypt(){_()}decrypt(){_()}isEncryptionAvailable(){_()}}f([b],Ww.prototype,"setUsePlainTextEncryption",null);f([b],Ww.prototype,"getKeyStorageProvider",null);f([b],Ww.prototype,"encrypt",null);f([b],Ww.prototype,"decrypt",null);f([b],Ww.prototype,"isEncryptionAvailable",null);$(OEe,Ww,G.Delayed);class lO{constructor(){this.onResultsChanged=D.None,this.onTestChanged=D.None,this.results=[],this.getResult=()=>{},this.getStateById=()=>{}}clear(){_()}createLiveResult(){_()}push(){_()}}f([b],lO.prototype,"clear",null);f([b],lO.prototype,"createLiveResult",null);f([b],lO.prototype,"push",null);$(Are,lO,G.Delayed);class lK{read(){_()}persist(){_()}}f([b],lK.prototype,"read",null);f([b],lK.prototype,"persist",null);$(IIe,lK,G.Delayed);class $I{constructor(){this.onDidChange=D.None}updateDecorationsAlternateAction(){_()}invalidateResultMessage(){_()}syncDecorations(){_()}getDecoratedTestPosition(){_()}}f([b],$I.prototype,"updateDecorationsAlternateAction",null);f([b],$I.prototype,"invalidateResultMessage",null);f([b],$I.prototype,"syncDecorations",null);f([b],$I.prototype,"getDecoratedTestPosition",null);$(kIe,$I,G.Delayed);class Rke{constructor(){this.requiresInitialization=async()=>!1,this.whenInitializationFinished=async()=>{},this.initializeRequiredResources=async()=>{},this.initializeInstalledExtensions=async()=>{},this.initializeOtherResources=async()=>{}}}$(BN,Rke,G.Delayed);$(NEe,MEe,G.Delayed);class Pke{notebookSearch(){return{openFilesToScan:new Fp,completeData:Promise.resolve({results:[],messages:[]}),allScannedFiles:Promise.resolve(new Fp)}}}$(_Ie,Pke,G.Delayed);let Bw=class{constructor(){this.onDidChangeLanguageModels=D.None,this.getLanguageModelIds=()=>[],this.lookupLanguageModel=()=>{}}sendChatRequest(){_()}selectLanguageModels(){_()}computeTokenLength(){_()}registerLanguageModelChat(){_()}makeLanguageModelChatRequest(){_()}};f([b],Bw.prototype,"sendChatRequest",null);f([b],Bw.prototype,"selectLanguageModels",null);f([b],Bw.prototype,"computeTokenLength",null);f([b],Bw.prototype,"registerLanguageModelChat",null);f([b],Bw.prototype,"makeLanguageModelChatRequest",null);$(Cw,Bw,G.Delayed);class Sf{onDidChangeCommands(){_()}registerSlashData(){_()}registerSlashCallback(){_()}registerSlashCommand(){_()}executeCommand(){_()}getCommands(){_()}hasCommand(){_()}}f([b],Sf.prototype,"onDidChangeCommands",null);f([b],Sf.prototype,"registerSlashData",null);f([b],Sf.prototype,"registerSlashCallback",null);f([b],Sf.prototype,"registerSlashCommand",null);f([b],Sf.prototype,"executeCommand",null);f([b],Sf.prototype,"getCommands",null);f([b],Sf.prototype,"hasCommand",null);$(ore,Sf,G.Delayed);class Yh{constructor(){this.getVariable=()=>{},this.resolveVariable=async()=>[]}attachContext(){_()}getDynamicVariables(){_()}getDynamicReferences(){_()}registerVariable(){_()}getVariables(){_()}resolveVariables(){_()}hasVariable(){_()}getSelectedTools(){_()}getSelectedToolSets(){_()}}f([b],Yh.prototype,"attachContext",null);f([b],Yh.prototype,"getDynamicVariables",null);f([b],Yh.prototype,"getDynamicReferences",null);f([b],Yh.prototype,"registerVariable",null);f([b],Yh.prototype,"getVariables",null);f([b],Yh.prototype,"resolveVariables",null);f([b],Yh.prototype,"hasVariable",null);f([b],Yh.prototype,"getSelectedTools",null);f([b],Yh.prototype,"getSelectedToolSets",null);$(yz,Yh,G.Delayed);class hK{constructor(){this.isEnabled=()=>!1}getRelatedInformation(){_()}registerAiRelatedInformationProvider(){_()}}f([b],hK.prototype,"getRelatedInformation",null);f([b],hK.prototype,"registerAiRelatedInformationProvider",null);$(kz,hK,G.Delayed);class uK{constructor(){this.isEnabled=()=>!1}getEmbeddingVector(){_()}registerAiEmbeddingVectorProvider(){_()}}f([b],uK.prototype,"getEmbeddingVector",null);f([b],uK.prototype,"registerAiEmbeddingVectorProvider",null);$(Mre,uK,G.Delayed);class hO{constructor(){this.isEnabled=()=>!1,this.getEmbeddingsResults=async()=>[],this.getLLMRankedResults=async()=>[],this.onProviderRegistered=D.None}startSearch(){_()}registerSettingsSearchProvider(){_()}handleSearchResult(){_()}}f([b],hO.prototype,"startSearch",null);f([b],hO.prototype,"registerSettingsSearchProvider",null);f([b],hO.prototype,"handleSearchResult",null);$(Cae,hO,G.Delayed);class uO{async createNewMessage(e){return{id:String(uO._nextId++),data:e}}async validate(){return!0}async sign(e){return e}}uO._nextId=1;$(qoe,uO,G.Delayed);class GI{constructor(){this.lastRunProfileIds=new Set,this.onDidChange=D.None,this.isSpecificallyEnabledFor=()=>!1,this.isEnabledForAParentOf=()=>!1,this.isEnabledForAChildOf=()=>!1,this.isEnabled=()=>!1}isEnabledForProfile(){_()}stopProfile(){_()}start(){_()}stop(){_()}}f([b],GI.prototype,"isEnabledForProfile",null);f([b],GI.prototype,"stopProfile",null);f([b],GI.prototype,"start",null);f([b],GI.prototype,"stop",null);$(DIe,GI,G.Delayed);class Dl{constructor(){this.onDidSelectTestInExplorer=D.None,this.onDidRequestInputFocus=D.None,this.isFilteringFor=()=>!1}didSelectTestInExplorer(){_()}get text(){return _()}get reveal(){return _()}get globList(){return _()}get includeTags(){return _()}get excludeTags(){return _()}get fuzzy(){return _()}focusInput(){_()}setText(){_()}toggleFilteringFor(){_()}}f([b],Dl.prototype,"didSelectTestInExplorer",null);f([b],Dl.prototype,"text",null);f([b],Dl.prototype,"reveal",null);f([b],Dl.prototype,"globList",null);f([b],Dl.prototype,"includeTags",null);f([b],Dl.prototype,"excludeTags",null);f([b],Dl.prototype,"fuzzy",null);f([b],Dl.prototype,"focusInput",null);f([b],Dl.prototype,"setText",null);f([b],Dl.prototype,"toggleFilteringFor",null);$(xIe,Dl,G.Delayed);class Jv{get historyVisible(){return _()}tryPeekFirstError(){_()}peekUri(){_()}openCurrentInEditor(){_()}open(){_()}closeAllPeeks(){_()}}f([b],Jv.prototype,"historyVisible",null);f([b],Jv.prototype,"tryPeekFirstError",null);f([b],Jv.prototype,"peekUri",null);f([b],Jv.prototype,"openCurrentInEditor",null);f([b],Jv.prototype,"open",null);f([b],Jv.prototype,"closeAllPeeks",null);$(TIe,Jv,G.Delayed);class Qae{constructor(){this.getWindow=()=>{},this.onDidOpenAuxiliaryWindow=D.None,this.hasWindow=()=>!1}open(){_()}}f([b],Qae.prototype,"open",null);$(Ore,Qae,G.Delayed);class qI{constructor(){this.onDidStartTextToSpeechSession=D.None,this.onDidEndTextToSpeechSession=D.None,this.hasActiveTextToSpeechSession=!1,this.onDidChangeHasSpeechProvider=D.None,this.onDidStartSpeechToTextSession=D.None,this.onDidEndSpeechToTextSession=D.None,this.hasActiveSpeechToTextSession=!1,this.onDidStartKeywordRecognition=D.None,this.onDidEndKeywordRecognition=D.None,this.hasActiveKeywordRecognition=!1,this.onDidRegisterSpeechProvider=D.None,this.onDidUnregisterSpeechProvider=D.None,this.hasSpeechProvider=!1}createTextToSpeechSession(){_()}recognizeKeyword(){_()}registerSpeechProvider(){_()}createSpeechToTextSession(){_()}}f([b],qI.prototype,"createTextToSpeechSession",null);f([b],qI.prototype,"recognizeKeyword",null);f([b],qI.prototype,"registerSpeechProvider",null);f([b],qI.prototype,"createSpeechToTextSession",null);$(LN,qI,G.Delayed);class Vw{get showInline(){return _()}get filterToTest(){return _()}get selected(){return _()}openCoverage(){_()}closeCoverage(){_()}}f([b],Vw.prototype,"showInline",null);f([b],Vw.prototype,"filterToTest",null);f([b],Vw.prototype,"selected",null);f([b],Vw.prototype,"openCoverage",null);f([b],Vw.prototype,"closeCoverage",null);$(EIe,Vw,G.Delayed);class gK{acceptRequest(){_()}acceptResponse(){_()}}f([b],gK.prototype,"acceptRequest",null);f([b],gK.prototype,"acceptResponse",null);$(eIe,gK,G.Delayed);let pK=class{constructor(){this.onDidClearHistory=D.None,this.getHistory=()=>[]}clearHistory(){_()}saveHistory(){_()}};f([b],pK.prototype,"clearHistory",null);f([b],pK.prototype,"saveHistory",null);$(rre,pK,G.Delayed);class Lke{constructor(){this.providers=[],this.registerProvider=()=>F.None}}$(tIe,Lke,G.Delayed);class kl{constructor(){this.onDidMoveSession=D.None,this.onDidMoveSessio=D.None,this.onDidStashSession=D.None,this.onWillStartSession=D.None,this.onDidEndSession=D.None,this.getSession=()=>{},this.getSession2=()=>{},this.onDidChangeSessions=D.None}get hideOnRequest(){return _()}moveSession(){_()}getCodeEditor(){_()}stashSession(){_()}createSession(){_()}releaseSession(){_()}registerSessionKeyComputer(){_()}recordings(){_()}dispose(){_()}createSession2(){_()}}f([b],kl.prototype,"hideOnRequest",null);f([b],kl.prototype,"moveSession",null);f([b],kl.prototype,"getCodeEditor",null);f([b],kl.prototype,"stashSession",null);f([b],kl.prototype,"createSession",null);f([b],kl.prototype,"releaseSession",null);f([b],kl.prototype,"registerSessionKeyComputer",null);f([b],kl.prototype,"recordings",null);f([b],kl.prototype,"dispose",null);f([b],kl.prototype,"createSession2",null);$(Ez,kl,G.Delayed);class Xae{constructor(){this.canComputeDiff=()=>!1,this.canPromptRecommendation=async()=>!1}computeDiff(){_()}}f([b],Xae.prototype,"computeDiff",null);$(pIe,Xae,G.Delayed);class fK{getKernels(){_()}addMostRecentKernel(){_()}}f([b],fK.prototype,"getKernels",null);f([b],fK.prototype,"addMostRecentKernel",null);$(hIe,fK,G.Delayed);class zI{executeNotebookCells(){_()}cancelNotebookCells(){_()}cancelNotebookCellHandles(){_()}registerExecutionParticipant(){_()}}f([b],zI.prototype,"executeNotebookCells",null);f([b],zI.prototype,"cancelNotebookCells",null);f([b],zI.prototype,"cancelNotebookCellHandles",null);f([b],zI.prototype,"registerExecutionParticipant",null);$(lIe,zI,G.Delayed);class Mke{}$(uIe,Mke,G.Delayed);class KI{info(){_()}debug(){_()}warn(){_()}error(){_()}}f([b],KI.prototype,"info",null);f([b],KI.prototype,"debug",null);f([b],KI.prototype,"warn",null);f([b],KI.prototype,"error",null);$(fre,KI,G.Delayed);class Cf{constructor(){this.onDidAddWalkthrough=D.None,this.onDidRemoveWalkthrough=D.None,this.onDidChangeWalkthrough=D.None,this.onDidProgressStep=D.None}getWalkthroughs(){_()}getWalkthrough(){_()}registerWalkthrough(){_()}progressByEvent(){_()}progressStep(){_()}deprogressStep(){_()}markWalkthroughOpened(){_()}}f([b],Cf.prototype,"getWalkthroughs",null);f([b],Cf.prototype,"getWalkthrough",null);f([b],Cf.prototype,"registerWalkthrough",null);f([b],Cf.prototype,"progressByEvent",null);f([b],Cf.prototype,"progressStep",null);f([b],Cf.prototype,"deprogressStep",null);f([b],Cf.prototype,"markWalkthroughOpened",null);$(RIe,Cf,G.Delayed);class mK{constructor(){this.onDidChangeUserDataSyncStore=D.None,this.userDataSyncStore=void 0}switch(){_()}getPreviousUserDataSyncStore(){_()}}f([b],mK.prototype,"switch",null);f([b],mK.prototype,"getPreviousUserDataSyncStore",null);$(XEe,mK,G.Delayed);class Sc{constructor(){this.onDidChangeDonotMakeRequestsUntil=D.None,this.donotMakeRequestsUntil=void 0,this.onTokenFailed=D.None,this.onTokenSucceed=D.None}setAuthToken(){_()}manifest(){_()}readResource(){_()}writeResource(){_()}deleteResource(){_()}getAllResourceRefs(){_()}resolveResourceContent(){_()}getAllCollections(){_()}createCollection(){_()}deleteCollection(){_()}getActivityData(){_()}clear(){_()}}f([b],Sc.prototype,"setAuthToken",null);f([b],Sc.prototype,"manifest",null);f([b],Sc.prototype,"readResource",null);f([b],Sc.prototype,"writeResource",null);f([b],Sc.prototype,"deleteResource",null);f([b],Sc.prototype,"getAllResourceRefs",null);f([b],Sc.prototype,"resolveResourceContent",null);f([b],Sc.prototype,"getAllCollections",null);f([b],Sc.prototype,"createCollection",null);f([b],Sc.prototype,"deleteCollection",null);f([b],Sc.prototype,"getActivityData",null);f([b],Sc.prototype,"clear",null);$(ZEe,Sc,G.Delayed);class Qh{constructor(){this.onDidChangeLogLevel=D.None}getLevel(){_()}setLevel(){_()}trace(){_()}debug(){_()}info(){_()}warn(){_()}error(){_()}flush(){_()}dispose(){_()}}f([b],Qh.prototype,"getLevel",null);f([b],Qh.prototype,"setLevel",null);f([b],Qh.prototype,"trace",null);f([b],Qh.prototype,"debug",null);f([b],Qh.prototype,"info",null);f([b],Qh.prototype,"warn",null);f([b],Qh.prototype,"error",null);f([b],Qh.prototype,"flush",null);f([b],Qh.prototype,"dispose",null);$(oxe,Qh,G.Delayed);class Ma{constructor(){this.status=BE.Uninitialized,this.onDidChangeStatus=D.None,this.conflicts=[],this.onDidChangeConflicts=D.None,this.onDidChangeLocal=D.None,this.onSyncErrors=D.None,this.onDidChangeLastSyncTime=D.None,this.onDidResetRemote=D.None,this.onDidResetLocal=D.None}createSyncTask(){_()}createManualSyncTask(){_()}resolveContent(){_()}accept(){_()}reset(){_()}resetRemote(){_()}cleanUpRemoteData(){_()}resetLocal(){_()}hasLocalData(){_()}hasPreviouslySynced(){_()}replace(){_()}saveRemoteActivityData(){_()}extractActivityData(){_()}}f([b],Ma.prototype,"createSyncTask",null);f([b],Ma.prototype,"createManualSyncTask",null);f([b],Ma.prototype,"resolveContent",null);f([b],Ma.prototype,"accept",null);f([b],Ma.prototype,"reset",null);f([b],Ma.prototype,"resetRemote",null);f([b],Ma.prototype,"cleanUpRemoteData",null);f([b],Ma.prototype,"resetLocal",null);f([b],Ma.prototype,"hasLocalData",null);f([b],Ma.prototype,"hasPreviouslySynced",null);f([b],Ma.prototype,"replace",null);f([b],Ma.prototype,"saveRemoteActivityData",null);f([b],Ma.prototype,"extractActivityData",null);$(txe,Ma,G.Delayed);class Hw{constructor(){this.onDidChange=D.None}getMachines(){_()}addCurrentMachine(){_()}removeCurrentMachine(){_()}renameMachine(){_()}setEnablements(){_()}}f([b],Hw.prototype,"getMachines",null);f([b],Hw.prototype,"addCurrentMachine",null);f([b],Hw.prototype,"removeCurrentMachine",null);f([b],Hw.prototype,"renameMachine",null);f([b],Hw.prototype,"setEnablements",null);$(axe,Hw,G.Delayed);class Xh{getRemoteSyncedProfiles(){_()}getLocalSyncedProfiles(){_()}getRemoteSyncResourceHandles(){_()}getLocalSyncResourceHandles(){_()}getAssociatedResources(){_()}getMachineId(){_()}getLocalSyncedMachines(){_()}resolveContent(){_()}resolveUserDataSyncResource(){_()}}f([b],Xh.prototype,"getRemoteSyncedProfiles",null);f([b],Xh.prototype,"getLocalSyncedProfiles",null);f([b],Xh.prototype,"getRemoteSyncResourceHandles",null);f([b],Xh.prototype,"getLocalSyncResourceHandles",null);f([b],Xh.prototype,"getAssociatedResources",null);f([b],Xh.prototype,"getMachineId",null);f([b],Xh.prototype,"getLocalSyncedMachines",null);f([b],Xh.prototype,"resolveContent",null);f([b],Xh.prototype,"resolveUserDataSyncResource",null);$(ixe,Xh,G.Delayed);class gO{writeResource(){_()}getAllResourceRefs(){_()}resolveResourceContent(){_()}}f([b],gO.prototype,"writeResource",null);f([b],gO.prototype,"getAllResourceRefs",null);f([b],gO.prototype,"resolveResourceContent",null);$(JEe,gO,G.Delayed);class pO{constructor(){this.resolveDefaultCoreIgnoredSettings=async()=>[]}resolveUserBindings(){_()}resolveFormattingOptions(){_()}resolveDefaultIgnoredSettings(){_()}}f([b],pO.prototype,"resolveUserBindings",null);f([b],pO.prototype,"resolveFormattingOptions",null);f([b],pO.prototype,"resolveDefaultIgnoredSettings",null);$(sxe,pO,G.Delayed);class Dg{getDefaultProfileToUse(){_()}createProfile(){_()}createAndEnterProfile(){_()}createAndEnterTransientProfile(){_()}removeProfile(){_()}updateProfile(){_()}switchProfile(){_()}getBuiltinProfileTemplates(){_()}}f([b],Dg.prototype,"getDefaultProfileToUse",null);f([b],Dg.prototype,"createProfile",null);f([b],Dg.prototype,"createAndEnterProfile",null);f([b],Dg.prototype,"createAndEnterTransientProfile",null);f([b],Dg.prototype,"removeProfile",null);f([b],Dg.prototype,"updateProfile",null);f([b],Dg.prototype,"switchProfile",null);f([b],Dg.prototype,"getBuiltinProfileTemplates",null);$(iCe,Dg,G.Delayed);class Uw{constructor(){this.onDidAddEntry=D.None,this.onDidChangeEntry=D.None,this.onDidReplaceEntry=D.None,this.onDidRemoveEntry=D.None,this.onDidMoveEntries=D.None,this.onDidRemoveEntries=D.None,this.getEntries=async()=>[],this.getAll=async()=>[]}addEntry(){_()}updateEntry(){_()}removeEntry(){_()}moveEntries(){_()}removeAll(){_()}}f([b],Uw.prototype,"addEntry",null);f([b],Uw.prototype,"updateEntry",null);f([b],Uw.prototype,"removeEntry",null);f([b],Uw.prototype,"moveEntries",null);f([b],Uw.prototype,"removeAll",null);$(dDe,Uw,G.Delayed);class vK{constructor(){this.getNotebook=()=>{}}addNotebookDocument(){_()}removeNotebookDocument(){_()}}f([b],vK.prototype,"addNotebookDocument",null);f([b],vK.prototype,"removeNotebookDocument",null);$(Vre,vK,G.Delayed);class e_{registerTree(){_()}getVisualizedNodeFor(){_()}getVisualizedChildren(){_()}editTreeItem(){_()}getApplicableFor(){_()}register(){_()}}f([b],e_.prototype,"registerTree",null);f([b],e_.prototype,"getVisualizedNodeFor",null);f([b],e_.prototype,"getVisualizedChildren",null);f([b],e_.prototype,"editTreeItem",null);f([b],e_.prototype,"getApplicableFor",null);f([b],e_.prototype,"register",null);$(cre,e_,G.Delayed);class Zh{constructor(){this.onDidChangeLogLevel=D.None}getLevel(){_()}setLevel(){_()}trace(){_()}debug(){_()}info(){_()}warn(){_()}error(){_()}flush(){_()}dispose(){_()}}f([b],Zh.prototype,"getLevel",null);f([b],Zh.prototype,"setLevel",null);f([b],Zh.prototype,"trace",null);f([b],Zh.prototype,"debug",null);f([b],Zh.prototype,"info",null);f([b],Zh.prototype,"warn",null);f([b],Zh.prototype,"error",null);f([b],Zh.prototype,"flush",null);f([b],Zh.prototype,"dispose",null);$(nIe,Zh,G.Delayed);class t_{constructor(){this.SIZE_LIMIT=0,this.isSignedIn=!1,this.onDidSignIn=D.None,this.onDidSignOut=D.None,this.storeClient=void 0,this.lastReadResources=new Map,this.lastWrittenResources=new Map}initialize(){_()}read(){_()}write(){_()}delete(){_()}list(){_()}getMachineById(){_()}}f([b],t_.prototype,"initialize",null);f([b],t_.prototype,"read",null);f([b],t_.prototype,"write",null);f([b],t_.prototype,"delete",null);f([b],t_.prototype,"list",null);f([b],t_.prototype,"getMachineById",null);$(iIe,t_,G.Delayed);class Nke{constructor(){this.registerResolver=()=>F.None,this.resolve=async()=>{}}}$(hre,Nke,G.Delayed);$(wIe,yIe,G.Delayed);class jI{constructor(){this.getAllAccessDataForExtension=()=>new Map,this.onDidChangeEnablement=D.None,this.isEnabled=()=>!0,this.onDidChangeAccessData=D.None,this.getAccessData=()=>{}}setEnablement(){_()}getEnablementData(){_()}getAccess(){_()}setStatus(){_()}}f([b],jI.prototype,"setEnablement",null);f([b],jI.prototype,"getEnablementData",null);f([b],jI.prototype,"getAccess",null);f([b],jI.prototype,"setStatus",null);$(Fre,jI,G.Delayed);class Oke{constructor(){this.onWillInstantiateEditorPane=D.None,this.didInstantiateEditorPane=()=>!1}}$(Ame,Oke,G.Delayed);class _K{matches(){_()}getWorkspaceStateFolders(){_()}}f([b],_K.prototype,"matches",null);f([b],_K.prototype,"getWorkspaceStateFolders",null);$(lDe,_K,G.Delayed);class fO{constructor(){this.onDidChangeDefaultLogLevels=D.None,this.getDefaultLogLevel=async()=>Eb.Off}getDefaultLogLevels(){_()}setDefaultLogLevel(){_()}migrateLogLevels(){_()}}f([b],fO.prototype,"getDefaultLogLevels",null);f([b],fO.prototype,"setDefaultLogLevel",null);f([b],fO.prototype,"migrateLogLevels",null);$(aIe,fO,G.Delayed);let Fke=class{constructor(){this.onDidChange=D.None,this.getName=()=>{}}};$(wg,Fke,G.Delayed);class mO{constructor(){this.isActive=()=>!1}start(){_()}resume(){_()}stop(){_()}}f([b],mO.prototype,"start",null);f([b],mO.prototype,"resume",null);f([b],mO.prototype,"stop",null);$(sIe,mO,G.Delayed);class Wke{async isPure(){return{isPure:!1,proof:[]}}}$(WIe,Wke,G.Delayed);class Bke{constructor(){this.onDidChangeTrustedDomains=D.None}isValid(){return!1}}$(mq,Bke,G.Delayed);class Jh{constructor(){this.getTool=()=>{},this.getToolByName=()=>{},this.onDidChangeTools=D.None,this.getTools=()=>[],this.getToolSetByName=()=>{}}registerToolData(){_()}registerToolImplementation(){_()}invokeTool(){_()}cancelToolCallsForRequest(){_()}setToolAutoConfirmation(){_()}resetToolAutoConfirmation(){_()}toEnablementMap(){_()}createToolSet(){_()}get toolSets(){return _()}}f([b],Jh.prototype,"registerToolData",null);f([b],Jh.prototype,"registerToolImplementation",null);f([b],Jh.prototype,"invokeTool",null);f([b],Jh.prototype,"cancelToolCallsForRequest",null);f([b],Jh.prototype,"setToolAutoConfirmation",null);f([b],Jh.prototype,"resetToolAutoConfirmation",null);f([b],Jh.prototype,"toEnablementMap",null);f([b],Jh.prototype,"createToolSet",null);f([b],Jh.prototype,"toolSets",null);$(CI,Jh,G.Delayed);class i_{openReporter(){_()}reloadWithExtensionsDisabled(){_()}showConfirmCloseDialog(){_()}showClipboardDialog(){_()}sendReporterMenu(){_()}closeReporter(){_()}}f([b],i_.prototype,"openReporter",null);f([b],i_.prototype,"reloadWithExtensionsDisabled",null);f([b],i_.prototype,"showConfirmCloseDialog",null);f([b],i_.prototype,"showClipboardDialog",null);f([b],i_.prototype,"sendReporterMenu",null);f([b],i_.prototype,"closeReporter",null);$(oIe,i_,G.Delayed);class Zae{constructor(){this.providers=[],this.mapCodeFromResponse=async()=>{},this.mapCode=async()=>{}}registerCodeMapperProvider(){_()}}f([b],Zae.prototype,"registerCodeMapperProvider",null);$(sre,Zae,G.Delayed);class Dd{constructor(){this.getOrRestoreEditingSession=async()=>null,this.hasRelatedFilesProviders=()=>!1,this.getRelatedFiles=async()=>{},this.onDidChangeEditingSession=D.None,this.currentAutoApplyOperation=null,this.editingSessionFileLimit=0,this.getEditingSession=()=>{},this.onDidCreateEditingSession=D.None,this.currentEditingSession=null}get editingSessionsObs(){return _()}get createAdhocEditingSession(){return _()}registerRelatedFilesProvider(){return _()}get currentEditingSessionObs(){return _()}triggerEditComputation(){_()}createSnapshot(){_()}getSnapshotUri(){_()}restoreSnapshot(){_()}startOrContinueEditingSession(){_()}startOrContinueGlobalEditingSession(){_()}createEditingSession(){_()}}f([b],Dd.prototype,"editingSessionsObs",null);f([b],Dd.prototype,"createAdhocEditingSession",null);f([b],Dd.prototype,"registerRelatedFilesProvider",null);f([b],Dd.prototype,"currentEditingSessionObs",null);f([b],Dd.prototype,"triggerEditComputation",null);f([b],Dd.prototype,"createSnapshot",null);f([b],Dd.prototype,"getSnapshotUri",null);f([b],Dd.prototype,"restoreSnapshot",null);f([b],Dd.prototype,"startOrContinueEditingSession",null);f([b],Dd.prototype,"startOrContinueGlobalEditingSession",null);f([b],Dd.prototype,"createEditingSession",null);$(bg,Dd,G.Delayed);class Jae{constructor(){this.onDidChange=D.None,this.lookUp=()=>{}}register(){_()}}f([b],Jae.prototype,"register",null);$(xse,Jae,G.Delayed);class ece{constructor(){this.fileIsIgnored=async()=>!1}registerIgnoredFileProvider(){_()}}f([b],ece.prototype,"registerIgnoredFileProvider",null);$(wz,ece,G.Delayed);class Vke{constructor(){this.onDidChangeAllowedExtensionsConfigValue=D.None,this.onDidChangeAllowedExtensions=D.None,this.isAllowed=()=>!0}}$(WEe,Vke,G.Delayed);class vO{checkAndSetTransferredWorkspaceTrust(){_()}addWorkspaceToTransferred(){_()}checkAndSetWorkspaceTrust(){_()}}f([b],vO.prototype,"checkAndSetTransferredWorkspaceTrust",null);f([b],vO.prototype,"addWorkspaceToTransferred",null);f([b],vO.prototype,"checkAndSetWorkspaceTrust",null);$(eke,vO,G.Delayed);class _O{constructor(){this.onDidChange=D.None}setOrUpdateEntry(){_()}deleteEntry(){_()}getEntries(){_()}}f([b],_O.prototype,"setOrUpdateEntry",null);f([b],_O.prototype,"deleteEntry",null);f([b],_O.prototype,"getEntries",null);$(Sae,_O,G.Delayed);class tce{getOrCreate(){_()}}f([b],tce.prototype,"getOrCreate",null);$(cIe,tce,G.Delayed);class ice{getOrCreate(){_()}}f([b],ice.prototype,"getOrCreate",null);$(dIe,ice,G.Delayed);class Hke{constructor(){this.createQuickDiffModelReference=()=>{},this.getDirtyDiffModel=()=>{},this.getDiffModel=()=>{}}}$(Iz,Hke,G.Delayed);class bO{get providers(){return _()}registerTerminalCompletionProvider(){_()}provideCompletions(){_()}}f([b],bO.prototype,"providers",null);f([b],bO.prototype,"registerTerminalCompletionProvider",null);f([b],bO.prototype,"provideCompletions",null);$(kre,bO,G.Delayed);class YI{constructor(){this.onDidChangeEntitlement=D.None,this.onDidChangeQuotaExceeded=D.None,this.onDidChangeQuotaRemaining=D.None,this.onDidChangeSentiment=D.None,this.resolve=async()=>{}}get entitlement(){return _()}get quotas(){return _()}get sentiment(){return _()}update(){_()}}f([b],YI.prototype,"entitlement",null);f([b],YI.prototype,"quotas",null);f([b],YI.prototype,"sentiment",null);f([b],YI.prototype,"update",null);$(VN,YI,G.Eager);class bK{constructor(){this.listPromptFiles=async()=>[],this.getSourceFolders=()=>[],this.asPromptSlashCommand=()=>{},this.resolvePromptSlashCommand=async()=>{},this.findPromptSlashCommands=async()=>[],this.findInstructionFilesFor=async()=>[],this.getAllMetadata=async()=>[],this.getCombinedToolsMetadata=async()=>null,this.onDidChangeCustomChatModes=D.None,this.getCustomChatModes=async()=>[]}getSyntaxParserFor(){_()}dispose(){}getMetadata(){_()}}f([b],bK.prototype,"getSyntaxParserFor",null);f([b],bK.prototype,"getMetadata",null);$(HN,bK,G.Eager);class Na{constructor(){this.onDidChangeInputs=D.None,this.discoverCollections=async()=>[]}get collections(){return _()}get lazyCollectionState(){return _()}collectionToolPrefix(){_()}get delegates(){return _()}registerCollection(){_()}resetTrust(){_()}getTrust(){_()}clearSavedInputs(){_()}editSavedInput(){_()}getSavedInputs(){_()}resolveConnection(){_()}registerDelegate(){return F.None}setSavedInput(){_()}getServerDefinition(){_()}}f([b],Na.prototype,"collections",null);f([b],Na.prototype,"lazyCollectionState",null);f([b],Na.prototype,"collectionToolPrefix",null);f([b],Na.prototype,"delegates",null);f([b],Na.prototype,"registerCollection",null);f([b],Na.prototype,"resetTrust",null);f([b],Na.prototype,"getTrust",null);f([b],Na.prototype,"clearSavedInputs",null);f([b],Na.prototype,"editSavedInput",null);f([b],Na.prototype,"getSavedInputs",null);f([b],Na.prototype,"resolveConnection",null);f([b],Na.prototype,"setSavedInput",null);f([b],Na.prototype,"getServerDefinition",null);$(yae,Na,G.Eager);class QI{get servers(){return _()}get lazyCollectionState(){return _()}resetCaches(){_()}activateCollections(){_()}}f([b],QI.prototype,"servers",null);f([b],QI.prototype,"lazyCollectionState",null);f([b],QI.prototype,"resetCaches",null);f([b],QI.prototype,"activateCollections",null);$(zDe,QI,G.Eager);class nce{get paths(){return _()}}f([b],nce.prototype,"paths",null);$(jDe,nce,G.Eager);class Uke{constructor(){this.onDidChangeExtensionGalleryManifest=D.None,this.isEnabled=()=>!1,this.getExtensionGalleryManifest=async()=>null}}$(wae,Uke,G.Eager);$(YDe,XDe,G.Delayed);$(jN,ZDe,G.Delayed);$(QDe,JDe,G.Delayed);class $ke{constructor(){this.onDidChange=D.None,this.getClientId=()=>{},this.storeClientId=()=>{},this.getInteractedProviders=()=>[],this.removeDynamicProvider=async()=>{},this.getSessionsForDynamicAuthProvider=async()=>{},this.setSessionsForDynamicAuthProvider=async()=>{},this.onDidChangeTokens=D.None}}$(Eae,$ke,G.Eager);class sce{constructor(){this.onDidChangeAccountPreference=D.None,this.getAccountPreference=()=>{},this.updateAccountPreference=()=>{},this.removeAccountPreference=()=>{},this.updateSessionPreference=()=>{},this.getSessionPreference=()=>{},this.removeSessionPreference=()=>{},this.requestSessionAccess=()=>{},this.requestNewSession=async()=>{}}selectSession(){_()}}f([b],sce.prototype,"selectSession",null);$(xae,sce,G.Eager);class Gke{constructor(){this.onDidChangeMcpSessionAccess=D.None,this.isAccessAllowed=()=>{},this.readAllowedMcpServers=()=>[],this.updateAllowedMcpServers=()=>{},this.removeAllowedMcpServers=()=>{}}}$(Iae,Gke,G.Eager);class qke{constructor(){this.initializeUsageCache=async()=>{},this.hasUsedAuth=async()=>!1,this.readAccountUsages=()=>[],this.removeAccountUsage=()=>{},this.addAccountUsage=()=>{}}}$(Dae,qke,G.Eager);class zke{constructor(){this.onChange=D.None,this.local=[],this.queryLocal=async()=>[],this.queryGallery=async()=>[],this.install=async()=>{},this.uninstall=async()=>{},this.update=async()=>{},this.open=async()=>{}}}$(bae,zke,G.Eager);class yK{constructor(){this.isEnabled=()=>!1,this.query=async()=>[]}getManifest(){_()}getReadme(){_()}}f([b],yK.prototype,"getManifest",null);f([b],yK.prototype,"getReadme",null);$(ske,yK,G.Eager);class Kke{constructor(){this.onInstallMcpServer=D.None,this.onDidInstallMcpServers=D.None,this.onUninstallMcpServer=D.None,this.onDidUninstallMcpServer=D.None,this.getInstalled=async()=>[],this.installFromGallery=async()=>{},this.uninstall=async()=>{}}}$(oke,Kke,G.Eager);class XI{constructor(){this.hasLogs=()=>!1}sample(){_()}getLogText(){_()}getConfig(){_()}updateConfig(){_()}}f([b],XI.prototype,"sample",null);f([b],XI.prototype,"getLogText",null);f([b],XI.prototype,"getConfig",null);f([b],XI.prototype,"updateConfig",null);$(KDe,XI,G.Eager);class jke{constructor(){this.items=[],this.registerChatContextItem=()=>F.None}}$(nke,jke,G.Eager);class Yke{constructor(){this.getElementData=async()=>{},this.startDebugSession=async()=>{}}}$(tke,Yke,G.Eager);class Qke{constructor(){this.getCurrentExperiment=()=>{}}}$(ike,Qke,G.Eager);class wK{get onChange(){return _()}findMetadata(){_()}}f([b],wK.prototype,"onChange",null);f([b],wK.prototype,"findMetadata",null);$(Rme,wK,G.Eager);class oce{constructor(){this.supportsLanguage=()=>!1,this.getLanguage=()=>{},this.getInjectionQueries=()=>{},this.getHighlightingQueries=()=>{}}getParserClass(){_()}}f([b],oce.prototype,"getParserClass",null);$(Pme,oce,G.Eager);const Xke=Z("IExtHostRpcService");class S9e{constructor(e){this.getProxy=e.getProxy.bind(e),this.set=e.set.bind(e),this.dispose=e.dispose.bind(e),this.assertRegistered=e.assertRegistered.bind(e),this.drain=e.drain.bind(e)}}const __="workbench.panel.output";new O("inOutput",!1);new O("activeLogOutput",!1);new O("activeLogOutput.isLog",!1);new O("activeLogOutput.levelSettable",!1);new O("activeLogOutput.level","");new O("activeLogOutput.levelIsDefault",!1);new O("outputView.scrollLock",!1);new O("activeOutputChannel","");new O("output.filter.trace",!0);new O("output.filter.debug",!0);new O("output.filter.info",!0);new O("output.filter.warning",!0);new O("output.filter.error",!0);new O("outputFilterFocus",!1);new O("output.filter.categories","");var TB;(function(s){s[s.Append=1]="Append",s[s.Replace=2]="Replace",s[s.Clear=3]="Clear"})(TB||(TB={}));const rce={OutputChannels:"workbench.contributions.outputChannels"};function C9e(s){return!!s.source&&!Array.isArray(s.source)}function Zke(s){return Array.isArray(s.source)}class Jke extends F{constructor(){super(...arguments),this.channels=new Map,this._onDidRegisterChannel=this._register(new M),this.onDidRegisterChannel=this._onDidRegisterChannel.event,this._onDidRemoveChannel=this._register(new M),this.onDidRemoveChannel=this._onDidRemoveChannel.event,this._onDidUpdateChannelFiles=this._register(new M),this.onDidUpdateChannelSources=this._onDidUpdateChannelFiles.event}registerChannel(e){this.channels.has(e.id)||(this.channels.set(e.id,e),this._onDidRegisterChannel.fire(e.id))}getChannels(){const e=[];return this.channels.forEach(t=>e.push(t)),e}getChannel(e){return this.channels.get(e)}updateChannelSources(e,t){const i=this.channels.get(e);i&&Zke(i)&&(i.source=t,this._onDidUpdateChannelFiles.fire(i))}removeChannel(e){const t=this.channels.get(e);t&&(this.channels.delete(e),this._onDidRemoveChannel.fire(t))}}Ge.add(rce.OutputChannels,new Jke);const eTe=Z("IExtHostInitDataService");function ZI(s,e){return{id:e,asString:async()=>s,asFile:()=>{},value:typeof s=="string"?s:void 0}}function tTe(s,e,t,i){const n={id:Dn(),name:s,uri:e,data:t};return{id:i,asString:async()=>"",asFile:()=>n,value:void 0}}class yO{constructor(){this._entries=new Map}get size(){let e=0;for(const t of this._entries)e++;return e}has(e){return this._entries.has(this.toKey(e))}matches(e){const t=[...this._entries.keys()];return dn.some(this,([i,n])=>n.asFile())&&t.push("files"),ace(FA(e),t)}get(e){return this._entries.get(this.toKey(e))?.[0]}append(e,t){const i=this._entries.get(e);i?i.push(t):this._entries.set(this.toKey(e),[t])}replace(e,t){this._entries.set(this.toKey(e),[t])}delete(e){this._entries.delete(this.toKey(e))}*[Symbol.iterator](){for(const[e,t]of this._entries)for(const i of t)yield[e,i]}toKey(e){return FA(e)}}function FA(s){return s.toLowerCase()}function xj(s,e){return ace(FA(s),e.map(FA))}function ace(s,e){if(s==="*/*")return e.length>0;if(e.includes(s))return!0;const t=s.match(/^([a-z]+)\/([a-z]+|\*)$/i);if(!t)return!1;const[i,n,o]=t;return o==="*"?e.some(r=>r.startsWith(n+"/")):!1}const ml=Object.freeze({create:s=>tI(s.map(e=>e.toString())).join(`\r
`),split:s=>s.split(`\r
`),parse:s=>ml.split(s).filter(e=>!e.startsWith("#"))}),ir=Symbol("unset");class WA{constructor(){this.root=new _0,this._size=0}get size(){return this._size}get nodes(){return this.root.children?.values()||dn.empty()}get entries(){return this.root.children?.entries()||dn.empty()}insert(e,t,i){this.opNode(e,n=>n._value=t,i)}mutate(e,t){this.opNode(e,i=>i._value=t(i._value===ir?void 0:i._value))}mutatePath(e,t){this.opNode(e,()=>{},i=>t(i))}delete(e){const t=this.getPathToKey(e);if(!t)return;let i=t.length-1;const n=t[i].node._value;if(n!==ir){for(this._size--,t[i].node._value=ir;i>0;i--){const{node:o,part:r}=t[i];if(o.children?.size||o._value!==ir)break;t[i-1].node.children.delete(r)}return n}}*deleteRecursive(e){const t=this.getPathToKey(e);if(!t)return;const i=t[t.length-1].node;for(let n=t.length-1;n>0;n--){const o=t[n-1];if(o.node.children.delete(t[n].part),o.node.children.size>0||o.node._value!==ir)break}for(const n of Ij(i))n._value!==ir&&(this._size--,yield n._value);i===this.root&&(this.root._value=ir,this.root.children=void 0)}find(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return;t=n}return t._value===ir?void 0:t._value}hasKeyOrParent(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return!1;if(n._value!==ir)return!0;t=n}return!1}hasKeyOrChildren(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return!1;t=n}return!0}hasKey(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return!1;t=n}return t._value!==ir}getPathToKey(e){const t=[{part:"",node:this.root}];let i=0;for(const n of e){const o=t[i].node.children?.get(n);if(!o)return;t.push({part:n,node:o}),i++}return t}opNode(e,t,i){let n=this.root;for(const a of e){if(n.children)if(n.children.has(a))n=n.children.get(a);else{const c=new _0;n.children.set(a,c),n=c}else{const c=new _0;n.children=new Map([[a,c]]),n=c}i?.(n)}const o=n._value===ir?0:1;t(n);const r=n._value===ir?0:1;this._size+=r-o}*values(){for(const{_value:e}of Ij(this.root))e!==ir&&(yield e)}}function*Ij(s){const e=[s];for(;e.length>0;){const t=e.pop();if(yield t,t.children)for(const i of t.children.values())e.push(i)}}let _0=class{constructor(){this._value=ir}get value(){return this._value===ir?void 0:this._value}set value(e){this._value=e===void 0?ir:e}};var Sy;(function(s){s.UseFileStorage="chat.useFileStorage",s.AgentEnabled="chat.agent.enabled",s.Edits2Enabled="chat.edits2.enabled",s.ExtensionToolsEnabled="chat.extensionTools.enabled"})(Sy||(Sy={}));var jt;(function(s){s.Ask="ask",s.Edit="edit",s.Agent="agent"})(jt||(jt={}));function SK(s){switch(s){case jt.Agent:return"Agent";case jt.Edit:return"Edit";case jt.Ask:default:return"Ask"}}function cce(s){switch(s){case jt.Ask:case jt.Edit:case jt.Agent:return s;default:return}}function iTe(s){return!!cce(s)}var Vi;(function(s){s.Panel="panel",s.Terminal="terminal",s.Notebook="notebook",s.Editor="editor"})(Vi||(Vi={}));(function(s){function e(t){switch(t){case"panel":return s.Panel;case"terminal":return s.Terminal;case"notebook":return s.Notebook;case"editor":return s.Editor}return s.Panel}s.fromRaw=e})(Vi||(Vi={}));var ve;(function(s){s.responseVote=new O("chatSessionResponseVote","",{type:"string",description:h(5108,"When the response has been voted up, is set to 'up'. When voted down, is set to 'down'. Otherwise an empty string.")}),s.responseDetectedAgentCommand=new O("chatSessionResponseDetectedAgentOrCommand",!1,{type:"boolean",description:h(5109,"When the agent or command was automatically detected")}),s.responseSupportsIssueReporting=new O("chatResponseSupportsIssueReporting",!1,{type:"boolean",description:h(5110,"True when the current chat response supports issue reporting.")}),s.responseIsFiltered=new O("chatSessionResponseFiltered",!1,{type:"boolean",description:h(5111,"True when the chat response was filtered out by the server.")}),s.responseHasError=new O("chatSessionResponseError",!1,{type:"boolean",description:h(5112,"True when the chat response resulted in an error.")}),s.requestInProgress=new O("chatSessionRequestInProgress",!1,{type:"boolean",description:h(5113,"True when the current request is still in progress.")}),s.isRequestPaused=new O("chatRequestIsPaused",!1,{type:"boolean",description:h(5114,"True when the current request is paused.")}),s.canRequestBePaused=new O("chatCanRequestBePaused",!1,{type:"boolean",description:h(5115,"True when the current request can be paused.")}),s.isResponse=new O("chatResponse",!1,{type:"boolean",description:h(5116,"The chat item is a response.")}),s.isRequest=new O("chatRequest",!1,{type:"boolean",description:h(5117,"The chat item is a request")}),s.itemId=new O("chatItemId","",{type:"string",description:h(5118,"The id of the chat item.")}),s.lastItemId=new O("chatLastItemId",[],{type:"string",description:h(5119,"The id of the last chat item.")}),s.editApplied=new O("chatEditApplied",!1,{type:"boolean",description:h(5120,"True when the chat text edits have been applied.")}),s.inputHasText=new O("chatInputHasText",!1,{type:"boolean",description:h(5121,"True when the chat input has text.")}),s.inputHasFocus=new O("chatInputHasFocus",!1,{type:"boolean",description:h(5122,"True when the chat input has focus.")}),s.inChatInput=new O("inChatInput",!1,{type:"boolean",description:h(5123,"True when focus is in the chat input, false otherwise.")}),s.inChatSession=new O("inChat",!1,{type:"boolean",description:h(5124,"True when focus is in the chat widget, false otherwise.")}),s.hasPromptFile=new O("chatPromptFileAttached",!1,{type:"boolean",description:h(5125,"True when the chat has a prompt file attached.")}),s.chatMode=new O("chatMode",jt.Ask,{type:"string",description:h(5126,"The current chat mode.")}),s.supported=x.or(Ru.negate(),nCe.notEqualsTo(""),x.has("config.chat.experimental.serverlessWebEnabled")),s.enabled=new O("chatIsEnabled",!1,{type:"boolean",description:h(5127,"True when chat is enabled because a default chat participant is activated with an implementation.")}),s.extensionParticipantRegistered=new O("chatPanelExtensionParticipantRegistered",!1,{type:"boolean",description:h(5128,"True when a default chat participant is registered for the panel from an extension.")}),s.panelParticipantRegistered=new O("chatPanelParticipantRegistered",!1,{type:"boolean",description:h(5129,"True when a default chat participant is registered for the panel.")}),s.editingParticipantRegistered=new O("chatEditingParticipantRegistered",!1,{type:"boolean",description:h(5130,"True when a default chat participant is registered for editing.")}),s.chatEditingCanUndo=new O("chatEditingCanUndo",!1,{type:"boolean",description:h(5131,"True when it is possible to undo an interaction in the editing panel.")}),s.chatEditingCanRedo=new O("chatEditingCanRedo",!1,{type:"boolean",description:h(5132,"True when it is possible to redo an interaction in the editing panel.")}),s.extensionInvalid=new O("chatExtensionInvalid",!1,{type:"boolean",description:h(5133,"True when the installed chat extension is invalid and needs to be updated.")}),s.inputCursorAtTop=new O("chatCursorAtTop",!1),s.inputHasAgent=new O("chatInputHasAgent",!1),s.location=new O("chatLocation",void 0),s.inQuickChat=new O("quickChatHasFocus",!1,{type:"boolean",description:h(5134,"True when the quick chat UI has focus, false otherwise.")}),s.hasFileAttachments=new O("chatHasFileAttachments",!1,{type:"boolean",description:h(5135,"True when the chat has file attachments.")}),s.languageModelsAreUserSelectable=new O("chatModelsAreUserSelectable",!1,{type:"boolean",description:h(5136,"True when the chat model can be selected manually by the user.")}),s.Setup={hidden:new O("chatSetupHidden",!1,!0),installed:new O("chatSetupInstalled",!1,!0),disabled:new O("chatSetupDisabled",!1,!0),later:new O("chatSetupLater",!1,!0)},s.Entitlement={signedOut:new O("chatEntitlementSignedOut",!1,!0),canSignUp:new O("chatPlanCanSignUp",!1,!0),free:new O("chatPlanFree",!1,!0),pro:new O("chatPlanPro",!1,!0),proPlus:new O("chatPlanProPlus",!1,!0),business:new O("chatPlanBusiness",!1,!0),enterprise:new O("chatPlanEnterprise",!1,!0)},s.chatQuotaExceeded=new O("chatQuotaExceeded",!1,!0),s.completionsQuotaExceeded=new O("completionsQuotaExceeded",!1,!0),s.Editing={agentModeDisallowed:new O("chatAgentModeDisallowed",void 0,{type:"boolean",description:h(5137,"True when agent mode is not allowed.")}),hasToolConfirmation:new O("chatHasToolConfirmation",!1,{type:"boolean",description:h(5138,"True when a tool confirmation is present.")})},s.Tools={toolsCount:new O("toolsCount",0,{type:"number",description:h(5139,"The count of tools available in the chat.")})},s.Modes={hasCustomChatModes:new O("chatHasCustomChatModes",!1,{type:"boolean",description:h(5140,"True when the chat has custom chat modes available.")})},s.panelLocation=new O("chatPanelLocation",void 0,{type:"number",description:h(5141,"The location of the chat panel.")})})(ve||(ve={}));var Dj;(function(s){s.inEditingMode=x.or(ve.chatMode.isEqualTo(jt.Edit),ve.chatMode.isEqualTo(jt.Agent))})(Dj||(Dj={}));var VS;let kj=class extends F{static{this.AGENT_LEADER="@"}constructor(e){super(),this.contextKeyService=e,this._agents=new Map,this._onDidChangeAgents=new M,this.onDidChangeAgents=this._onDidChangeAgents.event,this._agentsContextKeys=new Set,this._hasToolsAgent=!1,this._chatParticipantDetectionProviders=new Map,this._agentCompletionProviders=new Map,this._hasDefaultAgent=ve.enabled.bindTo(this.contextKeyService),this._extensionAgentRegistered=ve.extensionParticipantRegistered.bindTo(this.contextKeyService),this._defaultAgentRegistered=ve.panelParticipantRegistered.bindTo(this.contextKeyService),this._editingAgentRegistered=ve.editingParticipantRegistered.bindTo(this.contextKeyService),this._register(e.onDidChangeContext(t=>{t.affectsSome(this._agentsContextKeys)&&this._updateContextKeys()}))}registerAgent(e,t){if(this.getAgent(e))throw new Error(`Agent already registered: ${JSON.stringify(e)}`);const n=this,o=t.slashCommands;t={...t,get slashCommands(){return o.filter(a=>!a.when||n.contextKeyService.contextMatchesRules(x.deserialize(a.when)))}};const r={data:t};return this._agents.set(e,r),this._updateAgentsContextKeys(),this._updateContextKeys(),this._onDidChangeAgents.fire(void 0),Ee(()=>{this._agents.delete(e),this._updateAgentsContextKeys(),this._updateContextKeys(),this._onDidChangeAgents.fire(void 0)})}_updateAgentsContextKeys(){this._agentsContextKeys.clear();for(const e of this._agents.values())if(e.data.when){const t=x.deserialize(e.data.when);for(const i of t?.keys()||[])this._agentsContextKeys.add(i)}}_updateContextKeys(){let e=!1,t=!1,i=!1,n=!1;for(const o of this.getAgents())o.isDefault&&(o.isCore||(t=!0),o.modes.includes(jt.Agent)?n=!0:o.modes.includes(jt.Edit)?e=!0:i=!0);this._editingAgentRegistered.set(e),this._defaultAgentRegistered.set(i),this._extensionAgentRegistered.set(t),n!==this._hasToolsAgent&&(this._hasToolsAgent=n,this._onDidChangeAgents.fire(this.getDefaultAgent(Vi.Panel,jt.Agent)))}registerAgentImplementation(e,t){const i=this._agents.get(e);if(!i)throw new Error(`Unknown agent: ${JSON.stringify(e)}`);if(i.impl)throw new Error(`Agent already has implementation: ${JSON.stringify(e)}`);return i.data.isDefault&&this._hasDefaultAgent.set(!0),i.impl=t,this._onDidChangeAgents.fire(new zD(i.data,t)),Ee(()=>{i.impl=void 0,this._onDidChangeAgents.fire(void 0),i.data.isDefault&&this._hasDefaultAgent.set(dn.some(this._agents.values(),n=>n.data.isDefault))})}registerDynamicAgent(e,t){e.isDynamic=!0;const i={data:e,impl:t};return this._agents.set(e.id,i),this._onDidChangeAgents.fire(new zD(e,t)),Ee(()=>{this._agents.delete(e.id),this._onDidChangeAgents.fire(void 0)})}registerAgentCompletionProvider(e,t){return this._agentCompletionProviders.set(e,t),{dispose:()=>{this._agentCompletionProviders.delete(e)}}}async getAgentCompletionItems(e,t,i){return await this._agentCompletionProviders.get(e)?.(t,i)??[]}updateAgent(e,t){const i=this._agents.get(e);if(!i?.impl)throw new Error(`No activated agent with id ${JSON.stringify(e)} registered`);i.data.metadata={...i.data.metadata,...t},this._onDidChangeAgents.fire(new zD(i.data,i.impl))}getDefaultAgent(e,t=jt.Ask){return this._preferExtensionAgent(this.getActivatedAgents().filter(i=>t&&!i.modes.includes(t)?!1:!!i.isDefault&&i.locations.includes(e)))}get hasToolsAgent(){return!!this._hasToolsAgent}getContributedDefaultAgent(e){return this._preferExtensionAgent(this.getAgents().filter(t=>!!t.isDefault&&t.locations.includes(e)))}_preferExtensionAgent(e){return GM(e,t=>!t.isCore)??e.at(-1)}getAgent(e,t=!1){if(!(!this._agentIsEnabled(e)&&!t))return this._agents.get(e)?.data}_agentIsEnabled(e){const t=typeof e=="string"?this._agents.get(e):e;return!t?.data.when||this.contextKeyService.contextMatchesRules(x.deserialize(t.data.when))}getAgentByFullyQualifiedId(e){const t=dn.find(this._agents.values(),i=>dce(i.data)===e)?.data;if(!(t&&!this._agentIsEnabled(t.id)))return t}getAgents(){return Array.from(this._agents.values()).map(e=>e.data).filter(e=>this._agentIsEnabled(e.id))}getActivatedAgents(){return Array.from(this._agents.values()).filter(e=>!!e.impl).filter(e=>this._agentIsEnabled(e.data.id)).map(e=>new zD(e.data,e.impl))}getAgentsByName(e){return this._preferExtensionAgents(this.getAgents().filter(t=>t.name===e))}_preferExtensionAgents(e){const t=e.filter(i=>!i.isCore);return t.length>0?t:e}agentHasDupeName(e){const t=this.getAgent(e);return t?this.getAgentsByName(t.name).filter(i=>i.extensionId.value!==t.extensionId.value).length>0:!1}async invokeAgent(e,t,i,n,o){const r=this._agents.get(e);if(!r?.impl)throw new Error(`No activated agent with id "${e}"`);return await r.impl.invoke(t,i,n,o)}setRequestPaused(e,t,i){const n=this._agents.get(e);if(!n?.impl)throw new Error(`No activated agent with id "${e}"`);n.impl.setRequestPaused?.(t,i)}async getFollowups(e,t,i,n,o){const r=this._agents.get(e);return r?.impl?.provideFollowups?r.impl.provideFollowups(t,i,n,o):[]}async getChatTitle(e,t,i){const n=this._agents.get(e);if(n?.impl?.provideChatTitle)return n.impl.provideChatTitle(t,i)}registerChatParticipantDetectionProvider(e,t){return this._chatParticipantDetectionProviders.set(e,t),Ee(()=>{this._chatParticipantDetectionProviders.delete(e)})}hasChatParticipantDetectionProviders(){return this._chatParticipantDetectionProviders.size>0}async detectAgentOrCommand(e,t,i,n){const o=dn.first(this._chatParticipantDetectionProviders.values());if(!o)return;const r=this.getAgents().reduce((l,u)=>{if(u.locations.includes(i.location)){l.push({participant:u.id,disambiguation:u.disambiguation??[]});for(const g of u.slashCommands)l.push({participant:u.id,command:g.name,disambiguation:g.disambiguation??[]})}return l},[]),a=await o.provideParticipantDetection(e,t,{...i,participants:r},n);if(!a)return;const c=this.getAgent(a.participant);if(!c)return;if(!a.command)return{agent:c};const d=c?.slashCommands.find(l=>l.name===a.command);if(d)return{agent:c,command:d}}};kj=f([p(0,me)],kj);class zD{constructor(e,t){this.data=e,this.impl=t}get id(){return this.data.id}get name(){return this.data.name??""}get fullName(){return this.data.fullName??""}get description(){return this.data.description??""}get extensionId(){return this.data.extensionId}get extensionPublisherId(){return this.data.extensionPublisherId}get extensionPublisherDisplayName(){return this.data.publisherDisplayName}get extensionDisplayName(){return this.data.extensionDisplayName}get isDefault(){return this.data.isDefault}get isCore(){return this.data.isCore}get metadata(){return this.data.metadata}get slashCommands(){return this.data.slashCommands}get locations(){return this.data.locations}get modes(){return this.data.modes}get disambiguation(){return this.data.disambiguation}async invoke(e,t,i,n){return this.impl.invoke(e,t,i,n)}setRequestPaused(e,t){this.impl.setRequestPaused&&this.impl.setRequestPaused(e,t)}async provideFollowups(e,t,i,n){return this.impl.provideFollowups?this.impl.provideFollowups(e,t,i,n):[]}toJSON(){return this.data}}let Tj=class{static{VS=this}static{this.StorageKey="chat.participantNameRegistry"}constructor(e,t,i,n){if(this.requestService=t,this.logService=i,this.storageService=n,this.registry=oi(this,Object.create(null)),this.disposed=!1,!e.chatParticipantRegistry)return;this.url=e.chatParticipantRegistry;const o=n.get(VS.StorageKey,he.APPLICATION);try{this.registry.set(JSON.parse(o??"{}"),void 0)}catch{n.remove(VS.StorageKey,he.APPLICATION)}this.refresh()}refresh(){this.disposed||this.update().catch(e=>this.logService.warn("Failed to fetch chat participant registry",e)).then(()=>Ia(5*60*1e3)).then(()=>this.refresh())}async update(){const e=await this.requestService.request({type:"GET",url:this.url},ye.None);if(e.res.statusCode!==200)throw new Error("Could not get extensions report.");const t=await bF(e);if(!t||t.version!==1)throw new Error("Unexpected chat participant registry response.");const i=t.restrictedChatParticipants;this.registry.set(i,void 0),this.storageService.store(VS.StorageKey,JSON.stringify(i),he.APPLICATION,pt.MACHINE)}getAgentNameRestriction(e){if(e.isCore)return!0;const t=this.checkAgentNameRestriction(e.name,e).get(),i=!e.fullName||this.checkAgentNameRestriction(e.fullName.replace(/\s/g,""),e).get();return t&&i}checkAgentNameRestriction(e,t){return this.registry.map(n=>n[e.toLowerCase()]).map(n=>n?n.some(o=>Xs(o,o.includes(".")?t.extensionId.value:t.extensionPublisherId)):!0)}dispose(){this.disposed=!0}};Tj=VS=f([p(0,Fn),p(1,UM),p(2,Pe),p(3,tt)],Tj);function dce(s){return`${s.extensionId.value}.${s.id}`}function lce(s){const e="name"in s?s:{...s,name:s.id};return"extensionPublisherId"in e||(e.extensionPublisherId=e.extensionPublisher??""),"extensionDisplayName"in e||(e.extensionDisplayName=""),"extensionId"in e||(e.extensionId=new Es("")),cn(e)}class xu{static{this.Kind="text"}constructor(e,t,i){this.range=e,this.editorRange=t,this.text=i,this.kind=xu.Kind}get promptText(){return this.text}}const $w="#",CK="@",av="/";class BA{static{this.Kind="var"}constructor(e,t,i,n,o){this.range=e,this.editorRange=t,this.variableName=i,this.variableArg=n,this.variableId=o,this.kind=BA.Kind}get text(){const e=this.variableArg?`:${this.variableArg}`:"";return`${$w}${this.variableName}${e}`}get promptText(){return this.text}}class Cy{static{this.Kind="tool"}constructor(e,t,i,n,o,r){this.range=e,this.editorRange=t,this.toolName=i,this.toolId=n,this.displayName=o,this.icon=r,this.kind=Cy.Kind}get text(){return`${$w}${this.toolName}`}get promptText(){return this.text}toVariableEntry(){return{kind:"tool",id:this.toolId,name:this.toolName,range:this.range,value:void 0,icon:Te.isThemeIcon(this.icon)?this.icon:void 0,fullName:this.displayName}}}class YE{static{this.Kind="toolset"}constructor(e,t,i,n,o,r){this.range=e,this.editorRange=t,this.id=i,this.name=n,this.icon=o,this.tools=r,this.kind=YE.Kind}get text(){return`${$w}${this.name}`}get promptText(){return this.text}toVariableEntry(){return{kind:"toolset",id:this.id,name:this.name,range:this.range,icon:this.icon,value:this.tools}}}class sh{static{this.Kind="agent"}constructor(e,t,i){this.range=e,this.editorRange=t,this.agent=i,this.kind=sh.Kind}get text(){return`${CK}${this.agent.name}`}get promptText(){return""}}class Ey{static{this.Kind="subcommand"}constructor(e,t,i){this.range=e,this.editorRange=t,this.command=i,this.kind=Ey.Kind}get text(){return`${av}${this.command.name}`}get promptText(){return""}}class QE{static{this.Kind="slash"}constructor(e,t,i){this.range=e,this.editorRange=t,this.slashCommand=i,this.kind=QE.Kind}get text(){return`${av}${this.slashCommand.command}`}get promptText(){return`${av}${this.slashCommand.command}`}}class XE{static{this.Kind="prompt"}constructor(e,t,i){this.range=e,this.editorRange=t,this.slashPromptCommand=i,this.kind=XE.Kind}get text(){return`${av}${this.slashPromptCommand.command}`}get promptText(){return`${av}${this.slashPromptCommand.command}`}}class ZE{static{this.Kind="dynamic"}constructor(e,t,i,n,o,r,a,c,d,l){this.range=e,this.editorRange=t,this.text=i,this.id=n,this.modelDescription=o,this.data=r,this.fullName=a,this.icon=c,this.isFile=d,this.isDirectory=l,this.kind=ZE.Kind}get referenceText(){return this.text.replace($w,"")}get promptText(){return this.text}toVariableEntry(){return this.id==="vscode.problems"?JE.toEntry(this.data.filter):{kind:this.isDirectory?"directory":this.isFile?"file":"generic",id:this.id,name:this.referenceText,range:this.range,value:this.data,fullName:this.fullName,icon:this.icon}}}function nTe(s){return{text:s.text,parts:s.parts.map(e=>{if(e.kind===xu.Kind)return new xu(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.text);if(e.kind===BA.Kind)return new BA(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.variableName,e.variableArg,e.variableId||"");if(e.kind===Cy.Kind)return new Cy(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.toolName,e.toolId,e.displayName,e.icon);if(e.kind===YE.Kind)return new YE(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.id,e.name,e.icon,e.tools??[]);if(e.kind===sh.Kind){let t=e.agent;return t=lce(t),new sh(new bi(e.range.start,e.range.endExclusive),e.editorRange,t)}else{if(e.kind===Ey.Kind)return new Ey(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.command);if(e.kind===QE.Kind)return new QE(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.slashCommand);if(e.kind===XE.Kind)return new XE(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.slashPromptCommand);if(e.kind===ZE.Kind)return new ZE(new bi(e.range.start,e.range.endExclusive),e.editorRange,e.text,e.id,e.modelDescription,cn(e.data),e.fullName,e.icon,e.isFile,e.isDirectory);throw new Error(`Unknown chat request part: ${e.kind}`)}})}}function sTe(s,e,t,i=null,n=null){let o="";if(i&&i!==s.getDefaultAgent(e)?.id){const r=s.getAgent(i);if(!r)return;o+=`${CK}${r.name} `,n&&(o+=`${av}${n} `)}return o+t}var Aj;(function(s){s[s.Info=0]="Info",s[s.Warning=1]="Warning",s[s.Error=2]="Error"})(Aj||(Aj={}));function oTe(s){return!!s&&typeof s=="object"&&"uri"in s&&s.uri instanceof R&&"version"in s&&typeof s.version=="number"&&"ranges"in s&&Array.isArray(s.ranges)&&s.ranges.every(P.isIRange)}function rTe(s){return!!s&&typeof s=="object"&&"documents"in s&&Array.isArray(s.documents)&&s.documents.every(oTe)}var xy;(function(s){s[s.Complete=1]="Complete",s[s.Partial=2]="Partial",s[s.Omitted=3]="Omitted"})(xy||(xy={}));var Rj;(function(s){s[s.Down=0]="Down",s[s.Up=1]="Up"})(Rj||(Rj={}));var Pj;(function(s){s.IncorrectCode="incorrectCode",s.DidNotFollowInstructions="didNotFollowInstructions",s.IncompleteCode="incompleteCode",s.MissingContext="missingContext",s.PoorlyWrittenOrFormatted="poorlyWrittenOrFormatted",s.RefusedAValidRequest="refusedAValidRequest",s.OffensiveOrUnsafe="offensiveOrUnsafe",s.Other="other",s.WillReportIssue="willReportIssue"})(Pj||(Pj={}));var Lj;(function(s){s[s.Action=1]="Action",s[s.Toolbar=2]="Toolbar"})(Lj||(Lj={}));var AB,Yo;(function(s){s[s.NotOmitted=0]="NotOmitted",s[s.Partial=1]="Partial",s[s.Full=2]="Full"})(Yo||(Yo={}));var JE;(function(s){s.icon=j.error;function e(o){return{filterUri:o.resource,owner:o.owner,problemMessage:o.message,filterRange:{startLineNumber:o.startLineNumber,endLineNumber:o.endLineNumber,startColumn:o.startColumn,endColumn:o.endColumn}}}s.fromMarker=e;function t(o){return{id:i(o),name:n(o),icon:s.icon,value:o,kind:"diagnostic",...o}}s.toEntry=t;function i(o){return[o.filterUri,o.owner,o.filterSeverity,o.filterRange?.startLineNumber].join(":")}s.id=i;function n(o){let r;if(function(c){c[c.MaxChars=30]="MaxChars",c[c.MaxSpaceLookback=10]="MaxSpaceLookback"}(r||(r={})),o.problemMessage){if(o.problemMessage.length<r.MaxChars)return o.problemMessage;const c=o.problemMessage.lastIndexOf(" ",r.MaxChars);return c===-1||c+r.MaxSpaceLookback<r.MaxChars?o.problemMessage.substring(0,r.MaxChars)+"…":o.problemMessage.substring(0,c)+"…"}let a=h(5153,"All Problems");return o.filterUri&&(a=h(5154,"Problems in {0}",je(o.filterUri))),a}s.label=n})(JE||(JE={}));var Mj;(function(s){function e(t){return R.isUri(t.value)?t.value:Hie(t.value)?t.value.uri:void 0}s.toUri=e})(Mj||(Mj={}));function hce(s){return s.kind==="paste"}function rb(s){return s.kind==="image"}function uce(s){return s.kind==="notebookOutput"}function gce(s){return s.kind==="element"}function pce(s){return s.kind==="scmHistoryItem"}const EK={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp"};function aTe(s){return Object.entries(EK).find(([e,t])=>t===s)?.[0]}const la={reason:"other"};class Nj{get session(){return this._session}get username(){return this.session.requesterUsername}get avatarIconUri(){return this.session.requesterAvatarIconUri}get attempt(){return this._attempt}get variableData(){return this._variableData}set variableData(e){this._variableData=e}get confirmation(){return this._confirmation}get locationData(){return this._locationData}get attachedContext(){return this._attachedContext}get editedFileEvents(){return this._editedFileEvents}constructor(e){this._session=e.session,this.message=e.message,this._variableData=e.variableData,this.timestamp=e.timestamp,this._attempt=e.attempt??0,this._confirmation=e.confirmation,this._locationData=e.locationData,this._attachedContext=e.attachedContext,this.isCompleteAddedRequest=e.isCompleteAddedRequest??!1,this.modelId=e.modelId,this.id=e.restoredId??"request_"+Dn(),this._editedFileEvents=e.editedFileEvents}adoptTo(e){this._session=e}}class fce{get value(){return this._responseParts}constructor(e){this._responseRepr="",this._markdownContent="",this._responseParts=e,this._updateRepr()}toString(){return this._responseRepr}getMarkdown(){return this._markdownContent}_updateRepr(){this._responseRepr=this.partsToRepr(this._responseParts),this._markdownContent=this._responseParts.map(e=>e.kind==="inlineReference"?this.inlineRefToRepr(e):e.kind==="markdownContent"||e.kind==="markdownVuln"?e.content.value:"").filter(e=>e.length>0).join("")}partsToRepr(e){const t=[];let i=[];for(const n of e){let o;switch(n.kind){case"treeData":case"progressMessage":case"codeblockUri":case"toolInvocation":case"toolInvocationSerialized":case"extensions":case"undoStop":case"prepareToolInvocation":continue;case"inlineReference":o={text:this.inlineRefToRepr(n)};break;case"command":o={text:n.command.title,isBlock:!0};break;case"textEditGroup":case"notebookEditGroup":o={text:h(5155,"Made changes."),isBlock:!0};break;case"confirmation":o={text:`${n.title}
${n.message}`,isBlock:!0};break;default:o={text:n.content.value};break}o.isBlock?(i.length&&(t.push(i.join("")),i=[]),t.push(o.text)):i.push(o.text)}return i.length&&t.push(i.join("")),t.join(`

`)}inlineRefToRepr(e){return"uri"in e.inlineReference?this.uriToRepr(e.inlineReference.uri):"name"in e.inlineReference?"`"+e.inlineReference.name+"`":this.uriToRepr(e.inlineReference)}uriToRepr(e){return e.scheme===ae.http||e.scheme===ae.https?e.toString(!1):je(e)}}class cTe extends fce{constructor(e,t){let i=e.value.findIndex(n=>n.kind==="undoStop"&&n.id===t);e.value[i+1]?.kind==="codeblockUri"&&e.value[i-1]?.kind==="markdownContent"&&i--,super(i===-1?e.value.slice():e.value.slice(0,i)),this.undoStop=t}}class dTe extends fce{get onDidChangeValue(){return this._onDidChangeValue.event}constructor(e){super(cw(e).map(t=>ec(t)?{content:t,kind:"markdownContent"}:"kind"in t?t:{kind:"treeData",treeData:t})),this._onDidChangeValue=new M,this._citations=[]}dispose(){this._onDidChangeValue.dispose()}clear(){this._responseParts=[],this._updateRepr(!0)}updateContent(e,t){if(e.kind==="markdownContent"){const i=this._responseParts.filter(n=>n.kind!=="textEditGroup").at(-1);if(!i||i.kind!=="markdownContent"||!uTe(i.content,e.content))this._responseParts.push(e);else{const n=this._responseParts.indexOf(i);this._responseParts[n]={...i,content:gTe(i.content,e.content)}}this._updateRepr(t)}else if(e.kind==="textEdit"||e.kind==="notebookEdit"){const n=e.uri.scheme===ae.vscodeNotebookCell&&!this._responseParts.find(d=>d.kind==="notebookEditGroup")?void 0:fl.parse(e.uri)?.notebook,o=n??e.uri;let r=!1;const a=e.kind==="textEdit"&&!n?"textEditGroup":"notebookEditGroup",c=a==="textEditGroup"?e.edits:e.edits.map(d=>Uie.isTextEdit(d)?{uri:e.uri,edit:d}:d);for(let d=0;!r&&d<this._responseParts.length;d++){const l=this._responseParts[d];l.kind===a&&!l.done&&Dt(l.uri,o)&&(l.edits.push(c),l.done=e.done,r=!0)}r||this._responseParts.push({kind:a,uri:o,edits:a==="textEditGroup"?[c]:c,done:e.done}),this._updateRepr(t)}else if(e.kind==="progressTask"){const i=this._responseParts.push(e)-1;this._updateRepr(t);const n=e.onDidAddProgress(()=>{this._updateRepr(!1)});e.task?.().then(o=>{n.dispose(),typeof o=="string"&&(this._responseParts[i].content=new Ni(o)),this._updateRepr(!1)})}else e.kind==="toolInvocation"?(e.confirmationMessages&&e.confirmed.p.then(()=>{this._updateRepr(!1)}),e.isCompletePromise.then(()=>{this._updateRepr(!1)}),this._responseParts.push(e),this._updateRepr(t)):(this._responseParts.push(e),this._updateRepr(t))}addCitation(e){this._citations.push(e),this._updateRepr()}_updateRepr(e){super._updateRepr(),this._onDidChangeValue&&(this._responseRepr+=this._citations.length?`

`+pTe(this._citations):"",e||this._onDidChangeValue.fire())}}class KD extends F{get session(){return this._session}get shouldBeRemovedOnSend(){return this._shouldBeRemovedOnSend}get isComplete(){return this._isComplete}set shouldBeRemovedOnSend(e){this._shouldBeRemovedOnSend=e,this._onDidChange.fire(la)}get isCanceled(){return this._isCanceled}get vote(){return this._vote}get voteDownReason(){return this._voteDownReason}get followups(){return this._followups}get entireResponse(){return this._finalizedResponse||this._response}get result(){return this._result}get username(){return this.session.responderUsername}get avatarIcon(){return this.session.responderAvatarIcon}get agent(){return this._agent}get slashCommand(){return this._slashCommand}get agentOrSlashCommandDetected(){return this._agentOrSlashCommandDetected??!1}get usedContext(){return this._usedContext}get contentReferences(){return Array.from(this._contentReferences)}get codeCitations(){return this._codeCitations}get progressMessages(){return this._progressMessages}get isStale(){return this._isStale}get isPaused(){return this._isPaused}get response(){const e=this._shouldBeRemovedOnSend?.afterUndoStop;return e?(this._responseView?.undoStop!==e&&(this._responseView=new cTe(this._response,e)),this._responseView):this._finalizedResponse||this._response}constructor(e){super(),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._contentReferences=[],this._codeCitations=[],this._progressMessages=[],this._isStale=!1,this._isPaused=oi("isPaused",!1),this._session=e.session,this._agent=e.agent,this._slashCommand=e.slashCommand,this.requestId=e.requestId,this._isComplete=e.isComplete??!1,this._isCanceled=e.isCanceled??!1,this._vote=e.vote,this._voteDownReason=e.voteDownReason,this._result=e.result,this._followups=e.followups?[...e.followups]:void 0,this.isCompleteAddedRequest=e.isCompleteAddedRequest??!1,this._shouldBeRemovedOnSend=e.shouldBeRemovedOnSend,this._isStale=Array.isArray(e.responseContent)&&(e.responseContent.length!==0||ec(e.responseContent)&&e.responseContent.value.length!==0),this._response=this._register(new dTe(e.responseContent));const t=AE(this,this.onDidChange);this.isPendingConfirmation=t.map((i,n)=>(t.read(n),this._response.value.some(o=>o.kind==="toolInvocation"&&o.isConfirmed===void 0||o.kind==="confirmation"&&o.isUsed===!1))),this.isInProgress=t.map((i,n)=>(t.read(n),!this.isPendingConfirmation.read(n)&&!this.shouldBeRemovedOnSend&&!this._isComplete)),this._register(this._response.onDidChangeValue(()=>this._onDidChange.fire(la))),this.id=e.restoredId??"response_"+Dn()}updateContent(e,t){this.bufferWhenPaused(()=>this._response.updateContent(e,t))}addUndoStop(e){this.bufferWhenPaused(()=>{this._onDidChange.fire({reason:"undoStop",id:e.id}),this._response.updateContent(e,!0)})}applyReference(e){e.kind==="usedContext"?this._usedContext=e:e.kind==="reference"&&(this._contentReferences.push(e),this._onDidChange.fire(la))}applyCodeCitation(e){this._codeCitations.push(e),this._response.addCitation(e),this._onDidChange.fire(la)}setAgent(e,t){this._agent=e,this._slashCommand=t,this._agentOrSlashCommandDetected=!e.isDefault||!!t,this._onDidChange.fire(la)}setResult(e){this._result=e,this._onDidChange.fire(la)}complete(){this._result?.errorDetails?.responseIsRedacted&&this._response.clear(),this._isComplete=!0,this._onDidChange.fire(la)}cancel(){this._isComplete=!0,this._isCanceled=!0,this._onDidChange.fire(la)}setFollowups(e){this._followups=e,this._onDidChange.fire(la)}setVote(e){this._vote=e,this._onDidChange.fire(la)}setVoteDownReason(e){this._voteDownReason=e,this._onDidChange.fire(la)}setEditApplied(e,t){return!this.response.value.includes(e)||!e.state?!1:(e.state.applied=t,this._onDidChange.fire(la),!0)}adoptTo(e){this._session=e,this._onDidChange.fire(la)}setPaused(e,t){this._isPaused.set(e,t),this._onDidChange.fire(la),this.bufferedPauseContent?.forEach(i=>i()),this.bufferedPauseContent=void 0}finalizeUndoState(){this._finalizedResponse=this.response,this._responseView=void 0,this._shouldBeRemovedOnSend=void 0}bufferWhenPaused(e){this._isPaused.get()?(this.bufferedPauseContent??=[],this.bufferedPauseContent.push(e)):e()}}var ab;(function(s){s[s.NotPausable=0]="NotPausable",s[s.Paused=1]="Paused",s[s.Unpaused=2]="Unpaused"})(ab||(ab={}));function lTe(s){const e=s;return typeof e=="object"&&typeof e.requesterUsername=="string"}function hTe(s){const e=s;return lTe(s)&&typeof e.creationDate=="number"&&typeof e.sessionId=="string"&&s.requests.every(t=>!t.usedContext||rTe(t.usedContext))}var VA;(function(s){s[s.Removal=0]="Removal",s[s.Resend=1]="Resend",s[s.Adoption=2]="Adoption"})(VA||(VA={}));let Oj=AB=class extends F{static getDefaultTitle(e){const t=e.at(0)?.message??"";return(typeof t=="string"?t:t.text).split(`
`)[0].substring(0,50)}get sessionId(){return this._sessionId}get requestInProgress(){return this.requestInProgressObs.get()}get requestPausibility(){const e=this.lastRequest;return!e?.response?.agent||e.response.isComplete||e.response.isPendingConfirmation.get()?ab.NotPausable:e.response.isPaused.get()?ab.Paused:ab.Unpaused}get hasRequests(){return this._requests.length>0}get lastRequest(){return this._requests.at(-1)}get creationDate(){return this._creationDate}get lastMessageDate(){return this._lastMessageDate}get _defaultAgent(){return this.chatAgentService.getDefaultAgent(Vi.Panel,jt.Ask)}get requesterUsername(){return this._defaultAgent?.metadata.requester?.name??this.initialData?.requesterUsername??""}get responderUsername(){return this._defaultAgent?.fullName??this.initialData?.responderUsername??""}get requesterAvatarIconUri(){return this._defaultAgent?.metadata.requester?.icon??this._initialRequesterAvatarIconUri}get responderAvatarIcon(){return this._defaultAgent?.metadata.themeIcon??this._initialResponderAvatarIconUri}get isImported(){return this._isImported}get customTitle(){return this._customTitle}get title(){return this._customTitle||AB.getDefaultTitle(this._requests)}get initialLocation(){return this._initialLocation}get editingSessionObs(){return this._editingSession}get editingSession(){return this._editingSession?.promiseResult.get()?.data}constructor(e,t,i,n,o){super(),this.initialData=e,this._initialLocation=t,this.logService=i,this.chatAgentService=n,this.chatEditingService=o,this._onDidDispose=this._register(new M),this.onDidDispose=this._onDidDispose.event,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._isImported=!1,this.currentEditedFileEvents=new wn,this._checkpoint=void 0;const r=hTe(e);e&&!r&&this.logService.warn(`ChatModel#constructor: Loaded malformed session data: ${JSON.stringify(e)}`),this._isImported=!!e&&!r||(e?.isImported??!1),this._sessionId=r&&e.sessionId||Dn(),this._requests=e?this._deserialize(e):[],this._creationDate=r&&e.creationDate||Date.now(),this._lastMessageDate=r&&e.lastMessageDate||this._creationDate,this._customTitle=r?e.customTitle:void 0,this._initialRequesterAvatarIconUri=e?.requesterAvatarIconUri&&R.revive(e.requesterAvatarIconUri),this._initialResponderAvatarIconUri=MT(e?.responderAvatarIconUri)?R.revive(e.responderAvatarIconUri):e?.responderAvatarIconUri;const a=On(this,this.onDidChange,()=>this._requests.at(-1)?.response);this.requestInProgressObs=a.map((c,d)=>c?.isInProgress.read(d)??!1)}startEditingSession(e){const t=e?this.chatEditingService.startOrContinueGlobalEditingSession(this):this.chatEditingService.createEditingSession(this);this._editingSession=new Nme(t),this._editingSession.promise.then(i=>{this._store.isDisposed?i.dispose():this._register(i)})}notifyEditingAction(e){const t=e.outcome==="accepted"?cb.Keep:e.outcome==="rejected"?cb.Undo:e.outcome==="userModified"?cb.UserModification:null;t!==null&&(!this.currentEditedFileEvents.has(e.uri)||this.currentEditedFileEvents.get(e.uri)?.eventKind===cb.Keep)&&this.currentEditedFileEvents.set(e.uri,{eventKind:t,uri:e.uri})}_deserialize(e){const t=e.requests;if(!Array.isArray(t))return this.logService.error(`Ignoring malformed session data: ${JSON.stringify(e)}`),[];try{return t.map(i=>{const n=typeof i.message=="string"?this.getParsedRequestFromString(i.message):nTe(i.message),o=this.reviveVariableData(i.variableData),r=new Nj({session:this,message:n,variableData:o,timestamp:i.timestamp??-1,restoredId:i.requestId,confirmation:i.confirmation,editedFileEvents:i.editedFileEvents});if(r.shouldBeRemovedOnSend=i.isHidden?{requestId:i.requestId}:i.shouldBeRemovedOnSend,i.response||i.result||i.responseErrorDetails){const a=i.agent&&"metadata"in i.agent?lce(i.agent):void 0,c="responseErrorDetails"in i?{errorDetails:i.responseErrorDetails}:i.result;r.response=new KD({responseContent:i.response??[new Ni(i.response)],session:this,agent:a,slashCommand:i.slashCommand,requestId:r.id,isComplete:!0,isCanceled:i.isCanceled,vote:i.vote,voteDownReason:i.voteDownReason,result:c,followups:i.followups,restoredId:i.responseId}),r.response.shouldBeRemovedOnSend=i.isHidden?{requestId:i.requestId}:i.shouldBeRemovedOnSend,i.usedContext&&r.response.applyReference(cn(i.usedContext)),i.contentReferences?.forEach(d=>r.response.applyReference(cn(d))),i.codeCitations?.forEach(d=>r.response.applyCodeCitation(cn(d)))}return r})}catch(i){return this.logService.error("Failed to parse chat data",i),[]}}reviveVariableData(e){const t=e&&Array.isArray(e.variables)?e:{variables:[]};return t.variables=t.variables.map(i=>i&&"values"in i&&Array.isArray(i.values)?{kind:"generic",id:i.id??"",name:i.name,value:i.values[0]?.value,range:i.range,modelDescription:i.modelDescription,references:i.references}:i),t}getParsedRequestFromString(e){const t=[new xu(new bi(0,e.length),{startColumn:1,startLineNumber:1,endColumn:1,endLineNumber:1},e)];return{text:e,parts:t}}toggleLastRequestPaused(e){if(this.requestPausibility!==ab.NotPausable&&this.lastRequest?.response?.agent){const t=e??!this.lastRequest.response.isPaused.get();this.lastRequest.response.setPaused(t),this.chatAgentService.setRequestPaused(this.lastRequest.response.agent.id,this.lastRequest.id,t),this._onDidChange.fire({kind:"changedRequest",request:this.lastRequest})}}getRequests(){return this._requests}get checkpoint(){return this._checkpoint}setDisabledRequests(e){this._requests.forEach(t=>{const i=e.find(n=>n.requestId===t.id);t.shouldBeRemovedOnSend=i,t.response&&(t.response.shouldBeRemovedOnSend=i)}),this._onDidChange.fire({kind:"setHidden",hiddenRequestIds:e})}addRequest(e,t,i,n,o,r,a,c,d,l){const u=[...this.currentEditedFileEvents.values()];this.currentEditedFileEvents.clear();const g=new Nj({session:this,message:e,variableData:t,timestamp:Date.now(),attempt:i,confirmation:r,locationData:a,attachedContext:c,isCompleteAddedRequest:d,modelId:l,editedFileEvents:u.length?u:void 0});return g.response=new KD({responseContent:[],session:this,agent:n,slashCommand:o,requestId:g.id,isCompleteAddedRequest:d}),this._requests.push(g),this._lastMessageDate=Date.now(),this._onDidChange.fire({kind:"addRequest",request:g}),g}setCustomTitle(e){this._customTitle=e}updateRequest(e,t){e.variableData=t,this._onDidChange.fire({kind:"changedRequest",request:e})}adoptRequest(e){const t=e.session,i=t._requests.findIndex(n=>n.id===e.id);i!==-1&&(t._requests.splice(i,1),e.adoptTo(this),e.response?.adoptTo(this),this._requests.push(e),t._onDidChange.fire({kind:"removeRequest",requestId:e.id,responseId:e.response?.id,reason:VA.Adoption}),this._onDidChange.fire({kind:"addRequest",request:e}))}acceptResponseProgress(e,t,i){if(e.response||(e.response=new KD({responseContent:[],session:this,requestId:e.id})),e.response.isComplete)throw new Error("acceptResponseProgress: Adding progress to a completed response");t.kind==="usedContext"||t.kind==="reference"?e.response.applyReference(t):t.kind==="codeCitation"?e.response.applyCodeCitation(t):t.kind==="move"?this._onDidChange.fire({kind:"move",target:t.uri,range:t.range}):t.kind==="codeblockUri"&&t.isEdit?(e.response.addUndoStop({id:Dn(),kind:"undoStop"}),e.response.updateContent(t,i)):t.kind==="progressTaskResult"?this.logService.error(`Couldn't handle progress: ${JSON.stringify(t)}`):e.response.updateContent(t,i)}removeRequest(e,t=VA.Removal){const i=this._requests.findIndex(o=>o.id===e),n=this._requests[i];i!==-1&&(this._onDidChange.fire({kind:"removeRequest",requestId:n.id,responseId:n.response?.id,reason:t}),this._requests.splice(i,1),n.response?.dispose())}cancelRequest(e){e.response&&e.response.cancel()}setResponse(e,t){e.response||(e.response=new KD({responseContent:[],session:this,requestId:e.id})),e.response.setResult(t)}completeResponse(e){if(!e.response)throw new Error("Call setResponse before completeResponse");e.response.complete(),this._onDidChange.fire({kind:"completedRequest",request:e})}setFollowups(e,t){e.response&&e.response.setFollowups(t)}setResponseModel(e,t){e.response=t,this._onDidChange.fire({kind:"addResponse",response:t})}toExport(){return{requesterUsername:this.requesterUsername,requesterAvatarIconUri:this.requesterAvatarIconUri,responderUsername:this.responderUsername,responderAvatarIconUri:this.responderAvatarIcon,initialLocation:this.initialLocation,requests:this._requests.map(e=>{const t={...e.message,parts:e.message.parts.map(o=>o&&"toJSON"in o?o.toJSON():o)},i=e.response?.agent,n=i&&"toJSON"in i?i.toJSON():i?{...i}:void 0;return{requestId:e.id,message:t,variableData:e.variableData,response:e.response?e.response.entireResponse.value.map(o=>o.kind==="treeData"?o.treeData:o.kind==="markdownContent"?o.content:o):void 0,responseId:e.response?.id,shouldBeRemovedOnSend:e.shouldBeRemovedOnSend,result:e.response?.result,followups:e.response?.followups,isCanceled:e.response?.isCanceled,vote:e.response?.vote,voteDownReason:e.response?.voteDownReason,agent:n,slashCommand:e.response?.slashCommand,usedContext:e.response?.usedContext,contentReferences:e.response?.contentReferences,codeCitations:e.response?.codeCitations,timestamp:e.timestamp,confirmation:e.confirmation,editedFileEvents:e.editedFileEvents}})}}toJSON(){return{version:3,...this.toExport(),sessionId:this.sessionId,creationDate:this._creationDate,isImported:this._isImported,lastMessageDate:this._lastMessageDate,customTitle:this._customTitle}}dispose(){this._requests.forEach(e=>e.response?.dispose()),this._onDidDispose.fire(),super.dispose()}};Oj=AB=f([p(2,Pe),p(3,ff),p(4,bg)],Oj);function uTe(s,e){if(s.baseUri&&e.baseUri){if(!(s.baseUri.scheme===e.baseUri.scheme&&s.baseUri.authority===e.baseUri.authority&&s.baseUri.path===e.baseUri.path&&s.baseUri.query===e.baseUri.query&&s.baseUri.fragment===e.baseUri.fragment))return!1}else if(s.baseUri||e.baseUri)return!1;return ma(s.isTrusted,e.isTrusted)&&s.supportHtml===e.supportHtml&&s.supportThemeIcons===e.supportThemeIcons}function gTe(s,e){const t=typeof e=="string"?e:e.value;return{value:s.value+t,isTrusted:s.isTrusted,supportThemeIcons:s.supportThemeIcons,supportHtml:s.supportHtml,baseUri:s.baseUri}}function pTe(s){if(s.length===0)return"";const e=s.reduce((i,n)=>i.add(n.license),new Set);return e.size===1?h(5156,"Similar code found with 1 license type",e.size):h(5157,"Similar code found with {0} license types",e.size)}var cb;(function(s){s[s.Keep=1]="Keep",s[s.Undo=2]="Undo",s[s.UserModification=3]="UserModification"})(cb||(cb={}));var Fj;(function(s){s.scheme="vscode-chat-response-resource";function e(i,n,o,r,a){return R.from({scheme:s.scheme,authority:i,path:`/tool/${n}/${o}/${r}`+(a?`/${a}`:"")})}s.createUri=e;function t(i){if(i.scheme!==s.scheme)return;const n=i.path.split("/");if(n.length<5)return;const[,o,r,a,c]=n;if(o==="tool")return{sessionId:i.authority,requestId:r,toolCallId:a,index:Number(c)}}s.parseUri=t})(Fj||(Fj={}));var hu;(function(s){s[s.System=0]="System",s[s.User=1]="User",s[s.Assistant=2]="Assistant"})(hu||(hu={}));var Wj;(function(s){s.PNG="image/png",s.JPEG="image/jpeg",s.GIF="image/gif",s.WEBP="image/webp",s.BMP="image/bmp"})(Wj||(Wj={}));var Bj;(function(s){s.Low="low",s.High="high"})(Bj||(Bj={}));const Vj={type:"object",properties:{vendor:{type:"string",description:h(5173,"A globally unique vendor of language models.")}}},fTe=_l.registerExtensionPoint({extensionPoint:"languageModels",jsonSchema:{description:h(5174,"Contribute language models of a specific vendor."),oneOf:[Vj,{type:"array",items:Vj}]},activationEventsGenerator:(s,e)=>{for(const t of s)e.push(`onLanguageModelChat:${t.vendor}`)}});let Hj=class{constructor(e,t,i){this._extensionService=e,this._logService=t,this._contextKeyService=i,this._store=new U,this._providers=new Map,this._vendors=new Set,this._onDidChangeProviders=this._store.add(new M),this.onDidChangeLanguageModels=this._onDidChangeProviders.event,this._hasUserSelectableModels=ve.languageModelsAreUserSelectable.bindTo(this._contextKeyService),this._store.add(fTe.setHandler(n=>{this._vendors.clear();for(const r of n){if(!yE(r.description,"chatProvider")){r.collector.error(h(5175,"This contribution point requires the 'chatProvider' proposal."));continue}for(const a of dn.wrap(r.value)){if(this._vendors.has(a.vendor)){r.collector.error(h(5176,"The vendor '{0}' is already registered and cannot be registered twice",a.vendor));continue}if(wu(a.vendor)){r.collector.error(h(5177,"The vendor field cannot be empty."));continue}if(a.vendor.trim()!==a.vendor){r.collector.error(h(5178,"The vendor field cannot start or end with whitespace."));continue}this._vendors.add(a.vendor)}}const o=[];for(const[r,a]of this._providers)this._vendors.has(a.metadata.vendor)||(this._providers.delete(r),o.push(r));o.length>0&&this._onDidChangeProviders.fire({removed:o})}))}dispose(){this._store.dispose(),this._providers.clear()}getLanguageModelIds(){return Array.from(this._providers.keys())}lookupLanguageModel(e){return this._providers.get(e)?.metadata}async selectLanguageModels(e){if(e.vendor)await this._extensionService.activateByEvent(`onLanguageModelChat:${e.vendor}}`);else{const i=Array.from(this._vendors).map(n=>this._extensionService.activateByEvent(`onLanguageModelChat:${n}`));await Promise.all(i)}const t=[];for(const[i,n]of this._providers)(e.vendor===void 0||n.metadata.vendor===e.vendor)&&(e.family===void 0||n.metadata.family===e.family)&&(e.version===void 0||n.metadata.version===e.version)&&(e.id===void 0||n.metadata.id===e.id)&&(!n.metadata.targetExtensions||n.metadata.targetExtensions.some(o=>Es.equals(o,e.extension)))&&t.push(i);return this._logService.trace("[LM] selected language models",e,t),t}registerLanguageModelChat(e,t){if(this._logService.trace("[LM] registering language model chat",e,t.metadata),!this._vendors.has(t.metadata.vendor))throw new Error(`Chat response provider uses UNKNOWN vendor ${t.metadata.vendor}.`);if(this._providers.has(e))throw new Error(`Chat response provider with identifier ${e} is already registered.`);return this._providers.set(e,t),this._onDidChangeProviders.fire({added:[{identifier:e,metadata:t.metadata}]}),this.updateUserSelectableModelsContext(),Ee(()=>{this.updateUserSelectableModelsContext(),this._providers.delete(e)&&(this._onDidChangeProviders.fire({removed:[e]}),this._logService.trace("[LM] UNregistered language model chat",e,t.metadata))})}updateUserSelectableModelsContext(){const e=Array.from(this._providers.values()).some(i=>i.metadata.isUserSelectable&&!i.metadata.isDefault),t=Array.from(this._providers.values()).some(i=>i.metadata.isDefault);this._hasUserSelectableModels.set(e&&t)}async sendChatRequest(e,t,i,n,o){const r=this._providers.get(e);if(!r)throw new Error(`Chat response provider with identifier ${e} is not registered.`);return r.sendChatRequest(i,t,n,o)}computeTokenLength(e,t,i){const n=this._providers.get(e);if(!n)throw new Error(`Chat response provider with identifier ${e} is not registered.`);return n.provideTokenCount(t,i)}};Hj=f([p(0,hn),p(1,Pe),p(2,me)],Hj);var Rc;(function(s){s.Delimiter="\0"})(Rc||(Rc={}));var ql;(function(s){s[s.IsSame=0]="IsSame",s[s.Disconnected=1]="Disconnected",s[s.IsChild=2]="IsChild",s[s.IsParent=3]="IsParent"})(ql||(ql={}));class Ln{static fromExtHostTestItem(e,t,i=e.parent){if(e._isRoot)return new Ln([t]);const n=[e.id];for(let o=i;o&&o.id!==t;o=o.parent)n.push(o.id);return n.push(t),new Ln(n.reverse())}static isRoot(e){return!e.includes(Rc.Delimiter)}static root(e){const t=e.indexOf(Rc.Delimiter);return t===-1?e:e.slice(0,t)}static fromString(e){return new Ln(e.split(Rc.Delimiter))}static join(e,t){return new Ln([...e.path,t])}static split(e){return e.split(Rc.Delimiter)}static joinToString(e,t){return e.toString()+Rc.Delimiter+t}static parentId(e){const t=e.lastIndexOf(Rc.Delimiter);return t===-1?void 0:e.slice(0,t)}static localId(e){const t=e.lastIndexOf(Rc.Delimiter);return t===-1?e:e.slice(t+Rc.Delimiter.length)}static isChild(e,t){return t[e.length]===Rc.Delimiter&&t.startsWith(e)}static compare(e,t){return e===t?ql.IsSame:Ln.isChild(e,t)?ql.IsChild:Ln.isChild(t,e)?ql.IsParent:ql.Disconnected}static getLengthOfCommonPrefix(e,t){if(e===0)return 0;let i=0;for(;i<e-1;){for(let n=1;n<e;n++){const o=t(n-1),r=t(n);if(o.path[i]!==r.path[i])return i}i++}return i}constructor(e,t=e.length){if(this.path=e,this.viewEnd=t,e.length===0||t<1)throw new Error("cannot create test with empty path")}get rootId(){return new Ln(this.path,1)}get parentId(){return this.viewEnd>1?new Ln(this.path,this.viewEnd-1):void 0}get localId(){return this.path[this.viewEnd-1]}get controllerId(){return this.path[0]}get isRoot(){return this.viewEnd===1}*idsFromRoot(){for(let e=1;e<=this.viewEnd;e++)yield new Ln(this.path,e)}*idsToRoot(){for(let e=this.viewEnd;e>0;e--)yield new Ln(this.path,e)}compare(e){if(typeof e=="string")return Ln.compare(this.toString(),e);for(let t=0;t<e.viewEnd&&t<this.viewEnd;t++)if(e.path[t]!==this.path[t])return ql.Disconnected;return e.viewEnd>this.viewEnd?ql.IsChild:e.viewEnd<this.viewEnd?ql.IsParent:ql.IsSame}toJSON(){return this.toString()}toString(){if(!this.stringifed){this.stringifed=this.path[0];for(let e=1;e<this.viewEnd;e++)this.stringifed+=Rc.Delimiter,this.stringifed+=this.path[e]}return this.stringifed}}var Mi;(function(s){s[s.Unset=0]="Unset",s[s.Queued=1]="Queued",s[s.Running=2]="Running",s[s.Passed=3]="Passed",s[s.Failed=4]="Failed",s[s.Skipped=5]="Skipped",s[s.Errored=6]="Errored"})(Mi||(Mi={}));Mi.Unset+"",Mi.Queued+"",Mi.Running+"",Mi.Passed+"",Mi.Failed+"",Mi.Skipped+"",Mi.Errored+"";var Uj;(function(s){s[s.Run=1]="Run",s[s.Debug=2]="Debug",s[s.Coverage=3]="Coverage"})(Uj||(Uj={}));var $j;(function(s){s[s.Refresh=2]="Refresh",s[s.CodeRelatedToTest=4]="CodeRelatedToTest",s[s.TestRelatedToCode=8]="TestRelatedToCode"})($j||($j={}));var To;(function(s){s[s.Run=2]="Run",s[s.Debug=4]="Debug",s[s.Coverage=8]="Coverage",s[s.HasNonDefaultProfile=16]="HasNonDefaultProfile",s[s.HasConfigurable=32]="HasConfigurable",s[s.SupportsContinuousRun=64]="SupportsContinuousRun"})(To||(To={}));To.Run+"",h(11325,"Run"),To.Debug+"",h(11326,"Debug"),To.Coverage+"",h(11327,"Coverage");To.Run,To.Debug,To.Coverage,To.HasNonDefaultProfile,To.HasConfigurable,To.SupportsContinuousRun;const T9e=s=>"runId"in s;var Iy;(function(s){s.serialize=e=>({range:e.range.toJSON(),uri:e.uri.toJSON()}),s.deserialize=(e,t)=>({range:P.lift(t.range),uri:e.asCanonicalUri(R.revive(t.uri))})})(Iy||(Iy={}));var rd;(function(s){s[s.Error=0]="Error",s[s.Output=1]="Output"})(rd||(rd={}));var HA;(function(s){s.serialize=e=>({label:e.label,uri:e.uri?.toJSON(),position:e.position?.toJSON()}),s.deserialize=(e,t)=>({label:t.label,uri:t.uri?e.asCanonicalUri(R.revive(t.uri)):void 0,position:t.position?_e.lift(t.position):void 0})})(HA||(HA={}));var UA;(function(s){s.serialize=e=>({message:e.message,type:rd.Error,expected:e.expected,actual:e.actual,contextValue:e.contextValue,location:e.location&&Iy.serialize(e.location),stackTrace:e.stackTrace?.map(HA.serialize)}),s.deserialize=(e,t)=>({message:t.message,type:rd.Error,expected:t.expected,actual:t.actual,contextValue:t.contextValue,location:t.location&&Iy.deserialize(e,t.location),stackTrace:t.stackTrace&&t.stackTrace.map(i=>HA.deserialize(e,i))})})(UA||(UA={}));const mTe=(s,e)=>`${e?"s":"e"}${s}`;var $A;(function(s){s.serialize=e=>({message:e.message,type:rd.Output,offset:e.offset,length:e.length,location:e.location&&Iy.serialize(e.location)}),s.deserialize=(e,t)=>({message:t.message,type:rd.Output,offset:t.offset,length:t.length,location:t.location&&Iy.deserialize(e,t.location)})})($A||($A={}));var ex;(function(s){s.serialize=e=>e.type===rd.Error?UA.serialize(e):$A.serialize(e),s.deserialize=(e,t)=>t.type===rd.Error?UA.deserialize(e,t):$A.deserialize(e,t),s.isDiffable=e=>e.type===rd.Error&&e.actual!==void 0&&e.expected!==void 0})(ex||(ex={}));var PC;(function(s){s.serializeWithoutMessages=e=>({state:e.state,duration:e.duration,messages:[]}),s.serialize=e=>({state:e.state,duration:e.duration,messages:e.messages.map(ex.serialize)}),s.deserialize=(e,t)=>({state:t.state,duration:t.duration,messages:t.messages.map(i=>ex.deserialize(e,i))})})(PC||(PC={}));const mce="\0",Uk=(s,e)=>s+mce+e,vTe=s=>{const e=s.indexOf(mce);return{ctrlId:s.slice(0,e),tagId:s.slice(e+1)}};var tx;(function(s){s.serialize=e=>({extId:e.extId,label:e.label,tags:e.tags,busy:e.busy,children:void 0,uri:e.uri?.toJSON(),range:e.range?.toJSON()||null,description:e.description,error:e.error,sortText:e.sortText}),s.deserialize=(e,t)=>({extId:t.extId,label:t.label,tags:t.tags,busy:t.busy,children:void 0,uri:t.uri?e.asCanonicalUri(R.revive(t.uri)):void 0,range:t.range?P.lift(t.range):null,description:t.description,error:t.error,sortText:t.sortText})})(tx||(tx={}));var Js;(function(s){s[s.NotExpandable=0]="NotExpandable",s[s.Expandable=1]="Expandable",s[s.BusyExpanding=2]="BusyExpanding",s[s.Expanded=3]="Expanded"})(Js||(Js={}));var Cp;(function(s){s.serialize=e=>({expand:e.expand,item:tx.serialize(e.item)}),s.deserialize=(e,t)=>({controllerId:Ln.root(t.item.extId),expand:t.expand,item:tx.deserialize(e,t.item)})})(Cp||(Cp={}));var ix;(function(s){s.serialize=e=>{let t;return e.item&&(t={},e.item.label!==void 0&&(t.label=e.item.label),e.item.tags!==void 0&&(t.tags=e.item.tags),e.item.busy!==void 0&&(t.busy=e.item.busy),e.item.uri!==void 0&&(t.uri=e.item.uri?.toJSON()),e.item.range!==void 0&&(t.range=e.item.range?.toJSON()),e.item.description!==void 0&&(t.description=e.item.description),e.item.error!==void 0&&(t.error=e.item.error),e.item.sortText!==void 0&&(t.sortText=e.item.sortText)),{extId:e.extId,expand:e.expand,item:t}},s.deserialize=e=>{let t;return e.item&&(t={},e.item.label!==void 0&&(t.label=e.item.label),e.item.tags!==void 0&&(t.tags=e.item.tags),e.item.busy!==void 0&&(t.busy=e.item.busy),e.item.range!==void 0&&(t.range=e.item.range?P.lift(e.item.range):null),e.item.description!==void 0&&(t.description=e.item.description),e.item.error!==void 0&&(t.error=e.item.error),e.item.sortText!==void 0&&(t.sortText=e.item.sortText)),{extId:e.extId,expand:e.expand,item:t}}})(ix||(ix={}));const RB=(s,e)=>{e.expand!==void 0&&(s.expand=e.expand),e.item!==void 0&&(s.item=s.item?Object.assign(s.item,e.item):e.item)};var GA;(function(s){s.serializeWithoutMessages=e=>({...Cp.serialize(e),ownComputedState:e.ownComputedState,computedState:e.computedState,tasks:e.tasks.map(PC.serializeWithoutMessages)}),s.serialize=e=>({...Cp.serialize(e),ownComputedState:e.ownComputedState,computedState:e.computedState,tasks:e.tasks.map(PC.serialize)}),s.deserialize=(e,t)=>({...Cp.deserialize(e,t),ownComputedState:t.ownComputedState,computedState:t.computedState,tasks:t.tasks.map(i=>PC.deserialize(e,i)),retired:!0})})(GA||(GA={}));var PB;(function(s){s.empty=()=>({covered:0,total:0}),s.sum=(e,t)=>{e.covered+=t.covered,e.total+=t.total}})(PB||(PB={}));var LB;(function(s){s.serialize=e=>({id:e.id,statement:e.statement,branch:e.branch,declaration:e.declaration,testIds:e.testIds,uri:e.uri.toJSON()}),s.deserialize=(e,t)=>({id:t.id,statement:t.statement,branch:t.branch,declaration:t.declaration,testIds:t.testIds,uri:e.asCanonicalUri(R.revive(t.uri))}),s.empty=(e,t)=>({id:e,uri:t,statement:PB.empty()})})(LB||(LB={}));function xK(s){return{...s,location:s.location?.toJSON()}}function IK(s){return s.location=s.location?_e.isIPosition(s.location)?_e.lift(s.location):P.lift(s.location):void 0,s}var km;(function(s){s[s.Declaration=0]="Declaration",s[s.Statement=1]="Statement",s[s.Branch=2]="Branch"})(km||(km={}));var MB;(function(s){s.serialize=e=>e.type===km.Declaration?zA.serialize(e):KA.serialize(e),s.deserialize=e=>e.type===km.Declaration?zA.deserialize(e):KA.deserialize(e)})(MB||(MB={}));var qA;(function(s){s.serialize=xK,s.deserialize=IK})(qA||(qA={}));var zA;(function(s){s.serialize=xK,s.deserialize=IK})(zA||(zA={}));var KA;(function(s){s.serialize=e=>({...xK(e),branches:e.branches?.map(qA.serialize)}),s.deserialize=e=>({...IK(e),branches:e.branches?.map(qA.deserialize)})})(KA||(KA={}));var bn;(function(s){s[s.Add=0]="Add",s[s.Update=1]="Update",s[s.DocumentSynced=2]="DocumentSynced",s[s.Remove=3]="Remove",s[s.IncrementPendingExtHosts=4]="IncrementPendingExtHosts",s[s.Retire=5]="Retire",s[s.AddTag=6]="AddTag",s[s.RemoveTag=7]="RemoveTag"})(bn||(bn={}));var jA;(function(s){s.deserialize=(e,t)=>t.op===bn.Add?{op:t.op,item:Cp.deserialize(e,t.item)}:t.op===bn.Update?{op:t.op,item:ix.deserialize(t.item)}:t.op===bn.DocumentSynced?{op:t.op,uri:e.asCanonicalUri(R.revive(t.uri)),docv:t.docv}:t,s.serialize=e=>e.op===bn.Add?{op:e.op,item:Cp.serialize(e.item)}:e.op===bn.Update?{op:e.op,item:ix.serialize(e.item)}:e})(jA||(jA={}));class A9e{constructor(e){this.uriIdentity=e,this._tags=new Map,this.items=new Map,this.roots=new Set,this.busyControllerCount=0,this.pendingRootCount=0,this.tags=this._tags}apply(e){const t=this.createChangeCollector();for(const i of e)switch(i.op){case bn.Add:this.add(Cp.deserialize(this.uriIdentity,i.item),t);break;case bn.Update:this.update(ix.deserialize(i.item),t);break;case bn.Remove:this.remove(i.itemId,t);break;case bn.Retire:this.retireTest(i.itemId);break;case bn.IncrementPendingExtHosts:this.updatePendingRoots(i.amount);break;case bn.AddTag:this._tags.set(i.tag.id,i.tag);break;case bn.RemoveTag:this._tags.delete(i.id);break}t.complete?.()}add(e,t){const i=Ln.parentId(e.item.extId)?.toString();let n;if(!i)n=this.createItem(e),this.roots.add(n),this.items.set(e.item.extId,n);else if(this.items.has(i)){const o=this.items.get(i);o.children.add(e.item.extId),n=this.createItem(e,o),this.items.set(e.item.extId,n)}else{console.error(`Test with unknown parent ID: ${JSON.stringify(e)}`);return}return t.add?.(n),e.expand===Js.BusyExpanding&&this.busyControllerCount++,n}update(e,t){const i=this.items.get(e.extId);if(i)return e.expand!==void 0&&(i.expand===Js.BusyExpanding&&this.busyControllerCount--,e.expand===Js.BusyExpanding&&this.busyControllerCount++),RB(i,e),t.update?.(i),i}remove(e,t){const i=this.items.get(e);if(!i)return;const n=Ln.parentId(i.item.extId)?.toString();n?this.items.get(n).children.delete(i.item.extId):this.roots.delete(i);const o=[[e]];for(;o.length;)for(const r of o.pop()){const a=this.items.get(r);a&&(o.push(a.children),this.items.delete(r),t.remove?.(a,a!==i),a.expand===Js.BusyExpanding&&this.busyControllerCount--)}}retireTest(e){}updatePendingRoots(e){this.pendingRootCount+=e}createChangeCollector(){return{}}}var Yr;(function(s){s[s.Upsert=0]="Upsert",s[s.SetTags=1]="SetTags",s[s.UpdateCanResolveChildren=2]="UpdateCanResolveChildren",s[s.RemoveChild=3]="RemoveChild",s[s.SetProp=4]="SetProp",s[s.Bulk=5]="Bulk",s[s.DocumentSynced=6]="DocumentSynced"})(Yr||(Yr={}));const wS=(s,e)=>s===e,_Te={range:(s,e)=>s===e?!0:!s||!e?!1:s.equalsRange(e),busy:wS,label:wS,description:wS,error:wS,sortText:wS,tags:(s,e)=>!(s.length!==e.length||s.some(t=>!e.includes(t)))},bTe=Object.entries(_Te),yTe=(s,e)=>{let t;for(const[i,n]of bTe)n(s[i],e[i])||(t?t[i]=e[i]:t={[i]:e[i]});return t};class R9e extends F{get root(){return this.options.root}constructor(e){super(),this.options=e,this.debounceSendDiff=this._register(new fn(()=>this.flushDiff(),200)),this.diffOpEmitter=this._register(new M),this.tree=new Map,this.tags=new Map,this.diff=[],this.onDidGenerateDiff=this.diffOpEmitter.event,this.root.canResolveChildren=!0,this.upsertItem(this.root,void 0)}set resolveHandler(e){this._resolveHandler=e;for(const t of this.tree.values())this.updateExpandability(t)}get resolveHandler(){return this._resolveHandler}collectDiff(){const e=this.diff;return this.diff=[],e}pushDiff(e){switch(e.op){case bn.DocumentSynced:{for(const t of this.diff)if(t.op===bn.DocumentSynced&&t.uri===e.uri){t.docv=e.docv;return}break}case bn.Update:{const t=this.diff[this.diff.length-1];if(t){if(t.op===bn.Update&&t.item.extId===e.item.extId){RB(t.item,e.item);return}if(t.op===bn.Add&&t.item.item.extId===e.item.extId){RB(t.item,e.item);return}}break}}this.diff.push(e),this.debounceSendDiff.isScheduled()||this.debounceSendDiff.schedule()}expand(e,t){const i=this.tree.get(e);if(i){if((i.expandLevels===void 0||t>i.expandLevels)&&(i.expandLevels=t),i.expand===Js.Expandable){const n=this.resolveChildren(i);return n.isOpen()?this.expandChildren(i,t-1):n.wait().then(()=>this.expandChildren(i,t-1))}else if(i.expand===Js.Expanded)return i.resolveBarrier?.isOpen()===!1?i.resolveBarrier.wait().then(()=>this.expandChildren(i,t-1)):this.expandChildren(i,t-1)}}dispose(){for(const e of this.tree.values())this.options.getApiFor(e.actual).listener=void 0;this.tree.clear(),this.diff=[],super.dispose()}onTestItemEvent(e,t){switch(t.op){case Yr.RemoveChild:this.removeItem(Ln.joinToString(e.fullId,t.id));break;case Yr.Upsert:this.upsertItem(t.item,e);break;case Yr.Bulk:for(const i of t.ops)this.onTestItemEvent(e,i);break;case Yr.SetTags:this.diffTagRefs(t.new,t.old,e.fullId.toString());break;case Yr.UpdateCanResolveChildren:this.updateExpandability(e);break;case Yr.SetProp:this.pushDiff({op:bn.Update,item:{extId:e.fullId.toString(),item:t.update}});break;case Yr.DocumentSynced:this.documentSynced(e.actual.uri);break;default:ad()}}documentSynced(e){e&&this.pushDiff({op:bn.DocumentSynced,uri:e,docv:this.options.getDocumentVersion(e)})}upsertItem(e,t){const i=Ln.fromExtHostTestItem(e,this.root.id,t?.actual),n=this.options.getApiFor(e);n.parent&&n.parent!==t?.actual&&this.options.getChildren(n.parent).delete(e.id);let o=this.tree.get(i.toString());if(!o){o={fullId:i,actual:e,expandLevels:t?.expandLevels?t.expandLevels-1:void 0,expand:Js.NotExpandable},e.tags.forEach(this.incrementTagRefs,this),this.tree.set(o.fullId.toString(),o),this.setItemParent(e,t),this.pushDiff({op:bn.Add,item:{controllerId:this.options.controllerId,expand:o.expand,item:this.options.toITestItem(e)}}),this.connectItemAndChildren(e,o,t);return}if(o.actual===e){this.connectItem(e,o,t);return}if(o.actual.uri?.toString()!==e.uri?.toString())return this.removeItem(i.toString()),this.upsertItem(e,t);const r=this.options.getChildren(o.actual),a=o.actual,c=yTe(this.options.toITestItem(a),this.options.toITestItem(e));this.options.getApiFor(a).listener=void 0,o.actual=e,o.resolveBarrier=void 0,o.expand=Js.NotExpandable,c&&(c.hasOwnProperty("tags")&&(this.diffTagRefs(e.tags,a.tags,i.toString()),delete c.tags),this.onTestItemEvent(o,{op:Yr.SetProp,update:c})),this.connectItemAndChildren(e,o,t);for(const[l,u]of r)this.options.getChildren(e).get(u.id)||this.removeItem(Ln.joinToString(i,u.id));const d=o.expandLevels;d!==void 0&&queueMicrotask(()=>{o.expand===Js.Expandable&&(o.expandLevels=void 0,this.expand(i.toString(),d))}),this.documentSynced(o.actual.uri)}diffTagRefs(e,t,i){const n=new Set(t.map(o=>o.id));for(const o of e)n.delete(o.id)||this.incrementTagRefs(o);this.pushDiff({op:bn.Update,item:{extId:i,item:{tags:e.map(o=>Uk(this.options.controllerId,o.id))}}}),n.forEach(this.decrementTagRefs,this)}incrementTagRefs(e){const t=this.tags.get(e.id);t?t.refCount++:(this.tags.set(e.id,{refCount:1}),this.pushDiff({op:bn.AddTag,tag:{id:Uk(this.options.controllerId,e.id)}}))}decrementTagRefs(e){const t=this.tags.get(e);t&&!--t.refCount&&(this.tags.delete(e),this.pushDiff({op:bn.RemoveTag,id:Uk(this.options.controllerId,e)}))}setItemParent(e,t){this.options.getApiFor(e).parent=t&&t.actual!==this.root?t.actual:void 0}connectItem(e,t,i){this.setItemParent(e,i);const n=this.options.getApiFor(e);n.parent=i?.actual,n.listener=o=>this.onTestItemEvent(t,o),this.updateExpandability(t)}connectItemAndChildren(e,t,i){this.connectItem(e,t,i);for(const[n,o]of this.options.getChildren(e))this.upsertItem(o,t)}updateExpandability(e){let t;this._resolveHandler?e.resolveBarrier?t=e.resolveBarrier.isOpen()?Js.Expanded:Js.BusyExpanding:t=e.actual.canResolveChildren?Js.Expandable:Js.NotExpandable:t=Js.NotExpandable,t!==e.expand&&(e.expand=t,this.pushDiff({op:bn.Update,item:{extId:e.fullId.toString(),expand:t}}),t===Js.Expandable&&e.expandLevels!==void 0&&this.resolveChildren(e))}expandChildren(e,t){if(t<0)return;const i=[];for(const[n,o]of this.options.getChildren(e.actual)){const r=this.expand(Ln.joinToString(e.fullId,o.id),t);NT(r)&&i.push(r)}if(i.length)return Promise.all(i).then(()=>{})}resolveChildren(e){if(e.resolveBarrier)return e.resolveBarrier;if(!this._resolveHandler){const o=new Np;return o.open(),o}e.expand=Js.BusyExpanding,this.pushExpandStateUpdate(e);const t=e.resolveBarrier=new Np,i=o=>{console.error(`Unhandled error in resolveHandler of test controller "${this.options.controllerId}"`,o)};let n;try{n=this._resolveHandler(e.actual===this.root?void 0:e.actual)}catch(o){i(o)}return NT(n)?n.catch(i).then(()=>{t.open(),this.updateExpandability(e)}):(t.open(),this.updateExpandability(e)),e.resolveBarrier}pushExpandStateUpdate(e){this.pushDiff({op:bn.Update,item:{extId:e.fullId.toString(),expand:e.expand}})}removeItem(e){const t=this.tree.get(e);if(!t)throw new Error("attempting to remove non-existent child");this.pushDiff({op:bn.Remove,itemId:e});const i=[t];for(;i.length;){const n=i.pop();if(n){this.options.getApiFor(n.actual).listener=void 0;for(const o of n.actual.tags)this.decrementTagRefs(o.id);this.tree.delete(n.fullId.toString());for(const[o,r]of this.options.getChildren(n.actual))i.push(this.tree.get(Ln.joinToString(n.fullId,r.id)))}}}flushDiff(){const e=this.collectDiff();e.length&&this.diffOpEmitter.fire(e)}}class wTe extends Error{constructor(e){super(`Attempted to insert a duplicate test item ID ${e}`)}}class NB extends Error{constructor(e){super(`TestItem with ID "${e}" is invalid. Make sure to create it from the createTestItem method.`)}}class STe extends Error{constructor(e,t,i){super(`TestItem with ID "${e}" is from controller "${t}" and cannot be added as a child of an item from controller "${i}".`)}}const P9e=(s,e,t)=>{let i=new Map;return{get size(){return i.size},forEach(n,o){for(const r of i.values())n.call(o,r,this)},[Symbol.iterator](){return i.entries()},replace(n){const o=new Map,r=new Set(i.keys()),a={op:Yr.Bulk,ops:[]};for(const c of n){if(!(c instanceof t))throw new NB(c.id);const d=e(c).controllerId;if(d!==s.controllerId)throw new STe(c.id,d,s.controllerId);if(o.has(c.id))throw new wTe(c.id);o.set(c.id,c),r.delete(c.id),a.ops.push({op:Yr.Upsert,item:c})}for(const c of r.keys())a.ops.push({op:Yr.RemoveChild,id:c});s.listener?.(a),i=o},add(n){if(!(n instanceof t))throw new NB(n.id);i.set(n.id,n),s.listener?.({op:Yr.Upsert,item:n})},delete(n){i.delete(n)&&s.listener?.({op:Yr.RemoveChild,id:n})},get(n){return i.get(n)},toJSON(){return Array.from(i.values())}}},vce=new WeakMap,L9e=(s,e)=>{const t={controllerId:e};return vce.set(s,t),t},CTe=s=>{const e=vce.get(s);if(!e)throw new NB(s?.id||"<unknown>");return e};var ep;(function(s){s[s.EMBEDDED=1]="EMBEDDED",s[s.LLM_RANKED=2]="LLM_RANKED",s[s.CANCELED=3]="CANCELED"})(ep||(ep={}));var Gj;(function(s){s.LATEST_PROTOCOL_VERSION="2025-03-26",s.JSONRPC_VERSION="2.0",s.PARSE_ERROR=-32700,s.INVALID_REQUEST=-32600,s.METHOD_NOT_FOUND=-32601,s.INVALID_PARAMS=-32602,s.INTERNAL_ERROR=-32603})(Gj||(Gj={}));function M9e(s,e){return Es.toKey(s)+"/"+e}var qj;(function(s){s[s.WorkspaceFolder=0]="WorkspaceFolder",s[s.Workspace=100]="Workspace",s[s.User=200]="User",s[s.Extension=300]="Extension",s[s.Filesystem=400]="Filesystem",s[s.RemoteBoost=-50]="RemoteBoost"})(qj||(qj={}));var zj;(function(s){function e(t,i){return t.id===i.id&&t.remoteAuthority===i.remoteAuthority&&t.label===i.label&&t.isTrustedByDefault===i.isTrustedByDefault}s.equals=e})(zj||(zj={}));var OB;(function(s){function e(n){return n}s.toSerialized=e;function t(n){return{id:n.id,label:n.label,cacheNonce:n.cacheNonce,launch:nx.fromSerialized(n.launch),variableReplacement:n.variableReplacement?FB.fromSerialized(n.variableReplacement):void 0}}s.fromSerialized=t;function i(n,o){return n.id===o.id&&n.label===o.label&&ns(n.roots,o.roots,(r,a)=>r.toString()===a.toString())&&ma(n.launch,o.launch)&&ma(n.presentation,o.presentation)&&ma(n.variableReplacement,o.variableReplacement)&&ma(n.devMode,o.devMode)}s.equals=i})(OB||(OB={}));var FB;(function(s){function e(i){return i}s.toSerialized=e;function t(i){return{section:i.section,folder:i.folder?{...i.folder,uri:R.revive(i.folder.uri)}:void 0,target:i.target}}s.fromSerialized=t})(FB||(FB={}));var Kj;(function(s){s[s.HasUnknown=0]="HasUnknown",s[s.LoadingUnknown=1]="LoadingUnknown",s[s.AllKnown=2]="AllKnown"})(Kj||(Kj={}));var jj;(function(s){s[s.Unknown=0]="Unknown",s[s.Cached=1]="Cached",s[s.Outdated=2]="Outdated",s[s.RefreshingFromUnknown=3]="RefreshingFromUnknown",s[s.RefreshingFromCached=4]="RefreshingFromCached",s[s.Live=5]="Live"})(jj||(jj={}));var cv;(function(s){s[s.Stdio=1]="Stdio",s[s.HTTP=2]="HTTP"})(cv||(cv={}));var nx;(function(s){function e(i){return i}s.toSerialized=e;function t(i){switch(i.type){case cv.HTTP:return{type:i.type,uri:R.revive(i.uri),headers:i.headers};case cv.Stdio:return{type:i.type,cwd:i.cwd,command:i.command,args:i.args,env:i.env,envFile:i.envFile}}}s.fromSerialized=t})(nx||(nx={}));var hm;(function(s){let e;(function(t){t[t.Stopped=0]="Stopped",t[t.Starting=1]="Starting",t[t.Running=2]="Running",t[t.Error=3]="Error"})(e=s.Kind||(s.Kind={})),s.toString=t=>{switch(t.state){case e.Stopped:return h(7986,"Stopped");case e.Starting:return h(7987,"Starting");case e.Running:return h(7988,"Running");case e.Error:return h(7989,"Error {0}",t.message);default:ad()}},s.toKindString=t=>{switch(t){case e.Stopped:return"stopped";case e.Starting:return"starting";case e.Running:return"running";case e.Error:return"error";default:ad()}},s.canBeStarted=t=>t===e.Error||t===e.Stopped,s.isRunning=t=>!s.canBeStarted(t.state)})(hm||(hm={}));let Yj=class extends F{constructor(e,t){super(),this.containers=e,this._register(t.onChange(this.update,this))}set mcpServer(e){this.containers.forEach(t=>t.mcpServer=e)}update(e){for(const t of this.containers)e&&t.mcpServer?e.name===t.mcpServer.name&&(t.mcpServer=e):t.update()}};Yj=f([p(1,bae)],Yj);new O("mcpServersGalleryEnabled",!1);new O("hasInstalledMcpServers",!1);Ae("mcp-server",j.mcp,h(7990,"Icon used for the MCP server."));var Qj;(function(s){s.scheme="mcp-resource";function e(i,n){return typeof n=="string"&&(n=R.parse(n)),n.with({scheme:s.scheme,authority:Ome(Re.fromString(i.id)),path:["",n.scheme,n.authority].join("/")+n.path})}s.fromServer=e;function t(i){if(typeof i=="string"&&(i=R.parse(i)),i.scheme!==s.scheme)throw new Error(`Invalid MCP resource URI: ${i.toString()}`);const n=i.path.split("/");if(n.length<3)throw new Error(`Invalid MCP resource URI: ${i.toString()}`);const[,o,r,...a]=n;return{definitionId:Fme(i.authority).toString(),resourceURI:i.with({scheme:o,authority:r,path:"/"+a.join("/")})}}s.toServer=t})(Qj||(Qj={}));var Xj;(function(s){s[s.Logging=1]="Logging",s[s.Completions=2]="Completions",s[s.Prompts=4]="Prompts",s[s.PromptsListChanged=8]="PromptsListChanged",s[s.Resources=16]="Resources",s[s.ResourcesSubscribe=32]="ResourcesSubscribe",s[s.ResourcesListChanged=64]="ResourcesListChanged",s[s.Tools=128]="Tools",s[s.ToolsListChanged=256]="ToolsListChanged"})(Xj||(Xj={}));var Zj;(function(s){s.Prefix="mcp_",s[s.MaxPrefixLen=18]="MaxPrefixLen",s[s.MaxLength=64]="MaxLength"})(Zj||(Zj={}));var Jj;(function(s){function e(i){const{selectionStartLineNumber:n,selectionStartColumn:o,positionLineNumber:r,positionColumn:a}=i,c=new en(n-1,o-1),d=new en(r-1,a-1);return new dW(c,d)}s.to=e;function t(i){const{anchor:n,active:o}=i;return{selectionStartLineNumber:n.line+1,selectionStartColumn:n.character+1,positionLineNumber:o.line+1,positionColumn:o.character+1}}s.from=t})(Jj||(Jj={}));var rt;(function(s){function e(i){if(!i)return;const{start:n,end:o}=i;return{startLineNumber:n.line+1,startColumn:n.character+1,endLineNumber:o.line+1,endColumn:o.character+1}}s.from=e;function t(i){if(!i)return;const{startLineNumber:n,startColumn:o,endLineNumber:r,endColumn:a}=i;return new ls(n-1,o-1,r-1,a-1)}s.to=t})(rt||(rt={}));var bh;(function(s){function e(i){return{uri:i.uri,range:rt.from(i.range)}}s.from=e;function t(i){return new tv(R.revive(i.uri),rt.to(i.range))}s.to=t})(bh||(bh={}));var eY;(function(s){function e(t){switch(t){case Xc.Comment:return tb.Comment;case Xc.Other:return tb.Other;case Xc.RegEx:return tb.RegEx;case Xc.String:return tb.String}}s.to=e})(eY||(eY={}));var Dy;(function(s){function e(i){return new en(i.lineNumber-1,i.column-1)}s.to=e;function t(i){return{lineNumber:i.line+1,column:i.character+1}}s.from=t})(Dy||(Dy={}));var tY;(function(s){function e(n,o,r){return Vt(cw(n).map(a=>t(a,o,r)))}s.from=e;function t(n,o,r){if(typeof n=="string")return{$serialized:!0,language:n,isBuiltin:r?.isBuiltin};if(n)return{$serialized:!0,language:n.language,scheme:i(n.scheme,o),pattern:th.from(n.pattern)??void 0,exclusive:n.exclusive,notebookType:n.notebookType,isBuiltin:r?.isBuiltin}}function i(n,o){return o&&typeof n=="string"?o.transformOutgoingScheme(n):n}})(tY||(tY={}));var YA;(function(s){function e(i){switch(i){case X_.Unnecessary:return PD.Unnecessary;case X_.Deprecated:return PD.Deprecated}}s.from=e;function t(i){switch(i){case PD.Unnecessary:return X_.Unnecessary;case PD.Deprecated:return X_.Deprecated;default:return}}s.to=t})(YA||(YA={}));var iY;(function(s){function e(i){let n;return i.code&&(It(i.code)||Ja(i.code)?n=String(i.code):n={value:String(i.code.value),target:i.code.target}),{...rt.from(i.range),message:i.message,source:i.source,code:n,severity:sx.from(i.severity),relatedInformation:i.relatedInformation&&i.relatedInformation.map(QA.from),tags:Array.isArray(i.tags)?Vt(i.tags.map(YA.from)):void 0}}s.from=e;function t(i){const n=new hW(rt.to(i),i.message,sx.to(i.severity));return n.source=i.source,n.code=It(i.code)?i.code:i.code?.value,n.relatedInformation=i.relatedInformation&&i.relatedInformation.map(QA.to),n.tags=i.tags&&Vt(i.tags.map(YA.to)),n}s.to=t})(iY||(iY={}));var QA;(function(s){function e(i){return{...rt.from(i.location.range),message:i.message,resource:i.location.uri}}s.from=e;function t(i){return new uA(new tv(i.resource,rt.to(i)),i.message)}s.to=t})(QA||(QA={}));var sx;(function(s){function e(i){switch(i){case Ga.Error:return Mn.Error;case Ga.Warning:return Mn.Warning;case Ga.Information:return Mn.Info;case Ga.Hint:return Mn.Hint}return Mn.Error}s.from=e;function t(i){switch(i){case Mn.Info:return Ga.Information;case Mn.Warning:return Ga.Warning;case Mn.Error:return Ga.Error;case Mn.Hint:return Ga.Hint;default:return Ga.Error}}s.to=t})(sx||(sx={}));var nY;(function(s){function e(i){return typeof i=="number"&&i>=vA.One?i-1:i===vA.Beside?xr:cl}s.from=e;function t(i){if(typeof i=="number"&&i>=0)return i+1;throw new Error("invalid 'EditorGroupColumn'")}s.to=t})(nY||(nY={}));function ETe(s){return typeof s.range<"u"}function xTe(s){return s.length===0?!0:!!ETe(s[0])}var Tn;(function(s){function e(a){return a.map(s.from)}s.fromMany=e;function t(a){return a&&typeof a=="object"&&typeof a.language=="string"&&typeof a.value=="string"}function i(a){let c;if(t(a)){const{language:u,value:g}=a;c={value:"```"+u+`
`+g+"\n```\n"}}else qp.isMarkdownString(a)?c={value:a.value,isTrusted:a.isTrusted,supportThemeIcons:a.supportThemeIcons,supportHtml:a.supportHtml,baseUri:a.baseUri}:typeof a=="string"?c={value:a}:c={value:""};const d=Object.create(null);c.uris=d;const l=({href:u})=>{try{let g=R.parse(u,!0);g=g.with({query:n(g.query,d)}),d[u]=g}catch{}return""};return _7.walkTokens(_7.lexer(c.value),u=>{u.type==="link"?l({href:u.href}):u.type==="image"&&typeof u.href=="string"&&l(Wme(u.href))}),c}s.from=i;function n(a,c){if(!a)return a;let d;try{d=Gie(a)}catch{}if(!d)return a;let l=!1;return d=wF(d,u=>{if(R.isUri(u)){const g=`__uri_${Math.random().toString(16).slice(2,8)}`;return c[g]=u,l=!0,g}else return}),l?JSON.stringify(d):a}function o(a){const c=new qp(a.value,a.supportThemeIcons);return c.isTrusted=a.isTrusted,c.supportHtml=a.supportHtml,c.baseUri=a.baseUri?R.from(a.baseUri):void 0,c}s.to=o;function r(a){if(a)return typeof a=="string"?a:s.from(a)}s.fromStrict=r})(Tn||(Tn={}));function O9e(s){return xTe(s)?s.map(e=>({range:rt.from(e.range),hoverMessage:Array.isArray(e.hoverMessage)?Tn.fromMany(e.hoverMessage):e.hoverMessage?Tn.from(e.hoverMessage):void 0,renderOptions:e.renderOptions})):s.map(e=>({range:rt.from(e)}))}function DK(s){return typeof s>"u"?s:typeof s=="string"?R.file(s):s}var ky;(function(s){function e(t){return typeof t>"u"?t:{contentText:t.contentText,contentIconPath:t.contentIconPath?DK(t.contentIconPath):void 0,border:t.border,borderColor:t.borderColor,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,color:t.color,backgroundColor:t.backgroundColor,margin:t.margin,width:t.width,height:t.height}}s.from=e})(ky||(ky={}));var XA;(function(s){function e(t){return typeof t>"u"?t:{backgroundColor:t.backgroundColor,outline:t.outline,outlineColor:t.outlineColor,outlineStyle:t.outlineStyle,outlineWidth:t.outlineWidth,border:t.border,borderColor:t.borderColor,borderRadius:t.borderRadius,borderSpacing:t.borderSpacing,borderStyle:t.borderStyle,borderWidth:t.borderWidth,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,cursor:t.cursor,color:t.color,opacity:t.opacity,letterSpacing:t.letterSpacing,gutterIconPath:t.gutterIconPath?DK(t.gutterIconPath):void 0,gutterIconSize:t.gutterIconSize,overviewRulerColor:t.overviewRulerColor,before:t.before?ky.from(t.before):void 0,after:t.after?ky.from(t.after):void 0}}s.from=e})(XA||(XA={}));var WB;(function(s){function e(t){if(typeof t>"u")return t;switch(t){case J_.OpenOpen:return Di.AlwaysGrowsWhenTypingAtEdges;case J_.ClosedClosed:return Di.NeverGrowsWhenTypingAtEdges;case J_.OpenClosed:return Di.GrowsOnlyWhenTypingBefore;case J_.ClosedOpen:return Di.GrowsOnlyWhenTypingAfter}}s.from=e})(WB||(WB={}));var sY;(function(s){function e(t){return{isWholeLine:t.isWholeLine,rangeBehavior:t.rangeBehavior?WB.from(t.rangeBehavior):void 0,overviewRulerLane:t.overviewRulerLane,light:t.light?XA.from(t.light):void 0,dark:t.dark?XA.from(t.dark):void 0,backgroundColor:t.backgroundColor,outline:t.outline,outlineColor:t.outlineColor,outlineStyle:t.outlineStyle,outlineWidth:t.outlineWidth,border:t.border,borderColor:t.borderColor,borderRadius:t.borderRadius,borderSpacing:t.borderSpacing,borderStyle:t.borderStyle,borderWidth:t.borderWidth,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,cursor:t.cursor,color:t.color,opacity:t.opacity,letterSpacing:t.letterSpacing,gutterIconPath:t.gutterIconPath?DK(t.gutterIconPath):void 0,gutterIconSize:t.gutterIconSize,overviewRulerColor:t.overviewRulerColor,before:t.before?ky.from(t.before):void 0,after:t.after?ky.from(t.after):void 0}}s.from=e})(sY||(sY={}));var tl;(function(s){function e(i){return{text:i.newText,eol:i.newEol&&nR.from(i.newEol),range:rt.from(i.range)}}s.from=e;function t(i){const n=new gy(rt.to(i.range),i.text);return n.newEol=typeof i.eol>"u"?void 0:nR.to(i.eol),n}s.to=t})(tl||(tl={}));var oY;(function(s){function e(i,n){const o={edits:[]};if(i instanceof hA){const r=new Fp;for(const a of i._allEntries())a._type===Zn.File&&R.isUri(a.to)&&a.from===void 0&&r.add(a.to);for(const a of i._allEntries())if(a._type===Zn.File){let c;a.options?.contents&&(ArrayBuffer.isView(a.options.contents)?c={type:"base64",value:Xx(Re.wrap(a.options.contents))}:c={type:"dataTransferItem",id:a.options.contents._itemId}),o.edits.push({oldResource:a.from,newResource:a.to,options:{...a.options,contents:c},metadata:a.metadata})}else a._type===Zn.Text?o.edits.push({resource:a.uri,textEdit:tl.from(a.edit),versionId:r.has(a.uri)?void 0:n?.getTextDocumentVersion(a.uri),metadata:a.metadata}):a._type===Zn.Snippet?o.edits.push({resource:a.uri,textEdit:{range:rt.from(a.range),text:a.edit.value,insertAsSnippet:!0,keepWhitespace:a.keepWhitespace},versionId:r.has(a.uri)?void 0:n?.getTextDocumentVersion(a.uri),metadata:a.metadata}):a._type===Zn.Cell?o.edits.push({metadata:a.metadata,resource:a.uri,cellEdit:a.edit,notebookVersionId:n?.getNotebookDocumentVersion(a.uri)}):a._type===Zn.CellReplace&&o.edits.push({metadata:a.metadata,resource:a.uri,notebookVersionId:n?.getNotebookDocumentVersion(a.uri),cellEdit:{editType:al.Replace,index:a.index,count:a.count,cells:a.cells.map(Ay.from)}})}return o}s.from=e;function t(i){const n=new hA,o=new wn;for(const r of i.edits)if(r.textEdit){const a=r,c=R.revive(a.resource),d=rt.to(a.textEdit.range),l=a.textEdit.text,u=a.textEdit.insertAsSnippet;let g;u?g=Mb.replace(d,new OE(l)):g=gy.replace(d,l);const m=o.get(c);m?m.push(g):o.set(c,[g])}else n.renameFile(R.revive(r.oldResource),R.revive(r.newResource),r.options);for(const[r,a]of o)n.set(r,a);return n}s.to=t})(oY||(oY={}));var Ah;(function(s){const e=Object.create(null);e[on.File]=Et.File,e[on.Module]=Et.Module,e[on.Namespace]=Et.Namespace,e[on.Package]=Et.Package,e[on.Class]=Et.Class,e[on.Method]=Et.Method,e[on.Property]=Et.Property,e[on.Field]=Et.Field,e[on.Constructor]=Et.Constructor,e[on.Enum]=Et.Enum,e[on.Interface]=Et.Interface,e[on.Function]=Et.Function,e[on.Variable]=Et.Variable,e[on.Constant]=Et.Constant,e[on.String]=Et.String,e[on.Number]=Et.Number,e[on.Boolean]=Et.Boolean,e[on.Array]=Et.Array,e[on.Object]=Et.Object,e[on.Key]=Et.Key,e[on.Null]=Et.Null,e[on.EnumMember]=Et.EnumMember,e[on.Struct]=Et.Struct,e[on.Event]=Et.Event,e[on.Operator]=Et.Operator,e[on.TypeParameter]=Et.TypeParameter;function t(n){return typeof e[n]=="number"?e[n]:Et.Property}s.from=t;function i(n){for(const o in e)if(e[o]===n)return Number(o);return on.Property}s.to=i})(Ah||(Ah={}));var jp;(function(s){function e(i){switch(i){case pA.Deprecated:return yF.Deprecated}}s.from=e;function t(i){switch(i){case yF.Deprecated:return pA.Deprecated}}s.to=t})(jp||(jp={}));var ZA;(function(s){function e(i){return{name:i.name,kind:Ah.from(i.kind),tags:i.tags&&i.tags.map(jp.from),containerName:i.containerName,location:Ty.from(i.location)}}s.from=e;function t(i){const n=new mW(i.name,Ah.to(i.kind),i.containerName,Ty.to(i.location));return n.tags=i.tags&&i.tags.map(jp.to),n}s.to=t})(ZA||(ZA={}));var rY;(function(s){function e(i){const n={name:i.name||"!!MISSING: name!!",detail:i.detail,range:rt.from(i.range),selectionRange:rt.from(i.selectionRange),kind:Ah.from(i.kind),tags:i.tags?.map(jp.from)??[]};return i.children&&(n.children=i.children.map(e)),n}s.from=e;function t(i){const n=new vW(i.name,i.detail,Ah.to(i.kind),rt.to(i.range),rt.to(i.selectionRange));return xn(i.tags)&&(n.tags=i.tags.map(jp.to)),i.children&&(n.children=i.children.map(t)),n}s.to=t})(rY||(rY={}));var JA;(function(s){function e(i){const n=new aEe(Ah.to(i.kind),i.name,i.detail||"",R.revive(i.uri),rt.to(i.range),rt.to(i.selectionRange));return n._sessionId=i._sessionId,n._itemId=i._itemId,n}s.to=e;function t(i,n,o){if(n=n??i._sessionId,o=o??i._itemId,n===void 0||o===void 0)throw new Error("invalid item");return{_sessionId:n,_itemId:o,name:i.name,detail:i.detail,kind:Ah.from(i.kind),uri:i.uri,range:rt.from(i.range),selectionRange:rt.from(i.selectionRange),tags:i.tags?.map(jp.from)}}s.from=t})(JA||(JA={}));var aY;(function(s){function e(t){return new cEe(JA.to(t.from),t.fromRanges.map(i=>rt.to(i)))}s.to=e})(aY||(aY={}));var cY;(function(s){function e(t){return new dEe(JA.to(t.to),t.fromRanges.map(i=>rt.to(i)))}s.to=e})(cY||(cY={}));var Ty;(function(s){function e(i){return{range:i.range&&rt.from(i.range),uri:i.uri}}s.from=e;function t(i){return new tv(R.revive(i.uri),rt.to(i.range))}s.to=t})(Ty||(Ty={}));var dY;(function(s){function e(i){const n=i,o=i;return{originSelectionRange:n.originSelectionRange?rt.from(n.originSelectionRange):void 0,uri:n.targetUri?n.targetUri:o.uri,range:rt.from(n.targetRange?n.targetRange:o.range),targetSelectionRange:n.targetSelectionRange?rt.from(n.targetSelectionRange):void 0}}s.from=e;function t(i){return{targetUri:R.revive(i.uri),targetRange:rt.to(i.range),targetSelectionRange:i.targetSelectionRange?rt.to(i.targetSelectionRange):void 0,originSelectionRange:i.originSelectionRange?rt.to(i.originSelectionRange):void 0}}s.to=t})(dY||(dY={}));var lY;(function(s){function e(i){return{range:rt.from(i.range),contents:Tn.fromMany(i.contents),canIncreaseVerbosity:i.canIncreaseVerbosity,canDecreaseVerbosity:i.canDecreaseVerbosity}}s.from=e;function t(i){const n=i.contents.map(Tn.to),o=rt.to(i.range),r=i.canIncreaseVerbosity,a=i.canDecreaseVerbosity;return new gW(n,o,r,a)}s.to=t})(lY||(lY={}));var hY;(function(s){function e(i){return{range:rt.from(i.range),expression:i.expression}}s.from=e;function t(i){return new TW(rt.to(i.range),i.expression)}s.to=t})(hY||(hY={}));var uY;(function(s){function e(i){if(i instanceof AW)return{type:"text",range:rt.from(i.range),text:i.text};if(i instanceof RW)return{type:"variable",range:rt.from(i.range),variableName:i.variableName,caseSensitiveLookup:i.caseSensitiveLookup};if(i instanceof PW)return{type:"expression",range:rt.from(i.range),expression:i.expression};throw new Error("Unknown 'InlineValue' type")}s.from=e;function t(i){switch(i.type){case"text":return{range:rt.to(i.range),text:i.text};case"variable":return{range:rt.to(i.range),variableName:i.variableName,caseSensitiveLookup:i.caseSensitiveLookup};case"expression":return{range:rt.to(i.range),expression:i.expression}}}s.to=t})(uY||(uY={}));var gY;(function(s){function e(i){return{frameId:i.frameId,stoppedLocation:rt.from(i.stoppedLocation)}}s.from=e;function t(i){return new LW(i.frameId,rt.to(i.stoppedLocation))}s.to=t})(gY||(gY={}));var eR;(function(s){function e(i){return{range:rt.from(i.range),kind:i.kind}}s.from=e;function t(i){return new pW(rt.to(i.range),i.kind)}s.to=t})(eR||(eR={}));var pY;(function(s){function e(i){return{uri:i.uri,highlights:i.highlights.map(eR.from)}}s.from=e;function t(i){return new fW(R.revive(i.uri),i.highlights.map(eR.to))}s.to=t})(pY||(pY={}));var BB;(function(s){function e(t){switch(t){case _a.TriggerCharacter:return SC.TriggerCharacter;case _a.TriggerForIncompleteCompletions:return SC.TriggerForIncompleteCompletions;case _a.Invoke:default:return SC.Invoke}}s.to=e})(BB||(BB={}));var fY;(function(s){function e(t){return{triggerKind:BB.to(t.triggerKind),triggerCharacter:t.triggerCharacter}}s.to=e})(fY||(fY={}));var VB;(function(s){function e(i){switch(i){case mA.Deprecated:return OT.Deprecated}}s.from=e;function t(i){switch(i){case OT.Deprecated:return mA.Deprecated}}s.to=t})(VB||(VB={}));var HB;(function(s){const e=new Map([[_t.Method,De.Method],[_t.Function,De.Function],[_t.Constructor,De.Constructor],[_t.Field,De.Field],[_t.Variable,De.Variable],[_t.Class,De.Class],[_t.Interface,De.Interface],[_t.Struct,De.Struct],[_t.Module,De.Module],[_t.Property,De.Property],[_t.Unit,De.Unit],[_t.Value,De.Value],[_t.Constant,De.Constant],[_t.Enum,De.Enum],[_t.EnumMember,De.EnumMember],[_t.Keyword,De.Keyword],[_t.Snippet,De.Snippet],[_t.Text,De.Text],[_t.Color,De.Color],[_t.File,De.File],[_t.Reference,De.Reference],[_t.Folder,De.Folder],[_t.Event,De.Event],[_t.Operator,De.Operator],[_t.TypeParameter,De.TypeParameter],[_t.Issue,De.Issue],[_t.User,De.User]]);function t(o){return e.get(o)??De.Property}s.from=t;const i=new Map([[De.Method,_t.Method],[De.Function,_t.Function],[De.Constructor,_t.Constructor],[De.Field,_t.Field],[De.Variable,_t.Variable],[De.Class,_t.Class],[De.Interface,_t.Interface],[De.Struct,_t.Struct],[De.Module,_t.Module],[De.Property,_t.Property],[De.Unit,_t.Unit],[De.Value,_t.Value],[De.Constant,_t.Constant],[De.Enum,_t.Enum],[De.EnumMember,_t.EnumMember],[De.Keyword,_t.Keyword],[De.Snippet,_t.Snippet],[De.Text,_t.Text],[De.Color,_t.Color],[De.File,_t.File],[De.Reference,_t.Reference],[De.Folder,_t.Folder],[De.Event,_t.Event],[De.Operator,_t.Operator],[De.TypeParameter,_t.TypeParameter],[De.User,_t.User],[De.Issue,_t.Issue]]);function n(o){return i.get(o)??_t.Property}s.to=n})(HB||(HB={}));var mY;(function(s){function e(t,i){const n=new wW(t.label);return n.insertText=t.insertText,n.kind=HB.to(t.kind),n.tags=t.tags?.map(VB.to),n.detail=t.detail,n.documentation=ec(t.documentation)?Tn.to(t.documentation):t.documentation,n.sortText=t.sortText,n.filterText=t.filterText,n.preselect=t.preselect,n.commitCharacters=t.commitCharacters,P.isIRange(t.range)?n.range=rt.to(t.range):typeof t.range=="object"&&(n.range={inserting:rt.to(t.range.insert),replacing:rt.to(t.range.replace)}),n.keepWhitespace=typeof t.insertTextRules>"u"?!1:!!(t.insertTextRules&dh.KeepWhitespace),typeof t.insertTextRules<"u"&&t.insertTextRules&dh.InsertAsSnippet?n.insertText=new OE(t.insertText):(n.insertText=t.insertText,n.textEdit=n.range instanceof ls?new gy(n.range,n.insertText):void 0),t.additionalTextEdits&&t.additionalTextEdits.length>0&&(n.additionalTextEdits=t.additionalTextEdits.map(o=>tl.to(o))),n.command=i&&t.command?i.fromInternal(t.command):void 0,n}s.to=e})(mY||(mY={}));var tR;(function(s){function e(i){if(typeof i.label!="string"&&!Array.isArray(i.label))throw new TypeError("Invalid label");return{label:i.label,documentation:Tn.fromStrict(i.documentation)}}s.from=e;function t(i){return{label:i.label,documentation:ec(i.documentation)?Tn.to(i.documentation):i.documentation}}s.to=t})(tR||(tR={}));var iR;(function(s){function e(i){return{label:i.label,documentation:Tn.fromStrict(i.documentation),parameters:Array.isArray(i.parameters)?i.parameters.map(tR.from):[],activeParameter:i.activeParameter}}s.from=e;function t(i){return{label:i.label,documentation:ec(i.documentation)?Tn.to(i.documentation):i.documentation,parameters:Array.isArray(i.parameters)?i.parameters.map(tR.to):[],activeParameter:i.activeParameter}}s.to=t})(iR||(iR={}));var vY;(function(s){function e(i){return{activeSignature:i.activeSignature,activeParameter:i.activeParameter,signatures:Array.isArray(i.signatures)?i.signatures.map(iR.from):[]}}s.from=e;function t(i){return{activeSignature:i.activeSignature,activeParameter:i.activeParameter,signatures:Array.isArray(i.signatures)?i.signatures.map(iR.to):[]}}s.to=t})(vY||(vY={}));var _Y;(function(s){function e(t,i){const n=new yW(Dy.to(i.position),typeof i.label=="string"?i.label:i.label.map(UB.to.bind(void 0,t)),i.kind&&$B.to(i.kind));return n.textEdits=i.textEdits&&i.textEdits.map(tl.to),n.tooltip=ec(i.tooltip)?Tn.to(i.tooltip):i.tooltip,n.paddingLeft=i.paddingLeft,n.paddingRight=i.paddingRight,n}s.to=e})(_Y||(_Y={}));var UB;(function(s){function e(t,i){const n=new bW(i.label);return n.tooltip=ec(i.tooltip)?Tn.to(i.tooltip):i.tooltip,Oie.is(i.command)&&(n.command=t.fromInternal(i.command)),i.location&&(n.location=Ty.to(i.location)),n}s.to=e})(UB||(UB={}));var $B;(function(s){function e(i){return i}s.from=e;function t(i){return i}s.to=t})($B||($B={}));var bY;(function(s){function e(i){return{range:rt.from(i.range),url:i.target,tooltip:i.tooltip}}s.from=e;function t(i){let n;if(i.url)try{n=typeof i.url=="string"?R.parse(i.url,!0):R.revive(i.url)}catch{}const o=new SW(rt.to(i.range),n);return o.tooltip=i.tooltip,o}s.to=t})(bY||(bY={}));var yY;(function(s){function e(i){const n=new CW(i.label);return i.textEdit&&(n.textEdit=tl.to(i.textEdit)),i.additionalTextEdits&&(n.additionalTextEdits=i.additionalTextEdits.map(o=>tl.to(o))),n}s.to=e;function t(i){return{label:i.label,textEdit:i.textEdit?tl.from(i.textEdit):void 0,additionalTextEdits:i.additionalTextEdits?i.additionalTextEdits.map(n=>tl.from(n)):void 0}}s.from=t})(yY||(yY={}));var wY;(function(s){function e(i){return new yA(i[0],i[1],i[2],i[3])}s.to=e;function t(i){return[i.red,i.green,i.blue,i.alpha]}s.from=t})(wY||(wY={}));var SY;(function(s){function e(i){return{range:rt.from(i.range)}}s.from=e;function t(i){return new _W(rt.to(i.range))}s.to=t})(SY||(SY={}));var CY;(function(s){function e(t){switch(t){case ui.AUTO:return EC.AfterDelay;case ui.EXPLICIT:return EC.Manual;case ui.FOCUS_CHANGE:case ui.WINDOW_CHANGE:return EC.FocusOut}}s.to=e})(CY||(CY={}));var EY;(function(s){function e(i){switch(i){case Ul.Off:return cs.Off;case Ul.Relative:return cs.Relative;case Ul.Interval:return cs.Interval;case Ul.On:default:return cs.On}}s.from=e;function t(i){switch(i){case cs.Off:return Ul.Off;case cs.Relative:return Ul.Relative;case cs.Interval:return Ul.Interval;case cs.On:default:return Ul.On}}s.to=t})(EY||(EY={}));var nR;(function(s){function e(i){if(i===Q_.CRLF)return LD.CRLF;if(i===Q_.LF)return LD.LF}s.from=e;function t(i){if(i===LD.CRLF)return Q_.CRLF;if(i===LD.LF)return Q_.LF}s.to=t})(nR||(nR={}));var xY;(function(s){function e(t){if(typeof t=="object")return t.viewId;switch(t){case IC.SourceControl:return qo.Scm;case IC.Window:return qo.Window;case IC.Notification:return qo.Notification}throw new Error("Unknown 'ProgressLocation'")}s.from=e})(xY||(xY={}));var IY;(function(s){function e(i){const n={start:i.start+1,end:i.end+1};return i.kind&&(n.kind=sR.from(i.kind)),n}s.from=e;function t(i){const n={start:i.start-1,end:i.end-1};return i.kind&&(n.kind=sR.to(i.kind)),n}s.to=t})(IY||(IY={}));var sR;(function(s){function e(i){if(i)switch(i){case Xg.Comment:return v_.Comment;case Xg.Imports:return v_.Imports;case Xg.Region:return v_.Region}}s.from=e;function t(i){if(i)switch(i.value){case v_.Comment.value:return Xg.Comment;case v_.Imports.value:return Xg.Imports;case v_.Region.value:return Xg.Region}}s.to=t})(sR||(sR={}));var DY;(function(s){function e(t){if(t)return{pinned:typeof t.preview=="boolean"?!t.preview:void 0,inactive:t.background,preserveFocus:t.preserveFocus,selection:typeof t.selection=="object"?rt.from(t.selection):void 0,override:typeof t.override=="boolean"?od.id:void 0}}s.from=e})(DY||(DY={}));var th;(function(s){function e(o){return o instanceof kC?o.toJSON():typeof o=="string"?o:t(o)||i(o)?new kC(o.baseUri??o.base,o.pattern).toJSON():o}s.from=e;function t(o){const r=o;return r?R.isUri(r.baseUri)&&typeof r.pattern=="string":!1}function i(o){const r=o;return r?typeof r.base=="string"&&typeof r.pattern=="string":!1}function n(o){return typeof o=="string"?o:new kC(R.revive(o.baseUri),o.pattern)}s.to=n})(th||(th={}));var kY;(function(s){function e(t){if(t){if(Array.isArray(t))return t.map(e);if(typeof t=="string")return t;{const i=t;return{language:i.language,scheme:i.scheme,pattern:th.from(i.pattern)??void 0,exclusive:i.exclusive,notebookType:i.notebookType}}}else return}s.from=e})(kY||(kY={}));var TY;(function(s){function e(i){return{start:i.start,end:i.end}}s.from=e;function t(i){return new OS(i.start,i.end)}s.to=t})(TY||(TY={}));var oR;(function(s){function e(i){return{timing:typeof i.runStartTime=="number"&&typeof i.runEndTime=="number"?{startTime:i.runStartTime,endTime:i.runEndTime}:void 0,executionOrder:i.executionOrder,success:i.lastRunSuccess}}s.to=e;function t(i){return{lastRunSuccess:i.success,runStartTime:i.timing?.startTime,runEndTime:i.timing?.endTime,executionOrder:i.executionOrder}}s.from=t})(oR||(oR={}));var rR;(function(s){function e(i){switch(i){case eb.Markup:return gp.Markup;case eb.Code:default:return gp.Code}}s.from=e;function t(i){switch(i){case gp.Markup:return eb.Markup;case gp.Code:default:return eb.Code}}s.to=t})(rR||(rR={}));var AY;(function(s){function e(i){const n={metadata:i.metadata??Object.create(null),cells:[]};for(const o of i.cells)Ioe.validate(o),n.cells.push(Ay.from(o));return n}s.from=e;function t(i){const n=new pEe(i.cells.map(Ay.to));return FT(i.metadata)||(n.metadata=i.metadata),n}s.to=t})(AY||(AY={}));var Ay;(function(s){function e(i){return{cellKind:rR.from(i.kind),language:i.languageId,mime:i.mime,source:i.value,metadata:i.metadata,internalMetadata:oR.from(i.executionSummary??{}),outputs:i.outputs?i.outputs.map(cR.from):[]}}s.from=e;function t(i){return new Ioe(rR.to(i.cellKind),i.source,i.language,i.mime,i.outputs?i.outputs.map(cR.to):void 0,i.metadata,i.internalMetadata?oR.to(i.internalMetadata):void 0)}s.to=t})(Ay||(Ay={}));var aR;(function(s){function e(i){return{mime:i.mime,valueBytes:Re.wrap(i.data)}}s.from=e;function t(i){return new fEe(i.valueBytes.buffer,i.mime)}s.to=t})(aR||(aR={}));var cR;(function(s){function e(i){return{outputId:i.id,items:i.items.map(aR.from),metadata:i.metadata}}s.from=e;function t(i){const n=i.items.map(aR.to);return new mEe(n,i.outputId,i.metadata)}s.to=t})(cR||(cR={}));var RY;(function(s){function e(n){return i(n)?{include:th.from(n.include)??void 0,exclude:th.from(n.exclude)??void 0}:th.from(n)??void 0}s.from=e;function t(n){return i(n)?{include:th.to(n.include),exclude:th.to(n.exclude)}:th.to(n)}s.to=t;function i(n){const o=n;return o?!_p(o.include)&&!_p(o.exclude):!1}})(RY||(RY={}));var PY;(function(s){function e(t,i,n){const o=typeof t.command=="string"?{title:"",command:t.command}:t.command;return{alignment:t.alignment===FW.Left?lA.Left:lA.Right,command:i.toInternal(o,n),text:t.text,tooltip:t.tooltip,accessibilityInformation:t.accessibilityInformation,priority:t.priority}}s.from=e})(PY||(PY={}));var LY;(function(s){function e(t,i,n){const o=typeof t.command=="string"?{title:"",command:t.command}:t.command;return{command:i.toInternal(o,n),label:t.label,description:t.description,detail:t.detail,documentation:t.documentation}}s.from=e})(LY||(LY={}));var MY;(function(s){function e(t){return{transientOutputs:t?.transientOutputs??!1,transientCellMetadata:t?.transientCellMetadata??{},transientDocumentMetadata:t?.transientDocumentMetadata??{},cellContentMetadata:t?.cellContentMetadata??{}}}s.from=e})(MY||(MY={}));var NY;(function(s){function e(i){return{uri:i.uri,provides:i.provides}}s.from=e;function t(i){return new vEe(R.revive(i.uri),i.provides)}s.to=t})(NY||(NY={}));var GB;(function(s){function e(i){return{message:Tn.fromStrict(i.message)||"",type:rd.Error,expected:i.expectedOutput,actual:i.actualOutput,contextValue:i.contextValue,location:i.location&&{range:rt.from(i.location.range),uri:i.location.uri},stackTrace:i.stackTrace?.map(n=>({label:n.label,position:n.position&&Dy.from(n.position),uri:n.uri&&R.revive(n.uri).toJSON()}))}}s.from=e;function t(i){const n=new WW(typeof i.message=="string"?i.message:Tn.to(i.message));return n.actualOutput=i.actual,n.expectedOutput=i.expected,n.contextValue=i.contextValue,n.location=i.location?Ty.to(i.location):void 0,n}s.to=t})(GB||(GB={}));var Ry;(function(s){s.namespace=Uk,s.denamespace=vTe})(Ry||(Ry={}));var OY;(function(s){function e(t){return{controllerId:t.controllerId,profileId:t.profileId,group:qB.from(t.kind)}}s.from=e})(OY||(OY={}));var qB;(function(s){const e={[TC.Coverage]:To.Coverage,[TC.Debug]:To.Debug,[TC.Run]:To.Run};function t(i){return e.hasOwnProperty(i)?e[i]:To.Run}s.from=t})(qB||(qB={}));var zB;(function(s){function e(i){const n=CTe(i).controllerId;return{extId:Ln.fromExtHostTestItem(i,n).toString(),label:i.label,uri:R.revive(i.uri),busy:i.busy,tags:i.tags.map(o=>Ry.namespace(n,o.id)),range:P.lift(rt.from(i.range)),description:i.description||null,sortText:i.sortText||null,error:i.error&&Tn.fromStrict(i.error)||null}}s.from=e;function t(i){return{parent:void 0,error:void 0,id:Ln.fromString(i.extId).localId,label:i.label,uri:R.revive(i.uri),tags:(i.tags||[]).map(n=>{const{tagId:o}=Ry.denamespace(n);return new CA(o)}),children:{add:()=>{},delete:()=>{},forEach:()=>{},*[Symbol.iterator](){},get:()=>{},replace:()=>{},size:0},range:rt.to(i.range||void 0),canResolveChildren:!1,busy:i.busy,description:i.description||void 0,sortText:i.sortText||void 0}}s.toPlain=t})(zB||(zB={}));(function(s){function e(i){return{id:i.id}}s.from=e;function t(i){return new CA(i.id)}s.to=t})(Ry||(Ry={}));var FY;(function(s){const e=(i,n)=>{const o=i.value;if(!o)return;const r={...zB.toPlain(o.item),parent:n,taskStates:o.tasks.map(a=>({state:a.state,duration:a.duration,messages:a.messages.filter(c=>c.type===rd.Error).map(GB.to)})),children:[]};if(i.children)for(const a of i.children.values()){const c=e(a,r);c&&r.children.push(c)}return r};function t(i){const n=new WA;for(const a of i.items)n.insert(Ln.fromString(a.item.extId).path,a);const o=[n.nodes],r=[];for(;o.length;)for(const a of o.pop())a.value?r.push(a):a.children&&o.push(a.children.values());return{completedAt:i.completedAt,results:r.map(a=>e(a)).filter(ya)}}s.to=t})(FY||(FY={}));var WY;(function(s){function e(a){return{covered:a.covered,total:a.total}}function t(a){return"line"in a?Dy.from(a):rt.from(a)}function i(a){if(a)return"endLineNumber"in a?rt.to(a):Dy.to(a)}function n(a){if(a.type===km.Statement){const c=[];if(a.branches)for(const d of a.branches)c.push({executed:d.count,location:i(d.location),label:d.label});return new bEe(a.count,i(a.location),a.branches?.map(d=>new yEe(d.count,i(d.location),d.label)))}else return new wEe(a.name,a.count,i(a.location))}s.to=n;function o(a){if(typeof a.executed=="number"&&a.executed<0)throw new Error(`Invalid coverage count ${a.executed}`);return"branches"in a?{count:a.executed,location:t(a.location),type:km.Statement,branches:a.branches.length?a.branches.map(c=>({count:c.executed,location:c.location&&t(c.location),label:c.label})):void 0}:{type:km.Declaration,name:a.name,count:a.executed,location:t(a.location)}}s.fromDetails=o;function r(a,c,d){return Bk(d.statementCoverage),Bk(d.branchCoverage),Bk(d.declarationCoverage),{id:c,uri:d.uri,statement:e(d.statementCoverage),branch:d.branchCoverage&&e(d.branchCoverage),declaration:d.declarationCoverage&&e(d.declarationCoverage),testIds:d instanceof _Ee&&d.includesTests.length?d.includesTests.map(l=>Ln.fromExtHostTestItem(l,a).toString()):void 0}}s.fromFile=r})(WY||(WY={}));var BY;(function(s){function e(t){switch(t){case Bo.Invoke:return fA.Invoke;case Bo.Auto:return fA.Automatic}}s.to=e})(BY||(BY={}));var VY;(function(s){function e(i){const n=new SEe(Ah.to(i.kind),i.name,i.detail||"",R.revive(i.uri),rt.to(i.range),rt.to(i.selectionRange));return n._sessionId=i._sessionId,n._itemId=i._itemId,n}s.to=e;function t(i,n,o){if(n=n??i._sessionId,o=o??i._itemId,n===void 0||o===void 0)throw new Error("invalid item");return{_sessionId:n,_itemId:o,kind:Ah.from(i.kind),name:i.name,detail:i.detail??"",uri:i.uri,range:rt.from(i.range),selectionRange:rt.from(i.selectionRange),tags:i.tags?.map(jp.from)}}s.from=t})(VY||(VY={}));var HY;(function(s){function e(t){if(t)return{value:t.value,tooltip:t.tooltip}}s.from=e})(HY||(HY={}));var LC;(function(s){function e(o,r,a){const c=r.fileData;return c?new hEe(new uEe(c.name,R.revive(c.uri),c.id,hw(()=>a(c.id)))):o===Ii.uriList&&r.uriListData?new DW(n(r.uriListData)):new DW(r.asString)}s.to=e;async function t(o,r,a=Dn()){const c=await r.asString();if(o===Ii.uriList)return{id:a,asString:c,fileData:void 0,uriListData:i(c)};const d=r.asFile();return{id:a,asString:c,fileData:d?{name:d.name,uri:d.uri,id:d._itemId??d.id}:void 0}}s.from=t;function i(o){return ml.split(o).map(r=>{if(r.startsWith("#"))return r;try{return R.parse(r)}catch{}return r})}function n(o){return ml.create(o.map(r=>typeof r=="string"?r:R.revive(r)))}})(LC||(LC={}));var Py;(function(s){function e(n,o){const r=n.items.map(([a,c])=>[a,LC.to(a,c,o)]);return new kW(r)}s.toDataTransfer=e;async function t(n){return{items:await Promise.all(Array.from(n,async([r,a])=>[r,await LC.from(r,a)]))}}s.from=t;async function i(n){return{items:await Promise.all(Array.from(n,async([r,a])=>[r,await LC.from(r,a,a.id)]))}}s.fromList=i})(Py||(Py={}));var KB;(function(s){function e(i,n){return{kind:"reply",agentId:i.participant??n?.agentId??"",subCommand:i.command??n?.command,message:i.prompt,title:i.label}}s.from=e;function t(i){return{prompt:i.message,label:i.title,participant:i.agentId,command:i.subCommand}}s.to=t})(KB||(KB={}));var Ly;(function(s){function e(i){switch(i){case hu.System:return Gc.System;case hu.User:return Gc.User;case hu.Assistant:return Gc.Assistant}}s.to=e;function t(i){switch(i){case Gc.System:return hu.System;case Gc.User:return hu.User;case Gc.Assistant:return hu.Assistant}return hu.User}s.from=t})(Ly||(Ly={}));var UY;(function(s){function e(i){const n=i.content.map(a=>{if(a.type==="text")return new oo(a.value);if(a.type==="tool_result"){const c=a.value.map(d=>d.type==="text"?new oo(d.value):new rg(d.value));return new BW(a.toolCallId,c,a.isError)}else{if(a.type==="image_url")return;if(a.type==="tool_use")return new EA(a.toolCallId,a.name,a.parameters)}}).filter(a=>a!==void 0),o=Ly.to(i.role);return new TEe(o,n,i.name)}s.to=e;function t(i){const n=Ly.from(i.role),o=i.name;let r=i.content;typeof r=="string"&&(r=[new oo(r)]);const a=r.map(c=>{if(c instanceof BW)return{type:"tool_result",toolCallId:c.callId,value:Vt(c.content.map(d=>d instanceof oo?{type:"text",value:d.value}:d instanceof rg?{type:"prompt_tsx",value:d.value}:void 0)),isError:c.isError};if(c instanceof EA)return{type:"tool_use",toolCallId:c.callId,name:c.name,parameters:c.input};if(c instanceof oo)return{type:"text",value:c.value};if(typeof c!="string")throw new Error("Unexpected chat message content type");return{type:"text",value:c}});return{role:n,name:o,content:a}}s.from=t})(UY||(UY={}));var $Y;(function(s){function e(i){const n=i.content.map(a=>{if(a.type==="text")return new oo(a.value);if(a.type==="tool_result"){const c=a.value.map(d=>d.type==="text"?new oo(d.value):d.type==="data"?new Qd(d.value.data.buffer,d.value.mimeType):new rg(d.value));return new n8(a.toolCallId,c,a.isError)}else return a.type==="image_url"?new Qd(a.value.data.buffer,a.value.mimeType):a.type==="data"?new Qd(a.data.buffer,a.mimeType):new EA(a.toolCallId,a.name,a.parameters)}),o=Ly.to(i.role);return new AEe(o,n,i.name)}s.to=e;function t(i){const n=Ly.from(i.role),o=i.name;let r=i.content;typeof r=="string"&&(r=[new oo(r)]);const a=r.map(c=>{if(c instanceof n8||c instanceof BW)return{type:"tool_result",toolCallId:c.callId,value:Vt(c.content.map(d=>d instanceof oo?{type:"text",value:d.value}:d instanceof rg?{type:"prompt_tsx",value:d.value}:d instanceof Qd?{type:"data",value:{mimeType:d.mimeType,data:Re.wrap(d.data)}}:void 0)),isError:c.isError};if(c instanceof Qd)return ITe(c)?{type:"image_url",value:{mimeType:c.mimeType,data:Re.wrap(c.data)}}:{type:"data",mimeType:c.mimeType,data:Re.wrap(c.data)};if(c instanceof EA)return{type:"tool_use",toolCallId:c.callId,name:c.name,parameters:c.input};if(c instanceof oo)return{type:"text",value:c.value};if(typeof c!="string")throw new Error("Unexpected chat message content type llm 2");return{type:"text",value:c}});return{role:n,name:o,content:a}}s.from=t})($Y||($Y={}));function ITe(s){switch(s.mimeType){case op.PNG:case op.JPEG:case op.GIF:case op.WEBP:case op.BMP:return!0;default:return!1}}var dR;(function(s){function e(i){return{kind:"markdownContent",content:Tn.from(i.value)}}s.from=e;function t(i){return new koe(Tn.to(i.content))}s.to=t})(dR||(dR={}));var jB;(function(s){function e(i){return{kind:"codeblockUri",uri:i.value,isEdit:i.isEdit}}s.from=e;function t(i){return new Ooe(R.revive(i.uri),i.isEdit)}s.to=t})(jB||(jB={}));var YB;(function(s){function e(i){return{kind:"markdownVuln",content:Tn.from(i.value),vulnerabilities:i.vulnerabilities}}s.from=e;function t(i){return new Toe(Tn.to(i.content),i.vulnerabilities)}s.to=t})(YB||(YB={}));var QB;(function(s){function e(t){return{kind:"confirmation",title:t.title,message:t.message,data:t.data,buttons:t.buttons}}s.from=e})(QB||(QB={}));var lR;(function(s){function e(i){const{value:n,baseUri:o}=i;function r(a,c){return a.map(d=>{const l=R.joinPath(c,d.name);return{label:d.name,uri:l,children:d.children&&r(d.children,l)}})}return{kind:"treeData",treeData:{label:je(o),uri:o,children:r(n,o)}}}s.from=e;function t(i){const n=cn(i.treeData);function o(c){return c.map(d=>({name:d.label,children:d.children&&o(d.children)}))}const r=n.uri,a=n.children?o(n.children):[];return new Aoe(a,r)}s.to=t})(lR||(lR={}));var hR;(function(s){function e(i){const n=r=>R.isUri(r),o=r=>"name"in r;return{kind:"inlineReference",name:i.title,inlineReference:n(i.value)?i.value:o(i.value)?ZA.from(i.value):bh.from(i.value)}}s.from=e;function t(i){const n=cn(i);return new Roe(R.isUri(n.inlineReference)?n.inlineReference:"location"in n.inlineReference?ZA.to(n.inlineReference):bh.to(n.inlineReference),i.name)}s.to=t})(hR||(hR={}));var XB;(function(s){function e(i){return{kind:"progressMessage",content:Tn.from(i.value)}}s.from=e;function t(i){return new Poe(i.content.value)}s.to=t})(XB||(XB={}));var ZB;(function(s){function e(i){return{kind:"warning",content:Tn.from(i.value)}}s.from=e;function t(i){return new Loe(i.content.value)}s.to=t})(ZB||(ZB={}));var JB;(function(s){function e(t){return{kind:"extensions",extensions:t.extensions}}s.from=e})(JB||(JB={}));var eV;(function(s){function e(i){return{kind:"move",uri:i.uri,range:rt.from(i.range)}}s.from=e;function t(i){return new Foe(R.revive(i.uri),rt.to(i.range))}s.to=t})(eV||(eV={}));var tV;(function(s){function e(i){return{kind:"prepareToolInvocation",toolName:i.toolName}}s.from=e;function t(i){return new Boe(i.toolName)}s.to=t})(tV||(tV={}));var GY;(function(s){function e(t){return{kind:"progressTask",content:Tn.from(t.value)}}s.from=e})(GY||(GY={}));var qY;(function(s){function e(t){return{kind:"progressTaskResult",content:typeof t=="string"?Tn.from(t):void 0}}s.from=e})(qY||(qY={}));var uR;(function(s){function e(i,n,o){return{kind:"command",command:n.toInternal(i.value,o)??{command:i.value.command,title:i.value.title}}}s.from=e;function t(i,n){return new Moe(n.fromInternal(i.command)??{command:i.command.id,title:i.command.title})}s.to=t})(uR||(uR={}));var iV;(function(s){function e(i){return{kind:"textEdit",uri:i.uri,edits:i.edits.map(n=>tl.from(n)),done:i.isDone}}s.from=e;function t(i){const n=new Woe(R.revive(i.uri),i.edits.map(o=>tl.to(o)));return n.isDone=i.done,n}s.to=t})(iV||(iV={}));var nV;(function(s){function e(t){return t.newCellMetadata?{editType:al.Metadata,index:t.range.start,metadata:t.newCellMetadata}:t.newNotebookMetadata?{editType:al.DocumentMetadata,metadata:t.newNotebookMetadata}:{editType:al.Replace,index:t.range.start,count:t.range.end-t.range.start,cells:t.newCells.map(Ay.from)}}s.from=e})(nV||(nV={}));var sV;(function(s){function e(t){return{kind:"notebookEdit",uri:t.uri,edits:t.edits.map(nV.from),done:t.isDone}}s.from=e})(sV||(sV={}));var gR;(function(s){function e(i){const n=Te.isThemeIcon(i.iconPath)?i.iconPath:R.isUri(i.iconPath)?{light:R.revive(i.iconPath)}:i.iconPath&&"light"in i.iconPath&&"dark"in i.iconPath&&R.isUri(i.iconPath.light)&&R.isUri(i.iconPath.dark)?{light:R.revive(i.iconPath.light),dark:R.revive(i.iconPath.dark)}:void 0;return typeof i.value=="object"&&"variableName"in i.value?{kind:"reference",reference:{variableName:i.value.variableName,value:R.isUri(i.value.value)||!i.value.value?i.value.value:bh.from(i.value.value)},iconPath:n,options:i.options}:{kind:"reference",reference:R.isUri(i.value)||typeof i.value=="string"?i.value:bh.from(i.value),iconPath:n,options:i.options}}s.from=e;function t(i){const n=cn(i),o=r=>R.isUri(r)?r:bh.to(r);return new Noe(typeof n.reference=="string"?n.reference:"variableName"in n.reference?{variableName:n.reference.variableName,value:n.reference.value&&o(n.reference.value)}:o(n.reference))}s.to=t})(gR||(gR={}));var oV;(function(s){function e(t){return{kind:"codeCitation",value:t.value,license:t.license,snippet:t.snippet}}s.from=e})(oV||(oV={}));var zY;(function(s){function e(n,o,r){return n instanceof koe?dR.from(n):n instanceof Roe?hR.from(n):n instanceof Noe?gR.from(n):n instanceof Poe?XB.from(n):n instanceof Aoe?lR.from(n):n instanceof Moe?uR.from(n,o,r):n instanceof Woe?iV.from(n):n instanceof IEe?sV.from(n):n instanceof Toe?YB.from(n):n instanceof Ooe?jB.from(n):n instanceof Loe?ZB.from(n):n instanceof CEe?QB.from(n):n instanceof EEe?oV.from(n):n instanceof Foe?eV.from(n):n instanceof xEe?JB.from(n):n instanceof Boe?tV.from(n):{kind:"markdownContent",content:Tn.from("")}}s.from=e;function t(n,o){switch(n.kind){case"reference":return gR.to(n);case"markdownContent":case"inlineReference":case"progressMessage":case"treeData":case"command":return i(n,o)}}s.to=t;function i(n,o){switch(n.kind){case"markdownContent":return dR.to(n);case"inlineReference":return hR.to(n);case"progressMessage":return;case"treeData":return lR.to(n);case"command":return uR.to(n,o)}}s.toContent=i})(zY||(zY={}));var KY;(function(s){function e(t,i,n,o,r,a,c){const d=[],l=[];for(const g of t.variables.variables)g.kind==="tool"?d.push(g):g.kind==="toolset"?d.push(...g.value):l.push(g);const u={id:t.requestId,prompt:t.message,command:t.command,attempt:t.attempt??0,enableCommandDetection:t.enableCommandDetection??!0,isParticipantDetected:t.isParticipantDetected??!1,references:l.map(g=>aV.to(g,o,c)).filter(ya),toolReferences:d.map(cV.to),location:rV.to(t.location),acceptedConfirmationData:t.acceptedConfirmationData,rejectedConfirmationData:t.rejectedConfirmationData,location2:i,toolInvocationToken:Object.freeze({sessionId:t.sessionId}),tools:r,model:n,editedFileEvents:t.editedFileEvents,modeInstructions:t.modeInstructions};return yE(a,"chatParticipantPrivate")||(delete u.id,delete u.attempt,delete u.enableCommandDetection,delete u.isParticipantDetected,delete u.location,delete u.location2,delete u.editedFileEvents),yE(a,"chatParticipantAdditions")||(delete u.acceptedConfirmationData,delete u.rejectedConfirmationData,delete u.tools),u}s.to=e})(KY||(KY={}));var jY;(function(s){function e(t){return{prompt:t.prompt,files:t.files.map(i=>R.revive(i))}}s.to=e})(jY||(jY={}));var rV;(function(s){function e(i){switch(i){case Vi.Notebook:return $l.Notebook;case Vi.Terminal:return $l.Terminal;case Vi.Panel:return $l.Panel;case Vi.Editor:return $l.Editor}}s.to=e;function t(i){switch(i){case $l.Notebook:return Vi.Notebook;case $l.Terminal:return Vi.Terminal;case $l.Panel:return Vi.Panel;case $l.Editor:return Vi.Editor}}s.from=t})(rV||(rV={}));var aV;(function(s){function e(t,i,n){let o=t.value;if(!o){let r;try{r=JSON.stringify(t)}catch{r=`kind=${t.kind}, id=${t.id}, name=${t.name}`}n.error(`[ChatPromptReference] Ignoring invalid reference in variable: ${r}`);return}if(MT(o))o=R.revive(o);else if(o&&typeof o=="object"&&"uri"in o&&"range"in o&&MT(o.uri))o=bh.to(cn(o));else if(rb(t)){const r=t.references?.[0]?.reference;o=new DEe(t.mimeType??"image/png",()=>Promise.resolve(new Uint8Array(Object.values(t.value))),r&&R.isUri(r)?r:void 0)}else if(t.kind==="diagnostic"){const r=t.filterSeverity&&sx.to(t.filterSeverity),a=t.filterUri&&R.revive(t.filterUri).toString();o=new kEe(i.map(([c,d])=>t.filterUri&&c.toString()!==a?[c,[]]:[c,d.filter(l=>!(r&&l.severity>r||t.filterRange&&!P.areIntersectingOrTouching(t.filterRange,rt.from(l.range))))]).filter(([,c])=>c.length>0))}return{id:t.id,name:t.name,range:t.range&&[t.range.start,t.range.endExclusive],value:o,modelDescription:t.modelDescription}}s.to=e})(aV||(aV={}));var cV;(function(s){function e(t){if(t.value)throw new Error("Invalid tool reference");return{name:t.id,range:t.range&&[t.range.start,t.range.endExclusive]}}s.to=e})(cV||(cV={}));var YY;(function(s){function e(t,i,n){return{id:t.id,label:t.label,fullName:t.fullName,icon:t.icon?.id,value:t.values[0].value,insertText:t.insertText,detail:t.detail,documentation:t.documentation,command:i.toInternal(t.command,n)}}s.from=e})(YY||(YY={}));var dV;(function(s){function e(n){return{errorDetails:n.errorDetails,metadata:i(n.metadata),nextQuestion:n.nextQuestion}}s.to=e;function t(n){return{errorDetails:n.errorDetails,metadata:n.metadata,nextQuestion:n.nextQuestion}}s.from=t;function i(n){return wF(n,o=>{if(o.$mid===Nn.LanguageModelToolResult)return new cz(wF(o.content,i));if(o.$mid===Nn.LanguageModelTextPart)return new oo(o.value);if(o.$mid===Nn.LanguageModelPromptTsxPart)return new rg(o.value)})}})(dV||(dV={}));var QY;(function(s){function e(t,i,n){if(i.action.kind==="vote")return;const o=dV.to(t);if(i.action.kind==="command"){const r=i.action.commandButton.command;return{action:{kind:"command",commandButton:{command:n.fromInternal(r)??{command:r.id,title:r.title}}},result:o}}else return i.action.kind==="followUp"?{action:{kind:"followUp",followup:KB.to(i.action.followup)},result:o}:i.action.kind==="inlineChat"?{action:{kind:"editor",accepted:i.action.action==="accepted"},result:o}:i.action.kind==="chatEditingSessionAction"?{action:{kind:"chatEditingSessionAction",outcome:new Map([["accepted",ib.Accepted],["rejected",ib.Rejected],["saved",ib.Saved]]).get(i.action.outcome)??ib.Rejected,uri:R.revive(i.action.uri),hasRemainingEdits:i.action.hasRemainingEdits},result:o}:{action:i.action,result:o}}s.to=e})(QY||(QY={}));var XY;(function(s){function e(t,i,n){return"terminalCommand"in t?{terminalCommand:t.terminalCommand,shouldExecute:t.shouldExecute}:"uri"in t?{uri:t.uri}:i.toInternal(t,n)}s.from=e})(XY||(XY={}));var pR;(function(s){function e(t){return{...t,documentation:Tn.fromStrict(t.documentation)}}s.from=e})(pR||(pR={}));var ZY;(function(s){function e(t){return Array.isArray(t)?{items:t.map(i=>pR.from(i))}:{items:t.items.map(i=>pR.from(i)),resourceRequestConfig:t.resourceRequestConfig?lV.from(t.resourceRequestConfig):void 0}}s.from=e})(ZY||(ZY={}));var lV;(function(s){function e(t){return{...t,pathSeparator:pn?"\\":"/",cwd:t.cwd?R.revive(t.cwd):void 0}}s.from=e})(lV||(lV={}));var JY;(function(s){function e(t){return{kind:hV.to(t.kind),acceptedLength:t.acceptedLength}}s.to=e})(JY||(JY={}));var hV;(function(s){function e(t){switch(t){case xb.Word:return Z_.Word;case xb.Line:return Z_.Line;case xb.Suggest:return Z_.Suggest;default:return Z_.Unknown}}s.to=e})(hV||(hV={}));var eQ;(function(s){function e(t,i){if(t.kind===Wp.Ignored){const n=t.supersededBy?i(t.supersededBy):void 0;return{kind:CC.Ignored,supersededBy:n,userTypingDisagreed:t.userTypingDisagreed}}else if(t.kind===Wp.Accepted)return{kind:CC.Accepted};return{kind:CC.Rejected}}s.to=e})(eQ||(eQ={}));var tQ;(function(s){function e(t,i){return{id:i,label:t.label,description:t.description,canEdit:t.canEdit,collapsibleState:t.collapsibleState||UW.None,contextValue:t.contextValue}}s.from=e})(tQ||(tQ={}));var iQ;(function(s){function e(t){return{name:t.id,description:t.modelDescription,inputSchema:t.inputSchema,tags:t.tags??[]}}s.to=e})(iQ||(iQ={}));var nQ;(function(s){function e(i){return new cz(i.content.map(n=>n.kind==="text"?new oo(n.value):new rg(n.value)))}s.to=e;function t(i,n){return i.toolResultMessage&&$ie(n,"chatParticipantPrivate"),{content:i.content.map(o=>{if(o instanceof oo)return{kind:"text",value:o.value};if(o instanceof rg)return{kind:"promptTsx",value:o.value};throw new Error("Unknown LanguageModelToolResult part type")}),toolResultMessage:Tn.fromStrict(i.toolResultMessage),toolResultDetails:i.toolResultDetails?.map(o=>R.isUri(o)?o:bh.from(o))}}s.from=t})(nQ||(nQ={}));var sQ;(function(s){function e(i){return new REe(i.content.map(n=>{if(n.kind==="text")return new oo(n.value);if(n.kind==="data"){const o=Object.values(op).includes(n.value.mimeType)?n.value.mimeType:void 0;if(!o)throw new Error("Invalid MIME type");return new Qd(n.value.data.buffer,o)}else return new rg(n.value)}))}s.to=e;function t(i,n){i.toolResultMessage&&$ie(n,"chatParticipantPrivate");let o=!1;const r={content:i.content.map(a=>{if(a instanceof oo)return{kind:"text",value:a.value};if(a instanceof rg)return{kind:"promptTsx",value:a.value};if(a instanceof Qd)return o=!0,{kind:"data",value:{mimeType:a.mimeType,data:Re.wrap(a.data)}};throw new Error("Unknown LanguageModelToolResult part type")}),toolResultMessage:Tn.fromStrict(i.toolResultMessage),toolResultDetails:i.toolResultDetails?.map(a=>R.isUri(a)?a:bh.from(a))};return o?new Jr(r):r}s.from=t})(sQ||(sQ={}));var oQ;(function(s){function e(t){return t}s.fromThemeIcon=e})(oQ||(oQ={}));var rQ;(function(s){function e(i){return{query:i.query,kind:t(i.kind),settings:i.settings}}s.fromSettingsSearchResult=e;function t(i){switch(i){case ep.EMBEDDED:return ep.EMBEDDED;case ep.LLM_RANKED:return ep.LLM_RANKED;case ep.CANCELED:return ep.CANCELED;default:throw new Error("Unknown AiSettingsSearchResultKind")}}})(rQ||(rQ={}));var aQ;(function(s){function e(i){return!!i.uri}function t(i){return nx.toSerialized(e(i)?{type:cv.HTTP,uri:i.uri,headers:Object.entries(i.headers)}:{type:cv.Stdio,cwd:i.cwd?.fsPath,args:i.args,command:i.command,env:i.env,envFile:void 0})}s.from=t})(aQ||(aQ={}));const F9e="search.exclude",W9e=2e4,_ce="⟪ ",bce=" characters skipped ⟫",DTe=(_ce.length+bce.length+5)*2;var MC;(function(s){s[s.file=0]="file",s[s.text=1]="text",s[s.aiText=2]="aiText"})(MC||(MC={}));var Ep;(function(s){s[s.File=1]="File",s[s.Text=2]="Text",s[s.aiText=3]="aiText"})(Ep||(Ep={}));function B9e(s){return!!s.rangeLocations&&!!s.previewText}var cQ;(function(s){s[s.Normal=0]="Normal",s[s.NewSearchStarted=1]="NewSearchStarted"})(cQ||(cQ={}));class V9e{constructor(e,t,i,n){this.rangeLocations=[],this.webviewIndex=n;const o=Array.isArray(t)?t:[t];if(i&&i.matchLines===1&&kTe(o)){e=Vme(e,i.matchLines);let r="",a=0,c=0;const d=Math.floor(i.charsPerLine/5);for(const l of o){const u=Math.max(l.startColumn-d,0),g=l.startColumn+i.charsPerLine;if(u>c+d+DTe){const m=_ce+(u-c)+bce;r+=m+e.slice(u,g),a+=u-(c+m.length)}else r+=e.slice(c,g);c=g,this.rangeLocations.push({source:l,preview:new TTe(0,l.startColumn-a,l.endColumn-a)})}this.previewText=r}else{const r=Array.isArray(t)?t[0].startLineNumber:t.startLineNumber,a=Hme(t,c=>({preview:new yce(c.startLineNumber-r,c.startColumn,c.endLineNumber-r,c.endColumn),source:c}));this.rangeLocations=Array.isArray(a)?a:[a],this.previewText=e}}}function kTe(s){const e=s[0].startLineNumber;for(const t of s)if(t.startLineNumber!==e||t.endLineNumber!==e)return!1;return!0}class yce{constructor(e,t,i,n){this.startLineNumber=e,this.startColumn=t,this.endLineNumber=i,this.endColumn=n}}class TTe extends yce{constructor(e,t,i){super(e,t,e,i)}}var dQ;(function(s){s.List="list",s.Tree="tree"})(dQ||(dQ={}));var lQ;(function(s){s.Default="default",s.FileNames="fileNames",s.Type="type",s.Modified="modified",s.CountDescending="countDescending",s.CountAscending="countAscending"})(lQ||(lQ={}));var hQ;(function(s){s.Auto="auto",s.Manual="manual",s.RunOnEmpty="runOnEmpty"})(hQ||(hQ={}));function wce(s,e=!0){const t=s&&s.files&&s.files.exclude,i=e&&s&&s.search&&s.search.exclude;if(!t&&!i)return;if(!t||!i)return t||i||void 0;let n=Object.create(null);return n=zu(n,Cr(t)),n=zu(n,Cr(i),!0),n}function uQ(s,e){return s.excludePattern&&ch(s.excludePattern,e)?!1:s.includePattern||s.usingSearchPaths?s.includePattern&&ch(s.includePattern,e)?!0:s.usingSearchPaths?!!s.folderQueries&&s.folderQueries.some(t=>{const i=t.folder.fsPath;if(Bme(e,i)){const n=qM(i,e);return!t.includePattern||!!ch(t.includePattern,n)}else return!1}):!1:!0}var gQ;(function(s){s[s.unknownEncoding=1]="unknownEncoding",s[s.regexParseError=2]="regexParseError",s[s.globParseError=3]="globParseError",s[s.invalidLiteral=4]="invalidLiteral",s[s.rgProcessError=5]="rgProcessError",s[s.other=6]="other",s[s.canceled=7]="canceled"})(gQ||(gQ={}));function H9e(s,e){const t={...s||{},...e||{}};return Object.keys(t).filter(i=>{const n=t[i];return typeof n=="boolean"&&n})}class U9e{constructor(e,t){this._parsedIncludeExpression=null,this._excludeExpression=t.excludePattern?.map(n=>({...e.excludePattern||{},...n.pattern||{}}))??[],this._excludeExpression.length===0&&(this._excludeExpression=[e.excludePattern||{}]),this._parsedExcludeExpression=this._excludeExpression.map(n=>Um(n));let i=e.includePattern;t.includePattern&&(i?i={...i,...t.includePattern}:i=t.includePattern),i&&(this._parsedIncludeExpression=Um(i))}_evalParsedExcludeExpression(e,t,i){let n=null;for(const o of this._parsedExcludeExpression){const r=o(e,t,i);if(typeof r=="string"){n=r;break}}return n}matchesExcludesSync(e,t,i){return!!(this._parsedExcludeExpression&&this._evalParsedExcludeExpression(e,t,i))}includedInQuerySync(e,t,i){return!(this._parsedExcludeExpression&&this._evalParsedExcludeExpression(e,t,i)||this._parsedIncludeExpression&&!this._parsedIncludeExpression(e,t,i))}includedInQuery(e,t,i){const n=()=>this._parsedIncludeExpression?!!this._parsedIncludeExpression(e,t,i):!0;return Promise.all(this._parsedExcludeExpression.map(o=>{const r=o(e,t,i);return NT(r)?r.then(a=>a?!1:n()):n()})).then(o=>o.some(r=>!!r))}hasSiblingExcludeClauses(){return this._excludeExpression.reduce((e,t)=>ATe(t)||e,!1)}}function ATe(s){for(const e in s)if(typeof s[e]!="boolean")return!0;return!1}function $9e(s){if(!s)return;let e;return t=>(e||(e=(s()||Promise.resolve([])).then(i=>i?Sce(i):{})),e.then(i=>!!i[t]))}function G9e(s){if(!s)return;let e;return t=>{if(!e){const i=s();e=i?Sce(i):{}}return!!e[t]}}function Sce(s){const e={};for(const t of s)e[t]=!0;return e}function q9e(s){return s.flatMap(e=>e.patterns.map(t=>e.baseUri?{baseUri:e.baseUri,pattern:t}:t))}const z9e={matchLines:100,charsPerLine:1e4};function RTe(s){return[...s.entries()]}function K9e(s){return s?[...s.entries()]:[]}function PTe(s){return new Map(s)}function LTe(s){return new Map(s??[])}class MTe{constructor(e){this._callback=e,this._terminalBufferMap=new Map}dispose(){for(const e of this._terminalBufferMap.values())e.dispose()}startBuffering(e,t,i=5){const n=t(o=>{const r=typeof o=="string"?o:o.data;let a=this._terminalBufferMap.get(e);if(a){a.data.push(r);return}const c=setTimeout(()=>this.flushBuffer(e),i);a={data:[r],timeoutId:c,dispose:()=>{clearTimeout(c),this.flushBuffer(e),n.dispose()}},this._terminalBufferMap.set(e,a)});return n}stopBuffering(e){this._terminalBufferMap.get(e)?.dispose()}flushBuffer(e){const t=this._terminalBufferMap.get(e);t&&(this._terminalBufferMap.delete(e),this._callback(e,t.data.join("")))}}const NTe={type:"object",additionalProperties:!1,properties:{type:{type:"string",description:h(10320,"The actual task type. Please note that types starting with a '$' are reserved for internal usage.")},required:{type:"array",items:{type:"string"}},properties:{type:"object",description:h(10321,"Additional properties of the task type"),additionalProperties:{$ref:"http://json-schema.org/draft-07/schema#"}},when:{type:"string",markdownDescription:h(10322,"Condition which must be true to enable this type of task. Consider using `shellExecutionSupported`, `processExecutionSupported`, and `customExecutionSupported` as appropriate for this task definition. See the [API documentation](https://code.visualstudio.com/api/extension-guides/task-provider#when-clause) for more information."),default:""}}};var uV;(function(s){function e(t,i,n){if(!t)return;const o=It(t.type)?t.type:void 0;if(!o||o.length===0){n.error(h(10323,"The task type configuration is missing the required 'taskType' property"));return}const r=[];if(Array.isArray(t.required))for(const a of t.required)It(a)&&r.push(a);return{extensionId:i.value,taskType:o,required:r,properties:t.properties?Cr(t.properties):{},when:t.when?x.deserialize(t.when):void 0}}s.from=e})(uV||(uV={}));const OTe=_l.registerExtensionPoint({extensionPoint:"taskDefinitions",activationEventsGenerator:(s,e)=>{for(const t of s)t.type&&e.push(`onTaskType:${t.type}`)},jsonSchema:{description:h(10324,"Contributes task kinds"),type:"array",items:NTe}});class FTe{constructor(){this._onDefinitionsChanged=new M,this.onDefinitionsChanged=this._onDefinitionsChanged.event,this.taskTypes=Object.create(null),this.readyPromise=new Promise((e,t)=>{OTe.setHandler((i,n)=>{this._schema=void 0;try{for(const o of n.removed){const r=o.value;for(const a of r)this.taskTypes&&a.type&&this.taskTypes[a.type]&&delete this.taskTypes[a.type]}for(const o of n.added){const r=o.value;for(const a of r){const c=uV.from(a,o.description.identifier,o.collector);c&&(this.taskTypes[c.taskType]=c)}}(n.removed.length>0||n.added.length>0)&&this._onDefinitionsChanged.fire()}catch{}e(void 0)})})}onReady(){return this.readyPromise}get(e){return this.taskTypes[e]}all(){return Object.keys(this.taskTypes).map(e=>this.taskTypes[e])}getJsonSchema(){if(this._schema===void 0){const e=[];for(const t of this.all()){const i={type:"object",additionalProperties:!1};t.required.length>0&&(i.required=t.required.slice(0)),t.properties!==void 0?i.properties=Cr(t.properties):i.properties=Object.create(null),i.properties.type={type:"string",enum:[t.taskType]},e.push(i)}this._schema={oneOf:e}}return this._schema}}const WTe=new FTe,Cce="settings";new O("taskRunning",!1,h(10334,"Whether a task is currently running."));new O("taskTerminalActive",!1,h(10335,"Whether the active terminal is a task terminal."));I(10336,"Tasks");var fR;(function(s){s[s.Escape=1]="Escape",s[s.Strong=2]="Strong",s[s.Weak=3]="Weak"})(fR||(fR={}));const Ece="$customized";(function(s){function e(t){if(!t)return s.Strong;switch(t.toLowerCase()){case"escape":return s.Escape;case"strong":return s.Strong;case"weak":return s.Weak;default:return s.Strong}}s.from=e})(fR||(fR={}));var ox;(function(s){s.defaults={cwd:"${workspaceFolder}"}})(ox||(ox={}));var rx;(function(s){s[s.Always=1]="Always",s[s.Silent=2]="Silent",s[s.Never=3]="Never"})(rx||(rx={}));(function(s){function e(t){switch(t.toLowerCase()){case"always":return s.Always;case"silent":return s.Silent;case"never":return s.Never;default:return s.Always}}s.fromString=e})(rx||(rx={}));var ax;(function(s){s[s.Never=1]="Never",s[s.OnProblem=2]="OnProblem",s[s.Always=3]="Always"})(ax||(ax={}));(function(s){function e(t){switch(t.toLowerCase()){case"always":return s.Always;case"never":return s.Never;case"onproblem":return s.OnProblem;default:return s.OnProblem}}s.fromString=e})(ax||(ax={}));var cx;(function(s){s[s.Shared=1]="Shared",s[s.Dedicated=2]="Dedicated",s[s.New=3]="New"})(cx||(cx={}));(function(s){function e(t){switch(t.toLowerCase()){case"shared":return s.Shared;case"dedicated":return s.Dedicated;case"new":return s.New;default:return s.Shared}}s.fromString=e})(cx||(cx={}));var mR;(function(s){s.defaults={echo:!0,reveal:rx.Always,revealProblems:ax.Never,focus:!1,panel:cx.Shared,showReuseMessage:!0,clear:!1}})(mR||(mR={}));var ac;(function(s){s[s.Shell=1]="Shell",s[s.Process=2]="Process",s[s.CustomExecution=3]="CustomExecution"})(ac||(ac={}));(function(s){function e(i){switch(i.toLowerCase()){case"shell":return s.Shell;case"process":return s.Process;case"customExecution":return s.CustomExecution;default:return s.Process}}s.fromString=e;function t(i){switch(i){case s.Shell:return"shell";case s.Process:return"process";case s.CustomExecution:return"customExecution";default:return"process"}}s.toString=t})(ac||(ac={}));var pQ;(function(s){function e(t){return It(t)?t:t.value}s.value=e})(pQ||(pQ={}));var fQ;(function(s){s.Clean={_id:"clean",isDefault:!1},s.Build={_id:"build",isDefault:!1},s.Rebuild={_id:"rebuild",isDefault:!1},s.Test={_id:"test",isDefault:!1};function e(i){return i===s.Clean._id||i===s.Build._id||i===s.Rebuild._id||i===s.Test._id}s.is=e;function t(i){if(i!==void 0)return It(i)?e(i)?{_id:i,isDefault:!1}:void 0:i}s.from=t})(fQ||(fQ={}));var rp;(function(s){s[s.Global=1]="Global",s[s.Workspace=2]="Workspace",s[s.Folder=3]="Folder"})(rp||(rp={}));var Ou;(function(s){s.Workspace="workspace",s.Extension="extension",s.InMemory="inMemory",s.WorkspaceFile="workspaceFile",s.User="user";function e(t){switch(t){case s.User:return ur.USER;case s.WorkspaceFile:return ur.WORKSPACE;default:return ur.WORKSPACE_FOLDER}}s.toConfigurationTarget=e})(Ou||(Ou={}));var mQ;(function(s){s.parallel="parallel",s.sequence="sequence"})(mQ||(mQ={}));var gV;(function(s){s[s.default=1]="default",s[s.folderOpen=2]="folderOpen"})(gV||(gV={}));var pV;(function(s){s.terminateNewest="terminateNewest",s.terminateOldest="terminateOldest",s.prompt="prompt",s.warn="warn",s.silent="silent"})(pV||(pV={}));var vR;(function(s){s.defaults={reevaluateOnRerun:!0,runOn:gV.default,instanceLimit:1,instancePolicy:pV.prompt}})(vR||(vR={}));class kK{constructor(e,t,i,n,o,r){this._label="",this._id=e,t&&(this._label=t),i&&(this.type=i),this.runOptions=n,this.configurationProperties=o,this._source=r}getDefinition(e){}getMapKey(){return this._id}getKey(){}getCommonTaskId(){const e={folder:this.getFolderId(),id:this._id};return JSON.stringify(e)}clone(){return this.fromObject(Object.assign({},this))}getWorkspaceFolder(){}getWorkspaceFileName(){}getTelemetryKind(){return"unknown"}matches(e,t=!1){if(e===void 0)return!1;if(It(e))return e===this._label||e===this.configurationProperties.identifier||t&&e===this._id;const i=this.getDefinition(!0);return i!==void 0&&i._key===e._key}getQualifiedLabel(){const e=this.getWorkspaceFolder();return e?`${this._label} (${e.name})`:this._label}getTaskExecution(){return{id:this._id,task:this}}addTaskLoadMessages(e){this._taskLoadMessages===void 0&&(this._taskLoadMessages=[]),e&&(this._taskLoadMessages=this._taskLoadMessages.concat(e))}get taskLoadMessages(){return this._taskLoadMessages}}class NC extends kK{constructor(e,t,i,n,o,r,a,c){super(e,i,void 0,a,c,t),this.command={},this._source=t,this.hasDefinedMatchers=r,o&&(this.command=o)}clone(){return new NC(this._id,this._source,this._label,this.type,this.command,this.hasDefinedMatchers,this.runOptions,this.configurationProperties)}customizes(){if(this._source&&this._source.customizes)return this._source.customizes}getDefinition(e=!1){if(e&&this._source.customizes!==void 0)return this._source.customizes;{let t;switch(this.command?this.command.runtime:void 0){case ac.Shell:t="shell";break;case ac.Process:t="process";break;case ac.CustomExecution:t="customExecution";break;case void 0:t="$composite";break;default:throw new Error("Unexpected task runtime")}return{type:t,_key:this._id,id:this._id}}}static is(e){return e instanceof NC}getMapKey(){const e=this._source.config.workspaceFolder;return e?`${e.uri.toString()}|${this._id}|${this.instance}`:`${this._id}|${this.instance}`}getFolderId(){return this._source.kind===Ou.User?Cce:this._source.config.workspaceFolder?.uri.toString()}getCommonTaskId(){return this._source.customizes?super.getCommonTaskId():this.getKey()??super.getCommonTaskId()}getKey(){const e=this.getFolderId();if(!e)return;let t=this.configurationProperties.identifier;return this._source.kind!==Ou.Workspace&&(t+=this._source.kind),JSON.stringify({type:Ece,folder:e,id:t})}getWorkspaceFolder(){return this._source.config.workspaceFolder}getWorkspaceFileName(){return this._source.config.workspace&&this._source.config.workspace.configuration?je(this._source.config.workspace.configuration):void 0}getTelemetryKind(){return this._source.customizes?"workspace>extension":"workspace"}fromObject(e){return new NC(e._id,e._source,e._label,e.type,e.command,e.hasDefinedMatchers,e.runOptions,e.configurationProperties)}}class OC extends kK{constructor(e,t,i,n,o,r,a){super(e,i,n,r,a,t),this._source=t,this.configures=o}static is(e){return e instanceof OC}fromObject(e){return e}getDefinition(){return this.configures}getWorkspaceFileName(){return this._source.config.workspace&&this._source.config.workspace.configuration?je(this._source.config.workspace.configuration):void 0}getWorkspaceFolder(){return this._source.config.workspaceFolder}getFolderId(){return this._source.kind===Ou.User?Cce:this._source.config.workspaceFolder?.uri.toString()}getKey(){const e=this.getFolderId();if(!e)return;let t=this.configurationProperties.identifier;return this._source.kind!==Ou.Workspace&&(t+=this._source.kind),JSON.stringify({type:Ece,folder:e,id:t})}}class Tm extends kK{constructor(e,t,i,n,o,r,a,c,d){super(e,i,n,c,d,t),this.defines=o,this.hasDefinedMatchers=a,this.command=r,this.icon=d.icon,this.hide=d.hide}clone(){return new Tm(this._id,this._source,this._label,this.type,this.defines,this.command,this.hasDefinedMatchers,this.runOptions,this.configurationProperties)}getDefinition(){return this.defines}static is(e){return e instanceof Tm}getMapKey(){const e=this._source.workspaceFolder;return e?`${this._source.scope.toString()}|${e.uri.toString()}|${this._id}|${this.instance}`:`${this._source.scope.toString()}|${this._id}|${this.instance}`}getFolderId(){if(this._source.scope===rp.Folder&&this._source.workspaceFolder)return this._source.workspaceFolder.uri.toString()}getKey(){const e={type:"contributed",scope:this._source.scope,id:this._id};return e.folder=this.getFolderId(),JSON.stringify(e)}getWorkspaceFolder(){return this._source.workspaceFolder}getTelemetryKind(){return"extension"}fromObject(e){return new Tm(e._id,e._source,e._label,e.type,e.defines,e.command,e.hasDefinedMatchers,e.runOptions,e.configurationProperties)}}var _R;(function(s){s[s.Process=1]="Process",s[s.Terminal=2]="Terminal"})(_R||(_R={}));(function(s){s._default=s.Terminal})(_R||(_R={}));var vQ;(function(s){s[s.V0_1_0=1]="V0_1_0",s[s.V2_0_0=2]="V2_0_0"})(vQ||(vQ={}));var bR;(function(s){s.SingleRun="singleRun",s.Background="background"})(bR||(bR={}));var Qf;(function(s){s.Changed="changed",s.ProcessStarted="processStarted",s.ProcessEnded="processEnded",s.Terminated="terminated",s.Start="start",s.AcquiredInput="acquiredInput",s.DependsOnStarted="dependsOnStarted",s.Active="active",s.Inactive="inactive",s.End="end",s.ProblemMatcherStarted="problemMatcherStarted",s.ProblemMatcherEnded="problemMatcherEnded",s.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(Qf||(Qf={}));var _Q;(function(s){s[s.System=0]="System",s[s.User=1]="User",s[s.FolderOpen=2]="FolderOpen",s[s.ConfigurationChange=3]="ConfigurationChange",s[s.Reconnect=4]="Reconnect"})(_Q||(_Q={}));var bQ;(function(s){function e(c){return{taskId:c._id,taskName:c.configurationProperties.name,runType:c.configurationProperties.isBackground?bR.Background:bR.SingleRun,group:c.configurationProperties.group,__task:c}}function t(c,d,l){return{...e(c),kind:Qf.Start,terminalId:d,resolvedVariables:l}}s.start=t;function i(c,d,l){return{...e(c),kind:Qf.ProcessStarted,terminalId:d,processId:l}}s.processStarted=i;function n(c,d,l){return{...e(c),kind:Qf.ProcessEnded,terminalId:d,exitCode:l}}s.processEnded=n;function o(c,d,l){return{...e(c),kind:Qf.Terminated,exitReason:l,terminalId:d}}s.terminated=o;function r(c,d,l){return{...e(d),kind:c,terminalId:l}}s.general=r;function a(){return{kind:Qf.Changed}}s.changed=a})(bQ||(bQ={}));var yR;(function(s){function e(i){const n=Object.keys(i).sort();let o="";for(const r of n){let a=i[r];a instanceof Object?a=e(a):typeof a=="string"&&(a=a.replace(/,/g,",,")),o+=r+","+a+","}return o}function t(i){const o={_key:e(i),type:i.taskType};return Object.assign(o,i),o}s.create=t})(yR||(yR={}));var yQ;(function(s){s.AutoDetect="task.autoDetect",s.SaveBeforeRun="task.saveBeforeRun",s.ShowDecorations="task.showDecorations",s.ProblemMatchersNeverPrompt="task.problemMatchers.neverPrompt",s.SlowProviderWarning="task.slowProviderWarning",s.QuickOpenHistory="task.quickOpen.history",s.QuickOpenDetail="task.quickOpen.detail",s.QuickOpenSkip="task.quickOpen.skip",s.QuickOpenShowAll="task.quickOpen.showAll",s.AllowAutomaticTasks="task.allowAutomaticTasks",s.Reconnection="task.reconnection",s.VerboseLogging="task.verboseLogging"})(yQ||(yQ={}));var wQ;(function(s){s.Tasks="tasks",s.SuppressTaskName="tasks.suppressTaskName",s.Windows="tasks.windows",s.Osx="tasks.osx",s.Linux="tasks.linux",s.ShowOutput="tasks.showOutput",s.IsShellCommand="tasks.isShellCommand",s.ServiceTestSetting="tasks.service.testSetting"})(wQ||(wQ={}));var fV;(function(s){function e(t,i){const n=WTe.get(t.type);if(n===void 0){const c=Cr(t);return delete c._key,yR.create(c)}const o=Object.create(null);o.type=n.taskType;const r=new Set;n.required.forEach(c=>r.add(c));const a=n.properties;for(const c of Object.keys(a)){const d=t[c];if(d!=null)o[c]=d;else if(r.has(c)){const l=a[c];if(l.default!==void 0)o[c]=Cr(l.default);else switch(l.type){case"boolean":o[c]=!1;break;case"number":case"integer":o[c]=0;break;case"string":o[c]="";break;default:i.error(h(10337,"Error: the task identifier '{0}' is missing the required property '{1}'. The task identifier will be ignored.",JSON.stringify(t,void 0,0),c));return}}}return yR.create(o)}s.createTaskIdentifier=e})(fV||(fV={}));class BTe{constructor(){this.pendingRequests=new Map,this.queue=[],this._onError=new M,this._onExit=new M,this.sequence=1}get onError(){return this._onError.event}get onExit(){return this._onExit.event}onMessage(e){this.messageCallback&&this._onError.fire(new Error("attempt to set more than one 'Message' callback")),this.messageCallback=e}onEvent(e){this.eventCallback&&this._onError.fire(new Error("attempt to set more than one 'Event' callback")),this.eventCallback=e}onRequest(e){this.requestCallback&&this._onError.fire(new Error("attempt to set more than one 'Request' callback")),this.requestCallback=e}sendResponse(e){e.seq>0?this._onError.fire(new Error(`attempt to send more than one response for command ${e.command}`)):this.internalSend("response",e)}sendRequest(e,t,i,n){const o={command:e};if(t&&Object.keys(t).length>0&&(o.arguments=t),this.internalSend("request",o),typeof n=="number"){const r=setTimeout(()=>{clearTimeout(r);const a=this.pendingRequests.get(o.seq);if(a){this.pendingRequests.delete(o.seq);const c={type:"response",seq:0,request_seq:o.seq,success:!1,command:e,message:h(6108,"Timeout after {0} ms for '{1}'",n,e)};a(c)}},n)}return i&&this.pendingRequests.set(o.seq,i),o.seq}acceptMessage(e){this.messageCallback?this.messageCallback(e):(this.queue.push(e),this.queue.length===1&&this.processQueue())}needsTaskBoundaryBetween(e,t){return e.type!=="event"||t.type!=="event"}async processQueue(){let e;for(;this.queue.length;){if((!e||this.needsTaskBoundaryBetween(this.queue[0],e))&&await Ia(0),e=this.queue.shift(),!e)return;switch(e.type){case"event":this.eventCallback?.(e);break;case"request":this.requestCallback?.(e);break;case"response":{const t=e,i=this.pendingRequests.get(t.request_seq);i&&(this.pendingRequests.delete(t.request_seq),i(t));break}}}}internalSend(e,t){t.type=e,t.seq=this.sequence++,this.sendMessage(t)}async cancelPendingRequests(){if(this.pendingRequests.size===0)return Promise.resolve();const e=new Map;this.pendingRequests.forEach((t,i)=>e.set(i,t)),await Ia(500),e.forEach((t,i)=>{t({type:"response",seq:0,request_seq:i,success:!1,command:"canceled",message:"canceled"}),this.pendingRequests.delete(i)})}getPendingRequestIds(){return Array.from(this.pendingRequests.keys())}dispose(){this.queue=[]}}function xce(s){return s.configuration.request==="attach"&&!Ice(s)&&(!s.parentSession||xce(s.parentSession))}function Ice(s){let e=s.configuration.type;if(e)return e==="vslsShare"&&(e=s.configuration.adapterProxy.configuration.type),Xs(e,"extensionhost")||Xs(e,"pwa-extensionhost")?s:s.parentSession?Ice(s.parentSession):void 0}function j9e(s){return s.type&&(s.label||s.program||s.runtime)}const VTe=/^[a-zA-Z][a-zA-Z0-9\+\-\.]+:/;function HTe(s){return!!(s&&s.match(VTe))}function Dce(s){if(typeof s.path=="string"&&!(typeof s.sourceReference=="number"&&s.sourceReference>0)){if(HTe(s.path))return R.parse(s.path);if(iy(s.path))return R.file(s.path)}return s.path}function kce(s){if(typeof s.path=="object"){const e=R.revive(s.path);if(e)return e.scheme===ae.file?e.fsPath:e.toString()}return s.path}function UTe(s,e){const t=e?Dce:kce,i=Cr(s);return Tce(i,(n,o)=>{n&&o&&(o.path=t(o))}),i}function $Te(s,e){const t=e?Dce:kce,i=Cr(s);return Tce(i,(n,o)=>{!n&&o&&(o.path=t(o))}),i}function Tce(s,e){switch(s.type){case"event":{const t=s;switch(t.event){case"output":e(!1,t.body.source);break;case"loadedSource":e(!1,t.body.source);break;case"breakpoint":e(!1,t.body.breakpoint.source);break}break}case"request":{const t=s;switch(t.command){case"setBreakpoints":e(!0,t.arguments.source);break;case"breakpointLocations":e(!0,t.arguments.source);break;case"source":e(!0,t.arguments.source);break;case"gotoTargets":e(!0,t.arguments.source);break;case"launchVSCode":t.arguments.args.forEach(i=>e(!1,i));break}break}case"response":{const t=s;if(t.success&&t.body)switch(t.command){case"stackTrace":t.body.stackFrames.forEach(i=>e(!1,i.source));break;case"loadedSources":t.body.sources.forEach(i=>e(!1,i));break;case"scopes":t.body.scopes.forEach(i=>e(!1,i.source));break;case"setFunctionBreakpoints":t.body.breakpoints.forEach(i=>e(!1,i.source));break;case"setBreakpoints":t.body.breakpoints.forEach(i=>e(!1,i.source));break;case"disassemble":t.body?.instructions.forEach(n=>e(!1,n.location));break;case"locations":e(!1,t.body?.source);break}break}}}class GTe{constructor(e,t){this.versionId=e,this.removedDueToLooping=t}}class TK extends F{static isHostExtension(e,t,i){if(t.getExtensionDescription(e))return!1;const n=i.getExtensionDescription(e);return n?!!((n.main||n.browser)&&n.api==="none"):!1}constructor(e,t){super(),this._activationEventsReader=e,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._versionId=0,this._extensionDescriptions=t,this._initialize()}_initialize(){this._extensionDescriptions.sort(QTe),this._extensionsMap=new ko,this._extensionsArr=[],this._activationMap=new Map;for(const e of this._extensionDescriptions){if(this._extensionsMap.has(e.identifier)){console.error("Extension `"+e.identifier.value+"` is already registered");continue}this._extensionsMap.set(e.identifier,e),this._extensionsArr.push(e);const t=this._activationEventsReader.readActivationEvents(e);for(const i of t)this._activationMap.has(i)||this._activationMap.set(i,[]),this._activationMap.get(i).push(e)}}set(e){return this._extensionDescriptions=e,this._initialize(),this._versionId++,this._onDidChange.fire(void 0),{versionId:this._versionId}}deltaExtensions(e,t){this._extensionDescriptions=SQ(this._extensionDescriptions,t),this._extensionDescriptions=this._extensionDescriptions.concat(e);const i=TK._findLoopingExtensions(this._extensionDescriptions);return this._extensionDescriptions=SQ(this._extensionDescriptions,i.map(n=>n.identifier)),this._initialize(),this._versionId++,this._onDidChange.fire(void 0),new GTe(this._versionId,i)}static _findLoopingExtensions(e){const t=new class{constructor(){this._arcs=new Map,this._nodesSet=new Set,this._nodesArr=[]}addNode(a){this._nodesSet.has(a)||(this._nodesSet.add(a),this._nodesArr.push(a))}addArc(a,c){this.addNode(a),this.addNode(c),this._arcs.has(a)?this._arcs.get(a).push(c):this._arcs.set(a,[c])}getArcs(a){return this._arcs.has(a)?this._arcs.get(a):[]}hasOnlyGoodArcs(a,c){const d=t.getArcs(a);for(let l=0;l<d.length;l++)if(!c.has(d[l]))return!1;return!0}getNodes(){return this._nodesArr}},i=new ko;for(const a of e)if(i.set(a.identifier,a),a.extensionDependencies)for(const c of a.extensionDependencies)t.addArc(Es.toKey(a.identifier),Es.toKey(c));const n=new Set;t.getNodes().filter(a=>t.getArcs(a).length===0).forEach(a=>n.add(a));const o=t.getNodes().filter(a=>!n.has(a));let r;do{r=!1;for(let a=0;a<o.length;a++){const c=o[a];t.hasOnlyGoodArcs(c,n)&&(o.splice(a,1),a--,n.add(c),r=!0)}}while(r);return o.map(a=>i.get(a))}containsActivationEvent(e){return this._activationMap.has(e)}containsExtension(e){return this._extensionsMap.has(e)}getExtensionDescriptionsForActivationEvent(e){const t=this._activationMap.get(e);return t?t.slice(0):[]}getAllExtensionDescriptions(){return this._extensionsArr.slice(0)}getSnapshot(){return new qTe(this._versionId,this.getAllExtensionDescriptions())}getExtensionDescription(e){const t=this._extensionsMap.get(e);return t||void 0}getExtensionDescriptionByUUID(e){for(const t of this._extensionsArr)if(t.uuid===e)return t}getExtensionDescriptionByIdOrUUID(e,t){return this.getExtensionDescription(e)??(t?this.getExtensionDescriptionByUUID(t):void 0)}}class qTe{constructor(e,t){this.versionId=e,this.extensions=t}}class zTe{constructor(e){this._lock=new YTe,this._actual=new TK(e,[])}async acquireLock(e){const t=await this._lock.acquire(e);return new KTe(this,t)}deltaExtensions(e,t,i){if(!e.isAcquiredFor(this))throw new Error("Lock is not held");return this._actual.deltaExtensions(t,i)}containsActivationEvent(e){return this._actual.containsActivationEvent(e)}containsExtension(e){return this._actual.containsExtension(e)}getExtensionDescriptionsForActivationEvent(e){return this._actual.getExtensionDescriptionsForActivationEvent(e)}getAllExtensionDescriptions(){return this._actual.getAllExtensionDescriptions()}getSnapshot(){return this._actual.getSnapshot()}getExtensionDescription(e){return this._actual.getExtensionDescription(e)}getExtensionDescriptionByUUID(e){return this._actual.getExtensionDescriptionByUUID(e)}getExtensionDescriptionByIdOrUUID(e,t){return this._actual.getExtensionDescriptionByIdOrUUID(e,t)}}class KTe extends F{constructor(e,t){super(),this._registry=e,this._isDisposed=!1,this._register(t)}isAcquiredFor(e){return!this._isDisposed&&this._registry===e}}class jTe{constructor(e){this.name=e;const t=wE();this.promise=t.promise,this._resolve=t.resolve}resolve(e){this._resolve(e)}}class YTe{constructor(){this._pendingCustomers=[],this._isLocked=!1}async acquire(e){const t=new jTe(e);return this._pendingCustomers.push(t),this._advance(),t.promise}_advance(){if(this._isLocked||this._pendingCustomers.length===0)return;const e=this._pendingCustomers.shift();this._isLocked=!0;let t=!0;const i=setTimeout(()=>{t&&console.warn(`The customer named ${e.name} has been holding on to the lock for 30s. This might be a problem.`)},30*1e3),n=()=>{t&&(clearTimeout(i),t=!1,this._isLocked=!1,this._advance())};e.resolve(Ee(n))}}var tp;(function(s){s[s.Builtin=0]="Builtin",s[s.User=1]="User",s[s.Dev=2]="Dev"})(tp||(tp={}));function QTe(s,e){const t=s.isBuiltin?tp.Builtin:s.isUnderDevelopment?tp.Dev:tp.User,i=e.isBuiltin?tp.Builtin:e.isUnderDevelopment?tp.Dev:tp.User;if(t!==i)return t-i;const n=Zc.basename(s.extensionLocation.path),o=Zc.basename(e.extensionLocation.path);return n<o?-1:n>o?1:0}function SQ(s,e){const t=new Ume(e);return s.filter(i=>!t.has(i.identifier))}class XTe extends GIe{}var wR;(function(s){function e(i){return{remoteAddress:i.remoteAddress,localAddress:i.localAddress,public:!!i.public,privacy:i.privacy??(i.public?Eu.Public:Eu.Private),protocol:i.protocol}}s.fromApiTunnel=e;function t(i){return{remoteAddress:{host:i.tunnelRemoteHost,port:i.tunnelRemotePort},localAddress:i.localAddress,public:i.privacy!==Eu.ConstantPrivate&&i.privacy!==Eu.ConstantPrivate,privacy:i.privacy,protocol:i.protocol}}s.fromServiceTunnel=t})(wR||(wR={}));const Y9e=Z("IExtHostTunnelService");let CQ=class extends F{constructor(e,t,i){super(),this.logService=i,this._showCandidatePort=()=>Promise.resolve(!0),this._extensionTunnels=new Map,this._onDidChangeTunnels=new M,this.onDidChangeTunnels=this._onDidChangeTunnels.event,this._providerHandleCounter=0,this._portAttributesProviders=new Map,this._proxy=e.getProxy($e.MainThreadTunnelService)}async openTunnel(e,t){this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) ${e.identifier.value} called openTunnel API for ${t.remoteAddress.host}:${t.remoteAddress.port}.`);const i=await this._proxy.$openTunnel(t,e.displayName);if(i){const n=new XTe(i.remoteAddress,i.localAddress,()=>this._proxy.$closeTunnel(i.remoteAddress));return this._register(n),n}}async getTunnels(){return this._proxy.$getTunnels()}nextPortAttributesProviderHandle(){return this._providerHandleCounter++}registerPortsAttributesProvider(e,t){e.portRange===void 0&&e.commandPattern===void 0&&this.logService.error("PortAttributesProvider must specify either a portRange or a commandPattern");const i=this.nextPortAttributesProviderHandle();return this._portAttributesProviders.set(i,{selector:e,provider:t}),this._proxy.$registerPortsAttributesProvider(e,i),new cW(()=>{this._portAttributesProviders.delete(i),this._proxy.$unregisterPortsAttributesProvider(i)})}async $providePortAttributes(e,t,i,n,o){const r=[];for(const c of e){const d=this._portAttributesProviders.get(c);if(!d)return[];r.push(...await Promise.all(t.map(async l=>{let u;try{u=await d.provider.providePortAttributes({port:l,pid:i,commandLine:n},o)}catch{u=await d.provider.providePortAttributes(l,i,n,o)}return{providedAttributes:u,port:l}})))}const a=r.filter(c=>!!c.providedAttributes);return a.length>0?a.map(c=>({autoForwardAction:c.providedAttributes.autoForwardAction,port:c.port})):[]}async $registerCandidateFinder(e){}registerTunnelProvider(e,t){if(this._forwardPortProvider)throw new Error("A tunnel provider has already been registered. Only the first tunnel provider to be registered will be used.");this._forwardPortProvider=async(n,o)=>await e.provideTunnel(n,o,ye.None)??void 0;const i=t.tunnelFeatures?{elevation:!!t.tunnelFeatures?.elevation,privacyOptions:t.tunnelFeatures?.privacyOptions,protocol:t.tunnelFeatures.protocol===void 0?!0:t.tunnelFeatures.protocol}:void 0;return this._proxy.$setTunnelProvider(i,!0),Promise.resolve(Ee(()=>{this._forwardPortProvider=void 0,this._proxy.$setTunnelProvider(void 0,!1)}))}async setTunnelFactory(e,t){if(e){e.candidatePortSource!==void 0&&this._proxy.$setCandidatePortSource(e.candidatePortSource),e.showCandidatePort&&(this._showCandidatePort=e.showCandidatePort,this._proxy.$setCandidateFilter());const i=e.tunnelFactory??(t?this.makeManagedTunnelFactory(t):void 0);if(i){this._forwardPortProvider=i;let n=e.tunnelFeatures?.privacyOptions??[];e.tunnelFeatures?.public&&n.length===0&&(n=[{id:"private",label:h(2595,"Private"),themeIcon:"lock"},{id:"public",label:h(2596,"Public"),themeIcon:"eye"}]);const o=e.tunnelFeatures?{elevation:!!e.tunnelFeatures?.elevation,public:!!e.tunnelFeatures?.public,privacyOptions:n,protocol:!0}:void 0;this._proxy.$setTunnelProvider(o,!!e.tunnelFactory)}}else this._forwardPortProvider=void 0;return Ee(()=>{this._forwardPortProvider=void 0})}makeManagedTunnelFactory(e){}async $closeTunnel(e,t){if(this._extensionTunnels.has(e.host)){const i=this._extensionTunnels.get(e.host);i.has(e.port)&&(t&&i.get(e.port).disposeListener.dispose(),await i.get(e.port).tunnel.dispose(),i.delete(e.port))}}async $onDidTunnelsChange(){this._onDidChangeTunnels.fire()}async $forwardPort(e,t){if(this._forwardPortProvider)try{this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Getting tunnel from provider.");const i=this._forwardPortProvider(e,t);if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Got tunnel promise from provider."),i!==void 0){const n=await i;if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Successfully awaited tunnel from provider."),n===void 0){this.logService.error("ForwardedPorts: (ExtHostTunnelService) Resolved tunnel is undefined");return}this._extensionTunnels.has(e.remoteAddress.host)||this._extensionTunnels.set(e.remoteAddress.host,new Map);const o=this._register(n.onDidDispose(()=>(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Extension fired tunnel's onDidDispose."),this._proxy.$closeTunnel(n.remoteAddress))));return this._extensionTunnels.get(e.remoteAddress.host).set(e.remoteAddress.port,{tunnel:n,disposeListener:o}),wR.fromApiTunnel(n)}else this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Tunnel is undefined")}catch(i){if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) tunnel provider error"),i instanceof Error)return i.message}}async $applyCandidateFilter(e){const t=await Promise.all(e.map(n=>this._showCandidatePort(n.host,n.port,n.detail??""))),i=e.filter((n,o)=>t[o]);return this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) filtered from ${e.map(n=>n.port).join(", ")} to ${i.map(n=>n.port).join(", ")}`),i}};CQ=f([p(0,Xke),p(1,eTe),p(2,Pe)],CQ);const Ace="__";function ZTe(s){return typeof s=="object"&&"uri"in s&&"pattern"in s}let SR=class{constructor(e,t,i,n,o,r){this.configurationService=e,this.workspaceContextService=t,this.editorGroupsService=i,this.logService=n,this.pathService=o,this.uriIdentityService=r}aiText(e,t,i={}){return{...this.commonQuery(t?.map(wk),i),type:Ep.aiText,contentPattern:e}}text(e,t,i={}){e=this.getContentPattern(e,i);const n=this.configurationService.getValue(),o=t&&t.some(a=>!this.configurationService.getValue({resource:a}).search.useRipgrep);return{...this.commonQuery(t?.map(wk),i),type:Ep.Text,contentPattern:e,previewOptions:i.previewOptions,maxFileSize:i.maxFileSize,usePCRE2:n.search.usePCRE2||o||!1,surroundingContext:i.surroundingContext,userDisabledExcludesAndIgnoreFiles:i.disregardExcludeSettings&&i.disregardIgnoreFiles}}getContentPattern(e,t){const i=this.configurationService.getValue();e.isRegExp&&(e.pattern=e.pattern.replace(/\r?\n/g,"\\n"));const n={...e,wordSeparators:i.editor.wordSeparators};return this.isCaseSensitive(e,t)&&(n.isCaseSensitive=!0),this.isMultiline(e)&&(n.isMultiline=!0),t.notebookSearchConfig?.includeMarkupInput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookMarkdownInput=t.notebookSearchConfig.includeMarkupInput),t.notebookSearchConfig?.includeMarkupPreview&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookMarkdownPreview=t.notebookSearchConfig.includeMarkupPreview),t.notebookSearchConfig?.includeCodeInput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookCellInput=t.notebookSearchConfig.includeCodeInput),t.notebookSearchConfig?.includeOutput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookCellOutput=t.notebookSearchConfig.includeOutput),n}file(e,t={}){return{...this.commonQuery(e,t),type:Ep.File,filePattern:t.filePattern?t.filePattern.trim():t.filePattern,exists:t.exists,sortByScore:t.sortByScore,cacheKey:t.cacheKey,shouldGlobMatchFilePattern:t.shouldGlobSearch}}handleIncludeExclude(e,t){if(!e)return{};if(Array.isArray(e)){if(e=e.filter(i=>i.length>0).map($k),!e.length)return{}}else e=$k(e);return t?this.parseSearchPaths(e):{pattern:b0(...Array.isArray(e)?e:[e])}}commonQuery(e=[],t={}){let i=Array.isArray(t.excludePattern)?t.excludePattern.map(l=>l.pattern).flat():t.excludePattern;i=i?.length===1?i[0]:i;const n=this.handleIncludeExclude(t.includePattern,t.expandPatterns),o=this.handleIncludeExclude(i,t.expandPatterns),r=e.length>1,a=(n.searchPaths&&n.searchPaths.length?n.searchPaths.map(l=>this.getFolderQueryForSearchPath(l,t,o)):e.map(l=>this.getFolderQueryForRoot(l,t,o,r))).filter(l=>!!l),c={_reason:t._reason,folderQueries:a,usingSearchPaths:!!(n.searchPaths&&n.searchPaths.length),extraFileResources:t.extraFileResources,excludePattern:o.pattern,includePattern:n.pattern,onlyOpenEditors:t.onlyOpenEditors,maxResults:t.maxResults,onlyFileScheme:t.onlyFileScheme};if(t.onlyOpenEditors){const l=Vt(this.editorGroupsService.groups.flatMap(m=>m.editors.map(v=>v.resource)));this.logService.trace("QueryBuilder#commonQuery - openEditor URIs",JSON.stringify(l));const u=l.filter(m=>uQ(c,m.fsPath)),g=this.commonQueryFromFileList(u);return this.logService.trace("QueryBuilder#commonQuery - openEditor Query",JSON.stringify(g)),{...c,...g}}const d=t.extraFileResources&&t.extraFileResources.filter(l=>uQ(c,l.fsPath));return c.extraFileResources=d&&d.length?d:void 0,c}commonQueryFromFileList(e){const t=[],i=new wn,n={};let o=!1;return e.forEach(r=>{if(r.scheme===ae.walkThrough)return;if($me(r)){const c=this.workspaceContextService.getWorkspaceFolder(r)?.uri??this.uriIdentityService.extUri.dirname(r);let d=i.get(c);d||(o=!0,d={folder:c,includePattern:{}},t.push(d),i.set(c,d));const l=qM(c.fsPath,r.fsPath);Gt(d.includePattern)[l.replace(/\\/g,"/")]=!0}else r.fsPath&&(o=!0,n[r.fsPath]=!0)}),{folderQueries:t,includePattern:n,usingSearchPaths:!0,excludePattern:o?void 0:{"**/*":!0}}}isCaseSensitive(e,t){if(t.isSmartCase){if(e.isRegExp){if(SF(e.pattern,!0))return!0}else if(SF(e.pattern))return!0}return!!e.isCaseSensitive}isMultiline(e){return e.isMultiline||e.isRegExp&&Gme(e.pattern)||e.pattern.indexOf(`
`)>=0?!0:!!e.isMultiline}parseSearchPaths(e){const t=u=>iy(u)||/^\.\.?([\/\\]|$)/.test(u),n=(Array.isArray(e)?e:eAe(e)).map(u=>{const g=this.pathService.resolvedUserHome;return g?qme(u,g.scheme===ae.file?g.fsPath:g.path):u}),o=zme(n,u=>t(u)?"searchPaths":"exprSegments"),r=(o.exprSegments||[]).map(u=>$m(u,"/")).map(u=>$m(u,"\\")).map(u=>(u[0]==="."&&(u="*"+u),tAe(u))),a={},c=this.expandSearchPathPatterns(o.searchPaths||[]);c&&c.length&&(a.searchPaths=c);const d=r.flat(),l=b0(...d);return l&&(a.pattern=l),a}getExcludesForFolder(e,t){return t.disregardExcludeSettings?void 0:wce(e,!t.disregardSearchExcludeSettings)}expandSearchPathPatterns(e){if(!e||!e.length)return[];const t=e.flatMap(n=>{let{pathPortion:o,globPortion:r}=JTe(n);return r&&(r=y0(r)),this.expandOneSearchPath(o).flatMap(c=>this.resolveOneSearchPathPattern(c,r))}),i=new Map;return t.forEach(n=>{const o=n.searchPath.toString(),r=i.get(o);r?n.pattern&&(r.pattern=r.pattern||{},r.pattern[n.pattern]=!0):i.set(o,{searchPath:n.searchPath,pattern:n.pattern?b0(n.pattern):void 0})}),Array.from(i.values())}expandOneSearchPath(e){if(iy(e)){const t=this.workspaceContextService.getWorkspace().folders;return t[0]&&t[0].uri.scheme!==ae.file?[{searchPath:t[0].uri.with({path:e})}]:[{searchPath:R.file(oq(e))}]}if(this.workspaceContextService.getWorkbenchState()===zo.FOLDER){const t=this.workspaceContextService.getWorkspace().folders[0].uri;if(e=$k(e),e.startsWith("../")||e===".."){const n=Zc.resolve(t.path,e);return[{searchPath:t.with({path:n})}]}const i=y0(e);return[{searchPath:t,pattern:i}]}else{if(e==="./"||e===".\\")return[];{const t=e.replace(/^\.[\/\\]/,""),n=this.workspaceContextService.getWorkspace().folders.map(o=>{const r=t.match(new RegExp(`^${ny(o.name)}(?:/(.*)|$)`));return r?{match:r,folder:o}:null}).filter(ya);if(n.length)return n.map(o=>{const r=o.match[1];return{searchPath:o.folder.uri,pattern:r&&y0(r)}});{const o=e.match(/\.[\/\\](.+)[\/\\]?/),r=o?o[1]:e,a=h(12839,"Workspace folder does not exist: {0}",r);throw new Error(a)}}}}resolveOneSearchPathPattern(e,t){const i=e.pattern&&t?`${e.pattern}/${t}`:e.pattern||t,n=[{searchPath:e.searchPath,pattern:i}];return i&&!i.endsWith("**")&&n.push({searchPath:e.searchPath,pattern:i+"/**"}),n}getFolderQueryForSearchPath(e,t,i){const n=this.getFolderQueryForRoot(wk(e.searchPath),t,i,!1);return n?{...n,includePattern:e.pattern}:null}getFolderQueryForRoot(e,t,i,n){let o;const r=R.isUri(e)?e:e.uri;let a=t.excludePattern?.map(m=>{const v=t.excludePattern&&ZTe(m)?m.uri:void 0;return!v||!(R.isUri(e)&&this.uriIdentityService.extUri.isEqual(e,v))?v:void 0});if(a?.length||(a=[void 0]),i.searchPaths){const m=i.searchPaths.filter(v=>Dt(v.searchPath,r))[0];if(m&&!m.pattern)return null;m&&(o=m.pattern)}const c=this.configurationService.getValue({resource:r}),l={...this.getExcludesForFolder(c,t)||{},...o||{}},u=R.isUri(e)?je(e):e.name,g=a.map(m=>Object.keys(l).length>0?{folder:m,pattern:l}:void 0).filter(m=>m);return{folder:r,folderName:n?u:void 0,excludePattern:g,fileEncoding:c.files&&c.files.encoding,disregardIgnoreFiles:typeof t.disregardIgnoreFiles=="boolean"?t.disregardIgnoreFiles:!c.search?.useIgnoreFiles,disregardGlobalIgnoreFiles:typeof t.disregardGlobalIgnoreFiles=="boolean"?t.disregardGlobalIgnoreFiles:!c.search?.useGlobalIgnoreFiles,disregardParentIgnoreFiles:typeof t.disregardParentIgnoreFiles=="boolean"?t.disregardParentIgnoreFiles:!c.search?.useParentIgnoreFiles,ignoreSymlinks:typeof t.ignoreSymlinks=="boolean"?t.ignoreSymlinks:!c.search?.followSymlinks}}};SR=f([p(0,ne),p(1,Tt),p(2,Ie),p(3,Pe),p(4,_c),p(5,Zi)],SR);function JTe(s){const e=s.match(/[\*\{\}\(\)\[\]\?]/);if(e){const t=e.index,i=s.substr(0,t).match(/[/|\\][^/\\]*$/);if(i){let n=s.substr(0,i.index);return n.match(/[/\\]/)||(n+="/"),{pathPortion:n,globPortion:s.substr((i.index||0)+1)}}}return{pathPortion:s}}function b0(...s){return s.length?s.reduce((e,t)=>(e[t]=!0,e),Object.create(null)):void 0}function eAe(s){return qie(s,",").map(e=>e.trim()).filter(e=>!!e.length)}function tAe(s){return[`**/${s}/**`,`**/${s}`].map(t=>t.replace(/\*\*\/\*\*/g,"**"))}function $k(s){return s.replace(/\\/g,"/")}function y0(s){return $k(s).replace(/^\.\//,"").replace(/\/+$/g,"")}const iAe=7e3;function nAe(s,e){const t=e.activationEvents;if(!t)return Promise.resolve(void 0);const i=[],n=[];for(const l of t)if(/^workspaceContains:/.test(l)){const u=l.substr(18);u.indexOf("*")>=0||u.indexOf("?")>=0||s.forceUsingSearch?n.push(u):i.push(u)}if(i.length===0&&n.length===0)return Promise.resolve(void 0);const{promise:o,resolve:r}=wE(),a=l=>r({activationEvent:l}),c=Promise.all(i.map(l=>sAe(s,l,a))).then(()=>{}),d=oAe(s,e.identifier,n,a);return Promise.all([c,d]).then(()=>{r(void 0)}),o}async function sAe(s,e,t){for(const i of s.folders)if(await s.exists(xt(R.revive(i),e))){t(`workspaceContains:${e}`);return}}async function oAe(s,e,t,i){if(t.length===0)return Promise.resolve(void 0);const n=new ri,o=s.checkExists(s.folders,t,n.token),r=setTimeout(async()=>{n.cancel(),s.logService.info(`Not activating extension '${e.value}': Timed out while searching for 'workspaceContains' pattern ${t.join(",")}`)},iAe);let a=!1;try{a=await o}catch(c){gs(c)||mt(c)}n.dispose(),clearTimeout(r),a&&i(`workspaceContains:${t.join(",")}`)}function Rce(s,e,t,i){const n=s.get(J),o=s.get(DI),a=n.createInstance(SR).file(e.map(c=>wk(R.revive(c))),{_reason:"checkExists",includePattern:t,exists:!0});return o.fileSearch(a,i).then(c=>!!c.limitHit,c=>gs(c)?!1:Promise.reject(c))}function Pce(s,e,t,i){if(!s||i>200)return null;if(typeof s=="object"){if(s.$mid===Nn.Uri)return t?R.revive(e.transformIncoming(s)):e.transformIncoming(s);if(s instanceof Re)return null;for(const n in s)if(Object.hasOwnProperty.call(s,n)){const o=Pce(s[n],e,t,i+1);o!==null&&(s[n]=o)}}return null}function SS(s,e){const t=Pce(s,e,!1,0);return t===null?s:t}class Lce{constructor(){this._actual=null,this._actualOk=null,this._actualErr=null,this._hasValue=!1,this._value=null,this._hasErr=!1,this._err=null}get[Symbol.toStringTag](){return this.toString()}_ensureActual(){return this._actual||(this._actual=new Promise((e,t)=>{this._actualOk=e,this._actualErr=t,this._hasValue&&this._actualOk(this._value),this._hasErr&&this._actualErr(this._err)})),this._actual}resolveOk(e){this._hasValue||this._hasErr||(this._hasValue=!0,this._value=e,this._actual&&this._actualOk(e))}resolveErr(e){this._hasValue||this._hasErr||(this._hasErr=!0,this._err=e,this._actual?this._actualErr(e):mt(e))}then(e,t){return this._ensureActual().then(e,t)}catch(e){return this._ensureActual().then(void 0,e)}finally(e){return this._ensureActual().finally(e)}}class rAe extends Lce{constructor(){super(),this._hasErr=!0,this._err=new $s}}var EQ;function mV(s,e){try{return JSON.stringify(s,e)}catch{return"null"}}const AK="$$ref$$",aAe={[AK]:-1};function xQ(s,e=null,t=!1){const i=[];return{jsonString:(t?mV:JSON.stringify)(s,(o,r)=>{if(typeof r>"u")return aAe;if(typeof r=="object"){if(r instanceof Re){const a=i.push(r)-1;return{[AK]:a}}if(e)return e(o,r)}return r}),referencedBuffers:i}}function Mce(s,e,t){return JSON.parse(s,(i,n)=>{if(n){const o=n[AK];if(typeof o=="number")return e[o];if(t&&n.$mid===Nn.Uri)return t.transformIncoming(n)}return n})}function IQ(s,e){return JSON.stringify(s,e)}function cAe(s){return s?(e,t)=>t&&t.$mid===Nn.Uri?s.transformOutgoing(t):t:null}var zr;(function(s){s[s.LocalSide=0]="LocalSide",s[s.OtherSide=1]="OtherSide"})(zr||(zr={}));var Am;(function(s){s[s.Responsive=0]="Responsive",s[s.Unresponsive=1]="Unresponsive"})(Am||(Am={}));const dAe=()=>{},lAe=Symbol.for("rpcProtocol"),hAe=Symbol.for("rpcProxy");class CR extends F{static{EQ=lAe}static{this.UNRESPONSIVE_TIME=3*1e3}constructor(e,t=null,i=null){super(),this[EQ]=!0,this._onDidChangeResponsiveState=this._register(new M),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._protocol=e,this._logger=t,this._uriTransformer=i,this._uriReplacer=cAe(this._uriTransformer),this._isDisposed=!1,this._locals=[],this._proxies=[];for(let n=0,o=CN.count;n<o;n++)this._locals[n]=null,this._proxies[n]=null;this._lastMessageId=0,this._cancelInvokedHandlers=Object.create(null),this._pendingRPCReplies={},this._responsiveState=Am.Responsive,this._unacknowledgedCount=0,this._unresponsiveTime=0,this._asyncCheckUresponsive=this._register(new fn(()=>this._checkUnresponsive(),1e3)),this._register(this._protocol.onMessage(n=>this._receiveOneMessage(n)))}dispose(){this._isDisposed=!0,Object.keys(this._pendingRPCReplies).forEach(e=>{const t=this._pendingRPCReplies[e];delete this._pendingRPCReplies[e],t.resolveErr(Ib())}),super.dispose()}drain(){return typeof this._protocol.drain=="function"?this._protocol.drain():Promise.resolve()}_onWillSendRequest(e){this._unacknowledgedCount===0&&(this._unresponsiveTime=Date.now()+CR.UNRESPONSIVE_TIME),this._unacknowledgedCount++,this._asyncCheckUresponsive.isScheduled()||this._asyncCheckUresponsive.schedule()}_onDidReceiveAcknowledge(e){this._unresponsiveTime=Date.now()+CR.UNRESPONSIVE_TIME,this._unacknowledgedCount--,this._unacknowledgedCount===0&&this._asyncCheckUresponsive.cancel(),this._setResponsiveState(Am.Responsive)}_checkUnresponsive(){this._unacknowledgedCount!==0&&(Date.now()>this._unresponsiveTime?this._setResponsiveState(Am.Unresponsive):this._asyncCheckUresponsive.schedule())}_setResponsiveState(e){this._responsiveState!==e&&(this._responsiveState=e,this._onDidChangeResponsiveState.fire(this._responsiveState))}get responsiveState(){return this._responsiveState}transformIncomingURIs(e){return this._uriTransformer?SS(e,this._uriTransformer):e}getProxy(e){const{nid:t,sid:i}=e;return this._proxies[t]||(this._proxies[t]=this._createProxy(t,i)),this._proxies[t]}_createProxy(e,t){const i={get:(n,o)=>(typeof o=="string"&&!n[o]&&o.charCodeAt(0)===st.DollarSign&&(n[o]=(...r)=>this._remoteCall(e,o,r)),o===hAe?t:n[o])};return new Proxy(Object.create(null),i)}set(e,t){return this._locals[e.nid]=t,t}assertRegistered(e){for(let t=0,i=e.length;t<i;t++){const n=e[t];if(!this._locals[n.nid])throw new Error(`Missing proxy instance ${n.sid}`)}}_receiveOneMessage(e){if(this._isDisposed)return;const t=e.byteLength,i=Hn.read(e,0),n=i.readUInt8(),o=i.readUInt32();switch(n){case yn.RequestJSONArgs:case yn.RequestJSONArgsWithCancellation:{let{rpcId:r,method:a,args:c}=Ic.deserializeRequestJSONArgs(i);this._uriTransformer&&(c=SS(c,this._uriTransformer)),this._receiveRequest(t,o,r,a,c,n===yn.RequestJSONArgsWithCancellation);break}case yn.RequestMixedArgs:case yn.RequestMixedArgsWithCancellation:{let{rpcId:r,method:a,args:c}=Ic.deserializeRequestMixedArgs(i);this._uriTransformer&&(c=SS(c,this._uriTransformer)),this._receiveRequest(t,o,r,a,c,n===yn.RequestMixedArgsWithCancellation);break}case yn.Acknowledged:{this._logger?.logIncoming(t,o,zr.LocalSide,"ack"),this._onDidReceiveAcknowledge(o);break}case yn.Cancel:{this._receiveCancel(t,o);break}case yn.ReplyOKEmpty:{this._receiveReply(t,o,void 0);break}case yn.ReplyOKJSON:{let r=Ic.deserializeReplyOKJSON(i);this._uriTransformer&&(r=SS(r,this._uriTransformer)),this._receiveReply(t,o,r);break}case yn.ReplyOKJSONWithBuffers:{const r=Ic.deserializeReplyOKJSONWithBuffers(i,this._uriTransformer);this._receiveReply(t,o,r);break}case yn.ReplyOKVSBuffer:{const r=Ic.deserializeReplyOKVSBuffer(i);this._receiveReply(t,o,r);break}case yn.ReplyErrError:{let r=Ic.deserializeReplyErrError(i);this._uriTransformer&&(r=SS(r,this._uriTransformer)),this._receiveReplyErr(t,o,r);break}case yn.ReplyErrEmpty:{this._receiveReplyErr(t,o,void 0);break}default:console.error("received unexpected message"),console.error(e)}}_receiveRequest(e,t,i,n,o,r){this._logger?.logIncoming(e,t,zr.OtherSide,`receiveRequest ${UD(i)}.${n}(`,o);const a=String(t);let c,d;if(r){const u=new ri;o.push(u.token),c=this._invokeHandler(i,n,o),d=()=>u.cancel()}else c=this._invokeHandler(i,n,o),d=dAe;this._cancelInvokedHandlers[a]=d;const l=Ic.serializeAcknowledged(t);this._logger?.logOutgoing(l.byteLength,t,zr.OtherSide,"ack"),this._protocol.send(l),c.then(u=>{delete this._cancelInvokedHandlers[a];const g=Ic.serializeReplyOK(t,u,this._uriReplacer);this._logger?.logOutgoing(g.byteLength,t,zr.OtherSide,"reply:",u),this._protocol.send(g)},u=>{delete this._cancelInvokedHandlers[a];const g=Ic.serializeReplyErr(t,u);this._logger?.logOutgoing(g.byteLength,t,zr.OtherSide,"replyErr:",u),this._protocol.send(g)})}_receiveCancel(e,t){this._logger?.logIncoming(e,t,zr.OtherSide,"receiveCancel");const i=String(t);this._cancelInvokedHandlers[i]?.()}_receiveReply(e,t,i){this._logger?.logIncoming(e,t,zr.LocalSide,"receiveReply:",i);const n=String(t);if(!this._pendingRPCReplies.hasOwnProperty(n))return;const o=this._pendingRPCReplies[n];delete this._pendingRPCReplies[n],o.resolveOk(i)}_receiveReplyErr(e,t,i){this._logger?.logIncoming(e,t,zr.LocalSide,"receiveReplyErr:",i);const n=String(t);if(!this._pendingRPCReplies.hasOwnProperty(n))return;const o=this._pendingRPCReplies[n];delete this._pendingRPCReplies[n];let r;i&&(i.$isError?(r=new Error,r.name=i.name,r.message=i.message,r.stack=i.stack):r=i),o.resolveErr(r)}_invokeHandler(e,t,i){try{return Promise.resolve(this._doInvokeHandler(e,t,i))}catch(n){return Promise.reject(n)}}_doInvokeHandler(e,t,i){const n=this._locals[e];if(!n)throw new Error("Unknown actor "+UD(e));const o=n[t];if(typeof o!="function")throw new Error("Unknown method "+t+" on actor "+UD(e));return o.apply(n,i)}_remoteCall(e,t,i){if(this._isDisposed)return new rAe;let n=null;if(i.length>0&&ye.isCancellationToken(i[i.length-1])&&(n=i.pop()),n&&n.isCancellationRequested)return Promise.reject(Ib());const o=Ic.serializeRequestArguments(i,this._uriReplacer),r=++this._lastMessageId,a=String(r),c=new Lce,d=new U;n&&d.add(n.onCancellationRequested(()=>{const u=Ic.serializeCancel(r);this._logger?.logOutgoing(u.byteLength,r,zr.LocalSide,"cancel"),this._protocol.send(u)})),this._pendingRPCReplies[a]=new uAe(c,d),this._onWillSendRequest(r);const l=Ic.serializeRequest(r,e,t,o,!!n);return this._logger?.logOutgoing(l.byteLength,r,zr.LocalSide,`request: ${UD(e)}.${t}(`,i),this._protocol.send(l),c}}class uAe{constructor(e,t){this._promise=e,this._disposable=t}resolveOk(e){this._promise.resolveOk(e),this._disposable.dispose()}resolveErr(e){this._promise.resolveErr(e),this._disposable.dispose()}}class Hn{static alloc(e,t,i){const n=new Hn(Re.alloc(i+1+4),0);return n.writeUInt8(e),n.writeUInt32(t),n}static read(e,t){return new Hn(e,t)}get buffer(){return this._buff}constructor(e,t){this._buff=e,this._offset=t}static sizeUInt8(){return 1}static{this.sizeUInt32=4}writeUInt8(e){this._buff.writeUInt8(e,this._offset),this._offset+=1}readUInt8(){const e=this._buff.readUInt8(this._offset);return this._offset+=1,e}writeUInt32(e){this._buff.writeUInt32BE(e,this._offset),this._offset+=4}readUInt32(){const e=this._buff.readUInt32BE(this._offset);return this._offset+=4,e}static sizeShortString(e){return 1+e.byteLength}writeShortString(e){this._buff.writeUInt8(e.byteLength,this._offset),this._offset+=1,this._buff.set(e,this._offset),this._offset+=e.byteLength}readShortString(){const e=this._buff.readUInt8(this._offset);this._offset+=1;const i=this._buff.slice(this._offset,this._offset+e).toString();return this._offset+=e,i}static sizeLongString(e){return 4+e.byteLength}writeLongString(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}readLongString(){const e=this._buff.readUInt32BE(this._offset);this._offset+=4;const i=this._buff.slice(this._offset,this._offset+e).toString();return this._offset+=e,i}writeBuffer(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}static sizeVSBuffer(e){return 4+e.byteLength}writeVSBuffer(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}readVSBuffer(){const e=this._buff.readUInt32BE(this._offset);this._offset+=4;const t=this._buff.slice(this._offset,this._offset+e);return this._offset+=e,t}static sizeMixedArray(e){let t=0;t+=1;for(let i=0,n=e.length;i<n;i++){const o=e[i];switch(t+=1,o.type){case As.String:t+=this.sizeLongString(o.value);break;case As.VSBuffer:t+=this.sizeVSBuffer(o.value);break;case As.SerializedObjectWithBuffers:t+=this.sizeUInt32,t+=this.sizeLongString(o.value);for(let r=0;r<o.buffers.length;++r)t+=this.sizeVSBuffer(o.buffers[r]);break}}return t}writeMixedArray(e){this._buff.writeUInt8(e.length,this._offset),this._offset+=1;for(let t=0,i=e.length;t<i;t++){const n=e[t];switch(n.type){case As.String:this.writeUInt8(As.String),this.writeLongString(n.value);break;case As.VSBuffer:this.writeUInt8(As.VSBuffer),this.writeVSBuffer(n.value);break;case As.SerializedObjectWithBuffers:this.writeUInt8(As.SerializedObjectWithBuffers),this.writeUInt32(n.buffers.length),this.writeLongString(n.value);for(let o=0;o<n.buffers.length;++o)this.writeBuffer(n.buffers[o]);break;case As.Undefined:this.writeUInt8(As.Undefined);break}}}readMixedArray(){const e=this._buff.readUInt8(this._offset);this._offset+=1;const t=new Array(e);for(let i=0;i<e;i++)switch(this.readUInt8()){case As.String:t[i]=this.readLongString();break;case As.VSBuffer:t[i]=this.readVSBuffer();break;case As.SerializedObjectWithBuffers:{const o=this.readUInt32(),r=this.readLongString(),a=[];for(let c=0;c<o;++c)a.push(this.readVSBuffer());t[i]=new Jr(Mce(r,a,null));break}case As.Undefined:t[i]=void 0;break}return t}}var db;(function(s){s[s.Simple=0]="Simple",s[s.Mixed=1]="Mixed"})(db||(db={}));class Ic{static _useMixedArgSerialization(e){for(let t=0,i=e.length;t<i;t++)if(e[t]instanceof Re||e[t]instanceof Jr||typeof e[t]>"u")return!0;return!1}static serializeRequestArguments(e,t){if(this._useMixedArgSerialization(e)){const i=[];for(let n=0,o=e.length;n<o;n++){const r=e[n];if(r instanceof Re)i[n]={type:As.VSBuffer,value:r};else if(typeof r>"u")i[n]={type:As.Undefined};else if(r instanceof Jr){const{jsonString:a,referencedBuffers:c}=xQ(r.value,t);i[n]={type:As.SerializedObjectWithBuffers,value:Re.fromString(a),buffers:c}}else i[n]={type:As.String,value:Re.fromString(IQ(r,t))}}return{type:db.Mixed,args:i}}return{type:db.Simple,args:IQ(e,t)}}static serializeRequest(e,t,i,n,o){switch(n.type){case db.Simple:return this._requestJSONArgs(e,t,i,n.args,o);case db.Mixed:return this._requestMixedArgs(e,t,i,n.args,o)}}static _requestJSONArgs(e,t,i,n,o){const r=Re.fromString(i),a=Re.fromString(n);let c=0;c+=Hn.sizeUInt8(),c+=Hn.sizeShortString(r),c+=Hn.sizeLongString(a);const d=Hn.alloc(o?yn.RequestJSONArgsWithCancellation:yn.RequestJSONArgs,e,c);return d.writeUInt8(t),d.writeShortString(r),d.writeLongString(a),d.buffer}static deserializeRequestJSONArgs(e){const t=e.readUInt8(),i=e.readShortString(),n=e.readLongString();return{rpcId:t,method:i,args:JSON.parse(n)}}static _requestMixedArgs(e,t,i,n,o){const r=Re.fromString(i);let a=0;a+=Hn.sizeUInt8(),a+=Hn.sizeShortString(r),a+=Hn.sizeMixedArray(n);const c=Hn.alloc(o?yn.RequestMixedArgsWithCancellation:yn.RequestMixedArgs,e,a);return c.writeUInt8(t),c.writeShortString(r),c.writeMixedArray(n),c.buffer}static deserializeRequestMixedArgs(e){const t=e.readUInt8(),i=e.readShortString(),n=e.readMixedArray(),o=new Array(n.length);for(let r=0,a=n.length;r<a;r++){const c=n[r];typeof c=="string"?o[r]=JSON.parse(c):o[r]=c}return{rpcId:t,method:i,args:o}}static serializeAcknowledged(e){return Hn.alloc(yn.Acknowledged,e,0).buffer}static serializeCancel(e){return Hn.alloc(yn.Cancel,e,0).buffer}static serializeReplyOK(e,t,i){if(typeof t>"u")return this._serializeReplyOKEmpty(e);if(t instanceof Re)return this._serializeReplyOKVSBuffer(e,t);if(t instanceof Jr){const{jsonString:n,referencedBuffers:o}=xQ(t.value,i,!0);return this._serializeReplyOKJSONWithBuffers(e,n,o)}else return this._serializeReplyOKJSON(e,mV(t,i))}static _serializeReplyOKEmpty(e){return Hn.alloc(yn.ReplyOKEmpty,e,0).buffer}static _serializeReplyOKVSBuffer(e,t){let i=0;i+=Hn.sizeVSBuffer(t);const n=Hn.alloc(yn.ReplyOKVSBuffer,e,i);return n.writeVSBuffer(t),n.buffer}static deserializeReplyOKVSBuffer(e){return e.readVSBuffer()}static _serializeReplyOKJSON(e,t){const i=Re.fromString(t);let n=0;n+=Hn.sizeLongString(i);const o=Hn.alloc(yn.ReplyOKJSON,e,n);return o.writeLongString(i),o.buffer}static _serializeReplyOKJSONWithBuffers(e,t,i){const n=Re.fromString(t);let o=0;o+=Hn.sizeUInt32,o+=Hn.sizeLongString(n);for(const a of i)o+=Hn.sizeVSBuffer(a);const r=Hn.alloc(yn.ReplyOKJSONWithBuffers,e,o);r.writeUInt32(i.length),r.writeLongString(n);for(const a of i)r.writeBuffer(a);return r.buffer}static deserializeReplyOKJSON(e){const t=e.readLongString();return JSON.parse(t)}static deserializeReplyOKJSONWithBuffers(e,t){const i=e.readUInt32(),n=e.readLongString(),o=[];for(let r=0;r<i;++r)o.push(e.readVSBuffer());return new Jr(Mce(n,o,t))}static serializeReplyErr(e,t){const i=t?mV(CF(t),null):void 0;if(typeof i!="string")return this._serializeReplyErrEmpty(e);const n=Re.fromString(i);let o=0;o+=Hn.sizeLongString(n);const r=Hn.alloc(yn.ReplyErrError,e,o);return r.writeLongString(n),r.buffer}static deserializeReplyErrError(e){const t=e.readLongString();return JSON.parse(t)}static _serializeReplyErrEmpty(e){return Hn.alloc(yn.ReplyErrEmpty,e,0).buffer}}var yn;(function(s){s[s.RequestJSONArgs=1]="RequestJSONArgs",s[s.RequestJSONArgsWithCancellation=2]="RequestJSONArgsWithCancellation",s[s.RequestMixedArgs=3]="RequestMixedArgs",s[s.RequestMixedArgsWithCancellation=4]="RequestMixedArgsWithCancellation",s[s.Acknowledged=5]="Acknowledged",s[s.Cancel=6]="Cancel",s[s.ReplyOKEmpty=7]="ReplyOKEmpty",s[s.ReplyOKVSBuffer=8]="ReplyOKVSBuffer",s[s.ReplyOKJSON=9]="ReplyOKJSON",s[s.ReplyOKJSONWithBuffers=10]="ReplyOKJSONWithBuffers",s[s.ReplyErrError=11]="ReplyErrError",s[s.ReplyErrEmpty=12]="ReplyErrEmpty"})(yn||(yn={}));var As;(function(s){s[s.String=1]="String",s[s.VSBuffer=2]="VSBuffer",s[s.SerializedObjectWithBuffers=3]="SerializedObjectWithBuffers",s[s.Undefined=4]="Undefined"})(As||(As={}));var fa;(function(s){s[s.Promise=100]="Promise",s[s.PromiseCancel=101]="PromiseCancel",s[s.EventListen=102]="EventListen",s[s.EventDispose=103]="EventDispose"})(fa||(fa={}));function DQ(s){switch(s){case fa.Promise:return"req";case fa.PromiseCancel:return"cancel";case fa.EventListen:return"subscribe";case fa.EventDispose:return"unsubscribe"}}var rr;(function(s){s[s.Initialize=200]="Initialize",s[s.PromiseSuccess=201]="PromiseSuccess",s[s.PromiseError=202]="PromiseError",s[s.PromiseErrorObj=203]="PromiseErrorObj",s[s.EventFire=204]="EventFire"})(rr||(rr={}));function kQ(s){switch(s){case rr.Initialize:return"init";case rr.PromiseSuccess:return"reply:";case rr.PromiseError:case rr.PromiseErrorObj:return"replyErr:";case rr.EventFire:return"event:"}}var Xf;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Idle=1]="Idle"})(Xf||(Xf={}));function b_(s){let e=0;for(let t=0;;t+=7){const i=s.read(1);if(e|=(i.buffer[0]&127)<<t,!(i.buffer[0]&128))return e}}const gAe=Hg(0);function y_(s,e){if(e===0){s.write(gAe);return}let t=0;for(let n=e;n!==0;n=n>>>7)t++;const i=Re.alloc(t);for(let n=0;e!==0;n++)i.buffer[n]=e&127,e=e>>>7,e>0&&(i.buffer[n]|=128);s.write(i)}class pAe{constructor(e){this.buffer=e,this.pos=0}read(e){const t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=t.byteLength,t}}class fAe{constructor(){this.buffers=[]}get buffer(){return Re.concat(this.buffers)}write(e){this.buffers.push(e)}}var dr;(function(s){s[s.Undefined=0]="Undefined",s[s.String=1]="String",s[s.Buffer=2]="Buffer",s[s.VSBuffer=3]="VSBuffer",s[s.Array=4]="Array",s[s.Object=5]="Object",s[s.Int=6]="Int"})(dr||(dr={}));function Hg(s){const e=Re.alloc(1);return e.writeUInt8(s,0),e}const Mf={Undefined:Hg(dr.Undefined),String:Hg(dr.String),Buffer:Hg(dr.Buffer),VSBuffer:Hg(dr.VSBuffer),Array:Hg(dr.Array),Object:Hg(dr.Object),Uint:Hg(dr.Int)},mAe=typeof Buffer<"u";function vV(s,e){if(typeof e>"u")s.write(Mf.Undefined);else if(typeof e=="string"){const t=Re.fromString(e);s.write(Mf.String),y_(s,t.byteLength),s.write(t)}else if(mAe&&Buffer.isBuffer(e)){const t=Re.wrap(e);s.write(Mf.Buffer),y_(s,t.byteLength),s.write(t)}else if(e instanceof Re)s.write(Mf.VSBuffer),y_(s,e.byteLength),s.write(e);else if(Array.isArray(e)){s.write(Mf.Array),y_(s,e.length);for(const t of e)vV(s,t)}else if(typeof e=="number"&&(e|0)===e)s.write(Mf.Uint),y_(s,e);else{const t=Re.fromString(JSON.stringify(e));s.write(Mf.Object),y_(s,t.byteLength),s.write(t)}}function _V(s){switch(s.read(1).readUInt8(0)){case dr.Undefined:return;case dr.String:return s.read(b_(s)).toString();case dr.Buffer:return s.read(b_(s)).buffer;case dr.VSBuffer:return s.read(b_(s));case dr.Array:{const t=b_(s),i=[];for(let n=0;n<t;n++)i.push(_V(s));return i}case dr.Object:return JSON.parse(s.read(b_(s)).toString());case dr.Int:return b_(s)}}var lb;(function(s){s[s.LocalSide=0]="LocalSide",s[s.OtherSide=1]="OtherSide"})(lb||(lb={}));class TQ{constructor(e,t=null){this.protocol=e,this.isDisposed=!1,this.state=Xf.Uninitialized,this.activeRequests=new Set,this.handlers=new Map,this.lastRequestId=0,this._onDidInitialize=new M,this.onDidInitialize=this._onDidInitialize.event,this.protocolListener=this.protocol.onMessage(i=>this.onBuffer(i)),this.logger=t}getChannel(e){const t=this;return{call(i,n,o){return t.isDisposed?Promise.reject(new $s):t.requestPromise(e,i,n,o)},listen(i,n){return t.isDisposed?D.None:t.requestEvent(e,i,n)}}}requestPromise(e,t,i,n=ye.None){const o=this.lastRequestId++,r=fa.Promise,a={id:o,type:r,channelName:e,name:t,arg:i};if(n.isCancellationRequested)return Promise.reject(new $s);let c,d;return new Promise((u,g)=>{if(n.isCancellationRequested)return g(new $s);const m=()=>{const w=C=>{switch(C.type){case rr.PromiseSuccess:this.handlers.delete(o),u(C.data);break;case rr.PromiseError:{this.handlers.delete(o);const T=new Error(C.data.message);T.stack=Array.isArray(C.data.stack)?C.data.stack.join(`
`):C.data.stack,T.name=C.data.name,g(T);break}case rr.PromiseErrorObj:this.handlers.delete(o),g(C.data);break}};this.handlers.set(o,w),this.sendRequest(a)};let v=null;this.state===Xf.Idle?m():(v=En(w=>this.whenInitialized()),v.then(()=>{v=null,m()}));const y=()=>{v?(v.cancel(),v=null):this.sendRequest({id:o,type:fa.PromiseCancel}),g(new $s)};c=n.onCancellationRequested(y),d={dispose:hw(()=>{y(),c.dispose()})},this.activeRequests.add(d)}).finally(()=>{c?.dispose(),this.activeRequests.delete(d)})}requestEvent(e,t,i){const n=this.lastRequestId++,o=fa.EventListen,r={id:n,type:o,channelName:e,name:t,arg:i};let a=null;const c=new M({onWillAddFirstListener:()=>{const l=()=>{this.activeRequests.add(c),this.sendRequest(r)};this.state===Xf.Idle?l():(a=En(u=>this.whenInitialized()),a.then(()=>{a=null,l()}))},onDidRemoveLastListener:()=>{a?(a.cancel(),a=null):(this.activeRequests.delete(c),this.sendRequest({id:n,type:fa.EventDispose}))}}),d=l=>c.fire(l.data);return this.handlers.set(n,d),c.event}sendRequest(e){switch(e.type){case fa.Promise:case fa.EventListen:{const t=this.send([e.type,e.id,e.channelName,e.name],e.arg);this.logger?.logOutgoing(t,e.id,lb.LocalSide,`${DQ(e.type)}: ${e.channelName}.${e.name}`,e.arg);return}case fa.PromiseCancel:case fa.EventDispose:{const t=this.send([e.type,e.id]);this.logger?.logOutgoing(t,e.id,lb.LocalSide,DQ(e.type));return}}}send(e,t=void 0){const i=new fAe;return vV(i,e),vV(i,t),this.sendBuffer(i.buffer)}sendBuffer(e){try{return this.protocol.send(e),e.byteLength}catch{return 0}}onBuffer(e){const t=new pAe(e),i=_V(t),n=_V(t),o=i[0];switch(o){case rr.Initialize:return this.logger?.logIncoming(e.byteLength,0,lb.LocalSide,kQ(o)),this.onResponse({type:i[0]});case rr.PromiseSuccess:case rr.PromiseError:case rr.EventFire:case rr.PromiseErrorObj:return this.logger?.logIncoming(e.byteLength,i[1],lb.LocalSide,kQ(o),n),this.onResponse({type:i[0],id:i[1],data:n})}}onResponse(e){if(e.type===rr.Initialize){this.state=Xf.Idle,this._onDidInitialize.fire();return}this.handlers.get(e.id)?.(e)}get onDidInitializePromise(){return D.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===Xf.Idle?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),Qe(this.activeRequests.values()),this.activeRequests.clear()}}TQ.__decorator=f([Ht],TQ.prototype,"onDidInitializePromise",null);var AQ;(function(s){function e(o,r,a){const c=o,d=a&&a.disableMarshalling,l=new Map;for(const u in c)i(u)&&l.set(u,D.buffer(c[u],!0,void 0,r));return new class{listen(u,g,m){const v=l.get(g);if(v)return v;const y=c[g];if(typeof y=="function"){if(n(g))return y.call(c,m);if(i(g))return l.set(g,D.buffer(c[g],!0,void 0,r)),l.get(g)}throw new hr(`Event not found: ${g}`)}call(u,g,m){const v=c[g];if(typeof v=="function"){if(!d&&Array.isArray(m))for(let w=0;w<m.length;w++)m[w]=cn(m[w]);let y=v.apply(c,m);return y instanceof Promise||(y=Promise.resolve(y)),y}throw new hr(`Method not found: ${g}`)}}}s.fromService=e;function t(o,r){const a=r&&r.disableMarshalling;return new Proxy({},{get(c,d){if(typeof d=="string")return r?.properties?.has(d)?r.properties.get(d):n(d)?function(l){return o.listen(d,l)}:i(d)?o.listen(d):async function(...l){let u;r&&!_p(r.context)?u=[r.context,...l]:u=l;const g=await o.call(d,u);return a?g:cn(g)};throw new hr(`Property not found: ${String(d)}`)}})}s.toService=t;function i(o){return o[0]==="o"&&o[1]==="n"&&WT(o.charCodeAt(2))}function n(o){return/^onDynamic/.test(o)&&WT(o.charCodeAt(9))}})(AQ||(AQ={}));var Rm;(function(s){s.Created="created",s.Read="read",s.Write="write",s.Open="open",s.Error="error",s.Close="close",s.BrowserWebSocketBlobReceived="browserWebSocketBlobReceived",s.NodeEndReceived="nodeEndReceived",s.NodeEndSent="nodeEndSent",s.NodeDrainBegin="nodeDrainBegin",s.NodeDrainEnd="nodeDrainEnd",s.zlibInflateError="zlibInflateError",s.zlibInflateData="zlibInflateData",s.zlibInflateInitialWrite="zlibInflateInitialWrite",s.zlibInflateInitialFlushFired="zlibInflateInitialFlushFired",s.zlibInflateWrite="zlibInflateWrite",s.zlibInflateFlushFired="zlibInflateFlushFired",s.zlibDeflateError="zlibDeflateError",s.zlibDeflateData="zlibDeflateData",s.zlibDeflateWrite="zlibDeflateWrite",s.zlibDeflateFlushFired="zlibDeflateFlushFired",s.WebSocketNodeSocketWrite="webSocketNodeSocketWrite",s.WebSocketNodeSocketPeekedHeader="webSocketNodeSocketPeekedHeader",s.WebSocketNodeSocketReadHeader="webSocketNodeSocketReadHeader",s.WebSocketNodeSocketReadData="webSocketNodeSocketReadData",s.WebSocketNodeSocketUnmaskedData="webSocketNodeSocketUnmaskedData",s.WebSocketNodeSocketDrainBegin="webSocketNodeSocketDrainBegin",s.WebSocketNodeSocketDrainEnd="webSocketNodeSocketDrainEnd",s.ProtocolHeaderRead="protocolHeaderRead",s.ProtocolMessageRead="protocolMessageRead",s.ProtocolHeaderWrite="protocolHeaderWrite",s.ProtocolMessageWrite="protocolMessageWrite",s.ProtocolWrite="protocolWrite"})(Rm||(Rm={}));var bV;(function(s){s.enableDiagnostics=!1,s.records=[];const e=new WeakMap;let t=0;function i(o,r){if(!e.has(o)){const a=String(++t);e.set(o,a)}return e.get(o)}function n(o,r,a,c){if(!s.enableDiagnostics)return;const d=i(o);if(c instanceof Re||c instanceof Uint8Array||c instanceof ArrayBuffer||ArrayBuffer.isView(c)){const l=Re.alloc(c.byteLength);l.set(c),s.records.push({timestamp:Date.now(),id:d,label:r,type:a,buff:l})}else s.records.push({timestamp:Date.now(),id:d,label:r,type:a,data:c})}s.traceSocketEvent=n})(bV||(bV={}));var ER;(function(s){s[s.NodeSocketCloseEvent=0]="NodeSocketCloseEvent",s[s.WebSocketCloseEvent=1]="WebSocketCloseEvent"})(ER||(ER={}));let w0=null;function Ug(){return w0||(w0=Re.alloc(0)),w0}class vAe{get byteLength(){return this._totalLength}constructor(){this._chunks=[],this._totalLength=0}acceptChunk(e){this._chunks.push(e),this._totalLength+=e.byteLength}read(e){return this._read(e,!0)}peek(e){return this._read(e,!1)}_read(e,t){if(e===0)return Ug();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const r=this._chunks[0];return t&&(this._chunks.shift(),this._totalLength-=e),r}if(this._chunks[0].byteLength>e){const r=this._chunks[0].slice(0,e);return t&&(this._chunks[0]=this._chunks[0].slice(e),this._totalLength-=e),r}const i=Re.alloc(e);let n=0,o=0;for(;e>0;){const r=this._chunks[o];if(r.byteLength>e){const a=r.slice(0,e);i.set(a,n),n+=e,t&&(this._chunks[o]=r.slice(e),this._totalLength-=e),e-=e}else i.set(r,n),n+=r.byteLength,t?(this._chunks.shift(),this._totalLength-=r.byteLength):o++,e-=r.byteLength}return i}}var an;(function(s){s[s.None=0]="None",s[s.Regular=1]="Regular",s[s.Control=2]="Control",s[s.Ack=3]="Ack",s[s.Disconnect=5]="Disconnect",s[s.ReplayRequest=6]="ReplayRequest",s[s.Pause=7]="Pause",s[s.Resume=8]="Resume",s[s.KeepAlive=9]="KeepAlive"})(an||(an={}));function Nce(s){switch(s){case an.None:return"None";case an.Regular:return"Regular";case an.Control:return"Control";case an.Ack:return"Ack";case an.Disconnect:return"Disconnect";case an.ReplayRequest:return"ReplayRequest";case an.Pause:return"PauseWriting";case an.Resume:return"ResumeWriting";case an.KeepAlive:return"KeepAlive"}}var pa;(function(s){s[s.HeaderLength=13]="HeaderLength",s[s.AcknowledgeTime=2e3]="AcknowledgeTime",s[s.TimeoutTime=2e4]="TimeoutTime",s[s.ReconnectionGraceTime=108e5]="ReconnectionGraceTime",s[s.ReconnectionShortGraceTime=3e5]="ReconnectionShortGraceTime",s[s.KeepAliveSendTime=5e3]="KeepAliveSendTime"})(pa||(pa={}));class Vl{constructor(e,t,i,n){this.type=e,this.id=t,this.ack=i,this.data=n,this.writtenTime=0}get size(){return this.data.byteLength}}class RQ extends F{constructor(e){super(),this._onMessage=this._register(new M),this.onMessage=this._onMessage.event,this._state={readHead:!0,readLen:pa.HeaderLength,messageType:an.None,id:0,ack:0},this._socket=e,this._isDisposed=!1,this._incomingData=new vAe,this._register(this._socket.onData(t=>this.acceptChunk(t))),this.lastReadTime=Date.now()}acceptChunk(e){if(!(!e||e.byteLength===0))for(this.lastReadTime=Date.now(),this._incomingData.acceptChunk(e);this._incomingData.byteLength>=this._state.readLen;){const t=this._incomingData.read(this._state.readLen);if(this._state.readHead)this._state.readHead=!1,this._state.readLen=t.readUInt32BE(9),this._state.messageType=t.readUInt8(0),this._state.id=t.readUInt32BE(1),this._state.ack=t.readUInt32BE(5),this._socket.traceSocketEvent(Rm.ProtocolHeaderRead,{messageType:Nce(this._state.messageType),id:this._state.id,ack:this._state.ack,messageSize:this._state.readLen});else{const i=this._state.messageType,n=this._state.id,o=this._state.ack;if(this._state.readHead=!0,this._state.readLen=pa.HeaderLength,this._state.messageType=an.None,this._state.id=0,this._state.ack=0,this._socket.traceSocketEvent(Rm.ProtocolMessageRead,t),this._onMessage.fire(new Vl(i,n,o,t)),this._isDisposed)break}}}readEntireBuffer(){return this._incomingData.read(this._incomingData.byteLength)}dispose(){this._isDisposed=!0,super.dispose()}}class PQ{constructor(e){this._writeNowTimeout=null,this._isDisposed=!1,this._isPaused=!1,this._socket=e,this._data=[],this._totalLength=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this._isDisposed=!0}drain(){return this.flush(),this._socket.drain()}flush(){this._writeNow()}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this._scheduleWriting()}write(e){if(this._isDisposed)return;e.writtenTime=Date.now(),this.lastWriteTime=Date.now();const t=Re.alloc(pa.HeaderLength);t.writeUInt8(e.type,0),t.writeUInt32BE(e.id,1),t.writeUInt32BE(e.ack,5),t.writeUInt32BE(e.data.byteLength,9),this._socket.traceSocketEvent(Rm.ProtocolHeaderWrite,{messageType:Nce(e.type),id:e.id,ack:e.ack,messageSize:e.data.byteLength}),this._socket.traceSocketEvent(Rm.ProtocolMessageWrite,e.data),this._writeSoon(t,e.data)}_bufferAdd(e,t){const i=this._totalLength===0;return this._data.push(e,t),this._totalLength+=e.byteLength+t.byteLength,i}_bufferTake(){const e=Re.concat(this._data,this._totalLength);return this._data.length=0,this._totalLength=0,e}_writeSoon(e,t){this._bufferAdd(e,t)&&this._scheduleWriting()}_scheduleWriting(){this._writeNowTimeout||(this._writeNowTimeout=setTimeout(()=>{this._writeNowTimeout=null,this._writeNow()}))}_writeNow(){if(this._totalLength===0||this._isPaused)return;const e=this._bufferTake();this._socket.traceSocketEvent(Rm.ProtocolWrite,{byteLength:e.byteLength}),this._socket.write(e)}}class CS{constructor(){this._hasListeners=!1,this._isDeliveringMessages=!1,this._bufferedMessages=[],this._emitter=new M({onWillAddFirstListener:()=>{this._hasListeners=!0,queueMicrotask(()=>this._deliverMessages())},onDidRemoveLastListener:()=>{this._hasListeners=!1}}),this.event=this._emitter.event}_deliverMessages(){if(!this._isDeliveringMessages){for(this._isDeliveringMessages=!0;this._hasListeners&&this._bufferedMessages.length>0;)this._emitter.fire(this._bufferedMessages.shift());this._isDeliveringMessages=!1}}fire(e){this._hasListeners?this._bufferedMessages.length>0?this._bufferedMessages.push(e):this._emitter.fire(e):this._bufferedMessages.push(e)}flushBuffer(){this._bufferedMessages=[]}}class _Ae{constructor(e){this.data=e,this.next=null}}class bAe{constructor(){this._first=null,this._last=null}length(){let e=0,t=this._first;for(;t;)t=t.next,e++;return e}peek(){return this._first?this._first.data:null}toArray(){const e=[];let t=0,i=this._first;for(;i;)e[t++]=i.data,i=i.next;return e}pop(){if(this._first){if(this._first===this._last){this._first=null,this._last=null;return}this._first=this._first.next}}push(e){const t=new _Ae(e);if(!this._first){this._first=t,this._last=t;return}this._last.next=t,this._last=t}}class Fd{static{this._HISTORY_LENGTH=10}static{this._INSTANCE=null}static getInstance(){return Fd._INSTANCE||(Fd._INSTANCE=new Fd),Fd._INSTANCE}constructor(){this.lastRuns=[];const e=Date.now();for(let t=0;t<Fd._HISTORY_LENGTH;t++)this.lastRuns[t]=e-1e3*t;setInterval(()=>{for(let t=Fd._HISTORY_LENGTH;t>=1;t--)this.lastRuns[t]=this.lastRuns[t-1];this.lastRuns[0]=Date.now()},1e3)}load(){const e=Date.now(),t=(1+Fd._HISTORY_LENGTH)*1e3;let i=0;for(let n=0;n<Fd._HISTORY_LENGTH;n++)e-this.lastRuns[n]<=t&&i++;return 1-i/Fd._HISTORY_LENGTH}hasHighLoad(){return this.load()>=.5}}class yAe{get unacknowledgedCount(){return this._outgoingMsgId-this._outgoingAckId}constructor(e){this._onControlMessage=new CS,this.onControlMessage=this._onControlMessage.event,this._onMessage=new CS,this.onMessage=this._onMessage.event,this._onDidDispose=new CS,this.onDidDispose=this._onDidDispose.event,this._onSocketClose=new CS,this.onSocketClose=this._onSocketClose.event,this._onSocketTimeout=new CS,this.onSocketTimeout=this._onSocketTimeout.event,this._loadEstimator=e.loadEstimator??Fd.getInstance(),this._shouldSendKeepAlive=e.sendKeepAlive??!0,this._isReconnecting=!1,this._outgoingUnackMsg=new bAe,this._outgoingMsgId=0,this._outgoingAckId=0,this._outgoingAckTimeout=null,this._incomingMsgId=0,this._incomingAckId=0,this._incomingMsgLastTime=0,this._incomingAckTimeout=null,this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socketDisposables=new U,this._socket=e.socket,this._socketWriter=this._socketDisposables.add(new PQ(this._socket)),this._socketReader=this._socketDisposables.add(new RQ(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(t=>this._receiveMessage(t))),this._socketDisposables.add(this._socket.onClose(t=>this._onSocketClose.fire(t))),e.initialChunk&&this._socketReader.acceptChunk(e.initialChunk),this._shouldSendKeepAlive?this._keepAliveInterval=setInterval(()=>{this._sendKeepAlive()},pa.KeepAliveSendTime):this._keepAliveInterval=null}dispose(){this._outgoingAckTimeout&&(clearTimeout(this._outgoingAckTimeout),this._outgoingAckTimeout=null),this._incomingAckTimeout&&(clearTimeout(this._incomingAckTimeout),this._incomingAckTimeout=null),this._keepAliveInterval&&(clearInterval(this._keepAliveInterval),this._keepAliveInterval=null),this._socketDisposables.dispose()}drain(){return this._socketWriter.drain()}sendDisconnect(){if(!this._didSendDisconnect){this._didSendDisconnect=!0;const e=new Vl(an.Disconnect,0,0,Ug());this._socketWriter.write(e),this._socketWriter.flush()}}sendPause(){const e=new Vl(an.Pause,0,0,Ug());this._socketWriter.write(e)}sendResume(){const e=new Vl(an.Resume,0,0,Ug());this._socketWriter.write(e)}pauseSocketWriting(){this._socketWriter.pause()}getSocket(){return this._socket}getMillisSinceLastIncomingData(){return Date.now()-this._socketReader.lastReadTime}beginAcceptReconnection(e,t){this._isReconnecting=!0,this._socketDisposables.dispose(),this._socketDisposables=new U,this._onControlMessage.flushBuffer(),this._onSocketClose.flushBuffer(),this._onSocketTimeout.flushBuffer(),this._socket.dispose(),this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socket=e,this._socketWriter=this._socketDisposables.add(new PQ(this._socket)),this._socketReader=this._socketDisposables.add(new RQ(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(i=>this._receiveMessage(i))),this._socketDisposables.add(this._socket.onClose(i=>this._onSocketClose.fire(i))),this._socketReader.acceptChunk(t)}endAcceptReconnection(){this._isReconnecting=!1,this._incomingAckId=this._incomingMsgId;const e=new Vl(an.Ack,0,this._incomingAckId,Ug());this._socketWriter.write(e);const t=this._outgoingUnackMsg.toArray();for(let i=0,n=t.length;i<n;i++)this._socketWriter.write(t[i]);this._recvAckCheck()}acceptDisconnect(){this._onDidDispose.fire()}_receiveMessage(e){if(e.ack>this._outgoingAckId){this._outgoingAckId=e.ack;do{const t=this._outgoingUnackMsg.peek();if(t&&t.id<=e.ack)this._outgoingUnackMsg.pop();else break}while(!0)}switch(e.type){case an.None:break;case an.Regular:{if(e.id>this._incomingMsgId)if(e.id!==this._incomingMsgId+1){const t=Date.now();t-this._lastReplayRequestTime>1e4&&(this._lastReplayRequestTime=t,this._socketWriter.write(new Vl(an.ReplayRequest,0,0,Ug())))}else this._incomingMsgId=e.id,this._incomingMsgLastTime=Date.now(),this._sendAckCheck(),this._onMessage.fire(e.data);break}case an.Control:{this._onControlMessage.fire(e.data);break}case an.Ack:break;case an.Disconnect:{this._onDidDispose.fire();break}case an.ReplayRequest:{const t=this._outgoingUnackMsg.toArray();for(let i=0,n=t.length;i<n;i++)this._socketWriter.write(t[i]);this._recvAckCheck();break}case an.Pause:{this._socketWriter.pause();break}case an.Resume:{this._socketWriter.resume();break}}}readEntireBuffer(){return this._socketReader.readEntireBuffer()}flush(){this._socketWriter.flush()}send(e){const t=++this._outgoingMsgId;this._incomingAckId=this._incomingMsgId;const i=new Vl(an.Regular,t,this._incomingAckId,e);this._outgoingUnackMsg.push(i),this._isReconnecting||(this._socketWriter.write(i),this._recvAckCheck())}sendControl(e){const t=new Vl(an.Control,0,0,e);this._socketWriter.write(t)}_sendAckCheck(){if(this._incomingMsgId<=this._incomingAckId||this._incomingAckTimeout)return;const e=Date.now()-this._incomingMsgLastTime;if(e>=pa.AcknowledgeTime){this._sendAck();return}this._incomingAckTimeout=setTimeout(()=>{this._incomingAckTimeout=null,this._sendAckCheck()},pa.AcknowledgeTime-e+5)}_recvAckCheck(){if(this._outgoingMsgId<=this._outgoingAckId||this._outgoingAckTimeout||this._isReconnecting)return;const e=this._outgoingUnackMsg.peek(),t=Date.now()-e.writtenTime,i=Date.now()-this._socketReader.lastReadTime,n=Date.now()-this._lastSocketTimeoutTime;if(t>=pa.TimeoutTime&&i>=pa.TimeoutTime&&n>=pa.TimeoutTime&&!this._loadEstimator.hasHighLoad()){this._lastSocketTimeoutTime=Date.now(),this._onSocketTimeout.fire({unacknowledgedMsgCount:this._outgoingUnackMsg.length(),timeSinceOldestUnacknowledgedMsg:t,timeSinceLastReceivedSomeData:i});return}const o=Math.max(pa.TimeoutTime-t,pa.TimeoutTime-i,pa.TimeoutTime-n,500);this._outgoingAckTimeout=setTimeout(()=>{this._outgoingAckTimeout=null,this._recvAckCheck()},o)}_sendAck(){if(this._incomingMsgId<=this._incomingAckId)return;this._incomingAckId=this._incomingMsgId;const e=new Vl(an.Ack,0,this._incomingAckId,Ug());this._socketWriter.write(e)}_sendKeepAlive(){this._incomingAckId=this._incomingMsgId;const e=new Vl(an.KeepAlive,0,this._incomingAckId,Ug());this._socketWriter.write(e)}}var Lt;(function(s){s[s.LocalProcess=1]="LocalProcess",s[s.LocalWebWorker=2]="LocalWebWorker",s[s.Remote=3]="Remote"})(Lt||(Lt={}));function oh(s){if(s===null)return"None";switch(s){case Lt.LocalProcess:return"LocalProcess";case Lt.LocalWebWorker:return"LocalWebWorker";case Lt.Remote:return"Remote"}}var Zr;(function(s){s[s.None=0]="None",s[s.Local=1]="Local",s[s.Remote=2]="Remote"})(Zr||(Zr={}));function wAe(s){switch(s){case Zr.None:return"None";case Zr.Local:return"Local";case Zr.Remote:return"Remote"}}function SAe(s,e,t,i){const n=LQ(s,t),o=LQ(e,t),r=new Map,a=d=>{if(r.has(d.key))return;const l=n.get(d.key)||null,u=o.get(d.key)||null,g=new EAe(l,u);r.set(g.key,g)};n.forEach(d=>a(d)),o.forEach(d=>a(d));const c=new Map;return r.forEach(d=>{const l=!!d.local,u=!!d.remote,g=!!(d.local&&d.local.isUnderDevelopment),m=!!(d.remote&&d.remote.isUnderDevelopment);let v=Zr.None;g&&!m?v=Zr.Local:m&&!g&&(v=Zr.Remote),c.set(d.key,i(d.identifier,d.kind,l,u,v))}),c}function LQ(s,e){const t=new Map;return s.forEach(i=>{const n=new CAe(i,e(i));t.set(n.key,n)}),t}class CAe{constructor(e,t){this.desc=e,this.kind=t}get key(){return Es.toKey(this.desc.identifier)}get isUnderDevelopment(){return this.desc.isUnderDevelopment}}class EAe{constructor(e,t){this.local=e,this.remote=t}get key(){return this.local?this.local.key:this.remote.key}get identifier(){return this.local?this.local.desc.identifier:this.remote.desc.identifier}get kind(){return this.local?this.local.kind:this.remote.kind}}var dx;(function(s){s[s.Full=1]="Full",s[s.Delta=2]="Delta"})(dx||(dx={}));function Oce(s){for(let e=0,t=s.length;e<t;e+=4){const i=s[e+0],n=s[e+1],o=s[e+2],r=s[e+3];s[e+0]=r,s[e+1]=o,s[e+2]=n,s[e+3]=i}}function xAe(s){const e=new Uint8Array(s.buffer,s.byteOffset,s.length*4);return zie()||Oce(e),Re.wrap(e)}function IAe(s){const e=s.buffer;if(zie()||Oce(e),e.byteOffset%4===0)return new Uint32Array(e.buffer,e.byteOffset,e.length/4);{const t=new Uint8Array(e.byteLength);return t.set(e),new Uint32Array(t.buffer,t.byteOffset,t.length/4)}}function Fce(s){const e=new Uint32Array(DAe(s));let t=0;if(e[t++]=s.id,s.type==="full")e[t++]=dx.Full,e[t++]=s.data.length,e.set(s.data,t),t+=s.data.length;else{e[t++]=dx.Delta,e[t++]=s.deltas.length;for(const i of s.deltas)e[t++]=i.start,e[t++]=i.deleteCount,i.data?(e[t++]=i.data.length,e.set(i.data,t),t+=i.data.length):e[t++]=0}return xAe(e)}function DAe(s){let e=0;if(e+=2,s.type==="full")e+=1+s.data.length;else{e+=1,e+=3*s.deltas.length;for(const t of s.deltas)t.data&&(e+=t.data.length)}return e}function Wce(s){const e=IAe(s);let t=0;const i=e[t++];if(e[t++]===dx.Full){const a=e[t++],c=e.subarray(t,t+a);return t+=a,{id:i,type:"full",data:c}}const o=e[t++],r=[];for(let a=0;a<o;a++){const c=e[t++],d=e[t++],l=e[t++];let u;l>0&&(u=e.subarray(t,t+l),t+=l),r[a]={start:c,deleteCount:d,data:u}}return{id:i,type:"delta",deltas:r}}function kAe(s){return!!s&&typeof s.sessionId=="string"&&s.$mid===Nn.ChatViewContext}var jD={exports:{}},S0={},MQ;function TAe(){return MQ||(MQ=1,function(s,e){e=s.exports=Xi;var t;typeof process=="object"&&S0&&S0.NODE_DEBUG&&/\bsemver\b/i.test(S0.NODE_DEBUG)?t=function(){var q=Array.prototype.slice.call(arguments,0);q.unshift("SEMVER"),console.log.apply(console,q)}:t=function(){},e.SEMVER_SPEC_VERSION="2.0.0";var i=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,o=16,r=e.re=[],a=e.src=[],c=0,d=c++;a[d]="0|[1-9]\\d*";var l=c++;a[l]="[0-9]+";var u=c++;a[u]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var g=c++;a[g]="("+a[d]+")\\.("+a[d]+")\\.("+a[d]+")";var m=c++;a[m]="("+a[l]+")\\.("+a[l]+")\\.("+a[l]+")";var v=c++;a[v]="(?:"+a[d]+"|"+a[u]+")";var y=c++;a[y]="(?:"+a[l]+"|"+a[u]+")";var w=c++;a[w]="(?:-("+a[v]+"(?:\\."+a[v]+")*))";var C=c++;a[C]="(?:-?("+a[y]+"(?:\\."+a[y]+")*))";var T=c++;a[T]="[0-9A-Za-z-]+";var k=c++;a[k]="(?:\\+("+a[T]+"(?:\\."+a[T]+")*))";var A=c++,B="v?"+a[g]+a[w]+"?"+a[k]+"?";a[A]="^"+B+"$";var z="[v=\\s]*"+a[m]+a[C]+"?"+a[k]+"?",Q=c++;a[Q]="^"+z+"$";var ie=c++;a[ie]="((?:<|>)?=?)";var oe=c++;a[oe]=a[l]+"|x|X|\\*";var xe=c++;a[xe]=a[d]+"|x|X|\\*";var Se=c++;a[Se]="[v=\\s]*("+a[xe]+")(?:\\.("+a[xe]+")(?:\\.("+a[xe]+")(?:"+a[w]+")?"+a[k]+"?)?)?";var Ft=c++;a[Ft]="[v=\\s]*("+a[oe]+")(?:\\.("+a[oe]+")(?:\\.("+a[oe]+")(?:"+a[C]+")?"+a[k]+"?)?)?";var it=c++;a[it]="^"+a[ie]+"\\s*"+a[Se]+"$";var ti=c++;a[ti]="^"+a[ie]+"\\s*"+a[Ft]+"$";var ci=c++;a[ci]="(?:^|[^\\d])(\\d{1,"+o+"})(?:\\.(\\d{1,"+o+"}))?(?:\\.(\\d{1,"+o+"}))?(?:$|[^\\d])";var Xn=c++;a[Xn]="(?:~>?)";var tu=c++;a[tu]="(\\s*)"+a[Xn]+"\\s+",r[tu]=new RegExp(a[tu],"g");var Fr="$1~",Wr=c++;a[Wr]="^"+a[Xn]+a[Se]+"$";var Cc=c++;a[Cc]="^"+a[Xn]+a[Ft]+"$";var Ec=c++;a[Ec]="(?:\\^)";var Bn=c++;a[Bn]="(\\s*)"+a[Ec]+"\\s+",r[Bn]=new RegExp(a[Bn],"g");var Br="$1^",Pl=c++;a[Pl]="^"+a[Ec]+a[Se]+"$";var Rf=c++;a[Rf]="^"+a[Ec]+a[Ft]+"$";var Ad=c++;a[Ad]="^"+a[ie]+"\\s*("+z+")$|^$";var z1=c++;a[z1]="^"+a[ie]+"\\s*("+B+")$|^$";var pS=c++;a[pS]="(\\s*)"+a[ie]+"\\s*("+z+"|"+a[Se]+")",r[pS]=new RegExp(a[pS],"g");var ffe="$1$2$3",a7=c++;a[a7]="^\\s*("+a[Se]+")\\s+-\\s+("+a[Se]+")\\s*$";var c7=c++;a[c7]="^\\s*("+a[Ft]+")\\s+-\\s+("+a[Ft]+")\\s*$";var d7=c++;a[d7]="(<|>)?=?\\s*\\*";for(var Pf=0;Pf<c;Pf++)t(Pf,a[Pf]),r[Pf]||(r[Pf]=new RegExp(a[Pf]));e.parse=Lf;function Lf(q,se){if(q instanceof Xi)return q;if(typeof q!="string"||q.length>i)return null;var ce=se?r[Q]:r[A];if(!ce.test(q))return null;try{return new Xi(q,se)}catch{return null}}e.valid=mfe;function mfe(q,se){var ce=Lf(q,se);return ce?ce.version:null}e.clean=vfe;function vfe(q,se){var ce=Lf(q.trim().replace(/^[=v]+/,""),se);return ce?ce.version:null}e.SemVer=Xi;function Xi(q,se){if(q instanceof Xi){if(q.loose===se)return q;q=q.version}else if(typeof q!="string")throw new TypeError("Invalid Version: "+q);if(q.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof Xi))return new Xi(q,se);t("SemVer",q,se),this.loose=se;var ce=q.trim().match(se?r[Q]:r[A]);if(!ce)throw new TypeError("Invalid Version: "+q);if(this.raw=q,this.major=+ce[1],this.minor=+ce[2],this.patch=+ce[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");ce[4]?this.prerelease=ce[4].split(".").map(function(He){if(/^[0-9]+$/.test(He)){var ke=+He;if(ke>=0&&ke<n)return ke}return He}):this.prerelease=[],this.build=ce[5]?ce[5].split("."):[],this.format()}Xi.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Xi.prototype.toString=function(){return this.version},Xi.prototype.compare=function(q){return t("SemVer.compare",this.version,this.loose,q),q instanceof Xi||(q=new Xi(q,this.loose)),this.compareMain(q)||this.comparePre(q)},Xi.prototype.compareMain=function(q){return q instanceof Xi||(q=new Xi(q,this.loose)),m_(this.major,q.major)||m_(this.minor,q.minor)||m_(this.patch,q.patch)},Xi.prototype.comparePre=function(q){if(q instanceof Xi||(q=new Xi(q,this.loose)),this.prerelease.length&&!q.prerelease.length)return-1;if(!this.prerelease.length&&q.prerelease.length)return 1;if(!this.prerelease.length&&!q.prerelease.length)return 0;var se=0;do{var ce=this.prerelease[se],He=q.prerelease[se];if(t("prerelease compare",se,ce,He),ce===void 0&&He===void 0)return 0;if(He===void 0)return 1;if(ce===void 0)return-1;if(ce===He)continue;return m_(ce,He)}while(++se)},Xi.prototype.inc=function(q,se){switch(q){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",se);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",se);break;case"prepatch":this.prerelease.length=0,this.inc("patch",se),this.inc("pre",se);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",se),this.inc("pre",se);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var ce=this.prerelease.length;--ce>=0;)typeof this.prerelease[ce]=="number"&&(this.prerelease[ce]++,ce=-2);ce===-1&&this.prerelease.push(0)}se&&(this.prerelease[0]===se?isNaN(this.prerelease[1])&&(this.prerelease=[se,0]):this.prerelease=[se,0]);break;default:throw new Error("invalid increment argument: "+q)}return this.format(),this.raw=this.version,this},e.inc=_fe;function _fe(q,se,ce,He){typeof ce=="string"&&(He=ce,ce=void 0);try{return new Xi(q,ce).inc(se,He).version}catch{return null}}e.diff=bfe;function bfe(q,se){if(K1(q,se))return null;var ce=Lf(q),He=Lf(se);if(ce.prerelease.length||He.prerelease.length){for(var ke in ce)if((ke==="major"||ke==="minor"||ke==="patch")&&ce[ke]!==He[ke])return"pre"+ke;return"prerelease"}for(var ke in ce)if((ke==="major"||ke==="minor"||ke==="patch")&&ce[ke]!==He[ke])return ke}e.compareIdentifiers=m_;var l7=/^[0-9]+$/;function m_(q,se){var ce=l7.test(q),He=l7.test(se);return ce&&He&&(q=+q,se=+se),ce&&!He?-1:He&&!ce?1:q<se?-1:q>se?1:0}e.rcompareIdentifiers=yfe;function yfe(q,se){return m_(se,q)}e.major=wfe;function wfe(q,se){return new Xi(q,se).major}e.minor=Sfe;function Sfe(q,se){return new Xi(q,se).minor}e.patch=Cfe;function Cfe(q,se){return new Xi(q,se).patch}e.compare=iu;function iu(q,se,ce){return new Xi(q,ce).compare(new Xi(se,ce))}e.compareLoose=Efe;function Efe(q,se){return iu(q,se,!0)}e.rcompare=xfe;function xfe(q,se,ce){return iu(se,q,ce)}e.sort=Ife;function Ife(q,se){return q.sort(function(ce,He){return e.compare(ce,He,se)})}e.rsort=Dfe;function Dfe(q,se){return q.sort(function(ce,He){return e.rcompare(ce,He,se)})}e.gt=DD;function DD(q,se,ce){return iu(q,se,ce)>0}e.lt=kD;function kD(q,se,ce){return iu(q,se,ce)<0}e.eq=K1;function K1(q,se,ce){return iu(q,se,ce)===0}e.neq=h7;function h7(q,se,ce){return iu(q,se,ce)!==0}e.gte=j1;function j1(q,se,ce){return iu(q,se,ce)>=0}e.lte=Y1;function Y1(q,se,ce){return iu(q,se,ce)<=0}e.cmp=TD;function TD(q,se,ce,He){var ke;switch(se){case"===":typeof q=="object"&&(q=q.version),typeof ce=="object"&&(ce=ce.version),ke=q===ce;break;case"!==":typeof q=="object"&&(q=q.version),typeof ce=="object"&&(ce=ce.version),ke=q!==ce;break;case"":case"=":case"==":ke=K1(q,ce,He);break;case"!=":ke=h7(q,ce,He);break;case">":ke=DD(q,ce,He);break;case">=":ke=j1(q,ce,He);break;case"<":ke=kD(q,ce,He);break;case"<=":ke=Y1(q,ce,He);break;default:throw new TypeError("Invalid operator: "+se)}return ke}e.Comparator=xc;function xc(q,se){if(q instanceof xc){if(q.loose===se)return q;q=q.value}if(!(this instanceof xc))return new xc(q,se);t("comparator",q,se),this.loose=se,this.parse(q),this.semver===fS?this.value="":this.value=this.operator+this.semver.version,t("comp",this)}var fS={};xc.prototype.parse=function(q){var se=this.loose?r[Ad]:r[z1],ce=q.match(se);if(!ce)throw new TypeError("Invalid comparator: "+q);this.operator=ce[1],this.operator==="="&&(this.operator=""),ce[2]?this.semver=new Xi(ce[2],this.loose):this.semver=fS},xc.prototype.toString=function(){return this.value},xc.prototype.test=function(q){return t("Comparator.test",q,this.loose),this.semver===fS?!0:(typeof q=="string"&&(q=new Xi(q,this.loose)),TD(q,this.operator,this.semver,this.loose))},xc.prototype.intersects=function(q,se){if(!(q instanceof xc))throw new TypeError("a Comparator is required");var ce;if(this.operator==="")return ce=new ms(q.value,se),AD(this.value,ce,se);if(q.operator==="")return ce=new ms(this.value,se),AD(q.semver,ce,se);var He=(this.operator===">="||this.operator===">")&&(q.operator===">="||q.operator===">"),ke=(this.operator==="<="||this.operator==="<")&&(q.operator==="<="||q.operator==="<"),yt=this.semver.version===q.semver.version,ii=(this.operator===">="||this.operator==="<=")&&(q.operator===">="||q.operator==="<="),_i=TD(this.semver,"<",q.semver,se)&&(this.operator===">="||this.operator===">")&&(q.operator==="<="||q.operator==="<"),Ui=TD(this.semver,">",q.semver,se)&&(this.operator==="<="||this.operator==="<")&&(q.operator===">="||q.operator===">");return He||ke||yt&&ii||_i||Ui},e.Range=ms;function ms(q,se){if(q instanceof ms)return q.loose===se?q:new ms(q.raw,se);if(q instanceof xc)return new ms(q.value,se);if(!(this instanceof ms))return new ms(q,se);if(this.loose=se,this.raw=q,this.set=q.split(/\s*\|\|\s*/).map(function(ce){return this.parseRange(ce.trim())},this).filter(function(ce){return ce.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+q);this.format()}ms.prototype.format=function(){return this.range=this.set.map(function(q){return q.join(" ").trim()}).join("||").trim(),this.range},ms.prototype.toString=function(){return this.range},ms.prototype.parseRange=function(q){var se=this.loose;q=q.trim(),t("range",q,se);var ce=se?r[c7]:r[a7];q=q.replace(ce,Ffe),t("hyphen replace",q),q=q.replace(r[pS],ffe),t("comparator trim",q,r[pS]),q=q.replace(r[tu],Fr),q=q.replace(r[Bn],Br),q=q.split(/\s+/).join(" ");var He=se?r[Ad]:r[z1],ke=q.split(" ").map(function(yt){return Tfe(yt,se)}).join(" ").split(/\s+/);return this.loose&&(ke=ke.filter(function(yt){return!!yt.match(He)})),ke=ke.map(function(yt){return new xc(yt,se)}),ke},ms.prototype.intersects=function(q,se){if(!(q instanceof ms))throw new TypeError("a Range is required");return this.set.some(function(ce){return ce.every(function(He){return q.set.some(function(ke){return ke.every(function(yt){return He.intersects(yt,se)})})})})},e.toComparators=kfe;function kfe(q,se){return new ms(q,se).set.map(function(ce){return ce.map(function(He){return He.value}).join(" ").trim().split(" ")})}function Tfe(q,se){return t("comp",q),q=Pfe(q,se),t("caret",q),q=Afe(q,se),t("tildes",q),q=Mfe(q,se),t("xrange",q),q=Ofe(q,se),t("stars",q),q}function Vr(q){return!q||q.toLowerCase()==="x"||q==="*"}function Afe(q,se){return q.trim().split(/\s+/).map(function(ce){return Rfe(ce,se)}).join(" ")}function Rfe(q,se){var ce=se?r[Cc]:r[Wr];return q.replace(ce,function(He,ke,yt,ii,_i){t("tilde",q,He,ke,yt,ii,_i);var Ui;return Vr(ke)?Ui="":Vr(yt)?Ui=">="+ke+".0.0 <"+(+ke+1)+".0.0":Vr(ii)?Ui=">="+ke+"."+yt+".0 <"+ke+"."+(+yt+1)+".0":_i?(t("replaceTilde pr",_i),_i.charAt(0)!=="-"&&(_i="-"+_i),Ui=">="+ke+"."+yt+"."+ii+_i+" <"+ke+"."+(+yt+1)+".0"):Ui=">="+ke+"."+yt+"."+ii+" <"+ke+"."+(+yt+1)+".0",t("tilde return",Ui),Ui})}function Pfe(q,se){return q.trim().split(/\s+/).map(function(ce){return Lfe(ce,se)}).join(" ")}function Lfe(q,se){t("caret",q,se);var ce=se?r[Rf]:r[Pl];return q.replace(ce,function(He,ke,yt,ii,_i){t("caret",q,He,ke,yt,ii,_i);var Ui;return Vr(ke)?Ui="":Vr(yt)?Ui=">="+ke+".0.0 <"+(+ke+1)+".0.0":Vr(ii)?ke==="0"?Ui=">="+ke+"."+yt+".0 <"+ke+"."+(+yt+1)+".0":Ui=">="+ke+"."+yt+".0 <"+(+ke+1)+".0.0":_i?(t("replaceCaret pr",_i),_i.charAt(0)!=="-"&&(_i="-"+_i),ke==="0"?yt==="0"?Ui=">="+ke+"."+yt+"."+ii+_i+" <"+ke+"."+yt+"."+(+ii+1):Ui=">="+ke+"."+yt+"."+ii+_i+" <"+ke+"."+(+yt+1)+".0":Ui=">="+ke+"."+yt+"."+ii+_i+" <"+(+ke+1)+".0.0"):(t("no pr"),ke==="0"?yt==="0"?Ui=">="+ke+"."+yt+"."+ii+" <"+ke+"."+yt+"."+(+ii+1):Ui=">="+ke+"."+yt+"."+ii+" <"+ke+"."+(+yt+1)+".0":Ui=">="+ke+"."+yt+"."+ii+" <"+(+ke+1)+".0.0"),t("caret return",Ui),Ui})}function Mfe(q,se){return t("replaceXRanges",q,se),q.split(/\s+/).map(function(ce){return Nfe(ce,se)}).join(" ")}function Nfe(q,se){q=q.trim();var ce=se?r[ti]:r[it];return q.replace(ce,function(He,ke,yt,ii,_i,Ui){t("xRange",q,He,ke,yt,ii,_i,Ui);var Ll=Vr(yt),Ml=Ll||Vr(ii),ca=Ml||Vr(_i),Oa=ca;return ke==="="&&Oa&&(ke=""),Ll?ke===">"||ke==="<"?He="<0.0.0":He="*":ke&&Oa?(Ml&&(ii=0),ca&&(_i=0),ke===">"?(ke=">=",Ml?(yt=+yt+1,ii=0,_i=0):ca&&(ii=+ii+1,_i=0)):ke==="<="&&(ke="<",Ml?yt=+yt+1:ii=+ii+1),He=ke+yt+"."+ii+"."+_i):Ml?He=">="+yt+".0.0 <"+(+yt+1)+".0.0":ca&&(He=">="+yt+"."+ii+".0 <"+yt+"."+(+ii+1)+".0"),t("xRange return",He),He})}function Ofe(q,se){return t("replaceStars",q,se),q.trim().replace(r[d7],"")}function Ffe(q,se,ce,He,ke,yt,ii,_i,Ui,Ll,Ml,ca,Oa){return Vr(ce)?se="":Vr(He)?se=">="+ce+".0.0":Vr(ke)?se=">="+ce+"."+He+".0":se=">="+se,Vr(Ui)?_i="":Vr(Ll)?_i="<"+(+Ui+1)+".0.0":Vr(Ml)?_i="<"+Ui+"."+(+Ll+1)+".0":ca?_i="<="+Ui+"."+Ll+"."+Ml+"-"+ca:_i="<="+_i,(se+" "+_i).trim()}ms.prototype.test=function(q){if(!q)return!1;typeof q=="string"&&(q=new Xi(q,this.loose));for(var se=0;se<this.set.length;se++)if(Wfe(this.set[se],q))return!0;return!1};function Wfe(q,se){for(var ce=0;ce<q.length;ce++)if(!q[ce].test(se))return!1;if(se.prerelease.length){for(var ce=0;ce<q.length;ce++)if(t(q[ce].semver),q[ce].semver!==fS&&q[ce].semver.prerelease.length>0){var He=q[ce].semver;if(He.major===se.major&&He.minor===se.minor&&He.patch===se.patch)return!0}return!1}return!0}e.satisfies=AD;function AD(q,se,ce){try{se=new ms(se,ce)}catch{return!1}return se.test(q)}e.maxSatisfying=Bfe;function Bfe(q,se,ce){var He=null,ke=null;try{var yt=new ms(se,ce)}catch{return null}return q.forEach(function(ii){yt.test(ii)&&(!He||ke.compare(ii)===-1)&&(He=ii,ke=new Xi(He,ce))}),He}e.minSatisfying=Vfe;function Vfe(q,se,ce){var He=null,ke=null;try{var yt=new ms(se,ce)}catch{return null}return q.forEach(function(ii){yt.test(ii)&&(!He||ke.compare(ii)===1)&&(He=ii,ke=new Xi(He,ce))}),He}e.validRange=Hfe;function Hfe(q,se){try{return new ms(q,se).range||"*"}catch{return null}}e.ltr=Ufe;function Ufe(q,se,ce){return Q1(q,se,"<",ce)}e.gtr=$fe;function $fe(q,se,ce){return Q1(q,se,">",ce)}e.outside=Q1;function Q1(q,se,ce,He){q=new Xi(q,He),se=new ms(se,He);var ke,yt,ii,_i,Ui;switch(ce){case">":ke=DD,yt=Y1,ii=kD,_i=">",Ui=">=";break;case"<":ke=kD,yt=j1,ii=DD,_i="<",Ui="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(AD(q,se,He))return!1;for(var Ll=0;Ll<se.set.length;++Ll){var Ml=se.set[Ll],ca=null,Oa=null;if(Ml.forEach(function(Ng){Ng.semver===fS&&(Ng=new xc(">=0.0.0")),ca=ca||Ng,Oa=Oa||Ng,ke(Ng.semver,ca.semver,He)?ca=Ng:ii(Ng.semver,Oa.semver,He)&&(Oa=Ng)}),ca.operator===_i||ca.operator===Ui||(!Oa.operator||Oa.operator===_i)&&yt(q,Oa.semver))return!1;if(Oa.operator===Ui&&ii(q,Oa.semver))return!1}return!0}e.prerelease=Gfe;function Gfe(q,se){var ce=Lf(q,se);return ce&&ce.prerelease.length?ce.prerelease:null}e.intersects=qfe;function qfe(q,se,ce){return q=new ms(q,ce),se=new ms(se,ce),q.intersects(se)}e.coerce=zfe;function zfe(q){if(q instanceof Xi)return q;if(typeof q!="string")return null;var se=q.match(r[ci]);return se==null?null:Lf((se[1]||"0")+"."+(se[2]||"0")+"."+(se[3]||"0"))}}(jD,jD.exports)),jD.exports}var My=TAe();const Bce=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,AAe=/^-(\d{4})(\d{2})(\d{2})$/;function RAe(s){return s=s.trim(),s==="*"||Bce.test(s)}function yV(s){if(!RAe(s))return null;if(s=s.trim(),s==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};const e=s.match(Bce);return e?{hasCaret:e[1]==="^",hasGreaterEquals:e[1]===">=",majorBase:e[2]==="x"?0:parseInt(e[2],10),majorMustEqual:e[2]!=="x",minorBase:e[4]==="x"?0:parseInt(e[4],10),minorMustEqual:e[4]!=="x",patchBase:e[6]==="x"?0:parseInt(e[6],10),patchMustEqual:e[6]!=="x",preRelease:e[8]||null}:null}function wV(s){if(!s)return null;const e=s.majorBase,t=s.majorMustEqual,i=s.minorBase;let n=s.minorMustEqual;const o=s.patchBase;let r=s.patchMustEqual;s.hasCaret&&(e===0||(n=!1),r=!1);let a=0;if(s.preRelease){const c=AAe.exec(s.preRelease);if(c){const[,d,l,u]=c;a=Date.UTC(Number(d),Number(l)-1,Number(u))}}return{majorBase:e,majorMustEqual:t,minorBase:i,minorMustEqual:n,patchBase:o,patchMustEqual:r,isMinimum:s.hasGreaterEquals,notBefore:a}}function PAe(s,e,t){let i;typeof s=="string"?i=wV(yV(s)):i=s;let n;e instanceof Date?n=e.getTime():typeof e=="string"&&(n=new Date(e).getTime());let o;if(typeof t=="string"?o=wV(yV(t)):o=t,!i||!o)return!1;const r=i.majorBase,a=i.minorBase,c=i.patchBase;let d=o.majorBase,l=o.minorBase,u=o.patchBase;const g=o.notBefore;let m=o.majorMustEqual,v=o.minorMustEqual,y=o.patchMustEqual;return o.isMinimum?r>d?!0:r<d?!1:a>l?!0:a<l||n&&n<g?!1:c>=u:(r===1&&d===0&&(!m||!v||!y)&&(d=1,l=0,u=0,m=!0,v=!1,y=!1),r<d?!1:r>d?!m:a<l?!1:a>l?!v:c<u?!1:c>u?!y:!(n&&n<g))}function LAe(s,e,t,i,n,o){const r=[];if(typeof i.publisher<"u"&&typeof i.publisher!="string")return r.push([Me.Error,h(1829,"property publisher must be of type `string`.")]),r;if(typeof i.name!="string")return r.push([Me.Error,h(1830,"property `{0}` is mandatory and must be of type `string`","name")]),r;if(typeof i.version!="string")return r.push([Me.Error,h(1831,"property `{0}` is mandatory and must be of type `string`","version")]),r;if(!i.engines)return r.push([Me.Error,h(1832,"property `{0}` is mandatory and must be of type `object`","engines")]),r;if(typeof i.engines.vscode!="string")return r.push([Me.Error,h(1833,"property `{0}` is mandatory and must be of type `string`","engines.vscode")]),r;if(typeof i.extensionDependencies<"u"&&!NQ(i.extensionDependencies))return r.push([Me.Error,h(1834,"property `{0}` can be omitted or must be of type `string[]`","extensionDependencies")]),r;if(typeof i.activationEvents<"u"){if(!NQ(i.activationEvents))return r.push([Me.Error,h(1835,"property `{0}` can be omitted or must be of type `string[]`","activationEvents")]),r;if(typeof i.main>"u"&&typeof i.browser>"u")return r.push([Me.Error,h(1836,"property `{0}` should be omitted if the extension doesn't have a `{1}` or `{2}` property.","activationEvents","main","browser")]),r}if(typeof i.extensionKind<"u"&&typeof i.main>"u"&&r.push([Me.Warning,h(1837,"property `{0}` can be defined only if property `main` is also defined.","extensionKind")]),typeof i.main<"u"){if(typeof i.main!="string")return r.push([Me.Error,h(1838,"property `{0}` can be omitted or must be of type `string`","main")]),r;{const d=xt(t,i.main);cd(d,t)||r.push([Me.Warning,h(1839,"Expected `main` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",d.path,t.path)])}}if(typeof i.browser<"u"){if(typeof i.browser!="string")return r.push([Me.Error,h(1840,"property `{0}` can be omitted or must be of type `string`","browser")]),r;{const d=xt(t,i.browser);cd(d,t)||r.push([Me.Warning,h(1841,"Expected `browser` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",d.path,t.path)])}}if(!My.valid(i.version))return r.push([Me.Error,h(1842,"Extension version is not semver compatible.")]),r;const a=[];if(!MAe(s,e,i,n,a))for(const d of a)r.push([Me.Error,d]);if(o&&i.enabledApiProposals?.length){const d=[];if(!NAe([...i.enabledApiProposals],d))for(const l of d)r.push([Me.Error,l])}return r}function MAe(s,e,t,i,n){return i||typeof t.main>"u"&&typeof t.browser>"u"?!0:OAe(s,e,t.engines.vscode,n)}function NAe(s,e){if(s.length===0)return!0;const t=Array.isArray(e)?e:void 0,i=(t?void 0:e)??EF,n=[],o=Kme(s);for(const{proposalName:r,version:a}of o){if(!a)continue;i[r]?.version!==a&&n.push(r)}return n.length?(t&&(n.length===1?t.push(h(1843,"This extension is using the API proposal '{0}' that is not compatible with the current version of VS Code.",n[0])):t.push(h(1844,"This extension is using the API proposals {0} and '{1}' that are not compatible with the current version of VS Code.",n.slice(0,n.length-1).map(r=>`'${r}'`).join(", "),n[n.length-1]))),!1):!0}function OAe(s,e,t,i=[]){const n=wV(yV(t));if(!n)return i.push(h(1845,"Could not parse `engines.vscode` value {0}. Please use, for example: ^1.22.0, ^1.22.x, etc.",t)),!1;if(n.majorBase===0){if(!n.majorMustEqual||!n.minorMustEqual)return i.push(h(1846,"Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions before 1.0.0, please define at a minimum the major and minor desired version. E.g. ^0.10.0, 0.10.x, 0.11.0, etc.",t)),!1}else if(!n.majorMustEqual)return i.push(h(1847,"Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions after 1.0.0, please define at a minimum the major desired version. E.g. ^1.10.0, 1.10.x, 1.x.x, 2.x.x, etc.",t)),!1;return PAe(s,e,n)?!0:(i.push(h(1848,"Extension is not compatible with Code {0}. Extension requires: {1}.",s,t)),!1)}function NQ(s){if(!Array.isArray(s))return!1;for(let e=0,t=s.length;e<t;e++)if(typeof s[e]!="string")return!1;return!0}class FAe{constructor(){this.buffers=[]}add(e){let t=this.buffers.indexOf(e);return t<0&&(t=this.buffers.length,this.buffers.push(e)),t}}function WAe(s,e){if(e.serializeBuffersForPostMessage){const t=new FAe,n=JSON.stringify(s,(r,a)=>{if(a instanceof ArrayBuffer)return{$$vscode_array_buffer_reference$$:!0,index:t.add(a)};if(ArrayBuffer.isView(a)){const c=BAe(a);if(c)return{$$vscode_array_buffer_reference$$:!0,index:t.add(a.buffer),view:{type:c,byteLength:a.byteLength,byteOffset:a.byteOffset}}}return a}),o=t.buffers.map(r=>{const a=new Uint8Array(r);return Re.wrap(a)});return{message:n,buffers:o}}else return{message:JSON.stringify(s),buffers:[]}}function BAe(s){switch(s.constructor.name){case"Int8Array":return Jn.Int8Array;case"Uint8Array":return Jn.Uint8Array;case"Uint8ClampedArray":return Jn.Uint8ClampedArray;case"Int16Array":return Jn.Int16Array;case"Uint16Array":return Jn.Uint16Array;case"Int32Array":return Jn.Int32Array;case"Uint32Array":return Jn.Uint32Array;case"Float32Array":return Jn.Float32Array;case"Float64Array":return Jn.Float64Array;case"BigInt64Array":return Jn.BigInt64Array;case"BigUint64Array":return Jn.BigUint64Array}}function VAe(s,e){const t=e.map(o=>{const r=new ArrayBuffer(o.byteLength);return new Uint8Array(r).set(o.buffer),r}),i=e.length?(o,r)=>{if(r&&typeof r=="object"&&r.$$vscode_array_buffer_reference$$){const a=r,{index:c}=a,d=t[c];if(a.view)switch(a.view.type){case Jn.Int8Array:return new Int8Array(d,a.view.byteOffset,a.view.byteLength/Int8Array.BYTES_PER_ELEMENT);case Jn.Uint8Array:return new Uint8Array(d,a.view.byteOffset,a.view.byteLength/Uint8Array.BYTES_PER_ELEMENT);case Jn.Uint8ClampedArray:return new Uint8ClampedArray(d,a.view.byteOffset,a.view.byteLength/Uint8ClampedArray.BYTES_PER_ELEMENT);case Jn.Int16Array:return new Int16Array(d,a.view.byteOffset,a.view.byteLength/Int16Array.BYTES_PER_ELEMENT);case Jn.Uint16Array:return new Uint16Array(d,a.view.byteOffset,a.view.byteLength/Uint16Array.BYTES_PER_ELEMENT);case Jn.Int32Array:return new Int32Array(d,a.view.byteOffset,a.view.byteLength/Int32Array.BYTES_PER_ELEMENT);case Jn.Uint32Array:return new Uint32Array(d,a.view.byteOffset,a.view.byteLength/Uint32Array.BYTES_PER_ELEMENT);case Jn.Float32Array:return new Float32Array(d,a.view.byteOffset,a.view.byteLength/Float32Array.BYTES_PER_ELEMENT);case Jn.Float64Array:return new Float64Array(d,a.view.byteOffset,a.view.byteLength/Float64Array.BYTES_PER_ELEMENT);case Jn.BigInt64Array:return new BigInt64Array(d,a.view.byteOffset,a.view.byteLength/BigInt64Array.BYTES_PER_ELEMENT);case Jn.BigUint64Array:return new BigUint64Array(d,a.view.byteOffset,a.view.byteLength/BigUint64Array.BYTES_PER_ELEMENT);default:throw new Error("Unknown array buffer view type")}return d}return r}:void 0;return{message:JSON.parse(s,i),arrayBuffers:t}}class OQ{constructor(){this._data=new Set,this._obs=aC({equalsFn:()=>!1},this),this.observable=this._obs}get size(){return this._data.size}has(e){return this._data.has(e)}add(e,t){return this._data.has(e)||(this._data.add(e),this._obs.set(this,t)),this}delete(e,t){const i=this._data.delete(e);return i&&this._obs.set(this,t),i}clear(e){this._data.size>0&&(this._data.clear(),this._obs.set(this,e))}forEach(e,t){this._data.forEach((i,n,o)=>{e.call(t,i,n,this)})}*entries(){for(const e of this._data)yield[e,e]}*keys(){yield*this._data.keys()}*values(){yield*this._data.values()}[Symbol.iterator](){return this.values()}get[Symbol.toStringTag](){return"ObservableSet"}}var xR;(function(s){s.Internal={type:"internal",label:"Built-In"};function e(n){switch(n.type){case"extension":return`extension:${n.extensionId.value}`;case"mcp":return`mcp:${n.collectionId}:${n.definitionId}`;case"user":return`user:${n.file.toString()}`;case"internal":return"internal"}}s.toKey=e;function t(n,o){return e(n)===e(o)}s.equals=t;function i(n){return n.type==="internal"?{ordinal:1,label:h(5169,"Built-In")}:n.type==="mcp"?{ordinal:2,label:h(5170,"MCP Server: {0}",n.label)}:n.type==="user"?{ordinal:0,label:h(5171,"User Defined")}:{ordinal:3,label:h(5172,"Extension: {0}",n.label)}}s.classify=i})(xR||(xR={}));function Z9e(s){return typeof s=="object"&&typeof s.sessionId=="string"}function HAe(s){return s.content.some(e=>e.kind==="data")}class SV{constructor(e,t,i,n,o){this.id=e,this.referenceName=t,this.icon=i,this.source=n,this.description=o,this._tools=new OQ,this._toolSets=new OQ,this.isHomogenous=fe(r=>!dn.some(this._tools.observable.read(r),a=>!xR.equals(a.source,this.source))&&!dn.some(this._toolSets.observable.read(r),a=>!xR.equals(a.source,this.source)))}addTool(e,t){return this._tools.add(e,t),Ee(()=>{this._tools.delete(e)})}addToolSet(e,t){return e===this?F.None:(this._toolSets.add(e,t),Ee(()=>{this._toolSets.delete(e)}))}getTools(e){return dn.concat(this._tools.observable.read(e),...dn.map(this._toolSets.observable.read(e),t=>t.getTools(e)))}}I(6919,"Extensions");var FQ;(function(s){s[s.Installing=0]="Installing",s[s.Installed=1]="Installed",s[s.Uninstalling=2]="Uninstalling",s[s.Uninstalled=3]="Uninstalled"})(FQ||(FQ={}));var WQ;(function(s){s.ReloadWindow="reloadWindow",s.RestartExtensions="restartExtensions",s.DownloadUpdate="downloadUpdate",s.ApplyUpdate="applyUpdate",s.QuitAndInstall="quitAndInstall"})(WQ||(WQ={}));var BQ;(function(s){s.Readme="readme",s.Features="features",s.Changelog="changelog",s.Dependencies="dependencies",s.ExtensionPack="extensionPack"})(BQ||(BQ={}));let VQ=class extends F{constructor(e,t){super(),this.containers=e,this._register(t.onChange(this.update,this))}set extension(e){this.containers.forEach(t=>t.extension=e)}update(e){for(const t of this.containers)e&&t.extension?ja(t.extension.identifier,e.identifier)&&(t.extension.server&&e.server&&t.extension.server!==e.server?t.updateWhenCounterExtensionChanges&&t.update():t.extension=e):t.update()}};VQ=f([p(1,EI)],VQ);new O("defaultExtensionViews",!0);new O("hasOutdatedExtensions",!1);new O("hasGallery",!1);new O("extensionResultListFocused ",!0);new O("searchMcpServers",!1);new N("extensionsSearchActionsMenu");new N("extensionsFilterSubMenu");const e8e="workbench.editorAssociations",UAe=Ge.as(qs.Configuration),$Ae={...fN,properties:{"workbench.editorAssociations":{type:"object",markdownDescription:h(12470,'Configure [glob patterns](https://aka.ms/vscode-glob-patterns) to editors (for example `"*.hex": "hexEditor.hexedit"`). These have precedence over the default behavior.'),additionalProperties:{type:"string"}}}};UAe.registerConfiguration($Ae);var um;(function(s){s.builtin="builtin",s.option="option",s.exclusive="exclusive",s.default="default"})(um||(um={}));var HQ;(function(s){s[s.ABORT=1]="ABORT",s[s.NONE=2]="NONE"})(HQ||(HQ={}));function t8e(s){switch(s){case um.exclusive:return 5;case um.default:return 4;case um.builtin:return 3;case um.option:default:return 1}}function i8e(s,e){if(new Set([ae.extension,ae.webviewPanel,ae.vscodeWorkspaceTrust,ae.vscodeSettings]).has(e.scheme))return!1;const n=typeof s=="string"&&s.indexOf(Zc.sep)>=0?`${e.scheme}:${e.path}`:je(e);return ch(typeof s=="string"?s.toLowerCase():s,n.toLowerCase())}var IR;(function(s){s[s.Output=1]="Output",s[s.OutputItems=2]="OutputItems",s[s.ExecutionState=3]="ExecutionState"})(IR||(IR={}));const n8e="views",s8e=h(4044,"Views"),GAe=Ae("default-view-icon",j.window,h(4045,"Default view icon."));var Yp;(function(s){s.ViewContainersRegistry="workbench.registry.view.containers",s.ViewsRegistry="workbench.registry.view"})(Yp||(Yp={}));var Fe;(function(s){s[s.Sidebar=0]="Sidebar",s[s.Panel=1]="Panel",s[s.AuxiliaryBar=2]="AuxiliaryBar"})(Fe||(Fe={}));const o8e=[Fe.Sidebar,Fe.Panel,Fe.AuxiliaryBar];function ed(s){switch(s){case Fe.Sidebar:return"sidebar";case Fe.Panel:return"panel";case Fe.AuxiliaryBar:return"auxiliarybar"}}class qAe extends F{constructor(){super(...arguments),this._onDidRegister=this._register(new M),this.onDidRegister=this._onDidRegister.event,this._onDidDeregister=this._register(new M),this.onDidDeregister=this._onDidDeregister.event,this.viewContainers=new Map,this.defaultViewContainers=[]}get all(){return[...this.viewContainers.values()].flat()}registerViewContainer(e,t,i){const n=this.get(e.id);if(n)return n;const o=e;return o.openCommandActionDescriptor=i?.doNotRegisterOpenCommand?void 0:o.openCommandActionDescriptor??{id:o.id},Sk(this.viewContainers,t,[]).push(o),i?.isDefault&&this.defaultViewContainers.push(o),this._onDidRegister.fire({viewContainer:o,viewContainerLocation:t}),o}deregisterViewContainer(e){for(const t of this.viewContainers.keys()){const i=this.viewContainers.get(t),n=i?.indexOf(e);if(n!==-1){i?.splice(n,1),i.length===0&&this.viewContainers.delete(t),this._onDidDeregister.fire({viewContainer:e,viewContainerLocation:t});return}}}get(e){return this.all.filter(t=>t.id===e)[0]}getViewContainers(e){return[...this.viewContainers.get(e)||[]]}getViewContainerLocation(e){return[...this.viewContainers.keys()].filter(t=>this.getViewContainers(t).filter(i=>i?.id===e.id).length>0)[0]}getDefaultViewContainer(e){return this.defaultViewContainers.find(t=>this.getViewContainerLocation(t)===e)}}Ge.add(Yp.ViewContainersRegistry,new qAe);var DR;(function(s){s.Open="2_open",s.Debug="4_debug",s.SCM="5_scm",s.More="9_more"})(DR||(DR={}));function zAe(s,e){const t=s.group??DR.More,i=e.group??DR.More;return t!==i?t.localeCompare(i):(s.order??5)-(e.order??5)}class KAe extends F{constructor(){super(...arguments),this._onViewsRegistered=this._register(new M),this.onViewsRegistered=this._onViewsRegistered.event,this._onViewsDeregistered=this._register(new M),this.onViewsDeregistered=this._onViewsDeregistered.event,this._onDidChangeContainer=this._register(new M),this.onDidChangeContainer=this._onDidChangeContainer.event,this._onDidChangeViewWelcomeContent=this._register(new M),this.onDidChangeViewWelcomeContent=this._onDidChangeViewWelcomeContent.event,this._viewContainers=[],this._views=new Map,this._viewWelcomeContents=new Kie}registerViews(e,t){this.registerViews2([{views:e,viewContainer:t}])}registerViews2(e){e.forEach(({views:t,viewContainer:i})=>this.addViews(t,i)),this._onViewsRegistered.fire(e)}deregisterViews(e,t){const i=this.removeViews(e,t);i.length&&this._onViewsDeregistered.fire({views:i,viewContainer:t})}moveViews(e,t){for(const i of this._views.keys())if(i!==t){const n=this.removeViews(e,i);n.length&&(this.addViews(n,t),this._onDidChangeContainer.fire({views:n,from:i,to:t}))}}getViews(e){return this._views.get(e)||[]}getView(e){for(const t of this._viewContainers){const i=(this._views.get(t)||[]).filter(n=>n.id===e)[0];if(i)return i}return null}getViewContainer(e){for(const t of this._viewContainers)if((this._views.get(t)||[]).filter(n=>n.id===e)[0])return t;return null}registerViewWelcomeContent(e,t){return this._viewWelcomeContents.add(e,t),this._onDidChangeViewWelcomeContent.fire(e),Ee(()=>{this._viewWelcomeContents.delete(e,t),this._onDidChangeViewWelcomeContent.fire(e)})}registerViewWelcomeContent2(e,t){const i=new Map;for(const[n,o]of t)this._viewWelcomeContents.add(e,o),i.set(n,Ee(()=>{this._viewWelcomeContents.delete(e,o),this._onDidChangeViewWelcomeContent.fire(e)}));return this._onDidChangeViewWelcomeContent.fire(e),i}getViewWelcomeContent(e){const t=[];return this._viewWelcomeContents.forEach(e,i=>t.push(i)),t.sort(zAe)}addViews(e,t){let i=this._views.get(t);i||(i=[],this._views.set(t,i),this._viewContainers.push(t));for(const n of e){if(this.getView(n.id)!==null)throw new Error(h(4046,"A view with id '{0}' is already registered",n.id));i.push(n)}}removeViews(e,t){const i=this._views.get(t);if(!i)return[];const n=[],o=[];for(const r of i)e.includes(r)?n.push(r):o.push(r);return n.length&&(o.length?this._views.set(t,o):(this._views.delete(t),this._viewContainers.splice(this._viewContainers.indexOf(t),1))),n}}Ge.add(Yp.ViewsRegistry,new KAe);var CV;(function(s){s[s.Default=0]="Default",s[s.Expand=1]="Expand"})(CV||(CV={}));var UQ;(function(s){s[s.None=0]="None",s[s.Collapsed=1]="Collapsed",s[s.Expanded=2]="Expanded"})(UQ||(UQ={}));class C0{constructor(e,t){this.resolved=!1,this._hasResolve=!1,zu(this,e),this._hasResolve=!!t,this.resolve=async i=>{if(t&&!this.resolved){const n=await t(i);n&&(this.tooltip=this.tooltip??n.tooltip,this.command=this.command??n.command)}i.isCancellationRequested||(this.resolved=!0)}}get hasResolve(){return this._hasResolve}resetResolve(){this.resolved=!1}asTreeItem(){return{handle:this.handle,parentHandle:this.parentHandle,collapsibleState:this.collapsibleState,label:this.label,description:this.description,icon:this.icon,iconDark:this.iconDark,themeIcon:this.themeIcon,resourceUri:this.resourceUri,tooltip:this.tooltip,contextValue:this.contextValue,command:this.command,children:this.children,accessibilityInformation:this.accessibilityInformation}}}class jAe extends Error{constructor(e){super(h(4047,"No tree view with id '{0}' registered.",e)),this.name="NoTreeViewError"}static is(e){return!!e&&e.name==="NoTreeViewError"}}function YAe(s,e){if(s.length===0)return Promise.resolve(!1);const t=[];let i=!1;for(const n of s){if(n===!0)return Promise.resolve(!0);NT(n)&&t.push(n.then(o=>{o&&(i=!0)},o=>{e(o),i=!0}))}return Op.settled(t).then(()=>i)}function RK(s){const e=s.isExtensionDevelopment;let t=!0;const i=s.extensionDevelopmentLocationURI;if(i)for(const a of i)a.scheme!==ae.file&&(t=!1);const n=t&&typeof s.debugExtensionHost.port=="number",o=t&&!!s.debugExtensionHost.break,r=e&&!!s.extensionTestsLocationURI&&!s.debugExtensionHost.debugId;return{isExtensionDevHost:e,isExtensionDevDebug:n,isExtensionDevDebugBrk:o,isExtensionDevTestFromCli:r}}function ht(s){return function(e){Ny.INSTANCE.registerNamedCustomer(s,e)}}function n_(s){Ny.INSTANCE.registerCustomer(s)}var kR;(function(s){function e(){return Ny.INSTANCE.getNamedCustomers()}s.getNamedCustomers=e;function t(){return Ny.INSTANCE.getCustomers()}s.getCustomers=t})(kR||(kR={}));class Ny{static{this.INSTANCE=new Ny}constructor(){this._namedCustomers=[],this._customers=[]}registerNamedCustomer(e,t){const i=[e,t];this._namedCustomers.push(i)}getNamedCustomers(){return this._namedCustomers}registerCustomer(e){this._customers.push(e)}getCustomers(){return this._customers}}var Gk;let TR=Gk=class extends F{get pid(){return this._extensionHost.pid}get kind(){return this._extensionHost.runningLocation.kind}get startup(){return this._extensionHost.startup}get friendyName(){return Vce(this.kind,this.pid)}constructor(e,t,i,n,o,r,a){super(),this._internalExtensionService=i,this._instantiationService=n,this._environmentService=o,this._telemetryService=r,this._logService=a,this._onDidChangeResponsiveState=this._register(new M),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._hasStarted=!1,this._cachedActivationEvents=new Map,this._resolvedActivationEvents=new Set,this._rpcProtocol=null,this._customers=[],this._extensionHost=e,this.onDidExit=this._extensionHost.onExit;const c={time:Date.now(),action:"starting",kind:oh(this.kind)};this._telemetryService.publicLog2("extensionHostStartup",c),this._proxy=this._extensionHost.start().then(d=>{this._hasStarted=!0;const l={time:Date.now(),action:"success",kind:oh(this.kind)};return this._telemetryService.publicLog2("extensionHostStartup",l),this._createExtensionHostCustomers(this.kind,d)},d=>{this._logService.error(`Error received from starting extension host (kind: ${oh(this.kind)})`),this._logService.error(d);const l={time:Date.now(),action:"error",kind:oh(this.kind)};return d&&d.name&&(l.errorName=d.name),d&&d.message&&(l.errorMessage=d.message),d&&d.stack&&(l.errorStack=d.stack),this._telemetryService.publicLog2("extensionHostStartup",l),null}),this._proxy.then(()=>{t.forEach(d=>this.activateByEvent(d,Bp.Normal)),this._register(JAe({measure:()=>this.measure()}))})}async disconnect(){await this._extensionHost?.disconnect?.()}dispose(){this._extensionHost?.dispose(),this._rpcProtocol?.dispose();for(let e=0,t=this._customers.length;e<t;e++){const i=this._customers[e];try{i.dispose()}catch(n){mt(n)}}this._proxy=null,super.dispose()}async measure(){const e=await this._proxy;if(!e)return null;const t=await this._measureLatency(e),i=await this._measureDown(e),n=await this._measureUp(e);return{remoteAuthority:this._extensionHost.remoteAuthority,latency:t,down:i,up:n}}async ready(){await this._proxy}async _measureLatency(e){let i=0;for(let n=0;n<10;n++){const o=zn.create();await e.test_latency(n),o.stop(),i+=o.elapsed()}return i/10}static _convert(e,t){return e*1e3*8/t}async _measureUp(e){const i=Re.alloc(10485760),n=Math.ceil(Math.random()*256);for(let r=0;r<i.byteLength;r++)i.writeUInt8(r,n);const o=zn.create();return await e.test_up(i),o.stop(),Gk._convert(10485760,o.elapsed())}async _measureDown(e){const i=zn.create();return await e.test_down(10485760),i.stop(),Gk._convert(10485760,i.elapsed())}_createExtensionHostCustomers(e,t){let i=null;this._environmentService.logExtensionHostCommunication?i=new ZAe(e):AR.isEnabled()&&(i=new AR(this._telemetryService)),this._rpcProtocol=new CR(t,i),this._register(this._rpcProtocol.onDidChangeResponsiveState(d=>this._onDidChangeResponsiveState.fire(d)));let n=null,o=[];const r={remoteAuthority:this._extensionHost.remoteAuthority,extensionHostKind:this.kind,getProxy:d=>this._rpcProtocol.getProxy(d),set:(d,l)=>this._rpcProtocol.set(d,l),dispose:()=>this._rpcProtocol.dispose(),assertRegistered:d=>this._rpcProtocol.assertRegistered(d),drain:()=>this._rpcProtocol.drain(),internalExtensionService:this._internalExtensionService,_setExtensionHostProxy:d=>{n=d},_setAllMainProxyIdentifiers:d=>{o=d}},a=kR.getNamedCustomers();for(let d=0,l=a.length;d<l;d++){const[u,g]=a[d];try{const m=this._instantiationService.createInstance(g,r);this._customers.push(m),this._rpcProtocol.set(u,m)}catch(m){this._logService.error(`Cannot instantiate named customer: '${u.sid}'`),this._logService.error(m),mt(m)}}const c=kR.getCustomers();for(const d of c)try{const l=this._instantiationService.createInstance(d,r);this._customers.push(l)}catch(l){this._logService.error(l),mt(l)}if(!n)throw new Error("Missing IExtensionHostProxy!");return this._rpcProtocol.assertRegistered(o),n}async activate(e,t){const i=await this._proxy;return i?i.activate(e,t):!1}activateByEvent(e,t){return t===Bp.Immediate&&!this._hasStarted?Promise.resolve():(this._cachedActivationEvents.has(e)||this._cachedActivationEvents.set(e,this._activateByEvent(e,t)),this._cachedActivationEvents.get(e))}activationEventIsDone(e){return this._resolvedActivationEvents.has(e)}async _activateByEvent(e,t){if(!this._proxy)return;const i=await this._proxy;if(i){if(!this._extensionHost.extensions.containsActivationEvent(e)){this._resolvedActivationEvents.add(e);return}await i.activateByEvent(e,t),this._resolvedActivationEvents.add(e)}}async getInspectPort(e){if(this._extensionHost){e&&await this._extensionHost.enableInspectPort();const t=this._extensionHost.getInspectPort();if(t)return t}}async resolveAuthority(e,t){const i=zn.create(!1),n=()=>`[${oh(this._extensionHost.runningLocation.kind)}${this._extensionHost.runningLocation.affinity}][resolveAuthority(${foe(e)},${t})][${i.elapsed()}ms] `,o=d=>this._logService.info(`${n()}${d}`),r=(d,l=void 0)=>this._logService.error(`${n()}${d}`,l);o("obtaining proxy...");const a=await this._proxy;if(!a)return r("no proxy"),{type:"error",error:{message:"Cannot resolve authority",code:gr.Unknown,detail:void 0}};o("invoking...");const c=new jme;try{c.cancelAndSet(()=>o("waiting..."),1e3);const d=await a.resolveAuthority(e,t);return c.dispose(),d.type==="ok"?o(`returned ${d.value.authority.connectTo}`):r("returned an error",d.error),d}catch(d){return c.dispose(),r("returned an error",d),{type:"error",error:{message:d.message,code:gr.Unknown,detail:d}}}}async getCanonicalURI(e,t){const i=await this._proxy;if(!i)throw new Error("Cannot resolve canonical URI");return i.getCanonicalURI(e,t)}async start(e,t,i){const n=await this._proxy;if(!n)return;const o=this._extensionHost.extensions.set(e,t,i);return n.startExtensionHost(o)}async extensionTestsExecute(){const e=await this._proxy;if(!e)throw new Error("Could not obtain Extension Host Proxy");return e.extensionTestsExecute()}representsRunningLocation(e){return this._extensionHost.runningLocation.equals(e)}async deltaExtensions(e){const t=await this._proxy;if(!t)return;const i=this._extensionHost.extensions.delta(e);if(i)return t.deltaExtensions(i)}containsExtension(e){return this._extensionHost.extensions?.containsExtension(e)??!1}async setRemoteEnvironment(e){const t=await this._proxy;if(t)return t.setRemoteEnvironment(e)}};TR=Gk=f([p(3,J),p(4,mn),p(5,li),p(6,Pe)],TR);function Vce(s,e){return e?`${oh(s)} pid: ${e}`:`${oh(s)}`}const QAe=[["#2977B1","#FC802D","#34A13A","#D3282F","#9366BA"],["#8B564C","#E177C0","#7F7F7F","#BBBE3D","#2EBECD"]];function $Q(s){if(Array.isArray(s))return s;if(s&&typeof s=="object"&&typeof s.toString=="function"){const e=s.toString();if(e!=="[object Object]")return e}return s}function XAe(s){return Array.isArray(s)?s.map($Q):$Q(s)}class ZAe{constructor(e){this._kind=e,this._totalIncoming=0,this._totalOutgoing=0}_log(e,t,i,n,o,r,a){a=XAe(a);const c=QAe[o],d=c[n%c.length];let l=[`%c[${oh(this._kind)}][${e}]%c[${String(t).padStart(7)}]%c[len: ${String(i).padStart(5)}]%c${String(n).padStart(5)} - ${r}`,"color: darkgreen","color: grey","color: grey",`color: ${d}`];/\($/.test(r)?(l=l.concat(a),l.push(")")):l.push(a),console.log.apply(console,l)}logIncoming(e,t,i,n,o){this._totalIncoming+=e,this._log("Ext → Win",this._totalIncoming,e,t,i,n,o)}logOutgoing(e,t,i,n,o){this._totalOutgoing+=e,this._log("Win → Ext",this._totalOutgoing,e,t,i,n,o)}}let AR=class{static isEnabled(){return Math.random()<1e-4}constructor(e){this._telemetryService=e,this._pendingRequests=new Map}logIncoming(e,t,i,n){if(i===zr.LocalSide&&/^receiveReply(Err)?:/.test(n)){const o=this._pendingRequests.get(t)??"unknown_reply";this._pendingRequests.delete(t),this._telemetryService.publicLog2("extensionhost.incoming",{type:`${n} ${o}`,length:e})}i===zr.OtherSide&&/^receiveRequest /.test(n)&&this._telemetryService.publicLog2("extensionhost.incoming",{type:`${n}`,length:e})}logOutgoing(e,t,i,n){i===zr.LocalSide&&n.startsWith("request: ")&&(this._pendingRequests.set(t,n),this._telemetryService.publicLog2("extensionhost.outgoing",{type:n,length:e}))}};AR=f([p(0,li)],AR);const HS=[];function JAe(s){return HS.push(s),{dispose:()=>{for(let e=0;e<HS.length;e++)if(HS[e]===s){HS.splice(e,1);return}}}}function eRe(){return HS.slice(0)}K(class qk extends X{constructor(){super({id:"editor.action.measureExtHostLatency",title:I(12585,"Measure Extension Host Latency"),category:te.Developer,f1:!0})}async run(e){const t=e.get(de),i=await Promise.all(eRe().map(n=>n.measure()));t.openEditor({resource:void 0,contents:i.map(qk._print).join(`

`),options:{pinned:!0}})}static _print(e){return e?`${e.remoteAuthority?`Authority: ${e.remoteAuthority}
`:""}Roundtrip latency: ${e.latency.toFixed(3)}ms
Up: ${qk._printSpeed(e.up)}
Down: ${qk._printSpeed(e.down)}
`:""}static _printSpeed(e){return e<=1024?`${e} bps`:e<1024*1024?`${(e/1024).toFixed(1)} kbps`:`${(e/1024/1024).toFixed(1)} Mbps`}});class RR{constructor(e){this.affinity=e,this.kind=Lt.LocalProcess}equals(e){return this.kind===e.kind&&this.affinity===e.affinity}asString(){return this.affinity===0?"LocalProcess":`LocalProcess${this.affinity}`}}class EV{constructor(e){this.affinity=e,this.kind=Lt.LocalWebWorker}equals(e){return this.kind===e.kind&&this.affinity===e.affinity}asString(){return this.affinity===0?"LocalWebWorker":`LocalWebWorker${this.affinity}`}}class PR{constructor(){this.kind=Lt.Remote,this.affinity=0}equals(e){return this.kind===e.kind}asString(){return"Remote"}}let xV=class{get maxLocalProcessAffinity(){return this._maxLocalProcessAffinity}get maxLocalWebWorkerAffinity(){return this._maxLocalWebWorkerAffinity}constructor(e,t,i,n,o,r){this._registry=e,this._extensionHostKindPicker=t,this._environmentService=i,this._configurationService=n,this._logService=o,this._extensionManifestPropertiesService=r,this._runningLocation=new ko,this._maxLocalProcessAffinity=0,this._maxLocalWebWorkerAffinity=0}set(e,t){this._runningLocation.set(e,t)}readExtensionKinds(e){return e.isUnderDevelopment&&this._environmentService.extensionDevelopmentKind?this._environmentService.extensionDevelopmentKind:this._extensionManifestPropertiesService.getExtensionKind(e)}getRunningLocation(e){return this._runningLocation.get(e)||null}filterByRunningLocation(e,t){return zk(e,this._runningLocation,i=>t.equals(i))}filterByExtensionHostKind(e,t){return zk(e,this._runningLocation,i=>i.kind===t)}filterByExtensionHostManager(e,t){return zk(e,this._runningLocation,i=>t.representsRunningLocation(i))}_computeAffinity(e,t,i){const n=new ko;for(const u of e)(u.main||u.browser)&&n.set(u.identifier,u);for(const u of this._registry.getAllExtensionDescriptions())if(u.main||u.browser){const g=this._runningLocation.get(u.identifier);g&&g.kind===t&&n.set(u.identifier,u)}const o=new ko;let r=0;for(const[u,g]of n)o.set(g.identifier,++r);const a=(u,g)=>{for(const[m,v]of o)v===u&&o.set(m,g)};for(const[u,g]of n){if(!g.extensionDependencies)continue;const m=o.get(g.identifier);for(const v of g.extensionDependencies){const y=o.get(v);y&&y!==m&&a(y,m)}}const c=new Map;let d=0;for(const[u,g]of n){const m=this._runningLocation.get(g.identifier);if(m){const v=o.get(g.identifier);c.set(v,m.affinity),d=Math.max(d,m.affinity)}}if(!this._environmentService.isExtensionDevelopment){const u=this._configurationService.getValue("extensions.experimental.affinity")||{},g=Object.keys(u),m=new Map;for(const v of g){const y=u[v];if(typeof y!="number"||y<=0||Math.floor(y)!==y){this._logService.info(`Ignoring configured affinity for '${v}' because the value is not a positive integer.`);continue}const w=o.get(v);if(!w)continue;const C=c.get(w);if(C){m.set(y,C);continue}const T=m.get(y);if(T){c.set(w,T);continue}if(!i){this._logService.info(`Ignoring configured affinity for '${v}' because extension host(s) are already running. Reload window.`);continue}const k=++d;m.set(y,k),c.set(w,k)}}const l=new ko;for(const u of e){const g=o.get(u.identifier)||0,m=c.get(g)||0;l.set(u.identifier,m)}if(d>0&&i)for(let u=1;u<=d;u++){const g=[];for(const m of e)l.get(m.identifier)===u&&g.push(m.identifier);this._logService.info(`Placing extension(s) ${g.map(m=>m.value).join(", ")} on a separate extension host.`)}return{affinities:l,maxAffinity:d}}computeRunningLocation(e,t,i){return this._doComputeRunningLocation(this._runningLocation,e,t,i).runningLocation}_doComputeRunningLocation(e,t,i,n){t=t.filter(v=>!e.has(v.identifier)),i=i.filter(v=>!e.has(v.identifier));const o=SAe(t,i,v=>this.readExtensionKinds(v),(v,y,w,C,T)=>this._extensionHostKindPicker.pickExtensionHostKind(v,y,w,C,T)),r=new ko;for(const v of t)r.set(v.identifier,v);for(const v of i)r.set(v.identifier,v);const a=new ko,c=[],d=[];for(const[v,y]of o){let w=null;if(y===Lt.LocalProcess){const C=r.get(v);C&&c.push(C)}else if(y===Lt.LocalWebWorker){const C=r.get(v);C&&d.push(C)}else y===Lt.Remote&&(w=new PR);a.set(v,w)}const{affinities:l,maxAffinity:u}=this._computeAffinity(c,Lt.LocalProcess,n);for(const v of c){const y=l.get(v.identifier)||0;a.set(v.identifier,new RR(y))}const{affinities:g,maxAffinity:m}=this._computeAffinity(d,Lt.LocalWebWorker,n);for(const v of d){const y=g.get(v.identifier)||0;a.set(v.identifier,new EV(y))}for(const[v,y]of e)y&&a.set(v,y);return{runningLocation:a,maxLocalProcessAffinity:u,maxLocalWebWorkerAffinity:m}}initializeRunningLocation(e,t){const{runningLocation:i,maxLocalProcessAffinity:n,maxLocalWebWorkerAffinity:o}=this._doComputeRunningLocation(this._runningLocation,e,t,!0);this._runningLocation=i,this._maxLocalProcessAffinity=n,this._maxLocalWebWorkerAffinity=o}deltaExtensions(e,t){const i=new ko;for(const n of t){const o=n;i.set(o,this._runningLocation.get(o)||null),this._runningLocation.delete(o)}return this._updateRunningLocationForAddedExtensions(e),i}_updateRunningLocationForAddedExtensions(e){const t=[],i=[];for(const r of e){const a=this.readExtensionKinds(r),c=r.extensionLocation.scheme===ae.vscodeRemote,d=this._extensionHostKindPicker.pickExtensionHostKind(r.identifier,a,!c,c,Zr.None);let l=null;d===Lt.LocalProcess?t.push(r):d===Lt.LocalWebWorker?i.push(r):d===Lt.Remote&&(l=new PR),this._runningLocation.set(r.identifier,l)}const{affinities:n}=this._computeAffinity(t,Lt.LocalProcess,!1);for(const r of t){const a=n.get(r.identifier)||0;this._runningLocation.set(r.identifier,new RR(a))}const{affinities:o}=this._computeAffinity(i,Lt.LocalWebWorker,!1);for(const r of i){const a=o.get(r.identifier)||0;this._runningLocation.set(r.identifier,new EV(a))}}};xV=f([p(2,mn),p(3,ne),p(4,Pe),p(5,$v)],xV);function zk(s,e,t){return s.filter(i=>{const n=e.get(i.identifier);return n&&t(n)})}function tRe(s,e,t){return s.filter(i=>{const n=e.get(i);return n&&t(n)})}let IV=class extends F{get pid(){return this._actual?this._actual.pid:null}get kind(){return this._extensionHost.runningLocation.kind}get startup(){return this._extensionHost.startup}get friendyName(){return Vce(this.kind,this.pid)}constructor(e,t,i,n){super(),this._internalExtensionService=t,this._instantiationService=i,this._logService=n,this._onDidChangeResponsiveState=this._register(new M),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._extensionHost=e,this.onDidExit=e.onExit,this._startCalled=new Np,this._actual=null,this._lazyStartExtensions=null}_createActual(e){return this._logService.info(`Creating lazy extension host (${this.friendyName}). Reason: ${e}`),this._actual=this._register(this._instantiationService.createInstance(TR,this._extensionHost,[],this._internalExtensionService)),this._register(this._actual.onDidChangeResponsiveState(t=>this._onDidChangeResponsiveState.fire(t))),this._actual}async _getOrCreateActualAndStart(e){if(this._actual)return this._actual;const t=this._createActual(e);return await t.start(this._lazyStartExtensions.versionId,this._lazyStartExtensions.allExtensions,this._lazyStartExtensions.myExtensions),t}async ready(){await this._startCalled.wait(),this._actual&&await this._actual.ready()}async disconnect(){await this._actual?.disconnect()}representsRunningLocation(e){return this._extensionHost.runningLocation.equals(e)}async deltaExtensions(e){if(await this._startCalled.wait(),this._actual)return this._actual.deltaExtensions(e);if(this._lazyStartExtensions.delta(e),e.myToAdd.length>0){await this._createActual(`contains ${e.myToAdd.length} new extension(s) (installed or enabled): ${e.myToAdd.map(i=>i.value)}`).start(this._lazyStartExtensions.versionId,this._lazyStartExtensions.allExtensions,this._lazyStartExtensions.myExtensions);return}}containsExtension(e){return this._extensionHost.extensions?.containsExtension(e)??!1}async activate(e,t){return await this._startCalled.wait(),this._actual?this._actual.activate(e,t):!1}async activateByEvent(e,t){if(t===Bp.Immediate)return this._actual?this._actual.activateByEvent(e,t):void 0;if(await this._startCalled.wait(),this._actual)return this._actual.activateByEvent(e,t)}activationEventIsDone(e){return this._startCalled.isOpen()?this._actual?this._actual.activationEventIsDone(e):!0:!1}async getInspectPort(e){return await this._startCalled.wait(),this._actual?.getInspectPort(e)}async resolveAuthority(e,t){return await this._startCalled.wait(),this._actual?this._actual.resolveAuthority(e,t):{type:"error",error:{message:"Cannot resolve authority",code:gr.Unknown,detail:void 0}}}async getCanonicalURI(e,t){if(await this._startCalled.wait(),this._actual)return this._actual.getCanonicalURI(e,t);throw new Error("Cannot resolve canonical URI")}async start(e,t,i){if(i.length>0){const o=this._createActual(`contains ${i.length} extension(s): ${i.map(r=>r.value)}.`).start(e,t,i);return this._startCalled.open(),o}this._lazyStartExtensions=new Ck(e,t,i),this._startCalled.open()}async extensionTestsExecute(){return await this._startCalled.wait(),(await this._getOrCreateActualAndStart("execute tests.")).extensionTestsExecute()}async setRemoteEnvironment(e){if(await this._startCalled.wait(),this._actual)return this._actual.setRemoteEnvironment(e)}};IV=f([p(2,J),p(3,Pe)],IV);var DV;const E0=Object.hasOwnProperty,iRe=Promise.resolve(void 0);let kV=DV=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A,B){super(),this._extensionsProposedApi=t,this._extensionHostFactory=i,this._extensionHostKindPicker=n,this._instantiationService=o,this._notificationService=r,this._environmentService=a,this._telemetryService=c,this._extensionEnablementService=d,this._fileService=l,this._productService=u,this._extensionManagementService=g,this._contextService=m,this._configurationService=v,this._extensionManifestPropertiesService=y,this._logService=w,this._remoteAgentService=C,this._remoteExtensionsScannerService=T,this._lifecycleService=k,this._remoteAuthorityResolverService=A,this._dialogService=B,this._onDidRegisterExtensions=this._register(new M),this.onDidRegisterExtensions=this._onDidRegisterExtensions.event,this._onDidChangeExtensionsStatus=this._register(new M),this.onDidChangeExtensionsStatus=this._onDidChangeExtensionsStatus.event,this._onDidChangeExtensions=this._register(new M({leakWarningThreshold:400})),this.onDidChangeExtensions=this._onDidChangeExtensions.event,this._onWillActivateByEvent=this._register(new M),this.onWillActivateByEvent=this._onWillActivateByEvent.event,this._onDidChangeResponsiveChange=this._register(new M),this.onDidChangeResponsiveChange=this._onDidChangeResponsiveChange.event,this._onWillStop=this._register(new M),this.onWillStop=this._onWillStop.event,this._activationEventReader=new dRe,this._registry=new zTe(this._activationEventReader),this._installedExtensionsReady=new Np,this._extensionStatus=new ko,this._allRequestedActivateEvents=new Set,this._remoteCrashTracker=new LR,this._deltaExtensionsQueue=[],this._inHandleDeltaExtensions=!1,this._extensionHostManagers=this._register(new nRe),this._resolveAuthorityAttempt=0,this._hasLocalProcess=e.hasLocalProcess,this._allowRemoteExtensionsInLocalWebWorker=e.allowRemoteExtensionsInLocalWebWorker,this._register(this._fileService.onWillActivateFileSystemProvider(z=>{z.scheme!==ae.vscodeRemote&&z.join(this.activateByEvent(`onFileSystem:${z.scheme}`))})),this._runningLocations=new xV(this._registry,this._extensionHostKindPicker,this._environmentService,this._configurationService,this._logService,this._extensionManifestPropertiesService),this._register(this._extensionEnablementService.onEnablementChanged(z=>{const Q=[],ie=[];for(const oe of z)this._safeInvokeIsEnabled(oe)?Q.push(oe):ie.push(oe);Fl&&this._logService.info(`AbstractExtensionService.onEnablementChanged fired for ${z.map(oe=>oe.identifier.id).join(", ")}`),this._handleDeltaExtensions(new Uf(Q,ie))})),this._register(this._extensionManagementService.onDidChangeProfile(({added:z,removed:Q})=>{(z.length||Q.length)&&(Fl&&this._logService.info("AbstractExtensionService.onDidChangeProfile fired"),this._handleDeltaExtensions(new Uf(z,Q)))})),this._register(this._extensionManagementService.onDidEnableExtensions(z=>{z.length&&(Fl&&this._logService.info("AbstractExtensionService.onDidEnableExtensions fired"),this._handleDeltaExtensions(new Uf(z,[])))})),this._register(this._extensionManagementService.onDidInstallExtensions(z=>{const Q=[];for(const{local:ie,operation:oe}of z)ie&&ie.isValid&&oe!==jie.Migrate&&this._safeInvokeIsEnabled(ie)&&Q.push(ie);Q.length&&(Fl&&this._logService.info(`AbstractExtensionService.onDidInstallExtensions fired for ${Q.map(ie=>ie.identifier.id).join(", ")}`),this._handleDeltaExtensions(new Uf(Q,[])))})),this._register(this._extensionManagementService.onDidUninstallExtension(z=>{z.error||(Fl&&this._logService.info(`AbstractExtensionService.onDidUninstallExtension fired for ${z.identifier.id}`),this._handleDeltaExtensions(new Uf([],[z.identifier.id])))})),this._register(this._lifecycleService.onWillShutdown(z=>{this._remoteAgentService.getConnection()?z.join(async()=>{try{await this._remoteAgentService.endConnection(),await this._doStopExtensionHosts(),this._remoteAgentService.getConnection()?.dispose()}catch{this._logService.warn("Error while disconnecting remote agent")}},{id:"join.disconnectRemote",label:h(12574,"Disconnect Remote Agent"),order:Yme.Last}):z.join(this._doStopExtensionHosts(),{id:"join.stopExtensionHosts",label:h(12575,"Stopping Extension Hosts")})}))}_getExtensionHostManagers(e){return this._extensionHostManagers.getByKind(e)}async _handleDeltaExtensions(e){if(this._deltaExtensionsQueue.push(e),this._inHandleDeltaExtensions)return;let t=null;try{for(this._inHandleDeltaExtensions=!0,await this._installedExtensionsReady.wait(),t=await this._registry.acquireLock("handleDeltaExtensions");this._deltaExtensionsQueue.length>0;){const i=this._deltaExtensionsQueue.shift();await this._deltaExtensions(t,i.toAdd,i.toRemove)}}finally{this._inHandleDeltaExtensions=!1,t?.dispose()}}async _deltaExtensions(e,t,i){Fl&&this._logService.info(`AbstractExtensionService._deltaExtensions: toAdd: [${t.map(a=>a.identifier.id).join(",")}] toRemove: [${i.map(a=>typeof a=="string"?a:a.identifier.id).join(",")}]`);let n=[];for(let a=0,c=i.length;a<c;a++){const d=i[a],l=typeof d=="string"?d:d.identifier.id,u=typeof d=="string"?null:d,g=this._registry.getExtensionDescription(l);g&&(u&&g.extensionLocation.scheme!==u.location.scheme||this.canRemoveExtension(g)&&n.push(g))}const o=[];for(let a=0,c=t.length;a<c;a++){const d=t[a],l=Ek(d,!1);l&&this._canAddExtension(l,n)&&o.push(l)}if(o.length===0&&n.length===0)return;const r=this._registry.deltaExtensions(e,o,n.map(a=>a.identifier));this._onDidChangeExtensions.fire({added:o,removed:n}),n=n.concat(r.removedDueToLooping),r.removedDueToLooping.length>0&&this._notificationService.notify({severity:Me.Error,message:h(12576,"The following extensions contain dependency loops and have been disabled: {0}",r.removedDueToLooping.map(a=>`'${a.identifier.value}'`).join(", "))}),this._extensionsProposedApi.updateEnabledApiProposals(o),this._doHandleExtensionPoints([].concat(o).concat(n),!1),await this._updateExtensionsOnExtHosts(r.versionId,o,n.map(a=>a.identifier));for(let a=0;a<o.length;a++)this._activateAddedExtensionIfNeeded(o[a])}async _updateExtensionsOnExtHosts(e,t,i){const n=this._runningLocations.deltaExtensions(t,i),o=this._extensionHostManagers.map(r=>this._updateExtensionsOnExtHost(r,e,t,i,n));await Promise.all(o)}async _updateExtensionsOnExtHost(e,t,i,n,o){const r=this._runningLocations.filterByExtensionHostManager(i,e),a=tRe(n,o,d=>e.representsRunningLocation(d)),c=Yie.createActivationEventsMap(i);if(Fl){const d=u=>u.map(g=>g.identifier.value).join(","),l=u=>u.map(g=>g.value).join(",");this._logService.info(`AbstractExtensionService: Calling deltaExtensions: toRemove: [${l(n)}], toAdd: [${d(i)}], myToRemove: [${l(a)}], myToAdd: [${d(r)}],`)}await e.deltaExtensions({versionId:t,toRemove:n,toAdd:i,addActivationEvents:c,myToRemove:a,myToAdd:r.map(d=>d.identifier)})}canAddExtension(e){return this._canAddExtension(e,[])}_canAddExtension(e,t){if(this._registry.getExtensionDescriptionByIdOrUUID(e.identifier,e.id)&&!t.some(c=>Es.equals(e.identifier,c.identifier)))return!1;const n=this._runningLocations.readExtensionKinds(e),o=e.extensionLocation.scheme===ae.vscodeRemote;return this._extensionHostKindPicker.pickExtensionHostKind(e.identifier,n,!o,o,Zr.None)!==null}canRemoveExtension(e){const t=this._registry.getExtensionDescription(e.identifier);return!(!t||this._extensionStatus.get(t.identifier)?.activationStarted)}async _activateAddedExtensionIfNeeded(e){let t=!1,i=null,n=!1;const o=this._activationEventReader.readActivationEvents(e);for(const r of o){if(this._allRequestedActivateEvents.has(r)){t=!0,i=r;break}if(r==="*"){t=!0,i=r;break}if(/^workspaceContains/.test(r)&&(n=!0),r==="onStartupFinished"){t=!0,i=r;break}}if(t)await Promise.all(this._extensionHostManagers.map(r=>r.activate(e.identifier,{startup:!1,extensionId:e.identifier,activationEvent:i}))).then(()=>{});else if(n){const r=await this._contextService.getCompleteWorkspace(),a=!!this._environmentService.remoteAuthority,c={logService:this._logService,folders:r.folders.map(l=>l.uri),forceUsingSearch:a,exists:l=>this._fileService.exists(l),checkExists:(l,u,g)=>this._instantiationService.invokeFunction(m=>Rce(m,l,u,g))},d=await nAe(c,e);if(!d)return;await Promise.all(this._extensionHostManagers.map(l=>l.activate(e.identifier,{startup:!1,extensionId:e.identifier,activationEvent:d.activationEvent}))).then(()=>{})}}async _initialize(){or("code/willLoadExtensions"),this._startExtensionHostsIfNecessary(!0,[]);const e=await this._registry.acquireLock("_initialize");try{await this._resolveAndProcessExtensions(e);const t=this._registry.getSnapshot();for(const i of this._extensionHostManagers)if(i.startup!==fh.EagerAutoStart){const n=this._runningLocations.filterByExtensionHostManager(t.extensions,i);i.start(t.versionId,t.extensions,n.map(o=>o.identifier))}}finally{e.dispose()}this._releaseBarrier(),or("code/didLoadExtensions"),await this._handleExtensionTests()}async _resolveAndProcessExtensions(e){let t=[],i=[],n=[];for await(const u of this._resolveExtensions())u instanceof Hce&&(t=Kk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,u.extensions,!1),this._registry.deltaExtensions(e,t,[]),this._doHandleExtensionPoints(t,!0)),u instanceof Uce&&(i=Kk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,u.extensions,!1)),u instanceof $ce&&(n=Kk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,u.extensions,!1));this._runningLocations.initializeRunningLocation(i,n),this._startExtensionHostsIfNecessary(!0,[]);const o=this._allowRemoteExtensionsInLocalWebWorker?this._runningLocations.filterByExtensionHostKind(n,Lt.LocalWebWorker):[],r=this._hasLocalProcess?this._runningLocations.filterByExtensionHostKind(i,Lt.LocalProcess):[],a=this._runningLocations.filterByExtensionHostKind(i,Lt.LocalWebWorker);n=this._runningLocations.filterByExtensionHostKind(n,Lt.Remote);for(const u of o)aRe(a,u.identifier)||a.push(u);const c=n.concat(r).concat(a);let d=c;if(t.length&&(d=c.filter(u=>!t.some(g=>Es.equals(g.identifier,u.identifier)&&g.extensionLocation.toString()===u.extensionLocation.toString())),c.length<d.length+t.length)){const u=t.filter(g=>!c.some(m=>Es.equals(m.identifier,g.identifier)&&m.extensionLocation.toString()===g.extensionLocation.toString()));u.length&&(this._registry.deltaExtensions(e,[],u.map(g=>g.identifier)),this._doHandleExtensionPoints(u,!0))}const l=this._registry.deltaExtensions(e,d,[]);l.removedDueToLooping.length>0&&this._notificationService.notify({severity:Me.Error,message:h(12576,"The following extensions contain dependency loops and have been disabled: {0}",l.removedDueToLooping.map(u=>`'${u.identifier.value}'`).join(", "))}),this._doHandleExtensionPoints(this._registry.getAllExtensionDescriptions(),!1)}async _handleExtensionTests(){if(!this._environmentService.isExtensionDevelopment||!this._environmentService.extensionTestsLocationURI)return;const e=this.findTestExtensionHost(this._environmentService.extensionTestsLocationURI);if(!e){const i=h(12577,"No extension host found that can launch the test runner at {0}.",this._environmentService.extensionTestsLocationURI.toString());console.error(i),this._notificationService.error(i);return}let t;try{t=await e.extensionTestsExecute(),Fl&&this._logService.info(`Extension host test runner exit code: ${t}`)}catch(i){Fl&&this._logService.error("Extension host test runner error",i),console.error(i),t=1}this._onExtensionHostExit(t)}findTestExtensionHost(e){let t=null;for(const i of this._registry.getAllExtensionDescriptions())if(cd(e,i.extensionLocation)){t=this._runningLocations.getRunningLocation(i.identifier);break}return t===null&&(e.scheme===ae.vscodeRemote?t=new PR:t=new RR(0)),t!==null?this._extensionHostManagers.getByRunningLocation(t):null}_releaseBarrier(){this._installedExtensionsReady.open(),this._onDidRegisterExtensions.fire(void 0),this._onDidChangeExtensionsStatus.fire(this._registry.getAllExtensionDescriptions().map(e=>e.identifier))}async _resolveAuthorityInitial(e){for(let i=1;;i++)try{return this._resolveAuthorityWithLogging(e)}catch(n){if(wp.isNoResolverFound(n)||wp.isNotAvailable(n)||i>=5)throw n}}async _resolveAuthorityAgain(){const e=this._environmentService.remoteAuthority;if(e){this._remoteAuthorityResolverService._clearResolvedAuthority(e);try{const t=await this._resolveAuthorityWithLogging(e);this._remoteAuthorityResolverService._setResolvedAuthority(t.authority,t.options)}catch(t){this._remoteAuthorityResolverService._setResolvedAuthorityError(e,t)}}}async _resolveAuthorityWithLogging(e){const t=foe(e),i=zn.create(!1);this._logService.info(`Invoking resolveAuthority(${t})...`);try{or(`code/willResolveAuthority/${t}`);const n=await this._resolveAuthority(e);return or(`code/didResolveAuthorityOK/${t}`),this._logService.info(`resolveAuthority(${t}) returned '${n.authority.connectTo}' after ${i.elapsed()} ms`),n}catch(n){throw or(`code/didResolveAuthorityError/${t}`),this._logService.error(`resolveAuthority(${t}) returned an error after ${i.elapsed()} ms`,n),n}}async _resolveAuthorityOnExtensionHosts(e,t){const i=this._getExtensionHostManagers(e);if(i.length===0)throw new Error("Cannot resolve authority");this._resolveAuthorityAttempt++;const n=await Promise.all(i.map(r=>r.resolveAuthority(t,this._resolveAuthorityAttempt)));let o=null;for(const r of n){if(r.type==="ok")return r.value;if(!o){o=r;continue}const a=o.error.code===gr.Unknown,c=r.error.code===gr.Unknown;a&&!c&&(o=r)}throw new wp(o.error.message,o.error.code,o.error.detail)}stopExtensionHosts(e,t){return this._doStopExtensionHostsWithVeto(e,t)}async _doStopExtensionHosts(){const e=[];for(const t of this._extensionStatus.values())t.activationStarted&&e.push(t.id);await this._extensionHostManagers.stopAllInReverse();for(const t of this._extensionStatus.values())t.clearRuntimeStatus();e.length>0&&this._onDidChangeExtensionsStatus.fire(e)}async _doStopExtensionHostsWithVeto(e,t=!1){if(t&&this._environmentService.isExtensionDevelopment)return!1;const i=[],n=new Set;this._onWillStop.fire({reason:e,auto:t,veto(r,a){i.push(r),typeof r=="boolean"?r===!0&&n.add(a):r.then(c=>{c&&n.add(a)}).catch(c=>{n.add(h(12578,"{0} (Error: {1})",a,ho(c)))})}});const o=await YAe(i,r=>this._logService.error(r));if(!o)await this._doStopExtensionHosts();else if(!t){const r=Array.from(n);this._logService.warn(`Extension host was not stopped because of veto (stop reason: ${e}, veto reason: ${r.join(", ")})`);const{confirmed:a}=await this._dialogService.confirm({type:Me.Warning,message:h(12579,"Please confirm restart of extensions."),detail:r.length===1?r[0]:r.join(`
 -`),primaryButton:h(12580,"Restart Anyway")});if(a)return!0}return!o}_startExtensionHostsIfNecessary(e,t){const i=[];for(let n=0;n<=this._runningLocations.maxLocalProcessAffinity;n++)i.push(new RR(n));for(let n=0;n<=this._runningLocations.maxLocalWebWorkerAffinity;n++)i.push(new EV(n));i.push(new PR);for(const n of i){if(this._extensionHostManagers.getByRunningLocation(n))continue;const o=this._createExtensionHostManager(n,e,t);if(o){const[r,a]=o;this._extensionHostManagers.add(r,a)}}}_createExtensionHostManager(e,t,i){const n=this._extensionHostFactory.createExtensionHost(this._runningLocations,e,t);if(!n)return null;const o=this._doCreateExtensionHostManager(n,i),r=new U;return r.add(o.onDidExit(([a,c])=>this._onExtensionHostCrashOrExit(o,a,c))),r.add(o.onDidChangeResponsiveState(a=>{this._logService.info(`Extension host (${o.friendyName}) is ${a===Am.Responsive?"responsive":"unresponsive"}.`),this._onDidChangeResponsiveChange.fire({extensionHostKind:o.kind,isResponsive:a===Am.Responsive,getInspectListener:c=>o.getInspectPort(c)})})),[o,r]}_doCreateExtensionHostManager(e,t){const i=this._acquireInternalAPI(e);return e.startup===fh.Lazy&&t.length===0?this._instantiationService.createInstance(IV,e,i):this._instantiationService.createInstance(TR,e,t,i)}_onExtensionHostCrashOrExit(e,t,i){if(!RK(this._environmentService).isExtensionDevHost){this._onExtensionHostCrashed(e,t,i);return}this._onExtensionHostExit(t)}_onExtensionHostCrashed(e,t,i){console.error(`Extension host (${e.friendyName}) terminated unexpectedly. Code: ${t}, Signal: ${i}`),e.kind===Lt.LocalProcess?this._doStopExtensionHosts():e.kind===Lt.Remote&&(i&&this._onRemoteExtensionHostCrashed(e,i),this._extensionHostManagers.stopOne(e))}_getExtensionHostExitInfoWithTimeout(e){return new Promise((t,i)=>{const n=setTimeout(()=>{i(new Error("getExtensionHostExitInfo timed out"))},2e3);this._remoteAgentService.getExtensionHostExitInfo(e).then(o=>{clearTimeout(n),t(o)},i)})}async _onRemoteExtensionHostCrashed(e,t){try{const i=await this._getExtensionHostExitInfoWithTimeout(t);i&&this._logService.error(`Extension host (${e.friendyName}) terminated unexpectedly with code ${i.code}.`),this._logExtensionHostCrash(e),this._remoteCrashTracker.registerCrash(),this._remoteCrashTracker.shouldAutomaticallyRestart()?(this._logService.info("Automatically restarting the remote extension host."),this._notificationService.status(h(12581,"The remote extension host terminated unexpectedly. Restarting..."),{hideAfter:5e3}),this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()))):this._notificationService.prompt(Me.Error,h(12582,"Remote Extension host terminated unexpectedly 3 times within the last 5 minutes."),[{label:h(12583,"Restart Remote Extension Host"),run:()=>{this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()))}}])}catch{}}_logExtensionHostCrash(e){const t=[];for(const i of this._extensionStatus.values())i.activationStarted&&e.containsExtension(i.id)&&t.push(i.id);t.length>0?this._logService.error(`Extension host (${e.friendyName}) terminated unexpectedly. The following extensions were running: ${t.map(i=>i.value).join(", ")}`):this._logService.error(`Extension host (${e.friendyName}) terminated unexpectedly. No extensions were activated.`)}async startExtensionHosts(e){await this._doStopExtensionHosts(),e&&await this._handleDeltaExtensions(new Uf(e.toAdd,e.toRemove));const t=await this._registry.acquireLock("startExtensionHosts");try{this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()));const i=this._getExtensionHostManagers(Lt.LocalProcess);await Promise.all(i.map(n=>n.ready()))}finally{t.dispose()}}activateByEvent(e,t=Bp.Normal){return this._installedExtensionsReady.isOpen()?(this._allRequestedActivateEvents.add(e),this._registry.containsActivationEvent(e)?this._activateByEvent(e,t):iRe):(this._allRequestedActivateEvents.add(e),t===Bp.Immediate?this._activateByEvent(e,t):this._installedExtensionsReady.wait().then(()=>this._activateByEvent(e,t)))}_activateByEvent(e,t){const i=Promise.all(this._extensionHostManagers.map(n=>n.activateByEvent(e,t))).then(()=>{});return this._onWillActivateByEvent.fire({event:e,activation:i}),i}activateById(e,t){return this._activateById(e,t)}activationEventIsDone(e){return this._installedExtensionsReady.isOpen()?this._registry.containsActivationEvent(e)?this._extensionHostManagers.every(t=>t.activationEventIsDone(e)):!0:!1}whenInstalledExtensionsRegistered(){return this._installedExtensionsReady.wait()}get extensions(){return this._registry.getAllExtensionDescriptions()}_getExtensionRegistrySnapshotWhenReady(){return this._installedExtensionsReady.wait().then(()=>this._registry.getSnapshot())}getExtension(e){return this._installedExtensionsReady.wait().then(()=>this._registry.getExtensionDescription(e))}readExtensionPointContributions(e){return this._installedExtensionsReady.wait().then(()=>{const t=this._registry.getAllExtensionDescriptions(),i=[];for(const n of t)n.contributes&&E0.call(n.contributes,e.name)&&i.push(new Qme(n,n.contributes[e.name]));return i})}getExtensionsStatus(){const e=Object.create(null);if(this._registry){const t=this._registry.getAllExtensionDescriptions();for(const i of t){const n=this._extensionStatus.get(i.identifier);e[i.identifier.value]={id:i.identifier,messages:n?.messages??[],activationStarted:n?.activationStarted??!1,activationTimes:n?.activationTimes??void 0,runtimeErrors:n?.runtimeErrors??[],runningLocation:this._runningLocations.getRunningLocation(i.identifier)}}}return e}async getInspectPorts(e,t){return(await Promise.all(this._getExtensionHostManagers(e).map(n=>n.getInspectPort(t)))).filter(ya)}async setRemoteEnvironment(e){await this._extensionHostManagers.map(t=>t.setRemoteEnvironment(e))}_safeInvokeIsEnabled(e){try{return this._extensionEnablementService.isEnabled(e)}catch{return!1}}_doHandleExtensionPoints(e,t){const i=Object.create(null);for(const a of e)if(a.contributes)for(const c in a.contributes)E0.call(a.contributes,c)&&(i[c]=!0);const n=a=>this._handleExtensionPointMessage(a),o=this._registry.getAllExtensionDescriptions(),r=_l.getExtensionPoints();or(t?"code/willHandleResolverExtensionPoints":"code/willHandleExtensionPoints");for(const a of r)i[a.name]&&(!t||a.canHandleResolver)&&(or(`code/willHandleExtensionPoint/${a.name}`),DV._handleExtensionPoint(a,o,n),or(`code/didHandleExtensionPoint/${a.name}`));or(t?"code/didHandleResolverExtensionPoints":"code/didHandleExtensionPoints")}_getOrCreateExtensionStatus(e){return this._extensionStatus.has(e)||this._extensionStatus.set(e,new cRe(e)),this._extensionStatus.get(e)}_handleExtensionPointMessage(e){this._getOrCreateExtensionStatus(e.extensionId).addMessage(e);const i=this._registry.getExtensionDescription(e.extensionId),n=`[${e.extensionId.value}]: ${e.message}`;if(e.type===Me.Error?(i&&i.isUnderDevelopment&&this._notificationService.notify({severity:Me.Error,message:n}),this._logService.error(n)):e.type===Me.Warning?(i&&i.isUnderDevelopment&&this._notificationService.notify({severity:Me.Warning,message:n}),this._logService.warn(n)):this._logService.info(n),e.extensionId&&this._environmentService.isBuilt&&!this._environmentService.isExtensionDevelopment){const{type:o,extensionId:r,extensionPointId:a,message:c}=e;this._telemetryService.publicLog2("extensionsMessage",{type:o,extensionId:r.value,extensionPointId:a,message:c})}}static _handleExtensionPoint(e,t,i){const n=[];for(const o of t)o.contributes&&E0.call(o.contributes,e.name)&&n.push({description:o,value:o.contributes[e.name],collector:new Xme(i,o,e.name)});e.acceptUsers(n)}_acquireInternalAPI(e){return{_activateById:(t,i)=>this._activateById(t,i),_onWillActivateExtension:t=>this._onWillActivateExtension(t,e.runningLocation),_onDidActivateExtension:(t,i,n,o,r)=>this._onDidActivateExtension(t,i,n,o,r),_onDidActivateExtensionError:(t,i)=>this._onDidActivateExtensionError(t,i),_onExtensionRuntimeError:(t,i)=>this._onExtensionRuntimeError(t,i)}}async _activateById(e,t){if(!(await Promise.all(this._extensionHostManagers.map(o=>o.activate(e,t)))).some(o=>o))throw new Error(`Unknown extension ${e.value}`)}_onWillActivateExtension(e,t){this._runningLocations.set(e,t),this._getOrCreateExtensionStatus(e).onWillActivate()}_onDidActivateExtension(e,t,i,n,o){this._getOrCreateExtensionStatus(e).setActivationTimes(new Zme(t,i,n,o)),this._onDidChangeExtensionsStatus.fire([e])}_onDidActivateExtensionError(e,t){this._telemetryService.publicLog2("extensionActivationError",{extensionId:e.value,error:t.message})}_onExtensionRuntimeError(e,t){this._getOrCreateExtensionStatus(e).addRuntimeError(t),this._onDidChangeExtensionsStatus.fire([e])}};kV=DV=f([p(4,J),p(5,At),p(6,mn),p(7,li),p(8,gd),p(9,Xe),p(10,Fn),p(11,ON),p(12,Tt),p(13,ne),p(14,$v),p(15,Pe),p(16,Nh),p(17,xN),p(18,wd),p(19,Hh),p(20,Qt)],kV);class nRe extends F{constructor(){super(...arguments),this._extensionHostManagers=[]}dispose(){for(let e=this._extensionHostManagers.length-1;e>=0;e--){const t=this._extensionHostManagers[e];t.extensionHost.disconnect(),t.dispose()}this._extensionHostManagers=[],super.dispose()}add(e,t){this._extensionHostManagers.push(new sRe(e,t))}async stopAllInReverse(){for(let e=this._extensionHostManagers.length-1;e>=0;e--){const t=this._extensionHostManagers[e];await t.extensionHost.disconnect(),t.dispose()}this._extensionHostManagers=[]}async stopOne(e){const t=this._extensionHostManagers.findIndex(i=>i.extensionHost===e);t>=0&&(this._extensionHostManagers.splice(t,1),await e.disconnect(),e.dispose())}getByKind(e){return this.filter(t=>t.kind===e)}getByRunningLocation(e){for(const t of this._extensionHostManagers)if(t.extensionHost.representsRunningLocation(e))return t.extensionHost;return null}*[Symbol.iterator](){for(const e of this._extensionHostManagers)yield e.extensionHost}map(e){return this._extensionHostManagers.map(t=>e(t.extensionHost))}every(e){return this._extensionHostManagers.every(t=>e(t.extensionHost))}filter(e){return this._extensionHostManagers.filter(t=>e(t.extensionHost)).map(t=>t.extensionHost)}}class sRe{constructor(e,t){this.extensionHost=e,this.disposableStore=t}dispose(){this.disposableStore.dispose(),this.extensionHost.dispose()}}class Hce{constructor(e){this.extensions=e}}class Uce{constructor(e){this.extensions=e}}class $ce{constructor(e){this.extensions=e}}class Uf{constructor(e,t){this.toAdd=e,this.toRemove=t}}function oRe(s){return!!s.activationEvents?.some(e=>e.startsWith("onResolveRemoteAuthority:"))}function Kk(s,e,t,i,n){return t.updateEnabledApiProposals(i),rRe(s,e,i,n)}function rRe(s,e,t,i){const n=[],o=[],r=[];for(const c of t)c.isUnderDevelopment?n.push(c):(o.push(c),r.push(Qie(c)));const a=e.getEnablementStates(r,i?{trusted:!0}:void 0);for(let c=0;c<a.length;c++)e.isEnabledEnablementState(a[c])?n.push(o[c]):Fl&&s.info(`filterEnabledExtensions: extension '${o[c].identifier.value}' is disabled`);return n}function aRe(s,e){for(const t of s)if(Es.equals(t.identifier,e))return!0;return!1}class cRe{get messages(){return this._messages}get activationTimes(){return this._activationTimes}get runtimeErrors(){return this._runtimeErrors}get activationStarted(){return this._activationStarted}constructor(e){this.id=e,this._messages=[],this._activationTimes=null,this._runtimeErrors=[],this._activationStarted=!1}clearRuntimeStatus(){this._activationStarted=!1,this._activationTimes=null,this._runtimeErrors=[]}addMessage(e){this._messages.push(e)}setActivationTimes(e){this._activationTimes=e}addRuntimeError(e){this._runtimeErrors.push(e)}onWillActivate(){this._activationStarted=!0}}class LR{constructor(){this._recentCrashes=[]}static{this._TIME_LIMIT=5*60*1e3}static{this._CRASH_LIMIT=3}_removeOldCrashes(){const e=Date.now()-LR._TIME_LIMIT;for(;this._recentCrashes.length>0&&this._recentCrashes[0].timestamp<e;)this._recentCrashes.shift()}registerCrash(){this._removeOldCrashes(),this._recentCrashes.push({timestamp:Date.now()})}shouldAutomaticallyRestart(){return this._removeOldCrashes(),this._recentCrashes.length<LR._CRASH_LIMIT}}class dRe{readActivationEvents(e){return Yie.readActivationEvents(e)}}class lRe extends F{constructor(){super(...arguments),this.type="markdown"}shouldRender(e){return!!e.activationEvents}render(e){const t=e.activationEvents||[],i=new Ni;if(t.length)for(const n of t)i.appendMarkdown(`- \`${n}\`
`);return{data:i,dispose:()=>{}}}}Ge.as(_w.ExtensionFeaturesRegistry).registerExtensionFeature({id:"activationEvents",label:h(12584,"Activation Events"),access:{canToggle:!1},renderer:new _r(lRe)});const hRe="security.workspace.trust.enabled",GQ="security.workspace.trust.untrustedFiles",uRe="security.workspace.trust.emptyWindow",gRe="extensions.supportUntrustedWorkspaces",pRe="content.trust.model.key";class fRe{constructor(e,t,i){this.originalWorkspace=e,this.canonicalFolderUris=t,this.canonicalConfiguration=i}get folders(){return this.originalWorkspace.folders.map((e,t)=>({index:e.index,name:e.name,toResource:e.toResource,uri:this.canonicalFolderUris[t]}))}get transient(){return this.originalWorkspace.transient}get configuration(){return this.canonicalConfiguration??this.originalWorkspace.configuration}get id(){return this.originalWorkspace.id}}let qQ=class extends F{constructor(e,t){super(),this.configurationService=e,this.environmentService=t}isWorkspaceTrustEnabled(){return this.environmentService.disableWorkspaceTrust?!1:!!this.configurationService.getValue(hRe)}};qQ=f([p(0,ne),p(1,mn)],qQ);let zQ=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this.configurationService=e,this.remoteAuthorityResolverService=t,this.storageService=i,this.uriIdentityService=n,this.environmentService=o,this.workspaceService=r,this.workspaceTrustEnablementService=a,this.fileService=c,this.storageKey=pRe,this._onDidChangeTrust=this._register(new M),this.onDidChangeTrust=this._onDidChangeTrust.event,this._onDidChangeTrustedFolders=this._register(new M),this.onDidChangeTrustedFolders=this._onDidChangeTrustedFolders.event,this._canonicalStartupFiles=[],this._canonicalUrisResolved=!1,this._canonicalWorkspace=this.workspaceService.getWorkspace(),{promise:this._workspaceResolvedPromise,resolve:this._workspaceResolvedPromiseResolve}=wE(),{promise:this._workspaceTrustInitializedPromise,resolve:this._workspaceTrustInitializedPromiseResolve}=wE(),this._storedTrustState=new vRe($t&&this.isEmptyWorkspace()?void 0:this.storageService),this._trustTransitionManager=this._register(new mRe),this._trustStateInfo=this.loadTrustInfo(),this._isTrusted=this.calculateWorkspaceTrust(),this.initializeWorkspaceTrust(),this.registerListeners()}initializeWorkspaceTrust(){this.resolveCanonicalUris().then(async()=>{this._canonicalUrisResolved=!0,await this.updateWorkspaceTrust()}).finally(()=>{this._workspaceResolvedPromiseResolve(),this.environmentService.remoteAuthority||this._workspaceTrustInitializedPromiseResolve()}),this.environmentService.remoteAuthority&&this.remoteAuthorityResolverService.resolveAuthority(this.environmentService.remoteAuthority).then(async e=>{this._remoteAuthority=e,await this.fileService.activateProvider(ae.vscodeRemote),await this.updateWorkspaceTrust()}).finally(()=>{this._workspaceTrustInitializedPromiseResolve()}),this.isEmptyWorkspace()&&this._workspaceTrustInitializedPromise.then(()=>{this._storedTrustState.isEmptyWorkspaceTrusted===void 0&&(this._storedTrustState.isEmptyWorkspaceTrusted=this.isWorkspaceTrusted())})}registerListeners(){this._register(this.workspaceService.onDidChangeWorkspaceFolders(async()=>await this.updateWorkspaceTrust())),this._register(this.storageService.onDidChangeValue(he.APPLICATION,this.storageKey,this._store)(async()=>{JSON.stringify(this._trustStateInfo)!==JSON.stringify(this.loadTrustInfo())&&(this._trustStateInfo=this.loadTrustInfo(),this._onDidChangeTrustedFolders.fire(),await this.updateWorkspaceTrust())}))}async getCanonicalUri(e){let t=e;if(this.environmentService.remoteAuthority&&e.scheme===ae.vscodeRemote)t=await this.remoteAuthorityResolverService.getCanonicalURI(e);else if(e.scheme==="vscode-vfs"){const i=e.authority.indexOf("+");i!==-1&&(t=e.with({authority:e.authority.substr(0,i)}))}return t.with({query:null,fragment:null})}async resolveCanonicalUris(){const e=[];if(this.environmentService.filesToOpenOrCreate&&e.push(...this.environmentService.filesToOpenOrCreate),this.environmentService.filesToDiff&&e.push(...this.environmentService.filesToDiff),this.environmentService.filesToMerge&&e.push(...this.environmentService.filesToMerge),e.length){const o=e.filter(a=>!!a.fileUri).map(a=>a.fileUri),r=await Promise.all(o.map(a=>this.getCanonicalUri(a)));this._canonicalStartupFiles.push(...r.filter(a=>this._canonicalStartupFiles.every(c=>!this.uriIdentityService.extUri.isEqual(a,c))))}const t=this.workspaceService.getWorkspace().folders.map(o=>o.uri),i=await Promise.all(t.map(o=>this.getCanonicalUri(o)));let n=this.workspaceService.getWorkspace().configuration;n&&b7(n,this.environmentService)&&(n=await this.getCanonicalUri(n)),this._canonicalWorkspace=new fRe(this.workspaceService.getWorkspace(),i,n)}loadTrustInfo(){const e=this.storageService.get(this.storageKey,he.APPLICATION);let t;try{e&&(t=JSON.parse(e))}catch{}return t||(t={uriTrustInfo:[]}),t.uriTrustInfo||(t.uriTrustInfo=[]),t.uriTrustInfo=t.uriTrustInfo.map(i=>({uri:R.revive(i.uri),trusted:i.trusted})),t.uriTrustInfo=t.uriTrustInfo.filter(i=>i.trusted),t}async saveTrustInfo(){this.storageService.store(this.storageKey,JSON.stringify(this._trustStateInfo),he.APPLICATION,pt.MACHINE),this._onDidChangeTrustedFolders.fire(),await this.updateWorkspaceTrust()}getWorkspaceUris(){const e=this._canonicalWorkspace.folders.map(i=>i.uri),t=this._canonicalWorkspace.configuration;return t&&b7(t,this.environmentService)&&e.push(t),e}calculateWorkspaceTrust(){return this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()?this._canonicalUrisResolved?this.environmentService.remoteAuthority&&this._remoteAuthority?.options?.isTrusted?this._remoteAuthority.options.isTrusted:this.isEmptyWorkspace()?this._storedTrustState.isEmptyWorkspaceTrusted!==void 0?this._storedTrustState.isEmptyWorkspaceTrusted:this._canonicalStartupFiles.length?this.getUrisTrust(this._canonicalStartupFiles):!!this.configurationService.getValue(uRe):this.getUrisTrust(this.getWorkspaceUris()):!1:!0}async updateWorkspaceTrust(e){this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()&&(e===void 0&&(await this.resolveCanonicalUris(),e=this.calculateWorkspaceTrust()),this.isWorkspaceTrusted()!==e&&(this.isTrusted=e,await this._trustTransitionManager.participate(e),this._onDidChangeTrust.fire(e)))}getUrisTrust(e){let t=!0;for(const i of e){const{trusted:n}=this.doGetUriTrustInfo(i);if(!n)return t=n,t}return t}doGetUriTrustInfo(e){if(!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled())return{trusted:!0,uri:e};if(this.isTrustedVirtualResource(e))return{trusted:!0,uri:e};if(this.isTrustedByRemote(e))return{trusted:!0,uri:e};let t=!1,i=-1,n=e;for(const o of this._trustStateInfo.uriTrustInfo)if(this.uriIdentityService.extUri.isEqualOrParent(e,o.uri)){const r=o.uri.fsPath;r.length>i&&(i=r.length,t=o.trusted,n=o.uri)}return{trusted:t,uri:n}}async doSetUrisTrust(e,t){let i=!1;for(const n of e)if(t){if(this.isTrustedVirtualResource(n)||this.isTrustedByRemote(n))continue;this._trustStateInfo.uriTrustInfo.find(r=>this.uriIdentityService.extUri.isEqual(r.uri,n))||(this._trustStateInfo.uriTrustInfo.push({uri:n,trusted:!0}),i=!0)}else{const o=this._trustStateInfo.uriTrustInfo.length;this._trustStateInfo.uriTrustInfo=this._trustStateInfo.uriTrustInfo.filter(r=>!this.uriIdentityService.extUri.isEqual(r.uri,n)),o!==this._trustStateInfo.uriTrustInfo.length&&(i=!0)}i&&await this.saveTrustInfo()}isEmptyWorkspace(){if(this.workspaceService.getWorkbenchState()===zo.EMPTY)return!0;const e=this.workspaceService.getWorkspace();return e?zM(this.workspaceService.getWorkspace())&&e.folders.length===0:!1}isTrustedVirtualResource(e){return Jme(e)&&e.scheme!=="vscode-vfs"}isTrustedByRemote(e){return!this.environmentService.remoteAuthority||!this._remoteAuthority?!1:xF(eve(e),this._remoteAuthority.authority.authority)&&!!this._remoteAuthority.options?.isTrusted}set isTrusted(e){this._isTrusted=e,e||(this._storedTrustState.acceptsOutOfWorkspaceFiles=!1),this.isEmptyWorkspace()&&(this._storedTrustState.isEmptyWorkspaceTrusted=e)}get workspaceResolved(){return this._workspaceResolvedPromise}get workspaceTrustInitialized(){return this._workspaceTrustInitializedPromise}get acceptsOutOfWorkspaceFiles(){return this._storedTrustState.acceptsOutOfWorkspaceFiles}set acceptsOutOfWorkspaceFiles(e){this._storedTrustState.acceptsOutOfWorkspaceFiles=e}isWorkspaceTrusted(){return this._isTrusted}isWorkspaceTrustForced(){return!!(this.environmentService.remoteAuthority&&this._remoteAuthority&&this._remoteAuthority.options?.isTrusted!==void 0||this.getWorkspaceUris().filter(t=>!this.isTrustedVirtualResource(t)).length===0)}canSetParentFolderTrust(){const e=cC(this._canonicalWorkspace);if(!SE(e)||e.uri.scheme!==ae.file&&e.uri.scheme!==ae.vscodeRemote)return!1;const t=this.uriIdentityService.extUri.dirname(e.uri);return!this.uriIdentityService.extUri.isEqual(e.uri,t)}async setParentFolderTrust(e){if(this.canSetParentFolderTrust()){const t=cC(this._canonicalWorkspace).uri,i=this.uriIdentityService.extUri.dirname(t);await this.setUrisTrust([i],e)}}canSetWorkspaceTrust(){if(this.environmentService.remoteAuthority&&(!this._remoteAuthority||this._remoteAuthority.options?.isTrusted!==void 0))return!1;if(this.isEmptyWorkspace())return!0;if(this.getWorkspaceUris().filter(n=>!this.isTrustedVirtualResource(n)).length===0)return!1;if(!this.isWorkspaceTrusted())return!0;const t=cC(this._canonicalWorkspace);if(!SE(t)||t.uri.scheme!==ae.file&&t.uri.scheme!=="vscode-vfs")return!1;const i=this.doGetUriTrustInfo(t.uri);if(!i.trusted||!this.uriIdentityService.extUri.isEqual(t.uri,i.uri))return!1;if(this.canSetParentFolderTrust()){const n=this.uriIdentityService.extUri.dirname(t.uri);if(this.doGetUriTrustInfo(n).trusted)return!1}return!0}async setWorkspaceTrust(e){if(this.isEmptyWorkspace()){await this.updateWorkspaceTrust(e);return}const t=this.getWorkspaceUris();await this.setUrisTrust(t,e)}async getUriTrustInfo(e){return this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()?this.isTrustedByRemote(e)?{trusted:!0,uri:e}:this.doGetUriTrustInfo(await this.getCanonicalUri(e)):{trusted:!0,uri:e}}async setUrisTrust(e,t){this.doSetUrisTrust(await Promise.all(e.map(i=>this.getCanonicalUri(i))),t)}getTrustedUris(){return this._trustStateInfo.uriTrustInfo.map(e=>e.uri)}async setTrustedUris(e){this._trustStateInfo.uriTrustInfo=[];for(const t of e){const i=await this.getCanonicalUri(t),n=this.uriIdentityService.extUri.removeTrailingPathSeparator(i);let o=!1;for(const r of this._trustStateInfo.uriTrustInfo)if(this.uriIdentityService.extUri.isEqual(r.uri,n)){o=!0;break}o||this._trustStateInfo.uriTrustInfo.push({trusted:!0,uri:n})}await this.saveTrustInfo()}addWorkspaceTrustTransitionParticipant(e){return this._trustTransitionManager.addWorkspaceTrustTransitionParticipant(e)}};zQ=f([p(0,ne),p(1,Hh),p(2,tt),p(3,Zi),p(4,mn),p(5,Tt),p(6,fq),p(7,Xe)],zQ);let KQ=class extends F{constructor(e,t){super(),this.configurationService=e,this.workspaceTrustManagementService=t,this._onDidInitiateOpenFilesTrustRequest=this._register(new M),this.onDidInitiateOpenFilesTrustRequest=this._onDidInitiateOpenFilesTrustRequest.event,this._onDidInitiateWorkspaceTrustRequest=this._register(new M),this.onDidInitiateWorkspaceTrustRequest=this._onDidInitiateWorkspaceTrustRequest.event,this._onDidInitiateWorkspaceTrustRequestOnStartup=this._register(new M),this.onDidInitiateWorkspaceTrustRequestOnStartup=this._onDidInitiateWorkspaceTrustRequestOnStartup.event}get untrustedFilesSetting(){return this.configurationService.getValue(GQ)}set untrustedFilesSetting(e){this.configurationService.updateValue(GQ,e)}async completeOpenFilesTrustRequest(e,t){this._openFilesTrustRequestResolver&&(e===Ud.Open&&(this.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles=!0),t&&(e===Ud.Open&&(this.untrustedFilesSetting="open"),e===Ud.OpenInNewWindow&&(this.untrustedFilesSetting="newWindow")),this._openFilesTrustRequestResolver(e),this._openFilesTrustRequestResolver=void 0,this._openFilesTrustRequestPromise=void 0)}async requestOpenFilesTrust(e){if(!this.workspaceTrustManagementService.isWorkspaceTrusted()||(await Promise.all(e.map(i=>this.workspaceTrustManagementService.getUriTrustInfo(i)))).map(i=>i.trusted).every(i=>i))return Ud.Open;if(this.untrustedFilesSetting!=="prompt"){if(this.untrustedFilesSetting==="newWindow")return Ud.OpenInNewWindow;if(this.untrustedFilesSetting==="open")return Ud.Open}if(this.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles)return Ud.Open;if(!this._openFilesTrustRequestPromise)this._openFilesTrustRequestPromise=new Promise(i=>{this._openFilesTrustRequestResolver=i});else return this._openFilesTrustRequestPromise;return this._onDidInitiateOpenFilesTrustRequest.fire(),this._openFilesTrustRequestPromise}resolveWorkspaceTrustRequest(e){this._workspaceTrustRequestResolver&&(this._workspaceTrustRequestResolver(e??this.workspaceTrustManagementService.isWorkspaceTrusted()),this._workspaceTrustRequestResolver=void 0,this._workspaceTrustRequestPromise=void 0)}cancelWorkspaceTrustRequest(){this._workspaceTrustRequestResolver&&(this._workspaceTrustRequestResolver(void 0),this._workspaceTrustRequestResolver=void 0,this._workspaceTrustRequestPromise=void 0)}async completeWorkspaceTrustRequest(e){if(e===void 0||e===this.workspaceTrustManagementService.isWorkspaceTrusted()){this.resolveWorkspaceTrustRequest(e);return}D.once(this.workspaceTrustManagementService.onDidChangeTrust)(t=>this.resolveWorkspaceTrustRequest(t)),await this.workspaceTrustManagementService.setWorkspaceTrust(e)}async requestWorkspaceTrust(e){if(this.workspaceTrustManagementService.isWorkspaceTrusted())return this.workspaceTrustManagementService.isWorkspaceTrusted();if(!this._workspaceTrustRequestPromise)this._workspaceTrustRequestPromise=new Promise(t=>{this._workspaceTrustRequestResolver=t});else return this._workspaceTrustRequestPromise;return this._onDidInitiateWorkspaceTrustRequest.fire(e),this._workspaceTrustRequestPromise}requestWorkspaceTrustOnStartup(){this._workspaceTrustRequestPromise||(this._workspaceTrustRequestPromise=new Promise(e=>{this._workspaceTrustRequestResolver=e})),this._onDidInitiateWorkspaceTrustRequestOnStartup.fire()}};KQ=f([p(0,ne),p(1,Tv)],KQ);class mRe extends F{constructor(){super(...arguments),this.participants=new aq}addWorkspaceTrustTransitionParticipant(e){const t=this.participants.push(e);return Ee(()=>t())}async participate(e){for(const t of this.participants)await t.participate(e)}dispose(){this.participants.clear(),super.dispose()}}class vRe{constructor(e){this._acceptsOutOfWorkspaceFilesKey="acceptsOutOfWorkspaceFiles",this._isEmptyWorkspaceTrustedKey="isEmptyWorkspaceTrusted",e?(this._memento=new uw("workspaceTrust",e),this._mementoObject=this._memento.getMemento(he.WORKSPACE,pt.MACHINE)):this._mementoObject={}}get acceptsOutOfWorkspaceFiles(){return this._mementoObject[this._acceptsOutOfWorkspaceFilesKey]??!1}set acceptsOutOfWorkspaceFiles(e){this._mementoObject[this._acceptsOutOfWorkspaceFilesKey]=e,this._memento?.saveMemento()}get isEmptyWorkspaceTrusted(){return this._mementoObject[this._isEmptyWorkspaceTrustedKey]}set isEmptyWorkspaceTrusted(e){this._mementoObject[this._isEmptyWorkspaceTrustedKey]=e,this._memento?.saveMemento()}}let TV=class extends F{constructor(e,t,i,n){super(),this.productService=e,this.configurationService=t,this.workspaceTrustEnablementService=i,this.logService=n,this._extensionPointExtensionKindsMap=null,this._productExtensionKindsMap=null,this._configuredExtensionKindsMap=null,this._productVirtualWorkspaceSupportMap=null,this._configuredVirtualWorkspaceSupportMap=null,this._configuredExtensionWorkspaceTrustRequestMap=new ko;const o=t.inspect(gRe).userValue||{};for(const r of Object.keys(o))this._configuredExtensionWorkspaceTrustRequestMap.set(r,o[r]);if(this._productExtensionWorkspaceTrustRequestMap=new Map,e.extensionUntrustedWorkspaceSupport)for(const r of Object.keys(e.extensionUntrustedWorkspaceSupport))this._productExtensionWorkspaceTrustRequestMap.set(r,e.extensionUntrustedWorkspaceSupport[r])}prefersExecuteOnUI(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="ui"}prefersExecuteOnWorkspace(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="workspace"}prefersExecuteOnWeb(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="web"}canExecuteOnUI(e){return this.getExtensionKind(e).some(i=>i==="ui")}canExecuteOnWorkspace(e){return this.getExtensionKind(e).some(i=>i==="workspace")}canExecuteOnWeb(e){return this.getExtensionKind(e).some(i=>i==="web")}getExtensionKind(e){const t=this.deduceExtensionKind(e),i=this.getConfiguredExtensionKind(e);if(i&&i.length>0){const n=[];for(const o of i)o!=="-web"&&n.push(o);return i.includes("-web")&&!n.length&&(n.push("ui"),n.push("workspace")),$t&&!i.includes("-web")&&!i.includes("web")&&t.includes("web")&&n.push("web"),n}return t}getUserConfiguredExtensionKind(e){if(this._configuredExtensionKindsMap===null){const i=new ko,n=this.configurationService.getValue("remote.extensionKind")||{};for(const o of Object.keys(n))i.set(o,n[o]);this._configuredExtensionKindsMap=i}const t=this._configuredExtensionKindsMap.get(e.id);return t?this.toArray(t):void 0}getExtensionUntrustedWorkspaceSupportType(e){if(!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()||!e.main)return!0;const t=this.getConfiguredExtensionWorkspaceTrustRequest(e),i=this.getProductExtensionWorkspaceTrustRequest(e);return t!==void 0?t:i?.override!==void 0?i.override:e.capabilities?.untrustedWorkspaces?.supported!==void 0?e.capabilities.untrustedWorkspaces.supported:i?.default!==void 0?i.default:!1}getExtensionVirtualWorkspaceSupportType(e){const t=this.getConfiguredVirtualWorkspaceSupport(e);if(t!==void 0)return t;const i=this.getProductVirtualWorkspaceSupport(e);if(i?.override!==void 0)return i.override;const n=e.capabilities?.virtualWorkspaces;if(y7(n))return n;if(n){const o=n.supported;if(y7(o)||o==="limited")return o}return i?.default!==void 0?i.default:!0}deduceExtensionKind(e){if(e.main)return e.browser?$t?["workspace","web"]:["workspace"]:["workspace"];if(e.browser)return["web"];let t=[...tve];if((xn(e.extensionPack)||xn(e.extensionDependencies))&&(t=$t?["workspace","web"]:["workspace"]),e.contributes)for(const i of Object.keys(e.contributes)){const n=this.getSupportedExtensionKindsForExtensionPoint(i);n.length&&(t=t.filter(o=>n.includes(o)))}return t.length||this.logService.warn("Cannot deduce extensionKind for extension",du(e.publisher,e.name)),t}getSupportedExtensionKindsForExtensionPoint(e){if(this._extensionPointExtensionKindsMap===null){const i=new Map;_l.getExtensionPoints().forEach(n=>i.set(n.name,n.defaultExtensionKind||[])),this._extensionPointExtensionKindsMap=i}let t=this._extensionPointExtensionKindsMap.get(e);return t||(t=this.productService.extensionPointExtensionKind?this.productService.extensionPointExtensionKind[e]:void 0,t)?t:$t?["workspace","web"]:["workspace"]}getConfiguredExtensionKind(e){const t={id:du(e.publisher,e.name)};let i=this.getUserConfiguredExtensionKind(t);return typeof i<"u"?this.toArray(i):(i=this.getProductExtensionKind(e),typeof i<"u"?i:(i=e.extensionKind,typeof i<"u"?(i=this.toArray(i),i.filter(n=>["ui","workspace"].includes(n))):null))}getProductExtensionKind(e){if(this._productExtensionKindsMap===null){const i=new ko;if(this.productService.extensionKind)for(const n of Object.keys(this.productService.extensionKind))i.set(n,this.productService.extensionKind[n]);this._productExtensionKindsMap=i}const t=du(e.publisher,e.name);return this._productExtensionKindsMap.get(t)}getProductVirtualWorkspaceSupport(e){if(this._productVirtualWorkspaceSupportMap===null){const i=new ko;if(this.productService.extensionVirtualWorkspacesSupport)for(const n of Object.keys(this.productService.extensionVirtualWorkspacesSupport))i.set(n,this.productService.extensionVirtualWorkspacesSupport[n]);this._productVirtualWorkspaceSupportMap=i}const t=du(e.publisher,e.name);return this._productVirtualWorkspaceSupportMap.get(t)}getConfiguredVirtualWorkspaceSupport(e){if(this._configuredVirtualWorkspaceSupportMap===null){const i=new ko,n=this.configurationService.getValue("extensions.supportVirtualWorkspaces")||{};for(const o of Object.keys(n))n[o]!==void 0&&i.set(o,n[o]);this._configuredVirtualWorkspaceSupportMap=i}const t=du(e.publisher,e.name);return this._configuredVirtualWorkspaceSupportMap.get(t)}getConfiguredExtensionWorkspaceTrustRequest(e){const t=du(e.publisher,e.name),i=this._configuredExtensionWorkspaceTrustRequestMap.get(t);if(i&&(i.version===void 0||i.version===e.version))return i.supported}getProductExtensionWorkspaceTrustRequest(e){const t=du(e.publisher,e.name);return this._productExtensionWorkspaceTrustRequestMap.get(t)}toArray(e){return Array.isArray(e)?e:e==="ui"?["ui","workspace"]:[e]}};TV=f([p(0,Fn),p(1,ne),p(2,fq),p(3,Pe)],TV);let AV=class{constructor(e,t,i){if(this._logService=e,this._environmentService=t,this._envEnabledExtensions=new Set((t.extensionEnabledProposedApi??[]).map(n=>Es.toKey(n))),this._envEnablesProposedApiForAll=!t.isBuilt||t.isExtensionDevelopment&&i.quality!=="stable"||this._envEnabledExtensions.size===0&&Array.isArray(t.extensionEnabledProposedApi),this._productEnabledExtensions=new Map,i.extensionEnabledApiProposals)for(const[n,o]of Object.entries(i.extensionEnabledApiProposals)){const r=Es.toKey(n),a=o.filter(c=>EF[c]?!0:(e.warn(`Via 'product.json#extensionEnabledApiProposals' extension '${r}' wants API proposal '${c}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`),!1));this._productEnabledExtensions.set(r,a)}}updateEnabledApiProposals(e){for(const t of e)this.doUpdateEnabledApiProposals(t)}doUpdateEnabledApiProposals(e){const t=Es.toKey(e.identifier);if(xn(e.enabledApiProposals)&&(e.enabledApiProposals=e.enabledApiProposals.filter(i=>{const n=!!EF[i];return n||this._logService.error(`Extension '${t}' wants API proposal '${i}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`),n})),this._productEnabledExtensions.has(t)){const i=this._productEnabledExtensions.get(t),n=new Set(i),o=new Set(e.enabledApiProposals),r=new Set([...o].filter(a=>!n.has(a)));r.size>0&&(this._logService.error(`Extension '${t}' appears in product.json but enables LESS API proposals than the extension wants.
package.json (LOSES): ${[...o].join(", ")}
product.json (WINS): ${[...n].join(", ")}`),this._environmentService.isExtensionDevelopment&&(this._logService.error(`Proceeding with EXTRA proposals (${[...r].join(", ")}) because extension is in development mode. Still, this EXTENSION WILL BE BROKEN unless product.json is updated.`),i.push(...r))),e.enabledApiProposals=i;return}this._envEnablesProposedApiForAll||this._envEnabledExtensions.has(t)||!e.isBuiltin&&xn(e.enabledApiProposals)&&(this._logService.error(`Extension '${e.identifier.value} CANNOT USE these API proposals '${e.enabledApiProposals?.join(", ")||"*"}'. You MUST start in extension development mode or use the --enable-proposed-api command line flag`),e.enabledApiProposals=[])}};AV=f([p(0,Pe),p(1,mn),p(2,Fn)],AV);class _Re extends F{constructor(){super(...arguments),this.type="markdown"}shouldRender(e){return!!e.originalEnabledApiProposals?.length||!!e.enabledApiProposals?.length}render(e){const t=e.originalEnabledApiProposals??e.enabledApiProposals??[],i=new Ni;if(t.length)for(const n of t)i.appendMarkdown(`- \`${n}\`
`);return{data:i,dispose:()=>{}}}}Ge.as(_w.ExtensionFeaturesRegistry).registerExtensionFeature({id:"enabledApiProposals",label:h(12586,"API Proposals"),access:{canToggle:!1},renderer:new _r(_Re)});async function bRe(s,e){const t=[];return await Gce(s,t,e.logsHome,e.logsHome),t}async function Gce(s,e,t,i){const n=await s.resolve(t);for(const{resource:o,isDirectory:r}of n.children||[])if(r)await Gce(s,e,o,i);else{const a=(await s.readFile(o)).value.toString();if(a){const c=Qu(i,o);c&&e.push({relativePath:c,contents:a})}}}const yRe=30*1e3;var Pm;(function(s){s[s.Management=1]="Management",s[s.ExtensionHost=2]="ExtensionHost",s[s.Tunnel=3]="Tunnel"})(Pm||(Pm={}));function RV(s){switch(s){case Pm.Management:return"Management";case Pm.ExtensionHost:return"ExtensionHost";case Pm.Tunnel:return"Tunnel"}}function qce(s){const e=new ri;return setTimeout(()=>e.cancel(),s),e.token}function wRe(s,e){if(s.isCancellationRequested||e.isCancellationRequested)return ye.Cancelled;const t=new ri;return s.onCancellationRequested(()=>t.cancel()),e.onCancellationRequested(()=>t.cancel()),t.token}class wO{get didTimeout(){return this._state==="timedout"}constructor(e){this._state="pending",this._disposables=new U,{promise:this.promise,resolve:this._resolvePromise,reject:this._rejectPromise}=wE(),e.isCancellationRequested?this._timeout():this._disposables.add(e.onCancellationRequested(()=>this._timeout()))}registerDisposable(e){this._state==="pending"?this._disposables.add(e):e.dispose()}_timeout(){this._state==="pending"&&(this._disposables.dispose(),this._state="timedout",this._rejectPromise(this._createTimeoutError()))}_createTimeoutError(){const e=new Error("Time limit reached");return e.code="ETIMEDOUT",e.syscall="connect",e}resolve(e){this._state==="pending"&&(this._disposables.dispose(),this._state="resolved",this._resolvePromise(e))}reject(e){this._state==="pending"&&(this._disposables.dispose(),this._state="rejected",this._rejectPromise(e))}}function SRe(s,e){const t=new wO(e);return t.registerDisposable(s.onControlMessage(i=>{const n=JSON.parse(i.toString()),o=jce(n);o?t.reject(o):t.resolve(n)})),t.promise}function CRe(s,e,t,i,n,o,r,a){const c=new wO(a),d=zn.create(!1);return s.info(`Creating a socket (${r})...`),or(`code/willCreateSocket/${o}`),e.connect(t,i,n,r).then(l=>{c.didTimeout?(or(`code/didCreateSocketError/${o}`),s.info(`Creating a socket (${r}) finished after ${d.elapsed()} ms, but this is too late and has timed out already.`),l?.dispose()):(or(`code/didCreateSocketOK/${o}`),s.info(`Creating a socket (${r}) was successful after ${d.elapsed()} ms.`),c.resolve(l))},l=>{or(`code/didCreateSocketError/${o}`),s.info(`Creating a socket (${r}) returned an error after ${d.elapsed()} ms.`),s.error(l),c.reject(l)}),c.promise}function x0(s,e){const t=new wO(e);return s.then(i=>{t.didTimeout||t.resolve(i)},i=>{t.didTimeout||t.reject(i)}),t.promise}async function ERe(s,e,t,i){const n=Yce(s,e);s.logService.trace(`${n} 1/6. invoking socketFactory.connect().`);let o;try{o=await CRe(s.logService,s.remoteSocketFactoryService,s.connectTo,IF.getServerRootPath(),`reconnectionToken=${s.reconnectionToken}&reconnection=${s.reconnectionProtocol?"true":"false"}`,RV(e),`renderer-${RV(e)}-${s.reconnectionToken}`,i)}catch(l){throw s.logService.error(`${n} socketFactory.connect() failed or timed out. Error:`),s.logService.error(l),l}s.logService.trace(`${n} 2/6. socketFactory.connect() was successful.`);let r,a;s.reconnectionProtocol?(s.reconnectionProtocol.beginAcceptReconnection(o,null),r=s.reconnectionProtocol,a=!1):(r=new yAe({socket:o}),a=!0),s.logService.trace(`${n} 3/6. sending AuthRequest control message.`);const c=await x0(s.signService.createNewMessage(Dn()),i),d={type:"auth",auth:s.connectionToken||"00000000000000000000",data:c.data};r.sendControl(Re.fromString(JSON.stringify(d)));try{const l=await SRe(r,wRe(i,qce(1e4)));if(l.type!=="sign"||typeof l.data!="string"){const v=new Error("Unexpected handshake message");throw v.code="VSCODE_CONNECTION_ERROR",v}if(s.logService.trace(`${n} 4/6. received SignRequest control message.`),!await x0(s.signService.validate(c,l.signedData),i)){const v=new Error("Refused to connect to unsupported server");throw v.code="VSCODE_CONNECTION_ERROR",v}const g=await x0(s.signService.sign(l.data),i),m={type:"connectionType",commit:s.commit,signedData:g,desiredConnectionType:e};return t&&(m.args=t),s.logService.trace(`${n} 5/6. sending ConnectionTypeRequest control message.`),r.sendControl(Re.fromString(JSON.stringify(m))),{protocol:r,ownsProtocol:a}}catch(l){throw l&&l.code==="ETIMEDOUT"&&(s.logService.error(`${n} the handshake timed out. Error:`),s.logService.error(l)),l&&l.code==="VSCODE_CONNECTION_ERROR"&&(s.logService.error(`${n} received error control message when negotiating connection. Error:`),s.logService.error(l)),a&&PK(r),l}}async function xRe(s,e,t,i){const n=Date.now(),o=Yce(s,e),{protocol:r,ownsProtocol:a}=await ERe(s,e,t,i),c=new wO(i);return c.registerDisposable(r.onControlMessage(d=>{const l=JSON.parse(d.toString()),u=jce(l);u?(s.logService.error(`${o} received error control message when negotiating connection. Error:`),s.logService.error(u),a&&PK(r),c.reject(u)):(s.reconnectionProtocol?.endAcceptReconnection(),s.logService.trace(`${o} 6/6. handshake finished, connection is up and running after ${ORe(n)}!`),c.resolve({protocol:r,firstMessage:l}))})),c.promise}async function zce(s,e,t){const{protocol:i,firstMessage:n}=await xRe(s,Pm.ExtensionHost,e,t),o=n&&n.debugPort;return{protocol:i,debugPort:o}}async function Kce(s,e,t){const{connectTo:i,connectionToken:n}=await s.addressProvider.getAddress();return{commit:s.commit,quality:s.quality,connectTo:i,connectionToken:n,reconnectionToken:e,reconnectionProtocol:t,remoteSocketFactoryService:s.remoteSocketFactoryService,signService:s.signService,logService:s.logService}}async function IRe(s,e){return DRe(s,async t=>{const{protocol:i,debugPort:n}=await zce(t,e,ye.None);return new LRe(s,e,t.reconnectionToken,i,n)})}async function DRe(s,e){for(let i=1;;i++)try{const n=Dn(),o=await Kce(s,n,null);return await e(o)}catch(n){if(i<5)s.logService.error(`[remote-connection][attempt ${i}] An error occurred in initial connection! Will retry... Error:`),s.logService.error(n);else throw s.logService.error(`[remote-connection][attempt ${i}]  An error occurred in initial connection! It will be treated as a permanent error. Error:`),s.logService.error(n),$d.triggerPermanentFailure(0,0,wp.isHandled(n)),n}}function kRe(s){return En(e=>new Promise((t,i)=>{const n=setTimeout(t,s*1e3);e.onCancellationRequested(()=>{clearTimeout(n),t()})}))}var Qp;(function(s){s[s.ConnectionLost=0]="ConnectionLost",s[s.ReconnectionWait=1]="ReconnectionWait",s[s.ReconnectionRunning=2]="ReconnectionRunning",s[s.ReconnectionPermanentFailure=3]="ReconnectionPermanentFailure",s[s.ConnectionGain=4]="ConnectionGain"})(Qp||(Qp={}));class TRe{constructor(e,t){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.type=Qp.ConnectionLost}}class ARe{constructor(e,t,i,n){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.durationSeconds=i,this.cancellableTimer=n,this.type=Qp.ReconnectionWait}skipWait(){this.cancellableTimer.cancel()}}class RRe{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=Qp.ReconnectionRunning}}class jQ{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=Qp.ConnectionGain}}class PRe{constructor(e,t,i,n){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.handled=n,this.type=Qp.ReconnectionPermanentFailure}}class $d extends F{static triggerPermanentFailure(e,t,i){this._permanentFailure=!0,this._permanentFailureMillisSinceLastIncomingData=e,this._permanentFailureAttempt=t,this._permanentFailureHandled=i,this._instances.forEach(n=>n._gotoPermanentFailure(this._permanentFailureMillisSinceLastIncomingData,this._permanentFailureAttempt,this._permanentFailureHandled))}static debugTriggerReconnection(){this._instances.forEach(e=>e._beginReconnecting())}static debugPauseSocketWriting(){this._instances.forEach(e=>e._pauseSocketWriting())}static{this._permanentFailure=!1}static{this._permanentFailureMillisSinceLastIncomingData=0}static{this._permanentFailureAttempt=0}static{this._permanentFailureHandled=!1}static{this._instances=[]}get _isPermanentFailure(){return this._permanentFailure||$d._permanentFailure}constructor(e,t,i,n,o){super(),this._connectionType=e,this._options=t,this.reconnectionToken=i,this.protocol=n,this._reconnectionFailureIsFatal=o,this._onDidStateChange=this._register(new M),this.onDidStateChange=this._onDidStateChange.event,this._permanentFailure=!1,this._isReconnecting=!1,this._isDisposed=!1,this._onDidStateChange.fire(new jQ(this.reconnectionToken,0,0)),this._register(n.onSocketClose(r=>{const a=jk(this._connectionType,this.reconnectionToken,!0);r?r.type===ER.NodeSocketCloseEvent?(this._options.logService.info(`${a} received socket close event (hadError: ${r.hadError}).`),r.error&&this._options.logService.error(r.error)):(this._options.logService.info(`${a} received socket close event (wasClean: ${r.wasClean}, code: ${r.code}, reason: ${r.reason}).`),r.event&&this._options.logService.error(r.event)):this._options.logService.info(`${a} received socket close event.`),this._beginReconnecting()})),this._register(n.onSocketTimeout(r=>{const a=jk(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${a} received socket timeout event (unacknowledgedMsgCount: ${r.unacknowledgedMsgCount}, timeSinceOldestUnacknowledgedMsg: ${r.timeSinceOldestUnacknowledgedMsg}, timeSinceLastReceivedSomeData: ${r.timeSinceLastReceivedSomeData}).`),this._beginReconnecting()})),$d._instances.push(this),this._register(Ee(()=>{const r=$d._instances.indexOf(this);r>=0&&$d._instances.splice(r,1)})),this._isPermanentFailure&&this._gotoPermanentFailure($d._permanentFailureMillisSinceLastIncomingData,$d._permanentFailureAttempt,$d._permanentFailureHandled)}dispose(){super.dispose(),this._isDisposed=!0}async _beginReconnecting(){if(!this._isReconnecting)try{this._isReconnecting=!0,await this._runReconnectingLoop()}finally{this._isReconnecting=!1}}async _runReconnectingLoop(){if(this._isPermanentFailure||this._isDisposed)return;const e=jk(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${e} starting reconnecting loop. You can get more information with the trace log level.`),this._onDidStateChange.fire(new TRe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData()));const t=[0,5,5,10,10,10,10,10,30];let i=-1;do{i++;const n=i<t.length?t[i]:t[t.length-1];try{if(n>0){const r=kRe(n);this._onDidStateChange.fire(new ARe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),n,r)),this._options.logService.info(`${e} waiting for ${n} seconds before reconnecting...`);try{await r}catch{}}if(this._isPermanentFailure){this._options.logService.error(`${e} permanent failure occurred while running the reconnecting loop.`);break}this._onDidStateChange.fire(new RRe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1)),this._options.logService.info(`${e} resolving connection...`);const o=await Kce(this._options,this.reconnectionToken,this.protocol);this._options.logService.info(`${e} connecting to ${o.connectTo}...`),await this._reconnect(o,qce(yRe)),this._options.logService.info(`${e} reconnected!`),this._onDidStateChange.fire(new jQ(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1));break}catch(o){if(o.code==="VSCODE_CONNECTION_ERROR"){this._options.logService.error(`${e} A permanent error occurred in the reconnecting loop! Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(i>360){this._options.logService.error(`${e} An error occurred while reconnecting, but it will be treated as a permanent error because the reconnection grace time has expired! Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(wp.isTemporarilyNotAvailable(o)){this._options.logService.info(`${e} A temporarily not available error occurred while trying to reconnect, will try again...`),this._options.logService.trace(o);continue}if((o.code==="ETIMEDOUT"||o.code==="ENETUNREACH"||o.code==="ECONNREFUSED"||o.code==="ECONNRESET")&&o.syscall==="connect"){this._options.logService.info(`${e} A network error occurred while trying to reconnect, will try again...`),this._options.logService.trace(o);continue}if(gs(o)){this._options.logService.info(`${e} A promise cancelation error occurred while trying to reconnect, will try again...`),this._options.logService.trace(o);continue}if(o instanceof wp){this._options.logService.error(`${e} A RemoteAuthorityResolverError occurred while trying to reconnect. Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,wp.isHandled(o));break}this._options.logService.error(`${e} An unknown error occurred while trying to reconnect, since this is an unknown case, it will be treated as a permanent error! Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}}while(!this._isPermanentFailure&&!this._isDisposed)}_onReconnectionPermanentFailure(e,t,i){this._reconnectionFailureIsFatal?$d.triggerPermanentFailure(e,t,i):this._gotoPermanentFailure(e,t,i)}_gotoPermanentFailure(e,t,i){this._onDidStateChange.fire(new PRe(this.reconnectionToken,e,t,i)),PK(this.protocol)}_pauseSocketWriting(){this.protocol.pauseSocketWriting()}}class LRe extends $d{constructor(e,t,i,n,o){super(Pm.ExtensionHost,e,i,n,!1),this._startArguments=t,this.debugPort=o}async _reconnect(e,t){await zce(e,this._startArguments,t)}}function PK(s){try{s.acceptDisconnect();const e=s.getSocket();s.dispose(),e.dispose()}catch(e){mt(e)}}function jce(s){if(s&&s.type==="error"){const e=new Error(`Connection error: ${s.reason}`);return e.code="VSCODE_CONNECTION_ERROR",e}return null}function MRe(s,e){for(;s.length<e;)s+=" ";return s}function NRe(s,e){return`[remote-connection][${MRe(RV(s),13)}][${e.substr(0,5)}…]`}function jk(s,e,t){return`${NRe(s,e)}[${t?"reconnect":"initial"}]`}function Yce(s,e){return`${jk(e,s.reconnectionToken,!!s.reconnectionProtocol)}[${s.connectTo}]`}function ORe(s){return`${Date.now()-s} ms`}let MR=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){super(),this.runningLocation=e,this.startup=t,this._initDataProvider=i,this.workerUrl=n,this.workerOptions=o,this._telemetryService=r,this._contextService=a,this._labelService=c,this._logService=d,this._loggerService=l,this._environmentService=u,this._userDataProfilesService=g,this._productService=m,this._layoutService=v,this._storageService=y,this.pid=null,this.remoteAuthority=null,this.extensions=null,this._onDidExit=this._register(new M),this.onExit=this._onDidExit.event,this._isTerminating=!1,this._protocolPromise=null,this._protocol=null,this._extensionHostLogsLocation=xt(this._environmentService.extHostLogsPath,"webWorker")}async _getWebWorkerExtensionHostIframeSrc(){const e=new URLSearchParams;this._environmentService.debugExtensionHost&&this._environmentService.debugRenderer&&e.set("debugged","1"),ive.addSearchParam(e,!0,!0),e.set("parentOrigin",$i.origin);const t=`?${e.toString()}`,i="vs/workbench/services/extensions/worker/webWorkerExtensionHostIframe.html";if($t){const o=this._productService.webEndpointUrlTemplate,r=this._productService.commit,a=this._productService.quality;if(o&&r&&a){const c="webWorkerExtensionHostIframeStableOriginUUID";let d=this._storageService.get(c,he.WORKSPACE);typeof d>"u"&&(d=Dn(),this._storageService.store(c,d,he.WORKSPACE,pt.MACHINE));const l=await nve($i.origin,d),u=o.replace("{{uuid}}",`v--${l}`).replace("{{commit}}",r).replace("{{quality}}",a),g=new URL(`${u}/out/${i}${t}`);return g.searchParams.set("salt",d),g.toString()}}return`${tc.asBrowserUri(i).toString(!0)}${t}`}async start(){return this._protocolPromise||(this._protocolPromise=this._startInsideIframe(),this._protocolPromise.then(e=>this._protocol=e)),this._protocolPromise}async _startInsideIframe(){const e=await this._getWebWorkerExtensionHostIframeSrc(),t=this._register(new M),i=document.createElement("iframe");i.setAttribute("class","web-worker-ext-host-iframe"),i.setAttribute("sandbox","allow-scripts allow-same-origin"),i.setAttribute("allow","usb; serial; hid; cross-origin-isolated;"),i.setAttribute("aria-hidden","true"),i.style.display="none";const n=Dn();i.setAttribute("src",`${e}&vscodeWebWorkerExtHostId=${n}`);const o=new Np;let r,a=null,c=!1,d;const l=(v,y)=>{a=y,c=!0,mt(a),clearTimeout(d),this._onDidExit.fire([RC.UnexpectedError,a.message]),o.open()},u=v=>{r=v,clearTimeout(d),o.open()};if(d=setTimeout(()=>{console.warn("The Web Worker Extension Host did not start in 60s, that might be a problem.")},6e4),this._register(re($i,"message",v=>{if(v.source!==i.contentWindow||v.data.vscodeWebWorkerExtHostId!==n)return;if(v.data.error){const{name:w,message:C,stack:T}=v.data.error,k=new Error;return k.message=C,k.name=w,k.stack=T,l(RC.UnexpectedError,k)}if(v.data.type==="vscode.bootstrap.nls"){i.contentWindow.postMessage({type:v.data.type,data:{workerUrl:this.workerUrl,workerOptions:this.workerOptions,fileRoot:globalThis._VSCODE_FILE_ROOT,nls:{messages:ove(),language:sve()}}},"*");return}const{data:y}=v.data;if(o.isOpen()||!(y instanceof MessagePort)){console.warn("UNEXPECTED message",v);const w=new Error("UNEXPECTED message");return l(RC.UnexpectedError,w)}u(y)})),this._layoutService.mainContainer.appendChild(i),this._register(Ee(()=>i.remove())),await o.wait(),c)throw a;const g=this._environmentService.options?.messagePorts??new Map;i.contentWindow.postMessage({type:"vscode.init",data:g},"*",[...g.values()]),r.onmessage=v=>{const{data:y}=v;if(!(y instanceof ArrayBuffer)){console.warn("UNKNOWN data received",y),this._onDidExit.fire([77,"UNKNOWN data received"]);return}t.fire(Re.wrap(new Uint8Array(y,0,y.byteLength)))};const m={onMessage:t.event,send:v=>{const y=v.buffer.buffer.slice(v.buffer.byteOffset,v.buffer.byteOffset+v.buffer.byteLength);r.postMessage(y,[y])}};return this._performHandshake(m)}async _performHandshake(e){if(await D.toPromise(D.filter(e.onMessage,t=>IA(t,Sa.Ready))),this._isTerminating)throw Ib();if(e.send(Re.fromString(JSON.stringify(await this._createExtHostInitData()))),this._isTerminating)throw Ib();if(await D.toPromise(D.filter(e.onMessage,t=>IA(t,Sa.Initialized))),this._isTerminating)throw Ib();return e}dispose(){this._isTerminating||(this._isTerminating=!0,this._protocol?.send(Hoe(Sa.Terminate)),super.dispose())}getInspectPort(){}enableInspectPort(){return Promise.resolve(!1)}async _createExtHostInitData(){const e=await this._initDataProvider.getInitData();this.extensions=e.extensions;const t=this._contextService.getWorkspace(),i=this._productService.extensionsGallery?.nlsBaseUrl;let n;return i&&this._productService.commit&&!BT.isDefaultVariant()&&(n=R.joinPath(R.parse(i),this._productService.commit,this._productService.version,BT.value())),{commit:this._productService.commit,version:this._productService.version,quality:this._productService.quality,parentPid:0,environment:{isExtensionDevelopmentDebug:this._environmentService.debugRenderer,appName:this._productService.nameLong,appHost:this._productService.embedderIdentifier??($t?"web":"desktop"),appUriScheme:this._productService.urlProtocol,appLanguage:sl,isExtensionTelemetryLoggingOnly:Xie(this._productService,this._environmentService),extensionDevelopmentLocationURI:this._environmentService.extensionDevelopmentLocationURI,extensionTestsLocationURI:this._environmentService.extensionTestsLocationURI,globalStorageHome:this._userDataProfilesService.defaultProfile.globalStorageHome,workspaceStorageHome:this._environmentService.workspaceStorageHome,extensionLogLevel:this._environmentService.extensionLogLevel},workspace:this._contextService.getWorkbenchState()===zo.EMPTY?void 0:{configuration:t.configuration||void 0,id:t.id,name:this._labelService.getWorkspaceLabel(t),transient:t.transient},consoleForward:{includeStack:!1,logNative:this._environmentService.debugRenderer},extensions:this.extensions.toSnapshot(),nlsBaseUrl:n,telemetryInfo:{sessionId:this._telemetryService.sessionId,machineId:this._telemetryService.machineId,sqmId:this._telemetryService.sqmId,devDeviceId:this._telemetryService.devDeviceId,firstSessionDate:this._telemetryService.firstSessionDate,msftInternal:this._telemetryService.msftInternal},logLevel:this._logService.getLevel(),loggers:[...this._loggerService.getRegisteredLoggers()],logsLocation:this._extensionHostLogsLocation,autoStart:this.startup===fh.EagerAutoStart,remote:{authority:this._environmentService.remoteAuthority,connectionData:null,isRemote:!1},uiKind:$t?py.Web:py.Desktop}}};MR=f([p(5,li),p(6,Tt),p(7,di),p(8,Pe),p(9,eI),p(10,lf),p(11,Wv),p(12,Fn),p(13,df),p(14,tt)],MR);class FRe{constructor(){this.capabilities=ph.Readonly+ph.FileReadWrite+ph.PathCaseSensitive,this.onDidChangeCapabilities=D.None,this.onDidChangeFile=D.None}async readFile(e){try{const t=await fetch(e.toString(!0));if(t.status===200)return new Uint8Array(await t.arrayBuffer());throw w7(t.statusText,cr.Unknown)}catch(t){throw w7(t,cr.Unknown)}}async stat(e){return{type:dC.File,size:0,mtime:0,ctime:0}}watch(){return F.None}writeFile(e,t,i){throw new mS}readdir(e){throw new mS}mkdir(e){throw new mS}delete(e,t){throw new mS}rename(e,t,i){throw new mS}}function WRe(s,e,t,i,n){const o=new ko;return s.forEach(r=>{const a=o.get(r.identifier);a&&n.warn(h(12671,"Overwriting extension {0} with {1}.",a.extensionLocation.fsPath,r.extensionLocation.fsPath)),o.set(r.identifier,r)}),e.forEach(r=>{const a=o.get(r.identifier);if(a)if(a.isBuiltin){if(My.gte(a.version,r.version)){n.warn(`Skipping extension ${r.extensionLocation.path} in favour of the builtin extension ${a.extensionLocation.path}.`);return}r.isBuiltin=!0}else n.warn(h(12671,"Overwriting extension {0} with {1}.",a.extensionLocation.fsPath,r.extensionLocation.fsPath));else if(r.isBuiltin){n.warn(`Skipping obsolete builtin extension ${r.extensionLocation.path}`);return}o.set(r.identifier,r)}),t.forEach(r=>{const a=o.get(r.identifier);a&&n.warn(h(12672,"Overwriting {0} with Workspace Extension {1}.",a.extensionLocation.fsPath,r.extensionLocation.fsPath)),o.set(r.identifier,r)}),i.forEach(r=>{n.info(h(12673,"Loading development extension at {0}",r.extensionLocation.fsPath));const a=o.get(r.identifier);a&&a.isBuiltin&&(r.isBuiltin=!0),o.set(r.identifier,r)}),Array.from(o.values())}let PV=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.runningLocation=e,this._initDataProvider=t,this.remoteSocketFactoryService=i,this._contextService=n,this._environmentService=o,this._telemetryService=r,this._logService=a,this._loggerService=c,this._labelService=d,this.remoteAuthorityResolverService=l,this._extensionHostDebugService=u,this._productService=g,this._signService=m,this.pid=null,this.startup=fh.EagerAutoStart,this.extensions=null,this._onExit=this._register(new M),this.onExit=this._onExit.event,this._hasDisconnected=!1,this.remoteAuthority=this._initDataProvider.remoteAuthority,this._protocol=null,this._hasLostConnection=!1,this._terminating=!1;const v=RK(this._environmentService);this._isExtensionDevHost=v.isExtensionDevHost}start(){const e={commit:this._productService.commit,quality:this._productService.quality,addressProvider:{getAddress:async()=>{const{authority:t}=await this.remoteAuthorityResolverService.resolveAuthority(this._initDataProvider.remoteAuthority);return{connectTo:t.connectTo,connectionToken:t.connectionToken}}},remoteSocketFactoryService:this.remoteSocketFactoryService,signService:this._signService,logService:this._logService,ipcLogger:null};return this.remoteAuthorityResolverService.resolveAuthority(this._initDataProvider.remoteAuthority).then(t=>{const i={language:sl,debugId:this._environmentService.debugExtensionHost.debugId,break:this._environmentService.debugExtensionHost.break,port:this._environmentService.debugExtensionHost.port,env:{...this._environmentService.debugExtensionHost.env,...t.options?.extensionHostEnv}},n=this._environmentService.extensionDevelopmentLocationURI;let o=!0;return n&&n.length>0&&n[0].scheme===ae.file&&(o=!1),o||(i.break=!1),IRe(e,i).then(r=>{this._register(r);const{protocol:a,debugPort:c,reconnectionToken:d}=r,l=typeof c=="number";return o&&this._environmentService.isExtensionDevelopment&&this._environmentService.debugExtensionHost.debugId&&c&&this._extensionHostDebugService.attachSession(this._environmentService.debugExtensionHost.debugId,c,this._initDataProvider.remoteAuthority),a.onDidDispose(()=>{this._onExtHostConnectionLost(d)}),a.onSocketClose(()=>{this._isExtensionDevHost&&this._onExtHostConnectionLost(d)}),new Promise((u,g)=>{const m=setTimeout(()=>{g("The remote extension host took longer than 60s to send its ready message.")},6e4),v=a.onMessage(y=>{if(IA(y,Sa.Ready)){this._createExtHostInitData(l).then(w=>{a.send(Re.fromString(JSON.stringify(w)))});return}if(IA(y,Sa.Initialized)){clearTimeout(m),v.dispose(),this._protocol=a,u(a);return}console.error("received unexpected message during handshake phase from the extension host: ",y)})})})})}_onExtHostConnectionLost(e){this._hasLostConnection||(this._hasLostConnection=!0,this._isExtensionDevHost&&this._environmentService.debugExtensionHost.debugId&&this._extensionHostDebugService.close(this._environmentService.debugExtensionHost.debugId),!this._terminating&&this._onExit.fire([0,e]))}async _createExtHostInitData(e){const t=await this._initDataProvider.getInitData();this.extensions=t.extensions;const i=this._contextService.getWorkspace();return{commit:this._productService.commit,version:this._productService.version,quality:this._productService.quality,parentPid:t.pid,environment:{isExtensionDevelopmentDebug:e,appRoot:t.appRoot,appName:this._productService.nameLong,appHost:this._productService.embedderIdentifier||"desktop",appUriScheme:this._productService.urlProtocol,isExtensionTelemetryLoggingOnly:Xie(this._productService,this._environmentService),appLanguage:sl,extensionDevelopmentLocationURI:this._environmentService.extensionDevelopmentLocationURI,extensionTestsLocationURI:this._environmentService.extensionTestsLocationURI,globalStorageHome:t.globalStorageHome,workspaceStorageHome:t.workspaceStorageHome,extensionLogLevel:this._environmentService.extensionLogLevel},workspace:this._contextService.getWorkbenchState()===zo.EMPTY?null:{configuration:i.configuration,id:i.id,name:this._labelService.getWorkspaceLabel(i),transient:i.transient},remote:{isRemote:!0,authority:this._initDataProvider.remoteAuthority,connectionData:t.connectionData},consoleForward:{includeStack:!1,logNative:!!this._environmentService.debugExtensionHost.debugId},extensions:this.extensions.toSnapshot(),telemetryInfo:{sessionId:this._telemetryService.sessionId,machineId:this._telemetryService.machineId,sqmId:this._telemetryService.sqmId,devDeviceId:this._telemetryService.devDeviceId,firstSessionDate:this._telemetryService.firstSessionDate,msftInternal:this._telemetryService.msftInternal},logLevel:this._logService.getLevel(),loggers:[...this._loggerService.getRegisteredLoggers()],logsLocation:t.extensionHostLogsPath,autoStart:this.startup===fh.EagerAutoStart,uiKind:$t?py.Web:py.Desktop}}getInspectPort(){}enableInspectPort(){return Promise.resolve(!1)}async disconnect(){this._protocol&&!this._hasDisconnected&&(this._protocol.send(Hoe(Sa.Terminate)),this._protocol.sendDisconnect(),this._hasDisconnected=!0,await this._protocol.drain())}dispose(){super.dispose(),this._terminating=!0,this.disconnect(),this._protocol&&(this._protocol.getSocket().end(),this._protocol=null)}};PV=f([p(2,uz),p(3,Tt),p(4,mn),p(5,li),p(6,Pe),p(7,eI),p(8,di),p(9,Hh),p(10,Uoe),p(11,Fn),p(12,qoe)],PV);var LV;let MV=class extends kV{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A,B,z,Q,ie,oe){super({hasLocalProcess:!1,allowRemoteExtensionsInLocalWebWorker:!0},e,t,i,n,o,r,a,c,d,l,u,g,m,v,w,C,T,k,A,oe),this._browserEnvironmentService=r,this._webExtensionsScannerService=y,this._userDataInitializationService=B,this._userDataProfileService=z,this._workspaceTrustManagementService=Q,this._remoteExplorerService=ie,k.when(mc.Ready).then(async()=>{await this._userDataInitializationService.initializeInstalledExtensions(this._instantiationService),this._initialize()}),this._initFetchFileSystem()}_initFetchFileSystem(){const e=new FRe;this._register(this._fileService.registerProvider(ae.http,e)),this._register(this._fileService.registerProvider(ae.https,e))}async _scanWebExtensions(){return this._scanWebExtensionsPromise||(this._scanWebExtensionsPromise=(async()=>{const e=[],t=[],i=[];try{await Promise.all([this._webExtensionsScannerService.scanSystemExtensions().then(n=>e.push(...n.map(o=>Ek(o)))),this._webExtensionsScannerService.scanUserExtensions(this._userDataProfileService.currentProfile.extensionsResource,{skipInvalidExtensions:!0}).then(n=>t.push(...n.map(o=>Ek(o)))),this._webExtensionsScannerService.scanExtensionsUnderDevelopment().then(n=>i.push(...n.map(o=>Ek(o,!0))))])}catch(n){this._logService.error(n)}return WRe(e,t,[],i,this._logService)})()),this._scanWebExtensionsPromise}async _resolveExtensionsDefault(e){const[t,i]=await Promise.all([this._scanWebExtensions(),this._remoteExtensionsScannerService.scanExtensions()]);i.length&&e.emitOne(new $ce(i)),e.emitOne(new Uce(t))}_resolveExtensions(){return new Qa(e=>this._doResolveExtensions(e))}async _doResolveExtensions(e){if(!this._browserEnvironmentService.expectsResolverExtension)return this._resolveExtensionsDefault(e);const t=this._environmentService.remoteAuthority;await this._workspaceTrustManagementService.workspaceResolved;const n=(await this._scanWebExtensions()).filter(a=>oRe(a));n.length&&e.emitOne(new Hce(n));let o;try{o=await this._resolveAuthorityInitial(t)}catch(a){return wp.isHandled(a)&&console.log("Error handled: Not showing a notification for the error"),this._remoteAuthorityResolverService._setResolvedAuthorityError(t,a),this._resolveExtensionsDefault(e)}this._remoteAuthorityResolverService._setResolvedAuthority(o.authority,o.options),this._remoteExplorerService.setTunnelInformation(o.tunnelInformation);const r=this._remoteAgentService.getConnection();return r&&(r.onDidStateChange(async a=>{a.type===Qp.ConnectionLost&&this._remoteAuthorityResolverService._clearResolvedAuthority(t)}),r.onReconnecting(()=>this._resolveAuthorityAgain())),this._resolveExtensionsDefault(e)}async _onExtensionHostExit(e){await this._doStopExtensionHosts();const t=$i;typeof t.codeAutomationExit=="function"&&t.codeAutomationExit(e,await bRe(this._fileService,this._environmentService))}async _resolveAuthority(e){return this._resolveAuthorityOnExtensionHosts(Lt.LocalWebWorker,e)}};MV=f([p(3,J),p(4,At),p(5,lf),p(6,li),p(7,gd),p(8,Xe),p(9,Fn),p(10,ON),p(11,Tt),p(12,ne),p(13,$v),p(14,Az),p(15,Pe),p(16,Nh),p(17,xN),p(18,wd),p(19,Hh),p(20,BN),p(21,Fh),p(22,Tv),p(23,WN),p(24,Qt)],MV);let NV=class{constructor(e,t,i,n,o,r,a,c){this._extensionsProposedApi=e,this._scanWebExtensions=t,this._getExtensionRegistrySnapshotWhenReady=i,this._instantiationService=n,this._remoteAgentService=o,this._remoteAuthorityResolverService=r,this._extensionEnablementService=a,this._logService=c}createExtensionHost(e,t,i){switch(t.kind){case Lt.LocalProcess:return null;case Lt.LocalWebWorker:{const n=i?fh.EagerManualStart:fh.EagerAutoStart;return this._instantiationService.createInstance(MR,t,n,this._createLocalExtensionHostDataProvider(e,t,i),tc.asBrowserUri("vs/workbench/api/worker/extensionHostWorkerMain.js").toString(!0),{type:"module"})}case Lt.Remote:{const n=this._remoteAgentService.getConnection();return n?this._instantiationService.createInstance(PV,t,this._createRemoteExtensionHostDataProvider(e,n.remoteAuthority)):null}}}_createLocalExtensionHostDataProvider(e,t,i){return{getInitData:async()=>{if(i){const n=Kk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,await this._scanWebExtensions(),!0),o=e.computeRunningLocation(n,[],!1),r=zk(n,o,c=>t.equals(c));return{extensions:new Ck(0,n,r.map(c=>c.identifier))}}else{const n=await this._getExtensionRegistrySnapshotWhenReady(),o=e.filterByRunningLocation(n.extensions,t);return{extensions:new Ck(n.versionId,n.extensions,o.map(a=>a.identifier))}}}}}_createRemoteExtensionHostDataProvider(e,t){return{remoteAuthority:t,getInitData:async()=>{const i=await this._getExtensionRegistrySnapshotWhenReady(),n=await this._remoteAgentService.getEnvironment();if(!n)throw new Error("Cannot provide init data for remote extension host!");const o=e.filterByExtensionHostKind(i.extensions,Lt.Remote),r=new Ck(i.versionId,i.extensions,o.map(a=>a.identifier));return{connectionData:this._remoteAuthorityResolverService.getConnectionData(t),pid:n.pid,appRoot:n.appRoot,extensionHostLogsPath:n.extensionHostLogsPath,globalStorageHome:n.globalStorageHome,workspaceStorageHome:n.workspaceStorageHome,extensions:r}}}}};NV=f([p(3,J),p(4,Nh),p(5,Hh),p(6,gd),p(7,Pe)],NV);let OV=LV=class{constructor(e){this._logService=e}pickExtensionHostKind(e,t,i,n,o){const r=LV.pickRunningLocation(t,i,n,o);return this._logService.trace(`pickRunningLocation for ${e.value}, extension kinds: [${t.join(", ")}], isInstalledLocally: ${i}, isInstalledRemotely: ${n}, preference: ${wAe(o)} => ${oh(r)}`),r}static pickRunningLocation(e,t,i,n){const o=[];let r=!1;for(const a of e){if(a==="ui"&&i){if(n===Zr.Remote)return Lt.Remote;r=!0}if(a==="workspace"&&i){if(n===Zr.None||n===Zr.Remote)return Lt.Remote;o.push(Lt.Remote)}if(a==="web"&&(t||i)){if(n===Zr.None||n===Zr.Local)return Lt.LocalWebWorker;o.push(Lt.LocalWebWorker)}}return r&&o.push(Lt.Remote),o.length>0?o[0]:null}};OV=LV=f([p(0,Pe)],OV);async function BRe(s,e,t){let i=t&&t.get("storage.serviceMachineId",he.APPLICATION)||null;if(i)return i;try{const o=(await e.readFile(s.serviceMachineIdResource)).value.toString();i=rve(o)?o:null}catch{i=null}if(!i){i=Dn();try{await e.writeFile(s.serviceMachineIdResource,Re.fromString(i))}catch{}}return t?.store("storage.serviceMachineId",i,he.APPLICATION,pt.MACHINE),i}var FV;(function(s){s.ExtensionQueryService="ExtensionQueryService",s.ExtensionLatestVersionUri="ExtensionLatestVersionUriTemplate",s.ExtensionStatisticsUri="ExtensionStatisticsUriTemplate",s.WebExtensionStatisticsUri="WebExtensionStatisticsUriTemplate",s.PublisherViewUri="PublisherViewUriTemplate",s.ExtensionDetailsViewUri="ExtensionDetailsViewUriTemplate",s.ExtensionRatingViewUri="ExtensionRatingViewUriTemplate",s.ExtensionResourceUri="ExtensionResourceUriTemplate",s.ContactSupportUri="ContactSupportUri"})(FV||(FV={}));var YQ;(function(s){s.None="None",s.IncludeVersions="IncludeVersions",s.IncludeFiles="IncludeFiles",s.IncludeCategoryAndTags="IncludeCategoryAndTags",s.IncludeSharedAccounts="IncludeSharedAccounts",s.IncludeVersionProperties="IncludeVersionProperties",s.ExcludeNonValidated="ExcludeNonValidated",s.IncludeInstallationTargets="IncludeInstallationTargets",s.IncludeAssetUri="IncludeAssetUri",s.IncludeStatistics="IncludeStatistics",s.IncludeLatestVersionOnly="IncludeLatestVersionOnly",s.Unpublished="Unpublished",s.IncludeNameConflictInfo="IncludeNameConflictInfo",s.IncludeLatestPrereleaseAndStableVersionOnly="IncludeLatestPrereleaseAndStableVersionOnly"})(YQ||(YQ={}));function VRe(s,e){const[t,i]=e.split("/");for(const n of s.resources){const[o,r]=n.type.split("/");if(o===t){if(!i||r===i)return n.id;break}}}const HRe="/web-extension-resource/";class URe extends F{constructor(e,t,i,n,o,r,a){super(),this._fileService=e,this._storageService=t,this._productService=i,this._environmentService=n,this._configurationService=o,this._extensionGalleryManifestService=r,this._logService=a,this._initPromise=this._init()}async _init(){try{const e=await this._extensionGalleryManifestService.getExtensionGalleryManifest();this.resolve(e),this._register(this._extensionGalleryManifestService.onDidChangeExtensionGalleryManifest(()=>this.resolve(e)))}catch(e){this._logService.error(e)}}resolve(e){this._extensionGalleryResourceUrlTemplate=e?VRe(e,FV.ExtensionResourceUri):void 0,this._extensionGalleryAuthority=this._extensionGalleryResourceUrlTemplate?this._getExtensionGalleryAuthority(R.parse(this._extensionGalleryResourceUrlTemplate)):void 0}async supportsExtensionGalleryResources(){return await this._initPromise,this._extensionGalleryResourceUrlTemplate!==void 0}async getExtensionGalleryResourceURL({publisher:e,name:t,version:i,targetPlatform:n},o){if(await this._initPromise,this._extensionGalleryResourceUrlTemplate){const r=R.parse(ave(this._extensionGalleryResourceUrlTemplate,{publisher:e,name:t,version:n!==void 0&&n!==lC.UNDEFINED&&n!==lC.UNKNOWN&&n!==lC.UNIVERSAL?`${i}+${n}`:i,path:"extension"}));return this._isWebExtensionResourceEndPoint(r)?r.with({scheme:IF.getPreferredWebSchema()}):r}}async isExtensionGalleryResource(e){return await this._initPromise,!!this._extensionGalleryAuthority&&this._extensionGalleryAuthority===this._getExtensionGalleryAuthority(e)}async getExtensionGalleryRequestHeaders(){const e={"X-Client-Name":`${this._productService.applicationName}${$t?"-web":""}`,"X-Client-Version":this._productService.version};return xk(this._productService,this._environmentService)&&cve(this._configurationService)===vq.USAGE&&(e["X-Machine-Id"]=await this._getServiceMachineId()),this._productService.commit&&(e["X-Client-Commit"]=this._productService.commit),e}_getServiceMachineId(){return this._serviceMachineIdPromise||(this._serviceMachineIdPromise=BRe(this._environmentService,this._fileService,this._storageService)),this._serviceMachineIdPromise}_getExtensionGalleryAuthority(e){if(this._isWebExtensionResourceEndPoint(e))return e.authority;const t=e.authority.indexOf(".");return t!==-1?e.authority.substring(t+1):void 0}_isWebExtensionResourceEndPoint(e){const t=e.path,i=IF.getServerRootPath();return t.startsWith(i)&&t.startsWith(HRe,i.length)}}let WV=class extends URe{constructor(e,t,i,n,o,r,a){super(e,t,i,n,o,r,a)}async readExtensionResource(e){if(e=tc.uriToBrowserUri(e),e.scheme!==ae.http&&e.scheme!==ae.https&&e.scheme!==ae.data)return(await this._fileService.readFile(e)).value.toString();const t={};await this.isExtensionGalleryResource(e)&&(t.headers=await this.getExtensionGalleryRequestHeaders(),t.mode="cors");const i=await fetch(e.toString(!0),t);if(i.status!==200)throw this._logService.info(`Request to '${e.toString(!0)}' failed with status code ${i.status}`),new Error(i.statusText);return i.text()}};WV=f([p(0,Xe),p(1,tt),p(2,Fn),p(3,po),p(4,ne),p(5,wae),p(6,Pe)],WV);var k_,BV;class FC{static fromJSON(e){if(e)try{const t=JSON.parse(e);return new FC(t.extensions,t.low,t.high,t.mid)}catch{return}}constructor(e,t,i,n=(t+i)/2|0){this.extensions=e,this.low=t,this.high=i,this.mid=n}}let VV=class{static{k_=this}static{this._storageKey="extensionBisectState"}constructor(e,t,i){this._storageService=t,this._envService=i,this._disabled=new Map;const n=t.get(k_._storageKey,he.APPLICATION);if(this._state=FC.fromJSON(n),this._state){const{mid:o,high:r}=this._state;for(let a=0;a<this._state.extensions.length;a++){const c=a>=o&&a<r;this._disabled.set(this._state.extensions[a],c)}e.warn("extension BISECT active",[...this._disabled])}}get isActive(){return!!this._state}get disabledCount(){return this._state?this._state.high-this._state.mid:-1}isDisabledByBisect(e){return!this._state||dve(e.manifest,this._envService.remoteAuthority)||this._isEnabledInEnv(e)?!1:this._disabled.get(e.identifier.id)??!1}_isEnabledInEnv(e){return Array.isArray(this._envService.enableExtensions)&&this._envService.enableExtensions.some(t=>ja({id:t},e.identifier))}async start(e){if(this._state)throw new Error("invalid state");const t=e.map(n=>n.identifier.id),i=new FC(t,0,t.length,0);this._storageService.store(k_._storageKey,JSON.stringify(i),he.APPLICATION,pt.MACHINE),await this._storageService.flush()}async next(e){if(!this._state)throw new Error("invalid state");if(e&&this._state.mid===0&&this._state.high===this._state.extensions.length)return{bad:!0,id:""};if(this._state.low===this._state.high-1)return await this.reset(),{id:this._state.extensions[this._state.low],bad:e};const t=new FC(this._state.extensions,e?this._state.low:this._state.mid,e?this._state.mid:this._state.high);this._storageService.store(k_._storageKey,JSON.stringify(t),he.APPLICATION,pt.MACHINE),await this._storageService.flush()}async reset(){this._storageService.remove(k_._storageKey,he.APPLICATION),await this._storageService.flush()}};VV=k_=f([p(0,Pe),p(1,tt),p(2,mn)],VV);let Oy=class{static{BV=this}static{this.ctxIsBisectActive=new O("isExtensionBisectActive",!1)}constructor(e,t,i,n){this._extensionBisectService=t,this._notificationService=i,this._commandService=n,t.isActive&&(BV.ctxIsBisectActive.bindTo(e).set(!0),this._showBisectPrompt())}_showBisectPrompt(){const e={label:h(12471,"I can't reproduce"),run:()=>this._commandService.executeCommand("extension.bisect.next",!1)},t={label:h(12472,"I can reproduce"),run:()=>this._commandService.executeCommand("extension.bisect.next",!0)},i={label:"Stop Bisect",run:()=>this._commandService.executeCommand("extension.bisect.stop")},n=this._extensionBisectService.disabledCount===1?h(12473,"Extension Bisect is active and has disabled 1 extension. Check if you can still reproduce the problem and proceed by selecting from these options."):h(12474,"Extension Bisect is active and has disabled {0} extensions. Check if you can still reproduce the problem and proceed by selecting from these options.",this._extensionBisectService.disabledCount);this._notificationService.prompt(Me.Info,n,[e,t,i],{sticky:!0,priority:Zie.URGENT})}};Oy=BV=f([p(0,me),p(1,xw),p(2,At),p(3,qe)],Oy);Ge.as(hf.Workbench).registerWorkbenchContribution(Oy,mc.Restored);K(class extends X{constructor(){super({id:"extension.bisect.start",title:I(12475,"Start Extension Bisect"),category:te.Help,f1:!0,precondition:Oy.ctxIsBisectActive.negate(),menu:{id:N.ViewContainerTitle,when:x.equals("viewContainer","workbench.view.extensions"),group:"2_enablement",order:4}})}async run(s){const e=s.get(Qt),t=s.get(Wn),i=s.get(yI),n=s.get(gd),o=s.get(xw),r=(await i.getInstalled(Pn.User)).filter(c=>n.isEnabled(c));(await e.confirm({message:h(12476,"Extension Bisect"),detail:h(12477,"Extension Bisect will use binary search to find an extension that causes a problem. During the process the window reloads repeatedly (~{0} times). Each time you must confirm if you are still seeing problems.",2+Math.log2(r.length)|0),primaryButton:h(12478,"&&Start Extension Bisect")})).confirmed&&(await o.start(r),t.reload())}});K(class extends X{constructor(){super({id:"extension.bisect.next",title:I(12479,"Continue Extension Bisect"),category:te.Help,f1:!0,precondition:Oy.ctxIsBisectActive})}async run(s,e){const t=s.get(Qt),i=s.get(Wn),n=s.get(xw),o=s.get(Fn),r=s.get($oe),a=s.get(qe);if(!n.isActive)return;if(e===void 0){const d=await this._checkForBad(t,n);if(d===null)return;e=d}if(e===void 0){await n.reset(),i.reload();return}const c=await n.next(e);if(!c){i.reload();return}if(c.bad)await t.info(h(12480,"Extension Bisect"),h(12481,"Extension Bisect is done but no extension has been identified. This might be a problem with {0}.",o.nameShort));else{const d=await t.confirm({type:Me.Info,message:h(12480,"Extension Bisect"),primaryButton:h(12482,"&&Report Issue & Continue"),cancelButton:h(12483,"Continue"),detail:h(12484,"Extension Bisect is done and has identified {0} as the extension causing the problem.",c.id),checkbox:{label:h(12485,"Keep this extension disabled"),checked:!0}});d.checkboxChecked&&await r.disableExtension({id:c.id},void 0),d.confirmed&&await a.executeCommand("workbench.action.openIssueReporter",c.id)}await n.reset(),i.reload()}async _checkForBad(s,e){const{result:t}=await s.prompt({type:Me.Info,message:h(12486,"Extension Bisect"),detail:h(12487,"Extension Bisect is active and has disabled {0} extensions. Check if you can still reproduce the problem and proceed by selecting from these options.",e.disabledCount),buttons:[{label:h(12488,"I ca&&n't reproduce"),run:()=>!1},{label:h(12489,"I can &&reproduce"),run:()=>!0},{label:h(12490,"&&Stop Bisect"),run:()=>{}}],cancelButton:{label:h(12491,"&&Cancel Bisect"),run:()=>null}});return t}});K(class extends X{constructor(){super({id:"extension.bisect.stop",title:I(12492,"Stop Extension Bisect"),category:te.Help,f1:!0,precondition:Oy.ctxIsBisectActive})}async run(s){const e=s.get(xw),t=s.get(Wn);await e.reset(),t.reload()}});function Qce(s,e){if(e==null)return s.toString();const t=new URL(s,e);return t.host=new URL(e).hostname,t.toString()}function $Re(s){for(const[e,t]of Object.entries(s))tc.registerAppResourcePathUrl(e,t)}function HV(s){switch(s){case nu.InvalidSymbol:return h(109,"Invalid symbol");case nu.InvalidNumberFormat:return h(110,"Invalid number format");case nu.PropertyNameExpected:return h(111,"Property name expected");case nu.ValueExpected:return h(112,"Value expected");case nu.ColonExpected:return h(113,"Colon expected");case nu.CommaExpected:return h(114,"Comma expected");case nu.CloseBraceExpected:return h(115,"Closing brace expected");case nu.CloseBracketExpected:return h(116,"Closing bracket expected");case nu.EndOfFileExpected:return h(117,"End of file expected");default:return""}}var Fy;(function(s){s.ERROR_PROFILE_NOT_FOUND="ERROR_PROFILE_NOT_FOUND",s.ERROR_INVALID_CONTENT="ERROR_INVALID_CONTENT"})(Fy||(Fy={}));class NR extends Error{constructor(e,t){super(e),this.code=t}}let QQ=class extends F{constructor(e,t,i,n,o){super(),this.extensionsLocation=e,this.fileService=t,this.userDataProfilesService=i,this.uriIdentityService=n,this.logService=o,this._onAddExtensions=this._register(new M),this.onAddExtensions=this._onAddExtensions.event,this._onDidAddExtensions=this._register(new M),this.onDidAddExtensions=this._onDidAddExtensions.event,this._onRemoveExtensions=this._register(new M),this.onRemoveExtensions=this._onRemoveExtensions.event,this._onDidRemoveExtensions=this._register(new M),this.onDidRemoveExtensions=this._onDidRemoveExtensions.event,this.resourcesAccessQueueMap=new wn}scanProfileExtensions(e,t){return this.withProfileExtensions(e,void 0,t)}async addExtensionsToProfile(e,t,i){const n=[],o=[];try{return await this.withProfileExtensions(t,r=>{const a=[];if(i)a.push(...r);else for(const c of r)e.some(([d])=>ja(d.identifier,c.identifier)&&d.manifest.version!==c.version)?n.push(c):a.push(c);for(const[c,d]of e){const l=a.findIndex(g=>ja(g.identifier,c.identifier)&&g.version===c.manifest.version),u={identifier:c.identifier,version:c.manifest.version,location:c.location,metadata:d};l===-1?(o.push(u),a.push(u)):a.splice(l,1,u)}return o.length&&this._onAddExtensions.fire({extensions:o,profileLocation:t}),n.length&&this._onRemoveExtensions.fire({extensions:n,profileLocation:t}),a}),o.length&&this._onDidAddExtensions.fire({extensions:o,profileLocation:t}),n.length&&this._onDidRemoveExtensions.fire({extensions:n,profileLocation:t}),o}catch(r){throw o.length&&this._onDidAddExtensions.fire({extensions:o,error:r,profileLocation:t}),n.length&&this._onDidRemoveExtensions.fire({extensions:n,error:r,profileLocation:t}),r}}async updateMetadata(e,t){const i=[];return await this.withProfileExtensions(t,n=>{const o=[];for(const r of n){const a=e.find(([c])=>ja({id:c.identifier.id},{id:r.identifier.id})&&c.manifest.version===r.version);a&&(r.metadata={...r.metadata,...a[1]},i.push(r)),o.push(r)}return o}),i}async removeExtensionsFromProfile(e,t){const i=[];try{await this.withProfileExtensions(t,n=>{const o=[];for(const r of n)e.some(a=>ja(r.identifier,a))?i.push(r):o.push(r);return i.length&&this._onRemoveExtensions.fire({extensions:i,profileLocation:t}),o}),i.length&&this._onDidRemoveExtensions.fire({extensions:i,profileLocation:t})}catch(n){throw i.length&&this._onDidRemoveExtensions.fire({extensions:i,error:n,profileLocation:t}),n}}async withProfileExtensions(e,t,i){return this.getResourceAccessQueue(e).queue(async()=>{let n=[],o;try{const r=await this.fileService.readFile(e);o=JSON.parse(r.value.toString().trim()||"[]")}catch(r){if(Kf(r)!==$n.FILE_NOT_FOUND)throw r;if(this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)&&(o=await this.migrateFromOldDefaultProfileExtensionsLocation()),!o&&i?.bailOutWhenFileNotFound)throw new NR(ba(r),Fy.ERROR_PROFILE_NOT_FOUND)}if(o){Array.isArray(o)||this.throwInvalidConentError(e);let r=!1;for(const a of o){XQ(a)||this.throwInvalidConentError(e);let c;if(It(a.relativeLocation)&&a.relativeLocation)c=this.resolveExtensionLocation(a.relativeLocation);else if(It(a.location)){this.logService.warn(`Extensions profile: Ignoring extension with invalid location: ${a.location}`);continue}else{c=R.revive(a.location);const l=this.toRelativePath(c);l&&(r=!0,a.relativeLocation=l)}Gm(a.metadata?.hasPreReleaseVersion)&&a.metadata?.preRelease&&(r=!0,a.metadata.hasPreReleaseVersion=!0);const d=a.metadata?.id??a.identifier.uuid;n.push({identifier:d?{id:a.identifier.id,uuid:d}:{id:a.identifier.id},location:c,version:a.version,metadata:a.metadata})}r&&await this.fileService.writeFile(e,Re.fromString(JSON.stringify(o)))}if(t){n=t(n);const r=n.map(a=>({identifier:a.identifier,version:a.version,location:a.location.toJSON(),relativeLocation:this.toRelativePath(a.location),metadata:a.metadata}));await this.fileService.writeFile(e,Re.fromString(JSON.stringify(r)))}return n})}throwInvalidConentError(e){throw new NR(`Invalid extensions content in ${e.toString()}`,Fy.ERROR_INVALID_CONTENT)}toRelativePath(e){return this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(e),this.extensionsLocation)?this.uriIdentityService.extUri.basename(e):void 0}resolveExtensionLocation(e){return this.uriIdentityService.extUri.joinPath(this.extensionsLocation,e)}async migrateFromOldDefaultProfileExtensionsLocation(){return this._migrationPromise||(this._migrationPromise=(async()=>{const e=this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location,"extensions.json"),t=this.uriIdentityService.extUri.joinPath(this.extensionsLocation,".init-default-profile-extensions");let i;try{i=(await this.fileService.readFile(e)).value.toString()}catch(o){if(Kf(o)===$n.FILE_NOT_FOUND)return;throw o}this.logService.info("Migrating extensions from old default profile location",e.toString());let n;try{const o=JSON.parse(i);Array.isArray(o)&&o.every(r=>XQ(r))?n=o:this.logService.warn("Skipping migrating from old default profile locaiton: Found invalid data",o)}catch(o){this.logService.error(o)}if(n)try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,Re.fromString(JSON.stringify(n)),{overwrite:!1}),this.logService.info("Migrated extensions from old default profile location to new location",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString())}catch(o){if(Kf(o)===$n.FILE_MODIFIED_SINCE)this.logService.info("Migration from old default profile location to new location is done by another window",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString());else throw o}try{await this.fileService.del(e)}catch(o){Kf(o)!==$n.FILE_NOT_FOUND&&this.logService.error(o)}try{await this.fileService.del(t)}catch(o){Kf(o)!==$n.FILE_NOT_FOUND&&this.logService.error(o)}return n})()),this._migrationPromise}getResourceAccessQueue(e){let t=this.resourcesAccessQueueMap.get(e);return t||(t=new lve,this.resourcesAccessQueueMap.set(e,t)),t}};QQ=f([p(1,Xe),p(2,Wv),p(3,Zi),p(4,Pe)],QQ);function XQ(s){return oa(s)&&hve(s.identifier)&&(GRe(s.location)||It(s.location)&&s.location)&&(Gm(s.relativeLocation)||It(s.relativeLocation))&&s.version&&It(s.version)}function GRe(s){return s?It(s.path)&&It(s.scheme):!1}function qRe(s,e,t,i){try{zRe(s,e,t,i)}catch(n){s.error(n?.message??n)}return e}function zRe(s,e,t,i){const n=(o,r,a)=>{const c=o[r];if(It(c)){const d=c,l=d.length;if(l>1&&d[0]==="%"&&d[l-1]==="%"){const u=d.substr(1,l-2);let g=t[u];g===void 0&&i&&(g=i[u]);const m=typeof g=="string"?g:g?.message,v=i?.[u],y=typeof v=="string"?v:v?.message;if(!m){y||s.warn(`[${e.name}]: ${h(1823,"Couldn't find message for key {0}.",u)}`);return}if(a&&(r==="title"||r==="category")&&y&&y!==m){const w={value:m,original:y};o[r]=w}else o[r]=m}}else if(oa(c))for(const d in c)c.hasOwnProperty(d)&&(d==="commands"?n(c,d,!0):n(c,d,a));else if(Array.isArray(c))for(let d=0;d<c.length;d++)n(c,d,a)};for(const o in e)e.hasOwnProperty(o)&&n(e,o)}var UV;(function(s){function e(t,i){if(t===i)return!0;const n=Object.keys(t),o=new Set;for(const r of Object.keys(i))o.add(r);if(n.length!==o.size)return!1;for(const r of n){if(t[r]!==i[r])return!1;o.delete(r)}return o.size===0}s.equals=e})(UV||(UV={}));let ZQ=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(),this.systemExtensionsLocation=e,this.userExtensionsLocation=t,this.extensionsControlLocation=i,this.userDataProfilesService=o,this.extensionsProfileScannerService=r,this.fileService=a,this.logService=c,this.environmentService=d,this.productService=l,this.uriIdentityService=u,this.instantiationService=g,this._onDidChangeCache=this._register(new M),this.onDidChangeCache=this._onDidChangeCache.event,this.initializeDefaultProfileExtensionsPromise=void 0,this.systemExtensionsCachedScanner=this._register(this.instantiationService.createInstance(WR,n)),this.userExtensionsCachedScanner=this._register(this.instantiationService.createInstance(WR,n)),this.extensionsScanner=this._register(this.instantiationService.createInstance(FR)),this._register(this.systemExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(Pn.System))),this._register(this.userExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(Pn.User)))}getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=uve(this.fileService,this.logService)),this._targetPlatformPromise}async scanAllExtensions(e,t){const[i,n]=await Promise.all([this.scanSystemExtensions(e),this.scanUserExtensions(t)]);return this.dedupExtensions(i,n,[],await this.getTargetPlatform(),!0)}async scanSystemExtensions(e){const t=[];t.push(this.scanDefaultSystemExtensions(e.language)),t.push(this.scanDevSystemExtensions(e.language,!!e.checkControlFile));const[i,n]=await Promise.all(t);return this.applyScanOptions([...i,...n],Pn.System,{pickLatest:!1})}async scanUserExtensions(e){this.logService.trace("Started scanning user extensions",e.profileLocation);const t=this.uriIdentityService.extUri.isEqual(e.profileLocation,this.userDataProfilesService.defaultProfile.extensionsResource)?{bailOutWhenFileNotFound:!0}:void 0,i=await this.createExtensionScannerInput(e.profileLocation,!0,Pn.User,e.language,!0,t,e.productVersion??this.getProductVersion()),n=e.useCache&&!i.devMode?this.userExtensionsCachedScanner:this.extensionsScanner;let o;try{o=await n.scanExtensions(i)}catch(r){if(r instanceof NR&&r.code===Fy.ERROR_PROFILE_NOT_FOUND)await this.doInitializeDefaultProfileExtensions(),o=await n.scanExtensions(i);else throw r}return o=await this.applyScanOptions(o,Pn.User,{includeInvalid:e.includeInvalid,pickLatest:!0}),this.logService.trace("Scanned user extensions:",o.length),o}async scanAllUserExtensions(e={includeInvalid:!0,includeAllVersions:!0}){const t=await this.createExtensionScannerInput(this.userExtensionsLocation,!1,Pn.User,void 0,!0,void 0,this.getProductVersion()),i=await this.extensionsScanner.scanExtensions(t);return this.applyScanOptions(i,Pn.User,{includeAllVersions:e.includeAllVersions,includeInvalid:e.includeInvalid})}async scanExtensionsUnderDevelopment(e,t){if(this.environmentService.isExtensionDevelopment&&this.environmentService.extensionDevelopmentLocationURI){const i=(await Promise.all(this.environmentService.extensionDevelopmentLocationURI.filter(n=>n.scheme===ae.file).map(async n=>{const o=await this.createExtensionScannerInput(n,!1,Pn.User,t.language,!1,void 0,this.getProductVersion());return(await this.extensionsScanner.scanOneOrMultipleExtensions(o)).map(a=>(a.type=e.find(c=>ja(c.identifier,a.identifier))?.type??a.type,this.extensionsScanner.validate(a,o)))}))).flat();return this.applyScanOptions(i,"development",{includeInvalid:t.includeInvalid,pickLatest:!0})}return[]}async scanExistingExtension(e,t,i){const n=await this.createExtensionScannerInput(e,!1,t,i.language,!0,void 0,this.getProductVersion()),o=await this.extensionsScanner.scanExtension(n);return!o||!i.includeInvalid&&!o.isValid?null:o}async scanOneOrMultipleExtensions(e,t,i){const n=await this.createExtensionScannerInput(e,!1,t,i.language,!0,void 0,this.getProductVersion()),o=await this.extensionsScanner.scanOneOrMultipleExtensions(n);return this.applyScanOptions(o,t,{includeInvalid:i.includeInvalid,pickLatest:!0})}async scanMultipleExtensions(e,t,i){const n=[];return await Promise.all(e.map(async o=>{const r=await this.scanOneOrMultipleExtensions(o,t,i);n.push(...r)})),this.applyScanOptions(n,t,{includeInvalid:i.includeInvalid,pickLatest:!0})}async updateManifestMetadata(e,t){const i=xt(e,"package.json"),n=(await this.fileService.readFile(i)).value.toString(),o=JSON.parse(n);o.__metadata={...o.__metadata,...t},await this.fileService.writeFile(xt(e,"package.json"),Re.fromString(JSON.stringify(o,null,"	")))}async initializeDefaultProfileExtensions(){try{await this.extensionsProfileScannerService.scanProfileExtensions(this.userDataProfilesService.defaultProfile.extensionsResource,{bailOutWhenFileNotFound:!0})}catch(e){if(e instanceof NR&&e.code===Fy.ERROR_PROFILE_NOT_FOUND)await this.doInitializeDefaultProfileExtensions();else throw e}}async doInitializeDefaultProfileExtensions(){return this.initializeDefaultProfileExtensionsPromise||(this.initializeDefaultProfileExtensionsPromise=(async()=>{try{this.logService.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());const e=await this.scanAllUserExtensions({includeInvalid:!0});if(e.length)await this.extensionsProfileScannerService.addExtensionsToProfile(e.map(t=>[t,t.metadata]),this.userDataProfilesService.defaultProfile.extensionsResource);else try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,Re.fromString(JSON.stringify([])))}catch(t){Kf(t)!==$n.FILE_NOT_FOUND&&this.logService.warn("Failed to create default profile extensions manifest in extensions installation folder.",this.userExtensionsLocation.toString(),ba(t))}this.logService.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}catch(e){this.logService.error(e)}finally{this.initializeDefaultProfileExtensionsPromise=void 0}})()),this.initializeDefaultProfileExtensionsPromise}async applyScanOptions(e,t,i={}){return i.includeAllVersions||(e=this.dedupExtensions(t===Pn.System?e:void 0,t===Pn.User?e:void 0,t==="development"?e:void 0,await this.getTargetPlatform(),!!i.pickLatest)),i.includeInvalid||(e=e.filter(n=>n.isValid)),e.sort((n,o)=>{const r=Sn(n.location.fsPath),a=Sn(o.location.fsPath);return r<a?-1:r>a?1:0})}dedupExtensions(e,t,i,n,o){const r=(c,d,l)=>{if(!l){if(c.metadata?.isApplicationScoped&&!d.metadata?.isApplicationScoped)return!1;if(!c.metadata?.isApplicationScoped&&d.metadata?.isApplicationScoped)return!0}if(c.isValid&&!d.isValid)return!1;if(c.isValid===d.isValid){if(o&&My.gt(c.manifest.version,d.manifest.version))return this.logService.debug(`Skipping extension ${d.location.path} with lower version ${d.manifest.version} in favour of ${c.location.path} with version ${c.manifest.version}`),!1;if(My.eq(c.manifest.version,d.manifest.version)){if(c.type===Pn.System)return this.logService.debug(`Skipping extension ${d.location.path} in favour of system extension ${c.location.path} with same version`),!1;if(c.targetPlatform===n)return this.logService.debug(`Skipping extension ${d.location.path} from different target platform ${d.targetPlatform}`),!1}}return l?this.logService.warn(`Overwriting user extension ${c.location.path} with ${d.location.path}.`):this.logService.debug(`Overwriting user extension ${c.location.path} with ${d.location.path}.`),!0},a=new ko;return e?.forEach(c=>{const d=a.get(c.identifier.id);(!d||r(d,c,!1))&&a.set(c.identifier.id,c)}),t?.forEach(c=>{const d=a.get(c.identifier.id);if(!d&&e&&c.type===Pn.System){this.logService.debug(`Skipping obsolete system extension ${c.location.path}.`);return}(!d||r(d,c,!1))&&a.set(c.identifier.id,c)}),i?.forEach(c=>{const d=a.get(c.identifier.id);(!d||r(d,c,!0))&&a.set(c.identifier.id,c),a.set(c.identifier.id,c)}),[...a.values()]}async scanDefaultSystemExtensions(e){this.logService.trace("Started scanning system extensions");const t=await this.createExtensionScannerInput(this.systemExtensionsLocation,!1,Pn.System,e,!0,void 0,this.getProductVersion()),n=await(t.devMode?this.extensionsScanner:this.systemExtensionsCachedScanner).scanExtensions(t);return this.logService.trace("Scanned system extensions:",n.length),n}async scanDevSystemExtensions(e,t){const i=this.environmentService.isBuilt?[]:this.productService.builtInExtensions;if(!i?.length)return[];this.logService.trace("Started scanning dev system extensions");const n=t?await this.getBuiltInExtensionControl():{},o=[],r=R.file(oq(gve(tc.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(const c of i){const d=n[c.name]||"marketplace";switch(d){case"disabled":break;case"marketplace":o.push(xt(r,c.name));break;default:o.push(R.file(d));break}}const a=await Promise.all(o.map(async c=>this.extensionsScanner.scanExtension(await this.createExtensionScannerInput(c,!1,Pn.System,e,!0,void 0,this.getProductVersion()))));return this.logService.trace("Scanned dev system extensions:",a.length),Vt(a)}async getBuiltInExtensionControl(){try{const e=await this.fileService.readFile(this.extensionsControlLocation);return JSON.parse(e.value.toString())}catch{return{}}}async createExtensionScannerInput(e,t,i,n,o,r,a){const c=await this.getTranslations(n??sl),d=await this.getMtime(e),l=t&&!this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)?this.userDataProfilesService.defaultProfile.extensionsResource:void 0,u=l?await this.getMtime(l):void 0;return new WC(e,d,l,u,t,r,i,o,a.version,a.date,this.productService.commit,!this.environmentService.isBuilt,n,c)}async getMtime(e){try{const t=await this.fileService.stat(e);if(typeof t.mtime=="number")return t.mtime}catch{}}getProductVersion(){return{version:this.productService.version,date:this.productService.date}}};ZQ=f([p(4,Wv),p(5,EN),p(6,Xe),p(7,Pe),p(8,po),p(9,Fn),p(10,Zi),p(11,J)],ZQ);class WC{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){this.location=e,this.mtime=t,this.applicationExtensionslocation=i,this.applicationExtensionslocationMtime=n,this.profile=o,this.profileScanOptions=r,this.type=a,this.validate=c,this.productVersion=d,this.productDate=l,this.productCommit=u,this.devMode=g,this.language=m,this.translations=v}static createNlsConfiguration(e){return{language:e.language,pseudo:e.language==="pseudo",devMode:e.devMode,translations:e.translations}}static equals(e,t){return Dt(e.location,t.location)&&e.mtime===t.mtime&&Dt(e.applicationExtensionslocation,t.applicationExtensionslocation)&&e.applicationExtensionslocationMtime===t.applicationExtensionslocationMtime&&e.profile===t.profile&&ma(e.profileScanOptions,t.profileScanOptions)&&e.type===t.type&&e.validate===t.validate&&e.productVersion===t.productVersion&&e.productDate===t.productDate&&e.productCommit===t.productCommit&&e.devMode===t.devMode&&e.language===t.language&&UV.equals(e.translations,t.translations)}}let OR=class extends F{constructor(e,t){super(),this.fileService=e,this.logService=t}async getLocalizedMessages(e,t,i){const n=xt(e,"package.nls.json"),o=(d,l)=>{l.forEach(u=>{this.logService.error(this.formatMessage(e,h(1824,"Failed to parse {0}: {1}.",d?.path,HV(u.error))))})},r=d=>{this.logService.error(this.formatMessage(e,h(1825,"Invalid format {0}: JSON object expected.",d?.path)))},a=`${t.publisher}.${t.name}`,c=i.translations[a];if(c)try{const d=R.parse(c),l=(await this.fileService.readFile(d)).value.toString(),u=[],g=Db(l,u);return u.length>0?(o(d,u),{values:void 0,default:n}):hC(g)!=="object"?(r(d),{values:void 0,default:n}):{values:g.contents?g.contents.package:void 0,default:n}}catch{return{values:void 0,default:n}}else{if(!await this.fileService.exists(n))return;let l;try{l=await this.findMessageBundles(e,i)}catch{return}if(!l.localized)return{values:void 0,default:l.original};try{const u=(await this.fileService.readFile(l.localized)).value.toString(),g=[],m=Db(u,g);return g.length>0?(o(l.localized,g),{values:void 0,default:l.original}):hC(m)!=="object"?(r(l.localized),{values:void 0,default:l.original}):{values:m,default:l.original}}catch{return{values:void 0,default:l.original}}}}async translateManifest(e,t,i){const n=await this.getLocalizedMessages(e,t,i);if(n)try{const o=[],r=await this.resolveOriginalMessageBundle(n.default,o);if(o.length>0)return o.forEach(c=>{this.logService.error(this.formatMessage(e,h(1824,"Failed to parse {0}: {1}.",n.default?.path,HV(c.error))))}),t;if(hC(n)!=="object")return this.logService.error(this.formatMessage(e,h(1825,"Invalid format {0}: JSON object expected.",n.default?.path))),t;const a=n.values||Object.create(null);return qRe(this.logService,t,a,r)}catch{}return t}async resolveOriginalMessageBundle(e,t){if(e)try{const i=(await this.fileService.readFile(e)).value.toString();return Db(i,t)}catch{}}findMessageBundles(e,t){return new Promise((i,n)=>{const o=r=>{const a=xt(e,`package.nls.${r}.json`);this.fileService.exists(a).then(c=>{c&&i({localized:a,original:xt(e,"package.nls.json")});const d=r.lastIndexOf("-");d===-1?i({localized:xt(e,"package.nls.json"),original:null}):(r=r.substring(0,d),o(r))})};if(t.devMode||t.pseudo||!t.language)return i({localized:xt(e,"package.nls.json"),original:null});o(t.language)})}formatMessage(e,t){return`[${e.path}]: ${t}`}};OR=f([p(0,Xe),p(1,Pe)],OR);let FR=class extends OR{constructor(e,t,i,n,o,r){super(i,r),this.extensionsProfileScannerService=e,this.uriIdentityService=t,this.environmentService=o,this.extensionsEnabledWithApiProposalVersion=n.extensionsEnabledWithApiProposalVersion?.map(a=>a.toLowerCase())??[]}async scanExtensions(e){return e.profile?this.scanExtensionsFromProfile(e):this.scanExtensionsFromLocation(e)}async scanExtensionsFromLocation(e){const t=await this.fileService.resolve(e.location);if(!t.children?.length)return[];const i=await Promise.all(t.children.map(async n=>{if(!n.isDirectory||e.type===Pn.User&&je(n.resource).indexOf(".")===0)return null;const o=new WC(n.resource,e.mtime,e.applicationExtensionslocation,e.applicationExtensionslocationMtime,e.profile,e.profileScanOptions,e.type,e.validate,e.productVersion,e.productDate,e.productCommit,e.devMode,e.language,e.translations);return this.scanExtension(o)}));return Vt(i).sort((n,o)=>n.location.path<o.location.path?-1:1)}async scanExtensionsFromProfile(e){let t=await this.scanExtensionsFromProfileResource(e.location,()=>!0,e);if(e.applicationExtensionslocation&&!this.uriIdentityService.extUri.isEqual(e.location,e.applicationExtensionslocation)){t=t.filter(n=>!n.metadata?.isApplicationScoped);const i=await this.scanExtensionsFromProfileResource(e.applicationExtensionslocation,n=>!!n.metadata?.isBuiltin||!!n.metadata?.isApplicationScoped,e);t.push(...i)}return t}async scanExtensionsFromProfileResource(e,t,i){const n=await this.extensionsProfileScannerService.scanProfileExtensions(e,i.profileScanOptions);if(!n.length)return[];const o=await Promise.all(n.map(async r=>{if(t(r)){const a=new WC(r.location,i.mtime,i.applicationExtensionslocation,i.applicationExtensionslocationMtime,i.profile,i.profileScanOptions,i.type,i.validate,i.productVersion,i.productDate,i.productCommit,i.devMode,i.language,i.translations);return this.scanExtension(a,r)}return null}));return Vt(o)}async scanOneOrMultipleExtensions(e){try{if(await this.fileService.exists(xt(e.location,"package.json"))){const t=await this.scanExtension(e);return t?[t]:[]}else return await this.scanExtensions(e)}catch(t){return this.logService.error(`Error scanning extensions at ${e.location.path}:`,ba(t)),[]}}async scanExtension(e,t){const i=[];let n=!0,o;try{o=await this.scanExtensionManifest(e.location)}catch(g){if(t){i.push([Me.Error,ba(g)]),n=!1;const[m,v]=t.identifier.id.split(".");o={name:v,publisher:m,version:t.version,engines:{vscode:""}}}else return e.type!==Pn.System&&this.logService.error(g),null}o.publisher||(o.publisher=pve);let r;t?r={...t.metadata,size:o.__metadata?.size}:o.__metadata&&(r={installedTimestamp:o.__metadata.installedTimestamp,size:o.__metadata.size,targetPlatform:o.__metadata.targetPlatform}),delete o.__metadata;const a=du(o.publisher,o.name),c=r?.id?{id:a,uuid:r.id}:{id:a},d=r?.isSystem?Pn.System:e.type,l=d===Pn.System||!!r?.isBuiltin;try{o=await this.translateManifest(e.location,o,WC.createNlsConfiguration(e))}catch(g){this.logService.warn("Failed to translate manifest",ba(g))}let u={type:d,identifier:c,manifest:o,location:e.location,isBuiltin:l,targetPlatform:r?.targetPlatform??lC.UNDEFINED,publisherDisplayName:r?.publisherDisplayName,metadata:r,isValid:n,validations:i,preRelease:!!r?.preRelease};return e.validate&&(u=this.validate(u,e)),o.enabledApiProposals&&(!this.environmentService.isBuilt||this.extensionsEnabledWithApiProposalVersion.includes(a.toLowerCase()))&&(o.originalEnabledApiProposals=o.enabledApiProposals,o.enabledApiProposals=fve([...o.enabledApiProposals])),u}validate(e,t){let i=e.isValid;const n=this.environmentService.isBuilt&&this.extensionsEnabledWithApiProposalVersion.includes(e.identifier.id.toLowerCase()),o=LAe(t.productVersion,t.productDate,t.location,e.manifest,e.isBuiltin,n);for(const[r,a]of o)r===Me.Error&&(i=!1,this.logService.error(this.formatMessage(t.location,a)));return e.isValid=i,e.validations=[...e.validations,...o],e}async scanExtensionManifest(e){const t=xt(e,"package.json");let i;try{i=(await this.fileService.readFile(t)).value.toString()}catch(o){throw Kf(o)!==$n.FILE_NOT_FOUND&&this.logService.error(this.formatMessage(e,h(1826,"Cannot read file {0}: {1}.",t.path,o.message))),o}let n;try{n=JSON.parse(i)}catch(o){const r=[];Db(i,r);for(const a of r)this.logService.error(this.formatMessage(e,h(1827,"Failed to parse {0}: [{1}, {2}] {3}.",t.path,a.offset,a.length,HV(a.error))));throw o}if(hC(n)!=="object"){const o=this.formatMessage(e,h(1828,"Invalid manifest file {0}: Not a JSON object.",t.path));throw this.logService.error(o),new Error(o)}return n}};FR=f([p(0,EN),p(1,Zi),p(2,Xe),p(3,Fn),p(4,po),p(5,Pe)],FR);let WR=class extends FR{constructor(e,t,i,n,o,r,a,c){super(i,n,o,r,a,c),this.currentProfile=e,this.userDataProfilesService=t,this.cacheValidatorThrottler=this._register(new mve(3e3)),this._onDidChangeCache=this._register(new M),this.onDidChangeCache=this._onDidChangeCache.event}async scanExtensions(e){const t=this.getCacheFile(e),i=await this.readExtensionCache(t);if(this.input=e,i&&i.input&&WC.equals(i.input,this.input))return this.logService.debug("Using cached extensions scan result",e.type===Pn.System?"system":"user",e.location.toString()),this.cacheValidatorThrottler.trigger(()=>this.validateCache()),i.result.map(o=>(o.location=R.revive(o.location),o));const n=await super.scanExtensions(e);return await this.writeExtensionCache(t,{input:e,result:n}),n}async readExtensionCache(e){try{const t=await this.fileService.readFile(e),i=JSON.parse(t.value.toString());return{result:i.result,input:cn(i.input)}}catch(t){this.logService.debug("Error while reading the extension cache file:",e.path,ba(t))}return null}async writeExtensionCache(e,t){try{await this.fileService.writeFile(e,Re.fromString(JSON.stringify(t)))}catch(i){this.logService.debug("Error while writing the extension cache file:",e.path,ba(i))}}async validateCache(){if(!this.input)return;const e=this.getCacheFile(this.input),t=await this.readExtensionCache(e);if(!t)return;const i=t.result,n=JSON.parse(JSON.stringify(await super.scanExtensions(this.input)));if(!ma(n,i))try{this.logService.info("Invalidating Cache",i,n),await this.fileService.del(e),this._onDidChangeCache.fire()}catch(o){this.logService.error(o)}}getCacheFile(e){const t=this.getProfile(e);return this.uriIdentityService.extUri.joinPath(t.cacheHome,e.type===Pn.System?vve:_ve)}getProfile(e){return e.type===Pn.System?this.userDataProfilesService.defaultProfile:e.profile?this.uriIdentityService.extUri.isEqual(e.location,this.currentProfile.extensionsResource)?this.currentProfile:this.userDataProfilesService.profiles.find(t=>this.uriIdentityService.extUri.isEqual(e.location,t.extensionsResource))??this.currentProfile:this.userDataProfilesService.defaultProfile}};WR=f([p(1,Wv),p(2,EN),p(3,Zi),p(4,Xe),p(5,Fn),p(6,po),p(7,Pe)],WR);let $V;function T8e(s){$V=s}let Xce;function A8e(s){Xce=s}function KRe(s,e,t,i){const n=new U;n.add(tc.registerStaticBrowserUri(xt(s,e),R.parse(t)));const o=typeof i=="string"?{mimeType:i}:i;return n.add(oCe(new rCe(xt(s,e),t,o))),n}const JQ=sCe(async({toAdd:s,toRemove:e})=>{await nA(),await Ya.get(hn).deltaExtensions(s,e)},(s,e)=>({toAdd:[...s.toAdd,...e.toAdd],toRemove:[...s.toRemove,...e.toRemove]}),0),GV=new Map,US=[];function R8e(){return US}function jRe(s){return GV.get(s)}function P8e(s,e,{path:t="/extension",system:i=!1,readmePath:n,changelogPath:o}={}){const r=_q(s.publisher,s.name),a=R.from({scheme:zse.extensionFile,authority:r,path:t}),c=(async()=>{await nA();const l=Ya.get(mn).remoteAuthority;let u=a;e===Lt.Remote&&(u=R.from({scheme:ae.vscodeRemote,authority:l,path:t}));const m=Ya.get(J).createInstance(OR),v={devMode:!1,language:sl,pseudo:sl==="pseudo",translations:Gre(sl)??{}},w={manifest:await m.translateManifest(u,s,v),type:i?Pn.System:Pn.User,isBuiltin:!0,identifier:{id:r},location:u,targetPlatform:lC.WEB,isValid:!0,validations:[],extHostKind:e,readmeUrl:n!=null?R.joinPath(u,n):void 0,changelogUrl:o!=null?R.joinPath(u,o):void 0,preRelease:!1};return e!=null&&GV.set(r,e),e!==Lt.Remote&&US.push(w),Ya.get(gd).isEnabled(w)&&await JQ({toAdd:[w],toRemove:[]}),w})();let d={id:r,async whenReady(){await c},async isEnabled(){await nA();const l=Ya.get(gd),u=await c;return l.isEnabled(u)},async dispose(){const l=await c;US.indexOf(l)>=0&&US.splice(US.indexOf(l),1),GV.delete(r),await JQ({toAdd:[],toRemove:[l]})}};if(e!==Lt.Remote&&(d={...d,registerFileUrl:function(u,g,m){return KRe(a,u,g,m)}}),e===Lt.LocalProcess){async function l(){if(await c,$V==null)throw new Error("The local api can't be used without registering the local extension host by importing `vscode/localExtensionHost`");return await $V(r)}d={...d,getApi:l,async setAsDefaultApi(){Xce?.(await l())}}}return d}let eX=class extends F{constructor(e,t,i){super(),this.fileService=t,this.languagePackService=i}async $fetchBuiltInBundleUri(e,t){try{return await this.languagePackService.getBuiltInExtensionTranslationsUri(e,t)}catch{return}}async $fetchBundleContents(e){return(await this.fileService.readFile(R.revive(e))).value.toString()}};eX=f([ht($e.MainThreadLocalization),p(1,Xe),p(2,Goe)],eX);class SO{constructor(e,t,i){this.viewType=e,this.serializer=t,this.extensionData=i}}let BR=class extends gl{get capabilities(){let e=Ze.CanSplitInGroup;return this.fileService.hasProvider(this.resource)?this.filesConfigurationService.isReadonly(this.resource)&&(e|=Ze.Readonly):e|=Ze.Untitled,e&Ze.Readonly||(e|=Ze.CanDropIntoEditor),e}get preferredResource(){return this._preferredResource}constructor(e,t,i,n,o,r,a){super(),this.resource=e,this.labelService=i,this.fileService=n,this.filesConfigurationService=o,this.textResourceConfigurationService=r,this.customEditorLabelService=a,this._name=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._preferredResource=t||e,this.registerListeners()}registerListeners(){this._register(this.labelService.onDidChangeFormatters(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onLabelEvent(e.scheme))),this._register(this.customEditorLabelService.onDidChange(()=>this.updateLabel())),this._register(this.filesConfigurationService.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire()))}onLabelEvent(e){e===this._preferredResource.scheme&&this.updateLabel()}updateLabel(){this._name=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._onDidChangeLabel.fire()}setPreferredResource(e){Dt(e,this._preferredResource)||(this._preferredResource=e,this.updateLabel())}getName(){return typeof this._name!="string"&&(this._name=this.customEditorLabelService.getName(this._preferredResource)??this.labelService.getUriBasenameLabel(this._preferredResource)),this._name}getDescription(e=Nt.MEDIUM){switch(e){case Nt.SHORT:return this.shortDescription;case Nt.LONG:return this.longDescription;case Nt.MEDIUM:default:return this.mediumDescription}}get shortDescription(){return typeof this._shortDescription!="string"&&(this._shortDescription=this.labelService.getUriBasenameLabel(hs(this._preferredResource))),this._shortDescription}get mediumDescription(){return typeof this._mediumDescription!="string"&&(this._mediumDescription=this.labelService.getUriLabel(hs(this._preferredResource),{relative:!0})),this._mediumDescription}get longDescription(){return typeof this._longDescription!="string"&&(this._longDescription=this.labelService.getUriLabel(hs(this._preferredResource))),this._longDescription}get shortTitle(){return typeof this._shortTitle!="string"&&(this._shortTitle=this.getName()),this._shortTitle}get mediumTitle(){return typeof this._mediumTitle!="string"&&(this._mediumTitle=this.labelService.getUriLabel(this._preferredResource,{relative:!0})),this._mediumTitle}get longTitle(){return typeof this._longTitle!="string"&&(this._longTitle=this.labelService.getUriLabel(this._preferredResource)),this._longTitle}getTitle(e){switch(e){case Nt.SHORT:return this.shortTitle;case Nt.LONG:return this.longTitle;default:case Nt.MEDIUM:return this.mediumTitle}}isReadonly(){return this.filesConfigurationService.isReadonly(this.resource)}ensureLimits(e){if(e?.limits)return e.limits;const t=bve(this.resource);let i;const n=this.textResourceConfigurationService.inspect(this.resource,null,"workbench.editorLargeFileConfirmation");return yve(n)&&(i=n.value*Fo.MB),{size:i??t}}};BR=f([p(2,di),p(3,Xe),p(4,Ns),p(5,Xo),p(6,wg)],BR);var $S;let Lm=class extends BR{static{$S=this}static getOrCreate(e,t,i,n,o={}){const r=e.createInstance($S,t,i,n,o);return i&&r.setPreferredResource(i),r}static{this.ID="workbench.input.notebook"}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(e,t,c,d,l,m,v),this.viewType=i,this.options=n,this._notebookService=o,this._notebookModelResolverService=r,this._fileDialogService=a,this.editorModelReference=null,this._defaultDirtyState=!1,this._defaultDirtyState=!!n.startDirty,this._sideLoadedListener=o.onDidAddNotebookDocument(y=>{y.viewType===this.viewType&&y.uri.toString()===this.resource.toString()&&this.resolve().catch(mt)}),this._register(u.onWillStop(y=>{if(!y.auto&&!this.isDirty())return;const w=y.auto?h(8674,"An extension provided notebook for '{0}' is still open that would close otherwise.",this.getName()):h(8675,"An extension provided notebook for '{0}' could not be saved.",this.getName());y.veto((async()=>{const C=g.findEditors(this);return y.auto?!0:!(C.length>0&&(await g.save(C[0])).success)})(),w)}))}dispose(){this._sideLoadedListener.dispose(),this.editorModelReference?.dispose(),this.editorModelReference=null,super.dispose()}get typeId(){return $S.ID}get editorId(){return this.viewType}get capabilities(){let e=Ze.None;return this.resource.scheme===ae.untitled&&(e|=Ze.Untitled),this.editorModelReference?this.editorModelReference.object.isReadonly()&&(e|=Ze.Readonly):this.filesConfigurationService.isReadonly(this.resource)&&(e|=Ze.Readonly),e&Ze.Readonly||(e|=Ze.CanDropIntoEditor),e}getDescription(e=Nt.MEDIUM){if(!this.hasCapability(Ze.Untitled)||this.editorModelReference?.object.hasAssociatedFilePath())return super.getDescription(e)}isReadonly(){return this.editorModelReference?this.editorModelReference.object.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}isDirty(){return this.editorModelReference?this.editorModelReference.object.isDirty():this._defaultDirtyState}isSaving(){const e=this.editorModelReference?.object;return!e||!e.isDirty()||e.hasErrorState||this.hasCapability(Ze.Untitled)?!1:this.filesConfigurationService.hasShortAutoSaveDelay(this)}async save(e,t){if(this.editorModelReference)return this.hasCapability(Ze.Untitled)?this.saveAs(e,t):(await this.editorModelReference.object.save(t),this)}async saveAs(e,t){if(!this.editorModelReference)return;const i=this._notebookService.getContributedNotebookType(this.viewType);if(!i)return;const n=this.hasCapability(Ze.Untitled)?await this._suggestName(i,this.labelService.getUriBasenameLabel(this.resource)):this.editorModelReference.object.resource;let o;if(this.editorModelReference.object.hasAssociatedFilePath())o=n;else if(o=await this._fileDialogService.pickFileToSave(n,t?.availableFileSystems),!o)return;if(!i.matches(o)){const r=i.selectors.map(a=>typeof a=="string"?a:wve(a)?`${a} (base ${a.base})`:a.exclude?`${a.include} (exclude: ${a.exclude})`:`${a.include}`).join(", ");throw new Error(`File name ${o} is not supported by ${i.providerDisplayName}.

Please make sure the file name matches following patterns:
${r}`)}return await this.editorModelReference.object.saveAs(o)}async _suggestName(e,t){const i=e.selectors[0];let n=i&&typeof i=="string"?i:void 0;if(!n&&i){const o=i.include;typeof o=="string"&&(n=o)}if(n){const o=/^\*\.([A-Za-z_-]*)$/.exec(n);if(o&&o.length>1){const r=o[1];if(!t.endsWith(r))return xt(await this._fileDialogService.defaultFilePath(),t+"."+r)}}return xt(await this._fileDialogService.defaultFilePath(),t)}async rename(e,t){if(this.editorModelReference)return{editor:{resource:t},options:{override:this.viewType}}}async revert(e,t){this.editorModelReference&&this.editorModelReference.object.isDirty()&&await this.editorModelReference.object.revert(t)}async resolve(e,t){if(!await this._notebookService.canResolve(this.viewType))return null;if(t?.mark("extensionActivated"),this._sideLoadedListener.dispose(),this.editorModelReference)this.editorModelReference.object.load({limits:this.ensureLimits(e)});else{const i=!!(this.capabilities&Ze.Scratchpad),n=await this._notebookModelResolverService.resolve(this.resource,this.viewType,{limits:this.ensureLimits(e),scratchpad:i,viewType:this.editorId});if(this.editorModelReference)return n.dispose(),this.editorModelReference.object;if(this.editorModelReference=n,this.isDisposed())return this.editorModelReference.dispose(),this.editorModelReference=null,null;this._register(this.editorModelReference.object.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.editorModelReference.object.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire())),this._register(this.editorModelReference.object.onDidRevertUntitled(()=>this.dispose())),this.editorModelReference.object.isDirty()&&this._onDidChangeDirty.fire()}if(this.options._backupId){const i=await this._notebookService.withNotebookDataProvider(this.editorModelReference.object.notebook.viewType);if(!(i instanceof SO))throw new Error("CANNOT open file notebook with this provider");const n=await i.serializer.dataToNotebook(Re.fromString(JSON.stringify({__webview_backup:this.options._backupId})));this.editorModelReference.object.notebook.applyEdits([{editType:al.Replace,index:0,count:this.editorModelReference.object.notebook.length,cells:n.cells}],!0,void 0,()=>{},void 0,!1),this.options._workingCopy&&(this.options._backupId=void 0,this.options._workingCopy=void 0,this.options.startDirty=void 0)}return this.editorModelReference.object}toUntyped(){return{resource:this.resource,options:{override:this.viewType}}}matches(e){return super.matches(e)?!0:e instanceof $S?this.viewType===e.viewType&&Dt(this.resource,e.resource):eh(e)&&e.resource.scheme===fl.scheme?Dt(this.resource,fl.parse(e.resource)?.notebook):!1}};Lm=$S=f([p(4,$h),p(5,xI),p(6,js),p(7,di),p(8,Xe),p(9,Ns),p(10,hn),p(11,de),p(12,Xo),p(13,wg)],Lm);function YRe(s){return!!s&&typeof s=="object"&&Array.isArray(s.editorInputs)&&s.editorInputs.every(e=>e instanceof Lm)}const Zce="jupyter-notebook",QRe="ms-toolsai.jupyter",Jce=new Map;Jce.set(Zce,new Map);Jce.get(Zce)?.set("python",{extensionIds:["ms-python.python",QRe],displayName:"Python + Jupyter"});var tX;(function(s){s[s.Html=0]="Html",s[s.Extension=1]="Extension"})(tX||(tX={}));var iX;(function(s){s[s.fullCell=0]="fullCell",s[s.firstLine=1]="firstLine"})(iX||(iX={}));var nX;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Estimated=1]="Estimated",s[s.FromCache=2]="FromCache",s[s.Measured=3]="Measured"})(nX||(nX={}));var sX;(function(s){s[s.Fold=0]="Fold"})(sX||(sX={}));var oX;(function(s){s[s.Left=1]="Left",s[s.Center=2]="Center",s[s.Right=4]="Right",s[s.Full=7]="Full"})(oX||(oX={}));var rX;(function(s){s[s.Default=1]="Default",s[s.Top=2]="Top",s[s.Center=3]="Center",s[s.CenterIfOutsideViewport=4]="CenterIfOutsideViewport",s[s.NearTopIfOutsideViewport=5]="NearTopIfOutsideViewport",s[s.FirstLineIfOutsideViewport=6]="FirstLineIfOutsideViewport"})(rX||(rX={}));var aX;(function(s){s[s.Default=1]="Default",s[s.Center=2]="Center",s[s.CenterIfOutsideViewport=3]="CenterIfOutsideViewport"})(aX||(aX={}));var cX;(function(s){s[s.Preview=0]="Preview",s[s.Editing=1]="Editing"})(cX||(cX={}));var dX;(function(s){s[s.Container=0]="Container",s[s.Editor=1]="Editor",s[s.Output=2]="Output",s[s.ChatInput=3]="ChatInput"})(dX||(dX={}));var lX;(function(s){s[s.None=0]="None",s[s.Top=1]="Top",s[s.Bottom=2]="Bottom",s[s.Both=3]="Both"})(lX||(lX={}));var hX;(function(s){s[s.None=0]="None",s[s.Start=1]="Start",s[s.End=2]="End",s[s.Both=3]="Both"})(hX||(hX={}));function dl(s){if(!s)return;if(s.getId()===boe)return s.getControl();if(s.getId()===YCe)return s.getControl().inlineNotebookEditor;const e=s.input;if(e&&YRe(e))return s.getControl()?.notebookEditor}var uX;(function(s){s[s.None=0]="None",s[s.Expanded=1]="Expanded",s[s.Collapsed=2]="Collapsed"})(uX||(uX={}));class Fb extends Sve{static is(e){return e instanceof Fb?!0:R.isUri(e.resource)&&oa(e.cellEdit)}static lift(e){return e instanceof Fb?e:new Fb(e.resource,e.cellEdit,e.notebookVersionId,e.metadata)}constructor(e,t,i=void 0,n){super(n),this.resource=e,this.cellEdit=t,this.notebookVersionId=i}}let gX=class{constructor(e,t,i,n,o,r,a){this._undoRedoGroup=e,this._progress=i,this._token=n,this._edits=o,this._editorService=r,this._notebookModelService=a,this._edits=this._edits.map(c=>{if(c.resource.scheme===fl.scheme){const d=fl.parse(c.resource)?.notebook;if(!d)throw new Error(`Invalid notebook URI: ${c.resource}`);return new Fb(d,c.cellEdit,c.notebookVersionId,c.metadata)}else return c})}async apply(){const e=[],t=VT(this._edits,(i,n)=>RT(i.resource.toString(),n.resource.toString()));for(const i of t){if(this._token.isCancellationRequested)break;const[n]=i,o=await this._notebookModelService.resolve(n.resource);if(typeof n.notebookVersionId=="number"&&o.object.notebook.versionId!==n.notebookVersionId)throw o.dispose(),new Error(`Notebook '${n.resource}' has changed in the meantime`);const r=i.map(l=>l.cellEdit),a=!o.object.isReadonly(),c=dl(this._editorService.activeEditorPane),d=c?.textModel?.uri.toString()===o.object.notebook.uri.toString()?{kind:eW.Index,focus:c.getFocus(),selections:c.getSelections()}:void 0;o.object.notebook.applyEdits(r,!0,d,()=>{},this._undoRedoGroup,a),o.dispose(),this._progress.report(void 0),e.push(n.resource)}return e}};gX=f([p(5,de),p(6,xI)],gX);let pX=class{constructor(e,t,i,n){this._bulkEditService=t,this._logService=i,this._uriIdentService=n}dispose(){}$tryApplyWorkspaceEdit(e,t,i){const n=Fu(e.value,this._uriIdentService);return this._bulkEditService.apply(n,{undoRedoGroupId:t,respectAutoSaveConfig:i}).then(o=>o.isApplied,o=>(this._logService.warn(`IGNORING workspace edit: ${o}`),!1))}};pX=f([ht($e.MainThreadBulkEdits),p(1,gw),p(2,Pe),p(3,Zi)],pX);function Fu(s,e,t){if(!s||!s.edits)return s;const i=cn(s);for(const n of i.edits){if(Jie.is(n)&&(n.resource=e.asCanonicalUri(n.resource)),ic.is(n)){if(n.options){const o=n.options?.contents;if(o)if(o.type==="base64")n.options.contents=Promise.resolve(nq(o.value));else if(t)n.options.contents=t(o.id);else throw new Error("Could not revive data transfer file")}n.newResource=n.newResource&&e.asCanonicalUri(n.newResource),n.oldResource=n.oldResource&&e.asCanonicalUri(n.oldResource)}if(Fb.is(n)){n.resource=e.asCanonicalUri(n.resource);const o=n.cellEdit;o.editType===al.Replace&&(n.cellEdit={...o,cells:o.cells.map(r=>({...r,outputs:r.outputs.map(a=>({...a,outputs:a.items.map(c=>({mime:c.mime,data:c.valueBytes}))}))}))})}}return s}async function LK(s,e){const t=e==="image/gif";return typeof s=="string"&&(s=ede(s)),new Promise((i,n)=>{const o=new Blob([s],{type:e}),r=new Image,a=URL.createObjectURL(o);r.src=a,r.onload=()=>{URL.revokeObjectURL(a);let{width:c,height:d}=r;if((c<=768||d<=768)&&!t){i(s);return}if(c>2048||d>2048){const m=2048/Math.max(c,d);c=Math.round(c*m),d=Math.round(d*m)}const l=768/Math.min(c,d);c=Math.round(c*l),d=Math.round(d*l);const u=document.createElement("canvas");u.width=c,u.height=d;const g=u.getContext("2d");g?(g.drawImage(r,0,0,c,d),u.toBlob(m=>{if(m){const v=new FileReader;v.onload=()=>{i(new Uint8Array(v.result))},v.onerror=y=>n(y),v.readAsArrayBuffer(m)}else n(new Error("Failed to create blob from canvas"))},"image/png")):n(new Error("Failed to get canvas context"))},r.onerror=c=>{URL.revokeObjectURL(a),n(c)}})}function ede(s){const e=s.includes(",")?s.split(",")[1]:s;return XRe(e)?Uint8Array.from(atob(e),t=>t.charCodeAt(0)):new TextEncoder().encode(s)}function XRe(s){return/^[A-Za-z0-9+/]*={0,2}$/.test(s)&&(()=>{try{return atob(s),!0}catch{return!1}})()}async function ZRe(s){const e=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join("")}let fX=class{constructor(e,t,i,n,o,r,a,c){this._chatProviderService=t,this._languageModelStatsService=i,this._logService=n,this._authenticationService=o,this._authenticationAccessService=r,this._extensionService=a,this._ignoredFilesService=c,this._store=new U,this._providerRegistrations=new ei,this._pendingProgress=new Map,this._ignoredFileProviderRegistrations=new ei,this._proxy=e.getProxy(Ye.ExtHostChatProvider),this._proxy.$acceptChatModelMetadata({added:t.getLanguageModelIds().map(d=>({identifier:d,metadata:t.lookupLanguageModel(d)}))}),this._store.add(t.onDidChangeLanguageModels(this._proxy.$acceptChatModelMetadata,this._proxy))}dispose(){this._providerRegistrations.dispose(),this._ignoredFileProviderRegistrations.dispose(),this._store.dispose()}$registerLanguageModelProvider(e,t,i){const n=new U;n.add(this._chatProviderService.registerLanguageModelChat(t,{metadata:i,sendChatRequest:async(o,r,a,c)=>{const d=Math.random()*1e6|0,l=new Zo,u=new ene;try{this._pendingProgress.set(d,{defer:l,stream:u}),await Promise.all(o.flatMap(g=>g.content).filter(g=>g.type==="image_url").map(async g=>{g.value.data=Re.wrap(await LK(g.value.data.buffer))})),await this._proxy.$startChatRequest(e,d,r,new Jr(o),a,c)}catch(g){throw this._pendingProgress.delete(d),g}return{result:l.p,stream:u.asyncIterable}},provideTokenCount:(o,r)=>this._proxy.$provideTokenLength(e,o,r)})),i.auth&&n.add(this._registerAuthenticationProvider(i.extension,i.auth)),this._providerRegistrations.set(e,n)}async $reportResponsePart(e,t){const i=this._pendingProgress.get(e);this._logService.trace("[LM] report response PART",!!i,e,t),i&&i.stream.emitOne(t)}async $reportResponseDone(e,t){const i=this._pendingProgress.get(e);if(this._logService.trace("[LM] report response DONE",!!i,e,t),i)if(this._pendingProgress.delete(e),t){const n=Nd.tryDeserialize(t)??HT(t);i.stream.reject(n),i.defer.error(n)}else i.stream.resolve(),i.defer.complete(void 0)}$unregisterProvider(e){this._providerRegistrations.deleteAndDispose(e)}$selectChatModels(e){return this._chatProviderService.selectLanguageModels(e)}$whenLanguageModelChatRequestMade(e,t,i,n){this._languageModelStatsService.update(e,t,i,n)}async $tryStartChatRequest(e,t,i,n,o,r){this._logService.trace("[CHAT] request STARTED",e.value,i);let a;try{a=await this._chatProviderService.sendChatRequest(t,e,n.value,o,r)}catch(d){throw this._logService.error("[CHAT] request FAILED",e.value,i,d),d}const c=(async()=>{try{for await(const d of a.stream)this._logService.trace("[CHAT] request PART",e.value,i,d),await this._proxy.$acceptResponsePart(i,d);this._logService.trace("[CHAT] request DONE",e.value,i)}catch(d){this._logService.error("[CHAT] extension request ERRORED in STREAM",ho(d,!0),e.value,i),this._proxy.$acceptResponseDone(i,CF(d))}})();Promise.allSettled([a.result,c]).then(()=>{this._logService.debug("[CHAT] extension request DONE",e.value,i),this._proxy.$acceptResponseDone(i,void 0)},d=>{this._logService.error("[CHAT] extension request ERRORED",ho(d,!0),e.value,i),this._proxy.$acceptResponseDone(i,CF(d))})}$countTokens(e,t,i){return this._chatProviderService.computeTokenLength(e,t,i)}_registerAuthenticationProvider(e,t){const i=Ace+e.value;if(this._authenticationService.getProviderIds().includes(i))return F.None;const n=t.accountLabel??h(2437,"Language Models"),o=new U;return this._authenticationService.registerAuthenticationProvider(i,new JRe(i,t.providerLabel,n)),o.add(Ee(()=>{this._authenticationService.unregisterAuthenticationProvider(i)})),o.add(this._authenticationAccessService.onDidChangeExtensionSessionAccess(async r=>{const a=this._authenticationAccessService.readAllowedExtensions(i,n),c=[];for(const d of a){const l=await this._extensionService.getExtension(d.id);l&&c.push({from:l.identifier,to:e,enabled:d.allowed??!0})}this._proxy.$updateModelAccesslist(c)})),o}$fileIsIgnored(e,t){return this._ignoredFilesService.fileIsIgnored(R.revive(e),t)}$registerFileIgnoreProvider(e){this._ignoredFileProviderRegistrations.set(e,this._ignoredFilesService.registerIgnoredFileProvider({isFileIgnored:async(t,i)=>this._proxy.$isFileIgnored(e,t,i)}))}$unregisterFileIgnoreProvider(e){this._ignoredFileProviderRegistrations.deleteAndDispose(e)}};fX=f([ht($e.MainThreadLanguageModels),p(1,Cw),p(2,are),p(3,Pe),p(4,Uv),p(5,NN),p(6,hn),p(7,wz)],fX);class JRe{constructor(e,t,i){this.id=e,this.label=t,this._accountLabel=i,this.supportsMultipleAccounts=!1,this._onDidChangeSessions=new M,this.onDidChangeSessions=this._onDidChangeSessions.event}async getSessions(e){return e===void 0&&!this._session?[]:this._session?[this._session]:[await this.createSession(e||[])]}async createSession(e){return this._session=this._createFakeSession(e),this._onDidChangeSessions.fire({added:[this._session],changed:[],removed:[]}),this._session}removeSession(e){return this._session&&(this._onDidChangeSessions.fire({added:[],changed:[],removed:[this._session]}),this._session=void 0),Promise.resolve()}_createFakeSession(e){return{id:"fake-session",account:{id:this.id,label:this._accountLabel},accessToken:"fake-access-token",scopes:e}}}const ePe=(s,e,t)=>{const i=performance.now(),n=e(),o=performance.now()-i;return n instanceof Promise?n.then(r=>{const a=performance.now()-i;return mX(s,a,t),r}):(mX(s,o,t),n)},mX=(s,e,t)=>t(`[⏱][${s}] took ${e.toFixed(2)} ms`);class Zt{static{this.sep="."}static{this.None=new Zt("@@none@@")}static{this.Empty=new Zt("")}constructor(e){this.value=e}equals(e){return this.value===e.value}contains(e){return this.equals(e)||this.value===""||e.value.startsWith(this.value+Zt.sep)}intersects(e){return this.contains(e)||e.contains(this)}append(...e){return new Zt((this.value?[this.value,...e]:e).join(Zt.sep))}}const io={EDITORS:"CodeEditors",FILES:"CodeFiles",SYMBOLS:"application/vnd.code.symbols",MARKERS:"application/vnd.code.diagnostics",NOTEBOOK_CELL_OUTPUT:"notebook-cell-output"};function tde(s){const e=[];if(s.dataTransfer&&s.dataTransfer.types.length>0){const n=s.dataTransfer.getData(io.EDITORS);if(n)try{e.push(...Gie(n))}catch{}else try{const a=s.dataTransfer.getData(bs.RESOURCES);e.push(...nde(a))}catch{}if(s.dataTransfer?.files)for(let a=0;a<s.dataTransfer.files.length;a++){const c=s.dataTransfer.files[a];if(c&&dv(c))try{e.push({resource:R.file(dv(c)),isExternal:!0,allowWorkspaceOpen:!0})}catch{}}const o=s.dataTransfer.getData(io.FILES);if(o)try{const a=JSON.parse(o);for(const c of a)e.push({resource:R.file(c),isExternal:!0,allowWorkspaceOpen:!0})}catch{}const r=Ge.as(MK.DragAndDropContribution).getAll();for(const a of r){const c=s.dataTransfer.getData(a.dataFormatKey);if(c)try{e.push(...a.getEditorInputs(c))}catch{}}}const t=[],i=new wn;for(const n of e)n.resource?i.has(n.resource)||(t.push(n),i.set(n.resource,!0)):t.push(n);return t}async function ide(s,e){const t=tde(e);if(e.dataTransfer&&$t&&Eo(e,bs.FILES)&&e.dataTransfer.items){const o=await s.get(J).invokeFunction(r=>tPe(r,e));for(const r of o)t.push({resource:r.resource,contents:r.contents?.toString(),isExternal:!0,allowWorkspaceOpen:r.isDirectory})}return t}function nde(s){const e=[];if(s){const t=JSON.parse(s);for(const i of t)if(i.indexOf(":")>0){const{selection:n,uri:o}=tne(R.parse(i));e.push({resource:o,options:{selection:n}})}}return e}async function tPe(s,e){if(LE.supported($i)){const i=e.dataTransfer?.items;if(i)return iPe(s,i)}const t=e.dataTransfer?.files;return t?nPe(s,t):[]}async function iPe(s,e){const t=s.get(Xe).getProvider(ae.file);if(!(t instanceof aCe))return[];const i=[];for(let n=0;n<e.length;n++){const o=e[n];if(o){const r=new Zo;i.push(r),(async()=>{try{const a=await o.getAsFileSystemHandle();if(!a){r.complete(void 0);return}LE.isFileSystemFileHandle(a)?r.complete({resource:await t.registerFileHandle(a),isDirectory:!1}):LE.isFileSystemDirectoryHandle(a)?r.complete({resource:await t.registerDirectoryHandle(a),isDirectory:!0}):r.complete(void 0)}catch{r.complete(void 0)}})()}}return Vt(await Promise.all(i.map(n=>n.p)))}async function nPe(s,e){const t=s.get(Qt),i=[];for(let n=0;n<e.length;n++){const o=e.item(n);if(o){if(o.size>100*Fo.MB){t.warn(h(1752,"File is too large to open as untitled editor. Please upload it first into the file explorer and then try again."));continue}const r=new Zo;i.push(r);const a=new FileReader;a.onerror=()=>r.complete(void 0),a.onabort=()=>r.complete(void 0),a.onload=async c=>{const d=o.name,l=c.target?.result??void 0;if(typeof d!="string"||typeof l>"u"){r.complete(void 0);return}r.complete({resource:R.from({scheme:ae.untitled,path:d}),contents:typeof l=="string"?Re.fromString(l):Re.wrap(new Uint8Array(l))})},a.readAsArrayBuffer(o)}}return Vt(await Promise.all(i.map(n=>n.p)))}function Eo(s,...e){if(!s.dataTransfer)return!1;const t=s.dataTransfer.types,i=[];for(let n=0;n<t.length;n++)i.push(t[n].toLowerCase());for(const n of e)if(i.indexOf(n.toLowerCase())>=0)return!0;return!1}class sPe{constructor(){this._contributions=new Map}register(e){if(this._contributions.has(e.dataFormatKey))throw new Error(`A drag and drop contributiont with key '${e.dataFormatKey}' was already registered.`);this._contributions.set(e.dataFormatKey,e)}getAll(){return this._contributions.values()}}const MK={DragAndDropContribution:"workbench.contributions.dragAndDrop"};Ge.add(MK.DragAndDropContribution,new sPe);class Wu{static{this.INSTANCE=new Wu}constructor(){}static getInstance(){return Wu.INSTANCE}hasData(e){return e&&e===this.proto}clearData(e){this.hasData(e)&&(this.proto=void 0,this.data=void 0)}getData(e){if(this.hasData(e))return this.data}setData(e,t){t&&(this.data=e,this.proto=t)}}function oPe(s,e,t){s.dataTransfer?.setData(e,JSON.stringify(t))}function NK(s,e,t){const i=s.dataTransfer?.getData(e);if(i)try{return JSON.parse(i)}catch{}return t}function rPe(s){return NK(s,io.SYMBOLS,[])}function sde(s,e){oPe(e,io.SYMBOLS,s)}function aPe(s){return NK(s,io.MARKERS,void 0)}function cPe(s){return NK(s,io.NOTEBOOK_CELL_OUTPUT,void 0)}function dv(s){if(ra&&typeof globalThis.vscode?.webUtils?.getPathForFile=="function")return globalThis.vscode.webUtils.getPathForFile(s)}function ode(s){const e=new yO;for(const t of s.items){const i=t.type;if(t.kind==="string"){const n=new Promise(o=>t.getAsString(o));e.append(i,ZI(n))}else if(t.kind==="file"){const n=t.getAsFile();n&&e.append(i,dPe(n))}}return e}function dPe(s){const e=dv(s),t=e?R.parse(e):void 0;return tTe(s.name,t,async()=>new Uint8Array(await s.arrayBuffer()))}const lPe=Object.freeze([io.EDITORS,io.FILES,bs.RESOURCES,bs.INTERNAL_URI_LIST]);function rde(s,e=!1){const t=ode(s),i=t.get(bs.INTERNAL_URI_LIST);if(i)t.replace(Ii.uriList,i);else if(e||!t.has(Ii.uriList)){const n=[];for(const o of s.items){const r=o.getAsFile();if(r){const a=dv(r);try{a?n.push(R.file(a).toString()):n.push(R.parse(r.name,!0).toString())}catch{}}}n.length&&t.replace(Ii.uriList,ZI(ml.create(n)))}for(const n of lPe)t.delete(n);return t}const hPe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(hPe);const uPe=Yt.register({description:"inline-progress-widget",stickiness:Di.NeverGrowsWhenTypingAtEdges,showIfCollapsed:!0,after:{content:ine,inlineClassName:"inline-editor-progress-decoration",inlineClassNameAffectsLetterSpacing:!0}});class OK extends F{static{this.baseId="editor.widget.inlineProgressWidget"}constructor(e,t,i,n,o){super(),this.typeId=e,this.editor=t,this.range=i,this.delegate=o,this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this.create(n),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this)}create(e){this.domNode=Y(".inline-progress-widget"),this.domNode.role="button",this.domNode.title=e;const t=Y("span.icon");this.domNode.append(t),t.classList.add(...Te.asClassNameArray(j.loading),"codicon-modifier-spin");const i=()=>{const n=this.editor.getOption(L.lineHeight);this.domNode.style.height=`${n}px`,this.domNode.style.width=`${Math.ceil(.8*n)}px`};i(),this._register(this.editor.onDidChangeConfiguration(n=>{(n.hasChanged(L.fontSize)||n.hasChanged(L.lineHeight))&&i()})),this._register(re(this.domNode,pe.CLICK,n=>{this.delegate.cancel()}))}getId(){return OK.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:{lineNumber:this.range.startLineNumber,column:this.range.startColumn},preference:[Oi.EXACT]}}dispose(){super.dispose(),this.editor.removeContentWidget(this)}}let VR=class extends F{constructor(e,t,i){super(),this.id=e,this._editor=t,this._instantiationService=i,this._showDelay=500,this._showPromise=this._register(new kt),this._currentWidget=this._register(new kt),this._operationIdPool=0,this._currentDecorations=t.createDecorationsCollection()}dispose(){super.dispose(),this._currentDecorations.clear()}async showWhile(e,t,i,n,o){const r=this._operationIdPool++;this._currentOperation=r,this.clear(),this._showPromise.value=Hm(()=>{const a=P.fromPositions(e);this._currentDecorations.set([{range:a,options:uPe}]).length>0&&(this._currentWidget.value=this._instantiationService.createInstance(OK,this.id,this._editor,a,t,n))},o??this._showDelay);try{return await i}finally{this._currentOperation===r&&(this.clear(),this._currentOperation=void 0)}}clear(){this._showPromise.clear(),this._currentDecorations.clear(),this._currentWidget.clear()}};VR=f([p(2,J)],VR);class FK{constructor(e){this.copyMimeTypes=[],this.kind=e,this.providedDropEditKinds=[this.kind],this.providedPasteEditKinds=[this.kind]}async provideDocumentPasteEdits(e,t,i,n,o){const r=await this.getEdit(i,o);if(r)return{edits:[{insertText:r.insertText,title:r.title,kind:r.kind,handledMimeType:r.handledMimeType,yieldTo:r.yieldTo}],dispose(){}}}async provideDocumentDropEdits(e,t,i,n){const o=await this.getEdit(i,n);if(o)return{edits:[{insertText:o.insertText,title:o.title,kind:o.kind,handledMimeType:o.handledMimeType,yieldTo:o.yieldTo}],dispose(){}}}}class lv extends FK{static{this.id="text"}constructor(){super(Zt.Empty.append("text","plain")),this.id=lv.id,this.dropMimeTypes=[Ii.text],this.pasteMimeTypes=[Ii.text]}async getEdit(e,t){const i=e.get(Ii.text);if(!i||e.has(Ii.uriList))return;const n=await i.asString();return{handledMimeType:Ii.text,title:h(992,"Insert Plain Text"),insertText:n,kind:this.kind}}}class ade extends FK{constructor(){super(Zt.Empty.append("uri","path","absolute")),this.dropMimeTypes=[Ii.uriList],this.pasteMimeTypes=[Ii.uriList]}async getEdit(e,t){const i=await cde(e);if(!i.length||t.isCancellationRequested)return;let n=0;const o=i.map(({uri:a,originalText:c})=>a.scheme===ae.file?a.fsPath:(n++,c)).join(" ");let r;return n>0?r=i.length>1?h(993,"Insert Uris"):h(994,"Insert Uri"):r=i.length>1?h(995,"Insert Paths"):h(996,"Insert Path"),{handledMimeType:Ii.uriList,insertText:o,title:r,kind:this.kind}}}let HR=class extends FK{constructor(e){super(Zt.Empty.append("uri","path","relative")),this._workspaceContextService=e,this.dropMimeTypes=[Ii.uriList],this.pasteMimeTypes=[Ii.uriList]}async getEdit(e,t){const i=await cde(e);if(!i.length||t.isCancellationRequested)return;const n=Vt(i.map(({uri:o})=>{const r=this._workspaceContextService.getWorkspaceFolder(o);return r?Qu(r.uri,o):void 0}));if(n.length)return{handledMimeType:Ii.uriList,insertText:n.join(" "),title:i.length>1?h(997,"Insert Relative Paths"):h(998,"Insert Relative Path"),kind:this.kind}}};HR=f([p(0,Tt)],HR);class gPe{constructor(){this.kind=new Zt("html"),this.providedPasteEditKinds=[this.kind],this.copyMimeTypes=[],this.pasteMimeTypes=["text/html"],this._yieldTo=[{mimeType:Ii.text}]}async provideDocumentPasteEdits(e,t,i,n,o){if(n.triggerKind!==DF.PasteAs&&!n.only?.contains(this.kind))return;const a=await i.get("text/html")?.asString();if(!(!a||o.isCancellationRequested))return{dispose(){},edits:[{insertText:a,yieldTo:this._yieldTo,title:h(999,"Insert HTML"),kind:this.kind}]}}}async function cde(s){const e=s.get(Ii.uriList);if(!e)return[];const t=await e.asString(),i=[];for(const n of ml.parse(t))try{i.push({uri:R.parse(n),originalText:n})}catch{}return i}const gm={scheme:"*",hasAccessToAllModels:!0};let qV=class extends F{constructor(e,t){super(),this._register(e.documentDropEditProvider.register(gm,new lv)),this._register(e.documentDropEditProvider.register(gm,new ade)),this._register(e.documentDropEditProvider.register(gm,new HR(t)))}};qV=f([p(0,Ne),p(1,Tt)],qV);let zV=class extends F{constructor(e,t){super(),this._register(e.documentPasteEditProvider.register(gm,new lv)),this._register(e.documentPasteEditProvider.register(gm,new ade)),this._register(e.documentPasteEditProvider.register(gm,new HR(t))),this._register(e.documentPasteEditProvider.register(gm,new gPe))}};zV=f([p(0,Ne),p(1,Tt)],zV);var We;(function(s){s[s.Dollar=0]="Dollar",s[s.Colon=1]="Colon",s[s.Comma=2]="Comma",s[s.CurlyOpen=3]="CurlyOpen",s[s.CurlyClose=4]="CurlyClose",s[s.Backslash=5]="Backslash",s[s.Forwardslash=6]="Forwardslash",s[s.Pipe=7]="Pipe",s[s.Int=8]="Int",s[s.VariableName=9]="VariableName",s[s.Format=10]="Format",s[s.Plus=11]="Plus",s[s.Dash=12]="Dash",s[s.QuestionMark=13]="QuestionMark",s[s.EOF=14]="EOF"})(We||(We={}));class Wd{constructor(){this.value="",this.pos=0}static{this._table={[st.DollarSign]:We.Dollar,[st.Colon]:We.Colon,[st.Comma]:We.Comma,[st.OpenCurlyBrace]:We.CurlyOpen,[st.CloseCurlyBrace]:We.CurlyClose,[st.Backslash]:We.Backslash,[st.Slash]:We.Forwardslash,[st.Pipe]:We.Pipe,[st.Plus]:We.Plus,[st.Dash]:We.Dash,[st.QuestionMark]:We.QuestionMark}}static isDigitCharacter(e){return e>=st.Digit0&&e<=st.Digit9}static isVariableCharacter(e){return e===st.Underline||e>=st.a&&e<=st.z||e>=st.A&&e<=st.Z}text(e){this.value=e,this.pos=0}tokenText(e){return this.value.substr(e.pos,e.len)}next(){if(this.pos>=this.value.length)return{type:We.EOF,pos:this.pos,len:0};const e=this.pos;let t=0,i=this.value.charCodeAt(e),n;if(n=Wd._table[i],typeof n=="number")return this.pos+=1,{type:n,pos:e,len:1};if(Wd.isDigitCharacter(i)){n=We.Int;do t+=1,i=this.value.charCodeAt(e+t);while(Wd.isDigitCharacter(i));return this.pos+=t,{type:n,pos:e,len:t}}if(Wd.isVariableCharacter(i)){n=We.VariableName;do i=this.value.charCodeAt(e+ ++t);while(Wd.isVariableCharacter(i)||Wd.isDigitCharacter(i));return this.pos+=t,{type:n,pos:e,len:t}}n=We.Format;do t+=1,i=this.value.charCodeAt(e+t);while(!isNaN(i)&&typeof Wd._table[i]>"u"&&!Wd.isDigitCharacter(i)&&!Wd.isVariableCharacter(i));return this.pos+=t,{type:n,pos:e,len:t}}}class Gw{constructor(){this._children=[]}appendChild(e){return e instanceof pr&&this._children[this._children.length-1]instanceof pr?this._children[this._children.length-1].value+=e.value:(e.parent=this,this._children.push(e)),this}replace(e,t){const{parent:i}=e,n=i.children.indexOf(e),o=i.children.slice(0);o.splice(n,1,...t),i._children=o,function r(a,c){for(const d of a)d.parent=c,r(d.children,d)}(t,i)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let e=this;for(;;){if(!e)return;if(e instanceof JI)return e;e=e.parent}}toString(){return this.children.reduce((e,t)=>e+t.toString(),"")}len(){return 0}}let pr=class KV extends Gw{static escape(e){return e.replace(/\$|}|\\/g,"\\$&")}constructor(e){super(),this.value=e}toString(){return this.value}toTextmateString(){return KV.escape(this.value)}len(){return this.value.length}clone(){return new KV(this.value)}};class dde extends Gw{}class Xr extends dde{static compareByIndex(e,t){return e.index===t.index?0:e.isFinalTabstop?1:t.isFinalTabstop||e.index<t.index?-1:e.index>t.index?1:0}constructor(e){super(),this.index=e}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof qw?this._children[0]:void 0}toTextmateString(){let e="";return this.transform&&(e=this.transform.toTextmateString()),this.children.length===0&&!this.transform?`$${this.index}`:this.children.length===0?`\${${this.index}${e}}`:this.choice?`\${${this.index}|${this.choice.toTextmateString()}|${e}}`:`\${${this.index}:${this.children.map(t=>t.toTextmateString()).join("")}${e}}`}clone(){const e=new Xr(this.index);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}class qw extends Gw{constructor(){super(...arguments),this.options=[]}appendChild(e){return e instanceof pr&&(e.parent=this,this.options.push(e)),this}toString(){return this.options[0].value}toTextmateString(){return this.options.map(e=>e.value.replace(/\||,|\\/g,"\\$&")).join(",")}len(){return this.options[0].len()}clone(){const e=new qw;return this.options.forEach(e.appendChild,e),e}}class WK extends Gw{constructor(){super(...arguments),this.regexp=new RegExp("")}resolve(e){const t=this;let i=!1,n=e.replace(this.regexp,function(){return i=!0,t._replace(Array.prototype.slice.call(arguments,0,-2))});return!i&&this._children.some(o=>o instanceof zd&&!!o.elseValue)&&(n=this._replace([])),n}_replace(e){let t="";for(const i of this._children)if(i instanceof zd){let n=e[i.index]||"";n=i.resolve(n),t+=n}else t+=i.toString();return t}toString(){return""}toTextmateString(){return`/${this.regexp.source}/${this.children.map(e=>e.toTextmateString())}/${(this.regexp.ignoreCase?"i":"")+(this.regexp.global?"g":"")}`}clone(){const e=new WK;return e.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?"i":"")+(this.regexp.global?"g":"")),e._children=this.children.map(t=>t.clone()),e}}class zd extends Gw{constructor(e,t,i,n){super(),this.index=e,this.shorthandName=t,this.ifValue=i,this.elseValue=n}resolve(e){return this.shorthandName==="upcase"?e?e.toLocaleUpperCase():"":this.shorthandName==="downcase"?e?e.toLocaleLowerCase():"":this.shorthandName==="capitalize"?e?e[0].toLocaleUpperCase()+e.substr(1):"":this.shorthandName==="pascalcase"?e?this._toPascalCase(e):"":this.shorthandName==="camelcase"?e?this._toCamelCase(e):"":e&&typeof this.ifValue=="string"?this.ifValue:!e&&typeof this.elseValue=="string"?this.elseValue:e||""}_toPascalCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map(i=>i.charAt(0).toUpperCase()+i.substr(1)).join(""):e}_toCamelCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map((i,n)=>n===0?i.charAt(0).toLowerCase()+i.substr(1):i.charAt(0).toUpperCase()+i.substr(1)).join(""):e}toTextmateString(){let e="${";return e+=this.index,this.shorthandName?e+=`:/${this.shorthandName}`:this.ifValue&&this.elseValue?e+=`:?${this.ifValue}:${this.elseValue}`:this.ifValue?e+=`:+${this.ifValue}`:this.elseValue&&(e+=`:-${this.elseValue}`),e+="}",e}clone(){return new zd(this.index,this.shorthandName,this.ifValue,this.elseValue)}}class Wy extends dde{constructor(e){super(),this.name=e}resolve(e){let t=e.resolve(this);return this.transform&&(t=this.transform.resolve(t||"")),t!==void 0?(this._children=[new pr(t)],!0):!1}toTextmateString(){let e="";return this.transform&&(e=this.transform.toTextmateString()),this.children.length===0?`\${${this.name}${e}}`:`\${${this.name}:${this.children.map(t=>t.toTextmateString()).join("")}${e}}`}clone(){const e=new Wy(this.name);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}function vX(s,e){const t=[...s];for(;t.length>0;){const i=t.shift();if(!e(i))break;t.unshift(...i.children)}}class JI extends Gw{get placeholderInfo(){if(!this._placeholders){const e=[];let t;this.walk(function(i){return i instanceof Xr&&(e.push(i),t=!t||t.index<i.index?i:t),!0}),this._placeholders={all:e,last:t}}return this._placeholders}get placeholders(){const{all:e}=this.placeholderInfo;return e}offset(e){let t=0,i=!1;return this.walk(n=>n===e?(i=!0,!1):(t+=n.len(),!0)),i?t:-1}fullLen(e){let t=0;return vX([e],i=>(t+=i.len(),!0)),t}enclosingPlaceholders(e){const t=[];let{parent:i}=e;for(;i;)i instanceof Xr&&t.push(i),i=i.parent;return t}resolveVariables(e){return this.walk(t=>(t instanceof Wy&&t.resolve(e)&&(this._placeholders=void 0),!0)),this}appendChild(e){return this._placeholders=void 0,super.appendChild(e)}replace(e,t){return this._placeholders=void 0,super.replace(e,t)}toTextmateString(){return this.children.reduce((e,t)=>e+t.toTextmateString(),"")}clone(){const e=new JI;return this._children=this.children.map(t=>t.clone()),e}walk(e){vX(this.children,e)}}class fd{constructor(){this._scanner=new Wd,this._token={type:We.EOF,pos:0,len:0}}static escape(e){return e.replace(/\$|}|\\/g,"\\$&")}static asInsertText(e){return new fd().parse(e).toString()}static guessNeedsClipboard(e){return/\${?CLIPBOARD/.test(e)}parse(e,t,i){const n=new JI;return this.parseFragment(e,n),this.ensureFinalTabstop(n,i??!1,t??!1),n}parseFragment(e,t){const i=t.children.length;for(this._scanner.text(e),this._token=this._scanner.next();this._parse(t););const n=new Map,o=[];t.walk(c=>(c instanceof Xr&&(c.isFinalTabstop?n.set(0,void 0):!n.has(c.index)&&c.children.length>0?n.set(c.index,c.children):o.push(c)),!0));const r=(c,d)=>{const l=n.get(c.index);if(!l)return;const u=new Xr(c.index);u.transform=c.transform;for(const g of l){const m=g.clone();u.appendChild(m),m instanceof Xr&&n.has(m.index)&&!d.has(m.index)&&(d.add(m.index),r(m,d),d.delete(m.index))}t.replace(c,[u])},a=new Set;for(const c of o)r(c,a);return t.children.slice(i)}ensureFinalTabstop(e,t,i){(t||i&&e.placeholders.length>0)&&(e.placeholders.find(o=>o.index===0)||e.appendChild(new Xr(0)))}_accept(e,t){if(e===void 0||this._token.type===e){const i=t?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),i}return!1}_backTo(e){return this._scanner.pos=e.pos+e.len,this._token=e,!1}_until(e){const t=this._token;for(;this._token.type!==e;){if(this._token.type===We.EOF)return!1;if(this._token.type===We.Backslash){const n=this._scanner.next();if(n.type!==We.Dollar&&n.type!==We.CurlyClose&&n.type!==We.Backslash)return!1}this._token=this._scanner.next()}const i=this._scanner.value.substring(t.pos,this._token.pos).replace(/\\(\$|}|\\)/g,"$1");return this._token=this._scanner.next(),i}_parse(e){return this._parseEscaped(e)||this._parseTabstopOrVariableName(e)||this._parseComplexPlaceholder(e)||this._parseComplexVariable(e)||this._parseAnything(e)}_parseEscaped(e){let t;return(t=this._accept(We.Backslash,!0))?(t=this._accept(We.Dollar,!0)||this._accept(We.CurlyClose,!0)||this._accept(We.Backslash,!0)||t,e.appendChild(new pr(t)),!0):!1}_parseTabstopOrVariableName(e){let t;const i=this._token;return this._accept(We.Dollar)&&(t=this._accept(We.VariableName,!0)||this._accept(We.Int,!0))?(e.appendChild(/^\d+$/.test(t)?new Xr(Number(t)):new Wy(t)),!0):this._backTo(i)}_parseComplexPlaceholder(e){let t;const i=this._token;if(!(this._accept(We.Dollar)&&this._accept(We.CurlyOpen)&&(t=this._accept(We.Int,!0))))return this._backTo(i);const o=new Xr(Number(t));if(this._accept(We.Colon))for(;;){if(this._accept(We.CurlyClose))return e.appendChild(o),!0;if(!this._parse(o))return e.appendChild(new pr("${"+t+":")),o.children.forEach(e.appendChild,e),!0}else if(o.index>0&&this._accept(We.Pipe)){const r=new qw;for(;;){if(this._parseChoiceElement(r)){if(this._accept(We.Comma))continue;if(this._accept(We.Pipe)&&(o.appendChild(r),this._accept(We.CurlyClose)))return e.appendChild(o),!0}return this._backTo(i),!1}}else return this._accept(We.Forwardslash)?this._parseTransform(o)?(e.appendChild(o),!0):(this._backTo(i),!1):this._accept(We.CurlyClose)?(e.appendChild(o),!0):this._backTo(i)}_parseChoiceElement(e){const t=this._token,i=[];for(;!(this._token.type===We.Comma||this._token.type===We.Pipe);){let n;if((n=this._accept(We.Backslash,!0))?n=this._accept(We.Comma,!0)||this._accept(We.Pipe,!0)||this._accept(We.Backslash,!0)||n:n=this._accept(void 0,!0),!n)return this._backTo(t),!1;i.push(n)}return i.length===0?(this._backTo(t),!1):(e.appendChild(new pr(i.join(""))),!0)}_parseComplexVariable(e){let t;const i=this._token;if(!(this._accept(We.Dollar)&&this._accept(We.CurlyOpen)&&(t=this._accept(We.VariableName,!0))))return this._backTo(i);const o=new Wy(t);if(this._accept(We.Colon))for(;;){if(this._accept(We.CurlyClose))return e.appendChild(o),!0;if(!this._parse(o))return e.appendChild(new pr("${"+t+":")),o.children.forEach(e.appendChild,e),!0}else return this._accept(We.Forwardslash)?this._parseTransform(o)?(e.appendChild(o),!0):(this._backTo(i),!1):this._accept(We.CurlyClose)?(e.appendChild(o),!0):this._backTo(i)}_parseTransform(e){const t=new WK;let i="",n="";for(;!this._accept(We.Forwardslash);){let o;if(o=this._accept(We.Backslash,!0)){o=this._accept(We.Forwardslash,!0)||o,i+=o;continue}if(this._token.type!==We.EOF){i+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(We.Forwardslash);){let o;if(o=this._accept(We.Backslash,!0)){o=this._accept(We.Backslash,!0)||this._accept(We.Forwardslash,!0)||o,t.appendChild(new pr(o));continue}if(!(this._parseFormatString(t)||this._parseAnything(t)))return!1}for(;!this._accept(We.CurlyClose);){if(this._token.type!==We.EOF){n+=this._accept(void 0,!0);continue}return!1}try{t.regexp=new RegExp(i,n)}catch{return!1}return e.transform=t,!0}_parseFormatString(e){const t=this._token;if(!this._accept(We.Dollar))return!1;let i=!1;this._accept(We.CurlyOpen)&&(i=!0);const n=this._accept(We.Int,!0);if(n)if(i){if(this._accept(We.CurlyClose))return e.appendChild(new zd(Number(n))),!0;if(!this._accept(We.Colon))return this._backTo(t),!1}else return e.appendChild(new zd(Number(n))),!0;else return this._backTo(t),!1;if(this._accept(We.Forwardslash)){const o=this._accept(We.VariableName,!0);return!o||!this._accept(We.CurlyClose)?(this._backTo(t),!1):(e.appendChild(new zd(Number(n),o)),!0)}else if(this._accept(We.Plus)){const o=this._until(We.CurlyClose);if(o)return e.appendChild(new zd(Number(n),void 0,o,void 0)),!0}else if(this._accept(We.Dash)){const o=this._until(We.CurlyClose);if(o)return e.appendChild(new zd(Number(n),void 0,void 0,o)),!0}else if(this._accept(We.QuestionMark)){const o=this._until(We.Colon);if(o){const r=this._until(We.CurlyClose);if(r)return e.appendChild(new zd(Number(n),void 0,o,r)),!0}}else{const o=this._until(We.CurlyClose);if(o)return e.appendChild(new zd(Number(n),void 0,void 0,o)),!0}return this._backTo(t),!1}_parseAnything(e){return this._token.type!==We.EOF?(e.appendChild(new pr(this._scanner.tokenText(this._token))),this._accept(void 0),!0):!1}}function lde(s,e,t){return(typeof t.insertText=="string"?t.insertText==="":t.insertText.snippet==="")?{edits:t.additionalEdit?.edits??[]}:{edits:[...e.map(i=>new Jie(s,{range:i,text:typeof t.insertText=="string"?fd.escape(t.insertText)+"$0":t.insertText.snippet,insertAsSnippet:!0})),...t.additionalEdit?.edits??[]]}}function hde(s){function e(r,a){return"mimeType"in r?r.mimeType===a.handledMimeType:!!a.kind&&r.kind.contains(a.kind)}const t=new Map;for(const r of s)for(const a of r.yieldTo??[])for(const c of s)if(c!==r&&e(a,c)){let d=t.get(r);d||(d=[],t.set(r,d)),d.push(c)}if(!t.size)return Array.from(s);const i=new Set,n=[];function o(r){if(!r.length)return[];const a=r[0];if(n.includes(a))return console.warn("Yield to cycle detected",a),r;if(i.has(a))return o(r.slice(1));let c=[];const d=t.get(a);return d&&(n.push(a),c=o(d),n.pop()),i.add(a),[...c,a,...o(r.slice(1))]}return o(Array.from(s))}const pPe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var jV;Be(pPe);let YV=class extends F{static{jV=this}static{this.baseId="editor.widget.postEditWidget"}constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.typeId=e,this.editor=t,this.showCommand=n,this.range=o,this.edits=r,this.onSelectNewEdit=a,this.additionalActions=c,this._keybindingService=l,this._actionWidgetService=u,this.allowEditorOverflow=!0,this.suppressMouseDown=!0,this.create(),this.visibleContext=i.bindTo(d),this.visibleContext.set(!0),this._register(Ee(()=>this.visibleContext.reset())),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this),this._register(Ee(()=>this.editor.removeContentWidget(this))),this._register(this.editor.onDidChangeCursorPosition(g=>{this.dispose()})),this._register(D.runAndSubscribe(l.onDidUpdateKeybindings,()=>{this._updateButtonTitle()}))}_updateButtonTitle(){const e=this._keybindingService.lookupKeybinding(this.showCommand.id)?.getLabel();this.button.element.title=this.showCommand.label+(e?` (${e})`:"")}create(){this.domNode=Y(".post-edit-widget"),this.button=this._register(new Xu(this.domNode,{supportIcons:!0})),this.button.label="$(insert)",this._register(re(this.domNode,pe.CLICK,()=>this.showSelector()))}getId(){return jV.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:this.range.getEndPosition(),preference:[Oi.BELOW]}}showSelector(){const e=Ms(this.button.element),t={x:e.left+e.width,y:e.top+e.height};this._actionWidgetService.show("postEditWidget",!1,this.edits.allEdits.map((i,n)=>({kind:Uo.Action,item:i,label:i.title,disabled:!1,canPreview:!1,group:{title:"",icon:Te.fromId(n===this.edits.activeEditIndex?j.check.id:j.blank.id)}})),{onHide:()=>{this.editor.focus()},onSelect:i=>{this._actionWidgetService.hide(!1);const n=this.edits.allEdits.findIndex(o=>o===i);if(n!==this.edits.activeEditIndex)return this.onSelectNewEdit(n)}},t,this.editor.getDomNode()??void 0,this.additionalActions)}};YV=jV=f([p(8,me),p(9,Ve),p(10,Ed)],YV);let UR=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this._id=e,this._editor=t,this._visibleContext=i,this._showCommand=n,this._getAdditionalActions=o,this._instantiationService=r,this._bulkEditService=a,this._notificationService=c,this._currentWidget=this._register(new kt),this._register(D.any(t.onDidChangeModel,t.onDidChangeModelContent)(()=>this.clear()))}async applyEditAndShowIfNeeded(e,t,i,n,o){if(!e.length||!this._editor.hasModel())return;const r=this._editor.getModel(),a=t.allEdits.at(t.activeEditIndex);if(!a)return;const c=async C=>{const T=this._editor.getModel();T&&(await T.undo(),this.applyEditAndShowIfNeeded(e,{activeEditIndex:C,allEdits:t.allEdits},i,n,o))},d=(C,T)=>{gs(C)||(this._notificationService.error(T),i&&this.show(e[0],t,c))},l=new Xm(this._editor,ds.Value|ds.Selection,void 0,o);let u;try{u=await KM(n(a,l.token),l.token)}catch(C){return d(C,h(1003,`Error resolving edit '{0}':
{1}`,a.title,ho(C)))}finally{l.dispose()}if(o.isCancellationRequested)return;const g=lde(r.uri,e,u),m=e[0],v=r.deltaDecorations([],[{range:m,options:{description:"paste-line-suffix",stickiness:Di.AlwaysGrowsWhenTypingAtEdges}}]);this._editor.focus();let y,w;try{y=await this._bulkEditService.apply(g,{editor:this._editor,token:o}),w=r.getDecorationRange(v[0])}catch(C){return d(C,h(1004,`Error applying edit '{0}':
{1}`,a.title,ho(C)))}finally{r.deltaDecorations(v,[])}o.isCancellationRequested||i&&y.isApplied&&t.allEdits.length>1&&this.show(w??m,t,c)}show(e,t,i){this.clear(),this._editor.hasModel()&&(this._currentWidget.value=this._instantiationService.createInstance(YV,this._id,this._editor,this._visibleContext,this._showCommand,e,t,i,this._getAdditionalActions()))}clear(){this._currentWidget.clear()}tryShowSelector(){this._currentWidget.value?.showSelector()}};UR=f([p(5,J),p(6,gw),p(7,At)],UR);var Fa;const ude="editor.changePasteType",fPe="editor.pasteAs.preferences",BK=new O("pasteWidgetVisible",!1,h(983,"Whether the paste widget is showing")),I0="application/vnd.code.copymetadata";let md=class extends F{static{Fa=this}static{this.ID="editor.contrib.copyPasteActionController"}static get(e){return e.getContribution(Fa.ID)}static setConfigureDefaultAction(e){Fa._configureDefaultAction=e}constructor(e,t,i,n,o,r,a,c,d){super(),this._bulkEditService=i,this._clipboardService=n,this._commandService=o,this._configService=r,this._languageFeaturesService=a,this._quickInputService=c,this._progressService=d,this._editor=e;const l=e.getContainerDomNode();this._register(re(l,"copy",u=>this.handleCopy(u))),this._register(re(l,"cut",u=>this.handleCopy(u))),this._register(re(l,"paste",u=>this.handlePaste(u),!0)),this._pasteProgressManager=this._register(new VR("pasteIntoEditor",e,t)),this._postPasteWidgetManager=this._register(t.createInstance(UR,"pasteIntoEditor",e,BK,{id:ude,label:h(984,"Show paste options...")},()=>Fa._configureDefaultAction?[Fa._configureDefaultAction]:[]))}changePasteType(){this._postPasteWidgetManager.tryShowSelector()}async pasteAs(e){this._editor.focus();try{this._pasteAsActionContext={preferred:e},await this._commandService.executeCommand("editor.action.clipboardPasteAction")}finally{this._pasteAsActionContext=void 0}}clearWidgets(){this._postPasteWidgetManager.clear()}isPasteAsEnabled(){return this._editor.getOption(L.pasteAs).enabled}async finishedPaste(){await this._currentPasteOperation}handleCopy(e){if(!this._editor.hasTextFocus()||(this._clipboardService.clearInternalState?.(),!e.clipboardData||!this.isPasteAsEnabled()))return;const t=this._editor.getModel(),i=this._editor.getSelections();if(!t||!i?.length)return;const n=this._editor.getOption(L.emptySelectionClipboard);let o=i;const r=i.length===1&&i[0].isEmpty();if(r){if(!n)return;o=[new P(o[0].startLineNumber,1,o[0].startLineNumber,1+t.getLineLength(o[0].startLineNumber))]}const a=this._editor._getViewModel()?.getPlainTextToCopy(i,n,pn),d={multicursorText:Array.isArray(a)?a:null,pasteOnNewLine:r,mode:null},l=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(y=>!!y.prepareDocumentPaste);if(!l.length){this.setCopyMetadata(e.clipboardData,{defaultPastePayload:d});return}const u=ode(e.clipboardData),g=l.flatMap(y=>y.copyMimeTypes??[]),m=Dn();this.setCopyMetadata(e.clipboardData,{id:m,providerCopyMimeTypes:g,defaultPastePayload:d});const v=l.map(y=>({providerMimeTypes:y.copyMimeTypes,operation:En(w=>y.prepareDocumentPaste(t,o,u,w).catch(C=>{console.error(C)}))}));Fa._currentCopyOperation?.operations.forEach(y=>y.operation.cancel()),Fa._currentCopyOperation={handle:m,operations:v}}async handlePaste(e){if(!e.clipboardData||!this._editor.hasTextFocus())return;wr.get(this._editor)?.closeMessage(),this._currentPasteOperation?.cancel(),this._currentPasteOperation=void 0;const t=this._editor.getModel(),i=this._editor.getSelections();if(!i?.length||!t||this._editor.getOption(L.readOnly)||!this.isPasteAsEnabled()&&!this._pasteAsActionContext)return;const n=this.fetchCopyMetadata(e),o=rde(e.clipboardData);o.delete(I0);const r=Array.from(e.clipboardData.files).map(d=>d.type),a=[...e.clipboardData.types,...r,...n?.providerCopyMimeTypes??[],Ii.uriList],c=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(d=>{const l=this._pasteAsActionContext?.preferred;return l&&!this.providerMatchesPreference(d,l)?!1:d.pasteMimeTypes?.some(u=>xj(u,a))});if(!c.length){this._pasteAsActionContext?.preferred&&(this.showPasteAsNoEditMessage(i,this._pasteAsActionContext.preferred),e.preventDefault(),e.stopImmediatePropagation());return}e.preventDefault(),e.stopImmediatePropagation(),this._pasteAsActionContext?this.showPasteAsPick(this._pasteAsActionContext.preferred,c,i,o,n):this.doPasteInline(c,i,o,n,e)}showPasteAsNoEditMessage(e,t){const i="only"in t?t.only.value:"preferences"in t?t.preferences.length?t.preferences.map(n=>n.value).join(", "):h(985,"empty"):t.providerId;wr.get(this._editor)?.showMessage(h(986,"No paste edits for '{0}' found",i),e[0].getStartPosition())}doPasteInline(e,t,i,n,o){const r=this._editor;if(!r.hasModel())return;const a=new Xm(r,ds.Value|ds.Selection,void 0),c=En(async d=>{const l=this._editor;if(!l.hasModel())return;const u=l.getModel(),g=new U,m=g.add(new ri(d));g.add(a.token.onCancellationRequested(()=>m.cancel()));const v=m.token;try{if(await this.mergeInDataFromCopy(e,i,n,v),v.isCancellationRequested)return;const y=e.filter(T=>this.isSupportedPasteProvider(T,i));if(!y.length||y.length===1&&y[0]instanceof lv)return this.applyDefaultPasteHandler(i,n,v,o);const w={triggerKind:DF.Automatic},C=await this.getPasteEdits(y,i,u,t,w,v);if(g.add(C),v.isCancellationRequested)return;if(C.edits.length===1&&C.edits[0].provider instanceof lv)return this.applyDefaultPasteHandler(i,n,v,o);if(C.edits.length){const T=l.getOption(L.pasteAs).showPasteSelector==="afterPaste";return this._postPasteWidgetManager.applyEditAndShowIfNeeded(t,{activeEditIndex:this.getInitialActiveEditIndex(u,C.edits),allEdits:C.edits},T,async(k,A)=>{if(!k.provider.resolveDocumentPasteEdit)return k;const B=k.provider.resolveDocumentPasteEdit(k,A),z=new Zo,Q=await this._pasteProgressManager.showWhile(t[0].getEndPosition(),h(987,"Resolving paste edit for '{0}'. Click to cancel",k.title),xh(Promise.race([z.p,B]),A),{cancel:()=>z.cancel()},0);return Q&&(k.insertText=Q.insertText,k.additionalEdit=Q.additionalEdit),k},v)}await this.applyDefaultPasteHandler(i,n,v,o)}finally{g.dispose(),this._currentPasteOperation===c&&(this._currentPasteOperation=void 0)}});this._pasteProgressManager.showWhile(t[0].getEndPosition(),h(988,"Running paste handlers. Click to cancel and do basic paste"),c,{cancel:async()=>{try{if(c.cancel(),a.token.isCancellationRequested)return;await this.applyDefaultPasteHandler(i,n,a.token,o)}finally{a.dispose()}}}).then(()=>{a.dispose()}),this._currentPasteOperation=c}showPasteAsPick(e,t,i,n,o){const r=En(async a=>{const c=this._editor;if(!c.hasModel())return;const d=c.getModel(),l=new U,u=l.add(new Xm(c,ds.Value|ds.Selection,void 0,a));try{if(await this.mergeInDataFromCopy(t,n,o,u.token),u.token.isCancellationRequested)return;let g=t.filter(C=>this.isSupportedPasteProvider(C,n,e));e&&(g=g.filter(C=>this.providerMatchesPreference(C,e)));const m={triggerKind:DF.PasteAs,only:e&&"only"in e?e.only:void 0};let v=l.add(await this.getPasteEdits(g,n,d,i,m,u.token));if(u.token.isCancellationRequested)return;if(e&&(v={edits:v.edits.filter(C=>"only"in e?e.only.contains(C.kind):"preferences"in e?e.preferences.some(T=>T.contains(C.kind)):e.providerId===C.provider.id),dispose:v.dispose}),!v.edits.length){e&&this.showPasteAsNoEditMessage(i,e);return}let y;if(e)y=v.edits.at(0);else{const C={id:"editor.pasteAs.default",label:h(989,"Configure default paste action"),edit:void 0},T=await this._quickInputService.pick([...v.edits.map(k=>({label:k.title,description:k.kind?.value,edit:k})),...Fa._configureDefaultAction?[mF({type:"separator"}),{label:Fa._configureDefaultAction.label,edit:void 0}]:[]],{placeHolder:h(990,"Select Paste Action")});if(T===C){Fa._configureDefaultAction?.run();return}y=T?.edit}if(!y)return;const w=lde(d.uri,i,y);await this._bulkEditService.apply(w,{editor:this._editor})}finally{l.dispose(),this._currentPasteOperation===r&&(this._currentPasteOperation=void 0)}});this._progressService.withProgress({location:qo.Window,title:h(991,"Running paste handlers")},()=>r)}setCopyMetadata(e,t){e.setData(I0,JSON.stringify(t))}fetchCopyMetadata(e){if(!e.clipboardData)return;const t=e.clipboardData.getData(I0);if(t)try{return JSON.parse(t)}catch{return}const[i,n]=SSe.getTextData(e.clipboardData);if(n)return{defaultPastePayload:{mode:n.mode,multicursorText:n.multicursorText??null,pasteOnNewLine:!!n.isFromEmptySelection}}}async mergeInDataFromCopy(e,t,i,n){if(i?.id&&Fa._currentCopyOperation?.handle===i.id){const o=Fa._currentCopyOperation.operations.filter(a=>e.some(c=>c.pasteMimeTypes.some(d=>xj(d,a.providerMimeTypes)))).map(a=>a.operation),r=await Promise.all(o);if(n.isCancellationRequested)return;for(const a of r.reverse())if(a)for(const[c,d]of a)t.replace(c,d)}if(!t.has(Ii.uriList)){const o=await this._clipboardService.readResources();if(n.isCancellationRequested)return;o.length&&t.append(Ii.uriList,ZI(ml.create(o)))}}async getPasteEdits(e,t,i,n,o,r){const a=new U,c=await xh(Promise.all(e.map(async l=>{try{const u=await l.provideDocumentPasteEdits?.(i,n,t,o,r);return u&&a.add(u),u?.edits?.map(g=>({...g,provider:l}))}catch(u){gs(u)||console.error(u);return}})),r),d=Vt(c??[]).flat().filter(l=>!o.only||o.only.contains(l.kind));return{edits:hde(d),dispose:()=>a.dispose()}}async applyDefaultPasteHandler(e,t,i,n){const r=await(e.get(Ii.text)??e.get("text"))?.asString()??"";if(i.isCancellationRequested)return;const a={clipboardEvent:n,text:r,pasteOnNewLine:t?.defaultPastePayload.pasteOnNewLine??!1,multicursorText:t?.defaultPastePayload.multicursorText??null,mode:null};this._editor.trigger("keyboard",bq.Paste,a)}isSupportedPasteProvider(e,t,i){return e.pasteMimeTypes?.some(n=>t.matches(n))?!i||this.providerMatchesPreference(e,i):!1}providerMatchesPreference(e,t){return"only"in t?e.providedPasteEditKinds.some(i=>t.only.contains(i)):"preferences"in t?t.preferences.some(i=>t.preferences.some(n=>n.contains(i))):e.id===t.providerId}getInitialActiveEditIndex(e,t){const i=this._configService.getValue(fPe,{resource:e.uri});for(const n of Array.isArray(i)?i:[]){const o=new Zt(n),r=t.findIndex(a=>o.contains(a.kind));if(r>=0)return r}return 0}};md=Fa=f([p(1,J),p(2,gw),p(3,Is),p(4,qe),p(5,ne),p(6,Ne),p(7,zt),p(8,bl)],md);var au;const mPe="editor.dropIntoEditor.preferences",gde="editor.changeDropType",VK=new O("dropWidgetVisible",!1,h(1e3,"Whether the drop widget is showing"));let cg=class extends F{static{au=this}static{this.ID="editor.contrib.dropIntoEditorController"}static get(e){return e.getContribution(au.ID)}static setConfigureDefaultAction(e){this._configureDefaultAction=e}constructor(e,t,i,n,o){super(),this._configService=i,this._languageFeaturesService=n,this._treeViewsDragAndDropService=o,this.treeItemsTransfer=Wu.getInstance(),this._dropProgressManager=this._register(t.createInstance(VR,"dropIntoEditor",e)),this._postDropWidgetManager=this._register(t.createInstance(UR,"dropIntoEditor",e,VK,{id:gde,label:h(1001,"Show drop options...")},()=>au._configureDefaultAction?[au._configureDefaultAction]:[])),this._register(e.onDropIntoEditor(r=>this.onDropIntoEditor(e,r.position,r.event)))}clearWidgets(){this._postDropWidgetManager.clear()}changeDropType(){this._postDropWidgetManager.tryShowSelector()}async onDropIntoEditor(e,t,i){if(!i.dataTransfer||!e.hasModel())return;au._currentDropOperation?.cancel(),e.focus(),e.setPosition(t);const n=En(async o=>{const r=new U,a=r.add(new Xm(e,ds.Value,void 0,o));try{const c=await this.extractDataTransferData(i);if(c.size===0||a.token.isCancellationRequested)return;const d=e.getModel();if(!d)return;const l=this._languageFeaturesService.documentDropEditProvider.ordered(d).filter(g=>g.dropMimeTypes?g.dropMimeTypes.some(m=>c.matches(m)):!0),u=r.add(await this.getDropEdits(l,d,t,c,a.token));if(a.token.isCancellationRequested)return;if(u.edits.length){const g=this.getInitialActiveEditIndex(d,u.edits),m=e.getOption(L.dropIntoEditor).showDropSelector==="afterDrop";await this._postDropWidgetManager.applyEditAndShowIfNeeded([P.fromPositions(t)],{activeEditIndex:g,allEdits:u.edits},m,async v=>v,o)}}finally{r.dispose(),au._currentDropOperation===n&&(au._currentDropOperation=void 0)}});this._dropProgressManager.showWhile(t,h(1002,"Running drop handlers. Click to cancel"),n,{cancel:()=>n.cancel()}),au._currentDropOperation=n}async getDropEdits(e,t,i,n,o){const r=new U,a=await xh(Promise.all(e.map(async d=>{try{const l=await d.provideDocumentDropEdits(t,i,n,o);return l&&r.add(l),l?.edits.map(u=>({...u,providerId:d.id}))}catch(l){gs(l)||console.error(l),console.error(l)}})),o),c=Vt(a??[]).flat();return{edits:hde(c),dispose:()=>r.dispose()}}getInitialActiveEditIndex(e,t){const i=this._configService.getValue(mPe,{resource:e.uri});for(const n of Array.isArray(i)?i:[]){const o=new Zt(n),r=t.findIndex(a=>a.kind&&o.contains(a.kind));if(r>=0)return r}return 0}async extractDataTransferData(e){if(!e.dataTransfer)return new yO;const t=rde(e.dataTransfer);if(this.treeItemsTransfer.hasData(uC.prototype)){const i=this.treeItemsTransfer.getData(uC.prototype);if(Array.isArray(i))for(const n of i){const o=await this._treeViewsDragAndDropService.removeDragOperationTransfer(n.identifier);if(o)for(const[r,a]of o)t.replace(r,a)}}return t}};cg=au=f([p(1,J),p(2,ne),p(3,Ne),p(4,pq)],cg);const pde="editor.action.showHover",vPe="editor.action.showDefinitionPreviewHover",_Pe="editor.action.hideHover",bPe="editor.action.scrollUpHover",yPe="editor.action.scrollDownHover",wPe="editor.action.scrollLeftHover",SPe="editor.action.scrollRightHover",CPe="editor.action.pageUpHover",EPe="editor.action.pageDownHover",xPe="editor.action.goToTopHover",IPe="editor.action.goToBottomHover",zw="editor.action.increaseHoverVerbosityLevel",DPe="editor.action.increaseHoverVerbosityLevelFromAccessibleView",kPe=h(1168,"Increase Hover Verbosity Level"),Kw="editor.action.decreaseHoverVerbosityLevel",TPe="editor.action.decreaseHoverVerbosityLevelFromAccessibleView",APe=h(1169,"Decrease Hover Verbosity Level"),lx="editor.action.inlineSuggest.commit",fde="editor.action.inlineSuggest.showPrevious",mde="editor.action.inlineSuggest.showNext",RPe="editor.action.inlineSuggest.jump",vde="editor.action.inlineSuggest.hide",QV="editor.action.inlineSuggest.toggleShowCollapsed",PPe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var GS;Be(PPe);let XV=class extends F{constructor(e,t,i){super(),this.editor=e,this.model=t,this.instantiationService=i,this.alwaysShowToolbar=On(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(L.inlineSuggest).showToolbar==="always"),this.sessionPosition=void 0,this.position=fe(this,n=>{const o=this.model.read(n)?.primaryGhostText.read(n);if(!this.alwaysShowToolbar.read(n)||!o||o.parts.length===0)return this.sessionPosition=void 0,null;const r=o.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==o.lineNumber&&(this.sessionPosition=void 0);const a=new _e(o.lineNumber,Math.min(r,this.sessionPosition?.column??Number.MAX_SAFE_INTEGER));return this.sessionPosition=a,a}),this._register(Da((n,o)=>{const r=this.model.read(n);if(!r||!this.alwaysShowToolbar.read(n))return;const a=fe(d=>{const l=d.store.add(this.instantiationService.createInstance(By.hot.read(d),this.editor,!0,this.position,r.selectedInlineCompletionIndex,r.inlineCompletionsCount,r.activeCommands,r.warning,()=>{}));return e.addContentWidget(l),d.store.add(Ee(()=>e.removeContentWidget(l))),d.store.add(ki(u=>{this.position.read(u)&&r.lastTriggerKind.read(u)!==zc.Explicit&&r.triggerExplicitly()})),l}),c=Av(this,(d,l)=>!!this.position.read(d)||!!l);o.add(ki(d=>{c.read(d)&&a.read(d)}))}))}};XV=f([p(2,J)],XV);const LPe=Ae("inline-suggestion-hints-next",j.chevronRight,h(1269,"Icon for show next parameter hint.")),MPe=Ae("inline-suggestion-hints-previous",j.chevronLeft,h(1270,"Icon for show previous parameter hint."));let By=class extends F{static{GS=this}static{this.hot=cN(GS)}static{this._dropDownVisible=!1}static get dropDownVisible(){return this._dropDownVisible}static{this.id=0}createCommandAction(e,t,i){const n=new Kt(e,t,i,!0,()=>this._commandService.executeCommand(e)),o=this.keybindingService.lookupKeybinding(e,this._contextKeyService);let r=t;return o&&(r=h(1271,"{0} ({1})",t,o.getLabel())),n.tooltip=r,n}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.editor=e,this.withBorder=t,this._position=i,this._currentSuggestionIdx=n,this._suggestionCount=o,this._extraCommands=r,this._warning=a,this._relayout=c,this._commandService=d,this.keybindingService=u,this._contextKeyService=g,this._menuService=m,this.id=`InlineSuggestionHintsContentWidget${GS.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._warningMessageContentNode=fe(v=>{const y=this._warning.read(v);return y?typeof y.message=="string"?y.message:v.store.add(lq(y.message)).element:void 0}),this._warningMessageNode=dt.div({class:"warningMessage",style:{maxWidth:400,margin:4,marginBottom:4,display:fe(v=>this._warning.read(v)?"block":"none")}},[this._warningMessageContentNode]).keepUpdated(this._store),this.nodes=rn("div.inlineSuggestionsHints",{className:this.withBorder?"monaco-hover monaco-hover-content":""},[this._warningMessageNode.element,rn("div@toolBar")]),this.previousAction=this._register(this.createCommandAction(fde,h(1272,"Previous"),Te.asClassName(MPe))),this.availableSuggestionCountAction=this._register(new Kt("inlineSuggestionHints.availableSuggestionCount","",void 0,!1)),this.nextAction=this._register(this.createCommandAction(mde,h(1273,"Next"),Te.asClassName(LPe))),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(N.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new fn(()=>{this.availableSuggestionCountAction.label=""},100)),this.disableButtonsDebounced=this._register(new fn(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this._register(ki(v=>{this._warningMessageContentNode.read(v),this._warningMessageNode.readEffect(v),this._relayout()})),this.toolBar=this._register(l.createInstance(ZV,this.nodes.toolBar,N.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:v=>v.startsWith("primary")},actionViewItemProvider:(v,y)=>{if(v instanceof va)return l.createInstance(OPe,v,void 0);if(v===this.availableSuggestionCountAction){const w=new NPe(void 0,v,{label:!0,icon:!1});return w.setClass("availableSuggestionCount"),w}},telemetrySource:"InlineSuggestionToolbar"})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(v=>{GS._dropDownVisible=v})),this._register(ki(v=>{this._position.read(v),this.editor.layoutContentWidget(this)})),this._register(ki(v=>{const y=this._suggestionCount.read(v),w=this._currentSuggestionIdx.read(v);y!==void 0?(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${w+1}/${y}`):this.clearAvailableSuggestionCountLabelDebounced.schedule(),y!==void 0&&y>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(ki(v=>{const w=this._extraCommands.read(v).map(C=>({class:void 0,id:C.id,enabled:!0,tooltip:C.tooltip||"",label:C.title,run:T=>this._commandService.executeCommand(C.id)}));for(const[C,T]of this.inlineCompletionsActionsMenus.getActions())for(const k of T)k instanceof va&&w.push(k);w.length>0&&w.unshift(new is),this.toolBar.setAdditionalSecondaryActions(w)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[Oi.ABOVE,Oi.BELOW],positionAffinity:Jx.LeftOfInjectedText}}};By=GS=f([p(8,qe),p(9,J),p(10,Ve),p(11,me),p(12,tn)],By);class NPe extends qm{constructor(){super(...arguments),this._className=void 0}setClass(e){this._className=e}render(e){super.render(e),this._className&&e.classList.add(this._className)}updateTooltip(){}}class OPe extends yq{updateLabel(){const e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService,!0);if(!e)return super.updateLabel();if(this.label){const t=rn("div.keybinding").root;this._register(new VM(t,Yu,{disableTitle:!0,...Cve})).set(e),this.label.textContent=this._action.label,this.label.appendChild(t),this.label.classList.add("inlineSuggestionStatusBarItemLabel")}}updateTooltip(){}}let ZV=class extends zq{constructor(e,t,i,n,o,r,a,c,d){super(e,{resetMenu:t,...i},n,o,r,a,c,d),this.menuId=t,this.options2=i,this.menuService=n,this.contextKeyService=o,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this.additionalPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){const{primary:e,secondary:t}=zm(this.menu.getActions(this.options2?.menuOptions),this.options2?.toolbarOptions?.primaryGroup,this.options2?.toolbarOptions?.shouldInlineSubmenu,this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions);t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),e.push(...this.additionalPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){ns(this.prependedPrimaryActions,e,(t,i)=>t===i)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalPrimaryActions(e){ns(this.additionalPrimaryActions,e,(t,i)=>t===i)||(this.additionalPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){ns(this.additionalActions,e,(t,i)=>t===i)||(this.additionalActions=e,this.updateToolbar())}};ZV=f([p(3,tn),p(4,me),p(5,mi),p(6,Ve),p(7,qe),p(8,li)],ZV);function CO(s,e,t){const i=Ms(s);return!(e<i.left||e>i.left+i.width||t<i.top||t>i.top+i.height)}var Bs;(function(s){s[s.Idle=0]="Idle",s[s.FirstWait=1]="FirstWait",s[s.SecondWait=2]="SecondWait",s[s.WaitingForAsync=3]="WaitingForAsync",s[s.WaitingForAsyncShowingLoading=4]="WaitingForAsyncShowingLoading"})(Bs||(Bs={}));var Rh;(function(s){s[s.Delayed=0]="Delayed",s[s.Immediate=1]="Immediate"})(Rh||(Rh={}));var ll;(function(s){s[s.Mouse=0]="Mouse",s[s.Click=1]="Click",s[s.Keyboard=2]="Keyboard"})(ll||(ll={}));class FPe{constructor(e,t,i,n){this.value=e,this.isComplete=t,this.hasLoadingMessage=i,this.options=n}}class _de extends F{constructor(e,t){super(),this._editor=e,this._computer=t,this._onResult=this._register(new M),this.onResult=this._onResult.event,this._asyncComputationScheduler=this._register(new D0(i=>this._triggerAsyncComputation(i),0)),this._syncComputationScheduler=this._register(new D0(i=>this._triggerSyncComputation(i),0)),this._loadingMessageScheduler=this._register(new D0(i=>this._triggerLoadingMessage(i),0)),this._state=Bs.Idle,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._options=void 0,super.dispose()}get _hoverTime(){return this._editor.getOption(L.hover).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(e,t){this._options=t,this._state=e,this._fireResult(t)}_triggerAsyncComputation(e){this._setState(Bs.SecondWait,e),this._syncComputationScheduler.schedule(e,this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=Eve(t=>this._computer.computeAsync(e,t)),(async()=>{try{for await(const t of this._asyncIterable)t&&(this._result.push(t),this._fireResult(e));this._asyncIterableDone=!0,(this._state===Bs.WaitingForAsync||this._state===Bs.WaitingForAsyncShowingLoading)&&this._setState(Bs.Idle,e)}catch(t){mt(t)}})()):this._asyncIterableDone=!0}_triggerSyncComputation(e){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync(e))),this._setState(this._asyncIterableDone?Bs.Idle:Bs.WaitingForAsync,e)}_triggerLoadingMessage(e){this._state===Bs.WaitingForAsync&&this._setState(Bs.WaitingForAsyncShowingLoading,e)}_fireResult(e){if(this._state===Bs.FirstWait||this._state===Bs.SecondWait)return;const t=this._state===Bs.Idle,i=this._state===Bs.WaitingForAsyncShowingLoading;this._onResult.fire(new FPe(this._result.slice(0),t,i,e))}start(e,t){if(e===Rh.Delayed)this._state===Bs.Idle&&(this._setState(Bs.FirstWait,t),this._asyncComputationScheduler.schedule(t,this._firstWaitTime),this._loadingMessageScheduler.schedule(t,this._loadingMessageTime));else switch(this._state){case Bs.Idle:this._triggerAsyncComputation(t),this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break;case Bs.SecondWait:this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break}}cancel(){this._asyncComputationScheduler.cancel(),this._syncComputationScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._result=[],this._options=void 0,this._state=Bs.Idle}get options(){return this._options}}class D0 extends F{constructor(e,t){super(),this._scheduler=this._register(new fn(()=>e(this._options),t))}schedule(e,t){this._options=e,this._scheduler.schedule(t)}cancel(){this._scheduler.cancel()}}var Qo;(function(s){s[s.Range=1]="Range",s[s.ForeignElement=2]="ForeignElement"})(Qo||(Qo={}));class k0{constructor(e,t,i,n){this.priority=e,this.range=t,this.initialMousePosX=i,this.initialMousePosY=n,this.type=Qo.Range}equals(e){return e.type===Qo.Range&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return e.type===Qo.Range&&t.lineNumber===this.range.startLineNumber}}class qS{constructor(e,t,i,n,o,r){this.priority=e,this.owner=t,this.range=i,this.initialMousePosX=n,this.initialMousePosY=o,this.supportsMarkerHover=r,this.type=Qo.ForeignElement}equals(e){return e.type===Qo.ForeignElement&&this.owner===e.owner}canAdoptVisibleHover(e,t){return e.type===Qo.ForeignElement&&this.owner===e.owner}}class hv{constructor(e,t){this.renderedHoverParts=e,this.disposables=t}dispose(){for(const e of this.renderedHoverParts)e.dispose();this.disposables?.dispose()}}const s_=new class{constructor(){this._participants=[]}register(e){this._participants.push(e)}getAll(){return this._participants}};class HK{constructor(){this._onDidWillResize=new M,this.onDidWillResize=this._onDidWillResize.event,this._onDidResize=new M,this.onDidResize=this._onDidResize.event,this._sashListener=new U,this._size=new Ke(0,0),this._minSize=new Ke(0,0),this._maxSize=new Ke(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.domNode=document.createElement("div"),this._eastSash=new H_(this.domNode,{getVerticalSashLeft:()=>this._size.width},{orientation:wt.VERTICAL}),this._westSash=new H_(this.domNode,{getVerticalSashLeft:()=>0},{orientation:wt.VERTICAL}),this._northSash=new H_(this.domNode,{getHorizontalSashTop:()=>0},{orientation:wt.HORIZONTAL,orthogonalEdge:S7.North}),this._southSash=new H_(this.domNode,{getHorizontalSashTop:()=>this._size.height},{orientation:wt.HORIZONTAL,orthogonalEdge:S7.South}),this._northSash.orthogonalStartSash=this._westSash,this._northSash.orthogonalEndSash=this._eastSash,this._southSash.orthogonalStartSash=this._westSash,this._southSash.orthogonalEndSash=this._eastSash;let e,t=0,i=0;this._sashListener.add(D.any(this._northSash.onDidStart,this._eastSash.onDidStart,this._southSash.onDidStart,this._westSash.onDidStart)(()=>{e===void 0&&(this._onDidWillResize.fire(),e=this._size,t=0,i=0)})),this._sashListener.add(D.any(this._northSash.onDidEnd,this._eastSash.onDidEnd,this._southSash.onDidEnd,this._westSash.onDidEnd)(()=>{e!==void 0&&(e=void 0,t=0,i=0,this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(this._eastSash.onDidChange(n=>{e&&(i=n.currentX-n.startX,this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,east:!0}))})),this._sashListener.add(this._westSash.onDidChange(n=>{e&&(i=-(n.currentX-n.startX),this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,west:!0}))})),this._sashListener.add(this._northSash.onDidChange(n=>{e&&(t=-(n.currentY-n.startY),this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,north:!0}))})),this._sashListener.add(this._southSash.onDidChange(n=>{e&&(t=n.currentY-n.startY,this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,south:!0}))})),this._sashListener.add(D.any(this._eastSash.onDidReset,this._westSash.onDidReset)(n=>{this._preferredSize&&(this.layout(this._size.height,this._preferredSize.width),this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(D.any(this._northSash.onDidReset,this._southSash.onDidReset)(n=>{this._preferredSize&&(this.layout(this._preferredSize.height,this._size.width),this._onDidResize.fire({dimension:this._size,done:!0}))}))}dispose(){this._northSash.dispose(),this._southSash.dispose(),this._eastSash.dispose(),this._westSash.dispose(),this._sashListener.dispose(),this._onDidResize.dispose(),this._onDidWillResize.dispose(),this.domNode.remove()}enableSashes(e,t,i,n){this._northSash.state=e?Vd.Enabled:Vd.Disabled,this._eastSash.state=t?Vd.Enabled:Vd.Disabled,this._southSash.state=i?Vd.Enabled:Vd.Disabled,this._westSash.state=n?Vd.Enabled:Vd.Disabled}layout(e=this.size.height,t=this.size.width){const{height:i,width:n}=this._minSize,{height:o,width:r}=this._maxSize;e=Math.max(i,Math.min(o,e)),t=Math.max(n,Math.min(r,t));const a=new Ke(t,e);Ke.equals(a,this._size)||(this.domNode.style.height=e+"px",this.domNode.style.width=t+"px",this._size=a,this._northSash.layout(),this._eastSash.layout(),this._southSash.layout(),this._westSash.layout())}clearSashHoverState(){this._eastSash.clearSashHoverState(),this._westSash.clearSashHoverState(),this._northSash.clearSashHoverState(),this._southSash.clearSashHoverState()}get size(){return this._size}set maxSize(e){this._maxSize=e}get maxSize(){return this._maxSize}set minSize(e){this._minSize=e}get minSize(){return this._minSize}set preferredSize(e){this._preferredSize=e}get preferredSize(){return this._preferredSize}}const WPe=30,BPe=24;class VPe extends F{constructor(e,t=new Ke(10,10)){super(),this._editor=e,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new HK),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position="absolute",this._resizableNode.minSize=Ke.lift(t),this._resizableNode.layout(t.height,t.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(i=>{this._resize(new Ke(i.dimension.width,i.dimension.height)),i.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){return this._contentPosition?.position?_e.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(e){const t=this._editor.getDomNode(),i=this._editor.getScrolledVisiblePosition(e);return!t||!i?void 0:Ms(t).top+i.top-WPe}_availableVerticalSpaceBelow(e){const t=this._editor.getDomNode(),i=this._editor.getScrolledVisiblePosition(e);if(!t||!i)return;const n=Ms(t),o=Zu(t.ownerDocument.body),r=n.top+i.top+i.height;return o.height-r-BPe}_findPositionPreference(e,t){const i=Math.min(this._availableVerticalSpaceBelow(t)??1/0,e),n=Math.min(this._availableVerticalSpaceAbove(t)??1/0,e),o=Math.min(Math.max(n,i),e),r=Math.min(e,o);let a;return this._editor.getOption(L.hover).above?a=r<=n?Oi.ABOVE:Oi.BELOW:a=r<=i?Oi.BELOW:Oi.ABOVE,a===Oi.ABOVE?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),a}_resize(e){this._resizableNode.layout(e.height,e.width)}}var kc;const _X=30;let JV=class extends VPe{static{kc=this}static{this.ID="editor.contrib.resizableContentHoverWidget"}static{this._lastDimensions=new Ke(0,0)}get isVisibleFromKeyboard(){return this._renderedHover?.source===ll.Keyboard}get isVisible(){return this._hoverVisibleKey.get()??!1}get isFocused(){return this._hoverFocusedKey.get()??!1}constructor(e,t,i,n,o){const r=e.getOption(L.lineHeight)+8,a=150,c=new Ke(a,r);super(e,c),this._configurationService=i,this._accessibilityService=n,this._keybindingService=o,this._hover=this._register(new nne(!0)),this._onDidResize=this._register(new M),this.onDidResize=this._onDidResize.event,this._onDidScroll=this._register(new M),this.onDidScroll=this._onDidScroll.event,this._minimumSize=c,this._hoverVisibleKey=V.hoverVisible.bindTo(t),this._hoverFocusedKey=V.hoverFocused.bindTo(t),ee(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex="50",this._resizableNode.domNode.className="monaco-resizable-hover",this._register(this._editor.onDidLayoutChange(()=>{this.isVisible&&this._updateMaxDimensions()})),this._register(this._editor.onDidChangeConfiguration(l=>{l.hasChanged(L.fontInfo)&&this._updateFont()}));const d=this._register(Po(this._resizableNode.domNode));this._register(d.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(d.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._register(this._hover.scrollbar.onScroll(l=>{this._onDidScroll.fire(l)})),this._setRenderedHover(void 0),this._editor.addContentWidget(this)}dispose(){super.dispose(),this._renderedHover?.dispose(),this._editor.removeContentWidget(this)}getId(){return kc.ID}static _applyDimensions(e,t,i){const n=typeof t=="number"?`${t}px`:t,o=typeof i=="number"?`${i}px`:i;e.style.width=n,e.style.height=o}_setContentsDomNodeDimensions(e,t){const i=this._hover.contentsDomNode;return kc._applyDimensions(i,e,t)}_setContainerDomNodeDimensions(e,t){const i=this._hover.containerDomNode;return kc._applyDimensions(i,e,t)}_setScrollableElementDimensions(e,t){const i=this._hover.scrollbar.getDomNode();return kc._applyDimensions(i,e,t)}_setHoverWidgetDimensions(e,t){this._setContainerDomNodeDimensions(e,t),this._setScrollableElementDimensions(e,t),this._setContentsDomNodeDimensions(e,t),this._layoutContentWidget()}static _applyMaxDimensions(e,t,i){const n=typeof t=="number"?`${t}px`:t,o=typeof i=="number"?`${i}px`:i;e.style.maxWidth=n,e.style.maxHeight=o}_setHoverWidgetMaxDimensions(e,t){kc._applyMaxDimensions(this._hover.contentsDomNode,e,t),kc._applyMaxDimensions(this._hover.scrollbar.getDomNode(),e,t),kc._applyMaxDimensions(this._hover.containerDomNode,e,t),this._hover.containerDomNode.style.setProperty("--vscode-hover-maxWidth",typeof e=="number"?`${e}px`:e),this._layoutContentWidget()}_setAdjustedHoverWidgetDimensions(e){this._setHoverWidgetMaxDimensions("none","none"),this._setHoverWidgetDimensions(e.width,e.height)}_updateResizableNodeMaxDimensions(){const e=this._findMaximumRenderingWidth()??1/0,t=this._findMaximumRenderingHeight()??1/0;this._resizableNode.maxSize=new Ke(e,t),this._setHoverWidgetMaxDimensions(e,t)}_resize(e){kc._lastDimensions=new Ke(e.width,e.height),this._setAdjustedHoverWidgetDimensions(e),this._resizableNode.layout(e.height,e.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),this._onDidResize.fire()}_findAvailableSpaceVertically(){const e=this._renderedHover?.showAtPosition;if(e)return this._positionPreference===Oi.ABOVE?this._availableVerticalSpaceAbove(e):this._availableVerticalSpaceBelow(e)}_findMaximumRenderingHeight(){const e=this._findAvailableSpaceVertically();if(!e)return;let i=this._hover.contentsDomNode.children.length-1;return Array.from(this._hover.contentsDomNode.children).forEach(n=>{i+=n.clientHeight}),Math.min(e,i)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty("--vscode-hover-whiteSpace","nowrap"),this._hover.containerDomNode.style.setProperty("--vscode-hover-sourceWhiteSpace","nowrap");const e=Array.from(this._hover.contentsDomNode.children).some(t=>t.scrollWidth>t.clientWidth);return this._hover.containerDomNode.style.removeProperty("--vscode-hover-whiteSpace"),this._hover.containerDomNode.style.removeProperty("--vscode-hover-sourceWhiteSpace"),e}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;const e=this._isHoverTextOverflowing(),t=typeof this._contentWidth>"u"?0:this._contentWidth;return e||this._hover.containerDomNode.clientWidth<t?Zu(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth}isMouseGettingCloser(e,t){if(!this._renderedHover)return!1;if(this._renderedHover.initialMousePosX===void 0||this._renderedHover.initialMousePosY===void 0)return this._renderedHover.initialMousePosX=e,this._renderedHover.initialMousePosY=t,!1;const i=Ms(this.getDomNode());this._renderedHover.closestMouseDistance===void 0&&(this._renderedHover.closestMouseDistance=bX(this._renderedHover.initialMousePosX,this._renderedHover.initialMousePosY,i.left,i.top,i.width,i.height));const n=bX(e,t,i.left,i.top,i.width,i.height);return n>this._renderedHover.closestMouseDistance+4?!1:(this._renderedHover.closestMouseDistance=Math.min(this._renderedHover.closestMouseDistance,n),!0)}_setRenderedHover(e){this._renderedHover?.dispose(),this._renderedHover=e,this._hoverVisibleKey.set(!!e),this._hover.containerDomNode.classList.toggle("hidden",!e)}_updateFont(){const{fontSize:e,lineHeight:t}=this._editor.getOption(L.fontInfo),i=this._hover.contentsDomNode;i.style.fontSize=`${e}px`,i.style.lineHeight=`${t/e}`,Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(o=>this._editor.applyFontInfo(o))}_updateContent(e){const t=this._hover.contentsDomNode;t.style.paddingBottom="",t.textContent="",t.appendChild(e)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){const e=Math.max(this._editor.getLayoutInfo().height/4,250,kc._lastDimensions.height),t=Math.max(this._editor.getLayoutInfo().width*.66,750,kc._lastDimensions.width);this._resizableNode.maxSize=new Ke(t,e),this._setHoverWidgetMaxDimensions(t,e)}_render(e){this._setRenderedHover(e),this._updateFont(),this._updateContent(e.domNode),this.onContentsChanged(),this._editor.render()}getPosition(){return this._renderedHover?{position:this._renderedHover.showAtPosition,secondaryPosition:this._renderedHover.showAtSecondaryPosition,positionAffinity:this._renderedHover.shouldAppearBeforeContent?Jx.LeftOfInjectedText:void 0,preference:[this._positionPreference??Oi.ABOVE]}:null}show(e){if(!this._editor||!this._editor.hasModel())return;this._render(e);const t=U_(this._hover.containerDomNode),i=e.showAtPosition;this._positionPreference=this._findPositionPreference(t,i)??Oi.ABOVE,this.onContentsChanged(),e.shouldFocus&&this._hover.containerDomNode.focus(),this._onDidResize.fire();const o=this._hover.containerDomNode.ownerDocument.activeElement===this._hover.containerDomNode&&xve(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),this._keybindingService.lookupKeybinding("editor.action.accessibleView")?.getAriaLabel()??"");o&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+", "+o)}hide(){if(!this._renderedHover)return;const e=this._renderedHover.shouldFocus||this._hoverFocusedKey.get();this._setRenderedHover(void 0),this._resizableNode.maxSize=new Ke(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),e&&this._editor.focus()}_removeConstraintsRenderNormally(){const e=this._editor.getLayoutInfo();this._resizableNode.layout(e.height,e.width),this._setHoverWidgetDimensions("auto","auto"),this._updateMaxDimensions()}setMinimumDimensions(e){this._minimumSize=new Ke(Math.max(this._minimumSize.width,e.width),Math.max(this._minimumSize.height,e.height)),this._updateMinimumWidth()}_updateMinimumWidth(){const e=typeof this._contentWidth>"u"?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new Ke(e,this._minimumSize.height)}onContentsChanged(){this._removeConstraintsRenderNormally();const e=this._hover.contentsDomNode;let t=U_(e),i=$a(e)+2;if(this._resizableNode.layout(t,i),this._setHoverWidgetDimensions(i,t),t=U_(e),i=$a(e),this._contentWidth=i,this._updateMinimumWidth(),this._resizableNode.layout(t,i),this._renderedHover?.showAtPosition){const n=U_(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(n,this._renderedHover.showAtPosition)}this._layoutContentWidget()}focus(){this._hover.containerDomNode.focus()}scrollUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(L.fontInfo);this._hover.scrollbar.setScrollPosition({scrollTop:e-t.lineHeight})}scrollDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(L.fontInfo);this._hover.scrollbar.setScrollPosition({scrollTop:e+t.lineHeight})}scrollLeft(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e-_X})}scrollRight(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e+_X})}pageUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e-t})}pageDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e+t})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}};JV=kc=f([p(1,me),p(2,ne),p(3,Tr),p(4,Ve)],JV);function bX(s,e,t,i,n,o){const r=t+n/2,a=i+o/2,c=Math.max(Math.abs(s-r)-n/2,0),d=Math.max(Math.abs(e-a)-o/2,0);return Math.sqrt(c*c+d*d)}class $R{constructor(e,t){this._editor=e,this._participants=t}static _getLineDecorations(e,t){if(t.type!==Qo.Range&&!t.supportsMarkerHover)return[];const i=e.getModel(),n=t.range.startLineNumber;if(n>i.getLineCount())return[];const o=i.getLineMaxColumn(n);return e.getLineDecorations(n).filter(r=>{if(r.options.isWholeLine)return!0;const a=r.range.startLineNumber===n?r.range.startColumn:1,c=r.range.endLineNumber===n?r.range.endColumn:o;if(r.options.showIfCollapsed){if(a>t.range.startColumn+1||t.range.endColumn-1>c)return!1}else if(a>t.range.startColumn||t.range.endColumn>c)return!1;return!0})}computeAsync(e,t){const i=e.anchor;if(!this._editor.hasModel()||!i)return Qa.EMPTY;const n=$R._getLineDecorations(this._editor,i);return Qa.merge(this._participants.map(o=>o.computeAsync?o.computeAsync(i,n,e.source,t):Qa.EMPTY))}computeSync(e){if(!this._editor.hasModel())return[];const t=e.anchor,i=$R._getLineDecorations(this._editor,t);let n=[];for(const o of this._participants)n=n.concat(o.computeSync(t,i,e.source));return Vt(n)}}class bde{constructor(e,t,i){this.hoverParts=e,this.isComplete=t,this.options=i}filter(e){const t=this.hoverParts.filter(i=>i.isValidForHoverAnchor(e));return t.length===this.hoverParts.length?this:new HPe(this,t,this.isComplete,this.options)}}class HPe extends bde{constructor(e,t,i,n){super(t,i,n),this.original=e}filter(e){return this.original.filter(e)}}const yX=Y;let GR=class extends F{get hasContent(){return this._hasContent}constructor(e,t){super(),this._keybindingService=e,this._hoverService=t,this.actions=[],this._hasContent=!1,this.hoverElement=yX("div.hover-row.status-bar"),this.hoverElement.tabIndex=0,this.actionsElement=ee(this.hoverElement,yX("div.actions"))}addAction(e){const t=this._keybindingService.lookupKeybinding(e.commandId),i=t?t.getLabel():null;this._hasContent=!0;const n=this._register(Ive.render(this.actionsElement,e,i));return this._register(this._hoverService.setupManagedHover(yr("element"),n.actionContainer,n.actionRenderedLabel)),this.actions.push(n),n}append(e){const t=ee(this.actionsElement,e);return this._hasContent=!0,t}};GR=f([p(0,Ve),p(1,wi)],GR);class UPe{constructor(e,t,i){this.provider=e,this.hover=t,this.ordinal=i}}async function $Pe(s,e,t,i,n){const o=await Promise.resolve(s.provideHover(t,i,n)).catch(kn);if(!(!o||!GPe(o)))return new UPe(s,o,e)}function UK(s,e,t,i,n=!1){const r=s.ordered(e,n).map((a,c)=>$Pe(a,c,e,t,i));return Qa.fromPromisesResolveOrder(r).coalesce()}function yde(s,e,t,i,n=!1){return UK(s,e,t,i,n).map(o=>o.hover).toPromise()}Ar("_executeHoverProvider",(s,e,t)=>{const i=s.get(Ne);return yde(i.hoverProvider,e,t,ye.None)});Ar("_executeHoverProvider_recursive",(s,e,t)=>{const i=s.get(Ne);return yde(i.hoverProvider,e,t,ye.None,!0)});function GPe(s){const e=typeof s.range<"u",t=typeof s.contents<"u"&&s.contents&&s.contents.length>0;return e&&t}const pm=Y,qPe=Ae("hover-increase-verbosity",j.add,h(1194,"Icon for increaseing hover verbosity.")),zPe=Ae("hover-decrease-verbosity",j.remove,h(1195,"Icon for decreasing hover verbosity."));class Qc{constructor(e,t,i,n,o,r=void 0){this.owner=e,this.range=t,this.contents=i,this.isBeforeContent=n,this.ordinal=o,this.source=r}isValidForHoverAnchor(e){return e.type===Qo.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}class wde{constructor(e,t,i){this.hover=e,this.hoverProvider=t,this.hoverPosition=i}supportsVerbosityAction(e){switch(e){case Ps.Increase:return this.hover.canIncreaseVerbosity??!1;case Ps.Decrease:return this.hover.canDecreaseVerbosity??!1}}}let hx=class{constructor(e,t,i,n,o,r,a,c){this._editor=e,this._languageService=t,this._openerService=i,this._configurationService=n,this._languageFeaturesService=o,this._keybindingService=r,this._hoverService=a,this._commandService=c,this.hoverOrdinal=3}createLoadingMessage(e){return new Qc(this,e.range,[new Ni().appendText(h(1196,"Loading..."))],!1,2e3)}computeSync(e,t){if(!this._editor.hasModel()||e.type!==Qo.Range)return[];const i=this._editor.getModel(),n=e.range.startLineNumber,o=i.getLineMaxColumn(n),r=[];let a=1e3;const c=i.getLineLength(n),d=i.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),l=this._editor.getOption(L.stopRenderingLineAfter),u=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:d});let g=!1;l>=0&&c>l&&e.range.startColumn>=l&&(g=!0,r.push(new Qc(this,e.range,[{value:h(1197,"Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,a++))),!g&&typeof u=="number"&&c>=u&&r.push(new Qc(this,e.range,[{value:h(1198,"Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,a++));let m=!1;for(const v of t){const y=v.range.startLineNumber===n?v.range.startColumn:1,w=v.range.endLineNumber===n?v.range.endColumn:o,C=v.options.hoverMessage;if(!C||CE(C))continue;v.options.beforeContentClassName&&(m=!0);const T=new P(e.range.startLineNumber,y,e.range.startLineNumber,w);r.push(new Qc(this,T,cw(C),m,a++))}return r}computeAsync(e,t,i,n){if(!this._editor.hasModel()||e.type!==Qo.Range)return Qa.EMPTY;const o=this._editor.getModel(),r=this._languageFeaturesService.hoverProvider;return r.has(o)?this._getMarkdownHovers(r,o,e,n):Qa.EMPTY}_getMarkdownHovers(e,t,i,n){const o=i.range.getStartPosition();return UK(e,t,o,n).filter(c=>!CE(c.hover.contents)).map(c=>{const d=c.hover.range?P.lift(c.hover.range):i.range,l=new wde(c.hover,c.provider,o);return new Qc(this,d,c.hover.contents,!1,c.ordinal,l)})}renderHoverParts(e,t){return this._renderedHoverParts=new KPe(t,e.fragment,this,this._editor,this._languageService,this._openerService,this._commandService,this._keybindingService,this._hoverService,this._configurationService,e.onContentsChanged),this._renderedHoverParts}handleScroll(e){this._renderedHoverParts?.handleScroll(e)}getAccessibleContent(e){return this._renderedHoverParts?.getAccessibleContent(e)??""}doesMarkdownHoverAtIndexSupportVerbosityAction(e,t){return this._renderedHoverParts?.doesMarkdownHoverAtIndexSupportVerbosityAction(e,t)??!1}updateMarkdownHoverVerbosityLevel(e,t){return Promise.resolve(this._renderedHoverParts?.updateMarkdownHoverPartVerbosityLevel(e,t))}};hx=f([p(1,fi),p(2,hi),p(3,ne),p(4,Ne),p(5,Ve),p(6,wi),p(7,qe)],hx);class YD{constructor(e,t,i,n){this.hoverPart=e,this.hoverElement=t,this.disposables=i,this.actionsContainer=n}get hoverAccessibleContent(){return this.hoverElement.innerText.trim()}dispose(){this.disposables.dispose()}}class KPe{constructor(e,t,i,n,o,r,a,c,d,l,u){this._hoverParticipant=i,this._editor=n,this._languageService=o,this._openerService=r,this._commandService=a,this._keybindingService=c,this._hoverService=d,this._configurationService=l,this._onFinishedRendering=u,this._ongoingHoverOperations=new Map,this._disposables=new U,this.renderedHoverParts=this._renderHoverParts(e,t,this._onFinishedRendering),this._disposables.add(Ee(()=>{this.renderedHoverParts.forEach(g=>{g.dispose()}),this._ongoingHoverOperations.forEach(g=>{g.tokenSource.dispose(!0)})}))}_renderHoverParts(e,t,i){return e.sort(ul(n=>n.ordinal,Oh)),e.map(n=>{const o=this._renderHoverPart(n,i);return t.appendChild(o.hoverElement),o})}_renderHoverPart(e,t){const i=this._renderMarkdownHover(e,t),n=i.hoverElement,o=e.source,r=new U;if(r.add(i),!o)return new YD(e,n,r);const a=o.supportsVerbosityAction(Ps.Increase),c=o.supportsVerbosityAction(Ps.Decrease);if(!a&&!c)return new YD(e,n,r);const d=pm("div.verbosity-actions");n.prepend(d);const l=pm("div.verbosity-actions-inner");return d.append(l),r.add(this._renderHoverExpansionAction(l,Ps.Increase,a)),r.add(this._renderHoverExpansionAction(l,Ps.Decrease,c)),new YD(e,n,r,l)}_renderMarkdownHover(e,t){return Sde(this._editor,e,this._languageService,this._openerService,t)}_renderHoverExpansionAction(e,t,i){const n=new U,o=t===Ps.Increase,r=ee(e,pm(Te.asCSSSelector(o?qPe:zPe)));r.tabIndex=0;const a=new Dve("mouse",void 0,{target:e,position:{hoverPosition:kF.LEFT}},this._configurationService,this._hoverService);if(n.add(this._hoverService.setupManagedHover(a,r,Cde(this._keybindingService,t))),!i)return r.classList.add("disabled"),n;r.classList.add("enabled");const c=()=>this._commandService.executeCommand(t===Ps.Increase?zw:Kw,{focus:!0});return n.add(new kve(r,c)),n.add(new Tve(r,c,[S.Enter,S.Space])),n}handleScroll(e){this.renderedHoverParts.forEach(t=>{const i=t.actionsContainer;if(!i)return;const n=t.hoverElement,r=e.scrollTop+e.height,a=n.offsetTop,c=n.clientHeight,d=a+c,l=22;let u;d<=r||a>=r?u=c-l:u=r-a-l,i.style.top=`${u}px`})}async updateMarkdownHoverPartVerbosityLevel(e,t){const i=this._editor.getModel();if(!i)return;const n=this._getRenderedHoverPartAtIndex(t),o=n?.hoverPart.source;if(!n||!o?.supportsVerbosityAction(e))return;const r=await this._fetchHover(o,i,e);if(!r)return;const a=new wde(r,o.hoverProvider,o.hoverPosition),c=n.hoverPart,d=new Qc(this._hoverParticipant,c.range,r.contents,c.isBeforeContent,c.ordinal,a),l=this._updateRenderedHoverPart(t,d);if(l)return{hoverPart:d,hoverElement:l.hoverElement}}getAccessibleContent(e){const t=this.renderedHoverParts.findIndex(r=>r.hoverPart===e);if(t===-1)return;const i=this._getRenderedHoverPartAtIndex(t);return i?i.hoverElement.innerText.replace(/[^\S\n\r]+/gu," "):void 0}doesMarkdownHoverAtIndexSupportVerbosityAction(e,t){const i=this._getRenderedHoverPartAtIndex(e),n=i?.hoverPart.source;return!(!i||!n?.supportsVerbosityAction(t))}async _fetchHover(e,t,i){let n=i===Ps.Increase?1:-1;const o=e.hoverProvider,r=this._ongoingHoverOperations.get(o);r&&(r.tokenSource.cancel(),n+=r.verbosityDelta);const a=new ri;this._ongoingHoverOperations.set(o,{verbosityDelta:n,tokenSource:a});const c={verbosityRequest:{verbosityDelta:n,previousHover:e.hover}};let d;try{d=await Promise.resolve(o.provideHover(t,e.hoverPosition,a.token,c))}catch(l){kn(l)}return a.dispose(),this._ongoingHoverOperations.delete(o),d}_updateRenderedHoverPart(e,t){if(e>=this.renderedHoverParts.length||e<0)return;const i=this._renderHoverPart(t,this._onFinishedRendering),n=this.renderedHoverParts[e],o=n.hoverElement,r=i.hoverElement,a=Array.from(r.children);o.replaceChildren(...a);const c=new YD(t,o,i.disposables,i.actionsContainer);return n.dispose(),this.renderedHoverParts[e]=c,c}_getRenderedHoverPartAtIndex(e){return this.renderedHoverParts[e]}dispose(){this._disposables.dispose()}}function jPe(s,e,t,i,n){e.sort(ul(r=>r.ordinal,Oh));const o=[];for(const r of e){const a=Sde(t,r,i,n,s.onContentsChanged);s.fragment.appendChild(a.hoverElement),o.push(a)}return new hv(o)}function Sde(s,e,t,i,n){const o=new U,r=pm("div.hover-row"),a=pm("div.hover-row-contents");r.appendChild(a);const c=e.contents;for(const l of c){if(CE(l))continue;const u=pm("div.markdown-hover"),g=ee(u,pm("div.hover-contents")),m=new Rv({editor:s},t,i),v=o.add(m.render(l,{asyncRenderCallback:()=>{g.className="hover-contents code-hover-contents",n()}}));g.appendChild(v.element),a.appendChild(u)}return{hoverPart:e,hoverElement:r,dispose(){o.dispose()}}}function Cde(s,e){switch(e){case Ps.Increase:{const t=s.lookupKeybinding(zw);return t?h(1199,"Increase Hover Verbosity ({0})",t.getLabel()):h(1200,"Increase Hover Verbosity")}case Ps.Decrease:{const t=s.lookupKeybinding(Kw);return t?h(1201,"Decrease Hover Verbosity ({0})",t.getLabel()):h(1202,"Decrease Hover Verbosity")}}}let ux=class{constructor(e){this._editorWorkerService=e}async provideDocumentColors(e,t){return this._editorWorkerService.computeDefaultDocumentColors(e.uri)}provideColorPresentations(e,t,i){const n=t.range,o=t.color,r=o.alpha,a=new be(new Vm(Math.round(255*o.red),Math.round(255*o.green),Math.round(255*o.blue),r)),c=r?be.Format.CSS.formatRGB(a):be.Format.CSS.formatRGBA(a),d=r?be.Format.CSS.formatHSL(a):be.Format.CSS.formatHSLA(a),l=r?be.Format.CSS.formatHex(a):be.Format.CSS.formatHexA(a),u=[];return u.push({label:c,textEdit:{range:n,text:c}}),u.push({label:d,textEdit:{range:n,text:d}}),u.push({label:l,textEdit:{range:n,text:l}}),u}};ux=f([p(0,vc)],ux);let eH=class extends F{constructor(e,t){super(),this._register(e.colorProvider.register("*",new ux(t)))}};eH=f([p(0,Ne),p(1,vc)],eH);async function Ede(s,e,t,i="auto"){return $K(new YPe,s,e,t,i)}function xde(s,e,t,i){return Promise.resolve(t.provideColorPresentations(s,e,i))}class YPe{constructor(){}async compute(e,t,i,n){const o=await e.provideDocumentColors(t,i);if(Array.isArray(o))for(const r of o)n.push({colorInfo:r,provider:e});return Array.isArray(o)}}class QPe{constructor(){}async compute(e,t,i,n){const o=await e.provideDocumentColors(t,i);if(Array.isArray(o))for(const r of o)n.push({range:r.range,color:[r.color.red,r.color.green,r.color.blue,r.color.alpha]});return Array.isArray(o)}}class XPe{constructor(e){this.colorInfo=e}async compute(e,t,i,n){const o=await e.provideColorPresentations(t,this.colorInfo,ye.None);return Array.isArray(o)&&n.push(...o),Array.isArray(o)}}async function $K(s,e,t,i,n){let o=!1,r;const a=[],c=e.ordered(t);for(let d=c.length-1;d>=0;d--){const l=c[d];if(n!=="always"&&l instanceof ux)r=l;else try{await s.compute(l,t,i,a)&&(o=!0)}catch(u){kn(u)}}return o?a:r&&n!=="never"?(await s.compute(r,t,i,a),a):[]}function Ide(s,e){const{colorProvider:t}=s.get(Ne),i=s.get(ai).getModel(e);if(!i)throw Mt();const n=s.get(ne).getValue("editor.defaultColorDecorators",{resource:e});return{model:i,colorProviderRegistry:t,defaultColorDecoratorsEnablement:n}}var tH;const Dde=Object.create({});let Vy=class extends F{static{tH=this}static{this.ID="editor.contrib.colorDetector"}static{this.RECOMPUTE_TIME=1e3}constructor(e,t,i,n){super(),this._editor=e,this._configurationService=t,this._languageFeaturesService=i,this._localToDispose=this._register(new U),this._decorationsIds=[],this._colorDatas=new Map,this._decoratorLimitReporter=this._register(new ZPe),this._colorDecorationClassRefs=this._register(new U),this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=new Ese(this._editor),this._debounceInformation=n.for(i.colorProvider,"Document Colors",{min:tH.RECOMPUTE_TIME}),this._register(e.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(e.onDidChangeModelLanguage(()=>this.updateColors())),this._register(i.colorProvider.onDidChange(()=>this.updateColors())),this._register(e.onDidChangeConfiguration(o=>{const r=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(L.defaultColorDecorators);const a=r!==this._isColorDecoratorsEnabled||o.hasChanged(L.colorDecoratorsLimit),c=o.hasChanged(L.defaultColorDecorators);(a||c)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(L.defaultColorDecorators),this.updateColors()}isEnabled(){const e=this._editor.getModel();if(!e)return!1;const t=e.getLanguageId(),i=this._configurationService.getValue(t);if(i&&typeof i=="object"){const n=i.colorDecorators;if(n&&n.enable!==void 0&&!n.enable)return n.enable}return this._editor.getOption(L.colorDecorators)}get limitReporter(){return this._decoratorLimitReporter}static get(e){return e.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;const e=this._editor.getModel();!e||!this._languageFeaturesService.colorProvider.has(e)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new iI,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(e)))})),this.beginCompute())}async beginCompute(){this._computePromise=En(async e=>{const t=this._editor.getModel();if(!t)return[];const i=new zn(!1),n=await Ede(this._languageFeaturesService.colorProvider,t,e,this._defaultColorDecoratorsEnablement);return this._debounceInformation.update(t,i.elapsed()),n});try{const e=await this._computePromise;this.updateDecorations(e),this.updateColorDecorators(e),this._computePromise=null}catch(e){mt(e)}}stop(){this._timeoutTimer&&(this._timeoutTimer.cancel(),this._timeoutTimer=null),this._computePromise&&(this._computePromise.cancel(),this._computePromise=null),this._localToDispose.clear()}updateDecorations(e){const t=e.map(i=>({range:{startLineNumber:i.colorInfo.range.startLineNumber,startColumn:i.colorInfo.range.startColumn,endLineNumber:i.colorInfo.range.endLineNumber,endColumn:i.colorInfo.range.endColumn},options:Yt.EMPTY}));this._editor.changeDecorations(i=>{this._decorationsIds=i.deltaDecorations(this._decorationsIds,t),this._colorDatas=new Map,this._decorationsIds.forEach((n,o)=>this._colorDatas.set(n,e[o]))})}updateColorDecorators(e){this._colorDecorationClassRefs.clear();const t=[],i=this._editor.getOption(L.colorDecoratorsLimit);for(let o=0;o<e.length&&t.length<i;o++){const{red:r,green:a,blue:c,alpha:d}=e[o].colorInfo.color,l=new Vm(Math.round(r*255),Math.round(a*255),Math.round(c*255),d),u=`rgba(${l.r}, ${l.g}, ${l.b}, ${l.a})`,g=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:u}));t.push({range:{startLineNumber:e[o].colorInfo.range.startLineNumber,startColumn:e[o].colorInfo.range.startColumn,endLineNumber:e[o].colorInfo.range.endLineNumber,endColumn:e[o].colorInfo.range.endColumn},options:{description:"colorDetector",before:{content:ine,inlineClassName:`${g.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:Dde}}})}const n=i<e.length?i:!1;this._decoratorLimitReporter.update(e.length,n),this._colorDecoratorIds.set(t)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(e){const t=this._editor.getModel();if(!t)return null;const i=t.getDecorationsInRange(P.fromPositions(e,e)).filter(n=>this._colorDatas.has(n.id));return i.length===0?null:this._colorDatas.get(i[0].id)}isColorDecoration(e){return this._colorDecoratorIds.has(e)}};Vy=tH=f([p(1,ne),p(2,Ne),p(3,Sd)],Vy);class ZPe extends F{constructor(){super(...arguments),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._computed=0,this._limited=!1}get computed(){return this._computed}get limited(){return this._limited}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}}const Ef=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(Ef);const wX=Y;class JPe extends F{constructor(e,t,i){super(),this.model=t,this.pixelRatio=i,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new M,this.onColorFlushed=this._onColorFlushed.event,this._domNode=wX(".saturation-wrap"),ee(e,this._domNode),this._canvas=document.createElement("canvas"),this._canvas.className="saturation-box",ee(this._domNode,this._canvas),this.selection=wX(".saturation-selection"),ee(this._domNode,this.selection),this.layout(),this._register(re(this._domNode,pe.POINTER_DOWN,n=>this.onPointerDown(n))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}get canvas(){return this._canvas}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;this.monitor=this._register(new sne);const t=Ms(this._domNode);e.target!==this.selection&&this.onDidChangePosition(e.offsetX,e.offsetY),this.monitor.startMonitoring(e.target,e.pointerId,e.buttons,n=>this.onDidChangePosition(n.pageX-t.left,n.pageY-t.top),()=>null);const i=re(e.target.ownerDocument,pe.POINTER_UP,()=>{this._onColorFlushed.fire(),i.dispose(),this.monitor&&(this.monitor.stopMonitoring(!0),this.monitor=null)},!0)}onDidChangePosition(e,t){const i=Math.max(0,Math.min(1,e/this.width)),n=Math.max(0,Math.min(1,1-t/this.height));this.paintSelection(i,n),this._onDidChange.fire({s:i,v:n})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();const e=this.model.color.hsva;this.paintSelection(e.s,e.v)}paint(){const e=this.model.color.hsva,t=new be(new Ik(e.h,1,1,1)),i=this._canvas.getContext("2d"),n=i.createLinearGradient(0,0,this._canvas.width,0);n.addColorStop(0,"rgba(255, 255, 255, 1)"),n.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),n.addColorStop(1,"rgba(255, 255, 255, 0)");const o=i.createLinearGradient(0,0,0,this._canvas.height);o.addColorStop(0,"rgba(0, 0, 0, 0)"),o.addColorStop(1,"rgba(0, 0, 0, 1)"),i.rect(0,0,this._canvas.width,this._canvas.height),i.fillStyle=be.Format.CSS.format(t),i.fill(),i.fillStyle=n,i.fill(),i.fillStyle=o,i.fill()}paintSelection(e,t){this.selection.style.left=`${e*this.width}px`,this.selection.style.top=`${this.height-t*this.height}px`}onDidChangeColor(e){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();const t=e.hsva;this.paintSelection(t.s,t.v)}}Be(Ef);class eLe extends F{constructor(e){super(),this._onClicked=this._register(new M),this.onClicked=this._onClicked.event,this._button=ee(e,document.createElement("button")),this._button.classList.add("insert-button"),this._button.textContent="Insert",this._register(re(this._button,pe.CLICK,()=>{this._onClicked.fire()}))}get button(){return this._button}}class tLe{get color(){return this._color}set color(e){this._color.equals(e)||(this._color=e,this._onDidChangeColor.fire(e))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(e){this._colorPresentations=e,this.presentationIndex>e.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(e,t,i){this.presentationIndex=i,this._onColorFlushed=new M,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new M,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new M,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=e,this._color=e,this._colorPresentations=t}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(e,t){let i=-1;for(let n=0;n<this.colorPresentations.length;n++)if(t.toLowerCase()===this.colorPresentations[n].label){i=n;break}if(i===-1){const n=t.split("(")[0].toLowerCase();for(let o=0;o<this.colorPresentations.length;o++)if(this.colorPresentations[o].label.toLowerCase().startsWith(n)){i=o;break}}i!==-1&&i!==this.presentationIndex&&(this.presentationIndex=i,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}}var uv;(function(s){s.Hover="hover",s.Standalone="standalone"})(uv||(uv={}));async function kde(s,e,t){const i=s.getValueInRange(e.range),{red:n,green:o,blue:r,alpha:a}=e.color,c=new Vm(Math.round(n*255),Math.round(o*255),Math.round(r*255),a),d=new be(c),l=await xde(s,e,t,ye.None),u=new tLe(d,[],0);return u.colorPresentations=l||[],u.guessColorPresentation(d,i),{range:P.lift(e.range),model:u,provider:t}}function Tde(s,e,t){const i=[],n=t.presentation.textEdit??{range:e,text:t.presentation.label,forceMoveMarkers:!1};i.push(n),t.presentation.additionalTextEdits&&i.push(...t.presentation.additionalTextEdits);const o=P.lift(n.range),r=s.getModel()._setTrackedRange(null,o,Di.GrowsOnlyWhenTypingAfter);return s.executeEdits("colorpicker",i),s.pushUndoStop(),s.getModel()._getTrackedRange(r)??o}async function gx(s,e,t,i,n){const o=await xde(s,{range:i,color:{red:t.rgba.r/255,green:t.rgba.g/255,blue:t.rgba.b/255,alpha:t.rgba.a}},n.provider,ye.None);e.colorPresentations=o||[]}Be(Ef);const ES=Y;class Ade extends F{constructor(e,t,i){super(),this.model=t,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new M,this.onColorFlushed=this._onColorFlushed.event,i===uv.Standalone?(this.domNode=ee(e,ES(".standalone-strip")),this.overlay=ee(this.domNode,ES(".standalone-overlay"))):(this.domNode=ee(e,ES(".strip")),this.overlay=ee(this.domNode,ES(".overlay"))),this.slider=ee(this.domNode,ES(".slider")),this.slider.style.top="0px",this._register(re(this.domNode,pe.POINTER_DOWN,n=>this.onPointerDown(n))),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;const e=this.getValue(this.model.color);this.updateSliderPosition(e)}onDidChangeColor(e){const t=this.getValue(e);this.updateSliderPosition(t)}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;const t=this._register(new sne),i=Ms(this.domNode);this.domNode.classList.add("grabbing"),e.target!==this.slider&&this.onDidChangeTop(e.offsetY),t.startMonitoring(e.target,e.pointerId,e.buttons,o=>this.onDidChangeTop(o.pageY-i.top),()=>null);const n=re(e.target.ownerDocument,pe.POINTER_UP,()=>{this._onColorFlushed.fire(),n.dispose(),t.stopMonitoring(!0),this.domNode.classList.remove("grabbing")},!0)}onDidChangeTop(e){const t=Math.max(0,Math.min(1,1-e/this.height));this.updateSliderPosition(t),this._onDidChange.fire(t)}updateSliderPosition(e){this.slider.style.top=`${(1-e)*this.height}px`}}class iLe extends Ade{constructor(e,t,i){super(e,t,i),this.domNode.classList.add("opacity-strip"),this.onDidChangeColor(this.model.color)}onDidChangeColor(e){super.onDidChangeColor(e);const{r:t,g:i,b:n}=e.rgba,o=new be(new Vm(t,i,n,1)),r=new be(new Vm(t,i,n,0));this.overlay.style.background=`linear-gradient(to bottom, ${o} 0%, ${r} 100%)`}getValue(e){return e.hsva.a}}class nLe extends Ade{constructor(e,t,i){super(e,t,i),this.domNode.classList.add("hue-strip")}getValue(e){return 1-e.hsva.h/360}}Be(Ef);const sLe=Y;class oLe extends F{constructor(e,t,i,n){super(),this.model=t,this.pixelRatio=i,this._insertButton=null,this._domNode=sLe(".colorpicker-body"),ee(e,this._domNode),this._saturationBox=new JPe(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new iLe(this._domNode,this.model,n),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new nLe(this._domNode,this.model,n),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),n===uv.Standalone&&(this._insertButton=this._register(new eLe(this._domNode)),this._domNode.classList.add("standalone-colorpicker"))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:e,v:t}){const i=this.model.color.hsva;this.model.color=new be(new Ik(i.h,e,t,i.a))}onDidOpacityChange(e){const t=this.model.color.hsva;this.model.color=new be(new Ik(t.h,t.s,t.v,e))}onDidHueChange(e){const t=this.model.color.hsva,i=(1-e)*360;this.model.color=new be(new Ik(i===360?0:i,t.s,t.v,t.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get opacityStrip(){return this._opacityStrip}get hueStrip(){return this._hueStrip}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}}Be(Ef);const rLe=Y;class aLe extends F{constructor(e){super(),this._onClicked=this._register(new M),this.onClicked=this._onClicked.event,this._button=document.createElement("div"),this._button.classList.add("close-button"),ee(e,this._button);const t=document.createElement("div");t.classList.add("close-button-inner-div"),ee(this._button,t),ee(t,rLe(".button"+Te.asCSSSelector(Ae("color-picker-close",j.close,h(951,"Icon to close the color picker"))))).classList.add("close-icon"),this._register(re(this._button,pe.CLICK,()=>{this._onClicked.fire()}))}}Be(Ef);const QD=Y;class cLe extends F{constructor(e,t,i,n){super(),this.model=t,this.type=n,this._closeButton=null,this._domNode=QD(".colorpicker-header"),ee(e,this._domNode),this._pickedColorNode=ee(this._domNode,QD(".picked-color")),ee(this._pickedColorNode,QD("span.codicon.codicon-color-mode")),this._pickedColorPresentation=ee(this._pickedColorNode,document.createElement("span")),this._pickedColorPresentation.classList.add("picked-color-presentation");const o=h(952,"Click to toggle color options (rgb/hsl/hex)");this._pickedColorNode.setAttribute("title",o),this._originalColorNode=ee(this._domNode,QD(".original-color")),this._originalColorNode.style.backgroundColor=be.Format.CSS.format(this.model.originalColor)||"",this.backgroundColor=i.getColorTheme().getColor(C7)||be.white,this._register(i.onDidColorThemeChange(r=>{this.backgroundColor=r.getColor(C7)||be.white})),this._register(re(this._pickedColorNode,pe.CLICK,()=>this.model.selectNextColorPresentation())),this._register(re(this._originalColorNode,pe.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this._register(t.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=be.Format.CSS.format(t.color)||"",this._pickedColorNode.classList.toggle("light",t.color.rgba.a<.5?this.backgroundColor.isLighter():t.color.isLighter()),this.onDidChangeColor(this.model.color),this.type===uv.Standalone&&(this._domNode.classList.add("standalone-colorpicker"),this._closeButton=this._register(new aLe(this._domNode)))}get domNode(){return this._domNode}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(e){this._pickedColorNode.style.backgroundColor=be.Format.CSS.format(e)||"",this._pickedColorNode.classList.toggle("light",e.rgba.a<.5?this.backgroundColor.isLighter():e.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:""}}Be(Ef);const dLe=Y;class EO extends uf{static{this.ID="editor.contrib.colorPickerWidget"}constructor(e,t,i,n,o){super(),this.model=t,this.pixelRatio=i,this._register(Ise.getInstance(bt(e)).onDidChange(()=>this.layout())),this._domNode=dLe(".colorpicker-widget"),e.appendChild(this._domNode),this.header=this._register(new cLe(this._domNode,this.model,n,o)),this.body=this._register(new oLe(this._domNode,this.model,this.pixelRatio,o))}getId(){return EO.ID}layout(){this.body.layout()}get domNode(){return this._domNode}}class qR{constructor(e,t,i,n){this.owner=e,this.range=t,this.model=i,this.provider=n,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return e.type===Qo.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}static fromBaseColor(e,t){return new qR(e,t.range,t.model,t.provider)}}let zR=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}computeSync(e,t,i){return[]}computeAsync(e,t,i,n){return Qa.fromPromise(this._computeAsync(e,t,i))}async _computeAsync(e,t,i){if(!this._editor.hasModel())return[];if(!this._isValidRequest(i))return[];const n=Vy.get(this._editor);if(!n)return[];for(const o of t){if(!n.isColorDecoration(o))continue;const r=n.getColorData(o.range.getStartPosition());if(r)return[qR.fromBaseColor(this,await kde(this._editor.getModel(),r.colorInfo,r.provider))]}return[]}_isValidRequest(e){const t=this._editor.getOption(L.colorDecoratorsActivatedOn);switch(e){case ll.Mouse:return t==="hover"||t==="clickAndHover";case ll.Click:return t==="click"||t==="clickAndHover";case ll.Keyboard:return!0}}renderHoverParts(e,t){const i=this._editor;if(t.length===0||!i.hasModel())return new hv([]);const n=i.getOption(L.lineHeight)+8;e.setMinimumDimensions(new Ke(302,n));const o=new U,r=t[0],a=i.getModel(),c=r.model;this._colorPicker=o.add(new EO(e.fragment,c,i.getOption(L.pixelRatio),this._themeService,uv.Hover));let d=!1,l=new P(r.range.startLineNumber,r.range.startColumn,r.range.endLineNumber,r.range.endColumn);o.add(c.onColorFlushed(async g=>{await gx(a,c,g,l,r),d=!0,l=Tde(i,l,c)})),o.add(c.onDidChangeColor(g=>{gx(a,c,g,l,r)})),o.add(i.onDidChangeModelContent(g=>{d?d=!1:(e.hide(),i.focus())}));const u={hoverPart:qR.fromBaseColor(this,r),hoverElement:this._colorPicker.domNode,dispose(){o.dispose()}};return new hv([u])}getAccessibleContent(e){return h(953,"There is a color picker here.")}handleResize(){this._colorPicker?.layout()}handleHide(){this._colorPicker?.dispose(),this._colorPicker=void 0}isColorPickerVisible(){return!!this._colorPicker}};zR=f([p(1,ft)],zR);class SX extends qS{constructor(e,t,i,n){super(10,t,e.item.anchor.range,i,n,!0),this.part=e}}let KR=class extends hx{constructor(e,t,i,n,o,r,a,c,d){super(e,t,i,r,c,n,o,d),this._resolverService=a,this.hoverOrdinal=6}suggestHoverAnchor(e){if(!yy.get(this._editor)||e.target.type!==Ei.CONTENT_TEXT)return null;const i=e.target.detail.injectedText?.options;return i instanceof uq&&i.attachedData instanceof SB?new SX(i.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,i,n){return e instanceof SX?new Qa(async o=>{const{part:r}=e;if(await r.item.resolve(n),n.isCancellationRequested)return;let a;typeof r.item.hint.tooltip=="string"?a=new Ni().appendText(r.item.hint.tooltip):r.item.hint.tooltip&&(a=r.item.hint.tooltip),a&&o.emitOne(new Qc(this,e.range,[a],!1,0)),xn(r.item.hint.textEdits)&&o.emitOne(new Qc(this,e.range,[new Ni().appendText(h(1229,"Double-click to insert"))],!1,10001));let c;if(typeof r.part.tooltip=="string"?c=new Ni().appendText(r.part.tooltip):r.part.tooltip&&(c=r.part.tooltip),c&&o.emitOne(new Qc(this,e.range,[c],!1,1)),r.part.location||r.part.command){let l;const g=this._editor.getOption(L.multiCursorModifier)==="altKey"?qt?h(1230,"cmd + click"):h(1231,"ctrl + click"):qt?h(1232,"option + click"):h(1233,"alt + click");r.part.location&&r.part.command?l=new Ni().appendText(h(1234,"Go to Definition ({0}), right click for more",g)):r.part.location?l=new Ni().appendText(h(1235,"Go to Definition ({0})",g)):r.part.command&&(l=new Ni(`[${h(1236,"Execute Command")}](${oae(r.part.command)} "${r.part.command.title}") (${g})`,{isTrusted:!0})),l&&o.emitOne(new Qc(this,e.range,[l],!1,1e4))}const d=await this._resolveInlayHintLabelPartHover(r,n);for await(const l of d)o.emitOne(l)}):Qa.EMPTY}async _resolveInlayHintLabelPartHover(e,t){if(!e.part.location)return Qa.EMPTY;const{uri:i,range:n}=e.part.location,o=await this._resolverService.createModelReference(i);try{const r=o.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(r)?UK(this._languageFeaturesService.hoverProvider,r,new _e(n.startLineNumber,n.startColumn),t).filter(a=>!CE(a.hover.contents)).map(a=>new Qc(this,e.item.anchor.range,a.hover.contents,!1,2+a.ordinal)):Qa.EMPTY}finally{o.dispose()}}};KR=f([p(1,fi),p(2,hi),p(3,Ve),p(4,wi),p(5,ne),p(6,yi),p(7,Ne),p(8,qe)],KR);var iH,nH;let sH=iH=class extends F{constructor(e,t,i,n,o,r){super();const a=t.hoverParts;this._renderedHoverParts=this._register(new oH(e,i,a,n,o,r));const c=t.options,d=c.anchor,{showAtPosition:l,showAtSecondaryPosition:u}=iH.computeHoverPositions(e,d.range,a);this.shouldAppearBeforeContent=a.some(g=>g.isBeforeContent),this.showAtPosition=l,this.showAtSecondaryPosition=u,this.initialMousePosX=d.initialMousePosX,this.initialMousePosY=d.initialMousePosY,this.shouldFocus=c.shouldFocus,this.source=c.source}get domNode(){return this._renderedHoverParts.domNode}get domNodeHasChildren(){return this._renderedHoverParts.domNodeHasChildren}get focusedHoverPartIndex(){return this._renderedHoverParts.focusedHoverPartIndex}get hoverPartsCount(){return this._renderedHoverParts.hoverPartsCount}focusHoverPartWithIndex(e){this._renderedHoverParts.focusHoverPartWithIndex(e)}getAccessibleWidgetContent(){return this._renderedHoverParts.getAccessibleContent()}getAccessibleWidgetContentAtIndex(e){return this._renderedHoverParts.getAccessibleHoverContentAtIndex(e)}async updateHoverVerbosityLevel(e,t,i){this._renderedHoverParts.updateHoverVerbosityLevel(e,t,i)}doesHoverAtIndexSupportVerbosityAction(e,t){return this._renderedHoverParts.doesHoverAtIndexSupportVerbosityAction(e,t)}isColorPickerVisible(){return this._renderedHoverParts.isColorPickerVisible()}static computeHoverPositions(e,t,i){let n=1;if(e.hasModel()){const l=e._getViewModel(),u=l.coordinatesConverter,g=u.convertModelRangeToViewRange(t),m=l.getLineMinColumn(g.startLineNumber),v=new _e(g.startLineNumber,m);n=u.convertViewPositionToModelPosition(v).column}const o=t.startLineNumber;let r=t.startColumn,a;for(const l of i){const u=l.range,g=u.startLineNumber===o,m=u.endLineNumber===o;if(g&&m){const y=u.startColumn,w=Math.min(r,y);r=Math.max(w,n)}l.forceShowAtRange&&(a=u)}let c,d;if(a){const l=a.getStartPosition();c=l,d=l}else c=t.getStartPosition(),d=new _e(o,r);return{showAtPosition:c,showAtSecondaryPosition:d}}};sH=iH=f([p(4,Ve),p(5,wi)],sH);class lLe{constructor(e,t){this._statusBar=t,e.appendChild(this._statusBar.hoverElement)}get hoverElement(){return this._statusBar.hoverElement}get actions(){return this._statusBar.actions}dispose(){this._statusBar.dispose()}}let oH=class extends F{static{nH=this}static{this._DECORATION_OPTIONS=Yt.register({description:"content-hover-highlight",className:"hoverHighlight"})}constructor(e,t,i,n,o,r){super(),this._renderedParts=[],this._focusedHoverPartIndex=-1,this._context=n,this._fragment=document.createDocumentFragment(),this._register(this._renderParts(t,i,n,o,r)),this._register(this._registerListenersOnRenderedParts()),this._register(this._createEditorDecorations(e,i)),this._updateMarkdownAndColorParticipantInfo(t)}_createEditorDecorations(e,t){if(t.length===0)return F.None;let i=t[0].range;for(const o of t){const r=o.range;i=P.plusRange(i,r)}const n=e.createDecorationsCollection();return n.set([{range:i,options:nH._DECORATION_OPTIONS}]),Ee(()=>{n.clear()})}_renderParts(e,t,i,n,o){const r=new GR(n,o),a={fragment:this._fragment,statusBar:r,...i},c=new U;c.add(r);for(const l of e){const u=this._renderHoverPartsForParticipant(t,l,a);c.add(u);for(const g of u.renderedHoverParts)this._renderedParts.push({type:"hoverPart",participant:l,hoverPart:g.hoverPart,hoverElement:g.hoverElement})}const d=this._renderStatusBar(this._fragment,r);return d&&(c.add(d),this._renderedParts.push({type:"statusBar",hoverElement:d.hoverElement,actions:d.actions})),c}_renderHoverPartsForParticipant(e,t,i){const n=e.filter(r=>r.owner===t);return n.length>0?t.renderHoverParts(i,n):new hv([])}_renderStatusBar(e,t){if(t.hasContent)return new lLe(e,t)}_registerListenersOnRenderedParts(){const e=new U;return this._renderedParts.forEach((t,i)=>{const n=t.hoverElement;n.tabIndex=0,e.add(re(n,pe.FOCUS_IN,o=>{o.stopPropagation(),this._focusedHoverPartIndex=i})),e.add(re(n,pe.FOCUS_OUT,o=>{o.stopPropagation(),this._focusedHoverPartIndex=-1}))}),e}_updateMarkdownAndColorParticipantInfo(e){const t=e.find(i=>i instanceof hx&&!(i instanceof KR));t&&(this._markdownHoverParticipant=t),this._colorHoverParticipant=e.find(i=>i instanceof zR)}focusHoverPartWithIndex(e){e<0||e>=this._renderedParts.length||this._renderedParts[e].hoverElement.focus()}getAccessibleContent(){const e=[];for(let t=0;t<this._renderedParts.length;t++)e.push(this.getAccessibleHoverContentAtIndex(t));return e.join(`

`)}getAccessibleHoverContentAtIndex(e){const t=this._renderedParts[e];if(!t)return"";if(t.type==="statusBar"){const i=[h(1163,"This is a hover status bar.")];for(const n of t.actions){const o=n.actionKeybindingLabel;o?i.push(h(1164,"It has an action with label {0} and keybinding {1}.",n.actionLabel,o)):i.push(h(1165,"It has an action with label {0}.",n.actionLabel))}return i.join(`
`)}return t.participant.getAccessibleContent(t.hoverPart)}async updateHoverVerbosityLevel(e,t,i){if(!this._markdownHoverParticipant)return;let n;t>=0?n={start:t,endExclusive:t+1}:n=this._findRangeOfMarkdownHoverParts(this._markdownHoverParticipant);for(let o=n.start;o<n.endExclusive;o++){const r=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,o);if(r===void 0)continue;const a=await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(e,r);a&&(this._renderedParts[o]={type:"hoverPart",participant:this._markdownHoverParticipant,hoverPart:a.hoverPart,hoverElement:a.hoverElement})}i&&(t>=0?this.focusHoverPartWithIndex(t):this._context.focus()),this._context.onContentsChanged()}doesHoverAtIndexSupportVerbosityAction(e,t){if(!this._markdownHoverParticipant)return!1;const i=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,e);return i===void 0?!1:this._markdownHoverParticipant.doesMarkdownHoverAtIndexSupportVerbosityAction(i,t)}isColorPickerVisible(){return this._colorHoverParticipant?.isColorPickerVisible()??!1}_normalizedIndexToMarkdownHoverIndexRange(e,t){const i=this._renderedParts[t];if(!i||i.type!=="hoverPart"||!(i.participant===e))return;const o=this._renderedParts.findIndex(r=>r.type==="hoverPart"&&r.participant===e);if(o===-1)throw new ln;return t-o}_findRangeOfMarkdownHoverParts(e){const t=this._renderedParts.slice(),i=t.findIndex(r=>r.type==="hoverPart"&&r.participant===e),n=t.reverse().findIndex(r=>r.type==="hoverPart"&&r.participant===e),o=n>=0?t.length-n:n;return{start:i,endExclusive:o+1}}get domNode(){return this._fragment}get domNodeHasChildren(){return this._fragment.hasChildNodes()}get focusedHoverPartIndex(){return this._focusedHoverPartIndex}get hoverPartsCount(){return this._renderedParts.length}};oH=nH=f([p(4,Ve),p(5,wi)],oH);let rH=class extends F{constructor(e,t,i,n){super(),this._editor=e,this._instantiationService=t,this._keybindingService=i,this._hoverService=n,this._currentResult=null,this._renderedContentHover=this._register(new kt),this._onContentsChanged=this._register(new M),this.onContentsChanged=this._onContentsChanged.event,this._contentHoverWidget=this._register(this._instantiationService.createInstance(JV,this._editor)),this._participants=this._initializeHoverParticipants(),this._hoverOperation=this._register(new _de(this._editor,new $R(this._editor,this._participants))),this._registerListeners()}_initializeHoverParticipants(){const e=[];for(const t of s_.getAll()){const i=this._instantiationService.createInstance(t,this._editor);e.push(i)}return e.sort((t,i)=>t.hoverOrdinal-i.hoverOrdinal),this._register(this._contentHoverWidget.onDidResize(()=>{this._participants.forEach(t=>t.handleResize?.())})),this._register(this._contentHoverWidget.onDidScroll(t=>{this._participants.forEach(i=>i.handleScroll?.(t))})),e}_registerListeners(){this._register(this._hoverOperation.onResult(t=>{const i=t.hasLoadingMessage?this._addLoadingMessage(t):t.value;this._withResult(new bde(i,t.isComplete,t.options))}));const e=this._contentHoverWidget.getDomNode();this._register(co(e,"keydown",t=>{t.equals(S.Escape)&&this.hide()})),this._register(co(e,"mouseleave",t=>{this._onMouseLeave(t)})),this._register(Ave.onDidChange(()=>{this._contentHoverWidget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)}))}_startShowingOrUpdateHover(e,t,i,n,o){if(!(this._contentHoverWidget.position&&this._currentResult))return e?(this._startHoverOperationIfNecessary(e,t,i,n,!1),!0):!1;const a=this._editor.getOption(L.hover).sticky,c=o&&this._contentHoverWidget.isMouseGettingCloser(o.event.posx,o.event.posy);return a&&c?(e&&this._startHoverOperationIfNecessary(e,t,i,n,!0),!0):e?this._currentResult&&this._currentResult.options.anchor.equals(e)?!0:this._currentResult&&e.canAdoptVisibleHover(this._currentResult.options.anchor,this._contentHoverWidget.position)?(this._currentResult&&this._setCurrentResult(this._currentResult.filter(e)),this._startHoverOperationIfNecessary(e,t,i,n,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(e,t,i,n,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(e,t,i,n,o){if(this._hoverOperation.options&&this._hoverOperation.options.anchor.equals(e))return;this._hoverOperation.cancel();const a={anchor:e,source:i,shouldFocus:n,insistOnKeepingHoverVisible:o};this._hoverOperation.start(t,a)}_setCurrentResult(e){let t=e;if(this._currentResult===t)return;t&&t.hoverParts.length===0&&(t=null),this._currentResult=t,this._currentResult?this._showHover(this._currentResult):this._hideHover()}_addLoadingMessage(e){for(const t of this._participants){if(!t.createLoadingMessage)continue;const i=t.createLoadingMessage(e.options.anchor);if(i)return e.value.slice(0).concat([i])}return e.value}_withResult(e){if(this._contentHoverWidget.position&&this._currentResult&&this._currentResult.isComplete||this._setCurrentResult(e),!e.isComplete)return;const n=e.hoverParts.length===0,o=e.options.insistOnKeepingHoverVisible;n&&o||this._setCurrentResult(e)}_showHover(e){const t=this._getHoverContext();this._renderedContentHover.value=new sH(this._editor,e,this._participants,t,this._keybindingService,this._hoverService),this._renderedContentHover.value.domNodeHasChildren?this._contentHoverWidget.show(this._renderedContentHover.value):this._renderedContentHover.clear()}_hideHover(){this._contentHoverWidget.hide(),this._participants.forEach(e=>e.handleHide?.())}_getHoverContext(){return{hide:()=>{this.hide()},onContentsChanged:()=>{this._onContentsChanged.fire(),this._contentHoverWidget.onContentsChanged()},setMinimumDimensions:o=>{this._contentHoverWidget.setMinimumDimensions(o)},focus:()=>this.focus()}}showsOrWillShow(e){if(this._contentHoverWidget.isResizing)return!0;const i=this._findHoverAnchorCandidates(e);if(!(i.length>0))return this._startShowingOrUpdateHover(null,Rh.Delayed,ll.Mouse,!1,e);const o=i[0];return this._startShowingOrUpdateHover(o,Rh.Delayed,ll.Mouse,!1,e)}_findHoverAnchorCandidates(e){const t=[];for(const n of this._participants){if(!n.suggestHoverAnchor)continue;const o=n.suggestHoverAnchor(e);o&&t.push(o)}const i=e.target;switch(i.type){case Ei.CONTENT_TEXT:{t.push(new k0(0,i.range,e.event.posx,e.event.posy));break}case Ei.CONTENT_EMPTY:{const n=this._editor.getOption(L.fontInfo).typicalHalfwidthCharacterWidth/2;if(!(!i.detail.isAfterLines&&typeof i.detail.horizontalDistanceToText=="number"&&i.detail.horizontalDistanceToText<n))break;t.push(new k0(0,i.range,e.event.posx,e.event.posy));break}}return t.sort((n,o)=>o.priority-n.priority),t}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!CO(t,e.x,e.y))&&this.hide()}startShowingAtRange(e,t,i,n){this._startShowingOrUpdateHover(new k0(0,e,void 0,void 0),t,i,n,null)}getWidgetContent(){const e=this._contentHoverWidget.getDomNode();if(e.textContent)return e.textContent}async updateHoverVerbosityLevel(e,t,i){this._renderedContentHover.value?.updateHoverVerbosityLevel(e,t,i)}doesHoverAtIndexSupportVerbosityAction(e,t){return this._renderedContentHover.value?.doesHoverAtIndexSupportVerbosityAction(e,t)??!1}getAccessibleWidgetContent(){return this._renderedContentHover.value?.getAccessibleWidgetContent()}getAccessibleWidgetContentAtIndex(e){return this._renderedContentHover.value?.getAccessibleWidgetContentAtIndex(e)}focusedHoverPartIndex(){return this._renderedContentHover.value?.focusedHoverPartIndex??-1}containsNode(e){return e?this._contentHoverWidget.getDomNode().contains(e):!1}focus(){if(this._renderedContentHover.value?.hoverPartsCount===1){this.focusHoverPartWithIndex(0);return}this._contentHoverWidget.focus()}focusHoverPartWithIndex(e){this._renderedContentHover.value?.focusHoverPartWithIndex(e)}scrollUp(){this._contentHoverWidget.scrollUp()}scrollDown(){this._contentHoverWidget.scrollDown()}scrollLeft(){this._contentHoverWidget.scrollLeft()}scrollRight(){this._contentHoverWidget.scrollRight()}pageUp(){this._contentHoverWidget.pageUp()}pageDown(){this._contentHoverWidget.pageDown()}goToTop(){this._contentHoverWidget.goToTop()}goToBottom(){this._contentHoverWidget.goToBottom()}hide(){this._hoverOperation.cancel(),this._setCurrentResult(null)}getDomNode(){return this._contentHoverWidget.getDomNode()}get isColorPickerVisible(){return this._renderedContentHover.value?.isColorPickerVisible()??!1}get isVisibleFromKeyboard(){return this._contentHoverWidget.isVisibleFromKeyboard}get isVisible(){return this._contentHoverWidget.isVisible}get isFocused(){return this._contentHoverWidget.isFocused}get isResizing(){return this._contentHoverWidget.isResizing}get widget(){return this._contentHoverWidget}};rH=f([p(1,J),p(2,Ve),p(3,wi)],rH);const xO=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function Rde(s){const e=s.target;return!!e&&e.type===Ei.CONTENT_TEXT&&e.detail.injectedText?.options.attachedData===Dde}var aH;Be(xO);let ps=class extends F{static{aH=this}static{this.ID="editor.contrib.contentHover"}constructor(e,t,i){super(),this._editor=e,this._instantiationService=t,this._keybindingService=i,this._onHoverContentsChanged=this._register(new M),this.onHoverContentsChanged=this._onHoverContentsChanged.event,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new U,this._isMouseDown=!1,this._reactToEditorMouseMoveRunner=this._register(new fn(()=>{this._mouseMoveEvent&&this._reactToEditorMouseMove(this._mouseMoveEvent)},0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.hover)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(aH.ID)}_hookListeners(){const e=this._editor.getOption(L.hover);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled||this._cancelSchedulerAndHide(),this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>this._cancelSchedulerAndHide())),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelSchedulerAndHide(){this._cancelScheduler(),this.hideContentHover()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideContentHover()}_onEditorMouseDown(e){this._isMouseDown=!0,!this._shouldKeepHoverWidgetVisible(e)&&this.hideContentHover()}_shouldKeepHoverWidgetVisible(e){return this._isMouseOnContentHoverWidget(e)||this._isContentWidgetResizing()||Rde(e)}_isMouseOnContentHoverWidget(e){return this._contentWidget?CO(this._contentWidget.getDomNode(),e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._isMouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._shouldKeepHoverWidgetVisible(e))||this.hideContentHover()}_shouldKeepCurrentHover(e){const t=this._contentWidget;if(!t)return!1;const i=this._hoverSettings.sticky,n=(l,u)=>{const g=this._isMouseOnContentHoverWidget(l);return u&&g},o=l=>{const u=t.isColorPickerVisible,g=this._isMouseOnContentHoverWidget(l),m=u&&g,v=u&&this._isMouseDown;return m||v},r=(l,u)=>{const g=l.event.browserEvent.view;return g?u&&t.containsNode(g.document.activeElement)&&!g.getSelection()?.isCollapsed:!1},a=t.isFocused,c=t.isResizing,d=this._hoverSettings.sticky&&t.isVisibleFromKeyboard;return this.shouldKeepOpenOnEditorMouseMoveOrLeave||a||c||d||n(e,i)||o(e)||r(e,i)}_onEditorMouseMove(e){if(this._mouseMoveEvent=e,this._shouldKeepCurrentHover(e)){this._reactToEditorMouseMoveRunner.cancel();return}if(this._shouldRescheduleHoverComputation()){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(this._hoverSettings.hidingDelay);return}this._reactToEditorMouseMove(e)}_shouldRescheduleHoverComputation(){const e=this._hoverSettings.hidingDelay;return(this._contentWidget?.isVisible??!1)&&this._hoverSettings.sticky&&e>0}_reactToEditorMouseMove(e){this._hoverSettings.enabled&&this._getOrCreateContentWidget().showsOrWillShow(e)||this.hideContentHover()}_onKeyDown(e){if(!this._contentWidget)return;const t=this._isPotentialKeyboardShortcut(e),i=this._isModifierKeyPressed(e);t||i||this._contentWidget.isFocused&&e.keyCode===S.Tab||this.hideContentHover()}_isPotentialKeyboardShortcut(e){if(!this._editor.hasModel()||!this._contentWidget)return!1;const t=this._keybindingService.softDispatch(e,this._editor.getDomNode()),i=t.kind===UT.MoreChordsNeeded,n=t.kind===UT.KbFound&&(t.commandId===pde||t.commandId===zw||t.commandId===Kw)&&this._contentWidget.isVisible;return i||n}_isModifierKeyPressed(e){return e.keyCode===S.Ctrl||e.keyCode===S.Alt||e.keyCode===S.Meta||e.keyCode===S.Shift}hideContentHover(){By.dropDownVisible||this._contentWidget?.hide()}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(rH,this._editor),this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()))),this._contentWidget}showContentHover(e,t,i,n){this._getOrCreateContentWidget().startShowingAtRange(e,t,i,n)}_isContentWidgetResizing(){return this._contentWidget?.widget.isResizing||!1}focusedHoverPartIndex(){return this._getOrCreateContentWidget().focusedHoverPartIndex()}doesHoverAtIndexSupportVerbosityAction(e,t){return this._getOrCreateContentWidget().doesHoverAtIndexSupportVerbosityAction(e,t)}updateHoverVerbosityLevel(e,t,i){this._getOrCreateContentWidget().updateHoverVerbosityLevel(e,t,i)}focus(){this._contentWidget?.focus()}focusHoverPartWithIndex(e){this._contentWidget?.focusHoverPartWithIndex(e)}scrollUp(){this._contentWidget?.scrollUp()}scrollDown(){this._contentWidget?.scrollDown()}scrollLeft(){this._contentWidget?.scrollLeft()}scrollRight(){this._contentWidget?.scrollRight()}pageUp(){this._contentWidget?.pageUp()}pageDown(){this._contentWidget?.pageDown()}goToTop(){this._contentWidget?.goToTop()}goToBottom(){this._contentWidget?.goToBottom()}getWidgetContent(){return this._contentWidget?.getWidgetContent()}getAccessibleWidgetContent(){return this._contentWidget?.getAccessibleWidgetContent()}getAccessibleWidgetContentAtIndex(e){return this._contentWidget?.getAccessibleWidgetContentAtIndex(e)}get isColorPickerVisible(){return this._contentWidget?.isColorPickerVisible}get isHoverVisible(){return this._contentWidget?.isVisible}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._contentWidget?.dispose()}};ps=aH=f([p(1,J),p(2,Ve)],ps);class hLe{constructor(e){this._editor=e}computeSync(e){const t=r=>({value:r}),i=this._editor.getLineDecorations(e.lineNumber),n=[],o=e.laneOrLine==="lineNo";if(!i)return n;for(const r of i){const a=r.options.glyphMargin?.position??TF.Center;if(!o&&a!==e.laneOrLine)continue;const c=o?r.options.lineNumberHoverMessage:r.options.glyphMarginHoverMessage;!c||CE(c)||n.push(...cw(c).map(t))}return n}}var cH;const CX=Y;let dH=class extends F{static{cH=this}static{this.ID="editor.contrib.modesGlyphHoverWidget"}constructor(e,t,i){super(),this._renderDisposeables=this._register(new U),this._editor=e,this._isVisible=!1,this._messages=[],this._hover=this._register(new nne(!0)),this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._markdownRenderer=new Rv({editor:this._editor},t,i),this._hoverOperation=this._register(new _de(this._editor,new hLe(this._editor))),this._register(this._hoverOperation.onResult(n=>this._withResult(n))),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.fontInfo)&&this._updateFont()})),this._register(co(this._hover.containerDomNode,"mouseleave",n=>{this._onMouseLeave(n)})),this._editor.addOverlayWidget(this)}dispose(){this._hoverComputerOptions=void 0,this._editor.removeOverlayWidget(this),super.dispose()}getId(){return cH.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(t=>this._editor.applyFontInfo(t))}_onModelDecorationsChanged(){this._isVisible&&this._hoverComputerOptions&&(this._hoverOperation.cancel(),this._hoverOperation.start(Rh.Delayed,this._hoverComputerOptions))}showsOrWillShow(e){const t=e.target;return t.type===Ei.GUTTER_GLYPH_MARGIN&&t.detail.glyphMarginLane?(this._startShowingAt(t.position.lineNumber,t.detail.glyphMarginLane),!0):t.type===Ei.GUTTER_LINE_NUMBERS?(this._startShowingAt(t.position.lineNumber,"lineNo"),!0):!1}_startShowingAt(e,t){this._hoverComputerOptions&&this._hoverComputerOptions.lineNumber===e&&this._hoverComputerOptions.laneOrLine===t||(this._hoverOperation.cancel(),this.hide(),this._hoverComputerOptions={lineNumber:e,laneOrLine:t},this._hoverOperation.start(Rh.Delayed,this._hoverComputerOptions))}hide(){this._hoverComputerOptions=void 0,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible))}_withResult(e){this._messages=e.value,this._messages.length>0?this._renderMessages(e.options.lineNumber,e.options.laneOrLine,this._messages):this.hide()}_renderMessages(e,t,i){this._renderDisposeables.clear();const n=document.createDocumentFragment();for(const o of i){const r=CX("div.hover-row.markdown-hover"),a=ee(r,CX("div.hover-contents")),c=this._renderDisposeables.add(this._markdownRenderer.render(o.value));a.appendChild(c.element),n.appendChild(r)}this._updateContents(n),this._showAt(e,t)}_updateContents(e){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(e),this._updateFont()}_showAt(e,t){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible));const i=this._editor.getLayoutInfo(),n=this._editor.getTopForLineNumber(e),o=this._editor.getScrollTop(),r=this._editor.getOption(L.lineHeight),a=this._hover.containerDomNode.clientHeight,c=n-o-(a-r)/2,d=i.glyphMarginLeft+i.glyphMarginWidth+(t==="lineNo"?i.lineNumbersWidth:0);this._hover.containerDomNode.style.left=`${d}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(c),0)}px`,this._hover.containerDomNode.style.zIndex="11"}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!CO(t,e.x,e.y))&&this.hide()}};dH=cH=f([p(1,fi),p(2,hi)],dH);var lH;Be(xO);let Hy=class extends F{static{lH=this}static{this.ID="editor.contrib.marginHover"}constructor(e,t){super(),this._editor=e,this._instantiationService=t,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new U,this._hoverState={mouseDown:!1},this._reactToEditorMouseMoveRunner=this._register(new fn(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(L.hover)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(lH.ID)}_hookListeners(){const e=this._editor.getOption(L.hover);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))):(this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this.hideGlyphHover()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideGlyphHover()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._isMouseOnGlyphHoverWidget(e)&&this.hideGlyphHover()}_isMouseOnGlyphHoverWidget(e){const t=this._glyphWidget?.getDomNode();return t?CO(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._isMouseOnGlyphHoverWidget(e))||this.hideGlyphHover()}_shouldNotRecomputeCurrentHoverWidget(e){const t=this._hoverSettings.sticky,i=this._isMouseOnGlyphHoverWidget(e);return t&&i}_onEditorMouseMove(e){if(this.shouldKeepOpenOnEditorMouseMoveOrLeave)return;if(this._mouseMoveEvent=e,this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}this._reactToEditorMouseMove(e)}_reactToEditorMouseMove(e){!e||this._tryShowHoverWidget(e)||this.hideGlyphHover()}_tryShowHoverWidget(e){return this._getOrCreateGlyphWidget().showsOrWillShow(e)}_onKeyDown(e){this._editor.hasModel()&&(e.keyCode===S.Ctrl||e.keyCode===S.Alt||e.keyCode===S.Meta||e.keyCode===S.Shift||this.hideGlyphHover())}hideGlyphHover(){this._glyphWidget?.hide()}_getOrCreateGlyphWidget(){return this._glyphWidget||(this._glyphWidget=this._instantiationService.createInstance(dH,this._editor)),this._glyphWidget}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._glyphWidget?.dispose()}};Hy=lH=f([p(1,J)],Hy);const uLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let gLe=class{constructor(e,t){this._link=e,this._provider=t}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}async resolve(e){return this._link.url?this._link.url:typeof this._provider.resolveLink=="function"?Promise.resolve(this._provider.resolveLink(this._link,e)).then(t=>(this._link=t||this._link,this._link.url?this.resolve(e):Promise.reject(new Error("missing")))):Promise.reject(new Error("missing"))}};class px{static{this.Empty=new px([])}constructor(e){this._disposables=new U;let t=[];for(const[i,n]of e){const o=i.links.map(r=>new gLe(r,n));t=px._union(t,o),NM(i)&&(this._disposables??=new U,this._disposables.add(i))}this.links=t}dispose(){this._disposables?.dispose(),this.links.length=0}static _union(e,t){const i=[];let n,o,r,a;for(n=0,r=0,o=e.length,a=t.length;n<o&&r<a;){const c=e[n],d=t[r];if(P.areIntersectingOrTouching(c.range,d.range)){n++;continue}P.compareRangesUsingStarts(c.range,d.range)<0?(i.push(c),n++):(i.push(d),r++)}for(;n<o;n++)i.push(e[n]);for(;r<a;r++)i.push(t[r]);return i}}async function Pde(s,e,t){const i=[],n=s.ordered(e).reverse().map(async(r,a)=>{try{const c=await r.provideLinks(e,t);c&&(i[a]=[c,r])}catch(c){kn(c)}});await Promise.all(n);let o=new px(Vt(i));return t.isCancellationRequested&&(o.dispose(),o=px.Empty),o}Ce.registerCommand("_executeLinkProvider",async(s,...e)=>{let[t,i]=e;St(t instanceof R),typeof i!="number"&&(i=0);const{linkProvider:n}=s.get(Ne),o=s.get(ai).getModel(t);if(!o)return[];const r=await Pde(n,o,ye.None);if(!r)return[];for(let c=0;c<Math.min(i,r.links.length);c++)await r.links[c].resolve(ye.None);const a=r.links.slice(0);return r.dispose(),a});var hH;Be(uLe);let gv=class extends F{static{hH=this}static{this.ID="editor.linkDetector"}static get(e){return e.getContribution(hH.ID)}constructor(e,t,i,n,o){super(),this.editor=e,this.openerService=t,this.notificationService=i,this.languageFeaturesService=n,this.providers=this.languageFeaturesService.linkProvider,this.debounceInformation=o.for(this.providers,"Links",{min:1e3,max:4e3}),this.computeLinks=this._register(new fn(()=>this.computeLinksNow(),1e3)),this.computePromise=null,this.activeLinksList=null,this.currentOccurrences={},this.activeLinkDecorationId=null;const r=this._register(new zN(e));this._register(r.onMouseMoveOrRelevantKeyDown(([a,c])=>{this._onEditorMouseMove(a,c)})),this._register(r.onExecute(a=>{this.onEditorMouseUp(a)})),this._register(r.onCancel(a=>{this.cleanUpActiveLinkDecoration()})),this._register(e.onDidChangeConfiguration(a=>{a.hasChanged(L.links)&&(this.updateDecorations([]),this.stop(),this.computeLinks.schedule(0))})),this._register(e.onDidChangeModelContent(a=>{this.editor.hasModel()&&this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()))})),this._register(e.onDidChangeModel(a=>{this.currentOccurrences={},this.activeLinkDecorationId=null,this.stop(),this.computeLinks.schedule(0)})),this._register(e.onDidChangeModelLanguage(a=>{this.stop(),this.computeLinks.schedule(0)})),this._register(this.providers.onDidChange(a=>{this.stop(),this.computeLinks.schedule(0)})),this.computeLinks.schedule(0)}async computeLinksNow(){if(!this.editor.hasModel()||!this.editor.getOption(L.links))return;const e=this.editor.getModel();if(!e.isTooLargeForSyncing()&&this.providers.has(e)){this.activeLinksList&&(this.activeLinksList.dispose(),this.activeLinksList=null),this.computePromise=En(t=>Pde(this.providers,e,t));try{const t=new zn(!1);if(this.activeLinksList=await this.computePromise,this.debounceInformation.update(e,t.elapsed()),e.isDisposed())return;this.updateDecorations(this.activeLinksList.links)}catch(t){mt(t)}finally{this.computePromise=null}}}updateDecorations(e){const t=this.editor.getOption(L.multiCursorModifier)==="altKey",i=[],n=Object.keys(this.currentOccurrences);for(const r of n){const a=this.currentOccurrences[r];i.push(a.decorationId)}const o=[];if(e)for(const r of e)o.push(Wb.decoration(r,t));this.editor.changeDecorations(r=>{const a=r.deltaDecorations(i,o);this.currentOccurrences={},this.activeLinkDecorationId=null;for(let c=0,d=a.length;c<d;c++){const l=new Wb(e[c],a[c]);this.currentOccurrences[l.decorationId]=l}})}_onEditorMouseMove(e,t){const i=this.editor.getOption(L.multiCursorModifier)==="altKey";if(this.isEnabled(e,t)){this.cleanUpActiveLinkDecoration();const n=this.getLinkOccurrence(e.target.position);n&&this.editor.changeDecorations(o=>{n.activate(o,i),this.activeLinkDecorationId=n.decorationId})}else this.cleanUpActiveLinkDecoration()}cleanUpActiveLinkDecoration(){const e=this.editor.getOption(L.multiCursorModifier)==="altKey";if(this.activeLinkDecorationId){const t=this.currentOccurrences[this.activeLinkDecorationId];t&&this.editor.changeDecorations(i=>{t.deactivate(i,e)}),this.activeLinkDecorationId=null}}onEditorMouseUp(e){if(!this.isEnabled(e))return;const t=this.getLinkOccurrence(e.target.position);t&&this.openLinkOccurrence(t,e.hasSideBySideModifier,!0)}openLinkOccurrence(e,t,i=!1){if(!this.openerService)return;const{link:n}=e;n.resolve(ye.None).then(o=>{if(typeof o=="string"&&this.editor.hasModel()){const r=this.editor.getModel().uri;if(r.scheme===ae.file&&o.startsWith(`${ae.file}:`)){const a=R.parse(o);if(a.scheme===ae.file){const c=Rve(a);let d=null;c.startsWith("/./")||c.startsWith("\\.\\")?d=`.${c.substr(1)}`:(c.startsWith("//./")||c.startsWith("\\\\.\\"))&&(d=`.${c.substr(2)}`),d&&(o=xt(r,d))}}}return this.openerService.open(o,{openToSide:t,fromUserGesture:i,allowContributedOpeners:!0,allowCommands:!0,fromWorkspace:!0})},o=>{const r=o instanceof Error?o.message:o;r==="invalid"?this.notificationService.warn(h(1335,"Failed to open this link because it is not well-formed: {0}",n.url.toString())):r==="missing"?this.notificationService.warn(h(1336,"Failed to open this link because its target is missing.")):mt(o)})}getLinkOccurrence(e){if(!this.editor.hasModel()||!e)return null;const t=this.editor.getModel().getDecorationsInRange({startLineNumber:e.lineNumber,startColumn:e.column,endLineNumber:e.lineNumber,endColumn:e.column},0,!0);for(const i of t){const n=this.currentOccurrences[i.id];if(n)return n}return null}isEnabled(e,t){return!!(e.target.type===Ei.CONTENT_TEXT&&(e.hasTriggerModifier||t&&t.keyCodeIsTriggerKey))}stop(){this.computeLinks.cancel(),this.activeLinksList&&(this.activeLinksList?.dispose(),this.activeLinksList=null),this.computePromise&&(this.computePromise.cancel(),this.computePromise=null)}dispose(){super.dispose(),this.stop()}};gv=hH=f([p(1,hi),p(2,At),p(3,Ne),p(4,Sd)],gv);const EX={general:Yt.register({description:"detected-link",stickiness:Di.NeverGrowsWhenTypingAtEdges,collapseOnReplaceEdit:!0,inlineClassName:"detected-link"}),active:Yt.register({description:"detected-link-active",stickiness:Di.NeverGrowsWhenTypingAtEdges,collapseOnReplaceEdit:!0,inlineClassName:"detected-link-active"})};class Wb{static decoration(e,t){return{range:e.range,options:Wb._getOptions(e,t,!1)}}static _getOptions(e,t,i){const n={...i?EX.active:EX.general};return n.hoverMessage=pLe(e,t),n}constructor(e,t){this.link=e,this.decorationId=t}activate(e,t){e.changeDecorationOptions(this.decorationId,Wb._getOptions(this.link,t,!0))}deactivate(e,t){e.changeDecorationOptions(this.decorationId,Wb._getOptions(this.link,t,!1))}}function pLe(s,e){const t=s.url&&/^command:/i.test(s.url.toString()),i=s.tooltip?s.tooltip:t?h(1337,"Execute command"):h(1338,"Follow link"),n=e?qt?h(1339,"cmd + click"):h(1340,"ctrl + click"):qt?h(1341,"option + click"):h(1342,"alt + click");if(s.url){let o="";if(/^command:/i.test(s.url.toString())){const a=s.url.toString().match(/^command:([^?#]+)/);if(a){const c=a[1];o=h(1343,"Execute command {0}",c)}}return new Ni("",!0).appendLink(s.url.toString(!0).replace(/ /g,"%20"),i,o).appendMarkdown(` (${n})`)}else return new Ni().appendText(`${i} (${n})`)}class fLe extends we{constructor(){super({id:"editor.action.openLink",label:I(1344,"Open Link"),precondition:void 0})}run(e,t){const i=gv.get(t);if(!i||!t.hasModel())return;const n=t.getSelections();for(const o of n){const r=i.getLinkOccurrence(o.getEndPosition());r&&i.openLinkOccurrence(r,!1)}}}Rt(gv.ID,gv,vt.AfterFirstRender);ue(fLe);Be(Pve);const mLe=h(14,"input"),vLe=h(15,"Preserve Case");class _Le extends rne{constructor(e){super({icon:j.preserveCase,title:vLe+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??yr("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class bLe extends uf{static{this.OPTION_CHANGE="optionChange"}constructor(e,t,i,n){super(),this._showOptionButtons=i,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new M),this.onDidOptionChange=this._onDidOptionChange.event,this._onKeyDown=this._register(new M),this.onKeyDown=this._onKeyDown.event,this._onMouseDown=this._register(new M),this.onMouseDown=this._onMouseDown.event,this._onInput=this._register(new M),this.onInput=this._onInput.event,this._onKeyUp=this._register(new M),this.onKeyUp=this._onKeyUp.event,this._onPreserveCaseKeyDown=this._register(new M),this.onPreserveCaseKeyDown=this._onPreserveCaseKeyDown.event,this._lastHighlightFindOptions=0,this.contextViewProvider=t,this.placeholder=n.placeholder||"",this.validation=n.validation,this.label=n.label||mLe;const o=n.appendPreserveCaseLabel||"",r=n.history||new Set([]),a=!!n.flexibleHeight,c=!!n.flexibleWidth,d=n.flexibleMaxHeight;this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new one(this.domNode,this.contextViewProvider,{ariaLabel:this.label||"",placeholder:this.placeholder||"",validationOptions:{validation:this.validation},history:r,showHistoryHint:n.showHistoryHint,flexibleHeight:a,flexibleWidth:c,flexibleMaxHeight:d,inputBoxStyles:n.inputBoxStyles})),this.preserveCase=this._register(new _Le({appendTitle:o,isChecked:!1,...n.toggleStyles})),this._register(this.preserveCase.onChange(g=>{this._onDidOptionChange.fire(g),!g&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(g=>{this._onPreserveCaseKeyDown.fire(g)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;const l=[this.preserveCase.domNode];this.onkeydown(this.domNode,g=>{if(g.equals(S.LeftArrow)||g.equals(S.RightArrow)||g.equals(S.Escape)){const m=l.indexOf(this.domNode.ownerDocument.activeElement);if(m>=0){let v=-1;g.equals(S.RightArrow)?v=(m+1)%l.length:g.equals(S.LeftArrow)&&(m===0?v=l.length-1:v=m-1),g.equals(S.Escape)?(l[m].blur(),this.inputBox.focus()):v>=0&&l[v].focus(),Li.stop(g,!0)}}});const u=document.createElement("div");u.className="controls",u.style.display=this._showOptionButtons?"block":"none",u.appendChild(this.preserveCase.domNode),this.domNode.appendChild(u),e?.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,g=>this._onKeyDown.fire(g)),this.onkeyup(this.inputBox.inputElement,g=>this._onKeyUp.fire(g)),this.oninput(this.inputBox.inputElement,g=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,g=>this._onMouseDown.fire(g))}enable(){this.domNode.classList.remove("disabled"),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add("disabled"),this.inputBox.disable(),this.preserveCase.disable()}setFocusInputOnOptionClick(e){this.fixFocusOnOptionClickEnabled=e}setEnabled(e){e?this.enable():this.disable()}clear(){this.clearValidation(),this.setValue(""),this.focus()}getValue(){return this.inputBox.value}setValue(e){this.inputBox.value!==e&&(this.inputBox.value=e)}onSearchSubmit(){this.inputBox.addToHistory()}applyStyles(){}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(e){this.preserveCase.checked=e}focusOnPreserve(){this.preserveCase.focus()}highlightFindOptions(){this.domNode.classList.remove("highlight-"+this._lastHighlightFindOptions),this._lastHighlightFindOptions=1-this._lastHighlightFindOptions,this.domNode.classList.add("highlight-"+this._lastHighlightFindOptions)}validate(){this.inputBox?.validate()}showMessage(e){this.inputBox?.showMessage(e)}clearMessage(){this.inputBox?.hideMessage()}clearValidation(){this.inputBox?.hideMessage()}set width(e){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=e+"px"}dispose(){super.dispose()}}const GK=new O("suggestWidgetVisible",!1,h(1890,"Whether suggestion are visible")),qK="historyNavigationWidgetFocus",Lde="historyNavigationForwardsEnabled",Mde="historyNavigationBackwardsEnabled";let BC;const XD=[];function IO(s,e){if(XD.includes(e))throw new Error("Cannot register the same widget multiple times");XD.push(e);const t=new U,i=new O(qK,!1).bindTo(s),n=new O(Lde,!0).bindTo(s),o=new O(Mde,!0).bindTo(s),r=()=>{i.set(!0),BC=e},a=()=>{i.set(!1),BC===e&&(BC=void 0)};return gf(e.element)&&r(),t.add(e.onDidFocus(()=>r())),t.add(e.onDidBlur(()=>a())),t.add(Ee(()=>{XD.splice(XD.indexOf(e),1),a()})),{historyNavigationForwardsEnablement:n,historyNavigationBackwardsEnablement:o,dispose(){t.dispose()}}}let uH=class extends one{constructor(e,t,i,n){super(e,t,i);const o=this._register(n.createScoped(this.element));this._register(IO(o,this))}};uH=f([p(3,me)],uH);let gH=class extends Lve{constructor(e,t,i,n){super(e,t,i);const o=this._register(n.createScoped(this.inputBox.element));this._register(IO(o,this.inputBox))}};gH=f([p(3,me)],gH);let pH=class extends bLe{constructor(e,t,i,n,o=!1){super(e,t,o,i);const r=this._register(n.createScoped(this.inputBox.element));this._register(IO(r,this.inputBox))}};pH=f([p(3,me)],pH);Le.registerCommandAndKeybindingRule({id:"history.showPrevious",weight:W.WorkbenchContrib,when:x.and(x.has(qK),x.equals(Mde,!0),x.not("isComposing"),GK.isEqualTo(!1)),primary:S.UpArrow,secondary:[E.Alt|S.UpArrow],handler:s=>{BC?.showPreviousValue()}});Le.registerCommandAndKeybindingRule({id:"history.showNext",weight:W.WorkbenchContrib,when:x.and(x.has(qK),x.equals(Lde,!0),x.not("isComposing"),GK.isEqualTo(!1)),primary:S.DownArrow,secondary:[E.Alt|S.DownArrow],handler:s=>{BC?.showNextValue()}});const ut={Visible:GK,HasFocusedSuggestion:new O("suggestWidgetHasFocusedSuggestion",!1,h(1505,"Whether any suggestion is focused")),DetailsVisible:new O("suggestWidgetDetailsVisible",!1,h(1506,"Whether suggestion details are visible")),MultipleSuggestions:new O("suggestWidgetMultipleSuggestions",!1,h(1507,"Whether there are multiple suggestions to pick from")),MakesTextEdit:new O("suggestionMakesTextEdit",!0,h(1508,"Whether inserting the current suggestion yields in a change or has everything already been typed")),AcceptSuggestionsOnEnter:new O("acceptSuggestionOnEnter",!0,h(1509,"Whether suggestions are inserted when pressing Enter")),HasInsertAndReplaceRange:new O("suggestionHasInsertAndReplaceRange",!1,h(1510,"Whether the current suggestion has insert and replace behaviour")),InsertMode:new O("suggestionInsertMode",void 0,{type:"string",description:h(1511,"Whether the default behaviour is to insert or replace")}),CanResolve:new O("suggestionCanResolve",!1,h(1512,"Whether the current suggestion supports to resolve further details"))},xp=new N("suggestWidgetStatusBar");class yLe{constructor(e,t,i,n){this.position=e,this.completion=t,this.container=i,this.provider=n,this.isInvalid=!1,this.score=_E.Default,this.distance=0,this.textLabel=typeof t.label=="string"?t.label:t.label?.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=t.sortText&&t.sortText.toLowerCase(),this.filterTextLow=t.filterText&&t.filterText.toLowerCase(),this.extensionId=t.extensionId,P.isIRange(t.range)?(this.editStart=new _e(t.range.startLineNumber,t.range.startColumn),this.editInsertEnd=new _e(t.range.endLineNumber,t.range.endColumn),this.editReplaceEnd=new _e(t.range.endLineNumber,t.range.endColumn),this.isInvalid=this.isInvalid||P.spansMultipleLines(t.range)||t.range.startLineNumber!==e.lineNumber):(this.editStart=new _e(t.range.insert.startLineNumber,t.range.insert.startColumn),this.editInsertEnd=new _e(t.range.insert.endLineNumber,t.range.insert.endColumn),this.editReplaceEnd=new _e(t.range.replace.endLineNumber,t.range.replace.endColumn),this.isInvalid=this.isInvalid||P.spansMultipleLines(t.range.insert)||P.spansMultipleLines(t.range.replace)||t.range.insert.startLineNumber!==e.lineNumber||t.range.replace.startLineNumber!==e.lineNumber||t.range.insert.startColumn!==t.range.replace.startColumn),typeof n.resolveCompletionItem!="function"&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration!==void 0?this._resolveDuration:-1}async resolve(e){if(!this._resolveCache){const t=e.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),i=new zn(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,e)).then(n=>{Object.assign(this.completion,n),this._resolveDuration=i.elapsed()},n=>{gs(n)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{t.dispose()})}return this._resolveCache}}var Bu;(function(s){s[s.Top=0]="Top",s[s.Inline=1]="Inline",s[s.Bottom=2]="Bottom"})(Bu||(Bu={}));class eD{static{this.default=new eD}constructor(e=Bu.Bottom,t=new Set,i=new Set,n=new Map,o=!0){this.snippetSortOrder=e,this.kindFilter=t,this.providerFilter=i,this.providerItemsToReuse=n,this.showDeprecated=o}}let ap;function wLe(){return ap}function SLe(s){const e=ap;return ap=s,e}class CLe{constructor(e,t,i,n){this.items=e,this.needsClipboard=t,this.durations=i,this.disposable=n}}async function zK(s,e,t,i=eD.default,n={triggerKind:_a.Invoke},o=ye.None){const r=new zn;t=t.clone();const a=e.getWordAtPosition(t),c=a?new P(t.lineNumber,a.startColumn,t.lineNumber,a.endColumn):P.fromPositions(t),d={replace:c,insert:c.setEndPosition(t.lineNumber,t.column)},l=[],u=new U,g=[];let m=!1;const v=(w,C,T)=>{let k=!1;if(!C)return k;for(const A of C.suggestions)if(!i.kindFilter.has(A.kind)){if(!i.showDeprecated&&A?.tags?.includes(OT.Deprecated))continue;A.range||(A.range=d),A.sortText||(A.sortText=typeof A.label=="string"?A.label:A.label.label),!m&&A.insertTextRules&&A.insertTextRules&dh.InsertAsSnippet&&(m=fd.guessNeedsClipboard(A.insertText)),l.push(new yLe(t,A,C,w)),k=!0}return NM(C)&&u.add(C),g.push({providerName:w._debugDisplayName??"unknown_provider",elapsedProvider:C.duration??-1,elapsedOverall:T.elapsed()}),k},y=(async()=>{if(!ap||i.kindFilter.has(De.Snippet))return;const w=i.providerItemsToReuse.get(ap);if(w){w.forEach(k=>l.push(k));return}if(i.providerFilter.size>0&&!i.providerFilter.has(ap))return;const C=new zn,T=await ap.provideCompletionItems(e,t,n,o);v(ap,T,C)})();for(const w of s.orderedGroups(e)){let C=!1;if(await Promise.all(w.map(async T=>{if(i.providerItemsToReuse.has(T)){const k=i.providerItemsToReuse.get(T);k.forEach(A=>l.push(A)),C=C||k.length>0;return}if(!(i.providerFilter.size>0&&!i.providerFilter.has(T)))try{const k=new zn,A=await T.provideCompletionItems(e,t,n,o);C=v(T,A,k)||C}catch(k){kn(k)}})),C||o.isCancellationRequested)break}return await y,o.isCancellationRequested?(u.dispose(),Promise.reject(new $s)):new CLe(l.sort(ILe(i.snippetSortOrder)),m,{entries:g,elapsed:r.elapsed()},u)}function KK(s,e){if(s.sortTextLow&&e.sortTextLow){if(s.sortTextLow<e.sortTextLow)return-1;if(s.sortTextLow>e.sortTextLow)return 1}return s.textLabel<e.textLabel?-1:s.textLabel>e.textLabel?1:s.completion.kind-e.completion.kind}function ELe(s,e){if(s.completion.kind!==e.completion.kind){if(s.completion.kind===De.Snippet)return-1;if(e.completion.kind===De.Snippet)return 1}return KK(s,e)}function xLe(s,e){if(s.completion.kind!==e.completion.kind){if(s.completion.kind===De.Snippet)return 1;if(e.completion.kind===De.Snippet)return-1}return KK(s,e)}const DO=new Map;DO.set(Bu.Top,ELe);DO.set(Bu.Bottom,xLe);DO.set(Bu.Inline,KK);function ILe(s){return DO.get(s)}Ce.registerCommand("_executeCompletionItemProvider",async(s,...e)=>{const[t,i,n,o]=e;St(R.isUri(t)),St(_e.isIPosition(i)),St(typeof n=="string"||!n),St(typeof o=="number"||!o);const{completionProvider:r}=s.get(Ne),a=await s.get(yi).createModelReference(t);try{const c={incomplete:!1,suggestions:[]},d=[],l=a.object.textEditorModel.validatePosition(i),u=await zK(r,a.object.textEditorModel,l,void 0,{triggerCharacter:n??void 0,triggerKind:n?_a.TriggerCharacter:_a.Invoke});for(const g of u.items)d.length<(o??0)&&d.push(g.resolve(ye.None)),c.incomplete=c.incomplete||g.container.incomplete,c.suggestions.push(g.completion);try{return await Promise.all(d),c}finally{setTimeout(()=>u.disposable.dispose(),100)}}finally{a.dispose()}});function Nde(s,e){s.getContribution("editor.contrib.suggestController")?.triggerSuggest(new Set().add(e),void 0,!0)}class hb{static isAllOff(e){return e.other==="off"&&e.comments==="off"&&e.strings==="off"}static isAllOn(e){return e.other==="on"&&e.comments==="on"&&e.strings==="on"}static valueFor(e,t){switch(t){case Xc.Comment:return e.comments;case Xc.String:return e.strings;default:return e.other}}}const DLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),kLe=Object.freeze({CURRENT_YEAR:!0,CURRENT_YEAR_SHORT:!0,CURRENT_MONTH:!0,CURRENT_DATE:!0,CURRENT_HOUR:!0,CURRENT_MINUTE:!0,CURRENT_SECOND:!0,CURRENT_DAY_NAME:!0,CURRENT_DAY_NAME_SHORT:!0,CURRENT_MONTH_NAME:!0,CURRENT_MONTH_NAME_SHORT:!0,CURRENT_SECONDS_UNIX:!0,CURRENT_TIMEZONE_OFFSET:!0,SELECTION:!0,CLIPBOARD:!0,TM_SELECTED_TEXT:!0,TM_CURRENT_LINE:!0,TM_CURRENT_WORD:!0,TM_LINE_INDEX:!0,TM_LINE_NUMBER:!0,TM_FILENAME:!0,TM_FILENAME_BASE:!0,TM_DIRECTORY:!0,TM_FILEPATH:!0,CURSOR_INDEX:!0,CURSOR_NUMBER:!0,RELATIVE_FILEPATH:!0,BLOCK_COMMENT_START:!0,BLOCK_COMMENT_END:!0,LINE_COMMENT:!0,WORKSPACE_NAME:!0,WORKSPACE_FOLDER:!0,RANDOM:!0,RANDOM_HEX:!0,UUID:!0});class xX{constructor(e){this._delegates=e}resolve(e){for(const t of this._delegates){const i=t.resolve(e);if(i!==void 0)return i}}}class IX{constructor(e,t,i,n){this._model=e,this._selection=t,this._selectionIdx=i,this._overtypingCapturer=n}resolve(e){const{name:t}=e;if(t==="SELECTION"||t==="TM_SELECTED_TEXT"){let i=this._model.getValueInRange(this._selection)||void 0,n=this._selection.startLineNumber!==this._selection.endLineNumber;if(!i&&this._overtypingCapturer){const o=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);o&&(i=o.value,n=o.multiline)}if(i&&n&&e.snippet){const o=this._model.getLineContent(this._selection.startLineNumber),r=to(o,0,this._selection.startColumn-1);let a=r;e.snippet.walk(d=>d===e?!1:(d instanceof pr&&(a=to(Ih(d.value).pop())),!0));const c=rf(a,r);i=i.replace(/(\r\n|\r|\n)(.*)/g,(d,l,u)=>`${l}${a.substr(c)}${u}`)}return i}else{if(t==="TM_CURRENT_LINE")return this._model.getLineContent(this._selection.positionLineNumber);if(t==="TM_CURRENT_WORD"){const i=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return i&&i.word||void 0}else{if(t==="TM_LINE_INDEX")return String(this._selection.positionLineNumber-1);if(t==="TM_LINE_NUMBER")return String(this._selection.positionLineNumber);if(t==="CURSOR_INDEX")return String(this._selectionIdx);if(t==="CURSOR_NUMBER")return String(this._selectionIdx+1)}}}}class DX{constructor(e,t){this._labelService=e,this._model=t}resolve(e){const{name:t}=e;if(t==="TM_FILENAME")return Sn(this._model.uri.fsPath);if(t==="TM_FILENAME_BASE"){const i=Sn(this._model.uri.fsPath),n=i.lastIndexOf(".");return n<=0?i:i.slice(0,n)}else{if(t==="TM_DIRECTORY")return wq(this._model.uri.fsPath)==="."?"":this._labelService.getUriLabel(hs(this._model.uri));if(t==="TM_FILEPATH")return this._labelService.getUriLabel(this._model.uri);if(t==="RELATIVE_FILEPATH")return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}}}class kX{constructor(e,t,i,n){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=i,this._spread=n}resolve(e){if(e.name!=="CLIPBOARD")return;const t=this._readClipboardText();if(t){if(this._spread){const i=t.split(/\r\n|\n|\r/).filter(n=>!wu(n));if(i.length===this._selectionCount)return i[this._selectionIdx]}return t}}}let jR=class{constructor(e,t,i){this._model=e,this._selection=t,this._languageConfigurationService=i}resolve(e){const{name:t}=e,i=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),n=this._languageConfigurationService.getLanguageConfiguration(i).comments;if(n){if(t==="LINE_COMMENT")return n.lineCommentToken||void 0;if(t==="BLOCK_COMMENT_START")return n.blockCommentStartToken||void 0;if(t==="BLOCK_COMMENT_END")return n.blockCommentEndToken||void 0}}};jR=f([p(2,rs)],jR);class fm{constructor(){this._date=new Date}static{this.dayNames=[h(1456,"Sunday"),h(1457,"Monday"),h(1458,"Tuesday"),h(1459,"Wednesday"),h(1460,"Thursday"),h(1461,"Friday"),h(1462,"Saturday")]}static{this.dayNamesShort=[h(1463,"Sun"),h(1464,"Mon"),h(1465,"Tue"),h(1466,"Wed"),h(1467,"Thu"),h(1468,"Fri"),h(1469,"Sat")]}static{this.monthNames=[h(1470,"January"),h(1471,"February"),h(1472,"March"),h(1473,"April"),h(1474,"May"),h(1475,"June"),h(1476,"July"),h(1477,"August"),h(1478,"September"),h(1479,"October"),h(1480,"November"),h(1481,"December")]}static{this.monthNamesShort=[h(1482,"Jan"),h(1483,"Feb"),h(1484,"Mar"),h(1485,"Apr"),h(1486,"May"),h(1487,"Jun"),h(1488,"Jul"),h(1489,"Aug"),h(1490,"Sep"),h(1491,"Oct"),h(1492,"Nov"),h(1493,"Dec")]}resolve(e){const{name:t}=e;if(t==="CURRENT_YEAR")return String(this._date.getFullYear());if(t==="CURRENT_YEAR_SHORT")return String(this._date.getFullYear()).slice(-2);if(t==="CURRENT_MONTH")return String(this._date.getMonth().valueOf()+1).padStart(2,"0");if(t==="CURRENT_DATE")return String(this._date.getDate().valueOf()).padStart(2,"0");if(t==="CURRENT_HOUR")return String(this._date.getHours().valueOf()).padStart(2,"0");if(t==="CURRENT_MINUTE")return String(this._date.getMinutes().valueOf()).padStart(2,"0");if(t==="CURRENT_SECOND")return String(this._date.getSeconds().valueOf()).padStart(2,"0");if(t==="CURRENT_DAY_NAME")return fm.dayNames[this._date.getDay()];if(t==="CURRENT_DAY_NAME_SHORT")return fm.dayNamesShort[this._date.getDay()];if(t==="CURRENT_MONTH_NAME")return fm.monthNames[this._date.getMonth()];if(t==="CURRENT_MONTH_NAME_SHORT")return fm.monthNamesShort[this._date.getMonth()];if(t==="CURRENT_SECONDS_UNIX")return String(Math.floor(this._date.getTime()/1e3));if(t==="CURRENT_TIMEZONE_OFFSET"){const i=this._date.getTimezoneOffset(),n=i>0?"-":"+",o=Math.trunc(Math.abs(i/60)),r=o<10?"0"+o:o,a=Math.abs(i)-o*60,c=a<10?"0"+a:a;return n+r+":"+c}}}class TX{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;const t=cC(this._workspaceService.getWorkspace());if(!Mve(t)){if(e.name==="WORKSPACE_NAME")return this._resolveWorkspaceName(t);if(e.name==="WORKSPACE_FOLDER")return this._resoveWorkspacePath(t)}}_resolveWorkspaceName(e){if(SE(e))return Sn(e.uri.path);let t=Sn(e.configPath.path);return t.endsWith(E7)&&(t=t.substr(0,t.length-E7.length-1)),t}_resoveWorkspacePath(e){if(SE(e))return $T(e.uri.fsPath);const t=Sn(e.configPath.path);let i=e.configPath.fsPath;return i.endsWith(t)&&(i=i.substr(0,i.length-t.length-1)),i?$T(i):"/"}}class AX{resolve(e){const{name:t}=e;if(t==="RANDOM")return Math.random().toString().slice(-6);if(t==="RANDOM_HEX")return Math.random().toString(16).slice(-6);if(t==="UUID")return Dn()}}var Pd;Be(DLe);class Wc{static{this._decor={active:Yt.register({description:"snippet-placeholder-1",stickiness:Di.AlwaysGrowsWhenTypingAtEdges,className:"snippet-placeholder"}),inactive:Yt.register({description:"snippet-placeholder-2",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"snippet-placeholder"}),activeFinal:Yt.register({description:"snippet-placeholder-3",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"finish-snippet-placeholder"}),inactiveFinal:Yt.register({description:"snippet-placeholder-4",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"finish-snippet-placeholder"})}}constructor(e,t,i){this._editor=e,this._snippet=t,this._snippetLineLeadingWhitespace=i,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=VT(t.placeholders,Xr.compareByIndex),this._placeholderGroupsIdx=-1}initialize(e){this._offset=e.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw new Error("Snippet not initialized!");if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;const e=this._editor.getModel();this._editor.changeDecorations(t=>{for(const i of this._snippet.placeholders){const n=this._snippet.offset(i),o=this._snippet.fullLen(i),r=P.fromPositions(e.getPositionAt(this._offset+n),e.getPositionAt(this._offset+n+o)),a=i.isFinalTabstop?Wc._decor.inactiveFinal:Wc._decor.inactive,c=t.addDecoration(r,a);this._placeholderDecorations.set(i,c)}})}move(e){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){const n=[];for(const o of this._placeholderGroups[this._placeholderGroupsIdx])if(o.transform){const r=this._placeholderDecorations.get(o),a=this._editor.getModel().getDecorationRange(r),c=this._editor.getModel().getValueInRange(a),d=o.transform.resolve(c).split(/\r\n|\r|\n/);for(let l=1;l<d.length;l++)d[l]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+d[l]);n.push(Ki.replace(a,d.join(this._editor.getModel().getEOL())))}n.length>0&&this._editor.executeEdits("snippet.placeholderTransform",n)}let t=!1;e===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,t=!0):e===!1&&this._placeholderGroupsIdx>0&&(this._placeholderGroupsIdx-=1,t=!0);const i=this._editor.getModel().changeDecorations(n=>{const o=new Set,r=[];for(const a of this._placeholderGroups[this._placeholderGroupsIdx]){const c=this._placeholderDecorations.get(a),d=this._editor.getModel().getDecorationRange(c);r.push(new at(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn)),t=t&&this._hasPlaceholderBeenCollapsed(a),n.changeDecorationOptions(c,a.isFinalTabstop?Wc._decor.activeFinal:Wc._decor.active),o.add(a);for(const l of this._snippet.enclosingPlaceholders(a)){const u=this._placeholderDecorations.get(l);n.changeDecorationOptions(u,l.isFinalTabstop?Wc._decor.activeFinal:Wc._decor.active),o.add(l)}}for(const[a,c]of this._placeholderDecorations)o.has(a)||n.changeDecorationOptions(c,a.isFinalTabstop?Wc._decor.inactiveFinal:Wc._decor.inactive);return r});return t?this.move(e):i??[]}_hasPlaceholderBeenCollapsed(e){let t=e;for(;t;){if(t instanceof Xr){const i=this._placeholderDecorations.get(t);if(this._editor.getModel().getDecorationRange(i).isEmpty()&&t.toString().length>0)return!0}t=t.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){const[e]=this._snippet.placeholders;if(e.isFinalTabstop&&this._snippet.rightMostDescendant===e)return!0}return!1}computePossibleSelections(){const e=new Map;for(const t of this._placeholderGroups){let i;for(const n of t){if(n.isFinalTabstop)break;i||(i=[],e.set(n.index,i));const o=this._placeholderDecorations.get(n),r=this._editor.getModel().getDecorationRange(o);if(!r){e.delete(n.index);break}i.push(r)}}return e}get activeChoice(){if(!this._placeholderDecorations)return;const e=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!e?.choice)return;const t=this._placeholderDecorations.get(e);if(!t)return;const i=this._editor.getModel().getDecorationRange(t);if(i)return{range:i,choice:e.choice}}get hasChoice(){let e=!1;return this._snippet.walk(t=>(e=t instanceof qw,!e)),e}merge(e){const t=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(i=>{for(const n of this._placeholderGroups[this._placeholderGroupsIdx]){const o=e.shift();console.assert(o._offset!==-1),console.assert(!o._placeholderDecorations);const r=o._snippet.placeholderInfo.last.index;for(const c of o._snippet.placeholderInfo.all)c.isFinalTabstop?c.index=n.index+(r+1)/this._nestingLevel:c.index=n.index+c.index/this._nestingLevel;this._snippet.replace(n,o._snippet.children);const a=this._placeholderDecorations.get(n);i.removeDecoration(a),this._placeholderDecorations.delete(n);for(const c of o._snippet.placeholders){const d=o._snippet.offset(c),l=o._snippet.fullLen(c),u=P.fromPositions(t.getPositionAt(o._offset+d),t.getPositionAt(o._offset+d+l)),g=i.addDecoration(u,Wc._decor.inactive);this._placeholderDecorations.set(c,g)}}this._placeholderGroups=VT(this._snippet.placeholders,Xr.compareByIndex)})}getEnclosingRange(){let e;const t=this._editor.getModel();for(const i of this._placeholderDecorations.values()){const n=t.getDecorationRange(i)??void 0;e?e=e.plusRange(n):e=n}return e}}const RX={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let YR=Pd=class{static adjustWhitespace(e,t,i,n,o){const r=e.getLineContent(t.lineNumber),a=to(r,0,t.column-1);let c;return n.walk(d=>{if(!(d instanceof pr)||d.parent instanceof qw||o&&!o.has(d))return!0;const l=d.value.split(/\r\n|\r|\n/);if(i){const g=n.offset(d);if(g===0)l[0]=e.normalizeIndentation(l[0]);else{c=c??n.toString();const m=c.charCodeAt(g-1);(m===st.LineFeed||m===st.CarriageReturn)&&(l[0]=e.normalizeIndentation(a+l[0]))}for(let m=1;m<l.length;m++)l[m]=e.normalizeIndentation(a+l[m])}const u=l.join(e.getEOL());return u!==d.value&&(d.parent.replace(d,[new pr(u)]),c=void 0),!0}),a}static adjustSelection(e,t,i,n){if(i!==0||n!==0){const{positionLineNumber:o,positionColumn:r}=t,a=r-i,c=r+n,d=e.validateRange({startLineNumber:o,startColumn:a,endLineNumber:o,endColumn:c});t=at.createWithDirection(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn,t.getDirection())}return t}static createEditsAndSnippetsFromSelections(e,t,i,n,o,r,a,c,d){const l=[],u=[];if(!e.hasModel())return{edits:l,snippets:u};const g=e.getModel(),m=e.invokeWithinContext(A=>A.get(Tt)),v=e.invokeWithinContext(A=>new DX(A.get(di),g)),y=()=>a,w=g.getValueInRange(Pd.adjustSelection(g,e.getSelection(),i,0)),C=g.getValueInRange(Pd.adjustSelection(g,e.getSelection(),0,n)),T=g.getLineFirstNonWhitespaceColumn(e.getSelection().positionLineNumber),k=e.getSelections().map((A,B)=>({selection:A,idx:B})).sort((A,B)=>P.compareRangesUsingStarts(A.selection,B.selection));for(const{selection:A,idx:B}of k){let z=Pd.adjustSelection(g,A,i,0),Q=Pd.adjustSelection(g,A,0,n);w!==g.getValueInRange(z)&&(z=A),C!==g.getValueInRange(Q)&&(Q=A);const ie=A.setStartPosition(z.startLineNumber,z.startColumn).setEndPosition(Q.endLineNumber,Q.endColumn),oe=new fd().parse(t,!0,o),xe=ie.getStartPosition(),Se=Pd.adjustWhitespace(g,xe,r||B>0&&T!==g.getLineFirstNonWhitespaceColumn(A.positionLineNumber),oe);oe.resolveVariables(new xX([v,new kX(y,B,k.length,e.getOption(L.multiCursorPaste)==="spread"),new IX(g,A,B,c),new jR(g,A,d),new fm,new TX(m),new AX])),l[B]=Ki.replace(ie,oe.toString()),l[B].identifier={major:B,minor:0},l[B]._isTracked=!0,u[B]=new Wc(e,oe,Se)}return{edits:l,snippets:u}}static createEditsAndSnippetsFromEdits(e,t,i,n,o,r,a){if(!e.hasModel()||t.length===0)return{edits:[],snippets:[]};const c=[],d=e.getModel(),l=new fd,u=new JI,g=new xX([e.invokeWithinContext(v=>new DX(v.get(di),d)),new kX(()=>o,0,e.getSelections().length,e.getOption(L.multiCursorPaste)==="spread"),new IX(d,e.getSelection(),0,r),new jR(d,e.getSelection(),a),new fm,new TX(e.invokeWithinContext(v=>v.get(Tt))),new AX]);t=t.sort((v,y)=>P.compareRangesUsingStarts(v.range,y.range));let m=0;for(let v=0;v<t.length;v++){const{range:y,template:w,keepWhitespace:C}=t[v];if(v>0){const z=t[v-1].range,Q=P.fromPositions(z.getEndPosition(),y.getStartPosition()),ie=new pr(d.getValueInRange(Q));u.appendChild(ie),m+=ie.value.length}const T=l.parseFragment(w,u);Pd.adjustWhitespace(d,y.getStartPosition(),C!==void 0?!C:n,u,new Set(T)),u.resolveVariables(g);const k=u.toString(),A=k.slice(m);m=k.length;const B=Ki.replace(y,A);B.identifier={major:v,minor:0},B._isTracked=!0,c.push(B)}return l.ensureFinalTabstop(u,i,!0),{edits:c,snippets:[new Wc(e,u,"")]}}constructor(e,t,i=RX,n){this._editor=e,this._template=t,this._options=i,this._languageConfigurationService=n,this._templateMerges=[],this._snippets=[]}dispose(){Qe(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(" -> ")}"`}insert(){if(!this._editor.hasModel())return;const{edits:e,snippets:t}=typeof this._template=="string"?Pd.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):Pd.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=t,this._editor.executeEdits("snippet",e,i=>{const n=i.filter(o=>!!o.identifier);for(let o=0;o<t.length;o++)t[o].initialize(n[o].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):n.map(o=>at.fromPositions(o.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(e,t=RX){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,e]);const{edits:i,snippets:n}=Pd.createEditsAndSnippetsFromSelections(this._editor,e,t.overwriteBefore,t.overwriteAfter,!0,t.adjustWhitespace,t.clipboardText,t.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits("snippet",i,o=>{const r=o.filter(c=>!!c.identifier);for(let c=0;c<n.length;c++)n[c].initialize(r[c].textChange);const a=n[0].isTrivialSnippet;if(!a){for(const c of this._snippets)c.merge(n);console.assert(n.length===0)}return this._snippets[0].hasPlaceholder&&!a?this._move(void 0):r.map(c=>at.fromPositions(c.range.getEndPosition()))})}next(){const e=this._move(!0);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}prev(){const e=this._move(!1);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}_move(e){const t=[];for(const i of this._snippets){const n=i.move(e);t.push(...n)}return t}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;const e=this._editor.getSelections();if(e.length<this._snippets.length)return!1;const t=new Map;for(const i of this._snippets){const n=i.computePossibleSelections();if(t.size===0)for(const[o,r]of n){r.sort(P.compareRangesUsingStarts);for(const a of e)if(r[0].containsRange(a)){t.set(o,[]);break}}if(t.size===0)return!1;t.forEach((o,r)=>{o.push(...n.get(r))})}e.sort(P.compareRangesUsingStarts);for(const[i,n]of t){if(n.length!==e.length){t.delete(i);continue}n.sort(P.compareRangesUsingStarts);for(let o=0;o<n.length;o++)if(!n[o].containsRange(e[o])){t.delete(i);continue}}return t.size>0}getEnclosingRange(){let e;for(const t of this._snippets){const i=t.getEnclosingRange();e?e=e.plusRange(i):e=i}return e}};YR=Pd=f([p(3,rs)],YR);var T_;const ZD={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let os=class{static{T_=this}static{this.ID="snippetController2"}static get(e){return e.getContribution(T_.ID)}static{this.InSnippetMode=new O("inSnippetMode",!1,h(1452,"Whether the editor in current in snippet mode"))}static{this.HasNextTabstop=new O("hasNextTabstop",!1,h(1453,"Whether there is a next tab stop when in snippet mode"))}static{this.HasPrevTabstop=new O("hasPrevTabstop",!1,h(1454,"Whether there is a previous tab stop when in snippet mode"))}constructor(e,t,i,n,o){this._editor=e,this._logService=t,this._languageFeaturesService=i,this._languageConfigurationService=o,this._snippetListener=new U,this._modelVersionId=-1,this._inSnippet=T_.InSnippetMode.bindTo(n),this._hasNextTabstop=T_.HasNextTabstop.bindTo(n),this._hasPrevTabstop=T_.HasPrevTabstop.bindTo(n)}dispose(){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._session?.dispose(),this._snippetListener.dispose()}apply(e,t){try{this._doInsert(e,typeof t>"u"?ZD:{...ZD,...t})}catch(i){this.cancel(),this._logService.error(i),this._logService.error("snippet_error"),this._logService.error("insert_edits=",e),this._logService.error("existing_template=",this._session?this._session._logInfo():"<no_session>")}}insert(e,t){try{this._doInsert(e,typeof t>"u"?ZD:{...ZD,...t})}catch(i){this.cancel(),this._logService.error(i),this._logService.error("snippet_error"),this._logService.error("insert_template=",e),this._logService.error("existing_template=",this._session?this._session._logInfo():"<no_session>")}}_doInsert(e,t){if(this._editor.hasModel()){if(this._snippetListener.clear(),t.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof e!="string"&&this.cancel(),this._session?(St(typeof e=="string"),this._session.merge(e,t)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new YR(this._editor,e,t,this._languageConfigurationService),this._session.insert()),t.undoStopAfter&&this._editor.getModel().pushStackElement(),this._session?.hasChoice){const i={_debugDisplayName:"snippetChoiceCompletions",provideCompletionItems:(d,l)=>{if(!this._session||d!==this._editor.getModel()||!_e.equals(this._editor.getPosition(),l))return;const{activeChoice:u}=this._session;if(!u||u.choice.options.length===0)return;const g=d.getValueInRange(u.range),m=!!u.choice.options.find(y=>y.value===g),v=[];for(let y=0;y<u.choice.options.length;y++){const w=u.choice.options[y];v.push({kind:De.Value,label:w.value,insertText:w.value,sortText:"a".repeat(y+1),range:u.range,filterText:m?`${g}_${w.value}`:void 0,command:{id:"jumpToNextSnippetPlaceholder",title:h(1455,"Go to next placeholder...")}})}return{suggestions:v}}},n=this._editor.getModel();let o,r=!1;const a=()=>{o?.dispose(),r=!1},c=()=>{r||(o=this._languageFeaturesService.completionProvider.register({language:n.getLanguageId(),pattern:n.uri.fsPath,scheme:n.uri.scheme,exclusive:!0},i),this._snippetListener.add(o),r=!0)};this._choiceCompletions={provider:i,enable:c,disable:a}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(i=>i.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId())return this.cancel();if(!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}const{activeChoice:e}=this._session;if(!e||!this._choiceCompletions){this._choiceCompletions?.disable(),this._currentChoice=void 0;return}this._currentChoice!==e.choice&&(this._currentChoice=e.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{Nde(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(e=!1){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,this._session?.dispose(),this._session=void 0,this._modelVersionId=-1,e&&this._editor.setSelections([this._editor.getSelection()])}prev(){this._session?.prev(),this._updateState()}next(){this._session?.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}getSessionEnclosingRange(){if(this._session)return this._session.getEnclosingRange()}};os=T_=f([p(1,Pe),p(2,Ne),p(3,me),p(4,rs)],os);Rt(os.ID,os,vt.Lazy);const kO=No.bindToContribution(os.get);Ue(new kO({id:"jumpToNextSnippetPlaceholder",precondition:x.and(os.InSnippetMode,os.HasNextTabstop),handler:s=>s.next(),kbOpts:{weight:W.EditorContrib+30,kbExpr:V.textInputFocus,primary:S.Tab}}));Ue(new kO({id:"jumpToPrevSnippetPlaceholder",precondition:x.and(os.InSnippetMode,os.HasPrevTabstop),handler:s=>s.prev(),kbOpts:{weight:W.EditorContrib+30,kbExpr:V.textInputFocus,primary:E.Shift|S.Tab}}));Ue(new kO({id:"leaveSnippet",precondition:os.InSnippetMode,handler:s=>s.cancel(!0),kbOpts:{weight:W.EditorContrib+30,kbExpr:V.textInputFocus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));Ue(new kO({id:"acceptSnippet",precondition:os.InSnippetMode,handler:s=>s.finish()}));var fH;let QR=class{static{fH=this}static{this.AtEnd=new O("atEndOfWord",!1,{type:"boolean",description:h(1541,"A context key that is true when at the end of a word. Note that this is only defined when tab-completions are enabled")})}constructor(e,t){this._editor=e,this._enabled=!1,this._ckAtEnd=fH.AtEnd.bindTo(t),this._configListener=this._editor.onDidChangeConfiguration(i=>i.hasChanged(L.tabCompletion)&&this._update()),this._update()}dispose(){this._configListener.dispose(),this._selectionListener?.dispose(),this._ckAtEnd.reset()}_update(){const e=this._editor.getOption(L.tabCompletion)==="on";if(this._enabled!==e)if(this._enabled=e,this._enabled){const t=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}const i=this._editor.getModel(),n=this._editor.getSelection(),o=i.getWordAtPosition(n.getStartPosition());if(!o){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(o.endColumn===n.getStartPosition().column&&n.getStartPosition().lineNumber===n.getEndPosition().lineNumber)};this._selectionListener=this._editor.onDidChangeCursorSelection(t),t()}else this._selectionListener&&(this._ckAtEnd.reset(),this._selectionListener.dispose(),this._selectionListener=void 0)}};QR=fH=f([p(1,me)],QR);var zS;let Uy=class{static{zS=this}static{this.OtherSuggestions=new O("hasOtherSuggestions",!1)}constructor(e,t){this._editor=e,this._index=0,this._ckOtherSuggestions=zS.OtherSuggestions.bindTo(t)}dispose(){this.reset()}reset(){this._ckOtherSuggestions.reset(),this._listener?.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:e,index:t},i){if(e.items.length===0){this.reset();return}if(zS._moveIndex(!0,e,t)===t){this.reset();return}this._acceptNext=i,this._model=e,this._index=t,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(e,t,i){let n=i;for(let o=t.items.length;o>0&&(n=(n+t.items.length+(e?1:-1))%t.items.length,!(n===i||!t.items[n].completion.additionalTextEdits));o--);return n}next(){this._move(!0)}prev(){this._move(!1)}_move(e){if(this._model)try{this._ignore=!0,this._index=zS._moveIndex(e,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}};Uy=zS=f([p(1,me)],Uy);class Bc{async provideSelectionRanges(e,t){const i=[];for(const n of t){const o=[];i.push(o);const r=new Map;await new Promise(a=>Bc._bracketsRightYield(a,0,e,n,r)),await new Promise(a=>Bc._bracketsLeftYield(a,0,e,n,r,o))}return i}static{this._maxDuration=30}static{this._maxRounds=2}static _bracketsRightYield(e,t,i,n,o){const r=new Map,a=Date.now();for(;;){if(t>=Bc._maxRounds){e();break}if(!n){e();break}const c=i.bracketPairs.findNextBracket(n);if(!c){e();break}if(Date.now()-a>Bc._maxDuration){setTimeout(()=>Bc._bracketsRightYield(e,t+1,i,n,o));break}if(c.bracketInfo.isOpeningBracket){const l=c.bracketInfo.bracketText,u=r.has(l)?r.get(l):0;r.set(l,u+1)}else{const l=c.bracketInfo.getOpeningBrackets()[0].bracketText;let u=r.has(l)?r.get(l):0;if(u-=1,r.set(l,Math.max(0,u)),u<0){let g=o.get(l);g||(g=new aq,o.set(l,g)),g.push(c.range)}}n=c.range.getEndPosition()}}static _bracketsLeftYield(e,t,i,n,o,r){const a=new Map,c=Date.now();for(;;){if(t>=Bc._maxRounds&&o.size===0){e();break}if(!n){e();break}const d=i.bracketPairs.findPrevBracket(n);if(!d){e();break}if(Date.now()-c>Bc._maxDuration){setTimeout(()=>Bc._bracketsLeftYield(e,t+1,i,n,o,r));break}if(d.bracketInfo.isOpeningBracket){const u=d.bracketInfo.bracketText;let g=a.has(u)?a.get(u):0;if(g-=1,a.set(u,Math.max(0,g)),g<0){const m=o.get(u);if(m){const v=m.shift();m.size===0&&o.delete(u);const y=P.fromPositions(d.range.getEndPosition(),v.getStartPosition()),w=P.fromPositions(d.range.getStartPosition(),v.getEndPosition());r.push({range:y}),r.push({range:w}),Bc._addBracketLeading(i,w,r)}}}else{const u=d.bracketInfo.getOpeningBrackets()[0].bracketText,g=a.has(u)?a.get(u):0;a.set(u,g+1)}n=d.range.getStartPosition()}}static _addBracketLeading(e,t,i){if(t.startLineNumber===t.endLineNumber)return;const n=t.startLineNumber,o=e.getLineFirstNonWhitespaceColumn(n);o!==0&&o!==t.startColumn&&(i.push({range:P.fromPositions(new _e(n,o),t.getEndPosition())}),i.push({range:P.fromPositions(new _e(n,1),t.getEndPosition())}));const r=n-1;if(r>0){const a=e.getLineFirstNonWhitespaceColumn(r);a===t.startColumn&&a!==e.getLineLastNonWhitespaceColumn(r)&&(i.push({range:P.fromPositions(new _e(r,a),t.getEndPosition())}),i.push({range:P.fromPositions(new _e(r,1),t.getEndPosition())}))}}}class Ql{static{this.None=new class extends Ql{distance(){return 0}}}static async create(e,t){if(!t.getOption(L.suggest).localityBonus||!t.hasModel())return Ql.None;const i=t.getModel(),n=t.getPosition();if(!e.canComputeWordRanges(i.uri))return Ql.None;const[o]=await new Bc().provideSelectionRanges(i,[n]);if(o.length===0)return Ql.None;const r=await e.computeWordRanges(i.uri,o[0].range);if(!r)return Ql.None;const a=i.getWordUntilPosition(n);return delete r[a.word],new class extends Ql{distance(c,d){if(!n.equals(t.getPosition()))return 0;if(d.kind===De.Keyword)return 2<<20;const l=typeof d.label=="string"?d.label:d.label.label,u=r[l];if(Nve(u))return 2<<20;const g=AT(u,P.fromPositions(c),P.compareRangesUsingStarts),m=g>=0?u[g]:u[Math.max(0,~g-1)];let v=o.length;for(const y of o){if(!P.containsRange(y.range,m))break;v-=1}return v}}}}let PX=class{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}};var ip;(function(s){s[s.Nothing=0]="Nothing",s[s.All=1]="All",s[s.Incr=2]="Incr"})(ip||(ip={}));class cp{constructor(e,t,i,n,o,r,a=ane.default,c=void 0){this.clipboardText=c,this._snippetCompareFn=cp._compareCompletionItems,this._items=e,this._column=t,this._wordDistance=n,this._options=o,this._refilterKind=ip.All,this._lineContext=i,this._fuzzyScoreOptions=a,r==="top"?this._snippetCompareFn=cp._compareCompletionItemsSnippetsUp:r==="bottom"&&(this._snippetCompareFn=cp._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?ip.Incr:ip.All,this._lineContext=e)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();const e=new Set;for(const[t,i]of this.getItemsByProvider())i.length>0&&i[0].container.incomplete&&e.add(t);return e}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==ip.Nothing&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;const e=[],{leadingLineContent:t,characterCountDelta:i}=this._lineContext;let n="",o="";const r=this._refilterKind===ip.All?this._items:this._filteredItems,a=[],c=!this._options.filterGraceful||r.length>2e3?Sq:Ove;for(let d=0;d<r.length;d++){const l=r[d];if(l.isInvalid)continue;const u=this._itemsByProvider.get(l.provider);u?u.push(l):this._itemsByProvider.set(l.provider,[l]);const g=l.position.column-l.editStart.column,m=g+i-(l.position.column-this._column);if(n.length!==m&&(n=m===0?"":t.slice(-m),o=n.toLowerCase()),l.word=n,m===0)l.score=_E.Default;else{let v=0;for(;v<g;){const y=n.charCodeAt(v);if(y===st.Space||y===st.Tab)v+=1;else break}if(v>=m)l.score=_E.Default;else if(typeof l.completion.filterText=="string"){const y=c(n,o,v,l.completion.filterText,l.filterTextLow,0,this._fuzzyScoreOptions);if(!y)continue;RS(l.completion.filterText,l.textLabel)===0?l.score=y:(l.score=Fve(n,o,v,l.textLabel,l.labelLow,0),l.score[0]=y[0])}else{const y=c(n,o,v,l.textLabel,l.labelLow,0,this._fuzzyScoreOptions);if(!y)continue;l.score=y}}l.idx=d,l.distance=this._wordDistance.distance(l.position,l.completion),a.push(l),e.push(l.textLabel.length)}this._filteredItems=a.sort(this._snippetCompareFn),this._refilterKind=ip.Nothing,this._stats={pLabelLen:e.length?Wve(e.length-.85,e,(d,l)=>d-l):0}}static _compareCompletionItems(e,t){return e.score[0]>t.score[0]?-1:e.score[0]<t.score[0]?1:e.distance<t.distance?-1:e.distance>t.distance?1:e.idx<t.idx?-1:e.idx>t.idx?1:0}static _compareCompletionItemsSnippetsDown(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===De.Snippet)return 1;if(t.completion.kind===De.Snippet)return-1}return cp._compareCompletionItems(e,t)}static _compareCompletionItemsSnippetsUp(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===De.Snippet)return-1;if(t.completion.kind===De.Snippet)return 1}return cp._compareCompletionItems(e,t)}}class Ti{static{this.inlineSuggestionVisible=new O("inlineSuggestionVisible",!1,h(1255,"Whether an inline suggestion is visible"))}static{this.inlineSuggestionHasIndentation=new O("inlineSuggestionHasIndentation",!1,h(1256,"Whether the inline suggestion starts with whitespace"))}static{this.inlineSuggestionHasIndentationLessThanTabSize=new O("inlineSuggestionHasIndentationLessThanTabSize",!0,h(1257,"Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab"))}static{this.suppressSuggestions=new O("inlineSuggestionSuppressSuggestions",void 0,h(1258,"Whether suggestions should be suppressed for the current suggestion"))}static{this.cursorInIndentation=new O("cursorInIndentation",!1,h(1259,"Whether the cursor is in indentation"))}static{this.hasSelection=new O("editor.hasSelection",!1,h(1260,"Whether the editor has a selection"))}static{this.cursorAtInlineEdit=new O("cursorAtInlineEdit",!1,h(1261,"Whether the cursor is at an inline edit"))}static{this.inlineEditVisible=new O("inlineEditIsVisible",!1,h(1262,"Whether an inline edit is visible"))}static{this.tabShouldJumpToInlineEdit=new O("tabShouldJumpToInlineEdit",!1,h(1263,"Whether tab should jump to an inline edit."))}static{this.tabShouldAcceptInlineEdit=new O("tabShouldAcceptInlineEdit",!1,h(1264,"Whether tab should accept the inline edit."))}static{this.inInlineEditsPreviewEditor=new O("inInlineEditsPreviewEditor",!0,h(1265,"Whether the current code editor is showing an inline edits preview"))}}var mH;class Nf{static shouldAutoTrigger(e){if(!e.hasModel())return!1;const t=e.getModel(),i=e.getPosition();t.tokenization.tokenizeIfCheap(i.lineNumber);const n=t.getWordAtPosition(i);return!(!n||n.endColumn!==i.column&&n.startColumn+1!==i.column||!isNaN(Number(n.word)))}constructor(e,t,i){this.leadingLineContent=e.getLineContent(t.lineNumber).substr(0,t.column-1),this.leadingWord=e.getWordUntilPosition(t),this.lineNumber=t.lineNumber,this.column=t.column,this.triggerOptions=i}}var Ip;(function(s){s[s.Idle=0]="Idle",s[s.Manual=1]="Manual",s[s.Auto=2]="Auto"})(Ip||(Ip={}));function TLe(s,e,t){if(!e.getContextKeyValue(Ti.inlineSuggestionVisible.key))return!0;const i=e.getContextKeyValue(Ti.suppressSuggestions.key);return i!==void 0?!i:!s.getOption(L.inlineSuggest).suppressSuggestions}function ALe(s,e,t){if(!e.getContextKeyValue("inlineSuggestionVisible"))return!0;const i=e.getContextKeyValue(Ti.suppressSuggestions.key);return i!==void 0?!i:!s.getOption(L.inlineSuggest).suppressSuggestions}let XR=mH=class{constructor(e,t,i,n,o,r,a,c,d){this._editor=e,this._editorWorkerService=t,this._clipboardService=i,this._telemetryService=n,this._logService=o,this._contextKeyService=r,this._configurationService=a,this._languageFeaturesService=c,this._envService=d,this._toDispose=new U,this._triggerCharacterListener=new U,this._triggerQuickSuggest=new iI,this._triggerState=void 0,this._completionDisposables=new U,this._onDidCancel=new M,this._onDidTrigger=new M,this._onDidSuggest=new M,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._currentSelection=this._editor.getSelection()||new at(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let l=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{l=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{l=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(u=>{l||this._onCursorChange(u)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!l&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){Qe(this._triggerCharacterListener),Qe([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(L.readOnly)||!this._editor.hasModel()||!this._editor.getOption(L.suggestOnTriggerCharacters))return;const e=new Map;for(const i of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(const n of i.triggerCharacters||[]){let o=e.get(n);if(!o){o=new Set;const r=wLe();r&&o.add(r),e.set(n,o)}o.add(i)}const t=i=>{if(!ALe(this._editor,this._contextKeyService)||Nf.shouldAutoTrigger(this._editor))return;if(!i){const r=this._editor.getPosition();i=this._editor.getModel().getLineContent(r.lineNumber).substr(0,r.column-1)}let n="";Bve(i.charCodeAt(i.length-1))?Vve(i.charCodeAt(i.length-2))&&(n=i.substr(i.length-2)):n=i.charAt(i.length-1);const o=e.get(n);if(o){const r=new Map;if(this._completionModel)for(const[a,c]of this._completionModel.getItemsByProvider())o.has(a)||r.set(a,c);this.trigger({auto:!0,triggerKind:_a.TriggerCharacter,triggerCharacter:n,retrigger:!!this._completionModel,clipboardText:this._completionModel?.clipboardText,completionOptions:{providerFilter:o,providerItemsToReuse:r}})}};this._triggerCharacterListener.add(this._editor.onDidType(t)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>t()))}get state(){return this._triggerState?this._triggerState.auto?Ip.Auto:Ip.Manual:Ip.Idle}cancel(e=!1){this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),this._requestToken?.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:e}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(e){if(!this._editor.hasModel())return;const t=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!e.selection.isEmpty()||e.reason!==Ls.NotSet&&e.reason!==Ls.Explicit||e.source!=="keyboard"&&e.source!=="deleteLeft"){this.cancel();return}this._triggerState===void 0&&e.reason===Ls.NotSet?(t.containsRange(this._currentSelection)||t.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&e.reason===Ls.Explicit&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){hb.isAllOff(this._editor.getOption(L.quickSuggestions))||this._editor.getOption(L.suggest).snippetsPreventQuickSuggestions&&os.get(this._editor)?.isInSnippet()||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!Nf.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;const e=this._editor.getModel(),t=this._editor.getPosition(),i=this._editor.getOption(L.quickSuggestions);if(!hb.isAllOff(i)){if(!hb.isAllOn(i)){e.tokenization.tokenizeIfCheap(t.lineNumber);const n=e.tokenization.getLineTokens(t.lineNumber),o=n.getStandardTokenType(n.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(hb.valueFor(i,o)!=="on")return}TLe(this._editor,this._contextKeyService)&&this._languageFeaturesService.completionProvider.has(e)&&this.trigger({auto:!0})}},this._editor.getOption(L.quickSuggestionsDelay)))}_refilterCompletionItems(){St(this._editor.hasModel()),St(this._triggerState!==void 0);const e=this._editor.getModel(),t=this._editor.getPosition(),i=new Nf(e,t,{...this._triggerState,refilter:!0});this._onNewContext(i)}trigger(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),i=new Nf(t,this._editor.getPosition(),e);this.cancel(e.retrigger),this._triggerState=e,this._onDidTrigger.fire({auto:e.auto,shy:e.shy??!1,position:this._editor.getPosition()}),this._context=i;let n={triggerKind:e.triggerKind??_a.Invoke};e.triggerCharacter&&(n={triggerKind:_a.TriggerCharacter,triggerCharacter:e.triggerCharacter}),this._requestToken=new ri;const o=this._editor.getOption(L.snippetSuggestions);let r=Bu.Inline;switch(o){case"top":r=Bu.Top;break;case"bottom":r=Bu.Bottom;break}const{itemKind:a,showDeprecated:c}=mH.createSuggestFilter(this._editor),d=new eD(r,e.completionOptions?.kindFilter??a,e.completionOptions?.providerFilter,e.completionOptions?.providerItemsToReuse,c),l=Ql.create(this._editorWorkerService,this._editor),u=zK(this._languageFeaturesService.completionProvider,t,this._editor.getPosition(),d,n,this._requestToken.token);Promise.all([u,l]).then(async([g,m])=>{if(this._requestToken?.dispose(),!this._editor.hasModel()){g.disposable.dispose();return}let v=e?.clipboardText;if(!v&&g.needsClipboard&&(v=await this._clipboardService.readText()),this._triggerState===void 0){g.disposable.dispose();return}const y=this._editor.getModel(),w=new Nf(y,this._editor.getPosition(),e),C={...ane.default,firstMatchCanBeWeak:!this._editor.getOption(L.suggest).matchOnWordStartOnly};if(this._completionModel=new cp(g.items,this._context.column,{leadingLineContent:w.leadingLineContent,characterCountDelta:w.column-this._context.column},m,this._editor.getOption(L.suggest),this._editor.getOption(L.snippetSuggestions),C,v),this._completionDisposables.add(g.disposable),this._onNewContext(w),this._reportDurationsTelemetry(g.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(const T of g.items)T.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${T.provider._debugDisplayName}`,T.completion)}).catch(mt)}_reportDurationsTelemetry(e){Math.random()>1e-4||setTimeout(()=>{this._telemetryService.publicLog2("suggest.durations.json",{data:JSON.stringify(e)}),this._logService.debug("suggest.durations.json",e)})}static createSuggestFilter(e){const t=new Set;e.getOption(L.snippetSuggestions)==="none"&&t.add(De.Snippet);const n=e.getOption(L.suggest);return n.showMethods||t.add(De.Method),n.showFunctions||t.add(De.Function),n.showConstructors||t.add(De.Constructor),n.showFields||t.add(De.Field),n.showVariables||t.add(De.Variable),n.showClasses||t.add(De.Class),n.showStructs||t.add(De.Struct),n.showInterfaces||t.add(De.Interface),n.showModules||t.add(De.Module),n.showProperties||t.add(De.Property),n.showEvents||t.add(De.Event),n.showOperators||t.add(De.Operator),n.showUnits||t.add(De.Unit),n.showValues||t.add(De.Value),n.showConstants||t.add(De.Constant),n.showEnums||t.add(De.Enum),n.showEnumMembers||t.add(De.EnumMember),n.showKeywords||t.add(De.Keyword),n.showWords||t.add(De.Text),n.showColors||t.add(De.Color),n.showFiles||t.add(De.File),n.showReferences||t.add(De.Reference),n.showColors||t.add(De.Customcolor),n.showFolders||t.add(De.Folder),n.showTypeParameters||t.add(De.TypeParameter),n.showSnippets||t.add(De.Snippet),n.showUsers||t.add(De.User),n.showIssues||t.add(De.Issue),{itemKind:t,showDeprecated:n.showDeprecated}}_onNewContext(e){if(this._context){if(e.lineNumber!==this._context.lineNumber){this.cancel();return}if(to(e.leadingLineContent)!==to(this._context.leadingLineContent)){this.cancel();return}if(e.column<this._context.column){e.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(e.leadingWord.word.length!==0&&e.leadingWord.startColumn>this._context.leadingWord.startColumn){if(Nf.shouldAutoTrigger(this._editor)&&this._context){const i=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:i}})}return}if(e.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&e.leadingWord.word.length!==0){const t=new Map,i=new Set;for(const[n,o]of this._completionModel.getItemsByProvider())o.length>0&&o[0].container.incomplete?i.add(n):t.set(n,o);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:_a.TriggerForIncompleteCompletions,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:i,providerItemsToReuse:t}})}else{const t=this._completionModel.lineContext;let i=!1;if(this._completionModel.lineContext={leadingLineContent:e.leadingLineContent,characterCountDelta:e.column-this._context.column},this._completionModel.items.length===0){const n=Nf.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(n&&this._context.leadingWord.endColumn<e.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=t,i=this._completionModel.items.length>0,i&&e.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:e.triggerOptions,isFrozen:i})}}}}};XR=mH=f([p(1,vc),p(2,Is),p(3,li),p(4,Pe),p(5,me),p(6,ne),p(7,Ne),p(8,po)],XR);class RLe{constructor(e,t,i,n){this._disposables=new U,this._disposables.add(i.onDidSuggest(o=>{o.completionModel.items.length===0&&this.reset()})),this._disposables.add(i.onDidCancel(o=>{this.reset()})),this._disposables.add(t.onDidShow(()=>this._onItem(t.getFocusedItem()))),this._disposables.add(t.onDidFocus(this._onItem,this)),this._disposables.add(t.onDidHide(this.reset,this)),this._disposables.add(e.onWillType(o=>{if(this._active&&!t.isFrozen()&&i.state!==Ip.Idle){const r=o.charCodeAt(o.length-1);this._active.acceptCharacters.has(r)&&e.getOption(L.acceptSuggestionOnCommitCharacter)&&n(this._active.item)}}))}_onItem(e){if(!e||!xn(e.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===e.item)return;const t=new GT;for(const i of e.item.completion.commitCharacters)i.length>0&&t.add(i.charCodeAt(0));this._active={acceptCharacters:t,item:e}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}}class jK{static{this._maxSelectionLength=51200}constructor(e,t){this._disposables=new U,this._lastOvertyped=[],this._locked=!1,this._disposables.add(e.onWillType(()=>{if(this._locked||!e.hasModel())return;const i=e.getSelections(),n=i.length;let o=!1;for(let a=0;a<n;a++)if(!i[a].isEmpty()){o=!0;break}if(!o){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];const r=e.getModel();for(let a=0;a<n;a++){const c=i[a];if(r.getValueLengthInRange(c)>jK._maxSelectionLength)return;this._lastOvertyped[a]={value:r.getValueInRange(c),multiline:c.startLineNumber!==c.endLineNumber}}})),this._disposables.add(t.onDidTrigger(i=>{this._locked=!0})),this._disposables.add(t.onDidCancel(i=>{this._locked=!1}))}getLastOvertypedInfo(e){if(e>=0&&e<this._lastOvertyped.length)return this._lastOvertyped[e]}dispose(){this._disposables.dispose()}}const PLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),LLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(PLe);Be(LLe);const MLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let vH=class{constructor(e,t,i,n,o){this._menuId=t,this._menuService=n,this._contextKeyService=o,this._menuDisposables=new U,this.element=ee(e,Y(".suggest-status-bar"));const r=a=>a instanceof va?i.createInstance(Hve,a,{useComma:!0}):void 0;this._leftActions=new Er(this.element,{actionViewItemProvider:r}),this._rightActions=new Er(this.element,{actionViewItemProvider:r}),this._leftActions.domNode.classList.add("left"),this._rightActions.domNode.classList.add("right")}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){const e=this._menuService.createMenu(this._menuId,this._contextKeyService),t=()=>{const i=[],n=[];for(const[o,r]of e.getActions())o==="left"?i.push(...r):n.push(...r);this._leftActions.clear(),this._leftActions.push(i),this._rightActions.clear(),this._rightActions.push(n)};this._menuDisposables.add(e.onDidChange(()=>t())),this._menuDisposables.add(e)}hide(){this._menuDisposables.clear()}};vH=f([p(2,J),p(3,tn),p(4,me)],vH);const NLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(NLe);H("symbolIcon.arrayForeground",Kn,h(1542,"The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.booleanForeground",Kn,h(1543,"The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.classForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},h(1544,"The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.colorForeground",Kn,h(1545,"The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.constantForeground",Kn,h(1546,"The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.constructorForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},h(1547,"The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.enumeratorForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},h(1548,"The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.enumeratorMemberForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1549,"The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.eventForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},h(1550,"The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.fieldForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1551,"The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.fileForeground",Kn,h(1552,"The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.folderForeground",Kn,h(1553,"The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.functionForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},h(1554,"The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.interfaceForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1555,"The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.keyForeground",Kn,h(1556,"The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.keywordForeground",Kn,h(1557,"The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.methodForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},h(1558,"The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.moduleForeground",Kn,h(1559,"The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.namespaceForeground",Kn,h(1560,"The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.nullForeground",Kn,h(1561,"The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.numberForeground",Kn,h(1562,"The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.objectForeground",Kn,h(1563,"The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.operatorForeground",Kn,h(1564,"The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.packageForeground",Kn,h(1565,"The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.propertyForeground",Kn,h(1566,"The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.referenceForeground",Kn,h(1567,"The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.snippetForeground",Kn,h(1568,"The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.stringForeground",Kn,h(1569,"The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.structForeground",Kn,h(1570,"The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.textForeground",Kn,h(1571,"The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.typeParameterForeground",Kn,h(1572,"The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.unitForeground",Kn,h(1573,"The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.variableForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1574,"The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));function YK(s){return!!s&&!!(s.completion.documentation||s.completion.detail&&s.completion.detail!==s.completion.label)}let _H=class{constructor(e,t){this._editor=e,this._onDidClose=new M,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new M,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new U,this._renderDisposeable=new U,this._borderWidth=1,this._size=new Ke(330,0),this.domNode=Y(".suggest-details"),this.domNode.classList.add("no-docs"),this._markdownRenderer=t.createInstance(Rv,{editor:e}),this._body=Y(".body"),this._scrollbar=new nI(this._body,{alwaysConsumeMouseWheel:!0}),ee(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=ee(this._body,Y(".header")),this._close=ee(this._header,Y("span"+Te.asCSSSelector(j.close))),this._close.title=h(1537,"Close"),this._close.role="button",this._close.tabIndex=-1,this._type=ee(this._header,Y("p.type")),this._docs=ee(this._body,Y("p.docs")),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(L.fontInfo)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){const e=this._editor.getOptions(),t=e.get(L.fontInfo),i=t.getMassagedFontFamily(),n=e.get(L.suggestFontSize)||t.fontSize,o=e.get(L.suggestLineHeight)||t.lineHeight,r=t.fontWeight,a=`${n}px`,c=`${o}px`;this.domNode.style.fontSize=a,this.domNode.style.lineHeight=`${o/n}`,this.domNode.style.fontWeight=r,this.domNode.style.fontFeatureSettings=t.fontFeatureSettings,this._type.style.fontFamily=i,this._close.style.height=c,this._close.style.width=c}getLayoutInfo(){const e=this._editor.getOption(L.suggestLineHeight)||this._editor.getOption(L.fontInfo).lineHeight,t=this._borderWidth,i=t*2;return{lineHeight:e,borderWidth:t,borderHeight:i,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=h(1538,"Loading..."),this._docs.textContent="",this.domNode.classList.remove("no-docs","no-type"),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(e,t){this._renderDisposeable.clear();let{detail:i,documentation:n}=e.completion;if(t){let o="";o+=`score: ${e.score[0]}
`,o+=`prefix: ${e.word??"(no prefix)"}
`,o+=`word: ${e.completion.filterText?e.completion.filterText+" (filterText)":e.textLabel}
`,o+=`distance: ${e.distance} (localityBonus-setting)
`,o+=`index: ${e.idx}, based on ${e.completion.sortText&&`sortText: "${e.completion.sortText}"`||"label"}
`,o+=`commit_chars: ${e.completion.commitCharacters?.join("")}
`,n=new Ni().appendCodeblock("empty",o),i=`Provider: ${e.provider._debugDisplayName}`}if(!t&&!YK(e)){this.clearContents();return}if(this.domNode.classList.remove("no-docs","no-type"),i){const o=i.length>1e5?`${i.substr(0,1e5)}…`:i;this._type.textContent=o,this._type.title=o,Ho(this._type),this._type.classList.toggle("auto-wrap",!/\r?\n^\s+/gmi.test(o))}else Yi(this._type),this._type.title="",Hs(this._type),this.domNode.classList.add("no-type");if(Yi(this._docs),typeof n=="string")this._docs.classList.remove("markdown-docs"),this._docs.textContent=n;else if(n){this._docs.classList.add("markdown-docs"),Yi(this._docs);const o=this._markdownRenderer.render(n,{asyncRenderCallback:()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}});this._docs.appendChild(o.element),this._renderDisposeable.add(o)}this.domNode.classList.toggle("detail-and-doc",!!i&&!!n),this.domNode.style.userSelect="text",this.domNode.tabIndex=-1,this._close.onmousedown=o=>{o.preventDefault(),o.stopPropagation()},this._close.onclick=o=>{o.preventDefault(),o.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add("no-docs"),this._type.textContent="",this._docs.textContent=""}get isEmpty(){return this.domNode.classList.contains("no-docs")}get size(){return this._size}layout(e,t){const i=new Ke(e,t);Ke.equals(i,this._size)||(this._size=i,Cq(this.domNode,e,t)),this._scrollbar.scanDomNode()}scrollDown(e=8){this._body.scrollTop+=e}scrollUp(e=8){this._body.scrollTop-=e}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(e){this._borderWidth=e}get borderWidth(){return this._borderWidth}focus(){this.domNode.focus()}};_H=f([p(1,J)],_H);class OLe{constructor(e,t){this.widget=e,this._editor=t,this.allowEditorOverflow=!0,this._disposables=new U,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new HK,this._resizable.domNode.classList.add("suggest-details-container"),this._resizable.domNode.appendChild(e.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let i,n,o=0,r=0;this._disposables.add(this._resizable.onDidWillResize(()=>{i=this._topLeft,n=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(a=>{if(i&&n){this.widget.layout(a.dimension.width,a.dimension.height);let c=!1;a.west&&(r=n.width-a.dimension.width,c=!0),a.north&&(o=n.height-a.dimension.height,c=!0),c&&this._applyTopLeft({top:i.top+o,left:i.left+r})}a.done&&(i=void 0,n=void 0,o=0,r=0,this._userSize=a.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{this._anchorBox&&this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return"suggest.details"}getDomNode(){return this._resizable.domNode}getPosition(){return this._topLeft?{preference:this._topLeft}:null}show(){this._added||(this._editor.addOverlayWidget(this),this._added=!0)}hide(e=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),e&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(e,t){const i=e.getBoundingClientRect();this._anchorBox=i,this._preferAlignAtTop=t,this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,t)}_placeAtAnchor(e,t,i){const n=Zu(this.getDomNode().ownerDocument.body),o=this.widget.getLayoutInfo(),r=new Ke(220,2*o.lineHeight),a=e.top,c=function(){const B=n.width-(e.left+e.width+o.borderWidth+o.horizontalPadding),z=-o.borderWidth+e.left+e.width,Q=new Ke(B,n.height-e.top-o.borderHeight-o.verticalPadding),ie=Q.with(void 0,e.top+e.height-o.borderHeight-o.verticalPadding);return{top:a,left:z,fit:B-t.width,maxSizeTop:Q,maxSizeBottom:ie,minSize:r.with(Math.min(B,r.width))}}(),d=function(){const B=e.left-o.borderWidth-o.horizontalPadding,z=Math.max(o.horizontalPadding,e.left-t.width-o.borderWidth),Q=new Ke(B,n.height-e.top-o.borderHeight-o.verticalPadding),ie=Q.with(void 0,e.top+e.height-o.borderHeight-o.verticalPadding);return{top:a,left:z,fit:B-t.width,maxSizeTop:Q,maxSizeBottom:ie,minSize:r.with(Math.min(B,r.width))}}(),l=function(){const B=e.left,z=-o.borderWidth+e.top+e.height,Q=new Ke(e.width-o.borderHeight,n.height-e.top-e.height-o.verticalPadding);return{top:z,left:B,fit:Q.height-t.height,maxSizeBottom:Q,maxSizeTop:Q,minSize:r.with(Q.width)}}(),u=[c,d,l],g=u.find(B=>B.fit>=0)??u.sort((B,z)=>z.fit-B.fit)[0],m=e.top+e.height-o.borderHeight;let v,y=t.height;const w=Math.max(g.maxSizeTop.height,g.maxSizeBottom.height);y>w&&(y=w);let C;i?y<=g.maxSizeTop.height?(v=!0,C=g.maxSizeTop):(v=!1,C=g.maxSizeBottom):y<=g.maxSizeBottom.height?(v=!1,C=g.maxSizeBottom):(v=!0,C=g.maxSizeTop);let{top:T,left:k}=g;!v&&y>e.height&&(T=m-y);const A=this._editor.getDomNode();if(A){const B=A.getBoundingClientRect();T-=B.top,k-=B.left}this._applyTopLeft({left:k,top:T}),this._resizable.enableSashes(!v,g===c,v,g!==c),this._resizable.minSize=g.minSize,this._resizable.maxSize=C,this._resizable.layout(y,Math.min(C.width,t.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(e){this._topLeft=e,this._editor.layoutOverlayWidget(this)}}const FLe=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function uh(s,e,t,i,n){if(Te.isThemeIcon(n))return[`codicon-${n.id}`,"predefined-file-icon"];if(R.isUri(n))return[];const o=i===Hi.ROOT_FOLDER?["rootfolder-icon"]:i===Hi.FOLDER?["folder-icon"]:["file-icon"];if(t){let r;if(t.scheme===ae.data)r=qT.parseMetaData(t).get(qT.META_DATA_LABEL);else{const a=t.path.match(FLe);a?(r=KS(a[2].toLowerCase()),a[1]&&o.push(`${KS(a[1].toLowerCase())}-name-dir-icon`)):r=KS(t.authority.toLowerCase())}if(i===Hi.ROOT_FOLDER)o.push(`${r}-root-name-folder-icon`);else if(i===Hi.FOLDER)o.push(`${r}-name-folder-icon`);else{if(r){if(o.push(`${r}-name-file-icon`),o.push("name-file-icon"),r.length<=255){const c=r.split(".");for(let d=1;d<c.length;d++)o.push(`${c.slice(d).join(".")}-ext-file-icon`)}o.push("ext-file-icon")}const a=WLe(s,e,t);a&&o.push(`${KS(a)}-lang-file-icon`)}}return o}function xje(s){return["file-icon",`${KS(s)}-lang-file-icon`]}function WLe(s,e,t){if(!t)return null;let i=null;if(t.scheme===ae.data){const o=qT.parseMetaData(t).get(qT.META_DATA_MIME);o&&(i=e.getLanguageIdByMimeType(o))}else{const n=s.getModel(t);n&&(i=n.getLanguageId())}return i&&i!==WM?i:e.guessLanguageIdByFilepathOrFirstLine(t)}function KS(s){return s.replace(/[\s]/g,"/")}const BLe=Ae("suggest-more-info",j.chevronRight,h(1539,"Icon for more information in the suggest widget.")),VLe=new class jS{static{this._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/}static{this._regexStrict=new RegExp(`^${jS._regexRelaxed.source}$`,"i")}extract(e,t){if(e.textLabel.match(jS._regexStrict))return t[0]=e.textLabel,!0;if(e.completion.detail&&e.completion.detail.match(jS._regexStrict))return t[0]=e.completion.detail,!0;if(e.completion.documentation){const i=typeof e.completion.documentation=="string"?e.completion.documentation:e.completion.documentation.value,n=jS._regexRelaxed.exec(i);if(n&&(n.index===0||n.index+n[0].length===i.length))return t[0]=n[0],!0}return!1}};let bH=class{constructor(e,t,i,n){this._editor=e,this._modelService=t,this._languageService=i,this._themeService=n,this._onDidToggleDetails=new M,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){const t=new U,i=e;i.classList.add("show-file-icons");const n=ee(e,Y(".icon")),o=ee(n,Y("span.colorspan")),r=ee(e,Y(".contents")),a=ee(r,Y(".main")),c=ee(a,Y(".icon-label.codicon")),d=ee(a,Y("span.left")),l=ee(a,Y("span.right")),u=new cq(d,{supportHighlights:!0,supportIcons:!0});t.add(u);const g=ee(d,Y("span.signature-label")),m=ee(d,Y("span.qualifier-label")),v=ee(l,Y("span.details-label")),y=ee(l,Y("span.readMore"+Te.asCSSSelector(BLe)));return y.title=h(1540,"Read More"),{root:i,left:d,right:l,icon:n,colorspan:o,iconLabel:u,iconContainer:c,parametersLabel:g,qualifierLabel:m,detailsLabel:v,readMore:y,disposables:t,configureFont:()=>{const C=this._editor.getOptions(),T=C.get(L.fontInfo),k=T.getMassagedFontFamily(),A=T.fontFeatureSettings,B=C.get(L.suggestFontSize)||T.fontSize,z=C.get(L.suggestLineHeight)||T.lineHeight,Q=T.fontWeight,ie=T.letterSpacing,oe=`${B}px`,xe=`${z}px`,Se=`${ie}px`;i.style.fontSize=oe,i.style.fontWeight=Q,i.style.letterSpacing=Se,a.style.fontFamily=k,a.style.fontFeatureSettings=A,a.style.lineHeight=xe,n.style.height=xe,n.style.width=xe,y.style.height=xe,y.style.width=xe}}}renderElement(e,t,i){i.configureFont();const{completion:n}=e;i.colorspan.style.backgroundColor="";const o={labelEscapeNewLines:!0,matches:lw(e.score)},r=[];if(n.kind===De.Color&&VLe.extract(e,r))i.icon.className="icon customcolor",i.iconContainer.className="icon hide",i.colorspan.style.backgroundColor=r[0];else if(n.kind===De.File&&this._themeService.getFileIconTheme().hasFileIcons){i.icon.className="icon hide",i.iconContainer.className="icon hide";const a=uh(this._modelService,this._languageService,R.from({scheme:"fake",path:e.textLabel}),Hi.FILE),c=uh(this._modelService,this._languageService,R.from({scheme:"fake",path:n.detail}),Hi.FILE);o.extraClasses=a.length>c.length?a:c}else n.kind===De.Folder&&this._themeService.getFileIconTheme().hasFolderIcons?(i.icon.className="icon hide",i.iconContainer.className="icon hide",o.extraClasses=[uh(this._modelService,this._languageService,R.from({scheme:"fake",path:e.textLabel}),Hi.FOLDER),uh(this._modelService,this._languageService,R.from({scheme:"fake",path:n.detail}),Hi.FOLDER)].flat()):(i.icon.className="icon hide",i.iconContainer.className="",i.iconContainer.classList.add("suggest-icon",...Te.asClassNameArray(MM.toIcon(n.kind))));n.tags&&n.tags.indexOf(OT.Deprecated)>=0&&(o.extraClasses=(o.extraClasses||[]).concat(["deprecated"]),o.matches=[]),i.iconLabel.setLabel(e.textLabel,void 0,o),typeof n.label=="string"?(i.parametersLabel.textContent="",i.detailsLabel.textContent=T0(n.detail||""),i.root.classList.add("string-label")):(i.parametersLabel.textContent=T0(n.label.detail||""),i.detailsLabel.textContent=T0(n.label.description||""),i.root.classList.remove("string-label")),this._editor.getOption(L.suggest).showInlineDetails?Ho(i.detailsLabel):Hs(i.detailsLabel),YK(e)?(i.right.classList.add("can-expand-details"),Ho(i.readMore),i.readMore.onmousedown=a=>{a.stopPropagation(),a.preventDefault()},i.readMore.onclick=a=>{a.stopPropagation(),a.preventDefault(),this._onDidToggleDetails.fire()}):(i.right.classList.remove("can-expand-details"),Hs(i.readMore),i.readMore.onmousedown=null,i.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};bH=f([p(1,ai),p(2,fi),p(3,ft)],bH);function T0(s){return s.replace(/\r\n|\r|\n/g,"")}var A_;Be(MLe);H("editorSuggestWidget.background",LM,h(1520,"Background color of the suggest widget."));H("editorSuggestWidget.border",Uve,h(1521,"Border color of the suggest widget."));const HLe=H("editorSuggestWidget.foreground",ao,h(1522,"Foreground color of the suggest widget."));H("editorSuggestWidget.selectedForeground",cne,h(1523,"Foreground color of the selected entry in the suggest widget."));H("editorSuggestWidget.selectedIconForeground",$ve,h(1524,"Icon foreground color of the selected entry in the suggest widget."));const ULe=H("editorSuggestWidget.selectedBackground",dne,h(1525,"Background color of the selected entry in the suggest widget."));H("editorSuggestWidget.highlightForeground",lne,h(1526,"Color of the match highlights in the suggest widget."));H("editorSuggestWidget.focusHighlightForeground",Gve,h(1527,"Color of the match highlights in the suggest widget when an item is focused."));H("editorSuggestWidgetStatus.foreground",Je(HLe,.5),h(1528,"Foreground color of the suggest widget status."));var Ct;(function(s){s[s.Hidden=0]="Hidden",s[s.Loading=1]="Loading",s[s.Empty=2]="Empty",s[s.Open=3]="Open",s[s.Frozen=4]="Frozen",s[s.Details=5]="Details",s[s.onDetailsKeyDown=6]="onDetailsKeyDown"})(Ct||(Ct={}));class $Le{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof pd}`}restore(){const e=this._service.get(this._key,he.PROFILE)??"";try{const t=JSON.parse(e);if(Ke.is(t))return Ke.lift(t)}catch{}}store(e){this._service.store(this._key,JSON.stringify(e),he.PROFILE,pt.MACHINE)}reset(){this._service.remove(this._key,he.PROFILE)}}let yH=class{static{A_=this}static{this.LOADING_MESSAGE=h(1529,"Loading...")}static{this.NO_SUGGESTIONS_MESSAGE=h(1530,"No suggestions.")}constructor(e,t,i,n,o){this.editor=e,this._storageService=t,this._state=Ct.Hidden,this._isAuto=!1,this._pendingLayout=new kt,this._pendingShowDetails=new kt,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new iI,this._disposables=new U,this._onDidSelect=new AF,this._onDidFocus=new AF,this._onDidHide=new M,this._onDidShow=new M,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new M,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new HK,this.element.domNode.classList.add("editor-widget","suggest-widget"),this._contentWidget=new GLe(this,e),this._persistedSize=new $Le(t,e);class r{constructor(m,v,y=!1,w=!1){this.persistedSize=m,this.currentSize=v,this.persistHeight=y,this.persistWidth=w}}let a;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),a=new r(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(g=>{if(this._resize(g.dimension.width,g.dimension.height),a&&(a.persistHeight=a.persistHeight||!!g.north||!!g.south,a.persistWidth=a.persistWidth||!!g.east||!!g.west),!!g.done){if(a){const{itemHeight:m,defaultSize:v}=this.getLayoutInfo(),y=Math.round(m/2);let{width:w,height:C}=this.element.size;(!a.persistHeight||Math.abs(a.currentSize.height-C)<=y)&&(C=a.persistedSize?.height??v.height),(!a.persistWidth||Math.abs(a.currentSize.width-w)<=y)&&(w=a.persistedSize?.width??v.width),this._persistedSize.store(new Ke(w,C))}this._contentWidget.unlockPreference(),a=void 0}})),this._messageElement=ee(this.element.domNode,Y(".message")),this._listElement=ee(this.element.domNode,Y(".tree"));const c=this._disposables.add(o.createInstance(_H,this.editor));c.onDidClose(()=>this.toggleDetails(),this,this._disposables),this._details=new OLe(c,this.editor);const d=()=>this.element.domNode.classList.toggle("no-icons",!this.editor.getOption(L.suggest).showIcons);d();const l=o.createInstance(bH,this.editor);this._disposables.add(l),this._disposables.add(l.onDidToggleDetails(()=>this.toggleDetails())),this._list=new Dv("SuggestWidget",this._listElement,{getHeight:g=>this.getLayoutInfo().itemHeight,getTemplateId:g=>"suggestion"},[l],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>pn?"listitem":"option",getWidgetAriaLabel:()=>h(1531,"Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:g=>{let m=g.textLabel;const v=MM.toLabel(g.completion.kind);if(typeof g.completion.label!="string"){const{detail:T,description:k}=g.completion.label;T&&k?m=h(1532,"{0} {1}, {2}, {3}",m,T,k,v):T?m=h(1533,"{0} {1}, {2}",m,T,v):k&&(m=h(1534,"{0}, {1}, {2}",m,k,v))}else m=h(1535,"{0}, {1}",m,v);if(!g.isResolved||!this._isDetailsVisible())return m;const{documentation:y,detail:w}=g.completion,C=Eq("{0}{1}",w||"",y?typeof y=="string"?y:y.value:"");return h(1536,"{0}, docs: {1}",m,C)}}}),this._list.style(hne({listInactiveFocusBackground:ULe,listInactiveFocusOutline:Sr})),this._status=o.createInstance(vH,this.element.domNode,xp);const u=()=>this.element.domNode.classList.toggle("with-status-bar",this.editor.getOption(L.suggest).showStatusBar);u(),this._disposables.add(n.onDidColorThemeChange(g=>this._onThemeChange(g))),this._onThemeChange(n.getColorTheme()),this._disposables.add(this._list.onMouseDown(g=>this._onListMouseDownOrTap(g))),this._disposables.add(this._list.onTap(g=>this._onListMouseDownOrTap(g))),this._disposables.add(this._list.onDidChangeSelection(g=>this._onListSelection(g))),this._disposables.add(this._list.onDidChangeFocus(g=>this._onListFocus(g))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(g=>{g.hasChanged(L.suggest)&&(u(),d()),this._completionModel&&(g.hasChanged(L.fontInfo)||g.hasChanged(L.suggestFontSize)||g.hasChanged(L.suggestLineHeight))&&this._list.splice(0,this._list.length,this._completionModel.items)})),this._ctxSuggestWidgetVisible=ut.Visible.bindTo(i),this._ctxSuggestWidgetDetailsVisible=ut.DetailsVisible.bindTo(i),this._ctxSuggestWidgetMultipleSuggestions=ut.MultipleSuggestions.bindTo(i),this._ctxSuggestWidgetHasFocusedSuggestion=ut.HasFocusedSuggestion.bindTo(i),this._disposables.add(co(this._details.widget.domNode,"keydown",g=>{this._onDetailsKeydown.fire(g)})),this._disposables.add(this.editor.onMouseDown(g=>this._onEditorMouseDown(g)))}dispose(){this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),this._loadingTimeout?.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==Ct.Hidden&&this._contentWidget.layout()}_onListMouseDownOrTap(e){typeof e.element>"u"||typeof e.index>"u"||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){const i=this._completionModel;i&&(this._onDidSelect.fire({item:e,index:t,model:i}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=sy(e.type)?2:1}_onListFocus(e){if(this._ignoreFocusEvents)return;if(this._state===Ct.Details&&this._setState(Ct.Open),!e.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);const t=e.elements[0],i=e.indexes[0];t!==this._focusedItem&&(this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=t,this._list.reveal(i),this._currentSuggestionDetails=En(async n=>{const o=Hm(()=>{this._isDetailsVisible()&&this._showDetails(!0,!1)},250),r=n.onCancellationRequested(()=>o.dispose());try{return await t.resolve(n)}finally{o.dispose(),r.dispose()}}),this._currentSuggestionDetails.then(()=>{i>=this._list.length||t!==this._list.element(i)||(this._ignoreFocusEvents=!0,this._list.splice(i,1,[t]),this._list.setFocus([i]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this._showDetails(!1,!1):this.element.domNode.classList.remove("docs-side"),this.editor.setAriaOptions({activeDescendant:this._list.getElementID(i)}))}).catch(mt)),this._onDidFocus.fire({item:t,index:i,model:this._completionModel})}_setState(e){if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle("frozen",e===Ct.Frozen),this.element.domNode.classList.remove("message"),e){case Ct.Hidden:Hs(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case Ct.Loading:this.element.domNode.classList.add("message"),this._messageElement.textContent=A_.LOADING_MESSAGE,Hs(this._listElement,this._status.element),Ho(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,Kc(A_.LOADING_MESSAGE);break;case Ct.Empty:this.element.domNode.classList.add("message"),this._messageElement.textContent=A_.NO_SUGGESTIONS_MESSAGE,Hs(this._listElement,this._status.element),Ho(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,Kc(A_.NO_SUGGESTIONS_MESSAGE);break;case Ct.Open:Hs(this._messageElement),Ho(this._listElement,this._status.element),this._show();break;case Ct.Frozen:Hs(this._messageElement),Ho(this._listElement,this._status.element),this._show();break;case Ct.Details:Hs(this._messageElement),Ho(this._listElement,this._status.element),this._details.show(),this._show(),this._details.widget.focus();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)},100)}showTriggered(e,t){this._state===Ct.Hidden&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=Hm(()=>this._setState(Ct.Loading),t)))}showSuggestions(e,t,i,n,o){if(this._contentWidget.setPosition(this.editor.getPosition()),this._loadingTimeout?.dispose(),this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),i&&this._state!==Ct.Empty&&this._state!==Ct.Hidden){this._setState(Ct.Frozen);return}const r=this._completionModel.items.length,a=r===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(r>1),a){this._setState(n?Ct.Hidden:Ct.Empty),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(i?Ct.Frozen:Ct.Open),this._list.reveal(t,0,t===0?0:this.getLayoutInfo().itemHeight*.33),this._list.setFocus(o?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=x7(bt(this.element.domNode),()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove("focused")})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case Ct.Hidden:return!1;case Ct.Details:return this._details.widget.pageDown(),!0;case Ct.Loading:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case Ct.Hidden:return!1;case Ct.Loading:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case Ct.Hidden:return!1;case Ct.Details:return this._details.widget.scrollBottom(),!0;case Ct.Loading:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case Ct.Hidden:return!1;case Ct.Details:return this._details.widget.pageUp(),!0;case Ct.Loading:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case Ct.Hidden:return!1;case Ct.Loading:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case Ct.Hidden:return!1;case Ct.Details:return this._details.widget.scrollTop(),!0;case Ct.Loading:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==Ct.Hidden&&this._state!==Ct.Empty&&this._state!==Ct.Loading&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===Ct.Details?(this._list.setFocus(this._list.getFocus()),this._setState(Ct.Open)):this._state===Ct.Open&&(this._setState(Ct.Details),this._isDetailsVisible()?this._details.widget.focus():this.toggleDetails(!0))}toggleDetails(e=!1){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove("shows-details")):(YK(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===Ct.Open||this._state===Ct.Details||this._state===Ct.Frozen)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this._showDetails(!1,e))}_showDetails(e,t){this._pendingShowDetails.value=x7(bt(this.element.domNode),()=>{this._pendingShowDetails.clear(),this._details.show();let i=!1;e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._details.widget.isEmpty?this._details.hide():(this._positionDetails(),this.element.domNode.classList.add("shows-details"),t&&(this._details.widget.focus(),i=!0)),i||this.editor.focus()})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this._showDetails(!1,!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){this._pendingLayout.clear(),this._pendingShowDetails.clear(),this._loadingTimeout?.dispose(),this._setState(Ct.Hidden),this._onDidHide.fire(this),this.element.clearSashHoverState();const e=this._persistedSize.restore(),t=Math.ceil(this.getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}isFrozen(){return this._state===Ct.Frozen}_afterRender(e){if(e===null){this._isDetailsVisible()&&this._details.hide();return}this._state===Ct.Empty||this._state===Ct.Loading||(this._isDetailsVisible()&&!this._details.widget.isEmpty&&this._details.show(),this._positionDetails())}_layout(e){if(!this.editor.hasModel()||!this.editor.getDomNode())return;const t=Zu(this.element.domNode.ownerDocument.body),i=this.getLayoutInfo();e||(e=i.defaultSize);let n=e.height,o=e.width;if(this._status.element.style.height=`${i.itemHeight}px`,this._state===Ct.Empty||this._state===Ct.Loading)n=i.itemHeight+i.borderHeight,o=i.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new Ke(o,n),this._contentWidget.setPreference(Oi.BELOW);else{const r=t.width-i.borderHeight-2*i.horizontalPadding;o>r&&(o=r);const a=this._completionModel?this._completionModel.stats.pLabelLen*i.typicalHalfwidthCharacterWidth:o,c=i.statusBarHeight+this._list.contentHeight+i.borderHeight,d=i.itemHeight+i.statusBarHeight,l=Ms(this.editor.getDomNode()),u=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),g=l.top+u.top+u.height,m=Math.min(t.height-g-i.verticalPadding,c),v=l.top+u.top-i.verticalPadding,y=Math.min(v,c);let w=Math.min(Math.max(y,m)+i.borderHeight,c);n===this._cappedHeight?.capped&&(n=this._cappedHeight.wanted),n<d&&(n=d),n>w&&(n=w),n>m||this._forceRenderingAbove&&v>150?(this._contentWidget.setPreference(Oi.ABOVE),this.element.enableSashes(!0,!0,!1,!1),w=y):(this._contentWidget.setPreference(Oi.BELOW),this.element.enableSashes(!1,!0,!0,!1),w=m),this.element.preferredSize=new Ke(a,i.defaultSize.height),this.element.maxSize=new Ke(r,w),this.element.minSize=new Ke(220,d),this._cappedHeight=n===c?{wanted:this._cappedHeight?.wanted??e.height,capped:n}:void 0}this._resize(o,n)}_resize(e,t){const{width:i,height:n}=this.element.maxSize;e=Math.min(i,e),t=Math.min(n,t);const{statusBarHeight:o}=this.getLayoutInfo();this._list.layout(t-o,e),this._listElement.style.height=`${t-o}px`,this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,this._contentWidget.getPosition()?.preference[0]===Oi.BELOW)}getLayoutInfo(){const e=this.editor.getOption(L.fontInfo),t=om(this.editor.getOption(L.suggestLineHeight)||e.lineHeight,8,1e3),i=!this.editor.getOption(L.suggest).showStatusBar||this._state===Ct.Empty||this._state===Ct.Loading?0:t,n=this._details.widget.borderWidth,o=2*n;return{itemHeight:t,statusBarHeight:i,borderWidth:n,borderHeight:o,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new Ke(430,i+12*t)}}_isDetailsVisible(){return this._storageService.getBoolean("expandSuggestionDocs",he.PROFILE,!1)}_setDetailsVisible(e){this._storageService.store("expandSuggestionDocs",e,he.PROFILE,pt.USER)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};yH=A_=f([p(1,tt),p(2,me),p(3,ft),p(4,J)],yH);class GLe{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return"editor.widget.suggestWidget"}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){const{height:e,width:t}=this._widget.element.size,{borderWidth:i,horizontalPadding:n}=this._widget.getLayoutInfo();return new Ke(t+2*i+n,e+2*i)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}}var wH;class qLe{constructor(e,t){if(this._model=e,this._position=t,this._decorationOptions=Yt.register({description:"suggest-line-suffix",stickiness:Di.NeverGrowsWhenTypingAtEdges}),e.getLineMaxColumn(t.lineNumber)!==t.column){const n=e.getOffsetAt(t),o=e.getPositionAt(n+1);e.changeDecorations(r=>{this._marker&&r.removeDecoration(this._marker),this._marker=r.addDecoration(P.fromPositions(t,o),this._decorationOptions)})}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.changeDecorations(e=>{e.removeDecoration(this._marker),this._marker=void 0})}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){const t=this._model.getDecorationRange(this._marker);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}else return this._model.getLineMaxColumn(e.lineNumber)-e.column}}var Vs;(function(s){s[s.None=0]="None",s[s.NoBeforeUndoStop=1]="NoBeforeUndoStop",s[s.NoAfterUndoStop=2]="NoAfterUndoStop",s[s.KeepAlternativeSuggestions=4]="KeepAlternativeSuggestions",s[s.AlternativeOverwriteConfig=8]="AlternativeOverwriteConfig"})(Vs||(Vs={}));let ea=class{static{wH=this}static{this.ID="editor.contrib.suggestController"}static get(e){return e.getContribution(wH.ID)}constructor(e,t,i,n,o,r,a){this._memoryService=t,this._commandService=i,this._contextKeyService=n,this._instantiationService=o,this._logService=r,this._telemetryService=a,this._lineSuffix=new kt,this._toDispose=new U,this._selectors=new zLe(u=>u.priority),this._onWillInsertSuggestItem=new M,this.onWillInsertSuggestItem=this._onWillInsertSuggestItem.event,this.editor=e,this.model=o.createInstance(XR,this.editor),this._selectors.register({priority:0,select:(u,g,m)=>this._memoryService.select(u,g,m)});const c=ut.InsertMode.bindTo(n);c.set(e.getOption(L.suggest).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>c.set(e.getOption(L.suggest).insertMode))),this.widget=this._toDispose.add(new Dk(bt(e.getDomNode()),()=>{const u=this._instantiationService.createInstance(yH,this.editor);this._toDispose.add(u),this._toDispose.add(u.onDidSelect(w=>this._insertSuggestion(w,Vs.None),this));const g=new RLe(this.editor,u,this.model,w=>this._insertSuggestion(w,Vs.NoAfterUndoStop));this._toDispose.add(g);const m=ut.MakesTextEdit.bindTo(this._contextKeyService),v=ut.HasInsertAndReplaceRange.bindTo(this._contextKeyService),y=ut.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(Ee(()=>{m.reset(),v.reset(),y.reset()})),this._toDispose.add(u.onDidFocus(({item:w})=>{const C=this.editor.getPosition(),T=w.editStart.column,k=C.column;let A=!0;this.editor.getOption(L.acceptSuggestionOnEnter)==="smart"&&this.model.state===Ip.Auto&&!w.completion.additionalTextEdits&&!(w.completion.insertTextRules&dh.InsertAsSnippet)&&k-T===w.completion.insertText.length&&(A=this.editor.getModel().getValueInRange({startLineNumber:C.lineNumber,startColumn:T,endLineNumber:C.lineNumber,endColumn:k})!==w.completion.insertText),m.set(A),v.set(!_e.equals(w.editInsertEnd,w.editReplaceEnd)),y.set(!!w.provider.resolveCompletionItem||!!w.completion.documentation||w.completion.detail!==w.completion.label)})),this._toDispose.add(u.onDetailsKeyDown(w=>{if(w.toKeyCodeChord().equals(new vF(!0,!1,!1,!1,S.KeyC))||qt&&w.toKeyCodeChord().equals(new vF(!1,!1,!1,!0,S.KeyC))){w.stopPropagation();return}w.toKeyCodeChord().isModifierKey()||this.editor.focus()})),u})),this._overtypingCapturer=this._toDispose.add(new Dk(bt(e.getDomNode()),()=>this._toDispose.add(new jK(this.editor,this.model)))),this._alternatives=this._toDispose.add(new Dk(bt(e.getDomNode()),()=>this._toDispose.add(new Uy(this.editor,this._contextKeyService)))),this._toDispose.add(o.createInstance(QR,e)),this._toDispose.add(this.model.onDidTrigger(u=>{this.widget.value.showTriggered(u.auto,u.shy?250:50),this._lineSuffix.value=new qLe(this.editor.getModel(),u.position)})),this._toDispose.add(this.model.onDidSuggest(u=>{if(u.triggerOptions.shy)return;let g=-1;for(const v of this._selectors.itemsOrderedByPriorityDesc)if(g=v.select(this.editor.getModel(),this.editor.getPosition(),u.completionModel.items),g!==-1)break;if(g===-1&&(g=0),this.model.state===Ip.Idle)return;let m=!1;if(u.triggerOptions.auto){const v=this.editor.getOption(L.suggest);v.selectionMode==="never"||v.selectionMode==="always"?m=v.selectionMode==="never":v.selectionMode==="whenTriggerCharacter"?m=u.triggerOptions.triggerKind!==_a.TriggerCharacter:v.selectionMode==="whenQuickSuggestion"&&(m=u.triggerOptions.triggerKind===_a.TriggerCharacter&&!u.triggerOptions.refilter)}this.widget.value.showSuggestions(u.completionModel,g,u.isFrozen,u.triggerOptions.auto,m)})),this._toDispose.add(this.model.onDidCancel(u=>{u.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));const d=ut.AcceptSuggestionsOnEnter.bindTo(n),l=()=>{const u=this.editor.getOption(L.acceptSuggestionOnEnter);d.set(u==="on"||u==="smart")};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>l())),l()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(e,t){if(!e||!e.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;const i=os.get(this.editor);if(!i)return;this._onWillInsertSuggestItem.fire({item:e.item});const n=this.editor.getModel(),o=n.getAlternativeVersionId(),{item:r}=e,a=[],c=new ri;t&Vs.NoBeforeUndoStop||this.editor.pushUndoStop();const d=this.getOverwriteInfo(r,!!(t&Vs.AlternativeOverwriteConfig));this._memoryService.memorize(n,this.editor.getPosition(),r);const l=r.isResolved;let u=-1,g=-1;if(Array.isArray(r.completion.additionalTextEdits)){this.model.cancel();const v=cy.capture(this.editor);this.editor.executeEdits("suggestController.additionalTextEdits.sync",r.completion.additionalTextEdits.map(y=>{let w=P.lift(y.range);if(w.startLineNumber===r.position.lineNumber&&w.startColumn>r.position.column){const C=this.editor.getPosition().column-r.position.column,T=C,k=P.spansMultipleLines(w)?0:C;w=new P(w.startLineNumber,w.startColumn+T,w.endLineNumber,w.endColumn+k)}return Ki.replaceMove(w,y.text)})),v.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!l){const v=new zn;let y;const w=n.onDidChangeContent(A=>{if(A.isFlush){c.cancel(),w.dispose();return}for(const B of A.changes){const z=P.getEndPosition(B.range);(!y||_e.isBefore(z,y))&&(y=z)}}),C=t;t|=Vs.NoAfterUndoStop;let T=!1;const k=this.editor.onWillType(()=>{k.dispose(),T=!0,C&Vs.NoAfterUndoStop||this.editor.pushUndoStop()});a.push(r.resolve(c.token).then(()=>{if(!r.completion.additionalTextEdits||c.token.isCancellationRequested)return;if(y&&r.completion.additionalTextEdits.some(B=>_e.isBefore(y,P.getStartPosition(B.range))))return!1;T&&this.editor.pushUndoStop();const A=cy.capture(this.editor);return this.editor.executeEdits("suggestController.additionalTextEdits.async",r.completion.additionalTextEdits.map(B=>Ki.replaceMove(P.lift(B.range),B.text))),A.restoreRelativeVerticalPositionOfCursor(this.editor),(T||!(C&Vs.NoAfterUndoStop))&&this.editor.pushUndoStop(),!0}).then(A=>{this._logService.trace("[suggest] async resolving of edits DONE (ms, applied?)",v.elapsed(),A),g=A===!0?1:A===!1?0:-2}).finally(()=>{w.dispose(),k.dispose()}))}let{insertText:m}=r.completion;if(r.completion.insertTextRules&dh.InsertAsSnippet||(m=fd.escape(m)),this.model.cancel(),i.insert(m,{overwriteBefore:d.overwriteBefore,overwriteAfter:d.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(r.completion.insertTextRules&dh.KeepWhitespace),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value}),t&Vs.NoAfterUndoStop||this.editor.pushUndoStop(),r.completion.command)if(r.completion.command.id===TO.id)this.model.trigger({auto:!0,retrigger:!0});else{const v=new zn;a.push(this._commandService.executeCommand(r.completion.command.id,...r.completion.command.arguments?[...r.completion.command.arguments]:[]).catch(y=>{r.completion.extensionId?kn(y):mt(y)}).finally(()=>{u=v.elapsed()}))}t&Vs.KeepAlternativeSuggestions&&this._alternatives.value.set(e,v=>{for(c.cancel();n.canUndo();){o!==n.getAlternativeVersionId()&&n.undo(),this._insertSuggestion(v,Vs.NoBeforeUndoStop|Vs.NoAfterUndoStop|(t&Vs.AlternativeOverwriteConfig?Vs.AlternativeOverwriteConfig:0));break}}),this._alertCompletionItem(r),Promise.all(a).finally(()=>{this._reportSuggestionAcceptedTelemetry(r,n,l,u,g,e.index,e.model.items),this.model.clear(),c.dispose()})}_reportSuggestionAcceptedTelemetry(e,t,i,n,o,r,a){if(Math.random()>1e-4)return;const c=new Map;for(let g=0;g<Math.min(30,a.length);g++){const m=a[g].textLabel;c.has(m)?c.get(m).push(g):c.set(m,[g])}const d=c.get(e.textLabel),u=d&&d.length>1?d[0]:-1;this._telemetryService.publicLog2("suggest.acceptedSuggestion",{extensionId:e.extensionId?.value??"unknown",providerId:e.provider._debugDisplayName??"unknown",kind:e.completion.kind,basenameHash:cc(je(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:jM(t.uri),resolveInfo:e.provider.resolveCompletionItem?i?1:0:-1,resolveDuration:e.resolveDuration,commandDuration:n,additionalEditsAsync:o,index:r,firstIndex:u})}getOverwriteInfo(e,t){St(this.editor.hasModel());let i=this.editor.getOption(L.suggest).insertMode==="replace";t&&(i=!i);const n=e.position.column-e.editStart.column,o=(i?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column,r=this.editor.getPosition().column-e.position.column,a=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:n+r,overwriteAfter:o+a}}_alertCompletionItem(e){if(xn(e.completion.additionalTextEdits)){const t=h(1513,"Accepting '{0}' made {1} additional edits",e.textLabel,e.completion.additionalTextEdits.length);ta(t)}}triggerSuggest(e,t,i){this.editor.hasModel()&&(this.model.trigger({auto:t??!1,completionOptions:{providerFilter:e,kindFilter:i?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),ji.Smooth),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;const t=this.editor.getPosition(),i=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},n=o=>{if(o.completion.insertTextRules&dh.InsertAsSnippet||o.completion.additionalTextEdits)return!0;const r=this.editor.getPosition(),a=o.editStart.column,c=r.column;return c-a!==o.completion.insertText.length?!0:this.editor.getModel().getValueInRange({startLineNumber:r.lineNumber,startColumn:a,endLineNumber:r.lineNumber,endColumn:c})!==o.completion.insertText};D.once(this.model.onDidTrigger)(o=>{const r=[];D.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{Qe(r),i()},void 0,r),this.model.onDidSuggest(({completionModel:a})=>{if(Qe(r),a.items.length===0){i();return}const c=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),a.items),d=a.items[c];if(!n(d)){i();return}this.editor.pushUndoStop(),this._insertSuggestion({index:c,item:d,model:a},Vs.KeepAlternativeSuggestions|Vs.NoBeforeUndoStop|Vs.NoAfterUndoStop)},void 0,r)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,ji.Smooth),this.editor.focus()}acceptSelectedSuggestion(e,t){const i=this.widget.value.getFocusedItem();let n=0;e&&(n|=Vs.KeepAlternativeSuggestions),t&&(n|=Vs.AlternativeOverwriteConfig),this._insertSuggestion(i,n)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.value.forceRenderingAbove()}stopForceRenderingAbove(){this.widget.isInitialized&&this.widget.value.stopForceRenderingAbove()}registerSelector(e){return this._selectors.register(e)}};ea=wH=f([p(1,UN),p(2,qe),p(3,me),p(4,J),p(5,Pe),p(6,li)],ea);class zLe{constructor(e){this.prioritySelector=e,this._items=new Array}register(e){if(this._items.indexOf(e)!==-1)throw new Error("Value is already registered");return this._items.push(e),this._items.sort((t,i)=>this.prioritySelector(i)-this.prioritySelector(t)),{dispose:()=>{const t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}}class TO extends we{static{this.id="editor.action.triggerSuggest"}constructor(){super({id:TO.id,label:I(1514,"Trigger Suggest"),precondition:x.and(V.writable,V.hasCompletionItemProvider,ut.Visible.toNegated()),kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Space,secondary:[E.CtrlCmd|S.KeyI],mac:{primary:E.WinCtrl|S.Space,secondary:[E.Alt|S.Escape,E.CtrlCmd|S.KeyI]},weight:W.EditorContrib}})}run(e,t,i){const n=ea.get(t);if(!n)return;let o;i&&typeof i=="object"&&i.auto===!0&&(o=!0),n.triggerSuggest(void 0,o,void 0)}}Rt(ea.ID,ea,vt.BeforeFirstInteraction);ue(TO);const ka=W.EditorContrib+90,Jo=No.bindToContribution(ea.get);Ue(new Jo({id:"acceptSelectedSuggestion",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion),handler(s){s.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:S.Tab,kbExpr:x.and(ut.Visible,V.textInputFocus),weight:ka},{primary:S.Enter,kbExpr:x.and(ut.Visible,V.textInputFocus,ut.AcceptSuggestionsOnEnter,ut.MakesTextEdit),weight:ka}],menuOpts:[{menuId:xp,title:h(1515,"Insert"),group:"left",order:1,when:ut.HasInsertAndReplaceRange.toNegated()},{menuId:xp,title:h(1515,"Insert"),group:"left",order:1,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("insert"))},{menuId:xp,title:h(1516,"Replace"),group:"left",order:1,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("replace"))}]}));Ue(new Jo({id:"acceptAlternativeSelectedSuggestion",precondition:x.and(ut.Visible,V.textInputFocus,ut.HasFocusedSuggestion),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:E.Shift|S.Enter,secondary:[E.Shift|S.Tab]},handler(s){s.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:xp,group:"left",order:2,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("insert")),title:h(1516,"Replace")},{menuId:xp,group:"left",order:2,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("replace")),title:h(1515,"Insert")}]}));Ce.registerCommandAlias("acceptSelectedSuggestionOnEnter","acceptSelectedSuggestion");Ue(new Jo({id:"hideSuggestWidget",precondition:ut.Visible,handler:s=>s.cancelSuggestWidget(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));Ue(new Jo({id:"selectNextSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectNextSuggestion(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow],mac:{primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow,E.WinCtrl|S.KeyN]}}}));Ue(new Jo({id:"selectNextPageSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectNextPageSuggestion(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:S.PageDown,secondary:[E.CtrlCmd|S.PageDown]}}));Ue(new Jo({id:"selectLastSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectLastSuggestion()}));Ue(new Jo({id:"selectPrevSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectPrevSuggestion(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow],mac:{primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow,E.WinCtrl|S.KeyP]}}}));Ue(new Jo({id:"selectPrevPageSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectPrevPageSuggestion(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:S.PageUp,secondary:[E.CtrlCmd|S.PageUp]}}));Ue(new Jo({id:"selectFirstSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectFirstSuggestion()}));Ue(new Jo({id:"focusSuggestion",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion.negate()),handler:s=>s.focusSuggestion(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Space,secondary:[E.CtrlCmd|S.KeyI],mac:{primary:E.WinCtrl|S.Space,secondary:[E.CtrlCmd|S.KeyI]}}}));Ue(new Jo({id:"focusAndAcceptSuggestion",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion.negate()),handler:s=>{s.focusSuggestion(),s.acceptSelectedSuggestion(!0,!1)}}));Ue(new Jo({id:"toggleSuggestionDetails",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion),handler:s=>s.toggleSuggestionDetails(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Space,secondary:[E.CtrlCmd|S.KeyI],mac:{primary:E.WinCtrl|S.Space,secondary:[E.CtrlCmd|S.KeyI]}},menuOpts:[{menuId:xp,group:"right",order:1,when:x.and(ut.DetailsVisible,ut.CanResolve),title:h(1517,"Show Less")},{menuId:xp,group:"right",order:1,when:x.and(ut.DetailsVisible.toNegated(),ut.CanResolve),title:h(1518,"Show More")}]}));Ue(new Jo({id:"toggleExplainMode",precondition:ut.Visible,handler:s=>s.toggleExplainMode(),kbOpts:{weight:W.EditorContrib,primary:E.CtrlCmd|S.Slash}}));Ue(new Jo({id:"toggleSuggestionFocus",precondition:ut.Visible,handler:s=>s.toggleSuggestionFocus(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:E.CtrlCmd|E.Alt|S.Space,mac:{primary:E.WinCtrl|E.Alt|S.Space}}}));Ue(new Jo({id:"insertBestCompletion",precondition:x.and(V.textInputFocus,x.equals("config.editor.tabCompletion","on"),QR.AtEnd,ut.Visible.toNegated(),Uy.OtherSuggestions.toNegated(),os.InSnippetMode.toNegated()),handler:(s,e)=>{s.triggerSuggestAndAcceptBest(oa(e)?{fallback:"tab",...e}:{fallback:"tab"})},kbOpts:{weight:ka,primary:S.Tab}}));Ue(new Jo({id:"insertNextSuggestion",precondition:x.and(V.textInputFocus,x.equals("config.editor.tabCompletion","on"),Uy.OtherSuggestions,ut.Visible.toNegated(),os.InSnippetMode.toNegated()),handler:s=>s.acceptNextSuggestion(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:S.Tab}}));Ue(new Jo({id:"insertPrevSuggestion",precondition:x.and(V.textInputFocus,x.equals("config.editor.tabCompletion","on"),Uy.OtherSuggestions,ut.Visible.toNegated(),os.InSnippetMode.toNegated()),handler:s=>s.acceptPrevSuggestion(),kbOpts:{weight:ka,kbExpr:V.textInputFocus,primary:E.Shift|S.Tab}}));ue(class extends we{constructor(){super({id:"editor.action.resetSuggestSize",label:I(1519,"Reset Suggest Widget Size"),precondition:void 0})}run(s,e){ea.get(e)?.resetWidgetSize()}});let SH=class extends une{constructor(e,t,i,n,o,r){super(e),this._options=t,this._contextMenuService=i,this._keybindingService=n,this._hoverService=r,this._store=new U,this._updateStore=new U,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._actionRunner=this._store.add(new _g),t?.telemetrySource&&this._actionRunner.onDidRun(a=>{o.publicLog2("workbenchActionExecuted",{id:a.action.id,from:t.telemetrySource})},void 0,this._store)}dispose(){this._onDidChange.dispose(),this._updateStore.dispose(),this._store.dispose(),super.dispose()}update(e,t){const i=this._options?.buttonConfigProvider??(()=>({showLabel:!0}));this._updateStore.clear(),this.clear();const n=this._updateStore.add(Km());for(let o=0;o<e.length;o++){const r=o>0,a=e[o];let c,d,l="";const u=a instanceof Dh?"":this._keybindingService.lookupKeybinding(a.id);if(u?l=h(1702,"{0} ({1})",a.tooltip||a.label,u.getLabel()):l=a.tooltip||a.label,a instanceof Dh&&a.actions.length>0){const[m,...v]=a.actions;c=m,d=this.addButtonWithDropdown({secondary:i(c,o)?.isSecondary??r,actionRunner:this._actionRunner,actions:v,contextMenuProvider:this._contextMenuService,ariaLabel:l,supportIcons:!0})}else c=a,d=this.addButton({secondary:i(c,o)?.isSecondary??r,ariaLabel:l,supportIcons:!0});d.enabled=c.enabled,d.checked=c.checked??!1,d.element.classList.add("default-colors");const g=i(c,o)?.showLabel??!0;g?d.label=c.label:d.element.classList.add("monaco-text-button"),i(c,o)?.showIcon&&(c instanceof va&&Te.isThemeIcon(c.item.icon)?g?d.label=`$(${c.item.icon.id}) ${c.label}`:d.icon=c.item.icon:c.class&&d.element.classList.add(...c.class.split(" "))),this._updateStore.add(this._hoverService.setupManagedHover(n,d.element,l)),this._updateStore.add(d.onDidClick(async()=>{this._actionRunner.run(c)}))}if(t.length>0){const o=this.addButton({secondary:!0,ariaLabel:h(1703,"More Actions")});o.icon=j.dropDownButton,o.element.classList.add("default-colors","monaco-text-button"),o.enabled=!0,this._updateStore.add(this._hoverService.setupManagedHover(n,o.element,h(1703,"More Actions"))),this._updateStore.add(o.onDidClick(async()=>{this._contextMenuService.showContextMenu({getAnchor:()=>o.element,getActions:()=>t,actionRunner:this._actionRunner,onHide:()=>o.element.setAttribute("aria-expanded","false")}),o.element.setAttribute("aria-expanded","true")}))}this._onDidChange.fire(this)}};SH=f([p(2,mi),p(3,Ve),p(4,li),p(5,wi)],SH);let CH=class extends SH{constructor(e,t,i,n,o,r,a,c,d){super(e,i,r,a,c,d);const l=n.createMenu(t,o);this._store.add(l);const u=()=>{this.clear();const g=zm(l.getActions(i?.menuOptions),i?.toolbarOptions?.primaryGroup);super.update(g.primary,g.secondary)};this._store.add(l.onDidChange(u)),u()}dispose(){super.dispose()}update(e){throw new Error("Use Menu or WorkbenchButtonBar")}};CH=f([p(3,tn),p(4,me),p(5,mi),p(6,Ve),p(7,li),p(8,wi)],CH);let ZR=class extends YM{get onDidChangeDropdownVisibility(){return this._dropdown.onDidChangeVisibility}constructor(e,t,i,n,o,r,a,c,d,l,u){super(null,e,{hoverDelegate:o?.hoverDelegate}),this._options=o,this._contextMenuProvider=r,this._container=null,this._dropdownContainer=null,this._primaryAction=new yq(e,{hoverDelegate:o?.hoverDelegate},a,c,d,l,r,u),o?.actionRunner&&(this._primaryAction.actionRunner=o.actionRunner),this._dropdown=new gC(t,i,this._contextMenuProvider,{menuAsChild:o?.menuAsChild??!0,classNames:n?["codicon","codicon-chevron-down",n]:["codicon","codicon-chevron-down"],actionRunner:this._options?.actionRunner,keybindingProvider:this._options?.getKeyBinding??(g=>a.lookupKeybinding(g.id)),hoverDelegate:o?.hoverDelegate,skipTelemetry:o?.skipTelemetry})}set actionRunner(e){super.actionRunner=e,this._primaryAction.actionRunner=e,this._dropdown.actionRunner=e}setActionContext(e){super.setActionContext(e),this._primaryAction.setActionContext(e),this._dropdown.setActionContext(e)}render(e){this._container=e,super.render(this._container),this._container.classList.add("monaco-dropdown-with-primary");const t=Y(".action-container");t.role="button",t.ariaDisabled=String(!this.action.enabled),this._primaryAction.render(ee(this._container,t)),this._dropdownContainer=Y(".dropdown-action-container"),this._dropdown.render(ee(this._container,this._dropdownContainer)),this._register(re(t,pe.KEY_DOWN,i=>{if(!this.action.enabled)return;const n=new zs(i);n.equals(S.RightArrow)&&(this._primaryAction.element.tabIndex=-1,this._dropdown.focus(),n.stopPropagation())})),this._register(re(this._dropdownContainer,pe.KEY_DOWN,i=>{if(!this.action.enabled)return;const n=new zs(i);n.equals(S.LeftArrow)&&(this._primaryAction.element.tabIndex=0,this._dropdown.setFocusable(!1),this._primaryAction.element?.focus(),n.stopPropagation())})),this.updateEnabled()}focus(e){e?this._dropdown.focus():(this._primaryAction.element.tabIndex=0,this._primaryAction.element.focus())}blur(){this._primaryAction.element.tabIndex=-1,this._dropdown.blur(),this._container.blur()}setFocusable(e){e?this._primaryAction.element.tabIndex=0:(this._primaryAction.element.tabIndex=-1,this._dropdown.setFocusable(!1))}updateEnabled(){const e=!this.action.enabled;this.element?.classList.toggle("disabled",e)}update(e,t,i){this._dropdown.dispose(),this._dropdown=new gC(e,t,this._contextMenuProvider,{menuAsChild:this._options?.menuAsChild??!0,classNames:["codicon",i||"codicon-chevron-down"],actionRunner:this._options?.actionRunner,hoverDelegate:this._options?.hoverDelegate,keybindingProvider:this._options?.getKeyBinding}),this._dropdownContainer&&this._dropdown.render(this._dropdownContainer)}showDropdown(){this._dropdown.show()}dispose(){this._primaryAction.dispose(),this._dropdown.dispose(),super.dispose()}};ZR=f([p(5,mi),p(6,Ve),p(7,At),p(8,me),p(9,ft),p(10,Tr)],ZR);function Nl(s){if(!(!s||!s.resource))return R.isUri(s.resource)?s.resource:s.resource.primary}const AO={onDidChangeVisibility:D.None};let vd=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this.instantiationService=t,this.configurationService=i,this.modelService=n,this.workspaceService=o,this.languageService=r,this.decorationsService=a,this.themeService=c,this.labelService=d,this.textFileService=l,this._onDidChangeDecorations=this._register(new M),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this.widgets=[],this.labels=[],this.registerListeners(e)}registerListeners(e){this._register(e.onDidChangeVisibility(t=>{this.widgets.forEach(i=>i.notifyVisibilityChanged(t))})),this._register(this.languageService.onDidChange(()=>this.widgets.forEach(t=>t.notifyExtensionsRegistered()))),this._register(this.modelService.onModelLanguageChanged(t=>{t.model.uri&&this.widgets.forEach(i=>i.notifyModelLanguageChanged(t.model))})),this._register(this.modelService.onModelAdded(t=>{t.uri&&this.widgets.forEach(i=>i.notifyModelAdded(t))})),this._register(this.workspaceService.onDidChangeWorkspaceFolders(()=>{this.widgets.forEach(t=>t.notifyWorkspaceFoldersChange())})),this._register(this.decorationsService.onDidChangeDecorations(t=>{let i=!1;this.widgets.forEach(n=>{n.notifyFileDecorationsChanges(t)&&(i=!0)}),i&&this._onDidChangeDecorations.fire()})),this._register(this.themeService.onDidColorThemeChange(()=>this.widgets.forEach(t=>t.notifyThemeChange()))),this._register(this.configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(gne)&&this.widgets.forEach(i=>i.notifyFileAssociationsChange())})),this._register(this.labelService.onDidChangeFormatters(t=>{this.widgets.forEach(i=>i.notifyFormattersChange(t.scheme))})),this._register(this.textFileService.untitled.onDidChangeLabel(t=>{this.widgets.forEach(i=>i.notifyUntitledLabelChange(t.resource))}))}get(e){return this.labels[e]}create(e,t){const i=this.instantiationService.createInstance(xH,e,t),n={element:i.element,onDidRender:i.onDidRender,setLabel:(o,r,a)=>i.setLabel(o,r,a),setResource:(o,r)=>i.setResource(o,r),setFile:(o,r)=>i.setFile(o,r),clear:()=>i.clear(),dispose:()=>this.disposeWidget(i)};return this.labels.push(n),this.widgets.push(i),n}disposeWidget(e){const t=this.widgets.indexOf(e);t>-1&&(this.widgets.splice(t,1),this.labels.splice(t,1)),Qe(e)}clear(){this.widgets=Qe(this.widgets),this.labels=[]}dispose(){super.dispose(),this.clear()}};vd=f([p(1,J),p(2,ne),p(3,ai),p(4,Tt),p(5,fi),p(6,kv),p(7,ft),p(8,di),p(9,Ds)],vd);let EH=class extends vd{get element(){return this.label}constructor(e,t,i,n,o,r,a,c,d,l,u){super(AO,i,n,o,r,a,c,d,l,u),this.label=this._register(this.create(e,t))}};EH=f([p(2,J),p(3,ne),p(4,ai),p(5,Tt),p(6,fi),p(7,kv),p(8,ft),p(9,di),p(10,Ds)],EH);var Zf;(function(s){s[s.Basic=1]="Basic",s[s.Full=2]="Full"})(Zf||(Zf={}));let xH=class extends cq{constructor(e,t,i,n,o,r,a,c,d){super(e,t),this.languageService=i,this.modelService=n,this.decorationsService=o,this.labelService=r,this.textFileService=a,this.contextService=c,this.notebookDocumentService=d,this._onDidRender=this._register(new M),this.onDidRender=this._onDidRender.event,this.label=void 0,this.decoration=this._register(new kt),this.options=void 0,this.computedIconClasses=void 0,this.computedLanguageId=void 0,this.computedPathLabel=void 0,this.computedWorkspaceFolderLabel=void 0,this.needsRedraw=void 0,this.isHidden=!1}notifyVisibilityChanged(e){e===this.isHidden&&(this.isHidden=!e,e&&this.needsRedraw&&(this.render({updateIcon:this.needsRedraw===Zf.Full,updateDecoration:this.needsRedraw===Zf.Full}),this.needsRedraw=void 0))}notifyModelLanguageChanged(e){this.handleModelEvent(e)}notifyModelAdded(e){this.handleModelEvent(e)}handleModelEvent(e){const t=Nl(this.label);t&&Dt(e.uri,t)&&this.computedLanguageId!==e.getLanguageId()&&(this.computedLanguageId=e.getLanguageId(),this.render({updateIcon:!0,updateDecoration:!1}))}notifyFileDecorationsChanges(e){if(!this.options)return!1;const t=Nl(this.label);return t&&this.options.fileDecorations&&e.affectsResource(t)?this.render({updateIcon:!1,updateDecoration:!0}):!1}notifyExtensionsRegistered(){this.render({updateIcon:!0,updateDecoration:!1})}notifyThemeChange(){this.render({updateIcon:!1,updateDecoration:!1})}notifyFileAssociationsChange(){this.render({updateIcon:!0,updateDecoration:!1})}notifyFormattersChange(e){Nl(this.label)?.scheme===e&&this.render({updateIcon:!1,updateDecoration:!1})}notifyUntitledLabelChange(e){Dt(e,Nl(this.label))&&this.render({updateIcon:!1,updateDecoration:!1})}notifyWorkspaceFoldersChange(){if(typeof this.computedWorkspaceFolderLabel=="string"){const e=Nl(this.label);R.isUri(e)&&this.label?.name===this.computedWorkspaceFolderLabel&&this.setFile(e,this.options)}}setFile(e,t){const i=t?.hideLabel;let n;if(!i){if(t?.fileKind===Hi.ROOT_FOLDER){const r=this.contextService.getWorkspaceFolder(e);r&&(n=r.name,this.computedWorkspaceFolderLabel=n)}n||(n=$T(el(e)))}let o;if(!t?.hidePath){const r=this.labelService.getUriLabel(hs(e),{relative:!0});r&&r!=="."&&(o=r)}this.setResource({resource:e,name:n,description:o,range:t?.range},t)}setResource(e,t=Object.create(null)){const i=Nl(e),n=e?.resource&&!R.isUri(e.resource);if(!t.forceLabel&&!n&&i?.scheme===ae.untitled){const d=this.textFileService.untitled.get(i);if(d&&!d.hasAssociatedFilePath){if(typeof e.name=="string"&&(e.name=d.name),typeof e.description=="string"){const u=d.resource.path;e.name!==u?e.description=u:e.description=void 0}const l=d.resource.path;d.name!==l?t.title=`${d.name} • ${l}`:t.title=l}}if(!t.forceLabel&&!n&&i?.scheme===ae.vscodeNotebookCell){const d=this.notebookDocumentService.getNotebook(i),l=d?.getCellIndex(i);d&&l!==void 0&&typeof e.name=="string"&&(t.title=h(2846,"{0} • Cell {1}",e.name,`${l+1}`)),typeof e.name=="string"&&d&&l!==void 0&&typeof e.name=="string"&&(e.name=h(2846,"{0} • Cell {1}",e.name,`${l+1}`))}if(!t.forceLabel&&!n&&i?.scheme===ae.vscodeNotebookCellOutput){const d=this.notebookDocumentService.getNotebook(i),l=_oe(i);if(l?.cellFragment){if(!l.notebook)return;const u=l.notebook.with({scheme:ae.vscodeNotebookCell,fragment:l.cellFragment}),g=d?.getCellIndex(u),m=l.outputIndex;g!==void 0&&m!==void 0&&typeof e.name=="string"?e.name=h(2847,"{0} • Cell {1} • Output {2}",e.name,`${g+1}`,`${m+1}`):g!==void 0&&typeof e.name=="string"&&(e.name=h(2848,"{0} • Cell {1} • Output",e.name,`${g+1}`))}}const o=this.hasResourceChanged(e),r=o||this.hasPathLabelChanged(e),a=this.hasFileKindChanged(t),c=this.hasIconChanged(t);this.label=e,this.options=t,o&&(this.computedLanguageId=void 0),r&&(this.computedPathLabel=void 0),this.render({updateIcon:o||a||c,updateDecoration:o||a})}hasFileKindChanged(e){const t=e?.fileKind,i=this.options?.fileKind;return t!==i}hasResourceChanged(e){const t=Nl(e),i=Nl(this.label);return t&&i?t.toString()!==i.toString():!(!t&&!i)}hasPathLabelChanged(e){const t=Nl(e);return!!t&&this.computedPathLabel!==this.labelService.getUriLabel(t)}hasIconChanged(e){return this.options?.icon!==e?.icon}clear(){this.label=void 0,this.options=void 0,this.computedLanguageId=void 0,this.computedIconClasses=void 0,this.computedPathLabel=void 0,this.setLabel("")}render(e){if(this.isHidden)return this.needsRedraw!==Zf.Full&&(this.needsRedraw=e.updateIcon||e.updateDecoration?Zf.Full:Zf.Basic),!1;if(e.updateIcon&&(this.computedIconClasses=void 0),!this.label)return!1;const t={title:"",italic:this.options?.italic,strikethrough:this.options?.strikethrough,matches:this.options?.matches,descriptionMatches:this.options?.descriptionMatches,extraClasses:[],separator:this.options?.separator,domId:this.options?.domId,disabledCommand:this.options?.disabledCommand,labelEscapeNewLines:this.options?.labelEscapeNewLines,descriptionTitle:this.options?.descriptionTitle},i=Nl(this.label);if(this.options?.title!==void 0&&(t.title=this.options.title),i&&i.scheme!==ae.data&&(!this.options?.title||typeof this.options.title!="string"&&!this.options.title.markdownNotSupportedFallback)&&(this.computedPathLabel||(this.computedPathLabel=this.labelService.getUriLabel(i)),!t.title||typeof t.title=="string"?t.title=this.computedPathLabel:t.title.markdownNotSupportedFallback||(t.title.markdownNotSupportedFallback=this.computedPathLabel)),this.options&&!this.options.hideIcon&&(this.computedIconClasses||(this.computedIconClasses=uh(this.modelService,this.languageService,i,this.options.fileKind,this.options.icon)),R.isUri(this.options.icon)&&(t.iconPath=this.options.icon),t.extraClasses=this.computedIconClasses.slice(0)),this.options?.extraClasses&&t.extraClasses.push(...this.options.extraClasses),this.options?.fileDecorations&&i){e.updateDecoration&&(this.decoration.value=this.decorationsService.getDecoration(i,this.options.fileKind!==Hi.FILE));const n=this.decoration.value;if(n){if(n.tooltip){if(typeof t.title=="string")t.title=`${t.title} • ${n.tooltip}`;else if(typeof t.title?.markdown=="string"){const o=`${t.title.markdown} • ${n.tooltip}`;t.title={markdown:o,markdownNotSupportedFallback:o}}}n.strikethrough&&(t.strikethrough=!0),this.options.fileDecorations.colors&&t.extraClasses.push(n.labelClassName),this.options.fileDecorations.badges&&(t.extraClasses.push(n.badgeClassName),t.extraClasses.push(n.iconClassName))}}return this.label.range&&(t.suffix=this.label.range.startLineNumber!==this.label.range.endLineNumber?`:${this.label.range.startLineNumber}-${this.label.range.endLineNumber}`:`:${this.label.range.startLineNumber}`),this.setLabel(this.label.name??"",this.label.description,t),this._onDidRender.fire(),!0}dispose(){super.dispose(),this.label=void 0,this.options=void 0,this.computedLanguageId=void 0,this.computedIconClasses=void 0,this.computedPathLabel=void 0,this.computedWorkspaceFolderLabel=void 0}};xH=f([p(2,fi),p(3,ai),p(4,kv),p(5,di),p(6,Ds),p(7,Tt),p(8,Vre)],xH);const KLe=new O("hasSpeechProvider",!1,{type:"boolean",description:h(9886,"A speech provider is registered to the speech service.")}),jLe=new O("speechToTextInProgress",!1,{type:"boolean",description:h(9887,"A speech-to-text session is in progress.")});new O("textToSpeechInProgress",!1,{type:"boolean",description:h(9888,"A text-to-speech session is in progress.")});var ub;(function(s){s[s.Started=1]="Started",s[s.Recognizing=2]="Recognizing",s[s.Recognized=3]="Recognized",s[s.Stopped=4]="Stopped",s[s.Error=5]="Error"})(ub||(ub={}));var IH;(function(s){s[s.Started=1]="Started",s[s.Stopped=2]="Stopped",s[s.Error=3]="Error"})(IH||(IH={}));var LX;(function(s){s[s.Recognized=1]="Recognized",s[s.Stopped=2]="Stopped",s[s.Canceled=3]="Canceled"})(LX||(LX={}));var Iu;(function(s){s.SpeechTimeout="accessibility.voice.speechTimeout",s.AutoSynthesize="accessibility.voice.autoSynthesize",s.SpeechLanguage="accessibility.voice.speechLanguage",s.IgnoreCodeBlocks="accessibility.voice.ignoreCodeBlocks"})(Iu||(Iu={}));Iu.SpeechLanguage;const YLe={"da-DK":{name:h(9889,"Danish (Denmark)")},"de-DE":{name:h(9890,"German (Germany)")},"en-AU":{name:h(9891,"English (Australia)")},"en-CA":{name:h(9892,"English (Canada)")},"en-GB":{name:h(9893,"English (United Kingdom)")},"en-IE":{name:h(9894,"English (Ireland)")},"en-IN":{name:h(9895,"English (India)")},"en-NZ":{name:h(9896,"English (New Zealand)")},"en-US":{name:h(9897,"English (United States)")},"es-ES":{name:h(9898,"Spanish (Spain)")},"es-MX":{name:h(9899,"Spanish (Mexico)")},"fr-CA":{name:h(9900,"French (Canada)")},"fr-FR":{name:h(9901,"French (France)")},"hi-IN":{name:h(9902,"Hindi (India)")},"it-IT":{name:h(9903,"Italian (Italy)")},"ja-JP":{name:h(9904,"Japanese (Japan)")},"ko-KR":{name:h(9905,"Korean (South Korea)")},"nl-NL":{name:h(9906,"Dutch (Netherlands)")},"pt-PT":{name:h(9907,"Portuguese (Portugal)")},"pt-BR":{name:h(9908,"Portuguese (Brazil)")},"ru-RU":{name:h(9909,"Russian (Russia)")},"sv-SE":{name:h(9910,"Swedish (Sweden)")},"tr-TR":{name:h(9911,"Turkish (Türkiye)")},"zh-CN":{name:h(9912,"Chinese (Simplified, China)")},"zh-HK":{name:h(9913,"Chinese (Traditional, Hong Kong)")},"zh-TW":{name:h(9914,"Chinese (Traditional, Taiwan)")}},dg=new O("accessibilityHelpIsShown",!1,!0),Ta=new O("accessibleViewIsShown",!1,!0),JR=new O("accessibleViewSupportsNavigation",!1,!0),MX=new O("accessibleViewVerbosityEnabled",!1,!0),NX=new O("accessibleViewGoToSymbolSupported",!1,!0);new O("accessibleViewOnLastLine",!1,!0);const Dp=new O("accessibleViewCurrentProviderId",void 0,void 0);new O("accessibleViewInCodeBlock",void 0,void 0);const eP=new O("accessibleViewContainsCodeBlocks",void 0,void 0),OX=new O("accessibleViewHasUnassignedKeybindings",void 0,void 0),FX=new O("accessibleViewHasAssignedKeybindings",void 0,void 0);var DH;(function(s){s.DimUnfocusedEnabled="accessibility.dimUnfocused.enabled",s.DimUnfocusedOpacity="accessibility.dimUnfocused.opacity",s.HideAccessibleView="accessibility.hideAccessibleView",s.AccessibleViewCloseOnKeyPress="accessibility.accessibleView.closeOnKeyPress"})(DH||(DH={}));var WX;(function(s){s[s.Default=.75]="Default",s[s.Minimum=.2]="Minimum",s[s.Maximum=1]="Maximum"})(WX||(WX={}));var Un;(function(s){s.Terminal="accessibility.verbosity.terminal",s.DiffEditor="accessibility.verbosity.diffEditor",s.MergeEditor="accessibility.verbosity.mergeEditor",s.Chat="accessibility.verbosity.panelChat",s.InlineChat="accessibility.verbosity.inlineChat",s.TerminalChat="accessibility.verbosity.terminalChat",s.InlineCompletions="accessibility.verbosity.inlineCompletions",s.KeybindingsEditor="accessibility.verbosity.keybindingsEditor",s.Notebook="accessibility.verbosity.notebook",s.Editor="accessibility.verbosity.editor",s.Hover="accessibility.verbosity.hover",s.Notification="accessibility.verbosity.notification",s.EmptyEditorHint="accessibility.verbosity.emptyEditorHint",s.ReplEditor="accessibility.verbosity.replEditor",s.Comments="accessibility.verbosity.comments",s.DiffEditorActive="accessibility.verbosity.diffEditorActive",s.Debug="accessibility.verbosity.debug",s.Walkthrough="accessibility.verbosity.walkthrough",s.SourceControl="accessibility.verbosity.sourceControl"})(Un||(Un={}));const Ode=Object.freeze({id:"accessibility",title:h(4048,"Accessibility"),type:"object"});h(4049,"Enable sound when a screen reader is attached."),h(4050,"Enable sound."),h(4051,"Disable sound.");h(4052,"Enable announcement, will only play when in screen reader optimized mode."),h(4053,"Disable announcement.");({...Ode,scope:Bt.RESOURCE,properties:(Un.Terminal+"",h(4054,"Provide information about how to access the terminal accessibility help menu when the terminal is focused."),Un.DiffEditor+"",h(4055,"Provide information about how to navigate changes in the diff editor when it is focused."),Un.Chat+"",h(4056,"Provide information about how to access the chat help menu when the chat input is focused."),Un.InlineChat+"",h(4057,"Provide information about how to access the inline editor chat accessibility help menu and alert with hints that describe how to use the feature when the input is focused."),Un.InlineCompletions+"",h(4058,"Provide information about how to access the inline completions hover and Accessible View."),Un.KeybindingsEditor+"",h(4059,"Provide information about how to change a keybinding in the keybindings editor when a row is focused."),Un.Notebook+"",h(4060,"Provide information about how to focus the cell container or inner editor when a notebook cell is focused."),Un.Hover+"",h(4061,"Provide information about how to open the hover in an Accessible View."),Un.Notification+"",h(4062,"Provide information about how to open the notification in an Accessible View."),Un.EmptyEditorHint+"",h(4063,"Provide information about relevant actions in an empty text editor."),Un.ReplEditor+"",h(4064,"Provide information about how to access the REPL editor accessibility help menu when the REPL editor is focused."),Un.Comments+"",h(4065,"Provide information about actions that can be taken in the comment widget or in a file which contains comments."),Un.DiffEditorActive+"",h(4066,"Indicate when a diff editor becomes the active editor."),Un.Debug+"",h(4067,"Provide information about how to access the debug console accessibility help dialog when the debug console or run and debug viewlet is focused. Note that a reload of the window is required for this to take effect."),Un.Walkthrough+"",h(4068,"Provide information about how to open the walkthrough in an Accessible View."),DH.AccessibleViewCloseOnKeyPress+"",h(4069,"On keypress, close the Accessible View and focus the element from which it was invoked."),Un.SourceControl+"",h(4070,"Provide information about how to access the source control accessibility help menu when the input is focused."),h(4071,"The volume of the sounds in percent (0-100)."),h(4072,"Whether or not position changes should be debounced"),h(4073,"The delay in milliseconds before an announcement is made."),h(4074,"The delay in milliseconds before a sound is played."),h(4075,"The delay in milliseconds before an announcement is made when there's a warning at the position."),h(4076,"The delay in milliseconds before a sound is played when there's a warning at the position."),h(4077,"The delay in milliseconds before an announcement is made when there's an error at the position."),h(4078,"The delay in milliseconds before a sound is played when there's an error at the position."),h(4079,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a breakpoint."),h(4080,"Plays a sound when the active line has a breakpoint."),h(4081,"Announces when the active line has a breakpoint."),h(4082,"Plays a sound / audio cue when the active line has an inline suggestion."),h(4083,"Plays a sound when the active line has an inline suggestion."),h(4084,"Plays a signal - sound / audio cue and/or announcement (alert) when there is a next edit suggestion."),h(4085,"Plays a sound when there is a next edit suggestion."),h(4086,"Announces when there is a next edit suggestion."),h(4087,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has an error."),h(4088,"Plays a sound when the active line has an error."),h(4089,"Announces when the active line has an error."),h(4090,"Plays a signal - sound (audio cue) and/or announcement (alert) - the active line has a folded area that can be unfolded."),h(4091,"Plays a sound when the active line has a folded area that can be unfolded."),h(4092,"Announces when the active line has a folded area that can be unfolded."),h(4093,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a warning."),h(4094,"Plays a sound when the active line has a warning."),h(4095,"Announces when the active line has a warning."),h(4096,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a warning."),h(4097,"Plays a sound when the active line has a warning."),h(4098,"Announces when the active line has a warning."),h(4099,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a warning."),h(4100,"Plays a sound when the active line has a warning."),h(4101,"Announces when the active line has a warning."),h(4102,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the debugger stopped on a breakpoint."),h(4103,"Plays a sound when the debugger stopped on a breakpoint."),h(4104,"Announces when the debugger stopped on a breakpoint."),h(4105,"Plays a signal - sound (audio cue) and/or announcement (alert) - when trying to read a line with inlay hints that has no inlay hints."),h(4106,"Plays a sound when trying to read a line with inlay hints that has no inlay hints."),h(4107,"Announces when trying to read a line with inlay hints that has no inlay hints."),h(4108,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a task is completed."),h(4109,"Plays a sound when a task is completed."),h(4110,"Announces when a task is completed."),h(4111,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a task fails (non-zero exit code)."),h(4112,"Plays a sound when a task fails (non-zero exit code)."),h(4113,"Announces when a task fails (non-zero exit code)."),h(4114,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a terminal command fails (non-zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4115,"Plays a sound when a terminal command fails (non-zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4116,"Announces when a terminal command fails (non-zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4117,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a terminal command succeeds (zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4118,"Plays a sound when a terminal command succeeds (zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4119,"Announces when a terminal command succeeds (zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4120,"Plays a signal - sound (audio cue) and/or announcement (alert) - when terminal Quick Fixes are available."),h(4121,"Plays a sound when terminal Quick Fixes are available."),h(4122,"Announces when terminal Quick Fixes are available."),h(4123,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the terminal bell is ringing."),h(4124,"Plays a sound when the terminal bell is ringing."),h(4125,"Announces when the terminal bell is ringing."),h(4126,"Plays a sound / audio cue when the focus moves to an inserted line in Accessible Diff Viewer mode or to the next/previous change."),h(4127,"Plays a sound when the focus moves to an inserted line in Accessible Diff Viewer mode or to the next/previous change."),h(4128,"Plays a sound / audio cue when the focus moves to an modified line in Accessible Diff Viewer mode or to the next/previous change."),h(4129,"Plays a sound when the focus moves to a modified line in Accessible Diff Viewer mode or to the next/previous change."),h(4130,"Plays a sound / audio cue when the focus moves to an deleted line in Accessible Diff Viewer mode or to the next/previous change."),h(4131,"Plays a sound when the focus moves to an deleted line in Accessible Diff Viewer mode or to the next/previous change."),h(4132,"Plays a sound / audio cue when revealing a file with changes from chat edits"),h(4133,"Plays a sound when revealing a file with changes from chat edits"),h(4134,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a notebook cell execution is successfully completed."),h(4135,"Plays a sound when a notebook cell execution is successfully completed."),h(4136,"Announces when a notebook cell execution is successfully completed."),h(4137,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a notebook cell execution fails."),h(4138,"Plays a sound when a notebook cell execution fails."),h(4139,"Announces when a notebook cell execution fails."),h(4140,"Plays a signal - sound (audio cue) and/or announcement (alert) - on loop while progress is occurring."),h(4141,"Plays a sound on loop while progress is occurring."),h(4142,"Alerts on loop while progress is occurring."),h(4143,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a chat request is made."),h(4144,"Plays a sound when a chat request is made."),h(4145,"Announces when a chat request is made."),h(4146,"Plays a sound / audio cue when the response has been received."),h(4147,"Plays a sound on when the response has been received."),h(4148,"Plays a sound / audio cue - when a code action has been triggered."),h(4149,"Plays a sound when a code action has been triggered."),h(4150,"Plays a sound / audio cue when the code action has been applied."),h(4151,"Plays a sound when the code action has been applied."),h(4152,"Plays a sound / audio cue when the voice recording has started."),h(4153,"Plays a sound when the voice recording has started."),h(4154,"Plays a sound / audio cue when the voice recording has stopped."),h(4155,"Plays a sound when the voice recording has stopped."),h(4156,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a feature is cleared (for example, the terminal, Debug Console, or Output channel)."),h(4157,"Plays a sound when a feature is cleared."),h(4158,"Announces when a feature is cleared."),h(4159,"Plays a signal - sound (audio cue) and/or announcement (alert) - when edits have been undone."),h(4160,"Plays a sound when edits have been undone."),h(4161,"Announces when edits have been undone."),h(4162,"Plays a signal - sound (audio cue) and/or announcement (alert) - when edits are kept."),h(4163,"Plays a sound when edits are kept."),h(4164,"Announces when edits are kept."),h(4165,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a file is saved."),h(4166,"Plays a sound when a file is saved."),h(4167,"Plays the sound when a user explicitly saves a file."),h(4168,"Plays the sound whenever a file is saved, including auto save."),h(4169,"Never plays the sound."),h(4170,"Announces when a file is saved."),h(4171,"Announces when a user explicitly saves a file."),h(4172,"Announces whenever a file is saved, including auto save."),h(4173,"Never plays the announcement."),h(4174,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a file or notebook is formatted."),h(4175,"Plays a sound when a file or notebook is formatted."),h(4176,"Plays the sound when a user explicitly formats a file."),h(4177,"Plays the sound whenever a file is formatted, including if it is set to format on save, type, or, paste, or run of a cell."),h(4178,"Never plays the sound."),h(4179,"Announces when a file or notebook is formatted."),h(4180,"Announces when a user explicitly formats a file."),h(4181,"Announces whenever a file is formatted, including if it is set to format on save, type, or, paste, or run of a cell."),h(4182,"Never announces."),h(4183,"Plays a signal - sound (audio cue) and/or announcement (alert) - when user action is required in the chat."),h(4184,"Plays a sound when user action is required in the chat."),h(4185,"Enable sound when a screen reader is attached or when the current window is not focused."),h(4050,"Enable sound."),h(4051,"Disable sound."),h(4186,"Announces when a user action is required in the chat - including information about the action and how to take it."),h(4187,"Controls whether links should be underlined in the workbench."),h(4188,"Controls whether variable changes should be announced in the debug watch view."),h(4189,"Controls whether the output from an execution in the native REPL will be announced."),h(4190,"Control whether focus should automatically be sent to the REPL when code is executed."),h(4191,"Controls whether the {0} should be optimized for screen readers when in screen reader mode. When enabled, the window title will have {1} appended to the end.","`#window.title#`","`activeEditorState`"))});const QLe=1200;let BX=class extends F{static{this.ID="workbench.contrib.dynamicSpeechAccessibilityConfiguration"}constructor(e){super(),this.speechService=e,this._register(D.runAndSubscribe(e.onDidChangeHasSpeechProvider,()=>this.updateConfiguration()))}updateConfiguration(){if(!this.speechService.hasSpeechProvider)return;const e=this.getLanguages(),t=Object.keys(e).sort((n,o)=>e[n].name.localeCompare(e[o].name));Ge.as(qs.Configuration).registerConfiguration({...Ode,properties:{[Iu.SpeechTimeout]:{markdownDescription:h(4195,"The duration in milliseconds that voice speech recognition remains active after you stop speaking. For example in a chat session, the transcribed text is submitted automatically after the timeout is met. Set to `0` to disable this feature."),type:"number",default:QLe,minimum:0,tags:["accessibility"]},[Iu.IgnoreCodeBlocks]:{markdownDescription:h(4196,"Whether to ignore code snippets in text-to-speech synthesis."),type:"boolean",default:!1,tags:["accessibility"]},[Iu.SpeechLanguage]:{markdownDescription:h(4197,"The language that text-to-speech and speech-to-text should use. Select `auto` to use the configured display language if possible. Note that not all display languages maybe supported by speech recognition and synthesizers."),type:"string",enum:t,default:"auto",tags:["accessibility"],enumDescriptions:t.map(n=>e[n].name),enumItemLabels:t.map(n=>e[n].name)},[Iu.AutoSynthesize]:{type:"string",enum:["on","off"],enumDescriptions:[h(4198,"Enable the feature. When a screen reader is enabled, note that this will disable aria updates."),h(4199,"Disable the feature.")],markdownDescription:h(4200,"Whether a textual response should automatically be read out aloud when speech was used as input. For example in a chat session, a response is automatically synthesized when voice was used as chat request."),default:"off",tags:["accessibility"]}}})}getLanguages(){return{auto:{name:h(4201,"Auto (Use Display Language)")},...YLe}}};BX=f([p(0,LN)],BX);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"audioCues.volume",migrateFn:(s,e)=>[["accessibility.signalOptions.volume",{value:s}],["audioCues.volume",{value:void 0}]]}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"audioCues.debouncePositionChanges",migrateFn:s=>[["accessibility.signalOptions.debouncePositionChanges",{value:s}],["audioCues.debouncePositionChanges",{value:void 0}]]}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signalOptions",migrateFn:(s,e)=>{const t=A0(e,"general"),i=A0(e,"errorAtPosition"),n=A0(e,"warningAtPosition"),o=XLe(e),r=ZLe(e),a=[];return o&&a.push(["accessibility.signalOptions.volume",{value:o}]),t&&a.push(["accessibility.signalOptions.experimental.delays.general",{value:t}]),i&&a.push(["accessibility.signalOptions.experimental.delays.errorAtPosition",{value:i}]),n&&a.push(["accessibility.signalOptions.experimental.delays.warningAtPosition",{value:n}]),r&&a.push(["accessibility.signalOptions.debouncePositionChanges",{value:r}]),a.push(["accessibility.signalOptions",{value:void 0}]),a}}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signals.sounds.volume",migrateFn:s=>[["accessibility.signalOptions.volume",{value:s}],["accessibility.signals.sounds.volume",{value:void 0}]]}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signals.debouncePositionChanges",migrateFn:s=>[["accessibility.signalOptions.debouncePositionChanges",{value:s}],["accessibility.signals.debouncePositionChanges",{value:void 0}]]}]);function A0(s,e){return s(`accessibility.signalOptions.experimental.delays.${e}`)||s("accessibility.signalOptions")?.["experimental.delays"]?.[`${e}`]||s("accessibility.signalOptions")?.delays?.[`${e}`]}function XLe(s){return s("accessibility.signalOptions.volume")||s("accessibility.signalOptions")?.volume||s("accessibility.signals.sounds.volume")||s("audioCues.volume")}function ZLe(s){return s("accessibility.signalOptions.debouncePositionChanges")||s("accessibility.signalOptions")?.debouncePositionChanges||s("accessibility.signals.debouncePositionChanges")||s("audioCues.debouncePositionChanges")}Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:Iu.AutoSynthesize,migrateFn:s=>{let e;if(s===!0)e="on";else if(s===!1)e="off";else return[];return[[Iu.AutoSynthesize,{value:e}]]}}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signals.chatResponsePending",migrateFn:(s,e)=>[["accessibility.signals.progress",{value:s}],["accessibility.signals.chatResponsePending",{value:void 0}]]}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations(Up.allAccessibilitySignals.map(s=>s.legacySoundSettingsKey?{key:s.legacySoundSettingsKey,migrateFn:(e,t)=>{const i=[],n=s.legacyAnnouncementSettingsKey;let o;return n&&(o=t(n)??void 0,o!==void 0&&typeof o!="string"&&(o=o?"auto":"off")),i.push([`${s.legacySoundSettingsKey}`,{value:void 0}]),i.push([`${s.settingsKey}`,{value:o!==void 0?{announcement:o,sound:e}:{sound:e}}]),i}}:void 0).filter(ya));Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations(Up.allAccessibilitySignals.filter(s=>!!s.legacyAnnouncementSettingsKey&&!!s.legacySoundSettingsKey).map(s=>({key:s.legacyAnnouncementSettingsKey,migrateFn:(e,t)=>{const i=[],n=t(s.settingsKey)?.sound||t(s.legacySoundSettingsKey);return e!==void 0&&typeof e!="string"&&(e=e?"auto":"off"),i.push([`${s.settingsKey}`,{value:e!==void 0?{announcement:e,sound:n}:{sound:n}}]),i.push([`${s.legacyAnnouncementSettingsKey}`,{value:void 0}]),i.push([`${s.legacySoundSettingsKey}`,{value:void 0}]),i}})));var Mo;(function(s){s.OpenAccessibleView="editor.action.accessibleView",s.OpenAccessibilityHelp="editor.action.accessibilityHelp",s.DisableVerbosityHint="editor.action.accessibleViewDisableHint",s.GoToSymbol="editor.action.accessibleViewGoToSymbol",s.ShowNext="editor.action.accessibleViewNext",s.ShowPrevious="editor.action.accessibleViewPrevious",s.AccessibleViewAcceptInlineCompletion="editor.action.accessibleViewAcceptInlineCompletion",s.NextCodeBlock="editor.action.accessibleViewNextCodeBlock",s.PreviousCodeBlock="editor.action.accessibleViewPreviousCodeBlock",s.AccessibilityHelpConfigureKeybindings="editor.action.accessibilityHelpConfigureKeybindings",s.AccessibilityHelpConfigureAssignedKeybindings="editor.action.accessibilityHelpConfigureAssignedKeybindings",s.AccessibilityHelpOpenHelpLink="editor.action.accessibilityHelpOpenHelpLink"})(Mo||(Mo={}));var kH;let Xp=class{static{kH=this}static{this.ID="editor.contrib.contextmenu"}static get(e){return e.getContribution(kH.ID)}constructor(e,t,i,n,o,r,a,c){this._contextMenuService=t,this._contextViewService=i,this._contextKeyService=n,this._keybindingService=o,this._menuService=r,this._configurationService=a,this._workspaceContextService=c,this._toDispose=new U,this._contextMenuIsBeingShownCount=0,this._editor=e,this._toDispose.add(this._editor.onContextMenu(d=>this._onContextMenu(d))),this._toDispose.add(this._editor.onMouseWheel(d=>{if(this._contextMenuIsBeingShownCount>0){const l=this._contextViewService.getContextViewElement(),u=d.srcElement;u.shadowRoot&&qve(l)===u.shadowRoot||this._contextViewService.hideContextView()}})),this._toDispose.add(this._editor.onKeyDown(d=>{this._editor.getOption(L.contextmenu)&&d.keyCode===S.ContextMenu&&(d.preventDefault(),d.stopPropagation(),this.showContextMenu())}))}_onContextMenu(e){if(!this._editor.hasModel())return;if(!this._editor.getOption(L.contextmenu)){this._editor.focus(),e.target.position&&!this._editor.getSelection().containsPosition(e.target.position)&&this._editor.setPosition(e.target.position);return}if(e.target.type===Ei.OVERLAY_WIDGET||e.target.type===Ei.CONTENT_TEXT&&e.target.detail.injectedText)return;if(e.event.preventDefault(),e.event.stopPropagation(),e.target.type===Ei.SCROLLBAR)return this._showScrollbarContextMenu(e.event);if(e.target.type!==Ei.CONTENT_TEXT&&e.target.type!==Ei.CONTENT_EMPTY&&e.target.type!==Ei.TEXTAREA)return;if(this._editor.focus(),e.target.position){let i=!1;for(const n of this._editor.getSelections())if(n.containsPosition(e.target.position)){i=!0;break}i||this._editor.setPosition(e.target.position)}let t=null;e.target.type!==Ei.TEXTAREA&&(t=e.event),this.showContextMenu(t)}showContextMenu(e){if(!this._editor.getOption(L.contextmenu)||!this._editor.hasModel())return;const t=this._getMenuActions(this._editor.getModel(),this._editor.contextMenuId);t.length>0&&this._doShowContextMenu(t,e)}_getMenuActions(e,t){const i=[],n=this._menuService.getMenuActions(t,this._contextKeyService,{arg:e.uri});for(const o of n){const[,r]=o;let a=0;for(const c of r)if(c instanceof kh){const d=this._getMenuActions(e,c.item.submenu);d.length>0&&(i.push(new Dh(c.id,c.label,d)),a++)}else i.push(c),a++;a&&i.push(new is)}return i.length&&i.pop(),i}_doShowContextMenu(e,t=null){if(!this._editor.hasModel())return;const i=this._editor.getOption(L.hover);this._editor.updateOptions({hover:{enabled:!1}});let n=t;if(!n){this._editor.revealPosition(this._editor.getPosition(),ji.Immediate),this._editor.render();const r=this._editor.getScrolledVisiblePosition(this._editor.getPosition()),a=Ms(this._editor.getDomNode()),c=a.left+r.left,d=a.top+r.top+r.height;n={x:c,y:d}}const o=this._editor.getOption(L.useShadowDOM)&&!EE;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:o?this._editor.getOverflowWidgetsDomNode()??this._editor.getDomNode():void 0,getAnchor:()=>n,getActions:()=>e,getActionViewItem:r=>{const a=this._keybindingFor(r);if(a)return new qm(r,r,{label:!0,keybinding:a.getLabel(),isMenu:!0});const c=r;return typeof c.getActionViewItem=="function"?c.getActionViewItem():new qm(r,r,{icon:!0,label:!0,isMenu:!0})},getKeyBinding:r=>this._keybindingFor(r),onHide:r=>{this._contextMenuIsBeingShownCount--,this._editor.updateOptions({hover:i})}})}_showScrollbarContextMenu(e){if(!this._editor.hasModel()||zve(this._workspaceContextService.getWorkspace()))return;const t=this._editor.getOption(L.minimap);let i=0;const n=d=>({id:`menu-action-${++i}`,label:d.label,tooltip:"",class:void 0,enabled:typeof d.enabled>"u"?!0:d.enabled,checked:d.checked,run:d.run}),o=(d,l)=>new Dh(`menu-action-${++i}`,d,l,void 0),r=(d,l,u,g,m)=>{if(!l)return n({label:d,enabled:l,run:()=>{}});const v=w=>()=>{this._configurationService.updateValue(u,w)},y=[];for(const w of m)y.push(n({label:w.label,checked:g===w.value,run:v(w.value)}));return o(d,y)},a=[];a.push(n({label:h(967,"Minimap"),checked:t.enabled,run:()=>{this._configurationService.updateValue("editor.minimap.enabled",!t.enabled)}})),a.push(new is),a.push(n({label:h(968,"Render Characters"),enabled:t.enabled,checked:t.renderCharacters,run:()=>{this._configurationService.updateValue("editor.minimap.renderCharacters",!t.renderCharacters)}})),a.push(r(h(969,"Vertical size"),t.enabled,"editor.minimap.size",t.size,[{label:h(970,"Proportional"),value:"proportional"},{label:h(971,"Fill"),value:"fill"},{label:h(972,"Fit"),value:"fit"}])),a.push(r(h(973,"Slider"),t.enabled,"editor.minimap.showSlider",t.showSlider,[{label:h(974,"Mouse Over"),value:"mouseover"},{label:h(975,"Always"),value:"always"}]));const c=this._editor.getOption(L.useShadowDOM)&&!EE;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:c?this._editor.getDomNode():void 0,getAnchor:()=>e,getActions:()=>a,onHide:d=>{this._contextMenuIsBeingShownCount--,this._editor.focus()}})}_keybindingFor(e){return this._keybindingService.lookupKeybinding(e.id)}dispose(){this._contextMenuIsBeingShownCount>0&&this._contextViewService.hideContextView(),this._toDispose.dispose()}};Xp=kH=f([p(1,mi),p(2,cf),p(3,me),p(4,Ve),p(5,tn),p(6,ne),p(7,Tt)],Xp);class JLe extends we{constructor(){super({id:"editor.action.showContextMenu",label:I(976,"Show Editor Context Menu"),precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:E.Shift|S.F10,weight:W.EditorContrib}})}run(e,t){Xp.get(t)?.showContextMenu()}}Rt(Xp.ID,Xp,vt.BeforeFirstInteraction);ue(JLe);class fx extends F{static{this.ID="editor.contrib.menuPreventer"}constructor(e){super(),this._editor=e,this._altListeningMouse=!1,this._altMouseTriggered=!1,this._register(this._editor.onMouseDown(t=>{this._altListeningMouse&&(this._altMouseTriggered=!0)})),this._register(this._editor.onKeyDown(t=>{t.equals(E.Alt)&&(this._altListeningMouse||(this._altMouseTriggered=!1),this._altListeningMouse=!0)})),this._register(this._editor.onKeyUp(t=>{t.equals(E.Alt)&&(this._altMouseTriggered&&t.preventDefault(),this._altListeningMouse=!1,this._altMouseTriggered=!1)}))}}Rt(fx.ID,fx,vt.BeforeFirstInteraction);const Fde="editor.contrib.selectionClipboard";class eMe{constructor(e){this.isBogous=!1,this.isTrivial=!1,this.usesClipboardVariable=!1,this.usesSelectionVariable=!1,this.codeSnippet=e;const t=new fd().parse(e,!1),i=new Map;let n=0;for(const r of t.placeholders)n=Math.max(n,r.index);if(t.placeholders.length===0)this.isTrivial=!0;else if(n===0){const r=t.children.at(-1);this.isTrivial=r instanceof Xr&&r.isFinalTabstop}const o=[...t.children];for(;o.length>0;){const r=o.shift();if(r instanceof Wy){if(r.children.length===0&&!kLe[r.name]){const a=i.has(r.name)?i.get(r.name):++n;i.set(r.name,a);const c=new Xr(a).appendChild(new pr(r.name));t.replace(r,[c]),this.isBogous=!0}switch(r.name){case"CLIPBOARD":this.usesClipboardVariable=!0;break;case"SELECTION":case"TM_SELECTED_TEXT":this.usesSelectionVariable=!0;break}}else o.push(...r.children)}this.isBogous&&(this.codeSnippet=t.toTextmateString())}}class Wde{constructor(e,t,i,n,o,r,a,c,d,l){this.isFileTemplate=e,this.scopes=t,this.name=i,this.prefix=n,this.description=o,this.body=r,this.source=a,this.snippetSource=c,this.snippetIdentifier=d,this.extensionId=l,this.prefixLow=n.toLowerCase(),this._bodyInsights=new Dk(Vp(),()=>new eMe(this.body))}get codeSnippet(){return this._bodyInsights.value.codeSnippet}get isBogous(){return this._bodyInsights.value.isBogous}get isTrivial(){return this._bodyInsights.value.isTrivial}get needsClipboard(){return this._bodyInsights.value.usesClipboardVariable}get usesSelection(){return this._bodyInsights.value.usesSelectionVariable}}function tMe(s){return oa(s)&&!!s.body}var ih;(function(s){s[s.User=1]="User",s[s.Workspace=2]="Workspace",s[s.Extension=3]="Extension"})(ih||(ih={}));class R0{constructor(e,t,i,n,o,r){this.source=e,this.location=t,this.defaultScopes=i,this._extension=n,this._fileService=o,this._extensionResourceLoaderService=r,this.data=[],this.isGlobalSnippets=QM(t.path)===".code-snippets",this.isUserSnippets=!this._extension}select(e,t){this.isGlobalSnippets||!this.isUserSnippets?this._scopeSelect(e,t):this._filepathSelect(e,t)}_filepathSelect(e,t){e+".json"===Sn(this.location.path)&&t.push(...this.data)}_scopeSelect(e,t){for(const n of this.data){const o=n.scopes.length;if(o===0)t.push(n);else for(let r=0;r<o;r++)if(n.scopes[r]===e){t.push(n);break}}const i=e.lastIndexOf(".");i>=0&&this._scopeSelect(e.substring(0,i),t)}async _load(){return this._extension?this._extensionResourceLoaderService.readExtensionResource(this.location):(await this._fileService.readFile(this.location)).value.toString()}load(){return this._loadPromise||(this._loadPromise=Promise.resolve(this._load()).then(e=>{const t=Db(e);if(hC(t)==="object")for(const[i,n]of Object.entries(t))if(tMe(n))this._parseSnippet(i,n,this.data);else for(const[o,r]of Object.entries(n))this._parseSnippet(o,r,this.data);return this})),this._loadPromise}reset(){this._loadPromise=void 0,this.data.length=0}_parseSnippet(e,t,i){let{isFileTemplate:n,prefix:o,body:r,description:a}=t;if(o||(o=""),Array.isArray(r)&&(r=r.join(`
`)),typeof r!="string")return;Array.isArray(a)&&(a=a.join(`
`));let c;this.defaultScopes?c=this.defaultScopes:typeof t.scope=="string"?c=t.scope.split(",").map(l=>l.trim()).filter(Boolean):c=[];let d;this._extension?d=this._extension.displayName||this._extension.name:this.source===ih.Workspace?d=h(9871,"Workspace Snippet"):this.isGlobalSnippets?d=h(9872,"Global User Snippet"):d=h(9873,"User Snippet");for(const l of dn.wrap(o))i.push(new Wde(!!n,c,e,l,a,r,d,this.source,this._extension?`${Qu(this._extension.extensionLocation,this.location)}/${e}`:`${Sn(this.location.path)}/${e}`,this._extension?.identifier))}}const tP=_l.registerExtensionPoint({extensionPoint:"languages",jsonSchema:{description:h(12731,"Contributes language declarations."),type:"array",items:{type:"object",defaultSnippets:[{body:{id:"${1:languageId}",aliases:["${2:label}"],extensions:["${3:extension}"],configuration:"./language-configuration.json"}}],properties:{id:{description:h(12732,"ID of the language."),type:"string"},aliases:{description:h(12733,"Name aliases for the language."),type:"array",items:{type:"string"}},extensions:{description:h(12734,"File extensions associated to the language."),default:[".foo"],type:"array",items:{type:"string"}},filenames:{description:h(12735,"File names associated to the language."),type:"array",items:{type:"string"}},filenamePatterns:{description:h(12736,"File name glob patterns associated to the language."),type:"array",items:{type:"string"}},mimetypes:{description:h(12737,"Mime types associated to the language."),type:"array",items:{type:"string"}},firstLine:{description:h(12738,"A regular expression matching the first line of a file of the language."),type:"string"},configuration:{description:h(12739,"A relative path to a file containing configuration options for the language."),type:"string",default:"./language-configuration.json"},icon:{type:"object",description:h(12740,"A icon to use as file icon, if no icon theme provides one for the language."),properties:{light:{description:h(12741,"Icon path when a light theme is used"),type:"string"},dark:{description:h(12742,"Icon path when a dark theme is used"),type:"string"}}}}}},activationEventsGenerator:(s,e)=>{for(const t of s)t.id&&t.configuration&&e.push(`onLanguage:${t.id}`)}});class iMe extends F{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.languages}render(e){const t=e.contributes,i=t?.languages||[],n=[];for(const l of i)Bde(l)&&n.push({id:l.id,name:(l.aliases||[])[0]||l.id,extensions:l.extensions||[],hasGrammar:!1,hasSnippets:!1});const o=Kve(n,l=>l.id);if((t?.grammars||[]).forEach(l=>{if(!It(l.language))return;let u=o[l.language];u?u.hasGrammar=!0:(u={id:l.language,name:l.language,extensions:[],hasGrammar:!0,hasSnippets:!1},o[u.id]=u,n.push(u))}),(t?.snippets||[]).forEach(l=>{if(!It(l.language))return;let u=o[l.language];u?u.hasSnippets=!0:(u={id:l.language,name:l.language,extensions:[],hasGrammar:!1,hasSnippets:!0},o[u.id]=u,n.push(u))}),!n.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const c=[h(12743,"ID"),h(12744,"Name"),h(12745,"File Extensions"),h(12746,"Grammar"),h(12747,"Snippets")],d=n.sort((l,u)=>l.id.localeCompare(u.id)).map(l=>[l.id,l.name,new Ni().appendMarkdown(`${l.extensions.map(u=>`\`${u}\``).join("&nbsp;")}`),l.hasGrammar?"✔︎":"—",l.hasSnippets?"✔︎":"—"]);return{data:{headers:c,rows:d},dispose:()=>{}}}}Ge.as(_w.ExtensionFeaturesRegistry).registerExtensionFeature({id:"languages",label:h(12748,"Programming Languages"),access:{canToggle:!1},renderer:new _r(iMe)});let VX=class extends jve{constructor(e,t,i,n){super(i.verbose||i.isExtensionDevelopment||!i.isBuilt),this.logService=n,this._configurationService=t,this._extensionService=e,tP.setHandler(o=>{const r=[];for(let a=0,c=o.length;a<c;a++){const d=o[a];if(!Array.isArray(d.value)){d.collector.error(h(12749,"Invalid `contributes.{0}`. Expected an array.",tP.name));continue}for(let l=0,u=d.value.length;l<u;l++){const g=d.value[l];if(Bde(g,d.collector)){let m;g.configuration&&(m=xt(d.description.extensionLocation,g.configuration)),r.push({id:g.id,extensions:g.extensions,filenames:g.filenames,filenamePatterns:g.filenamePatterns,firstLine:g.firstLine,aliases:g.aliases,mimetypes:g.mimetypes,configuration:m,icon:g.icon&&{light:xt(d.description.extensionLocation,g.icon.light),dark:xt(d.description.extensionLocation,g.icon.dark)}})}}}this._registry.setDynamicLanguages(r)}),this.updateMime(),this._register(this._configurationService.onDidChangeConfiguration(o=>{o.affectsConfiguration(gne)&&this.updateMime()})),this._extensionService.whenInstalledExtensionsRegistered().then(()=>{this.updateMime()}),this._register(this.onDidRequestRichLanguageFeatures(o=>{this._extensionService.activateByEvent(`onLanguage:${o}`),this._extensionService.activateByEvent("onLanguage")}))}updateMime(){const e=this._configurationService.getValue();Yve(),e.files?.associations&&Object.keys(e.files.associations).forEach(t=>{const i=e.files.associations[t];if(typeof i!="string"){this.logService.warn(`Ignoring configured 'files.associations' for '${t}' because its type is not a string but '${typeof i}'`);return}const n=this.getMimeType(i)||`text/x-${i}`;Qve({id:i,mime:n,filepattern:t})}),this._onDidChange.fire()}};VX=f([p(0,hn),p(1,ne),p(2,po),p(3,Pe)],VX);function JD(s){return typeof s>"u"?!0:Array.isArray(s)?s.every(e=>typeof e=="string"):!1}function Bde(s,e){return s?typeof s.id!="string"?(e?.error(h(12751,"property `{0}` is mandatory and must be of type `string`","id")),!1):JD(s.extensions)?JD(s.filenames)?typeof s.firstLine<"u"&&typeof s.firstLine!="string"?(e?.error(h(12754,"property `{0}` can be omitted and must be of type `string`","firstLine")),!1):typeof s.configuration<"u"&&typeof s.configuration!="string"?(e?.error(h(12755,"property `{0}` can be omitted and must be of type `string`","configuration")),!1):JD(s.aliases)?JD(s.mimetypes)?typeof s.icon<"u"&&(typeof s.icon!="object"||typeof s.icon.light!="string"||typeof s.icon.dark!="string")?(e?.error(h(12758,"property `{0}` can be omitted and must be of type `object` with properties `{1}` and `{2}` of type `string`","icon","light","dark")),!1):!0:(e?.error(h(12757,"property `{0}` can be omitted and must be of type `string[]`","mimetypes")),!1):(e?.error(h(12756,"property `{0}` can be omitted and must be of type `string[]`","aliases")),!1):(e?.error(h(12753,"property `{0}` can be omitted and must be of type `string[]`","filenames")),!1):(e?.error(h(12752,"property `{0}` can be omitted and must be of type `string[]`","extensions")),!1):(e?.error(h(12750,"Empty value for `contributes.{0}`",tP.name)),!1)}const Vde="_snippet.markAsUsed";Ce.registerCommand(Vde,(s,...e)=>{const t=s.get(PN),[i]=e;i instanceof Wde&&t.updateUsageTimestamp(i)});class YS{constructor(e,t){this.snippet=e,this.label={label:e.prefix,description:e.name},this.detail=h(9854,"{0} ({1})",e.description||e.name,e.source),this.insertText=e.codeSnippet,this.extensionId=e.extensionId,this.range=t,this.sortText=`${e.snippetSource===ih.Extension?"z":"a"}-${e.prefix}`,this.kind=De.Snippet,this.insertTextRules=dh.InsertAsSnippet,this.command={id:Vde,title:"",arguments:[e]}}resolve(){return this.documentation=new Ni().appendCodeblock("",fd.asInsertText(this.snippet.codeSnippet)),this}static compareByLabel(e,t){return RT(e.label.label,t.label.label)}}let TH=class{constructor(e,t,i){this._languageService=e,this._snippets=t,this._languageConfigurationService=i,this._debugDisplayName="snippetCompletions"}async provideCompletionItems(e,t,i){const n=new zn,o=t.lineNumber,r=e.getWordAtPosition(t)??{startColumn:t.column,endColumn:t.column,word:""},a=e.getLineContent(t.lineNumber).toLowerCase(),c=a.substring(0,r.startColumn+r.word.length-1),d=this._computeSnippetPositions(e,o,r,c),l=t.column-1,u=i.triggerCharacter?.toLowerCase()??"",g=this._getLanguageIdAtPosition(e,t),m=this._languageConfigurationService.getLanguageConfiguration(g),v=new Set(await this._snippets.getSnippets(g)),y=[];for(const w of v){if(i.triggerKind===_a.TriggerCharacter&&!w.prefixLow.startsWith(u))continue;let C;for(const oe of d)if(!(oe.prefixLow.match(/^\s/)&&!w.prefixLow.match(/^\s/))&&Xve(oe.prefixLow,0,oe.prefixLow.length,w.prefixLow,0,w.prefixLow.length)){C=oe;break}if(!C)continue;const T=C.startColumn-1,k=w.prefixLow.length-(l-T),A=Zve(a,w.prefixLow,l,l+k,l-T),B=t.with(void 0,T+1);let z=A===0?t.column+k:t.column;l<a.length&&m.getAutoClosingPairs().autoClosingPairsCloseSingleChar.get(a[l])?.some(Se=>Se.open===a[B.column-1]&&w.prefix.startsWith(Se.open)&&w.prefix[w.prefix.length-1]===Se.close)&&z++;const Q=P.fromPositions({lineNumber:o,column:C.startColumn},{lineNumber:o,column:z}),ie=Q.setEndPosition(o,t.column);y.push(new YS(w,{replace:Q,insert:ie})),v.delete(w)}if(!u&&(/\s/.test(a[t.column-2])||!a))for(const w of v){const C=P.fromPositions(t),T=a.indexOf(w.prefixLow,l)===l?C.setEndPosition(t.lineNumber,t.column+w.prefixLow.length):C;y.push(new YS(w,{replace:T,insert:C}))}return this._disambiguateSnippets(y),{suggestions:y,duration:n.elapsed()}}_disambiguateSnippets(e){e.sort(YS.compareByLabel);for(let t=0;t<e.length;t++){const i=e[t];let n=t+1;for(;n<e.length&&i.label===e[n].label;n++)e[n].label.label=h(9855,"{0}, {1}",e[n].label.label,e[n].snippet.name);n>t+1&&(e[t].label.label=h(9855,"{0}, {1}",e[t].label.label,e[t].snippet.name),t=n)}}resolveCompletionItem(e){return e instanceof YS?e.resolve():e}_computeSnippetPositions(e,t,i,n){const o=[];for(let r=1;r<i.startColumn;r++){const a=e.getWordAtPosition(new _e(t,r));o.push({startColumn:r,prefixLow:n.substring(r-1),isWord:!!a}),a&&(r=a.endColumn,o.push({startColumn:a.endColumn,prefixLow:n.substring(a.endColumn-1),isWord:!1}))}return(i.word.length>0||o.length===0)&&o.push({startColumn:i.startColumn,prefixLow:n.substring(i.startColumn-1),isWord:!0}),o}_getLanguageIdAtPosition(e,t){e.tokenization.tokenizeIfCheap(t.lineNumber);let i=e.getLanguageIdAtPosition(t.lineNumber,t.column);return this._languageService.getLanguageName(i)||(i=e.getLanguageId()),i}};TH=f([p(0,fi),p(1,PN),p(2,rs)],TH);var Yk,Qk,iP;(function(s){function e(t,i,n){if(wu(i.path))return t.collector.error(h(9874,"Expected string in `contributes.{0}.path`. Provided value: {1}",t.description.name,String(i.path))),null;if(wu(i.language)&&!i.path.endsWith(".code-snippets"))return t.collector.error(h(9875,"When omitting the language, the value of `contributes.{0}.path` must be a `.code-snippets`-file. Provided value: {1}",t.description.name,String(i.path))),null;if(!wu(i.language)&&!n.isRegisteredLanguageId(i.language))return t.collector.error(h(9876,"Unknown language in `contributes.{0}.language`. Provided value: {1}",t.description.name,String(i.language))),null;const o=t.description.extensionLocation,r=xt(o,i.path);return cd(r,o)?{language:i.language,location:r}:(t.collector.error(h(9877,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",t.description.name,r.path,o.path)),null)}s.toValidSnippet=e,s.snippetsContribution={description:h(9878,"Contributes snippets."),type:"array",defaultSnippets:[{body:[{language:"",path:""}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",path:"./snippets/${2:id}.json."}}],properties:{language:{description:h(9879,"Language identifier for which this snippet is contributed to."),type:"string"},path:{description:h(9880,"Path of the snippets file. The path is relative to the extension folder and typically starts with './snippets/'."),type:"string"}}}},s.point=_l.registerExtensionPoint({extensionPoint:"snippets",deps:[tP],jsonSchema:s.snippetsContribution})})(iP||(iP={}));function nMe(s,e,t){return Lo(s.watch(e),s.onDidFilesChange(i=>{i.affects(e)&&t()}))}let AH=class{static{Yk=this}static{this._key="snippets.ignoredSnippets"}constructor(e){this._storageService=e;const t=e.get(Yk._key,he.PROFILE,"");let i;try{i=JSON.parse(t)}catch{}this._ignored=Cie(i)?new Set(i):new Set}isIgnored(e){return this._ignored.has(e)}updateIgnored(e,t){let i=!1;this._ignored.has(e)&&!t?(this._ignored.delete(e),i=!0):!this._ignored.has(e)&&t&&(this._ignored.add(e),i=!0),i&&this._storageService.store(Yk._key,JSON.stringify(Array.from(this._ignored)),he.PROFILE,pt.USER)}};AH=Yk=f([p(0,tt)],AH);let RH=class{static{Qk=this}static{this._key="snippets.usageTimestamps"}constructor(e){this._storageService=e;const t=e.get(Qk._key,he.PROFILE,"");let i;try{i=JSON.parse(t)}catch{i=[]}this._usages=Array.isArray(i)?new Map(i):new Map}getUsageTimestamp(e){return this._usages.get(e)}updateUsageTimestamp(e){this._usages.delete(e),this._usages.set(e,Date.now());const t=[...this._usages].slice(-100);this._storageService.store(Qk._key,JSON.stringify(t),he.PROFILE,pt.USER)}};RH=Qk=f([p(0,tt)],RH);let HX=class{constructor(e,t,i,n,o,r,a,c,d,l,u){this._environmentService=e,this._userDataProfileService=t,this._contextService=i,this._languageService=n,this._logService=o,this._fileService=r,this._textfileService=a,this._extensionResourceLoaderService=c,this._disposables=new U,this._pendingWork=[],this._files=new wn,this._pendingWork.push(Promise.resolve(d.when(mc.Restored).then(()=>{this._initExtensionSnippets(),this._initUserSnippets(),this._initWorkspaceSnippets()}))),SLe(new TH(this._languageService,this,u)),this._enablement=l.createInstance(AH),this._usageTimestamps=l.createInstance(RH)}dispose(){this._disposables.dispose()}isEnabled(e){return!this._enablement.isIgnored(e.snippetIdentifier)}updateEnablement(e,t){this._enablement.updateIgnored(e.snippetIdentifier,!t)}updateUsageTimestamp(e){this._usageTimestamps.updateUsageTimestamp(e.snippetIdentifier)}_joinSnippets(){const e=this._pendingWork.slice(0);return this._pendingWork.length=0,Promise.all(e)}async getSnippetFiles(){return await this._joinSnippets(),this._files.values()}async getSnippets(e,t){await this._joinSnippets();const i=[],n=[];if(e){if(this._languageService.isRegisteredLanguageId(e))for(const o of this._files.values())n.push(o.load().then(r=>r.select(e,i)).catch(r=>this._logService.error(r,o.location.toString())))}else for(const o of this._files.values())n.push(o.load().then(r=>Jve(i,i.length,r.data)).catch(r=>this._logService.error(r,o.location.toString())));return await Promise.all(n),this._filterAndSortSnippets(i,t)}getSnippetsSync(e,t){const i=[];if(this._languageService.isRegisteredLanguageId(e))for(const n of this._files.values())n.load().catch(o=>{}),n.select(e,i);return this._filterAndSortSnippets(i,t)}_filterAndSortSnippets(e,t){const i=[];for(const n of e)!n.prefix&&!t?.includeNoPrefixSnippets||!this.isEnabled(n)&&!t?.includeDisabledSnippets||typeof t?.fileTemplateSnippets=="boolean"&&t.fileTemplateSnippets!==n.isFileTemplate||i.push(n);return i.sort((n,o)=>{let r=0;if(!t?.noRecencySort){const a=this._usageTimestamps.getUsageTimestamp(n.snippetIdentifier)??-1;r=(this._usageTimestamps.getUsageTimestamp(o.snippetIdentifier)??-1)-a}return r===0&&(r=this._compareSnippet(n,o)),r})}_compareSnippet(e,t){return e.snippetSource<t.snippetSource?-1:e.snippetSource>t.snippetSource?1:e.source<t.source?-1:e.source>t.source||e.name>t.name?1:e.name<t.name?-1:0}_initExtensionSnippets(){iP.point.setHandler(e=>{for(const[t,i]of this._files)i.source===ih.Extension&&this._files.delete(t);for(const t of e)for(const i of t.value){const n=iP.toValidSnippet(t,i,this._languageService);if(!n)continue;const o=this._files.get(n.location);if(o)o.defaultScopes?o.defaultScopes.push(n.language):o.defaultScopes=[];else{const r=new R0(ih.Extension,n.location,n.language?[n.language]:void 0,t.description,this._fileService,this._extensionResourceLoaderService);this._files.set(r.location,r),this._environmentService.isExtensionDevelopment&&r.load().then(a=>{a.data.some(c=>c.isBogous)&&t.collector.warn(h(9881,"One or more snippets from the extension '{0}' very likely confuse snippet-variables and snippet-placeholders (see https://code.visualstudio.com/docs/editor/userdefinedsnippets#_snippet-syntax for more details)",t.description.name))},a=>{t.collector.warn(h(9882,'The snippet file "{0}" could not be read.',r.location.toString()))})}}})}_initWorkspaceSnippets(){const e=new U,t=()=>{e.clear(),this._pendingWork.push(this._initWorkspaceFolderSnippets(this._contextService.getWorkspace(),e))};this._disposables.add(e),this._disposables.add(this._contextService.onDidChangeWorkspaceFolders(t)),this._disposables.add(this._contextService.onDidChangeWorkbenchState(t)),t()}async _initWorkspaceFolderSnippets(e,t){const i=e.folders.map(async n=>{const o=n.toResource(".vscode");await this._fileService.exists(o)?this._initFolderSnippets(ih.Workspace,o,t):t.add(this._fileService.onDidFilesChange(a=>{a.contains(o,mh.ADDED)&&this._initFolderSnippets(ih.Workspace,o,t)}))});await Promise.all(i)}async _initUserSnippets(){const e=new U,t=async()=>{e.clear();const i=this._userDataProfileService.currentProfile.snippetsHome;await this._fileService.createFolder(i),await this._initFolderSnippets(ih.User,i,e)};this._disposables.add(e),this._disposables.add(this._userDataProfileService.onDidChangeCurrentProfile(i=>i.join((async()=>{this._pendingWork.push(t())})()))),await t()}_initFolderSnippets(e,t,i){const n=new U,o=async()=>{if(n.clear(),!!await this._fileService.exists(t))try{const r=await this._fileService.resolve(t);for(const a of r.children||[])n.add(this._addSnippetFile(a.resource,e))}catch(r){this._logService.error(`Failed snippets from folder '${t.toString()}'`,r)}};return i.add(this._textfileService.files.onDidSave(r=>{cd(r.model.resource,t)&&o()})),i.add(nMe(this._fileService,t,o)),i.add(n),o()}_addSnippetFile(e,t){const i=jM(e);if(t===ih.User&&i===".json"){const n=je(e).replace(/\.json/,"");this._files.set(e,new R0(t,e,[n],void 0,this._fileService,this._extensionResourceLoaderService))}else i===".code-snippets"&&this._files.set(e,new R0(t,e,void 0,void 0,this._fileService,this._extensionResourceLoaderService));return{dispose:()=>this._files.delete(e)}}};HX=f([p(0,po),p(1,Fh),p(2,Tt),p(3,fi),p(4,Pe),p(5,Xe),p(6,Ds),p(7,hz),p(8,wd),p(9,J),p(10,rs)],HX);function sMe(s,e){const i=s.getLineContent(e.lineNumber).substr(0,e.column-1),n=Math.max(0,i.length-100);for(let o=i.length-1;o>=n;o--){const r=i.charAt(o);if(/\s/.test(r))return i.substr(o+1)}return n===0?i:""}var Xk;let lg=class{static{Xk=this}static{this.ID="editor.tabCompletionController"}static{this.ContextKey=new O("hasSnippetCompletions",void 0)}static get(e){return e.getContribution(Xk.ID)}constructor(e,t,i,n,o){this._editor=e,this._snippetService=t,this._clipboardService=i,this._languageFeaturesService=n,this._activeSnippets=[],this._hasSnippets=Xk.ContextKey.bindTo(o),this._configListener=this._editor.onDidChangeConfiguration(r=>{r.hasChanged(L.tabCompletion)&&this._update()}),this._update()}dispose(){this._configListener.dispose(),this._selectionListener?.dispose()}_update(){const e=this._editor.getOption(L.tabCompletion)==="onlySnippets";this._enabled!==e&&(this._enabled=e,this._enabled?(this._selectionListener=this._editor.onDidChangeCursorSelection(t=>this._updateSnippets()),this._editor.getModel()&&this._updateSnippets()):this._selectionListener?.dispose())}_updateSnippets(){if(this._activeSnippets=[],this._completionProvider?.dispose(),!this._editor.hasModel())return;const e=this._editor.getSelection(),t=this._editor.getModel();t.tokenization.tokenizeIfCheap(e.positionLineNumber);const i=t.getLanguageIdAtPosition(e.positionLineNumber,e.positionColumn),n=this._snippetService.getSnippetsSync(i);if(!n){this._hasSnippets.set(!1);return}if(P.isEmpty(e)){const r=sMe(t,e.getPosition());if(r)for(const a of n)r.endsWith(a.prefix)&&this._activeSnippets.push(a)}else if(!P.spansMultipleLines(e)&&t.getValueLengthInRange(e)<=100){const r=t.getValueInRange(e);if(r)for(const a of n)r===a.prefix&&this._activeSnippets.push(a)}const o=this._activeSnippets.length;if(o===0)this._hasSnippets.set(!1);else if(o===1)this._hasSnippets.set(!0);else{this._hasSnippets.set(!0),this._completionProvider={_debugDisplayName:"tabCompletion",dispose:()=>{r.dispose()},provideCompletionItems:(a,c)=>a!==t||!e.containsPosition(c)?void 0:{suggestions:this._activeSnippets.map(l=>{const u=P.fromPositions(c.delta(0,-l.prefix.length),c);return new YS(l,u)})}};const r=this._languageFeaturesService.completionProvider.register({language:t.getLanguageId(),pattern:t.uri.fsPath,scheme:t.uri.scheme},this._completionProvider)}}async performSnippetCompletions(){if(this._editor.hasModel())if(this._activeSnippets.length===1){const[e]=this._activeSnippets;let t;if(e.needsClipboard){const i=new dN(this._editor,ds.Value|ds.Position);if(t=await this._clipboardService.readText(),!i.validate(this._editor))return}os.get(this._editor)?.insert(e.codeSnippet,{overwriteBefore:e.prefix.length,overwriteAfter:0,clipboardText:t})}else this._activeSnippets.length>1&&this._completionProvider&&Nde(this._editor,this._completionProvider)}};lg=Xk=f([p(1,PN),p(2,Is),p(3,Ne),p(4,me)],lg);Rt(lg.ID,lg,vt.Eager);const oMe=No.bindToContribution(lg.get);Ue(new oMe({id:"insertSnippet",precondition:lg.ContextKey,handler:s=>s.performSnippetCompletions(),kbOpts:{weight:W.EditorContrib,kbExpr:x.and(V.editorTextFocus,V.tabDoesNotMoveFocus,os.InSnippetMode.toNegated()),primary:S.Tab}}));function rMe(s){return{wordWrap:"on",overviewRulerLanes:0,glyphMargin:!1,lineNumbers:"off",folding:!1,selectOnLineNumbers:!1,hideCursorInOverviewRuler:!0,selectionHighlight:!1,scrollbar:{horizontal:"hidden",alwaysConsumeMouseWheel:!1},lineDecorationsWidth:0,overviewRulerBorder:!1,scrollBeyondLastLine:!1,renderLineHighlight:"none",fixedOverflowWidgets:!0,acceptSuggestionOnEnter:"smart",dragAndDrop:!1,revealHorizontalRightPadding:5,minimap:{enabled:!1},guides:{indentation:!1},accessibilitySupport:s.getValue("editor.accessibilitySupport"),cursorBlinking:s.getValue("editor.cursorBlinking"),experimentalEditContextEnabled:s.getValue("editor.experimentalEditContextEnabled"),defaultColorDecorators:"never"}}function aMe(){return{isSimpleWidget:!0,contributions:xE.getSomeEditorContributions([fx.ID,Fde,Xp.ID,ea.ID,os.ID,lg.ID])}}function cMe(s){return Pv((e,t)=>{const i=e.getColor(e_e);if(i){const n=e.getColor(RF);n&&(t.addRule(`${s} .monaco-editor-background { background-color: ${n}; } `),t.addRule(`${s} .monaco-editor .selected-text { background-color: ${n.transparent(.4)}; }`));const o=e.getColor(pne);o&&t.addRule(`${s} .monaco-editor .view-line span.inline-selected-text { color: ${o}; }`),t.addRule(`${s} .monaco-editor .focused .selected-text { background-color: ${i}; }`)}else t.addRule(`${s} .monaco-editor .focused .selected-text { background-color: ${e.getColor(fne)}; }`)})}var $g,Zk,Jt;(function(s){s[s.Unknown=1]="Unknown",s[s.Unresolved=2]="Unresolved",s[s.Available=3]="Available",s[s.Unavailable=4]="Unavailable",s[s.Free=5]="Free",s[s.Pro=6]="Pro",s[s.ProPlus=7]="ProPlus",s[s.Business=8]="Business",s[s.Enterprise=9]="Enterprise"})(Jt||(Jt={}));function dMe(s){return s===Jt.Pro||s===Jt.ProPlus||s===Jt.Business||s===Jt.Enterprise}const Co={extensionId:Io.defaultChatAgent?.extensionId??"",chatExtensionId:Io.defaultChatAgent?.chatExtensionId??"",upgradePlanUrl:Io.defaultChatAgent?.upgradePlanUrl??"",providerId:Io.defaultChatAgent?.providerId??"",enterpriseProviderId:Io.defaultChatAgent?.enterpriseProviderId??"",providerScopes:Io.defaultChatAgent?.providerScopes??[[]],entitlementUrl:Io.defaultChatAgent?.entitlementUrl??"",entitlementSignupLimitedUrl:Io.defaultChatAgent?.entitlementSignupLimitedUrl??"",completionsAdvancedSetting:Io.defaultChatAgent?.completionsAdvancedSetting??"",chatQuotaExceededContext:Io.defaultChatAgent?.chatQuotaExceededContext??"",completionsQuotaExceededContext:Io.defaultChatAgent?.completionsQuotaExceededContext??""};let UX=class extends F{constructor(e,t,i,n,o){if(super(),this.contextKeyService=n,this._onDidChangeQuotaExceeded=this._register(new M),this.onDidChangeQuotaExceeded=this._onDidChangeQuotaExceeded.event,this._onDidChangeQuotaRemaining=this._register(new M),this.onDidChangeQuotaRemaining=this._onDidChangeQuotaRemaining.event,this._quotas={},this.ExtensionQuotaContextKeys={chatQuotaExceeded:Co.chatQuotaExceededContext,completionsQuotaExceeded:Co.completionsQuotaExceededContext},this.chatQuotaExceededContextKey=ve.chatQuotaExceeded.bindTo(this.contextKeyService),this.completionsQuotaExceededContextKey=ve.completionsQuotaExceeded.bindTo(this.contextKeyService),this.onDidChangeEntitlement=D.map(D.filter(this.contextKeyService.onDidChangeContext,a=>a.affectsSome(new Set([ve.Entitlement.pro.key,ve.Entitlement.business.key,ve.Entitlement.enterprise.key,ve.Entitlement.proPlus.key,ve.Entitlement.free.key,ve.Entitlement.canSignUp.key,ve.Entitlement.signedOut.key])),this._store),()=>{},this._store),this.onDidChangeSentiment=D.map(D.filter(this.contextKeyService.onDidChangeContext,a=>a.affectsSome(new Set([ve.Setup.hidden.key,ve.Setup.disabled.key,ve.Setup.installed.key,ve.Setup.later.key])),this._store),()=>{},this._store),!t.defaultChatAgent||$t&&!i.remoteAuthority&&!o.getValue("chat.experimental.serverlessWebEnabled")){ve.Setup.hidden.bindTo(this.contextKeyService).set(!0);return}const r=this.context=new Ju(()=>this._register(e.createInstance(LH)));this.requests=new Ju(()=>this._register(e.createInstance(PH,r.value,{clearQuotas:()=>this.clearQuotas(),acceptQuotas:a=>this.acceptQuotas(a)}))),this.registerListeners()}get entitlement(){return this.contextKeyService.getContextKeyValue(ve.Entitlement.pro.key)===!0?Jt.Pro:this.contextKeyService.getContextKeyValue(ve.Entitlement.business.key)===!0?Jt.Business:this.contextKeyService.getContextKeyValue(ve.Entitlement.enterprise.key)===!0?Jt.Enterprise:this.contextKeyService.getContextKeyValue(ve.Entitlement.proPlus.key)===!0?Jt.ProPlus:this.contextKeyService.getContextKeyValue(ve.Entitlement.free.key)===!0?Jt.Free:this.contextKeyService.getContextKeyValue(ve.Entitlement.canSignUp.key)===!0?Jt.Available:this.contextKeyService.getContextKeyValue(ve.Entitlement.signedOut.key)===!0?Jt.Unknown:Jt.Unresolved}get quotas(){return this._quotas}registerListeners(){const e=new Set([this.ExtensionQuotaContextKeys.chatQuotaExceeded,this.ExtensionQuotaContextKeys.completionsQuotaExceeded]),t=this._register(new kt);this._register(this.contextKeyService.onDidChangeContext(i=>{i.affectsSome(e)&&(t.value&&t.value.cancel(),t.value=new ri,this.update(t.value.token))}))}acceptQuotas(e){const t=this._quotas;this._quotas=e,this.updateContextKeys();const{changed:i}=this.compareQuotas(t.chat,e.chat),{changed:n}=this.compareQuotas(t.completions,e.completions),{changed:o}=this.compareQuotas(t.premiumChat,e.premiumChat);(i.exceeded||n.exceeded||o.exceeded)&&this._onDidChangeQuotaExceeded.fire(),(i.remaining||n.remaining||o.remaining)&&this._onDidChangeQuotaRemaining.fire()}compareQuotas(e,t){return{changed:{exceeded:e?.percentRemaining===0!=(t?.percentRemaining===0),remaining:e?.percentRemaining!==t?.percentRemaining}}}clearQuotas(){this.acceptQuotas({})}updateContextKeys(){this.chatQuotaExceededContextKey.set(this._quotas.chat?.percentRemaining===0),this.completionsQuotaExceededContextKey.set(this._quotas.completions?.percentRemaining===0)}get sentiment(){return{installed:this.contextKeyService.getContextKeyValue(ve.Setup.installed.key)===!0,hidden:this.contextKeyService.getContextKeyValue(ve.Setup.hidden.key)===!0,disabled:this.contextKeyService.getContextKeyValue(ve.Setup.disabled.key)===!0,later:this.contextKeyService.getContextKeyValue(ve.Setup.later.key)===!0}}async update(e){await this.requests?.value.forceResolveEntitlement(void 0,e)}};UX=f([p(0,J),p(1,Fn),p(2,mn),p(3,me),p(4,ne)],UX);let PH=$g=class extends F{static providerId(e){return e.getValue(`${Co.completionsAdvancedSetting}.authProvider`)===Co.enterpriseProviderId?Co.enterpriseProviderId:Co.providerId}constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.context=e,this.chatQuotasAccessor=t,this.telemetryService=i,this.authenticationService=n,this.logService=o,this.requestService=r,this.dialogService=a,this.openerService=c,this.configurationService=d,this.authenticationExtensionsService=l,this.lifecycleService=u,this.pendingResolveCts=new ri,this.didResolveEntitlements=!1,this.state={entitlement:this.context.state.entitlement},this.registerListeners(),this.resolve()}registerListeners(){this._register(this.authenticationService.onDidChangeDeclaredProviders(()=>this.resolve())),this._register(this.authenticationService.onDidChangeSessions(e=>{e.providerId===$g.providerId(this.configurationService)&&this.resolve()})),this._register(this.authenticationService.onDidRegisterAuthenticationProvider(e=>{e.id===$g.providerId(this.configurationService)&&this.resolve()})),this._register(this.authenticationService.onDidUnregisterAuthenticationProvider(e=>{e.id===$g.providerId(this.configurationService)&&this.resolve()})),this._register(this.context.onDidChange(()=>{(!this.context.state.installed||this.context.state.disabled||this.context.state.entitlement===Jt.Unknown)&&(this.state={entitlement:this.state.entitlement,quotas:void 0},this.chatQuotasAccessor.clearQuotas())}))}async resolve(){this.pendingResolveCts.dispose(!0);const e=this.pendingResolveCts=new ri,t=await this.findMatchingProviderSession(e.token);if(e.token.isCancellationRequested)return;let i;t?this.state.entitlement===Jt.Unknown&&(i={entitlement:Jt.Unresolved}):(this.didResolveEntitlements=!1,i={entitlement:Jt.Unknown}),i&&this.update(i),t&&!this.didResolveEntitlements&&await this.resolveEntitlement(t,e.token)}async findMatchingProviderSession(e){const t=await this.doGetSessions($g.providerId(this.configurationService));if(!e.isCancellationRequested){for(const i of t)for(const n of Co.providerScopes)if(this.scopesMatch(i.scopes,n))return i}}async doGetSessions(e){const t=this.authenticationExtensionsService.getAccountPreference(Co.chatExtensionId,e)??this.authenticationExtensionsService.getAccountPreference(Co.extensionId,e);let i;for(const n of await this.authenticationService.getAccounts(e))if(n.label===t){i=n;break}try{return await this.authenticationService.getSessions(e,void 0,{account:i})}catch{}return[]}scopesMatch(e,t){return e.length===t.length&&t.every(i=>e.includes(i))}async resolveEntitlement(e,t){const i=await this.doResolveEntitlement(e,t);return typeof i?.entitlement=="number"&&!t.isCancellationRequested&&(this.didResolveEntitlements=!0,this.update(i)),i}async doResolveEntitlement(e,t){if($g.providerId(this.configurationService)===Co.enterpriseProviderId)return this.logService.trace("[chat entitlement]: enterprise provider, assuming Enterprise plan"),{entitlement:Jt.Enterprise};if(t.isCancellationRequested)return;const i=await this.request(Co.entitlementUrl,"GET",void 0,e,t);if(t.isCancellationRequested)return;if(!i)return this.logService.trace("[chat entitlement]: no response"),{entitlement:Jt.Unresolved};if(i.res.statusCode&&i.res.statusCode!==200)return this.logService.trace(`[chat entitlement]: unexpected status code ${i.res.statusCode}`),i.res.statusCode===401||i.res.statusCode===404?{entitlement:Jt.Unknown}:{entitlement:Jt.Unresolved};let n=null;try{n=await Z1(i)}catch{}if(t.isCancellationRequested)return;if(!n)return this.logService.trace("[chat entitlement]: response has no content"),{entitlement:Jt.Unresolved};let o;try{o=JSON.parse(n),this.logService.trace(`[chat entitlement]: parsed result is ${JSON.stringify(o)}`)}catch(c){return this.logService.trace(`[chat entitlement]: error parsing response (${c})`),{entitlement:Jt.Unresolved}}let r;o.access_type_sku==="free_limited_copilot"?r=Jt.Free:o.can_signup_for_limited?r=Jt.Available:o.copilot_plan==="individual"?r=Jt.Pro:o.copilot_plan==="individual_pro"?r=Jt.ProPlus:o.copilot_plan==="business"?r=Jt.Business:o.copilot_plan==="enterprise"?r=Jt.Enterprise:o.chat_enabled?r=Jt.Pro:r=Jt.Unavailable;const a={entitlement:r,quotas:this.toQuotas(o)};return this.logService.trace(`[chat entitlement]: resolved to ${a.entitlement}, quotas: ${JSON.stringify(a.quotas)}`),this.telemetryService.publicLog2("chatInstallEntitlement",{entitlement:a.entitlement,tid:o.analytics_tracking_id,quotaChat:o?.quota_snapshots?.chat?.remaining,quotaPremiumChat:o?.quota_snapshots?.premium_interactions?.remaining,quotaCompletions:o?.quota_snapshots?.completions?.remaining,quotaResetDate:o.quota_reset_date??o.limited_user_reset_date}),a}toQuotas(e){const t={resetDate:e.quota_reset_date??e.limited_user_reset_date};if(e.monthly_quotas?.chat&&typeof e.limited_user_quotas?.chat=="number"&&(t.chat={total:e.monthly_quotas.chat,percentRemaining:Math.min(100,Math.max(0,e.limited_user_quotas.chat/e.monthly_quotas.chat*100)),overageEnabled:!1,overageCount:0,unlimited:!1}),e.monthly_quotas?.completions&&typeof e.limited_user_quotas?.completions=="number"&&(t.completions={total:e.monthly_quotas.completions,percentRemaining:Math.min(100,Math.max(0,e.limited_user_quotas.completions/e.monthly_quotas.completions*100)),overageEnabled:!1,overageCount:0,unlimited:!1}),e.quota_snapshots)for(const i of["chat","completions","premium_interactions"]){const n=e.quota_snapshots[i];if(!n)continue;const o={total:n.entitlement,percentRemaining:Math.min(100,Math.max(0,n.percent_remaining)),overageEnabled:n.overage_permitted,overageCount:n.overage_count,unlimited:n.unlimited};switch(i){case"chat":t.chat=o;break;case"completions":t.completions=o;break;case"premium_interactions":t.premiumChat=o;break}}return t}async request(e,t,i,n,o){try{return await this.requestService.request({type:t,url:e,data:t==="POST"?JSON.stringify(i):void 0,disableCache:!0,headers:{Authorization:`Bearer ${n.accessToken}`}},o)}catch(r){o.isCancellationRequested||this.logService.error(`[chat entitlement] request: error ${r}`);return}}update(e){this.state=e,this.context.update({entitlement:this.state.entitlement}),e.quotas&&this.chatQuotasAccessor.acceptQuotas(e.quotas)}async forceResolveEntitlement(e,t=ye.None){if(e||(e=await this.findMatchingProviderSession(t)),!!e)return this.resolveEntitlement(e,t)}async signUpFree(e){const t={restricted_telemetry:this.telemetryService.telemetryLevel===vq.NONE?"disabled":"enabled",public_code_suggestions:"enabled"},i=await this.request(Co.entitlementSignupLimitedUrl,"POST",t,e,ye.None);if(!i)return await this.onUnknownSignUpError(h(5144,"No response received."),"[chat entitlement] sign-up: no response")?this.signUpFree(e):{errorCode:1};if(i.res.statusCode&&i.res.statusCode!==200){if(i.res.statusCode===422)try{const a=await Z1(i);if(a){const c=JSON.parse(a);if(typeof c.message=="string"&&c.message)return this.onUnprocessableSignUpError(`[chat entitlement] sign-up: unprocessable entity (${c.message})`,c.message),{errorCode:i.res.statusCode}}}catch{}return await this.onUnknownSignUpError(h(5145,"Unexpected status code {0}.",i.res.statusCode),`[chat entitlement] sign-up: unexpected status code ${i.res.statusCode}`)?this.signUpFree(e):{errorCode:i.res.statusCode}}let n=null;try{n=await Z1(i)}catch{}if(!n)return await this.onUnknownSignUpError(h(5146,"Response has no contents."),"[chat entitlement] sign-up: response has no content")?this.signUpFree(e):{errorCode:2};let o;try{o=JSON.parse(n),this.logService.trace(`[chat entitlement] sign-up: response is ${n}`)}catch(r){return await this.onUnknownSignUpError(h(5147,"Invalid response contents."),`[chat entitlement] sign-up: error parsing response (${r})`)?this.signUpFree(e):{errorCode:3}}return this.update({entitlement:Jt.Free}),!!o?.subscribed}async onUnknownSignUpError(e,t){if(this.logService.error(t),!this.lifecycleService.willShutdown){const{confirmed:i}=await this.dialogService.confirm({type:Me.Error,message:h(5148,"An error occurred while signing up for the Copilot Free plan. Would you like to try again?"),detail:e,primaryButton:h(5149,"Retry")});return i}return!1}onUnprocessableSignUpError(e,t){this.logService.error(e),this.lifecycleService.willShutdown||this.dialogService.prompt({type:Me.Error,message:h(5150,"An error occurred while signing up for the Copilot Free plan."),detail:t,buttons:[{label:h(5151,"OK"),run:()=>{}},{label:h(5152,"Learn More"),run:()=>this.openerService.open(R.parse(Co.upgradePlanUrl))}]})}async signIn(){const e=$g.providerId(this.configurationService),t=await this.authenticationService.createSession(e,Co.providerScopes[0]);this.authenticationExtensionsService.updateAccountPreference(Co.extensionId,e,t.account),this.authenticationExtensionsService.updateAccountPreference(Co.chatExtensionId,e,t.account);const i=await this.forceResolveEntitlement(t);return{session:t,entitlements:i}}dispose(){this.pendingResolveCts.dispose(!0),super.dispose()}};PH=$g=f([p(2,li),p(3,Uv),p(4,Pe),p(5,UM),p(6,Qt),p(7,hi),p(8,ne),p(9,Tz),p(10,wd)],PH);let LH=class extends F{static{Zk=this}static{this.CHAT_ENTITLEMENT_CONTEXT_STORAGE_KEY="chat.setupContext"}get state(){return this.suspendedState??this._state}constructor(e,t,i,n,o){super(),this.storageService=t,this.extensionEnablementService=i,this.logService=n,this.extensionsWorkbenchService=o,this.suspendedState=void 0,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.updateBarrier=void 0,this.canSignUpContextKey=ve.Entitlement.canSignUp.bindTo(e),this.signedOutContextKey=ve.Entitlement.signedOut.bindTo(e),this.freeContextKey=ve.Entitlement.free.bindTo(e),this.proContextKey=ve.Entitlement.pro.bindTo(e),this.proPlusContextKey=ve.Entitlement.proPlus.bindTo(e),this.businessContextKey=ve.Entitlement.business.bindTo(e),this.enterpriseContextKey=ve.Entitlement.enterprise.bindTo(e),this.hiddenContext=ve.Setup.hidden.bindTo(e),this.laterContext=ve.Setup.later.bindTo(e),this.installedContext=ve.Setup.installed.bindTo(e),this.disabledContext=ve.Setup.disabled.bindTo(e),this._state=this.storageService.getObject(Zk.CHAT_ENTITLEMENT_CONTEXT_STORAGE_KEY,he.PROFILE)??{entitlement:Jt.Unknown},this.checkExtensionInstallation(),this.updateContextSync()}async checkExtensionInstallation(){await this.extensionsWorkbenchService.queryLocal(),this._register(D.runAndSubscribe(this.extensionsWorkbenchService.onChange,e=>{if(e&&!Es.equals(e.identifier.id,Co.extensionId))return;const t=this.extensionsWorkbenchService.local.find(o=>Es.equals(o.identifier.id,Co.extensionId)),i=!!t?.local,n=i&&!this.extensionEnablementService.isEnabled(t.local);this.update({installed:i,disabled:n})}))}update(e){return this.logService.trace(`[chat entitlement context] update(): ${JSON.stringify(e)}`),typeof e.installed=="boolean"&&typeof e.disabled=="boolean"&&(this._state.installed=e.installed,this._state.disabled=e.disabled,e.installed&&!e.disabled&&(e.hidden=!1)),typeof e.hidden=="boolean"&&(this._state.hidden=e.hidden),typeof e.later=="boolean"&&(this._state.later=e.later),typeof e.entitlement=="number"&&(this._state.entitlement=e.entitlement,this._state.entitlement===Jt.Free||dMe(this._state.entitlement)?this._state.registered=!0:this._state.entitlement===Jt.Available&&(this._state.registered=!1)),this.storageService.store(Zk.CHAT_ENTITLEMENT_CONTEXT_STORAGE_KEY,{...this._state,later:void 0},he.PROFILE,pt.MACHINE),this.updateContext()}async updateContext(){await this.updateBarrier?.wait(),this.updateContextSync()}updateContextSync(){this.logService.trace(`[chat entitlement context] updateContext(): ${JSON.stringify(this._state)}`),this.signedOutContextKey.set(this._state.entitlement===Jt.Unknown),this.canSignUpContextKey.set(this._state.entitlement===Jt.Available),this.freeContextKey.set(this._state.entitlement===Jt.Free),this.proContextKey.set(this._state.entitlement===Jt.Pro),this.proPlusContextKey.set(this._state.entitlement===Jt.ProPlus),this.businessContextKey.set(this._state.entitlement===Jt.Business),this.enterpriseContextKey.set(this._state.entitlement===Jt.Enterprise),this.hiddenContext.set(!!this._state.hidden),this.laterContext.set(!!this._state.later),this.installedContext.set(!!this._state.installed),this.disabledContext.set(!!this._state.disabled),this._onDidChange.fire()}suspend(){this.suspendedState={...this._state},this.updateBarrier=new Np}resume(){this.suspendedState=void 0,this.updateBarrier?.open(),this.updateBarrier=void 0}};LH=Zk=f([p(0,me),p(1,tt),p(2,gd),p(3,Pe),p(4,EI)],LH);function lMe(s){if(typeof s=="object"&&s!==null){const e=s;return typeof e.id=="string"&&typeof e.kind=="string"}return!1}class P0{constructor(e,t){this.kind=e,this.description=t}get id(){return this.kind}get name(){return SK(this.kind)}toJSON(){return{id:this.id,name:this.name,description:this.description,kind:this.kind}}}var Ca;(function(s){s.Ask=new P0(jt.Ask,h(5158,"Ask Copilot")),s.Edit=new P0(jt.Edit,h(5159,"Edit files in your workspace")),s.Agent=new P0(jt.Agent,h(5160,"Edit files in your workspace in agent mode"))})(Ca||(Ca={}));function Hde(s){switch(s){case jt.Ask:return Ca.Ask;case jt.Edit:return Ca.Edit;case jt.Agent:return Ca.Agent;default:return lMe(s)?s:void 0}}function hMe(s){return s.id===Ca.Ask.id||s.id===Ca.Edit.id||s.id===Ca.Agent.id}const Ude=Z("chatModeService"),uMe="copilot",gMe=40;let $X=class{constructor(e){this._onDidClearHistory=new M,this.onDidClearHistory=this._onDidClearHistory.event,this.memento=new uw("interactive-session",e);const t=this.memento.getMemento(he.WORKSPACE,pt.MACHINE);for(const i in t.history)t.history[i]=t.history[i].map(n=>typeof n=="string"?{text:n}:n);this.viewState=t}getHistory(e){const t=this.getKey(e);return this.viewState.history?.[t]??[]}getKey(e){return e===Vi.Panel?uMe:e}saveHistory(e,t){this.viewState.history||(this.viewState.history={});const i=this.getKey(e);this.viewState.history[i]=t.slice(-40),this.memento.saveMemento()}clearHistory(){this.viewState.history={},this.memento.saveMemento(),this._onDidClearHistory.fire()}};$X=f([p(0,tt)],$X);var _d;(function(s){s[s.Modified=0]="Modified",s[s.Accepted=1]="Accepted",s[s.Rejected=2]="Rejected"})(_d||(_d={}));var GX;(function(s){s[s.Initial=0]="Initial",s[s.StreamingEdits=1]="StreamingEdits",s[s.Idle=2]="Idle",s[s.Disposed=3]="Disposed"})(GX||(GX={}));const $de="chat-editing-multi-diff-source",RO=new O("chatEditingWidgetFileState",void 0,h(5142,"The current state of the file in the chat editing widget"));new O("chatEditingAgentSupportsReadonlyReferences",void 0,h(5143,"Whether the chat editing agent supports readonly references (temporary)"));const Gde=new O("decidedChatEditingResource",[]),qde=new O("chatEditingResource",void 0);new O("inChatEditingSession",void 0);const yh=new O("hasUndecidedChatEditingResource",!1),QK=new O("hasAppliedChatEdits",!1),PO=new O("applyingChatEditsFailed",!1);var qX;(function(s){s[s.Created=0]="Created",s[s.Modified=1]="Modified"})(qX||(qX={}));function pMe(s){const e=[];for(const t of s){const i=e[e.length-1];if(t.kind==="markdownContent")i?.kind==="markdownContent"?e[e.length-1]={content:new Ni(i.content.value+t.content.value,{isTrusted:i.content.isTrusted}),kind:"markdownContent"}:e.push(t);else if(t.kind==="markdownVuln"){const o=`<vscode_annotation details='${encodeURIComponent(JSON.stringify(t.vulnerabilities))}'>${t.content.value}</vscode_annotation>`;i?.kind==="markdownContent"?e[e.length-1]={content:new Ni(i.content.value+o,{isTrusted:i.content.isTrusted}),kind:"markdownContent"}:e.push({content:new Ni(o),kind:"markdownContent"})}}return e}const er=String.raw,fMe=er`(?<!\\)`+er`(!?\[`+er`(?:`+er`[^\[\]\\]|`+er`\\.|`+er`\[[^\[\]]*\]`+er`)*`+er`\])`+er`(\(\s*)`+er`(`+er`[^\s\(\)<](?:[^\s\(\)]|\([^\s\(\)]*?\))*|`+er`<(?:\\[<>]|[^<>])+>`+er`)`+er`\s*(?:"[^"]*"|'[^']*'|\([^\(\)]*\))?\s*`+er`\)`;function mMe(s,e){const t=Array.from(s.matchAll(new RegExp(fMe+er`|\p{sc=Han}|=+|\++|-+|[^\s\|\p{sc=Han}|=|\+|\-]+`,"gu"))),i=t.slice(0,e),n=e>=t.length?s.length:i.length?i.at(-1).index+i.at(-1)[0].length:0,o=s.substring(0,n);return{value:o,returnedWordCount:i.length===0?o.length?1:0:i.length,isFullString:n>=s.length,totalWordCount:t.length}}function vMe(s){return mMe(s,Number.MAX_SAFE_INTEGER).returnedWordCount}function nP(s){return!!s&&typeof s=="object"&&"message"in s}function MH(s){return!!s&&typeof s.setVote<"u"}let zX=class extends F{get inputPlaceholder(){return this._inputPlaceholder}get model(){return this._model}setInputPlaceholder(e){this._inputPlaceholder=e,this._onDidChange.fire({kind:"changePlaceholder"})}resetInputPlaceholder(){this._inputPlaceholder=void 0,this._onDidChange.fire({kind:"changePlaceholder"})}get sessionId(){return this._model.sessionId}get requestInProgress(){return this._model.requestInProgress}get requestPausibility(){return this._model.requestPausibility}constructor(e,t,i){super(),this._model=e,this.codeBlockModelCollection=t,this.instantiationService=i,this._onDidDisposeModel=this._register(new M),this.onDidDisposeModel=this._onDidDisposeModel.event,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._items=[],this._inputPlaceholder=void 0,e.getRequests().forEach((n,o)=>{const r=this.instantiationService.createInstance(KX,n);this._items.push(r),this.updateCodeBlockTextModels(r),n.response&&this.onAddResponse(n.response)}),this._register(e.onDidDispose(()=>this._onDidDisposeModel.fire())),this._register(e.onDidChange(n=>{if(n.kind==="addRequest"){const r=this.instantiationService.createInstance(KX,n.request);this._items.push(r),this.updateCodeBlockTextModels(r),n.request.response&&this.onAddResponse(n.request.response)}else if(n.kind==="addResponse")this.onAddResponse(n.response);else if(n.kind==="removeRequest"){const r=this._items.findIndex(c=>nP(c)&&c.id===n.requestId);r>=0&&this._items.splice(r,1);const a=n.responseId&&this._items.findIndex(c=>MH(c)&&c.id===n.responseId);if(typeof a=="number"&&a>=0){const d=this._items.splice(a,1)[0];d instanceof VC&&d.dispose()}}const o=n.kind==="addRequest"?{kind:"addRequest"}:n.kind==="initialize"?{kind:"initialize"}:n.kind==="setHidden"?{kind:"setHidden"}:null;this._onDidChange.fire(o)}))}onAddResponse(e){const t=this.instantiationService.createInstance(VC,e,this);this._register(t.onDidChange(()=>(t.isComplete&&this.updateCodeBlockTextModels(t),this._onDidChange.fire(null)))),this._items.push(t),this.updateCodeBlockTextModels(t)}getItems(){return this._items.filter(e=>!e.shouldBeRemovedOnSend||e.shouldBeRemovedOnSend.afterUndoStop)}dispose(){super.dispose(),Qe(this._items.filter(e=>e instanceof VC))}updateCodeBlockTextModels(e){let t;nP(e)?t=e.messageText:t=pMe(e.response.value).map(n=>n.content.value).join("");let i=0;t_e(i_e(t),n=>{if(n.type==="code"){const o=n.lang||"",r=n.text;this.codeBlockModelCollection.update(this._model.sessionId,e,i++,{text:r,languageId:o,isComplete:!0})}})}};zX=f([p(2,J)],zX);class KX{get id(){return this._model.id}get dataId(){return this.id+`_${cc(this.variables)}_${cc(this.isComplete)}`}get sessionId(){return this._model.session.sessionId}get username(){return this._model.username}get avatarIcon(){return this._model.avatarIconUri}get message(){return this._model.message}get messageText(){return this.message.text}get attempt(){return this._model.attempt}get variables(){return this._model.variableData.variables}get contentReferences(){return this._model.response?.contentReferences}get confirmation(){return this._model.confirmation}get isComplete(){return this._model.response?.isComplete??!1}get isCompleteAddedRequest(){return this._model.isCompleteAddedRequest}get shouldBeRemovedOnSend(){return this._model.shouldBeRemovedOnSend}get slashCommand(){return this._model.response?.slashCommand}get agentOrSlashCommandDetected(){return this._model.response?.agentOrSlashCommandDetected??!1}constructor(e){this._model=e}}let VC=class extends F{get model(){return this._model}get id(){return this._model.id}get dataId(){return this._model.id+`_${this._modelChangeCount}`+(this.isLast?"_last":"")}get sessionId(){return this._model.session.sessionId}get username(){return this.agent?this.chatAgentNameService.getAgentNameRestriction(this.agent)?this.agent.fullName||this.agent.name:dce(this.agent):this._model.username}get avatarIcon(){return this._model.avatarIcon}get agent(){return this._model.agent}get slashCommand(){return this._model.slashCommand}get agentOrSlashCommandDetected(){return this._model.agentOrSlashCommandDetected}get response(){return this._model.response}get usedContext(){return this._model.usedContext}get contentReferences(){return this._model.contentReferences}get codeCitations(){return this._model.codeCitations}get progressMessages(){return this._model.progressMessages}get isComplete(){return this._model.isComplete}get isCanceled(){return this._model.isCanceled}get shouldBeRemovedOnSend(){return this._model.shouldBeRemovedOnSend}get isCompleteAddedRequest(){return this._model.isCompleteAddedRequest}get replyFollowups(){return this._model.followups?.filter(e=>e.kind==="reply")}get result(){return this._model.result}get errorDetails(){return this.result?.errorDetails}get vote(){return this._model.vote}get voteDownReason(){return this._model.voteDownReason}get requestId(){return this._model.requestId}get isStale(){return this._model.isStale}get isLast(){return this._chatViewModel.getItems().at(-1)===this}get usedReferencesExpanded(){if(typeof this._usedReferencesExpanded=="boolean")return this._usedReferencesExpanded}set usedReferencesExpanded(e){this._usedReferencesExpanded=e}get vulnerabilitiesListExpanded(){return this._vulnerabilitiesListExpanded}set vulnerabilitiesListExpanded(e){this._vulnerabilitiesListExpanded=e}get contentUpdateTimings(){return this._contentUpdateTimings}get isPaused(){return this._model.isPaused}constructor(e,t,i,n){super(),this._model=e,this._chatViewModel=t,this.logService=i,this.chatAgentNameService=n,this._modelChangeCount=0,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.renderData=void 0,this._vulnerabilitiesListExpanded=!1,this._contentUpdateTimings=void 0,e.isComplete||(this._contentUpdateTimings={totalTime:0,lastUpdateTime:Date.now(),impliedWordLoadRate:0,lastWordCount:0}),this._register(e.onDidChange(()=>{if(this._contentUpdateTimings){const o=Date.now(),r=vMe(e.entireResponse.getMarkdown());if(r===this._contentUpdateTimings.lastWordCount)this.trace("onDidChange","Update- no new words");else{this._contentUpdateTimings.lastWordCount===0&&(this._contentUpdateTimings.lastUpdateTime=o);const a=Math.min(o-this._contentUpdateTimings.lastUpdateTime,1e3),c=Math.max(this._contentUpdateTimings.totalTime+a,250),d=r/(c/1e3);this.trace("onDidChange",`Update- got ${r} words over last ${c}ms = ${d} words/s`),this._contentUpdateTimings={totalTime:this._contentUpdateTimings.totalTime!==0||this.response.value.some(l=>l.kind==="markdownContent")?c:this._contentUpdateTimings.totalTime,lastUpdateTime:o,impliedWordLoadRate:d,lastWordCount:r}}}this._modelChangeCount++,this._onDidChange.fire()}))}trace(e,t){this.logService.trace(`ChatResponseViewModel#${e}: ${t}`)}setVote(e){this._modelChangeCount++,this._model.setVote(e)}setVoteDownReason(e){this._modelChangeCount++,this._model.setVoteDownReason(e)}setEditApplied(e,t){this._modelChangeCount++,this._model.setEditApplied(e,t)}};VC=f([p(2,Pe),p(3,nre)],VC);const sP="workbench.actions.manage",oP="workbench.actions.accounts";class LO extends X{constructor(e,t,i,n,o){super({id:`toggle.${e}`,title:t,metadata:i?{description:i}:void 0,toggled:x.equals(`config.${e}`,!0),menu:[{id:N.TitleBarContext,when:o,order:n,group:"2_config"},{id:N.TitleBarTitleContext,when:o,order:n,group:"2_config"}]}),this.section=e}run(e,...t){const i=e.get(ne),n=i.getValue(this.section);i.updateValue(this.section,!n)}}K(class extends LO{constructor(){super(si.COMMAND_CENTER,h(3510,"Command Center"),h(3511,"Toggle visibility of the Command Center in title bar"),1,Zq.toNegated())}});K(class extends LO{constructor(){super("workbench.navigationControl.enabled",h(3512,"Navigation Controls"),h(3513,"Toggle visibility of the Navigation Controls in title bar"),2,x.and(Zq.toNegated(),x.has("config.window.commandCenter")))}});K(class extends LO{constructor(){super(si.LAYOUT_ACTIONS,h(3514,"Layout Controls"),h(3515,"Toggle visibility of the Layout Controls in title bar"),4)}});K(class extends X{constructor(){super({id:`toggle.${jc.CUSTOM_TITLE_BAR_VISIBILITY}`,title:h(3516,"Hide Custom Title Bar"),menu:[{id:N.TitleBarContext,order:0,when:x.equals(sA.key,zT.NATIVE),group:"3_toggle"},{id:N.TitleBarTitleContext,order:0,when:x.equals(sA.key,zT.NATIVE),group:"3_toggle"}]})}run(e,...t){e.get(ne).updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.NEVER)}});K(class extends X{constructor(){super({id:`toggle.${jc.CUSTOM_TITLE_BAR_VISIBILITY}.windowed`,title:h(3517,"Hide Custom Title Bar In Full Screen"),menu:[{id:N.TitleBarContext,order:1,when:Gp,group:"3_toggle"},{id:N.TitleBarTitleContext,order:1,when:Gp,group:"3_toggle"}]})}run(e,...t){e.get(ne).updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.WINDOWED)}});class _Me extends X{constructor(){super({id:"toggle.toggleCustomTitleBar",title:h(3518,"Custom Title Bar"),toggled:mN,menu:[{id:N.MenubarAppearanceMenu,order:6,when:x.or(x.and(x.equals(sA.key,zT.NATIVE),x.and(x.equals("config.workbench.layoutControl.enabled",!1),x.equals("config.window.commandCenter",!1),x.notEquals("config.workbench.editor.editorActionsLocation","titleBar"),x.notEquals("config.workbench.activityBar.location","top"),x.notEquals("config.workbench.activityBar.location","bottom"))?.negate()),Gp),group:"2_workbench_layout"}]})}run(e,...t){const i=e.get(ne),n=e.get(me);switch(i.getValue(jc.CUSTOM_TITLE_BAR_VISIBILITY)){case Hc.NEVER:i.updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.AUTO);break;case Hc.WINDOWED:{Gp.evaluate(n.getContext(null))?i.updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.AUTO):i.updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.NEVER);break}case Hc.AUTO:default:i.updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.NEVER);break}}}K(_Me);K(class extends X{constructor(){super({id:"showCustomTitleBar",title:I(3519,"Show Custom Title Bar"),precondition:mN.negate(),f1:!0})}run(e,...t){e.get(ne).updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.AUTO)}});K(class extends X{constructor(){super({id:"hideCustomTitleBar",title:I(3520,"Hide Custom Title Bar"),precondition:mN,f1:!0})}run(e,...t){e.get(ne).updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.NEVER)}});K(class extends X{constructor(){super({id:"hideCustomTitleBarInFullScreen",title:I(3521,"Hide Custom Title Bar In Full Screen"),precondition:x.and(mN,Gp),f1:!0})}run(e,...t){e.get(ne).updateValue(jc.CUSTOM_TITLE_BAR_VISIBILITY,Hc.WINDOWED)}});K(class Ld extends X{static{this.settingsID="workbench.editor.editorActionsLocation"}constructor(){const e=x.and(x.equals("config.workbench.editor.showTabs","none").negate(),x.equals(`config.${Ld.settingsID}`,"default"))?.negate();super({id:`toggle.${Ld.settingsID}`,title:h(3522,"Editor Actions"),toggled:x.equals(`config.${Ld.settingsID}`,"hidden").negate(),menu:[{id:N.TitleBarContext,order:3,when:e,group:"2_config"},{id:N.TitleBarTitleContext,order:3,when:e,group:"2_config"}]})}run(e,...t){const i=e.get(ne),n=e.get(tt),o=i.getValue(Ld.settingsID);if(o==="hidden"){if(i.getValue(si.EDITOR_TABS_MODE)!=="none")i.updateValue(Ld.settingsID,"titleBar");else{const a=n.get(Ld.settingsID,he.PROFILE);i.updateValue(Ld.settingsID,a??"default")}n.remove(Ld.settingsID,he.PROFILE)}else i.updateValue(Ld.settingsID,"hidden"),n.store(Ld.settingsID,o,he.PROFILE,pt.USER)}});const nYe={id:oP,label:h(3523,"Accounts"),tooltip:h(3523,"Accounts"),class:void 0,enabled:!0,run:function(){}},sYe={id:sP,label:h(3524,"Manage"),tooltip:h(3524,"Manage"),class:void 0,enabled:!0,run:function(){}};let jX=class extends F{constructor(e,t){super(),this.extensionFeaturesManagementService=e;for(const i in t.keys(he.APPLICATION,pt.USER))(i.startsWith("languageModelStats.")||i.startsWith("languageModelAccess."))&&t.remove(i,he.APPLICATION)}async update(e,t,i,n){await this.extensionFeaturesManagementService.getAccess(t,zde)}};jX=f([p(0,Fre),p(1,tt)],jX);const zde="copilot";Ge.as(_w.ExtensionFeaturesRegistry).registerExtensionFeature({id:zde,label:h(5166,"Copilot"),description:h(5167,"Language models usage statistics of this extension."),icon:j.copilot,access:{canToggle:!1},accessDataLabel:h(5168,"chat")});var YX;(function(s){s[s.Confirmation=1]="Confirmation",s[s.Prompt=2]="Prompt",s[s.Input=3]="Input"})(YX||(YX={}));var zi;(function(s){s[s.SAVE=0]="SAVE",s[s.DONT_SAVE=1]="DONT_SAVE",s[s.CANCEL=2]="CANCEL"})(zi||(zi={}));const ek=10;function Vu(s){const e=[];return e.push(...s.slice(0,ek).map(t=>typeof t=="string"?t:je(t))),s.length>ek&&(s.length-ek===1?e.push(h(1750,"...1 additional file not shown")):e.push(h(1751,"...{0} additional files not shown",s.length-ek))),e.push(""),e.join(`
`)}var cu;const bMe=Ae("chat-editor-label-icon",j.commentDiscussion,h(4821,"Icon of the chat editor label."));let NH=class extends gl{static{cu=this}static{this.countsInUse=new Set}static{this.TypeID="workbench.input.chatSession"}static{this.EditorID="workbench.editor.chatSession"}static getNewEditorUri(){const e=Math.floor(Math.random()*1e9);return rP.generate(e)}static getNextCount(){let e=0;for(;cu.countsInUse.has(e);)e++;return e}constructor(e,t,i,n){if(super(),this.resource=e,this.options=t,this.chatService=i,this.dialogService=n,this.closeHandler=this,typeof rP.parse(e)?.handle!="number")throw new Error("Invalid chat URI");this.sessionId=t.target&&"sessionId"in t.target?t.target.sessionId:void 0,this.inputCount=cu.getNextCount(),cu.countsInUse.add(this.inputCount),this._register(Ee(()=>cu.countsInUse.delete(this.inputCount)))}showConfirm(){return this.model?.editingSession?jde(this.model.editingSession):!1}async confirm(e){if(!this.model?.editingSession)return zi.SAVE;const t=h(4822,"Close Chat Editor"),i=h(4823,"Closing the chat editor will end your current edit session.");return await Kde(this.model.editingSession,this.dialogService,{titleOverride:t,messageOverride:i})?zi.SAVE:zi.CANCEL}get editorId(){return cu.EditorID}get capabilities(){return super.capabilities|Ze.Singleton|Ze.CanDropIntoEditor}matches(e){return e instanceof cu&&e.resource.toString()===this.resource.toString()}get typeId(){return cu.TypeID}getName(){return this.model?.title||h(4824,"Chat")+(this.inputCount>0?` ${this.inputCount+1}`:"")}getIcon(){return bMe}async resolve(){return typeof this.sessionId=="string"?this.model=await this.chatService.getOrRestoreSession(this.sessionId)??this.chatService.startSession(Vi.Panel,ye.None):this.options.target?"data"in this.options.target&&(this.model=this.chatService.loadSessionFromContent(this.options.target.data)):this.model=this.chatService.startSession(Vi.Panel,ye.None),this.model?(this.sessionId=this.model.sessionId,this._register(this.model.onDidChange(()=>this._onDidChangeLabel.fire())),this._register(new yMe(this.model))):null}dispose(){super.dispose(),this.sessionId&&this.chatService.clearSession(this.sessionId)}};NH=cu=f([p(2,mf),p(3,Qt)],NH);class yMe extends F{constructor(e){super(),this.model=e,this._onWillDispose=this._register(new M),this.onWillDispose=this._onWillDispose.event,this._isDisposed=!1,this._isResolved=!1}async resolve(){this._isResolved=!0}isResolved(){return this._isResolved}isDisposed(){return this._isDisposed}dispose(){super.dispose(),this._isDisposed=!0}}var rP;(function(s){s.scheme=ae.vscodeChatSesssion;function e(i){return R.from({scheme:s.scheme,path:`chat-${i}`})}s.generate=e;function t(i){if(i.scheme!==s.scheme)return;const o=i.path.match(/chat-(\d+)/)?.[1];if(typeof o!="string")return;const r=parseInt(o);if(!isNaN(r))return{handle:r}}s.parse=t})(rP||(rP={}));const kd=I(4369,"Chat"),wMe="workbench.action.chat.newChat",SMe="workbench.action.chat.triggerSetup",CMe="workbench.action.chat.toggle",EMe="workbench.action.chat.openQuotaExceededDialog";function QX(s){return`workbench.action.chat.open${SK(s)}`}Io.defaultChatAgent?.manageSettingsUrl,Io.defaultChatAgent?.enterpriseProviderId,Io.defaultChatAgent?.completionsAdvancedSetting,Io.defaultChatAgent?.completionsMenuCommand;ge.appendMenuItem(N.CommandCenter,{submenu:N.ChatTitleBarMenu,title:h(4404,"Copilot"),icon:j.copilot,when:x.and(ve.supported,x.and(ve.Setup.hidden.negate(),ve.Setup.disabled.negate()),x.has("config.chat.commandCenter.enabled")),order:10001});ge.appendMenuItem(N.TitleBar,{submenu:N.ChatTitleBarMenu,title:h(4404,"Copilot"),group:"navigation",icon:j.copilot,when:x.and(ve.supported,x.and(ve.Setup.hidden.negate(),ve.Setup.disabled.negate()),x.has("config.chat.commandCenter.enabled"),x.has("config.window.commandCenter").negate()),order:1});K(class extends LO{constructor(){super("chat.commandCenter.enabled",h(4405,"Copilot Controls"),h(4406,"Toggle visibility of the Copilot Controls in title bar"),5,x.and(x.and(ve.Setup.hidden.negate(),ve.Setup.disabled.negate()),Zq.negate(),ve.supported))}});let XX=class extends F{static{this.ID="workbench.contrib.copilotTitleBarMenuRendering"}constructor(e,t,i){super();const n=e.register(N.CommandCenter,N.ChatTitleBarMenu,(o,r)=>{if(!(o instanceof kh))return;const a=Ci({id:"copilot.titleBarMenuRendering.more",label:h(4407,"More..."),run(){}}),c=i.sentiment,d=i.quotas.chat?.percentRemaining===0,l=i.entitlement===Jt.Unknown,u=i.entitlement===Jt.Free;let g=CMe,m=h(4372,"Toggle Chat"),v=j.copilot;return c.installed&&!c.disabled&&(l?(g=SMe,m=h(4408,"Sign in to use Copilot..."),v=j.copilotNotConnected):d&&u&&(g=EMe,m=h(4409,"Copilot Free plan chat messages quota reached. Click for details."),v=j.copilotWarning)),t.createInstance(ZR,t.createInstance(va,{id:g,title:m,icon:v},void 0,void 0,void 0,void 0),a,o.actions,"",{...r,skipTelemetry:!0})},D.any(i.onDidChangeSentiment,i.onDidChangeQuotaExceeded,i.onDidChangeEntitlement));mne(n)}};XX=f([p(0,xse),p(1,J),p(2,VN)],XX);async function xMe(s,e,t){return jde(s)?Kde(s,t,{messageOverride:e}):!0}async function IMe(s,e,t,i,n){if(!n||e===t)return{needToClearSession:!1};const o=s.get(ne),r=s.get(Qt);if(!o.getValue(Sy.Edits2Enabled)&&(e===jt.Edit||t===jt.Edit)&&i>0){const c=h(4410,"Switching chat modes will end your current edit session.");return n.entries.get().filter(u=>u.state.get()===_d.Modified).length>0?await xMe(n,c,r)?{needToClearSession:!0}:!1:(await r.confirm({title:h(4411,"Start new session?"),message:h(4412,"Changing the chat mode will end your current edit session. Would you like to change the chat mode?"),primaryButton:h(4413,"Yes"),type:"info"})).confirmed?{needToClearSession:!0}:!1}return{needToClearSession:!1}}async function Kde(s,e,t){const i=h(4414,"Starting a new chat will end your current edit session."),n=h(4415,"Start new chat?"),o=t?.messageOverride??i,r=t?.titleOverride??n,c=s.entries.get().filter(l=>l.state.get()===_d.Modified),{result:d}=await e.prompt({title:r,message:o+" "+h(4416,"Do you want to keep pending edits to {0} files?",c.length),type:"info",cancelButton:!0,buttons:[{label:h(4417,"Keep & Continue"),run:async()=>(await s.accept(),!0)},{label:h(4418,"Undo & Continue"),run:async()=>(await s.reject(),!0)}]});return!!d}function jde(s){const e=s.entries.get();return e.length?!!e.filter(n=>n.state.get()===_d.Modified).length:!1}class o_ extends X{constructor(e){super({category:kd,...e})}run(e,...t){const i=Yde(e,t);if(!(!i||!i.editingSession))return this.runEditingSessionAction(e,i.editingSession,i.chatWidget,...t)}}function Yde(s,e){const t=e.at(0),i=kAe(t)?t:void 0,n=s.get(Pr),o=s.get(bg);let r=i?n.getWidgetBySessionId(i.sessionId):void 0;if(r||(r=n.lastFocusedWidget??n.getWidgetsByLocations(Vi.Panel).find(d=>d.supportsChangingModes)),!r?.viewModel)return;const a=r.viewModel.model.sessionId,c=o.getEditingSession(a);if(c)return{editingSession:c,chatWidget:r}}class MO extends o_{runEditingSessionAction(e,t,i,...n){const o=[];if(R.isUri(n[0])?o.push(n[0]):i&&o.push(...i.input.selectedElements),!!o.length)return this.runWorkingSetAction(e,t,i,...o)}}K(class extends MO{constructor(){super({id:"chatEditing.removeFileFromWorkingSet",title:I(4726,"Remove File"),icon:j.close,precondition:ve.requestInProgress.negate(),menu:[{id:N.ChatEditingWidgetModifiedFilesToolbar,order:5,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){const o=e.get(Qt),r=t.entries.get().filter(a=>n.includes(a.modifiedURI)&&a.state.get()===_d.Modified);if(r.length>0){const a=r.length>1?h(4727,"{0} files",r.length):je(r[0].modifiedURI);if(!(await o.confirm({title:h(4728,"Remove {0} from working set?",a),message:h(4729,"This will remove {0} from your working set and undo the edits made to it. Do you want to proceed?",a),primaryButton:h(4730,"Yes"),type:"info"})).confirmed)return}await t.reject(...n),t.remove(...n);for(const a of n)i.attachmentModel.delete(a.toString());i.attachmentModel.fileAttachments.length===0&&i.input.relatedFiles?.clear()}});K(class extends MO{constructor(){super({id:"chatEditing.openFileInDiff",title:I(4731,"Open Changes in Diff Editor"),icon:j.diffSingle,menu:[{id:N.ChatEditingWidgetModifiedFilesToolbar,when:x.equals(RO.key,_d.Modified),order:2,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){const o=e.get(de);for(const r of n){let a=o.activeEditorPane;if(a||(a=await o.openEditor({resource:r})),!a)return;t.getEntry(r)?.getEditorIntegration(a).toggleDiff(void 0,!0)}}});K(class extends MO{constructor(){super({id:"chatEditing.acceptFile",title:I(4732,"Keep"),icon:j.check,precondition:ve.requestInProgress.negate(),menu:[{when:x.and(x.equals("resourceScheme",$de),x.notIn(qde.key,Gde.key)),id:N.MultiDiffEditorFileToolbar,order:0,group:"navigation"},{id:N.ChatEditingWidgetModifiedFilesToolbar,when:x.equals(RO.key,_d.Modified),order:0,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){await t.accept(...n)}});K(class extends MO{constructor(){super({id:"chatEditing.discardFile",title:I(4733,"Undo"),icon:j.discard,precondition:ve.requestInProgress.negate(),menu:[{when:x.and(x.equals("resourceScheme",$de),x.notIn(qde.key,Gde.key)),id:N.MultiDiffEditorFileToolbar,order:2,group:"navigation"},{id:N.ChatEditingWidgetModifiedFilesToolbar,when:x.equals(RO.key,_d.Modified),order:1,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){await t.reject(...n)}});class DMe extends o_{constructor(){super({id:"chatEditing.acceptAllFiles",title:h(4734,"Keep"),icon:j.check,tooltip:h(4735,"Keep All Edits"),precondition:x.and(ve.requestInProgress.negate(),yh),keybinding:{primary:E.CtrlCmd|S.Enter,when:x.and(ve.requestInProgress.negate(),yh,ve.inChatInput),weight:W.WorkbenchContrib},menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:0,when:x.and(PO.negate(),x.and(yh))}]})}async runEditingSessionAction(e,t,i,...n){await t.accept()}}K(DMe);class kMe extends o_{constructor(){super({id:"chatEditing.discardAllFiles",title:h(4736,"Undo"),icon:j.discard,tooltip:h(4737,"Undo All Edits"),precondition:x.and(ve.requestInProgress.negate(),yh),menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:1,when:x.and(PO.negate(),yh)}],keybinding:{when:x.and(ve.requestInProgress.negate(),yh,ve.inChatInput,ve.inputHasText.negate()),weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Backspace}})}async runEditingSessionAction(e,t,i,...n){await TMe(e,t)}}K(kMe);async function TMe(s,e){const t=s.get(Qt),i=e.entries.get();return i.length>0&&!(await t.confirm({title:h(4738,"Undo all edits?"),message:i.length===1?h(4739,"This will undo changes made by {0} in {1}. Do you want to proceed?","Copilot Edits",je(i[0].modifiedURI)):h(4740,"This will undo changes made by {0} in {1} files. Do you want to proceed?","Copilot Edits",i.length),primaryButton:h(4741,"Yes"),type:"info"})).confirmed?!1:(await e.reject(),!0)}class NO extends o_{static{this.ID="chatEditing.clearWorkingSet"}constructor(){super({id:NO.ID,title:h(4742,"Clear Working Set"),icon:j.clearAll,tooltip:h(4742,"Clear Working Set"),precondition:x.and(ve.requestInProgress.negate()),menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:5,when:QK.negate()}]})}async runEditingSessionAction(e,t,i,...n){const o=[...t.entries.get()].map(c=>c.modifiedURI);t.remove(...o);const a=(i.attachmentModel?i.attachmentModel.fileAttachments:[]).map(c=>c.toString());i.attachmentModel.delete(...a)}}K(NO);class Bb extends o_{static{this.ID="chatEditing.viewChanges"}static{this.LABEL=h(4743,"View All Edits")}constructor(){super({id:Bb.ID,title:Bb.LABEL,tooltip:Bb.LABEL,f1:!1,icon:j.diffMultiple,precondition:yh,menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:4,when:x.and(PO.negate(),x.and(QK,yh))}]})}async runEditingSessionAction(e,t,i,...n){await t.show()}}K(Bb);K(class extends X{constructor(){super({id:"workbench.action.chat.undoEdits",title:I(4744,"Undo Requests"),f1:!1,category:kd,icon:j.x,keybinding:{primary:S.Delete,mac:{primary:E.CtrlCmd|S.Backspace},when:x.and(ve.inChatSession,V.textInputFocus.negate()),weight:W.WorkbenchContrib},menu:[{id:N.ChatMessageTitle,group:"navigation",order:2,when:ve.isRequest}]})}async run(e,...t){let i=t[0];if(!MH(i)&&!nP(i)&&(i=e.get(Pr).lastFocusedWidget?.getFocus()),!i)return;const n=e.get(ne),o=e.get(Qt),a=e.get(mf).getSession(i.sessionId);if(!a)return;const c=a.editingSession;if(!c)return;const d=nP(i)?i.id:MH(i)?i.requestId:void 0;if(d){const l=a.getRequests(),u=l.findIndex(A=>A.id===d),g=l.length-u,m=l.slice(u),v=new Set(m.map(A=>A.id)),y=c.entries.get().filter(A=>v.has(A.lastModifyingRequestId))??[],w=y.length>0&&n.getValue("chat.editing.confirmEditRequestRemoval")===!0;let C;g===1?y.length===1?C=h(4745,"This will remove your last request and undo the edits made to {0}. Do you want to proceed?",je(y[0].modifiedURI)):C=h(4746,"This will remove your last request and undo edits made to {0} files in your working set. Do you want to proceed?",y.length):y.length===1?C=h(4747,"This will remove all subsequent requests and undo edits made to {0}. Do you want to proceed?",je(y[0].modifiedURI)):C=h(4748,"This will remove all subsequent requests and undo edits made to {0} files in your working set. Do you want to proceed?",y.length);const T=w?await o.confirm({title:g===1?h(4749,"Do you want to undo your last edit?"):h(4750,"Do you want to undo {0} edits?",g),message:C,primaryButton:h(4751,"Yes"),checkbox:{label:h(4752,"Don't ask again"),checked:!1},type:"info"}):{confirmed:!0};if(!T.confirmed)return;T.checkboxChecked&&await n.updateValue("chat.editing.confirmEditRequestRemoval",!1);const k=l[u].id;await c.restoreSnapshot(k,void 0)}}});K(class Qde extends X{static{this.id="chat.openFileUpdatedBySnapshot"}constructor(){super({id:Qde.id,title:h(4753,"Open File"),menu:[{id:N.ChatEditingCodeBlockContext,group:"navigation",order:0}]})}async run(e,...t){const i=t[0];if(!i?.sessionId)return;await e.get(de).openEditor({resource:i.uri})}});K(class Xde extends X{static{this.id="chat.openFileSnapshot"}constructor(){super({id:Xde.id,title:h(4754,"Open File Snapshot"),menu:[{id:N.ChatEditingCodeBlockContext,group:"navigation",order:1}]})}async run(e,...t){const i=t[0];if(!i?.sessionId)return;const n=e.get(mf),o=e.get(bg),r=e.get(de),a=n.getSession(i.sessionId);if(!a)return;const c=o.getEditingSession(a.sessionId)?.getSnapshotUri(i.requestId,i.uri,i.stopId);if(c){const d=await r.openEditor({resource:c,label:h(4755,"{0} (Snapshot)",je(i.uri)),options:{transient:!0,activation:Yc.ACTIVATE}});Ao(d)&&d.updateOptions({readOnly:!0})}}});K(class extends o_{constructor(){super({id:"workbench.action.edits.addFilesFromReferences",title:I(4756,"Add Files From References"),f1:!1,category:kd,menu:{id:N.ChatInputSymbolAttachmentContext,group:"navigation",order:1,when:x.and(ve.chatMode.isEqualTo(jt.Ask),V.hasReferenceProvider)}})}async runEditingSessionAction(e,t,i,...n){if(n.length===0||!Hie(n[0]))return;const o=e.get(yi),r=e.get(Ne),a=n[0],d=(await o.createModelReference(a.uri)).object.textEditorModel;if(!d)return;const l=new _e(a.range.startLineNumber,a.range.startColumn),[u,g,m]=await Promise.all([this.getReferences(l,d,r),this.getDefinitions(l,d,r),this.getImplementations(l,d,r)]),v=[];for(const y of[...g,...m,...u])v.push(i.attachmentModel.asFileVariableEntry(y.uri));i.attachmentModel.addContext(...v)}async getReferences(e,t,i){const n=i.referenceProvider.all(t);return(await Promise.all(n.map(async r=>await r.provideReferences(t,e,{includeDeclaration:!0},ye.None)??[]))).flat()}async getDefinitions(e,t,i){const n=i.definitionProvider.all(t);return(await Promise.all(n.map(async r=>await r.provideDefinition(t,e,ye.None)??[]))).flat()}async getImplementations(e,t,i){const n=i.implementationProvider.all(t);return(await Promise.all(n.map(async r=>await r.provideImplementation(t,e,ye.None)??[]))).flat()}});class Vb extends o_{static{this.Id="chatEditing.viewPreviousEdits"}static{this.Label=h(4757,"View Previous Edits")}constructor(){super({id:Vb.Id,title:Vb.Label,tooltip:Vb.Label,f1:!1,icon:j.diffMultiple,precondition:yh.negate(),menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:4,when:x.and(PO.negate(),x.and(QK,yh.negate()))}]})}async runEditingSessionAction(e,t,i,...n){await t.show(!0)}}K(Vb);class Zde extends X{run(e,...t){const i=t[0],n=e.get(Pr);(i?.widget??n.lastFocusedWidget)?.acceptInput(i?.inputValue)}}const OO=x.or(ve.isRequestPaused,ve.requestInProgress.negate());class XK extends Zde{static{this.ID="workbench.action.chat.submit"}constructor(){const e=ve.chatMode.isEqualTo(jt.Ask);super({id:XK.ID,title:I(4453,"Send and Dispatch"),f1:!1,category:kd,icon:j.send,precondition:e,keybinding:{when:ve.inChatInput,primary:S.Enter,weight:W.EditorContrib},menu:[{id:N.ChatExecuteSecondary,group:"group_1",order:1,when:e},{id:N.ChatExecute,order:4,when:x.and(OO,e),group:"navigation"}]})}}const Jde="workbench.action.chat.toggleAgentMode";class ele extends X{static{this.ID=Jde}constructor(){super({id:ele.ID,title:I(4454,"Set Chat Mode"),f1:!0,category:kd,precondition:x.and(ve.enabled,ve.requestInProgress.negate()),tooltip:h(4455,"Set Mode"),keybinding:{when:x.and(ve.inChatInput,ve.location.isEqualTo(Vi.Panel)),primary:E.CtrlCmd|S.Period,weight:W.EditorContrib},menu:[{id:N.ChatInput,order:1,when:x.and(ve.enabled,ve.location.isEqualTo(Vi.Panel),ve.inQuickChat.negate()),group:"navigation"}]})}async run(e,...t){const i=e.get(qe),n=e.get(ne),o=e.get(J),r=Yde(e,t);if(!r?.chatWidget)return;const a=t.at(0),d=r.chatWidget.viewModel?.model?.getRequests().length??0,l=Hde(a?.mode)??this.getNextMode(r.chatWidget,d,n);if(l.id===r.chatWidget.input.currentMode2.id)return;const u=await o.invokeFunction(IMe,r.chatWidget.input.currentMode,l.kind,d,r.editingSession);u&&(r.chatWidget.input.setChatMode2(l),u.needToClearSession&&await i.executeCommand(wMe))}getNextMode(e,t,i){const n=[Ca.Ask];(i.getValue(Sy.Edits2Enabled)||t===0)&&n.push(Ca.Edit),n.push(Ca.Agent);const o=n.findIndex(a=>a.id===e.input.currentMode2.id);return n[(o+1)%n.length]}}const AMe="workbench.action.chat.toggleRequestPaused";class tle extends X{static{this.ID=AMe}constructor(){super({id:tle.ID,title:I(4456,"Toggle Request Paused"),category:kd,icon:j.debugPause,toggled:{condition:ve.isRequestPaused,icon:j.play,tooltip:h(4457,"Resume Request")},tooltip:h(4458,"Pause Request"),menu:[{id:N.ChatExecute,order:3.5,when:x.and(ve.canRequestBePaused,ve.chatMode.isEqualTo(jt.Agent),ve.location.isEqualTo(Vi.Panel),x.or(ve.isRequestPaused.negate(),ve.inputHasText.negate())),group:"navigation"}]})}run(e,...t){const i=t[0],n=e.get(Pr);(i?.widget??n.lastFocusedWidget)?.togglePaused()}}class ile extends X{static{this.ID="workbench.action.chat.switchToNextModel"}constructor(){super({id:ile.ID,title:I(4459,"Switch to Next Model"),category:kd,f1:!0,precondition:ve.enabled})}run(e,...t){e.get(Pr).lastFocusedWidget?.input.switchToNextModel()}}const nle="workbench.action.chat.openModelPicker";class sle extends X{static{this.ID=nle}constructor(){super({id:sle.ID,title:I(4460,"Open Model Picker"),category:kd,f1:!1,keybinding:{primary:E.CtrlCmd|E.Alt|S.Period,weight:W.WorkbenchContrib,when:ve.inChatInput},precondition:ve.enabled,menu:{id:N.ChatInput,order:3,group:"navigation",when:x.and(ve.languageModelsAreUserSelectable,x.or(x.equals(ve.location.key,Vi.Panel),x.equals(ve.location.key,Vi.Editor),x.equals(ve.location.key,Vi.Notebook),x.equals(ve.location.key,Vi.Terminal)))}})}async run(e,...t){const n=e.get(Pr).lastFocusedWidget;n&&n.input.openModelPicker()}}const RMe="workbench.action.chat.changeModel";class ole extends X{static{this.ID=RMe}constructor(){super({id:ole.ID,title:I(4461,"Change Model"),category:kd,f1:!1,precondition:ve.enabled})}run(e,...t){const i=t[0];St(typeof i.vendor=="string"&&typeof i.id=="string"&&typeof i.family=="string");const o=e.get(Pr).getAllWidgets();for(const r of o)r.input.switchModel(i)}}class ZK extends Zde{static{this.ID="workbench.action.edits.submit"}constructor(){const e=ve.chatMode.notEqualsTo(jt.Ask);super({id:ZK.ID,title:I(4462,"Send"),f1:!1,category:kd,icon:j.send,precondition:e,keybinding:{when:ve.inChatInput,primary:S.Enter,weight:W.EditorContrib},menu:[{id:N.ChatExecuteSecondary,group:"group_1",when:x.and(OO,e),order:1},{id:N.ChatExecute,order:4,when:x.and(x.or(x.and(ve.isRequestPaused,ve.inputHasText),ve.requestInProgress.negate()),e),group:"navigation"}]})}}class rle extends X{static{this.ID="workbench.action.chat.submitWithoutDispatching"}constructor(){const e=x.and(x.or(ve.inputHasText,ve.hasPromptFile),OO,ve.chatMode.isEqualTo(jt.Ask));super({id:rle.ID,title:I(4463,"Send"),f1:!1,category:kd,precondition:e,keybinding:{when:ve.inChatInput,primary:E.Alt|E.Shift|S.Enter,weight:W.EditorContrib},menu:[{id:N.ChatExecuteSecondary,group:"group_1",order:2,when:ve.chatMode.isEqualTo(jt.Ask)}]})}run(e,...t){const i=t[0],n=e.get(Pr);(i?.widget??n.lastFocusedWidget)?.acceptInput(i?.inputValue,{noCommandDetection:!0})}}class ale extends X{static{this.ID="workbench.action.chat.submitWithCodebase"}constructor(){const e=x.and(x.or(ve.inputHasText,ve.hasPromptFile),OO);super({id:ale.ID,title:I(4464,"Send with {0}",`${$w}codebase`),precondition:e,menu:{id:N.ChatExecuteSecondary,group:"group_1",order:3,when:x.equals(ve.location.key,Vi.Panel)},keybinding:{when:ve.inChatInput,primary:E.CtrlCmd|S.Enter,weight:W.EditorContrib}})}run(e,...t){const i=t[0],n=e.get(Pr),o=i?.widget??n.lastFocusedWidget;if(!o)return;const a=e.get(CI).getToolByName("codebase");a&&(o.input.attachmentModel.addContext({id:a.id,name:a.displayName??"",fullName:a.displayName??"",value:void 0,icon:Te.isThemeIcon(a.icon)?a.icon:void 0,kind:"tool"}),o.acceptInput())}}const PMe="workbench.action.chat.cancel";class JK extends X{static{this.ID=PMe}constructor(){super({id:JK.ID,title:I(4466,"Cancel"),f1:!1,category:kd,icon:j.stopCircle,menu:{id:N.ChatExecute,when:x.and(ve.isRequestPaused.negate(),ve.requestInProgress),order:4,group:"navigation"},keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Escape,win:{primary:E.Alt|S.Backspace}}})}run(e,...t){const i=t[0],n=e.get(Pr),o=i?.widget??n.lastFocusedWidget;if(!o)return;const r=e.get(mf);o.viewModel&&r.cancelCurrentRequestForSession(o.viewModel.sessionId)}}let OH=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this.attachment=e,this.resourceLabels=t,this.contextKeyService=i,this.contextMenuService=n,this.labelService=o,this.menuService=r,this.fileService=a,this.languageService=c,this.modelService=d,this.hoverService=l,this.renderDisposables=this._register(new U),this.domNode=Y(".chat-attached-context-attachment.show-file-icons.implicit"),this.render()}render(){Yi(this.domNode),this.renderDisposables.clear(),this.domNode.classList.toggle("disabled",!this.attachment.enabled);const e=this.resourceLabels.create(this.domNode,{supportIcons:!0}),t=R.isUri(this.attachment.value)?this.attachment.value:this.attachment.value.uri,i=R.isUri(this.attachment.value)||!this.attachment.isSelection?void 0:this.attachment.value.range,n=this.attachment.isPromptFile===!1?t.scheme===ae.vscodeNotebookCell?h(4553,"cell"):h(4554,"file"):h(4555,"prompt"),o=je(t),r=hs(t),a=`${o} ${r}`,c=i?h(4556,"Attached {0}, {1}, line {2} to line {3}",n,a,i.startLineNumber,i.endLineNumber):h(4557,"Attached {0}, {1}",n,a),d=this.labelService.getUriLabel(t,{relative:!0}),l=h(4558,"Current {0} context",n),u=h(4559,"disabled"),m=`${l+(this.attachment.enabled?"":` (${u})`)}
${d}`,v=this.attachment.isPromptFile?Te.fromId(j.bookmark.id):void 0;e.setFile(t,{fileKind:Hi.FILE,hidePath:!0,range:i,title:m,icon:v}),this.domNode.ariaLabel=c,this.domNode.tabIndex=0;const y=h(4560,"Current {0}",n),w=ee(this.domNode,Y("span.chat-implicit-hint",void 0,y));this._register(this.hoverService.setupManagedHover(yr("element"),w,m));const C=this.attachment.enabled?h(4561,"Disable current {0} context",n):h(4562,"Enable current {0} context",n),T=this.renderDisposables.add(new Xu(this.domNode,{supportIcons:!0,title:C}));T.icon=this.attachment.enabled?j.eye:j.eyeClosed,this.renderDisposables.add(T.onDidClick(B=>{B.stopPropagation(),this.attachment.enabled=!this.attachment.enabled}));const k=this.renderDisposables.add(this.contextKeyService.createScoped(this.domNode));this.renderDisposables.add(new pi(k,this.fileService,this.languageService,this.modelService)).set(t),this.renderDisposables.add(re(this.domNode,pe.CONTEXT_MENU,async B=>{const z=new us(bt(B),B);Li.stop(B,!0),this.contextMenuService.showContextMenu({contextKeyService:k,getAnchor:()=>z,getActions:()=>{const Q=this.menuService.getMenuActions(N.ChatInputResourceAttachmentContext,k,{arg:t});return sI(Q)}})}))}};OH=f([p(2,me),p(3,mi),p(4,di),p(5,tn),p(6,Xe),p(7,fi),p(8,ai),p(9,wi)],OH);var na;(function(s){s.instructions="instructions",s.prompt="prompt",s.mode="mode"})(na||(na={}));const cle=".prompt.md",dle=".instructions.md",lle=".chatmode.md",hle="copilot-instructions.md",L0="chat.promptFiles",ule="chat.promptFilesLocations",gle="chat.instructionsFilesLocations",ple="chat.modeFilesLocations",LMe=".github/prompts",MMe=".github/instructions",NMe=".github/chatmodes";function OMe(s){const e=Sn(s.path);if(e.endsWith(cle))return na.prompt;if(e.endsWith(dle)||e===hle)return na.instructions;if(e.endsWith(lle))return na.mode}function fle(s){return OMe(s)!==void 0}function FMe(s){switch(s){case na.instructions:return MMe;case na.prompt:return LMe;case na.mode:return NMe;default:throw new Error("Unknown prompt type")}}function WMe(s){switch(s){case na.instructions:return gle;case na.prompt:return ule;case na.mode:return ple;default:throw new Error("Unknown prompt type")}}const BMe=s=>s.scheme==="untitled",VMe=s=>{const e=Sn(s.path),t=[cle,dle,lle];for(const i of t)if(e.endsWith(i))return Sn(s.path,i);return e===hle?Sn(s.path,".md"):Sn(s.path)};class r_ extends F{constructor(){super(...arguments),this.store=this._register(new U)}get isDisposed(){return this.store.isDisposed}onDispose(e){if(this.isDisposed){const t=setTimeout(e);return Ee(()=>{clearTimeout(t)})}return this.store.add(Ee(e))}addDisposables(...e){for(const t of e)this.store.add(t);return this}assertNotDisposed(e){HMe(this,e)}}function HMe(s,e){if(!s.isDisposed)return;throw typeof e=="string"?new Error(e):e}let FH=class extends r_{get uri(){return this.model.reference.uri}constructor(e,t,i,n,o,r,a,c,d,l){super(),this.model=e,this.resourceLabels=t,this.contextKeyService=i,this.contextMenuService=n,this.hoverService=o,this.labelService=r,this.menuService=a,this.fileService=c,this.languageService=d,this.modelService=l,this.renderDisposables=this._register(new U),this.domNode=Y(".chat-prompt-attachment.chat-attached-context-attachment.show-file-icons.implicit"),this._register(this.model.onUpdate(this.render.bind(this))),this._register(this.model.onDispose(this.dispose.bind(this))),this.render()}render(){Yi(this.domNode),this.renderDisposables.clear(),this.domNode.classList.remove("warning","error","disabled");const{topError:e}=this.model,t=this.resourceLabels.create(this.domNode,{supportIcons:!0}),i=this.model.reference.uri,n=je(i),o=hs(i),r=`${n} ${o}`,a=this.languageService.guessLanguageIdByFilepathOrFirstLine(i)==="prompt",c=a?h(4563,"Prompt file, {0}",r):h(4564,"Instructions attachment, {0}",r),d=a?h(4565,"Prompt"):h(4566,"Instructions"),l=this.labelService.getUriLabel(i,{relative:!0});let u=`${d} ${l}`;if(e){const{errorSubject:C}=e,T=C==="root";this.domNode.classList.add(T?"error":"warning");const k=T?h(4567,"Error"):h(4568,"Warning");u+=`
[${k}]: ${e.localizedMessage}`}const g=VMe(i);t.setFile(R.file(g),{fileKind:Hi.FILE,hidePath:!0,range:void 0,title:u,icon:Te.fromId(j.bookmark.id),extraClasses:[]}),this.domNode.ariaLabel=c,this.domNode.tabIndex=0;const m=ee(this.domNode,Y("span.chat-implicit-hint",void 0,d));this._register(this.hoverService.setupManagedHover(yr("element"),m,u));const v=this.renderDisposables.add(new Xu(this.domNode,{supportIcons:!0,title:h(4569,"Remove")}));v.icon=j.close,this.renderDisposables.add(v.onDidClick(C=>{C.stopPropagation(),this.model.dispose()}));const y=this.renderDisposables.add(this.contextKeyService.createScoped(this.domNode));this.renderDisposables.add(new pi(y,this.fileService,this.languageService,this.modelService)).set(i),this.renderDisposables.add(re(this.domNode,pe.CONTEXT_MENU,async C=>{const T=new us(bt(C),C);Li.stop(C,!0),this.contextMenuService.showContextMenu({contextKeyService:y,getAnchor:()=>T,getActions:()=>{const k=this.menuService.getMenuActions(N.ChatInputResourceAttachmentContext,y,{arg:i});return sI(k)}})}))}};FH=f([p(2,me),p(3,mi),p(4,wi),p(5,di),p(6,tn),p(7,Xe),p(8,fi),p(9,ai)],FH);const FO="prompt",WO="instructions",mle="chatmode";let WH=class extends F{get references(){return this.model.references}get chatAttachments(){return this.model.chatAttachments}allSettled(){return this.model.allSettled()}get empty(){return this.children.length===0}get hasInstructions(){return this.references.some(e=>{const t=this.modelService.getModel(e);return(t?t.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e))===WO})}constructor(e,t,i,n,o,r){super(),this.model=e,this.resourceLabels=t,this.instantiationService=i,this.languageService=n,this.modelService=o,this.logService=r,this.children=[],this._onAttachmentsChange=this._register(new M),this.onAttachmentsChange=this._onAttachmentsChange.event,this._register(this.model.onAdd(a=>{const c=this.instantiationService.createInstance(FH,a,this.resourceLabels);c.onDispose(this.handleAttachmentDispose.bind(this,c)),this.children.push(c),this.parentNode&&this.parentNode.appendChild(c.domNode),this._onAttachmentsChange.fire()}))}handleAttachmentDispose(e){const t=`[onChildDispose] Widget for instructions attachment '${e.uri.path}'`;let i=!1;return this.children=this.children.filter(n=>n===e?(i&&this.logService.warn(`${t} is present in the children references list multiple times.`),i=!0,!1):!0),i||this.logService.warn(`${t} was disposed, but was not found in the child references.`),this.parentNode||this.logService.warn(`${t} no parent node reference found.`),this.parentNode?.removeChild(e.domNode),this._onAttachmentsChange.fire(),this}render(e){this.parentNode=e;for(const t of this.children)this.parentNode.appendChild(t.domNode);return this}dispose(){for(const e of this.children)e.dispose();super.dispose()}};WH=f([p(2,J),p(3,fi),p(4,ai),p(5,Pe)],WH);class UMe extends Error{constructor(e,t){super(e,t)}sameTypeAs(e){return e==null?!1:e instanceof this.constructor}equal(e){return this.sameTypeAs(e)}}class jw extends UMe{constructor(e,t,i){super(t,i),this.uri=e}}class e4 extends jw{constructor(e,t,i=`Failed to resolve prompt contents stream for '${e.toString()}': ${t}.`){super(e,i),this.originalError=t,this.errorType="FailedToResolveContentsStream"}}class vle extends e4{constructor(e,t){super(e,t,`Failed to open '${e.fsPath}': ${t}.`),this.errorType="OpenError"}}const ZX=" -> ";class BH extends jw{constructor(e,t){ze(t.length>=2,`Recursive path must contain at least two paths, got '${t.length}'.`),super(e,"Recursive references found."),this.recursivePath=t,this.errorType="RecursiveReferenceError"}get message(){return`${super.message} ${this.getRecursivePathString("fullpath")}`}getRecursivePathString(e,t=ZX){const i=e==="fullpath"&&t===ZX;if(i&&this.defaultPathStringCache!==void 0)return this.defaultPathStringCache;const n=this.recursivePath.map(o=>{if(e==="fullpath")return`'${o}'`;if(e==="basename")return`'${Sn(o)}'`;ad(e,`Unknown filename format '${e}'.`)}).join(t);return i&&(this.defaultPathStringCache=n),n}equal(e){if(!this.sameTypeAs(e)||this.uri.toString()!==e.uri.toString()||this.recursivePath.length!==e.recursivePath.length)return!1;const t=this.getRecursivePathString("fullpath"),i=e.getRecursivePathString("fullpath");return t.length!==i.length?!1:t===i}toString(){return`"${this.message}"(${this.uri})`}}class HC extends jw{constructor(e,t=""){const i=t?`: ${t}`:"";super(e,`Resource at ${e.path} is not a prompt file${i}`),this.errorType="NotPromptFileError"}}class _le extends HC{constructor(e,t=""){const i=t?`: ${t}`:"";super(e,`Entity at '${e.path}' is a folder${i}`),this.errorType="FolderReferenceError"}}class JX{constructor(e){this.originalError=e.originalError,this.errorSubject=e.errorSubject,this.errorsCount=e.errorsCount,this.parentUri=e.parentUri}get localizedMessage(){const{originalError:e,parentUri:t,errorSubject:i,errorsCount:n}=this;ze(n>=1,`Error count must be at least 1, got '${n}'.`);const o=n>1?h(5193,`
(+{0} more issues)`,n-1):"";if(i==="root")return e instanceof vle?h(5194,"Cannot open '{0}'.{1}",e.uri.path,o):e instanceof e4?h(5195,"Cannot read '{0}'.{1}",e.uri.path,o):e instanceof BH?h(5196,"Recursion to itself."):e.message+o;lc(t,"Parent URI must be defined for error of non-root link.");const r=i==="child"?h(5197,"Contains"):h(5198,"Indirectly referenced prompt '{0}' contains",t.path),a=e instanceof BH?h(5199,"recursive"):h(5200,"broken");return h(5201,"{0} a {1} link to '{2}' that will be ignored.{3}",r,a,e.uri.path,o)}}class ble{constructor(e,t){this.range=e,this.message=t}}class kp extends ble{toString(){return`warning(${this.message})${this.range}`}}class pv extends ble{toString(){return`error(${this.message})${this.range}`}}class yle{get range(){return this.recordToken.range}constructor(e,t,i){this.expectedRecordName=e,this.recordToken=t,this.languageId=i;const n=t.nameToken.text;ze(n===e,`Record name must be '${e}', got '${n}'.`),this.issues=[]}get recordName(){return this.recordToken.nameToken.text}get diagnostics(){return this.issues}get errorDiagnostics(){return this.diagnostics.filter(e=>e instanceof pv)}get warningDiagnostics(){return this.diagnostics.filter(e=>e instanceof kp)}}class Cn{constructor(e){this.tokenRange=e}get range(){return this.tokenRange}sameRange(e){return this.range.equalsRange(e)}equals(e){return e.constructor!==this.constructor||this.text.length!==e.text.length||this.text!==e.text?!1:this.sameRange(e.range)}withRange(e){return this.tokenRange=new P(e.startLineNumber??this.range.startLineNumber,e.startColumn??this.range.startColumn,e.endLineNumber??this.range.endLineNumber,e.endColumn??this.range.endColumn),this}collapseRangeToStart(){return this.tokenRange=this.tokenRange.collapseToStart(),this}static render(e,t=""){return e.map(xq("text")).join(t)}static fullRange(e){ze(e.length>0,"Cannot get full range for an empty list of tokens.");const t=e[0],i=e[e.length-1];return ze(t.range.startLineNumber<=i.range.startLineNumber,"First token must start on previous or the same line as the last token."),t!==i&&t.range.startLineNumber===i.range.startLineNumber&&ze(t.range.endColumn<=i.range.startColumn,["First token must end at least on previous or the same column as the last token.",`First token: ${t}; Last token: ${i}.`].join(`
`)),new P(t.range.startLineNumber,t.range.startColumn,i.range.endLineNumber,i.range.endColumn)}shortText(e=32){return this.text.length<=e?this.text:`${this.text.slice(0,e-1)}...`}}class wle extends Cn{constructor(e){super(Cn.fullRange(e)),this.childTokens=[...e]}get text(){return Cn.render(this.childTokens)}get children(){return this.childTokens}equals(e){if(super.equals(e)===!1||this.children.length!==e.children.length)return!1;for(let t=0;t<this.children.length;t++){const i=this.children[t],n=e.children[t];if(i.equals(n)===!1)return!1}return!0}}class tD extends wle{}class hg extends tD{}class Qn extends Cn{static newOnLine(e,t,i){const{range:n}=e;return new i(new P(n.startLineNumber,t,n.startLineNumber,t+i.symbol.length))}}class ug extends Qn{}class a_ extends Qn{static{this.symbol="@"}get text(){return a_.symbol}toString(){return`at${this.range}`}}class Yw extends ug{static{this.symbol="	"}get text(){return Yw.symbol}toString(){return`tab${this.range}`}}class Ro extends Qn{static{this.symbol="-"}get text(){return Ro.symbol}toString(){return`dash${this.range}`}}class kg extends Qn{static{this.symbol="#"}get text(){return kg.symbol}toString(){return`hash${this.range}`}}class Tg extends Cn{constructor(e,t){super(e),this.text=t}static newOnLine(e,t,i){const n=typeof t=="number"?t:t.range.startLineNumber,o=new P(n,i,n,i+e.length);return new Tg(o,e)}toString(){return`word("${this.shortText()}")${this.range}`}}class vl extends Qn{static{this.symbol=":"}get text(){return vl.symbol}toString(){return`colon${this.range}`}}class iD extends Qn{static{this.symbol="'"}get text(){return iD.symbol}sameType(e){return e instanceof this.constructor}toString(){return`quote${this.range}`}}class nD extends Qn{static{this.symbol="/"}get text(){return nD.symbol}toString(){return`slash${this.range}`}}class Qw extends ug{static{this.symbol=" "}get text(){return Qw.symbol}toString(){return`space${this.range}`}}class $y extends Qn{static{this.symbol=","}get text(){return $y.symbol}toString(){return`comma${this.range}`}}class Ag extends Qn{static{this.symbol="\f"}get text(){return Ag.symbol}toString(){return`formfeed${this.range}`}}class Xw extends Qn{static{this.symbol="$"}get text(){return Xw.symbol}toString(){return`dollarSign${this.range}`}}class c_ extends ug{static{this.symbol="\v"}get text(){return c_.symbol}toString(){return`vtab${this.range}`}}class sD extends Qn{static{this.symbol='"'}get text(){return sD.symbol}sameType(e){return e instanceof this.constructor}toString(){return`double-quote${this.range}`}}class wh extends Qn{static{this.symbol="!"}get text(){return wh.symbol}toString(){return`exclamation-mark${this.range}`}}class eu extends Qn{static{this.symbol="["}get text(){return eu.symbol}toString(){return`left-bracket${this.range}`}}class Sh extends Qn{static{this.symbol="]"}get text(){return Sh.symbol}toString(){return`right-bracket${this.range}`}}class Zw extends Qn{static{this.symbol="{"}get text(){return Zw.symbol}toString(){return`left-curly-brace${this.range}`}}class Mm extends Qn{static{this.symbol="}"}get text(){return Mm.symbol}toString(){return`right-curly-brace${this.range}`}}class oD extends Qn{static{this.symbol="("}get text(){return oD.symbol}toString(){return`left-parenthesis${this.range}`}}class BO extends Qn{static{this.symbol=")"}get text(){return BO.symbol}toString(){return`right-parenthesis${this.range}`}}class gg extends Qn{static{this.symbol="<"}get text(){return gg.symbol}toString(){return`left-angle-bracket${this.range}`}}class d_ extends Qn{static{this.symbol=">"}get text(){return d_.symbol}toString(){return`right-angle-bracket${this.range}`}}class l_ extends hg{get valueTypeName(){return this}get cleanText(){return this.text}trimEnd(){const e=[];let t=this.childTokens.length-1;for(;t>=0;){const i=this.childTokens[t];if(i instanceof ug){e.push(i),t--;continue}break}return this.childTokens.length=t+1,this.childTokens.length===0&&(this.collapseRangeToStart(),this.childTokens.push(new Tg(this.range,""))),this.withRange(Cn.fullRange(this.childTokens)),e.reverse()}toString(){return`front-matter-sequence(${this.shortText()})${this.range}`}}class VO extends hg{constructor(){super(...arguments),this.valueTypeName="quoted-string"}get cleanText(){return Cn.render(this.children.slice(1,this.children.length-1))}toString(){return`front-matter-string(${this.shortText()})${this.range}`}}class t4 extends yle{get value(){return this.valueToken?.cleanText}constructor(e,t,i){super(e,t,i)}validate(){const{valueToken:e}=this.recordToken,t=e instanceof VO,i=e instanceof l_;return t||i?(this.valueToken=e,this.issues):(this.issues.push(new pv(e.range,h(5187,"The '{0}' metadata must be a '{1}', got '{2}'.",this.recordName,"string",e.valueTypeName.toString()))),delete this.valueToken,this.issues)}}class $Me extends t4{constructor(e,t,i,n){super(t,i,n),this.validValues=e}get value(){return this.enumValue}validate(){if(super.validate(),this.valueToken===void 0)return this.issues;ze(this.valueToken instanceof VO||this.valueToken instanceof l_,`Record token must be 'string', got '${this.valueToken}'.`);const{cleanText:e}=this.valueToken;return n_e(e,this.validValues)?(this.enumValue=e,this.issues):(this.issues.push(new pv(this.valueToken.range,h(5186,"The '{0}' metadata must be one of {1}, got '{2}'.",this.recordName,this.validValues.map(t=>`'${t}'`).join(" | "),e))),delete this.valueToken,this.issues)}}class Sle extends tD{toString(){return`front-matter-record-name(${this.shortText()})${this.range}`}}class GMe extends tD{toString(){return`front-matter-delimiter(${this.shortText()})${this.range}`}}class Zp extends tD{get nameToken(){return this.children[0]}get valueToken(){return this.children[2]}trimValueEnd(){const{valueToken:e}=this;if(!(e instanceof l_))return[];const t=e.trimEnd();return this.withRange(Cn.fullRange(this.children)),t}toString(){return`front-matter-record(${this.shortText()})${this.range}`}}const eZ="mode";class tZ extends $Me{constructor(e,t){super([jt.Ask,jt.Edit,jt.Agent],eZ,e,t)}static isModeRecord(e){return e instanceof Zp?e.nameToken.text===eZ:!1}}class Cle extends hg{constructor(){super(...arguments),this.valueTypeName="array"}get items(){const e=[];for(const t of this.children)t instanceof hg&&e.push(t);return e}toString(){return`front-matter-array(${Cn.render(this.items,", ")})${this.range}`}}const tk="tools";class iZ extends yle{get value(){return this.validToolNames===void 0?[]:[...this.validToolNames.values()]}get recordName(){return tk}constructor(e,t){super(tk,e,t)}validate(){const{valueToken:e}=this.recordToken;if(!(e instanceof Cle))return this.issues.push(new pv(e.range,h(5188,"The '{0}' metadata must be an array of tool names, got '{2}'.",tk,e.valueTypeName.toString()))),delete this.valueToken,this.issues;this.valueToken=e,this.validToolNames=new Set;for(const t of this.valueToken.items)this.issues.push(...this.validateToolName(t,this.validToolNames));return this.issues}validateToolName(e,t){const i=[];if(!(e instanceof VO)&&!(e instanceof l_))return i.push(new kp(e.range,h(5189,"Unexpected tool name '{0}', expected '{1}'.",e.text,"string"))),i;const n=e.cleanText.trim();return n.length===0?(i.push(new kp(e.range,h(5190,"Tool name cannot be empty."))),i):t.has(n)?(i.push(new kp(e.range,h(5191,"Duplicate tool name '{0}'.",n))),i):(t.add(n),i)}static isToolsRecord(e){return e instanceof Zp?e.nameToken.text===tk:!1}}const M0="description";class nZ extends t4{get recordName(){return M0}constructor(e,t){super(M0,e,t)}static isDescriptionRecord(e){return e instanceof Zp?e.nameToken.text===M0:!1}}class rD extends r_{constructor(e,t){if(super(),this.data=e,this.cancellationToken=t,this.ended=!1,this.stream=s_e(null),t?.isCancellationRequested){this.end();return}this.send(!0)}send(e=!1){if(this.cancellationToken?.isCancellationRequested||this.ended){this.end();return}this.sendData().then(()=>{if(this.cancellationToken?.isCancellationRequested||this.ended){this.end();return}if(e===!0){this.stopStream();return}this.timeoutHandle=setTimeout(this.send.bind(this))}).catch(t=>{this.stream.error(t),this.dispose()})}stopStream(){return this.timeoutHandle===void 0?this:(clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this)}async sendData(e=25){for(;e>0;)try{const t=this.data.next();if(t.done||this.cancellationToken?.isCancellationRequested){this.end();return}await this.stream.write(t.value),e--}catch(t){this.stream.error(t),this.dispose();return}}end(){return this.ended?this:(this.ended=!0,this.stopStream(),this.stream.end(),this)}pause(){this.stopStream(),this.stream.pause()}resume(){this.send(),this.stream.resume()}destroy(){this.dispose()}removeListener(e,t){this.stream.removeListener(e,t)}on(e,t){if(e==="data"){this.stream.on(e,t),this.send();return}if(e==="error"){this.stream.on(e,t);return}if(e==="end"){this.stream.on(e,t);return}ad(e,`Unexpected event name '${e}'.`)}dispose(){this.stopStream(),this.stream.destroy(),super.dispose()}static fromArray(e,t){return new rD(qMe(e),t)}}const qMe=s=>function*(){for(const e of s)yield e}();class no extends Qn{static{this.symbol=`
`}static{this.byte=Re.fromString(no.symbol)}get text(){return no.symbol}get byte(){return no.byte}toString(){return`newline${this.range}`}}class $o extends Qn{static{this.symbol="\r"}static{this.byte=Re.fromString($o.symbol)}get byte(){return $o.byte}get text(){return $o.symbol}toString(){return`CR${this.range}`}}const Ele=Object.freeze([ug,$o,no,Ag]);class zMe extends F{constructor(e){super(),this.decoder=e,this.messages=[],this._register(e)}async*[Symbol.asyncIterator](){const e=t=>{t!==void 0?this.messages.push(t):(this.decoder.removeListener("data",e),this.decoder.removeListener("end",e)),this.resolveOnNewEvent&&(this.resolveOnNewEvent(),delete this.resolveOnNewEvent)};for(this.decoder.on("end",e),this.decoder.on("data",e),this.decoder.start();;){const t=this.messages.shift();if(t!==void 0){yield t;continue}if(this.decoder.ended)return this.dispose(),null;await new Promise(i=>{this.resolveOnNewEvent=i})}}}class xf extends r_{constructor(e){super(),this.stream=e,this._ended=!1,this._onData=this._register(new M),this._onEnd=this._register(new M),this._onError=this._register(new M),this._listeners=this._register(new ei),this.started=!1,this.settledPromise=new Zo}get settled(){return ze(this.started,["Cannot get `settled` promise of a stream that has not been started.","Please call `start()` first."].join(" ")),this.settledPromise.p}start(){return ze(this._ended===!1,"Cannot start stream that has already ended."),ze(this.isDisposed===!1,"Cannot start stream that has already disposed."),this.started?this:(this.started=!0,this.stream.on("end",this.onStreamEnd.bind(this)),this.stream.on("error",this.onStreamError.bind(this)),this.stream.on("data",this.tryOnStreamData.bind(this)),this.stream instanceof xf&&this.stream.start(),this)}get ended(){return this._ended}tryOnStreamData(e){try{this.onStreamData(e)}catch(t){this.onStreamError(t)}}on(e,t){if(e==="data")return this.onData(t);if(e==="error")return this.onError(t);if(e==="end")return this.onEnd(t);ad(e,`Invalid event name '${e}'`)}onData(e){ze(!this.ended,"Cannot subscribe to the `data` event because the decoder stream has already ended.");let t=this._listeners.get("data");t||(t=new ei,this._listeners.set("data",t)),t.set(e,this._onData.event(e))}onError(e){ze(!this.ended,"Cannot subscribe to the `error` event because the decoder stream has already ended.");let t=this._listeners.get("error");t||(t=new ei,this._listeners.set("error",t)),t.set(e,this._onError.event(e))}onEnd(e){ze(!this.ended,"Cannot subscribe to the `end` event because the decoder stream has already ended.");let t=this._listeners.get("end");t||(t=new ei,this._listeners.set("end",t)),t.set(e,this._onEnd.event(e))}pause(){this.stream.pause()}resume(){ze(this.ended===!1,"Cannot resume the stream because it has already ended."),this.stream.resume()}destroy(){this.dispose()}removeListener(e,t){const i=this._listeners.get(e);if(i!==void 0)for(const[n]of i)n===t&&i.deleteAndDispose(n)}onStreamEnd(){this._ended||(this._ended=!0,this._onEnd.fire(),this.settledPromise.complete())}onStreamError(e){this._onError.fire(e)}async consumeAll(){ze(!this._ended,"Cannot consume all messages of the stream that has already ended.");const e=[];for await(const t of this){if(t===null)break;e.push(t)}return e}[Symbol.asyncIterator](){return ze(!this._ended,"Cannot iterate on messages of the stream that has already ended."),this._register(new zMe(this))[Symbol.asyncIterator]()}dispose(){this.settledPromise.complete(),this._listeners.clearAndDisposeAll(),this.stream.destroy(),super.dispose()}}class KMe extends Cn{constructor(e,t){ze(!isNaN(e),"The line number must not be a NaN."),ze(e>0,`The line number must be >= 1, got "${e}".`),super(new P(e,1,e,t.length+1)),this.text=t}toString(){return`line("${this.shortText()}")${this.range}`}}class xle extends xf{constructor(){super(...arguments),this.buffer=Re.alloc(0)}onStreamData(e){this.buffer=Re.concat([this.buffer,e]),this.processData(!1)}processData(e){for(;this.buffer.byteLength>0;){const t=this.lastEmittedLine?this.lastEmittedLine.range.startLineNumber+1:1,i=this.findEndOfLineTokens(t,e),n=i[0];if(n===void 0){e&&this.emitLine(t,this.buffer.slice(0));break}this.emitLine(t,this.buffer.slice(0,n.range.startColumn-1)),lc(this.lastEmittedLine,"No last emitted line found."),i.length===1&&n instanceof $o&&i.splice(0,1,new no(n.range));let o=this.lastEmittedLine.range.endColumn;for(const r of i){const a=r.byte.byteLength,c=o+a;this._onData.fire(r.withRange({startColumn:o,endColumn:c})),this.buffer=this.buffer.slice(a),o=c}}e&&ze(this.buffer.byteLength===0,"Expected the input data buffer to be empty when the stream ends.")}findEndOfLineTokens(e,t){const i=[],n=this.buffer.indexOf($o.byte),o=this.buffer.indexOf(no.byte);return n>=0&&(n<o||o===-1)?(i.push(new $o(new P(e,n+1,e,n+1+$o.byte.byteLength))),o===n+1&&i.push(new no(new P(e,o+1,e,o+1+no.byte.byteLength))),this.buffer.byteLength>n+1||t?i:[]):(o>=0&&i.push(new no(new P(e,o+1,e,o+1+no.byte.byteLength))),i)}emitLine(e,t){const i=new KMe(e,t.toString());this._onData.fire(i),this.lastEmittedLine=i,this.buffer=this.buffer.slice(t.byteLength)}onStreamEnd(){this.buffer.byteLength>0&&this.processData(!0),super.onStreamEnd()}}const Ile=Object.freeze([oD,BO,eu,Sh,Zw,Mm,gg,d_,Qw,Yw,c_,Ag,vl,kg,Ro,wh,a_,nD,Xw,iD,sD,$y]),jMe=Object.freeze(Ile.map(xq("symbol")));class Dle extends xf{constructor(e){super(new xle(e))}onStreamData(e){if(e instanceof $o||e instanceof no){this._onData.fire(e);return}const t=e.text.split("");let i=0;for(;i<t.length;){const n=i+1,o=t[i],r=Ile.find(c=>c.symbol===o);if(r){this._onData.fire(Qn.newOnLine(e,n,r)),i++;continue}let a="";for(;i<t.length&&!jMe.includes(t[i]);)a+=t[i],i++;this._onData.fire(Tg.newOnLine(a,e,n))}}}class Ts{get consumed(){return this.isConsumed}constructor(e=[]){this.currentTokens=e,this.isConsumed=!1,this.startTokensCount=this.currentTokens.length}get tokens(){return this.currentTokens}assertNotConsumed(){ze(this.isConsumed===!1,"The parser object is already consumed and should not be used anymore.")}}function bo(s,e,t){const i=t.value;return t.value=function(...n){return ze(this.isConsumed===!1,"The parser object is already consumed and should not be used anymore."),i.apply(this,n)},t}const YMe=Object.freeze([...Ele,$y]);class VH extends Ts{constructor(e){super([e]),this.startToken=e,this.arrayItemAllowed=!0}accept(e){if(this.currentValueParser!==void 0){const t=this.currentValueParser.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="failure")return this.isConsumed=!0,{result:"failure",wasTokenConsumed:n};const{nextParser:o}=t;return o instanceof hg?(this.currentTokens.push(o),delete this.currentValueParser,n===!1?this.accept(e):{result:"success",nextParser:this,wasTokenConsumed:n}):(this.currentValueParser=o,{result:"success",nextParser:this,wasTokenConsumed:n})}if(e instanceof Sh)return ze(this.currentValueParser===void 0,"Unexpected end of array. Last value is not finished."),this.currentTokens.push(e),this.isConsumed=!0,{result:"success",nextParser:this.asArrayToken(),wasTokenConsumed:!0};for(const t of YMe)if(e instanceof t)return this.currentTokens.push(e),this.arrayItemAllowed===!1&&e instanceof $y&&(this.arrayItemAllowed=!0),{result:"success",nextParser:this,wasTokenConsumed:!0};return this.arrayItemAllowed===!0?(this.currentValueParser=new Hb(t=>t instanceof Sh||t instanceof $y),this.arrayItemAllowed=!1,this.accept(e)):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}asArrayToken(){const e=this.currentTokens[this.currentTokens.length-1];lc(e,"No tokens found."),ze(e instanceof Sh,"Cannot find a closing bracket of the array.");const t=[];for(const i of this.currentTokens)i instanceof hg&&(i instanceof l_&&i.trimEnd(),t.push(i));return this.isConsumed=!0,new Cle([this.startToken,...t,e])}}VH.__decorator=f([bo],VH.prototype,"accept",null);class HH extends Ts{constructor(e){super([e]),this.startToken=e}accept(e){return this.currentTokens.push(e),e instanceof Qn&&this.startToken.sameType(e)?{result:"success",nextParser:this.asStringToken(),wasTokenConsumed:!0}:{result:"success",nextParser:this,wasTokenConsumed:!0}}asStringToken(){const e=this.currentTokens[this.currentTokens.length-1];return lc(e,"No matching end token found."),ze(this.startToken.sameType(e),`String starts with \`${this.startToken.text}\`, but ends with \`${e.text}\`.`),new VO([this.startToken,...this.currentTokens.slice(1,this.currentTokens.length-1),e])}}HH.__decorator=f([bo],HH.prototype,"accept",null);class i4 extends hg{constructor(e){const t=kle(e);lc(t,`Cannot convert '${e}' to a boolean value.`),super([e]),this.valueTypeName="boolean",this.value=t}static tryFromToken(e){if(!(e instanceof Tg))return null;try{return new i4(e)}catch{return null}}equals(e){return super.equals(e)===!1?!1:this.value===e.value}toString(){return`front-matter-boolean(${this.shortText()})${this.range}`}}function kle(s){return s.text.toLowerCase()==="true"?!0:s.text.toLowerCase()==="false"?!1:null}class Gy extends Ts{constructor(e){super([]),this.shouldStop=e}accept(e){return this.shouldStop(e)?(this.isConsumed=!0,{result:"success",nextParser:this.asSequenceToken(),wasTokenConsumed:!1}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}addTokens(e){return this.currentTokens.push(...e),this}asSequenceToken(){return this.isConsumed=!0,new l_(this.currentTokens)}}Gy.__decorator=f([bo],Gy.prototype,"accept",null);const QMe=Object.freeze([iD,sD,eu]);class Hb extends Ts{get tokens(){return this.currentValueParser===void 0?[]:this.currentValueParser.tokens}constructor(e){super(),this.shouldStop=e}accept(e){if(this.currentValueParser!==void 0){const i=this.currentValueParser.accept(e),{result:n,wasTokenConsumed:o}=i;if(this.isConsumed=this.currentValueParser.consumed,n==="success"){const{nextParser:r}=i;return r instanceof hg?{result:"success",nextParser:r,wasTokenConsumed:o}:(this.currentValueParser=r,{result:"success",nextParser:this,wasTokenConsumed:o})}return{result:"failure",wasTokenConsumed:o}}if(e instanceof iD||e instanceof sD)return this.currentValueParser=new HH(e),{result:"success",nextParser:this,wasTokenConsumed:!0};if(e instanceof eu)return this.currentValueParser=new VH(e),{result:"success",nextParser:this,wasTokenConsumed:!0};const t=i4.tryFromToken(e);return t!==null?(this.isConsumed=!0,{result:"success",nextParser:t,wasTokenConsumed:!0}):(this.currentValueParser=new Gy(this.shouldStop),this.accept(e))}static isValueStartToken(e){for(const t of QMe)if(e instanceof t)return!0;return e instanceof Tg&&kle(e)!==null}get isSequence(){return this.currentValueParser===void 0?!1:this.currentValueParser instanceof Gy}asSequenceToken(){return this.isConsumed=!0,new l_(this.tokens)}}Hb.__decorator=f([bo],Hb.prototype,"accept",null);class aP extends Ts{constructor(e){super(e),this.recordNameToken=e[0],this.recordDelimiterToken=e[1]}accept(e){if(this.valueParser!==void 0){const t=this.valueParser.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="failure")return this.isConsumed=!0,{result:"failure",wasTokenConsumed:n};const{nextParser:o}=t;if(o instanceof hg){this.currentTokens.push(o),delete this.valueParser,this.isConsumed=!0;try{return{result:"success",nextParser:new Zp([this.recordNameToken,this.recordDelimiterToken,o]),wasTokenConsumed:n}}catch{return{result:"failure",wasTokenConsumed:n}}}return this.valueParser=o,{result:"success",nextParser:this,wasTokenConsumed:n}}if(e instanceof ug)return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0};if(Hb.isValueStartToken(e))return this.valueParser=new Hb(N0),this.accept(e);if(this.valueParser=new Gy(N0),N0(e)){const t=this.currentTokens.slice(this.startTokensCount);return t.length===0&&t.push(Tg.newOnLine("",e.range.startLineNumber,e.range.startColumn)),this.valueParser.addTokens(t),{result:"success",nextParser:this.asRecordToken(),wasTokenConsumed:!1}}return this.accept(e)}asRecordToken(){if(lc(this.valueParser,"Current value parser must be defined."),this.valueParser instanceof Hb||this.valueParser instanceof Gy){const e=this.valueParser.asSequenceToken();return this.currentTokens.push(e),this.isConsumed=!0,new Zp([this.recordNameToken,this.recordDelimiterToken,e])}ad(this.valueParser,`Unexpected value parser '${this.valueParser}'.`)}}aP.__decorator=f([bo],aP.prototype,"accept",null);const N0=s=>s instanceof no||s instanceof $o||s instanceof Ag;class UH extends Ts{constructor(e){super([...e])}accept(e){const t=this.currentTokens[this.currentTokens.length-1];if(e instanceof ug&&t instanceof vl){const n=new GMe([t,e]),o=this.currentTokens[0];return ze(o instanceof Sle,`Expected a front matter record name, got '${o}'.`),this.isConsumed=!0,{result:"success",nextParser:new aP([o,n]),wasTokenConsumed:!0}}return e instanceof ug?(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0}):e instanceof vl?(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}}UH.__decorator=f([bo],UH.prototype,"accept",null);const XMe=[Tg,Ro];class $H extends Ts{constructor(e){super([e])}accept(e){for(const t of XMe)if(e instanceof t)return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0};if(e instanceof vl||e instanceof ug){const t=new Sle(this.currentTokens);return this.isConsumed=!0,{result:"success",nextParser:new UH([t,e]),wasTokenConsumed:!0}}return this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}}}$H.__decorator=f([bo],$H.prototype,"accept",null);class ZMe extends xf{constructor(e){if(e instanceof rD){super(e);return}super(new Dle(e))}onStreamData(e){if(this.current!==void 0){const t=this.current.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="failure"){this.reEmitCurrentTokens(),n===!1&&this._onData.fire(e),delete this.current;return}const{nextParser:o}=t;if(o instanceof tD){const r=o instanceof Zp?o.trimValueEnd():[];this._onData.fire(o);for(const a of r)this._onData.fire(a);n===!1&&this._onData.fire(e),delete this.current;return}this.current=o,n===!1&&this._onData.fire(e);return}if(e instanceof Tg){this.current=new $H(e);return}for(const t of Ele)if(e instanceof t){this._onData.fire(e);return}this.reEmitCurrentTokens()}onStreamEnd(){try{if(this.current===void 0)return;ze(this.current instanceof aP,"Only partial front matter records can be processed on stream end.");const e=this.current.asRecordToken(),t=e.trimValueEnd();this._onData.fire(e);for(const i of t)this._onData.fire(i)}catch{this.reEmitCurrentTokens()}finally{delete this.current,super.onStreamEnd()}}reEmitCurrentTokens(){if(this.current!==void 0){for(const e of this.current.tokens)this._onData.fire(e);delete this.current}}}class Tle extends F{get metadata(){const e={};for(const[t,i]of Object.entries(this.meta))i?.value!==void 0&&Object.assign(e,{[t]:i.value});return e}get metadataUtility(){return{...this.meta}}get diagnostics(){return this.issues}get range(){return this.token.range}constructor(e,t){super(),this.token=e,this.languageId=t,this.issues=[],this.meta={},this.recordNames=new Set,this.stream=this._register(new ZMe(rD.fromArray([...e.contentToken.children]))),this.stream.onData(this.onData.bind(this)),this.stream.onError(this.onError.bind(this))}onData(e){if(!(e instanceof Zp)){if(e instanceof Qn)return;this.issues.push(new pv(e.range,h(5180,"Unexpected token '{0}'.",e.text)));return}const t=e.nameToken.text;if(this.recordNames.has(t)){this.issues.push(new kp(e.range,h(5181,"Duplicate metadata '{0}' will be ignored.",t)));return}if(this.recordNames.add(t),nZ.isDescriptionRecord(e)){const i=new nZ(e,this.languageId);this.issues.push(...i.validate()),this.meta.description=i,this.recordNames.add(t);return}this.handleToken(e)||this.issues.push(new kp(e.range,h(5182,"Unknown metadata '{0}' will be ignored.",t)))}onError(e){this.issues.push(new pv(this.token.range,h(5183,"Failed to parse prompt header: {0}",e.message)))}get settled(){return this.stream.settled}start(){return this.stream.start(),this}}class Ale extends Tle{handleToken(e){if(iZ.isToolsRecord(e)){const t=new iZ(e,this.languageId);return this.issues.push(...t.validate()),this.meta.tools=t,this.validateToolsAndModeCompatibility(),!0}if(tZ.isModeRecord(e)){const t=new tZ(e,this.languageId);return this.issues.push(...t.validate()),this.meta.mode=t,this.validateToolsAndModeCompatibility(),!0}return!1}get toolsAndModeCompatible(){const{tools:e,mode:t}=this.meta;return e===void 0||t?.value===void 0?!0:t.value===jt.Agent}validateToolsAndModeCompatibility(){if(this.toolsAndModeCompatible===!0)return;const{tools:e,mode:t}=this.meta;lc(e,"Tools metadata must have been present."),lc(t,"Mode metadata must have been present."),ze(t.value!==jt.Agent,"Mode metadata must not be agent mode."),this.issues.push(new kp(t.range,h(5192,"Record '{0}' is implied to have the '{1}' value if '{2}' record is present so the specified value will be ignored.",t.recordName,jt.Agent,e.recordName)))}}class JMe extends Ale{}class Jw extends Cn{}const GH="#",sZ=":";class Rle extends Jw{constructor(e,t){for(const i of t)ze(n4.includes(i)===!1&&aD.includes(i)===!1,`Variable 'name' cannot contain character '${i}', got '${t}'.`);super(e),this.name=t}get text(){return`${GH}${this.name}`}toString(){return`${this.text}${this.range}`}}class cP extends Rle{constructor(e,t,i){super(e,t),this.data=i;for(const n of i)ze(aD.includes(n)===!1,`Variable 'data' cannot contain character '${n}', got '${i}'.`)}get text(){return`${GH}${this.name}${sZ}${this.data}`}get dataRange(){const{range:e}=this,t=e.startColumn+GH.length+this.name.length+sZ.length,i=new P(e.startLineNumber,t,e.endLineNumber,e.endColumn);if(!i.isEmpty())return i}}const aD=[Qw,Yw,no,$o,c_,Ag,kg,a_].map(s=>s.symbol),n4=[kg,vl,wh,gg,d_,eu,Sh].map(s=>s.symbol);class dP extends Ts{constructor(e){super([e])}accept(e){if(aD.includes(e.text))try{return{result:"success",nextParser:this.asPromptVariable(),wasTokenConsumed:!1}}catch{return{result:"failure",wasTokenConsumed:!1}}finally{this.isConsumed=!0}return e instanceof vl?(this.isConsumed=!0,this.currentTokens.length<=1?{result:"failure",wasTokenConsumed:!1}:{result:"success",nextParser:new lP([...this.currentTokens,e]),wasTokenConsumed:!0}):n4.includes(e.text)?(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asPromptVariable(){ze(this.currentTokens.length>1,"Cannot create a prompt variable out of incomplete token sequence.");const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1],i=this.currentTokens.slice(1),n=Cn.render(i);return new Rle(new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn),n)}}dP.__decorator=f([bo],dP.prototype,"accept",null);class lP extends Ts{constructor(e){const t=e[0],i=e[e.length-1];ze(e.length>2,`Tokens list must contain at least 3 items, got '${e.length}'.`),ze(t instanceof kg,`The first token must be a '#', got '${t} '.`),ze(i instanceof vl,`The last token must be a ':', got '${i} '.`),super([...e])}accept(e){if(aD.includes(e.text)){this.isConsumed=!0;const t=this.currentTokens[0],i=this.currentTokens[this.currentTokens.length-1],n=this.currentTokens.slice(1,this.startTokensCount-1),o=this.currentTokens.slice(this.startTokensCount),r=new P(t.range.startLineNumber,t.range.startColumn,i.range.endLineNumber,i.range.endColumn),a=Cn.render(n),c=Cn.render(o);return{result:"success",nextParser:new cP(r,a,c),wasTokenConsumed:!1}}return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0}}asPromptVariableWithData(){const e=this.currentTokens.slice(1,this.startTokensCount-1),t=this.currentTokens.slice(this.startTokensCount),i=Cn.render(e),n=Cn.render(t),o=this.currentTokens[0],r=this.currentTokens[this.currentTokens.length-1];return new cP(new P(o.range.startLineNumber,o.range.startColumn,r.range.endLineNumber,r.range.endColumn),i,n)}}lP.__decorator=f([bo],lP.prototype,"accept",null);const eNe="@";class tNe extends Jw{constructor(e,t){for(const i of t)ze(n4.includes(i)===!1&&aD.includes(i)===!1,`Mention 'name' cannot contain character '${i}', got '${t}'.`);super(e),this.name=t}get text(){return`${eNe}${this.name}`}toString(){return`${this.text}${this.range}`}}const iNe=[Qw,Yw,no,$o,c_,Ag,a_,vl,kg].map(s=>s.symbol),nNe=[wh,gg,d_,eu,Sh].map(s=>s.symbol);class hP extends Ts{constructor(e){super([e])}accept(e){if(iNe.includes(e.text))try{return{result:"success",nextParser:this.asPromptAtMention(),wasTokenConsumed:!1}}catch{return{result:"failure",wasTokenConsumed:!1}}finally{this.isConsumed=!0}return nNe.includes(e.text)?(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asPromptAtMention(){ze(this.currentTokens.length>1,"Cannot create a prompt @mention out of incomplete token sequence.");const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1],i=this.currentTokens.slice(1),n=Cn.render(i);return new tNe(new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn),n)}}hP.__decorator=f([bo],hP.prototype,"accept",null);const sNe="/";class oNe extends Jw{constructor(e,t){for(const i of t)ze(Lle.includes(i)===!1&&Ple.includes(i)===!1,`Slash command 'name' cannot contain character '${i}', got '${t}'.`);super(e),this.name=t}get text(){return`${sNe}${this.name}`}toString(){return`${this.text}${this.range}`}}const Ple=[Qw,Yw,no,$o,c_,Ag,vl,a_,kg,nD].map(s=>s.symbol),Lle=[wh,gg,d_,eu,Sh].map(s=>s.symbol);class uP extends Ts{constructor(e){super([e])}accept(e){if(Ple.includes(e.text))try{return{result:"success",nextParser:this.asPromptSlashCommand(),wasTokenConsumed:!1}}catch{return{result:"failure",wasTokenConsumed:!1}}finally{this.isConsumed=!0}return Lle.includes(e.text)?(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asPromptSlashCommand(){ze(this.currentTokens.length>1,"Cannot create a prompt /command out of incomplete token sequence.");const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1],i=this.currentTokens.slice(1),n=Cn.render(i);return new oNe(new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn),n)}}uP.__decorator=f([bo],uP.prototype,"accept",null);class eS extends Cn{}class Ub extends eS{constructor(e,t,i,n){ze(!isNaN(e),"The line number must not be a NaN."),ze(e>0,`The line number must be >= 1, got "${e}".`),ze(t>0,`The column number must be >= 1, got "${t}".`),ze(i[0]==="["&&i[i.length-1]==="]",`The caption must be enclosed in square brackets, got "${i}".`),ze(n[0]==="("&&n[n.length-1]===")",`The reference must be enclosed in parentheses, got "${n}".`),super(new P(e,t,e,t+i.length+n.length)),this.caption=i,this.reference=n;try{new URL(this.path),this.isURL=!0}catch{this.isURL=!1}}get text(){return`${this.caption}${this.reference}`}get path(){return this.reference.slice(1,this.reference.length-1)}get linkRange(){if(this.path.length===0)return;const{range:e}=this,t=e.startColumn+this.caption.length+1,i=t+this.path.length;return new P(e.startLineNumber,t,e.endLineNumber,i)}toString(){return`md-link("${this.shortText()}")${this.range}`}}class rNe extends eS{constructor(e,t,i,n){ze(!isNaN(e),"The line number must not be a NaN."),ze(e>0,`The line number must be >= 1, got "${e}".`),ze(t>0,`The column number must be >= 1, got "${t}".`),ze(i[0]==="!",`The caption must start with '!' character, got "${i}".`),ze(i[1]==="["&&i[i.length-1]==="]",`The caption must be enclosed in square brackets, got "${i}".`),ze(n[0]==="("&&n[n.length-1]===")",`The reference must be enclosed in parentheses, got "${n}".`),super(new P(e,t,e,t+i.length+n.length)),this.caption=i,this.reference=n;try{new URL(this.path),this.isURL=!0}catch{this.isURL=!1}}get text(){return`${this.caption}${this.reference}`}get path(){return this.reference.slice(1,this.reference.length-1)}get linkRange(){if(this.path.length===0)return;const{range:e}=this,t=e.startColumn+this.caption.length+1,i=t+this.path.length;return new P(e.startLineNumber,t,e.endLineNumber,i)}toString(){return`md-image("${this.shortText()}")${this.range}`}}const Mle=[$o,no,c_,Ag].map(s=>s.symbol);class Nle extends Ts{constructor(e){super([e])}accept(e){return Mle.includes(e.text)?{result:"failure",wasTokenConsumed:!1}:e instanceof Sh?{result:"success",nextParser:new aNe([...this.tokens,e]),wasTokenConsumed:!0}:(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}}class aNe extends Ts{accept(e){return e instanceof oD?{result:"success",wasTokenConsumed:!0,nextParser:new cNe([...this.tokens],e)}:{result:"failure",wasTokenConsumed:!1}}}class cNe extends Ts{constructor(e,t){super([t]),this.captionTokens=e,this.openParensCount=1}get tokens(){return[...this.captionTokens,...this.currentTokens]}accept(e){if(e instanceof oD&&(this.openParensCount+=1),e instanceof BO&&(this.openParensCount-=1,ze(this.openParensCount>=0,`Unexpected right parenthesis token encountered: '${e}'.`),this.openParensCount===0)){const{startLineNumber:t,startColumn:i}=this.captionTokens[0].range,n=Cn.render(this.captionTokens);this.currentTokens.push(e);const o=Cn.render(this.currentTokens);return{result:"success",wasTokenConsumed:!0,nextParser:new Ub(t,i,n,o)}}return Mle.includes(e.text)?{result:"failure",wasTokenConsumed:!1}:(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}}class qH extends Ts{constructor(e){super([e])}get tokens(){const e=this.markdownLinkParser?.tokens??[];return[...this.currentTokens,...e]}accept(e){if(!this.markdownLinkParser)return e instanceof eu?(this.markdownLinkParser=new Nle(e),{result:"success",nextParser:this,wasTokenConsumed:!0}):{result:"failure",wasTokenConsumed:!1};const t=this.markdownLinkParser.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="success"){const{nextParser:o}=t;if(o instanceof Ub){this.isConsumed=!0;const r=this.currentTokens[0];return{result:i,wasTokenConsumed:n,nextParser:new rNe(r.range.startLineNumber,r.range.startColumn,`${r.text}${o.caption}`,o.reference)}}return this.markdownLinkParser=o,{result:i,wasTokenConsumed:n,nextParser:this}}return this.isConsumed=!0,t}}qH.__decorator=f([bo],qH.prototype,"accept",null);class dNe extends eS{constructor(e,t){ze(t.startsWith("<!--"),`The comment must start with '<!--', got '${t.substring(0,10)}'.`),super(e),this.text=t}get hasEndMarker(){return this.text.endsWith("-->")}toString(){return`md-comment("${this.shortText()}")${this.range}`}}class zH extends Ts{constructor(e){super([e])}accept(e){const t=this.currentTokens[this.currentTokens.length-1];if(e instanceof wh&&t instanceof gg)return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0};if(e instanceof Ro){if(this.currentTokens.push(e),t instanceof wh)return{result:"success",nextParser:this,wasTokenConsumed:!0};if(t instanceof Ro){const i=this.currentTokens[0],n=this.currentTokens[1],o=this.currentTokens[2],r=this.currentTokens[3];return ze(i instanceof gg,`The first token must be a '<', got '${i}'.`),ze(n instanceof wh,`The second token must be a '!', got '${n}'.`),ze(o instanceof Ro,`The third token must be a '-', got '${o}'.`),ze(r instanceof Ro,`The fourth token must be a '-', got '${r}'.`),this.isConsumed=!0,{result:"success",nextParser:new gP([i,n,o,r]),wasTokenConsumed:!0}}}return this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}}}zH.__decorator=f([bo],zH.prototype,"accept",null);class gP extends Ts{constructor(e){super(e)}accept(e){return e instanceof d_&&this.endsWithDashes?(this.currentTokens.push(e),{result:"success",nextParser:this.asMarkdownComment(),wasTokenConsumed:!0}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asMarkdownComment(){return this.isConsumed=!0,new dNe(this.range,Cn.render(this.currentTokens))}get range(){const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1];return new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn)}get endsWithDashes(){return!(!(this.currentTokens[this.currentTokens.length-1]instanceof Ro)||!(this.currentTokens[this.currentTokens.length-2]instanceof Ro))}}gP.__decorator=f([bo],gP.prototype,"accept",null);class s4 extends eS{}class lNe extends wle{toString(){return`text(${this.shortText()})${this.range}`}}class fv extends s4{get text(){return Cn.render(this.tokens)}get dashTokens(){return this.tokens.filter(e=>e instanceof Ro)}constructor(e,t){super(e),this.tokens=t}static fromTokens(e){const t=Cn.fullRange(e);return new fv(t,e)}toString(){return`frontmatter-marker(${this.dashTokens.length}:${this.range})`}}class mx extends s4{constructor(e,t,i,n){super(e),this.startMarker=t,this.content=i,this.endMarker=n}get text(){return[this.startMarker.text,this.content.text,this.endMarker.text].join("")}get contentRange(){return this.content.range}get contentToken(){return this.content}static fromTokens(e,t,i){const n=Cn.fullRange([...e,...i]);return new mx(n,fv.fromTokens(e),new lNe(t),fv.fromTokens(i))}toString(){return`frontmatter("${this.shortText()}")${this.range}`}}class pP extends Ts{constructor(e){const{range:t}=e;ze(t.startLineNumber===1,`Front Matter header must start at the first line, but it starts at line #${t.startLineNumber}.`),ze(t.startColumn===1,`Front Matter header must start at the beginning of the line, but it starts at ${t.startColumn}.`),super([e])}accept(e){const t=this.currentTokens[this.currentTokens.length-1];return e instanceof Ro||e instanceof $o?t instanceof Ro?(this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:this}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):e instanceof no?(this.isConsumed=!0,{result:"success",wasTokenConsumed:!0,nextParser:new fP(fv.fromTokens([...this.currentTokens,e]))}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}static mayStartHeader(e){return e instanceof Ro&&e.range.startLineNumber===1&&e.range.startColumn===1}}pP.__decorator=f([bo],pP.prototype,"accept",null);class fP extends Ts{constructor(e){super([]),this.startMarker=e}get tokens(){const e=this.maybeEndMarker!==void 0?this.maybeEndMarker.tokens:[];return[...this.startMarker.tokens,...this.currentTokens,...e]}asFrontMatterHeader(){return lc(this.maybeEndMarker,"Cannot convert to Front Matter header token without an end marker."),ze(this.maybeEndMarker.dashCount===this.startMarker.dashTokens.length,["Start and end markers must have the same number of dashes",`, got ${this.startMarker.dashTokens.length} / ${this.maybeEndMarker.dashCount}.`].join("")),this.isConsumed=!0,mx.fromTokens(this.startMarker.tokens,this.currentTokens,this.maybeEndMarker.tokens)}accept(e){return this.maybeEndMarker!==void 0?this.acceptEndMarkerToken(e):!(e instanceof Ro)||e.range.startColumn!==1?(this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:this}):(ze(this.maybeEndMarker===void 0,"End marker parser must not be present."),this.maybeEndMarker=new KH(e),{result:"success",wasTokenConsumed:!0,nextParser:this})}acceptEndMarkerToken(e){lc(this.maybeEndMarker,"Partial end marker parser must be initialized.");const t=this.maybeEndMarker.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="success"){const{nextParser:o}=t;if(o instanceof fv===!1)return{result:"success",wasTokenConsumed:n,nextParser:this};const a=o;return a.dashTokens.length!==this.startMarker.dashTokens.length?this.handleEndMarkerParsingFailure(a.tokens,n):(this.isConsumed=!0,{result:"success",wasTokenConsumed:!0,nextParser:mx.fromTokens(this.startMarker.tokens,this.currentTokens,this.maybeEndMarker.tokens)})}if(i==="failure")return this.handleEndMarkerParsingFailure(this.maybeEndMarker.tokens,n);ad(i,`Unexpected result '${i}' while parsing the end marker.`)}handleEndMarkerParsingFailure(e,t){return this.currentTokens.push(...e),delete this.maybeEndMarker,{result:"success",wasTokenConsumed:t,nextParser:this}}}fP.__decorator=f([bo],fP.prototype,"accept",null);class KH extends Ts{constructor(e){const{range:t}=e;ze(t.startColumn===1,`Front Matter header must start at the beginning of the line, but it starts at ${t.startColumn}.`),super([e])}get dashCount(){return this.tokens.filter(e=>e instanceof Ro).length}accept(e){const t=this.currentTokens[this.currentTokens.length-1];return e instanceof Ro||e instanceof $o?t instanceof Ro?(this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:this}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):e instanceof no?(this.isConsumed=!0,this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:fv.fromTokens([...this.currentTokens])}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}}KH.__decorator=f([bo],KH.prototype,"accept",null);class hNe extends xf{constructor(e){super(new Dle(e))}onStreamData(e){if(this.current===void 0&&pP.mayStartHeader(e)){this.current=new pP(e);return}if(this.current===void 0){this._onData.fire(e);return}const t=this.current.accept(e);if(t.result==="success"){const{nextParser:i}=t;i instanceof s4?(this._onData.fire(i),delete this.current):this.current=i}else this.reEmitCurrentTokens();t.wasTokenConsumed||this.onStreamData(e)}onStreamEnd(){try{if(this.current===void 0)return;if(this.current instanceof fP){this._onData.fire(this.current.asFrontMatterHeader()),delete this.current;return}}catch{this.reEmitCurrentTokens()}finally{delete this.current,super.onStreamEnd()}}reEmitCurrentTokens(){if(this.current!==void 0){for(const e of this.current.tokens)this._onData.fire(e);delete this.current}}}class uNe extends xf{constructor(e){super(new hNe(e))}onStreamData(e){if(e instanceof eu&&!this.current){this.current=new Nle(e);return}if(e instanceof gg&&!this.current){this.current=new zH(e);return}if(e instanceof wh&&!this.current){this.current=new qH(e);return}if(!this.current){this._onData.fire(e);return}const t=this.current.accept(e);if(t.result==="success"){const{nextParser:i}=t;i instanceof eS?(this._onData.fire(i),delete this.current):this.current=i}else{for(const i of this.current.tokens)this._onData.fire(i);delete this.current}t.wasTokenConsumed||this.onStreamData(e)}onStreamEnd(){if(this.current){if(this.current instanceof gP){this._onData.fire(this.current.asMarkdownComment()),delete this.current,this.onStreamEnd();return}const{tokens:e}=this.current;for(const t of[...e])this._onData.fire(t);delete this.current}super.onStreamEnd()}}class gNe extends Jw{constructor(e,t){super(e),this.contents=t}get text(){return[Xw.symbol,Zw.symbol,this.contents,Mm.symbol].join("")}toString(){return`${this.text}${this.range}`}}class mP extends Ts{constructor(e){super([e])}accept(e){return e instanceof Zw?(this.currentTokens.push(e),this.isConsumed=!0,{result:"success",nextParser:new vP(this.currentTokens),wasTokenConsumed:!0}):{result:"failure",wasTokenConsumed:!1}}}mP.__decorator=f([bo],mP.prototype,"accept",null);class vP extends Ts{constructor(e){super(e)}accept(e){return e instanceof Mm?(this.currentTokens.push(e),this.isConsumed=!0,{result:"success",nextParser:this.asPromptTemplateVariable(),wasTokenConsumed:!0}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}get contents(){const e=[];if(this.currentTokens.length<3)return"";for(let t=2;t<this.currentTokens.length;t++){const i=this.currentTokens[t],n=t===this.currentTokens.length-1;if(i instanceof Mm&&n===!0)break;e.push(i)}return Cn.render(e)}asPromptTemplateVariable(){const e=this.currentTokens[0],t=this.currentTokens[1],i=this.currentTokens[this.currentTokens.length-1];return ze(this.currentTokens.length>=3,"Prompt template variable should have at least 3 tokens."),ze(i instanceof Mm,'Last token is not a "}".'),ze(e instanceof Xw,'First token must be a "$".'),ze(t instanceof Zw,'Second token must be a "{".'),new gNe(Cn.fullRange(this.currentTokens),this.contents)}}vP.__decorator=f([bo],vP.prototype,"accept",null);class pNe extends xf{constructor(e){super(new uNe(e))}onStreamData(e){if(e instanceof kg&&!this.current){this.current=new dP(e);return}if(e instanceof a_&&!this.current){this.current=new hP(e);return}if(e instanceof nD&&!this.current){this.current=new uP(e);return}if(e instanceof Xw&&!this.current){this.current=new mP(e);return}if(!this.current){this._onData.fire(e);return}const t=this.current.accept(e);switch(t.result){case"success":{const{nextParser:i}=t;i instanceof Jw?(this._onData.fire(i),delete this.current):this.current=i;break}case"failure":{this.reEmitCurrentTokens();break}}t.wasTokenConsumed||this.onStreamData(e)}onStreamEnd(){try{if(this.current===void 0)return;if(this.current instanceof dP){this._onData.fire(this.current.asPromptVariable());return}if(this.current instanceof lP){this._onData.fire(this.current.asPromptVariableWithData());return}if(this.current instanceof hP){this._onData.fire(this.current.asPromptAtMention());return}if(this.current instanceof uP){this._onData.fire(this.current.asPromptSlashCommand());return}if(ze(!(this.current instanceof mP),"Incomplete template variable token."),this.current instanceof vP){this._onData.fire(this.current.asPromptTemplateVariable());return}ad(this.current,`Unknown parser object '${this.current}'`)}catch{this.reEmitCurrentTokens()}finally{delete this.current,super.onStreamEnd()}}reEmitCurrentTokens(){if(this.current!==void 0){for(const e of this.current.tokens)this._onData.fire(e);delete this.current}}}const fNe=Object.freeze({encode:s=>{throw new Error("The `encode` method is not implemented.")},decode:s=>new pNe(s)}),O0="file";class $b extends cP{constructor(e,t){super(e,O0,t),this.path=t}static from(e){return ze(e.name===O0,`Variable name must be '${O0}', got '${e.name}'.`),new $b(e.range,e.data)}get linkRange(){return super.dataRange}}const F0="applyTo";class oZ extends t4{constructor(e,t){super(F0,e,t)}get recordName(){return F0}validate(){if(super.validate(),this.valueToken===void 0)return this.issues;if(this.languageId!==WO)return this.issues.push(new pv(this.range,h(5184,"The '{0}' metadata record is only valid in instruction files.",this.recordName))),delete this.valueToken,this.issues;const{cleanText:e}=this.valueToken;return this.isValidGlob(e)===!1?(this.issues.push(new kp(this.valueToken.range,h(5185,"Invalid glob pattern '{0}'.",e))),delete this.valueToken,this.issues):this.issues}isValidGlob(e){try{const t=qie(e,",");if(t.length===0)return!1;for(const i of t){const n=Um(i);if(o_e(n))return!1}return!0}catch{return!1}}static isApplyToRecord(e){return e instanceof Zp?e.nameToken.text===F0:!1}}class rZ extends Tle{handleToken(e){if(oZ.isApplyToRecord(e)){const t=new oZ(e,this.languageId);return this.issues.push(...t.validate()),this.meta.applyTo=t,!0}return!1}}function mNe(s,e,t){const i=t.value;lc(i,`Method '${e}' is not defined.`);const n=new WeakMap;return t.value=function(...o){let r=n.get(this);r||(r=new ei,n.set(this,r),this._register({dispose:()=>{n.get(this)?.dispose(),n.delete(this)}})),r.get(e)?.dispose(!0);const a=o.length>0?o[o.length-1]:void 0,c=ye.isCancellationToken(a)?a:void 0,d=new ri(c);return r.set(e,d),ye.isCancellationToken(a)?o[o.length-1]=d.token:o.push(d.token),i.call(this,...o)},t}const Ole={allowNonPromptFiles:!1};class _P extends r_{get contents(){return this.getContentsStream("full")}get promptType(){const{languageId:e}=this;return e===FO?na.prompt:e===WO?na.instructions:e===mle?na.mode:"non-prompt"}constructor(e){super(),this.onChangeEmitter=this._register(new M),this.onContentChangedEmitter=this._register(new M),this.onContentChanged=this.onContentChangedEmitter.event,this.options={...Ole,...e}}onContentsChanged(e,t){return(t?.isCancellationRequested?Promise.reject(new $s):this.getContentsStream(e,t)).then(n=>{if(t?.isCancellationRequested||this.isDisposed)throw n.destroy(),new $s;this.onContentChangedEmitter.fire(n)}).catch(n=>{if(n instanceof jw){this.onContentChangedEmitter.fire(n);return}this.onContentChangedEmitter.fire(new e4(this.uri,n))}),this}start(){return ze(!this.isDisposed,"Cannot start contents provider that was already disposed."),this.onContentsChanged("full"),this._register(this.onChangeEmitter.event(this.onContentsChanged,this)),this}}_P.__decorator=f([mNe],_P.prototype,"onContentsChanged",null);const vNe={...Ole,seenReferences:[]};let vx=class extends r_{get tokens(){return[...this.receivedTokens]}get header(){return this.promptHeader}async getBody(){const e=this.header!==void 0?this.header.range.endLineNumber+1:1,i=(await new xle(await this.promptContentsProvider.contents).consumeAll()).filter(({range:n})=>n.startLineNumber>=e);return Cn.render(i)}onSettled(e){const t=this._onSettled.event(e);return(this.stream?.ended&&this.stream.isDisposed===!1||this.errorCondition)&&setTimeout(e.bind(void 0,this.errorCondition)),t}get errorCondition(){return this._errorCondition}get resolveFailed(){if(this.firstParseResult.gotFirstResult)return!!this._errorCondition}async settled(){return ze(this.started,"Cannot wait on the parser that did not start yet."),await this.firstParseResult.promise,this.errorCondition?this:this.isDisposed?this:(lc(this.stream,"No stream reference found."),await this.stream.settled,this.promptHeader&&await this.promptHeader.settled,this)}async allSettled(){return await this.settled(),await Promise.allSettled(this.references.map(e=>e.allSettled())),this}constructor(e,t,i,n,o){super(),this.promptContentsProvider=e,this.instantiationService=i,this.workspaceService=n,this.logService=o,this.receivedTokens=[],this._references=[],this._onUpdate=this._register(new M),this.onUpdate=this._onUpdate.event,this._onSettled=this._register(new M),this.firstParseResult=new _Ne,this.started=!1,this.options={...vNe,...t};const r=[...this.options.seenReferences];if(r.includes(this.uri.path))return r.push(this.uri.path),this._errorCondition=new BH(this.uri,r),this._onUpdate.fire(),this.firstParseResult.end(),this;r.push(this.uri.path),this._register(this.promptContentsProvider.onContentChanged(a=>{this.onContentsChanged(a,r),this.firstParseResult.end()})),this._register(this.promptContentsProvider.onDispose(this.dispose.bind(this)))}onContentsChanged(e,t){if(this.stream?.dispose(),delete this.stream,delete this._errorCondition,this.receivedTokens=[],this.promptHeader?.dispose(),delete this.promptHeader,this.disposeReferences(),e instanceof jw){this._errorCondition=e,this._onUpdate.fire(),this._onSettled.fire(e);return}if(this.stream=fNe.decode(e),this.stream.on("error",this.onStreamEnd.bind(this,this.stream)),this.stream.on("end",this.onStreamEnd.bind(this,this.stream)),this.stream.on("data",i=>{if((i instanceof eS||i instanceof Jw)&&this.receivedTokens.push(i),i instanceof mx)return this.createHeader(i);if(i instanceof cP)try{this.handleLinkToken($b.from(i),[...t])}catch{}i instanceof Ub&&!i.isURL&&this.handleLinkToken(i,[...t])}),this.stream.isDisposed){this.logService.warn(`[prompt parser][${je(this.uri)}] cannot start stream that has been already disposed, aborting`);return}this.stream.start()}createHeader(e){const{languageId:t}=this.promptContentsProvider;t===FO&&(this.promptHeader=new Ale(e,t)),t===WO&&(this.promptHeader=new rZ(e,t)),t===mle&&(this.promptHeader=new JMe(e,t)),this.promptHeader?.start()}handleLinkToken(e,t){const{parentFolder:i}=this,n=i!==null&&iy(e.path)===!1?R.joinPath(i,e.path):R.file(e.path),o=this.promptContentsProvider.createNew({uri:n}),r=this.instantiationService.createInstance(jH,o,e,{seenReferences:t});return this._references.push(r),r.addDisposables(r.onDispose(o.dispose.bind(o)),r.onUpdate(this._onUpdate.fire)),this._onUpdate.fire(),r.start(),this}onStreamEnd(e,t){return e.isDisposed===!0?this:(t&&this.logService.warn(`[prompt parser][${je(this.uri)}] received an error on the chat prompt decoder stream: ${t}`),this._onUpdate.fire(),this._onSettled.fire(t),this)}disposeReferences(){for(const e of[...this._references])e.dispose();this._references.length=0}start(){return this.started?this:(this.started=!0,this.errorCondition?this:(this.promptContentsProvider.start(),this))}get uri(){return this.promptContentsProvider.uri}get parentFolder(){if(this.uri.scheme==="file")return hs(this.uri);const{folders:e}=this.workspaceService.getWorkspace();return e.length===1?e[0].uri:null}get references(){return[...this._references]}get allReferences(){const e=[];for(const t of this.references)e.push(t),t.type==="file"&&e.push(...t.allReferences);return e}get allValidReferences(){return this.allReferences.filter(e=>{const{errorCondition:t}=e;return t?t instanceof _le?!1:t instanceof HC:!0})}get metadata(){const{promptType:e}=this.promptContentsProvider;if(e==="non-prompt")return null;if(this.header===void 0)return{promptType:e};if(this.header instanceof rZ)return{promptType:e,...this.header.metadata};const{tools:t,mode:i,description:n}=this.header.metadata,o=t!==void 0?jt.Agent:i,r={};return n!==void 0&&(r.description=n),t!==void 0&&(r.tools=t),o!==void 0&&(r.mode=o),{promptType:e,...r}}get allToolsMetadata(){let e=!1;const t=[];if(this.metadata?.promptType!==na.prompt)return null;const{tools:i,mode:n}=this.metadata;if(i!==void 0&&(t.push(...i),e=!0),(e===!0||n===jt.Agent)===!1)return null;for(const r of this.references){const{allToolsMetadata:a}=r;a!==null&&(t.push(...a),e=!0)}return e===!1?null:[...new Set(t)]}get errors(){const e=[];for(const t of this.references){const{errorCondition:i}=t;i&&!(i instanceof HC)&&e.push(i)}return e}get allErrors(){const e=[];for(const t of this.references){const{errorCondition:i}=t;i&&!(i instanceof HC)&&e.push({originalError:i,parentUri:this.uri}),e.push(...t.allErrors)}return e}get topError(){if(this.errorCondition)return new JX({errorSubject:"root",errorsCount:1,originalError:this.errorCondition});const e=[...this.errors],t=[];for(const d of this.references)t.push(...d.allErrors);if(e.length===0&&t.length===0)return;const i=e[0],n=t[0],o=i!==void 0,r=o?{originalError:i,parentUri:this.uri}:n,a=e.length+t.length,c=o?"child":"indirect-child";return new JX({errorSubject:c,originalError:r.originalError,parentUri:r.parentUri,errorsCount:a})}sameUri(e){return this.uri.toString()===e.toString()}get isPromptFile(){return fle(this.uri)}toString(){return`prompt:${this.uri.path}`}dispose(){this.isDisposed||(this.disposeReferences(),this.stream?.dispose(),delete this.stream,this.promptHeader?.dispose(),delete this.promptHeader,super.dispose())}};vx=f([p(2,J),p(3,Tt),p(4,Pe)],vx);let jH=class extends r_{constructor(e,t,i,n){super(),this.promptContentsProvider=e,this.token=t,this.parser=this._register(n.createInstance(vx,this.promptContentsProvider,i))}get linkRange(){if(this.token instanceof $b)return this.token.dataRange;if(this.token instanceof Ub)return this.token.linkRange}get type(){if(this.token instanceof $b||this.token instanceof Ub)return"file";ad(this.token,`Unknown token type '${this.token}'.`)}get subtype(){if(this.token instanceof $b)return"prompt";if(this.token instanceof Ub)return"markdown";ad(this.token,`Unknown token type '${this.token}'.`)}start(){return this.parser.start(),this}onUpdate(...e){return this.parser.onUpdate(...e)}get range(){return this.token.range}get path(){return this.token.path}get text(){return this.token.text}get resolveFailed(){return this.parser.resolveFailed}get errorCondition(){return this.parser.errorCondition}get topError(){return this.parser.topError}get uri(){return this.parser.uri}get isPromptFile(){return this.parser.isPromptFile}get errors(){return this.parser.errors}get allErrors(){return this.parser.allErrors}get references(){return this.parser.references}get allReferences(){return this.parser.allReferences}get metadata(){return this.parser.metadata}get allToolsMetadata(){return this.parser.allToolsMetadata}get allValidReferences(){return this.parser.allValidReferences}async settled(){return await this.parser.settled(),this}async allSettled(){return await this.parser.allSettled(),this}toString(){return`prompt-reference/${this.type}:${this.subtype}/${this.token}`}};jH=f([p(3,J)],jH);class _Ne extends Zo{constructor(){super(...arguments),this._gotResult=!1}get gotFirstResult(){return this._gotResult}get promise(){return this.p}end(){this._gotResult=!0,super.complete(void 0).catch(()=>{})}}var YH;let _x=YH=class extends _P{get sourceName(){return"file"}get languageId(){const e=this.modelService.getModel(this.uri);if(e!==null)return e.getLanguageId();const t=this.languageService.guessLanguageIdByFilepathOrFirstLine(this.uri);return t!==null?t:FO}constructor(e,t,i,n,o){super(t),this.uri=e,this.fileService=i,this.modelService=n,this.languageService=o,this._register(this.fileService.onDidFilesChange(r=>{if(r.contains(this.uri,mh.ADDED,mh.UPDATED)){this.onChangeEmitter.fire("full");return}if(r.contains(this.uri,mh.DELETED)){this.onChangeEmitter.fire(r);return}}))}async getContentsStream(e,t){ze(!t?.isCancellationRequested,new $s);let i;try{const n=await this.fileService.resolve(this.uri);ze(!t?.isCancellationRequested,new $s),ze(n.isFile,new _le(this.uri));const{allowNonPromptFiles:o}=this.options;if(o!==!0&&fle(this.uri)===!1)throw new HC(this.uri);if(i=await this.fileService.readFileStream(this.uri),this.isDisposed||t?.isCancellationRequested)throw i.value.destroy(),new $s;return i.value}catch(n){throw n instanceof jw||n instanceof $s?n:new vle(this.uri,n)}}createNew(e,t={}){return new YH(e.uri,t,this.fileService,this.modelService,this.languageService)}toString(){return`file-prompt-contents-provider:${this.uri.path}`}};_x=YH=f([p(2,Xe),p(3,ai),p(4,fi)],_x);function bNe(s,e){return new rD(yNe(s),e)}const yNe=s=>function*(){const e=s.getLineCount();let t=1;for(;t<=e;){if(s.isDisposed())return;yield Re.fromString(s.getLineContent(t)),t!==e&&(yield Re.fromString(s.getEOL())),t++}}();var QH;let XH=QH=class extends _P{get uri(){return this.model.uri}get sourceName(){return"text-model"}get languageId(){return this.model.getLanguageId()}constructor(e,t,i){super(t),this.model=e,this.instantiationService=i,this._register(this.model.onWillDispose(this.dispose.bind(this))),this._register(this.model.onDidChangeContent(this.onChangeEmitter.fire.bind(this.onChangeEmitter)))}async getContentsStream(e,t){return bNe(this.model,t)}createNew(e,t={}){return e instanceof ty?this.instantiationService.createInstance(QH,e,t):this.instantiationService.createInstance(_x,e.uri,t)}toString(){return`text-model-prompt-contents-provider:${this.uri.path}`}};XH=QH=f([p(2,J)],XH);const wNe=(s,e,t,i)=>{if(BMe(s)){const n=t.getModel(s);return lc(n,`Cannot find model of untitled document '${s.path}'.`),i.createInstance(XH,n,e)}return i.createInstance(_x,s,e)};let ZH=class extends vx{constructor(e,t,i,n,o,r){const a=wNe(e,t,n,o);super(a,t,o,r,i),this.contentsProvider=this._register(a)}toString(){const{sourceName:e}=this.contentsProvider;return`prompt-parser:${e}:${this.uri.path}`}};ZH=f([p(2,Pe),p(3,ai),p(4,J),p(5,Tt)],ZH);let JH=class extends r_{get reference(){return this._reference}get references(){const{reference:e}=this,{errorCondition:t}=e;return t?[]:[...e.allValidReferences.map(xq("uri")),e.uri]}get toolsMetadata(){return this.reference.allToolsMetadata}get allSettled(){return this.reference.allSettled()}get topError(){return this.reference.topError}constructor(e,t){super(),this.uri=e,this.instantiationService=t,this._onUpdate=this._register(new M),this.onUpdate=this._onUpdate.event,this._reference=this._register(this.instantiationService.createInstance(ZH,this.uri,{allowNonPromptFiles:!0})),this._register(this._reference.onUpdate(this._onUpdate.fire.bind(this._onUpdate)))}resolve(){return this._reference.start(),this}};JH=f([p(1,J)],JH);var eU;(function(s){s.KEY=L0,s.PROMPT_LOCATIONS_KEY=ule,s.INSTRUCTIONS_LOCATION_KEY=gle,s.MODE_LOCATION_KEY=ple,s.enabled=e=>{const t=e.getValue(L0);return aZ(t)??!1},s.enabledCtx=x.equals(`config.${L0}`,!0),s.getLocationsValue=(e,t)=>{const i=WMe(t),n=e.getValue(i);if(!(n==null||Array.isArray(n))&&typeof n=="object"){const o={};for(const[r,a]of Object.entries(n)){const c=r.trim(),d=aZ(a);d!==void 0&&c&&(o[c]=d)}return o}},s.promptSourceFolders=(e,t)=>{const i=s.getLocationsValue(e,t),n=FMe(t);if(i&&typeof i=="object"){const o=[];i[n]!==!1&&o.push(n);for(const[r,a]of Object.entries(i))a===!1||r===n||o.push(r);return o}return[]}})(eU||(eU={}));const aZ=s=>{if(typeof s=="boolean")return s;if(typeof s=="string"){const e=s.trim().toLowerCase();return e==="true"?!0:e==="false"?!1:void 0}},SNe="vscode.prompt.instructions",CNe=(s,e)=>{let t=SNe;return e&&(t+=".root"),`${t}__${s}`},dp=(s,e)=>{const{uri:t,isPromptFile:i}=s;let n=`${t}`;i&&(n=CNe(t,e));const o=i?`prompt:${je(t)}`:`file:${je(t)}`;return{id:n,name:o,value:t,kind:"file",modelDescription:i?"Prompt instructions file":"File attachment",isRoot:e}};let tU=class extends F{get references(){const e=[];for(const t of this.attachments.values())e.push(...t.references);return e}get toolsMetadata(){const e=[];for(const t of this.attachments.values()){const{toolsMetadata:i}=t;i!==null&&e.push(...i)}return[...new Set(e)]}get chatAttachments(){const e=[],t=[...this.attachments.values()];for(const i of t){const{reference:n}=i;e.push(...n.allValidReferences.map(o=>dp(o,!1))),e.push(dp({uri:n.uri,isPromptFile:!0},!0))}return e}async allSettled(){const e=[...this.attachments.values()];return await Promise.allSettled(e.map(t=>t.allSettled)),this}constructor(e,t){super(),this.instantiationService=e,this.configService=t,this._onUpdate=this._register(new M),this.onUpdate=this._onUpdate.event,this._onAdd=this._register(new M),this.onAdd=this._onAdd.event,this._onRemove=this._register(new M),this.onRemove=this._onRemove.event,this.attachments=this._register(new ei)}add(e){const t=Array.isArray(e)?e:[e];if(t.length!==0)for(const i of t){if(this.attachments.has(i.path))continue;const n=this.instantiationService.createInstance(JH,i);n.addDisposables(n.onDispose(()=>{this.attachments.deleteAndLeak(i.path),this._onUpdate.fire(),this._onRemove.fire(n)}),n.onUpdate(this._onUpdate.fire)),this.attachments.set(i.path,n),this._onAdd.fire(n),this._onUpdate.fire()}}remove(e){return this.attachments.has(e.path)?(this.attachments.deleteAndDispose(e.path),this):this}get featureEnabled(){return eU.enabled(this.configService)}clear(){for(const e of this.attachments.values())this.remove(e.uri);return this._onUpdate.fire(),this}};tU=f([p(0,J),p(1,ne)],tU);let iU=class extends YF{constructor(e,t,i,n,o){super(i,t,n,o,e)}dispose(){this.textEditorModelHandle&&this.modelService.destroyModel(this.textEditorModelHandle),super.dispose()}};iU=f([p(1,fi),p(2,ai),p(3,Hse),p(4,Tr)],iU);var Jk;let Zd=class extends BR{constructor(e,t,i,n,o,r,a,c,d){super(e,t,o,r,a,c,d),this.editorService=i,this.textFileService=n}save(e,t){return this.resource.scheme!==ae.untitled&&!this.fileService.hasProvider(this.resource)?this.saveAs(e,t):this.doSave(t,!1,e)}saveAs(e,t){return this.doSave(t,!0,e)}async doSave(e,t,i){let n;if(t?n=await this.textFileService.saveAs(this.resource,void 0,{...e,suggestedTarget:this.preferredResource}):n=await this.textFileService.save(this.resource,e),!!n)return{resource:n}}async revert(e,t){await this.textFileService.revert(this.resource,t)}};Zd=f([p(2,de),p(3,Ds),p(4,di),p(5,Xe),p(6,Ns),p(7,Xo),p(8,wg)],Zd);let cZ=class extends Zd{static{Jk=this}static{this.ID="workbench.editors.resourceEditorInput"}get typeId(){return Jk.ID}get editorId(){return od.id}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(e,void 0,c,a,l,d,u,g,m),this.name=t,this.description=i,this.preferredLanguageId=n,this.preferredContents=o,this.textModelService=r,this.cachedModel=void 0,this.modelReference=void 0}getName(){return this.name||super.getName()}setName(e){this.name!==e&&(this.name=e,this._onDidChangeLabel.fire())}getDescription(){return this.description}setDescription(e){this.description!==e&&(this.description=e,this._onDidChangeLabel.fire())}setLanguageId(e,t){this.setPreferredLanguageId(e),this.cachedModel?.setLanguageId(e,t)}setPreferredLanguageId(e){this.preferredLanguageId=e}setPreferredContents(e){this.preferredContents=e}async resolve(){const e=this.preferredContents,t=this.preferredLanguageId;this.preferredContents=void 0,this.preferredLanguageId=void 0,this.modelReference||(this.modelReference=this.textModelService.createModelReference(this.resource));const i=await this.modelReference,n=i.object;if(!(n instanceof iU))throw i.dispose(),this.modelReference=void 0,new Error(`Unexpected model for TextResourceEditorInput: ${this.resource}`);return this.cachedModel=n,(typeof e=="string"||typeof t=="string")&&n.updateTextEditorModel(typeof e=="string"?vne(e):void 0,t),n}matches(e){return this===e?!0:e instanceof Jk?Dt(e.resource,this.resource):eh(e)?super.matches(e):!1}dispose(){this.modelReference&&(this.modelReference.then(e=>e.dispose()),this.modelReference=void 0),this.cachedModel=void 0,super.dispose()}};cZ=Jk=f([p(5,yi),p(6,Ds),p(7,de),p(8,Xe),p(9,di),p(10,Ns),p(11,Xo),p(12,wg)],cZ);var eT;let nU=class extends Zd{static{eT=this}static{this.ID="workbench.editors.untitledEditorInput"}get typeId(){return eT.ID}get editorId(){return od.id}constructor(e,t,i,n,o,r,a,c,d,l,u){super(e.resource,void 0,n,t,i,o,c,l,u),this.model=e,this.environmentService=r,this.pathService=a,this.textModelService=d,this.modelResolve=void 0,this.modelDisposables=this._register(new U),this.cachedUntitledTextEditorModelReference=void 0,this.registerModelListeners(e),this._register(this.textFileService.untitled.onDidCreate(g=>this.onDidCreateUntitledModel(g)))}registerModelListeners(e){this.modelDisposables.clear(),this.modelDisposables.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this.modelDisposables.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire())),this.modelDisposables.add(e.onDidRevert(()=>this.dispose()))}onDidCreateUntitledModel(e){Dt(e.resource,this.model.resource)&&e!==this.model&&(this.model=e,this.registerModelListeners(e))}getName(){return this.model.name}getDescription(e=Nt.MEDIUM){if(!this.model.hasAssociatedFilePath){const t=this.resource.path;return t!==this.getName()?t:void 0}return super.getDescription(e)}getTitle(e){if(!this.model.hasAssociatedFilePath){const t=this.getName(),i=this.getDescription();return i&&i!==t?`${t} • ${i}`:t}return super.getTitle(e)}isDirty(){return this.model.isDirty()}getEncoding(){return this.model.getEncoding()}setEncoding(e,t){return this.model.setEncoding(e)}get hasLanguageSetExplicitly(){return this.model.hasLanguageSetExplicitly}get hasAssociatedFilePath(){return this.model.hasAssociatedFilePath}setLanguageId(e,t){this.model.setLanguageId(e,t)}getLanguageId(){return this.model.getLanguageId()}async resolve(){return this.modelResolve||(this.modelResolve=(async()=>{this.cachedUntitledTextEditorModelReference=await this.textModelService.createModelReference(this.resource)})()),await this.modelResolve,this.isDisposed()&&this.disposeModelReference(),this.model}toUntyped(e){const t={resource:this.model.hasAssociatedFilePath?Iq(this.model.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):this.resource,forceUntitled:!0,options:{override:this.editorId}};return typeof e?.preserveViewState=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=this.model.isModified()?this.model.textEditorModel?.getValue():void 0,t.options.viewState=Pb(this,e.preserveViewState,this.editorService),typeof t.contents=="string"&&!this.model.hasAssociatedFilePath&&!e.preserveResource&&(t.resource=void 0)),t}matches(e){return this===e?!0:e instanceof eT?Dt(e.resource,this.resource):Kse(e)?super.matches(e):!1}dispose(){this.modelResolve=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){Qe(this.cachedUntitledTextEditorModelReference),this.cachedUntitledTextEditorModelReference=void 0}};nU=eT=f([p(1,Ds),p(2,di),p(3,de),p(4,Xe),p(5,mn),p(6,_c),p(7,Ns),p(8,yi),p(9,Xo),p(10,wg)],nU);const ENe=["text/plain","text/html","application/vnd.code.notebook.error","application/vnd.code.notebook.stdout","application/x.notebook.stdout","application/x.notebook.stream","application/vnd.code.notebook.stderr","application/x.notebook.stderr","image/png","image/jpeg","image/svg"];function xNe(s,e,t){const i=s.cellViewModel.handle,n=t.textModel,o=t.getCellByHandle(i);if(!o||o.outputsViewModels.length===0||!n)return;const r=n.uri,a=o.uri,c=n.cells.indexOf(o.model),d=s?.model.outputId;let l=0;d!==void 0&&(l=o.outputsViewModels.findIndex(v=>v.model.outputId===d));const u=fl.generateCellOutputUriWithIndex(r,a,l),g=$T(el(r));return{value:u,id:u.toString(),name:h(8174,"{0} • Cell {1} • Output {2}",g,`${c+1}`,`${l+1}`),icon:e==="application/vnd.code.notebook.error"?Te.fromId("error"):void 0,kind:"notebookOutput",outputIndex:l,mimeType:e}}new O("userHasOpenedNotebook",!1);new O("notebookFindWidgetFocused",!1);new O("interactiveWindowOpen",!1);new O("mostRecentReplEditor",void 0);x.equals("activeEditor",boe);x.equals("activeEditor",QCe);x.equals("activeEditor",XCe);new O("isCompositeNotebook",!1);const INe=new O("notebookEditorFocused",!1);new O("notebookCellListFocused",!1);new O("notebookOutputFocused",!1);new O("notebookOutputInputFocused",!1);const DNe=new O("notebookEditable",!0);new O("notebookHasRunningCell",!1);new O("notebookHasSomethingRunning",!1);new O("notebookUseConsolidatedOutputButton",!1);new O("notebookCellToolbarLocation","left");new O("notebookCursorNavigationMode",!1);new O("notebookLastCellFailed",!1);new O("notebookType",void 0);new O("notebookCellType",void 0);new O("notebookCellEditable",!1);new O("notebookCellFocused",!1);new O("notebookCellEditorFocused",!1);new O("notebookCellMarkdownEditMode",!1);new O("notebookCellLineNumbers","inherit");new O("notebookCellExecutionState",void 0);new O("notebookCellExecuting",!1);const o4=new O("notebookCellHasOutputs",!1);new O("notebookCellIsFirstOutput",!1);const kNe=new O("hasHiddenOutputs",!1);new O("notebookCellOutputMimeType",void 0);new O("notebookCellInputIsCollapsed",!1);new O("notebookCellOutputIsCollapsed",!1);new O("notebookCellResource","");new O("notebookCellGenerateByChat",!1);new O("notebookCellHasErrorDiagnostics",!1);new O("notebookCellOutputMimeTypeListForChat",[]);new O("notebookKernel",void 0);const TNe=new O("notebookKernelCount",0),ANe=new O("notebookKernelSourceCount",0);new O("notebookKernelSelected",!1);new O("notebookInterruptibleKernel",!1);new O("notebookMissingKernelExtension",!1);new O("notebookHasOutputs",!1);new O("kernelHasVariableProvider",!1);const HO=I(8310,"Notebook");W.EditorContrib;W.WorkbenchContrib+1;var dZ;(function(s){s[s.RunSection=0]="RunSection",s[s.EditCell=1]="EditCell",s[s.ExecuteAboveCells=2]="ExecuteAboveCells",s[s.ExecuteCellAndBelow=3]="ExecuteCellAndBelow",s[s.SaveCell=4]="SaveCell",s[s.SplitCell=5]="SplitCell",s[s.ClearCellOutput=6]="ClearCellOutput"})(dZ||(dZ={}));var bx;(function(s){s.Copy="1_copy",s.Insert="2_insert",s.Edit="3_edit",s.Share="4_share"})(bx||(bx={}));x.or(x.greater(TNe.key,0),x.greater(ANe.key,0));ge.appendMenuItem(N.NotebookCellTitle,{submenu:N.NotebookCellInsert,title:h(8311,"Insert Cell"),group:bx.Insert,when:DNe.isEqualTo(!0)});ge.appendMenuItem(N.EditorContext,{submenu:N.NotebookCellTitle,title:h(8312,"Notebook Cell"),group:bx.Insert,when:INe});ge.appendMenuItem(N.NotebookCellTitle,{title:h(8313,"Share"),submenu:N.EditorContextShare,group:bx.Share});Ae("notebook-kernel-select",j.serverEnvironment,h(8587,"Configure icon to select a kernel in notebook editors."));Ae("notebook-execute",j.play,h(8588,"Icon to execute in notebook editors."));Ae("notebook-execute-above",j.runAbove,h(8589,"Icon to execute above cells in notebook editors."));Ae("notebook-execute-below",j.runBelow,h(8590,"Icon to execute below cells in notebook editors."));Ae("notebook-stop",j.primitiveSquare,h(8591,"Icon to stop an execution in notebook editors."));Ae("notebook-delete-cell",j.trash,h(8592,"Icon to delete a cell in notebook editors."));Ae("notebook-execute-all",j.runAll,h(8593,"Icon to execute all cells in notebook editors."));Ae("notebook-edit",j.pencil,h(8594,"Icon to edit a cell in notebook editors."));Ae("notebook-stop-edit",j.check,h(8595,"Icon to stop editing a cell in notebook editors."));Ae("notebook-move-up",j.arrowUp,h(8596,"Icon to move up a cell in notebook editors."));Ae("notebook-move-down",j.arrowDown,h(8597,"Icon to move down a cell in notebook editors."));Ae("notebook-clear",j.clearAll,h(8598,"Icon to clear cell outputs in notebook editors."));Ae("notebook-split-cell",j.splitVertical,h(8599,"Icon to split a cell in notebook editors."));Ae("notebook-state-success",j.check,h(8600,"Icon to indicate a success state in notebook editors."));Ae("notebook-state-error",j.error,h(8601,"Icon to indicate an error state in notebook editors."));Ae("notebook-state-pending",j.clock,h(8602,"Icon to indicate a pending state in notebook editors."));Ae("notebook-state-executing",j.sync,h(8603,"Icon to indicate an executing state in notebook editors."));Ae("notebook-collapsed",j.chevronRight,h(8604,"Icon to annotate a collapsed section in notebook editors."));Ae("notebook-expanded",j.chevronDown,h(8605,"Icon to annotate an expanded section in notebook editors."));Ae("notebook-open-as-text",j.fileCode,h(8606,"Icon to open the notebook in a text editor."));Ae("notebook-revert",j.discard,h(8607,"Icon to revert in notebook editors."));Ae("notebook-diff-cell-toggle-whitespace",j.whitespace,h(8608,"Icon for the toggle whitespace action in the diff editor."));Ae("notebook-render-output",j.preview,h(8609,"Icon to render output in diff editor."));Ae("notebook-mimetype",j.code,h(8610,"Icon for a mime type in notebook editors."));const Fle=Ae("notebook-copy",j.copy,h(8611,"Icon to copy content to clipboard"));Ae("notebook-diff-editor-previous-change",j.arrowUp,h(8612,"Icon for the previous change action in the diff editor."));Ae("notebook-diff-editor-next-change",j.arrowDown,h(8613,"Icon for the next change action in the diff editor."));Ae("variables-view-icon",j.variableGroup,h(8614,"View icon of the variables view."));function RNe(s){let e="";const t=s.cellViewModel;let i=t.outputsViewModels.indexOf(s),n=0;for(;i<t.model.outputs.length;){const r=t.model.outputs[i].outputs.find(a=>az(a.mime));if(!r)break;e=e+Wle.decode(r.data.buffer),i=i+1,n++}return{text:e.trim(),count:n}}const Wle=new TextDecoder;function PNe(s,e,t=!1){let i=`${s}`;const n=1e5;if(i=Wle.decode(e.data.slice(0,n).buffer),e.data.byteLength>n)i=i+"...(truncated)";else if(s==="application/vnd.code.notebook.error"){i=i.replace(/\\u001b\[[0-9;]*m/gi,"");try{const o=JSON.parse(i);!o.stack||t?i=`${o.name}: ${o.message}`:i=o.stack}catch{}}return i.trim()}async function LNe(s,e,t,i){const n=e.model,o=s&&lZ.includes(s)?n.outputs.find(a=>a.mime===s):n.outputs.find(a=>lZ.includes(a.mime));if(s=o?.mime,!s||!o)return;const r=az(s)?RNe(e).text:PNe(s,o);try{await t.writeText(r)}catch(a){i.error(`Failed to copy content: ${a}`)}}const lZ=["text/latex","text/html","application/vnd.code.notebook.error","application/vnd.code.notebook.stdout","application/x.notebook.stdout","application/x.notebook.stream","application/vnd.code.notebook.stderr","application/x.notebook.stderr","text/plain","text/markdown","application/json"],MNe="notebook.cellOutput.copy";K(class extends X{constructor(){super({id:"notebook.cellOuput.showEmptyOutputs",title:h(8270,"Show Empty Outputs"),menu:{id:N.NotebookOutputToolbar,when:x.and(o4,kNe)},f1:!1,category:HO})}run(e,t){const i=t.cell;if(i&&i.cellKind===gp.Code)for(let n=1;n<i.outputsViewModels.length;n++)i.outputsViewModels[n].visible.get()||(i.outputsViewModels[n].setVisible(!0,!0),i.updateOutputHeight(n,1,"command"))}});K(class extends X{constructor(){super({id:MNe,title:h(8271,"Copy Cell Output"),menu:{id:N.NotebookOutputToolbar,when:o4},category:HO,icon:Fle})}getNoteboookEditor(e,t){return t&&"notebookEditor"in t?t.notebookEditor:dl(e.activeEditorPane)}async run(e,t){const i=this.getNoteboookEditor(e.get(de),t);if(!i)return;let n;if(t&&"outputId"in t&&typeof t.outputId=="string"?n=UO(t.outputId,i):t&&"outputViewModel"in t&&(n=t.outputViewModel),!n){const r=i.getActiveCell();if(!r)return;r.focusedOutputId!==void 0?n=r.outputsViewModels.find(a=>a.model.outputId===r.focusedOutputId):n=r.outputsViewModels.find(a=>a.pickedMimeType?.isTrusted)}if(!n)return;const o=n.pickedMimeType?.mimeType;if(o?.startsWith("image/")){const r={skipReveal:!0,outputId:n.model.outputId,altOutputId:n.model.alternativeOutputId};await i.focusNotebookCell(n.cellViewModel,"output",r),i.copyOutputImage(n)}else{const r=e.get(Is),a=e.get(Pe);LNe(o,n,r,a)}}});function UO(s,e){const t=e.getViewModel();if(t){const i=t.viewCells.filter(n=>n.cellKind===gp.Code);for(const n of i){const o=n.outputsViewModels.find(r=>r.model.outputId===s||r.model.alternativeOutputId===s);if(o)return o}}}const NNe="notebook.cellOutput.openInTextEditor";K(class extends X{constructor(){super({id:NNe,title:h(8272,"Open Cell Output in Text Editor"),f1:!1,category:HO,icon:Fle})}getNoteboookEditor(e,t){return t&&"notebookEditor"in t?t.notebookEditor:dl(e.activeEditorPane)}async run(e,t){const i=this.getNoteboookEditor(e.get(de),t),n=e.get(xI);if(!i)return;let o;t&&"outputId"in t&&typeof t.outputId=="string"?o=UO(t.outputId,i):t&&"outputViewModel"in t&&(o=t.outputViewModel);const r=e.get(hi);if(o?.model.outputId&&i.textModel?.uri){const a=await n.resolve(i.textModel.uri);await r.open(fl.generateCellOutputUriWithId(i.textModel.uri,o.model.outputId)),a.dispose()}}});const ONe="notebook.cellOutput.openInOutputPreview";K(class extends X{constructor(){super({id:ONe,title:h(8273,"Open in Output Preview"),menu:{id:N.NotebookOutputToolbar,when:x.and(o4,x.equals("config.notebook.output.openInPreviewEditor.enabled",!0))},f1:!1,category:HO})}getNotebookEditor(e,t){return t&&"notebookEditor"in t?t.notebookEditor:dl(e.activeEditorPane)}async run(e,t){const i=this.getNotebookEditor(e.get(de),t);if(!i)return;let n;if(t&&"outputId"in t&&typeof t.outputId=="string"?n=UO(t.outputId,i):t&&"outputViewModel"in t&&(n=t.outputViewModel),!n)return;const o=n.cellViewModel;if(!o)return;const r=i.getCellByHandle(o.handle);if(!r)return;const a=i.getCellIndex(r);if(a===void 0)return;const c=o.outputsViewModels.indexOf(n);if(c===-1||!i.textModel)return;const d=fl.generateOutputEditorUri(i.textModel.uri,r.id,a,n.model.outputId,c);e.get(hi).open(d,{openToSide:!0})}});async function hZ(s,e,t,i,n,o){if(Kse(s))return await FNe(s,t,i);if(!s.resource)return;let r;try{r=await e.stat(s.resource)}catch{return}if(!r.isDirectory&&!r.isFile)return;const a=await oU(e,o,s.resource);return a?n.extensions.some(c=>yE(c,"chatReferenceBinaryData"))?a:void 0:await sU(s.resource,r.isDirectory,i)}async function FNe(s,e,t){if(s.resource)return await sU(s.resource,!1,t);const i=e.editors.filter(n=>n instanceof nU);for(const n of i)if((await n.resolve()).textEditorModel?.getValue()===s.contents)return await sU(n.resource,!1,t)}async function sU(s,e,t){let i=Yo.NotOmitted;if(!e){try{(await t.createModelReference(s)).dispose()}catch{i=Yo.Full}/\.(svg)$/i.test(s.path)&&(i=Yo.Full)}return{kind:e?"directory":"file",value:s,id:s.toString(),name:je(s),omittedState:i}}const WNe=new RegExp(`\\.(${Object.keys(EK).join("|")})$`,"i");function BNe(s){const e=s[1].toLowerCase();return EK[e]}async function oU(s,e,t,i,n){if(!t)return;if(n){if(!aTe(n))return}else{const d=WNe.exec(t.path);if(!d)return;n=BNe(d)}const o=je(t);let r;if(i)r=i;else{let d;try{d=await s.stat(t)}catch{return}const l=await s.readFile(t);if(d.size>30*1024*1024)throw e.error(h(4642,"Image is too large"),h(4643,"The image {0} is too large to be attached.",o)),new Error("Image is too large");r=l.value}const a=/\.gif$/i.test(t.path);return(await Ble([{id:t.toString(),name:o,data:r.buffer,icon:j.fileMedia,resource:t,mimeType:n,omittedState:a?Yo.Partial:Yo.NotOmitted}]))[0]}async function Ble(s){return Promise.all(s.map(async e=>({id:e.id||await ZRe(e.data),name:e.name,fullName:e.resource?e.resource.path:void 0,value:await LK(e.data,e.mimeType),icon:e.icon,kind:"image",isFile:!1,isDirectory:!1,omittedState:e.omittedState||Yo.NotOmitted,references:e.resource?[{reference:e.resource,kind:"reference"}]:[]})))}function VNe(s){return s.map(e=>{let t;return"severity"in e?t=JE.fromMarker(e):t={filterUri:R.revive(e.uri),filterSeverity:Mn.Warning},JE.toEntry(t)})}function HNe(s){return s.map(e=>{const t=R.file(e.fsPath);return{kind:"symbol",id:UNe(t,e.range),value:{uri:t,range:e.range},symbolKind:e.kind,icon:_ne.toIcon(e.kind),fullName:e.name,name:e.name}})}function UNe(s,e){let t="";return e&&(t=`:${e.startLineNumber}`,e.startLineNumber!==e.endLineNumber&&(t+=`-${e.endLineNumber}`)),s.fsPath+t}function $Ne(s,e){const t=dl(e.activeEditorPane);if(!t)return[];const i=UO(s.outputId,t);if(!i)return[];const n=i.pickedMimeType?.mimeType;if(n&&ENe.includes(n)){const o=xNe(i,n,t);return o?[o]:[]}return[]}let rU=class extends F{constructor(e,t,i,n){super(),this.fileService=t,this.dialogService=i,this.webContentExtractorService=n,this._attachments=new Map,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.promptInstructions=this._register(e.createInstance(tU))}get attachments(){return Array.from(this._attachments.values())}get size(){return this._attachments.size}get fileAttachments(){return this.attachments.filter(e=>e.kind==="file"&&R.isUri(e.value)).map(e=>e.value)}getAttachmentIDs(){return new Set(this._attachments.keys())}async addFile(e,t){if(/\.(png|jpe?g|gif|bmp|webp)$/i.test(e.path)){const i=await this.asImageVariableEntry(e);i&&this.addContext(i);return}else this.addContext(this.asFileVariableEntry(e,t))}addFolder(e){this.addContext({kind:"directory",value:e,id:e.toString(),name:je(e)})}clear(e=!1){const t=Array.from(this._attachments.keys());this._attachments.clear(),e&&this.promptInstructions.clear(),this._onDidChange.fire({deleted:t,added:[],updated:[]})}addContext(...e){e=e.filter(t=>!this._attachments.has(t.id)),this.updateContext(dn.empty(),e)}clearAndSetContext(...e){this.updateContext(Array.from(this._attachments.keys()),e)}delete(...e){this.updateContext(e,dn.empty())}updateContext(e,t){const i=[],n=[],o=[];for(const r of e)this._attachments.delete(r)&&i.push(r);for(const r of t){if(r.kind==="promptFile"){this.promptInstructions.add(r.value);continue}const a=this._attachments.get(r.id);a?ma(a,r)||(this._attachments.set(r.id,r),o.push(r)):(this._attachments.set(r.id,r),n.push(r))}(i.length>0||n.length>0||o.length>0)&&this._onDidChange.fire({deleted:i,added:n,updated:o})}asFileVariableEntry(e,t){return{kind:"file",value:t?{uri:e,range:t}:e,id:e.toString()+(t?.toString()??""),name:je(e)}}async asImageVariableEntry(e){if(e.scheme===ae.file&&await this.fileService.canHandleResource(e))return await oU(this.fileService,this.dialogService,e);if(e.scheme===ae.http||e.scheme===ae.https){const t=await this.webContentExtractorService.readImage(e,ye.None);if(t)return await oU(this.fileService,this.dialogService,e,t)}}};rU=f([p(0,J),p(1,Xe),p(2,Qt),p(3,jN)],rU);const r4="revealInExplorer",$O="workbench.action.files.revert",Vle="explorer.openToSide",Hle="explorer.openWith",Ule="selectForCompare",$le="compareSelected",Gle="compareFiles",a4="workbench.files.action.compareWithSaved",cD="copyFilePath",dD="copyRelativeFilePath",c4="workbench.action.files.saveAs",qle=I(7126,"Save As..."),GO="workbench.action.files.save",zle=I(7127,"Save"),Kle="workbench.action.files.saveWithoutFormatting",GNe=I(7128,"Save without Formatting"),d4="saveAll",qNe=I(7129,"Save All"),qO="workbench.files.action.saveAllInGroup",jle="workbench.action.files.saveFiles",h_=new O("groupFocusedInOpenEditors",!1),zO=new O("dirtyEditorFocusedInOpenEditors",!1),l4=new O("readonlyEditorFocusedInOpenEditors",!1),Yle=new O("openEditorsSelectedFileOrUntitled",!0),h4=new O("resourceSelectedForCompare",!1),Qle="removeRootFolder",zNe=h(7130,"Remove Folder from Workspace"),KNe="previousCompressedFolder",jNe="nextCompressedFolder",YNe="firstCompressedFolder",QNe="lastCompressedFolder",tS="workbench.action.files.newUntitledFile",Xle=I(7131,"New Untitled Text File"),XNe="workbench.action.files.newFile",ZNe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Du;(function(s){s[s.NO_ACTION=0]="NO_ACTION",s[s.CLOSE_PICKER=1]="CLOSE_PICKER",s[s.REFRESH_PICKER=2]="REFRESH_PICKER",s[s.REMOVE_ITEM=3]="REMOVE_ITEM"})(Du||(Du={}));function W0(s){const e=s;return Array.isArray(e.items)}function uZ(s){const e=s;return!!e.picks&&e.additionalPicks instanceof Promise}class u4 extends F{constructor(e,t){super(),this.prefix=e,this.options=t}provide(e,t,i){const n=new U;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let o;const r=n.add(new kt),a=async()=>{o?.dispose(!0),e.busy=!1;const d=r.value=new U;o=d.add(new ri(t));const l=o.token;let u=e.value.substring(this.prefix.length);this.options?.shouldSkipTrimPickFilter||(u=u.trim());const g=this._getPicks(u,d,l,i),m=(y,w)=>{let C,T;if(W0(y)?(C=y.items,T=y.active):C=y,C.length===0){if(w)return!1;(u.length>0||e.hideInput)&&this.options?.noResultsPick&&(r_e(this.options.noResultsPick)?C=[this.options.noResultsPick(u)]:C=[this.options.noResultsPick])}return e.items=C,T&&(e.activeItems=[T]),!0},v=async y=>{let w=!1,C=!1;await Promise.all([(async()=>{typeof y.mergeDelay=="number"&&(await Ia(y.mergeDelay),l.isCancellationRequested)||C||(w=m(y.picks,!0))})(),(async()=>{e.busy=!0;try{const T=await y.additionalPicks;if(l.isCancellationRequested)return;let k,A;W0(y.picks)?(k=y.picks.items,A=y.picks.active):k=y.picks;let B,z;if(W0(T)?(B=T.items,z=T.active):B=T,B.length>0||!w){let Q;if(!A&&!z){const ie=e.activeItems[0];ie&&k.indexOf(ie)!==-1&&(Q=ie)}m({items:[...k,...B],active:A||z||Q})}}finally{l.isCancellationRequested||(e.busy=!1),C=!0}})()])};if(g!==null)if(uZ(g))await v(g);else if(!(g instanceof Promise))m(g);else{e.busy=!0;try{const y=await g;if(l.isCancellationRequested)return;uZ(y)?await v(y):m(y)}finally{l.isCancellationRequested||(e.busy=!1)}}};n.add(e.onDidChangeValue(()=>a())),a(),n.add(e.onDidAccept(d=>{if(i?.handleAccept){d.inBackground||e.hide(),i.handleAccept?.(e.activeItems[0],d.inBackground);return}const[l]=e.selectedItems;typeof l?.accept=="function"&&(d.inBackground||e.hide(),l.accept(e.keyMods,d))}));const c=async(d,l)=>{if(typeof l.trigger!="function")return;const u=l.buttons?.indexOf(d)??-1;if(u>=0){const g=l.trigger(u,e.keyMods),m=typeof g=="number"?g:await g;if(t.isCancellationRequested)return;switch(m){case Du.NO_ACTION:break;case Du.CLOSE_PICKER:e.hide();break;case Du.REFRESH_PICKER:a();break;case Du.REMOVE_ITEM:{const v=e.items.indexOf(l);if(v!==-1){const y=e.items.slice(),w=y.splice(v,1),C=e.activeItems.filter(k=>k!==w[0]),T=e.keepScrollPosition;e.keepScrollPosition=!0,e.items=y,C&&(e.activeItems=C),e.keepScrollPosition=T}break}}}};return n.add(e.onDidTriggerItemButton(({button:d,item:l})=>c(d,l))),n.add(e.onDidTriggerSeparatorButton(({button:d,separator:l})=>c(d,l))),n}}const bP=0,gZ=[bP,[]];function pZ(s,e,t,i){if(!s||!e)return gZ;const n=s.length,o=e.length;if(n<o)return gZ;const r=s.toLowerCase();return JNe(e,t,o,s,r,n,i)}function JNe(s,e,t,i,n,o,r){const a=[],c=[];for(let g=0;g<t;g++){const m=g*o,v=m-o,y=g>0,w=s[g],C=e[g];for(let T=0;T<o;T++){const k=T>0,A=m+T,B=A-1,z=v+T-1,Q=k?a[B]:0,ie=y&&k?a[z]:0,oe=y&&k?c[z]:0;let xe;!ie&&y?xe=0:xe=eOe(w,C,i,n,T,oe),xe&&ie+xe>=Q&&(r||y||n.startsWith(e,T))?(c[A]=oe+1,a[A]=ie+xe):(c[A]=bP,a[A]=Q)}}const d=[];let l=t-1,u=o-1;for(;l>=0&&u>=0;){const g=l*o+u;c[g]===bP||(d.push(u),l--),u--}return[a[t*o-1],d.reverse()]}function eOe(s,e,t,i,n,o){let r=0;if(!tOe(e,i[n]))return r;if(r+=1,o>0&&(r+=o*5),s===t[n]&&(r+=1),n===0)r+=8;else{const a=iOe(t.charCodeAt(n-1));a?r+=a:c_e(t.charCodeAt(n))&&o===0&&(r+=2)}return r}function tOe(s,e){return s===e?!0:s==="/"||s==="\\"?e==="/"||e==="\\":!1}function iOe(s){switch(s){case st.Slash:case st.Backslash:return 5;case st.Underline:case st.Dash:case st.Period:case st.Space:case st.SingleQuote:case st.DoubleQuote:case st.Colon:return 4;default:return 0}}const Zle=[void 0,[]];function B0(s,e,t=0,i=0){const n=e;return n.values&&n.values.length>1?nOe(s,n.values,t,i):Jle(s,e,t,i)}function nOe(s,e,t,i){let n=0;const o=[];for(const r of e){const[a,c]=Jle(s,r,t,i);if(typeof a!="number")return Zle;n+=a,o.push(...c)}return[n,lU(o)]}function Jle(s,e,t,i){const n=Sq(e.original,e.originalLowercase,t,s,s.toLowerCase(),i,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return n?[n[0],lw(n)]:Zle}const yP=Object.freeze({score:0}),tT=1<<18,aU=1<<17,cU=65536;function sOe(s,e,t,i){const n=i.values?i.values:[i];return cc({[i.normalized]:{values:n.map(r=>({value:r.normalized,expectContiguousMatch:r.expectContiguousMatch})),label:s,description:e,allowNonContiguousMatches:t}})}function dU(s,e,t,i,n){if(!s||!e.normalized)return yP;const o=i.getItemLabel(s);if(!o)return yP;const r=i.getItemDescription(s),a=sOe(o,r,t,e),c=n[a];if(c)return c;const d=oOe(o,r,i.getItemPath(s),e);return n[a]=d,d}function oOe(s,e,t,i,n){const o=!t||!i.containsPathSeparator;return t&&(vh?i.pathNormalized===t:Xs(i.pathNormalized,t))?{score:tT,labelMatch:[{start:0,end:s.length}],descriptionMatch:e?[{start:0,end:e.length}]:void 0}:i.values&&i.values.length>1?rOe(s,e,t,i.values,o):ehe(s,e,t,i,o)}function rOe(s,e,t,i,n,o){let r=0;const a=[],c=[];for(const d of i){const{score:l,labelMatch:u,descriptionMatch:g}=ehe(s,e,t,d,n);if(l===bP)return yP;r+=l,u&&a.push(...u),g&&c.push(...g)}return{score:r,labelMatch:lU(a),descriptionMatch:lU(c)}}function ehe(s,e,t,i,n,o){if(n||!e){const[r,a]=pZ(s,i.normalized,i.normalizedLowercase,!i.expectContiguousMatch);if(r){const c=Dq(i.normalized,s);let d;if(c){d=aU;const l=Math.round(i.normalized.length/s.length*100);d+=l}else d=cU;return{score:d+r,labelMatch:c||fZ(a)}}}if(e){let r=e;t&&(r=`${e}${KT}`);const a=r.length,c=`${r}${s}`,[d,l]=pZ(c,i.normalized,i.normalizedLowercase,!i.expectContiguousMatch);if(d){const u=fZ(l),g=[],m=[];return u.forEach(v=>{v.start<a&&v.end>a?(g.push({start:0,end:v.end-a}),m.push({start:v.start,end:a})):v.start>=a?g.push({start:v.start-a,end:v.end-a}):m.push(v)}),{score:d,labelMatch:g,descriptionMatch:m}}}return yP}function fZ(s){const e=[];if(!s)return e;let t;for(const i of s)t&&t.end===i?t.end+=1:(t={start:i,end:i+1},e.push(t));return e}function lU(s){const e=s.sort((n,o)=>n.start-o.start),t=[];let i;for(const n of e)!i||!aOe(i,n)?(i=n,t.push(n)):(i.start=Math.min(i.start,n.start),i.end=Math.max(i.end,n.end));return t}function aOe(s,e){return!(s.end<e.start||e.end<s.start)}function cOe(s,e,t,i,n,o){const r=dU(s,t,i,n,o),a=dU(e,t,i,n,o),c=r.score,d=a.score;if((c===tT||d===tT)&&c!==d)return c===tT?-1:1;if(c>cU||d>cU){if(c!==d)return c>d?-1:1;if(c<aU&&d<aU){const w=dOe(r.labelMatch,a.labelMatch);if(w!==0)return w}const v=n.getItemLabel(s)||"",y=n.getItemLabel(e)||"";if(v.length!==y.length)return v.length-y.length}if(c!==d)return c>d?-1:1;const l=Array.isArray(r.labelMatch)&&r.labelMatch.length>0,u=Array.isArray(a.labelMatch)&&a.labelMatch.length>0;if(l&&!u)return-1;if(u&&!l)return 1;const g=mZ(s,r,n),m=mZ(e,a,n);return g&&m&&g!==m?m>g?-1:1:lOe(s,e,t,n)}function mZ(s,e,t){let i=-1,n=-1;if(e.descriptionMatch&&e.descriptionMatch.length?i=e.descriptionMatch[0].start:e.labelMatch&&e.labelMatch.length&&(i=e.labelMatch[0].start),e.labelMatch&&e.labelMatch.length){if(n=e.labelMatch[e.labelMatch.length-1].end,e.descriptionMatch&&e.descriptionMatch.length){const o=t.getItemDescription(s);o&&(n+=o.length)}}else e.descriptionMatch&&e.descriptionMatch.length&&(n=e.descriptionMatch[e.descriptionMatch.length-1].end);return n-i}function dOe(s,e){if(!s&&!e||(!s||!s.length)&&(!e||!e.length))return 0;if(!e||!e.length)return-1;if(!s||!s.length)return 1;const t=s[0].start,n=s[s.length-1].end-t,o=e[0].start,a=e[e.length-1].end-o;return n===a?0:a<n?1:-1}function lOe(s,e,t,i){const n=i.getItemLabel(s)||"",o=i.getItemLabel(e)||"",r=i.getItemDescription(s),a=i.getItemDescription(e),c=n.length+(r?r.length:0),d=o.length+(a?a.length:0);if(c!==d)return c-d;const l=i.getItemPath(s),u=i.getItemPath(e);return l&&u&&l.length!==u.length?l.length-u.length:n!==o?J1(n,o,t.normalized):r&&a&&r!==a?J1(r,a,t.normalized):l&&u&&l!==u?J1(l,u,t.normalized):0}function vZ(s){return s.startsWith('"')&&s.endsWith('"')}const the=" ";function yx(s){typeof s!="string"&&(s="");const e=s.toLowerCase(),{pathNormalized:t,normalized:i,normalizedLowercase:n}=_Z(s),o=t.indexOf(KT)>=0,r=vZ(s);let a;const c=s.split(the);if(c.length>1)for(const d of c){const l=vZ(d),{pathNormalized:u,normalized:g,normalizedLowercase:m}=_Z(d);g&&(a||(a=[]),a.push({original:d,originalLowercase:d.toLowerCase(),pathNormalized:u,normalized:g,normalizedLowercase:m,expectContiguousMatch:l}))}return{original:s,originalLowercase:e,pathNormalized:t,normalized:i,normalizedLowercase:n,values:a,containsPathSeparator:o,expectContiguousMatch:r}}function _Z(s){let e;pn?e=s.replace(/\//g,KT):e=s.replace(/\\/g,KT);const t=a_e(e).replace(/\s|"/g,"");return{pathNormalized:e,normalized:t,normalizedLowercase:t.toLowerCase()}}function bZ(s){return Array.isArray(s)?yx(s.map(e=>e.original).join(the)):yx(s.original)}var hU,uU,gU;Be(ZNe);let wx=class extends u4{constructor(e,t,i,n,o){super(e,{canAcceptInBackground:!0,noResultsPick:{label:h(3283,"No matching editors"),groupId:-1}}),this.editorGroupService=t,this.editorService=i,this.modelService=n,this.languageService=o,this.pickState=new class{constructor(){this.scorerCache=Object.create(null),this.isQuickNavigating=void 0}reset(r){r||(this.scorerCache=Object.create(null)),this.isQuickNavigating=r}}}provide(e,t){return this.pickState.reset(!!e.quickNavigate),super.provide(e,t)}_getPicks(e){const t=yx(e),i=this.doGetEditorPickItems().filter(o=>{if(!t.normalized)return!0;const r=dU(o,t,!0,I7,this.pickState.scorerCache);return r.score?(o.highlights={label:r.labelMatch,description:r.descriptionMatch},!0):!1});if(t.normalized){const o=this.editorGroupService.getGroups(Ko.GRID_APPEARANCE).map(r=>r.id);i.sort((r,a)=>r.groupId!==a.groupId?o.indexOf(r.groupId)-o.indexOf(a.groupId):cOe(r,a,t,!0,I7,this.pickState.scorerCache))}const n=[];if(this.editorGroupService.count>1){let o;for(const r of i){if(typeof o!="number"||o!==r.groupId){const a=this.editorGroupService.getGroup(r.groupId);a&&n.push({type:"separator",label:a.label}),o=r.groupId}n.push(r)}}else n.push(...i);return n}doGetEditorPickItems(){const e=this.doGetEditors(),t=new Map;for(const{groupId:i}of e)if(!t.has(i)){const n=this.editorGroupService.getGroup(i);n&&t.set(i,n.ariaLabel)}return this.doGetEditors().map(({editor:i,groupId:n})=>{const o=xi.getOriginalUri(i,{supportSideBySide:Ut.PRIMARY}),r=i.isDirty()&&!i.isSaving(),a=i.getDescription(),c=a?`${i.getName()} ${a}`:i.getName();return{groupId:n,resource:o,label:i.getName(),ariaLabel:t.size>1?r?h(3284,"{0}, unsaved changes, {1}",c,t.get(n)):h(3285,"{0}, {1}",c,t.get(n)):r?h(3286,"{0}, unsaved changes",c):c,description:a,iconClasses:uh(this.modelService,this.languageService,o,void 0,i.getIcon()).concat(i.getLabelExtraClasses()),italic:!this.editorGroupService.getGroup(n)?.isPinned(i),buttons:[{iconClass:r?"dirty-editor "+Te.asClassName(j.closeDirty):Te.asClassName(j.close),tooltip:h(3287,"Close Editor"),alwaysVisible:r}],trigger:async()=>{const d=this.editorGroupService.getGroup(n);return d&&(await d.closeEditor(i,{preserveFocus:!0}),!d.contains(i))?Du.REMOVE_ITEM:Du.NO_ACTION},accept:(d,l)=>this.editorGroupService.getGroup(n)?.openEditor(i,{preserveFocus:l.inBackground})}})}};wx=f([p(1,Ie),p(2,de),p(3,ai),p(4,fi)],wx);let qy=class extends wx{static{hU=this}static{this.PREFIX="edt active "}constructor(e,t,i,n){super(hU.PREFIX,e,t,i,n)}doGetEditors(){const e=this.editorGroupService.activeGroup;return e.getEditors(Ai.MOST_RECENTLY_ACTIVE).map(t=>({editor:t,groupId:e.id}))}};qy=hU=f([p(0,Ie),p(1,de),p(2,ai),p(3,fi)],qy);let pU=class extends wx{static{uU=this}static{this.PREFIX="edt "}constructor(e,t,i,n){super(uU.PREFIX,e,t,i,n)}doGetEditors(){const e=[];for(const t of this.editorGroupService.getGroups(Ko.GRID_APPEARANCE))for(const i of t.getEditors(Ai.SEQUENTIAL))e.push({editor:i,groupId:t.id});return e}};pU=uU=f([p(0,Ie),p(1,de),p(2,ai),p(3,fi)],pU);let Sx=class extends wx{static{gU=this}static{this.PREFIX="edt mru "}constructor(e,t,i,n){super(gU.PREFIX,e,t,i,n)}doGetEditors(){const e=[];for(const t of this.editorService.getEditors(Ai.MOST_RECENTLY_ACTIVE))e.push(t);return e}};Sx=gU=f([p(0,Ie),p(1,de),p(2,ai),p(3,fi)],Sx);const hOe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var R_;let ws=class extends gl{static{R_=this}static{this.ID="workbench.editorinputs.sidebysideEditorInput"}get typeId(){return R_.ID}get capabilities(){let e=this.primary.capabilities;return e&=~Ze.CanSplitInGroup,this.secondary.hasCapability(Ze.RequiresTrust)&&(e|=Ze.RequiresTrust),this.secondary.hasCapability(Ze.Singleton)&&(e|=Ze.Singleton),e|=Ze.MultipleEditors,e}get resource(){if(this.hasIdenticalSides)return this.primary.resource}constructor(e,t,i,n,o){super(),this.preferredName=e,this.preferredDescription=t,this.secondary=i,this.primary=n,this.editorService=o,this.hasIdenticalSides=this.primary.matches(this.secondary),this.registerListeners()}registerListeners(){this._register(D.once(D.any(this.primary.onWillDispose,this.secondary.onWillDispose))(()=>{this.isDisposed()||this.dispose()})),this._register(this.primary.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.primary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.secondary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.primary.onDidChangeLabel(()=>this._onDidChangeLabel.fire())),this._register(this.secondary.onDidChangeLabel(()=>this._onDidChangeLabel.fire()))}getName(){const e=this.getPreferredName();return e||(this.hasIdenticalSides?this.primary.getName():h(3882,"{0} - {1}",this.secondary.getName(),this.primary.getName()))}getPreferredName(){return this.preferredName}getDescription(e){const t=this.getPreferredDescription();return t||(this.hasIdenticalSides?this.primary.getDescription(e):super.getDescription(e))}getPreferredDescription(){return this.preferredDescription}getTitle(e){let t;this.hasIdenticalSides?t=this.primary.getTitle(e)??this.getName():t=super.getTitle(e);const i=this.getPreferredTitle();return i&&(t=`${i} (${t})`),t}getPreferredTitle(){if(this.preferredName&&this.preferredDescription)return`${this.preferredName} ${this.preferredDescription}`;if(this.preferredName||this.preferredDescription)return this.preferredName??this.preferredDescription}getLabelExtraClasses(){return this.hasIdenticalSides?this.primary.getLabelExtraClasses():super.getLabelExtraClasses()}getAriaLabel(){return this.hasIdenticalSides?this.primary.getAriaLabel():super.getAriaLabel()}getTelemetryDescriptor(){return{...this.primary.getTelemetryDescriptor(),...super.getTelemetryDescriptor()}}isDirty(){return this.primary.isDirty()}isSaving(){return this.primary.isSaving()}async save(e,t){const i=await this.primary.save(e,t);return this.saveResultToEditor(i)}async saveAs(e,t){const i=await this.primary.saveAs(e,t);return this.saveResultToEditor(i)}saveResultToEditor(e){if(!e||!this.hasIdenticalSides)return e;if(this.primary.matches(e))return this;if(e instanceof gl)return new R_(this.preferredName,this.preferredDescription,e,e,this.editorService);if(!K_(e)&&!d0(e)&&!LS(e)&&!_C(e))return{primary:e,secondary:e,label:this.preferredName,description:this.preferredDescription}}revert(e,t){return this.primary.revert(e,t)}async rename(e,t){if(!this.hasIdenticalSides)return;const i=await this.primary.rename(e,t);if(i){if(bC(i.editor))return{editor:new R_(this.preferredName,this.preferredDescription,i.editor,i.editor,this.editorService),options:{...i.options,viewState:Pb(this,e,this.editorService)}};if(eh(i.editor))return{editor:{label:this.preferredName,description:this.preferredDescription,primary:i.editor,secondary:i.editor,options:{...i.options,viewState:Pb(this,e,this.editorService)}}}}}isReadonly(){return this.primary.isReadonly()}toUntyped(e){const t=this.primary.toUntyped(e),i=this.secondary.toUntyped(e);if(t&&i&&!K_(t)&&!K_(i)&&!d0(t)&&!d0(i)&&!LS(t)&&!LS(i)&&!_C(t)&&!_C(i)){const n={label:this.preferredName,description:this.preferredDescription,primary:t,secondary:i};return typeof e?.preserveViewState=="number"&&(n.options={viewState:Pb(this,e.preserveViewState,this.editorService)}),n}}matches(e){return this===e?!0:cCe(e)||K_(e)?!1:e instanceof R_?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):LS(e)?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):!1}};ws=R_=f([p(4,de)],ws);class ihe{canSerialize(e){const t=e;if(t.primary&&t.secondary){const[i,n]=this.getSerializers(t.secondary.typeId,t.primary.typeId);return!!(i?.canSerialize(t.secondary)&&n?.canSerialize(t.primary))}return!1}serialize(e){const t=e;if(t.primary&&t.secondary){const[i,n]=this.getSerializers(t.secondary.typeId,t.primary.typeId);if(n&&i){const o=n.serialize(t.primary),r=i.serialize(t.secondary);if(o&&r){const a={name:t.getPreferredName(),description:t.getPreferredDescription(),primarySerialized:o,secondarySerialized:r,primaryTypeId:t.primary.typeId,secondaryTypeId:t.secondary.typeId};return JSON.stringify(a)}}}}deserialize(e,t){const i=JSON.parse(t),[n,o]=this.getSerializers(i.secondaryTypeId,i.primaryTypeId);if(o&&n){const r=o.deserialize(e,i.primarySerialized),a=n.deserialize(e,i.secondarySerialized);if(r instanceof gl&&a instanceof gl)return this.createEditorInput(e,i.name,i.description,a,r)}}getSerializers(e,t){const i=Ge.as(Zm.EditorFactory);return[i.getEditorSerializer(e),i.getEditorSerializer(t)]}}class BYe extends ihe{createEditorInput(e,t,i,n,o){return e.createInstance(ws,t,i,n,o)}}class KO extends pw{constructor(e,t,i){super(t),this.id=e,this.memento=new uw(this.id,i),this._register(i.onWillSaveState(()=>{this.saveState(),this.memento.saveMemento()}))}getId(){return this.id}getMemento(e,t){return this.memento.getMemento(e,t)}reloadMemento(e){return this.memento.reloadMemento(e)}onDidChangeMementoValue(e,t){return this.memento.onDidChangeValue(e,t)}saveState(){}}class uOe extends KO{get onDidFocus(){return this._onDidFocus||(this._onDidFocus=this.registerFocusTrackEvents().onDidFocus),this._onDidFocus.event}get onDidBlur(){return this._onDidBlur||(this._onDidBlur=this.registerFocusTrackEvents().onDidBlur),this._onDidBlur.event}hasFocus(){return this._hasFocus}registerFocusTrackEvents(){const e=Gt(this.getContainer()),t=this._register(Po(e)),i=this._onDidFocus=this._register(new M);this._register(t.onDidFocus(()=>{this._hasFocus=!0,i.fire()}));const n=this._onDidBlur=this._register(new M);return this._register(t.onDidBlur(()=>{this._hasFocus=!1,n.fire()})),{onDidFocus:i,onDidBlur:n}}constructor(e,t,i,n){super(e,i,n),this.telemetryService=t,this._onTitleAreaUpdate=this._register(new M),this.onTitleAreaUpdate=this._onTitleAreaUpdate.event,this._hasFocus=!1,this.visible=!1}getTitle(){}create(e){this.parent=e}getContainer(){return this.parent}setVisible(e){this.visible!==!!e&&(this.visible=e)}focus(){}getMenuIds(){return[]}getActions(){return[]}getSecondaryActions(){return[]}getContextMenuActions(){return[]}getActionViewItem(e,t){}getActionsContext(){return null}getActionRunner(){return this.actionRunner||(this.actionRunner=this._register(new _g)),this.actionRunner}updateTitleArea(){this._onTitleAreaUpdate.fire()}isVisible(){return this.visible}getControl(){}}class VYe{constructor(e,t,i,n,o,r){this.ctor=e,this.id=t,this.name=i,this.cssClass=n,this.order=o,this.requestedIndex=r}instantiate(e){return e.createInstance(this.ctor)}}class HYe extends F{constructor(){super(...arguments),this._onDidRegister=this._register(new M),this.onDidRegister=this._onDidRegister.event,this._onDidDeregister=this._register(new M),this.onDidDeregister=this._onDidDeregister.event,this.composites=[]}registerComposite(e){this.compositeById(e.id)||(this.composites.push(e),this._onDidRegister.fire(e))}deregisterComposite(e){const t=this.compositeById(e);t&&(this.composites.splice(this.composites.indexOf(t),1),this._onDidDeregister.fire(t))}getComposite(e){return this.compositeById(e)}getComposites(){return this.composites.slice(0)}compositeById(e){return this.composites.find(t=>t.id===e)}}class Hu extends uOe{static{this.EDITOR_MEMENTOS=new Map}get minimumWidth(){return pp.width}get maximumWidth(){return TA.width}get minimumHeight(){return pp.height}get maximumHeight(){return TA.height}get input(){return this._input}get options(){return this._options}get window(){return kq(this.group.windowId,!0).window}get scopedContextKeyService(){}constructor(e,t,i,n,o){super(e,i,n,o),this.group=t,this.onDidChangeSizeConstraints=D.None,this._onDidChangeControl=this._register(new M),this.onDidChangeControl=this._onDidChangeControl.event}create(e){super.create(e),this.createEditor(e)}async setInput(e,t,i,n){this._input=e,this._options=t}clearInput(){this._input=void 0,this._options=void 0}setOptions(e){this._options=e}setVisible(e){super.setVisible(e),this.setEditorVisible(e)}setEditorVisible(e){}setBoundarySashes(e){}getEditorMemento(e,t,i,n=10){const o=`${this.getId()}${i}`;let r=Hu.EDITOR_MEMENTOS.get(o);return r||(r=this._register(new UC(this.getId(),i,this.getMemento(he.WORKSPACE,pt.MACHINE),n,e,t)),Hu.EDITOR_MEMENTOS.set(o,r)),r}getViewState(){}saveState(){for(const[,e]of Hu.EDITOR_MEMENTOS)e.id===this.getId()&&e.saveState();super.saveState()}dispose(){this._input=void 0,this._options=void 0,super.dispose()}}class UC extends F{static{this.SHARED_EDITOR_STATE=-1}constructor(e,t,i,n,o,r){super(),this.id=e,this.key=t,this.memento=i,this.limit=n,this.editorGroupService=o,this.configurationService=r,this.cleanedUp=!1,this.shareEditorState=!1,this.updateConfiguration(void 0),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e)))}updateConfiguration(e){(!e||e.affectsConfiguration(void 0,"workbench.editor.sharedViewState"))&&(this.shareEditorState=this.configurationService.getValue(void 0,"workbench.editor.sharedViewState")===!0)}saveEditorState(e,t,i){const n=this.doGetResource(t);if(!n||!e)return;const o=this.doLoad();let r=o.get(n.toString());r||(r=Object.create(null),o.set(n.toString(),r)),r[e.id]=i,this.shareEditorState&&(r[UC.SHARED_EDITOR_STATE]=i),bC(t)&&this.clearEditorStateOnDispose(n,t)}loadEditorState(e,t){const i=this.doGetResource(t);if(!i||!e)return;const o=this.doLoad().get(i.toString());if(o){const r=o[e.id];if(r)return r;if(this.shareEditorState)return o[UC.SHARED_EDITOR_STATE]}}clearEditorState(e,t){bC(e)&&this.editorDisposables?.delete(e);const i=this.doGetResource(e);if(i){const n=this.doLoad();if(t){const o=n.get(i.toString());o&&(delete o[t.id],FT(o)&&n.delete(i.toString()))}else n.delete(i.toString())}}clearEditorStateOnDispose(e,t){this.editorDisposables||(this.editorDisposables=new Map),this.editorDisposables.has(t)||this.editorDisposables.set(t,D.once(t.onWillDispose)(()=>{this.clearEditorState(e),this.editorDisposables?.delete(t)}))}moveEditorState(e,t,i){const n=this.doLoad(),o=[...n.keys()];for(const r of o){const a=R.parse(r);if(!i.isEqualOrParent(a,e))continue;let c;if(Dt(e,a))c=t;else{const l=d_e(a.path,e.path);c=xt(t,a.path.substr(l+e.path.length+1))}const d=n.get(r,l_e.None);d&&(n.delete(r),n.set(c.toString(),d))}}doGetResource(e){return bC(e)?e.resource:e}doLoad(){if(!this.cache){this.cache=new Bm(this.limit);const e=this.memento[this.key];Array.isArray(e)&&this.cache.fromJSON(e)}return this.cache}saveState(){const e=this.doLoad();this.cleanedUp||(this.cleanUp(),this.cleanedUp=!0),this.memento[this.key]=e.toJSON()}cleanUp(){const e=this.doLoad(),t=[...e.entries()];for(const[i,n]of t)for(const o of Object.keys(n)){const r=Number(o);r===UC.SHARED_EDITOR_STATE&&this.shareEditorState||this.editorGroupService.getGroup(r)||(delete n[r],FT(n)&&e.delete(i))}}}let wP=class extends Hu{constructor(e,t,i,n,o,r,a,c,d,l){super(e,t,n,c,r),this.instantiationService=o,this.textResourceConfigurationService=a,this.editorService=d,this.editorGroupService=l,this.groupListener=this._register(new kt),this.viewState=this.getEditorMemento(l,a,i,100)}setEditorVisible(e){this.groupListener.value=this.group.onWillCloseEditor(t=>this.onWillCloseEditor(t)),super.setEditorVisible(e)}onWillCloseEditor(e){const t=e.editor;t===this.input&&this.updateEditorViewState(t)}clearInput(){this.updateEditorViewState(this.input),super.clearInput()}saveState(){this.updateEditorViewState(this.input),super.saveState()}updateEditorViewState(e){if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);t&&(this.tracksDisposedEditorViewState()||(this.editorViewStateDisposables||(this.editorViewStateDisposables=new Map),this.editorViewStateDisposables.has(e)||this.editorViewStateDisposables.set(e,D.once(e.onWillDispose)(()=>{this.clearEditorViewState(t,this.group),this.editorViewStateDisposables?.delete(e)}))),e.isDisposed()&&!this.tracksDisposedEditorViewState()||!this.shouldRestoreEditorViewState(e)&&!this.group.contains(e)?this.clearEditorViewState(t,this.group):e.isDisposed()||this.saveEditorViewState(t))}shouldRestoreEditorViewState(e,t){return t?.newInGroup?this.textResourceConfigurationService.getValue(xi.getOriginalUri(e,{supportSideBySide:Ut.PRIMARY}),"workbench.editor.restoreViewState")!==!1:!0}getViewState(){const e=this.input;if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);if(t)return this.computeEditorViewState(t)}saveEditorViewState(e){const t=this.computeEditorViewState(e);t&&this.viewState.saveEditorState(this.group,e,t)}loadEditorViewState(e,t){if(!e||!this.tracksEditorViewState(e)||!this.shouldRestoreEditorViewState(e,t))return;const i=this.toEditorViewStateResource(e);if(i)return this.viewState.loadEditorState(this.group,i)}moveEditorViewState(e,t,i){return this.viewState.moveEditorState(e,t,i)}clearEditorViewState(e,t){this.viewState.clearEditorState(e,t)}dispose(){if(super.dispose(),this.editorViewStateDisposables){for(const[,e]of this.editorViewStateDisposables)e.dispose();this.editorViewStateDisposables=void 0}}tracksDisposedEditorViewState(){return!1}};wP=f([p(3,li),p(4,J),p(5,tt),p(6,Xo),p(7,ft),p(8,de),p(9,Ie)],wP);var $f;Be(hOe);function gOe(s){const e=s;return typeof e?.primary=="object"&&typeof e.secondary=="object"}let Tp=class extends wP{static{$f=this}static{this.ID=dCe}static{this.SIDE_BY_SIDE_LAYOUT_SETTING="workbench.editor.splitInGroupLayout"}static{this.VIEW_STATE_PREFERENCE_KEY="sideBySideEditorViewState"}get minimumPrimaryWidth(){return this.primaryEditorPane?this.primaryEditorPane.minimumWidth:0}get maximumPrimaryWidth(){return this.primaryEditorPane?this.primaryEditorPane.maximumWidth:Number.POSITIVE_INFINITY}get minimumPrimaryHeight(){return this.primaryEditorPane?this.primaryEditorPane.minimumHeight:0}get maximumPrimaryHeight(){return this.primaryEditorPane?this.primaryEditorPane.maximumHeight:Number.POSITIVE_INFINITY}get minimumSecondaryWidth(){return this.secondaryEditorPane?this.secondaryEditorPane.minimumWidth:0}get maximumSecondaryWidth(){return this.secondaryEditorPane?this.secondaryEditorPane.maximumWidth:Number.POSITIVE_INFINITY}get minimumSecondaryHeight(){return this.secondaryEditorPane?this.secondaryEditorPane.minimumHeight:0}get maximumSecondaryHeight(){return this.secondaryEditorPane?this.secondaryEditorPane.maximumHeight:Number.POSITIVE_INFINITY}set minimumWidth(e){}set maximumWidth(e){}set minimumHeight(e){}set maximumHeight(e){}get minimumWidth(){return this.minimumPrimaryWidth+this.minimumSecondaryWidth}get maximumWidth(){return this.maximumPrimaryWidth+this.maximumSecondaryWidth}get minimumHeight(){return this.minimumPrimaryHeight+this.minimumSecondaryHeight}get maximumHeight(){return this.maximumPrimaryHeight+this.maximumSecondaryHeight}constructor(e,t,i,n,o,r,a,c,d){super($f.ID,e,$f.VIEW_STATE_PREFERENCE_KEY,t,i,o,a,n,c,d),this.configurationService=r,this.onDidCreateEditors=this._register(new M),this._onDidChangeSizeConstraints=this._register(new bne),this.onDidChangeSizeConstraints=D.any(this.onDidCreateEditors.event,this._onDidChangeSizeConstraints.event),this._onDidChangeSelection=this._register(new M),this.onDidChangeSelection=this._onDidChangeSelection.event,this.primaryEditorPane=void 0,this.secondaryEditorPane=void 0,this.splitviewDisposables=this._register(new U),this.editorDisposables=this._register(new U),this.dimension=new Ke(0,0),this.lastFocusedSide=void 0,this.orientation=this.configurationService.getValue($f.SIDE_BY_SIDE_LAYOUT_SETTING)==="vertical"?wt.VERTICAL:wt.HORIZONTAL,this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e)))}onConfigurationUpdated(e){e.affectsConfiguration($f.SIDE_BY_SIDE_LAYOUT_SETTING)&&(this.orientation=this.configurationService.getValue($f.SIDE_BY_SIDE_LAYOUT_SETTING)==="vertical"?wt.VERTICAL:wt.HORIZONTAL,this.splitview&&this.recreateSplitview())}recreateSplitview(){const e=Gt(this.getContainer()),t=this.getSplitViewRatio();this.splitview&&(this.splitview.el.remove(),this.splitviewDisposables.clear()),this.createSplitView(e,t),this.layout(this.dimension)}getSplitViewRatio(){let e;if(this.splitview){const t=this.splitview.getViewSize(0),i=this.splitview.getViewSize(1);if(Math.abs(t-i)>1){const n=this.splitview.orientation===wt.HORIZONTAL?this.dimension.width:this.dimension.height;e=t/n}}return e}createEditor(e){e.classList.add("side-by-side-editor"),this.secondaryEditorContainer=Y(".side-by-side-editor-container.editor-instance"),this.primaryEditorContainer=Y(".side-by-side-editor-container.editor-instance"),this.createSplitView(e)}createSplitView(e,t){this.splitview=this.splitviewDisposables.add(new PT(e,{orientation:this.orientation})),this.splitviewDisposables.add(this.splitview.onDidSashReset(()=>this.splitview?.distributeViewSizes())),this.orientation===wt.HORIZONTAL?this.splitview.orthogonalEndSash=this._boundarySashes?.bottom:(this.splitview.orthogonalStartSash=this._boundarySashes?.left,this.splitview.orthogonalEndSash=this._boundarySashes?.right);let i=bE.Distribute,n=bE.Distribute;if(t){const a=this.splitview.orientation===wt.HORIZONTAL?this.dimension.width:this.dimension.height;i=Math.round(a*t),n=a-i,this.splitview.layout(this.orientation===wt.HORIZONTAL?this.dimension.width:this.dimension.height)}const o=Gt(this.secondaryEditorContainer);this.splitview.addView({element:o,layout:a=>this.layoutPane(this.secondaryEditorPane,a),minimumSize:this.orientation===wt.HORIZONTAL?pp.width:pp.height,maximumSize:Number.POSITIVE_INFINITY,onDidChange:D.None},i);const r=Gt(this.primaryEditorContainer);this.splitview.addView({element:r,layout:a=>this.layoutPane(this.primaryEditorPane,a),minimumSize:this.orientation===wt.HORIZONTAL?pp.width:pp.height,maximumSize:Number.POSITIVE_INFINITY,onDidChange:D.None},n),this.updateStyles()}getTitle(){return this.input?this.input.getName():h(3348,"Side by Side Editor")}async setInput(e,t,i,n){const o=this.input;await super.setInput(e,t,i,n),(!o||!e.matches(o))&&(o&&this.disposeEditors(),this.createEditors(e));const{primary:r,secondary:a,viewState:c}=this.loadViewState(e,t,i);if(this.lastFocusedSide=c?.focus,typeof c?.ratio=="number"&&this.splitview){const d=this.splitview.orientation===wt.HORIZONTAL?this.dimension.width:this.dimension.height;this.splitview.resizeView(0,Math.round(d*c.ratio))}else this.splitview?.distributeViewSizes();await Promise.all([this.secondaryEditorPane?.setInput(e.secondary,a,i,n),this.primaryEditorPane?.setInput(e.primary,r,i,n)]),typeof t?.target=="number"&&(this.lastFocusedSide=t.target)}loadViewState(e,t,i){const n=gOe(t?.viewState)?t?.viewState:this.loadEditorViewState(e,i);let o=Object.create(null),r;return t?.target===Ut.SECONDARY?r={...t}:o={...t},o.viewState=n?.primary,n?.secondary&&(r?r.viewState=n?.secondary:r={viewState:n.secondary}),{primary:o,secondary:r,viewState:n}}createEditors(e){this.secondaryEditorPane=this.doCreateEditor(e.secondary,Gt(this.secondaryEditorContainer)),this.primaryEditorPane=this.doCreateEditor(e.primary,Gt(this.primaryEditorContainer)),this.layout(this.dimension),this._onDidChangeSizeConstraints.input=D.any(D.map(this.secondaryEditorPane.onDidChangeSizeConstraints,()=>{}),D.map(this.primaryEditorPane.onDidChangeSizeConstraints,()=>{})),this.onDidCreateEditors.fire(void 0),this.editorDisposables.add(this.primaryEditorPane.onDidFocus(()=>this.onDidFocusChange(Ut.PRIMARY))),this.editorDisposables.add(this.secondaryEditorPane.onDidFocus(()=>this.onDidFocusChange(Ut.SECONDARY)))}doCreateEditor(e,t){const i=Ge.as(Zm.EditorPane).getEditorPane(e);if(!i)throw new Error("No editor pane descriptor for editor found");const n=i.instantiate(this.instantiationService,this.group);return n.create(t),n.setVisible(this.isVisible()),u6(n)&&this.editorDisposables.add(n.onDidChangeSelection(o=>this._onDidChangeSelection.fire(o))),this.editorDisposables.add(n),n}onDidFocusChange(e){this.lastFocusedSide=e,this._onDidChangeControl.fire()}getSelection(){const e=this.getLastFocusedEditorPane();if(u6(e)){const t=e.getSelection();if(t)return new g4(t,e===this.primaryEditorPane?Ut.PRIMARY:Ut.SECONDARY)}}setOptions(e){super.setOptions(e),typeof e?.target=="number"&&(this.lastFocusedSide=e.target),this.getLastFocusedEditorPane()?.setOptions(e)}setEditorVisible(e){this.primaryEditorPane?.setVisible(e),this.secondaryEditorPane?.setVisible(e),super.setEditorVisible(e)}clearInput(){super.clearInput(),this.primaryEditorPane?.clearInput(),this.secondaryEditorPane?.clearInput(),this.disposeEditors()}focus(){super.focus(),this.getLastFocusedEditorPane()?.focus()}getLastFocusedEditorPane(){return this.lastFocusedSide===Ut.SECONDARY?this.secondaryEditorPane:this.primaryEditorPane}layout(e){this.dimension=e,Gt(this.splitview).layout(this.orientation===wt.HORIZONTAL?e.width:e.height)}setBoundarySashes(e){this._boundarySashes=e,this.splitview&&(this.splitview.orthogonalEndSash=e.bottom)}layoutPane(e,t){e?.layout(this.orientation===wt.HORIZONTAL?new Ke(t,this.dimension.height):new Ke(this.dimension.width,t))}getControl(){return this.getLastFocusedEditorPane()?.getControl()}getPrimaryEditorPane(){return this.primaryEditorPane}getSecondaryEditorPane(){return this.secondaryEditorPane}tracksEditorViewState(e){return e instanceof ws}computeEditorViewState(e){if(!this.input||!Dt(e,this.toEditorViewStateResource(this.input)))return;const t=this.primaryEditorPane?.getViewState(),i=this.secondaryEditorPane?.getViewState();if(!(!t||!i))return{primary:t,secondary:i,focus:this.lastFocusedSide,ratio:this.getSplitViewRatio()}}toEditorViewStateResource(e){let t,i;if(e instanceof ws&&(t=e.primary.resource,i=e.secondary.resource),!(!i||!t))return R.from({scheme:"sideBySide",path:`${IE(i.toString())}${IE(t.toString())}`})}updateStyles(){super.updateStyles(),this.primaryEditorContainer&&(this.orientation===wt.HORIZONTAL?(this.primaryEditorContainer.style.borderLeftWidth="1px",this.primaryEditorContainer.style.borderLeftStyle="solid",this.primaryEditorContainer.style.borderLeftColor=this.getColor(Dxe)??"",this.primaryEditorContainer.style.borderTopWidth="0"):(this.primaryEditorContainer.style.borderTopWidth="1px",this.primaryEditorContainer.style.borderTopStyle="solid",this.primaryEditorContainer.style.borderTopColor=this.getColor(Ixe)??"",this.primaryEditorContainer.style.borderLeftWidth="0"))}dispose(){this.disposeEditors(),super.dispose()}disposeEditors(){this.editorDisposables.clear(),this.secondaryEditorPane=void 0,this.primaryEditorPane=void 0,this.lastFocusedSide=void 0,this.secondaryEditorContainer&&Yi(this.secondaryEditorContainer),this.primaryEditorContainer&&Yi(this.primaryEditorContainer)}};Tp=$f=f([p(1,li),p(2,J),p(3,ft),p(4,tt),p(5,ne),p(6,Xo),p(7,de),p(8,Ie)],Tp);class g4{constructor(e,t){this.selection=e,this.side=t}compare(e){return e instanceof g4?this.side!==e.side?j_.DIFFERENT:this.selection.compare(e.selection):j_.DIFFERENT}restore(e){const t={...e,target:this.side};return this.selection.restore(t)}}class lp{static{this.instantiatedEditorPanes=new Set}static didInstantiateEditorPane(e){return lp.instantiatedEditorPanes.has(e)}static{this._onWillInstantiateEditorPane=new M}static{this.onWillInstantiateEditorPane=lp._onWillInstantiateEditorPane.event}static create(e,t,i){return new lp(e,t,i)}constructor(e,t,i){this.ctor=e,this.typeId=t,this.name=i}instantiate(e,t){lp._onWillInstantiateEditorPane.fire({typeId:this.typeId});const i=e.createInstance(this.ctor,t);return lp.instantiatedEditorPanes.add(this.typeId),i}describes(e){return e.getId()===this.typeId}}class pOe{constructor(){this.mapEditorPanesToEditors=new Map}registerEditorPane(e,t){return this.mapEditorPanesToEditors.set(e,t),Ee(()=>{this.mapEditorPanesToEditors.delete(e)})}getEditorPane(e){const t=this.findEditorPaneDescriptors(e);if(t.length!==0)return t.length===1?t[0]:e.prefersEditorPane(t)}findEditorPaneDescriptors(e,t){const i=[];for(const n of this.mapEditorPanesToEditors.keys()){const o=this.mapEditorPanesToEditors.get(n)||[];for(const r of o){const a=r.ctor;if(!t&&e.constructor===a){i.push(n);break}else if(t&&e instanceof a){i.push(n);break}}}return!t&&i.length===0?this.findEditorPaneDescriptors(e,!0):i}getEditorPaneByType(e){return dn.find(this.mapEditorPanesToEditors.keys(),t=>t.typeId===e)}getEditorPanes(){return Array.from(this.mapEditorPanesToEditors.keys())}getEditors(){const e=[];for(const t of this.mapEditorPanesToEditors.keys()){const i=this.mapEditorPanesToEditors.get(t);i&&e.push(...i.map(n=>n.ctor))}return e}}Ge.add(Zm.EditorPane,new pOe);function fOe(s,e){const t=s.get(de),i=s.get(Zi),n=s.get(vg);return new Promise(o=>{let r=[...e];const a=t.onDidCloseEditor(async c=>{if(c.context===Yd.MOVE)return;let d=xi.getOriginalUri(c.editor,{supportSideBySide:Ut.PRIMARY}),l=xi.getOriginalUri(c.editor,{supportSideBySide:Ut.SECONDARY});if(c.context===Yd.REPLACE){const u=xi.getOriginalUri(t.activeEditor,{supportSideBySide:Ut.PRIMARY}),g=xi.getOriginalUri(t.activeEditor,{supportSideBySide:Ut.SECONDARY});i.extUri.isEqual(d,u)&&(d=void 0),i.extUri.isEqual(l,g)&&(l=void 0)}if(r=r.filter(u=>!(i.extUri.isEqual(u,d)||i.extUri.isEqual(u,l)||c.context!==Yd.REPLACE&&(d?.scheme===ae.untitled&&i.extUri.isEqual(u,d.with({scheme:u.scheme}))||l?.scheme===ae.untitled&&i.extUri.isEqual(u,l.with({scheme:u.scheme}))))),r.length===0){const u=e.filter(g=>n.isDirty(g));return u.length>0&&await Op.settled(u.map(async g=>await new Promise(m=>{if(!n.isDirty(g))return m();const v=n.onDidChangeDirty(y=>{if(!y.isDirty()&&i.extUri.isEqual(g,y.resource))return v.dispose(),m()})}))),a.dispose(),o()}})})}function p4(s,e,t,i){let n=s.getAriaLabel();return t&&!t.isPinned(s)&&(n=h(2844,"{0}, preview",n)),t?.isSticky(e??s)&&(n=h(2845,"{0}, pinned",n)),t&&typeof i=="number"&&i>1&&(n=`${n}, ${t.ariaLabel}`),n}var fU;let mU=class extends wP{static{fU=this}static{this.VIEW_STATE_PREFERENCE_KEY="textEditorViewState"}constructor(e,t,i,n,o,r,a,c,d,l){super(e,t,fU.VIEW_STATE_PREFERENCE_KEY,i,n,o,r,a,c,d),this.fileService=l,this._onDidChangeSelection=this._register(new M),this.onDidChangeSelection=this._onDidChangeSelection.event,this._onDidChangeScroll=this._register(new M),this.onDidChangeScroll=this._onDidChangeScroll.event,this.inputListener=this._register(new kt),this._register(this.textResourceConfigurationService.onDidChangeConfiguration(u=>this.handleConfigurationChangeEvent(u))),this._register(D.any(this.editorGroupService.onDidAddGroup,this.editorGroupService.onDidRemoveGroup)(()=>{const u=this.computeAriaLabel();this.editorContainer?.setAttribute("aria-label",u),this.updateEditorControlOptions({ariaLabel:u})})),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(u=>this.onDidChangeFileSystemProvider(u.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(u=>this.onDidChangeFileSystemProvider(u.scheme)))}handleConfigurationChangeEvent(e){const t=this.getActiveResource();this.shouldHandleConfigurationChangeEvent(e,t)&&(this.isVisible()?this.updateEditorConfiguration(t):this.hasPendingConfigurationChange=!0)}shouldHandleConfigurationChangeEvent(e,t){return e.affectsConfiguration(t,"editor")||e.affectsConfiguration(t,"problems.visibility")}consumePendingConfigurationChangeEvent(){this.hasPendingConfigurationChange&&(this.updateEditorConfiguration(),this.hasPendingConfigurationChange=!1)}computeConfiguration(e){const t=oa(e.editor)?Cr(e.editor):Object.create(null);return Object.assign(t,this.getConfigurationOverrides(e)),t.ariaLabel=this.computeAriaLabel(),t}computeAriaLabel(){return this.input?p4(this.input,void 0,this.group,this.editorGroupService.count):h(3353,"Editor")}onDidChangeFileSystemProvider(e){this.input&&this.getActiveResource()?.scheme===e&&this.updateReadonly(this.input)}onDidChangeInputCapabilities(e){this.input===e&&this.updateReadonly(e)}updateReadonly(e){this.updateEditorControlOptions({...this.getReadonlyConfiguration(e.isReadonly())})}getReadonlyConfiguration(e){return{readOnly:!!e,readOnlyMessage:typeof e!="boolean"?e:void 0}}getConfigurationOverrides(e){return{overviewRulerLanes:3,lineNumbersMinChars:3,fixedOverflowWidgets:!0,...this.getReadonlyConfiguration(this.input?.isReadonly()),renderValidationDecorations:e.problems?.visibility!==!1?"on":"off"}}createEditor(e){this.editorContainer=e,this.createEditorControl(e,this.computeConfiguration(this.textResourceConfigurationService.getValue(this.getActiveResource()))),this.registerCodeEditorListeners()}registerCodeEditorListeners(){const e=this.getMainControl();e&&(this._register(e.onDidChangeModelLanguage(()=>this.updateEditorConfiguration())),this._register(e.onDidChangeModel(()=>this.updateEditorConfiguration())),this._register(e.onDidChangeCursorPosition(t=>this._onDidChangeSelection.fire({reason:this.toEditorPaneSelectionChangeReason(t)}))),this._register(e.onDidChangeModelContent(()=>this._onDidChangeSelection.fire({reason:bS.EDIT}))),this._register(e.onDidScrollChange(()=>this._onDidChangeScroll.fire())))}toEditorPaneSelectionChangeReason(e){switch(e.source){case sd.PROGRAMMATIC:return bS.PROGRAMMATIC;case sd.NAVIGATION:return bS.NAVIGATION;case sd.JUMP:return bS.JUMP;default:return bS.USER}}getSelection(){const e=this.getMainControl();if(e){const t=e.getSelection();if(t)return new SP(t)}}async setInput(e,t,i,n){await super.setInput(e,t,i,n),this.inputListener.value=e.onDidChangeCapabilities(()=>this.onDidChangeInputCapabilities(e)),this.updateEditorConfiguration(),Gt(this.editorContainer).setAttribute("aria-label",this.computeAriaLabel())}clearInput(){this.inputListener.clear(),super.clearInput()}getScrollPosition(){const e=this.getMainControl();if(!e)throw new Error("Control has not yet been initialized");return{scrollTop:e.getScrollTop()-e.getTopForLineNumber(1),scrollLeft:e.getScrollLeft()}}setScrollPosition(e){const t=this.getMainControl();if(!t)throw new Error("Control has not yet been initialized");t.setScrollTop(e.scrollTop),e.scrollLeft&&t.setScrollLeft(e.scrollLeft)}setEditorVisible(e){e&&this.consumePendingConfigurationChangeEvent(),super.setEditorVisible(e)}toEditorViewStateResource(e){return e.resource}updateEditorConfiguration(e=this.getActiveResource()){let t;if(e&&(t=this.textResourceConfigurationService.getValue(e)),!t)return;const i=this.computeConfiguration(t);let n=i;this.lastAppliedEditorOptions&&(n=h_e(this.lastAppliedEditorOptions,n)),Object.keys(n).length>0&&(this.lastAppliedEditorOptions=i,this.updateEditorControlOptions(n))}getActiveResource(){const e=this.getMainControl();if(e){const t=e.getModel();if(t)return t.uri}if(this.input)return this.input.resource}dispose(){this.lastAppliedEditorOptions=void 0,super.dispose()}};mU=fU=f([p(2,li),p(3,J),p(4,tt),p(5,Xo),p(6,ft),p(7,de),p(8,Ie),p(9,Xe)],mU);class SP{static{this.TEXT_EDITOR_SELECTION_THRESHOLD=10}constructor(e){this.textSelection=e}compare(e){if(!(e instanceof SP))return j_.DIFFERENT;const t=Math.min(this.textSelection.selectionStartLineNumber,this.textSelection.positionLineNumber),i=Math.min(e.textSelection.selectionStartLineNumber,e.textSelection.positionLineNumber);return t===i?j_.IDENTICAL:Math.abs(t-i)<SP.TEXT_EDITOR_SELECTION_THRESHOLD?j_.SIMILAR:j_.DIFFERENT}restore(e){return{...e,selection:this.textSelection,selectionRevealType:Cm.CenterIfOutsideViewport}}log(){return`line: ${this.textSelection.startLineNumber}-${this.textSelection.endLineNumber}, col:  ${this.textSelection.startColumn}-${this.textSelection.endColumn}`}}class nhe extends Bv{get originalModel(){return this._originalModel}get modifiedModel(){return this._modifiedModel}constructor(e,t){super(),this._originalModel=e,this._modifiedModel=t}async resolve(){await Promise.all([this._originalModel?.resolve(),this._modifiedModel?.resolve()])}isResolved(){return!!(this._originalModel?.isResolved()&&this._modifiedModel?.isResolved())}dispose(){super.dispose()}}class she extends nhe{get originalModel(){return this._originalModel}get modifiedModel(){return this._modifiedModel}get textDiffEditorModel(){return this._textDiffEditorModel}constructor(e,t){super(e,t),this._textDiffEditorModel=void 0,this._originalModel=e,this._modifiedModel=t,this.updateTextDiffEditorModel()}async resolve(){await super.resolve(),this.updateTextDiffEditorModel()}updateTextDiffEditorModel(){this.originalModel?.isResolved()&&this.modifiedModel?.isResolved()&&(this._textDiffEditorModel?(this._textDiffEditorModel.original=this.originalModel.textEditorModel,this._textDiffEditorModel.modified=this.modifiedModel.textEditorModel):this._textDiffEditorModel={original:this.originalModel.textEditorModel,modified:this.modifiedModel.textEditorModel})}isResolved(){return!!this._textDiffEditorModel}isReadonly(){return!!this.modifiedModel&&this.modifiedModel.isReadonly()}dispose(){this._textDiffEditorModel=void 0,super.dispose()}}var iT;let ro=class extends ws{static{iT=this}static{this.ID="workbench.editors.diffEditorInput"}get typeId(){return iT.ID}get editorId(){return this.modified.editorId===this.original.editorId?this.modified.editorId:void 0}get capabilities(){let e=super.capabilities;return this.labels.forceDescription&&(e|=Ze.ForceDescription),e}constructor(e,t,i,n,o,r){super(e,t,i,n,r),this.original=i,this.modified=n,this.forceOpenAsBinary=o,this.cachedModel=void 0,this.labels=this.computeLabels()}computeLabels(){let e,t=!1;if(this.preferredName)e=this.preferredName;else{const l=this.original.getName(),u=this.modified.getName();e=h(3881,"{0} ↔ {1}",l,u),t=l===u}let i,n,o;if(this.preferredDescription)i=this.preferredDescription,n=this.preferredDescription,o=this.preferredDescription;else{i=this.computeLabel(this.original.getDescription(Nt.SHORT),this.modified.getDescription(Nt.SHORT)),o=this.computeLabel(this.original.getDescription(Nt.LONG),this.modified.getDescription(Nt.LONG));const l=this.original.getDescription(Nt.MEDIUM),u=this.modified.getDescription(Nt.MEDIUM);if(typeof l=="string"&&typeof u=="string"&&(l||u)){const[g,m]=yne([l,u]);n=this.computeLabel(g,m)}}let r=this.computeLabel(this.original.getTitle(Nt.SHORT)??this.original.getName(),this.modified.getTitle(Nt.SHORT)??this.modified.getName()," ↔ "),a=this.computeLabel(this.original.getTitle(Nt.MEDIUM)??this.original.getName(),this.modified.getTitle(Nt.MEDIUM)??this.modified.getName()," ↔ "),c=this.computeLabel(this.original.getTitle(Nt.LONG)??this.original.getName(),this.modified.getTitle(Nt.LONG)??this.modified.getName()," ↔ ");const d=this.getPreferredTitle();return d&&(r=`${d} (${r})`,a=`${d} (${a})`,c=`${d} (${c})`),{name:e,shortDescription:i,mediumDescription:n,longDescription:o,forceDescription:t,shortTitle:r,mediumTitle:a,longTitle:c}}computeLabel(e,t,i=" - "){if(!(!e||!t))return e===t?t:`${e}${i}${t}`}getName(){return this.labels.name}getDescription(e=Nt.MEDIUM){switch(e){case Nt.SHORT:return this.labels.shortDescription;case Nt.LONG:return this.labels.longDescription;case Nt.MEDIUM:default:return this.labels.mediumDescription}}getTitle(e){switch(e){case Nt.SHORT:return this.labels.shortTitle;case Nt.LONG:return this.labels.longTitle;default:case Nt.MEDIUM:return this.labels.mediumTitle}}async resolve(){const e=await this.createModel();return this.cachedModel?.dispose(),this.cachedModel=e,this.cachedModel}prefersEditorPane(e){return this.forceOpenAsBinary?e.find(t=>t.typeId===lCe):e.find(t=>t.typeId===Jq)}async createModel(){const[e,t]=await Promise.all([this.original.resolve(),this.modified.resolve()]);return t instanceof YF&&e instanceof YF?new she(e,t):new nhe(D7(e)?e:void 0,D7(t)?t:void 0)}toUntyped(e){const t=super.toUntyped(e);if(t)return{...t,modified:t.primary,original:t.secondary}}matches(e){return this===e?!0:e instanceof iT?this.modified.matches(e.modified)&&this.original.matches(e.original)&&e.forceOpenAsBinary===this.forceOpenAsBinary:K_(e)?this.modified.matches(e.modified)&&this.original.matches(e.original):!1}dispose(){this.cachedModel&&(this.cachedModel.dispose(),this.cachedModel=void 0),super.dispose()}};ro=iT=f([p(5,de)],ro);class zYe extends ihe{createEditorInput(e,t,i,n,o){return e.createInstance(ro,t,i,n,o,void 0)}}var vU;let Gb=class extends mU{static{vU=this}static{this.ID=Jq}get scopedContextKeyService(){if(!this.diffEditorControl)return;const e=this.diffEditorControl.getOriginalEditor(),t=this.diffEditorControl.getModifiedEditor();return(e.hasTextFocus()?e:t).invokeWithinContext(i=>i.get(me))}constructor(e,t,i,n,o,r,a,c,d,l){super(vU.ID,e,t,i,n,o,a,r,c,d),this.preferencesService=l,this.diffEditorControl=void 0,this.inputLifecycleStopWatch=void 0,this._previousViewModel=null}getTitle(){return this.input?this.input.getName():h(3350,"Text Diff Editor")}createEditorControl(e,t){this.diffEditorControl=this._register(this.instantiationService.createInstance(og,e,t,{}))}updateEditorControlOptions(e){this.diffEditorControl?.updateOptions(e)}getMainControl(){return this.diffEditorControl?.getModifiedEditor()}async setInput(e,t,i,n){this._previousViewModel&&(this._previousViewModel.dispose(),this._previousViewModel=null),this.inputLifecycleStopWatch=void 0,await super.setInput(e,t,i,n);try{const o=await e.resolve();if(n.isCancellationRequested)return;if(!(o instanceof she)){this.openAsBinary(e,t);return}const r=Gt(this.diffEditorControl),a=o,c=a.textDiffEditorModel?r.createViewModel(a.textDiffEditorModel):null;this._previousViewModel=c,await c?.waitForDiff(),r.setModel(c);let d=!1;Vse(t?.viewState)||(d=this.restoreTextDiffEditorViewState(e,t,i,r));let l=!1;t&&(l=tB(t,r,ji.Immediate)),!l&&!d&&r.revealFirstDiff(),r.updateOptions({...this.getReadonlyConfiguration(a.modifiedModel?.isReadonly()),originalEditable:!a.originalModel?.isReadonly()}),r.handleInitialized(),this.inputLifecycleStopWatch=new zn(!1)}catch(o){await this.handleSetInputError(o,e,t)}}async handleSetInputError(e,t,i){if(this.isFileBinaryError(e))return this.openAsBinary(t,i);if(e.fileOperationResult===$n.FILE_TOO_LARGE){let n;throw e instanceof u_e?n=h(3351,"At least one file is not displayed in the text compare editor because it is very large ({0}).",Fo.formatSize(e.size)):n=h(3352,"At least one file is not displayed in the text compare editor because it is very large."),hCe(this.group,t,i,n,this.preferencesService)}throw e}restoreTextDiffEditorViewState(e,t,i,n){const o=this.loadEditorViewState(e,i);return o?(t?.selection&&o.modified&&(o.modified.cursorState=[]),n.restoreViewState(o),t?.revealIfVisible&&n.revealFirstDiff(),!0):!1}openAsBinary(e,t){const i=e.original,n=e.modified,o=this.instantiationService.createInstance(ro,e.getName(),e.getDescription(),i,n,!0),r=Ge.as(Zm.EditorFactory).getFileEditorFactory();r.isFileEditor(i)&&i.setForceOpenAsBinary(),r.isFileEditor(n)&&n.setForceOpenAsBinary(),this.group.replaceEditors([{editor:e,replacement:o,options:{...t,activation:Yc.PRESERVE,pinned:this.group.isPinned(e),sticky:this.group.isSticky(e)}}])}setOptions(e){super.setOptions(e),e&&tB(e,Gt(this.diffEditorControl),ji.Smooth)}shouldHandleConfigurationChangeEvent(e,t){return super.shouldHandleConfigurationChangeEvent(e,t)?!0:e.affectsConfiguration(t,"diffEditor")||e.affectsConfiguration(t,"accessibility.verbosity.diffEditor")}computeConfiguration(e){const t=super.computeConfiguration(e);if(oa(e.diffEditor)){const n=Cr(e.diffEditor);n.diffCodeLens=n.codeLens,delete n.codeLens,n.diffWordWrap=n.wordWrap,delete n.wordWrap,Object.assign(t,n)}const i=e.accessibility?.verbosity?.diffEditor??!1;return t.accessibilityVerbose=i,t}getConfigurationOverrides(e){return{...super.getConfigurationOverrides(e),...this.getReadonlyConfiguration(this.input?.isReadonly()),originalEditable:this.input instanceof ro&&!this.input.original.isReadonly(),lineDecorationsWidth:"2ch"}}updateReadonly(e){e instanceof ro?this.diffEditorControl?.updateOptions({...this.getReadonlyConfiguration(e.isReadonly()),originalEditable:!e.original.isReadonly()}):super.updateReadonly(e)}isFileBinaryError(e){return Array.isArray(e)?e.some(i=>this.isFileBinaryError(i)):e.textFileOperationResult===jse.FILE_IS_BINARY}clearInput(){this._previousViewModel&&(this._previousViewModel.dispose(),this._previousViewModel=null),super.clearInput();const e=this.inputLifecycleStopWatch?.elapsed();this.inputLifecycleStopWatch=void 0,typeof e=="number"&&this.logInputLifecycleTelemetry(e,this.getControl()?.getModel()?.modified?.getLanguageId()),this.diffEditorControl?.setModel(null)}logInputLifecycleTelemetry(e,t){let i=!1;this.diffEditorControl instanceof og&&(i=this.diffEditorControl.collapseUnchangedRegions),this.telemetryService.publicLog2("diffEditor.editorVisibleTime",{editorVisibleTimeMs:e,languageId:t??"",collapseUnchangedRegions:i})}getControl(){return this.diffEditorControl}focus(){super.focus(),this.diffEditorControl?.focus()}hasFocus(){return this.diffEditorControl?.hasTextFocus()||super.hasFocus()}setEditorVisible(e){super.setEditorVisible(e),e?this.diffEditorControl?.onVisible():this.diffEditorControl?.onHide()}layout(e){this.diffEditorControl?.layout(e)}setBoundarySashes(e){this.diffEditorControl?.setBoundarySashes(e)}tracksEditorViewState(e){return e instanceof ro}computeEditorViewState(e){if(!this.diffEditorControl)return;const t=this.diffEditorControl.getModel();if(!t||!t.modified||!t.original)return;const i=this.toEditorViewStateResource(t);if(i&&Dt(i,e))return this.diffEditorControl.saveViewState()??void 0}toEditorViewStateResource(e){let t,i;if(e instanceof ro?(t=e.original.resource,i=e.modified.resource):bC(e)||(t=e.original.uri,i=e.modified.uri),!(!t||!i))return R.from({scheme:"diff",path:`${IE(t.toString())}${IE(i.toString())}`})}};Gb=vU=f([p(1,li),p(2,J),p(3,tt),p(4,Xo),p(5,de),p(6,ft),p(7,Ie),p(8,Xe),p(9,Fv)],Gb);function Nm(s,e,t=cl){if(t===cl||t===xr)return t;let i=s.getGroups(Ko.GRID_APPEARANCE)[t];if(!i&&t<9){for(let n=0;n<=t;n++){const o=s.getGroups(Ko.GRID_APPEARANCE);o[n]||s.addGroup(o[n-1],Vv(e))}i=s.getGroups(Ko.GRID_APPEARANCE)[t]}return i?.id??xr}function Jp(s,e){const t=typeof e=="number"?s.getGroup(e):e;return s.getGroups(Ko.GRID_APPEARANCE).indexOf(t??s.activeGroup)}const yZ="toggle.diff.renderSideBySide",wZ="workbench.action.compareEditor.nextChange",SZ="workbench.action.compareEditor.previousChange",ohe="workbench.action.compareEditor.focusPrimarySide",rhe="workbench.action.compareEditor.focusSecondarySide",ahe="workbench.action.compareEditor.focusOtherSide",mOe="workbench.action.compareEditor.openSide",vOe="toggle.diff.ignoreTrimWhitespace",CZ="workbench.action.compareEditor.swapSides";function _Oe(){Le.registerCommandAndKeybindingRule({id:wZ,weight:W.WorkbenchContrib,when:QF,primary:E.Alt|S.F5,handler:(a,...c)=>e(a,c,!0)}),ge.appendMenuItem(N.CommandPalette,{command:{id:wZ,title:I(2965,"Go to Next Change")}}),Le.registerCommandAndKeybindingRule({id:SZ,weight:W.WorkbenchContrib,when:QF,primary:E.Alt|E.Shift|S.F5,handler:(a,...c)=>e(a,c,!1)}),ge.appendMenuItem(N.CommandPalette,{command:{id:SZ,title:I(2966,"Go to Previous Change")}});function s(a,c){const d=a.get(de),l=c.length>0&&c[0]instanceof R?c[0]:void 0;for(const u of[d.activeEditorPane,...d.visibleEditorPanes])if(u instanceof Gb&&(!l||u.input instanceof ro&&Dt(u.input.primary.resource,l)))return u}function e(a,c,d){const l=s(a,c);l&&l.getControl()?.goToDiff(d?"next":"previous")}let t;(function(a){a[a.Original=0]="Original",a[a.Modified=1]="Modified",a[a.Toggle=2]="Toggle"})(t||(t={}));function i(a,c,d){const l=s(a,c);if(l)switch(d){case t.Original:l.getControl()?.getOriginalEditor().focus();break;case t.Modified:l.getControl()?.getModifiedEditor().focus();break;case t.Toggle:return l.getControl()?.getModifiedEditor().hasWidgetFocus()?i(a,c,t.Original):i(a,c,t.Modified)}}function n(a,c){const d=a.get(Xo),u=s(a,c)?.getControl()?.getModifiedEditor()?.getModel();if(!u)return;const g="diffEditor.renderSideBySide",m=d.getValue(u.uri,g);d.updateValue(u.uri,g,!m)}function o(a,c){const d=a.get(Xo),u=s(a,c)?.getControl()?.getModifiedEditor()?.getModel();if(!u)return;const g="diffEditor.ignoreTrimWhitespace",m=d.getValue(u.uri,g);d.updateValue(u.uri,g,!m)}async function r(a,c){const d=a.get(de),l=s(a,c),u=l?.group,g=l?.input;if(!l||typeof u>"u"||!(g instanceof ro)||!g.modified.resource)return;const m=g.toUntyped({preserveViewState:u.id,preserveResource:!0});if(m){if(g.modified.isModified()&&d.findEditors({resource:g.modified.resource,typeId:g.modified.typeId,editorId:g.modified.editorId}).length===0){const v={...m.modified};v.options||(v.options={}),v.options.pinned=!0,v.options.inactive=!0,await d.openEditor(v,u)}await d.replaceEditors([{editor:g,replacement:{...m,original:m.modified,modified:m.original,options:{...m.options,pinned:!0}}}],u)}}Le.registerCommandAndKeybindingRule({id:yZ,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>n(a,c)}),Le.registerCommandAndKeybindingRule({id:ohe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>i(a,c,t.Modified)}),Le.registerCommandAndKeybindingRule({id:rhe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>i(a,c,t.Original)}),Le.registerCommandAndKeybindingRule({id:ahe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>i(a,c,t.Toggle)}),Le.registerCommandAndKeybindingRule({id:vOe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>o(a,c)}),Le.registerCommandAndKeybindingRule({id:CZ,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>r(a,c)}),ge.appendMenuItem(N.CommandPalette,{command:{id:yZ,title:I(2967,"Toggle Inline View"),category:h(2968,"Compare")},when:Lb}),ge.appendMenuItem(N.CommandPalette,{command:{id:CZ,title:I(2969,"Swap Left and Right Editor Side"),category:h(2968,"Compare")},when:x.and(Lb,Yse)})}function Rs(s,e,t,i){const n=bOe(s,e,t,i),o=n.length&&n[0].preserveFocus||!1,r={groupedEditors:[],preserveFocus:o};for(const a of n){const c=SOe(a,t);if(!c)continue;const{group:d,editor:l}=c;let u;for(const g of r.groupedEditors)if(g.group.id===d.id){u=g;break}u||(u={group:d,editors:[]},r.groupedEditors.push(u)),l&&u.editors.push(l)}return r}function bOe(s,e,t,i){const n=i.lastFocusedList;let o=n instanceof Dv&&n.getHTMLElement()===Eh(),r=wOe(s,o,e,t,i);if(!r){const c=t.activeGroup,d=c.activeEditor;r={groupId:c.id,editorIndex:d?c.getIndexOfEditor(d):void 0},o=!1}const a=che(r,o,e,t,i);return yOe(r,a)}function yOe(s,e){if(e.length<=1)return e;const t=e.findIndex(i=>i.groupId===s.groupId&&i.editorIndex===s.editorIndex);if(t!==-1)e.splice(t,1),e.unshift(s);else if(s.editorIndex===void 0)e.unshift(s);else throw new Error("Editor context not found in multi editor context");return e}function wOe(s,e,t,i,n){const o=s.filter(r=>g6(r)||R.isUri(r));for(const r of o)if(g6(r))return r;for(const r of o){const a=t.findEditors(r);if(a.length){const c=a[0],d=i.getGroup(c.groupId);return{groupId:c.groupId,editorIndex:d?.getIndexOfEditor(c.editor)}}}if(e){const r=n.lastFocusedList;for(const a of r.getFocusedElements())if(dhe(a))return _U(a,void 0,i)}}function che(s,e,t,i,n){if(e){const r=n.lastFocusedList.getSelectedElements().filter(dhe);if(r.length>1)return r.map(a=>_U(a,s.preserveFocus,i));if(r.length===0)return che(s,!1,t,i,n)}else{const o=i.getGroup(s.groupId),r=s.editorIndex!==void 0?o?.getEditorByIndex(s.editorIndex):o?.activeEditor;if(o&&r&&o.isSelected(r))return o.selectedEditors.map(a=>_U({editor:a,groupId:o.id},s.preserveFocus,i))}return[s]}function _U(s,e,t){if(Yq(s))return{groupId:s.id,editorIndex:void 0,preserveFocus:e};const i=t.getGroup(s.groupId);return{groupId:s.groupId,editorIndex:i?i.getIndexOfEditor(s.editor):-1,preserveFocus:e}}function dhe(s){return Yq(s)||XF(s)}function SOe(s,e){const t=e.getGroup(s.groupId);if(!t)return;if(s.editorIndex===void 0)return{group:t,editor:void 0};const i=t.getEditorByIndex(s.editorIndex);return{group:t,editor:i}}const lhe="workbench.action.closeUnmodifiedEditors",hhe="workbench.action.closeEditorsInGroup",uhe="workbench.action.closeEditorsAndGroup",COe="workbench.action.closeEditorsToTheRight",iS="workbench.action.closeActiveEditor",EOe="workbench.action.closeActivePinnedEditor",xOe="workbench.action.closeGroup",ghe="workbench.action.closeOtherEditors",Tl="moveActiveEditor",Rg="copyActiveEditor",Pg="layoutEditorGroups",IOe="workbench.action.keepEditor",DOe="workbench.action.toggleKeepEditors",kOe="workbench.action.toggleEditorGroupLock",TOe="workbench.action.lockEditorGroup",jO="workbench.action.unlockEditorGroup",AOe="workbench.action.showEditorsInGroup",phe="workbench.action.reopenWithEditor",ROe="reopenActiveEditorWith",POe="workbench.action.pinEditor",f4="workbench.action.unpinEditor",fhe="workbench.action.splitEditor",bU="workbench.action.splitEditorUp",yU="workbench.action.splitEditorDown",wU="workbench.action.splitEditorLeft",SU="workbench.action.splitEditorRight",mhe="workbench.action.toggleMaximizeEditorGroup",LOe="workbench.action.splitEditorInGroup",MOe="workbench.action.toggleSplitEditorInGroup",NOe="workbench.action.joinEditorInGroup",OOe="workbench.action.toggleSplitEditorInGroupLayout",FOe="workbench.action.focusFirstSideEditor",WOe="workbench.action.focusSecondSideEditor",BOe="workbench.action.focusOtherSideEditor",VOe="workbench.action.focusLeftGroupWithoutWrap",HOe="workbench.action.focusRightGroupWithoutWrap",UOe="workbench.action.focusAboveGroupWithoutWrap",$Oe="workbench.action.focusBelowGroupWithoutWrap",EZ="workbench.action.openEditorAtIndex",GOe="workbench.action.moveEditorToNewWindow",qOe="workbench.action.copyEditorToNewWindow",zOe="workbench.action.moveEditorGroupToNewWindow",KOe="workbench.action.copyEditorGroupToNewWindow",jOe="workbench.action.newEmptyEditorWindow",xZ="_workbench.open",IZ="_workbench.diff",YOe="_workbench.openWith",QOe=[fhe,iS,f4,jO,mhe],DZ=function(s){return!(!oa(s)||!It(s.to)||!Gm(s.by)&&!It(s.by)||!Gm(s.value)&&!Ja(s.value))};function XOe(){const s={type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right"]},by:{type:"string",enum:["tab","group"]},value:{type:"number"}}};Le.registerCommandAndKeybindingRule({id:Tl,weight:W.WorkbenchContrib,when:V.editorTextFocus,primary:0,handler:(o,r)=>e(!0,r,o),metadata:{description:h(3224,"Move the active editor by tabs or groups"),args:[{name:h(3225,"Active editor move argument"),description:h(3226,`Argument Properties:
	* 'to': String value providing where to move.
	* 'by': String value providing the unit for move (by tab or by group).
	* 'value': Number value providing how many positions or an absolute position to move.`),constraint:DZ,schema:s}]}}),Le.registerCommandAndKeybindingRule({id:Rg,weight:W.WorkbenchContrib,when:V.editorTextFocus,primary:0,handler:(o,r)=>e(!1,r,o),metadata:{description:h(3227,"Copy the active editor by groups"),args:[{name:h(3228,"Active editor copy argument"),description:h(3229,`Argument Properties:
	* 'to': String value providing where to copy.
	* 'value': Number value providing how many positions or an absolute position to copy.`),constraint:DZ,schema:s}]}});function e(o,r=Object.create(null),a){r.to=r.to||"right",r.by=r.by||"tab",r.value=typeof r.value=="number"?r.value:1;const c=a.get(Ie).activeGroup,d=c.selectedEditors;if(d.length>0)switch(r.by){case"tab":if(o)return t(r,c,d);break;case"group":return n(o,r,c,d,a)}}function t(o,r,a){const c=o.to;c==="first"||c==="right"?a=[...a].reverse():c==="position"&&(o.value??1)<r.getIndexOfEditor(a[0])&&(a=[...a].reverse());for(const d of a)i(o,r,d)}function i(o,r,a){let c=r.getIndexOfEditor(a);switch(o.to){case"first":c=0;break;case"last":c=r.count-1;break;case"left":c=c-(o.value??1);break;case"right":c=c+(o.value??1);break;case"center":c=Math.round(r.count/2)-1;break;case"position":c=(o.value??1)-1;break}c=c<0?0:c>=r.count?r.count-1:c,r.moveEditor(a,r,{index:c})}function n(o,r,a,c,d){const l=d.get(Ie),u=d.get(ne);let g;switch(r.to){case"left":g=l.findGroup({direction:Xt.LEFT},a),g||(g=l.addGroup(a,Xt.LEFT));break;case"right":g=l.findGroup({direction:Xt.RIGHT},a),g||(g=l.addGroup(a,Xt.RIGHT));break;case"up":g=l.findGroup({direction:Xt.UP},a),g||(g=l.addGroup(a,Xt.UP));break;case"down":g=l.findGroup({direction:Xt.DOWN},a),g||(g=l.addGroup(a,Xt.DOWN));break;case"first":g=l.findGroup({location:Xa.FIRST},a);break;case"last":g=l.findGroup({location:Xa.LAST},a);break;case"previous":g=l.findGroup({location:Xa.PREVIOUS},a);break;case"next":g=l.findGroup({location:Xa.NEXT},a),g||(g=l.addGroup(a,Vv(u)));break;case"center":g=l.getGroups(Ko.GRID_APPEARANCE)[l.count/2-1];break;case"position":g=l.getGroups(Ko.GRID_APPEARANCE)[(r.value??1)-1];break}if(g){const m=bz(a,c);o?a.moveEditors(m,g):a.id!==g.id&&a.copyEditors(m,g),g.focus()}}}function ZOe(){function s(e,t){if(!t||typeof t!="object")return;e.get(Ie).applyLayout(t)}Ce.registerCommand(Pg,(e,t)=>{s(e,t)}),Ce.registerCommand({id:"vscode.setEditorLayout",handler:(e,t)=>s(e,t),metadata:{description:`Set the editor layout. Editor layout is represented as a tree of groups in which the first group is the root group of the layout.
					The orientation of the first group is 0 (horizontal) by default unless specified otherwise. The other orientations are 1 (vertical).
					The orientation of subsequent groups is the opposite of the orientation of the group that contains it.
					Here are some examples: A layout representing 1 row and 2 columns: { orientation: 0, groups: [{}, {}] }.
					A layout representing 3 rows and 1 column: { orientation: 1, groups: [{}, {}, {}] }.
					A layout representing 3 rows and 1 column in which the second row has 2 columns: { orientation: 1, groups: [{}, { groups: [{}, {}] }, {}] }
					`,args:[{name:"args",schema:{type:"object",required:["groups"],properties:{orientation:{type:"number",default:0,description:"The orientation of the root group in the layout. 0 for horizontal, 1 for vertical.",enum:[0,1],enumDescriptions:[h(3230,"Horizontal"),h(3231,"Vertical")]},groups:{$ref:"#/definitions/editorGroupsSchema",default:[{},{}]}}}}]}}),Ce.registerCommand({id:"vscode.getEditorLayout",handler:e=>e.get(Ie).getLayout(),metadata:{description:"Get Editor Layout",args:[],returns:"An editor layout object, in the same format as vscode.setEditorLayout"}})}function JOe(){function s(e,t,i){return e?[{...e.editorOptions,...t??Object.create(null)},e.sideBySide?xr:i]:[t,i]}Ce.registerCommand({id:"vscode.open",handler:(e,t)=>{e.get(qe).executeCommand(xZ,t)},metadata:{description:"Opens the provided resource in the editor.",args:[{name:"Uri"}]}}),Ce.registerCommand(xZ,async function(e,t,i,n,o){const r=e.get(de),a=e.get(Ie),c=e.get(hi),d=e.get(_c),l=e.get(ne),u=e.get(Qq),g=typeof t=="string"?t:R.from(t,!0),[m,v]=i??[];if(v||typeof m=="number"||DE(g,ae.untitled)){const[y,w]=s(o,v,m),C=R.isUri(g)?g:R.parse(g);let T;u.isUntitledWithAssociatedResource(C)?T={resource:C.with({scheme:d.defaultUriScheme}),forceUntitled:!0,options:y,label:n}:T={resource:C,options:y,label:n},await r.openEditor(T,Nm(a,l,w))}else{if(DE(g,ae.command))return;await c.open(g,{openToSide:o?.sideBySide,editorOptions:o?.editorOptions})}}),Ce.registerCommand({id:"vscode.diff",handler:(e,t,i,n)=>{e.get(qe).executeCommand(IZ,t,i,n)},metadata:{description:"Opens the provided resources in the diff editor to compare their contents.",args:[{name:"left",description:"Left-hand side resource of the diff editor"},{name:"right",description:"Right-hand side resource of the diff editor"},{name:"title",description:"Human readable title for the diff editor"}]}}),Ce.registerCommand(IZ,async function(e,t,i,n,o,r){const a=e.get(de),c=e.get(Ie),d=e.get(ne),[l,u]=o??[],[g,m]=s(r,u,l);let v,y;typeof n=="string"?v=n:n&&(v=n.label,y=n.description),await a.openEditor({original:{resource:R.from(t,!0)},modified:{resource:R.from(i,!0)},label:v,description:y,options:g},Nm(c,d,m))}),Ce.registerCommand(YOe,async(e,t,i,n)=>{const o=e.get(de),r=e.get(Ie),a=e.get(ne),[c,d]=n??[];await o.openEditor({resource:R.from(t,!0),options:{pinned:!0,...d,override:i}},Nm(r,a,c))}),Ce.registerCommand({id:"vscode.changes",handler:(e,t,i)=>{e.get(qe).executeCommand("_workbench.changes",t,i)},metadata:{description:"Opens a list of resources in the changes editor to compare their contents.",args:[{name:"title",description:"Human readable title for the diff editor"},{name:"resources",description:"List of resources to open in the changes editor"}]}}),Ce.registerCommand("_workbench.changes",async(e,t,i)=>{const n=e.get(de),o=[];for(const[r,a,c]of i)o.push({resource:R.revive(r),original:{resource:R.revive(a)},modified:{resource:R.revive(c)}});await n.openEditor({resources:o,label:t})}),Ce.registerCommand("_workbench.openMultiDiffEditor",async(e,t)=>{await e.get(de).openEditor({multiDiffSource:t.multiDiffSourceUri?R.revive(t.multiDiffSourceUri):void 0,resources:t.resources?.map(n=>({original:{resource:R.revive(n.originalUri)},modified:{resource:R.revive(n.modifiedUri)}})),label:t.title})})}function e1e(){const s=(t,i)=>{const n=t.get(de),o=n.activeEditorPane;if(o){const r=o.group.getEditorByIndex(i);r&&n.openEditor(r)}};Ce.registerCommand({id:EZ,handler:s});for(let t=0;t<9;t++){const i=t,n=t+1;Le.registerCommandAndKeybindingRule({id:EZ+n,weight:W.WorkbenchContrib,when:void 0,primary:E.Alt|e(n),mac:{primary:E.WinCtrl|e(n)},handler:o=>s(o,i)})}function e(t){switch(t){case 0:return S.Digit0;case 1:return S.Digit1;case 2:return S.Digit2;case 3:return S.Digit3;case 4:return S.Digit4;case 5:return S.Digit5;case 6:return S.Digit6;case 7:return S.Digit7;case 8:return S.Digit8;case 9:return S.Digit9}throw new Error("invalid index")}}function t1e(){for(let t=1;t<8;t++)Le.registerCommandAndKeybindingRule({id:s(t),weight:W.WorkbenchContrib,when:void 0,primary:E.CtrlCmd|e(t),handler:i=>{const n=i.get(Ie),o=i.get(ne);if(t>n.count)return;const r=n.getGroups(Ko.GRID_APPEARANCE);if(r[t])return r[t].focus();const a=Vv(o),c=n.findGroup({location:Xa.LAST});if(!c)return;n.addGroup(c,a).focus()}});function s(t){switch(t){case 1:return"workbench.action.focusSecondEditorGroup";case 2:return"workbench.action.focusThirdEditorGroup";case 3:return"workbench.action.focusFourthEditorGroup";case 4:return"workbench.action.focusFifthEditorGroup";case 5:return"workbench.action.focusSixthEditorGroup";case 6:return"workbench.action.focusSeventhEditorGroup";case 7:return"workbench.action.focusEighthEditorGroup"}throw new Error("Invalid index")}function e(t){switch(t){case 1:return S.Digit2;case 2:return S.Digit3;case 3:return S.Digit4;case 4:return S.Digit5;case 5:return S.Digit6;case 6:return S.Digit7;case 7:return S.Digit8}throw new Error("Invalid index")}}function vhe(s,e,t){if(!t.groupedEditors.length)return;const{group:i,editors:n}=t.groupedEditors[0],o=t.preserveFocus,r=s.addGroup(i,e);for(const a of n)a&&!a.hasCapability(Ze.Singleton)&&i.copyEditor(a,r,{preserveFocus:o});r.focus()}function i1e(){[{id:bU,direction:Xt.UP},{id:yU,direction:Xt.DOWN},{id:wU,direction:Xt.LEFT},{id:SU,direction:Xt.RIGHT}].forEach(({id:s,direction:e})=>{Ce.registerCommand(s,function(t,...i){const n=Rs(i,t.get(de),t.get(Ie),t.get(Si));vhe(t.get(Ie),e,n)})})}function n1e(){function s(t,i,...n){const o=t.get(Ie),r=t.get(de);let a;if(i||n.length?a=!1:a=o.partOptions.preventPinnedEditorClose==="keyboard"||o.partOptions.preventPinnedEditorClose==="keyboardAndMouse",a){const l=o.activeGroup,u=l.activeEditor;if(u&&l.isSticky(u)){const g=l.getEditors(Ai.MOST_RECENTLY_ACTIVE,{excludeSticky:!0})[0];if(g)return l.openEditor(g);const m=r.getEditors(Ai.MOST_RECENTLY_ACTIVE,{excludeSticky:!0})[0];if(m)return Promise.resolve(o.getGroup(m.groupId)?.openEditor(m.editor))}}const c=Rs(n,t.get(de),t.get(Ie),t.get(Si)),d=c.preserveFocus;return Promise.all(c.groupedEditors.map(async({group:l,editors:u})=>{const g=u.filter(m=>!a||!l.isSticky(m));await l.closeEditors(g,{preserveFocus:d})}))}Le.registerCommandAndKeybindingRule({id:iS,weight:W.WorkbenchContrib,when:void 0,primary:E.CtrlCmd|S.KeyW,win:{primary:E.CtrlCmd|S.F4,secondary:[E.CtrlCmd|S.KeyW]},handler:(t,...i)=>s(t,!1,...i)}),Ce.registerCommand(EOe,(t,...i)=>s(t,!0,...i)),Le.registerCommandAndKeybindingRule({id:hhe,weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.KeyW),handler:(t,...i)=>{const n=Rs(i,t.get(de),t.get(Ie),t.get(Si));return Promise.all(n.groupedEditors.map(async({group:o})=>{await o.closeAllEditors({excludeSticky:!0})}))}}),Le.registerCommandAndKeybindingRule({id:xOe,weight:W.WorkbenchContrib,when:x.and(ez,vN),primary:E.CtrlCmd|S.KeyW,win:{primary:E.CtrlCmd|S.F4,secondary:[E.CtrlCmd|S.KeyW]},handler:(t,...i)=>{const n=t.get(Ie),o=Rs(i,t.get(de),n,t.get(Si));o.groupedEditors.length&&n.removeGroup(o.groupedEditors[0].group)}}),Le.registerCommandAndKeybindingRule({id:lhe,weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.KeyU),handler:(t,...i)=>{const n=Rs(i,t.get(de),t.get(Ie),t.get(Si));return Promise.all(n.groupedEditors.map(async({group:o})=>{await o.closeEditors({savedOnly:!0,excludeSticky:!0},{preserveFocus:n.preserveFocus})}))}}),Le.registerCommandAndKeybindingRule({id:ghe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,mac:{primary:E.CtrlCmd|E.Alt|S.KeyT},handler:(t,...i)=>{const n=Rs(i,t.get(de),t.get(Ie),t.get(Si));return Promise.all(n.groupedEditors.map(async({group:o,editors:r})=>{const a=o.getEditors(Ai.SEQUENTIAL,{excludeSticky:!0}).filter(c=>!r.includes(c));for(const c of r)c&&o.pinEditor(c);await o.closeEditors(a,{preserveFocus:n.preserveFocus})}))}}),Le.registerCommandAndKeybindingRule({id:COe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:async(t,...i)=>{const n=Rs(i,t.get(de),t.get(Ie),t.get(Si));if(n.groupedEditors.length){const{group:o,editors:r}=n.groupedEditors[0];o.activeEditor&&o.pinEditor(o.activeEditor),await o.closeEditors({direction:tz.RIGHT,except:r[0],excludeSticky:!0},{preserveFocus:n.preserveFocus})}}}),Le.registerCommandAndKeybindingRule({id:phe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(t,...i)=>e(t,jT.PICK,...i)}),Le.registerCommandAndKeybindingRule({id:ROe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(t,i,...n)=>e(t,i??jT.PICK,...n)});async function e(t,i,...n){const o=t.get(de),r=t.get(vf),a=t.get(li),c=Rs(n,o,t.get(Ie),t.get(Si)),d=new Map;for(const{group:l,editors:u}of c.groupedEditors)for(const g of u){const m=g.toUntyped();if(!m)return;m.options={...o.activeEditorPane?.options,override:i};const v=await r.resolveEditor(m,l);if(!uCe(v))return;let y=d.get(l);y||(y=[],d.set(l,y)),y.push({editor:g,replacement:v.editor,forceReplaceDirty:g.resource?.scheme===ae.untitled,options:v.options}),a.publicLog2("workbenchEditorReopen",{scheme:g.resource?.scheme??"",ext:g.resource?jM(g.resource):"",from:g.editorId??"",to:v.editor.editorId??""})}for(const[l,u]of d)await l.replaceEditors(u),await l.openEditor(u[0].replacement)}Ce.registerCommand(uhe,async(t,...i)=>{const n=t.get(Ie),o=Rs(i,t.get(de),n,t.get(Si));if(o.groupedEditors.length){const{group:r}=o.groupedEditors[0];await r.closeAllEditors(),r.count===0&&n.getGroup(r.id)&&n.removeGroup(r)}})}function s1e(){const s=[{id:VOe,direction:Xt.LEFT},{id:HOe,direction:Xt.RIGHT},{id:UOe,direction:Xt.UP},{id:$Oe,direction:Xt.DOWN}];for(const e of s)Ce.registerCommand(e.id,async t=>{const i=t.get(Ie);(i.findGroup({direction:e.direction},i.activeGroup,!1)??i.activeGroup).focus()})}function o1e(){async function s(t,i){const n=t.get(J);if(!i.groupedEditors.length)return;const{group:o,editors:r}=i.groupedEditors[0],a=r[0];a&&await o.replaceEditors([{editor:a,replacement:n.createInstance(ws,void 0,void 0,a,a),forceReplaceDirty:!0}])}K(class extends X{constructor(){super({id:LOe,title:I(3232,"Split Editor in Group"),category:te.View,precondition:yC,f1:!0,keybinding:{weight:W.WorkbenchContrib,when:yC,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.Backslash)}})}run(t,...i){return s(t,Rs(i,t.get(de),t.get(Ie),t.get(Si)))}});async function e(t){if(!t.groupedEditors.length)return;const{group:i,editors:n}=t.groupedEditors[0],o=n[0];if(!o||!(o instanceof ws))return;let r;const a=i.activeEditorPane;if(a instanceof Tp&&i.activeEditor===o){for(const c of[a.getPrimaryEditorPane(),a.getSecondaryEditorPane()])if(c?.hasFocus()){r={viewState:c.getViewState()};break}}await i.replaceEditors([{editor:o,replacement:o.primary,options:r}])}K(class extends X{constructor(){super({id:NOe,title:I(3233,"Join Editor in Group"),category:te.View,precondition:Cu,f1:!0,keybinding:{weight:W.WorkbenchContrib,when:Cu,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.Backslash)}})}run(t,...i){return e(Rs(i,t.get(de),t.get(Ie),t.get(Si)))}}),K(class extends X{constructor(){super({id:MOe,title:I(3234,"Toggle Split Editor in Group"),category:te.View,precondition:x.or(yC,Cu),f1:!0})}async run(t,...i){const n=Rs(i,t.get(de),t.get(Ie),t.get(Si));if(!n.groupedEditors.length)return;const{editors:o}=n.groupedEditors[0];o[0]instanceof ws?await e(n):o[0]&&await s(t,n)}}),K(class extends X{constructor(){super({id:OOe,title:I(3235,"Toggle Layout of Split Editor in Group"),category:te.View,precondition:Cu,f1:!0})}async run(t){const i=t.get(ne),n=i.getValue(Tp.SIDE_BY_SIDE_LAYOUT_SETTING);let o;return n!=="horizontal"?o="horizontal":o="vertical",i.updateValue(Tp.SIDE_BY_SIDE_LAYOUT_SETTING,o)}})}function r1e(){K(class extends X{constructor(){super({id:FOe,title:I(3236,"Focus First Side in Active Editor"),category:te.View,precondition:x.or(Cu,Lb),f1:!0})}async run(s){const e=s.get(de),t=s.get(qe),i=e.activeEditorPane;i instanceof Tp?i.getSecondaryEditorPane()?.focus():i instanceof Gb&&await t.executeCommand(rhe)}}),K(class extends X{constructor(){super({id:WOe,title:I(3237,"Focus Second Side in Active Editor"),category:te.View,precondition:x.or(Cu,Lb),f1:!0})}async run(s){const e=s.get(de),t=s.get(qe),i=e.activeEditorPane;i instanceof Tp?i.getPrimaryEditorPane()?.focus():i instanceof Gb&&await t.executeCommand(ohe)}}),K(class extends X{constructor(){super({id:BOe,title:I(3238,"Focus Other Side in Active Editor"),category:te.View,precondition:x.or(Cu,Lb),f1:!0})}async run(s){const e=s.get(de),t=s.get(qe),i=e.activeEditorPane;i instanceof Tp?i.getPrimaryEditorPane()?.hasFocus()?i.getSecondaryEditorPane()?.focus():i.getPrimaryEditorPane()?.focus():i instanceof Gb&&await t.executeCommand(ahe)}})}function a1e(){Le.registerCommandAndKeybindingRule({id:IOe,weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.Enter),handler:async(e,...t)=>{const i=Rs(t,e.get(de),e.get(Ie),e.get(Si));for(const{group:n,editors:o}of i.groupedEditors)for(const r of o)n.pinEditor(r)}}),Ce.registerCommand({id:DOe,handler:e=>{const t=e.get(ne),n=t.getValue("workbench.editor.enablePreview")!==!0;t.updateValue("workbench.editor.enablePreview",n)}});function s(e,t,...i){const o=Rs(i,e.get(de),e.get(Ie),e.get(Si)).groupedEditors[0]?.group;o?.lock(t??!o.isLocked)}K(class extends X{constructor(){super({id:kOe,title:I(3239,"Toggle Editor Group Lock"),category:te.View,f1:!0})}async run(e,...t){s(e,void 0,...t)}}),K(class extends X{constructor(){super({id:TOe,title:I(3240,"Lock Editor Group"),category:te.View,precondition:oA.toNegated(),f1:!0})}async run(e,...t){s(e,!0,...t)}}),K(class extends X{constructor(){super({id:jO,title:I(3241,"Unlock Editor Group"),precondition:oA,category:te.View,f1:!0})}async run(e,...t){s(e,!1,...t)}}),Le.registerCommandAndKeybindingRule({id:POe,weight:W.WorkbenchContrib,when:rA.toNegated(),primary:lt(E.CtrlCmd|S.KeyK,E.Shift|S.Enter),handler:async(e,...t)=>{const i=Rs(t,e.get(de),e.get(Ie),e.get(Si));for(const{group:n,editors:o}of i.groupedEditors)for(const r of o)n.stickEditor(r)}}),Le.registerCommandAndKeybindingRule({id:mOe,weight:W.WorkbenchContrib,when:V.inDiffEditor,primary:lt(E.CtrlCmd|S.KeyK,E.Shift|S.KeyO),handler:async e=>{const t=e.get(de),i=e.get(Ie),n=t.activeEditor,o=t.activeTextEditorControl;if(!$p(o)||!(n instanceof ro))return;let r;return o.getOriginalEditor().hasTextFocus()?r=n.original:r=n.modified,i.activeGroup.openEditor(r)}}),Le.registerCommandAndKeybindingRule({id:f4,weight:W.WorkbenchContrib,when:rA,primary:lt(E.CtrlCmd|S.KeyK,E.Shift|S.Enter),handler:async(e,...t)=>{const i=Rs(t,e.get(de),e.get(Ie),e.get(Si));for(const{group:n,editors:o}of i.groupedEditors)for(const r of o)n.unstickEditor(r)}}),Le.registerCommandAndKeybindingRule({id:AOe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(e,...t)=>{const i=e.get(Ie),n=e.get(zt),r=Rs(t,e.get(de),i,e.get(Si)).groupedEditors[0]?.group;return r&&i.activateGroup(r),n.quickAccess.show(qy.PREFIX)}})}function jYe(){XOe(),ZOe(),_Oe(),JOe(),e1e(),n1e(),a1e(),o1e(),r1e(),t1e(),i1e(),s1e()}class c1e{constructor(e){this.root=new CP;for(const[t,i]of e)for(const n of i)this.root.add(t,n)}toString(){return this.root.toString()}getAttributes(e,t){const i=e.lastIndexOf(".");return i<1?{dirname:t,basename:e,extname:""}:{dirname:t,basename:e.substring(0,i),extname:e.substring(i+1)}}nest(e,t){const i=new CP;for(const r of e){const a=this.getAttributes(r,t),c=this.root.get(r,a);for(const d of c)i.add(d,r)}const n=(r,a=new Set)=>{if(a.has(r))return[];a.add(r);const c=this.getAttributes(r,t),d=i.get(r,c);return d.length===0?[r]:d.length===1&&d[0]===r?[r]:d.flatMap(l=>n(l,a))},o=new Map;for(const r of e){let a=n(r);a.length===0&&(a=[r]);for(const c of a){let d=o.get(c);d||o.set(c,d=new Set),r!==c&&d.add(r)}}return o}}class CP{constructor(){this.value=new m4,this.map=new Map}add(e,t){if(e==="")this.value.add(e,t);else if(e[0]==="*")this.value.add(e,t);else{const i=e[0],n=e.slice(1);let o=this.map.get(i);o||this.map.set(i,o=new CP),o.add(n,t)}}get(e,t){const i=[];i.push(...this.value.get(e,t));const n=e[0],o=e.slice(1),r=this.map.get(n);return r&&i.push(...r.get(o,t)),i}toString(e=""){const t=[];return this.value.hasItems&&t.push(`* => 
`+this.value.toString(e+"  ")),t.map(i=>e+i).join(`
`)}}class m4{constructor(){this.star=[],this.epsilon=[],this.map=new Map,this.hasItems=!1}add(e,t){if(this.hasItems=!0,e==="*")this.star.push(new TZ(t));else if(e==="")this.epsilon.push(new TZ(t));else{const i=e[e.length-1],n=e.slice(0,e.length-1);if(i==="*")throw Error("Unexpected star in SufTrie key: "+e);{let o=this.map.get(i);o||this.map.set(i,o=new m4),o.add(n,t)}}}get(e,t){const i=[];e===""&&i.push(...this.epsilon.map(a=>a.substitute(t))),this.star.length&&i.push(...this.star.map(a=>a.substitute(t,e)));const n=e[e.length-1],o=e.slice(0,e.length-1),r=this.map.get(n);return r&&i.push(...r.get(o,t)),i}toString(e=""){const t=[];return this.star.length&&t.push("* => "+this.star.join("; ")),this.epsilon.length&&t.push("ε => "+this.epsilon.join("; ")),t.map(i=>e+i).join(`
`)}}var zl;(function(s){s.capture="capture",s.basename="basename",s.dirname="dirname",s.extname="extname"})(zl||(zl={}));const kZ=/\$[({](capture|basename|dirname|extname)[)}]/g;class TZ{constructor(e){this.tokens=[],kZ.lastIndex=0;let t,i=0;for(;t=kZ.exec(e);){const n=e.slice(i,t.index);this.tokens.push(n);const o=t[1];switch(o){case zl.basename:case zl.dirname:case zl.extname:case zl.capture:this.tokens.push({capture:o});break;default:throw Error("unknown substitution type: "+o)}i=t.index+t[0].length}if(i!==e.length){const n=e.slice(i,e.length);this.tokens.push(n)}}substitute(e,t){return this.tokens.map(i=>{if(typeof i=="string")return i;switch(i.capture){case zl.basename:return e.basename;case zl.dirname:return e.dirname;case zl.extname:return e.extname;case zl.capture:return t||""}}).join("")}}class Ss{constructor(e,t,i,n,o,r,a,c,d,l=el(e),u,g=!1){this.resource=e,this.fileService=t,this.configService=i,this.filesConfigService=n,this._parent=o,this._isDirectory=r,this._isSymbolicLink=a,this._readonly=c,this._locked=d,this._name=l,this._mtime=u,this._unknown=g,this.error=void 0,this._isExcluded=!1,this.markedAsFindResult=!1,this._isDirectoryResolved=!1}get isExcluded(){return this._isExcluded?!0:this._parent?this._parent.isExcluded:!1}set isExcluded(e){this._isExcluded=e}hasChildren(e){return this.hasNests?this.nestedChildren?.some(t=>e(t))??!1:this.isDirectory}get hasNests(){return!!this.nestedChildren?.length}get isDirectoryResolved(){return this._isDirectoryResolved}get isSymbolicLink(){return!!this._isSymbolicLink}get isDirectory(){return!!this._isDirectory}get isReadonly(){return this.filesConfigService.isReadonly(this.resource,{resource:this.resource,name:this.name,readonly:this._readonly,locked:this._locked})}get mtime(){return this._mtime}get name(){return this._name}get isUnknown(){return this._unknown}get parent(){return this._parent}get root(){return this._parent?this._parent.root:this}get children(){return new Map}updateName(e){this._parent?.removeChild(this),this._name=e,this._parent?.addChild(this)}getId(){let e=this.root.resource.toString()+"::"+this.resource.toString();return this.isMarkedAsFiltered()&&(e+="::findFilterResult"),e}toString(){return`ExplorerItem: ${this.name}`}get isRoot(){return this===this.root}static create(e,t,i,n,o,r){const a=new Ss(n.resource,e,t,i,o,n.isDirectory,n.isSymbolicLink,n.readonly,n.locked,n.name,n.mtime,!n.isFile&&!n.isDirectory);if(a.isDirectory&&(a._isDirectoryResolved=!!n.children||!!r&&r.some(c=>cd(c,a.resource)),n.children))for(let c=0,d=n.children.length;c<d;c++){const l=Ss.create(e,t,i,n.children[c],a,r);a.addChild(l)}return a}static mergeLocalWithDisk(e,t){if(e.resource.toString()!==t.resource.toString())return;const i=e.isDirectory||t.isDirectory;if(!(i&&t._isDirectoryResolved&&!e._isDirectoryResolved)&&(t.resource=e.resource,t.isRoot||t.updateName(e.name),t._isDirectory=e.isDirectory,t._mtime=e.mtime,t._isDirectoryResolved=e._isDirectoryResolved,t._isSymbolicLink=e.isSymbolicLink,t.error=e.error,i&&e._isDirectoryResolved)){const n=new wn;t.children.forEach(o=>{n.set(o.resource,o)}),t.children.clear(),e.children.forEach(o=>{const r=n.get(o.resource);r?(Ss.mergeLocalWithDisk(o,r),t.addChild(r),n.delete(o.resource)):t.addChild(o)}),n.forEach(o=>{o instanceof YO&&t.addChild(o)})}}addChild(e){e._parent=this,e.updateResource(!1),this.children.set(this.getPlatformAwareName(e.name),e)}getChild(e){return this.children.get(this.getPlatformAwareName(e))}fetchChildren(e){const t=this.configService.getValue({resource:this.root.resource}).explorer.fileNesting;return t.enabled&&this.nestedChildren?this.nestedChildren:(async()=>{if(!this._isDirectoryResolved){const n=e===gCe.Modified;this.error=void 0;try{const o=await this.fileService.resolve(this.resource,{resolveSingleChildDescendants:!0,resolveMetadata:n}),r=Ss.create(this.fileService,this.configService,this.filesConfigService,o,this);Ss.mergeLocalWithDisk(r,this)}catch(o){throw this.error=o,o}this._isDirectoryResolved=!0}const i=[];if(t.enabled){const n=[],o=[];for(const a of this.children.entries())a[1].nestedParent=void 0,a[1].isDirectory?o.push(a):n.push(a);const r=this.fileNester.nest(n.map(([a])=>a),this.getPlatformAwareName(this.name));for(const[a,c]of n){const d=r.get(a);if(d!==void 0){c.nestedChildren=[];for(const l of d.keys()){const u=Gt(this.children.get(l));c.nestedChildren.push(u),u.nestedParent=c}i.push(c)}else c.nestedChildren=void 0}for(const[a,c]of o.values())i.push(c)}else this.children.forEach(n=>{i.push(n)});return i})()}get fileNester(){if(!this.root._fileNester){const e=this.configService.getValue({resource:this.root.resource}).explorer.fileNesting,t=Object.entries(e.patterns).filter(i=>typeof i[0]=="string"&&typeof i[1]=="string"&&i[0]&&i[1]).map(([i,n])=>[this.getPlatformAwareName(i.trim()),n.split(",").map(o=>this.getPlatformAwareName(o.trim().replace(/\u200b/g,"").trim())).filter(o=>o!=="")]);this.root._fileNester=new c1e(t)}return this.root._fileNester}removeChild(e){this.nestedChildren=void 0,this.children.delete(this.getPlatformAwareName(e.name))}forgetChildren(){this.children.clear(),this.nestedChildren=void 0,this._isDirectoryResolved=!1,this._fileNester=void 0}getPlatformAwareName(e){return this.fileService.hasCapability(this.resource,ph.PathCaseSensitive)?e:e.toLowerCase()}move(e){this.nestedParent?.removeChild(this),this._parent?.removeChild(this),e.removeChild(this),e.addChild(this),this.updateResource(!0)}updateResource(e){this._parent&&(this.resource=xt(this._parent.resource,this.name)),e&&this.isDirectory&&this.children.forEach(t=>{t.updateResource(!0)})}rename(e){this.updateName(e.name),this._mtime=e.mtime,this.updateResource(!0)}find(e){const t=!this.fileService.hasCapability(e,ph.PathCaseSensitive);return e&&this.resource.scheme===e.scheme&&Xs(this.resource.authority,e.authority)&&(t?g_e(e.path,this.resource.path):e.path.startsWith(this.resource.path))?this.findByPath($m(e.path,Zc.sep),this.resource.path.length,t):null}findByPath(e,t,i){if(p_e($m(this.resource.path,Zc.sep),e,i))return this;if(this.isDirectory){for(;t<e.length&&e[t]===Zc.sep;)t++;let n=e.indexOf(Zc.sep,t);n===-1&&(n=e.length);const o=e.substring(t,n),r=this.children.get(this.getPlatformAwareName(o));if(r)return r.findByPath(e,n,i)}return null}isMarkedAsFiltered(){return this.markedAsFindResult}markItemAndParentsAsFiltered(){this.markedAsFindResult=!0,this.parent?.markItemAndParentsAsFiltered()}unmarkItemAndChildren(){this.markedAsFindResult=!1,this.children.forEach(e=>e.unmarkItemAndChildren())}}Ss.__decorator=f([Ht],Ss.prototype,"children",null);class YO extends Ss{constructor(e,t,i,n,o){super(R.file(""),e,t,i,n,o),this._isDirectoryResolved=!0}}var nT,sT;let EP=class{static{nT=this}static{this.MAX_PARALLEL_UPLOADS=20}constructor(e,t,i,n,o){this.progressService=e,this.dialogService=t,this.explorerService=i,this.editorService=n,this.fileService=o}upload(e,t){const i=new ri,n=this.progressService.withProgress({location:qo.Window,delay:800,cancellable:!0,title:h(7132,"Uploading")},async o=>this.doUpload(e,this.toTransfer(t),o,i.token),()=>i.dispose(!0));return this.progressService.withProgress({location:hd,delay:500},()=>n),n}toTransfer(e){if(f_e(e))return e.dataTransfer;const t={items:[]};for(const i of e)t.items.push({webkitGetAsEntry:()=>({name:i.name,isDirectory:!1,isFile:!0,createReader:()=>{throw new Error("Unsupported for files")},file:n=>n(i)})});return t}async doUpload(e,t,i,n){const o=t.items,r=[];for(const u of o)r.push(u.webkitGetAsEntry());const a=[],c={startTime:Date.now(),progressScheduler:new Tq(u=>{i.report(u[u.length-1])},1e3),filesTotal:r.length,filesUploaded:0,totalBytesUploaded:0},d=new k7(nT.MAX_PARALLEL_UPLOADS);await Op.settled(r.map(u=>d.queue(async()=>{if(n.isCancellationRequested)return;if(e&&u.name&&e.getChild(u.name)){const{confirmed:m}=await this.dialogService.confirm(v4(u.name));if(!m||(await this.explorerService.applyBulkEdit([new ic(xt(e.resource,u.name),void 0,{recursive:!0,folder:e.getChild(u.name)?.isDirectory})],{undoLabel:h(7133,"Overwrite {0}",u.name),progressLabel:h(7134,"Overwriting {0}",u.name)}),n.isCancellationRequested))return}const g=await this.doUploadEntry(u,e.resource,e,i,c,n);g&&a.push(g)}))),c.progressScheduler.dispose();const l=a[0];!n.isCancellationRequested&&l?.isFile&&await this.editorService.openEditor({resource:l.resource,options:{pinned:!0}})}async doUploadEntry(e,t,i,n,o,r){if(r.isCancellationRequested||!e.name||!e.isFile&&!e.isDirectory)return;let a=0;const c=(l,u)=>{a+=u,o.totalBytesUploaded+=u;const g=o.totalBytesUploaded/((Date.now()-o.startTime)/1e3);let m;l<Fo.MB?o.filesTotal===1?m=`${e.name}`:m=h(7135,"{0} of {1} files ({2}/s)",o.filesUploaded,o.filesTotal,Fo.formatSize(g)):m=h(7136,"{0} ({1} of {2}, {3}/s)",e.name,Fo.formatSize(a),Fo.formatSize(l),Fo.formatSize(g)),o.progressScheduler.work({message:m})};o.filesUploaded++,c(0,0);const d=xt(t,e.name);if(e.isFile){const l=await new Promise((u,g)=>e.file(u,g));return r.isCancellationRequested?void 0:(typeof l.stream=="function"&&l.size>Fo.MB?await this.doUploadFileBuffered(d,l,c,r):await this.doUploadFileUnbuffered(d,l,c),{isFile:!0,resource:d})}else{if(await this.fileService.createFolder(d),r.isCancellationRequested)return;const l=e.createReader(),u=[];let g=!1;do{const C=await new Promise((T,k)=>l.readEntries(T,k));C.length>0?u.push(...C):g=!0}while(!g&&!r.isCancellationRequested);o.filesTotal+=u.length;const m=i&&i.getChild(e.name)||void 0,v=[],y=[];for(const C of u)C.isFile?v.push(C):C.isDirectory&&y.push(C);const w=new k7(nT.MAX_PARALLEL_UPLOADS);await Op.settled(v.map(C=>w.queue(()=>this.doUploadEntry(C,d,m,n,o,r))));for(const C of y)await this.doUploadEntry(C,d,m,n,o,r);return{isFile:!1,resource:d}}}async doUploadFileBuffered(e,t,i,n){const o=m_e({highWaterMark:10}),r=this.fileService.writeFile(e,o);try{const a=t.stream().getReader();let c=await a.read();for(;!c.done&&!n.isCancellationRequested;){const d=Re.wrap(c.value);if(await o.write(d),n.isCancellationRequested)break;i(t.size,d.byteLength),c=await a.read()}o.end(void 0)}catch(a){o.error(a),o.end()}n.isCancellationRequested||await r}doUploadFileUnbuffered(e,t,i){return new Promise((n,o)=>{const r=new FileReader;r.onload=async a=>{try{if(a.target?.result instanceof ArrayBuffer){const c=Re.wrap(new Uint8Array(a.target.result));await this.fileService.writeFile(e,c),i(t.size,c.byteLength)}else throw new Error("Could not read from dropped file.");n()}catch(c){o(c)}},r.readAsArrayBuffer(t)})}};EP=nT=f([p(0,bl),p(1,Qt),p(2,Qi),p(3,de),p(4,Xe)],EP);let CU=class{constructor(e,t,i,n,o,r,a,c,d,l,u){this.fileService=e,this.hostService=t,this.contextService=i,this.configurationService=n,this.dialogService=o,this.workspaceEditingService=r,this.explorerService=a,this.editorService=c,this.progressService=d,this.notificationService=l,this.instantiationService=u}async import(e,t,i){const n=new ri,o=this.progressService.withProgress({location:qo.Window,delay:800,cancellable:!0,title:h(7137,"Copying...")},async()=>await this.doImport(e,t,i,n.token),()=>n.dispose(!0));return this.progressService.withProgress({location:hd,delay:500},()=>o),o}async doImport(e,t,i,n){const o=Vt((await this.instantiationService.invokeFunction(d=>ide(d,t))).map(d=>d.resource));await Promise.all(o.map(d=>this.fileService.activateProvider(d.scheme)));const r=Vt(o.filter(d=>this.fileService.hasProvider(d))),a=await this.fileService.resolveAll(r.map(d=>({resource:d})));if(n.isCancellationRequested)return;this.hostService.focus(i);const c=a.filter(d=>d.success&&d.stat?.isDirectory).map(d=>({uri:d.stat.resource}));if(c.length>0&&e.isRoot){let d;(function(v){v[v.Copy=1]="Copy",v[v.Add=2]="Add"})(d||(d={}));const l=[{label:c.length>1?h(7138,"&&Copy Folders"):h(7139,"&&Copy Folder"),run:()=>d.Copy}];let u;const g=this.contextService.getWorkspace().folders.map(v=>v.uri.scheme);c.some(v=>g.indexOf(v.uri.scheme)>=0)?(l.unshift({label:c.length>1?h(7140,"&&Add Folders to Workspace"):h(7141,"&&Add Folder to Workspace"),run:()=>d.Add}),u=c.length>1?h(7142,"Do you want to copy the folders or add the folders to the workspace?"):h(7143,"Do you want to copy '{0}' or add '{0}' as a folder to the workspace?",je(c[0].uri))):u=c.length>1?h(7144,"Are you sure to want to copy folders?"):h(7145,"Are you sure to want to copy '{0}'?",je(c[0].uri));const{result:m}=await this.dialogService.prompt({type:Me.Info,message:u,buttons:l,cancelButton:!0});if(m===d.Add)return this.workspaceEditingService.addFolders(c);if(m===d.Copy)return this.importResources(e,r,n)}else if(e instanceof Ss)return this.importResources(e,r,n)}async importResources(e,t,i){if(t&&t.length>0){const n=await this.fileService.resolve(e.resource);if(i.isCancellationRequested)return;const o=new Set,r=this.fileService.hasCapability(e.resource,ph.PathCaseSensitive);n.children&&n.children.forEach(g=>{o.add(r?g.name:g.name.toLowerCase())});let a=0;const c=Vt(await Op.settled(t.map(async g=>{if(!await this.fileService.exists(g)){a++;return}if(!(o.has(r?je(g):je(g).toLowerCase())&&!(await this.dialogService.confirm(v4(je(g)))).confirmed))return g})));a>0&&this.notificationService.error(a>1?h(7146,"Some or all of the dropped files could not be accessed for import."):h(7147,"The dropped file could not be accessed for import."));const d=c.map(g=>{const m=je(g),v=xt(e.resource,m);return new ic(g,v,{overwrite:!0,copy:!0})}),l=this.configurationService.getValue().explorer.confirmUndo;if(await this.explorerService.applyBulkEdit(d,{undoLabel:c.length===1?h(7148,"Import {0}",je(c[0])):h(7149,"Import {0} resources",c.length),progressLabel:c.length===1?h(7150,"Copying {0}",je(c[0])):h(7151,"Copying {0} resources",c.length),progressLocation:qo.Window,confirmBeforeUndo:l===Lu.Verbose||l===Lu.Default}),this.configurationService.getValue().explorer.autoOpenDroppedFile&&d.length===1){const g=this.explorerService.findClosest(d[0].newResource);g&&!g.isDirectory&&this.editorService.openEditor({resource:g.resource,options:{pinned:!0}})}}}};CU=f([p(0,Xe),p(1,Wn),p(2,Tt),p(3,ne),p(4,Qt),p(5,uc),p(6,Qi),p(7,de),p(8,bl),p(9,At),p(10,J)],CU);let EU=class{static{sT=this}static{this.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY="workbench.explorer.downloadPath"}constructor(e,t,i,n,o,r){this.fileService=e,this.explorerService=t,this.progressService=i,this.logService=n,this.fileDialogService=o,this.storageService=r}download(e){const t=new ri,i=this.progressService.withProgress({location:qo.Window,delay:800,cancellable:$t,title:h(7152,"Downloading")},async n=>this.doDownload(e,n,t),()=>t.dispose(!0));return this.progressService.withProgress({location:hd,delay:500},()=>i),i}async doDownload(e,t,i){for(const n of e){if(i.token.isCancellationRequested)return;$t?await this.doDownloadBrowser(n.resource,t,i):await this.doDownloadNative(n,t,i)}}async doDownloadBrowser(e,t,i){const n=await this.fileService.resolve(e,{resolveMetadata:!0});if(i.token.isCancellationRequested)return;const o=32*Fo.MB,r=n.isDirectory||n.size>o,a=Vp();if(r&&LE.supported(a))try{const c=await a.showDirectoryPicker(),d={startTime:Date.now(),progressScheduler:new Tq(l=>{t.report(l[l.length-1])},1e3),filesTotal:n.isDirectory?0:1,filesDownloaded:0,totalBytesDownloaded:0,fileBytesDownloaded:0};if(n.isDirectory){const l=await c.getDirectoryHandle(n.name,{create:!0});await this.downloadFolderBrowser(n,l,d,i.token)}else await this.downloadFileBrowser(c,n,d,i.token);d.progressScheduler.dispose()}catch(c){this.logService.warn(c),i.cancel()}else if(n.isFile){let c;try{c=(await this.fileService.readFile(n.resource,{limits:{size:o}},i.token)).value.buffer}catch{c=tc.uriToBrowserUri(n.resource)}i.token.isCancellationRequested||v_e(c,n.name)}}async downloadFileBufferedBrowser(e,t,i,n){const o=await this.fileService.readFileStream(e,void 0,n);if(n.isCancellationRequested){t.close();return}return new Promise((r,a)=>{const c=o.value,d=new U;d.add(Ee(()=>t.close())),d.add(hw(n.onCancellationRequested)(()=>{d.dispose(),a(Ib())})),__e(c,{onData:l=>{t.write(l.buffer),this.reportProgress(o.name,o.size,l.byteLength,i)},onError:l=>{d.dispose(),a(l)},onEnd:()=>{d.dispose(),r()}},n)})}async downloadFileUnbufferedBrowser(e,t,i,n){const o=await this.fileService.readFile(e,void 0,n);n.isCancellationRequested||(t.write(o.value.buffer),this.reportProgress(o.name,o.size,o.value.byteLength,i)),t.close()}async downloadFileBrowser(e,t,i,n){i.filesDownloaded++,i.fileBytesDownloaded=0,this.reportProgress(t.name,0,0,i);const r=await(await e.getFileHandle(t.name,{create:!0})).createWritable();return t.size>Fo.MB?this.downloadFileBufferedBrowser(t.resource,r,i,n):this.downloadFileUnbufferedBrowser(t.resource,r,i,n)}async downloadFolderBrowser(e,t,i,n){if(e.children){i.filesTotal+=e.children.map(o=>o.isFile).length;for(const o of e.children){if(n.isCancellationRequested)return;if(o.isFile)await this.downloadFileBrowser(t,o,i,n);else{const r=await t.getDirectoryHandle(o.name,{create:!0}),a=await this.fileService.resolve(o.resource,{resolveMetadata:!0});await this.downloadFolderBrowser(a,r,i,n)}}}}reportProgress(e,t,i,n){n.fileBytesDownloaded+=i,n.totalBytesDownloaded+=i;const o=n.totalBytesDownloaded/((Date.now()-n.startTime)/1e3);let r;t<Fo.MB?n.filesTotal===1?r=e:r=h(7153,"{0} of {1} files ({2}/s)",n.filesDownloaded,n.filesTotal,Fo.formatSize(o)):r=h(7154,"{0} ({1} of {2}, {3}/s)",e,Fo.formatSize(n.fileBytesDownloaded),Fo.formatSize(t),Fo.formatSize(o)),n.progressScheduler.work({message:r})}async doDownloadNative(e,t,i){t.report({message:e.name});let n;const o=this.storageService.get(sT.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY,he.APPLICATION);o?n=xt(R.file(o),e.name):n=xt(e.isDirectory?await this.fileDialogService.defaultFolderPath(ae.file):await this.fileDialogService.defaultFilePath(ae.file),e.name);const r=await this.fileDialogService.showSaveDialog({availableFileSystems:[ae.file],saveLabel:h(7155,"Download"),title:h(7156,"Choose Where to Download"),defaultUri:n});r?(this.storageService.store(sT.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY,hs(r).fsPath,he.APPLICATION,pt.MACHINE),await this.explorerService.applyBulkEdit([new ic(e.resource,r,{overwrite:!0,copy:!0})],{undoLabel:h(7157,"Download {0}",e.name),progressLabel:h(7158,"Downloading {0}",e.name),progressLocation:qo.Window})):i.cancel()}};EU=sT=f([p(0,Xe),p(1,Qi),p(2,bl),p(3,Pe),p(4,js),p(5,tt)],EU);function v4(s){return{message:h(7159,"A file or folder with the name '{0}' already exists in the destination folder. Do you want to replace it?",s),detail:h(7160,"This action is irreversible!"),primaryButton:h(7161,"&&Replace"),type:"warning"}}function d1e(s){return s.length>1?{message:h(7162,"The following {0} files and/or folders already exist in the destination folder. Do you want to replace them?",s.length),detail:Vu(s)+`
`+h(7160,"This action is irreversible!"),primaryButton:h(7161,"&&Replace"),type:"warning"}:v4(je(s[0]))}const lD="explorer.newFile",_he=I(7025,"New File..."),QO="explorer.newFolder",bhe=I(7026,"New Folder..."),l1e=h(7027,"Rename..."),h1e=h(7028,"Delete"),u1e=h(7029,"Copy"),g1e=h(7030,"Paste"),yhe=new O("fileCopied",!1),whe="explorer.download",p1e=h(7031,"Download..."),She="explorer.upload",f1e=h(7032,"Upload..."),AZ="explorer.confirmDelete",m1e=5e6;function Che(s,e){e.message==="string"&&(e=e.message),s.error(ho(e,!1))}async function Ehe(s,e){s&&(s.indexOf("/")>=0||s.indexOf("\\")>=0)&&await e.refresh()}async function _4(s,e,t,i,n,o,r,a=!1,c=!1){let d;r?d=pn?h(7033,"&&Move to Recycle Bin"):h(7034,"&&Move to Trash"):d=h(7035,"&&Delete");const l=Rq(o,v=>v.resource),u=new Set;for(const v of l)for(const y of e.getDirty(v.resource))u.add(y);if(u.size){let v;if(l.length>1?v=h(7036,"You are deleting files with unsaved changes. Do you want to continue?"):l[0].isDirectory?u.size===1?v=h(7037,"You are deleting a folder {0} with unsaved changes in 1 file. Do you want to continue?",l[0].name):v=h(7038,"You are deleting a folder {0} with unsaved changes in {1} files. Do you want to continue?",l[0].name,u.size):v=h(7039,"You are deleting {0} with unsaved changes. Do you want to continue?",l[0].name),(await t.confirm({type:"warning",message:v,detail:h(7040,"Your changes will be lost if you don't save them."),primaryButton:d})).confirmed)a=!0;else return}if(!a){const v=l.filter(y=>n.isReadonly(y.resource));if(v.length){let y;if(v.length>1?y=h(7041,"You are deleting files that are configured to be read-only. Do you want to continue?"):v[0].isDirectory?y=h(7042,"You are deleting a folder {0} that is configured to be read-only. Do you want to continue?",l[0].name):y=h(7043,"You are deleting a file {0} that is configured to be read-only. Do you want to continue?",l[0].name),!(await t.confirm({type:"warning",message:y,detail:h(7044,"The read-only protection will be overridden if you continue."),primaryButton:h(7045,"Continue")})).confirmed)return}}let g;const m=l.some(v=>v.isDirectory)?h(7046,"This action is irreversible!"):l.length>1?h(7047,"You can restore these files using the Undo command."):h(7048,"You can restore this file using the Undo command.");if(a||r&&i.getValue(AZ)===!1)g={confirmed:!0};else if(r){let{message:v,detail:y}=v1e(l);y+=y?`
`:"",pn?y+=l.length>1?h(7049,"You can restore these files from the Recycle Bin."):h(7050,"You can restore this file from the Recycle Bin."):y+=l.length>1?h(7051,"You can restore these files from the Trash."):h(7052,"You can restore this file from the Trash."),g=await t.confirm({message:v,detail:y,primaryButton:d,checkbox:{label:h(7053,"Do not ask me again")}})}else{let{message:v,detail:y}=_1e(l);y+=y?`
`:"",y+=m,g=await t.confirm({type:"warning",message:v,detail:y,primaryButton:d})}if(g.confirmed&&g.checkboxChecked===!0&&await i.updateValue(AZ,!1),!!g.confirmed)try{const v=l.map(w=>new ic(w.resource,void 0,{recursive:!0,folder:w.isDirectory,ignoreIfNotExists:c,skipTrashBin:!r,maxSize:m1e})),y={undoLabel:l.length>1?h(7054,"Delete {0} files",l.length):h(7055,"Delete {0}",l[0].name),progressLabel:l.length>1?h(7056,"Deleting {0} files",l.length):h(7057,"Deleting {0}",l[0].name)};await s.applyBulkEdit(v,y)}catch(v){let y,w,C;if(r?(y=pn?h(7058,"Failed to delete using the Recycle Bin. Do you want to permanently delete instead?"):h(7059,"Failed to delete using the Trash. Do you want to permanently delete instead?"),w=m,C=h(7060,"&&Delete Permanently")):(y=ho(v,!1),C=h(7061,"&&Retry")),(await t.confirm({type:"warning",message:y,detail:w,primaryButton:C})).confirmed)return r&&(r=!1),a=!0,c=!0,_4(s,e,t,i,n,o,r,a,c)}}function v1e(s){return xhe(s)?{message:h(7062,"Are you sure you want to delete the following {0} files/directories and their contents?",s.length),detail:Vu(s.map(e=>e.resource))}:s.length>1?s[0].isDirectory?{message:h(7063,"Are you sure you want to delete the following {0} directories and their contents?",s.length),detail:Vu(s.map(e=>e.resource))}:{message:h(7064,"Are you sure you want to delete the following {0} files?",s.length),detail:Vu(s.map(e=>e.resource))}:s[0].isDirectory&&!s[0].isSymbolicLink?{message:h(7065,"Are you sure you want to delete '{0}' and its contents?",s[0].name),detail:""}:{message:h(7066,"Are you sure you want to delete '{0}'?",s[0].name),detail:""}}function _1e(s){return xhe(s)?{message:h(7067,"Are you sure you want to permanently delete the following {0} files/directories and their contents?",s.length),detail:Vu(s.map(e=>e.resource))}:s.length>1?s[0].isDirectory?{message:h(7068,"Are you sure you want to permanently delete the following {0} directories and their contents?",s.length),detail:Vu(s.map(e=>e.resource))}:{message:h(7069,"Are you sure you want to permanently delete the following {0} files?",s.length),detail:Vu(s.map(e=>e.resource))}:s[0].isDirectory?{message:h(7070,"Are you sure you want to permanently delete '{0}' and its contents?",s[0].name),detail:""}:{message:h(7071,"Are you sure you want to permanently delete '{0}'?",s[0].name),detail:""}}function xhe(s){const e=s.find(i=>i.isDirectory),t=s.find(i=>!i.isDirectory);return!!e&&!!t}async function xU(s,e,t,i,n,o){let r=typeof n.resource=="string"?n.resource:el(n.resource),a=xt(i.resource,r);if(!(o==="disabled"&&!await y1e(e,t,a))){for(;!n.allowOverwrite&&s.findClosest(a);)o!=="disabled"&&(r=b1e(r,!!n.isDirectory,o)),a=xt(i.resource,r);return a}}function b1e(s,e,t){if(t==="simple"){let u=s,g="";e||(g=QM(s),u=Sn(s,g));const m=/^(.+ copy)( \d+)?$/;return m.test(u)?u.replace(m,(v,y,w)=>{const C=w?parseInt(w):1;return C===0?`${y}`:C<dc.MAX_SAFE_SMALL_INTEGER?`${y} ${C+1}`:`${y}${w} copy`})+g:`${u} copy${g}`}const i="[\\.\\-_]",n=dc.MAX_SAFE_SMALL_INTEGER,o=RegExp("(.*"+i+")(\\d+)(\\..*)$");if(!e&&s.match(o))return s.replace(o,(u,g,m,v)=>{const y=parseInt(m);return y<n?g+String(y+1).padStart(m.length,"0")+v:`${g}${m}.1${v}`});const r=RegExp("(\\d+)("+i+".*)(\\..*)$");if(!e&&s.match(r))return s.replace(r,(u,g,m,v)=>{const y=parseInt(g);return y<n?String(y+1).padStart(g.length,"0")+m+v:`${g}${m}.1${v}`});const a=RegExp("(\\d+)(\\..*)$");if(!e&&s.match(a))return s.replace(a,(u,g,m)=>{const v=parseInt(g);return v<n?String(v+1).padStart(g.length,"0")+m:`${g}.1${m}`});const c=s.lastIndexOf(".");if(!e&&c>=0)return`${s.substr(0,c)}.1${s.substr(c)}`;const d=RegExp("(\\d+)$");if(!e&&c===-1&&s.match(d))return s.replace(d,(u,g)=>{const m=parseInt(g);return m<n?String(m+1).padStart(g.length,"0"):`${g}.1`});const l=RegExp("(.*)(\\d*)$");return!e&&c===-1&&s.match(l)?s.replace(l,(u,g,m)=>{let v=parseInt(m);return isNaN(v)&&(v=0),v<n?g+String(v+1).padStart(m.length,"0"):`${g}${m}.1`}):e&&s.match(/(\d+)$/)?s.replace(/(\d+)$/,(u,...g)=>{const m=parseInt(g[0]);return m<n?String(m+1).padStart(g[0].length,"0"):`${g[0]}.1`}):e&&s.match(/^(\d+)/)?s.replace(/^(\d+)(.*)$/,(u,...g)=>{const m=parseInt(g[0]);return m<n?String(m+1).padStart(g[0].length,"0")+g[1]:`${g[0]}${g[1]}.1`}):`${s}.1`}async function y1e(s,e,t){if(!await s.exists(t))return!0;const{confirmed:n}=await e.confirm({type:Me.Warning,message:h(7072,"A file or folder with the name '{0}' already exists in the destination folder. Do you want to replace it?",Sn(t.path)),primaryButton:h(7073,"&&Replace")});return n}class xP extends X{static{this.ID="workbench.files.action.compareFileWith"}static{this.LABEL=I(7074,"Compare Active File With...")}constructor(){super({id:xP.ID,title:xP.LABEL,f1:!0,category:te.File,precondition:bw,metadata:{description:I(7075,"Opens a picker to select a file to diff with the active editor.")}})}async run(e){const t=e.get(de),i=e.get(yi),n=e.get(zt),o=t.activeEditor,r=xi.getOriginalUri(o);if(r&&i.canHandleResource(r)){const a=await n.quickAccess.pick("",{itemActivation:fw.SECOND});if(a?.length===1){const c=a[0].resource;R.isUri(c)&&i.canHandleResource(c)&&t.openEditor({original:{resource:r},modified:{resource:c},options:{pinned:!0}})}}}}class XO extends X{static{this.ID="workbench.action.toggleAutoSave"}constructor(){super({id:XO.ID,title:I(7076,"Toggle Auto Save"),f1:!0,category:te.File,metadata:{description:I(7077,"Toggle the ability to save files automatically after typing")}})}run(e){return e.get(Ns).toggleAutoSave()}}let IU=class extends Kt{constructor(e,t,i,n,o){super(e,t),this.commandService=i,this.notificationService=n,this.workingCopyService=o,this.lastDirtyState=this.workingCopyService.hasDirty,this.enabled=this.lastDirtyState,this.registerListeners()}registerListeners(){this._register(this.workingCopyService.onDidChangeDirty(e=>this.updateEnablement(e)))}updateEnablement(e){const t=e.isDirty()||this.workingCopyService.hasDirty;this.lastDirtyState!==t&&(this.enabled=t,this.lastDirtyState=this.enabled)}async run(e){try{await this.doRun(e)}catch(t){Che(this.notificationService,t)}}};IU=f([p(2,qe),p(3,At),p(4,vg)],IU);class V0 extends IU{static{this.ID="workbench.files.action.saveAllInGroup"}static{this.LABEL=h(7078,"Save All in Group")}get class(){return"explorer-action "+Te.asClassName(j.saveAll)}doRun(e){return this.commandService.executeCommand(qO,{},e)}}let $C=class extends Kt{static{this.ID="workbench.files.action.closeGroup"}static{this.LABEL=h(7079,"Close Group")}constructor(e,t,i){super(e,t,Te.asClassName(j.closeAll)),this.commandService=i}run(e){return this.commandService.executeCommand(uhe,{},e)}};$C=f([p(2,qe)],$C);class IP extends X{static{this.ID="workbench.files.action.focusFilesExplorer"}static{this.LABEL=I(7080,"Focus on Files Explorer")}constructor(){super({id:IP.ID,title:IP.LABEL,f1:!0,category:te.File,metadata:{description:I(7081,"Moves focus to the file explorer view container.")}})}async run(e){await e.get(aa).openPaneComposite(pI,Fe.Sidebar,!0)}}class DP extends X{static{this.ID="workbench.files.action.showActiveFileInExplorer"}static{this.LABEL=I(7082,"Reveal Active File in Explorer View")}constructor(){super({id:DP.ID,title:DP.LABEL,f1:!0,category:te.File,metadata:{description:I(7083,"Reveals and selects the active file within the explorer view.")}})}async run(e){const t=e.get(qe),i=e.get(de),n=xi.getOriginalUri(i.activeEditor,{supportSideBySide:Ut.PRIMARY});n&&t.executeCommand(r4,n)}}class kP extends X{static{this.ID="workbench.action.files.showOpenedFileInNewWindow"}static{this.LABEL=I(7084,"Open Active File in New Empty Workspace")}constructor(){super({id:kP.ID,title:kP.LABEL,f1:!0,category:te.File,precondition:_N,metadata:{description:I(7085,"Opens the active file in a new window with no folders open.")}})}async run(e){const t=e.get(de),i=e.get(Wn),n=e.get(Qt),o=e.get(Xe),r=xi.getOriginalUri(t.activeEditor,{supportSideBySide:Ut.PRIMARY});r&&(o.hasProvider(r)?i.openWindow([{fileUri:r}],{forceNewWindow:!0}):n.error(h(7086,"The active editor must contain an openable resource.")))}}function Ihe(s,e,t,i){if(t=S1e(t),!t||t.length===0||/^\s+$/.test(t))return{content:h(7087,"A file or folder name must be provided."),severity:Me.Error};if(t[0]==="/"||t[0]==="\\")return{content:h(7088,"A file or folder name cannot start with a slash."),severity:Me.Error};const n=Vt(t.split(/[\\/]/)),o=e.parent;if(t!==e.name){const r=o?.getChild(t);if(r&&r!==e)return{content:h(7089,"A file or folder **{0}** already exists at this location. Please choose a different name.",t),severity:Me.Error}}if(n.some(r=>!s.hasValidBasename(e.resource,i,r))){const r=t.replace(/\*/g,"\\*");return{content:h(7090,"The name **{0}** is not valid as a file or folder name. Please choose a different name.",w1e(r)),severity:Me.Error}}return n.some(r=>/^\s|\s$/.test(r))?{content:h(7091,"Leading or trailing whitespace detected in file or folder name."),severity:Me.Warning}:null}function w1e(s){return s?.length>255?`${s.substr(0,255)}...`:s}function S1e(s){return s&&(s=Aq(s,"	"),s=$m(s,"/"),s=$m(s,"\\"),s)}class TP extends X{static{this.ID="workbench.files.action.compareNewUntitledTextFiles"}static{this.LABEL=I(7092,"Compare New Untitled Text Files")}constructor(){super({id:TP.ID,title:TP.LABEL,f1:!0,category:te.File,metadata:{description:I(7093,"Opens a new diff editor with two untitled files.")}})}async run(e){await e.get(de).openEditor({original:{resource:void 0},modified:{resource:void 0},options:{pinned:!0}})}}class GC extends X{static{this.ID="workbench.files.action.compareWithClipboard"}static{this.LABEL=I(7094,"Compare Active File with Clipboard")}static{this.SCHEME_COUNTER=0}constructor(){super({id:GC.ID,title:GC.LABEL,f1:!0,category:te.File,keybinding:{primary:lt(E.CtrlCmd|S.KeyK,S.KeyC),weight:W.WorkbenchContrib},metadata:{description:I(7095,"Opens a new diff editor to compare the active file with the contents of the clipboard.")}})}async run(e){const t=e.get(de),i=e.get(J),n=e.get(yi),o=e.get(Xe),r=xi.getOriginalUri(t.activeEditor,{supportSideBySide:Ut.PRIMARY}),a=`clipboardCompare${GC.SCHEME_COUNTER++}`;if(r&&(o.hasProvider(r)||r.scheme===ae.untitled)){if(!this.registrationDisposal){const l=i.createInstance(DU);this.registrationDisposal=n.registerTextModelContentProvider(a,l)}const c=je(r),d=h(7096,"Clipboard ↔ {0}",c);await t.openEditor({original:{resource:r.with({scheme:a})},modified:{resource:r},label:d,options:{pinned:!0}}).finally(()=>{Qe(this.registrationDisposal),this.registrationDisposal=void 0})}}dispose(){Qe(this.registrationDisposal),this.registrationDisposal=void 0}}let DU=class{constructor(e,t,i){this.clipboardService=e,this.languageService=t,this.modelService=i}async provideTextContent(e){const t=await this.clipboardService.readText();return this.modelService.createModel(t,this.languageService.createByFilepathOrFirstLine(e),e)}};DU=f([p(0,Is),p(1,fi),p(2,ai)],DU);function C1e(s,e,t){s.prompt(Me.Error,ho(e,!1),[{label:h(7097,"Retry"),run:()=>t()}])}async function Dhe(s,e){const t=s.get(Qi),i=s.get(Xe),n=s.get(ne),o=s.get(Ns),r=s.get(de),a=s.get(mo),c=s.get(At),d=s.get(Nh),l=s.get(qe),u=s.get(_c),g=!a.isViewVisible(hd),m=await a.openView(hd,!0);if(g&&await Ia(500),!m){if(e)throw new Error("Open a folder or workspace first.");return l.executeCommand(tS)}const v=t.getContext(!1),y=v.length>0?v[0]:void 0;let w;if(y?w=y.isDirectory?y:y.parent||t.roots[0]:w=t.roots[0],w.isReadonly)throw new Error("Parent folder is readonly.");const C=new YO(i,n,o,w,e);w.addChild(C);const T=async A=>{try{const B=xt(w.resource,A);A.endsWith("/")&&(e=!0),await t.applyBulkEdit([new ic(void 0,B,{folder:e})],{undoLabel:h(7098,"Create {0}",A),progressLabel:h(7099,"Creating {0}",A),confirmBeforeUndo:!0}),await Ehe(A,t),e?await t.select(B,!0):await r.openEditor({resource:B,options:{pinned:!0}})}catch(B){C1e(c,B,()=>T(A))}},k=(await d.getEnvironment())?.os??Yu;await t.setEditable(C,{validationMessage:A=>Ihe(u,C,A,k),onFinish:async(A,B)=>{w.removeChild(C),await t.setEditable(C,null),B&&T(A)}})}Ce.registerCommand({id:lD,handler:async s=>{await Dhe(s,!1)}});Ce.registerCommand({id:QO,handler:async s=>{await Dhe(s,!0)}});const E1e=async s=>{const e=s.get(Qi),t=s.get(At),i=s.get(Nh),n=s.get(_c),o=s.get(ne),r=e.getContext(!1),a=r.length>0?r[0]:void 0;if(!a)return;const c=(await i.getEnvironment())?.os??Yu;await e.setEditable(a,{validationMessage:d=>Ihe(n,a,d,c),onFinish:async(d,l)=>{if(l){const u=a.parent.resource,g=xt(u,d);if(a.resource.toString()!==g.toString())try{await e.applyBulkEdit([new ic(a.resource,g)],{confirmBeforeUndo:o.getValue().explorer.confirmUndo===Lu.Verbose,undoLabel:h(7100,"Rename {0} to {1}",a.name,d),progressLabel:h(7101,"Renaming {0} to {1}",a.name,d)}),await Ehe(d,e)}catch(m){t.error(m)}}await e.setEditable(a,null)}})},x1e=async s=>{const t=s.get(Qi).getContext(!0).filter(i=>!i.isRoot);t.length&&await _4(s.get(Qi),s.get(mg),s.get(Qt),s.get(ne),s.get(Ns),t,!0)},khe=async s=>{const t=s.get(Qi).getContext(!0).filter(i=>!i.isRoot);t.length&&await _4(s.get(Qi),s.get(mg),s.get(Qt),s.get(ne),s.get(Ns),t,!1)};let Jf=!1;const I1e=async s=>{const e=s.get(Qi),t=e.getContext(!0);t.length>0&&(await e.setToCopy(t,!1),Jf=!1)},D1e=async s=>{const e=s.get(Qi),t=e.getContext(!0);t.length>0&&(await e.setToCopy(t,!0),Jf=!0)},k1e=async s=>{const e=s.get(Qi),t=s.get(At),i=s.get(J),n=e.getContext(!0),o=n.length?n:e.roots,r=i.createInstance(EU);try{await r.download(o)}catch(a){throw t.error(a),a}};Ce.registerCommand({id:whe,handler:k1e});const T1e=async s=>{const e=s.get(Qi),t=s.get(At),i=s.get(J),n=e.getContext(!1),o=n.length?n[0]:e.roots[0];try{const r=await b_e();r&&await i.createInstance(EP).upload(o,r)}catch(r){throw t.error(r),r}};Ce.registerCommand({id:She,handler:T1e});const A1e=async(s,e)=>{const t=s.get(Is),i=s.get(Qi),n=s.get(Xe),o=s.get(At),r=s.get(de),a=s.get(ne),c=s.get(Zi),d=s.get(Qt);s.get(Wn);const l=i.getContext(!1),g=e&&e.length>0&&a.getValue("explorer.confirmPasteNative"),m=await R1e(e,t);if(g&&m.files.length>=1){const T=m.files.length>1?h(7102,"Are you sure you want to paste the following {0} items?",m.files.length):h(7103,"Are you sure you want to paste '{0}'?",Sn(m.type==="paths"?m.files[0].fsPath:m.files[0].name)),k=m.files.length>1?Vu(m.files.map(B=>{if(R.isUri(B))return B.fsPath;if(m.type==="paths"){const z=dv(B);if(z)return z}return B.name})):void 0,A=await d.confirm({message:T,detail:k,checkbox:{label:h(7053,"Do not ask me again")},primaryButton:h(7104,"&&Paste")});if(!A.confirmed)return;A.checkboxChecked===!0&&await a.updateValue("explorer.confirmPasteNative",!1)}const v=l.length?l[0]:i.roots[0],y=a.getValue().explorer.incrementalNaming;if(i.getEditable())return;try{let T=[];if(m.type==="paths"){const k=Vt(await Promise.all(m.files.map(async A=>{if(v.resource.toString()!==A.toString()&&cd(v.resource,A))throw new Error(h(7105,"File to paste is an ancestor of the destination folder"));const B=await n.stat(A);let z;c.extUri.isEqual(v.resource,A)?z=v.parent:z=v.isDirectory?v:v.parent;const Q=await xU(i,n,d,z,{resource:A,isDirectory:B.isDirectory,allowOverwrite:Jf||y==="disabled"},y);if(Q)return{source:A,target:Q}})));if(k.length>=1)if(Jf){const A=k.map(z=>new ic(z.source,z.target,{overwrite:y==="disabled"})),B={confirmBeforeUndo:a.getValue().explorer.confirmUndo===Lu.Verbose,progressLabel:k.length>1?h(7106,"Moving {0} files",k.length):h(7107,"Moving {0}",el(k[0].target)),undoLabel:k.length>1?h(7108,"Move {0} files",k.length):h(7109,"Move {0}",el(k[0].target))};await i.applyBulkEdit(A,B)}else{const A=k.map(B=>new ic(B.source,B.target,{copy:!0,overwrite:y==="disabled"}));await C(k.map(B=>B.target),A)}T=k.map(A=>A.target)}else{const k=Vt(await Promise.all(m.files.map(async A=>{const B=v.isDirectory?v:v.parent,z=await xU(i,n,d,B,{resource:A.name,isDirectory:!1,allowOverwrite:Jf||y==="disabled"},y);if(z)return{target:z,edit:new ic(void 0,z,{overwrite:y==="disabled",contents:(async()=>Re.wrap(new Uint8Array(await A.arrayBuffer())))()})}})));await C(k.map(A=>A.target),k.map(A=>A.edit)),T=k.map(A=>A.target)}if(T.length){const k=T[0];if(await i.select(k),T.length===1){const A=i.findClosest(k);A&&!A.isDirectory&&await r.openEditor({resource:A.resource,options:{pinned:!0,preserveFocus:!0}})}}}catch(T){Che(o,new Error(h(7110,"The file(s) to paste have been deleted or moved since you copied them. {0}",ba(T))))}finally{Jf&&(await i.setToCopy([],!1),Jf=!1)}async function C(T,k){const A=a.getValue().explorer.confirmUndo,B={confirmBeforeUndo:A===Lu.Default||A===Lu.Verbose,progressLabel:T.length>1?h(7111,"Copying {0} files",T.length):h(7112,"Copying {0}",el(T[0])),undoLabel:T.length>1?h(7113,"Paste {0} files",T.length):h(7114,"Paste {0}",el(T[0]))};await i.applyBulkEdit(k,B)}};async function R1e(s,e,t){if(s&&s.length>0){const i=[...s].map(n=>dv(n)).filter(n=>!!n&&iy(n)).map(n=>R.file(n));return i.length?{type:"paths",files:i}:{type:"data",files:[...s].filter(n=>!dv(n))}}else return{type:"paths",files:Rq(await e.readResources(),i=>i)}}const P1e=async s=>{const e=s.get(de),i=s.get(Qi).getContext(!0);await e.openEditors(i.filter(n=>!n.isDirectory).map(n=>({resource:n.resource,options:{preserveFocus:!0}})))};class ZO extends X{constructor(e,t,i){super({id:e,title:t,f1:!0,category:te.File,precondition:Qse}),this.newReadonlyState=i}async run(e){const t=e.get(de),i=e.get(Ns),n=xi.getOriginalUri(t.activeEditor,{supportSideBySide:Ut.PRIMARY});n&&await i.updateReadonly(n,this.newReadonlyState)}}class AP extends ZO{static{this.ID="workbench.action.files.setActiveEditorReadonlyInSession"}static{this.LABEL=I(7115,"Set Active Editor Read-only in Session")}constructor(){super(AP.ID,AP.LABEL,!0)}}class RP extends ZO{static{this.ID="workbench.action.files.setActiveEditorWriteableInSession"}static{this.LABEL=I(7116,"Set Active Editor Writeable in Session")}constructor(){super(RP.ID,RP.LABEL,!1)}}class PP extends ZO{static{this.ID="workbench.action.files.toggleActiveEditorReadonlyInSession"}static{this.LABEL=I(7117,"Toggle Active Editor Read-only in Session")}constructor(){super(PP.ID,PP.LABEL,"toggle")}}class LP extends ZO{static{this.ID="workbench.action.files.resetActiveEditorReadonlyInSession"}static{this.LABEL=I(7118,"Reset Active Editor Read-only in Session")}constructor(){super(LP.ID,LP.LABEL,"reset")}}let kU=class extends Bv{constructor(e,t,i){super(),this.resource=e,this.name=t,this.fileService=i,this.mime=Ii.binary}getName(){return this.name}getSize(){return this.size}getMime(){return this.mime}getETag(){return this.etag}async resolve(){if(this.fileService.hasProvider(this.resource)){const e=await this.fileService.stat(this.resource);this.etag=e.etag,typeof e.size=="number"&&(this.size=e.size)}return super.resolve()}};kU=f([p(2,Xe)],kU);var TU,np;(function(s){s[s.None=0]="None",s[s.Text=1]="Text",s[s.Binary=2]="Binary"})(np||(np={}));let AU=TU=class extends Zd{get typeId(){return pCe}get editorId(){return od.id}get capabilities(){let e=Ze.CanSplitInGroup;return this.model?this.model.isReadonly()&&(e|=Ze.Readonly):this.fileService.hasProvider(this.resource)?this.filesConfigurationService.isReadonly(this.resource)&&(e|=Ze.Readonly):e|=Ze.Untitled,e&Ze.Readonly||(e|=Ze.CanDropIntoEditor),e}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C){super(e,t,v,d,u,g,m,w,C),this.instantiationService=c,this.textModelService=l,this.pathService=y,this.forceOpenAs=np.None,this.model=void 0,this.cachedTextFileModelReference=void 0,this.modelListeners=this._register(new U),this.model=this.textFileService.files.get(e),i&&this.setPreferredName(i),n&&this.setPreferredDescription(n),o&&this.setPreferredEncoding(o),r&&this.setPreferredLanguageId(r),typeof a=="string"&&this.setPreferredContents(a),this._register(this.textFileService.files.onDidCreate(T=>this.onDidCreateTextFileModel(T))),this.model&&this.registerModelListeners(this.model)}onDidCreateTextFileModel(e){Dt(e.resource,this.resource)&&(this.model=e,this.registerModelListeners(e))}registerModelListeners(e){this.modelListeners.clear(),this.modelListeners.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this.modelListeners.add(e.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire())),this.modelListeners.add(e.onDidSaveError(()=>this._onDidChangeDirty.fire())),this.modelListeners.add(D.once(e.onWillDispose)(()=>{this.modelListeners.clear(),this.model=void 0}))}getName(){return this.preferredName||super.getName()}setPreferredName(e){this.allowLabelOverride()&&this.preferredName!==e&&(this.preferredName=e,this._onDidChangeLabel.fire())}allowLabelOverride(){return this.resource.scheme!==this.pathService.defaultUriScheme&&this.resource.scheme!==ae.vscodeUserData&&this.resource.scheme!==ae.file&&this.resource.scheme!==ae.vscodeRemote}getPreferredName(){return this.preferredName}isReadonly(){return this.model?this.model.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}getDescription(e){return this.preferredDescription||super.getDescription(e)}setPreferredDescription(e){this.allowLabelOverride()&&this.preferredDescription!==e&&(this.preferredDescription=e,this._onDidChangeLabel.fire())}getPreferredDescription(){return this.preferredDescription}getTitle(e){let t=super.getTitle(e);const i=this.getPreferredTitle();return i&&(t=`${i} (${t})`),t}getPreferredTitle(){if(this.preferredName&&this.preferredDescription)return`${this.preferredName} ${this.preferredDescription}`;if(this.preferredName||this.preferredDescription)return this.preferredName??this.preferredDescription}getEncoding(){return this.model?this.model.getEncoding():this.preferredEncoding}getPreferredEncoding(){return this.preferredEncoding}async setEncoding(e,t){return this.setPreferredEncoding(e),this.model?.setEncoding(e,t)}setPreferredEncoding(e){this.preferredEncoding=e,this.setForceOpenAsText()}getLanguageId(){return this.model?this.model.getLanguageId():this.preferredLanguageId}getPreferredLanguageId(){return this.preferredLanguageId}setLanguageId(e,t){this.setPreferredLanguageId(e),this.model?.setLanguageId(e,t)}setPreferredLanguageId(e){this.preferredLanguageId=e,this.setForceOpenAsText()}setPreferredContents(e){this.preferredContents=e,this.setForceOpenAsText()}setForceOpenAsText(){this.forceOpenAs=np.Text}setForceOpenAsBinary(){this.forceOpenAs=np.Binary}isDirty(){return!!this.model?.isDirty()}isSaving(){return this.model?.hasState(Mk.SAVED)||this.model?.hasState(Mk.CONFLICT)||this.model?.hasState(Mk.ERROR)?!1:this.filesConfigurationService.hasShortAutoSaveDelay(this)?!0:super.isSaving()}prefersEditorPane(e){return this.forceOpenAs===np.Binary?e.find(t=>t.typeId===fCe):e.find(t=>t.typeId===mCe)}resolve(e){return this.forceOpenAs===np.Binary?this.doResolveAsBinary():this.doResolveAsText(e)}async doResolveAsText(e){try{const t=this.preferredContents;this.preferredContents=void 0,await this.textFileService.files.resolve(this.resource,{languageId:this.preferredLanguageId,encoding:this.preferredEncoding,contents:typeof t=="string"?vne(t):void 0,reload:{async:!0},allowBinary:this.forceOpenAs===np.Text,reason:Xse.EDITOR,limits:this.ensureLimits(e)}),this.cachedTextFileModelReference||(this.cachedTextFileModelReference=await this.textModelService.createModelReference(this.resource));const i=this.cachedTextFileModelReference.object;return this.isDisposed()&&this.disposeModelReference(),i}catch(t){if(t.textFileOperationResult===jse.FILE_IS_BINARY)return this.doResolveAsBinary();throw t}}async doResolveAsBinary(){const e=this.instantiationService.createInstance(kU,this.preferredResource,this.getName());return await e.resolve(),e}isResolved(){return!!this.model}async rename(e,t){return{editor:{resource:t,encoding:this.getEncoding(),options:{viewState:Pb(this,e,this.editorService)}}}}toUntyped(e){const t={resource:this.preferredResource,forceFile:!0,options:{override:this.editorId}};return typeof e?.preserveViewState=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=(()=>{const i=this.textFileService.files.get(this.resource);if(i?.isDirty()&&!i.textEditorModel.isTooLargeForHeapOperation())return i.textEditorModel.getValue()})(),t.options={...t.options,viewState:Pb(this,e.preserveViewState,this.editorService)}),t}matches(e){return this===e?!0:e instanceof TU?Dt(e.resource,this.resource):eh(e)?super.matches(e):!1}dispose(){this.model=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){Qe(this.cachedTextFileModelReference),this.cachedTextFileModelReference=void 0}};AU=TU=f([p(7,J),p(8,Ds),p(9,yi),p(10,di),p(11,Xe),p(12,Ns),p(13,de),p(14,_c),p(15,Xo),p(16,wg)],AU);const The="saveConflictResolutionContext",RU="conflictResolution",b4="learnMoreDirtyWriteError",Ahe=h(6955,"Use the actions in the editor tool bar to either undo your changes or overwrite the content of the file with your changes.");let RZ=class extends F{static{this.ID="workbench.contrib.textFileSaveErrorHandler"}constructor(e,t,i,n,o,r,a){super(),this.notificationService=e,this.textFileService=t,this.editorService=n,this.instantiationService=r,this.storageService=a,this.messages=new wn,this.activeConflictResolutionResource=void 0,this.conflictResolutionContext=new O(The,!1,!0).bindTo(i);const c=this._register(r.createInstance(aA));this._register(o.registerTextModelContentProvider(RU,c)),this.textFileService.files.saveErrorHandler=this,this.registerListeners()}registerListeners(){this._register(this.textFileService.files.onDidSave(e=>this.onFileSavedOrReverted(e.model.resource))),this._register(this.textFileService.files.onDidRevert(e=>this.onFileSavedOrReverted(e.resource))),this._register(this.editorService.onDidActiveEditorChange(()=>this.onActiveEditorChanged()))}onActiveEditorChanged(){let e=!1,t;const i=this.editorService.activeEditor;i instanceof ro&&i.original.resource?.scheme===RU&&(e=!0,t=i.modified.resource),this.conflictResolutionContext.set(e),this.activeConflictResolutionResource=t}onFileSavedOrReverted(e){const t=this.messages.get(e);t&&(t.close(),this.messages.delete(e))}onSaveError(e,t,i){const n=e,o=t.resource;let r;const a=[],c=[];if(n.fileOperationResult===$n.FILE_MODIFIED_SINCE)if(this.activeConflictResolutionResource&&Dt(this.activeConflictResolutionResource,t.resource)){if(this.storageService.getBoolean(b4,he.APPLICATION))return;r=Ahe,a.push(this.instantiationService.createInstance(MP)),c.push(this.instantiationService.createInstance(LU))}else r=h(6956,"Failed to save '{0}': The content of the file is newer. Please compare your version with the file contents or overwrite the content of the file with your changes.",je(o)),a.push(this.instantiationService.createInstance(MU,t)),a.push(this.instantiationService.createInstance(W1e,t,i)),c.push(this.instantiationService.createInstance(OU));else{const u=n.fileOperationResult===$n.FILE_WRITE_LOCKED,g=u&&n.options?.unlock,m=n.fileOperationResult===$n.FILE_PERMISSION_DENIED,v=o.scheme===ae.file;v&&(m||g)?a.push(this.instantiationService.createInstance(M1e,t,i,!!g)):u?a.push(this.instantiationService.createInstance(F1e,t,i)):a.push(this.instantiationService.createInstance(N1e,t,i)),a.push(this.instantiationService.createInstance(NU,t)),a.push(this.instantiationService.createInstance(O1e,t)),u?g&&v?r=pn?h(6957,"Failed to save '{0}': File is read-only. Select 'Overwrite as Admin' to retry as administrator.",je(o)):h(6958,"Failed to save '{0}': File is read-only. Select 'Overwrite as Sudo' to retry as superuser.",je(o)):r=h(6959,"Failed to save '{0}': File is read-only. Select 'Overwrite' to attempt to make it writeable.",je(o)):v&&m?r=pn?h(6960,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Admin' to retry as administrator.",je(o)):h(6961,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Sudo' to retry as superuser.",je(o)):r=h(6962,"Failed to save '{0}': {1}",je(o),ho(e,!1))}const d={primary:a,secondary:c},l=this.notificationService.notify({id:`${cc(t.resource.toString())}`,severity:Me.Error,message:r,actions:d});D.once(l.onDidClose)(()=>{Qe(a),Qe(c)}),this.messages.set(t.resource,l)}dispose(){super.dispose(),this.messages.clear()}};RZ=f([p(0,At),p(1,Ds),p(2,me),p(3,de),p(4,yi),p(5,J),p(6,tt)],RZ);const PU=[];function L1e(){for(;PU.length>0;)PU.pop()?.close()}let MP=class extends Kt{constructor(e){super("workbench.files.action.resolveConflictLearnMore",h(6963,"Learn More")),this.openerService=e}async run(){await this.openerService.open(R.parse("https://go.microsoft.com/fwlink/?linkid=868264"))}};MP=f([p(0,hi)],MP);let LU=class extends Kt{constructor(e){super("workbench.files.action.resolveConflictLearnMoreDoNotShowAgain",h(6964,"Don't Show Again")),this.storageService=e}async run(e){this.storageService.store(b4,!0,he.APPLICATION,pt.USER),e.dispose()}};LU=f([p(0,tt)],LU);let MU=class extends Kt{constructor(e,t,i,n,o){super("workbench.files.action.resolveConflict",h(6965,"Compare")),this.model=e,this.editorService=t,this.notificationService=i,this.instantiationService=n,this.productService=o}async run(){if(!this.model.isDisposed()){const e=this.model.resource,t=je(e),i=h(6966,"{0} (in file) ↔ {1} (in {2}) - Resolve save conflict",t,t,this.productService.nameLong);await aA.open(e,RU,i,this.editorService,{pinned:!0});const n={primary:[this.instantiationService.createInstance(MP)]},o=this.notificationService.notify({id:`${cc(e.toString())}`,severity:Me.Info,message:Ahe,actions:n,neverShowAgain:{id:b4,isSecondary:!0}});D.once(o.onDidClose)(()=>Qe(n.primary)),PU.push(o)}}};MU=f([p(1,de),p(2,At),p(3,J),p(4,Fn)],MU);class M1e extends Kt{constructor(e,t,i){super("workbench.files.action.saveModelElevated",i?pn?h(6967,"Overwrite as Admin..."):h(6968,"Overwrite as Sudo..."):pn?h(6969,"Retry as Admin..."):h(6970,"Retry as Sudo...")),this.model=e,this.options=t,this.triedToUnlock=i}async run(){this.model.isDisposed()||await this.model.save({...this.options,writeElevated:!0,writeUnlock:this.triedToUnlock,reason:ui.EXPLICIT})}}class N1e extends Kt{constructor(e,t){super("workbench.files.action.saveModel",h(6971,"Retry")),this.model=e,this.options=t}async run(){this.model.isDisposed()||await this.model.save({...this.options,reason:ui.EXPLICIT})}}class O1e extends Kt{constructor(e){super("workbench.files.action.revertModel",h(6972,"Revert")),this.model=e}async run(){this.model.isDisposed()||await this.model.revert()}}let NU=class extends Kt{constructor(e,t){super("workbench.files.action.saveModelAs",qle.value),this.model=e,this.editorService=t}async run(){if(!this.model.isDisposed()){const e=this.findEditor();e&&await this.editorService.save(e,{saveAs:!0,reason:ui.EXPLICIT})}}findEditor(){let e;const t=this.editorService.findEditors(this.model.resource,{supportSideBySide:Ut.PRIMARY});for(const i of t)if(i.editor instanceof AU){e=i;break}else e||(e=i);return e}};NU=f([p(1,de)],NU);class F1e extends Kt{constructor(e,t){super("workbench.files.action.unlock",h(6973,"Overwrite")),this.model=e,this.options=t}async run(){this.model.isDisposed()||await this.model.save({...this.options,writeUnlock:!0,reason:ui.EXPLICIT})}}class W1e extends Kt{constructor(e,t){super("workbench.files.action.saveIgnoreModifiedSince",h(6973,"Overwrite")),this.model=e,this.options=t}async run(){this.model.isDisposed()||await this.model.save({...this.options,ignoreModifiedSince:!0,reason:ui.EXPLICIT})}}let OU=class extends Kt{constructor(e){super("workbench.files.action.configureSaveConflict",h(6974,"Configure")),this.preferencesService=e}async run(){this.preferencesService.openSettings({query:"files.saveConflictResolution"})}};OU=f([p(0,Fv)],OU);const B1e=(s,e)=>Rhe(s,e,!0),V1e=(s,e)=>Rhe(s,e,!1);async function Rhe(s,e,t){const i=s.get(de),n=i.activeEditorPane;if(!n)return;const o=n.input,r=n.group;if(L1e(),t){const a={ignoreModifiedSince:!0,reason:ui.EXPLICIT};await i.save({editor:o,groupId:r.id},a)}else await i.revert({editor:o,groupId:r.id});return await i.openEditor({resource:e},r),r.closeEditor(o)}function H1e(s){const e=s.lastFocusedList,t=e?.getHTMLElement();if(t&&gf(t)){let i;if(e instanceof Dv){const n=e.getFocusedElements();n.length&&(i=n[0])}else if(e instanceof wne){const n=e.getFocus();n.length&&(i=n[0])}return i}}function nS(s,e,t){if(R.isUri(s))return s;const i=H1e(t);return i instanceof Ss?i.resource:i instanceof Gn?i.getResource():xi.getOriginalUri(e.activeEditor,{supportSideBySide:Ut.PRIMARY})}function hD(s,e,t,i,n){const o=e.lastFocusedList,r=o?.getHTMLElement();if(r&&gf(r)){if(o instanceof wne&&o.getFocus().every(l=>l instanceof Ss)){const l=n.getContext(!0,!0);if(l.length)return l.map(u=>u.resource)}if(o instanceof Dv){const l=Vt(o.getSelectedElements().filter(y=>y instanceof Gn).map(y=>y.getResource())),u=o.getFocusedElements(),g=u.length?u[0]:void 0;let m;if(R.isUri(s))m=s.toString();else if(g instanceof Gn){const y=g.getResource();m=y?y.toString():void 0}const v=l.findIndex(y=>y.toString()===m);if(v!==-1){const y=l[v];return l.splice(v,1),l.unshift(y),l}}}const c=i.activeGroup.selectedEditors;if(c.length>1&&R.isUri(s)){const l=c.findIndex(u=>u.matches({resource:s}));if(l!==-1){const u=c[l];return c.splice(l,1),c.unshift(u),c.map(g=>xi.getOriginalUri(g)).filter(g=>!!g)}}const d=nS(s,t,e);return d?[d]:[]}function Phe(s){const e=s.get(Si).lastFocusedList,t=e?.getHTMLElement();if(t&&gf(t)&&e instanceof Dv){const i=Vt(e.getSelectedElements().filter(a=>a instanceof Gn)),n=e.getFocusedElements(),o=n.length?n[0]:void 0;let r;return o instanceof Gn&&(r=o),i.some(a=>a===r)?i:r?[r]:void 0}}const JO="addRootFolder",Lhe=I(2840,"Add Folder to Workspace..."),Mhe="setRootFolder",Nhe="_workbench.pickWorkspaceFolder";Ce.registerCommand({id:"workbench.action.files.openFileFolderInNewWindow",handler:s=>s.get(js).pickFileFolderAndOpen({forceNewWindow:!0})});Ce.registerCommand({id:"_files.pickFolderAndOpen",handler:(s,e)=>s.get(js).pickFolderAndOpen(e)});Ce.registerCommand({id:"workbench.action.files.openFolderInNewWindow",handler:s=>s.get(js).pickFolderAndOpen({forceNewWindow:!0})});Ce.registerCommand({id:"workbench.action.files.openFileInNewWindow",handler:s=>s.get(js).pickFileAndOpen({forceNewWindow:!0})});Ce.registerCommand({id:"workbench.action.openWorkspaceInNewWindow",handler:s=>s.get(js).pickWorkspaceAndOpen({forceNewWindow:!0})});Ce.registerCommand({id:JO,handler:async s=>{const e=s.get(uc),t=await Ohe(s);!t||!t.length||await e.addFolders(t.map(i=>({uri:i})))}});Ce.registerCommand({id:Mhe,handler:async s=>{const e=s.get(uc),t=s.get(Tt),i=await Ohe(s);!i||!i.length||await e.updateFolders(0,t.getWorkspace().folders.length,i.map(n=>({uri:n})))}});async function Ohe(s){const e=s.get(js),t=s.get(_c);return await e.showOpenDialog({openLabel:y_e(h(2841,"&&Add")),title:h(2842,"Add Folder to Workspace"),canSelectFolders:!0,canSelectMany:!0,defaultUri:await e.defaultFolderPath(),availableFileSystems:[t.defaultUriScheme]})}Ce.registerCommand(Nhe,async function(s,e){const t=s.get(zt),i=s.get(di),n=s.get(Tt),o=s.get(ai),r=s.get(fi),a=n.getWorkspace().folders;if(!a.length)return;const c=a.map(g=>{const m=g.name,v=i.getUriLabel(hs(g.uri),{relative:!0});return{label:m,description:v!==m?v:void 0,folder:g,iconClasses:uh(o,r,g.uri,Hi.ROOT_FOLDER)}}),d=(e?e[0]:void 0)||Object.create(null);d.activeItem||(d.activeItem=c[0]),d.placeHolder||(d.placeHolder=h(2843,"Select workspace folder")),typeof d.matchOnDescription!="boolean"&&(d.matchOnDescription=!0);const l=(e?e[1]:void 0)||ye.None,u=await t.pick(c,d,l);if(u)return a[c.indexOf(u)]});Ce.registerCommand({id:"vscode.openFolder",handler:(s,e,t)=>{const i=s.get(qe);if(typeof t=="boolean"&&(t={forceNewWindow:t}),!e){const a={forceNewWindow:t?.forceNewWindow};return t?.forceLocalWindow&&(a.remoteAuthority=null,a.availableFileSystems=["file"]),i.executeCommand("_files.pickFolderAndOpen",a)}const n=R.from(e,!0),o={forceNewWindow:t?.forceNewWindow,forceReuseWindow:t?.forceReuseWindow,noRecentEntry:t?.noRecentEntry,remoteAuthority:t?.forceLocalWindow?null:void 0,forceProfile:t?.forceProfile,forceTempProfile:t?.forceTempProfile},r=Pq(n)||n.scheme===ae.untitled?{workspaceUri:n}:{folderUri:n};return i.executeCommand("_files.windowOpen",[r],o)},metadata:{description:"Open a folder or workspace in the current window or new window depending on the newWindow argument. Note that opening in the same window will shutdown the current extension host process and start a new one on the given folder/workspace unless the newWindow parameter is set to true.",args:[{name:"uri",description:"(optional) Uri of the folder or workspace file to open. If not provided, a native dialog will ask the user for the folder",constraint:s=>s==null||s instanceof R},{name:"options",description:"(optional) Options. Object with the following properties: `forceNewWindow`: Whether to open the folder/workspace in a new window or the same. Defaults to opening in the same window. `forceReuseWindow`: Whether to force opening the folder/workspace in the same window.  Defaults to false. `noRecentEntry`: Whether the opened URI will appear in the 'Open Recent' list. Defaults to false. Note, for backward compatibility, options can also be of type boolean, representing the `forceNewWindow` setting.",constraint:s=>s===void 0||typeof s=="object"||typeof s=="boolean"}]}});Ce.registerCommand({id:"vscode.newWindow",handler:(s,e)=>{const t=s.get(qe),i={forceReuseWindow:e&&e.reuseWindow,remoteAuthority:e&&e.remoteAuthority};return t.executeCommand("_files.newWindow",i)},metadata:{description:"Opens an new window depending on the newWindow argument.",args:[{name:"options",description:"(optional) Options. Object with the following properties: `reuseWindow`: Whether to open a new window or the same. Defaults to opening in a new window. ",constraint:s=>s===void 0||typeof s=="object"}]}});Ce.registerCommand("_workbench.removeFromRecentlyOpened",function(s,e){return s.get(Wh).removeRecentlyOpened([e])});Ce.registerCommand({id:"vscode.removeFromRecentlyOpened",handler:(s,e)=>{const t=s.get(Wh);return typeof e=="string"?e=e.match(/^[^:/?#]+:\/\//)?R.parse(e):R.file(e):e=R.revive(e),t.removeRecentlyOpened([e])},metadata:{description:"Removes an entry with the given path from the recently opened list.",args:[{name:"path",description:"URI or URI string to remove from recently opened.",constraint:s=>typeof s=="string"||s instanceof R}]}});Ce.registerCommand("_workbench.addToRecentlyOpened",async function(s,e){const t=s.get(Wh),i=e.uri,n=e.label,o=e.remoteAuthority;let r;return e.type==="workspace"?r={workspace:await t.getWorkspaceIdentifier(i),label:n,remoteAuthority:o}:e.type==="folder"?r={folderUri:i,label:n,remoteAuthority:o}:r={fileUri:i,label:n,remoteAuthority:o},t.addRecentlyOpened([r])});Ce.registerCommand("_workbench.getRecentlyOpened",async function(s){return s.get(Wh).getRecentlyOpened()});const sS=I(2821,"Workspaces");class e1 extends X{static{this.ID="workbench.action.files.openFile"}constructor(){super({id:e1.ID,title:I(2822,"Open File..."),category:te.File,f1:!0,keybinding:{when:eg.toNegated(),weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyO}})}async run(e,t){return e.get(js).pickFileAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}class t1 extends X{static{this.ID="workbench.action.files.openFolder"}constructor(){super({id:t1.ID,title:I(2823,"Open Folder..."),category:te.File,f1:!0,precondition:yw,keybinding:{weight:W.WorkbenchContrib,primary:void 0,linux:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyO)},win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyO)}}})}async run(e,t){return e.get(js).pickFolderAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}class i1 extends X{static{this.ID="workbench.action.files.openFolderViaWorkspace"}constructor(){super({id:i1.ID,title:I(2823,"Open Folder..."),category:te.File,f1:!0,precondition:x.and(yw.toNegated(),yl.isEqualTo("workspace")),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyO}})}run(e){return e.get(qe).executeCommand(Mhe)}}class Cx extends X{static{this.ID="workbench.action.files.openFileFolder"}static{this.LABEL=I(2824,"Open...")}constructor(){super({id:Cx.ID,title:Cx.LABEL,category:te.File,f1:!0,precondition:x.and(eg,yw),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyO}})}async run(e,t){return e.get(js).pickFileFolderAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}class n1 extends X{static{this.ID="workbench.action.openWorkspace"}constructor(){super({id:n1.ID,title:I(2825,"Open Workspace from File..."),category:te.File,f1:!0,precondition:wl})}async run(e,t){return e.get(js).pickWorkspaceAndOpen({telemetryExtraData:t})}}class uD extends X{static{this.ID="workbench.action.closeFolder"}constructor(){super({id:uD.ID,title:I(2826,"Close Workspace"),category:sS,f1:!0,precondition:x.and(yl.notEqualsTo("empty"),_N),keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyF)}})}async run(e){const t=e.get(Wn),i=e.get(mn);return t.openWindow({forceReuseWindow:!0,remoteAuthority:i.remoteAuthority})}}class y4 extends X{static{this.ID="workbench.action.openWorkspaceConfigFile"}constructor(){super({id:y4.ID,title:I(2827,"Open Workspace Configuration File"),category:sS,f1:!0,precondition:yl.isEqualTo("workspace")})}async run(e){const t=e.get(Tt),i=e.get(de),n=t.getWorkspace().configuration;n&&await i.openEditor({resource:n,options:{pinned:!0}})}}class w4 extends X{static{this.ID="workbench.action.addRootFolder"}constructor(){super({id:w4.ID,title:Lhe,category:sS,f1:!0,precondition:x.or(wl,yl.isEqualTo("workspace"))})}run(e){return e.get(qe).executeCommand(JO)}}class s1 extends X{static{this.ID="workbench.action.removeRootFolder"}constructor(){super({id:s1.ID,title:I(2828,"Remove Folder from Workspace..."),category:sS,f1:!0,precondition:x.and(bN.notEqualsTo("0"),x.or(wl,yl.isEqualTo("workspace")))})}async run(e){const t=e.get(qe),i=e.get(uc),n=await t.executeCommand(Nhe);n&&await i.removeFolders([n.uri])}}class o1 extends X{static{this.ID="workbench.action.saveWorkspaceAs"}constructor(){super({id:o1.ID,title:I(2829,"Save Workspace As..."),category:sS,f1:!0,precondition:wl})}async run(e){const t=e.get(uc),i=e.get(Tt),n=await t.pickNewWorkspacePath();if(n&&Pq(n))switch(i.getWorkbenchState()){case zo.EMPTY:case zo.FOLDER:{const o=i.getWorkspace().folders.map(r=>({uri:r.uri}));return t.createAndEnterWorkspace(o,n)}case zo.WORKSPACE:return t.saveAndEnterWorkspace(n)}}}class r1 extends X{static{this.ID="workbench.action.duplicateWorkspaceInNewWindow"}constructor(){super({id:r1.ID,title:I(2830,"Duplicate As Workspace in New Window"),category:sS,f1:!0,precondition:wl})}async run(e){const t=e.get(Tt),i=e.get(uc),n=e.get(Wn),o=e.get(Wh),r=e.get(mn),a=t.getWorkspace().folders,c=r.remoteAuthority,d=await o.createUntitledWorkspace(a,c);return await i.copyWorkspaceSettings(d),n.openWindow([{workspaceUri:d.configPath}],{forceNewWindow:!0,remoteAuthority:c})}}K(w4);K(s1);K(e1);K(t1);K(i1);K(Cx);K(n1);K(y4);K(uD);K(o1);K(r1);ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:e1.ID,title:h(2831,"&&Open File...")},order:1,when:eg.toNegated()});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:t1.ID,title:h(2832,"Open &&Folder...")},order:2,when:yw});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:i1.ID,title:h(2832,"Open &&Folder...")},order:2,when:x.and(yw.toNegated(),yl.isEqualTo("workspace"))});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:Cx.ID,title:h(2833,"&&Open...")},order:1,when:x.and(eg,yw)});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:n1.ID,title:h(2834,"Open Wor&&kspace from File...")},order:3,when:wl});ge.appendMenuItem(N.MenubarFileMenu,{group:"3_workspace",command:{id:JO,title:h(2835,"A&&dd Folder to Workspace...")},when:x.or(wl,yl.isEqualTo("workspace")),order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"3_workspace",command:{id:o1.ID,title:h(2836,"Save Workspace As...")},order:2,when:wl});ge.appendMenuItem(N.MenubarFileMenu,{group:"3_workspace",command:{id:r1.ID,title:h(2837,"Duplicate Workspace")},order:3,when:wl});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:uD.ID,title:h(2838,"Close &&Folder")},order:3,when:x.and(yl.isEqualTo("folder"),_N)});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:uD.ID,title:h(2839,"Close &&Workspace")},order:3,when:x.and(yl.isEqualTo("workspace"),_N)});const U1e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var pc;(function(s){s[s.NONE=0]="NONE",s[s.EDITS=1]="EDITS",s[s.NAVIGATION=2]="NAVIGATION"})(pc||(pc={}));var PZ;(function(s){s[s.DEFAULT=0]="DEFAULT",s[s.EDITOR_GROUP=1]="EDITOR_GROUP",s[s.EDITOR=2]="EDITOR"})(PZ||(PZ={}));class un extends X{constructor(e,t,i){super(e),this.commandId=t,this.commandArgs=i}run(e){return e.get(qe).executeCommand(this.commandId,this.commandArgs)}}class Fhe extends X{getDirection(e){return Vv(e)}async run(e,...t){const i=e.get(Ie),n=e.get(ne),o=e.get(de),r=e.get(Si),a=this.getDirection(n),c=Rs(t,o,i,r);vhe(i,a,c)}}class Whe extends Fhe{static{this.ID=fhe}constructor(){super({id:Whe.ID,title:I(3100,"Split Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Backslash},category:te.View})}}class dQe extends Fhe{constructor(){super({id:"workbench.action.splitEditorOrthogonal",title:I(3101,"Split Editor Orthogonal"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View})}getDirection(e){return Vv(e)===Xt.RIGHT?Xt.DOWN:Xt.RIGHT}}class lQe extends un{constructor(){super({id:wU,title:I(3102,"Split Editor Left"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},wU)}}class hQe extends un{constructor(){super({id:SU,title:I(3103,"Split Editor Right"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},SU)}}class uQe extends un{static{this.LABEL=h(3104,"Split Editor Up")}constructor(){super({id:bU,title:I(3104,"Split Editor Up"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},bU)}}class gQe extends un{static{this.LABEL=h(3105,"Split Editor Down")}constructor(){super({id:yU,title:I(3105,"Split Editor Down"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},yU)}}class pQe extends X{constructor(){super({id:"workbench.action.joinTwoGroups",title:I(3106,"Join Editor Group with Next Group"),f1:!0,category:te.View})}async run(e,t){const i=e.get(Ie);let n;if(t&&typeof t.groupId=="number"?n=i.getGroup(t.groupId):n=i.activeGroup,n){const o=[Xt.RIGHT,Xt.DOWN,Xt.LEFT,Xt.UP];for(const r of o){const a=i.findGroup({direction:r},n);if(a&&n!==a){i.mergeGroup(n,a);break}}}}}class fQe extends X{constructor(){super({id:"workbench.action.joinAllGroups",title:I(3107,"Join All Editor Groups"),f1:!0,category:te.View})}async run(e){const t=e.get(Ie);t.mergeAllGroups(t.activeGroup)}}class mQe extends X{constructor(){super({id:"workbench.action.navigateEditorGroups",title:I(3108,"Navigate Between Editor Groups"),f1:!0,category:te.View})}async run(e){const t=e.get(Ie);t.findGroup({location:Xa.NEXT},t.activeGroup,!0)?.focus()}}class vQe extends X{constructor(){super({id:"workbench.action.focusActiveEditorGroup",title:I(3109,"Focus Active Editor Group"),f1:!0,category:te.View})}async run(e){e.get(Ie).activeGroup.focus()}}class If extends X{constructor(e,t){super(e),this.scope=t}async run(e){const t=e.get(Ie);t.findGroup(this.scope,t.activeGroup,!0)?.focus()}}class _Qe extends If{constructor(){super({id:"workbench.action.focusFirstEditorGroup",title:I(3110,"Focus First Editor Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Digit1},category:te.View},{location:Xa.FIRST})}}class bQe extends If{constructor(){super({id:"workbench.action.focusLastEditorGroup",title:I(3111,"Focus Last Editor Group"),f1:!0,category:te.View},{location:Xa.LAST})}}class yQe extends If{constructor(){super({id:"workbench.action.focusNextGroup",title:I(3112,"Focus Next Editor Group"),f1:!0,category:te.View},{location:Xa.NEXT})}}class wQe extends If{constructor(){super({id:"workbench.action.focusPreviousGroup",title:I(3113,"Focus Previous Editor Group"),f1:!0,category:te.View},{location:Xa.PREVIOUS})}}class SQe extends If{constructor(){super({id:"workbench.action.focusLeftGroup",title:I(3114,"Focus Left Editor Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.LeftArrow)},category:te.View},{direction:Xt.LEFT})}}class CQe extends If{constructor(){super({id:"workbench.action.focusRightGroup",title:I(3115,"Focus Right Editor Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.RightArrow)},category:te.View},{direction:Xt.RIGHT})}}class EQe extends If{constructor(){super({id:"workbench.action.focusAboveGroup",title:I(3116,"Focus Editor Group Above"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.UpArrow)},category:te.View},{direction:Xt.UP})}}class xQe extends If{constructor(){super({id:"workbench.action.focusBelowGroup",title:I(3117,"Focus Editor Group Below"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.DownArrow)},category:te.View},{direction:Xt.DOWN})}}let qC=class extends Kt{static{this.ID="workbench.action.closeActiveEditor"}static{this.LABEL=h(3118,"Close Editor")}constructor(e,t,i){super(e,t,Te.asClassName(j.close)),this.commandService=i}run(e){return this.commandService.executeCommand(iS,void 0,e)}};qC=f([p(2,qe)],qC);let Ap=class extends Kt{static{this.ID="workbench.action.unpinActiveEditor"}static{this.LABEL=h(3119,"Unpin Editor")}constructor(e,t,i){super(e,t,Te.asClassName(j.pinned)),this.commandService=i}run(e){return this.commandService.executeCommand(f4,void 0,e)}};Ap=f([p(2,qe)],Ap);let zC=class extends Kt{static{this.ID="workbench.action.closeActiveEditor"}static{this.LABEL=h(3120,"Close")}constructor(e,t,i){super(e,t,Te.asClassName(j.close)),this.editorGroupService=i}async run(e){const t=e?this.editorGroupService.getGroup(e.groupId):this.editorGroupService.activeGroup;if(!t)return;const i=e?.editorIndex!==void 0?t.getEditorByIndex(e.editorIndex):t.activeEditor;if(!i)return;const n=[];t.isSelected(i)?n.push(...t.selectedEditors):n.push(i);for(const o of n)await t.closeEditor(o,{preserveFocus:e?.preserveFocus})}};zC=f([p(2,Ie)],zC);class TQe extends X{constructor(){super({id:"workbench.action.revertAndCloseActiveEditor",title:I(3121,"Revert and Close Editor"),f1:!0,category:te.View})}async run(e){const t=e.get(de),i=e.get(Pe),n=t.activeEditorPane;if(n){const o=n.input,r=n.group;try{await t.revert({editor:o,groupId:r.id})}catch(a){i.error(a),await t.revert({editor:o,groupId:r.id},{soft:!0})}await r.closeEditor(o)}}}class AQe extends X{constructor(){super({id:"workbench.action.closeEditorsToTheLeft",title:I(3122,"Close Editors to the Left in Group"),f1:!0,category:te.View})}async run(e,t){const i=e.get(Ie),{group:n,editor:o}=this.getTarget(i,t);n&&o&&await n.closeEditors({direction:tz.LEFT,except:o,excludeSticky:!0})}getTarget(e,t){return t?{editor:t.editor,group:e.getGroup(t.groupId)}:{group:e.activeGroup,editor:e.activeGroup.activeEditor}}}class Bhe extends X{groupsToClose(e){const t=[],i=e.getGroups(Ko.GRID_APPEARANCE);for(let n=i.length-1;n>=0;n--)t.push(i[n]);return t}async run(e){const t=e.get(de),i=e.get(Pe),n=e.get(bl),o=e.get(Ie),r=e.get(Ns),a=e.get(js),c=new Set,d=new Set,l=new Set,u=new Map;for(const{editor:g,groupId:m}of t.getEditors(Ai.SEQUENTIAL,{excludeSticky:this.excludeSticky})){let v=!1,y=!1;if(g.closeHandler)try{v=g.closeHandler.showConfirm()}catch(w){i.error(w),y=!0}if((!g.closeHandler||y)&&(v=g.isDirty()&&!g.isSaving()),!!v)if(typeof g.closeHandler?.confirm=="function"){let w=u.get(g.typeId);w||(w=new Set,u.set(g.typeId,w)),w.add({editor:g,groupId:m})}else!g.hasCapability(Ze.Untitled)&&r.getAutoSaveMode(g).mode===cA.ON_FOCUS_CHANGE?d.add({editor:g,groupId:m}):ra&&(pn||vh)&&!g.hasCapability(Ze.Untitled)&&r.getAutoSaveMode(g).mode===cA.ON_WINDOW_CHANGE?l.add({editor:g,groupId:m}):c.add({editor:g,groupId:m})}if(c.size>0){const g=Array.from(c.values());switch(await this.revealEditorsToConfirm(g,o),await a.showSaveConfirm(g.map(({editor:v})=>v instanceof ws?v.primary.getName():v.getName()))){case zi.CANCEL:return;case zi.DONT_SAVE:await this.revertEditors(t,i,n,g);break;case zi.SAVE:await t.save(g,{reason:ui.EXPLICIT});break}}for(const[,g]of u){const m=Array.from(g.values());await this.revealEditorsToConfirm(m,o);const v=await m.at(0)?.editor.closeHandler?.confirm?.(m);if(typeof v=="number")switch(v){case zi.CANCEL:return;case zi.DONT_SAVE:await this.revertEditors(t,i,n,m);break;case zi.SAVE:await t.save(m,{reason:ui.EXPLICIT});break}}if(d.size>0){const g=Array.from(d.values());await t.save(g,{reason:ui.FOCUS_CHANGE})}if(l.size>0){const g=Array.from(l.values());await t.save(g,{reason:ui.WINDOW_CHANGE})}return this.doCloseAll(o)}revertEditors(e,t,i,n){return i.withProgress({location:qo.Window,delay:800,title:h(3123,"Reverting Editors...")},()=>this.doRevertEditors(e,t,n))}async doRevertEditors(e,t,i){try{await e.revert(i)}catch(n){t.error(n),await e.revert(i,{soft:!0})}}async revealEditorsToConfirm(e,t){try{const i=new Set;for(const{editor:n,groupId:o}of e){if(i.has(o))continue;i.add(o),await t.getGroup(o)?.openEditor(n)}}catch{}}async doCloseAll(e){await Promise.all(this.groupsToClose(e).map(t=>t.closeAllEditors({excludeSticky:this.excludeSticky})))}}class Ex extends Bhe{static{this.ID="workbench.action.closeAllEditors"}static{this.LABEL=I(3124,"Close All Editors")}constructor(){super({id:Ex.ID,title:Ex.LABEL,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyW)},icon:j.closeAll,category:te.View})}get excludeSticky(){return!0}}class RQe extends Bhe{constructor(){super({id:"workbench.action.closeAllGroups",title:I(3125,"Close All Editor Groups"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyW)},category:te.View})}get excludeSticky(){return!1}async doCloseAll(e){await super.doCloseAll(e);for(const t of this.groupsToClose(e))e.removeGroup(t)}}class PQe extends X{constructor(){super({id:"workbench.action.closeEditorsInOtherGroups",title:I(3126,"Close Editors in Other Groups"),f1:!0,category:te.View})}async run(e,t){const i=e.get(Ie),n=t?i.getGroup(t.groupId):i.activeGroup;await Promise.all(i.getGroups(Ko.MOST_RECENTLY_ACTIVE).map(async o=>{if(!(n&&o.id===n.id))return o.closeAllEditors({excludeSticky:!0})}))}}class LQe extends X{constructor(){super({id:"workbench.action.closeEditorInAllGroups",title:I(3127,"Close Editor in All Groups"),f1:!0,category:te.View})}async run(e){const t=e.get(de),i=e.get(Ie),n=t.activeEditor;n&&await Promise.all(i.getGroups(Ko.MOST_RECENTLY_ACTIVE).map(o=>o.closeEditor(n)))}}class Vhe extends X{constructor(e,t,i){super(e),this.direction=t,this.isMove=i}async run(e,t){const i=e.get(Ie);let n;if(t&&typeof t.groupId=="number"?n=i.getGroup(t.groupId):n=i.activeGroup,n){let o;if(this.isMove){const r=this.findTargetGroup(i,n);r&&(o=i.moveGroup(n,r,this.direction))}else o=i.copyGroup(n,n,this.direction);o&&i.activateGroup(o)}}findTargetGroup(e,t){const i=[this.direction];switch(this.direction){case Xt.LEFT:case Xt.RIGHT:i.push(Xt.UP,Xt.DOWN);break;case Xt.UP:case Xt.DOWN:i.push(Xt.LEFT,Xt.RIGHT);break}for(const n of i){const o=e.findGroup({direction:n},t);if(o)return o}}}class a1 extends Vhe{constructor(e,t){super(e,t,!0)}}class MQe extends a1{constructor(){super({id:"workbench.action.moveActiveEditorGroupLeft",title:I(3128,"Move Editor Group Left"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.LeftArrow)},category:te.View},Xt.LEFT)}}class NQe extends a1{constructor(){super({id:"workbench.action.moveActiveEditorGroupRight",title:I(3129,"Move Editor Group Right"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.RightArrow)},category:te.View},Xt.RIGHT)}}class OQe extends a1{constructor(){super({id:"workbench.action.moveActiveEditorGroupUp",title:I(3130,"Move Editor Group Up"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.UpArrow)},category:te.View},Xt.UP)}}class FQe extends a1{constructor(){super({id:"workbench.action.moveActiveEditorGroupDown",title:I(3131,"Move Editor Group Down"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.DownArrow)},category:te.View},Xt.DOWN)}}class c1 extends Vhe{constructor(e,t){super(e,t,!1)}}class WQe extends c1{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupLeft",title:I(3132,"Duplicate Editor Group Left"),f1:!0,category:te.View},Xt.LEFT)}}class BQe extends c1{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupRight",title:I(3133,"Duplicate Editor Group Right"),f1:!0,category:te.View},Xt.RIGHT)}}class VQe extends c1{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupUp",title:I(3134,"Duplicate Editor Group Up"),f1:!0,category:te.View},Xt.UP)}}class HQe extends c1{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupDown",title:I(3135,"Duplicate Editor Group Down"),f1:!0,category:te.View},Xt.DOWN)}}class UQe extends X{constructor(){super({id:"workbench.action.minimizeOtherEditors",title:I(3136,"Expand Editor Group"),f1:!0,category:te.View,precondition:vN})}async run(e){e.get(Ie).arrangeGroups(yN.EXPAND)}}class $Qe extends X{constructor(){super({id:"workbench.action.minimizeOtherEditorsHideSidebar",title:I(3137,"Expand Editor Group and Hide Side Bars"),f1:!0,category:te.View,precondition:x.or(vN,xm,yp)})}async run(e){const t=e.get(Ie),i=e.get(vi);i.setPartHidden(!0,ot.SIDEBAR_PART),i.setPartHidden(!0,ot.AUXILIARYBAR_PART),t.arrangeGroups(yN.EXPAND)}}class GQe extends X{constructor(){super({id:"workbench.action.evenEditorWidths",title:I(3138,"Reset Editor Group Sizes"),f1:!0,category:te.View})}async run(e){e.get(Ie).arrangeGroups(yN.EVEN)}}class qQe extends X{constructor(){super({id:"workbench.action.toggleEditorWidths",title:I(3139,"Toggle Editor Group Sizes"),f1:!0,category:te.View})}async run(e){e.get(Ie).toggleExpandGroup()}}class zQe extends X{constructor(){super({id:"workbench.action.maximizeEditorHideSidebar",title:I(3140,"Maximize Editor Group and Hide Side Bars"),f1:!0,category:te.View,precondition:x.or(x.and(MS.negate(),Zse),xm,yp)})}async run(e){const t=e.get(vi),i=e.get(Ie);e.get(de).activeEditor&&(t.setPartHidden(!0,ot.SIDEBAR_PART),t.setPartHidden(!0,ot.AUXILIARYBAR_PART),i.arrangeGroups(yN.MAXIMIZE))}}class KQe extends X{constructor(){super({id:mhe,title:I(3141,"Toggle Maximize Editor Group"),f1:!0,category:te.View,precondition:x.or(Zse,MS),keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyM)},menu:[{id:N.EditorTitle,order:-1e4,group:"navigation",when:MS},{id:N.EmptyEditorGroup,order:-1e4,group:"navigation",when:MS}],icon:j.screenFull,toggled:MS})}async run(e,...t){const i=e.get(Ie),n=e.get(de),o=e.get(Si),r=Rs(t,n,i,o);r.groupedEditors.length&&i.toggleMaximizeGroup(r.groupedEditors[0].group)}}class oS extends X{async run(e){const t=e.get(Ie),i=this.navigate(t);if(!i)return;const{groupId:n,editor:o}=i;if(!o)return;const r=t.getGroup(n);r&&await r.openEditor(o)}}class jQe extends oS{constructor(){super({id:"workbench.action.nextEditor",title:I(3142,"Open Next Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.PageDown,mac:{primary:E.CtrlCmd|E.Alt|S.RightArrow,secondary:[E.CtrlCmd|E.Shift|S.BracketRight]}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ai.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;if(n+1<i.length)return{editor:i[n+1],groupId:t.id};const o=new Set;let r=e.activeGroup;for(;r&&!o.has(r.id);)if(r=e.findGroup({location:Xa.NEXT},r,!0),r){o.add(r.id);const a=r.getEditors(Ai.SEQUENTIAL);if(a.length>0)return{editor:a[0],groupId:r.id}}}}class YQe extends oS{constructor(){super({id:"workbench.action.previousEditor",title:I(3143,"Open Previous Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.PageUp,mac:{primary:E.CtrlCmd|E.Alt|S.LeftArrow,secondary:[E.CtrlCmd|E.Shift|S.BracketLeft]}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ai.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;if(n>0)return{editor:i[n-1],groupId:t.id};const o=new Set;let r=e.activeGroup;for(;r&&!o.has(r.id);)if(r=e.findGroup({location:Xa.PREVIOUS},r,!0),r){o.add(r.id);const a=r.getEditors(Ai.SEQUENTIAL);if(a.length>0)return{editor:a[a.length-1],groupId:r.id}}}}class QQe extends oS{constructor(){super({id:"workbench.action.nextEditorInGroup",title:I(3144,"Open Next Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.PageDown),mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Alt|S.RightArrow)}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ai.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;return{editor:n+1<i.length?i[n+1]:i[0],groupId:t.id}}}class XQe extends oS{constructor(){super({id:"workbench.action.previousEditorInGroup",title:I(3145,"Open Previous Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.PageUp),mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Alt|S.LeftArrow)}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ai.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;return{editor:n>0?i[n-1]:i[i.length-1],groupId:t.id}}}class ZQe extends oS{constructor(){super({id:"workbench.action.firstEditorInGroup",title:I(3146,"Open First Editor in Group"),f1:!0,category:te.View})}navigate(e){const t=e.activeGroup;return{editor:t.getEditors(Ai.SEQUENTIAL)[0],groupId:t.id}}}class JQe extends oS{constructor(){super({id:"workbench.action.lastEditorInGroup",title:I(3147,"Open Last Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.Alt|S.Digit0,secondary:[E.CtrlCmd|S.Digit9],mac:{primary:E.WinCtrl|S.Digit0,secondary:[E.CtrlCmd|S.Digit9]}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ai.SEQUENTIAL);return{editor:i[i.length-1],groupId:t.id}}}class Hhe extends X{static{this.ID="workbench.action.navigateForward"}static{this.LABEL=h(3148,"Go Forward")}constructor(){super({id:Hhe.ID,title:{...I(3148,"Go Forward"),mnemonicTitle:h(3149,"&&Forward")},f1:!0,icon:j.arrowRight,precondition:x.has("canNavigateForward"),keybinding:{weight:W.WorkbenchContrib,win:{primary:E.Alt|S.RightArrow,secondary:[S.BrowserForward]},mac:{primary:E.WinCtrl|E.Shift|S.Minus,secondary:[S.BrowserForward]},linux:{primary:E.CtrlCmd|E.Shift|S.Minus,secondary:[S.BrowserForward]}},menu:[{id:N.MenubarGoMenu,group:"1_history_nav",order:2},{id:N.CommandCenter,order:2,when:x.has("config.workbench.navigationControl.enabled")}]})}async run(e){await e.get(fo).goForward(pc.NONE)}}class Uhe extends X{static{this.ID="workbench.action.navigateBack"}static{this.LABEL=h(3150,"Go Back")}constructor(){super({id:Uhe.ID,title:{...I(3150,"Go Back"),mnemonicTitle:h(3151,"&&Back")},f1:!0,precondition:x.has("canNavigateBack"),icon:j.arrowLeft,keybinding:{weight:W.WorkbenchContrib,win:{primary:E.Alt|S.LeftArrow,secondary:[S.BrowserBack]},mac:{primary:E.WinCtrl|S.Minus,secondary:[S.BrowserBack]},linux:{primary:E.CtrlCmd|E.Alt|S.Minus,secondary:[S.BrowserBack]}},menu:[{id:N.MenubarGoMenu,group:"1_history_nav",order:1},{id:N.CommandCenter,order:1,when:x.has("config.workbench.navigationControl.enabled")}]})}async run(e){await e.get(fo).goBack(pc.NONE)}}class eXe extends X{constructor(){super({id:"workbench.action.navigateLast",title:I(3152,"Go Previous"),f1:!0})}async run(e){await e.get(fo).goPrevious(pc.NONE)}}class tXe extends X{constructor(){super({id:"workbench.action.navigateForwardInEditLocations",title:I(3153,"Go Forward in Edit Locations"),f1:!0})}async run(e){await e.get(fo).goForward(pc.EDITS)}}class iXe extends X{constructor(){super({id:"workbench.action.navigateBackInEditLocations",title:I(3154,"Go Back in Edit Locations"),f1:!0})}async run(e){await e.get(fo).goBack(pc.EDITS)}}class nXe extends X{constructor(){super({id:"workbench.action.navigatePreviousInEditLocations",title:I(3155,"Go Previous in Edit Locations"),f1:!0})}async run(e){await e.get(fo).goPrevious(pc.EDITS)}}class sXe extends X{constructor(){super({id:"workbench.action.navigateToLastEditLocation",title:I(3156,"Go to Last Edit Location"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyQ)}})}async run(e){await e.get(fo).goLast(pc.EDITS)}}class oXe extends X{constructor(){super({id:"workbench.action.navigateForwardInNavigationLocations",title:I(3157,"Go Forward in Navigation Locations"),f1:!0})}async run(e){await e.get(fo).goForward(pc.NAVIGATION)}}class rXe extends X{constructor(){super({id:"workbench.action.navigateBackInNavigationLocations",title:I(3158,"Go Back in Navigation Locations"),f1:!0})}async run(e){await e.get(fo).goBack(pc.NAVIGATION)}}class aXe extends X{constructor(){super({id:"workbench.action.navigatePreviousInNavigationLocations",title:I(3159,"Go Previous in Navigation Locations"),f1:!0})}async run(e){await e.get(fo).goPrevious(pc.NAVIGATION)}}class cXe extends X{constructor(){super({id:"workbench.action.navigateToLastNavigationLocation",title:I(3160,"Go to Last Navigation Location"),f1:!0})}async run(e){await e.get(fo).goLast(pc.NAVIGATION)}}class $he extends X{static{this.ID="workbench.action.reopenClosedEditor"}constructor(){super({id:$he.ID,title:I(3161,"Reopen Closed Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.KeyT},category:te.View})}async run(e){await e.get(fo).reopenLastClosedEditor()}}class Ghe extends X{static{this.ID="workbench.action.clearRecentFiles"}constructor(){super({id:Ghe.ID,title:I(3162,"Clear Recently Opened..."),f1:!0,category:te.File})}async run(e){const t=e.get(Qt),i=e.get(Wh),n=e.get(fo),{confirmed:o}=await t.confirm({type:"warning",message:h(3163,"Do you want to clear all recently opened files and workspaces?"),detail:h(3164,"This action is irreversible!"),primaryButton:h(3165,"&&Clear")});o&&(i.clearRecentlyOpened(),n.clearRecentlyOpened())}}class qhe extends X{static{this.ID="workbench.action.showEditorsInActiveGroup"}constructor(){super({id:qhe.ID,title:I(3166,"Show Editors in Active Group By Most Recently Used"),f1:!0,category:te.View})}async run(e){e.get(zt).quickAccess.show(qy.PREFIX)}}class zhe extends X{static{this.ID="workbench.action.showAllEditors"}constructor(){super({id:zhe.ID,title:I(3167,"Show All Editors By Appearance"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyP),mac:{primary:E.CtrlCmd|E.Alt|S.Tab}},category:te.File})}async run(e){e.get(zt).quickAccess.show(pU.PREFIX)}}class Khe extends X{static{this.ID="workbench.action.showAllEditorsByMostRecentlyUsed"}constructor(){super({id:Khe.ID,title:I(3168,"Show All Editors By Most Recently Used"),f1:!0,category:te.View})}async run(e){e.get(zt).quickAccess.show(Sx.PREFIX)}}class d1 extends X{constructor(e,t,i){super(e),this.prefix=t,this.itemActivation=i}async run(e){const t=e.get(Ve),i=e.get(zt),n=t.lookupKeybindings(this.desc.id);i.quickAccess.show(this.prefix,{quickNavigateConfiguration:{keybindings:n},itemActivation:this.itemActivation})}}class dXe extends d1{constructor(){super({id:"workbench.action.quickOpenPreviousRecentlyUsedEditor",title:I(3169,"Quick Open Previous Recently Used Editor"),f1:!0,category:te.View},Sx.PREFIX,void 0)}}class lXe extends d1{constructor(){super({id:"workbench.action.quickOpenLeastRecentlyUsedEditor",title:I(3170,"Quick Open Least Recently Used Editor"),f1:!0,category:te.View},Sx.PREFIX,void 0)}}class hXe extends d1{constructor(){super({id:"workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup",title:I(3171,"Quick Open Previous Recently Used Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Tab,mac:{primary:E.WinCtrl|S.Tab}},precondition:ez.toNegated(),category:te.View},qy.PREFIX,void 0)}}class uXe extends d1{constructor(){super({id:"workbench.action.quickOpenLeastRecentlyUsedEditorInGroup",title:I(3172,"Quick Open Least Recently Used Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Tab,mac:{primary:E.WinCtrl|E.Shift|S.Tab}},precondition:ez.toNegated(),category:te.View},qy.PREFIX,fw.LAST)}}class FU extends X{static{this.ID="workbench.action.openPreviousEditorFromHistory"}constructor(){super({id:FU.ID,title:I(3173,"Quick Open Previous Editor from History"),f1:!0})}async run(e){const t=e.get(Ve),i=e.get(zt),n=e.get(Ie),o=t.lookupKeybindings(FU.ID);let r;n.activeGroup.count===0&&(r=fw.FIRST),i.quickAccess.show("",{quickNavigateConfiguration:{keybindings:o},itemActivation:r})}}class gXe extends X{constructor(){super({id:"workbench.action.openNextRecentlyUsedEditor",title:I(3174,"Open Next Recently Used Editor"),f1:!0,category:te.View})}async run(e){e.get(fo).openNextRecentlyUsedEditor()}}class pXe extends X{constructor(){super({id:"workbench.action.openPreviousRecentlyUsedEditor",title:I(3175,"Open Previous Recently Used Editor"),f1:!0,category:te.View})}async run(e){e.get(fo).openPreviouslyUsedEditor()}}class fXe extends X{constructor(){super({id:"workbench.action.openNextRecentlyUsedEditorInGroup",title:I(3176,"Open Next Recently Used Editor In Group"),f1:!0,category:te.View})}async run(e){const t=e.get(fo),i=e.get(Ie);t.openNextRecentlyUsedEditor(i.activeGroup.id)}}class mXe extends X{constructor(){super({id:"workbench.action.openPreviousRecentlyUsedEditorInGroup",title:I(3177,"Open Previous Recently Used Editor In Group"),f1:!0,category:te.View})}async run(e){const t=e.get(fo),i=e.get(Ie);t.openPreviouslyUsedEditor(i.activeGroup.id)}}class vXe extends X{constructor(){super({id:"workbench.action.clearEditorHistory",title:I(3178,"Clear Editor History"),f1:!0})}async run(e){const t=e.get(Qt),i=e.get(fo),{confirmed:n}=await t.confirm({type:"warning",message:h(3179,"Do you want to clear the history of recently opened editors?"),detail:h(3164,"This action is irreversible!"),primaryButton:h(3165,"&&Clear")});n&&i.clear()}}class _Xe extends un{constructor(){super({id:"workbench.action.moveEditorLeftInGroup",title:I(3180,"Move Editor Left"),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.PageUp,mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.LeftArrow)}},f1:!0,category:te.View},Tl,{to:"left"})}}class bXe extends un{constructor(){super({id:"workbench.action.moveEditorRightInGroup",title:I(3181,"Move Editor Right"),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.PageDown,mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.RightArrow)}},f1:!0,category:te.View},Tl,{to:"right"})}}class yXe extends un{constructor(){super({id:"workbench.action.moveEditorToPreviousGroup",title:I(3182,"Move Editor into Previous Group"),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Alt|S.LeftArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|S.LeftArrow}},f1:!0,category:te.View},Tl,{to:"previous",by:"group"})}}class wXe extends un{constructor(){super({id:"workbench.action.moveEditorToNextGroup",title:I(3183,"Move Editor into Next Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Alt|S.RightArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|S.RightArrow}},category:te.View},Tl,{to:"next",by:"group"})}}class SXe extends un{constructor(){super({id:"workbench.action.moveEditorToAboveGroup",title:I(3184,"Move Editor into Group Above"),f1:!0,category:te.View},Tl,{to:"up",by:"group"})}}class CXe extends un{constructor(){super({id:"workbench.action.moveEditorToBelowGroup",title:I(3185,"Move Editor into Group Below"),f1:!0,category:te.View},Tl,{to:"down",by:"group"})}}class EXe extends un{constructor(){super({id:"workbench.action.moveEditorToLeftGroup",title:I(3186,"Move Editor into Left Group"),f1:!0,category:te.View},Tl,{to:"left",by:"group"})}}class xXe extends un{constructor(){super({id:"workbench.action.moveEditorToRightGroup",title:I(3187,"Move Editor into Right Group"),f1:!0,category:te.View},Tl,{to:"right",by:"group"})}}class IXe extends un{constructor(){super({id:"workbench.action.moveEditorToFirstGroup",title:I(3188,"Move Editor into First Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.Shift|E.Alt|S.Digit1,mac:{primary:E.CtrlCmd|E.WinCtrl|S.Digit1}},category:te.View},Tl,{to:"first",by:"group"})}}class DXe extends un{constructor(){super({id:"workbench.action.moveEditorToLastGroup",title:I(3189,"Move Editor into Last Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.Shift|E.Alt|S.Digit9,mac:{primary:E.CtrlCmd|E.WinCtrl|S.Digit9}},category:te.View},Tl,{to:"last",by:"group"})}}class kXe extends un{constructor(){super({id:"workbench.action.splitEditorToPreviousGroup",title:I(3190,"Split Editor into Previous Group"),f1:!0,category:te.View},Rg,{to:"previous",by:"group"})}}class TXe extends un{constructor(){super({id:"workbench.action.splitEditorToNextGroup",title:I(3191,"Split Editor into Next Group"),f1:!0,category:te.View},Rg,{to:"next",by:"group"})}}class AXe extends un{constructor(){super({id:"workbench.action.splitEditorToAboveGroup",title:I(3192,"Split Editor into Group Above"),f1:!0,category:te.View},Rg,{to:"up",by:"group"})}}class RXe extends un{constructor(){super({id:"workbench.action.splitEditorToBelowGroup",title:I(3193,"Split Editor into Group Below"),f1:!0,category:te.View},Rg,{to:"down",by:"group"})}}class PXe extends un{static{this.ID="workbench.action.splitEditorToLeftGroup"}static{this.LABEL=h(3194,"Split Editor into Left Group")}constructor(){super({id:"workbench.action.splitEditorToLeftGroup",title:I(3194,"Split Editor into Left Group"),f1:!0,category:te.View},Rg,{to:"left",by:"group"})}}class LXe extends un{constructor(){super({id:"workbench.action.splitEditorToRightGroup",title:I(3195,"Split Editor into Right Group"),f1:!0,category:te.View},Rg,{to:"right",by:"group"})}}class MXe extends un{constructor(){super({id:"workbench.action.splitEditorToFirstGroup",title:I(3196,"Split Editor into First Group"),f1:!0,category:te.View},Rg,{to:"first",by:"group"})}}class NXe extends un{constructor(){super({id:"workbench.action.splitEditorToLastGroup",title:I(3197,"Split Editor into Last Group"),f1:!0,category:te.View},Rg,{to:"last",by:"group"})}}class jhe extends un{static{this.ID="workbench.action.editorLayoutSingle"}constructor(){super({id:jhe.ID,title:I(3198,"Single Column Editor Layout"),f1:!0,category:te.View},Pg,{groups:[{}],orientation:rc.HORIZONTAL})}}class Yhe extends un{static{this.ID="workbench.action.editorLayoutTwoColumns"}constructor(){super({id:Yhe.ID,title:I(3199,"Two Columns Editor Layout"),f1:!0,category:te.View},Pg,{groups:[{},{}],orientation:rc.HORIZONTAL})}}class Qhe extends un{static{this.ID="workbench.action.editorLayoutThreeColumns"}constructor(){super({id:Qhe.ID,title:I(3200,"Three Columns Editor Layout"),f1:!0,category:te.View},Pg,{groups:[{},{},{}],orientation:rc.HORIZONTAL})}}class Xhe extends un{static{this.ID="workbench.action.editorLayoutTwoRows"}constructor(){super({id:Xhe.ID,title:I(3201,"Two Rows Editor Layout"),f1:!0,category:te.View},Pg,{groups:[{},{}],orientation:rc.VERTICAL})}}class Zhe extends un{static{this.ID="workbench.action.editorLayoutThreeRows"}constructor(){super({id:Zhe.ID,title:I(3202,"Three Rows Editor Layout"),f1:!0,category:te.View},Pg,{groups:[{},{},{}],orientation:rc.VERTICAL})}}class Jhe extends un{static{this.ID="workbench.action.editorLayoutTwoByTwoGrid"}constructor(){super({id:Jhe.ID,title:I(3203,"Grid Editor Layout (2x2)"),f1:!0,category:te.View},Pg,{groups:[{groups:[{},{}]},{groups:[{},{}]}],orientation:rc.HORIZONTAL})}}class eue extends un{static{this.ID="workbench.action.editorLayoutTwoColumnsBottom"}constructor(){super({id:eue.ID,title:I(3204,"Two Columns Bottom Editor Layout"),f1:!0,category:te.View},Pg,{groups:[{},{groups:[{},{}]}],orientation:rc.VERTICAL})}}class tue extends un{static{this.ID="workbench.action.editorLayoutTwoRowsRight"}constructor(){super({id:tue.ID,title:I(3205,"Two Rows Right Editor Layout"),f1:!0,category:te.View},Pg,{groups:[{},{groups:[{},{}]}],orientation:rc.HORIZONTAL})}}class l1 extends X{constructor(e,t){super(e),this.direction=t}async run(e){const t=e.get(Ie),i=e.get(vi),n=Kd(),o=i.hasFocus(ot.EDITOR_PART)||n.activeElement===n.body,r=t.addGroup(t.activeGroup,this.direction);t.activateGroup(r),o&&r.focus()}}class OXe extends l1{constructor(){super({id:"workbench.action.newGroupLeft",title:I(3206,"New Editor Group to the Left"),f1:!0,category:te.View},Xt.LEFT)}}class FXe extends l1{constructor(){super({id:"workbench.action.newGroupRight",title:I(3207,"New Editor Group to the Right"),f1:!0,category:te.View},Xt.RIGHT)}}class WXe extends l1{constructor(){super({id:"workbench.action.newGroupAbove",title:I(3208,"New Editor Group Above"),f1:!0,category:te.View},Xt.UP)}}class BXe extends l1{constructor(){super({id:"workbench.action.newGroupBelow",title:I(3209,"New Editor Group Below"),f1:!0,category:te.View},Xt.DOWN)}}class VXe extends X{constructor(){super({id:"workbench.action.toggleEditorType",title:I(3210,"Toggle Editor Type"),f1:!0,category:te.View,precondition:fI})}async run(e){const t=e.get(de),i=e.get(vf),n=t.activeEditorPane;if(!n)return;const o=xi.getCanonicalUri(n.input);if(!o)return;const r=i.getEditors(o).map(a=>a.id).filter(a=>a!==n.input.editorId);r.length!==0&&await t.replaceEditors([{editor:n.input,replacement:{resource:o,options:{override:r[0]}}}],n.group)}}class HXe extends X{constructor(){super({id:"workbench.action.reopenTextEditor",title:I(3211,"Reopen Editor with Text Editor"),f1:!0,category:te.View,precondition:fI})}async run(e){const t=e.get(de),i=t.activeEditorPane;if(!i)return;const n=xi.getCanonicalUri(i.input);n&&await t.replaceEditors([{editor:i.input,replacement:{resource:n,options:{override:od.id}}}],i.group)}}class iue extends X{constructor(e,t,i,n){super({id:e,title:t,category:te.View,precondition:bw,keybinding:i,f1:!0}),this.move=n}async run(e,...t){const i=e.get(Ie),n=e.get(de),o=e.get(Si),r=Rs(t,n,i,o);if(!r.groupedEditors.length)return;const a=await i.createAuxiliaryEditorPart(),{group:c,editors:d}=r.groupedEditors[0],l=bz(c,d,r.preserveFocus);this.move?c.moveEditors(l,a.activeGroup):c.copyEditors(l,a.activeGroup),a.activeGroup.focus()}}class UXe extends iue{constructor(){super(GOe,{...I(3212,"Move Editor into New Window"),mnemonicTitle:h(3213,"&&Move Editor into New Window")},void 0,!0)}}class $Xe extends iue{constructor(){super(qOe,{...I(3214,"Copy Editor into New Window"),mnemonicTitle:h(3215,"&&Copy Editor into New Window")},{primary:lt(E.CtrlCmd|S.KeyK,S.KeyO),weight:W.WorkbenchContrib},!1)}}class nue extends X{constructor(e,t,i){super({id:e,title:t,category:te.View,f1:!0}),this.move=i}async run(e){const t=e.get(Ie),i=t.activeGroup,n=await t.createAuxiliaryEditorPart();t.mergeGroup(i,n.activeGroup,{mode:this.move?ME.MOVE_EDITORS:ME.COPY_EDITORS}),n.activeGroup.focus()}}class GXe extends nue{constructor(){super(zOe,{...I(3216,"Move Editor Group into New Window"),mnemonicTitle:h(3217,"&&Move Editor Group into New Window")},!0)}}class qXe extends nue{constructor(){super(KOe,{...I(3218,"Copy Editor Group into New Window"),mnemonicTitle:h(3219,"&&Copy Editor Group into New Window")},!1)}}class zXe extends X{constructor(){super({id:"workbench.action.restoreEditorsToMainWindow",title:{...I(3220,"Restore Editors into Main Window"),mnemonicTitle:h(3221,"&&Restore Editors into Main Window")},f1:!0,precondition:Sl,category:te.View})}async run(e){const t=e.get(Ie);t.mergeAllGroups(t.mainPart.activeGroup)}}class KXe extends X{constructor(){super({id:jOe,title:{...I(3222,"New Empty Editor Window"),mnemonicTitle:h(3223,"&&New Empty Editor Window")},f1:!0,category:te.View})}async run(e){(await e.get(Ie).createAuxiliaryEditorPart()).activeGroup.focus()}}class Pc{constructor(e){this.identifier=e}}class mu{constructor(e){this.identifier=e}}async function $1e(s){const e=[],t=Ii.uriList.toLowerCase();if(s.has(t))try{const i=await s.get(t)?.asString(),n=JSON.stringify(ml.parse(i??""));e.push(...nde(n))}catch{}return e}let NP=class{constructor(e,t,i,n,o,r,a,c){this.options=e,this.fileService=t,this.workspacesService=i,this.editorService=n,this.workspaceEditingService=o,this.hostService=r,this.contextService=a,this.instantiationService=c}async handleDrop(e,t,i,n,o){const r=await this.instantiationService.invokeFunction(d=>ide(d,e));if(!r.length)return;if(await this.hostService.focus(t),this.options.allowWorkspaceOpen){const d=Vt(r.filter(l=>l.allowWorkspaceOpen&&l.resource?.scheme===ae.file).map(l=>l.resource));if(d.length>0&&await this.handleWorkspaceDrop(d))return}const a=Vt(r.filter(d=>d.isExternal&&d.resource?.scheme===ae.file).map(d=>d.resource));a.length&&this.workspacesService.addRecentlyOpened(a.map(d=>({fileUri:d})));const c=i?.();await this.editorService.openEditors(r.map(d=>({...d,resource:d.resource,options:{...d.options,...o,pinned:!0}})),c,{validateTrust:!0}),n?.(c)}async handleWorkspaceDrop(e){const t=[],i=[];return await Promise.all(e.map(async n=>{if(Pq(n)){t.push({workspaceUri:n});return}try{const o=await this.fileService.stat(n);o.isDirectory&&(t.push({folderUri:o.resource}),i.push({uri:o.resource}))}catch{}})),t.length===0?!1:(t.length>i.length||i.length===1?await this.hostService.openWindow(t):zM(this.contextService.getWorkspace())?await this.workspaceEditingService.addFolders(i):await this.workspaceEditingService.createAndEnterWorkspace(i),!0)}};NP=f([p(1,Xe),p(2,Wh),p(3,de),p(4,uc),p(5,Wn),p(6,Tt),p(7,J)],NP);function pg(s,e,t,i){if(e.length===0||!t.dataTransfer)return;const n=s.get(Ds),o=s.get(de),r=s.get(Xe),a=s.get(di),c=Vt(e.map(v=>R.isUri(v)?{resource:v}:XF(v)?R.isUri(v.editor.resource)?{resource:v.editor.resource}:void 0:{resource:v.selection?_F(v.resource,v.selection):v.resource,isDirectory:v.isDirectory,selection:v.selection})),d=c.filter(({resource:v})=>r.hasProvider(v));if(!i?.disableStandardTransfer){const v=pn?`\r
`:`
`;t.dataTransfer.setData(bs.TEXT,d.map(({resource:w})=>a.getUriLabel(w,{noPrefix:!0})).join(v));const y=d.find(({isDirectory:w})=>!w);if(y){const w=tc.uriToFileUri(y.resource);w.scheme===ae.file&&t.dataTransfer.setData(bs.DOWNLOAD_URL,[Ii.binary,je(y.resource),w.toString()].join(":"))}}const l=d.filter(({isDirectory:v})=>!v);l.length&&t.dataTransfer.setData(bs.RESOURCES,JSON.stringify(l.map(({resource:v})=>v.toString())));const u=Ge.as(MK.DragAndDropContribution).getAll();for(const v of u)v.setData(c,t);const g=[];for(const v of e){let y;if(XF(v)){const w=v.editor.toUntyped({preserveViewState:v.groupId});w&&(y={...w,resource:xi.getCanonicalUri(w)})}else if(R.isUri(v)){const{selection:w,uri:C}=tne(v);y={resource:C,options:w?{selection:w}:void 0}}else v.isDirectory||(y={resource:v.resource,options:{selection:v.selection}});if(y){{const w=y.resource;if(w){const C=n.files.get(w);C&&(typeof y.languageId!="string"&&(y.languageId=C.getLanguageId()),typeof y.encoding!="string"&&(y.encoding=C.getEncoding()),typeof y.contents!="string"&&C.isDirty()&&!C.textEditorModel.isTooLargeForHeapOperation()&&(y.contents=C.textEditorModel.getValue())),y.options?.viewState||(y.options={...y.options,viewState:(()=>{for(const T of o.visibleEditorPanes)if(Dt(T.input.resource,w)){const k=T.getViewState();if(k)return k}})()})}}g.push(y)}}g.length&&t.dataTransfer.setData(io.EDITORS,w_e(g));const m=d.filter(({isDirectory:v})=>v).map(({resource:v})=>v);if(g.length||m.length){const v=[...m];for(const y of g)y.resource?v.push(y.options?.selection?_F(y.resource,y.options.selection):y.resource):K_(y)?y.modified.resource&&v.push(y.modified.resource):LS(y)?y.primary.resource&&v.push(y.primary.resource):_C(y)&&v.push(y.result.resource);i?.disableStandardTransfer||t.dataTransfer.setData(Ii.uriList,ml.create(v.slice(0,1))),t.dataTransfer.setData(bs.INTERNAL_URI_LIST,ml.create(v))}}class G1e{constructor(e,t){this.type=e,this.id=t}update(e){}getData(){return{type:this.type,id:this.id}}}class xS{constructor(e){this.compositeId=e}get id(){return this.compositeId}}class IS{constructor(e){this.viewId=e}get id(){return this.viewId}}class Jd extends F{static get INSTANCE(){return Jd.instance||(Jd.instance=new Jd,mne(Jd.instance)),Jd.instance}constructor(){super(),this.transferData=Wu.getInstance(),this.onDragStart=this._register(new M),this.onDragEnd=this._register(new M),this._register(this.onDragEnd.event(e=>{const t=e.dragAndDropData.getData().id,i=e.dragAndDropData.getData().type;this.readDragData(i)?.getData().id===t&&this.transferData.clearData(i==="view"?IS.prototype:xS.prototype)}))}readDragData(e){if(this.transferData.hasData(e==="view"?IS.prototype:xS.prototype)){const t=this.transferData.getData(e==="view"?IS.prototype:xS.prototype);if(t&&t[0])return new G1e(e,t[0].id)}}writeDragData(e,t){this.transferData.setData([t==="view"?new IS(e):new xS(e)],t==="view"?IS.prototype:xS.prototype)}registerTarget(e,t){const i=new U;return i.add(new Hp(e,{onDragEnter:n=>{if(n.preventDefault(),t.onDragEnter){const o=this.readDragData("composite")||this.readDragData("view");o&&t.onDragEnter({eventData:n,dragAndDropData:o})}},onDragLeave:n=>{const o=this.readDragData("composite")||this.readDragData("view");t.onDragLeave&&o&&t.onDragLeave({eventData:n,dragAndDropData:o})},onDrop:n=>{if(t.onDrop){const o=this.readDragData("composite")||this.readDragData("view");if(!o)return;t.onDrop({eventData:n,dragAndDropData:o}),this.onDragEnd.fire({eventData:n,dragAndDropData:o})}},onDragOver:n=>{if(n.preventDefault(),t.onDragOver){const o=this.readDragData("composite")||this.readDragData("view");if(!o)return;t.onDragOver({eventData:n,dragAndDropData:o})}}})),t.onDragStart&&this.onDragStart.event(n=>{t.onDragStart(n)},this,i),t.onDragEnd&&this.onDragEnd.event(n=>{t.onDragEnd(n)},this,i),this._register(i)}registerDraggable(e,t,i){e.draggable=!0;const n=new U;return n.add(new Hp(e,{onDragStart:o=>{const{id:r,type:a}=t();this.writeDragData(r,a),o.dataTransfer?.setDragImage(e,0,0),this.onDragStart.fire({eventData:o,dragAndDropData:this.readDragData(a)})},onDragEnd:o=>{const{type:r}=t(),a=this.readDragData(r);a&&this.onDragEnd.fire({eventData:o,dragAndDropData:a})},onDragEnter:o=>{if(i.onDragEnter){const r=this.readDragData("composite")||this.readDragData("view");if(!r)return;r&&i.onDragEnter({eventData:o,dragAndDropData:r})}},onDragLeave:o=>{const r=this.readDragData("composite")||this.readDragData("view");r&&i.onDragLeave?.({eventData:o,dragAndDropData:r})},onDrop:o=>{if(i.onDrop){const r=this.readDragData("composite")||this.readDragData("view");if(!r)return;i.onDrop({eventData:o,dragAndDropData:r}),this.onDragEnd.fire({eventData:o,dragAndDropData:r})}},onDragOver:o=>{if(i.onDragOver){const r=this.readDragData("composite")||this.readDragData("view");if(!r)return;i.onDragOver({eventData:o,dragAndDropData:r})}}})),i.onDragStart&&this.onDragStart.event(o=>{i.onDragStart(o)},this,n),i.onDragEnd&&this.onDragEnd.event(o=>{i.onDragEnd(o)},this,n),this._register(n)}}function OP(s,e,t){s&&(s.dropEffect=t?e:"none")}let LZ=class{constructor(e,t){this.toResource=e,this.instantiationService=t}getDragURI(e){const t=this.toResource(e);return t?t.toString():null}getDragLabel(e){const t=Vt(e.map(this.toResource));return t.length===1?je(t[0]):t.length>1?String(t.length):void 0}onDragStart(e,t){const i=[],n=e.elements;for(const o of n){const r=this.toResource(o);r&&i.push(r)}this.onWillDragElements(n,t),i.length&&this.instantiationService.invokeFunction(o=>pg(o,i,t))}onWillDragElements(e,t){}onDragOver(e,t,i,n,o){return!1}drop(e,t,i,n,o){}dispose(){}};LZ=f([p(1,J)],LZ);class S4 extends F{static{this.CHANNEL_NAME="monaco-workbench-global-dragged-over"}constructor(){super(),this.broadcaster=this._register(new vCe(S4.CHANNEL_NAME)),this.draggedOver=!1,this.registerListeners()}registerListeners(){this._register(D.runAndSubscribe(Em,({window:e,disposables:t})=>{t.add(re(e,pe.DRAG_OVER,()=>this.markDraggedOver(!1),!0)),t.add(re(e,pe.DRAG_LEAVE,()=>this.clearDraggedOver(!1),!0))},{window:$i,disposables:this._store})),this._register(this.broadcaster.onDidReceiveData(e=>{e===!0?this.markDraggedOver(!0):this.clearDraggedOver(!0)}))}get isDraggedOver(){return this.draggedOver}markDraggedOver(e){this.draggedOver!==!0&&(this.draggedOver=!0,e||this.broadcaster.postData(!0))}clearDraggedOver(e){this.draggedOver!==!1&&(this.draggedOver=!1,e||this.broadcaster.postData(!1))}}const q1e=new S4;function sue(){return q1e.isDraggedOver}const oue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),z1e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(z1e);class FP extends F{static{this.HEADER_SIZE=22}get ariaHeaderLabel(){return this._ariaHeaderLabel}set ariaHeaderLabel(e){this._ariaHeaderLabel=e,this.header?.setAttribute("aria-label",this.ariaHeaderLabel)}get draggableElement(){return this.header}get dropTargetElement(){return this.element}get dropBackground(){return this.styles.dropBackground}get minimumBodySize(){return this._minimumBodySize}set minimumBodySize(e){this._minimumBodySize=e,this._onDidChange.fire(void 0)}get maximumBodySize(){return this._maximumBodySize}set maximumBodySize(e){this._maximumBodySize=e,this._onDidChange.fire(void 0)}get headerSize(){return this.headerVisible?FP.HEADER_SIZE:0}get minimumSize(){const e=this.headerSize,i=!this.headerVisible||this.isExpanded()?this.minimumBodySize:0;return e+i}get maximumSize(){const e=this.headerSize,i=!this.headerVisible||this.isExpanded()?this.maximumBodySize:0;return e+i}getAriaHeaderLabel(e){return h(30,"{0} Section",e)}constructor(e){super(),this.expandedSize=void 0,this._headerVisible=!0,this._collapsible=!0,this._bodyRendered=!1,this.styles={dropBackground:void 0,headerBackground:void 0,headerBorder:void 0,headerForeground:void 0,leftBorder:void 0},this.animationTimer=void 0,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._onDidChangeExpansionState=this._register(new M),this.onDidChangeExpansionState=this._onDidChangeExpansionState.event,this.orthogonalSize=0,this._expanded=typeof e.expanded>"u"?!0:!!e.expanded,this._orientation=typeof e.orientation>"u"?wt.VERTICAL:e.orientation,this._ariaHeaderLabel=this.getAriaHeaderLabel(e.title),this._minimumBodySize=typeof e.minimumBodySize=="number"?e.minimumBodySize:this._orientation===wt.HORIZONTAL?200:120,this._maximumBodySize=typeof e.maximumBodySize=="number"?e.maximumBodySize:Number.POSITIVE_INFINITY,this.element=Y(".pane")}isExpanded(){return this._expanded}setExpanded(e){return!e&&!this.collapsible||this._expanded===!!e?!1:(this.element?.classList.toggle("expanded",e),this._expanded=!!e,this.updateHeader(),e?(this._bodyRendered||(this.renderBody(this.body),this._bodyRendered=!0),typeof this.animationTimer=="number"&&bt(this.element).clearTimeout(this.animationTimer),ee(this.element,this.body)):this.animationTimer=bt(this.element).setTimeout(()=>{this.body.remove()},200),this._onDidChangeExpansionState.fire(e),this._onDidChange.fire(e?this.expandedSize:void 0),!0)}get headerVisible(){return this._headerVisible}set headerVisible(e){this._headerVisible!==!!e&&(this._headerVisible=!!e,this.updateHeader(),this._onDidChange.fire(void 0))}get collapsible(){return this._collapsible}set collapsible(e){this._collapsible!==!!e&&(this._collapsible=!!e,this.updateHeader())}get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,this.element&&(this.element.classList.toggle("horizontal",this.orientation===wt.HORIZONTAL),this.element.classList.toggle("vertical",this.orientation===wt.VERTICAL)),this.header&&this.updateHeader())}render(){this.element.classList.toggle("expanded",this.isExpanded()),this.element.classList.toggle("horizontal",this.orientation===wt.HORIZONTAL),this.element.classList.toggle("vertical",this.orientation===wt.VERTICAL),this.header=Y(".pane-header"),ee(this.element,this.header),this.header.setAttribute("tabindex","0"),this.header.setAttribute("role","button"),this.header.setAttribute("aria-label",this.ariaHeaderLabel),this.renderHeader(this.header);const e=Po(this.header);this._register(e),this._register(e.onDidFocus(()=>this.header?.classList.add("focused"),null)),this._register(e.onDidBlur(()=>this.header?.classList.remove("focused"),null)),this.updateHeader();const t=this._register(new U),i=this._register(new Wo(this.header,"keydown")),n=D.map(i.event,r=>new zs(r),t);this._register(D.filter(n,r=>r.keyCode===S.Enter||r.keyCode===S.Space,t)(()=>this.setExpanded(!this.isExpanded()),null)),this._register(D.filter(n,r=>r.keyCode===S.LeftArrow,t)(()=>this.setExpanded(!1),null)),this._register(D.filter(n,r=>r.keyCode===S.RightArrow,t)(()=>this.setExpanded(!0),null)),this._register(Th.addTarget(this.header));const o=this.header;[pe.CLICK,Vo.Tap].forEach(r=>{this._register(re(o,r,a=>{a.defaultPrevented||this.setExpanded(!this.isExpanded())}))}),this.body=ee(this.element,Y(".pane-body")),!this._bodyRendered&&this.isExpanded()&&(this.renderBody(this.body),this._bodyRendered=!0),this.isExpanded()||this.body.remove()}layout(e){const t=this.headerVisible?FP.HEADER_SIZE:0,i=this._orientation===wt.VERTICAL?this.orthogonalSize:e,n=this._orientation===wt.VERTICAL?e-t:this.orthogonalSize-t;this.isExpanded()&&(this.body.classList.toggle("wide",i>=600),this.layoutBody(n,i),this.expandedSize=e)}style(e){this.styles=e,this.header&&this.updateHeader()}updateHeader(){if(!this.header)return;const e=!this.headerVisible||this.isExpanded();this.collapsible?(this.header.setAttribute("tabindex","0"),this.header.setAttribute("role","button")):(this.header.removeAttribute("tabindex"),this.header.removeAttribute("role")),this.header.style.lineHeight=`${this.headerSize}px`,this.header.classList.toggle("hidden",!this.headerVisible),this.header.classList.toggle("expanded",e),this.header.classList.toggle("not-collapsible",!this.collapsible),this.header.setAttribute("aria-expanded",String(e)),this.header.style.color=this.collapsible?this.styles.headerForeground??"":"",this.header.style.backgroundColor=(this.collapsible?this.styles.headerBackground:"transparent")??"",this.header.style.borderTop=this.styles.headerBorder&&this.orientation===wt.VERTICAL?`1px solid ${this.styles.headerBorder}`:"",this.element.style.borderLeft=this.styles.leftBorder&&this.orientation===wt.HORIZONTAL?`1px solid ${this.styles.leftBorder}`:""}}class C4 extends F{static{this.DefaultDragOverBackgroundColor=new be(new Vm(128,128,128,.5))}constructor(e,t,i){super(),this.pane=e,this.dnd=t,this.context=i,this.dragOverCounter=0,this._onDidDrop=this._register(new M),this.onDidDrop=this._onDidDrop.event,e.draggableElement.draggable=!0,this._register(re(e.draggableElement,"dragstart",n=>this.onDragStart(n))),this._register(re(e.dropTargetElement,"dragenter",n=>this.onDragEnter(n))),this._register(re(e.dropTargetElement,"dragleave",n=>this.onDragLeave(n))),this._register(re(e.dropTargetElement,"dragend",n=>this.onDragEnd(n))),this._register(re(e.dropTargetElement,"drop",n=>this.onDrop(n)))}onDragStart(e){if(!this.dnd.canDrag(this.pane)||!e.dataTransfer){e.preventDefault(),e.stopPropagation();return}const t=this.pane.draggableElement?.textContent||"";e.dataTransfer.effectAllowed="move",XM&&e.dataTransfer?.setData(bs.TEXT,t),ZM(e,this.pane.element,t),this.context.draggable=this}onDragEnter(e){!this.context.draggable||this.context.draggable===this||this.dnd.canDrop(this.context.draggable.pane,this.pane)&&(this.dragOverCounter++,this.render())}onDragLeave(e){!this.context.draggable||this.context.draggable===this||this.dnd.canDrop(this.context.draggable.pane,this.pane)&&(this.dragOverCounter--,this.dragOverCounter===0&&this.render())}onDragEnd(e){this.context.draggable&&(this.dragOverCounter=0,this.render(),this.context.draggable=null)}onDrop(e){this.context.draggable&&(Li.stop(e),this.dragOverCounter=0,this.render(),this.dnd.canDrop(this.context.draggable.pane,this.pane)&&this.context.draggable!==this&&this._onDidDrop.fire({from:this.context.draggable.pane,to:this.pane}),this.context.draggable=null)}render(){let e=null;this.dragOverCounter>0&&(e=this.pane.dropBackground??C4.DefaultDragOverBackgroundColor.toString()),this.pane.dropTargetElement.style.backgroundColor=e||""}}class K1e extends F{constructor(e,t={}){super(),this.dndContext={draggable:null},this.paneItems=[],this.orthogonalSize=0,this.size=0,this.animationTimer=void 0,this._onDidDrop=this._register(new M),this.onDidDrop=this._onDidDrop.event,this.dnd=t.dnd,this.orientation=t.orientation??wt.VERTICAL,this.element=ee(e,Y(".monaco-pane-view")),this.splitview=this._register(new PT(this.element,{orientation:this.orientation})),this.onDidSashReset=this.splitview.onDidSashReset,this.onDidSashChange=this.splitview.onDidSashChange,this.onDidScroll=this.splitview.onDidScroll;const i=this._register(new U),n=this._register(new Wo(this.element,"keydown")),o=D.map(D.filter(n.event,r=>Mh(r.target)&&r.target.classList.contains("pane-header"),i),r=>new zs(r),i);this._register(D.filter(o,r=>r.keyCode===S.UpArrow,i)(()=>this.focusPrevious())),this._register(D.filter(o,r=>r.keyCode===S.DownArrow,i)(()=>this.focusNext()))}addPane(e,t,i=this.splitview.length){const n=new U;e.onDidChangeExpansionState(this.setupAnimation,this,n);const o={pane:e,disposable:n};if(this.paneItems.splice(i,0,o),e.orientation=this.orientation,e.orthogonalSize=this.orthogonalSize,this.splitview.addView(e,t,i),this.dnd){const r=new C4(e,this.dnd,this.dndContext);n.add(r),n.add(r.onDidDrop(this._onDidDrop.fire,this._onDidDrop))}}removePane(e){const t=this.paneItems.findIndex(n=>n.pane===e);if(t===-1)return;this.splitview.removeView(t,e.isExpanded()?bE.Distribute:void 0),this.paneItems.splice(t,1)[0].disposable.dispose()}movePane(e,t){const i=this.paneItems.findIndex(r=>r.pane===e),n=this.paneItems.findIndex(r=>r.pane===t);if(i===-1||n===-1)return;const[o]=this.paneItems.splice(i,1);this.paneItems.splice(n,0,o),this.splitview.moveView(i,n)}resizePane(e,t){const i=this.paneItems.findIndex(n=>n.pane===e);i!==-1&&this.splitview.resizeView(i,t)}getPaneSize(e){const t=this.paneItems.findIndex(i=>i.pane===e);return t===-1?-1:this.splitview.getViewSize(t)}layout(e,t){this.orthogonalSize=this.orientation===wt.VERTICAL?t:e,this.size=this.orientation===wt.HORIZONTAL?t:e;for(const i of this.paneItems)i.pane.orthogonalSize=this.orthogonalSize;this.splitview.layout(this.size)}setBoundarySashes(e){this.boundarySashes=e,this.updateSplitviewOrthogonalSashes(e)}updateSplitviewOrthogonalSashes(e){this.orientation===wt.VERTICAL?(this.splitview.orthogonalStartSash=e?.left,this.splitview.orthogonalEndSash=e?.right):this.splitview.orthogonalEndSash=e?.bottom}flipOrientation(e,t){this.orientation=this.orientation===wt.VERTICAL?wt.HORIZONTAL:wt.VERTICAL;const i=this.paneItems.map(r=>this.getPaneSize(r.pane));this.splitview.dispose(),Yi(this.element),this.splitview=this._register(new PT(this.element,{orientation:this.orientation})),this.updateSplitviewOrthogonalSashes(this.boundarySashes);const n=this.orientation===wt.VERTICAL?t:e,o=this.orientation===wt.HORIZONTAL?t:e;this.paneItems.forEach((r,a)=>{r.pane.orthogonalSize=n,r.pane.orientation=this.orientation;const c=this.size===0?0:o*i[a]/this.size;this.splitview.addView(r.pane,c,a)}),this.size=o,this.orthogonalSize=n,this.splitview.layout(this.size)}setupAnimation(){typeof this.animationTimer=="number"&&bt(this.element).clearTimeout(this.animationTimer),this.element.classList.add("animated"),this.animationTimer=bt(this.element).setTimeout(()=>{this.animationTimer=void 0,this.element.classList.remove("animated")},200)}getPaneHeaderElements(){return[...this.element.querySelectorAll(".pane-header")]}focusPrevious(){const e=this.getPaneHeaderElements(),t=e.indexOf(this.element.ownerDocument.activeElement);t!==-1&&e[Math.max(t-1,0)].focus()}focusNext(){const e=this.getPaneHeaderElements(),t=e.indexOf(this.element.ownerDocument.activeElement);t!==-1&&e[Math.min(t+1,e.length-1)].focus()}dispose(){super.dispose(),this.paneItems.forEach(e=>e.disposable.dispose())}}const j1e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(j1e);let xx=class extends F{get enabled(){return this._enabled}set enabled(e){e?(this.el.setAttribute("aria-disabled","false"),this.el.tabIndex=0,this.el.style.pointerEvents="auto",this.el.style.opacity="1",this.el.style.cursor="pointer",this._enabled=!1):(this.el.setAttribute("aria-disabled","true"),this.el.tabIndex=-1,this.el.style.pointerEvents="none",this.el.style.opacity="0.4",this.el.style.cursor="default",this._enabled=!0),this._enabled=e}set link(e){typeof e.label=="string"?this.el.textContent=e.label:(Yi(this.el),this.el.appendChild(e.label)),this.el.href=e.href,typeof e.tabIndex<"u"&&(this.el.tabIndex=e.tabIndex),this.setTooltip(e.title),this._link=e}constructor(e,t,i={},n,o){super(),this._link=t,this._hoverService=n,this._enabled=!0,this.el=ee(e,Y("a.monaco-link",{tabIndex:t.tabIndex??0,href:t.href},t.label)),this.hoverDelegate=i.hoverDelegate??yr("mouse"),this.setTooltip(t.title),this.el.setAttribute("role","button");const r=this._register(new Wo(this.el,"click")),a=this._register(new Wo(this.el,"keypress")),c=D.chain(a.event,u=>u.map(g=>new zs(g)).filter(g=>g.keyCode===S.Enter)),d=this._register(new Wo(this.el,Vo.Tap)).event;this._register(Th.addTarget(this.el));const l=D.any(r.event,c,d);this._register(l(u=>{this.enabled&&(Li.stop(u,!0),i?.opener?i.opener(this._link.href):o.open(this._link.href,{allowCommands:!0}))})),this.enabled=!0}setTooltip(e){this.hoverDelegate.showNativeHover?this.el.title=e??"":!this.hover&&e?this.hover=this._register(this._hoverService.setupManagedHover(this.hoverDelegate,this.el,e)):this.hover&&this.hover.update(e)}};xx=f([p(3,wi),p(4,hi)],xx);class Y1e extends F{constructor(e,t){super(),this.progressBar=e,this.group=t,this.registerListeners()}registerListeners(){this._register(this.group.onDidModelChange(e=>{(e.kind===ct.EDITOR_ACTIVE||e.kind===ct.EDITOR_CLOSE&&this.group.isEmpty)&&this.progressBar.stop().hide()}))}show(e,t){return this.group.isEmpty?S_e:e===!0?this.doShow(!0,t):this.doShow(e,t)}doShow(e,t){return typeof e=="boolean"?this.progressBar.infinite().show(t):this.progressBar.total(e).show(t),{total:i=>{this.progressBar.total(i)},worked:i=>{this.progressBar.hasTotal()?this.progressBar.worked(i):this.progressBar.infinite().show()},done:()=>{this.progressBar.stop().hide()}}}async showWhile(e,t){if(this.group.isEmpty)try{await e}catch{}return this.doShowWhile(e,t)}async doShowWhile(e,t){try{this.progressBar.infinite().show(t),await e}catch{}finally{this.progressBar.stop().hide()}}}var vs;(function(s){let e;(function(n){n[n.None=0]="None",n[n.Done=1]="Done",n[n.Infinite=2]="Infinite",n[n.While=3]="While",n[n.Work=4]="Work"})(e=s.Type||(s.Type={})),s.None={type:e.None},s.Done={type:e.Done},s.Infinite={type:e.Infinite};class t{constructor(o,r,a){this.whilePromise=o,this.whileStart=r,this.whileDelay=a,this.type=e.While}}s.While=t;class i{constructor(o,r){this.total=o,this.worked=r,this.type=e.Work}}s.Work=i})(vs||(vs={}));class Q1e extends F{constructor(e,t){super(),this.progressBar=e,this.scope=t,this.progressState=vs.None,this.registerListeners()}registerListeners(){this._register(this.scope.onDidChangeActive(()=>{this.scope.isActive?this.onDidScopeActivate():this.onDidScopeDeactivate()}))}onDidScopeActivate(){if(this.progressState.type!==vs.Done.type)if(this.progressState.type===vs.Type.While){let e;if(this.progressState.whileDelay>0){const t=this.progressState.whileDelay-(Date.now()-this.progressState.whileStart);t>0&&(e=t)}this.doShowWhile(e)}else this.progressState.type===vs.Type.Infinite?this.progressBar.infinite().show():this.progressState.type===vs.Type.Work&&(this.progressState.total&&this.progressBar.total(this.progressState.total).show(),this.progressState.worked&&this.progressBar.worked(this.progressState.worked).show())}onDidScopeDeactivate(){this.progressBar.stop().hide()}show(e,t){return typeof e=="boolean"?this.progressState=vs.Infinite:this.progressState=new vs.Work(e,void 0),this.scope.isActive&&(this.progressState.type===vs.Type.Infinite?this.progressBar.infinite().show(t):this.progressState.type===vs.Type.Work&&typeof this.progressState.total=="number"&&this.progressBar.total(this.progressState.total).show(t)),{total:i=>{this.progressState=new vs.Work(i,this.progressState.type===vs.Type.Work?this.progressState.worked:void 0),this.scope.isActive&&this.progressBar.total(i)},worked:i=>{!this.scope.isActive||this.progressBar.hasTotal()?(this.progressState=new vs.Work(this.progressState.type===vs.Type.Work?this.progressState.total:void 0,this.progressState.type===vs.Type.Work&&typeof this.progressState.worked=="number"?this.progressState.worked+i:i),this.scope.isActive&&this.progressBar.worked(i)):(this.progressState=vs.Infinite,this.progressBar.infinite().show())},done:()=>{this.progressState=vs.Done,this.scope.isActive&&this.progressBar.stop().hide()}}}async showWhile(e,t){this.progressState.type===vs.Type.While&&(e=Promise.allSettled([e,this.progressState.whilePromise])),this.progressState=new vs.While(e,t||0,Date.now());try{this.doShowWhile(t),await e}catch{}finally{(this.progressState.type!==vs.Type.While||this.progressState.whilePromise===e)&&(this.progressState=vs.None,this.scope.isActive&&this.progressBar.stop().hide())}}doShowWhile(e){this.scope.isActive&&this.progressBar.infinite().show(e)}}class X1e extends F{get isActive(){return this._isActive}constructor(e,t){super(),this.scopeId=e,this._isActive=t,this._onDidChangeActive=this._register(new M),this.onDidChangeActive=this._onDidChangeActive.event}onScopeOpened(e){e===this.scopeId&&(this._isActive||(this._isActive=!0,this._onDidChangeActive.fire()))}onScopeClosed(e){e===this.scopeId&&this._isActive&&(this._isActive=!1,this._onDidChangeActive.fire())}}class Z1e extends F{get primaryActions(){return this._primaryActions}get secondaryActions(){return this._secondaryActions}constructor(e,t,i,n){super(),this.options=t,this.menuService=i,this.contextKeyService=n,this._primaryActions=[],this._secondaryActions=[],this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.disposables=this._register(new U),this.menu=this._register(i.createMenu(e,n)),this._register(this.menu.onDidChange(()=>this.updateActions())),this.updateActions()}updateActions(){this.disposables.clear();const e=zm(this.menu.getActions(this.options));this._primaryActions=e.primary,this._secondaryActions=e.secondary,this.disposables.add(this.updateSubmenus([...this._primaryActions,...this._secondaryActions],{})),this._onDidChange.fire()}updateSubmenus(e,t){const i=new U;for(const n of e)if(n instanceof kh&&!t[n.item.submenu.id]){const o=t[n.item.submenu.id]=i.add(this.menuService.createMenu(n.item.submenu,this.contextKeyService));i.add(o.onDidChange(()=>this.updateActions())),i.add(this.updateSubmenus(n.actions,t))}return i}}let WP=class extends F{constructor(e,t,i,n,o){super(),this.menuId=e,this.contextMenuId=t,this.options=i,this.contextKeyService=n,this.menuService=o,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.menuActions=this._register(new Z1e(e,this.options,o,n)),this._register(this.menuActions.onDidChange(()=>this._onDidChange.fire()))}getPrimaryActions(){return this.menuActions.primaryActions}getSecondaryActions(){return this.menuActions.secondaryActions}getContextMenuActions(){if(this.contextMenuId){const e=this.menuService.getMenuActions(this.contextMenuId,this.contextKeyService,this.options);return zm(e).secondary}return[]}};WP=f([p(3,me),p(4,tn)],WP);function WU(s){return s.lookupKeybinding("history.showPrevious")?.getElectronAccelerator()==="Up"&&s.lookupKeybinding("history.showNext")?.getElectronAccelerator()==="Down"}const rue=new N("menu.view.filter"),gD=new N("submenu.view.filter");ge.appendMenuItem(rue,{submenu:gD,title:h(3539,"More Filters..."),group:"navigation",icon:j.filter});class J1e extends Sne{constructor(){super(...arguments),this._checked=!1}set checked(e){this._checked!==e&&(this._checked=e,this.updateChecked())}updateChecked(){this.element&&this.element.classList.toggle("checked",this._checked)}render(e){super.render(e),this.updateChecked()}}let BU=class extends uf{get onDidFocus(){return this.focusTracker.onDidFocus}get onDidBlur(){return this.focusTracker.onDidBlur}constructor(e,t,i,n,o){super(),this.options=e,this.instantiationService=t,this.contextViewService=i,this.keybindingService=o,this._onDidChangeFilterText=this._register(new M),this.onDidChangeFilterText=this._onDidChangeFilterText.event,this.isMoreFiltersChecked=!1,this.delayedFilterUpdate=new tg(300),this._register(Ee(()=>this.delayedFilterUpdate.cancel())),e.focusContextKey&&(this.focusContextKey=new O(e.focusContextKey,!1).bindTo(n)),this.element=Y(".viewpane-filter"),[this.filterInputBox,this.focusTracker]=this.createInput(this.element),this._register(this.filterInputBox),this._register(this.focusTracker);const r=ee(this.element,Y(".viewpane-filter-controls"));this.filterBadge=this.createBadge(r),this.toolbar=this._register(this.createToolBar(r)),this.adjustInputBox()}hasFocus(){return this.filterInputBox.hasFocus()}focus(){this.filterInputBox.focus()}blur(){this.filterInputBox.blur()}updateBadge(e){this.filterBadge.classList.toggle("hidden",!e),this.filterBadge.textContent=e||"",this.adjustInputBox()}setFilterText(e){this.filterInputBox.value=e}getFilterText(){return this.filterInputBox.value}getHistory(){return this.filterInputBox.getHistory()}layout(e){this.element.parentElement?.classList.toggle("grow",e>700),this.element.classList.toggle("small",e<400),this.adjustInputBox(),this.lastWidth=e}relayout(){this.lastWidth&&this.layout(this.lastWidth)}checkMoreFilters(e){this.isMoreFiltersChecked=e,this.moreFiltersActionViewItem&&(this.moreFiltersActionViewItem.checked=e)}createInput(e){const t=this.options.history||[],i=this._register(this.instantiationService.createInstance(uH,e,this.contextViewService,{placeholder:this.options.placeholder,ariaLabel:this.options.ariaLabel,history:new Set(t),showHistoryHint:()=>WU(this.keybindingService),inputBoxStyles:YT}));this.options.text&&(i.value=this.options.text),this._register(i.onDidChange(o=>this.delayedFilterUpdate.trigger(()=>this.onDidInputChange(i)))),this._register(co(i.inputElement,pe.KEY_DOWN,o=>this.onInputKeyDown(o,i))),this._register(co(e,pe.KEY_DOWN,this.handleKeyboardEvent)),this._register(co(e,pe.KEY_UP,this.handleKeyboardEvent)),this._register(co(i.inputElement,pe.CLICK,o=>{o.stopPropagation(),o.preventDefault()}));const n=this._register(Po(i.inputElement));return this.focusContextKey&&(this._register(n.onDidFocus(()=>this.focusContextKey.set(!0))),this._register(n.onDidBlur(()=>this.focusContextKey.set(!1))),this._register(Ee(()=>this.focusContextKey.reset()))),[i,n]}createBadge(e){const t=ee(e,Y(".viewpane-filter-badge.hidden"));return t.style.backgroundColor=gt(JM),t.style.color=gt(Lq),t.style.border=`1px solid ${gt(et)}`,t}createToolBar(e){return this.instantiationService.createInstance(z_,e,rue,{hiddenItemStrategy:Ak.NoHide,actionViewItemProvider:(t,i)=>{if(t instanceof kh&&t.item.submenu.id===gD.id)return this.moreFiltersActionViewItem=this.instantiationService.createInstance(J1e,t,i),this.moreFiltersActionViewItem.checked=this.isMoreFiltersChecked,this.moreFiltersActionViewItem}})}onDidInputChange(e){e.addToHistory(),this._onDidChangeFilterText.fire(e.value)}adjustInputBox(){this.filterInputBox.inputElement.style.paddingRight=this.element.classList.contains("small")||this.filterBadge.classList.contains("hidden")?"25px":"150px"}handleKeyboardEvent(e){(e.equals(S.Space)||e.equals(S.LeftArrow)||e.equals(S.RightArrow)||e.equals(S.Home)||e.equals(S.End))&&e.stopPropagation()}onInputKeyDown(e,t){let i=!1;e.equals(S.Tab)&&!this.toolbar.isEmpty()&&(this.toolbar.focus(),i=!0),i&&(e.stopPropagation(),e.preventDefault())}};BU=f([p(1,J),p(2,cf),p(3,me),p(4,Ve)],BU);var VU;Be(oue);var KC;(function(s){s[s.Default=0]="Default",s[s.WhenExpanded=1]="WhenExpanded",s[s.Always=2]="Always"})(KC||(KC={}));const MZ=new Kt("viewpane.action.filter"),e0e=Ae("view-pane-container-expanded",j.chevronDown,h(3540,"Icon for an expanded view pane container.")),t0e=Ae("view-pane-container-collapsed",j.chevronRight,h(3541,"Icon for a collapsed view pane container.")),NZ=Ge.as(Yp.ViewsRegistry);let HU=class{get enabled(){return this._enabled}constructor(e,t,i,n,o,r){this.container=e,this.delegate=t,this.instantiationService=i,this.openerService=n,this.contextKeyService=o,this.items=[],this._enabled=!1,this.disposables=new U,this.enabledDisposables=this.disposables.add(new U),this.renderDisposables=this.disposables.add(new U),this.disposables.add(D.runAndSubscribe(this.delegate.onDidChangeViewWelcomeState,()=>this.onDidChangeViewWelcomeState())),this.disposables.add(r.onWillShutdown(()=>this.dispose()))}layout(e,t){this._enabled&&(this.element.style.height=`${e}px`,this.element.style.width=`${t}px`,this.element.classList.toggle("wide",t>640),this.scrollableElement.scanDomNode())}focus(){this._enabled&&this.element.focus()}onDidChangeViewWelcomeState(){const e=this.delegate.shouldShowWelcome();if(this._enabled===e)return;if(this._enabled=e,!e){this.enabledDisposables.clear();return}this.container.classList.add("welcome");const t=ee(this.container,Y(".welcome-view"));this.element=Y(".welcome-view-content",{tabIndex:0}),this.scrollableElement=new nI(this.element,{alwaysConsumeMouseWheel:!0,horizontal:dd.Hidden,vertical:dd.Visible}),ee(t,this.scrollableElement.getDomNode()),this.enabledDisposables.add(Ee(()=>{this.container.classList.remove("welcome"),this.scrollableElement.dispose(),t.remove(),this.scrollableElement=void 0,this.element=void 0})),this.contextKeyService.onDidChangeContext(this.onDidChangeContext,this,this.enabledDisposables),D.chain(NZ.onDidChangeViewWelcomeContent,i=>i.filter(n=>n===this.delegate.id))(this.onDidChangeViewWelcomeContent,this,this.enabledDisposables),this.onDidChangeViewWelcomeContent()}onDidChangeViewWelcomeContent(){const e=NZ.getViewWelcomeContent(this.delegate.id);this.items=[];for(const t of e)if(t.when==="default")this.defaultItem={descriptor:t,visible:!0};else{const i=t.when?this.contextKeyService.contextMatchesRules(t.when):!0;this.items.push({descriptor:t,visible:i})}this.render()}onDidChangeContext(){let e=!1;for(const t of this.items){if(!t.descriptor.when||t.descriptor.when==="default")continue;const i=this.contextKeyService.contextMatchesRules(t.descriptor.when);t.visible!==i&&(t.visible=i,e=!0)}e&&this.render()}render(){this.renderDisposables.clear(),this.element.innerText="";const e=this.getContentDescriptors();if(e.length===0){this.container.classList.remove("welcome"),this.scrollableElement.scanDomNode();return}let t=0;for(const{content:i,precondition:n,renderSecondaryButtons:o}of e){const r=i.split(`
`);for(let a of r){if(a=a.trim(),!a)continue;const c=x_e(a);if(c.nodes.length===1&&typeof c.nodes[0]!="string"){const d=c.nodes[0],l=ee(this.element,Y(".button-container")),u=new Xu(l,{title:d.title,supportIcons:!0,secondary:!!(o&&t>0),...XT});if(u.label=d.label,u.onDidClick(g=>{this.openerService.open(d.href,{allowCommands:!0})},null,this.renderDisposables),this.renderDisposables.add(u),t++,n){const g=()=>u.enabled=this.contextKeyService.contextMatchesRules(n);g();const m=new Set(n.keys());D.filter(this.contextKeyService.onDidChangeContext,y=>y.affectsSome(m))(g,null,this.renderDisposables)}}else{const d=ee(this.element,Y("p"));for(const l of c.nodes)if(typeof l=="string")ee(d,...Lv(l));else{const u=this.renderDisposables.add(this.instantiationService.createInstance(xx,d,l,{}));if(n&&l.href.startsWith("command:")){const g=()=>u.enabled=this.contextKeyService.contextMatchesRules(n);g();const m=new Set(n.keys());D.filter(this.contextKeyService.onDidChangeContext,y=>y.affectsSome(m))(g,null,this.renderDisposables)}}}}}this.container.classList.add("welcome"),this.scrollableElement.scanDomNode()}getContentDescriptors(){const e=this.items.filter(t=>t.visible);return e.length===0&&this.defaultItem?[this.defaultItem.descriptor]:e.map(t=>t.descriptor)}dispose(){this.disposables.dispose()}};HU=f([p(2,J),p(3,hi),p(4,me),p(5,wd)],HU);let Ix=class extends FP{static{VU=this}static{this.AlwaysShowActionsConfig="workbench.view.alwaysShowHeaderActions"}get title(){return this._title}get titleDescription(){return this._titleDescription}get singleViewPaneContainerTitle(){return this._singleViewPaneContainerTitle}constructor(e,t,i,n,o,r,a,c,d,l,u){super({...e,orientation:r.getViewLocationById(e.id)===Fe.Panel?wt.HORIZONTAL:wt.VERTICAL}),this.keybindingService=t,this.contextMenuService=i,this.configurationService=n,this.contextKeyService=o,this.viewDescriptorService=r,this.instantiationService=a,this.openerService=c,this.themeService=d,this.hoverService=l,this.accessibleViewInformationService=u,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new M),this.onDidBlur=this._onDidBlur.event,this._onDidChangeBodyVisibility=this._register(new M),this.onDidChangeBodyVisibility=this._onDidChangeBodyVisibility.event,this._onDidChangeTitleArea=this._register(new M),this.onDidChangeTitleArea=this._onDidChangeTitleArea.event,this._onDidChangeViewWelcomeState=this._register(new M),this.onDidChangeViewWelcomeState=this._onDidChangeViewWelcomeState.event,this._isVisible=!1,this.headerActionViewItems=this._register(new ei),this.id=e.id,this._title=e.title,this._titleDescription=e.titleDescription,this._singleViewPaneContainerTitle=e.singleViewPaneContainerTitle,this.showActions=e.showActions??KC.Default,this.scopedContextKeyService=this._register(o.createScoped(this.element)),this.scopedContextKeyService.createKey("view",this.id);const g=this.scopedContextKeyService.createKey("viewLocation",ed(r.getViewLocationById(this.id)));this._register(D.filter(r.onDidChangeLocation,v=>v.views.some(y=>y.id===this.id))(()=>g.set(ed(r.getViewLocationById(this.id)))));const m=this._register(this.instantiationService.createChild(new pf([me,this.scopedContextKeyService])));this.menuActions=this._register(m.createInstance(WP,e.titleMenuId??N.ViewTitle,N.ViewTitleContext,{shouldForwardArgs:!e.donotForwardArgs,renderShortTitle:!0})),this._register(this.menuActions.onDidChange(()=>this.updateActions()))}get headerVisible(){return super.headerVisible}set headerVisible(e){super.headerVisible=e,this.element.classList.toggle("merged-header",!e)}setVisible(e){this._isVisible!==e&&(this._isVisible=e,this.isExpanded()&&this._onDidChangeBodyVisibility.fire(e))}isVisible(){return this._isVisible}isBodyVisible(){return this._isVisible&&this.isExpanded()}setExpanded(e){const t=super.setExpanded(e);return t&&this._onDidChangeBodyVisibility.fire(e),this.updateTwistyIcon(),t}render(){super.render();const e=Po(this.element);this._register(e),this._register(e.onDidFocus(()=>this._onDidFocus.fire())),this._register(e.onDidBlur(()=>this._onDidBlur.fire()))}renderHeader(e){this.headerContainer=e,this.twistiesContainer=ee(e,Y(`.twisty-container${Te.asCSSSelector(this.getTwistyIcon(this.isExpanded()))}`)),this.renderHeaderTitle(e,this.title);const t=ee(e,Y(".actions"));t.classList.toggle("show-always",this.showActions===KC.Always),t.classList.toggle("show-expanded",this.showActions===KC.WhenExpanded),this.toolbar=this.instantiationService.createInstance(zq,t,{orientation:xa.HORIZONTAL,actionViewItemProvider:(o,r)=>{const a=this.createActionViewItem(o,r);return a&&this.headerActionViewItems.set(a.action.id,a),a},ariaLabel:h(3542,"{0} actions",this.title),getKeyBinding:o=>this.keybindingService.lookupKeybinding(o.id),renderDropdownAsChildElement:!0,actionRunner:this.getActionRunner(),resetMenu:this.menuActions.menuId}),this._register(this.toolbar),this.setActions(),this._register(re(t,pe.CLICK,o=>o.preventDefault()));const i=this.viewDescriptorService.getViewContainerByViewId(this.id);i?this._register(this.viewDescriptorService.getViewContainerModel(i).onDidChangeContainerInfo(({title:o})=>this.updateTitle(this.title))):console.error(`View container model not found for view ${this.id}`);const n=D.filter(this.configurationService.onDidChangeConfiguration,o=>o.affectsConfiguration(VU.AlwaysShowActionsConfig));this._register(n(this.updateActionsVisibility,this)),this.updateActionsVisibility()}updateHeader(){super.updateHeader(),this.updateTwistyIcon()}updateTwistyIcon(){this.twistiesContainer&&(this.twistiesContainer.classList.remove(...Te.asClassNameArray(this.getTwistyIcon(!this._expanded))),this.twistiesContainer.classList.add(...Te.asClassNameArray(this.getTwistyIcon(this._expanded))))}getTwistyIcon(e){return e?e0e:t0e}style(e){super.style(e);const t=this.getIcon();if(this.iconContainer){const i=C_e(e.headerForeground,gt(Kn));R.isUri(t)?(this.iconContainer.style.backgroundColor=i,this.iconContainer.style.color=""):(this.iconContainer.style.color=i,this.iconContainer.style.backgroundColor="")}}getIcon(){return this.viewDescriptorService.getViewDescriptorById(this.id)?.containerIcon||GAe}renderHeaderTitle(e,t){this.iconContainer=ee(e,Y(".icon",void 0));const i=this.getIcon();let n;if(R.isUri(i)){n=`view-${this.id.replace(/[\.\:]/g,"-")}`;const r=`.pane-header .icon.${n}`;OM(r,`
				mask: ${oy(i)} no-repeat 50% 50%;
				mask-size: 24px;
				-webkit-mask: ${oy(i)} no-repeat 50% 50%;
				-webkit-mask-size: 16px;
			`)}else Te.isThemeIcon(i)&&(n=Te.asClassName(i));n&&this.iconContainer.classList.add(...n.split(" "));const o=this.calculateTitle(t);this.titleContainer=ee(e,Y("h3.title",{},o)),this.titleContainerHover=this._register(this.hoverService.setupManagedHover(yr("mouse"),this.titleContainer,o)),this._titleDescription&&this.setTitleDescription(this._titleDescription),this.iconContainerHover=this._register(this.hoverService.setupManagedHover(yr("mouse"),this.iconContainer,o)),this.iconContainer.setAttribute("aria-label",this._getAriaLabel(o,this._titleDescription))}_getAriaLabel(e,t){const i=this.viewDescriptorService.getViewDescriptorById(this.id)?.accessibilityHelpContent,n=this.accessibleViewInformationService?.hasShownAccessibleView(this.id);return!i||n?t?`${e} - ${t}`:e:h(3543,"Use Alt+F1 for accessibility help {0}",e)}updateTitle(e){const t=this.calculateTitle(e);this.titleContainer&&(this.titleContainer.textContent=t,this.titleContainerHover?.update(t)),this.updateAriaHeaderLabel(t,this._titleDescription),this._title=e,this._onDidChangeTitleArea.fire()}updateAriaHeaderLabel(e,t){const i=this._getAriaLabel(e,t);this.iconContainer&&(this.iconContainerHover?.update(e),this.iconContainer.setAttribute("aria-label",i)),this.ariaHeaderLabel=this.getAriaHeaderLabel(i)}setTitleDescription(e){this.titleDescriptionContainer?(this.titleDescriptionContainer.textContent=e??"",this.titleDescriptionContainerHover?.update(e??"")):e&&this.titleContainer&&(this.titleDescriptionContainer=E_e(this.titleContainer,Y("span.description",{},e)),this.titleDescriptionContainerHover=this._register(this.hoverService.setupManagedHover(yr("mouse"),this.titleDescriptionContainer,e)))}updateTitleDescription(e){this.setTitleDescription(e),this.updateAriaHeaderLabel(this._title,e),this._titleDescription=e,this._onDidChangeTitleArea.fire()}calculateTitle(e){const t=this.viewDescriptorService.getViewContainerByViewId(this.id),i=this.viewDescriptorService.getViewContainerModel(t),n=this.viewDescriptorService.getViewDescriptorById(this.id);return!(this.viewDescriptorService.getDefaultContainerById(this.id)===t)&&n?.containerTitle&&i.title!==n.containerTitle?`${n.containerTitle}: ${e}`:e}renderBody(e){this.viewWelcomeController=this._register(this.instantiationService.createInstance(HU,e,this))}layoutBody(e,t){this.viewWelcomeController.layout(e,t)}onDidScrollRoot(){}getProgressIndicator(){if(this.progressBar===void 0&&(this.progressBar=this._register(new Cne(this.element,Ene)),this.progressBar.hide()),this.progressIndicator===void 0){const e=this;this.progressIndicator=this._register(new Q1e(Gt(this.progressBar),new class extends X1e{constructor(){super(e.id,e.isBodyVisible()),this._register(e.onDidChangeBodyVisibility(t=>t?this.onScopeOpened(e.id):this.onScopeClosed(e.id)))}}))}return this.progressIndicator}getProgressLocation(){return this.viewDescriptorService.getViewContainerByViewId(this.id).id}getLocationBasedColors(){return i0e(this.viewDescriptorService.getViewLocationById(this.id))}focus(){this.viewWelcomeController.enabled?this.viewWelcomeController.focus():this.element&&this.element.focus(),(gf(this.element)||Mq(this.element))&&this._onDidFocus.fire()}setActions(){if(this.toolbar){const e=[...this.menuActions.getPrimaryActions()];this.shouldShowFilterInHeader()&&e.unshift(MZ),this.toolbar.setActions(QT(e),QT(this.menuActions.getSecondaryActions())),this.toolbar.context=this.getActionsContext()}}updateActionsVisibility(){if(!this.headerContainer)return;const e=this.configurationService.getValue("workbench.view.alwaysShowHeaderActions");this.headerContainer.classList.toggle("actions-always-visible",e)}updateActions(){this.setActions(),this._onDidChangeTitleArea.fire()}createActionViewItem(e,t){if(e.id===MZ.id){const i=this;return new class extends YM{constructor(){super(null,e)}setFocusable(){}get trapsArrowNavigation(){return!0}render(n){n.classList.add("viewpane-filter-container");const o=i.getFilterWidget();ee(n,o.element),o.relayout()}}}return dw(this.instantiationService,e,{...t,menuAsChild:e instanceof kh})}getActionsContext(){}getActionRunner(){}getOptimalWidth(){return 0}saveState(){}shouldShowWelcome(){return!1}getFilterWidget(){}shouldShowFilterInHeader(){return!1}};Ix=VU=f([p(1,Ve),p(2,mi),p(3,ne),p(4,me),p(5,Os),p(6,J),p(7,hi),p(8,ft),p(9,wi)],Ix);let UU=class extends Ix{constructor(e,t,i,n,o,r,a,c,d,l,u){super(e,t,i,n,o,r,a,c,d,l,u);const g=this._register(a.createChild(new pf([me,this.scopedContextKeyService])));this.filterWidget=this._register(g.createInstance(BU,e.filterOptions))}getFilterWidget(){return this.filterWidget}renderBody(e){super.renderBody(e),this.filterContainer=ee(e,Y(".viewpane-filter-container"))}layoutBody(e,t){super.layoutBody(e,t),this.dimension=new Ke(t,e);const i=!this.filterContainer?.hasChildNodes(),n=this.shouldShowFilterInHeader();i!==n&&(n&&ig(this.filterContainer),this.updateActions(),n||ee(this.filterContainer,this.filterWidget.element)),n||(e=e-44),this.filterWidget.layout(t),this.layoutBodyContent(e,t)}shouldShowFilterInHeader(){return!(this.dimension&&this.dimension.width<600&&this.dimension.height>100)}};UU=f([p(1,Ve),p(2,mi),p(3,ne),p(4,me),p(5,Os),p(6,J),p(7,hi),p(8,ft),p(9,wi)],UU);function i0e(s){let e,t,i,n,o;switch(s){case Fe.Panel:e=Zoe,t=fz,i=Vxe,n=Hxe,o=Uxe;break;case Fe.Sidebar:case Fe.AuxiliaryBar:default:e=mz,t=vz,i=zxe,n=Kxe,o=jxe}return{background:e,overlayBackground:t,listOverrideStyles:{listBackground:e,treeStickyScrollBackground:i,treeStickyScrollBorder:n,treeStickyScrollShadow:o}}}class u_ extends X{constructor(e){super(e),this.desc=e}run(e,...t){const i=e.get(mo).getActiveViewWithId(this.desc.viewId);if(i)return this.runInView(e,i,...t)}}const n0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Gf;const H0={LEFT:"left",FIRST:"first",LAST:"last"};function aue(s){const e=s;return!!(e&&typeof e=="object"&&Array.isArray(e.editors)&&Array.isArray(e.mru))}function s0e(s){const e=s;return e.kind===ct.EDITOR_OPEN&&e.editorIndex!==void 0}function o0e(s){const e=s;return e.kind===ct.EDITOR_MOVE&&e.editorIndex!==void 0&&e.oldEditorIndex!==void 0}function r0e(s){const e=s;return e.kind===ct.EDITOR_CLOSE&&e.editorIndex!==void 0&&e.context!==void 0&&e.sticky!==void 0}let BP=class extends F{static{Gf=this}static{this.IDS=0}get id(){return this._id}get active(){return this.selection[0]??null}constructor(e,t,i){super(),this.instantiationService=t,this.configurationService=i,this._onDidModelChange=this._register(new M({leakWarningThreshold:500})),this.onDidModelChange=this._onDidModelChange.event,this.editors=[],this.mru=[],this.editorListeners=new Set,this.locked=!1,this.selection=[],this.preview=null,this.sticky=-1,this.transient=new Set,aue(e)?this._id=this.deserialize(e):this._id=Gf.IDS++,this.onConfigurationUpdated(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e)))}onConfigurationUpdated(e){e&&!e.affectsConfiguration("workbench.editor.openPositioning")&&!e.affectsConfiguration("workbench.editor.focusRecentEditorAfterClose")||(this.editorOpenPositioning=this.configurationService.getValue("workbench.editor.openPositioning"),this.focusRecentEditorAfterClose=this.configurationService.getValue("workbench.editor.focusRecentEditorAfterClose"))}get count(){return this.editors.length}get stickyCount(){return this.sticky+1}getEditors(e,t){const i=e===Ai.MOST_RECENTLY_ACTIVE?this.mru.slice(0):this.editors.slice(0);return t?.excludeSticky?e===Ai.MOST_RECENTLY_ACTIVE?i.filter(n=>!this.isSticky(n)):i.slice(this.sticky+1):i}getEditorByIndex(e){return this.editors[e]}get activeEditor(){return this.active}isActive(e){return this.matches(this.active,e)}get previewEditor(){return this.preview}openEditor(e,t){const i=t?.sticky||typeof t?.index=="number"&&this.isSticky(t.index),n=t?.pinned||t?.sticky,o=!!t?.transient,r=t?.active||!this.activeEditor||!n&&this.preview===this.activeEditor,a=this.findEditor(e,t);if(a){const[c,d]=a;return this.doSetTransient(c,d,o===!1?!1:this.isTransient(c)),n&&this.doPin(c,d),this.setSelection(r?c:this.activeEditor,t?.inactiveSelection??[]),t&&typeof t.index=="number"&&this.moveEditor(c,t.index),i&&this.doStick(c,this.indexOf(c)),{editor:c,isNew:!1}}else{const c=e,d=this.indexOf(this.active);let l;if(t&&typeof t.index=="number"?l=t.index:this.editorOpenPositioning===H0.FIRST?(l=0,!i&&this.isSticky(l)&&(l=this.sticky+1)):this.editorOpenPositioning===H0.LAST?l=this.editors.length:(this.editorOpenPositioning===H0.LEFT?d===0||!this.editors.length?l=0:l=d:l=d+1,!i&&this.isSticky(l)&&(l=this.sticky+1)),i&&(this.sticky++,this.isSticky(l)||(l=this.sticky)),(n||!this.preview)&&this.splice(l,!1,c),o&&this.doSetTransient(c,l,!0),!n){if(this.preview){const g=this.indexOf(this.preview);l>g&&l--,this.replaceEditor(this.preview,c,l,!r)}this.preview=c}this.registerEditorListeners(c);const u={kind:ct.EDITOR_OPEN,editor:c,editorIndex:l};return this._onDidModelChange.fire(u),this.setSelection(r?c:this.activeEditor,t?.inactiveSelection??[]),{editor:c,isNew:!0}}}registerEditorListeners(e){const t=new U;this.editorListeners.add(t),t.add(D.once(e.onWillDispose)(()=>{const i=this.editors.indexOf(e);if(i>=0){const n={kind:ct.EDITOR_WILL_DISPOSE,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}})),t.add(e.onDidChangeDirty(()=>{const i={kind:ct.EDITOR_DIRTY,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(e.onDidChangeLabel(()=>{const i={kind:ct.EDITOR_LABEL,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(e.onDidChangeCapabilities(()=>{const i={kind:ct.EDITOR_CAPABILITIES,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(this.onDidModelChange(i=>{i.kind===ct.EDITOR_CLOSE&&i.editor?.matches(e)&&(Qe(t),this.editorListeners.delete(t))}))}replaceEditor(e,t,i,n=!0){const o=this.doCloseEditor(e,Yd.REPLACE,n);if(this.splice(i,!1,t),o){const r={kind:ct.EDITOR_CLOSE,...o};this._onDidModelChange.fire(r)}}closeEditor(e,t=Yd.UNKNOWN,i=!0){const n=this.doCloseEditor(e,t,i);if(n){const o={kind:ct.EDITOR_CLOSE,...n};return this._onDidModelChange.fire(o),n}}doCloseEditor(e,t,i){const n=this.indexOf(e);if(n===-1)return;const o=this.editors[n],r=this.isSticky(n),a=this.active===o;if(i&&a)if(this.mru.length>1){let c;this.focusRecentEditorAfterClose?c=this.mru[1]:n===this.editors.length-1?c=this.editors[n-1]:c=this.editors[n+1];const d=this.selection.filter(l=>l!==o&&l!==c);this.doSetSelection(c,this.editors.indexOf(c),d)}else this.doSetSelection(null,void 0,[]);else if(!a&&this.doIsSelected(o)){const c=this.selection.filter(d=>d!==o&&d!==this.activeEditor);this.doSetSelection(this.activeEditor,this.indexOf(this.activeEditor),c)}return this.preview===o&&(this.preview=null),this.transient.delete(o),this.splice(n,!0),{editor:o,sticky:r,editorIndex:n,context:t}}moveEditor(e,t){t>=this.editors.length?t=this.editors.length-1:t<0&&(t=0);const i=this.indexOf(e);if(i<0||t===i)return;const n=this.editors[i],o=this.sticky;this.isSticky(i)&&t>this.sticky?this.sticky--:!this.isSticky(i)&&t<=this.sticky&&this.sticky++,this.editors.splice(i,1),this.editors.splice(t,0,n);const r={kind:ct.EDITOR_MOVE,editor:n,oldEditorIndex:i,editorIndex:t};if(this._onDidModelChange.fire(r),o!==this.sticky){const a={kind:ct.EDITOR_STICKY,editor:n,editorIndex:t};this._onDidModelChange.fire(a)}return n}setActive(e){let t;return e?t=this.setEditorActive(e):this.setGroupActive(),t}setGroupActive(){this._onDidModelChange.fire({kind:ct.GROUP_ACTIVE})}setEditorActive(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doSetSelection(i,n,[]),i}get selectedEditors(){return this.editors.filter(e=>this.doIsSelected(e))}isSelected(e){let t;return typeof e=="number"?t=this.editors[e]:t=this.findEditor(e)?.[0],!!t&&this.doIsSelected(t)}doIsSelected(e){return this.selection.includes(e)}setSelection(e,t){const i=this.findEditor(e);if(!i)return;const[n,o]=i,r=new Set;for(const a of t){const c=this.findEditor(a);if(!c)return;const[d]=c;d!==n&&r.add(d)}this.doSetSelection(n,o,Array.from(r))}doSetSelection(e,t,i){const n=this.activeEditor,o=this.selection;let r;e?r=[e,...i]:r=[],this.selection=r;const a=e&&typeof t=="number"&&n!==e;if(a){const c=this.indexOf(e,this.mru);this.mru.splice(c,1),this.mru.unshift(e);const d={kind:ct.EDITOR_ACTIVE,editor:e,editorIndex:t};this._onDidModelChange.fire(d)}if(a||o.length!==r.length||o.some(c=>!r.includes(c))){const c={kind:ct.EDITORS_SELECTION};this._onDidModelChange.fire(c)}}setIndex(e){this._onDidModelChange.fire({kind:ct.GROUP_INDEX})}setLabel(e){this._onDidModelChange.fire({kind:ct.GROUP_LABEL})}pin(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doPin(i,n),i}doPin(e,t){if(this.isPinned(e))return;this.setTransient(e,!1),this.preview=null;const i={kind:ct.EDITOR_PIN,editor:e,editorIndex:t};this._onDidModelChange.fire(i)}unpin(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doUnpin(i,n),i}doUnpin(e,t){if(!this.isPinned(e))return;const i=this.preview;this.preview=e;const n={kind:ct.EDITOR_PIN,editor:e,editorIndex:t};this._onDidModelChange.fire(n),i&&this.closeEditor(i,Yd.UNPIN)}isPinned(e){let t;return typeof e=="number"?t=this.editors[e]:t=e,!this.matches(this.preview,t)}stick(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doStick(i,n),i}doStick(e,t){if(this.isSticky(t))return;this.pin(e);const i=this.sticky+1;this.moveEditor(e,i),this.sticky++;const n={kind:ct.EDITOR_STICKY,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}unstick(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doUnstick(i,n),i}doUnstick(e,t){if(!this.isSticky(t))return;const i=this.sticky;this.moveEditor(e,i),this.sticky--;const n={kind:ct.EDITOR_STICKY,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}isSticky(e){if(this.sticky<0)return!1;let t;return typeof e=="number"?t=e:t=this.indexOf(e),t<0?!1:t<=this.sticky}setTransient(e,t){if(!t&&this.transient.size===0)return;const i=this.findEditor(e);if(!i)return;const[n,o]=i;return this.doSetTransient(n,o,t),n}doSetTransient(e,t,i){if(i){if(this.transient.has(e))return;this.transient.add(e)}else{if(!this.transient.has(e))return;this.transient.delete(e)}const n={kind:ct.EDITOR_TRANSIENT,editor:e,editorIndex:t};this._onDidModelChange.fire(n)}isTransient(e){if(this.transient.size===0)return!1;let t;return typeof e=="number"?t=this.editors[e]:t=this.findEditor(e)?.[0],!!t&&this.transient.has(t)}splice(e,t,i){const n=this.editors[e];if(t&&this.isSticky(e)&&this.sticky--,i?this.editors.splice(e,t?1:0,i):this.editors.splice(e,t?1:0),!t&&i)this.mru.length===0?this.mru.push(i):this.mru.splice(1,0,i);else{const o=this.indexOf(n,this.mru);t&&!i?this.mru.splice(o,1):t&&i&&this.mru.splice(o,1,i)}}indexOf(e,t=this.editors,i){let n=-1;if(!e)return n;for(let o=0;o<t.length;o++){const r=t[o];if(this.matches(r,e,i))if(i?.supportSideBySide&&r instanceof ws&&!(e instanceof ws))n=o;else{n=o;break}}return n}findEditor(e,t){const i=this.indexOf(e,this.editors,t);if(i!==-1)return[this.editors[i],i]}isFirst(e,t=this.editors){return this.matches(t[0],e)}isLast(e,t=this.editors){return this.matches(t[t.length-1],e)}contains(e,t){return this.indexOf(e,this.editors,t)!==-1}matches(e,t,i){if(!e||!t)return!1;if(i?.supportSideBySide&&e instanceof ws&&!(t instanceof ws))switch(i.supportSideBySide){case Ut.ANY:if(this.matches(e.primary,t,i)||this.matches(e.secondary,t,i))return!0;break;case Ut.BOTH:if(this.matches(e.primary,t,i)&&this.matches(e.secondary,t,i))return!0;break}const n=e===t;return i?.strictEquals?n:n||e.matches(t)}get isLocked(){return this.locked}lock(e){this.isLocked!==e&&(this.locked=e,this._onDidModelChange.fire({kind:ct.GROUP_LOCKED}))}clone(){const e=this.instantiationService.createInstance(Gf,void 0);e.editors=this.editors.slice(0),e.mru=this.mru.slice(0),e.preview=this.preview,e.selection=this.selection.slice(0),e.sticky=this.sticky;for(const t of e.editors)e.registerEditorListeners(t);return e}serialize(){const e=Ge.as(Zm.EditorFactory),t=[],i=[];let n,o=this.sticky;for(let a=0;a<this.editors.length;a++){const c=this.editors[a];let d=!1;const l=e.getEditorSerializer(c);if(l){const u=l.canSerialize(c)?l.serialize(c):void 0;typeof u=="string"?(d=!0,i.push({id:c.typeId,value:u}),t.push(c),this.preview===c&&(n=t.length-1)):d=!1}!d&&this.isSticky(a)&&o--}const r=this.mru.map(a=>this.indexOf(a,t)).filter(a=>a>=0);return{id:this.id,locked:this.locked?!0:void 0,editors:i,mru:r,preview:n,sticky:o>=0?o:void 0}}deserialize(e){const t=Ge.as(Zm.EditorFactory);return typeof e.id=="number"?(this._id=e.id,Gf.IDS=Math.max(e.id+1,Gf.IDS)):this._id=Gf.IDS++,e.locked&&(this.locked=!0),this.editors=Vt(e.editors.map((i,n)=>{let o;const r=t.getEditorSerializer(i.id);if(r){const a=r.deserialize(this.instantiationService,i.value);a instanceof gl&&(o=a,this.registerEditorListeners(o))}return!o&&typeof e.sticky=="number"&&n<=e.sticky&&e.sticky--,o})),this.mru=Vt(e.mru.map(i=>this.editors[i])),this.selection=this.mru.length>0?[this.mru[0]]:[],typeof e.preview=="number"&&(this.preview=this.editors[e.preview]),typeof e.sticky=="number"&&(this.sticky=e.sticky),this._id}dispose(){Qe(Array.from(this.editorListeners)),this.editorListeners.clear(),this.transient.clear(),super.dispose()}};BP=Gf=f([p(1,J),p(2,ne)],BP);const a0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class c0e{constructor(e){this._container=e}set text(e){ig(this._container,...Lv(e??""))}set title(e){!this.hover&&e?this.hover=Nq().setupManagedHover(yr("mouse"),this._container,e):this.hover&&this.hover.update(e)}dispose(){this.hover?.dispose()}}var $U,QS,oT;Be(a0e);let VP=class extends Hu{static{$U=this}static{this.PLACEHOLDER_LABEL_MAX_LENGTH=1024}constructor(e,t,i,n,o){super(e,t,i,n,o),this.inputDisposable=this._register(new kt)}createEditor(e){this.container=Y(".monaco-editor-pane-placeholder",{tabIndex:0}),this.container.style.outline="none",this.scrollbar=this._register(new nI(this.container,{horizontal:dd.Auto,vertical:dd.Auto})),e.appendChild(this.scrollbar.getDomNode())}async setInput(e,t,i,n){await super.setInput(e,t,i,n),!n.isCancellationRequested&&(this.inputDisposable.value=await this.renderInput(e,t))}async renderInput(e,t){const[i,n]=rm(this.container,this.scrollbar);Yi(i);const o=new U,{icon:r,label:a,actions:c}=await this.getContents(e,t,o),d=I_e(a,$U.PLACEHOLDER_LABEL_MAX_LENGTH),l=i.appendChild(Y(".editor-placeholder-icon-container")),u=o.add(new c0e(l));u.text=r;const g=i.appendChild(Y(".editor-placeholder-label-container")),m=Y("span");if(m.textContent=d,g.appendChild(m),i.setAttribute("aria-label",`${p4(e,void 0,this.group,void 0)}, ${d}`),c.length){const v=i.appendChild(Y(".editor-placeholder-buttons-container")),y=o.add(new une(v));for(let w=0;w<c.length;w++){const C=o.add(y.addButton({...XT,secondary:w!==0}));C.label=c[w].label,o.add(C.onDidClick(T=>{T&&Li.stop(T,!0),c[w].run()}))}}return n.scanDomNode(),o}clearInput(){this.container&&Yi(this.container),this.inputDisposable.clear(),super.clearInput()}layout(e){const[t,i]=rm(this.container,this.scrollbar);Cq(t,e.width,e.height),i.scanDomNode(),t.classList.toggle("max-height-200px",e.height<=200)}focus(){super.focus(),this.container?.focus()}dispose(){this.container?.remove(),super.dispose()}};VP=$U=f([p(2,li),p(3,ft),p(4,tt)],VP);let GU=class extends VP{static{QS=this}static{this.ID="workbench.editors.workspaceTrustRequiredEditor"}static{this.LABEL=h(3274,"Workspace Trust Required")}static{this.DESCRIPTOR=lp.create(QS,this.ID,this.LABEL)}constructor(e,t,i,n,o,r){super(QS.ID,e,t,i,r),this.commandService=n,this.workspaceService=o}getTitle(){return QS.LABEL}async getContents(){return{icon:"$(workspace-untrusted)",label:SE(cC(this.workspaceService.getWorkspace()))?h(3275,"The file is not displayed in the editor because trust has not been granted to the folder."):h(3276,"The file is not displayed in the editor because trust has not been granted to the workspace."),actions:[{label:h(3277,"Manage Workspace Trust"),run:()=>this.commandService.executeCommand("workbench.trust.manage")}]}}};GU=QS=f([p(1,li),p(2,ft),p(3,qe),p(4,Tt),p(5,tt)],GU);let qU=class extends VP{static{oT=this}static{this.ID="workbench.editors.errorEditor"}static{this.LABEL=h(3278,"Error Editor")}static{this.DESCRIPTOR=lp.create(oT,this.ID,this.LABEL)}constructor(e,t,i,n,o,r){super(oT.ID,e,t,i,n),this.fileService=o,this.dialogService=r}async getContents(e,t,i){const n=e.resource,o=t.error,r=o?.fileOperationResult===$n.FILE_NOT_FOUND;let a;r?a=h(3279,"The editor could not be opened because the file was not found."):wC(o)&&o.forceMessage?a=o.message:o?a=h(3280,"The editor could not be opened due to an unexpected error. Please consult the log for more details."):a=h(3281,"The editor could not be opened due to an unexpected error.");let c="$(error)";wC(o)&&(o.forceSeverity===Me.Info?c="$(info)":o.forceSeverity===Me.Warning&&(c="$(warning)"));let d;return wC(o)&&o.actions.length>0?d=o.actions.map(l=>({label:l.label,run:()=>{const u=l.run();u instanceof Promise&&u.catch(g=>this.dialogService.error(ho(g)))}})):d=[{label:h(3282,"Try Again"),run:()=>this.group.openEditor(e,{...t,source:eN.USER})}],r&&n&&this.fileService.hasProvider(n)&&i.add(this.fileService.onDidFilesChange(l=>{l.contains(n,mh.ADDED,mh.UPDATED)&&this.group.openEditor(e,t)})),{icon:c,label:a,actions:d??[]}}};qU=oT=f([p(1,li),p(2,ft),p(3,tt),p(4,Xe),p(5,Qt)],qU);let zU=class extends F{get minimumWidth(){return this._activeEditorPane?.minimumWidth??pp.width}get minimumHeight(){return this._activeEditorPane?.minimumHeight??pp.height}get maximumWidth(){return this._activeEditorPane?.maximumWidth??TA.width}get maximumHeight(){return this._activeEditorPane?.maximumHeight??TA.height}get activeEditorPane(){return this._activeEditorPane}constructor(e,t,i,n,o,r,a,c,d,l){super(),this.editorGroupParent=e,this.editorPanesParent=t,this.groupView=i,this.layoutService=n,this.instantiationService=o,this.workspaceTrustService=a,this.logService=c,this.dialogService=d,this.hostService=l,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onDidChangeSizeConstraints=this._register(new M),this.onDidChangeSizeConstraints=this._onDidChangeSizeConstraints.event,this._activeEditorPane=null,this.editorPanes=[],this.mapEditorPaneToPendingSetInput=new Map,this.activeEditorPaneDisposables=this._register(new U),this.editorPanesRegistry=Ge.as(Zm.EditorPane),this.editorOperation=this._register(new D_e(r)),this.registerListeners()}registerListeners(){this._register(this.workspaceTrustService.onDidChangeTrust(()=>this.onDidChangeWorkspaceTrust()))}onDidChangeWorkspaceTrust(){const e=this._activeEditorPane?.input,t=this._activeEditorPane?.options;e?.hasCapability(Ze.RequiresTrust)&&this.groupView.openEditor(e,t)}async openEditor(e,t,i,n=Object.create(null)){try{return await this.doOpenEditor(this.getEditorPaneDescriptor(e),e,t,i,n)}catch(o){return t?.ignoreError?{error:o}:this.doShowError(o,e,t,i,n)}}async doShowError(e,t,i,n,o){this.logService.error(e);let r=!1;if(i?.source===eN.USER&&(!wC(e)||e.allowDialog)&&(r=await this.doShowErrorDialog(e,t)),r)return{error:e};const a={...i};return gs(e)||(a.error=e),{...await this.doOpenEditor(qU.DESCRIPTOR,t,a,n,o),error:e}}async doShowErrorDialog(e,t){let i=Me.Error,n,o=ho(e),r;wC(e)&&(r=e.actions,i=e.forceSeverity??Me.Error,e.forceMessage&&(n=e.message,o=void 0)),n||(n=h(3271,"Unable to open '{0}'",t.getName()));const a=[];if(r&&r.length>0)for(const u of r)a.push({label:u.label,run:()=>u});else a.push({label:h(3272,"&&OK"),run:()=>{}});let c;a.length===1&&(c={run:()=>{d=!0}});let d=!1;const{result:l}=await this.dialogService.prompt({type:i,message:n,detail:o,buttons:a,cancelButton:c});if(l){const u=l.run();u instanceof Promise&&u.catch(g=>this.dialogService.error(ho(g))),d=!0}return d}async doOpenEditor(e,t,i,n,o=Object.create(null)){const r=this.doShowEditorPane(e),a=Eh(),{changed:c,cancelled:d}=await this.doSetInput(r,t,i,o);return d||((!i||!i.preserveFocus)&&this.shouldRestoreFocus(a)?r.focus():n?.preserveWindowOrder||this.hostService.moveTop(kq(this.groupView.windowId,!0).window)),{pane:r,changed:c,cancelled:d}}shouldRestoreFocus(e){if(!this.layoutService.isRestored()||!e)return!0;const t=Eh();return!!(!t||t===e.ownerDocument.body||e===t||!xne(t)||Ku(t,this.editorGroupParent))}getEditorPaneDescriptor(e){return e.hasCapability(Ze.RequiresTrust)&&!this.workspaceTrustService.isWorkspaceTrusted()?GU.DESCRIPTOR:Gt(this.editorPanesRegistry.getEditorPane(e))}doShowEditorPane(e){if(this._activeEditorPane&&e.describes(this._activeEditorPane))return this._activeEditorPane;this.doHideActiveEditorPane();const t=this.doCreateEditorPane(e);this.doSetActiveEditorPane(t);const i=Gt(t.getContainer());return this.editorPanesParent.appendChild(i),Ho(i),t.setVisible(!0),this.pagePosition&&t.layout(new Ke(this.pagePosition.width,this.pagePosition.height),{top:this.pagePosition.top,left:this.pagePosition.left}),this.boundarySashes&&t.setBoundarySashes(this.boundarySashes),t}doCreateEditorPane(e){const t=this.doInstantiateEditorPane(e);if(!t.getContainer()){const i=Y(".editor-instance");this.editorPanesParent.appendChild(i);try{t.create(i)}catch(n){throw i.remove(),Hs(i),n}}return t}doInstantiateEditorPane(e){const t=this.editorPanes.find(n=>e.describes(n));if(t)return t;const i=this._register(e.instantiate(this.instantiationService,this.groupView));return this.editorPanes.push(i),i}doSetActiveEditorPane(e){this._activeEditorPane=e,this.activeEditorPaneDisposables.clear(),e&&(this.activeEditorPaneDisposables.add(e.onDidChangeSizeConstraints(t=>this._onDidChangeSizeConstraints.fire(t))),this.activeEditorPaneDisposables.add(e.onDidFocus(()=>this._onDidFocus.fire()))),this._onDidChangeSizeConstraints.fire(void 0)}async doSetInput(e,t,i,n){let o=e.input?.matches(t);if(o&&!i?.forceReload)return this.mapEditorPaneToPendingSetInput.has(e)&&await this.mapEditorPaneToPendingSetInput.get(e),o=e.input?.matches(t),o&&e.setOptions(i),{changed:!1,cancelled:!o};const r=this.editorOperation.start(this.layoutService.isRestored()?800:3200);let a=!1;try{e.clearInput();const c=e.setInput(t,i,n,r.token);this.mapEditorPaneToPendingSetInput.set(e,c),await c,r.isCurrent()||(a=!0)}catch(c){if(!r.isCurrent())a=!0;else throw c}finally{r.isCurrent()&&this.mapEditorPaneToPendingSetInput.delete(e),r.stop()}return{changed:!o,cancelled:a}}doHideActiveEditorPane(){if(!this._activeEditorPane)return;this.editorOperation.stop(),this.safeRun(()=>this._activeEditorPane?.clearInput()),this.safeRun(()=>this._activeEditorPane?.setVisible(!1)),this.mapEditorPaneToPendingSetInput.delete(this._activeEditorPane);const e=this._activeEditorPane.getContainer();e&&(e.remove(),Hs(e)),this.doSetActiveEditorPane(null)}closeEditor(e){this._activeEditorPane?.input&&e.matches(this._activeEditorPane.input)&&this.doHideActiveEditorPane()}setVisible(e){this.safeRun(()=>this._activeEditorPane?.setVisible(e))}layout(e){this.pagePosition=e,this.safeRun(()=>this._activeEditorPane?.layout(new Ke(e.width,e.height),e))}setBoundarySashes(e){this.boundarySashes=e,this.safeRun(()=>this._activeEditorPane?.setBoundarySashes(e))}safeRun(e){try{e()}catch(t){this.logService.error(t)}}};zU=f([p(3,vi),p(4,J),p(5,ju),p(6,Tv),p(7,Pe),p(8,Qt),p(9,Wn)],zU);var rT;const cue={text:h(3258,"Show All Commands"),id:"workbench.action.showCommands"},d0e={text:h(3259,"Go to File"),id:"workbench.action.quickOpen"},l0e={text:h(3260,"Open File"),id:"workbench.action.files.openFile"},h0e={text:h(3261,"Open Folder"),id:"workbench.action.files.openFolder"},u0e={text:h(3262,"Open File or Folder"),id:"workbench.action.files.openFileFolder"},g0e={text:h(3263,"Open Recent"),id:"workbench.action.openRecent"},p0e={text:h(3264,"New Untitled Text File"),id:"workbench.action.files.newUntitledFile"},f0e={text:h(3265,"Find in Files"),id:"workbench.action.findInFiles"},m0e={text:h(3266,"Toggle Terminal"),id:"workbench.action.terminal.toggleTerminal",when:{web:x.equals("terminalProcessSupported",!0)}},v0e={text:h(3267,"Start Debugging"),id:"workbench.action.debug.start",when:{web:x.equals("terminalProcessSupported",!0)}},_0e={text:h(3268,"Open Settings"),id:"workbench.action.openSettings"},OZ=x.and(x.equals("chatSetupHidden",!1),x.equals("chatSetupDisabled",!1)),due={text:h(3269,"Open Chat"),id:"workbench.action.chat.open",when:{native:OZ,web:OZ}},FZ=Vt([cue,...qt&&!$t?[u0e]:[l0e,h0e],g0e,qt&&!$t?p0e:void 0,due]),WZ=[],BZ=[cue,d0e,due],VZ=[f0e,v0e,m0e,_0e];let KU=class extends F{static{rT=this}static{this.CACHED_WHEN="editorGroupWatermark.whenConditions"}constructor(e,t,i,n,o,r){super(),this.keybindingService=t,this.contextService=i,this.contextKeyService=n,this.configurationService=o,this.storageService=r,this.transientDisposables=this._register(new U),this.keybindingLabels=this._register(new U),this.enabled=!1,this.cachedWhen=this.storageService.getObject(rT.CACHED_WHEN,he.PROFILE,Object.create(null)),this.workbenchState=this.contextService.getWorkbenchState();const a=rn(".editor-group-watermark",[rn(".letterpress"),rn(".shortcuts@shortcuts")]);ee(e,a.root),this.shortcuts=a.shortcuts,this.registerListeners(),this.render()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("workbench.tips.enabled")&&this.enabled!==this.configurationService.getValue("workbench.tips.enabled")&&this.render()})),this._register(this.contextService.onDidChangeWorkbenchState(e=>{this.workbenchState!==e&&(this.workbenchState=e,this.render())})),this._register(this.storageService.onWillSaveState(e=>{if(e.reason===Zx.SHUTDOWN){const t=[...FZ,...WZ,...BZ,...VZ];for(const i of t){const n=$t?i.when?.web:i.when?.native;n&&(this.cachedWhen[i.id]=this.contextKeyService.contextMatchesRules(n))}this.storageService.store(rT.CACHED_WHEN,JSON.stringify(this.cachedWhen),he.PROFILE,pt.MACHINE)}}))}render(){if(this.enabled=this.configurationService.getValue("workbench.tips.enabled"),Yi(this.shortcuts),this.transientDisposables.clear(),!this.enabled)return;const e=this.filterEntries(this.workbenchState!==zo.EMPTY?BZ:FZ,!1),t=this.filterEntries(this.workbenchState!==zo.EMPTY?VZ:WZ,!0).slice(0,Math.max(0,5-e.length)),i=[...e,...t],n=ee(this.shortcuts,Y(".watermark-box")),o=()=>{Yi(n),this.keybindingLabels.clear();for(const r of i){const a=this.keybindingService.lookupKeybinding(r.id);if(!a)continue;const c=ee(n,Y("dl")),d=ee(c,Y("dt"));d.textContent=r.text;const l=ee(c,Y("dd"));this.keybindingLabels.add(new VM(l,Yu,{renderUnboundKeybindings:!0,...Ine})).set(a)}};o(),this.transientDisposables.add(this.keybindingService.onDidUpdateKeybindings(o))}filterEntries(e,t){const i=e.filter(n=>$t&&!n.when?.web||!$t&&!n.when?.native||this.cachedWhen[n.id]).filter(n=>!!Ce.getCommand(n.id)).filter(n=>!!this.keybindingService.lookupKeybinding(n.id));return t&&k_e(i),i}};KU=rT=f([p(1,Ve),p(2,Tt),p(3,me),p(4,ne),p(5,tt)],KU);H("editorWatermark.foreground",{dark:Je(ao,.6),light:Je(ao,.68),hcDark:ao,hcLight:ao},h(3270,"Foreground color for the labels in the editor watermark."));const b0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),y0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(y0e);class E4{}class w0e{constructor(e,t,i,n){this._disposables=new U,this._onDidSelectItem=new M,this._onDidFocusItem=new M,this._onDidChangeFocus=new M,this.onDidSelectItem=this._onDidSelectItem.event,this.onDidFocusItem=this._onDidFocusItem.event,this.onDidChangeFocus=this._onDidChangeFocus.event,this._items=new Array,this._nodes=new Array,this._freeNodes=new Array,this._enabled=!0,this._focusedItemIdx=-1,this._selectedItemIdx=-1,this._domNode=document.createElement("div"),this._domNode.className="monaco-breadcrumbs",this._domNode.tabIndex=0,this._domNode.setAttribute("role","list"),this._scrollable=new nI(this._domNode,{vertical:dd.Hidden,horizontal:dd.Auto,horizontalScrollbarSize:t,useShadows:!1,scrollYToX:!0}),this._separatorIcon=i,this._disposables.add(this._scrollable),this._disposables.add(co(this._domNode,"click",a=>this._onClick(a))),e.appendChild(this._scrollable.getDomNode());const o=tN(this._domNode);this._style(o,n);const r=Po(this._domNode);this._disposables.add(r),this._disposables.add(r.onDidBlur(a=>this._onDidChangeFocus.fire(!1))),this._disposables.add(r.onDidFocus(a=>this._onDidChangeFocus.fire(!0)))}setHorizontalScrollbarSize(e){this._scrollable.updateOptions({horizontalScrollbarSize:e})}dispose(){this._disposables.dispose(),this._pendingLayout?.dispose(),this._pendingDimLayout?.dispose(),this._onDidSelectItem.dispose(),this._onDidFocusItem.dispose(),this._onDidChangeFocus.dispose(),this._domNode.remove(),this._nodes.length=0,this._freeNodes.length=0}layout(e){e&&Ke.equals(e,this._dimension)||(e?(this._pendingDimLayout?.dispose(),this._pendingDimLayout=this._updateDimensions(e)):(this._pendingLayout?.dispose(),this._pendingLayout=this._updateScrollbar()))}_updateDimensions(e){const t=new U;return t.add(T_e(bt(this._domNode),()=>{this._dimension=e,this._domNode.style.width=`${e.width}px`,this._domNode.style.height=`${e.height}px`,t.add(this._updateScrollbar())})),t}_updateScrollbar(){return T7(bt(this._domNode),()=>{T7(bt(this._domNode),()=>{this._scrollable.setRevealOnScroll(!1),this._scrollable.scanDomNode(),this._scrollable.setRevealOnScroll(!0)})})}_style(e,t){let i="";t.breadcrumbsBackground&&(i+=`.monaco-breadcrumbs { background-color: ${t.breadcrumbsBackground}}`),t.breadcrumbsForeground&&(i+=`.monaco-breadcrumbs .monaco-breadcrumb-item { color: ${t.breadcrumbsForeground}}
`),t.breadcrumbsFocusForeground&&(i+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused { color: ${t.breadcrumbsFocusForeground}}
`),t.breadcrumbsFocusAndSelectionForeground&&(i+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused.selected { color: ${t.breadcrumbsFocusAndSelectionForeground}}
`),t.breadcrumbsHoverForeground&&(i+=`.monaco-breadcrumbs:not(.disabled	) .monaco-breadcrumb-item:hover:not(.focused):not(.selected) { color: ${t.breadcrumbsHoverForeground}}
`),e.innerText=i}setEnabled(e){this._enabled=e,this._domNode.classList.toggle("disabled",!this._enabled)}domFocus(){const e=this._focusedItemIdx>=0?this._focusedItemIdx:this._items.length-1;e>=0&&e<this._items.length?this._focus(e,void 0):this._domNode.focus()}isDOMFocused(){return Mq(this._domNode)}getFocused(){return this._items[this._focusedItemIdx]}setFocused(e,t){this._focus(this._items.indexOf(e),t)}focusPrev(e){this._focusedItemIdx>0&&this._focus(this._focusedItemIdx-1,e)}focusNext(e){this._focusedItemIdx+1<this._nodes.length&&this._focus(this._focusedItemIdx+1,e)}_focus(e,t){this._focusedItemIdx=-1;for(let i=0;i<this._nodes.length;i++){const n=this._nodes[i];i!==e?n.classList.remove("focused"):(this._focusedItemIdx=i,n.classList.add("focused"),n.focus())}this._reveal(this._focusedItemIdx,!0),this._onDidFocusItem.fire({type:"focus",item:this._items[this._focusedItemIdx],node:this._nodes[this._focusedItemIdx],payload:t})}reveal(e){const t=this._items.indexOf(e);t>=0&&this._reveal(t,!1)}revealLast(){this._reveal(this._items.length-1,!1)}_reveal(e,t){if(e<0||e>=this._nodes.length)return;const i=this._nodes[e];if(!i)return;const{width:n}=this._scrollable.getScrollDimensions(),{scrollLeft:o}=this._scrollable.getScrollPosition();(!t||i.offsetLeft>o+n||i.offsetLeft<o)&&(this._scrollable.setRevealOnScroll(!1),this._scrollable.setScrollPosition({scrollLeft:i.offsetLeft}),this._scrollable.setRevealOnScroll(!0))}getSelection(){return this._items[this._selectedItemIdx]}setSelection(e,t){this._select(this._items.indexOf(e),t)}_select(e,t){this._selectedItemIdx=-1;for(let i=0;i<this._nodes.length;i++){const n=this._nodes[i];i!==e?n.classList.remove("selected"):(this._selectedItemIdx=i,n.classList.add("selected"))}this._onDidSelectItem.fire({type:"select",item:this._items[this._selectedItemIdx],node:this._nodes[this._selectedItemIdx],payload:t})}getItems(){return this._items}setItems(e){let t,i=[];try{t=A_e(this._items,e,(n,o)=>n.equals(o)),i=this._items.splice(t,this._items.length-t,...e.slice(t)),this._render(t),Qe(i),Qe(e.slice(0,t)),this._focus(-1,void 0)}catch(n){const o=new Error(`BreadcrumbsItem#setItems: newItems: ${e.length}, prefix: ${t}, removed: ${i.length}`);throw o.name=n.name,o.stack=n.stack,o}}_render(e){let t=!1;for(;e<this._items.length&&e<this._nodes.length;e++){const i=this._items[e],n=this._nodes[e];this._renderItem(i,n),t=!0}for(;e<this._nodes.length;){const i=this._nodes.pop();i&&(this._freeNodes.push(i),i.remove(),t=!0)}for(;e<this._items.length;e++){const i=this._items[e],n=this._freeNodes.length>0?this._freeNodes.pop():document.createElement("div");n&&(this._renderItem(i,n),this._domNode.appendChild(n),this._nodes.push(n),t=!0)}t&&this.layout(void 0)}_renderItem(e,t){Yi(t),t.className="";try{e.render(t)}catch(n){t.innerText="<<RENDER ERROR>>",console.error(n)}t.tabIndex=-1,t.setAttribute("role","listitem"),t.classList.add("monaco-breadcrumb-item");const i=Y(Te.asCSSSelector(this._separatorIcon));t.appendChild(i)}_onClick(e){if(this._enabled)for(let t=e.target;t;t=t.parentElement){const i=this._nodes.indexOf(t);if(i>=0){this._focus(i,e),this._select(i,e);break}}}}class cZe{constructor(){this._map=new Map}register(e,t){if(this._map.has(e))throw new Error(`group (${e}) has already a widget`);return this._map.set(e,t),{dispose:()=>this._map.delete(e)}}getWidget(e){return this._map.get(e)}}class eo{constructor(){}static{this.IsEnabled=eo._stub("breadcrumbs.enabled")}static{this.UseQuickPick=eo._stub("breadcrumbs.useQuickPick")}static{this.FilePath=eo._stub("breadcrumbs.filePath")}static{this.SymbolPath=eo._stub("breadcrumbs.symbolPath")}static{this.SymbolSortOrder=eo._stub("breadcrumbs.symbolSortOrder")}static{this.Icons=eo._stub("breadcrumbs.icons")}static{this.TitleScrollbarSizing=eo._stub("workbench.editor.titleScrollbarSizing")}static{this.FileExcludes=eo._stub("files.exclude")}static _stub(e){return{bindTo(t){const i=new M,n=t.onDidChangeConfiguration(o=>{o.affectsConfiguration(e)&&i.fire(void 0)});return new class{constructor(){this.name=e,this.onDidChange=i.event}getValue(o){return o?t.getValue(e,o):t.getValue(e)}updateValue(o,r){return r?t.updateValue(e,o,r):t.updateValue(e,o)}dispose(){n.dispose(),i.dispose()}}}}}}Ge.as(qs.Configuration).registerConfiguration({id:"breadcrumbs",title:h(2912,"Breadcrumb Navigation"),order:101,type:"object",properties:{"breadcrumbs.enabled":{description:h(2913,"Enable/disable navigation breadcrumbs."),type:"boolean",default:!0},"breadcrumbs.filePath":{description:h(2914,"Controls whether and how file paths are shown in the breadcrumbs view."),type:"string",default:"on",enum:["on","off","last"],enumDescriptions:[h(2915,"Show the file path in the breadcrumbs view."),h(2916,"Do not show the file path in the breadcrumbs view."),h(2917,"Only show the last element of the file path in the breadcrumbs view.")]},"breadcrumbs.symbolPath":{description:h(2918,"Controls whether and how symbols are shown in the breadcrumbs view."),type:"string",default:"on",enum:["on","off","last"],enumDescriptions:[h(2919,"Show all symbols in the breadcrumbs view."),h(2920,"Do not show symbols in the breadcrumbs view."),h(2921,"Only show the current symbol in the breadcrumbs view.")]},"breadcrumbs.symbolSortOrder":{description:h(2922,"Controls how symbols are sorted in the breadcrumbs outline view."),type:"string",default:"position",scope:Bt.LANGUAGE_OVERRIDABLE,enum:["position","name","type"],enumDescriptions:[h(2923,"Show symbol outline in file position order."),h(2924,"Show symbol outline in alphabetical order."),h(2925,"Show symbol outline in symbol type order.")]},"breadcrumbs.icons":{description:h(2926,"Render breadcrumb items with icons."),type:"boolean",default:!0},"breadcrumbs.showFiles":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2927,"When enabled breadcrumbs show `file`-symbols.")},"breadcrumbs.showModules":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2928,"When enabled breadcrumbs show `module`-symbols.")},"breadcrumbs.showNamespaces":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2929,"When enabled breadcrumbs show `namespace`-symbols.")},"breadcrumbs.showPackages":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2930,"When enabled breadcrumbs show `package`-symbols.")},"breadcrumbs.showClasses":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2931,"When enabled breadcrumbs show `class`-symbols.")},"breadcrumbs.showMethods":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2932,"When enabled breadcrumbs show `method`-symbols.")},"breadcrumbs.showProperties":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2933,"When enabled breadcrumbs show `property`-symbols.")},"breadcrumbs.showFields":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2934,"When enabled breadcrumbs show `field`-symbols.")},"breadcrumbs.showConstructors":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2935,"When enabled breadcrumbs show `constructor`-symbols.")},"breadcrumbs.showEnums":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2936,"When enabled breadcrumbs show `enum`-symbols.")},"breadcrumbs.showInterfaces":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2937,"When enabled breadcrumbs show `interface`-symbols.")},"breadcrumbs.showFunctions":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2938,"When enabled breadcrumbs show `function`-symbols.")},"breadcrumbs.showVariables":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2939,"When enabled breadcrumbs show `variable`-symbols.")},"breadcrumbs.showConstants":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2940,"When enabled breadcrumbs show `constant`-symbols.")},"breadcrumbs.showStrings":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2941,"When enabled breadcrumbs show `string`-symbols.")},"breadcrumbs.showNumbers":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2942,"When enabled breadcrumbs show `number`-symbols.")},"breadcrumbs.showBooleans":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2943,"When enabled breadcrumbs show `boolean`-symbols.")},"breadcrumbs.showArrays":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2944,"When enabled breadcrumbs show `array`-symbols.")},"breadcrumbs.showObjects":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2945,"When enabled breadcrumbs show `object`-symbols.")},"breadcrumbs.showKeys":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2946,"When enabled breadcrumbs show `key`-symbols.")},"breadcrumbs.showNull":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2947,"When enabled breadcrumbs show `null`-symbols.")},"breadcrumbs.showEnumMembers":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2948,"When enabled breadcrumbs show `enumMember`-symbols.")},"breadcrumbs.showStructs":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2949,"When enabled breadcrumbs show `struct`-symbols.")},"breadcrumbs.showEvents":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2950,"When enabled breadcrumbs show `event`-symbols.")},"breadcrumbs.showOperators":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2951,"When enabled breadcrumbs show `operator`-symbols.")},"breadcrumbs.showTypeParameters":{type:"boolean",default:!0,scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(2952,"When enabled breadcrumbs show `typeParameter`-symbols.")}}});var HP;(function(s){s[s.OutlinePane=1]="OutlinePane",s[s.Breadcrumbs=2]="Breadcrumbs",s[s.QuickPick=4]="QuickPick"})(HP||(HP={}));var HZ;(function(s){s.icons="outline.icons",s.collapseItems="outline.collapseItems",s.problemsEnabled="outline.problems.enabled",s.problemsColors="outline.problems.colors",s.problemsBadges="outline.problems.badges"})(HZ||(HZ={}));var UZ;(function(s){s.Collapsed="alwaysCollapse",s.Expanded="alwaysExpand"})(UZ||(UZ={}));class UP{constructor(e,t){this.uri=e,this.kind=t}}class jU{constructor(e,t){this.element=e,this.outline=t}}let YU=class{constructor(e,t,i,n,o){this.resource=e,this.editor=t,this._workspaceService=n,this._outlineService=o,this._disposables=new U,this._currentOutline=new kt,this._outlineDisposables=new U,this._onDidUpdate=new M,this.onDidUpdate=this._onDidUpdate.event,this._cfgFilePath=eo.FilePath.bindTo(i),this._cfgSymbolPath=eo.SymbolPath.bindTo(i),this._disposables.add(this._cfgFilePath.onDidChange(r=>this._onDidUpdate.fire(this))),this._disposables.add(this._cfgSymbolPath.onDidChange(r=>this._onDidUpdate.fire(this))),this._workspaceService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspaceFolders,this,this._disposables),this._fileInfo=this._initFilePathInfo(e),t&&(this._bindToEditor(t),this._disposables.add(o.onDidChange(()=>this._bindToEditor(t))),this._disposables.add(t.onDidChangeControl(()=>this._bindToEditor(t)))),this._onDidUpdate.fire(this)}dispose(){this._disposables.dispose(),this._cfgFilePath.dispose(),this._cfgSymbolPath.dispose(),this._currentOutline.dispose(),this._outlineDisposables.dispose(),this._onDidUpdate.dispose()}isRelative(){return!!this._fileInfo.folder}getElements(){let e=[];if(this._cfgFilePath.getValue()==="on"?e=e.concat(this._fileInfo.path):this._cfgFilePath.getValue()==="last"&&this._fileInfo.path.length>0&&(e=e.concat(this._fileInfo.path.slice(-1))),this._cfgSymbolPath.getValue()==="off"||!this._currentOutline.value)return e;const t=this._currentOutline.value.config.breadcrumbsDataSource.getBreadcrumbElements();for(let i=this._cfgSymbolPath.getValue()==="last"&&t.length>0?t.length-1:0;i<t.length;i++)e.push(new jU(t[i],this._currentOutline.value));return t.length===0&&!this._currentOutline.value.isEmpty&&e.push(new jU(this._currentOutline.value,this._currentOutline.value)),e}_initFilePathInfo(e){if(hq(e,ae.untitled,ae.data))return{folder:void 0,path:[]};const t={folder:this._workspaceService.getWorkspaceFolder(e)??void 0,path:[]};let i=e;for(;i&&i.path!=="/"&&!(t.folder&&Dt(t.folder.uri,i));){t.path.unshift(new UP(i,t.path.length===0?Hi.FILE:Hi.FOLDER));const n=i.path.length;if(i=hs(i),i.path.length===n)break}return t.folder&&this._workspaceService.getWorkbenchState()===zo.WORKSPACE&&t.path.unshift(new UP(t.folder.uri,Hi.ROOT_FOLDER)),t}_onDidChangeWorkspaceFolders(){this._fileInfo=this._initFilePathInfo(this.resource),this._onDidUpdate.fire(this)}_bindToEditor(e){const t=new ri;this._currentOutline.clear(),this._outlineDisposables.clear(),this._outlineDisposables.add(Ee(()=>t.dispose(!0))),this._outlineService.createOutline(e,HP.Breadcrumbs,t.token).then(i=>{t.token.isCancellationRequested&&(i?.dispose(),i=void 0),this._currentOutline.value=i,this._onDidUpdate.fire(this),i&&this._outlineDisposables.add(i.onDidChange(()=>this._onDidUpdate.fire(this)))}).catch(i=>{this._onDidUpdate.fire(this),mt(i)})}};YU=f([p(2,ne),p(3,Tt),p(4,Pz)],YU);const lue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(lue);let $P=class{constructor(e,t,i,n,o){this.resource=t,this._instantiationService=i,this._themeService=n,this._configurationService=o,this._disposables=new U,this._fakeEvent=new UIEvent("fakeEvent"),this._onWillPickElement=new M,this.onWillPickElement=this._onWillPickElement.event,this._previewDispoables=new kt,this._domNode=document.createElement("div"),this._domNode.className="monaco-breadcrumbs-picker show-file-icons",e.appendChild(this._domNode)}dispose(){this._disposables.dispose(),this._previewDispoables.dispose(),this._onWillPickElement.dispose(),this._domNode.remove(),setTimeout(()=>this._tree.dispose(),0)}async show(e,t,i,n,o){const a=this._themeService.getColorTheme().getColor(Dne);this._arrow=document.createElement("div"),this._arrow.className="arrow",this._arrow.style.borderColor=`transparent transparent ${a?a.toString():""}`,this._domNode.appendChild(this._arrow),this._treeContainer=document.createElement("div"),this._treeContainer.style.background=a?a.toString():"",this._treeContainer.style.paddingTop="2px",this._treeContainer.style.borderRadius="3px",this._treeContainer.style.boxShadow=`0 0 8px 2px ${this._themeService.getColorTheme().getColor(kne)}`,this._treeContainer.style.border=`1px solid ${this._themeService.getColorTheme().getColor(ey)}`,this._domNode.appendChild(this._treeContainer),this._layoutInfo={maxHeight:t,width:i,arrowSize:n,arrowOffset:o,inputHeight:0},this._tree=this._createTree(this._treeContainer,e),this._disposables.add(this._tree.onDidOpen(async c=>{const{element:d,editorOptions:l,sideBySide:u}=c;await this._revealElement(d,{...l,preserveFocus:!1},u)})),this._disposables.add(this._tree.onDidChangeFocus(c=>{this._previewDispoables.value=this._previewElement(c.elements[0])})),this._disposables.add(this._tree.onDidChangeContentHeight(()=>{this._layout()})),this._domNode.focus();try{await this._setInput(e),this._layout()}catch(c){mt(c)}}_layout(){const e=2*this._layoutInfo.arrowSize,t=Math.min(this._layoutInfo.maxHeight-e,this._tree.contentHeight),i=t+e;this._domNode.style.height=`${i}px`,this._domNode.style.width=`${this._layoutInfo.width}px`,this._arrow.style.top=`-${2*this._layoutInfo.arrowSize}px`,this._arrow.style.borderWidth=`${this._layoutInfo.arrowSize}px`,this._arrow.style.marginLeft=`${this._layoutInfo.arrowOffset}px`,this._treeContainer.style.height=`${t}px`,this._treeContainer.style.width=`${this._layoutInfo.width}px`,this._tree.layout(t,this._layoutInfo.width)}restoreViewState(){}};$P=f([p(2,J),p(3,ft),p(4,ne)],$P);class S0e{getHeight(e){return 22}getTemplateId(e){return"FileStat"}}class C0e{getId(e){return R.isUri(e)?e.toString():PF(e)?e.id:ng(e)?e.uri.toString():e.resource.toString()}}let QU=class{constructor(e){this._fileService=e}hasChildren(e){return R.isUri(e)||PF(e)||ng(e)||e.isDirectory}async getChildren(e){if(PF(e))return e.folders;let t;return ng(e)?t=e.uri:R.isUri(e)?t=e:t=e.resource,(await this._fileService.resolve(t)).children??[]}};QU=f([p(0,Xe)],QU);let XU=class{constructor(e,t){this._labels=e,this._configService=t,this.templateId="FileStat"}renderTemplate(e){return this._labels.create(e,{supportHighlights:!0})}renderElement(e,t,i){const n=this._configService.getValue("explorer.decorations"),{element:o}=e;let r,a;ng(o)?(r=o.uri,a=Hi.ROOT_FOLDER):(r=o.resource,a=o.isDirectory?Hi.FOLDER:Hi.FILE),i.setFile(r,{fileKind:a,hidePath:!0,fileDecorations:n,matches:lw(e.filterData),extraClasses:["picker-item"]})}disposeTemplate(e){e.dispose()}};XU=f([p(1,ne)],XU);class E0e{getKeyboardNavigationLabel(e){return e.name}}class x0e{getWidgetAriaLabel(){return h(2964,"Breadcrumbs")}getAriaLabel(e){return e.name}}let ZU=class{constructor(e,t){this._workspaceService=e,this._cachedExpressions=new Map,this._disposables=new U;const i=eo.FileExcludes.bindTo(t),n=()=>{e.getWorkspace().folders.forEach(o=>{const r=i.getValue({resource:o.uri});if(!r)return;const a={};for(const c in r){if(typeof r[c]!="boolean")continue;const d=c.indexOf("**/")!==0?Zc.join(o.uri.path,c):c;a[d]=r[c]}this._cachedExpressions.set(o.uri.toString(),Um(a))})};n(),this._disposables.add(i),this._disposables.add(i.onDidChange(n)),this._disposables.add(e.onDidChangeWorkspaceFolders(n))}dispose(){this._disposables.dispose()}filter(e,t){if(ng(e))return!0;const i=this._workspaceService.getWorkspaceFolder(e.resource);return!i||!this._cachedExpressions.has(i.uri.toString())?!0:!this._cachedExpressions.get(i.uri.toString())(qM(i.uri.path,e.resource.path),je(e.resource))}};ZU=f([p(0,Tt),p(1,ne)],ZU);let I0e=class{compare(e,t){return ng(e)&&ng(t)?e.index-t.index:e.isDirectory===t.isDirectory?R_e(e.name,t.name):e.isDirectory?-1:1}},JU=class extends $P{constructor(e,t,i,n,o,r,a){super(e,t,i,n,o),this._workspaceService=r,this._editorService=a}_createTree(e){this._treeContainer.classList.add("file-icon-themable-tree"),this._treeContainer.classList.add("show-file-icons");const t=n=>{this._treeContainer.classList.toggle("align-icons-and-twisties",n.hasFileIcons&&!n.hasFolderIcons),this._treeContainer.classList.toggle("hide-arrows",n.hidesExplorerArrows===!0)};this._disposables.add(this._themeService.onDidFileIconThemeChange(t)),t(this._themeService.getFileIconTheme());const i=this._instantiationService.createInstance(vd,AO);return this._disposables.add(i),this._instantiationService.createInstance(dq,"BreadcrumbsFilePicker",e,new S0e,[this._instantiationService.createInstance(XU,i)],this._instantiationService.createInstance(QU),{multipleSelectionSupport:!1,sorter:new I0e,filter:this._instantiationService.createInstance(ZU),identityProvider:new C0e,keyboardNavigationLabelProvider:new E0e,accessibilityProvider:this._instantiationService.createInstance(x0e),showNotFoundMessage:!1,overrideStyles:{listBackground:Dne}})}async _setInput(e){const{uri:t,kind:i}=e;let n;i===Hi.ROOT_FOLDER?n=this._workspaceService.getWorkspace():n=hs(t);const o=this._tree;await o.setInput(n);let r;for(const{element:a}of o.getNode().children)if(ng(a)&&Dt(a.uri,t)){r=a;break}else if(Dt(a.resource,t)){r=a;break}r&&(o.reveal(r,.5),o.setFocus([r],this._fakeEvent)),o.domFocus()}_previewElement(e){return F.None}async _revealElement(e,t,i){return!ng(e)&&e.isFile?(this._onWillPickElement.fire(),await this._editorService.openEditor({resource:e.resource,options:t},i?xr:void 0),!0):!1}};JU=f([p(2,J),p(3,ft),p(4,ne),p(5,Tt),p(6,de)],JU);let e2=class{constructor(e,t,i){this.comparator=e,this._order=i.getValue(t,"breadcrumbs.symbolSortOrder")}compare(e,t){return this._order==="name"?this.comparator.compareByName(e,t):this._order==="type"?this.comparator.compareByType(e,t):this.comparator.compareByPosition(e,t)}};e2=f([p(2,Xo)],e2);class D0e extends $P{_createTree(e,t){const{config:i}=t.outline;return this._instantiationService.createInstance(Tne,"BreadcrumbsOutlinePicker",e,i.delegate,i.renderers,i.treeDataSource,{...i.options,sorter:this._instantiationService.createInstance(e2,i.comparator,void 0),collapseByDefault:!0,expandOnlyOnTwistieClick:!0,multipleSelectionSupport:!1,showNotFoundMessage:!1})}_setInput(e){const t=e.outline.captureViewState();this.restoreViewState=()=>{t.dispose()};const i=this._tree;return i.setInput(e.outline),e.element!==e.outline&&(i.reveal(e.element,.5),i.setFocus([e.element],this._fakeEvent)),i.domFocus(),Promise.resolve()}_previewElement(e){return this._tree.getInput().preview(e)}async _revealElement(e,t,i){return this._onWillPickElement.fire(),await this._tree.getInput().reveal(e,t,i,!1),!0}}var t2,i2,Hl;Be(lue);let GP=t2=class extends E4{constructor(e,t,i,n){super(),this.model=e,this.element=t,this.options=i,this._instantiationService=n,this._disposables=new U}dispose(){this._disposables.dispose()}equals(e){return e instanceof t2?this.element.element===e.element.element&&this.options.showFileIcons===e.options.showFileIcons&&this.options.showSymbolIcons===e.options.showSymbolIcons:!1}render(e){const{element:t,outline:i}=this.element;if(t===i){const a=Y("span",void 0,"…");e.appendChild(a);return}const n=i.config.delegate.getTemplateId(t),o=i.config.renderers.find(a=>a.templateId===n);if(!o){e.innerText="<<NO RENDERER>>";return}const r=o.renderTemplate(e);o.renderElement({element:t,children:[],depth:0,visibleChildrenCount:0,visibleChildIndex:0,collapsible:!1,collapsed:!1,visible:!0,filterData:void 0},0,r,void 0),this._disposables.add(Ee(()=>{o.disposeTemplate(r)})),t instanceof RA&&i.uri&&this._disposables.add(this._instantiationService.invokeFunction(a=>hue(a,e,t.symbol.name,{symbol:t.symbol,uri:i.uri},this.model,this.options.dragEditor)))}};GP=t2=f([p(3,J)],GP);let qP=i2=class extends E4{constructor(e,t,i,n,o,r){super(),this.model=e,this.element=t,this.options=i,this._labels=n,this._hoverDelegate=o,this._instantiationService=r,this._disposables=new U}dispose(){this._disposables.dispose()}equals(e){return e instanceof i2?vE.isEqual(this.element.uri,e.element.uri)&&this.options.showFileIcons===e.options.showFileIcons&&this.options.showSymbolIcons===e.options.showSymbolIcons:!1}render(e){const t=this._labels.create(e,{hoverDelegate:this._hoverDelegate});t.setFile(this.element.uri,{hidePath:!0,hideIcon:this.element.kind===Hi.FOLDER||!this.options.showFileIcons,fileKind:this.element.kind,fileDecorations:{colors:this.options.showDecorationColors,badges:!1}}),e.classList.add(Hi[this.element.kind].toLowerCase()),this._disposables.add(t),this._disposables.add(this._instantiationService.invokeFunction(i=>hue(i,e,je(this.element.uri),this.element.uri,this.model,this.options.dragEditor)))}};qP=i2=f([p(5,J)],qP);function hue(s,e,t,i,n,o){const r=s.get(J);return e.draggable=!0,new Hp(e,{onDragStart:a=>{a.dataTransfer&&(a.dataTransfer.effectAllowed="copyMove",r.invokeFunction(c=>{R.isUri(i)?pg(c,[i],a):(pg(c,[{resource:i.uri,selection:i.symbol.range}],a),sde([{name:i.symbol.name,fsPath:i.uri.fsPath,range:i.symbol.range,kind:i.symbol.kind}],a)),o&&n.editor&&n.editor?.input&&Wu.getInstance().setData([new Pc({editor:n.editor.input,groupId:n.editor.group.id})],Pc.prototype)}),ZM(a,e,t))}})}const k0e=Ae("breadcrumb-separator",j.chevronRight,h(2953,"Icon for the separator in the breadcrumbs."));let In=class{static{Hl=this}static{this.HEIGHT=22}static{this.SCROLLBAR_SIZES={default:3,large:8}}static{this.Payload_Reveal={}}static{this.Payload_RevealAside={}}static{this.Payload_Pick={}}static{this.CK_BreadcrumbsPossible=new O("breadcrumbsPossible",!1,h(2954,"Whether the editor can show breadcrumbs"))}static{this.CK_BreadcrumbsVisible=new O("breadcrumbsVisible",!1,h(2955,"Whether breadcrumbs are currently visible"))}static{this.CK_BreadcrumbsActive=new O("breadcrumbsActive",!1,h(2956,"Whether breadcrumbs have focus"))}get onDidVisibilityChange(){return this._onDidVisibilityChange.event}constructor(e,t,i,n,o,r,a,c,d,l,u,g){this._options=t,this._editorGroup=i,this._contextKeyService=n,this._contextViewService=o,this._instantiationService=r,this._quickInputService=a,this._fileService=c,this._editorService=d,this._labelService=l,this._disposables=new U,this._breadcrumbsDisposables=new U,this._model=new kt,this._breadcrumbsPickerShowing=!1,this._onDidVisibilityChange=this._disposables.add(new M),this.domNode=document.createElement("div"),this.domNode.classList.add("breadcrumbs-control"),ee(e,this.domNode),this._cfUseQuickPick=eo.UseQuickPick.bindTo(u),this._cfShowIcons=eo.Icons.bindTo(u),this._cfTitleScrollbarSizing=eo.TitleScrollbarSizing.bindTo(u),this._labels=this._instantiationService.createInstance(vd,AO);const m=this._cfTitleScrollbarSizing.getValue()??"default",v=t.widgetStyles??Ane;this._widget=new w0e(this.domNode,Hl.SCROLLBAR_SIZES[m],k0e,v),this._widget.onDidSelectItem(this._onSelectEvent,this,this._disposables),this._widget.onDidFocusItem(this._onFocusEvent,this,this._disposables),this._widget.onDidChangeFocus(this._updateCkBreadcrumbsActive,this,this._disposables),this._ckBreadcrumbsPossible=Hl.CK_BreadcrumbsPossible.bindTo(this._contextKeyService),this._ckBreadcrumbsVisible=Hl.CK_BreadcrumbsVisible.bindTo(this._contextKeyService),this._ckBreadcrumbsActive=Hl.CK_BreadcrumbsActive.bindTo(this._contextKeyService),this._hoverDelegate=yr("mouse"),this._disposables.add(g.register(this._editorGroup.id,this._widget)),this.hide()}dispose(){this._disposables.dispose(),this._breadcrumbsDisposables.dispose(),this._model.dispose(),this._ckBreadcrumbsPossible.reset(),this._ckBreadcrumbsVisible.reset(),this._ckBreadcrumbsActive.reset(),this._cfUseQuickPick.dispose(),this._cfShowIcons.dispose(),this._widget.dispose(),this._labels.dispose(),this.domNode.remove()}get model(){return this._model.value}layout(e){this._widget.layout(e)}isHidden(){return this.domNode.classList.contains("hidden")}hide(){const e=this.isHidden();this._breadcrumbsDisposables.clear(),this._ckBreadcrumbsVisible.set(!1),this.domNode.classList.toggle("hidden",!0),e||this._onDidVisibilityChange.fire()}show(){const e=this.isHidden();this._ckBreadcrumbsVisible.set(!0),this.domNode.classList.toggle("hidden",!1),e&&this._onDidVisibilityChange.fire()}revealLast(){this._widget.revealLast()}update(){this._breadcrumbsDisposables.clear();const e=xi.getCanonicalUri(this._editorGroup.activeEditor,{supportSideBySide:Ut.PRIMARY}),t=this.isHidden();if(!e||!this._fileService.hasProvider(e))return this._ckBreadcrumbsPossible.set(!1),t?!1:(this.hide(),!0);const i=xi.getOriginalUri(this._editorGroup.activeEditor,{supportSideBySide:Ut.PRIMARY});this.show(),this._ckBreadcrumbsPossible.set(!0);const n=this._instantiationService.createInstance(YU,i??e,this._editorGroup.activeEditorPane);this._model.value=n,this.domNode.classList.toggle("backslash-path",this._labelService.getSeparator(e.scheme,e.authority)==="\\");const o=()=>{this.domNode.classList.toggle("relative-path",n.isRelative());const l=this._cfShowIcons.getValue(),u={...this._options,showFileIcons:this._options.showFileIcons&&l,showSymbolIcons:this._options.showSymbolIcons&&l},g=n.getElements().map(m=>m instanceof UP?this._instantiationService.createInstance(qP,n,m,u,this._labels,this._hoverDelegate):this._instantiationService.createInstance(GP,n,m,u));g.length===0?(this._widget.setEnabled(!1),this._widget.setItems([new class extends E4{render(m){m.innerText=h(2957,"no elements")}equals(m){return m===this}dispose(){}}])):(this._widget.setEnabled(!0),this._widget.setItems(g),this._widget.reveal(g[g.length-1]))},r=n.onDidUpdate(o),a=this._cfShowIcons.onDidChange(o);o(),this._breadcrumbsDisposables.clear(),this._breadcrumbsDisposables.add(r),this._breadcrumbsDisposables.add(Ee(()=>this._model.clear())),this._breadcrumbsDisposables.add(a),this._breadcrumbsDisposables.add(Ee(()=>this._widget.setItems([])));const c=()=>{const l=this._cfTitleScrollbarSizing.getValue()??"default";this._widget.setHorizontalScrollbarSize(Hl.SCROLLBAR_SIZES[l])};c();const d=this._cfTitleScrollbarSizing.onDidChange(c);return this._breadcrumbsDisposables.add(d),this._breadcrumbsDisposables.add({dispose:()=>{this._breadcrumbsPickerShowing&&this._contextViewService.hideContextView({source:this})}}),t!==this.isHidden()}_onFocusEvent(e){e.item&&this._breadcrumbsPickerShowing&&(this._breadcrumbsPickerIgnoreOnceItem=void 0,this._widget.setSelection(e.item))}_onSelectEvent(e){if(!e.item)return;if(e.item===this._breadcrumbsPickerIgnoreOnceItem){this._breadcrumbsPickerIgnoreOnceItem=void 0,this._widget.setFocused(void 0),this._widget.setSelection(void 0);return}const{element:t}=e.item;this._editorGroup.focus();const i=this._getEditorGroup(e.payload);if(i!==void 0){this._widget.setFocused(void 0),this._widget.setSelection(void 0),this._revealInEditor(e,t,i);return}if(this._cfUseQuickPick.getValue()){this._widget.setFocused(void 0),this._widget.setSelection(void 0),this._quickInputService.quickAccess.show(t instanceof jU?"@":"");return}let n,o;this._contextViewService.showContextView({render:r=>{e.item instanceof qP?n=this._instantiationService.createInstance(JU,r,e.item.model.resource):e.item instanceof GP&&(n=this._instantiationService.createInstance(D0e,r,e.item.model.resource));const a=n.onWillPickElement(()=>this._contextViewService.hideContextView({source:this,didPick:!0})),c=Ise.getInstance(bt(this.domNode)).onDidChange(()=>this._contextViewService.hideContextView({source:this})),d=Po(r),l=d.onDidBlur(()=>{this._breadcrumbsPickerIgnoreOnceItem=this._widget.isDOMFocused()?e.item:void 0,this._contextViewService.hideContextView({source:this})});return this._breadcrumbsPickerShowing=!0,this._updateCkBreadcrumbsActive(),Lo(n,a,c,d,l)},getAnchor:()=>{if(!o){const r=bt(this.domNode),a=r.innerWidth-8;let c=Math.min(r.innerHeight*.7,300);const d=Math.min(a,Math.max(240,a/4.17)),l=8;let u;const g=Ms(e.node.firstChild),m=g.top+g.height+l;m+c>=r.innerHeight&&(c=r.innerHeight-m-30);let v=g.left;if(v+d>=a&&(v=a-d),e.payload instanceof us){const y=d-2*l;u=e.payload.posx-v,u>y&&(v=Math.min(a-d,v+u-y),u=y)}else u=g.left+g.width*.3-v;n.show(t,c,d,l,Math.max(0,u)),o={x:v,y:m}}return o},onHide:r=>{r?.didPick||n.restoreViewState(),this._breadcrumbsPickerShowing=!1,this._updateCkBreadcrumbsActive(),r?.source===this&&(this._widget.setFocused(void 0),this._widget.setSelection(void 0)),n.dispose()}})}_updateCkBreadcrumbsActive(){const e=this._widget.isDOMFocused()||this._breadcrumbsPickerShowing;this._ckBreadcrumbsActive.set(e)}async _revealInEditor(e,t,i,n=!1){if(t instanceof UP)if(t.kind===Hi.FILE)await this._editorService.openEditor({resource:t.uri,options:{pinned:n}},i);else{const o=this._widget.getItems(),r=o.indexOf(e.item);this._widget.setFocused(o[r+1]),this._widget.setSelection(o[r+1],Hl.Payload_Pick)}else t.outline.reveal(t,{pinned:n},i===xr,!1)}_getEditorGroup(e){return e===Hl.Payload_RevealAside?xr:e===Hl.Payload_Reveal?cl:void 0}};In=Hl=f([p(3,me),p(4,cf),p(5,J),p(6,zt),p(7,Xe),p(8,de),p(9,di),p(10,ne),p(11,Uh)],In);let zP=class{get control(){return this._control}get onDidEnablementChange(){return this._onDidEnablementChange.event}get onDidVisibilityChange(){return this._onDidVisibilityChange.event}constructor(e,t,i,n,o,r){this._container=e,this._editorGroup=t,this._options=i,this._instantiationService=o,this._disposables=new U,this._controlDisposables=new U,this._onDidEnablementChange=this._disposables.add(new M),this._onDidVisibilityChange=this._disposables.add(new M);const a=this._disposables.add(eo.IsEnabled.bindTo(n));this._disposables.add(a.onDidChange(()=>{const c=a.getValue();!c&&this._control?(this._controlDisposables.clear(),this._control=void 0,this._onDidEnablementChange.fire()):c&&!this._control&&(this._control=this.createControl(),this._control.update(),this._onDidEnablementChange.fire())})),a.getValue()&&(this._control=this.createControl()),this._disposables.add(r.onDidChangeFileSystemProviderRegistrations(c=>{this._control?.model&&this._control.model.resource.scheme!==c.scheme||this._control?.update()&&this._onDidEnablementChange.fire()}))}createControl(){const e=this._controlDisposables.add(this._instantiationService.createInstance(In,this._container,this._options,this._editorGroup));return this._controlDisposables.add(e.onDidVisibilityChange(()=>this._onDidVisibilityChange.fire())),e}dispose(){this._disposables.dispose(),this._controlDisposables.dispose()}};zP=f([p(3,ne),p(4,J),p(5,Xe)],zP);K(class extends X{constructor(){super({id:"breadcrumbs.toggle",title:{...I(2958,"Toggle Breadcrumbs"),mnemonicTitle:h(2959,"Toggle &&Breadcrumbs")},category:te.View,toggled:{condition:x.equals("config.breadcrumbs.enabled",!0),title:h(2960,"Toggle Breadcrumbs"),mnemonicTitle:h(2961,"Toggle &&Breadcrumbs")},menu:[{id:N.CommandPalette},{id:N.MenubarAppearanceMenu,group:"4_editor",order:2},{id:N.NotebookToolbar,group:"notebookLayout",order:2},{id:N.StickyScrollContext},{id:N.NotebookStickyScrollContext,group:"notebookView",order:2},{id:N.NotebookToolbarContext,group:"notebookView",order:2}]})}run(e){const t=e.get(ne),i=eo.IsEnabled.bindTo(t).getValue();eo.IsEnabled.bindTo(t).updateValue(!i)}});function x4(s,e){const t=s.get(Ie),n=s.get(Uh).getWidget(t.activeGroup.id);if(n){const o=n.getItems().at(-1);n.setFocused(o),e&&n.setSelection(o,In.Payload_Pick)}}K(class extends X{constructor(){super({id:"breadcrumbs.focusAndSelect",title:I(2962,"Focus and Select Breadcrumbs"),precondition:In.CK_BreadcrumbsVisible,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Period,when:In.CK_BreadcrumbsPossible},f1:!0})}run(e,...t){x4(e,!0)}});K(class extends X{constructor(){super({id:"breadcrumbs.focus",title:I(2963,"Focus Breadcrumbs"),precondition:In.CK_BreadcrumbsVisible,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Semicolon,when:In.CK_BreadcrumbsPossible},f1:!0})}run(e,...t){x4(e,!1)}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.toggleToOn",weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Period,when:x.not("config.breadcrumbs.enabled"),handler:async s=>{const e=s.get(J),t=s.get(ne),i=eo.IsEnabled.bindTo(t);return i.getValue()||(await i.updateValue(!0),await Ia(50)),e.invokeFunction(x4,!0)}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.focusNext",weight:W.WorkbenchContrib,primary:S.RightArrow,secondary:[E.CtrlCmd|S.RightArrow],mac:{primary:S.RightArrow,secondary:[E.Alt|S.RightArrow]},when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive),handler(s){const e=s.get(Ie),i=s.get(Uh).getWidget(e.activeGroup.id);i&&i.focusNext()}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.focusPrevious",weight:W.WorkbenchContrib,primary:S.LeftArrow,secondary:[E.CtrlCmd|S.LeftArrow],mac:{primary:S.LeftArrow,secondary:[E.Alt|S.LeftArrow]},when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive),handler(s){const e=s.get(Ie),i=s.get(Uh).getWidget(e.activeGroup.id);i&&i.focusPrev()}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.focusNextWithPicker",weight:W.WorkbenchContrib+1,primary:E.CtrlCmd|S.RightArrow,mac:{primary:E.Alt|S.RightArrow},when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive,af),handler(s){const e=s.get(Ie),i=s.get(Uh).getWidget(e.activeGroup.id);i&&i.focusNext()}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.focusPreviousWithPicker",weight:W.WorkbenchContrib+1,primary:E.CtrlCmd|S.LeftArrow,mac:{primary:E.Alt|S.LeftArrow},when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive,af),handler(s){const e=s.get(Ie),i=s.get(Uh).getWidget(e.activeGroup.id);i&&i.focusPrev()}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.selectFocused",weight:W.WorkbenchContrib,primary:S.Enter,secondary:[S.DownArrow],when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive),handler(s){const e=s.get(Ie),i=s.get(Uh).getWidget(e.activeGroup.id);i&&i.setSelection(i.getFocused(),In.Payload_Pick)}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.revealFocused",weight:W.WorkbenchContrib,primary:S.Space,secondary:[E.CtrlCmd|S.Enter],when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive),handler(s){const e=s.get(Ie),i=s.get(Uh).getWidget(e.activeGroup.id);i&&i.setSelection(i.getFocused(),In.Payload_Reveal)}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.selectEditor",weight:W.WorkbenchContrib+1,primary:S.Escape,when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive),handler(s){const e=s.get(Ie),i=s.get(Uh).getWidget(e.activeGroup.id);i&&(i.setFocused(void 0),i.setSelection(void 0),e.activeGroup.activeEditorPane?.focus())}});Le.registerCommandAndKeybindingRule({id:"breadcrumbs.revealFocusedFromTreeAside",weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Enter,when:x.and(In.CK_BreadcrumbsVisible,In.CK_BreadcrumbsActive,af),handler(s){const e=s.get(de),i=s.get(Si).lastFocusedList;if(!(i instanceof Tne)&&!(i instanceof dq))return;const n=i.getFocus()[0];if(R.isUri(n?.resource))return e.openEditor({resource:n.resource,options:{pinned:!0}},xr);const o=i.getInput();if(o&&typeof o.outlineKind=="string")return o.reveal(n,{pinned:!0,preserveFocus:!1},!0,!1)}});const T0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),A0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var aT;Be(A0e);class uue extends _g{constructor(e){super(),this.context=e}run(e,t){let i=this.context;return t?.preserveFocus&&(i={...this.context,preserveFocus:!0}),super.run(e,i)}}let Dx=class extends pw{static{aT=this}static{this.EDITOR_TAB_HEIGHT={normal:35,compact:22}}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(g),this.parent=e,this.editorPartsView=t,this.groupsView=i,this.groupView=n,this.tabsModel=o,this.contextMenuService=r,this.instantiationService=a,this.contextKeyService=c,this.keybindingService=d,this.notificationService=l,this.quickInputService=u,this.editorResolverService=m,this.hostService=v,this.editorTransfer=Wu.getInstance(),this.groupTransfer=Wu.getInstance(),this.treeItemsTransfer=Wu.getInstance(),this.editorActionsToolbarDisposables=this._register(new U),this.editorActionsDisposables=this._register(new U),this.renderDropdownAsChildElement=!1;const y=this.create(e);this.contextMenuContextKeyService=this._register(this.contextKeyService.createScoped(y));const w=this._register(this.instantiationService.createChild(new pf([me,this.contextMenuContextKeyService])));this.resourceContext=this._register(w.createInstance(pi)),this.editorPinnedContext=Jse.bindTo(this.contextMenuContextKeyService),this.editorIsFirstContext=eoe.bindTo(this.contextMenuContextKeyService),this.editorIsLastContext=toe.bindTo(this.contextMenuContextKeyService),this.editorStickyContext=rA.bindTo(this.contextMenuContextKeyService),this.editorAvailableEditorIds=fI.bindTo(this.contextMenuContextKeyService),this.editorCanSplitInGroupContext=yC.bindTo(this.contextMenuContextKeyService),this.sideBySideEditorContext=Cu.bindTo(this.contextMenuContextKeyService),this.groupLockedContext=oA.bindTo(this.contextMenuContextKeyService)}create(e){return this.updateTabHeight(),e}get editorActionsEnabled(){return this.groupsView.partOptions.editorActionsLocation==="default"&&this.groupsView.partOptions.showTabs!=="none"}createEditorActionsToolBar(e,t){this.editorActionsToolbarContainer=Y("div"),this.editorActionsToolbarContainer.classList.add(...t),e.appendChild(this.editorActionsToolbarContainer),this.handleEditorActionToolBarVisibility(this.editorActionsToolbarContainer)}handleEditorActionToolBarVisibility(e){const t=this.editorActionsEnabled,i=!!this.editorActionsToolbar;t&&!i?this.doCreateEditorActionsToolBar(e):!t&&i&&(this.editorActionsToolbar?.getElement().remove(),this.editorActionsToolbar=void 0,this.editorActionsToolbarDisposables.clear(),this.editorActionsDisposables.clear()),e.classList.toggle("hidden",!t)}doCreateEditorActionsToolBar(e){const t={groupId:this.groupView.id};this.editorActionsToolbar=this.editorActionsToolbarDisposables.add(this.instantiationService.createInstance(zq,e,{actionViewItemProvider:(i,n)=>this.actionViewItemProvider(i,n),orientation:xa.HORIZONTAL,ariaLabel:h(3345,"Editor actions"),getKeyBinding:i=>this.getKeybinding(i),actionRunner:this.editorActionsToolbarDisposables.add(new uue(t)),anchorAlignmentProvider:()=>kb.RIGHT,renderDropdownAsChildElement:this.renderDropdownAsChildElement,telemetrySource:"editorPart",resetMenu:N.EditorTitle,overflowBehavior:{maxItems:9,exempted:QOe},highlightToggledItems:!0})),this.editorActionsToolbar.context=t,this.editorActionsToolbarDisposables.add(this.editorActionsToolbar.actionRunner.onDidRun(i=>{i.error&&!gs(i.error)&&this.notificationService.error(i.error)}))}actionViewItemProvider(e,t){const i=this.groupView.activeEditorPane;if(i instanceof Hu){const n=i.getActionViewItem(e,t);if(n)return n}return dw(this.instantiationService,e,{...t,menuAsChild:this.renderDropdownAsChildElement})}updateEditorActionsToolbar(){if(!this.editorActionsEnabled)return;this.editorActionsDisposables.clear();const e=this.groupView.createEditorActions(this.editorActionsDisposables);this.editorActionsDisposables.add(e.onDidChange(()=>this.updateEditorActionsToolbar()));const t=Gt(this.editorActionsToolbar),{primary:i,secondary:n}=this.prepareEditorActions(e.actions);t.setActions(QT(i),QT(n))}getEditorPaneAwareContextKeyService(){return this.groupView.activeEditorPane?.scopedContextKeyService??this.contextKeyService}clearEditorActionsToolbar(){if(!this.editorActionsEnabled)return;Gt(this.editorActionsToolbar).setActions([],[])}onGroupDragStart(e,t){if(e.target!==t)return!1;const i=this.isNewWindowOperation(e);this.groupTransfer.setData([new mu(this.groupView.id)],mu.prototype),e.dataTransfer&&(e.dataTransfer.effectAllowed="copyMove");let n=!1;if(this.groupsView.partOptions.showTabs==="multiple"?n=this.doFillResourceDataTransfers(this.groupView.getEditors(Ai.SEQUENTIAL),e,i):this.groupView.activeEditor&&(n=this.doFillResourceDataTransfers([this.groupView.activeEditor],e,i)),!n&&XM&&e.dataTransfer?.setData(bs.TEXT,String(this.groupView.label)),this.groupView.activeEditor){let o=this.groupView.activeEditor.getName();this.groupsView.partOptions.showTabs==="multiple"&&this.groupView.count>1&&(o=h(3346,"{0} (+{1})",o,this.groupView.count-1)),ZM(e,t,o)}return i}async onGroupDragEnd(e,t,i,n){if(this.groupTransfer.clearData(mu.prototype),e.target!==i||!n||sue())return;const o=await this.maybeCreateAuxiliaryEditorPartAt(e,i);if(!o)return;const r=o.activeGroup;this.groupsView.mergeGroup(this.groupView,r.id,{mode:this.isMoveOperation(t??e,r.id)?ME.MOVE_EDITORS:ME.COPY_EDITORS}),r.focus()}async maybeCreateAuxiliaryEditorPartAt(e,t){const{point:i,display:n}=await this.hostService.getCursorScreenPoint()??{point:{x:e.screenX,y:e.screenY}},o=Vp();if(o.document.visibilityState==="visible"&&o.document.hasFocus()&&i.x>=o.screenX&&i.x<=o.screenX+o.outerWidth&&i.y>=o.screenY&&i.y<=o.screenY+o.outerHeight)return;const r=t.offsetWidth/2,a=30+t.offsetHeight/2,c={x:i.x-r,y:i.y-a};return n&&(c.x<n.x&&(c.x=n.x),c.y<n.y&&(c.y=n.y)),this.editorPartsView.createAuxiliaryEditorPart({bounds:c})}isNewWindowOperation(e){return this.groupsView.partOptions.dragToOpenWindow?!e.altKey:e.altKey}isMoveOperation(e,t,i){return i?.hasCapability(Ze.Singleton)?!0:!(e.ctrlKey&&!qt||e.altKey&&qt)||t===this.groupView.id}doFillResourceDataTransfers(e,t,i){return e.length?(this.instantiationService.invokeFunction(pg,e.map(n=>({editor:n,groupId:this.groupView.id})),t,{disableStandardTransfer:i}),!0):!1}onTabContextMenu(e,t,i){this.resourceContext.set(xi.getOriginalUri(e,{supportSideBySide:Ut.PRIMARY})),this.editorPinnedContext.set(this.tabsModel.isPinned(e)),this.editorIsFirstContext.set(this.tabsModel.isFirst(e)),this.editorIsLastContext.set(this.tabsModel.isLast(e)),this.editorStickyContext.set(this.tabsModel.isSticky(e)),this.groupLockedContext.set(this.tabsModel.isLocked),this.editorCanSplitInGroupContext.set(e.hasCapability(Ze.CanSplitInGroup)),this.sideBySideEditorContext.set(e.typeId===ws.ID),ioe(this.editorAvailableEditorIds,e,this.editorResolverService);let n=i;hp(t)&&(n=new us(bt(i),t)),this.contextMenuService.showContextMenu({getAnchor:()=>n,menuId:N.EditorTitleContext,menuActionOptions:{shouldForwardArgs:!0,arg:this.resourceContext.get()},contextKeyService:this.contextMenuContextKeyService,getActionsContext:()=>({groupId:this.groupView.id,editorIndex:this.groupView.getIndexOfEditor(e)}),getKeyBinding:o=>this.keybindingService.lookupKeybinding(o.id,this.contextMenuContextKeyService),onHide:()=>this.groupsView.activeGroup.focus()})}getKeybinding(e){return this.keybindingService.lookupKeybinding(e.id,this.getEditorPaneAwareContextKeyService())}getKeybindingLabel(e){const t=this.getKeybinding(e);return t?t.getLabel()??void 0:void 0}get tabHeight(){return this.groupsView.partOptions.tabHeight!=="compact"?aT.EDITOR_TAB_HEIGHT.normal:aT.EDITOR_TAB_HEIGHT.compact}getHoverTitle(e){const t=e.getTitle(Nt.LONG);return this.tabsModel.isPinned(e)?t:{markdown:new Ni("",{supportThemeIcons:!0,isTrusted:!0}).appendText(t).appendMarkdown(' (_preview_ [$(gear)](command:workbench.action.openSettings?%5B%22workbench.editor.enablePreview%22%5D "Configure Preview Mode"))'),markdownNotSupportedFallback:t+" (preview)"}}updateTabHeight(){this.parent.style.setProperty("--editor-group-tab-height",`${this.tabHeight}px`)}updateOptions(e,t){e.tabHeight!==t.tabHeight&&this.updateTabHeight(),(e.editorActionsLocation!==t.editorActionsLocation||e.showTabs!==t.showTabs)&&this.editorActionsToolbarContainer&&(this.handleEditorActionToolBarVisibility(this.editorActionsToolbarContainer),this.updateEditorActionsToolbar())}};Dx=aT=f([p(5,mi),p(6,J),p(7,me),p(8,Ve),p(9,At),p(10,zt),p(11,ft),p(12,vf),p(13,Wn)],Dx);class gue extends F{constructor(e){super(),this.model=e,this._onDidModelChange=this._register(new M),this.onDidModelChange=this._onDidModelChange.event,this._register(this.model.onDidModelChange(t=>{const i=t.editorIndex??t.editor;i!==void 0&&!this.filter(i)||this._onDidModelChange.fire(t)}))}get id(){return this.model.id}get isLocked(){return this.model.isLocked}get stickyCount(){return this.model.stickyCount}get activeEditor(){return this.model.activeEditor&&this.filter(this.model.activeEditor)?this.model.activeEditor:null}get previewEditor(){return this.model.previewEditor&&this.filter(this.model.previewEditor)?this.model.previewEditor:null}get selectedEditors(){return this.model.selectedEditors.filter(e=>this.filter(e))}isPinned(e){return this.model.isPinned(e)}isTransient(e){return this.model.isTransient(e)}isSticky(e){return this.model.isSticky(e)}isActive(e){return this.model.isActive(e)}isSelected(e){return this.model.isSelected(e)}isFirst(e){return this.model.isFirst(e,this.getEditors(Ai.SEQUENTIAL))}isLast(e){return this.model.isLast(e,this.getEditors(Ai.SEQUENTIAL))}getEditors(e,t){return this.model.getEditors(e,t).filter(n=>this.filter(n))}findEditor(e,t){const i=this.model.findEditor(e,t);if(i)return this.filter(i[1])?i:void 0}}class pue extends gue{get count(){return this.model.stickyCount}getEditors(e,t){return t?.excludeSticky?[]:e===Ai.SEQUENTIAL?this.model.getEditors(Ai.SEQUENTIAL).slice(0,this.model.stickyCount):super.getEditors(e,t)}isSticky(e){return!0}getEditorByIndex(e){return e<this.count?this.model.getEditorByIndex(e):void 0}indexOf(e,t,i){const n=this.model.indexOf(e,t,i);return n<0||n>=this.model.stickyCount?-1:n}contains(e,t){const i=this.model.indexOf(e,void 0,t);return i>=0&&i<this.model.stickyCount}filter(e){return this.model.isSticky(e)}}class fue extends gue{get count(){return this.model.count-this.model.stickyCount}get stickyCount(){return 0}isSticky(e){return!1}getEditors(e,t){return e===Ai.SEQUENTIAL?this.model.getEditors(Ai.SEQUENTIAL).slice(this.model.stickyCount):super.getEditors(e,t)}getEditorByIndex(e){return e>=0?this.model.getEditorByIndex(e+this.model.stickyCount):void 0}indexOf(e,t,i){const n=this.model.indexOf(e,t,i);return n<this.model.stickyCount||n>=this.model.count?-1:n-this.model.stickyCount}contains(e,t){const i=this.model.indexOf(e,void 0,t);return i>=this.model.stickyCount&&i<this.model.count}filter(e){return!this.model.isSticky(e)}}var Wa;Be(T0e);let kx=class extends Dx{static{Wa=this}static{this.SCROLLBAR_SIZES={default:3,large:10}}static{this.TAB_WIDTH={compact:38,shrink:80,fit:120}}static{this.DRAG_OVER_OPEN_TAB_THRESHOLD=1500}static{this.MOUSE_WHEEL_EVENT_THRESHOLD=150}static{this.MOUSE_WHEEL_DISTANCE_THRESHOLD=1.5}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C){super(e,t,i,n,o,r,a,c,d,l,u,g,w,C),this.editorService=m,this.pathService=v,this.treeViewsDragAndDropService=y,this.closeEditorAction=this._register(this.instantiationService.createInstance(zC,zC.ID,zC.LABEL)),this.unpinEditorAction=this._register(this.instantiationService.createInstance(Ap,Ap.ID,Ap.LABEL)),this.tabResourceLabels=this._register(this.instantiationService.createInstance(vd,AO)),this.tabLabels=[],this.tabActionBars=[],this.tabDisposables=[],this.dimensions={container:Ke.None,available:Ke.None},this.layoutScheduler=this._register(new kt),this.path=pn?P_e:Zc,this.lastMouseWheelEventTime=0,this.isMouseOverTabs=!1,this.updateEditorLabelScheduler=this._register(new fn(()=>this.doUpdateEditorLabels(),0)),(async()=>this.path=await this.pathService.path)(),this._register(this.tabResourceLabels.onDidChangeDecorations(()=>this.doHandleDecorationsChange()))}create(e){return super.create(e),this.titleContainer=e,this.tabsAndActionsContainer=Y(".tabs-and-actions-container"),this.titleContainer.appendChild(this.tabsAndActionsContainer),this.tabsContainer=Y(".tabs-container",{role:"tablist",draggable:!0}),this._register(Th.addTarget(this.tabsContainer)),this.tabSizingFixedDisposables=this._register(new U),this.updateTabSizing(!1),this.tabsScrollbar=this.createTabsScrollbar(this.tabsContainer),this.tabsAndActionsContainer.appendChild(this.tabsScrollbar.getDomNode()),this.registerTabsContainerListeners(this.tabsContainer,this.tabsScrollbar),this.createEditorActionsToolBar(this.tabsAndActionsContainer,["editor-actions"]),this.updateTabsControlVisibility(),this.tabsAndActionsContainer}createTabsScrollbar(e){const t=this._register(new Rne(e,{horizontal:dd.Auto,horizontalScrollbarSize:this.getTabsScrollbarSizing(),vertical:dd.Hidden,scrollYToX:!0,useShadows:!1}));return this._register(t.onScroll(i=>{i.scrollLeftChanged&&(e.scrollLeft=i.scrollLeft)})),t}updateTabsScrollbarSizing(){this.tabsScrollbar?.updateOptions({horizontalScrollbarSize:this.getTabsScrollbarSizing()})}updateTabSizing(e){const[t,i]=rm(this.tabsContainer,this.tabSizingFixedDisposables);i.clear();const n=this.groupsView.partOptions;n.tabSizing==="fixed"?(t.style.setProperty("--tab-sizing-fixed-min-width",`${n.tabSizingFixedMinWidth}px`),t.style.setProperty("--tab-sizing-fixed-max-width",`${n.tabSizingFixedMaxWidth}px`),i.add(re(t,pe.MOUSE_ENTER,()=>{this.isMouseOverTabs=!0})),i.add(re(t,pe.MOUSE_LEAVE,()=>{this.isMouseOverTabs=!1,this.updateTabsFixedWidth(!1)}))):e&&(t.style.removeProperty("--tab-sizing-fixed-min-width"),t.style.removeProperty("--tab-sizing-fixed-max-width"),this.updateTabsFixedWidth(!1))}updateTabsFixedWidth(e){this.forEachTab((t,i,n)=>{if(e){const{width:o}=n.getBoundingClientRect();n.style.setProperty("--tab-sizing-current-width",`${o}px`)}else n.style.removeProperty("--tab-sizing-current-width")})}getTabsScrollbarSizing(){return this.groupsView.partOptions.titleScrollbarSizing!=="large"?Wa.SCROLLBAR_SIZES.default:Wa.SCROLLBAR_SIZES.large}registerTabsContainerListeners(e,t){this._register(re(e,pe.SCROLL,()=>{e.classList.contains("scroll")&&t.setScrollPosition({scrollLeft:e.scrollLeft})}));for(const r of[Vo.Tap,pe.DBLCLICK])this._register(re(e,r,a=>{if(r===pe.DBLCLICK){if(a.target!==e)return}else if(a.tapCount!==2||a.initialTarget!==e)return;Li.stop(a),this.editorService.openEditor({resource:void 0,options:{pinned:!0,index:this.groupView.count,override:od.id}},this.groupView.id)}));this._register(re(e,pe.MOUSE_DOWN,r=>{r.button===1&&r.preventDefault()})),vh&&this._register(re(e,pe.MOUSE_UP,r=>{r.button===1&&r.preventDefault()}));let i,n=!1;this._register(new Hp(e,{onDragStart:r=>{n=this.onGroupDragStart(r,e)},onDrag:r=>{i=r},onDragEnter:r=>{if(e.classList.add("scroll"),r.target===e){if(!this.isSupportedDropTransfer(r)){r.dataTransfer&&(r.dataTransfer.dropEffect="none");return}this.editorTransfer.hasData(Pc.prototype)||r.dataTransfer&&(r.dataTransfer.dropEffect="copy"),this.updateDropFeedback(e,!0,r)}},onDragLeave:r=>{this.updateDropFeedback(e,!1,r),e.classList.remove("scroll")},onDragEnd:r=>{this.updateDropFeedback(e,!1,r),e.classList.remove("scroll"),this.onGroupDragEnd(r,i,e,n)},onDrop:r=>{if(this.updateDropFeedback(e,!1,r),e.classList.remove("scroll"),r.target===e){const a=this.groupTransfer.hasData(mu.prototype);this.onDrop(r,a?this.groupView.count:this.tabsModel.count,e)}}})),this._register(re(e,pe.MOUSE_WHEEL,r=>{const a=this.groupView.activeEditor;if(!a||this.groupView.count<2)return;if(this.groupsView.partOptions.scrollToSwitchTabs===!0){if(r.shiftKey)return}else if(!r.shiftKey)return;const c=Date.now();if(c-this.lastMouseWheelEventTime<Wa.MOUSE_WHEEL_EVENT_THRESHOLD-2*(Math.abs(r.deltaX)+Math.abs(r.deltaY)))return;this.lastMouseWheelEventTime=c;let d;if(r.deltaX+r.deltaY<-Wa.MOUSE_WHEEL_DISTANCE_THRESHOLD)d=-1;else if(r.deltaX+r.deltaY>Wa.MOUSE_WHEEL_DISTANCE_THRESHOLD)d=1;else return;const l=this.groupView.getEditorByIndex(this.groupView.getIndexOfEditor(a)+d);l&&(this.groupView.openEditor(l),Li.stop(r,!0))}));const o=r=>{Li.stop(r);let a=e;hp(r)&&(a=new us(bt(this.parent),r)),this.contextMenuService.showContextMenu({getAnchor:()=>a,menuId:N.EditorTabsBarContext,contextKeyService:this.contextKeyService,menuActionOptions:{shouldForwardArgs:!0},getActionsContext:()=>({groupId:this.groupView.id}),getKeyBinding:c=>this.getKeybinding(c),onHide:()=>this.groupView.focus()})};this._register(re(e,Vo.Contextmenu,r=>o(r))),this._register(re(e,pe.CONTEXT_MENU,r=>o(r)))}doHandleDecorationsChange(){this.layout(this.dimensions)}updateEditorActionsToolbar(){super.updateEditorActionsToolbar(),this.layout(this.dimensions)}openEditor(e,t){const i=this.handleOpenedEditors();return t?.focusTabControl&&this.withTab(e,(n,o,r)=>r.focus()),i}openEditors(e){return this.handleOpenedEditors()}handleOpenedEditors(){this.updateTabsControlVisibility();const[e,t]=rm(this.tabsContainer,this.tabsScrollbar);for(let r=e.children.length;r<this.tabsModel.count;r++)e.appendChild(this.createTab(r,e,t));const i=this.didActiveEditorChange(),n=this.tabLabels;this.computeTabLabels();let o=!1;return i||n.length!==this.tabLabels.length||n.some((r,a)=>!this.equalsEditorInputLabel(r,this.tabLabels.at(a)))?(this.redraw({forceRevealActiveTab:!0}),o=!0):this.layout(this.dimensions,{forceRevealActiveTab:!0}),o}didActiveEditorChange(){return!!(!this.activeTabLabel?.editor&&this.tabsModel.activeEditor||this.activeTabLabel?.editor&&!this.tabsModel.activeEditor||!this.activeTabLabel?.editor||!this.tabsModel.isActive(this.activeTabLabel.editor))}equalsEditorInputLabel(e,t){return e===t?!0:!e||!t?!1:e.name===t.name&&e.description===t.description&&e.forceDescription===t.forceDescription&&e.title===t.title&&e.ariaLabel===t.ariaLabel}beforeCloseEditor(e){if(this.isMouseOverTabs&&this.groupsView.partOptions.tabSizing==="fixed"){const t=this.tabsModel.isLast(e);this.updateTabsFixedWidth(!t)}}closeEditor(e){this.handleClosedEditors()}closeEditors(e){this.handleClosedEditors()}handleClosedEditors(){if(this.tabsModel.count){const e=Gt(this.tabsContainer);for(;e.children.length>this.tabsModel.count;)e.lastChild?.remove(),Qe(this.tabDisposables.pop());this.computeTabLabels(),this.redraw({forceRevealActiveTab:!0})}else this.tabsContainer&&Yi(this.tabsContainer),this.tabDisposables=Qe(this.tabDisposables),this.tabResourceLabels.clear(),this.tabLabels=[],this.activeTabLabel=void 0,this.tabActionBars=[],this.clearEditorActionsToolbar(),this.updateTabsControlVisibility()}moveEditor(e,t,i){const n=this.tabLabels[t];this.tabLabels.splice(t,1),this.tabLabels.splice(i,0,n),this.forEachTab((o,r,a,c,d,l)=>{this.redrawTab(o,r,a,c,d,l)},Math.min(t,i),Math.max(t,i)),this.layout(this.dimensions,{forceRevealActiveTab:!0})}pinEditor(e){this.withTab(e,(t,i,n,o,r)=>this.redrawTabLabel(t,i,n,o,r))}stickEditor(e){this.doHandleStickyEditorChange(e)}unstickEditor(e){this.doHandleStickyEditorChange(e)}doHandleStickyEditorChange(e){this.withTab(e,(t,i,n,o,r,a)=>this.redrawTab(t,i,n,o,r,a)),this.forEachTab((t,i,n,o,r)=>{this.redrawTabBorders(i,n)}),this.layout(this.dimensions,{forceRevealActiveTab:!0})}setActive(e){this.forEachTab((t,i,n,o,r,a)=>{this.redrawTabSelectedActiveAndDirty(e,t,n,a)}),this.updateEditorActionsToolbar(),this.layout(this.dimensions,{forceRevealActiveTab:!0})}updateEditorSelections(){this.forEachTab((e,t,i,n,o,r)=>{this.redrawTabSelectedActiveAndDirty(this.groupsView.activeGroup===this.groupView,e,i,r)})}updateEditorLabel(e){this.updateEditorLabelScheduler.schedule()}doUpdateEditorLabels(){this.computeTabLabels(),this.forEachTab((e,t,i,n,o)=>{this.redrawTabLabel(e,t,i,n,o)}),this.layout(this.dimensions)}updateEditorDirty(e){this.withTab(e,(t,i,n,o,r,a)=>this.redrawTabSelectedActiveAndDirty(this.groupsView.activeGroup===this.groupView,t,n,a))}updateOptions(e,t){super.updateOptions(e,t),e.labelFormat!==t.labelFormat&&this.computeTabLabels(),e.titleScrollbarSizing!==t.titleScrollbarSizing&&this.updateTabsScrollbarSizing(),e.alwaysShowEditorActions!==t.alwaysShowEditorActions&&this.updateEditorActionsToolbar(),(e.tabSizingFixedMinWidth!==t.tabSizingFixedMinWidth||e.tabSizingFixedMaxWidth!==t.tabSizingFixedMaxWidth||e.tabSizing!==t.tabSizing)&&this.updateTabSizing(!0),(e.labelFormat!==t.labelFormat||e.tabActionLocation!==t.tabActionLocation||e.tabActionCloseVisibility!==t.tabActionCloseVisibility||e.tabActionUnpinVisibility!==t.tabActionUnpinVisibility||e.tabSizing!==t.tabSizing||e.pinnedTabSizing!==t.pinnedTabSizing||e.showIcons!==t.showIcons||e.hasIcons!==t.hasIcons||e.highlightModifiedTabs!==t.highlightModifiedTabs||e.wrapTabs!==t.wrapTabs||!ma(e.decorations,t.decorations))&&this.redraw()}updateStyles(){this.redraw()}forEachTab(e,t,i){this.tabsModel.getEditors(Ai.SEQUENTIAL).forEach((n,o)=>{typeof t=="number"&&t>o||typeof i=="number"&&i<o||this.doWithTab(o,n,e)})}withTab(e,t){this.doWithTab(this.tabsModel.indexOf(e),e,t)}doWithTab(e,t,i){const o=Gt(this.tabsContainer).children[e],r=this.tabResourceLabels.get(e),a=this.tabLabels[e],c=this.tabActionBars[e];o&&r&&a&&i(t,e,o,r,a,c)}createTab(e,t,i){const n=Y(".tab",{draggable:!0,role:"tab"});this._register(Th.addTarget(n));const o=Y(".tab-border-top-container");n.appendChild(o);const r=this.tabResourceLabels.create(n,{hoverTargetOverride:n}),a=Y(".tab-actions");n.appendChild(a);const c=this,d=new uue({groupId:this.groupView.id,get editorIndex(){return c.toEditorIndex(e)}}),l=new Er(a,{ariaLabel:h(3347,"Tab actions"),actionRunner:d}),u=l.onWillRun(w=>{w.action.id===this.closeEditorAction.id&&this.blockRevealActiveTabOnce()}),g=Lo(d,l,u,Ee(L_e(this.tabActionBars,l))),m=Y(".tab-fade-hider");n.appendChild(m);const v=Y(".tab-border-bottom-container");n.appendChild(v);const y=this.registerTabListeners(n,e,t,i);return this.tabDisposables.push(Lo(y,g,d,r)),n}toEditorIndex(e){const t=Gt(this.tabsModel.getEditorByIndex(e));return this.groupView.getIndexOfEditor(t)}registerTabListeners(e,t,i,n){const o=new U,r=async(l,u)=>{if(e.blur(),hp(l)&&(l.button!==0||qt&&l.ctrlKey)){l.button===1&&l.preventDefault();return}if(this.originatesFromTabActionBar(l))return;const g=this.tabsModel.getEditorByIndex(t);if(g)if(l.shiftKey){let m;if(this.lastSingleSelectSelectedEditor&&this.tabsModel.isSelected(this.lastSingleSelectSelectedEditor))m=this.lastSingleSelectSelectedEditor;else{const v=Gt(this.groupView.activeEditor);this.lastSingleSelectSelectedEditor=v,m=v}await this.selectEditorsBetween(g,m)}else if(l.ctrlKey&&!qt||l.metaKey&&qt)this.tabsModel.isSelected(g)?await this.unselectEditor(g):(await this.selectEditor(g),this.lastSingleSelectSelectedEditor=g);else{const m=this.tabsModel.isSelected(g)?this.groupView.selectedEditors.filter(v=>!v.matches(g)):[];await this.groupView.openEditor(g,{preserveFocus:u,activation:Yc.ACTIVATE},{inactiveSelection:m,focusTabControl:!0})}},a=l=>{Li.stop(l);const u=this.tabsModel.getEditorByIndex(t);u&&this.onTabContextMenu(u,l,e)};o.add(re(e,pe.MOUSE_DOWN,l=>r(l,!1))),o.add(re(e,Vo.Tap,l=>r(l,!0))),o.add(re(e,Vo.Change,l=>{n.setScrollPosition({scrollLeft:n.getScrollPosition().scrollLeft-l.translationX})})),o.add(re(e,pe.MOUSE_UP,async l=>{if(Li.stop(l),e.blur(),hp(l)&&(l.button!==0||qt&&l.ctrlKey)||this.originatesFromTabActionBar(l))return;!(l.ctrlKey&&!qt||l.metaKey&&qt)&&!l.shiftKey&&this.groupView.selectedEditors.length>1&&await this.unselectAllEditors()})),o.add(re(e,pe.AUXCLICK,l=>{if(l.button===1){Li.stop(l,!0);const u=this.tabsModel.getEditorByIndex(t);if(u){if(iz(this.tabsModel,u,nz.MOUSE,this.groupsView.partOptions))return;this.blockRevealActiveTabOnce(),this.closeEditorAction.run({groupId:this.groupView.id,editorIndex:this.groupView.getIndexOfEditor(u)})}}})),o.add(re(e,pe.KEY_DOWN,l=>{const u=new zs(l);u.shiftKey&&u.keyCode===S.F10&&a(l)})),o.add(re(e,Vo.Contextmenu,l=>{a(l)})),o.add(re(e,pe.KEY_UP,l=>{const u=new zs(l);let g=!1;if(u.equals(S.Enter)||u.equals(S.Space)){g=!0;const m=this.tabsModel.getEditorByIndex(t);m&&this.groupView.openEditor(m)}else if([S.LeftArrow,S.RightArrow,S.UpArrow,S.DownArrow,S.Home,S.End].some(m=>u.equals(m))){let m=this.toEditorIndex(t);u.equals(S.LeftArrow)||u.equals(S.UpArrow)?m=m-1:u.equals(S.RightArrow)||u.equals(S.DownArrow)?m=m+1:u.equals(S.Home)?m=0:m=this.groupView.count-1;const v=this.groupView.getEditorByIndex(m);v&&(g=!0,this.groupView.openEditor(v,{preserveFocus:!0},{focusTabControl:!0}))}g&&Li.stop(l,!0),n.setScrollPosition({scrollLeft:i.scrollLeft})}));for(const l of[Vo.Tap,pe.DBLCLICK])o.add(re(e,l,u=>{if(l===pe.DBLCLICK)Li.stop(u);else if(u.tapCount!==2)return;const g=this.tabsModel.getEditorByIndex(t);if(g&&this.tabsModel.isPinned(g))switch(this.groupsView.partOptions.doubleClickTabToToggleEditorGroupSizes){case"maximize":this.groupsView.toggleMaximizeGroup(this.groupView);break;case"expand":this.groupsView.toggleExpandGroup(this.groupView);break}else this.groupView.pinEditor(g)}));o.add(re(e,pe.CONTEXT_MENU,l=>{Li.stop(l,!0);const u=this.tabsModel.getEditorByIndex(t);u&&this.onTabContextMenu(u,l,e)},!0));let c,d=!1;return o.add(new Hp(e,{onDragStart:l=>{const u=this.tabsModel.getEditorByIndex(t);if(!u)return;d=this.isNewWindowOperation(l);const g=this.groupView.selectedEditors;if(this.editorTransfer.setData(g.map(m=>new Pc({editor:m,groupId:this.groupView.id})),Pc.prototype),l.dataTransfer)if(l.dataTransfer.effectAllowed="copyMove",g.length>1){const m=`${u.getName()} + ${g.length-1}`;ZM(l,e,m)}else l.dataTransfer.setDragImage(e,0,0);this.doFillResourceDataTransfers(g,l,d),kE(bt(this.parent),()=>this.updateDropFeedback(e,!1,l,t))},onDrag:l=>{c=l},onDragEnter:l=>{if(!this.isSupportedDropTransfer(l)){l.dataTransfer&&(l.dataTransfer.dropEffect="none");return}this.editorTransfer.hasData(Pc.prototype)||l.dataTransfer&&(l.dataTransfer.dropEffect="copy"),this.updateDropFeedback(e,!0,l,t)},onDragOver:(l,u)=>{if(u>=Wa.DRAG_OVER_OPEN_TAB_THRESHOLD){const g=this.tabsModel.getEditorByIndex(t);g&&this.tabsModel.activeEditor!==g&&this.groupView.openEditor(g,{preserveFocus:!0})}this.updateDropFeedback(e,!0,l,t)},onDragEnd:async l=>{this.updateDropFeedback(e,!1,l,t);const u=this.editorTransfer.getData(Pc.prototype);if(this.editorTransfer.clearData(Pc.prototype),!d||sue()||!u||u.length===0)return;const g=await this.maybeCreateAuxiliaryEditorPartAt(l,e);if(!g)return;const m=g.activeGroup,v=bz(this.groupView,u.map(y=>y.identifier.editor));this.isMoveOperation(c??l,m.id,u[0].identifier.editor)?this.groupView.moveEditors(v,m):this.groupView.copyEditors(v,m),m.focus()},onDrop:l=>{this.updateDropFeedback(e,!1,l,t);let u=t;this.getTabDragOverLocation(l,e)==="right"&&u++,this.onDrop(l,u,i)}})),o}isSupportedDropTransfer(e){if(this.groupTransfer.hasData(mu.prototype)){const t=this.groupTransfer.getData(mu.prototype);return!(Array.isArray(t)&&t.length>0&&t[0].identifier===this.groupView.id)}return!!(this.editorTransfer.hasData(Pc.prototype)||e.dataTransfer&&e.dataTransfer.types.length>0)}updateDropFeedback(e,t,i,n){const o=typeof n=="number";let r;t?o?r=this.computeDropTarget(i,n,e):r={leftElement:e.lastElementChild,rightElement:void 0}:r=void 0,this.updateDropTarget(r)}updateDropTarget(e){const t=this.dropTarget;if(t===e||t&&e&&t.leftElement===e.leftElement&&t.rightElement===e.rightElement)return;const i="drop-target-left",n="drop-target-right";t&&(t.leftElement?.classList.remove(i),t.rightElement?.classList.remove(n)),e&&(e.leftElement?.classList.add(i),e.rightElement?.classList.add(n)),this.dropTarget=e}getTabDragOverLocation(e,t){const i=t.getBoundingClientRect();return e.clientX-i.left<=i.width/2?"left":"right"}computeDropTarget(e,t,i){const n=this.getTabDragOverLocation(e,i)==="left",o=t===this.tabsModel.count-1;if(n&&t===0)return{leftElement:void 0,rightElement:i};if(!n&&o)return{leftElement:i,rightElement:void 0};const a=n?i.previousElementSibling:i,c=n?i:i.nextElementSibling;return{leftElement:a,rightElement:c}}async selectEditor(e){this.groupView.isActive(e)||await this.groupView.setSelection(e,this.groupView.selectedEditors)}async selectEditorsBetween(e,t){const i=this.groupView.getIndexOfEditor(e);if(i===-1)throw new ln;const n=this.groupView.getIndexOfEditor(t);if(n===-1)throw new ln;let o=this.groupView.selectedEditors,r=n;for(;r>=0&&r<=this.groupView.count-1;){r=n<i?r-1:r+1;const u=this.groupView.getEditorByIndex(r);if(!u||!this.groupView.isSelected(u))break;o=o.filter(g=>!g.matches(u))}const a=n<i?n:i,c=n<i?i:n,d=this.groupView.getEditors(Ai.SEQUENTIAL).slice(a,c+1);for(const u of d)this.groupView.isSelected(u)||o.push(u);const l=o.filter(u=>!u.matches(e));await this.groupView.setSelection(e,l)}async unselectEditor(e){const t=this.groupView.isActive(e);if(t&&this.groupView.selectedEditors.length===1)return;let i=Gt(this.groupView.activeEditor);if(t){const o=this.groupView.getEditors(Ai.MOST_RECENTLY_ACTIVE);for(let r=1;r<o.length;r++){const a=o[r];if(this.groupView.isSelected(a)){i=a;break}}}const n=this.groupView.selectedEditors.filter(o=>!o.matches(e)&&!o.matches(i));await this.groupView.setSelection(i,n)}async unselectAllEditors(){if(this.groupView.selectedEditors.length>1){const e=Gt(this.groupView.activeEditor);await this.groupView.setSelection(e,[])}}computeTabLabels(){const{labelFormat:e}=this.groupsView.partOptions,{verbosity:t,shortenDuplicates:i}=this.getLabelConfigFlags(e),n=[];let o=-1;this.tabsModel.getEditors(Ai.SEQUENTIAL).forEach((r,a)=>{n.push({editor:r,name:r.getName(),description:r.getDescription(t),forceDescription:r.hasCapability(Ze.ForceDescription),title:r.getTitle(Nt.LONG),ariaLabel:p4(r,a,this.groupView,this.editorPartsView.count)}),r===this.tabsModel.activeEditor&&(o=a)}),i&&this.shortenTabLabels(n),this.tabLabels=n,this.activeTabLabel=n[o]}shortenTabLabels(e){const t=new Map;for(const i of e)typeof i.description=="string"?Sk(t,i.name,[]).push(i):i.description="";for(const[,i]of t){if(i.length===1&&!i[0].forceDescription){i[0].description="";continue}const n=new Map;for(const c of i)Sk(n,c.description,[]).push(c);let o=!1;for(const[,c]of n)if(!o&&c.length>1){const[d,...l]=c.map(({editor:u})=>u.getDescription(Nt.LONG));o=l.some(u=>u!==d)}if(o){n.clear();for(const c of i)c.description=c.editor.getDescription(Nt.LONG),Sk(n,c.description,[]).push(c)}const r=[];for(const[c]of n)r.push(c);if(r.length===1){for(const c of n.get(r[0])||[])c.forceDescription||(c.description="");continue}const a=yne(r,this.path.sep);r.forEach((c,d)=>{for(const l of n.get(c)||[])l.description=a[d]})}}getLabelConfigFlags(e){switch(e){case"short":return{verbosity:Nt.SHORT,shortenDuplicates:!1};case"medium":return{verbosity:Nt.MEDIUM,shortenDuplicates:!1};case"long":return{verbosity:Nt.LONG,shortenDuplicates:!1};default:return{verbosity:Nt.MEDIUM,shortenDuplicates:!0}}}redraw(e){if(this.tabsAndActionsContainer){let t=this.getColor(Cxe);!t&&sy(this.theme.type)&&(t=this.getColor(YW)||this.getColor(et)),t?(this.tabsAndActionsContainer.classList.add("tabs-border-bottom"),this.tabsAndActionsContainer.style.setProperty("--tabs-border-bottom-color",t.toString())):(this.tabsAndActionsContainer.classList.remove("tabs-border-bottom"),this.tabsAndActionsContainer.style.removeProperty("--tabs-border-bottom-color"))}this.forEachTab((t,i,n,o,r,a)=>{this.redrawTab(t,i,n,o,r,a)}),this.updateEditorActionsToolbar(),this.layout(this.dimensions,e)}redrawTab(e,t,i,n,o,r){const a=this.tabsModel.isSticky(t),c=this.groupsView.partOptions;this.redrawTabLabel(e,t,i,n,o);const d=a&&c.tabActionUnpinVisibility,l=!d&&c.tabActionCloseVisibility,u=d||l;let g;u?g=d?this.unpinEditorAction:this.closeEditorAction:g=a?this.unpinEditorAction:this.closeEditorAction,r.hasAction(g)||(r.isEmpty()||r.clear(),r.push(g,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(g)})),i.classList.toggle("pinned-action-off",a&&!d),i.classList.toggle("close-action-off",!d&&!l);for(const v of["left","right"])i.classList.toggle(`tab-actions-${v}`,u&&c.tabActionLocation===v);const m=a&&c.pinnedTabSizing==="shrink"?"shrink":c.tabSizing;for(const v of["fit","shrink","fixed"])i.classList.toggle(`sizing-${v}`,m===v);i.classList.toggle("has-icon",c.showIcons&&c.hasIcons),i.classList.toggle("sticky",a);for(const v of["normal","compact","shrink"])i.classList.toggle(`sticky-${v}`,a&&c.pinnedTabSizing===v);if(!c.wrapTabs&&a&&c.pinnedTabSizing!=="normal"){let v=0;switch(c.pinnedTabSizing){case"compact":v=Wa.TAB_WIDTH.compact;break;case"shrink":v=Wa.TAB_WIDTH.shrink;break}i.style.left=`${t*v}px`}else i.style.left="auto";this.redrawTabBorders(t,i),this.redrawTabSelectedActiveAndDirty(this.groupsView.activeGroup===this.groupView,e,i,r)}redrawTabLabel(e,t,i,n,o){const r=this.groupsView.partOptions;let a,c=!1,d=!!r.decorations?.badges;const l=!!r.decorations?.colors;let u;r.pinnedTabSizing==="compact"&&this.tabsModel.isSticky(t)?(a=r.showIcons&&r.hasIcons?"":o.name?.charAt(0).toUpperCase(),u="",c=!0,d=!1):(a=o.name,u=o.description||""),o.ariaLabel&&(i.setAttribute("aria-label",o.ariaLabel),i.setAttribute("aria-description","")),n.setResource({name:a,description:u,resource:xi.getOriginalUri(e,{supportSideBySide:Ut.BOTH})},{title:this.getHoverTitle(e),extraClasses:Vt(["tab-label",d?"tab-label-has-badge":void 0].concat(e.getLabelExtraClasses())),italic:!this.tabsModel.isPinned(e),forceLabel:c,fileDecorations:{colors:l,badges:d},icon:e.getIcon(),hideIcon:r.showIcons===!1});const g=xi.getOriginalUri(e,{supportSideBySide:Ut.PRIMARY});g?i.setAttribute("data-resource-name",el(g)):i.removeAttribute("data-resource-name")}redrawTabSelectedActiveAndDirty(e,t,i,n){const o=this.tabsModel.isActive(t),r=this.doRedrawTabDirty(e,o,t,i);this.doRedrawTabActive(e,!r,t,i,n)}doRedrawTabActive(e,t,i,n,o){const r=this.tabsModel.isActive(i),a=this.tabsModel.isSelected(i);if(n.classList.toggle("active",r),n.classList.toggle("selected",a),n.setAttribute("aria-selected",r?"true":"false"),n.tabIndex=r?0:-1,o.setFocusable(r),r){const d=this.getColor(e?DA:mxe);n.classList.toggle("tab-border-bottom",!!d),n.style.setProperty("--tab-border-bottom-color",d??"")}let c=null;t&&(r&&(c=this.getColor(e?kA:vxe)),c===null&&a&&(c=this.getColor(_xe))),n.classList.toggle("tab-border-top",!!c),n.style.setProperty("--tab-border-top-color",c??"")}doRedrawTabDirty(e,t,i,n){let o=!1;if(i.isDirty()&&!i.isSaving())if(n.classList.add("dirty"),this.groupsView.partOptions.highlightModifiedTabs){let r;e&&t?r=this.getColor(VE):e&&!t?r=this.getColor(XW):!e&&t?r=this.getColor(yxe):r=this.getColor(wxe),r&&(o=!0,n.classList.add("dirty-border-top"),n.style.setProperty("--tab-dirty-border-top-color",r))}else n.classList.remove("dirty-border-top"),n.style.removeProperty("--tab-dirty-border-top-color");else n.classList.remove("dirty","dirty-border-top"),n.style.removeProperty("--tab-dirty-border-top-color");return o}redrawTabBorders(e,t){const n=this.tabsModel.isSticky(e)&&this.tabsModel.stickyCount===e+1,o=this.tabsModel.stickyCount!==this.tabsModel.count,r=(n&&o?this.getColor(fxe):void 0)||this.getColor(YW)||this.getColor(et);t.style.borderRight=r?`1px solid ${r}`:"",t.style.outlineColor=this.getColor(Sr)||""}prepareEditorActions(e){return this.groupsView.activeGroup===this.groupView?e:{primary:this.groupsView.partOptions.alwaysShowEditorActions?e.primary:e.primary.filter(i=>i.id===jO),secondary:e.secondary}}getHeight(){return this.dimensions.used?this.dimensions.used.height:this.computeHeight()}computeHeight(){let e;return this.visible?this.groupsView.partOptions.wrapTabs&&this.tabsAndActionsContainer?.classList.contains("wrapping")?e=this.tabsAndActionsContainer.offsetHeight:e=this.tabHeight:e=0,e}layout(e,t){if(Object.assign(this.dimensions,e),this.visible){if(!this.layoutScheduler.value){const i=kE(bt(this.parent),()=>{this.doLayout(this.dimensions,this.layoutScheduler.value?.options),this.layoutScheduler.clear()});this.layoutScheduler.value={options:t,dispose:()=>i.dispose()}}t?.forceRevealActiveTab&&(this.layoutScheduler.value.options={...this.layoutScheduler.value.options,forceRevealActiveTab:!0})}return this.dimensions.used||(this.dimensions.used=new Ke(e.container.width,this.computeHeight())),this.dimensions.used}doLayout(e,t){e.container!==Ke.None&&e.available!==Ke.None&&this.doLayoutTabs(e,t);const i=this.dimensions.used,n=this.dimensions.used=new Ke(e.container.width,this.computeHeight());i&&i.height!==n.height&&this.groupView.relayout()}doLayoutTabs(e,t){this.doLayoutTabsWrapping(e)||this.doLayoutTabsNonWrapping(t)}doLayoutTabsWrapping(e){const[t,i,n,o]=rm(this.tabsAndActionsContainer,this.tabsContainer,this.editorActionsToolbarContainer,this.tabsScrollbar),r=t.classList.contains("wrapping");let a=r;function c(d){a=d,t.classList.toggle("wrapping",a),i.style.setProperty("--last-tab-margin-right",a?`${n.offsetWidth}px`:"0");for(const l of i.children)l.classList.remove("last-in-row")}if(this.groupsView.partOptions.wrapTabs){const d=i.offsetWidth,l=i.scrollWidth,u=()=>{const g=this.getLastTab();return g?!(g.offsetWidth+n.offsetWidth-e.available.width>1):!0};(a||l>d&&u())&&c(!0),a&&(i.offsetHeight>e.available.height||l===d&&i.offsetHeight===this.tabHeight||!u())&&c(!1)}else r&&c(!1);if(a&&!r){const d=i.offsetWidth;o.setScrollDimensions({width:d,scrollWidth:d})}if(a){const d=new Map;let l,u;for(const g of i.children){const m=g,v=m.offsetTop;v!==l&&(l=v,u&&d.set(u,!0)),u=m,d.set(m,!1)}u&&d.set(u,!0);for(const[g,m]of d)g.classList.toggle("last-in-row",m)}return a}doLayoutTabsNonWrapping(e){const[t,i]=rm(this.tabsContainer,this.tabsScrollbar),n=t.offsetWidth,o=t.scrollWidth;let r=0;if(this.tabsModel.stickyCount>0){let A=0;switch(this.groupsView.partOptions.pinnedTabSizing){case"compact":A=Wa.TAB_WIDTH.compact;break;case"shrink":A=Wa.TAB_WIDTH.shrink;break}r=this.tabsModel.stickyCount*A}const a=this.tabsModel.activeEditor?this.getTabAndIndex(this.tabsModel.activeEditor):void 0,[c,d]=a??[void 0,void 0];let l=this.groupsView.partOptions.pinnedTabSizing!=="normal"&&typeof d=="number"&&this.tabsModel.isSticky(d),u=n-r;this.tabsModel.stickyCount>0&&u<Wa.TAB_WIDTH.fit?(t.classList.add("disable-sticky-tabs"),u=n,r=0,l=!1):t.classList.remove("disable-sticky-tabs");let g,m;!this.blockRevealActiveTab&&c&&(g=c.offsetLeft,m=c.offsetWidth);const{width:v,scrollWidth:y}=i.getScrollDimensions();i.setScrollDimensions({width:n,scrollWidth:o});const w=v!==n||y!==o;if(this.blockRevealActiveTab||typeof g!="number"||typeof m!="number"||l||!w&&!e?.forceRevealActiveTab){this.blockRevealActiveTab=!1;return}const C=i.getScrollPosition().scrollLeft,T=m<=u,k=g-r;T&&C+u<k+m?i.setScrollPosition({scrollLeft:C+(k+m-(C+u))}):(C>k||!T)&&i.setScrollPosition({scrollLeft:k})}updateTabsControlVisibility(){Gt(this.tabsAndActionsContainer).classList.toggle("empty",!this.visible),!this.visible&&this.dimensions&&(this.dimensions.used=void 0)}get visible(){return this.tabsModel.count>0}getTabAndIndex(e){const t=this.tabsModel.indexOf(e),i=this.getTabAtIndex(t);if(i)return[i,t]}getTabAtIndex(e){if(e>=0)return Gt(this.tabsContainer).children[e]}getLastTab(){return this.getTabAtIndex(this.tabsModel.count-1)}blockRevealActiveTabOnce(){this.blockRevealActiveTab=!0}originatesFromTabActionBar(e){let t;return hp(e)?t=e.target||e.srcElement:t=e.initialTarget,!!LF(t,"action-item","tab")}async onDrop(e,t,i){Li.stop(e,!0),this.updateDropFeedback(i,!1,e,t),i.classList.remove("scroll");let n=this.tabsModel instanceof fue?t+this.groupView.stickyCount:t;const o={sticky:this.tabsModel instanceof pue&&this.tabsModel.stickyCount===n,index:n};if(this.groupTransfer.hasData(mu.prototype)){const r=this.groupTransfer.getData(mu.prototype);if(Array.isArray(r)&&r.length>0){const a=this.editorPartsView.getGroup(r[0].identifier);if(a){const c={index:n};this.isMoveOperation(e,a.id)||(c.mode=ME.COPY_EDITORS),this.groupsView.mergeGroup(a,this.groupView,c)}this.groupView.focus(),this.groupTransfer.clearData(mu.prototype)}}else if(this.editorTransfer.hasData(Pc.prototype)){const r=this.editorTransfer.getData(Pc.prototype);if(Array.isArray(r)&&r.length>0){const a=this.editorPartsView.getGroup(r[0].identifier.groupId);if(a)for(const c of r){const d=c.identifier.editor;if(a.id!==c.identifier.groupId)continue;const l=a.getIndexOfEditor(d);a===this.groupView&&l<n&&n--,this.isMoveOperation(e,c.identifier.groupId,d)?a.moveEditor(d,this.groupView,{...o,index:n}):a.copyEditor(d,this.groupView,{...o,index:n}),n++}}this.groupView.focus(),this.editorTransfer.clearData(Pc.prototype)}else if(this.treeItemsTransfer.hasData(uC.prototype)){const r=this.treeItemsTransfer.getData(uC.prototype);if(Array.isArray(r)&&r.length>0){const a=[];for(const c of r){const d=await this.treeViewsDragAndDropService.removeDragOperationTransfer(c.identifier);if(d){const l=await $1e(d);a.push(...l.map(u=>({...u,options:{...u.options,pinned:!0,index:n}})))}}this.editorService.openEditors(a,this.groupView,{validateTrust:!0})}this.treeItemsTransfer.clearData(uC.prototype)}else this.instantiationService.createInstance(NP,{allowWorkspaceOpen:!1}).handleDrop(e,bt(this.parent),()=>this.groupView,()=>this.groupView.focus(),o)}dispose(){super.dispose(),this.tabDisposables=Qe(this.tabDisposables)}};kx=Wa=f([p(5,mi),p(6,J),p(7,me),p(8,Ve),p(9,At),p(10,zt),p(11,ft),p(12,de),p(13,_c),p(14,pq),p(15,vf),p(16,Wn)],kx);Pv((s,e)=>{const t=s.getColor(YW);t&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title > .tabs-and-actions-container.wrapping .tabs-container > .tab {
				border-bottom: 1px solid ${t};
			}
		`);const i=s.getColor(Sr);i&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab.active,
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab.active:hover  {
				outline: 1px solid;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.selected:not(.active):not(:hover)  {
				outline: 1px dotted;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab.active:focus {
				outline-style: dashed;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.active {
				outline: 1px dotted;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:hover  {
				outline: 1px dashed;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.active > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.active:hover > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.dirty > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.sticky > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:hover > .tab-actions .action-label {
				opacity: 1 !important;
			}
		`);const n=s.getColor(et);n&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .editor-actions {
				outline: 1px solid ${n}
			}
		`);const o=s.getColor(KW);o&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab:not(.selected):hover {
				background-color: ${o} !important;
			}
		`);const r=s.getColor(gxe);r&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:not(.selected):hover  {
				background-color: ${r} !important;
			}
		`);const a=s.getColor(jW);a&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab:not(.selected):hover  {
				color: ${a} !important;
			}
		`);const c=s.getColor(pxe);c&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:not(.selected):hover  {
				color: ${c} !important;
			}
		`);const d=s.getColor(QW);d&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab:hover > .tab-border-bottom-container {
				display: block;
				position: absolute;
				left: 0;
				pointer-events: none;
				width: 100%;
				z-index: 10;
				bottom: 0;
				height: 1px;
				background-color: ${d};
			}
		`);const l=s.getColor(bxe);if(l&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:hover > .tab-border-bottom-container  {
				display: block;
				position: absolute;
				left: 0;
				pointer-events: none;
				width: 100%;
				z-index: 10;
				bottom: 0;
				height: 1px;
				background-color: ${l};
			}
		`),!sy(s.type)&&!M_e&&!i){const u=dxe(s),g=s.getColor(ts),m=s.getColor(joe),v=s.getColor(TN);let y;m&&g&&(y=m.flatten(g,g,u));let w;m&&g&&v&&g&&(w=m.flatten(g,v,g,u));const C=(Q,ie,oe=!1)=>`
			.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-shrink:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after,
			.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-fixed:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after {
				background: linear-gradient(to left, ${Q}, transparent) !important;
			}

			.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-shrink:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after,
			.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-fixed:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after {
				background: linear-gradient(to left, ${ie}, transparent) !important;
			}
		`;if(o&&y&&w){const Q=o.flatten(y),ie=o.flatten(w);e.addRule(C(Q,ie,!0))}if(r&&y&&w){const Q=r.flatten(y),ie=r.flatten(w);e.addRule(C(Q,ie))}if(v&&w){const Q=v.flatten(w);e.addRule(`
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container.active > .title .tabs-container > .tab.sizing-shrink.dragged-over:not(.active):not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container:not(.active) > .title .tabs-container > .tab.sizing-shrink.dragged-over:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container.active > .title .tabs-container > .tab.sizing-fixed.dragged-over:not(.active):not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container:not(.active) > .title .tabs-container > .tab.sizing-fixed.dragged-over:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after {
					background: linear-gradient(to left, ${Q}, transparent) !important;
				}
		`)}const T=(Q,ie,oe,xe)=>`
				.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-shrink${xe?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-fixed${xe?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after {
					background: linear-gradient(to left, ${Q}, transparent);
				}

				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-shrink${xe?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-fixed${xe?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after {
					background: linear-gradient(to left, ${ie}, transparent);
				}
		`,k=s.getColor(pz);if(k&&y&&w){const Q=k.flatten(y),ie=k.flatten(w);e.addRule(T(Q,ie,!0,!0))}const A=s.getColor(lxe);if(A&&y&&w){const Q=A.flatten(y),ie=A.flatten(w);e.addRule(T(Q,ie,!1,!0))}const B=s.getColor(Koe);if(B&&y&&w){const Q=B.flatten(y),ie=B.flatten(w);e.addRule(T(Q,ie,!0,!1))}const z=s.getColor(hxe);if(z&&y&&w){const Q=z.flatten(y),ie=z.flatten(w);e.addRule(T(Q,ie,!1,!1))}}});const mue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(mue);class R0e extends Dx{constructor(){super(...arguments),this.activeLabel=Object.create(null)}get breadcrumbsControl(){return this.breadcrumbsControlFactory?.control}create(e){super.create(e);const t=this.titleContainer=e;t.draggable=!0,this.registerContainerListeners(t),this._register(Th.addTarget(t));const i=Y(".label-container");return t.appendChild(i),this.editorLabel=this._register(this.instantiationService.createInstance(EH,i,{})).element,this._register(re(this.editorLabel.element,pe.CLICK,n=>this.onTitleLabelClick(n))),this.breadcrumbsControlFactory=this._register(this.instantiationService.createInstance(zP,i,this.groupView,{showFileIcons:!1,showSymbolIcons:!0,showDecorationColors:!1,widgetStyles:{...Ane,breadcrumbsBackground:be.transparent.toString()},showPlaceholder:!1,dragEditor:!0})),this._register(this.breadcrumbsControlFactory.onDidEnablementChange(()=>this.handleBreadcrumbsEnablementChange())),t.classList.toggle("breadcrumbs",!!this.breadcrumbsControl),this._register(Ee(()=>t.classList.remove("breadcrumbs"))),this.createEditorActionsToolBar(t,["title-actions"]),t}registerContainerListeners(e){let t,i=!1;this._register(new Hp(e,{onDragStart:n=>{i=this.onGroupDragStart(n,e)},onDrag:n=>{t=n},onDragEnd:n=>{this.onGroupDragEnd(n,t,e,i)}})),this._register(re(e,pe.DBLCLICK,n=>this.onTitleDoubleClick(n))),this._register(re(e,pe.AUXCLICK,n=>this.onTitleAuxClick(n))),this._register(re(e,Vo.Tap,n=>this.onTitleTap(n)));for(const n of[pe.CONTEXT_MENU,Vo.Contextmenu])this._register(re(e,n,o=>{this.tabsModel.activeEditor&&this.onTabContextMenu(this.tabsModel.activeEditor,o,e)}))}onTitleLabelClick(e){Li.stop(e,!1),setTimeout(()=>this.quickInputService.quickAccess.show())}onTitleDoubleClick(e){Li.stop(e),this.groupView.pinEditor()}onTitleAuxClick(e){e.button===1&&this.tabsModel.activeEditor&&(Li.stop(e,!0),iz(this.tabsModel,this.tabsModel.activeEditor,nz.MOUSE,this.groupsView.partOptions)||this.groupView.closeEditor(this.tabsModel.activeEditor))}onTitleTap(e){const t=e.initialTarget;!Mh(t)||!this.editorLabel||!Ku(t,this.editorLabel.element)||setTimeout(()=>this.quickInputService.quickAccess.show(),50)}openEditor(e){return this.doHandleOpenEditor()}openEditors(e){return this.doHandleOpenEditor()}doHandleOpenEditor(){const e=this.ifActiveEditorChanged(()=>this.redraw());return e||this.ifActiveEditorPropertiesChanged(()=>this.redraw()),e}beforeCloseEditor(e){}closeEditor(e){this.ifActiveEditorChanged(()=>this.redraw())}closeEditors(e){this.ifActiveEditorChanged(()=>this.redraw())}moveEditor(e,t,i){this.ifActiveEditorChanged(()=>this.redraw())}pinEditor(e){this.ifEditorIsActive(e,()=>this.redraw())}stickEditor(e){}unstickEditor(e){}setActive(e){this.redraw()}updateEditorSelections(){}updateEditorLabel(e){this.ifEditorIsActive(e,()=>this.redraw())}updateEditorDirty(e){this.ifEditorIsActive(e,()=>{const t=Gt(this.titleContainer);e.isDirty()&&!e.isSaving()?t.classList.add("dirty"):t.classList.remove("dirty")})}updateOptions(e,t){super.updateOptions(e,t),(e.labelFormat!==t.labelFormat||!ma(e.decorations,t.decorations))&&this.redraw()}updateStyles(){this.redraw()}handleBreadcrumbsEnablementChange(){Gt(this.titleContainer).classList.toggle("breadcrumbs",!!this.breadcrumbsControl),this.redraw()}ifActiveEditorChanged(e){return!this.activeLabel.editor&&this.tabsModel.activeEditor||this.activeLabel.editor&&!this.tabsModel.activeEditor||!this.activeLabel.editor||!this.tabsModel.isActive(this.activeLabel.editor)?(e(),!0):!1}ifActiveEditorPropertiesChanged(e){!this.activeLabel.editor||!this.tabsModel.activeEditor||this.activeLabel.pinned!==this.tabsModel.isPinned(this.tabsModel.activeEditor)&&e()}ifEditorIsActive(e,t){this.tabsModel.isActive(e)&&t()}redraw(){const e=this.tabsModel.activeEditor??void 0,t=this.groupsView.partOptions,i=e?this.tabsModel.isPinned(e):!1,n=this.groupsView.activeGroup===this.groupView;this.activeLabel={editor:e,pinned:i},this.breadcrumbsControl&&(n?(this.breadcrumbsControl.update(),this.breadcrumbsControl.domNode.classList.toggle("preview",!i)):this.breadcrumbsControl.hide());const[o,r]=rm(this.titleContainer,this.editorLabel);if(!e)o.classList.remove("dirty"),r.clear(),this.clearEditorActionsToolbar();else{this.updateEditorDirty(e);const{labelFormat:a}=this.groupsView.partOptions;let c;this.breadcrumbsControl&&!this.breadcrumbsControl.isHidden()||a==="default"&&!n?c="":c=e.getDescription(this.getVerbosity(a))||"",r.setResource({resource:xi.getOriginalUri(e,{supportSideBySide:Ut.BOTH}),name:e.getName(),description:c},{title:this.getHoverTitle(e),italic:!i,extraClasses:["single-tab","title-label"].concat(e.getLabelExtraClasses()),fileDecorations:{colors:!!t.decorations?.colors,badges:!!t.decorations?.badges},icon:e.getIcon(),hideIcon:t.showIcons===!1}),n?o.style.color=this.getColor(Kp)||"":o.style.color=this.getColor(uxe)||"",this.updateEditorActionsToolbar()}}getVerbosity(e){switch(e){case"short":return Nt.SHORT;case"long":return Nt.LONG;default:return Nt.MEDIUM}}prepareEditorActions(e){return this.groupsView.activeGroup===this.groupView?e:{primary:this.groupsView.partOptions.alwaysShowEditorActions?e.primary:e.primary.filter(i=>i.id===iS||i.id===jO),secondary:e.secondary}}getHeight(){return this.tabHeight}layout(e){return this.breadcrumbsControl?.layout(void 0),new Ke(e.container.width,this.getHeight())}}let n2=class extends F{constructor(e,t,i,n,o,r){super(),this.parent=e,this.groupsView=i,this.groupView=n,this.model=o,this.instantiationService=r;const a=this._register(new pue(this.model)),c=this._register(new fue(this.model));this.stickyEditorTabsControl=this._register(this.instantiationService.createInstance(kx,this.parent,t,this.groupsView,this.groupView,a)),this.unstickyEditorTabsControl=this._register(this.instantiationService.createInstance(kx,this.parent,t,this.groupsView,this.groupView,c)),this.handleTabBarsStateChange()}handleTabBarsStateChange(){this.activeControl=this.model.activeEditor?this.getEditorTabsController(this.model.activeEditor):void 0,this.handleTabBarsLayoutChange()}handleTabBarsLayoutChange(){if(this.groupView.count===0)return;const e=this.parent.classList.contains("two-tab-bars"),t=this.groupView.count!==this.groupView.stickyCount&&this.groupView.stickyCount>0;this.parent.classList.toggle("two-tab-bars",t),e!==t&&this.groupView.relayout()}didActiveControlChange(){return this.activeControl!==(this.model.activeEditor?this.getEditorTabsController(this.model.activeEditor):void 0)}getEditorTabsController(e){return this.model.isSticky(e)?this.stickyEditorTabsControl:this.unstickyEditorTabsControl}openEditor(e,t){const i=this.didActiveControlChange(),o=this.getEditorTabsController(e).openEditor(e,t)||i;return o&&this.handleOpenedEditors(),o}openEditors(e){const t=e.filter(c=>this.model.isSticky(c)),i=e.filter(c=>!this.model.isSticky(c)),n=this.didActiveControlChange(),o=this.stickyEditorTabsControl.openEditors(t),r=this.unstickyEditorTabsControl.openEditors(i),a=o||r||n;return a&&this.handleOpenedEditors(),a}handleOpenedEditors(){this.handleTabBarsStateChange()}beforeCloseEditor(e){this.getEditorTabsController(e).beforeCloseEditor(e)}closeEditor(e){this.stickyEditorTabsControl.closeEditor(e),this.unstickyEditorTabsControl.closeEditor(e),this.handleClosedEditors()}closeEditors(e){const t=e.filter(n=>this.model.isSticky(n)),i=e.filter(n=>!this.model.isSticky(n));this.stickyEditorTabsControl.closeEditors(t),this.unstickyEditorTabsControl.closeEditors(i),this.handleClosedEditors()}handleClosedEditors(){this.handleTabBarsStateChange()}moveEditor(e,t,i,n){n?(this.model.isSticky(e)?(this.stickyEditorTabsControl.openEditor(e),this.unstickyEditorTabsControl.closeEditor(e)):(this.stickyEditorTabsControl.closeEditor(e),this.unstickyEditorTabsControl.openEditor(e)),this.handleTabBarsStateChange()):this.model.isSticky(e)?this.stickyEditorTabsControl.moveEditor(e,t,i,n):this.unstickyEditorTabsControl.moveEditor(e,t-this.model.stickyCount,i-this.model.stickyCount,n)}pinEditor(e){this.getEditorTabsController(e).pinEditor(e)}stickEditor(e){this.unstickyEditorTabsControl.closeEditor(e),this.stickyEditorTabsControl.openEditor(e),this.handleTabBarsStateChange()}unstickEditor(e){this.stickyEditorTabsControl.closeEditor(e),this.unstickyEditorTabsControl.openEditor(e),this.handleTabBarsStateChange()}setActive(e){this.stickyEditorTabsControl.setActive(e),this.unstickyEditorTabsControl.setActive(e)}updateEditorSelections(){this.stickyEditorTabsControl.updateEditorSelections(),this.unstickyEditorTabsControl.updateEditorSelections()}updateEditorLabel(e){this.getEditorTabsController(e).updateEditorLabel(e)}updateEditorDirty(e){this.getEditorTabsController(e).updateEditorDirty(e)}updateOptions(e,t){this.stickyEditorTabsControl.updateOptions(e,t),this.unstickyEditorTabsControl.updateOptions(e,t)}layout(e){const t=this.stickyEditorTabsControl.layout(e),i={container:e.container,available:new Ke(e.available.width,e.available.height-t.height)},n=this.unstickyEditorTabsControl.layout(i);return new Ke(e.container.width,t.height+n.height)}getHeight(){return this.stickyEditorTabsControl.getHeight()+this.unstickyEditorTabsControl.getHeight()}dispose(){this.parent.classList.toggle("two-tab-bars",!1),super.dispose()}};n2=f([p(5,J)],n2);Be(mue);class P0e extends Dx{constructor(){super(...arguments),this.activeEditor=null}prepareEditorActions(e){return{primary:[],secondary:[]}}openEditor(e){return this.handleOpenedEditors()}openEditors(e){return this.handleOpenedEditors()}handleOpenedEditors(){const e=this.activeEditorChanged();return this.activeEditor=this.tabsModel.activeEditor,e}activeEditorChanged(){return!!(!this.activeEditor&&this.tabsModel.activeEditor||this.activeEditor&&!this.tabsModel.activeEditor||!this.activeEditor||!this.tabsModel.isActive(this.activeEditor))}beforeCloseEditor(e){}closeEditor(e){this.handleClosedEditors()}closeEditors(e){this.handleClosedEditors()}handleClosedEditors(){this.activeEditor=this.tabsModel.activeEditor}moveEditor(e,t,i){}pinEditor(e){}stickEditor(e){}unstickEditor(e){}setActive(e){}updateEditorSelections(){}updateEditorLabel(e){}updateEditorDirty(e){}getHeight(){return 0}layout(e){return new Ke(e.container.width,this.getHeight())}}Be(b0e);let s2=class extends pw{get breadcrumbsControl(){return this.breadcrumbsControlFactory?.control}constructor(e,t,i,n,o,r,a){super(a),this.parent=e,this.editorPartsView=t,this.groupsView=i,this.groupView=n,this.model=o,this.instantiationService=r,this.editorTabsControlDisposable=this._register(new U),this.breadcrumbsControlDisposables=this._register(new U),this.editorTabsControl=this.createEditorTabsControl(),this.breadcrumbsControlFactory=this.createBreadcrumbsControl()}createEditorTabsControl(){let e;switch(this.groupsView.partOptions.showTabs){case"none":e=P0e;break;case"single":e=R0e;break;case"multiple":default:e=this.groupsView.partOptions.pinnedTabsOnSeparateRow?n2:kx;break}const t=this.instantiationService.createInstance(e,this.parent,this.editorPartsView,this.groupsView,this.groupView,this.model);return this.editorTabsControlDisposable.add(t)}createBreadcrumbsControl(){if(this.groupsView.partOptions.showTabs==="single")return;const e=Y(".breadcrumbs-below-tabs");this.parent.appendChild(e);const t=this.breadcrumbsControlDisposables.add(this.instantiationService.createInstance(zP,e,this.groupView,{showFileIcons:!0,showSymbolIcons:!0,showDecorationColors:!1,showPlaceholder:!0,dragEditor:!1}));return this.breadcrumbsControlDisposables.add(t.onDidEnablementChange(()=>this.groupView.relayout())),this.breadcrumbsControlDisposables.add(t.onDidVisibilityChange(()=>this.groupView.relayout())),t}openEditor(e,t){const i=this.editorTabsControl.openEditor(e,t);this.handleOpenedEditors(i)}openEditors(e){const t=this.editorTabsControl.openEditors(e);this.handleOpenedEditors(t)}handleOpenedEditors(e){e?this.breadcrumbsControl?.update():this.breadcrumbsControl?.revealLast()}beforeCloseEditor(e){return this.editorTabsControl.beforeCloseEditor(e)}closeEditor(e){this.editorTabsControl.closeEditor(e),this.handleClosedEditors()}closeEditors(e){this.editorTabsControl.closeEditors(e),this.handleClosedEditors()}handleClosedEditors(){this.groupView.activeEditor||this.breadcrumbsControl?.update()}moveEditor(e,t,i,n){return this.editorTabsControl.moveEditor(e,t,i,n)}pinEditor(e){return this.editorTabsControl.pinEditor(e)}stickEditor(e){return this.editorTabsControl.stickEditor(e)}unstickEditor(e){return this.editorTabsControl.unstickEditor(e)}setActive(e){return this.editorTabsControl.setActive(e)}updateEditorSelections(){this.editorTabsControl.updateEditorSelections()}updateEditorLabel(e){return this.editorTabsControl.updateEditorLabel(e)}updateEditorDirty(e){return this.editorTabsControl.updateEditorDirty(e)}updateOptions(e,t){e.showTabs!==t.showTabs||t.showTabs!=="single"&&e.pinnedTabsOnSeparateRow!==t.pinnedTabsOnSeparateRow?(this.editorTabsControlDisposable.clear(),this.breadcrumbsControlDisposables.clear(),Yi(this.parent),this.editorTabsControl=this.createEditorTabsControl(),this.breadcrumbsControlFactory=this.createBreadcrumbsControl()):this.editorTabsControl.updateOptions(e,t)}layout(e){const t=this.editorTabsControl.layout(e);let i;return this.breadcrumbsControl?.isHidden()===!1&&(i=new Ke(e.container.width,In.HEIGHT),this.breadcrumbsControl.layout(i)),new Ke(e.container.width,t.height+(i?i.height:0))}getHeight(){const e=this.editorTabsControl.getHeight(),t=this.breadcrumbsControl?.isHidden()===!1?In.HEIGHT:0;return{total:e+t,offset:e}}};s2=f([p(5,J),p(6,ft)],s2);var Gg;Be(n0e);let KP=Gg=class extends pw{static createNew(e,t,i,n,o,r){return o.createInstance(Gg,null,e,t,i,n,r)}static createFromSerialized(e,t,i,n,o,r,a){return r.createInstance(Gg,e,t,i,n,o,a)}static createCopy(e,t,i,n,o,r,a){return r.createInstance(Gg,e,t,i,n,o,a)}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A,B,z){super(d),this.editorPartsView=t,this.groupsView=i,this.groupsLabel=n,this._index=o,this.instantiationService=a,this.contextKeyService=c,this.telemetryService=l,this.keybindingService=u,this.menuService=g,this.contextMenuService=m,this.fileDialogService=v,this.editorService=y,this.filesConfigurationService=w,this.uriIdentityService=C,this.logService=T,this.editorResolverService=k,this.hostService=A,this.dialogService=B,this.fileService=z,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onWillDispose=this._register(new M),this.onWillDispose=this._onWillDispose.event,this._onDidModelChange=this._register(new M),this.onDidModelChange=this._onDidModelChange.event,this._onDidActiveEditorChange=this._register(new M),this.onDidActiveEditorChange=this._onDidActiveEditorChange.event,this._onDidOpenEditorFail=this._register(new M),this.onDidOpenEditorFail=this._onDidOpenEditorFail.event,this._onWillCloseEditor=this._register(new M),this.onWillCloseEditor=this._onWillCloseEditor.event,this._onDidCloseEditor=this._register(new M),this.onDidCloseEditor=this._onDidCloseEditor.event,this._onWillMoveEditor=this._register(new M),this.onWillMoveEditor=this._onWillMoveEditor.event,this._onWillOpenEditor=this._register(new M),this.onWillOpenEditor=this._onWillOpenEditor.event,this.disposedEditorsWorker=this._register(new Tq(ie=>this.handleDisposedEditors(ie),0)),this.mapEditorToPendingConfirmation=new Map,this.containerToolBarMenuDisposable=this._register(new kt),this.whenRestoredPromise=new Zo,this.whenRestored=this.whenRestoredPromise.p,this._disposed=!1,this.element=Y("div"),this._onDidChange=this._register(new bne),this.onDidChange=this._onDidChange.event,e instanceof Gg?this.model=this._register(e.model.clone()):aue(e)?this.model=this._register(a.createInstance(BP,e)):this.model=this._register(a.createInstance(BP,void 0)),this.scopedContextKeyService=this._register(this.contextKeyService.createScoped(this.element)),this.element.classList.add(...Vt(["editor-group-container",this.model.isLocked?"locked":void 0])),this.registerContainerListeners(),this.createContainerToolbar(),this.createContainerContextMenu(),this._register(this.instantiationService.createInstance(KU,this.element)),this.progressBar=this._register(new Cne(this.element,Ene)),this.progressBar.hide(),this.scopedInstantiationService=this._register(this.instantiationService.createChild(new pf([me,this.scopedContextKeyService],[ju,this._register(new Y1e(this.progressBar,this))]))),this.resourceContext=this._register(this.scopedInstantiationService.createInstance(pi)),this.handleGroupContextKeys(),this.titleContainer=Y(".title"),this.element.appendChild(this.titleContainer),this.titleControl=this._register(this.scopedInstantiationService.createInstance(s2,this.titleContainer,this.editorPartsView,this.groupsView,this,this.model)),this.editorContainer=Y(".editor-container"),this.element.appendChild(this.editorContainer),this.editorPane=this._register(this.scopedInstantiationService.createInstance(zU,this.element,this.editorContainer,this)),this._onDidChange.input=this.editorPane.onDidChangeSizeConstraints,this.doTrackFocus(),this.updateTitleContainer(),this.updateContainer(),this.updateStyles(),(this.restoreEditors(e,r)??Promise.resolve()).finally(()=>{this.whenRestoredPromise.complete()}),this.registerListeners()}handleGroupContextKeys(){const e=this.editorPartsView.bind(_Ce,this),t=this.editorPartsView.bind(Jse,this),i=this.editorPartsView.bind(eoe,this),n=this.editorPartsView.bind(toe,this),o=this.editorPartsView.bind(rA,this),r=this.editorPartsView.bind(bCe,this),a=this.editorPartsView.bind(oA,this),c=noe.bindTo(this.scopedContextKeyService),d=soe.bindTo(this.scopedContextKeyService),l=ooe.bindTo(this.scopedContextKeyService),u=this.editorPartsView.bind(bw,this),g=this.editorPartsView.bind(yCe,this),m=this.editorPartsView.bind(roe,this),v=this.editorPartsView.bind(Qse,this),y=this.editorPartsView.bind(Yse,this),w=this.editorPartsView.bind(QF,this),C=this.editorPartsView.bind(Lb,this),T=this.editorPartsView.bind(fI,this),k=this.editorPartsView.bind(yC,this),A=this.editorPartsView.bind(Cu,this),B=this._register(new kt),z=()=>{B.clear(),this.scopedContextKeyService.bufferChangeEvents(()=>{const ie=this.activeEditor,oe=this.activeEditorPane;if(this.resourceContext.set(xi.getOriginalUri(ie,{supportSideBySide:Ut.PRIMARY})),ioe(T,ie,this.editorResolverService),ie?(k.set(ie.hasCapability(Ze.CanSplitInGroup)),A.set(ie.typeId===ws.ID),e.set(ie.isDirty()&&!ie.isSaving()),B.value=ie.onDidChangeDirty(()=>{e.set(ie.isDirty()&&!ie.isSaving())})):(k.set(!1),A.set(!1),e.set(!1)),oe){u.set(oe.getId()),m.set(!oe.input.hasCapability(Ze.Untitled)),g.set(!!oe.input.isReadonly());const xe=xi.getOriginalUri(oe.input,{supportSideBySide:Ut.PRIMARY}),Se=xi.getOriginalUri(oe.input,{supportSideBySide:Ut.SECONDARY});y.set(oe.input instanceof ro&&!oe.input.original.isReadonly()&&!!xe&&(this.fileService.hasProvider(xe)||xe.scheme===ae.untitled)&&!!Se&&(this.fileService.hasProvider(Se)||Se.scheme===ae.untitled)),v.set(!!xe&&this.fileService.hasProvider(xe)&&!this.fileService.hasCapability(xe,ph.Readonly));const Ft=oe?.getId()===Jq;C.set(Ft),w.set(Ft)}else u.reset(),m.reset(),g.reset(),y.reset(),v.reset()})},Q=ie=>{switch(ie.kind){case ct.GROUP_LOCKED:a.set(this.isLocked);break;case ct.EDITOR_ACTIVE:i.set(this.model.isFirst(this.model.activeEditor)),n.set(this.model.isLast(this.model.activeEditor)),t.set(this.model.activeEditor?this.model.isPinned(this.model.activeEditor):!1),o.set(this.model.activeEditor?this.model.isSticky(this.model.activeEditor):!1);break;case ct.EDITOR_CLOSE:t.set(this.model.activeEditor?this.model.isPinned(this.model.activeEditor):!1),o.set(this.model.activeEditor?this.model.isSticky(this.model.activeEditor):!1);case ct.EDITOR_OPEN:case ct.EDITOR_MOVE:i.set(this.model.isFirst(this.model.activeEditor)),n.set(this.model.isLast(this.model.activeEditor));break;case ct.EDITOR_PIN:ie.editor&&ie.editor===this.model.activeEditor&&t.set(this.model.isPinned(this.model.activeEditor));break;case ct.EDITOR_STICKY:ie.editor&&ie.editor===this.model.activeEditor&&o.set(this.model.isSticky(this.model.activeEditor));break;case ct.EDITORS_SELECTION:c.set(this.model.selectedEditors.length>1),d.set(this.model.selectedEditors.length===2),l.set(this.model.selectedEditors.every(oe=>oe.resource&&(this.fileService.hasProvider(oe.resource)||oe.resource.scheme===ae.untitled)));break}r.set(this.count)};this._register(this.onDidModelChange(ie=>Q(ie))),this._register(this.onDidActiveEditorChange(()=>z())),z(),Q({kind:ct.EDITOR_ACTIVE}),Q({kind:ct.GROUP_LOCKED})}registerContainerListeners(){this._register(re(this.element,pe.DBLCLICK,e=>{this.isEmpty&&(Li.stop(e),this.editorService.openEditor({resource:void 0,options:{pinned:!0,override:od.id}},this.id))})),this._register(re(this.element,pe.AUXCLICK,e=>{this.isEmpty&&e.button===1&&(Li.stop(e,!0),this.groupsView.removeGroup(this))}))}createContainerToolbar(){const e=Y(".editor-group-container-toolbar");this.element.appendChild(e);const t=this._register(new Er(e,{ariaLabel:h(3251,"Empty editor group actions"),highlightToggledItems:!0})),i=this._register(this.menuService.createMenu(N.EmptyEditorGroup,this.scopedContextKeyService)),n=()=>{this.containerToolBarMenuDisposable.value=Ee(()=>t.clear());const o=zm(i.getActions({arg:{groupId:this.id},shouldForwardArgs:!0}),"navigation");for(const r of[...o.primary,...o.secondary]){const a=this.keybindingService.lookupKeybinding(r.id);t.push(r,{icon:!0,label:!1,keybinding:a?.getLabel()})}};n(),this._register(i.onDidChange(n))}createContainerContextMenu(){this._register(re(this.element,pe.CONTEXT_MENU,e=>this.onShowContainerContextMenu(e))),this._register(re(this.element,Vo.Contextmenu,()=>this.onShowContainerContextMenu()))}onShowContainerContextMenu(e){if(!this.isEmpty)return;let t=this.element;e&&(t=new us(bt(this.element),e)),this.contextMenuService.showContextMenu({menuId:N.EmptyEditorGroupContext,contextKeyService:this.contextKeyService,getAnchor:()=>t,onHide:()=>this.focus()})}doTrackFocus(){const e=this._register(Po(this.element));this._register(e.onDidFocus(()=>{this.isEmpty&&this._onDidFocus.fire()}));const t=i=>{let n;if(hp(i)){if(i.button!==0||qt&&i.ctrlKey)return;n=i.target}else n=i.initialTarget;LF(n,"monaco-action-bar",this.titleContainer)||LF(n,"monaco-breadcrumb-item",this.titleContainer)||setTimeout(()=>{this.focus()})};this._register(re(this.titleContainer,pe.MOUSE_DOWN,i=>t(i))),this._register(re(this.titleContainer,Vo.Tap,i=>t(i))),this._register(this.editorPane.onDidFocus(()=>{this._onDidFocus.fire()}))}updateContainer(){this.isEmpty?(this.element.classList.add("empty"),this.element.tabIndex=0,this.element.setAttribute("aria-label",h(3252,"{0} (empty)",this.ariaLabel))):(this.element.classList.remove("empty"),this.element.removeAttribute("tabIndex"),this.element.removeAttribute("aria-label")),this.updateStyles()}updateTitleContainer(){this.titleContainer.classList.toggle("tabs",this.groupsView.partOptions.showTabs==="multiple"),this.titleContainer.classList.toggle("show-file-icons",this.groupsView.partOptions.showIcons)}restoreEditors(e,t){if(this.count===0)return;let i;e instanceof Gg?i=Z8(e):i=Object.create(null);const n=this.model.activeEditor;if(!n)return;i.pinned=this.model.isPinned(n),i.sticky=this.model.isSticky(n),i.preserveFocus=!0;const o={preserveWindowOrder:!0,skipTitleUpdate:!0},r=Eh(),a=this.doShowEditor(n,{active:!0,isNew:!1},i,o).then(()=>{this.groupsView.activeGroup===this&&r&&gf(r)&&!t?.preserveFocus&&this.focus()});return this.titleControl.openEditors(this.editors),a}registerListeners(){this._register(this.model.onDidModelChange(e=>this.onDidGroupModelChange(e))),this._register(this.groupsView.onDidChangeEditorPartOptions(e=>this.onDidChangeEditorPartOptions(e))),this._register(this.groupsView.onDidVisibilityChange(e=>this.onDidVisibilityChange(e))),this._register(this.onDidFocus(()=>this.onDidGainFocus()))}onDidGroupModelChange(e){switch(this._onDidModelChange.fire(e),e.kind){case ct.GROUP_LOCKED:this.element.classList.toggle("locked",this.isLocked);break;case ct.EDITORS_SELECTION:this.onDidChangeEditorSelection();break}if(e.editor)switch(e.kind){case ct.EDITOR_OPEN:s0e(e)&&this.onDidOpenEditor(e.editor,e.editorIndex);break;case ct.EDITOR_CLOSE:r0e(e)&&this.handleOnDidCloseEditor(e.editor,e.editorIndex,e.context,e.sticky);break;case ct.EDITOR_WILL_DISPOSE:this.onWillDisposeEditor(e.editor);break;case ct.EDITOR_DIRTY:this.onDidChangeEditorDirty(e.editor);break;case ct.EDITOR_TRANSIENT:this.onDidChangeEditorTransient(e.editor);break;case ct.EDITOR_LABEL:this.onDidChangeEditorLabel(e.editor);break}}onDidOpenEditor(e,t){this.telemetryService.publicLog("editorOpened",this.toEditorTelemetryDescriptor(e)),this.updateContainer()}handleOnDidCloseEditor(e,t,i,n){this._onWillCloseEditor.fire({groupId:this.id,editor:e,context:i,index:t,sticky:n});const o=[e];e instanceof ws&&o.push(e.primary,e.secondary);for(const r of o)this.canDispose(r)&&r.dispose();this.updateContainer(),this._onDidCloseEditor.fire({groupId:this.id,editor:e,context:i,index:t,sticky:n})}canDispose(e){for(const t of this.editorPartsView.groups)if(t instanceof Gg&&t.model.contains(e,{strictEquals:!0,supportSideBySide:Ut.ANY}))return!1;return!0}toResourceTelemetryDescriptor(e){if(!e)return;const t=e?e.scheme===ae.file?e.fsPath:e.path:void 0;if(!t)return;let i=jM(e);const n=i.indexOf("?");return i=n!==-1?i.substr(0,n):i,{mimeType:new N_e(O_e(e).join(", ")),scheme:e.scheme,ext:i,path:cc(t)}}toEditorTelemetryDescriptor(e){const t=e.getTelemetryDescriptor(),i=xi.getOriginalUri(e,{supportSideBySide:Ut.BOTH});return R.isUri(i)?(t.resource=this.toResourceTelemetryDescriptor(i),t):(i&&(i.primary&&(t.resource=this.toResourceTelemetryDescriptor(i.primary)),i.secondary&&(t.resourceSecondary=this.toResourceTelemetryDescriptor(i.secondary))),t)}onWillDisposeEditor(e){this.disposedEditorsWorker.work(e)}handleDisposedEditors(e){let t;const i=[];for(const n of e){const o=this.model.findEditor(n);if(!o)continue;const r=o[0];r.isDisposed()&&(this.model.isActive(r)?t=r:i.push(r))}for(const n of i)this.doCloseEditor(n,!0);t&&this.doCloseEditor(t,!0)}onDidChangeEditorPartOptions(e){this.updateTitleContainer(),this.titleControl.updateOptions(e.oldPartOptions,e.newPartOptions),(e.oldPartOptions.showTabs!==e.newPartOptions.showTabs||e.oldPartOptions.tabHeight!==e.newPartOptions.tabHeight||e.oldPartOptions.showTabs==="multiple"&&e.oldPartOptions.pinnedTabsOnSeparateRow!==e.newPartOptions.pinnedTabsOnSeparateRow)&&(this.relayout(),this.model.activeEditor&&this.titleControl.openEditors(this.model.getEditors(Ai.SEQUENTIAL))),this.updateStyles(),e.oldPartOptions.enablePreview&&!e.newPartOptions.enablePreview&&this.model.previewEditor&&this.pinEditor(this.model.previewEditor)}onDidChangeEditorDirty(e){this.pinEditor(e),this.titleControl.updateEditorDirty(e)}onDidChangeEditorTransient(e){!this.model.isTransient(e)&&!this.groupsView.partOptions.enablePreview&&this.pinEditor(e)}onDidChangeEditorLabel(e){this.titleControl.updateEditorLabel(e)}onDidChangeEditorSelection(){this.titleControl.updateEditorSelections()}onDidVisibilityChange(e){this.editorPane.setVisible(e)}onDidGainFocus(){this.activeEditor&&this.model.setTransient(this.activeEditor,!1)}get index(){return this._index}get label(){return this.groupsLabel?h(3253,"{0}: Group {1}",this.groupsLabel,this._index+1):h(3254,"Group {0}",this._index+1)}get ariaLabel(){return this.groupsLabel?h(3255,"{0}: Editor Group {1}",this.groupsLabel,this._index+1):h(3256,"Editor Group {0}",this._index+1)}get disposed(){return this._disposed}get isEmpty(){return this.count===0}get titleHeight(){return this.titleControl.getHeight()}notifyIndexChanged(e){this._index!==e&&(this._index=e,this.model.setIndex(e))}notifyLabelChanged(e){this.groupsLabel!==e&&(this.groupsLabel=e,this.model.setLabel(e))}setActive(e){this.active=e,!e&&this.activeEditor&&this.selectedEditors.length>1&&this.setSelection(this.activeEditor,[]),this.element.classList.toggle("active",e),this.element.classList.toggle("inactive",!e),this.titleControl.setActive(e),this.updateStyles(),this.model.setActive(void 0)}get id(){return this.model.id}get windowId(){return this.groupsView.windowId}get editors(){return this.model.getEditors(Ai.SEQUENTIAL)}get count(){return this.model.count}get stickyCount(){return this.model.stickyCount}get activeEditorPane(){return this.editorPane?this.editorPane.activeEditorPane??void 0:void 0}get activeEditor(){return this.model.activeEditor}get selectedEditors(){return this.model.selectedEditors}get previewEditor(){return this.model.previewEditor}isPinned(e){return this.model.isPinned(e)}isSticky(e){return this.model.isSticky(e)}isSelected(e){return this.model.isSelected(e)}isTransient(e){return this.model.isTransient(e)}isActive(e){return this.model.isActive(e)}async setSelection(e,t){this.isActive(e)?this.model.setSelection(e,t):await this.openEditor(e,{activation:Yc.ACTIVATE},{inactiveSelection:t})}contains(e,t){return this.model.contains(e,t)}getEditors(e,t){return this.model.getEditors(e,t)}findEditors(e,t){const i=this.uriIdentityService.asCanonicalUri(e);return this.getEditors(Ai.SEQUENTIAL).filter(n=>{if(n.resource&&Dt(n.resource,i))return!0;if(t?.supportSideBySide===Ut.PRIMARY||t?.supportSideBySide===Ut.ANY){const o=xi.getCanonicalUri(n,{supportSideBySide:Ut.PRIMARY});if(o&&Dt(o,i))return!0}if(t?.supportSideBySide===Ut.SECONDARY||t?.supportSideBySide===Ut.ANY){const o=xi.getCanonicalUri(n,{supportSideBySide:Ut.SECONDARY});if(o&&Dt(o,i))return!0}return!1})}getEditorByIndex(e){return this.model.getEditorByIndex(e)}getIndexOfEditor(e){return this.model.indexOf(e)}isFirst(e){return this.model.isFirst(e)}isLast(e){return this.model.isLast(e)}focus(){this.activeEditorPane?this.activeEditorPane.focus():this.element.focus(),this._onDidFocus.fire()}pinEditor(e=this.activeEditor||void 0){if(e&&!this.model.isPinned(e)){const t=this.model.pin(e);t&&this.titleControl.pinEditor(t)}}stickEditor(e=this.activeEditor||void 0){this.doStickEditor(e,!0)}unstickEditor(e=this.activeEditor||void 0){this.doStickEditor(e,!1)}doStickEditor(e,t){if(e&&this.model.isSticky(e)!==t){const i=this.getIndexOfEditor(e),n=t?this.model.stick(e):this.model.unstick(e);if(!n)return;const o=this.getIndexOfEditor(n);o!==i&&this.titleControl.moveEditor(n,i,o,!0),t?this.titleControl.stickEditor(n):this.titleControl.unstickEditor(n)}}async openEditor(e,t,i){return this.doOpenEditor(e,t,{...i,supportSideBySide:Ut.BOTH})}async doOpenEditor(e,t,i){if(!e||e.isDisposed())return;this._onWillOpenEditor.fire({editor:e,groupId:this.id});const n=t?.sticky||!this.groupsView.partOptions.enablePreview&&!t?.transient||e.isDirty()||(t?.pinned??typeof t?.index=="number")||typeof t?.index=="number"&&this.model.isSticky(t.index)||e.hasCapability(Ze.Scratchpad),o={index:t?t.index:void 0,pinned:n,sticky:t?.sticky||typeof t?.index=="number"&&this.model.isSticky(t.index),transient:!!t?.transient,inactiveSelection:i?.inactiveSelection,active:this.count===0||!t||!t.inactive,supportSideBySide:i?.supportSideBySide};!o.active&&!o.pinned&&this.model.activeEditor&&!this.model.isPinned(this.model.activeEditor)&&(o.active=!0);let r=!1,a=!1;if(t?.activation===Yc.ACTIVATE?r=!0:t?.activation===Yc.RESTORE?a=!0:t?.activation===Yc.PRESERVE?(r=!1,a=!1):o.active&&(r=!t||!t.preserveFocus,a=!r),typeof o.index=="number"){const u=this.model.indexOf(e);u!==-1&&u!==o.index&&this.doMoveEditorInsideGroup(e,o)}const{editor:c,isNew:d}=this.model.openEditor(e,o);d&&this.count===1&&this.editorPartsView.groups.length>1&&c.editorId&&this.groupsView.partOptions.autoLockGroups?.has(c.editorId)&&this.lock(!0);const l=this.doShowEditor(c,{active:!!o.active,isNew:d},t,i);return r?this.groupsView.activateGroup(this):a&&this.groupsView.restoreGroup(this),l}doShowEditor(e,t,i,n){let o;return t.active?o=(async()=>{const{pane:r,changed:a,cancelled:c,error:d}=await this.editorPane.openEditor(e,i,n,{newInGroup:t.isNew});if(!c)return a&&this._onDidActiveEditorChange.fire({editor:e}),d&&this._onDidOpenEditorFail.fire(e),!r&&this.activeEditor===e&&this.doCloseEditor(e,i?.preserveFocus,{fromError:!0}),r})():o=Promise.resolve(void 0),n?.skipTitleUpdate||this.titleControl.openEditor(e,n),o}async openEditors(e){const t=Vt(e).filter(({editor:a})=>!a.isDisposed()),i=t.at(0);if(!i)return;const n={supportSideBySide:Ut.BOTH};await this.doOpenEditor(i.editor,i.options,n);const o=t.slice(1),r=this.getIndexOfEditor(i.editor)+1;return await Op.settled(o.map(({editor:a,options:c},d)=>this.doOpenEditor(a,{...c,inactive:!0,pinned:!0,index:r+d},{...n,skipTitleUpdate:!0}))),this.titleControl.openEditors(o.map(({editor:a})=>a)),this.editorPane.activeEditorPane??void 0}moveEditors(e,t){const i={skipTitleUpdate:this!==t};let n=!1;const o=new Set;for(const{editor:r,options:a}of e)this.moveEditor(r,t,a,i)?o.add(r):n=!0;return i.skipTitleUpdate&&(t.titleControl.openEditors(Array.from(o)),this.titleControl.closeEditors(Array.from(o))),!n}moveEditor(e,t,i,n){return this===t?(this.doMoveEditorInsideGroup(e,i),!0):this.doMoveOrCopyEditorAcrossGroups(e,t,i,{...n,keepCopy:!1})}doMoveEditorInsideGroup(e,t){const i=t?t.index:void 0;if(typeof i!="number")return;const n=this.model.indexOf(e),o=this.model.getEditorByIndex(n);if(o){if(n!==i){const r=this.model.stickyCount;this.model.moveEditor(o,i),this.model.pin(o),this.titleControl.moveEditor(o,n,i,r!==this.model.stickyCount),this.titleControl.pinEditor(o)}t?.sticky&&this.stickEditor(o)}}doMoveOrCopyEditorAcrossGroups(e,t,i,n){const o=n?.keepCopy;if(!o||e.hasCapability(Ze.Singleton)){const a=e.canMove(this.id,t.id);if(typeof a=="string")return this.dialogService.error(a,h(3257,"Try saving or reverting the editor first and then try again.")),!1}const r=Z8(this,e,{...i,pinned:!0,sticky:i?.sticky??(!o&&this.model.isSticky(e))});return o||this._onWillMoveEditor.fire({groupId:this.id,editor:e,target:t.id}),t.doOpenEditor(o?e.copy():e,r,n),o||this.doCloseEditor(e,!0,{...n,context:Yd.MOVE}),!0}copyEditors(e,t){const i={skipTitleUpdate:this!==t};for(const{editor:n,options:o}of e)this.copyEditor(n,t,o,i);if(i.skipTitleUpdate){const n=e.map(({editor:o})=>o);t.titleControl.openEditors(n)}}copyEditor(e,t,i,n){this===t?this.doMoveEditorInsideGroup(e,i):this.doMoveOrCopyEditorAcrossGroups(e,t,i,{...n,keepCopy:!0})}async closeEditor(e=this.activeEditor||void 0,t){return this.doCloseEditorWithConfirmationHandling(e,t)}async doCloseEditorWithConfirmationHandling(e=this.activeEditor||void 0,t,i){return!e||await this.handleCloseConfirmation([e])?!1:(this.doCloseEditor(e,t?.preserveFocus,i),!0)}doCloseEditor(e,t=this.groupsView.activeGroup!==this,i){i?.skipTitleUpdate||this.titleControl.beforeCloseEditor(e),this.model.isActive(e)?this.doCloseActiveEditor(t,i):this.doCloseInactiveEditor(e,i),i?.skipTitleUpdate||this.titleControl.closeEditor(e)}doCloseActiveEditor(e=this.groupsView.activeGroup!==this,t){const i=this.activeEditor,n=!e&&this.shouldRestoreFocus(this.element),o=this.groupsView.partOptions.closeEmptyGroups;if(o&&this.active&&this.count===1){const c=this.groupsView.getGroups(Ko.MOST_RECENTLY_ACTIVE)[1];c&&(n?c.focus():this.groupsView.activateGroup(c,!0))}i&&this.model.closeEditor(i,t?.context);const r=this.model.activeEditor;if(r){let a;e&&this.groupsView.activeGroup!==this&&(a=Yc.PRESERVE);const c={preserveFocus:e,activation:a,ignoreError:t?.fromError},d={preserveWindowOrder:!0};this.doOpenEditor(r,c,d)}else i&&this.editorPane.closeEditor(i),n&&!o&&this.focus(),this._onDidActiveEditorChange.fire({editor:void 0}),o&&this.groupsView.removeGroup(this,e)}shouldRestoreFocus(e){const t=Eh();return t===e.ownerDocument.body?!0:Ku(t,e)}doCloseInactiveEditor(e,t){this.model.closeEditor(e,t?.context)}async handleCloseConfirmation(e){if(!e.length)return!1;const t=e.shift();let i=this.mapEditorToPendingConfirmation.get(t);i||(i=this.doHandleCloseConfirmation(t),this.mapEditorToPendingConfirmation.set(t,i));let n;try{n=await i}finally{this.mapEditorToPendingConfirmation.delete(t)}return n||this.handleCloseConfirmation(e)}async doHandleCloseConfirmation(e,t){if(!this.shouldConfirmClose(e)||e instanceof ws&&this.model.contains(e.primary)||this.editorPartsView.groups.some(r=>{if(r===this)return!1;const a=r;return!!(a.contains(e,{supportSideBySide:Ut.BOTH})||e instanceof ws&&a.contains(e.primary))}))return!1;let i=zi.CANCEL,n=ui.EXPLICIT,o=!1;if(!e.hasCapability(Ze.Untitled)&&!t?.skipAutoSave&&!e.closeHandler&&(this.filesConfigurationService.getAutoSaveMode(e).mode===cA.ON_FOCUS_CHANGE?(o=!0,i=zi.SAVE,n=ui.FOCUS_CHANGE):ra&&(pn||vh)&&this.filesConfigurationService.getAutoSaveMode(e).mode===cA.ON_WINDOW_CHANGE&&(o=!0,i=zi.SAVE,n=ui.WINDOW_CHANGE)),!o){(!this.activeEditor||!this.activeEditor.matches(e))&&await this.doOpenEditor(e),await this.hostService.focus(bt(this.element));let r=!1;if(typeof e.closeHandler?.confirm=="function")try{i=await e.closeHandler.confirm([{editor:e,groupId:this.id}])}catch(a){this.logService.error(a),r=!0}if(typeof e.closeHandler?.confirm!="function"||r){let a;e instanceof ws?a=e.primary.getName():a=e.getName(),i=await this.fileDialogService.showSaveConfirm([a])}}if(!e.closeHandler&&!this.shouldConfirmClose(e))return i===zi.CANCEL;switch(i){case zi.SAVE:return!await e.save(this.id,{reason:n})&&o?this.doHandleCloseConfirmation(e,{skipAutoSave:!0}):e.isDirty();case zi.DONT_SAVE:try{return await e.revert(this.id),e.isDirty()}catch(r){return this.logService.error(r),await e.revert(this.id,{soft:!0}),e.isDirty()}case zi.CANCEL:return!0}}shouldConfirmClose(e){if(e.closeHandler)try{return e.closeHandler.showConfirm()}catch(t){this.logService.error(t)}return e.isDirty()&&!e.isSaving()}async closeEditors(e,t){if(this.isEmpty)return!0;const i=this.doGetEditorsToClose(e);return await this.handleCloseConfirmation(i.slice(0))?!1:(this.doCloseEditors(i,t),!0)}doGetEditorsToClose(e){if(Array.isArray(e))return e;const t=e,i=typeof t.direction=="number";let n=this.model.getEditors(i?Ai.SEQUENTIAL:Ai.MOST_RECENTLY_ACTIVE,t);return t.savedOnly?n=n.filter(o=>!o.isDirty()||o.isSaving()):i&&t.except?n=t.direction===tz.LEFT?n.slice(0,this.model.indexOf(t.except,n)):n.slice(this.model.indexOf(t.except,n)+1):t.except&&(n=n.filter(o=>t.except&&!o.matches(t.except))),n}doCloseEditors(e,t){let i=!1;for(const n of e)this.isActive(n)?i=!0:this.doCloseInactiveEditor(n);i&&this.doCloseActiveEditor(t?.preserveFocus),e.length&&this.titleControl.closeEditors(e)}closeAllEditors(e){return this.isEmpty?(this.groupsView.partOptions.closeEmptyGroups&&this.groupsView.removeGroup(this),!0):e?.excludeConfirming?(this.doCloseAllEditors(e),!0):this.handleCloseConfirmation(this.model.getEditors(Ai.MOST_RECENTLY_ACTIVE,e)).then(t=>t?!1:(this.doCloseAllEditors(e),!0))}doCloseAllEditors(e){let t=this.model.getEditors(Ai.SEQUENTIAL,e);e?.excludeConfirming&&(t=t.filter(n=>!this.shouldConfirmClose(n)));const i=[];for(const n of t)this.isActive(n)||this.doCloseInactiveEditor(n),i.push(n);this.activeEditor&&i.includes(this.activeEditor)&&this.doCloseActiveEditor(),i.length&&this.titleControl.closeEditors(i)}async replaceEditors(e){let t;const i=[];for(let{editor:n,replacement:o,forceReplaceDirty:r,options:a}of e){const c=this.getIndexOfEditor(n);if(c>=0){const d=this.isActive(n);a?a.index=c:a={index:c},a.inactive=!d,a.pinned=a.pinned??!0;const l={editor:n,replacement:o,forceReplaceDirty:r,options:a};d?t=l:i.push(l)}}for(const{editor:n,replacement:o,forceReplaceDirty:r,options:a}of i)if(await this.doOpenEditor(o,a),!n.matches(o)){let c=!1;if(r?(this.doCloseEditor(n,!0,{context:Yd.REPLACE}),c=!0):c=await this.doCloseEditorWithConfirmationHandling(n,{preserveFocus:!0},{context:Yd.REPLACE}),!c)return}if(t){const n=this.doOpenEditor(t.replacement,t.options);t.editor.matches(t.replacement)||(t.forceReplaceDirty?this.doCloseEditor(t.editor,!0,{context:Yd.REPLACE}):await this.doCloseEditorWithConfirmationHandling(t.editor,{preserveFocus:!0},{context:Yd.REPLACE})),await n}}get isLocked(){return this.model.isLocked}lock(e){this.model.lock(e)}createEditorActions(e,t=N.EditorTitle){let i={primary:[],secondary:[]},n;const o=this.activeEditorPane;if(o instanceof Hu){const r=o.scopedContextKeyService??this.scopedContextKeyService,a=e.add(this.menuService.createMenu(t,r,{emitEventsForSubmenuChanges:!0,eventDebounceDelay:0}));n=a.onDidChange;const c=(d,l)=>l==="navigation"&&d.actions.length<=1;i=zm(a.getActions({arg:this.resourceContext.get(),shouldForwardArgs:!0}),"navigation",c)}else{const r=e.add(new M);n=r.event,e.add(this.onDidActiveEditorChange(()=>r.fire()))}return{actions:i,onDidChange:n}}updateStyles(){const e=this.isEmpty;e?this.element.style.backgroundColor=this.getColor(Sxe)||"":this.element.style.backgroundColor="";const t=this.getColor(xxe)||this.getColor(et);!e&&t?(this.titleContainer.classList.add("title-border-bottom"),this.titleContainer.style.setProperty("--title-border-bottom-color",t)):(this.titleContainer.classList.remove("title-border-bottom"),this.titleContainer.style.removeProperty("--title-border-bottom-color"));const{showTabs:i}=this.groupsView.partOptions;this.titleContainer.style.backgroundColor=this.getColor(i==="multiple"?joe:Exe)||"",this.editorContainer.style.backgroundColor=this.getColor(ts)||""}get minimumWidth(){return this.editorPane.minimumWidth}get minimumHeight(){return this.editorPane.minimumHeight}get maximumWidth(){return this.editorPane.maximumWidth}get maximumHeight(){return this.editorPane.maximumHeight}get proportionalLayout(){return this.lastLayout?!(this.lastLayout.width===this.minimumWidth||this.lastLayout.height===this.minimumHeight):!0}layout(e,t,i,n){this.lastLayout={width:e,height:t,top:i,left:n},this.element.classList.toggle("max-height-478px",t<=478);const o=this.titleControl.layout({container:new Ke(e,t),available:new Ke(e,t-this.editorPane.minimumHeight)});this.progressBar.getContainer().style.top=`${Math.max(this.titleHeight.offset-2,0)}px`;const r=Math.max(0,t-o.height);this.editorContainer.style.height=`${r}px`,this.editorPane.layout({width:e,height:r,top:i+o.height,left:n})}relayout(){if(this.lastLayout){const{width:e,height:t,top:i,left:n}=this.lastLayout;this.layout(e,t,i,n)}}setBoundarySashes(e){this.editorPane.setBoundarySashes(e)}toJSON(){return this.model.serialize()}dispose(){this._disposed=!0,this._onWillDispose.fire(),super.dispose()}};KP=Gg=f([p(6,J),p(7,me),p(8,ft),p(9,li),p(10,Ve),p(11,tn),p(12,mi),p(13,js),p(14,de),p(15,Ns),p(16,Zi),p(17,Pe),p(18,vf),p(19,Wn),p(20,Qt),p(21,Xe)],KP);var XS;Be(U1e);const jP=Y;let mv=class extends Ix{static{XS=this}static{this.DEFAULT_VISIBLE_OPEN_EDITORS=9}static{this.DEFAULT_MIN_VISIBLE_OPEN_EDITORS=0}static{this.ID="workbench.explorer.openEditorsView"}static{this.NAME=I(7302,"Open Editors")}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){super(e,a,n,r,c,i,t,v,d,u),this.editorGroupService=o,this.telemetryService=l,this.workingCopyService=g,this.filesConfigurationService=m,this.fileService=y,this.needsRefresh=!1,this.elements=[],this.blockFocusActiveEditorTracking=!1,this.structuralRefreshDelay=0,this.sortOrder=r.getValue("explorer.openEditors.sortOrder"),this.registerUpdateEvents(),this._register(this.configurationService.onDidChangeConfiguration(w=>this.onConfigurationChange(w))),this._register(this.workingCopyService.onDidChangeDirty(w=>this.updateDirtyIndicator(w)))}registerUpdateEvents(){const e=()=>{if(!this.isBodyVisible()||!this.list){this.needsRefresh=!0;return}this.listRefreshScheduler?.schedule(this.structuralRefreshDelay)},t=this._register(new ei),i=n=>{const o=n.onDidModelChange(r=>{if(this.listRefreshScheduler?.isScheduled())return;if(!this.isBodyVisible()||!this.list){this.needsRefresh=!0;return}const a=this.getIndex(n,r.editor);switch(r.kind){case ct.EDITOR_ACTIVE:this.focusActiveEditor();break;case ct.GROUP_INDEX:case ct.GROUP_LABEL:a>=0&&this.list.splice(a,1,[n]);break;case ct.EDITOR_DIRTY:case ct.EDITOR_STICKY:case ct.EDITOR_CAPABILITIES:case ct.EDITOR_PIN:case ct.EDITOR_LABEL:this.list.splice(a,1,[new Gn(r.editor,n)]),this.focusActiveEditor();break;case ct.EDITOR_OPEN:case ct.EDITOR_MOVE:case ct.EDITOR_CLOSE:e();break}});t.set(n.id,o)};this.editorGroupService.groups.forEach(n=>i(n)),this._register(this.editorGroupService.onDidAddGroup(n=>{i(n),e()})),this._register(this.editorGroupService.onDidMoveGroup(()=>e())),this._register(this.editorGroupService.onDidChangeActiveGroup(()=>this.focusActiveEditor())),this._register(this.editorGroupService.onDidRemoveGroup(n=>{t.deleteAndDispose(n.id),e()}))}renderHeaderTitle(e){super.renderHeaderTitle(e,this.title);const t=ee(e,jP(".open-editors-dirty-count-container"));this.dirtyCountElement=ee(t,jP(".dirty-count.monaco-count-badge.long")),this.dirtyCountElement.style.backgroundColor=gt(JM),this.dirtyCountElement.style.color=gt(Lq),this.dirtyCountElement.style.border=`1px solid ${gt(et)}`,this.updateDirtyIndicator()}renderBody(e){super.renderBody(e),e.classList.add("open-editors"),e.classList.add("show-file-icons");const t=new jC;this.list&&this.list.dispose(),this.listLabels&&this.listLabels.clear(),this.dnd=new o2(this.sortOrder,this.instantiationService,this.editorGroupService),this.listLabels=this.instantiationService.createInstance(vd,{onDidChangeVisibility:this.onDidChangeBodyVisibility}),this.list=this.instantiationService.createInstance(Pne,"OpenEditors",e,t,[new h1(this.keybindingService,this.instantiationService),new u1(this.listLabels,this.instantiationService,this.keybindingService,this.configurationService)],{identityProvider:{getId:o=>o instanceof Gn?o.getId():o.id.toString()},dnd:this.dnd,overrideStyles:this.getLocationBasedColors().listOverrideStyles,accessibilityProvider:new M0e}),this._register(this.list),this._register(this.listLabels);let i=[];this.listRefreshScheduler=this._register(new fn(()=>{if(!this.list)return;i=Qe(i);const o=this.list.length,r=this.getElements();this.list.splice(0,this.list.length,r),this.focusActiveEditor(),o!==this.list.length&&this.updateSize(),this.needsRefresh=!1,(this.sortOrder==="alphabetical"||this.sortOrder==="fullPath")&&r.forEach(a=>{a instanceof Gn&&i.push(a.editor.onDidChangeLabel(()=>this.listRefreshScheduler?.schedule()))})},this.structuralRefreshDelay)),this.updateSize(),this.handleContextKeys(),this._register(this.list.onContextMenu(o=>this.onListContextMenu(o))),this._register(this.list.onMouseMiddleClick(o=>{if(o&&o.element instanceof Gn){if(iz(o.element.group,o.element.editor,nz.MOUSE,this.editorGroupService.partOptions))return;o.element.group.closeEditor(o.element.editor,{preserveFocus:!0})}})),this._register(this.list.onDidOpen(o=>{const r=o.element;if(r)if(r instanceof Gn){if(hp(o.browserEvent)&&o.browserEvent.button===1)return;this.withActiveEditorFocusTrackingDisabled(()=>{this.openEditor(r,{preserveFocus:o.editorOptions.preserveFocus,pinned:o.editorOptions.pinned,sideBySide:o.sideBySide})})}else this.withActiveEditorFocusTrackingDisabled(()=>{this.editorGroupService.activateGroup(r),o.editorOptions.preserveFocus||r.focus()});else return})),this.listRefreshScheduler.schedule(0),this._register(this.onDidChangeBodyVisibility(o=>{o&&this.needsRefresh&&this.listRefreshScheduler?.schedule(0)}));const n=this.viewDescriptorService.getViewContainerModel(this.viewDescriptorService.getViewContainerByViewId(this.id));this._register(n.onDidChangeAllViewDescriptors(()=>{this.updateSize()}))}handleContextKeys(){if(!this.list)return;wCe.bindTo(this.list.contextKeyService),aoe.bindTo(this.list.contextKeyService);const e=h_.bindTo(this.contextKeyService),t=zO.bindTo(this.contextKeyService),i=l4.bindTo(this.contextKeyService),n=Yle.bindTo(this.contextKeyService),o=this.instantiationService.createInstance(pi);this._register(o),this._register(this.list.onDidChangeFocus(r=>{o.reset(),e.reset(),t.reset(),i.reset();const a=r.elements.length?r.elements[0]:void 0;if(a instanceof Gn){const c=a.getResource();t.set(a.editor.isDirty()&&!a.editor.isSaving()),i.set(!!a.editor.isReadonly()),o.set(c??null)}else a&&e.set(!0)})),this._register(this.list.onDidChangeSelection(r=>{const a=r.elements.every(c=>{if(c instanceof Gn){const d=c.getResource();return d&&(d.scheme===ae.untitled||this.fileService.hasProvider(d))}return!1});n.set(a)}))}focus(){super.focus(),this.list?.domFocus()}layoutBody(e,t){super.layoutBody(e,t),this.list?.layout(e,t)}get showGroups(){return this.editorGroupService.groups.length>1}getElements(){return this.elements=[],this.editorGroupService.getGroups(Ko.GRID_APPEARANCE).forEach(e=>{this.showGroups&&this.elements.push(e);let t=e.editors.map(i=>new Gn(i,e));this.sortOrder==="alphabetical"?t=t.sort((i,n)=>MF(i.editor.getName(),n.editor.getName())):this.sortOrder==="fullPath"&&(t=t.sort((i,n)=>{const o=i.editor.resource,r=n.editor.resource;if(o===void 0&&r===void 0)return MF(i.editor.getName(),n.editor.getName());if(o===void 0)return-1;if(r===void 0)return 1;{const a=o.scheme,c=r.scheme;return a!==ae.file&&c!==ae.file?A7.compare(o,r):a!==ae.file?-1:c!==ae.file?1:A7.compare(o,r)}})),this.elements.push(...t)}),this.elements}getIndex(e,t){return t?this.elements.findIndex(i=>i instanceof Gn&&i.editor===t&&i.group.id===e.id):this.elements.findIndex(i=>!(i instanceof Gn)&&i.id===e.id)}openEditor(e,t){e&&(this.telemetryService.publicLog2("workbenchActionExecuted",{id:"workbench.files.openFile",from:"openEditors"}),t.sideBySide&&t.preserveFocus||this.editorGroupService.activateGroup(e.group),(t.sideBySide?this.editorGroupService.sideGroup:e.group).openEditor(e.editor,t))}onListContextMenu(e){if(!e.element)return;const t=e.element;this.contextMenuService.showContextMenu({menuId:N.OpenEditorsContext,menuActionOptions:{shouldForwardArgs:!0,arg:t instanceof Gn?xi.getOriginalUri(t.editor):{}},contextKeyService:this.list?.contextKeyService,getAnchor:()=>e.anchor,getActionsContext:()=>t instanceof Gn?{groupId:t.groupId,editorIndex:t.group.getIndexOfEditor(t.editor)}:{groupId:t.id}})}withActiveEditorFocusTrackingDisabled(e){this.blockFocusActiveEditorTracking=!0;try{e()}finally{this.blockFocusActiveEditorTracking=!1}}focusActiveEditor(){if(!(!this.list||this.blockFocusActiveEditorTracking)){if(this.list.length&&this.editorGroupService.activeGroup){const e=this.getIndex(this.editorGroupService.activeGroup,this.editorGroupService.activeGroup.activeEditor);if(e>=0){try{this.list.setFocus([e]),this.list.setSelection([e]),this.list.reveal(e)}catch{}return}}this.list.setFocus([]),this.list.setSelection([])}}onConfigurationChange(e){e.affectsConfiguration("explorer.openEditors")&&this.updateSize(),(e.affectsConfiguration("explorer.decorations")||e.affectsConfiguration("explorer.openEditors.sortOrder"))&&(this.sortOrder=this.configurationService.getValue("explorer.openEditors.sortOrder"),this.dnd&&(this.dnd.sortOrder=this.sortOrder),this.listRefreshScheduler?.schedule())}updateSize(){this.minimumBodySize=this.orientation===wt.VERTICAL?this.getMinExpandedBodySize():170,this.maximumBodySize=this.orientation===wt.VERTICAL?this.getMaxExpandedBodySize():Number.POSITIVE_INFINITY}updateDirtyIndicator(e){if(e&&e.isDirty()&&!(e.capabilities&NE.Untitled)&&this.filesConfigurationService.hasShortAutoSaveDelay(e.resource))return;const t=this.workingCopyService.dirtyCount;t===0?this.dirtyCountElement.classList.add("hidden"):(this.dirtyCountElement.textContent=h(7303,"{0} unsaved",t),this.dirtyCountElement.classList.remove("hidden"))}get elementCount(){return this.editorGroupService.groups.map(e=>e.count).reduce((e,t)=>e+t,this.showGroups?this.editorGroupService.groups.length:0)}getMaxExpandedBodySize(){let e=this.configurationService.getValue("explorer.openEditors.minVisible");return typeof e!="number"&&(e=XS.DEFAULT_MIN_VISIBLE_OPEN_EDITORS),this.viewDescriptorService.getViewContainerModel(this.viewDescriptorService.getViewContainerByViewId(this.id)).visibleViewDescriptors.length<=1?Number.POSITIVE_INFINITY:Math.max(this.elementCount,e)*jC.ITEM_HEIGHT}getMinExpandedBodySize(){let e=this.configurationService.getValue("explorer.openEditors.visible");return typeof e!="number"&&(e=XS.DEFAULT_VISIBLE_OPEN_EDITORS),this.computeMinExpandedBodySize(e)}computeMinExpandedBodySize(e=XS.DEFAULT_VISIBLE_OPEN_EDITORS){return Math.min(Math.max(e,1),this.elementCount)*jC.ITEM_HEIGHT}setStructuralRefreshDelay(e){this.structuralRefreshDelay=e}getOptimalWidth(){if(!this.list)return super.getOptimalWidth();const e=this.list.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".open-editor > a"));return Lne(e,t)}};mv=XS=f([p(1,J),p(2,Os),p(3,mi),p(4,Ie),p(5,ne),p(6,Ve),p(7,me),p(8,ft),p(9,li),p(10,wi),p(11,vg),p(12,Ns),p(13,hi),p(14,Xe)],mv);class L0e extends _g{async run(e){if(this.editor)return super.run(e,{groupId:this.editor.groupId,editorIndex:this.editor.group.getIndexOfEditor(this.editor.editor)})}}class jC{static{this.ITEM_HEIGHT=22}getHeight(e){return jC.ITEM_HEIGHT}getTemplateId(e){return e instanceof Gn?u1.ID:h1.ID}}class h1{static{this.ID="editorgroup"}constructor(e,t){this.keybindingService=e,this.instantiationService=t}get templateId(){return h1.ID}renderTemplate(e){const t=Object.create(null);t.root=ee(e,jP(".editor-group")),t.name=ee(t.root,jP("span.name")),t.actionBar=new Er(e);const i=this.instantiationService.createInstance(V0,V0.ID,V0.LABEL),n=this.keybindingService.lookupKeybinding(i.id);t.actionBar.push(i,{icon:!0,label:!1,keybinding:n?n.getLabel():void 0});const o=this.instantiationService.createInstance($C,$C.ID,$C.LABEL),r=this.keybindingService.lookupKeybinding(o.id);return t.actionBar.push(o,{icon:!0,label:!1,keybinding:r?r.getLabel():void 0}),t}renderElement(e,t,i){i.editorGroup=e,i.name.textContent=e.label,i.actionBar.context={groupId:e.id}}disposeTemplate(e){e.actionBar.dispose()}}class u1{static{this.ID="openeditor"}constructor(e,t,i,n){this.labels=e,this.instantiationService=t,this.keybindingService=i,this.configurationService=n,this.closeEditorAction=this.instantiationService.createInstance(qC,qC.ID,qC.LABEL),this.unpinEditorAction=this.instantiationService.createInstance(Ap,Ap.ID,Ap.LABEL)}get templateId(){return u1.ID}renderTemplate(e){const t=Object.create(null);return t.container=e,t.actionRunner=new L0e,t.actionBar=new Er(e,{actionRunner:t.actionRunner}),t.root=this.labels.create(e),t}renderElement(e,t,i){const n=e.editor;i.actionRunner.editor=e,i.container.classList.toggle("dirty",n.isDirty()&&!n.isSaving()),i.container.classList.toggle("sticky",e.isSticky()),i.root.setResource({resource:xi.getOriginalUri(n,{supportSideBySide:Ut.BOTH}),name:n.getName(),description:n.getDescription(Nt.MEDIUM)},{italic:e.isPreview(),extraClasses:["open-editor"].concat(e.editor.getLabelExtraClasses()),fileDecorations:this.configurationService.getValue().explorer.decorations,title:n.getTitle(Nt.LONG),icon:n.getIcon()});const o=e.isSticky()?this.unpinEditorAction:this.closeEditorAction;i.actionBar.hasAction(o)||(i.actionBar.isEmpty()||i.actionBar.clear(),i.actionBar.push(o,{icon:!0,label:!1,keybinding:this.keybindingService.lookupKeybinding(o.id)?.getLabel()}))}disposeTemplate(e){e.actionBar.dispose(),e.root.dispose(),e.actionRunner.dispose()}}class o2{set sortOrder(e){this._sortOrder=e}constructor(e,t,i){this.instantiationService=t,this.editorGroupService=i,this._sortOrder=e}get dropHandler(){return this.instantiationService.createInstance(NP,{allowWorkspaceOpen:!1})}getDragURI(e){if(e instanceof Gn){const t=e.getResource();if(t)return t.toString()}return null}getDragLabel(e){if(e.length>1)return String(e.length);const t=e[0];return t instanceof Gn?t.editor.getName():t.label}onDragStart(e,t){const i=e.elements,n=[];if(i)for(const o of i)o instanceof Gn&&n.push(o);n.length&&this.instantiationService.invokeFunction(pg,n,t)}onDragOver(e,t,i,n,o){if(e instanceof NF&&!Eo(o,bs.FILES,io.FILES))return!1;if(this._sortOrder!=="editorOrder")return e instanceof R7?!1:{accept:!0,effect:{type:$_.Move},feedback:[-1]};let r;switch(n){case jr.TOP:case jr.CENTER_TOP:r=i===0&&t instanceof KP?am.After:am.Before;break;case jr.CENTER_BOTTOM:case jr.BOTTOM:r=am.After;break}return{accept:!0,effect:{type:$_.Move,position:r},feedback:[i]}}drop(e,t,i,n,o){let r=t instanceof Gn?t.group:t||this.editorGroupService.groups[this.editorGroupService.count-1],a=t instanceof Gn?t.group.getIndexOfEditor(t.editor):0;switch(n){case jr.TOP:case jr.CENTER_TOP:t instanceof KP&&r.index!==0&&(r=this.editorGroupService.groups[r.index-1],a=r.count);break;case jr.BOTTOM:case jr.CENTER_BOTTOM:t instanceof Gn&&a++;break}if(e instanceof R7){for(const c of e.elements){const d=c.group.getIndexOfEditor(c.editor);c.group===r&&d<a&&a--,c.group.moveEditor(c.editor,r,{index:a,preserveFocus:!0}),a++}this.editorGroupService.activateGroup(r)}else this.dropHandler.handleDrop(o,$i,()=>r,()=>r.focus(),{index:a})}dispose(){}}o2.__decorator=f([Ht],o2.prototype,"dropHandler",null);class M0e{getWidgetAriaLabel(){return h(7302,"Open Editors")}getAriaLabel(e){return e instanceof Gn?`${e.editor.getName()}, ${e.editor.getDescription()}`:e.ariaLabel}}const N0e="workbench.action.toggleEditorGroupLayout";K(class extends X{constructor(){super({id:"workbench.action.toggleEditorGroupLayout",title:I(7304,"Toggle Vertical/Horizontal Editor Layout"),f1:!0,keybinding:{primary:E.Shift|E.Alt|S.Digit0,mac:{primary:E.CtrlCmd|E.Alt|S.Digit0},weight:W.WorkbenchContrib},icon:j.editorLayout,menu:{id:N.ViewTitle,group:"navigation",when:x.and(x.equals("view",mv.ID),vN),order:10}})}async run(s){const e=s.get(Ie),t=e.orientation===rc.VERTICAL?rc.HORIZONTAL:rc.VERTICAL;e.setGroupOrientation(t),e.activeGroup.focus()}});ge.appendMenuItem(N.MenubarLayoutMenu,{group:"5_flip",command:{id:N0e,title:{...I(7305,"Flip Layout"),mnemonicTitle:h(7306,"Flip &&Layout")}},order:1});K(class extends X{constructor(){super({id:"workbench.action.files.saveAll",title:qNe,f1:!0,icon:j.saveAll,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",mv.ID),order:20}})}async run(s){await s.get(qe).executeCommand(d4)}});K(class extends X{constructor(){super({id:"openEditors.closeAll",title:Ex.LABEL,f1:!1,icon:j.closeAll,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",mv.ID),order:30}})}async run(s){const e=s.get(J),t=new Ex;await e.invokeFunction(i=>t.run(i))}});K(class extends X{constructor(){super({id:"openEditors.newUntitledFile",title:I(7307,"New Untitled Text File"),f1:!1,icon:j.newFile,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",mv.ID),order:5}})}async run(s){await s.get(qe).executeCommand(tS)}});async function I4(s,e){const t=s.get(Ie),i=s.get(Ot),n=s.get(Ds);let o=Phe(s);if(!o){const a=t.activeGroup;a.activeEditor&&(o=[],a.activeEditor instanceof ws&&!e?.saveAs&&!(a.activeEditor.primary.hasCapability(Ze.Untitled)||a.activeEditor.secondary.hasCapability(Ze.Untitled))&&a.activeEditor.secondary.isModified()?(o.push({groupId:a.id,editor:a.activeEditor.primary}),o.push({groupId:a.id,editor:a.activeEditor.secondary})):o.push({groupId:a.id,editor:a.activeEditor}))}if(!o||o.length===0)return;await D4(s,o,e);const r=i.getFocusedCodeEditor();if(r instanceof pd&&!r.isSimpleWidget){const a=r.getModel()?.uri;a&&!o.some(({editor:c})=>Dt(xi.getCanonicalUri(c,{supportSideBySide:Ut.PRIMARY}),a))&&(n.files.get(a)?.isReadonly()||await n.save(a,e))}}function vue(s,e,t){const i=[];for(const n of e)for(const o of n.getEditors(Ai.MOST_RECENTLY_ACTIVE))o.isDirty()&&i.push({groupId:n.id,editor:o});return D4(s,i,t)}async function D4(s,e,t){const i=s.get(de),n=s.get(At),o=s.get(J);try{await i.save(e,t)}catch(r){if(!gs(r)){const a=[Ci({id:"workbench.action.files.saveEditors",label:h(7119,"Retry"),run:()=>o.invokeFunction(d=>D4(d,e,t))})],c=e.filter(({editor:d})=>!d.hasCapability(Ze.Untitled));c.length>0&&a.push(Ci({id:"workbench.action.files.revertEditors",label:c.length>1?h(7120,"Revert All"):h(7121,"Revert"),run:()=>i.revert(c)})),n.notify({id:e.map(({editor:d})=>cc(d.resource?.toString())).join(),severity:Me.Error,message:h(7122,"Failed to save '{0}': {1}",e.map(({editor:d})=>d.getName()).join(", "),ho(r,!1)),actions:{primary:a}})}}}Le.registerCommandAndKeybindingRule({when:void 0,weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyS,id:GO,handler:s=>I4(s,{reason:ui.EXPLICIT,force:!0})});Le.registerCommandAndKeybindingRule({when:void 0,weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyS),win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyS)},id:Kle,handler:s=>I4(s,{reason:ui.EXPLICIT,force:!0,skipSaveParticipants:!0})});Le.registerCommandAndKeybindingRule({id:c4,weight:W.WorkbenchContrib,when:void 0,primary:E.CtrlCmd|E.Shift|S.KeyS,handler:s=>I4(s,{reason:ui.EXPLICIT,saveAs:!0})});Le.registerCommandAndKeybindingRule({when:void 0,weight:W.WorkbenchContrib,primary:void 0,mac:{primary:E.CtrlCmd|E.Alt|S.KeyS},win:{primary:lt(E.CtrlCmd|S.KeyK,S.KeyS)},id:d4,handler:s=>vue(s,s.get(Ie).getGroups(Ko.MOST_RECENTLY_ACTIVE),{reason:ui.EXPLICIT})});Ce.registerCommand({id:qO,handler:(s,e,t)=>{const i=s.get(Ie),n=Rs([t],s.get(de),i,s.get(Si));let o;return n.groupedEditors.length?o=n.groupedEditors.map(({group:r})=>r):o=i.getGroups(Ko.MOST_RECENTLY_ACTIVE),vue(s,o,{reason:ui.EXPLICIT})}});Ce.registerCommand({id:jle,handler:async s=>(await s.get(de).saveAll({includeUntitled:!1,reason:ui.EXPLICIT})).success});Ce.registerCommand({id:$O,handler:async s=>{const e=s.get(Ie),t=s.get(de);let i=Phe(s);if(!i){const n=e.activeGroup;n.activeEditor&&(i=[{groupId:n.id,editor:n.activeEditor}])}if(!(!i||i.length===0))try{await t.revert(i.filter(({editor:n})=>!n.hasCapability(Ze.Untitled)),{force:!0})}catch(n){s.get(At).error(h(7123,"Failed to revert '{0}': {1}",i.map(({editor:r})=>r.getName()).join(", "),ho(n,!1)))}}});const O0e=(s,e,t)=>{if(Array.isArray(e)){const i=s.get(Wn),n=s.get(po);e=e.map(o=>OF(o)&&o.workspaceUri.scheme===ae.untitled?{workspaceUri:xt(n.untitledWorkspacesHome,o.workspaceUri.path,F_e)}:o),i.openWindow(e,t)}},F0e=(s,e)=>{s.get(Wn).openWindow(e)};Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:SCe,primary:E.CtrlCmd|S.Enter,mac:{primary:E.WinCtrl|S.Enter},id:Vle,handler:async(s,e)=>{const t=s.get(de),i=s.get(Xe),n=s.get(Qi),o=hD(e,s.get(Si),t,s.get(Ie),n);if(o.length){const r=o.filter(u=>u.scheme===ae.untitled),a=o.filter(u=>u.scheme!==ae.untitled),l=(await Promise.all(a.map(async u=>{const g=n.findClosest(u);return g||await i.stat(u)}))).filter(u=>!u.isDirectory).map(u=>({resource:u.resource,options:{pinned:!0}})).concat(...r.map(u=>({resource:u,options:{pinned:!0}})));await t.openEditors(l,xr)}}});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Aa,uo.toNegated()),primary:S.Enter,mac:{primary:E.CtrlCmd|S.DownArrow},id:"explorer.openAndPassFocus",handler:async(s,e)=>{const t=s.get(de),n=s.get(Qi).getContext(!0);n.length&&await t.openEditors(n.map(o=>({resource:o.resource,options:{preserveFocus:!1,pinned:!0}})))}});const U0="showModifications";let Fg=[];Le.registerCommandAndKeybindingRule({id:a4,when:void 0,weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyD),handler:async(s,e)=>{const t=s.get(J),i=s.get(yi),n=s.get(de),o=s.get(Xe),r=s.get(Si);let a=!1;if(Fg.length===0){a=!0;const d=t.createInstance(aA);Fg.push(d),Fg.push(i.registerTextModelContentProvider(U0,d))}const c=nS(e,n,r);if(c&&o.hasProvider(c)){const d=je(c),l=h(7124,"{0} (in file) ↔ {1}",d,d);try{await aA.open(c,U0,l,n,{pinned:!0}),a&&Fg.push(n.onDidVisibleEditorsChange(()=>{n.editors.some(u=>!!xi.getCanonicalUri(u,{supportSideBySide:Ut.SECONDARY,filterByScheme:U0}))||(Fg=Qe(Fg))}))}catch{Fg=Qe(Fg)}}}});let r2,$0;Ce.registerCommand({id:Ule,handler:(s,e)=>{r2=nS(e,s.get(de),s.get(Si)),$0||($0=h4.bindTo(s.get(me))),$0.set(!0)}});Ce.registerCommand({id:$le,handler:async(s,e)=>{const t=s.get(de),i=hD(e,s.get(Si),t,s.get(Ie),s.get(Qi));return i.length===2?t.openEditor({original:{resource:i[0]},modified:{resource:i[1]},options:{pinned:!0}}):!0}});Ce.registerCommand({id:Gle,handler:(s,e)=>{const t=s.get(de),i=nS(e,t,s.get(Si));r2&&i&&t.openEditor({original:{resource:r2},modified:{resource:i},options:{pinned:!0}})}});async function k4(s,e,t,i,n){if(s.length){const o=pn?`\r
`:`
`;let r;const a=e?"explorer.copyRelativePathSeparator":"explorer.copyPathSeparator",c=n.getValue(a);(c==="/"||c==="\\")&&(r=c);const d=s.map(l=>i.getUriLabel(l,{relative:e,noPrefix:!0,separator:r})).join(o);await t.writeText(d)}}const _ue=async(s,e)=>{const t=hD(e,s.get(Si),s.get(de),s.get(Ie),s.get(Qi));await k4(t,!1,s.get(Is),s.get(di),s.get(ne))};Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus.toNegated(),primary:E.CtrlCmd|E.Alt|S.KeyC,win:{primary:E.Shift|E.Alt|S.KeyC},id:cD,handler:_ue});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Alt|S.KeyC),win:{primary:E.Shift|E.Alt|S.KeyC},id:cD,handler:_ue});const bue=async(s,e)=>{const t=hD(e,s.get(Si),s.get(de),s.get(Ie),s.get(Qi));await k4(t,!0,s.get(Is),s.get(di),s.get(ne))};Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus.toNegated(),primary:E.CtrlCmd|E.Shift|E.Alt|S.KeyC,win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyC)},id:dD,handler:bue});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|E.Alt|S.KeyC),win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyC)},id:dD,handler:bue});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.KeyP),id:"workbench.action.files.copyPathOfActiveFile",handler:async s=>{const t=s.get(de).activeEditor,i=xi.getOriginalUri(t,{supportSideBySide:Ut.PRIMARY});await k4(i?[i]:[],!1,s.get(Is),s.get(di),s.get(ne))}});Ce.registerCommand({id:r4,handler:async(s,e)=>{const t=s.get(mo),i=s.get(Tt),n=s.get(Qi),o=s.get(de),r=s.get(Si),a=nS(e,o,r);if(a&&i.isInsideWorkspace(a)){const c=await t.openView(hd,!1);if(c){const d=c.autoReveal;c.autoReveal=!1,c.setExpanded(!0),await n.select(a,"force"),c.focus(),c.autoReveal=d}}else{const c=t.getViewWithId(mv.ID);c&&(c.setExpanded(!0),c.focus())}}});Ce.registerCommand({id:Hle,handler:async(s,e)=>{const t=s.get(de),i=s.get(Si),n=nS(e,t,i);if(n)return t.openEditor({resource:n,options:{override:jT.PICK,source:eN.USER}})}});Ce.registerCommand({id:Qle,handler:(s,e)=>{const t=s.get(Tt),i=s.get(Zi),n=t.getWorkspace(),o=hD(e,s.get(Si),s.get(de),s.get(Ie),s.get(Qi)).filter(a=>n.folders.some(c=>i.extUri.isEqual(c.uri,a)));return o.length===0?s.get(qe).executeCommand(s1.ID):s.get(uc).removeFolders(o)}});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Aa,mI,sz.negate()),primary:S.LeftArrow,id:KNe,handler:s=>{const t=s.get(aa).getActivePaneComposite(Fe.Sidebar);if(t?.getId()!==pI)return;t.getViewPaneContainer().getExplorerView().previousCompressedStat()}});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Aa,mI,oz.negate()),primary:S.RightArrow,id:jNe,handler:s=>{const t=s.get(aa).getActivePaneComposite(Fe.Sidebar);if(t?.getId()!==pI)return;t.getViewPaneContainer().getExplorerView().nextCompressedStat()}});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Aa,mI,sz.negate()),primary:S.Home,id:YNe,handler:s=>{const t=s.get(aa).getActivePaneComposite(Fe.Sidebar);if(t?.getId()!==pI)return;t.getViewPaneContainer().getExplorerView().firstCompressedStat()}});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Aa,mI,oz.negate()),primary:S.End,id:QNe,handler:s=>{const t=s.get(aa).getActivePaneComposite(Fe.Sidebar);if(t?.getId()!==pI)return;t.getViewPaneContainer().getExplorerView().lastCompressedStat()}});Le.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:null,primary:$t?pn?lt(E.CtrlCmd|S.KeyK,S.KeyN):E.CtrlCmd|E.Alt|S.KeyN:E.CtrlCmd|S.KeyN,secondary:$t?[E.CtrlCmd|S.KeyN]:void 0,id:tS,metadata:{description:Xle,args:[{isOptional:!0,name:"New Untitled Text File arguments",description:"The editor view type or language ID if known",schema:{type:"object",properties:{viewType:{type:"string"},languageId:{type:"string"}}}}]},handler:async(s,e)=>{await s.get(de).openEditor({resource:void 0,options:{override:e?.viewType,pinned:!0},languageId:e?.languageId})}});Ce.registerCommand({id:XNe,handler:async(s,e)=>{const t=s.get(de),i=s.get(js),n=s.get(Xe),o=h(7125,"Create File"),r=xt(await i.defaultFilePath(),e?.fileName??"Untitled.txt"),a=await i.showSaveDialog({saveLabel:o,title:o,defaultUri:r});a&&(await n.createFile(a,void 0,{overwrite:!0}),await t.openEditor({resource:a,options:{override:e?.viewType,pinned:!0},languageId:e?.languageId}))}});K(xP);K(IP);K(DP);K(GC);K(TP);K(XO);K(kP);K(AP);K(RP);K(PP);K(LP);Ce.registerCommand("_files.windowOpen",O0e);Ce.registerCommand("_files.newWindow",F0e);const Lg=10,yue="renameFile";Le.registerCommandAndKeybindingRule({id:yue,weight:W.WorkbenchContrib+Lg,when:x.and(Aa,Cd.toNegated(),Bh),primary:S.F2,mac:{primary:S.Enter},handler:E1e});const wue="moveFileToTrash";Le.registerCommandAndKeybindingRule({id:wue,weight:W.WorkbenchContrib+Lg,when:x.and(Aa,vI),primary:S.Delete,mac:{primary:E.CtrlCmd|S.Backspace,secondary:[S.Delete]},handler:x1e});const g1="deleteFile";Le.registerCommandAndKeybindingRule({id:g1,weight:W.WorkbenchContrib+Lg,when:Aa,primary:E.Shift|S.Delete,mac:{primary:E.CtrlCmd|E.Alt|S.Backspace},handler:khe});Le.registerCommandAndKeybindingRule({id:g1,weight:W.WorkbenchContrib+Lg,when:x.and(Aa,vI.toNegated()),primary:S.Delete,mac:{primary:E.CtrlCmd|S.Backspace},handler:khe});const Sue="filesExplorer.cut";Le.registerCommandAndKeybindingRule({id:Sue,weight:W.WorkbenchContrib+Lg,when:x.and(Aa,Cd.toNegated(),Bh),primary:E.CtrlCmd|S.KeyX,handler:D1e});const Cue="filesExplorer.copy";Le.registerCommandAndKeybindingRule({id:Cue,weight:W.WorkbenchContrib+Lg,when:x.and(Aa,Cd.toNegated()),primary:E.CtrlCmd|S.KeyC,handler:I1e});const T4="filesExplorer.paste";Ce.registerCommand(T4,A1e);Le.registerKeybindingRule({id:`^${T4}`,weight:W.WorkbenchContrib+Lg,when:x.and(Aa,Bh),primary:E.CtrlCmd|S.KeyV});Le.registerCommandAndKeybindingRule({id:"filesExplorer.cancelCut",weight:W.WorkbenchContrib+Lg,when:x.and(Aa,coe),primary:S.Escape,handler:async s=>{await s.get(Qi).setToCopy([],!0)}});Le.registerCommandAndKeybindingRule({id:"filesExplorer.openFilePreserveFocus",weight:W.WorkbenchContrib+Lg,when:x.and(Aa,uo.toNegated()),primary:S.Space,handler:P1e});const pD={id:cD,title:h(6988,"Copy Path")},fD={id:dD,title:h(6989,"Copy Relative Path")},Tx={id:r4,title:h(6990,"Reveal in Explorer View")};A4(cD,pD.title,pi.IsFileSystemResource,"1_cutcopypaste",!0);A4(dD,fD.title,pi.IsFileSystemResource,"1_cutcopypaste",!0);A4(Tx.id,Tx.title,pi.IsFileSystemResource,"2_files",!1,1);function A4(s,e,t,i,n,o){const r=n!==!0?noe.negate():void 0;ge.appendMenuItem(N.EditorTitleContext,{command:{id:s,title:e,precondition:r},when:t,group:i,order:o})}Eue("workbench.files.action.acceptLocalChanges",h(6991,"Use your changes and overwrite file contents"),j.check,-10,B1e);Eue("workbench.files.action.revertLocalChanges",h(6992,"Discard your changes and revert to file contents"),j.discard,-9,V1e);function Eue(s,e,t,i,n){Ce.registerCommand(s,n),ge.appendMenuItem(N.EditorTitle,{command:{id:s,title:e,icon:t},when:x.equals(The,!0),group:"navigation",order:i})}function Td({id:s,title:e,category:t,metadata:i},n){ge.appendMenuItem(N.CommandPalette,{command:{id:s,title:e,category:t,metadata:i},when:n})}Td({id:cD,title:I(6993,"Copy Path of Active File"),category:te.File});Td({id:dD,title:I(6994,"Copy Relative Path of Active File"),category:te.File});Td({id:GO,title:zle,category:te.File});Td({id:Kle,title:GNe,category:te.File});Td({id:qO,title:I(6995,"Save All in Group"),category:te.File});Td({id:jle,title:I(6996,"Save All Files"),category:te.File});Td({id:$O,title:I(6997,"Revert File"),category:te.File});Td({id:a4,title:I(6998,"Compare Active File with Saved"),category:te.File,metadata:{description:I(6999,"Opens a new diff editor to compare the active file with the version on disk.")}});Td({id:c4,title:qle,category:te.File});Td({id:lD,title:_he,category:te.File},bN.notEqualsTo("0"));Td({id:QO,title:bhe,category:te.File,metadata:{description:I(7e3,"Create a new folder or directory")}},bN.notEqualsTo("0"));Td({id:tS,title:Xle,category:te.File});const R4=x.or(pi.IsFileSystemResource,pi.Scheme.isEqualTo(ae.untitled)),p1={id:Vle,title:h(7001,"Open to the Side")};ge.appendMenuItem(N.OpenEditorsContext,{group:"navigation",order:10,command:p1,when:R4});ge.appendMenuItem(N.OpenEditorsContext,{group:"1_open",order:10,command:{id:phe,title:h(7002,"Reopen Editor With...")},when:x.and(fI,h_.toNegated())});ge.appendMenuItem(N.OpenEditorsContext,{group:"1_cutcopypaste",order:10,command:pD,when:pi.IsFileSystemResource});ge.appendMenuItem(N.OpenEditorsContext,{group:"1_cutcopypaste",order:20,command:fD,when:pi.IsFileSystemResource});ge.appendMenuItem(N.OpenEditorsContext,{group:"2_save",order:10,command:{id:GO,title:zle,precondition:zO},when:x.or(pi.Scheme.isEqualTo(ae.untitled),x.and(h_.toNegated(),l4.toNegated(),rz.toNegated()))});ge.appendMenuItem(N.OpenEditorsContext,{group:"2_save",order:20,command:{id:$O,title:h(6997,"Revert File"),precondition:zO},when:x.and(h_.toNegated(),l4.toNegated(),pi.Scheme.notEqualsTo(ae.untitled),rz.toNegated())});ge.appendMenuItem(N.OpenEditorsContext,{group:"2_save",order:30,command:{id:qO,title:h(7003,"Save All"),precondition:doe},when:h_});ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:10,command:{id:a4,title:h(7004,"Compare with Saved"),precondition:zO},when:x.and(pi.IsFileSystemResource,rz.toNegated(),Mv.toNegated())});const xue={id:Gle,title:h(7005,"Compare with Selected")};ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:20,command:xue,when:x.and(pi.HasResource,h4,R4,Mv.toNegated())});const Iue={id:Ule,title:h(7006,"Select for Compare")};ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:30,command:Iue,when:x.and(pi.HasResource,R4,Mv.toNegated())});const P4={id:$le,title:h(7007,"Compare Selected")};ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:30,command:P4,when:x.and(pi.HasResource,Mv,Yle)});ge.appendMenuItem(N.EditorTitleContext,{group:"1_compare",order:30,command:P4,when:x.and(pi.HasResource,soe,ooe)});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:10,command:{id:iS,title:h(7008,"Close")},when:h_.toNegated()});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:20,command:{id:ghe,title:h(7009,"Close Others")},when:h_.toNegated()});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:30,command:{id:lhe,title:h(7010,"Close Saved")}});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:40,command:{id:hhe,title:h(7011,"Close All")}});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:4,command:{id:lD,title:_he,precondition:Bh},when:uo});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:6,command:{id:QO,title:bhe,precondition:Bh},when:uo});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:10,command:p1,when:x.and(uo.toNegated(),pi.HasResource)});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:20,command:{id:Hle,title:h(7012,"Open With...")},when:x.and(uo.toNegated(),loe)});ge.appendMenuItem(N.ExplorerContext,{group:"3_compare",order:20,command:xue,when:x.and(uo.toNegated(),pi.HasResource,h4,Mv.toNegated())});ge.appendMenuItem(N.ExplorerContext,{group:"3_compare",order:30,command:Iue,when:x.and(uo.toNegated(),pi.HasResource,Mv.toNegated())});ge.appendMenuItem(N.ExplorerContext,{group:"3_compare",order:30,command:P4,when:x.and(uo.toNegated(),pi.HasResource,Mv)});ge.appendMenuItem(N.ExplorerContext,{group:"5_cutcopypaste",order:8,command:{id:Sue,title:h(7013,"Cut")},when:x.and(Cd.toNegated(),Bh)});ge.appendMenuItem(N.ExplorerContext,{group:"5_cutcopypaste",order:10,command:{id:Cue,title:u1e},when:Cd.toNegated()});ge.appendMenuItem(N.ExplorerContext,{group:"5_cutcopypaste",order:20,command:{id:T4,title:g1e,precondition:x.and(Bh,yhe)},when:uo});ge.appendMenuItem(N.ExplorerContext,{group:"5b_importexport",order:10,command:{id:whe,title:p1e},when:x.and(Jm.toNegated(),x.or(x.and(Ru.toNegated(),pi.Scheme.notEqualsTo(ae.file)),x.and(Ru,uo.toNegated(),Cd.toNegated()),x.and(Ru,CCe)))});ge.appendMenuItem(N.ExplorerContext,{group:"5b_importexport",order:20,command:{id:She,title:f1e},when:x.and(Ru,uo,Bh)});ge.appendMenuItem(N.ExplorerContext,{group:"6_copypath",order:10,command:pD,when:pi.IsFileSystemResource});ge.appendMenuItem(N.ExplorerContext,{group:"6_copypath",order:20,command:fD,when:pi.IsFileSystemResource});ge.appendMenuItem(N.ExplorerContext,{group:"2_workspace",order:10,command:{id:JO,title:Lhe},when:x.and(Cd,x.or(wl,yl.isEqualTo("workspace")))});ge.appendMenuItem(N.ExplorerContext,{group:"2_workspace",order:30,command:{id:Qle,title:zNe},when:x.and(Cd,uo,x.and(bN.notEqualsTo("0"),x.or(wl,yl.isEqualTo("workspace"))))});ge.appendMenuItem(N.ExplorerContext,{group:"7_modification",order:10,command:{id:yue,title:l1e,precondition:Bh},when:Cd.toNegated()});ge.appendMenuItem(N.ExplorerContext,{group:"7_modification",order:20,command:{id:wue,title:h1e},alt:{id:g1,title:h(7014,"Delete Permanently")},when:x.and(Cd.toNegated(),vI)});ge.appendMenuItem(N.ExplorerContext,{group:"7_modification",order:20,command:{id:g1,title:h(7014,"Delete Permanently")},when:x.and(Cd.toNegated(),vI.toNegated())});for(const s of[N.EmptyEditorGroupContext,N.EditorTabsBarContext])ge.appendMenuItem(s,{command:{id:tS,title:h(7015,"New Text File")},group:"1_file",order:10}),ge.appendMenuItem(s,{command:{id:"workbench.action.quickOpen",title:h(7016,"Open File...")},group:"1_file",order:20});ge.appendMenuItem(N.MenubarFileMenu,{group:"1_new",command:{id:tS,title:h(7017,"&&New Text File")},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"4_save",command:{id:GO,title:h(7018,"&&Save"),precondition:x.or(bw,x.and(_I,wN))},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"4_save",command:{id:c4,title:h(7019,"Save &&As..."),precondition:x.or(bw,x.and(_I,wN))},order:2});ge.appendMenuItem(N.MenubarFileMenu,{group:"4_save",command:{id:d4,title:h(7020,"Save A&&ll"),precondition:doe},order:3});ge.appendMenuItem(N.MenubarFileMenu,{group:"5_autosave",command:{id:XO.ID,title:h(7021,"A&&uto Save"),toggled:x.notEquals("config.files.autoSave","off")},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:$O,title:h(7022,"Re&&vert File"),precondition:x.or(x.and(roe),x.and(pi.Scheme.notEqualsTo(ae.untitled),_I,wN))},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:iS,title:h(7023,"&&Close Editor"),precondition:x.or(bw,x.and(_I,wN))},order:2});ge.appendMenuItem(N.MenubarGoMenu,{group:"3_global_nav",command:{id:"workbench.action.quickOpen",title:h(7024,"Go to &&File...")},order:1});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"navigation",order:10,command:p1,when:x.and(pi.IsFileSystemResource,uo.toNegated())});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"navigation",order:20,command:Tx,when:pi.IsFileSystemResource});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"1_cutcopypaste",order:10,command:pD,when:pi.IsFileSystemResource});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"1_cutcopypaste",order:20,command:fD,when:pi.IsFileSystemResource});for(const s of[N.ChatInlineResourceAnchorContext,N.ChatInputResourceAttachmentContext])ge.appendMenuItem(s,{group:"navigation",order:10,command:p1,when:x.and(pi.HasResource,uo.toNegated())}),ge.appendMenuItem(s,{group:"navigation",order:20,command:Tx,when:pi.IsFileSystemResource}),ge.appendMenuItem(s,{group:"1_cutcopypaste",order:10,command:pD,when:pi.IsFileSystemResource}),ge.appendMenuItem(s,{group:"1_cutcopypaste",order:20,command:fD,when:pi.IsFileSystemResource});const W0e=new O("chatAttachmentResource",void 0,{type:"URI",description:h(4663,"The full value of the chat attachment resource, including scheme and path")});let $Z=class extends F{constructor(e,t=[],i=Y(".chat-attached-context"),n){super(),this.variables=e,this.contentReferences=t,this.domNode=i,this.instantiationService=n,this.attachedContextDisposables=this._register(new U),this._onDidChangeVisibility=this._register(new M),this._contextResourceLabels=this._register(this.instantiationService.createInstance(vd,{onDidChangeVisibility:this._onDidChangeVisibility.event})),this.initAttachedContext(i),i.childElementCount||(this.domNode=void 0)}initAttachedContext(e){Yi(e),this.attachedContextDisposables.clear();const t=this.attachedContextDisposables.add(Km());for(const i of this.variables){const n=R.isUri(i.value)?i.value:i.value&&typeof i.value=="object"&&"uri"in i.value&&R.isUri(i.value.uri)?i.value.uri:void 0,o=i.value&&typeof i.value=="object"&&"range"in i.value&&P.isIRange(i.value.range)?i.value.range:void 0,r=this.contentReferences.find(g=>typeof g.reference=="object"&&"variableName"in g.reference&&g.reference.variableName===i.name||R.isUri(g.reference)&&Sn(g.reference.path)===i.name),c=r?.options?.status?.kind===xy.Omitted||r?.options?.status?.kind===xy.Partial;let d;i.kind==="tool"||i.kind==="toolset"?d=this.instantiationService.createInstance(JP,i,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t):gce(i)?d=this.instantiationService.createInstance(tL,i,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t):rb(i)?(i.omittedState=c?Yo.Full:i.omittedState,d=this.instantiationService.createInstance(QP,n,i,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t)):n&&(i.kind==="file"||i.kind==="directory")?d=this.instantiationService.createInstance(YP,n,o,i,r,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t):hce(i)?d=this.instantiationService.createInstance(XP,i,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t):n&&uce(i)?d=this.instantiationService.createInstance(eL,n,i,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t):pce(i)?d=this.instantiationService.createInstance(iL,i,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t):d=this.instantiationService.createInstance(ZP,n,o,i,r,void 0,{shouldFocusClearButton:!1,supportsDeletion:!1},e,this._contextResourceLabels,t);let l=null;c&&d.element.classList.add("warning");const u=r?.options?.status?.description;if(c){l=`${l}${u?` ${u}`:""}`;for(const g of[".monaco-icon-suffix-container",".monaco-icon-name-container"]){const m=d.label.element.querySelector(g);m&&m.classList.add("warning")}}if(this._register(re(d.element,"contextmenu",g=>this.contextMenuHandler?.(i,g))),this.attachedContextDisposables.isDisposed){d.dispose();return}l&&(d.element.ariaLabel=l),this.attachedContextDisposables.add(d)}}};$Z=f([p(3,J)],$Z);class YC{get childrenCount(){return this._children.size}get children(){return this._children.values()}get name(){return Zc.basename(this.relativePath)}constructor(e,t,i,n=void 0,o=void 0){this.uri=e,this.relativePath=t,this.context=i,this.element=n,this.parent=o,this._children=new Map}get(e){return this._children.get(e)}set(e,t){this._children.set(e,t)}delete(e){this._children.delete(e)}clear(){this._children.clear()}}YC.__decorator=f([Ht],YC.prototype,"name",null);function Due(s,e){typeof s.element<"u"&&e.push(s.element);for(const t of s.children)Due(t,e);return e}class B0e{static getRoot(e){for(;e.parent;)e=e.parent;return e}static collect(e){return Due(e,[])}static isResourceNode(e){return e instanceof YC}constructor(e,t=R.file("/"),i=vE){this.extUri=i,this.root=new YC(t,"",e)}add(e,t){const i=this.extUri.relativePath(this.root.uri,e)||e.path,n=new e0(!1).reset(i);let o=this.root,r="";for(;;){const a=n.value();r=r+"/"+a;let c=o.get(a);if(c?n.hasNext()||(c.element=t):(c=new YC(this.extUri.joinPath(this.root.uri,r),r,this.root.context,n.hasNext()?void 0:t,o),o.set(a,c)),o=c,!n.hasNext())return;n.next()}}delete(e){const t=this.extUri.relativePath(this.root.uri,e)||e.path,i=new e0(!1).reset(t);return this._delete(this.root,i)}_delete(e,t){const i=t.value(),n=e.get(i);if(n){if(t.hasNext()){const o=this._delete(n,t.next());return typeof o<"u"&&n.childrenCount===0&&e.delete(i),o}return e.delete(i),n.element}}clear(){this.root.clear()}getNode(e){const t=this.extUri.relativePath(this.root.uri,e)||e.path,i=new e0(!1).reset(t);let n=this.root;for(;;){const o=i.value(),r=n.get(o);if(!r||!i.hasNext())return r;n=r,i.next()}}}const V0e=H("scmGraph.historyItemRefColor",W_e,h(9436,"History item reference color.")),H0e=H("scmGraph.historyItemRemoteRefColor",B_e,h(9437,"History item remote reference color.")),U0e=H("scmGraph.historyItemBaseRefColor","#EA5C00",h(9438,"History item base reference color.")),$0e=H("scmGraph.historyItemHoverDefaultLabelForeground",Kn,h(9439,"History item hover default label foreground color.")),G0e=H("scmGraph.historyItemHoverDefaultLabelBackground",JM,h(9440,"History item hover default label background color.")),q0e=H("scmGraph.historyItemHoverLabelForeground",iN,h(9441,"History item hover label foreground color.")),z0e=H("scmGraph.historyItemHoverAdditionsForeground",{light:"#587C0C",dark:"#81B88B",hcDark:"#A1E3AD",hcLight:"#374E06"},h(9442,"History item hover additions foreground color.")),K0e=H("scmGraph.historyItemHoverDeletionsForeground",{light:"#AD0707",dark:"#C74E39",hcDark:"#C74E39",hcLight:"#AD0707"},h(9443,"History item hover deletions foreground color."));H("scmGraph.foreground1","#FFB000",h(9444,"Source control graph foreground color (1).")),H("scmGraph.foreground2","#DC267F",h(9445,"Source control graph foreground color (2).")),H("scmGraph.foreground3","#994F00",h(9446,"Source control graph foreground color (3).")),H("scmGraph.foreground4","#40B0A6",h(9447,"Source control graph foreground color (4).")),H("scmGraph.foreground5","#B66DFF",h(9448,"Source control graph foreground color (5)."));function j0e(s,e=20){const t=s.subject.length<=e?s.subject:`${s.subject.substring(0,e)}…`;return`${s.displayId??s.id} - ${t}`}function Y0e(s,e){const t=s.getColorTheme(),i=new Ni("",{isTrusted:!0,supportThemeIcons:!0});if(e.author){const n=R.isUri(e.authorIcon)?`![${e.author}](${e.authorIcon.toString()}|width=20,height=20)`:Te.isThemeIcon(e.authorIcon)?`$(${e.authorIcon.id})`:"$(account)";if(e.authorEmail){const o=h(9498,"Email");i.appendMarkdown(`${n} [**${e.author}**](mailto:${e.authorEmail} "${o} ${e.author}")`)}else i.appendMarkdown(`${n} **${e.author}**`);if(e.timestamp){const o=Oq.DateTimeFormat(sl,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).value;i.appendMarkdown(`, $(history) ${Mne(e.timestamp,!0,!0)} (${o.format(e.timestamp)})`)}i.appendMarkdown(`

`)}if(i.appendMarkdown(`${e.message.replace(/\r\n|\r|\n/g,`

`)}

`),e.statistics){if(i.appendMarkdown(`---

`),i.appendMarkdown(`<span>${e.statistics.files===1?h(9499,"{0} file changed",e.statistics.files):h(9500,"{0} files changed",e.statistics.files)}</span>`),e.statistics.insertions){const n=t.getColor(z0e);i.appendMarkdown(`,&nbsp;<span style="color:${n};">${e.statistics.insertions===1?h(9501,"{0} insertion{1}",e.statistics.insertions,"(+)"):h(9502,"{0} insertions{1}",e.statistics.insertions,"(+)")}</span>`)}if(e.statistics.deletions){const n=t.getColor(K0e);i.appendMarkdown(`,&nbsp;<span style="color:${n};">${e.statistics.deletions===1?h(9503,"{0} deletion{1}",e.statistics.deletions,"(-)"):h(9504,"{0} deletions{1}",e.statistics.deletions,"(-)")}</span>`)}}return(e.references??[]).length>0&&(i.appendMarkdown(`

---

`),i.appendMarkdown((e.references??[]).map(n=>{const o=Te.isThemeIcon(n.icon)?n.icon.id:"",r=n.color?gt(n.color):gt(G0e);return`<span style="color:${n.color?gt(q0e):gt($0e)};background-color:${r};border-radius:10px;">&nbsp;$(${o})&nbsp;${n.name}&nbsp;&nbsp;</span>`}).join("&nbsp;&nbsp;"))),{markdown:i,markdownNotSupportedFallback:e.message}}let Ph=class extends F{get onDidDelete(){return this._onDidDelete.event}get onDidOpen(){return this._onDidOpen.event}constructor(e,t,i,n,o,r,a,c){super(),this.attachment=e,this.options=t,this.hoverDelegate=o,this.currentLanguageModel=r,this.commandService=a,this.openerService=c,this._onDidDelete=this._register(new M),this._onDidOpen=this._register(new M),this.element=ee(i,Y(".chat-attached-context-attachment.show-file-icons")),this.label=n.create(this.element,{supportIcons:!0,hoverDelegate:o,hoverTargetOverride:this.element}),this._register(this.label),this.element.tabIndex=0}modelSupportsVision(){return kue(this.currentLanguageModel)}attachClearButton(){if(this.attachment.range||!this.options.supportsDeletion)return;const e=new Xu(this.element,{supportIcons:!0,hoverDelegate:this.hoverDelegate,title:h(4644,"Remove from context")});e.element.tabIndex=-1,e.icon=j.close,this._register(e),this._register(D.once(e.onDidClick)(t=>{this._onDidDelete.fire(t)})),this._register(co(this.element,pe.KEY_DOWN,t=>{(t.keyCode===S.Backspace||t.keyCode===S.Delete)&&this._onDidDelete.fire(t.browserEvent)}))}addResourceOpenHandlers(e,t){this.element.style.cursor="pointer",this._register(re(this.element,pe.CLICK,async i=>{Li.stop(i,!0),this.attachment.kind==="directory"?await this.openResource(e,!0):await this.openResource(e,!1,t)})),this._register(re(this.element,pe.KEY_DOWN,async i=>{const n=new zs(i);(n.equals(S.Enter)||n.equals(S.Space))&&(Li.stop(i,!0),this.attachment.kind==="directory"?await this.openResource(e,!0):await this.openResource(e,!1,t))}))}async openResource(e,t,i){if(t){this.commandService.executeCommand(Tx.id,e);return}const o={fromUserGesture:!0,editorOptions:{...i?{selection:i}:void 0,preserveFocus:!0}};await this.openerService.open(e,o),this._onDidOpen.fire(),this.element.focus()}};Ph=f([p(6,qe),p(7,hi)],Ph);function kue(s){return s?.metadata.capabilities?.vision??!1}let YP=class extends Ph{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){super(i,r,a,c,d,o,l,u),this.themeService=g,this.hoverService=m,this.languageModelsService=v,this.instantiationService=y;const w=Sn(e.path),C=wq(e.path),T=`${w} ${C}`;let k=t?h(4645,"Attached file, {0}, line {1} to line {2}",T,t.startLineNumber,t.endLineNumber):h(4646,"Attached file, {0}",T);if(i.omittedState===Yo.Full)k=h(4647,"Omitted this file: {0}",i.name),this.renderOmittedWarning(T,k,d);else{const A={hidePath:!0,title:n?.options?.status?.description};this.label.setFile(e,i.kind==="file"?{...A,fileKind:Hi.FILE,range:t}:{...A,fileKind:Hi.FOLDER,icon:this.themeService.getFileIconTheme().hasFolderIcons?void 0:V_e})}this.element.ariaLabel=k,this.instantiationService.invokeFunction(A=>{this._register(f1(A,this.element,e))}),this.addResourceOpenHandlers(e,t),this.attachClearButton()}renderOmittedWarning(e,t,i){const n=Y("div.chat-attached-context-pill",{},Y("span.codicon.codicon-warning")),o=Y("span.chat-attached-context-custom-text",{},e);this.element.appendChild(n),this.element.appendChild(o);const r=Y("div.chat-attached-context-hover");r.setAttribute("aria-label",t),this.element.classList.add("warning"),r.textContent=h(4648,"{0} does not support this file type.",this.currentLanguageModel?this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name:this.currentLanguageModel??"This model"),this._register(this.hoverService.setupManagedHover(i,this.element,r,{trapFocus:!0}))}};YP=f([p(9,qe),p(10,hi),p(11,ft),p(12,wi),p(13,Cw),p(14,J)],YP);let QP=class extends Ph{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(t,n,o,r,a,i,c,d),this.hoverService=l,this.languageModelsService=u,this.telemetryService=g,this.labelService=v;let y;t.omittedState===Yo.Full?y=h(4649,"Omitted this image: {0}",t.name):t.omittedState===Yo.Partial?y=h(4650,"Partially omitted this image: {0}",t.name):y=h(4651,"Attached image, {0}",t.name);const w=t.references?.[0]?.reference;e=w&&R.isUri(w)?w:void 0;const C=async()=>{e&&await this.openResource(e,!1,void 0)},T=this.currentLanguageModel?this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name??this.currentLanguageModel.identifier:"unknown",k=this.modelSupportsVision();this.telemetryService.publicLog2("copilot.attachImage",{currentModel:T,supportsVision:k});const A=e?this.labelService.getUriLabel(e):t.fullName||t.name;this._register(Tue(e,t.name,A,this.element,t.value,this.hoverService,y,T,C,this.currentLanguageModel,t.omittedState)),e&&(this.addResourceOpenHandlers(e,void 0),m.invokeFunction(B=>{this._register(f1(B,this.element,e))})),this.attachClearButton()}};QP=f([p(7,qe),p(8,hi),p(9,wi),p(10,Cw),p(11,li),p(12,J),p(13,di)],QP);function Tue(s,e,t,i,n,o,r,a,c,d,l){const u=new U;l===Yo.Partial&&i.classList.add("partial-warning"),i.ariaLabel=r,i.style.position="relative",s&&(i.style.cursor="pointer",u.add(re(i,"click",c)));const g=kue(d),m=Y("div.chat-attached-context-pill",{},Y(g?"span.codicon.codicon-file-media":"span.codicon.codicon-warning")),v=Y("span.chat-attached-context-custom-text",{},e);i.appendChild(m),i.appendChild(v);const y=Y("div.chat-attached-context-hover");if(y.setAttribute("aria-label",r),!g&&d||l===Yo.Full)i.classList.add("warning"),y.textContent=h(4652,"{0} does not support images.",a??"This model"),u.add(o.setupDelayedHover(i,{content:y,appearance:{showPointer:!0}}));else{u.add(o.setupDelayedHover(i,{content:y,appearance:{showPointer:!0}}));const w=new Blob([n],{type:"image/png"}),C=URL.createObjectURL(w),T=Y("img.chat-attached-context-pill-image",{src:C,alt:""}),k=Y("div.chat-attached-context-pill",{},T),A=i.querySelector(".chat-attached-context-pill");A&&A.replaceWith(k);const B=Y("img.chat-attached-context-image",{src:C,alt:""}),z=Y("div.chat-attached-context-image-container",{},B);if(y.appendChild(z),s){const Q=Y("a.chat-attached-context-url",{},l===Yo.Partial?h(4653,"This GIF was partially omitted - current frame will be sent."):t),ie=Y("div.chat-attached-context-url-separator");u.add(re(Q,"click",()=>c())),y.append(ie,Q)}B.onload=()=>{URL.revokeObjectURL(C)},B.onerror=()=>{const Q=Y("div.chat-attached-context-pill",{},Y("span.codicon.codicon-file-media")),ie=Y("div.chat-attached-context-pill",{},Q),oe=i.querySelector(".chat-attached-context-pill");oe&&oe.replaceWith(ie)}}return u}let XP=class extends Ph{constructor(e,t,i,n,o,r,a,c,d,l){super(e,i,n,o,r,t,a,c),this.hoverService=d,this.instantiationService=l;const u=h(4654,"Attached context, {0}",e.name);this.element.ariaLabel=u;const g=["file-icon",`${e.language}-lang-file-icon`];let m,v;if(e.copiedFrom){m=e.copiedFrom.uri,v=e.copiedFrom.range;const T=Sn(m.path);this.label.setLabel(T,void 0,{extraClasses:g})}else this.label.setLabel(e.fileName,void 0,{extraClasses:g});this.element.appendChild(Y("span.attachment-additional-info",{},`Pasted ${e.pastedLines}`)),this.element.style.position="relative";const y=e.copiedFrom?.uri,w={markdown:{value:`${y?this.instantiationService.invokeFunction(T=>T.get(di).getUriLabel(y,{relative:!0})):e.fileName}

---

\`\`\`${e.language}

${e.code}
\`\`\``},markdownNotSupportedFallback:e.code};this._register(this.hoverService.setupManagedHover(r,this.element,w,{trapFocus:!0}));const C=e.copiedFrom?.uri;C&&(this._register(this.instantiationService.invokeFunction(f1,this.element,C)),this.addResourceOpenHandlers(C,v)),this.attachClearButton()}};XP=f([p(6,qe),p(7,hi),p(8,wi),p(9,J)],XP);let ZP=class extends Ph{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(i,r,a,c,d,o,l,u),this.contextKeyService=g,this.instantiationService=m;const v=i.fullName??i.name,y=i.icon?.id?`$(${i.icon.id}) ${v}`:v;if(this.label.setLabel(y,n?.options?.status?.description),this.element.ariaLabel=h(4654,"Attached context, {0}",i.name),i.kind==="diagnostic"&&(i.filterUri?(e=i.filterUri?R.revive(i.filterUri):void 0,t=i.filterRange):(this.element.style.cursor="pointer",this._register(re(this.element,pe.CLICK,()=>{this.commandService.executeCommand("workbench.panel.markers.view.focus")})))),i.kind==="symbol"){const w=this._register(this.contextKeyService.createScoped(this.element));this._register(this.instantiationService.invokeFunction(Q0e,this.element,w,{...i,kind:i.symbolKind},N.ChatInputSymbolAttachmentContext))}e&&this.addResourceOpenHandlers(e,t),this.attachClearButton()}};ZP=f([p(9,qe),p(10,hi),p(11,me),p(12,J)],ZP);let JP=class extends Ph{constructor(e,t,i,n,o,r,a,c,d,l){super(e,i,n,o,r,t,c,d);const u=dn.find(a.getTools(),y=>y.id===e.id)??dn.find(a.toolSets.get(),y=>y.id===e.id);let g=e.name;const m=e.icon??j.tools;u instanceof SV?g=u.referenceName:u&&(g=u.toolReferenceName??g),this.label.setLabel(`$(${m.id}) ${g}`,void 0),this.element.style.cursor="pointer",this.element.ariaLabel=h(4654,"Attached context, {0}",g);let v;u instanceof SV?v=h(4655,"{0} - {1}",u.description??u.referenceName,u.source.label):u&&(v=h(4656,"{0} - {1}",u.userDescription??u.modelDescription,u.source.label)),v&&this._register(l.setupManagedHover(r,this.element,v,{trapFocus:!0})),this.attachClearButton()}};JP=f([p(6,CI),p(7,qe),p(8,hi),p(9,wi)],JP);let eL=class extends Ph{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){switch(super(t,n,o,r,a,i,c,d),this.hoverService=l,this.languageModelsService=u,this.notebookService=g,this.instantiationService=m,t.mimeType){case"application/vnd.code.notebook.error":{this.renderErrorOutput(e,t);break}case"image/png":case"image/jpeg":case"image/svg":{this.renderImageOutput(e,t);break}default:this.renderGenericOutput(e,t)}this.instantiationService.invokeFunction(v=>{this._register(f1(v,this.element,e))}),this.addResourceOpenHandlers(e,void 0),this.attachClearButton()}getAriaLabel(e){return h(4657,"Attached Notebook output, {0}",e.name)}renderErrorOutput(e,t){const i=t.name,n=t.icon?.id?`$(${t.icon.id}) ${i}`:i,o=this.getOutputItem(e,t)?.data.buffer??new Uint8Array;let r;try{const a=JSON.parse(new TextDecoder().decode(o));a.name&&a.message&&(r=`${a.name}: ${a.message}`)}catch{}this.label.setLabel(n,void 0,{title:r}),this.element.ariaLabel=this.getAriaLabel(t)}renderGenericOutput(e,t){this.element.ariaLabel=this.getAriaLabel(t),this.label.setFile(e,{hidePath:!0,icon:Te.fromId("output")})}renderImageOutput(e,t){let i;t.omittedState===Yo.Full?i=h(4658,"Omitted this Notebook ouput: {0}",t.name):t.omittedState===Yo.Partial?i=h(4659,"Partially omitted this Notebook output: {0}",t.name):i=this.getAriaLabel(t);const n=async()=>await this.openResource(e,!1,void 0),o=this.currentLanguageModel?this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name??this.currentLanguageModel.identifier:void 0,r=this.getOutputItem(e,t)?.data.buffer??new Uint8Array;this._register(Tue(e,t.name,t.name,this.element,r,this.hoverService,i,o,n,this.currentLanguageModel,t.omittedState))}getOutputItem(e,t){const i=fl.parseCellOutputUri(e);if(!i||typeof i.cellHandle!="number"||typeof i.outputIndex!="number")return;const n=this.notebookService.getNotebookTextModel(i.notebook);if(!n)return;const o=n.cells.find(a=>a.handle===i.cellHandle);return o?(o.outputs.length>i.outputIndex?o.outputs[i.outputIndex]:void 0)?.outputs.find(a=>a.mime===t.mimeType):void 0}};eL=f([p(7,qe),p(8,hi),p(9,wi),p(10,Cw),p(11,$h),p(12,J)],eL);let tL=class extends Ph{constructor(e,t,i,n,o,r,a,c,d){super(e,i,n,o,r,t,a,c);const l=h(4660,"Attached element, {0}",e.name);this.element.ariaLabel=l,this.element.style.position="relative",this.element.style.cursor="pointer";const u=e.name,g=e.icon?.id?`$(${e.icon.id}) ${u}`:u;this.label.setLabel(g,void 0,{title:h(4661,"Click to view the contents of: {0}",u)}),this._register(re(this.element,pe.CLICK,async()=>{const m=e.value?.toString()||"";await d.openEditor({resource:void 0,contents:m,options:{pinned:!0}})})),this.attachClearButton()}};tL=f([p(6,qe),p(7,hi),p(8,de)],tL);let iL=class extends Ph{constructor(e,t,i,n,o,r,a,c,d,l){super(e,i,n,o,r,t,a,d),this.label.setLabel(e.name,void 0),this.element.style.cursor="pointer",this.element.ariaLabel=h(4654,"Attached context, {0}",e.name),this._store.add(c.setupManagedHover(r,this.element,()=>Y0e(l,e.historyItem),{trapFocus:!0})),this._store.add(re(this.element,pe.CLICK,u=>{Li.stop(u,!0),this._openAttachment(e)})),this._store.add(re(this.element,pe.KEY_DOWN,u=>{const g=new zs(u);(g.equals(S.Enter)||g.equals(S.Space))&&(Li.stop(u,!0),this._openAttachment(e))})),this.attachClearButton()}async _openAttachment(e){await this.commandService.executeCommand("_workbench.openMultiDiffEditor",{title:j0e(e.historyItem),multiDiffSourceUri:e.value})}};iL=f([p(6,qe),p(7,wi),p(8,hi),p(9,ft)],iL);function f1(s,e,t){const i=s.get(me),n=s.get(J),o=new U,r=o.add(i.createScoped(e));return o.add(Aue(s,r,t)),e.draggable=!0,o.add(re(e,"dragstart",a=>{n.invokeFunction(c=>pg(c,[t],a)),a.dataTransfer?.setDragImage(e,0,0)})),o.add(Rue(s,e,r,N.ChatInputResourceAttachmentContext,t)),o}function Q0e(s,e,t,i,n){const o=s.get(J),r=s.get(Ne),a=s.get(yi),c=new U;c.add(Aue(s,t,i.value.uri)),W0e.bindTo(t).set(i.value.uri.toString()),e.draggable=!0,c.add(re(e,"dragstart",g=>{o.invokeFunction(m=>pg(m,[{resource:i.value.uri,selection:i.value.range}],g)),sde([{fsPath:i.value.uri.fsPath,range:i.value.range,name:i.name,kind:i.kind}],g),g.dataTransfer?.setDragImage(e,0,0)}));const l=[[V.hasDefinitionProvider.bindTo(t),r.definitionProvider],[V.hasReferenceProvider.bindTo(t),r.referenceProvider],[V.hasImplementationProvider.bindTo(t),r.implementationProvider],[V.hasTypeDefinitionProvider.bindTo(t),r.typeDefinitionProvider]],u=async()=>{const g=await a.createModelReference(i.value.uri);try{const m=g.object.textEditorModel;for(const[v,y]of l)v.set(y.has(m))}finally{g.dispose()}};return c.add(Rue(s,e,t,n,i.value,u)),c}function Aue(s,e,t){const i=s.get(Xe),n=s.get(fi),o=s.get(ai),r=new pi(e,i,n,o);return r.set(t),r}function Rue(s,e,t,i,n,o){const r=s.get(mi),a=s.get(tn);return re(e,pe.CONTEXT_MENU,async c=>{const d=new us(bt(c),c);Li.stop(c,!0);try{await o?.()}catch(l){console.error(l)}r.showContextMenu({contextKeyService:t,getAnchor:()=>d,getActions:()=>{const l=a.getMenuActions(i,t,{arg:n});return sI(l)}})})}var GZ;(function(s){s[s.CommandPalette=0]="CommandPalette",s[s.StatusBarWindowIndicatorMenu=1]="StatusBarWindowIndicatorMenu"})(GZ||(GZ={}));var a2;(function(s){s.DARK="dark",s.LIGHT="light",s.HIGH_CONTRAST_LIGHT="hcLight",s.HIGH_CONTRAST_DARK="hcDark"})(a2||(a2={}));var qZ;(function(s){s.Null="null",s.Enum="enum",s.String="string",s.MultilineString="multiline-string",s.Integer="integer",s.Number="number",s.Boolean="boolean",s.Array="array",s.Exclude="exclude",s.Include="include",s.Complex="complex",s.NullableInteger="nullable-integer",s.NullableNumber="nullable-number",s.Object="object",s.BooleanObject="boolean-object",s.LanguageTag="language-tag",s.ExtensionToggle="extension-toggle",s.ComplexObject="complex-object"})(qZ||(qZ={}));var em;(function(s){s[s.None=0]="None",s[s.LanguageTagSettingMatch=1]="LanguageTagSettingMatch",s[s.RemoteMatch=2]="RemoteMatch",s[s.NonContiguousQueryInSettingId=4]="NonContiguousQueryInSettingId",s[s.DescriptionOrValueMatch=8]="DescriptionOrValueMatch",s[s.NonContiguousWordsInSettingsLabel=16]="NonContiguousWordsInSettingsLabel",s[s.ContiguousWordsInSettingsLabel=32]="ContiguousWordsInSettingsLabel",s[s.ContiguousQueryInSettingId=64]="ContiguousQueryInSettingId",s[s.AllWordsInSettingsLabel=128]="AllWordsInSettingsLabel",s[s.ExactMatch=256]="ExactMatch"})(em||(em={}));em.AllWordsInSettingsLabel|em.ContiguousWordsInSettingsLabel|em.NonContiguousWordsInSettingsLabel|em.NonContiguousQueryInSettingId|em.ContiguousQueryInSettingId;const VZe="editor.contrib.defineKeybinding",X0e="settings";class Z0e{constructor(e,t,i){if(this.location=t,this.parent=i,t[t.length-1]==="\\")throw Error("Unexpected path format, do not use trailing backslashes");t[t.length-1]!=="/"&&(t+="/"),this.isPathIgnored=this.parseIgnoreFile(e,this.location,this.parent)}updateContents(e){this.isPathIgnored=this.parseIgnoreFile(e,this.location,this.parent)}isPathIncludedInTraversal(e,t){if(e[0]!=="/"||e[e.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+e);return!this.isPathIgnored(e,t)}isArbitraryPathIgnored(e,t){if(e[0]!=="/"||e[e.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+e);const i=e.split("/").filter(r=>r);let n=!1,o="";for(let r=0;r<i.length;r++){const a=r===i.length-1,c=i[r];if(o=o+"/"+c,!this.isPathIncludedInTraversal(o,a?t:!0)){n=!0;break}}return n}gitignoreLinesToExpression(e,t,i){const n=e.map(r=>this.gitignoreLineToGlob(r,t)),o=Object.create(null);for(const r of n)o[r]=!0;return Um(o,{trimForExclusions:i})}parseIgnoreFile(e,t,i){const n=e.split(`
`).map(y=>y.trim()).filter(y=>y&&y[0]!=="#"),o=n.filter(y=>!y.endsWith("/")),r=o.filter(y=>!y.includes("!")),a=this.gitignoreLinesToExpression(r,t,!0),c=o.filter(y=>y.includes("!")).map(y=>y.replace(/!/g,"")),d=this.gitignoreLinesToExpression(c,t,!1),l=n.filter(y=>!y.includes("!")),u=this.gitignoreLinesToExpression(l,t,!0),g=n.filter(y=>y.includes("!")).map(y=>y.replace(/!/g,"")),m=this.gitignoreLinesToExpression(g,t,!1);return(y,w)=>y.startsWith(t)?w&&u(y)&&!m(y)||a(y)&&!d(y)?!0:i?i.isPathIgnored(y,w):!1:!1}gitignoreLineToGlob(e,t){const i=e.indexOf("/");return i===-1||i===e.length-1?e="**/"+e:(i===0?t.slice(-1)==="/"&&(e=e.slice(1)):t.slice(-1)!=="/"&&(e="/"+e),e=t+e),e}}var c2;(function(s){s.FileContributionRegistry="workbench.registry.explorer.fileContributions"})(c2||(c2={}));class J0e extends F{constructor(){super(...arguments),this._onDidRegisterDescriptor=this._register(new M),this.onDidRegisterDescriptor=this._onDidRegisterDescriptor.event,this.descriptors=[]}register(e){this.descriptors.push(e),this._onDidRegisterDescriptor.fire(e)}create(e,t,i){return this.descriptors.map(n=>{const o=n.create(e,t);return i.add(o),o})}}const d2=new J0e;Ge.add(c2.FileContributionRegistry,d2);var l2,Md;class nL{static{this.ITEM_HEIGHT=22}getHeight(e){return nL.ITEM_HEIGHT}getTemplateId(e){return sL.ID}}const h2=new M;let u2=class{constructor(e,t,i,n,o,r,a,c,d,l){this.fileFilter=e,this.findProvider=t,this.progressService=i,this.configService=n,this.notificationService=o,this.layoutService=r,this.fileService=a,this.explorerService=c,this.contextService=d,this.filesConfigService=l}getParent(e){if(e.parent)return e.parent;throw new Error("getParent only supported for cached parents")}hasChildren(e){return Array.isArray(e)||e.hasChildren(t=>this.fileFilter.filter(t,cm.Visible))}getChildren(e){if(Array.isArray(e))return e;if(this.findProvider.isShowingFilterResults())return Array.from(e.children.values());const t=e.error,i=this.explorerService.sortOrderConfiguration.sortOrder,n=e.fetchChildren(i);if(Array.isArray(n))return n;const o=n.then(r=>(e instanceof Ss&&e.isRoot&&!e.error&&t&&this.contextService.getWorkbenchState()!==zo.FOLDER&&h2.fire(e.resource),r),r=>{if(e instanceof Ss&&e.isRoot)if(this.contextService.getWorkbenchState()===zo.FOLDER){const a=new Ss(e.resource,this.fileService,this.configService,this.filesConfigService,void 0,void 0,!1);return a.error=r,[a]}else h2.fire(e.resource);else this.notificationService.error(r);return[]});return this.progressService.withProgress({location:qo.Explorer,delay:this.layoutService.isRestored()?800:1500},r=>o),o}};u2=f([p(2,bl),p(3,ne),p(4,At),p(5,vi),p(6,Xe),p(7,Qi),p(8,Tt),p(9,Ns)],u2);class zZ extends Ss{constructor(e,t,i,n,o,r){super(e,t,i,n,o,r)}}class eFe{constructor(){this._tree=new Map,this._highlightedItems=new Map}get highlightedItems(){return Array.from(this._highlightedItems.values())}get(e){const t=this.find(e);if(t===void 0)return 0;const{treeLayer:i,relPath:n}=t;return this._highlightedItems.set(n,e),i.childMatches}find(e){const t=this._tree.get(e.root.name);if(t===void 0)return;const i=Qu(e.root.resource,e.resource);if(i===void 0||i.startsWith(".."))throw new Error("Resource is not a child of the root");if(i==="")return{treeLayer:t,relPath:i};let n=t;for(const o of i.split("/")){if(!n.stats[o])return;n=n.stats[o]}return{treeLayer:n,relPath:i}}add(e,t){const i=Qu(t.resource,e);if(i===void 0||i.startsWith(".."))throw new Error("Resource is not a child of the root");let n=this._tree.get(t.name);n||(n={childMatches:0,stats:{},isMatch:!1},this._tree.set(t.name,n)),n.childMatches++;let o=n;for(const r of i.split("/"))o.stats[r]||(o.stats[r]={childMatches:0,stats:{},isMatch:!1}),o=o.stats[r],o.childMatches++;o.childMatches--,o.isMatch=!0}isMatch(e){const t=this.find(e);if(t===void 0)return!1;const{treeLayer:i}=t;return i.isMatch}clear(){this._tree.clear()}}let g2=class{get highlightTree(){return this.findHighlightTree}constructor(e,t,i,n,o,r,a,c,d){this.filesFilter=e,this.treeProvider=t,this.searchService=i,this.fileService=n,this.configurationService=o,this.filesConfigService=r,this.progressService=a,this.explorerService=c,this.sessionId=0,this.phantomParents=new Set,this.findHighlightTree=new eFe,this.explorerFindActiveContextKey=hoe.bindTo(d)}isShowingFilterResults(){return!!this.filterSessionStartState}isVisible(e){return!this.filterSessionStartState||this.explorerService.isEditable(e)?!0:this.filterSessionStartState.rootsWithProviders.has(e.root)?e.isMarkedAsFiltered():!0}startSession(){this.sessionId++}async endSession(){this.filterSessionStartState&&await this.endFilterSession(),this.highlightSessionStartState&&this.endHighlightSession()}async find(e,t,i){const n=this.doFind(e,t,i);return await this.progressService.withProgress({location:qo.Explorer,delay:750},o=>n)}async doFind(e,t,i){return t.findMode===q_e.Highlight?(this.filterSessionStartState&&await this.endFilterSession(),this.highlightSessionStartState||this.startHighlightSession(),await this.doHighlightFind(e,t.matchType,i)):(this.highlightSessionStartState&&this.endHighlightSession(),this.filterSessionStartState||this.startFilterSession(),await this.doFilterFind(e,t.matchType,i))}startFilterSession(){const e=this.treeProvider(),t=e.getInput();if(!t)return;const i=this.explorerService.roots.filter(n=>this.searchSupportsScheme(n.resource.scheme));this.filterSessionStartState={viewState:e.getViewState(),input:t,rootsWithProviders:new Set(i)},this.explorerFindActiveContextKey.set(!0)}async doFilterFind(e,t,i){if(!this.filterSessionStartState)throw new Error("ExplorerFindProvider: no session state");const n=Array.from(this.filterSessionStartState.rootsWithProviders),o=await this.getSearchResults(e,n,t,i);if(i.isCancellationRequested)return;this.clearPhantomElements();for(const{explorerRoot:c,files:d,directories:l}of o)this.addWorkspaceFilterResults(c,d,l);await this.treeProvider().setInput(this.filterSessionStartState.input);const a=o.some(({hitMaxResults:c})=>c);return{isMatch:c=>c.isMarkedAsFiltered(),matchCount:o.reduce((c,{files:d,directories:l})=>c+d.length+l.length,0),warningMessage:a?h(7286,"The result set only contains a subset of all matches. Be more specific in your search to narrow down the results."):void 0}}addWorkspaceFilterResults(e,t,i){const n=[...t.map(o=>({resource:o,isDirectory:!1})),...i.map(o=>({resource:o,isDirectory:!0}))];for(const{resource:o,isDirectory:r}of n){const a=e.find(o);if(a&&a.root===e){a.markItemAndParentsAsFiltered();continue}const c=this.createPhantomItems(o,e,r);if(c.length===0)throw new Error("Phantom item was not created even though it is not in the model");const d=c[0].parent;d instanceof zZ||this.phantomParents.add(d),c[c.length-1].markItemAndParentsAsFiltered()}}createPhantomItems(e,t,i){const n=Qu(t.resource,e);if(!n)throw new Error("Resource is not a child of the root");const o=[];let r=t,a=t.resource;const c=n.split("/");for(const d of c){a=a.with({path:`${a.path}/${d}`});let l=r.getChild(d);if(!l){const u=c[c.length-1]===d?i:!0;l=new zZ(a,this.fileService,this.configurationService,this.filesConfigService,r,u),r.addChild(l),o.push(l)}r=l}return o}async endFilterSession(){if(this.clearPhantomElements(),this.explorerFindActiveContextKey.set(!1),!this.filterSessionStartState)throw new Error("ExplorerFindProvider: no session state to restore");await this.treeProvider().setInput(this.filterSessionStartState.input,this.filterSessionStartState.viewState),this.filterSessionStartState=void 0,this.explorerService.refresh()}clearPhantomElements(){for(const e of this.phantomParents)e.forgetChildren();this.phantomParents.clear(),this.explorerService.roots.forEach(e=>e.unmarkItemAndChildren())}startHighlightSession(){const e=this.explorerService.roots.filter(t=>this.searchSupportsScheme(t.resource.scheme));this.highlightSessionStartState={rootsWithProviders:new Set(e)}}async doHighlightFind(e,t,i){if(!this.highlightSessionStartState)throw new Error("ExplorerFindProvider: no highlight session state");const n=Array.from(this.highlightSessionStartState.rootsWithProviders),o=await this.getSearchResults(e,n,t,i);if(i.isCancellationRequested)return;this.clearHighlights();for(const{explorerRoot:a,files:c,directories:d}of o)this.addWorkspaceHighlightResults(a,c.concat(d));const r=o.some(({hitMaxResults:a})=>a);return{isMatch:a=>this.findHighlightTree.isMatch(a)||this.findHighlightTree.get(a)>0&&this.treeProvider().isCollapsed(a),matchCount:o.reduce((a,{files:c,directories:d})=>a+c.length+d.length,0),warningMessage:r?h(7286,"The result set only contains a subset of all matches. Be more specific in your search to narrow down the results."):void 0}}addWorkspaceHighlightResults(e,t){const i=new Set,n=r=>{for(;r;)i.add(r),r=r.parent};for(const r of t){const a=e.find(r);if(a&&a.root===e){this.findHighlightTree.add(r,e),n(a.parent);continue}const c=iFe(r,e);c&&(this.findHighlightTree.add(r,e),n(c.parent))}const o=this.treeProvider();for(const r of i)o.hasNode(r)&&o.rerender(r)}endHighlightSession(){this.highlightSessionStartState=void 0,this.clearHighlights()}clearHighlights(){const e=this.treeProvider();for(const t of this.findHighlightTree.highlightedItems)e.hasNode(t)&&e.rerender(t);this.findHighlightTree.clear()}searchSupportsScheme(e){return e!==ae.file&&e!==ae.vscodeRemote?!1:this.searchService.schemeHasFileSearchProvider(e)}async getSearchResults(e,t,i,n){const o=e.toLowerCase(),r=i===z_e.Fuzzy;return await Promise.all(t.map((a,c)=>this.searchInWorkspace(o,a,c,r,n)))}async searchInWorkspace(e,t,i,n,o){const r=oFe(n?nFe(e):sFe(e)),a=wce(this.configurationService.getValue({resource:t.resource}))||{},c={folderQueries:[{folder:t.resource,disregardIgnoreFiles:!this.configurationService.getValue("explorer.excludeGitIgnore")}],type:Ep.File,shouldGlobMatchFilePattern:!0,cacheKey:`explorerfindprovider:${t.name}:${i}:${this.sessionId}`,excludePattern:a};let d,l;try{[d,l]=await Promise.all([this.searchService.fileSearch({...c,filePattern:`**/${r}`,maxResults:512},o),this.searchService.fileSearch({...c,filePattern:`**/${r}/**`},o)])}catch(y){if(!gs(y))throw y}if(!d||!l||o.isCancellationRequested)return{explorerRoot:t,files:[],directories:[],hitMaxResults:!1};const u=d.results.map(y=>y.resource),g=tFe(l.results.map(y=>y.resource),t,r),m=u.filter(y=>!this.filesFilter.isIgnored(y,t.resource,!1)),v=g.filter(y=>!this.filesFilter.isIgnored(y,t.resource,!0));return{explorerRoot:t,files:m,directories:v,hitMaxResults:!!d.limitHit||!!l.limitHit}}};g2=f([p(2,DI),p(3,Xe),p(4,ne),p(5,Ns),p(6,bl),p(7,Qi),p(8,me)],g2);function tFe(s,e,t){const i=new Fp;for(const o of s){const r=Qu(e.resource,o);if(!r)throw new Error("Resource is not a child of the root");let a=e.resource;const c=r.split("/").slice(0,-1);for(const d of c)a=a.with({path:`${a.path}/${d}`}),i.add(a)}const n=[];for(const o of i){const r=o.path.split("/"),a=r[r.length-1];!a||!ch(t,a)||n.push(o)}return n}function iFe(s,e){const t=Qu(e.resource,s);if(!t)throw new Error("Resource is not a child of the root");let i=e,n=e.resource;const o=t.split("/");for(const r of o){n=n.with({path:`${n.path}/${r}`});const a=i.getChild(r);if(!a)return i;i=a}}function nFe(s){return s?"*"+s.split("").join("*")+"*":"*"}function sFe(s){return s?"*"+s+"*":"*"}function oFe(s){let e="";for(let t=0;t<s.length;t++){const i=s[t];/[a-zA-Z]/.test(i)?e+=`[${i.toLowerCase()}${i.toUpperCase()}]`:e+=i}return e}class KZ{static{this.ID=0}get index(){return this._index}get count(){return this.items.length}get current(){return this.items[this._index]}get currentId(){return`${this.id}_${this.index}`}get labels(){return this._labels}constructor(e,t,i,n,o){this.id=e,this.items=t,this.depth=n,this.collapsed=o,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._index=t.length-1,this.updateLabels(i),this._updateLabelDisposable=i.label.onDidRender(()=>this.updateLabels(i))}updateLabels(e){this._labels=Array.from(e.container.querySelectorAll(".label-name"));let t="";for(let i=0;i<this.labels.length;i++){const n=t.length?`${this.items[i].name}, compact, ${t}`:this.items[i].name;this.labels[i].setAttribute("aria-label",n),this.labels[i].setAttribute("aria-level",`${this.depth+i}`),t=t.length?`${this.items[i].name} ${t}`:this.items[i].name}this.updateCollapsed(this.collapsed),this._index<this.labels.length&&this.labels[this._index].classList.add("active")}previous(){this._index<=0||this.setIndex(this._index-1)}next(){this._index>=this.items.length-1||this.setIndex(this._index+1)}first(){this._index!==0&&this.setIndex(0)}last(){this._index!==this.items.length-1&&this.setIndex(this.items.length-1)}setIndex(e){e<0||e>=this.items.length||(this.labels[this._index].classList.remove("active"),this._index=e,this.labels[this._index].classList.add("active"),this._onDidChange.fire())}updateCollapsed(e){this.collapsed=e;for(let t=0;t<this.labels.length;t++)this.labels[t].setAttribute("aria-expanded",e?"false":"true")}dispose(){this._onDidChange.dispose(),this._updateLabelDisposable.dispose()}}let sL=class{static{l2=this}static{this.ID="file"}constructor(e,t,i,n,o,r,a,c,d,l,u,g){this.labels=t,this.highlightTree=i,this.updateWidth=n,this.contextViewService=o,this.themeService=r,this.configurationService=a,this.explorerService=c,this.labelService=d,this.contextService=l,this.contextMenuService=u,this.instantiationService=g,this.compressedNavigationControllers=new Map,this._onDidChangeActiveDescendant=new H_e,this.onDidChangeActiveDescendant=this._onDidChangeActiveDescendant.event,this.config=this.configurationService.getValue();const m=()=>{const v=this.configurationService.getValue("workbench.tree.indent"),y=Math.max(22-v,0);e.style.setProperty("--vscode-explorer-align-offset-margin-left",`${y}px`)};this.configListener=this.configurationService.onDidChangeConfiguration(v=>{v.affectsConfiguration("explorer")&&(this.config=this.configurationService.getValue()),v.affectsConfiguration("workbench.tree.indent")&&m()}),m()}getWidgetAriaLabel(){return h(7287,"Files Explorer")}get templateId(){return l2.ID}renderTemplate(e){const t=new U,i=t.add(this.labels.create(e,{supportHighlights:!0}));t.add(i.onDidRender(()=>{try{o.currentContext&&this.updateWidth(o.currentContext)}catch{}}));const n=d2.create(this.instantiationService,e,t);t.add(d2.onDidRegisterDescriptor(r=>{const a=r.create(this.instantiationService,e);n.push(t.add(a)),a.setResource(o.currentContext?.resource)}));const o={templateDisposables:t,elementDisposables:t.add(new U),label:i,container:e,contribs:n};return o}renderElement(e,t,i){const n=e.element;i.currentContext=n;const o=this.explorerService.getEditableData(n);i.label.element.classList.remove("compressed"),o?(i.label.element.style.display="none",i.contribs.forEach(r=>r.setResource(void 0)),i.elementDisposables.add(this.renderInputBox(i.container,n,o))):(i.label.element.style.display="flex",this.renderStat(n,n.name,void 0,e.filterData,i))}renderCompressedElements(e,t,i){const n=e.element.elements[e.element.elements.length-1];i.currentContext=n;const o=e.element.elements.filter(a=>this.explorerService.isEditable(a)),r=o.length===0?void 0:this.explorerService.getEditableData(o[0]);if(r)i.label.element.classList.remove("compressed"),i.label.element.style.display="none",i.contribs.forEach(a=>a.setResource(void 0)),i.elementDisposables.add(this.renderInputBox(i.container,o[0],r));else{i.label.element.classList.add("compressed"),i.label.element.style.display="flex";const a=`compressed-explorer_${KZ.ID++}`,c=e.element.elements.map(g=>g.name);let d=e.filterData;if(d&&d.length>2){const g=c.join("/").length-c[c.length-1].length;d=[d[0],d[1]+g,...d.slice(2)]}this.renderStat(n,c,a,d,i);const l=new KZ(a,e.element.elements,i,e.depth,e.collapsed);i.elementDisposables.add(l);const u=this.compressedNavigationControllers.get(n)??[];this.compressedNavigationControllers.set(n,[...u,l]),i.elementDisposables.add(this._onDidChangeActiveDescendant.add(l.onDidChange)),i.elementDisposables.add(re(i.container,"mousedown",g=>{const m=oL(g.target);m&&l.setIndex(m.index)})),i.elementDisposables.add(Ee(()=>{const g=this.compressedNavigationControllers.get(n)??[],m=g.findIndex(v=>v===l);if(m<0)throw new Error("Disposing unknown navigation controller");g.length===1?this.compressedNavigationControllers.delete(n):g.splice(m,1)}))}}renderStat(e,t,i,n,o){o.label.element.style.display="flex";const r=["explorer-item"];this.explorerService.isCut(e)&&r.push("cut");const a=this.themeService.getFileIconTheme();o.container.parentElement?.parentElement?.querySelector(".monaco-tl-twistie")?.classList.toggle("force-twistie",e.hasNests&&a.hidesExplorerArrows);const d=a.hasFileIcons&&(a.hidesExplorerArrows||!a.hasFolderIcons),l=e.nestedParent&&d;o.contribs.forEach(g=>g.setResource(e.resource)),o.label.setResource({resource:e.resource,name:t},{fileKind:e.isRoot?Hi.ROOT_FOLDER:e.isDirectory?Hi.FOLDER:Hi.FILE,extraClasses:l?[...r,"align-nest-icon-with-parent-icon"]:r,fileDecorations:this.config.explorer.decorations,matches:lw(n),separator:this.labelService.getSeparator(e.resource.scheme,e.resource.authority),domId:i});const u=e.isDirectory?this.highlightTree.get(e):0;if(u>0){const g=new Aie(o.label.element.lastElementChild,{},{...Rie,badgeBackground:gt(tbe),badgeBorder:gt(ebe)});g.setCount(u),g.setTitleFormat(h(7288,"Directory contains {0} matches",u)),o.elementDisposables.add(g)}o.label.element.classList.toggle("highlight-badge",u>0)}renderInputBox(e,t,i){const n=this.labels.create(e),o=["explorer-item","explorer-item-edited"],r=t.isRoot?Hi.ROOT_FOLDER:t.isDirectory?Hi.FOLDER:Hi.FILE,a=this.themeService.getFileIconTheme(),c=a.hasFileIcons&&(a.hidesExplorerArrows||!a.hasFolderIcons),d=t.nestedParent&&c,l={hidePath:!0,hideLabel:!0,fileKind:r,extraClasses:d?[...o,"align-nest-icon-with-parent-icon"]:o},u=t.name?hs(t.resource):t.resource,g=t.name||"";n.setFile(xt(u,g||" "),l),n.element.firstElementChild.style.display="none";const m=new U_e(n.element,this.contextViewService,{validationOptions:{validation:k=>{const A=i.validationMessage(k);return!A||A.severity!==Me.Error?null:{content:A.content,formatContent:!0,type:MD.ERROR}}},ariaLabel:h(7289,"Type file name. Press Enter to confirm or Escape to cancel."),inputBoxStyles:YT}),v=g.lastIndexOf(".");let y="prefix";m.value=g,m.focus(),m.select({start:0,end:v>0&&!t.isDirectory?v:g.length});const w=hw((k,A)=>{n.element.style.display="none";const B=m.value;Qe(T),n.element.remove(),A&&i.onFinish(B,k)}),C=()=>{if(m.isInputValid()){const k=i.validationMessage(m.value);k?m.showMessage({content:k.content,formatContent:!0,type:k.severity===Me.Info?MD.INFO:k.severity===Me.Warning?MD.WARNING:MD.ERROR}):m.hideMessage()}};C();const T=[m,m.onDidChange(k=>{n.setFile(xt(u,k||" "),l)}),co(m.inputElement,pe.KEY_DOWN,k=>{if(k.equals(S.F2)){const A=m.value.lastIndexOf(".");if(t.isDirectory||A===-1)return;y==="prefix"?(y="all",m.select({start:0,end:m.value.length})):y==="all"?(y="suffix",m.select({start:A+1,end:m.value.length})):(y="prefix",m.select({start:0,end:A}))}else k.equals(S.Enter)?m.validate()||w(!0,!0):k.equals(S.Escape)&&w(!1,!0)}),co(m.inputElement,pe.KEY_UP,k=>{C()}),re(m.inputElement,pe.BLUR,async()=>{for(;;){await Ia(0);const k=m.inputElement.ownerDocument;if(!k.hasFocus())break;if(gf(m.inputElement))return;if(Mh(k.activeElement)&&$_e(k.activeElement,"context-view"))await D.toPromise(this.contextMenuService.onDidHideContextMenu);else break}w(m.isInputValid(),!0)}),n];return Ee(()=>{w(!1,!1)})}disposeElement(e,t,i){i.currentContext=void 0,i.elementDisposables.clear()}disposeCompressedElements(e,t,i){i.currentContext=void 0,i.elementDisposables.clear()}disposeTemplate(e){e.templateDisposables.dispose()}getCompressedNavigationController(e){return this.compressedNavigationControllers.get(e)}getAriaLabel(e){return e.name}getAriaLevel(e){let t=0,i=e.parent;for(;i;)i=i.parent,t++;return this.contextService.getWorkbenchState()===zo.WORKSPACE&&(t=t+1),t}getActiveDescendantId(e){return this.compressedNavigationControllers.get(e)?.[0]?.currentId??void 0}dispose(){this.configListener.dispose()}};sL=l2=f([p(4,cf),p(5,ft),p(6,ne),p(7,Qi),p(8,di),p(9,Tt),p(10,mi),p(11,J)],sL);let p2=class{constructor(e,t,i,n,o,r){this.contextService=e,this.configurationService=t,this.explorerService=i,this.editorService=n,this.uriIdentityService=o,this.fileService=r,this.hiddenExpressionPerRoot=new Map,this.editorsAffectingFilter=new Set,this._onDidChange=new M,this.toDispose=[],this.ignoreFileResourcesPerRoot=new Map,this.ignoreTreesPerRoot=new Map,this.toDispose.push(this.contextService.onDidChangeWorkspaceFolders(()=>this.updateConfiguration())),this.toDispose.push(this.configurationService.onDidChangeConfiguration(a=>{(a.affectsConfiguration("files.exclude")||a.affectsConfiguration("explorer.excludeGitIgnore"))&&this.updateConfiguration()})),this.toDispose.push(this.fileService.onDidFilesChange(a=>{for(const[c,d]of this.ignoreFileResourcesPerRoot.entries())d.forEach(async l=>{a.contains(l,mh.UPDATED)&&await this.processIgnoreFile(c,l,!0),a.contains(l,mh.DELETED)&&(this.ignoreTreesPerRoot.get(c)?.delete(hs(l)),d.delete(l),this._onDidChange.fire())})})),this.toDispose.push(this.editorService.onDidVisibleEditorsChange(()=>{const a=this.editorService.visibleEditors;let c=!1;for(const d of a){if(!d.resource)continue;const l=this.explorerService.findClosest(d.resource);if(l&&l.isExcluded){c=!0;break}}for(const d of this.editorsAffectingFilter)if(!a.includes(d)){c=!0;break}c&&(this.editorsAffectingFilter.clear(),this._onDidChange.fire())})),this.updateConfiguration()}get onDidChange(){return this._onDidChange.event}updateConfiguration(){let e=!1,t=!1;this.contextService.getWorkspace().folders.forEach(i=>{const n=this.configurationService.getValue({resource:i.uri}),o=n?.files?.exclude||Object.create(null),r=n.explorer.excludeGitIgnore;if(r&&!this.ignoreTreesPerRoot.has(i.uri.toString())&&(t=!0,this.ignoreFileResourcesPerRoot.set(i.uri.toString(),new Fp),this.ignoreTreesPerRoot.set(i.uri.toString(),kie.forUris(c=>this.uriIdentityService.extUri.ignorePathCasing(c)))),!r&&this.ignoreTreesPerRoot.has(i.uri.toString())&&(t=!0,this.ignoreFileResourcesPerRoot.delete(i.uri.toString()),this.ignoreTreesPerRoot.delete(i.uri.toString())),!e){const c=this.hiddenExpressionPerRoot.get(i.uri.toString());e=!c||!ma(c.original,o)}const a=Cr(o);this.hiddenExpressionPerRoot.set(i.uri.toString(),{original:a,parsed:Um(a)})}),(e||t)&&(this.editorsAffectingFilter.clear(),this._onDidChange.fire())}async processIgnoreFile(e,t,i){const n=hs(t),o=this.ignoreTreesPerRoot.get(e);if(!o||!i&&o.has(n))return;const r=await this.fileService.readFile(t);if(i)o.get(n)?.updateContents(r.value.toString());else{const a=o.findSubstr(n),c=new Z0e(r.value.toString(),n.path,a);o.set(n,c),this.ignoreFileResourcesPerRoot.get(e)?.has(t)||this.ignoreFileResourcesPerRoot.get(e)?.add(t)}this._onDidChange.fire()}filter(e,t){return e.name===".gitignore"&&this.ignoreTreesPerRoot.has(e.root.resource.toString())?(this.processIgnoreFile(e.root.resource.toString(),e.resource,!1),!0):this.isVisible(e,t)}isVisible(e,t){if(e.isExcluded=!1,t===cm.Hidden)return e.isExcluded=!0,!1;if(this.explorerService.getEditableData(e))return!0;if((this.hiddenExpressionPerRoot.get(e.root.resource.toString())?.parsed(qM(e.root.resource.path,e.resource.path),e.name,r=>!!(e.parent&&e.parent.getChild(r)))?!0:this.isIgnored(e.resource,e.root.resource,e.isDirectory))||e.parent?.isExcluded){e.isExcluded=!0;const a=this.editorService.visibleEditors.find(c=>c.resource&&this.uriIdentityService.extUri.isEqualOrParent(c.resource,e.resource));return a&&e.root===this.explorerService.findClosestRoot(e.resource)?(this.editorsAffectingFilter.add(a),!0):!1}return!0}isIgnored(e,t,i){const o=this.ignoreTreesPerRoot.get(t.toString())?.findSubstr(e)?.isPathIncludedInTraversal(e.path,i);return o===void 0?!1:!o}dispose(){Qe(this.toDispose)}};p2=f([p(0,Tt),p(1,ne),p(2,Qi),p(3,de),p(4,Zi),p(5,Xe)],p2);let f2=class{constructor(e,t){this.explorerService=e,this.contextService=t}compare(e,t){if(e.isRoot){if(t.isRoot){const c=this.contextService.getWorkspaceFolder(e.resource),d=this.contextService.getWorkspaceFolder(t.resource);return c&&d?c.index-d.index:-1}return-1}if(t.isRoot)return 1;const i=this.explorerService.sortOrderConfiguration.sortOrder,n=this.explorerService.sortOrderConfiguration.lexicographicOptions;this.explorerService.sortOrderConfiguration.reverse&&([e,t]=[t,e]);let r,a;switch(n){case"upper":r=Z_e,a=J_e;break;case"lower":r=Q_e,a=X_e;break;case"unicode":r=j_e,a=Y_e;break;default:r=MF,a=K_e}switch(i){case"type":if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;if(e.isDirectory&&t.isDirectory)return r(e.name,t.name);break;case"filesFirst":if(e.isDirectory&&!t.isDirectory)return 1;if(t.isDirectory&&!e.isDirectory)return-1;break;case"foldersNestsFiles":if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;if(e.hasNests&&!t.hasNests)return-1;if(t.hasNests&&!e.hasNests)return 1;break;case"mixed":break;default:if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;break}switch(i){case"type":return a(e.name,t.name);case"modified":return e.mtime!==t.mtime?e.mtime&&t.mtime&&e.mtime<t.mtime?1:-1:r(e.name,t.name);default:return r(e.name,t.name)}}};f2=f([p(0,Qi),p(1,Tt)],f2);let m2=class{static{Md=this}static{this.CONFIRM_DND_SETTING_KEY="explorer.confirmDragAndDrop"}constructor(e,t,i,n,o,r,a,c,d,l){this.isCollapsed=e,this.explorerService=t,this.editorService=i,this.dialogService=n,this.contextService=o,this.fileService=r,this.configurationService=a,this.instantiationService=c,this.workspaceEditingService=d,this.uriIdentityService=l,this.compressedDropTargetDisposable=F.None,this.disposables=new U,this.dropEnabled=!1;const u=g=>{(!g||g.affectsConfiguration("explorer.enableDragAndDrop"))&&(this.dropEnabled=this.configurationService.getValue("explorer.enableDragAndDrop"))};u(void 0),this.disposables.add(this.configurationService.onDidChangeConfiguration(g=>u(g)))}onDragOver(e,t,i,n,o){if(!this.dropEnabled)return!1;if(t){const r=Md.getCompressedStatFromDragEvent(t,o);if(r){const a=oL(o.target);if(a&&a.index<a.count-1){const c=this.handleDragOver(e,r,i,n,o);return c?(a.element!==this.compressedDragOverElement&&(this.compressedDragOverElement=a.element,this.compressedDropTargetDisposable.dispose(),this.compressedDropTargetDisposable=Ee(()=>{a.element.classList.remove("drop-target"),this.compressedDragOverElement=void 0}),a.element.classList.add("drop-target")),typeof c=="boolean"?c:{...c,feedback:[]}):(this.compressedDropTargetDisposable.dispose(),!1)}}}return this.compressedDropTargetDisposable.dispose(),this.handleDragOver(e,t,i,n,o)}handleDragOver(e,t,i,n,o){const r=o&&(o.ctrlKey&&!qt||o.altKey&&qt),a=e instanceof NF,d={type:a||r?$_.Copy:$_.Move,position:am.Over};if(a){if(!Eo(o,bs.FILES,io.FILES,bs.RESOURCES))return!1}else{if(e instanceof G_e)return!1;{const l=Md.getStatsFromDragAndDropData(e),u=l.every(g=>g.isRoot);if(!t)return!r&&l.every(g=>!!g.parent&&g.parent.isRoot)?!1:u?{accept:!0,effect:{type:$_.Move,position:am.After}}:{accept:!0,bubble:ND.Down,effect:d,autoExpand:!1};if(!Array.isArray(l)||!r&&l.every(g=>g.isReadonly)||l.some(g=>g.isRoot?!1:!!(this.uriIdentityService.extUri.isEqual(g.resource,t.resource)||!r&&this.uriIdentityService.extUri.isEqual(hs(g.resource),t.resource)||this.uriIdentityService.extUri.isEqualOrParent(t.resource,g.resource))))return!1;if(u){if(!t.isRoot)return!1;let g;switch(n){case jr.TOP:case jr.CENTER_TOP:g=am.Before;break;case jr.CENTER_BOTTOM:case jr.BOTTOM:g=am.After;break}return{accept:!0,effect:{type:$_.Move,position:g}}}}}if(t){if(t.isDirectory)return t.isReadonly?!1:{accept:!0,bubble:ND.Down,effect:d,autoExpand:!0};if(this.contextService.getWorkspace().folders.every(l=>l.uri.toString()!==t.resource.toString()))return{accept:!0,bubble:ND.Up,effect:d}}else return{accept:!0,bubble:ND.Down,effect:d};return!1}getDragURI(e){return this.explorerService.isEditable(e)?null:e.resource.toString()}getDragLabel(e,t){return e.length===1?Md.getCompressedStatFromDragEvent(e[0],t).name:String(e.length)}onDragStart(e,t){const i=Md.getStatsFromDragAndDropData(e,t);if(i&&i.length&&t.dataTransfer){this.instantiationService.invokeFunction(o=>pg(o,i,t));const n=i.filter(o=>o.resource.scheme===ae.file).map(o=>o.resource.fsPath);n.length&&t.dataTransfer.setData(io.FILES,JSON.stringify(n))}}async drop(e,t,i,n,o){if(this.compressedDropTargetDisposable.dispose(),t){const a=Md.getCompressedStatFromDragEvent(t,o);a&&(t=a)}if(t||(t=this.explorerService.roots[this.explorerService.roots.length-1],n=jr.BOTTOM),!t.isDirectory&&t.parent&&(t=t.parent),t.isReadonly)return;const r=t;if(r)try{e instanceof NF?!$t||zM(this.contextService.getWorkspace())&&LE.supported($i)?await this.instantiationService.createInstance(CU).import(r,o,$i):await this.instantiationService.createInstance(EP).upload(t,o):await this.handleExplorerDrop(e,r,i,n,o)}catch(a){this.dialogService.error(ho(a))}}async handleExplorerDrop(e,t,i,n,o){const r=Md.getStatsFromDragAndDropData(e),a=new Map(r.map(g=>[g,this.isCollapsed(g)]));for(const[g,m]of a)if(m){const v=g.nestedChildren;if(v)for(const y of v)a.set(y,!0)}const c=Rq([...a.keys()],g=>g.resource),d=o.ctrlKey&&!qt||o.altKey&&qt;if(!d&&this.configurationService.getValue(Md.CONFIRM_DND_SETTING_KEY)){const g=c.length>1&&c.every(y=>y.isRoot)?h(7290,"Are you sure you want to change the order of multiple root folders in your workspace?"):c.length>1?h(7291,"Are you sure you want to move the following {0} files into '{1}'?",c.length,t.name):c[0].isRoot?h(7292,"Are you sure you want to change the order of root folder '{0}' in your workspace?",c[0].name):h(7293,"Are you sure you want to move '{0}' into '{1}'?",c[0].name,t.name),m=c.length>1&&!c.every(y=>y.isRoot)?Vu(c.map(y=>y.resource)):void 0,v=await this.dialogService.confirm({message:g,detail:m,checkbox:{label:h(7294,"Do not ask me again")},primaryButton:h(7295,"&&Move")});if(!v.confirmed)return;v.checkboxChecked===!0&&await this.configurationService.updateValue(Md.CONFIRM_DND_SETTING_KEY,!1)}await this.doHandleRootDrop(c.filter(g=>g.isRoot),t,n);const u=c.filter(g=>!g.isRoot);return d?this.doHandleExplorerDropOnCopy(u,t):this.doHandleExplorerDropOnMove(u,t)}async doHandleRootDrop(e,t,i){if(e.length===0)return;const n=this.contextService.getWorkspace().folders;let o;const r=[],a=[],c=[];for(let d=0;d<n.length;d++){const l={uri:n[d].uri,name:n[d].name};t instanceof Ss&&this.uriIdentityService.extUri.isEqual(n[d].uri,t.resource)&&(o=d);for(const u of e)if(this.uriIdentityService.extUri.isEqual(n[d].uri,u.resource)){r.push(d);break}e.every(u=>u.resource.toString()!==n[d].uri.toString())?a.push(l):c.push(l)}if(o===void 0)o=a.length;else{switch(i){case jr.BOTTOM:case jr.CENTER_BOTTOM:o++;break}for(const d of r)d<o&&o--}return a.splice(o,0,...c),this.workspaceEditingService.updateFolders(0,a.length,a)}async doHandleExplorerDropOnCopy(e,t){const i=this.configurationService.getValue().explorer,n=[];for(const{resource:a,isDirectory:c}of e){const d=i.incrementalNaming==="disabled",l=await xU(this.explorerService,this.fileService,this.dialogService,t,{resource:a,isDirectory:c,allowOverwrite:d},i.incrementalNaming);if(!l)continue;const u=new ic(a,l,{copy:!0,overwrite:d});n.push(u)}const o=jZ(e);await this.explorerService.applyBulkEdit(n,{confirmBeforeUndo:i.confirmUndo===Lu.Default||i.confirmUndo===Lu.Verbose,undoLabel:h(7296,"Copy {0}",o),progressLabel:h(7297,"Copying {0}",o)});const r=n.filter(a=>{const c=a.newResource?this.explorerService.findClosest(a.newResource):void 0;return c&&!c.isDirectory}).map(a=>({resource:a.newResource,options:{pinned:!0}}));await this.editorService.openEditors(r)}async doHandleExplorerDropOnMove(e,t){const i=e.filter(r=>!r.isReadonly).map(r=>new ic(r.resource,xt(t.resource,r.name))),n=jZ(e),o={confirmBeforeUndo:this.configurationService.getValue().explorer.confirmUndo===Lu.Verbose,undoLabel:h(7298,"Move {0}",n),progressLabel:h(7299,"Moving {0}",n)};try{await this.explorerService.applyBulkEdit(i,o)}catch(r){if(r.fileOperationResult===$n.FILE_MOVE_CONFLICT){const a=[];for(const l of i)l.newResource&&await this.fileService.exists(l.newResource)&&a.push(l.newResource);const c=d1e(a),{confirmed:d}=await this.dialogService.confirm(c);d&&await this.explorerService.applyBulkEdit(i.map(l=>new ic(l.oldResource,l.newResource,{overwrite:!0})),o)}else throw r}}static getStatsFromDragAndDropData(e,t){return e.context?e.context:t&&e.elements.length===1?(e.context=[Md.getCompressedStatFromDragEvent(e.elements[0],t)],e.context):e.elements}static getCompressedStatFromDragEvent(e,t){const i=bt(t).document.elementFromPoint(t.clientX,t.clientY),n=oL(i);if(n){const{count:o,index:r}=n;let a=o-1;for(;a>r&&e.parent;)e=e.parent,a--;return e}return e}onDragEnd(){this.compressedDropTargetDisposable.dispose()}dispose(){this.compressedDropTargetDisposable.dispose()}};m2=Md=f([p(1,Qi),p(2,de),p(3,Qt),p(4,Tt),p(5,Xe),p(6,ne),p(7,J),p(8,uc),p(9,Zi)],m2);function oL(s){if(!Mh(s))return null;let e=s;for(;e&&!e.classList.contains("monaco-list-row");){if(e.classList.contains("label-name")&&e.hasAttribute("data-icon-label-count")){const t=Number(e.getAttribute("data-icon-label-count")),i=Number(e.getAttribute("data-icon-label-index"));if(Ja(t)&&Ja(i))return{element:e,count:t,index:i}}e=e.parentElement}return null}function rFe(s){return!!oL(s)}class aFe{isIncompressible(e){return e.isRoot||!e.isDirectory||e instanceof YO||!e.parent||e.parent.isRoot}}function jZ(s){return s.length===1?s[0].name:s.every(e=>e.isDirectory)?h(7300,"{0} folders",s.length):s.every(e=>!e.isDirectory)?h(7301,"{0} files",s.length):`${s.length} files and folders`}function cFe(s){if(s.isRoot&&s.error)return{tooltip:h(7275,"Unable to resolve workspace folder ({0})",ho(s.error)),letter:"!",color:ibe};if(s.isSymbolicLink)return{tooltip:h(7276,"Symbolic Link"),letter:"⤷"};if(s.isUnknown)return{tooltip:h(7277,"Unknown File Type"),letter:"?"};if(s.isExcluded)return{color:nbe}}let v2=class{constructor(e,t){this.explorerService=e,this.label=h(7278,"Explorer"),this._onDidChange=new M,this.toDispose=new U,this.toDispose.add(this._onDidChange),this.toDispose.add(t.onDidChangeWorkspaceFolders(i=>{this._onDidChange.fire(i.changed.concat(i.added).map(n=>n.uri))})),this.toDispose.add(h2.event(i=>{this._onDidChange.fire([i])}))}get onDidChange(){return this._onDidChange.event}async provideDecorations(e){const t=this.explorerService.findClosest(e);if(!t)throw new Error("ExplorerItem not found");return cFe(t)}dispose(){this.toDispose.dispose()}};v2=f([p(0,Qi),p(1,Tt)],v2);var cT;function dFe(s,e){for(const t of e)if(s.hasNode(t)&&!s.isCollapsed(t)){for(const[,i]of t.children.entries())if(s.hasNode(i)&&s.isCollapsible(i)&&!s.isCollapsed(i))return!0}return!1}function lFe(s,e){for(const t of e)if(s.hasNode(t)&&!s.isCollapsed(t))return!0;return!1}const hFe={getId:s=>s instanceof YO?`new:${s.getId()}`:s.getId()};function uFe(s,e,t,i){let n;n=s.length?s[0]:void 0,t&&e.length>1&&(n=void 0);const o=n&&i.getCompressedNavigationController(n),r=o&&o.length?o[0]:void 0;n=r?r.current:n;const a=[];for(const c of e){const d=i.getCompressedNavigationController(c),l=d&&d.length?d[0]:void 0;if(l&&n&&l===r){c===n&&a.push(c);continue}l?a.push(...l.items):a.push(c)}return n?t&&a.indexOf(n)>=0?a:[n]:t?a:[]}let zy=class extends Ix{static{cT=this}static{this.TREE_VIEW_STATE_STORAGE_KEY="workbench.explorer.treeViewState"}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A,B,z,Q,ie){super(e,l,t,g,u,i,n,ie,y,C),this.contextService=o,this.progressService=r,this.editorService=a,this.editorResolverService=c,this.layoutService=d,this.decorationService=m,this.labelService=v,this.telemetryService=w,this.explorerService=T,this.storageService=k,this.clipboardService=A,this.fileService=B,this.uriIdentityService=z,this.commandService=Q,this._autoReveal=!1,this.delegate=e.delegate,this.resourceContext=n.createInstance(pi),this._register(this.resourceContext),this.parentReadonlyContext=uoe.bindTo(u),this.folderContext=uo.bindTo(u),this.readonlyContext=ECe.bindTo(u),this.availableEditorIdsContext=loe.bindTo(u),this.rootContext=Cd.bindTo(u),this.resourceMoveableToTrash=vI.bindTo(u),this.compressedFocusContext=mI.bindTo(u),this.compressedFocusFirstContext=sz.bindTo(u),this.compressedFocusLastContext=oz.bindTo(u),this.viewHasSomeCollapsibleRootItem=xCe.bindTo(u),this.viewVisibleContextKey=_I.bindTo(u),this.explorerService.registerView(this)}get autoReveal(){return this._autoReveal}set autoReveal(e){this._autoReveal=e}get name(){return this.labelService.getWorkspaceLabel(this.contextService.getWorkspace())}get title(){return this.name}set title(e){}setVisible(e){this.viewVisibleContextKey.set(e),super.setVisible(e)}get fileCopiedContextKey(){return yhe.bindTo(this.contextKeyService)}get resourceCutContextKey(){return coe.bindTo(this.contextKeyService)}renderHeader(e){super.renderHeader(e),this.dragHandler=new Nne(e,()=>this.setExpanded(!0));const t=e.querySelector(".title"),i=()=>{t.textContent=this.name,this.updateTitle(this.name),this.ariaHeaderLabel=h(7279,"Explorer Section: {0}",this.name),t.setAttribute("aria-label",this.ariaHeaderLabel)};this._register(this.contextService.onDidChangeWorkspaceName(i)),this._register(this.labelService.onDidChangeFormatters(i)),i()}layoutBody(e,t){super.layoutBody(e,t),this.tree.layout(e,t)}renderBody(e){super.renderBody(e),this.container=e,this.treeContainer=ee(e,Y(".explorer-folders-view")),this.createTree(this.treeContainer),this._register(this.labelService.onDidChangeFormatters(()=>{this._onDidChangeTitleArea.fire()})),this.onConfigurationUpdated(void 0),this._register(this.editorService.onDidActiveEditorChange(()=>{this.selectActiveFile()})),this._register(this.configurationService.onDidChangeConfiguration(t=>this.onConfigurationUpdated(t))),this._register(this.onDidChangeBodyVisibility(async t=>{t&&(await this.setTreeInput(),this.updateAnyCollapsedContext(),this.selectActiveFile(!0))})),this._register(re(bt(this.container),pe.PASTE,async t=>{!this.hasFocus()||this.readonlyContext.get()||t.clipboardData?.files?.length&&await this.commandService.executeCommand("filesExplorer.paste",t.clipboardData?.files)}))}focus(){if(super.focus(),this.tree.domFocus(),this.tree.getFocusedPart()===P7.Tree){const e=this.tree.getFocus();e.length===1&&this._autoReveal&&this.tree.reveal(e[0],.5)}}hasFocus(){return Mq(this.container)}getFocus(){return this.tree.getFocus()}focusNext(){this.tree.focusNext()}focusLast(){this.tree.focusLast()}getContext(e){const t=this.tree.getFocusedPart()===P7.StickyScroll?this.tree.getStickyScrollFocus():this.tree.getFocus();return uFe(t,this.tree.getSelection(),e,this.renderer)}isItemVisible(e){return this.filter?this.filter.filter(e,cm.Visible):!1}isItemCollapsed(e){return this.tree.isCollapsed(e)}async setEditable(e,t){t?(this.horizontalScrolling=this.tree.options.horizontalScrolling,this.horizontalScrolling&&this.tree.updateOptions({horizontalScrolling:!1}),await this.tree.expand(e.parent)):(this.horizontalScrolling!==void 0&&this.tree.updateOptions({horizontalScrolling:this.horizontalScrolling}),this.horizontalScrolling=void 0,this.treeContainer.classList.remove("highlight")),await this.refresh(!1,e.parent,!1),t?(this.treeContainer.classList.add("highlight"),this.tree.reveal(e)):this.tree.domFocus()}async selectActiveFile(e=this._autoReveal){if(this._autoReveal){const t=xi.getCanonicalUri(this.editorService.activeEditor,{supportSideBySide:Ut.PRIMARY});if(t){const i=this.tree.getFocus(),n=this.tree.getSelection();return i.length===1&&this.uriIdentityService.extUri.isEqual(i[0].resource,t)&&n.length===1&&this.uriIdentityService.extUri.isEqual(n[0].resource,t)?void 0:this.explorerService.select(t,e)}}}createTree(e){this.filter=this.instantiationService.createInstance(p2),this._register(this.filter),this._register(this.filter.onDidChange(()=>this.refresh(!0)));const t=this.instantiationService.createInstance(vd,{onDidChangeVisibility:this.onDidChangeBodyVisibility});this._register(t),this.findProvider=this.instantiationService.createInstance(g2,this.filter,()=>this.tree);const i=a=>this.tree.updateWidth(a);this.renderer=this.instantiationService.createInstance(sL,e,t,this.findProvider.highlightTree,i),this._register(this.renderer),this._register(Pue(e,this.themeService));const n=()=>this.configurationService.getValue("explorer.compactFolders"),o=a=>this.configurationService.getValue({resource:a?.root.resource}).explorer.fileNesting;this.tree=this.instantiationService.createInstance(sbe,"FileExplorer",e,new nL,new aFe,[this.renderer],this.instantiationService.createInstance(u2,this.filter,this.findProvider),{compressionEnabled:n(),accessibilityProvider:this.renderer,identityProvider:hFe,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:a=>{if(!this.explorerService.isEditable(a))return a.name},getCompressedNodeKeyboardNavigationLabel:a=>{if(!a.some(c=>this.explorerService.isEditable(c)))return a.map(c=>c.name).join("/")}},multipleSelectionSupport:!0,filter:this.filter,sorter:this.instantiationService.createInstance(f2),dnd:this.instantiationService.createInstance(m2,a=>this.isItemCollapsed(a)),collapseByDefault:a=>!(a instanceof Ss&&(a.hasNests&&o(a).expand||this.findProvider.isShowingFilterResults())),autoExpandSingleChildren:!0,expandOnlyOnTwistieClick:a=>{if(a instanceof Ss){if(a.hasNests)return!0;if(this.configurationService.getValue("workbench.tree.expandMode")==="doubleClick")return!0}return!1},paddingBottom:nL.ITEM_HEIGHT,overrideStyles:this.getLocationBasedColors().listOverrideStyles,findProvider:this.findProvider}),this._register(this.tree),this._register(this.themeService.onDidColorThemeChange(()=>this.tree.rerender()));const r=D.filter(this.configurationService.onDidChangeConfiguration,a=>a.affectsConfiguration("explorer.compactFolders"));this._register(r(a=>this.tree.updateOptions({compressionEnabled:n()}))),ICe.bindTo(this.tree.contextKeyService),aoe.bindTo(this.tree.contextKeyService),this._register(this.tree.onDidChangeFocus(a=>this.onFocusChanged(a.elements))),this.onFocusChanged([]),this._register(this.tree.onDidOpen(async a=>{const c=a.element;if(!c)return;if(!(FF(a.browserEvent)&&a.browserEvent.shiftKey)){if(c.isDirectory||this.explorerService.isEditable(void 0))return;this.telemetryService.publicLog2("workbenchActionExecuted",{id:"workbench.files.openFile",from:"explorer"});try{this.delegate?.willOpenElement(a.browserEvent),await this.editorService.openEditor({resource:c.resource,options:{preserveFocus:a.editorOptions.preserveFocus,pinned:a.editorOptions.pinned,source:eN.USER}},a.sideBySide?xr:cl)}finally{this.delegate?.didOpenElement()}}})),this._register(this.tree.onContextMenu(a=>this.onContextMenu(a))),this._register(this.tree.onDidScroll(async a=>{const c=this.explorerService.getEditable();a.scrollTopChanged&&c&&this.tree.getRelativeTop(c.stat)===null&&await c.data.onFinish("",!1)})),this._register(this.tree.onDidChangeCollapseState(a=>{const c=a.node.element?.element;c&&this.renderer.getCompressedNavigationController(c instanceof Array?c[0]:c)?.forEach(l=>l.updateCollapsed(a.node.collapsed)),this.updateAnyCollapsedContext()})),this.updateAnyCollapsedContext(),this._register(this.tree.onMouseDblClick(a=>{const c=this.configurationService.getValue("workbench.list.scrollByPage");a.element===null&&!c&&this.commandService.executeCommand(lD)})),this._register(this.storageService.onWillSaveState(()=>{this.storeTreeViewState()}))}onConfigurationUpdated(e){if(!e||e.affectsConfiguration("explorer.autoReveal")){const t=this.configurationService.getValue();this._autoReveal=t?.explorer?.autoReveal}e&&(e.affectsConfiguration("explorer.decorations.colors")||e.affectsConfiguration("explorer.decorations.badges"))&&this.refresh(!0)}storeTreeViewState(){this.storageService.store(cT.TREE_VIEW_STATE_STORAGE_KEY,JSON.stringify(this.tree.getViewState()),he.WORKSPACE,pt.MACHINE)}setContextKeys(e){const t=this.contextService.getWorkspace().folders,i=e?e.resource:t[t.length-1].uri;if(e=e||this.explorerService.findClosest(i),this.resourceContext.set(i),this.folderContext.set(!!e&&e.isDirectory),this.readonlyContext.set(!!e&&!!e.isReadonly),this.parentReadonlyContext.set(!!e?.parent?.isReadonly),this.rootContext.set(!!e&&e.isRoot),i){const n=i?this.editorResolverService.getEditors(i).map(o=>o.id):[];this.availableEditorIdsContext.set(n.join(","))}else this.availableEditorIdsContext.reset()}async onContextMenu(e){if(xne(e.browserEvent.target))return;const t=e.element;let i=e.anchor;if(Mh(i)&&t){const a=this.renderer.getCompressedNavigationController(t);a&&a.length>0&&(FF(e.browserEvent)||rFe(e.browserEvent.target)?i=a[0].labels[a[0].index]:a.forEach(c=>c.last()))}this.fileCopiedContextKey.set(await this.clipboardService.hasResources()),this.setContextKeys(t);const n=this.tree.getSelection(),o=this.explorerService.roots;let r;if(t instanceof Ss){const a=this.renderer.getCompressedNavigationController(t);r=a&&a.length?a[0].current.resource:t.resource}else r=o.length===1?o[0].resource:{};this.contextMenuService.showContextMenu({menuId:N.ExplorerContext,menuActionOptions:{arg:r,shouldForwardArgs:!0},contextKeyService:this.tree.contextKeyService,getAnchor:()=>i,onHide:a=>{a&&this.tree.domFocus()},getActionsContext:()=>t&&n&&n.indexOf(t)>=0?n.map(a=>a.resource):t instanceof Ss?[t.resource]:[]})}onFocusChanged(e){const t=e&&e.length?e[0]:void 0;if(this.setContextKeys(t),t){const n=!!this.configurationService.getValue().files?.enableTrash,o=this.fileService.hasCapability(t.resource,ph.Trash);this.resourceMoveableToTrash.set(n&&o)}else this.resourceMoveableToTrash.reset();const i=t&&this.renderer.getCompressedNavigationController(t);if(!i){this.compressedFocusContext.set(!1);return}this.compressedFocusContext.set(!0),i.forEach(n=>{this.updateCompressedNavigationContextKeys(n)})}refresh(e,t,i=!0){if(!this.tree||!this.isBodyVisible()||t&&!this.tree.hasNode(t)||this.findProvider?.isShowingFilterResults()&&e)return Promise.resolve(void 0);i&&this.explorerService.isEditable(void 0)&&this.tree.domFocus();const n=t||this.tree.getInput();return this.tree.updateChildren(n,e,!!t)}getOptimalWidth(){const e=this.tree.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".explorer-item .label-name"));return Lne(e,t)}async setTreeInput(){if(!this.isBodyVisible())return Promise.resolve(void 0);this.setTreeInputPromise&&await this.setTreeInputPromise;const e=!this.tree.getInput();e&&or("code/willResolveExplorer");const t=this.explorerService.roots;let i=t[0];(this.contextService.getWorkbenchState()!==zo.FOLDER||t[0].error)&&(i=t);let n;if(this.tree&&this.tree.getInput())n=this.tree.getViewState();else{const a=this.storageService.get(cT.TREE_VIEW_STATE_STORAGE_KEY,he.WORKSPACE);a&&(n=JSON.parse(a))}const o=this.tree.getInput(),r=this.setTreeInputPromise=this.tree.setInput(i,n).then(async()=>{if(Array.isArray(i)){if(!n||o instanceof Ss)for(let a=0;a<Math.min(i.length,5);a++)try{await this.tree.expand(i[a])}catch{}if(!o&&i.length===1&&this.configurationService.getValue().explorer.expandSingleFolderWorkspaces&&await this.tree.expand(i[0]).catch(()=>{}),Array.isArray(o)){const a=new wn;o.forEach(c=>a.set(c.resource,!0)),await Promise.all(i.map(async c=>{if(!a.has(c.resource))try{await this.tree.expand(c)}catch{}}))}}e&&or("code/didResolveExplorer")});this.progressService.withProgress({location:qo.Explorer,delay:this.layoutService.isRestored()?800:1500},a=>r),await r,this.decorationsProvider||(this.decorationsProvider=new v2(this.explorerService,this.contextService),this._register(this.decorationService.registerDecorationsProvider(this.decorationsProvider)))}async selectResource(e,t=this._autoReveal,i=0){if(i===2||!e||!this.isBodyVisible())return;this.setTreeInputPromise&&await this.setTreeInputPromise;let n=this.explorerService.findClosestRoot(e);for(;n&&n.resource.toString()!==e.toString();){try{await this.tree.expand(n)}catch{return this.selectResource(e,t,i+1)}if(!n.children.size)n=null;else for(const o of n.children.values()){if(this.uriIdentityService.extUri.isEqualOrParent(e,o.resource)){n=o;break}n=null}}if(n){if(n===this.tree.getInput()){this.tree.setFocus([]),this.tree.setSelection([]);return}try{n.nestedParent&&await this.tree.expand(n.nestedParent),(t===!0||t==="force")&&this.tree.getRelativeTop(n)===null&&this.tree.reveal(n,.5),this.tree.setFocus([n]),this.tree.setSelection([n])}catch{return this.selectResource(e,t,i+1)}}}itemsCopied(e,t,i){this.fileCopiedContextKey.set(e.length>0),this.resourceCutContextKey.set(t&&e.length>0),i?.forEach(n=>this.tree.rerender(n)),t&&e.forEach(n=>this.tree.rerender(n))}expandAll(){this.explorerService.isEditable(void 0)&&this.tree.domFocus(),this.tree.expandAll()}collapseAll(){this.explorerService.isEditable(void 0)&&this.tree.domFocus();const e=this.tree.getInput();if(Array.isArray(e)&&dFe(this.tree,e)){e.forEach(t=>{t.children.forEach(i=>this.tree.hasNode(i)&&this.tree.collapse(i,!0))});return}this.tree.collapseAll()}previousCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.previous(),this.updateCompressedNavigationContextKeys(i)})}nextCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.next(),this.updateCompressedNavigationContextKeys(i)})}firstCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.first(),this.updateCompressedNavigationContextKeys(i)})}lastCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.last(),this.updateCompressedNavigationContextKeys(i)})}updateCompressedNavigationContextKeys(e){this.compressedFocusFirstContext.set(e.index===0),this.compressedFocusLastContext.set(e.index===e.count-1)}updateAnyCollapsedContext(){const e=this.tree.getInput();if(e===void 0)return;const t=Array.isArray(e)?e:Array.from(e.children.values());this.viewHasSomeCollapsibleRootItem.set(lFe(this.tree,t)),this.storeTreeViewState()}hasPhantomElements(){return!!this.findProvider?.isShowingFilterResults()}dispose(){this.dragHandler?.dispose(),super.dispose()}};zy.__decorator=f([Ht],zy.prototype,"fileCopiedContextKey",null);zy.__decorator=f([Ht],zy.prototype,"resourceCutContextKey",null);zy=cT=f([p(1,mi),p(2,Os),p(3,J),p(4,Tt),p(5,bl),p(6,de),p(7,vf),p(8,vi),p(9,Ve),p(10,me),p(11,ne),p(12,kv),p(13,di),p(14,ft),p(15,li),p(16,wi),p(17,Qi),p(18,tt),p(19,Is),p(20,Xe),p(21,Zi),p(22,qe),p(23,hi)],zy);function Pue(s,e){s.classList.add("file-icon-themable-tree"),s.classList.add("show-file-icons");const t=i=>{s.classList.toggle("align-icons-and-twisties",i.hasFileIcons&&!i.hasFolderIcons),s.classList.toggle("hide-arrows",i.hidesExplorerArrows===!0)};return t(e.getFileIconTheme()),e.onDidFileIconThemeChange(t)}const Lue=x.or(x.and(uo,Bh),x.and(uo.toNegated(),uoe.toNegated()));K(class extends X{constructor(){super({id:"workbench.files.action.createFileFromExplorer",title:h(7280,"New File..."),f1:!1,icon:j.newFile,precondition:Lue,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",hd),order:10}})}run(s){s.get(qe).executeCommand(lD)}});K(class extends X{constructor(){super({id:"workbench.files.action.createFolderFromExplorer",title:h(7281,"New Folder..."),f1:!1,icon:j.newFolder,precondition:Lue,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",hd),order:20}})}run(s){s.get(qe).executeCommand(QO)}});K(class extends X{constructor(){super({id:"workbench.files.action.refreshFilesExplorer",title:I(7282,"Refresh Explorer"),f1:!0,icon:j.refresh,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",hd),order:30},metadata:{description:I(7283,"Forces a refresh of the Explorer.")},precondition:hoe.negate()})}async run(s){const e=s.get(mo),t=s.get(Qi);await e.openView(hd),await t.refresh()}});K(class extends X{constructor(){super({id:"workbench.files.action.collapseExplorerFolders",title:I(7284,"Collapse Folders in Explorer"),f1:!0,icon:j.collapseAll,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",hd),order:40},metadata:{description:I(7285,"Folds all folders in the Explorer.")}})}run(s){const t=s.get(mo).getViewWithId(hd);t!==null&&t.collapseAll()}});class gFe extends F{constructor(e,t){super(),this.title=e,this.context=t,this._onDidChangeHeight=this._register(new M),this.onDidChangeHeight=this._onDidChangeHeight.event,this._isExpanded=oi(this,!1),this.hasFollowingContent=this.context.contentIndex+1<this.context.content.length}get domNode(){return this._domNode??=this.init(),this._domNode}init(){const e=this.title,t=rL(".chat-used-context-label",void 0),i=this._register(new obe(t,{buttonBackground:void 0,buttonBorder:void 0,buttonForeground:void 0,buttonHoverBackground:void 0,buttonSecondaryBackground:void 0,buttonSecondaryForeground:void 0,buttonSecondaryHoverBackground:void 0,buttonSeparator:void 0}));this._domNode=rL(".chat-used-context",void 0,t),i.label=e,this._register(i.onDidClick(()=>{const o=this._isExpanded.get();this._isExpanded.set(!o,void 0)})),this._register(ki(o=>{const r=this._isExpanded.read(o);i.icon=r?j.chevronDown:j.chevronRight,this._domNode?.classList.toggle("chat-used-context-collapsed",!r),this.updateAriaLabel(i.element,typeof e=="string"?e:e.value,this.isExpanded()),this._domNode?.isConnected&&queueMicrotask(()=>{this._onDidChangeHeight.fire()})}));const n=this.initContent();return this._domNode.appendChild(n),this._domNode}updateAriaLabel(e,t,i){e.ariaLabel=i?h(4665,"{0}, expanded",t):h(4666,"{0}, collapsed",t)}addDisposable(e){this._register(e)}get expanded(){return this._isExpanded}isExpanded(){return this._isExpanded.get()}setExpanded(e){this._isExpanded.set(e,void 0)}}class pFe extends F{get inUse(){return this._inUse}constructor(e){super(),this._itemFactory=e,this.pool=[],this._inUse=new Set}get(){if(this.pool.length>0){const t=this.pool.pop();return this._inUse.add(t),t}const e=this._register(this._itemFactory());return this._inUse.add(e),e}release(e){this._inUse.delete(e),this.pool.push(e)}}var _2;const rL=Y;let b2=class extends gFe{constructor(e,t,i,n,o,r,a,c){super(t??(e.length>1?h(4685,"Used {0} references",e.length):h(4686,"Used {0} reference",1)),i),this.data=e,this.contentReferencesListPool=n,this.openerService=o,this.menuService=r,this.instantiationService=a,this.contextMenuService=c}initContent(){const t=this._register(this.contentReferencesListPool.get()).object;this._register(t.onDidOpen(a=>{if(a.element&&"reference"in a.element&&typeof a.element.reference=="object"){const c="variableName"in a.element.reference?a.element.reference.value:a.element.reference,d=R.isUri(c)?c:c?.uri;d&&this.openerService.open(d,{fromUserGesture:!0,editorOptions:{...a.editorOptions,selection:c&&"range"in c?c.range:void 0}})}})),this._register(t.onContextMenu(a=>{Li.stop(a.browserEvent,!0);const c=a.element&&QC(a.element);c&&this.contextMenuService.showContextMenu({getAnchor:()=>a.anchor,getActions:()=>{const d=this.menuService.getMenuActions(N.ChatAttachmentsContext,t.contextKeyService,{shouldForwardArgs:!0,arg:c});return sI(d)}})}));const i=this._register(this.instantiationService.createInstance(pi));this._register(t.onDidChangeFocus(a=>{i.reset();const c=a.elements.length?a.elements[0]:void 0,d=c&&QC(c);i.set(d??null)}));const r=Math.min(this.data.length,6)*22;return t.layout(r),t.getHTMLElement().style.height=`${r}px`,t.splice(0,t.length,this.data),t.getHTMLElement().parentElement}hasSameContent(e,t,i){return e.kind==="references"&&e.references.length===this.data.length&&!!t.length===this.hasFollowingContent}};b2=f([p(4,hi),p(5,tn),p(6,J),p(7,mi)],b2);let YZ=class extends b2{constructor(e,t,i,n,o,r,a,c,d){super(e,t,i,n,r,a,c,d),this.options=o,e.length===0&&Hs(this.domNode)}isExpanded(){const e=this.context.element;return e.usedReferencesExpanded??!!(this.options.expandedWhenEmptyResponse&&e.response.value.length===0)}setExpanded(e){const t=this.context.element;t.usedReferencesExpanded=!this.isExpanded()}};YZ=f([p(5,hi),p(6,tn),p(7,J),p(8,mi)],YZ);let y2=class extends F{get inUse(){return this._pool.inUse}constructor(e,t,i,n,o){super(),this._onDidChangeVisibility=e,this.menuId=t,this.instantiationService=i,this.themeService=n,this.labelService=o,this._pool=this._register(new pFe(()=>this.listFactory()))}listFactory(){const e=this._register(this.instantiationService.createInstance(vd,{onDidChangeVisibility:this._onDidChangeVisibility})),t=rL(".chat-used-context-list");return this._register(Pue(t,this.themeService)),this.instantiationService.createInstance(Pne,"ChatListRenderer",t,new fFe,[this.instantiationService.createInstance(aL,e,this.menuId)],{alwaysConsumeMouseWheel:!1,accessibilityProvider:{getAriaLabel:n=>{if(n.kind==="warning")return n.content.value;const o=n.reference;return typeof o=="string"?o:"variableName"in o?o.variableName:R.isUri(o)?Sn(o.path):Sn(o.uri.path)},getWidgetAriaLabel:()=>h(4687,"Collapsible Chat List")},dnd:{getDragURI:n=>QC(n)?.toString()??null,getDragLabel:(n,o)=>{const r=Vt(n.map(QC));if(r.length)return r.length===1?this.labelService.getUriLabel(r[0],{relative:!0}):`${r.length}`},dispose:()=>{},onDragOver:()=>!1,drop:()=>{},onDragStart:(n,o)=>{try{const r=n.getData(),a=Vt(r.map(QC));this.instantiationService.invokeFunction(c=>pg(c,a,o))}catch{}}}})}get(){const e=this._pool.get();let t=!1;return{object:e,isStale:()=>t,dispose:()=>{t=!0,this._pool.release(e)}}}};y2=f([p(2,J),p(3,ft),p(4,di)],y2);class fFe{getHeight(e){return 22}getTemplateId(e){return aL.TEMPLATE_ID}}let aL=class{static{_2=this}static{this.TEMPLATE_ID="chatCollapsibleListRenderer"}constructor(e,t,i,n,o,r){this.labels=e,this.menuId=t,this.themeService=i,this.productService=n,this.instantiationService=o,this.contextKeyService=r,this.templateId=_2.TEMPLATE_ID}renderTemplate(e){const t=new U,i=t.add(this.labels.create(e,{supportHighlights:!0,supportIcons:!0}));let n,o,r;if(this.menuId){o=rL(".chat-collapsible-list-action-bar"),r=t.add(this.contextKeyService.createScoped(o));const a=t.add(this.instantiationService.createChild(new pf([me,r])));n=t.add(a.createInstance(z_,o,this.menuId,{menuOptions:{shouldForwardArgs:!0,arg:void 0}})),i.element.appendChild(o)}return{templateDisposables:t,label:i,toolbar:n,actionBarContainer:o,contextKeyService:r}}getReferenceIcon(e){return Te.isThemeIcon(e.iconPath)?e.iconPath:this.themeService.getColorTheme().type===a2.DARK&&e.iconPath?.dark?e.iconPath?.dark:e.iconPath?.light}renderElement(e,t,i){if(e.kind==="warning"){i.label.setResource({name:e.content.value},{icon:j.warning});return}const n=e.reference,o=this.getReferenceIcon(e);i.label.element.style.display="flex";let r;if(typeof n=="object"&&"variableName"in n)if(n.value){const a=R.isUri(n.value)?n.value:n.value.uri;i.label.setResource({resource:a,name:el(a),description:`#${n.variableName}`,range:"range"in n.value?n.value.range:void 0},{icon:o,title:e.options?.status?.description??e.title})}else if(n.variableName.startsWith("kernelVariable")){const c=`${n.variableName.split(":")[1]}`;i.label.setLabel("Kernel variable",c,{title:e.options?.status?.description})}else i.label.setLabel("Unknown variable type");else if(typeof n=="string")i.label.setLabel(n,void 0,{iconPath:R.isUri(o)?o:void 0,title:e.options?.status?.description??e.title});else{const a="uri"in n?n.uri:n;r=a;const c=e.excluded?["excluded"]:[];if(a.scheme==="https"&&xF(a.authority,"github.com")&&a.path.includes("/tree/"))i.label.setResource(mFe(a),{icon:j.github,title:e.title,strikethrough:e.excluded,extraClasses:c});else if(a.scheme===this.productService.urlProtocol&&xF(a.authority,X0e)){const d=a.path.substring(1);i.label.setResource({resource:a,name:d},{icon:j.settingsGear,title:h(4688,"Open setting '{0}'",d),strikethrough:e.excluded,extraClasses:c})}else hq(a,ae.mailto,ae.http,ae.https)?i.label.setResource({resource:a,name:a.toString()},{icon:o??j.globe,title:e.options?.status?.description??e.title??a.toString(),strikethrough:e.excluded,extraClasses:c}):i.label.setFile(a,{fileKind:Hi.FILE,fileDecorations:void 0,range:"range"in n?n.range:void 0,title:e.options?.status?.description??e.title,strikethrough:e.excluded,extraClasses:c})}for(const a of[".monaco-icon-suffix-container",".monaco-icon-name-container"]){const c=i.label.element.querySelector(a);c&&(e.options?.status?.kind===xy.Omitted||e.options?.status?.kind===xy.Partial?c.classList.add("warning"):c.classList.remove("warning"))}e.state!==void 0&&(i.actionBarContainer&&(e.state===_d.Modified&&!i.actionBarContainer.classList.contains("modified")?(i.actionBarContainer.classList.add("modified"),i.label.element.querySelector(".monaco-icon-name-container")?.classList.add("modified")):e.state!==_d.Modified&&(i.actionBarContainer.classList.remove("modified"),i.label.element.querySelector(".monaco-icon-name-container")?.classList.remove("modified"))),i.toolbar&&(i.toolbar.context=r),i.contextKeyService&&e.state!==void 0&&RO.bindTo(i.contextKeyService).set(e.state))}disposeTemplate(e){e.templateDisposables.dispose()}};aL=_2=f([p(2,ft),p(3,Fn),p(4,J),p(5,me)],aL);function mFe(s){const e=s.path.split("/").slice(1,3).join("/"),t=s.path.split("/").slice(5),i=t.at(-1),n=vFe(s);return{resource:s,name:i??t.join("/"),description:[e,...t.slice(0,-1)].join("/"),range:n}}function vFe(s){if(!s.fragment)return;const e=s.fragment.match(/\bL(\d+)(?:-L(\d+))?/);if(!e)return;const t=parseInt(e[1]);if(isNaN(t))return;const i=e[2]?parseInt(e[2]):t;if(!isNaN(i))return{startLineNumber:t,startColumn:1,endLineNumber:i,endColumn:1}}function QC(s){if(s.kind==="warning")return null;const{reference:e}=s;return typeof e=="string"||"variableName"in e?null:R.isUri(e)?e:e.uri}K(class Mue extends X{static{this.id="workbench.action.chat.addToChatAction"}constructor(){super({id:Mue.id,title:{...I(4689,"Add File to Chat")},f1:!1,menu:[{id:N.ChatAttachmentsContext,group:"chat",order:1,when:x.and(pi.IsFileSystemResource,uo.negate())}]})}async run(e,t){const i=e.get(Pr);if(!t)return;const n=i.lastFocusedWidget;n&&n.attachmentModel.addFile(t)}});K(class Nue extends X{static{this.id="workbench.action.chat.copyLink"}constructor(){super({id:Nue.id,title:{...I(4690,"Copy Link")},f1:!1,menu:[{id:N.ChatAttachmentsContext,group:"chat",order:0,when:x.or(pi.Scheme.isEqualTo(ae.http),pi.Scheme.isEqualTo(ae.https))}]})}async run(e,t){await e.get(Is).writeResources([t])}});var wo;(function(s){s[s.FILE_INTERNAL=0]="FILE_INTERNAL",s[s.FILE_EXTERNAL=1]="FILE_EXTERNAL",s[s.FOLDER=2]="FOLDER",s[s.IMAGE=3]="IMAGE",s[s.SYMBOL=4]="SYMBOL",s[s.HTML=5]="HTML",s[s.MARKER=6]="MARKER",s[s.NOTEBOOK_CELL_OUTPUT=7]="NOTEBOOK_CELL_OUTPUT"})(wo||(wo={}));const _Fe=/^data:image\/[a-z]+;base64,/,bFe=/^https?:\/\/.+/;let w2=class extends pw{constructor(e,t,i,n,o,r,a,c,d,l,u){super(i),this.attachmentModel=e,this.styles=t,this.extensionService=n,this.fileService=o,this.editorService=r,this.dialogService=a,this.textModelService=c,this.webContentExtractorService=d,this.chatWidgetService=l,this.logService=u,this.overlays=new Map,this.overlayTextBackground="",this.currentActiveTarget=void 0,this.updateStyles()}addOverlay(e,t){this.removeOverlay(e);const{overlay:i,disposable:n}=this.createOverlay(e,t);this.overlays.set(e,{overlay:i,disposable:n})}removeOverlay(e){this.currentActiveTarget===e&&(this.currentActiveTarget=void 0);const t=this.overlays.get(e);t&&(t.overlay.remove(),t.disposable.dispose(),this.overlays.delete(e))}createOverlay(e,t){const i=document.createElement("div");i.classList.add("chat-dnd-overlay"),this.updateOverlayStyles(i),t.appendChild(i);const n=new Hp(e,{onDragOver:o=>{o.stopPropagation(),o.preventDefault(),e!==this.currentActiveTarget&&(this.currentActiveTarget&&this.setOverlay(this.currentActiveTarget,void 0),this.currentActiveTarget=e,this.onDragEnter(o,e))},onDragLeave:o=>{e===this.currentActiveTarget&&(this.currentActiveTarget=void 0),this.onDragLeave(o,e)},onDrop:o=>{o.stopPropagation(),o.preventDefault(),e===this.currentActiveTarget&&(this.currentActiveTarget=void 0,this.onDrop(o,e))}});return{overlay:i,disposable:n}}onDragEnter(e,t){const i=this.guessDropType(e);this.updateDropFeedback(e,t,i)}onDragLeave(e,t){this.updateDropFeedback(e,t,void 0)}onDrop(e,t){this.updateDropFeedback(e,t,void 0),this.drop(e)}async drop(e){const t=await this.resolveAttachmentsFromDragEvent(e);t.length!==0&&this.attachmentModel.addContext(...t)}updateDropFeedback(e,t,i){const n=i!==void 0;e.dataTransfer&&(e.dataTransfer.dropEffect=n?"copy":"none"),this.setOverlay(t,i)}guessDropType(e){if(Eo(e,io.NOTEBOOK_CELL_OUTPUT))return wo.NOTEBOOK_CELL_OUTPUT;if(yFe(e))return this.extensionService.extensions.some(t=>yE(t,"chatReferenceBinaryData"))?wo.IMAGE:void 0;if(Eo(e,"text/html"))return wo.HTML;if(Eo(e,io.SYMBOLS))return wo.SYMBOL;if(Eo(e,io.MARKERS))return wo.MARKER;if(Eo(e,bs.FILES))return wo.FILE_EXTERNAL;if(Eo(e,io.EDITORS))return wo.FILE_INTERNAL;if(Eo(e,Ii.uriList,io.FILES,bs.RESOURCES,bs.INTERNAL_URI_LIST))return wo.FOLDER}isDragEventSupported(e){return this.guessDropType(e)!==void 0}getDropTypeName(e){switch(e){case wo.FILE_INTERNAL:return h(4717,"File");case wo.FILE_EXTERNAL:return h(4717,"File");case wo.FOLDER:return h(4718,"Folder");case wo.IMAGE:return h(4719,"Image");case wo.SYMBOL:return h(4720,"Symbol");case wo.MARKER:return h(4721,"Problem");case wo.HTML:return h(4722,"URL");case wo.NOTEBOOK_CELL_OUTPUT:return h(4723,"Output")}}async resolveAttachmentsFromDragEvent(e){if(!this.isDragEventSupported(e))return[];if(Eo(e,io.NOTEBOOK_CELL_OUTPUT)){const o=cPe(e);if(o)return $Ne(o,this.editorService)}const t=aPe(e);if(t)return VNe(t);if(Eo(e,io.SYMBOLS)){const o=rPe(e);return HNe(o)}const i=tde(e);if(i.length>0)return Vt(await Promise.all(i.map(o=>hZ(o,this.fileService,this.editorService,this.textModelService,this.extensionService,this.dialogService))));const n=e.dataTransfer?.getData(bs.INTERNAL_URI_LIST);if(n){const o=ml.parse(n);if(o.length)return Vt(await Promise.all(o.map(r=>hZ({resource:R.parse(r)},this.fileService,this.editorService,this.textModelService,this.extensionService,this.dialogService))))}return!Eo(e,bs.INTERNAL_URI_LIST)&&Eo(e,Ii.uriList)&&(Eo(e,Ii.html)||Eo(e,Ii.text))?this.resolveHTMLAttachContext(e):[]}async downloadImageAsUint8Array(e){try{const i=await this.webContentExtractorService.readImage(R.parse(e),ye.None);if(i)return i.buffer}catch(i){this.logService.warn("Fetch failed:",i)}const t=this.chatWidgetService.lastFocusedWidget?.inputEditor.getSelection();t&&this.chatWidgetService.lastFocusedWidget&&this.chatWidgetService.lastFocusedWidget.inputEditor.executeEdits("chatInsertUrl",[{range:t,text:e}]),this.logService.warn(`Image URLs must end in .jpg, .png, .gif, .webp, or .bmp. Failed to fetch image from this URL: ${e}`)}async resolveHTMLAttachContext(e){const t=new Set(this.attachmentModel.attachments.map(d=>d.name)),i=()=>{const d=h(4724,"Image from URL");let l=d,u=1;for(;t.has(l);)l=`${d} ${++u}`;return t.add(l),l},n=async d=>{const l=R.parse(d);if(_Fe.test(d))return{data:ede(d),name:i(),resource:l};if(bFe.test(d)){const u=await this.downloadImageAsUint8Array(d);if(u)return{data:u,name:i(),resource:l,id:d}}},o=async d=>{try{const l=await d.arrayBuffer();return{data:new Uint8Array(l),name:i()}}catch(l){this.logService.error("Error reading file:",l)}},r=[],a=SFe(e);if(a.length){const d=await Promise.all(a.map(l=>o(l)));r.push(...d.filter(l=>!!l))}const c=wFe(e);if(c.length){const d=await Promise.all(c.map(n));r.push(...d.filter(l=>!!l))}return await Ble(r)}setOverlay(e,t){this.overlayText?.remove(),this.overlayText=void 0;const{overlay:i}=this.overlays.get(e);if(t!==void 0){const o=Lv(`$(${j.attach.id}) ${this.getOverlayText(t)}`).map(r=>typeof r=="string"?Y("span.overlay-text",void 0,r):r);this.overlayText=Y("span.attach-context-overlay-text",void 0,...o),this.overlayText.style.backgroundColor=this.overlayTextBackground,i.appendChild(this.overlayText)}i.classList.toggle("visible",t!==void 0)}getOverlayText(e){const t=this.getDropTypeName(e);return h(4725,"Attach {0} as Context",t)}updateOverlayStyles(e){e.style.backgroundColor=this.getColor(this.styles.overlayBackground)||"",e.style.color=this.getColor(this.styles.listForeground)||""}updateStyles(){this.overlays.forEach(e=>this.updateOverlayStyles(e.overlay)),this.overlayTextBackground=this.getColor(this.styles.listBackground)||""}};w2=f([p(2,ft),p(3,hn),p(4,Xe),p(5,de),p(6,Qt),p(7,yi),p(8,jN),p(9,Pr),p(10,Pe)],w2);function yFe(s){if(Eo(s,"image"))return!0;if(Eo(s,bs.FILES)){const e=s.dataTransfer?.files;if(e&&e.length>0)return Array.from(e).some(i=>i.type.startsWith("image/"));const t=s.dataTransfer?.items;if(t&&t.length>0)return Array.from(t).some(i=>i.type.startsWith("image/"))}return!1}function wFe(s,e){const t=s.dataTransfer?.getData("text/uri-list");if(t)try{const i=ml.parse(t);if(i.length>0)return i}catch{return[]}return[]}function SFe(s){const e=s.dataTransfer?.files;return e?Array.from(e).filter(t=>t.type.startsWith("image/")):[]}const CFe=Y;let S2=class extends F{constructor(e,t,i,n,o,r){super(),this.location=i,this.options=n,this.clickHandler=o,this.chatAgentService=r;const a=ee(e,CFe(".interactive-session-followups"));t.forEach(c=>this.renderFollowup(a,c))}renderFollowup(e,t){if(!this.chatAgentService.getDefaultAgent(this.location))return;const i=sTe(this.chatAgentService,this.location,"",t.agentId,t.subCommand);if(i===void 0)return;const n=t.kind==="reply"?t.title||t.message:t.title,o=t.kind==="reply"?t.message:t.title,r=(i+("tooltip"in t&&t.tooltip||o)).trim(),a=this._register(new Xu(e,{...this.options,title:r}));t.kind==="reply"?a.element.classList.add("interactive-followup-reply"):t.kind==="command"&&a.element.classList.add("interactive-followup-command"),a.element.ariaLabel=h(4825,"Follow up question: {0}",n),a.label=new Ni(n),this._register(a.onDidClick(()=>this.clickHandler(t)))}};S2=f([p(5,ff)],S2);function EFe(s){return(e,t,i)=>new C2(s,e,t,i)}let C2=class extends rbe{constructor(e,t,i,n){e.defaultValue&&typeof e.defaultValue=="object"&&(e.toStorage??=c=>JSON.stringify(c),e.fromStorage??=c=>JSON.parse(c));let o=e.defaultValue;const r=n.get(e.key,t);if(r!==void 0&&e.fromStorage)try{o=e.fromStorage(r)}catch{o=e.defaultValue}super(new One(void 0,`storage/${e.key}`,void 0),o,Fne),this._store=new U,this._didChange=!1;const a=n.onDidChangeValue(t,e.key,this._store);this._store.add(a(c=>{c.external&&c.key===e.key&&!this._didChange&&this.set(e.defaultValue,void 0)})),this._store.add(n.onWillSaveState(()=>{if(this._didChange){this._didChange=!1;const c=this.get();e.toStorage?n.store(e.key,e.toStorage(c),t,i):n.store(e.key,String(c),t,i)}}))}_setValue(e){super._setValue(e),this._didChange=!0}dispose(){this._store.dispose()}};C2=f([p(3,tt)],C2);class xFe{constructor(){this._data=new Map,this._obs=aC({equalsFn:()=>!1},this),this.observable=this._obs}get size(){return this._data.size}has(e){return this._data.has(e)}get(e){return this._data.get(e)}set(e,t,i){const n=this._data.has(e),o=this._data.get(e);return(!n||o!==t)&&(this._data.set(e,t),this._obs.set(this,i)),this}delete(e,t){const i=this._data.delete(e);return i&&this._obs.set(this,t),i}clear(e){this._data.size>0&&(this._data.clear(),this._obs.set(this,e))}forEach(e,t){this._data.forEach((i,n,o)=>{e.call(t,i,n,this)})}*entries(){yield*this._data.entries()}*keys(){yield*this._data.keys()}*values(){yield*this._data.values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"ObservableMap"}}const IFe=EFe({defaultValue:{},key:"chat/selectedTools"});let E2=class extends F{constructor(e,t,i){super(),this._toolsService=t,this._sessionSelectedTools=oi(this,{}),this.entriesMap=new xFe,this.entries=this.entriesMap.observable.map(function(o){const r=new Set;for(const[a,c]of o)c&&r.add(a);return r}),this._selectedTools=this._store.add(IFe(he.WORKSPACE,pt.MACHINE,i)),this._allTools=On(t.onDidChangeTools,()=>Array.from(t.getTools()));const n=fe(o=>{const r=this._selectedTools.read(o),a=this._sessionSelectedTools.read(o),c=new Set,d=new Set;for(const l of[r,a]){if(l.disabledToolSets)for(const u of l.disabledToolSets)c.add(u);if(l.disabledTools)for(const u of l.disabledTools)d.add(u)}if(!(c.size===0&&d.size===0))return{toolSetIds:c,toolIds:d}});this._store.add(ki(o=>{const r=this._allTools.read(o).filter(l=>l.canBeReferencedInPrompt),a=t.toolSets.read(o),c=new Set(this.entriesMap.keys()),d=e.read(o)===jt.Agent?n.read(o):void 0;ys(l=>{for(const u of r){const g=!d||!d.toolIds.has(u.id);this.entriesMap.set(u,g,l),c.delete(u)}for(const u of a){const g=!d||!d.toolSetIds.has(u.id);this.entriesMap.set(u,g,l),c.delete(u)}for(const u of c)this.entriesMap.delete(u,l)})}))}resetSessionEnablementState(){this._sessionSelectedTools.set({},void 0)}enable(e,t,i){const n=new Set(t.map(c=>c.id)),o=new Set(e.map(c=>c.id)),r=this._allTools.get().filter(c=>!n.has(c.id)),a=Array.from(this._toolsService.toolSets.get()).filter(c=>!o.has(c.id));this.disable(a,r,i)}disable(e,t,i){(i?this._sessionSelectedTools:this._selectedTools).set({disabledToolSets:e.map(o=>o.id),disabledTools:t.map(o=>o.id)},void 0)}asEnablementMap(){const e=new Map,t=this.entriesMap,i=(n,o)=>{const r=e.get(n);(o||!r)&&e.set(n,o)};for(const[n,o]of t)if(n instanceof SV)for(const r of n.getTools())i(r,t.get(r)??o);else n.canBeReferencedInPrompt&&i(n,o);return e}};E2=f([p(1,CI),p(2,tt)],E2);let x2=class extends vx{constructor(e,t,i,n,o){const r=i.createInstance(_x,e,t);super(r,t,i,n,o),this._register(r)}toString(){return`file-prompt:${this.uri.path}`}};x2=f([p(2,J),p(3,Tt),p(4,Pe)],x2);let I2=class extends x2{constructor(e,t,i,n){const{data:o}=e;ze(o instanceof R,`Variable data must be an URI, got '${o}'.`),super(o,{},t,i,n),this.reference=e}get id(){return this.reference.id}get range(){return this.reference.range}set range(e){this.reference.range=e}get data(){return this.uri}get isFile(){return this.reference.isFile}get fullName(){return this.reference.fullName}get icon(){return this.reference.icon}get modelDescription(){return this.reference.modelDescription}};I2=f([p(1,J),p(2,Tt),p(3,Pe)],I2);let QZ=class extends F{static{this.ID="chat.implicitContext"}constructor(e,t,i,n,o,r,a){super(),this.codeEditorService=e,this.editorService=t,this.chatWidgetService=i,this.chatService=n,this.chatEditingService=o,this.configurationService=r,this.ignoredFilesService=a,this._currentCancelTokenSource=this._register(new kt),this._implicitContextEnablement=this.configurationService.getValue("chat.implicitContext.enabled");const c=this._register(new U);this._register(D.runAndSubscribe(t.onDidActiveEditorChange,()=>{c.clear();const d=this.findActiveCodeEditor();d&&c.add(D.debounce(D.any(d.onDidChangeModel,d.onDidChangeModelLanguage,d.onDidChangeCursorSelection,d.onDidScrollChange),()=>{},500)(()=>this.updateImplicitContext()));const l=this.findActiveNotebookEditor();if(l){const u=c.add(new U);c.add(l.onDidChangeActiveCell(()=>{u.clear();const g=this.codeEditorService.getActiveCodeEditor();g&&g.getModel()?.uri.scheme===ae.vscodeNotebookCell&&u.add(D.debounce(D.any(g.onDidChangeModel,g.onDidChangeCursorSelection,g.onDidScrollChange),()=>{},500)(()=>this.updateImplicitContext()))})),c.add(D.debounce(D.any(l.onDidChangeModel,l.onDidChangeActiveCell),()=>{},500)(()=>this.updateImplicitContext()))}this.updateImplicitContext()})),this._register(ki(d=>{this.chatEditingService.editingSessionsObs.read(d),this.updateImplicitContext()})),this._register(this.configurationService.onDidChangeConfiguration(d=>{d.affectsConfiguration("chat.implicitContext.enabled")&&(this._implicitContextEnablement=this.configurationService.getValue("chat.implicitContext.enabled"),this.updateImplicitContext())})),this._register(this.chatService.onDidSubmitRequest(({chatSessionId:d})=>{const l=this.chatWidgetService.getWidgetBySessionId(d);l?.input.implicitContext&&this._implicitContextEnablement[l.location]==="first"&&l.viewModel?.getItems().length!==0&&l.input.implicitContext.setValue(void 0,!1,void 0)})),this._register(this.chatWidgetService.onDidAddWidget(async d=>{await this.updateImplicitContext(d)}))}findActiveCodeEditor(){const e=this.codeEditorService.getActiveCodeEditor();if(e){const t=e.getModel();if(t?.uri.scheme===ae.vscodeNotebookCell)return;if(t)return e}for(const t of this.editorService.getVisibleTextEditorControls(Ai.MOST_RECENTLY_ACTIVE)){const i=vw(t);if(!i)continue;if(i.getModel())return i}}findActiveNotebookEditor(){return dl(this.editorService.activeEditorPane)}async updateImplicitContext(e){const t=this._currentCancelTokenSource.value=new ri,i=this.findActiveCodeEditor(),n=i?.getModel(),o=i?.getSelection();let r,a=!1,c;if(n)if(c=n.getLanguageId(),o&&!o.isEmpty())r={uri:n.uri,range:o},a=!0;else{const g=i?.getVisibleRanges();if(g&&g.length>0){let m=g[0];g.slice(1).forEach(v=>{m=m.plusRange(v)}),r={uri:n.uri,range:m}}else r=n.uri}const d=this.findActiveNotebookEditor();if(d){const g=d.getActiveCell();if(g){const m=this.codeEditorService.getActiveCodeEditor(),v=m?.getSelection(),y=m?.getVisibleRanges()||[];if(r=g.uri,Dt(m?.getModel()?.uri,g.uri)){if(v&&!v.isEmpty())r={uri:g.uri,range:v},a=!0;else if(y.length>0){let w=y[0];y.slice(1).forEach(C=>{w=w.plusRange(C)}),r={uri:g.uri,range:w}}}}else r=d.textModel?.uri}const l=r instanceof R?r:r?.uri;if(l&&(await this.ignoredFilesService.fileIsIgnored(l,t.token)||l.path.endsWith(".copilotmd"))&&(r=void 0),t.token.isCancellationRequested)return;const u=e?[e]:[...this.chatWidgetService.getWidgetsByLocations(Vi.Panel),...this.chatWidgetService.getWidgetsByLocations(Vi.Editor)];for(const g of u){if(!g.input.implicitContext)continue;const m=this._implicitContextEnablement[g.location],v=g.viewModel?.getItems().length===0;m==="first"&&!v?g.input.implicitContext.setValue(void 0,!1,void 0):m==="always"||m==="first"&&v?g.input.implicitContext.setValue(r,a,c):m==="never"&&g.input.implicitContext.setValue(void 0,!1,void 0)}}};QZ=f([p(0,Ot),p(1,de),p(2,Pr),p(3,mf),p(4,bg),p(5,ne),p(6,wz)],QZ);let D2=class extends F{get id(){return this.prompt!==void 0?dp(this.prompt,!0).id:R.isUri(this.value)?"vscode.implicit.file":this.value?this._isSelection?"vscode.implicit.selection":"vscode.implicit.viewport":"vscode.implicit"}get name(){return this.prompt!==void 0?dp(this.prompt,!0).name:R.isUri(this.value)?`file:${je(this.value)}`:this.value?`file:${je(this.value.uri)}`:"implicit"}get modelDescription(){return this.prompt!==void 0?dp(this.prompt,!0).modelDescription:R.isUri(this.value)?"User's active file":this._isSelection?"User's active selection":"User's current visible code"}get isSelection(){return this._isSelection}get value(){return this._value}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._onDidChangeValue.fire()}constructor(e,t,i){super(),this.promptsService=e,this.modelService=t,this.logService=i,this.kind="implicit",this.isFile=!0,this._isSelection=!1,this._onDidChangeValue=this._register(new M),this.onDidChangeValue=this._onDidChangeValue.event,this._enabled=!0}setValue(e,t,i){this._value=e,this._isSelection=t,this.removePrompt(),e&&i===FO&&this.addPrompt(e),this._onDidChangeValue.fire()}async toBaseEntries(){return this.prompt===void 0?[{kind:"file",id:this.id,name:this.name,value:this.value,modelDescription:this.modelDescription}]:(await this.prompt.allSettled(),[...this.prompt.allValidReferences.map(e=>dp(e,!1)),dp({uri:this.prompt.uri,isPromptFile:!0},!0)])}get isPromptFile(){return this.prompt!==void 0}addPrompt(e){const t=R.isUri(e)?e:e.uri,i=this.modelService.getModel(t),n=i!==null;if(n===!1||i.isDisposed())return this.logService.warn(`cannot create prompt parser instance for ${t.path} (model exists: ${n})`);this.prompt=this.promptsService.getSyntaxParserFor(i)}removePrompt(){delete this.prompt}dispose(){this.removePrompt(),super.dispose()}};D2=f([p(0,HN),p(1,ai),p(2,Pe)],D2);let XZ=class extends F{static{this.ID="chat.relatedFilesWorkingSet"}constructor(e,t){super(),this.chatEditingService=e,this.chatWidgetService=t,this.chatEditingSessionDisposables=new Map,this._register(ki(i=>{this.chatEditingService.editingSessionsObs.read(i).forEach(o=>{const r=this.chatWidgetService.getWidgetBySessionId(o.chatSessionId);r&&!this.chatEditingSessionDisposables.has(o.chatSessionId)&&this._handleNewEditingSession(o,r)})}))}_updateRelatedFileSuggestions(e,t){this._currentRelatedFilesRetrievalOperation||e.entries.get().length>0||t.attachmentModel.fileAttachments.length===0||(this._currentRelatedFilesRetrievalOperation=this.chatEditingService.getRelatedFiles(e.chatSessionId,t.getInput(),t.attachmentModel.fileAttachments,ye.None).then(n=>{if(!n?.length||!t.viewModel?.sessionId||!t.input.relatedFiles)return;const o=this.chatEditingService.getEditingSession(t.viewModel.sessionId);if(!o||o.entries.get().length)return;const r=new Fp([...t.attachmentModel.fileAttachments,...t.input.relatedFiles.removedFiles]);if(!r.size)return;const a=new wn;for(const c of n)for(const d of c.files){if(a.size>=2)break;r.has(d.uri)||(a.set(d.uri,h(5035,"{0} (Suggested)",d.description)),r.add(d.uri))}t.input.relatedFiles.value=[...a.entries()].map(([c,d])=>({uri:c,description:d}))}).finally(()=>{this._currentRelatedFilesRetrievalOperation=void 0}))}_handleNewEditingSession(e,t){const i=new U;i.add(e.onDidDispose(()=>{i.clear()})),this._updateRelatedFileSuggestions(e,t);const n=D.debounce(t.inputEditor.onDidChangeModelContent,()=>null,3e3);i.add(n(()=>{this._updateRelatedFileSuggestions(e,t)})),i.add(t.attachmentModel.onDidChange(()=>{this._updateRelatedFileSuggestions(e,t)})),i.add(e.onDidDispose(()=>{i.dispose()})),i.add(t.onDidAcceptInput(()=>{t.input.relatedFiles?.clear(),this._updateRelatedFileSuggestions(e,t)})),this.chatEditingSessionDisposables.set(e.chatSessionId,i)}dispose(){for(const e of this.chatEditingSessionDisposables.values())e.dispose();super.dispose()}};XZ=f([p(0,bg),p(1,Pr)],XZ);class DFe extends F{constructor(){super(...arguments),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._removedFiles=new Fp,this._value=[]}get removedFiles(){return this._removedFiles}get value(){return this._value}set value(e){this._value=e,this._onDidChange.fire()}remove(e){this._value=this._value.filter(t=>!Dt(t.uri,e)),this._removedFiles.add(e),this._onDidChange.fire()}clearRemovedFiles(){this._removedFiles.clear()}clear(){this._value=[],this._removedFiles.clear(),this._onDidChange.fire()}}let k2=class extends abe{constructor(e,t,i,n){super(e,t),this._options=t,this.actionWidgetService=i,this.keybindingService=n}show(){let e=this._options.actionBarActions??this._options.actionBarActionProvider?.getActions()??[];const t=this._options.actions??this._options.actionProvider?.getActions()??[],i=[],n=new Map;for(const d of t){let l=d.category;l||(l={label:"",order:Number.MIN_SAFE_INTEGER}),n.has(l.label)||n.set(l.label,[]),n.get(l.label).push(d)}const o=Array.from(n.entries()).sort((d,l)=>{const u=d[1][0]?.category?.order??Number.MAX_SAFE_INTEGER,g=l[1][0]?.category?.order??Number.MAX_SAFE_INTEGER;return u-g});for(const[d,l]of o){d!==""&&i.push({label:d,kind:Uo.Header,canPreview:!1,disabled:!1,hideIcon:!1});for(const u of l)i.push({item:u,tooltip:u.tooltip,description:u.description,kind:Uo.Action,canPreview:!1,group:{title:"",icon:Te.fromId(u.checked?j.check.id:j.blank.id)},disabled:!1,hideIcon:!1,label:u.label,keybinding:this._options.showItemKeybindings?this.keybindingService.lookupKeybinding(u.id):void 0})}const r=Eh(),a={onSelect:(d,l)=>{this.actionWidgetService.hide(),d.run()},onHide:()=>{Mh(r)&&r.focus()}};e=e.map(d=>({...d,run:async(...l)=>(this.actionWidgetService.hide(),d.run(...l))}));const c={isChecked(d){return d.kind===Uo.Action&&!!d?.item?.checked},getRole:d=>d.kind===Uo.Action?"menuitemcheckbox":"separator",getWidgetRole:()=>"menu"};this.actionWidgetService.show(this._options.label??"",!1,i,a,this.element,void 0,e,c)}};k2=f([p(2,Ed),p(3,Ve)],k2);let cL=class extends YM{constructor(e,t,i,n,o){super(void 0,e),this.actionWidgetOptions=t,this._actionWidgetService=i,this._keybindingService=n,this._contextKeyService=o,this.actionItem=null}render(e){this.actionItem=e;const t=i=>(this.element=ee(i,Y("a.action-label")),this.renderLabel(this.element));this.actionWidgetDropdown=this._register(new k2(e,{...this.actionWidgetOptions,labelRenderer:t},this._actionWidgetService,this._keybindingService)),this._register(this.actionWidgetDropdown.onDidChangeVisibility(i=>{this.element?.setAttribute("aria-expanded",`${i}`)})),this.updateTooltip(),this.updateEnabled()}renderLabel(e){return e.classList.add("codicon"),this._action.label&&this._register(Nq().setupManagedHover(this.options.hoverDelegate??yr("mouse"),e,this._action.label)),null}updateAriaLabel(){this.element&&this.setAriaLabelAttributes(this.element)}setAriaLabelAttributes(e){e.setAttribute("role","button"),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-expanded","false"),e.ariaLabel=this.getTooltip()+" - "+(e.textContent||this._action.label)||""}getTooltip(){const e=this._keybindingService.lookupKeybinding(this.action.id,this._contextKeyService),t=e&&e.getLabel(),i=this.action.tooltip??this.action.label;return t?`${i} (${t})`:i}show(){this.actionWidgetDropdown?.show()}updateEnabled(){const e=!this.action.enabled;this.actionItem?.classList.toggle("disabled",e),this.element?.classList.toggle("disabled",e)}};cL=f([p(2,Ed),p(3,Ve),p(4,me)],cL);function kFe(s){return{getActions:()=>s.getModels().map(e=>({id:e.metadata.id,enabled:!0,checked:e.metadata.id===s.getCurrentModel()?.metadata.id,category:e.metadata.modelPickerCategory,class:void 0,description:e.metadata.cost,tooltip:e.metadata.description??e.metadata.name,label:e.metadata.name,run:()=>{s.setModel(e)}}))}}function TFe(s,e,t,i){const n=s.createMenu(N.ChatModelPicker,e),o=oI(n.getActions());n.dispose();const r=[];return o.length>0&&r.push(...o),i.entitlement===Jt.Free&&r.push({id:"moreModels",label:h(5039,"Add Premium Models"),enabled:!0,tooltip:h(5040,"Add premium models"),class:void 0,run:()=>{t.executeCommand("workbench.action.chat.upgradePlan")}}),r}let T2=class extends cL{constructor(e,t,i,n,o,r,a,c,d){const l={...e,label:t.metadata.name,tooltip:h(5041,"Pick Model"),run:()=>{}},u={actionProvider:kFe(i),actionBarActions:TFe(o,r,a,c)};super(l,u,n,d,r),this.currentModel=t,this._register(i.onDidChangeModel(g=>{this.currentModel=g,this.element&&this.renderLabel(this.element)}))}renderLabel(e){return ig(e,Y("span.chat-model-label",void 0,this.currentModel.metadata.name),...Lv("$(chevron-down)")),this.setAriaLabelAttributes(e),null}render(e){super.render(e),e.classList.add("chat-modelPicker-item")}};T2=f([p(3,Ed),p(4,tn),p(5,me),p(6,qe),p(7,VN),p(8,Ve)],T2);let A2=class extends cL{constructor(e,t,i,n,o,r,a,c,d){const l=(v,y)=>({...e,id:QX(v),label:SK(v),class:void 0,enabled:!0,checked:t.getMode().id===v,tooltip:n.getDefaultAgent(Vi.Panel,v)?.description??e.tooltip,run:async()=>{const w=await e.run({mode:v});return this.renderLabel(this.element),w},category:y?{label:h(5037,"Built-In"),order:0}:void 0}),u=v=>({...e,id:QX(v.name),label:v.name,class:void 0,enabled:!0,checked:t.getMode().id===v.id,tooltip:v.description??n.getDefaultAgent(Vi.Panel,v.kind)?.description??e.tooltip,run:async()=>{const y=await e.run({mode:v});return this.renderLabel(this.element),y},category:{label:h(5038,"Custom"),order:1}}),m={actionProvider:{getActions:()=>{const v=c.getModes(),y=v.custom&&v.custom.length>0,w=v.builtin.map(C=>l(C.kind,!!y));return v.custom&&w.push(...v.custom.map(C=>u(C))),w}},actionBarActionProvider:{getActions:()=>this.getModePickerActionBarActions()},showItemKeybindings:!0};super(e,m,i,o,r),this.delegate=t,this.contextKeyService=r,this.menuService=d,this._register(t.onDidChangeMode(()=>this.renderLabel(this.element)))}getModePickerActionBarActions(){const e=this.menuService.createMenu(N.ChatModePicker,this.contextKeyService),t=oI(e.getActions({renderShortTitle:!0}));return e.dispose(),t}renderLabel(e){if(!this.element)return null;this.setAriaLabelAttributes(e);const t=this.delegate.getMode().name;return ig(e,Y("span.chat-model-label",void 0,t),...Lv("$(chevron-down)")),null}render(e){super.render(e),e.classList.add("chat-modelPicker-item")}};A2=f([p(2,Ed),p(3,ff),p(4,Ve),p(5,me),p(6,HN),p(7,Ude),p(8,tn)],A2);var dT;const Of=Y,ZZ=250,JZ="chat.lastChatMode";let R2=class extends F{static{dT=this}static{this.INPUT_SCHEME="chatSessionInput"}static{this._counter=0}get attachmentModel(){return this._attachmentModel}async getAttachedAndImplicitContext(e){const t=[...this.attachmentModel.attachments];if(this.implicitContext?.enabled&&this.implicitContext.value){const n=await this.implicitContext.toBaseEntries();t.push(...n)}const i=this.variableService.getDynamicVariables(e);for(const n of i)n instanceof I2&&t.push(...n.allValidReferences.map(o=>dp(o,!1)));return await ePe("instructions tree resolve",this.promptInstructionsAttachmentsPart.allSettled.bind(this.promptInstructionsAttachmentsPart),this.logService.trace.bind(this.logService)),t.push(...this.promptInstructionsAttachmentsPart.chatAttachments),t}get hasPromptFileAttachments(){return this.promptInstructionsAttachmentsPart.hasInstructions?!0:this.implicitContext===void 0?!1:this.implicitContext.isPromptFile&&this.implicitContext.enabled}get implicitContext(){return this._implicitContext}get relatedFiles(){return this._relatedFiles}get inputPartHeight(){return this._inputPartHeight}get followupsHeight(){return this._followupsHeight}get editSessionWidgetHeight(){return this._editSessionWidgetHeight}get attachmentsHeight(){return this.attachmentsContainer.offsetHeight+(this.attachmentsContainer.checkVisibility()?6:0)}get inputEditor(){return this._inputEditor}get currentLanguageModel(){return this._currentLanguageModel?.identifier}get selectedLanguageModel(){return this._currentLanguageModel}get currentMode(){return this._currentMode.kind===jt.Agent&&!this.agentService.hasToolsAgent?jt.Edit:this._currentMode.kind}get currentMode2(){return this._currentMode}get selectedElements(){const e=[],i=this._chatEditList?.object?.getSelectedElements()??[];for(const n of i)n.kind==="reference"&&R.isUri(n.reference)&&e.push(n.reference);return e}get attemptedWorkingSetEntriesCount(){return this._attemptedWorkingSetEntriesCount}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A,B,z,Q,ie,oe){super(),this.location=e,this.options=t,this.historyService=o,this.modelService=r,this.instantiationService=a,this.contextKeyService=c,this.configurationService=d,this.keybindingService=l,this.accessibilityService=u,this.languageModelsService=g,this.logService=m,this.fileService=v,this.editorService=y,this.themeService=w,this.textModelResolverService=C,this.storageService=T,this.labelService=k,this.variableService=A,this.agentService=B,this.sharedWebExtracterService=z,this.experimentService=Q,this.entitlementService=ie,this.chatModeService=oe,this._onDidLoadInputState=this._register(new M),this.onDidLoadInputState=this._onDidLoadInputState.event,this._onDidChangeHeight=this._register(new M),this.onDidChangeHeight=this._onDidChangeHeight.event,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new M),this.onDidBlur=this._onDidBlur.event,this._onDidChangeContext=this._register(new M),this.onDidChangeContext=this._onDidChangeContext.event,this._onDidAcceptFollowup=this._register(new M),this.onDidAcceptFollowup=this._onDidAcceptFollowup.event,this._indexOfLastAttachedContextDeletedWithKeyboard=-1,this._indexOfLastOpenedContext=-1,this._onDidChangeVisibility=this._register(new M),this._contextResourceLabels=this.instantiationService.createInstance(vd,{onDidChangeVisibility:this._onDidChangeVisibility.event}),this.inputEditorHeight=0,this.followupsDisposables=this._register(new U),this.attachedContextDisposables=this._register(new kt),this._inputPartHeight=0,this._followupsHeight=0,this._editSessionWidgetHeight=0,this._waitForPersistedLanguageModel=this._register(new kt),this._onDidChangeCurrentLanguageModel=this._register(new M),this._onDidChangeCurrentChatMode=this._register(new M),this.onDidChangeCurrentChatMode=this._onDidChangeCurrentChatMode.event,this._currentMode=Ca.Ask,this.inputUri=R.parse(`${dT.INPUT_SCHEME}:input-${dT._counter++}`),this._chatEditsActionsDisposables=this._register(new U),this._chatEditsDisposables=this._register(new U),this._attemptedWorkingSetEntriesCount=0,this._register(this.editorService.onDidActiveEditorChange(()=>{this._indexOfLastOpenedContext=-1})),this._attachmentModel=this._register(this.instantiationService.createInstance(rU)),this.selectedToolsModel=this._register(this.instantiationService.createInstance(E2,On(this,this.onDidChangeCurrentChatMode,()=>this.currentMode))),this.dnd=this._register(this.instantiationService.createInstance(w2,this._attachmentModel,i)),this.getInputState=()=>({...n(),chatContextAttachments:this._attachmentModel.attachments,chatMode:this._currentMode}),this.inputEditorMaxHeight=this.options.renderStyle==="compact"?ZZ/3:ZZ,this.inputEditorHasText=ve.inputHasText.bindTo(c),this.chatCursorAtTop=ve.inputCursorAtTop.bindTo(c),this.inputEditorHasFocus=ve.inputHasFocus.bindTo(c),this.promptFileAttached=ve.hasPromptFile.bindTo(c),this.chatMode=ve.chatMode.bindTo(c),this.history=this.loadHistory(),this._register(this.historyService.onDidClearHistory(()=>this.history=new L7([{text:"",state:this.getInputState()}],gMe,eJ))),this._register(this.configurationService.onDidChangeConfiguration(xe=>{xe.affectsConfiguration(Un.Chat)&&this.inputEditor.updateOptions({ariaLabel:this._getAriaLabel()})})),this._chatEditsListPool=this._register(this.instantiationService.createInstance(y2,this._onDidChangeVisibility.event,N.ChatEditingWidgetModifiedFilesToolbar)),this._hasFileAttachmentContextKey=ve.hasFileAttachments.bindTo(c),this.promptInstructionsAttachmentsPart=this._register(a.createInstance(WH,this.attachmentModel.promptInstructions,this._contextResourceLabels)),this._register(this.promptInstructionsAttachmentsPart.onAttachmentsChange(()=>{this._handleAttachedContextChange(),this._onDidChangeHeight.fire()})),this.initSelectedModel(),this._register(this.onDidChangeCurrentChatMode(()=>this.accessibilityService.alert(this._currentMode.kind))),this._register(this._onDidChangeCurrentLanguageModel.event(()=>{this._currentLanguageModel?.metadata.name&&this.accessibilityService.alert(this._currentLanguageModel.metadata.name)})),this._register(this.chatModeService.onDidChangeChatModes(()=>this.validateCurrentChatMode()))}getSelectedModelStorageKey(){return`chat.currentLanguageModel.${this.location}`}getSelectedModelIsDefaultStorageKey(){return`chat.currentLanguageModel.${this.location}.isDefault`}initSelectedModel(){const e=this.storageService.get(this.getSelectedModelStorageKey(),he.APPLICATION),t=this.storageService.getBoolean(this.getSelectedModelIsDefaultStorageKey(),he.APPLICATION,e==="github.copilot-chat/gpt-4o");if(e){const i=this.languageModelsService.lookupLanguageModel(e);i?(!t||i.isDefault)&&(this.setCurrentLanguageModel({metadata:i,identifier:e}),this.checkModelSupported()):this._waitForPersistedLanguageModel.value=this.languageModelsService.onDidChangeLanguageModels(n=>{const o=n.added?.find(r=>r.identifier===e);o&&(this._waitForPersistedLanguageModel.clear(),(!t||o.metadata.isDefault)&&o.metadata.isUserSelectable&&(this.setCurrentLanguageModel({metadata:o.metadata,identifier:e}),this.checkModelSupported()))})}this._register(this._onDidChangeCurrentChatMode.event(()=>{this.checkModelSupported()})),this._register(this.configurationService.onDidChangeConfiguration(i=>{i.affectsConfiguration(Sy.Edits2Enabled)&&this.checkModelSupported()}))}switchModel(e){const i=this.getModels().find(n=>n.metadata.vendor===e.vendor&&n.metadata.id===e.id&&n.metadata.family===e.family);i&&this.setCurrentLanguageModel(i)}switchToNextModel(){const e=this.getModels();if(e.length>0){const i=(e.findIndex(n=>n.identifier===this._currentLanguageModel?.identifier)+1)%e.length;this.setCurrentLanguageModel(e[i])}}openModelPicker(){this.modelWidget?.show()}checkModelSupported(){this._currentLanguageModel&&!this.modelSupportedForDefaultAgent(this._currentLanguageModel)&&this.setCurrentLanguageModelToDefault()}setChatMode(e,t=!0){if(!this.options.supportsChangingModes)return;const i=Hde(e)??Ca.Ask;this.setChatMode2(i,t)}setChatMode2(e,t=!0){this.options.supportsChangingModes&&(this._currentMode=e,this.chatMode.set(e.kind),this._onDidChangeCurrentChatMode.fire(),t&&this.storageService.store(JZ,e.kind,he.APPLICATION,pt.USER))}modelSupportedForDefaultAgent(e){return this.currentMode===jt.Agent||this.currentMode===jt.Edit&&this.configurationService.getValue(Sy.Edits2Enabled)?this.configurationService.getValue("chat.agent.allModels")?!0:(typeof e.metadata.capabilities?.agentMode>"u"||e.metadata.capabilities.agentMode)&&!!e.metadata.capabilities?.toolCalling:!0}getModels(){const e=this.languageModelsService.getLanguageModelIds().map(t=>({identifier:t,metadata:this.languageModelsService.lookupLanguageModel(t)})).filter(t=>t.metadata?.isUserSelectable&&this.modelSupportedForDefaultAgent(t));return e.sort((t,i)=>t.metadata.name.localeCompare(i.metadata.name)),e}setCurrentLanguageModelToDefault(){const e=this.languageModelsService.getLanguageModelIds().find(n=>this.languageModelsService.lookupLanguageModel(n)?.isDefault),i=this.languageModelsService.getLanguageModelIds().find(n=>{const o=this.languageModelsService.lookupLanguageModel(n);return o?.isUserSelectable&&!o.isDefault})&&e?{metadata:this.languageModelsService.lookupLanguageModel(e),identifier:e}:void 0;i&&this.setCurrentLanguageModel(i)}setCurrentLanguageModel(e){this._currentLanguageModel=e,this.cachedDimensions&&this.layout(this.cachedDimensions.height,this.cachedDimensions.width),this.storageService.store(this.getSelectedModelStorageKey(),e.identifier,he.APPLICATION,pt.USER),this.storageService.store(this.getSelectedModelIsDefaultStorageKey(),!!e.metadata.isDefault,he.APPLICATION,pt.USER),this._onDidChangeCurrentLanguageModel.fire(e)}loadHistory(){const e=this.historyService.getHistory(this.location);return e.length===0&&e.push({text:"",state:this.getInputState()}),new L7(e,50,eJ)}_getAriaLabel(){if(this.configurationService.getValue(Un.Chat)){const t=this.keybindingService.lookupKeybinding(Mo.OpenAccessibilityHelp)?.getLabel();return t?h(4837,"Chat Input,  Type to ask questions or type / for topics, press enter to send out the request. Use {0} for Chat Accessibility Help.",t):h(4838,"Chat Input,  Type code here and press Enter to run. Use the Chat Accessibility Help command for more information.")}return h(4839,"Chat Input")}async validateCurrentChatMode(){const e=this._currentMode;if(hMe(e))return;const i=(await this.chatModeService.getModesAsync()).custom?.find(n=>n.id===e.id);if(!i){this.setChatMode2(Ca.Agent);return}this.setChatMode2(i)}initForNewChatModel(e,t){this.history=this.loadHistory(),this.history.add({text:e.inputValue??this.history.current().text,state:e.inputState??this.getInputState()});const i=e.inputState?.chatContextAttachments??[];if(this._attachmentModel.clearAndSetContext(...i),this.selectedToolsModel.resetSessionEnablementState(),e.inputValue&&this.setValue(e.inputValue,!1),e.inputState?.chatMode)typeof e.inputState.chatMode=="string"?this.setChatMode(e.inputState.chatMode):(this.setChatMode2(e.inputState.chatMode),this.validateCurrentChatMode());else{const n=this.storageService.get(JZ,he.APPLICATION);iTe(n)&&this.setChatMode(n)}if(t&&this.entitlementService.entitlement!==Jt.Free){const n=this.getDefaultModeExperimentStorageKey();this.storageService.getBoolean(n,he.WORKSPACE,!1)||Promise.all([this.experimentService.getTreatment("chat.defaultMode"),this.experimentService.getTreatment("chat.defaultLanguageModel")]).then(([r,a])=>{if(typeof r=="string"){this.storageService.store(n,!0,he.WORKSPACE,pt.MACHINE);const c=cce(r);c&&(this.logService.trace(`Applying default mode from experiment: ${c}`),this.setChatMode(c,!1),this.checkModelSupported())}typeof a=="string"&&this._currentMode.kind===jt.Agent&&(this.storageService.store(n,!0,he.WORKSPACE,pt.MACHINE),this.logService.trace(`Applying default language model from experiment: ${a}`),this.setExpModelOrWait(a))})}}setExpModelOrWait(e){const t=this.languageModelsService.lookupLanguageModel(e);t?(this.setCurrentLanguageModel({metadata:t,identifier:e}),this.checkModelSupported(),this._waitForPersistedLanguageModel.clear()):this._waitForPersistedLanguageModel.value=this.languageModelsService.onDidChangeLanguageModels(i=>{const n=i.added?.find(o=>o.identifier===e);n&&(this._waitForPersistedLanguageModel.clear(),n.metadata.isUserSelectable&&(this.setCurrentLanguageModel({metadata:n.metadata,identifier:e}),this.checkModelSupported()))})}getDefaultModeExperimentStorageKey(){return`chat.${this.options.widgetViewKindTag}.hasSetDefaultModeByExperiment`}logInputHistory(){const e=[...this.history].map(t=>JSON.stringify(t)).join(`
`);this.logService.info(`[${this.location}] Chat input history:`,e)}setVisible(e){this._onDidChangeVisibility.fire(e)}get generating(){return this._generating?.defer.p}startGenerating(){return this.logService.trace("ChatWidget#startGenerating"),this._generating?this._generating.rc++:this._generating={rc:1,defer:new Zo},Ee(()=>{this.logService.trace("ChatWidget#doneGenerating"),this._generating&&!--this._generating.rc&&(this._generating.defer.complete(),this._generating=void 0)})}get element(){return this.container}async showPreviousValue(){const e=this.getInputState();if(this.history.isAtEnd())this.saveCurrentValue(e);else{const t=this.getFilteredEntry(this._inputEditor.getValue(),e);this.history.has(t)||(this.saveCurrentValue(e),this.history.resetCursor())}this.navigateHistory(!0)}async showNextValue(){const e=this.getInputState();if(!this.history.isAtEnd()){{const t=this.getFilteredEntry(this._inputEditor.getValue(),e);this.history.has(t)||(this.saveCurrentValue(e),this.history.resetCursor())}this.navigateHistory(!1)}}async navigateHistory(e){const t=e?this.history.previous():this.history.next();let i=t.state?.chatContextAttachments??[];i.length>0&&(i=(await Promise.all(i.map(async o=>{if(rb(o)&&o.references?.length&&R.isUri(o.references[0].reference)){const r=o.references[0].reference;try{const a=r.toString(!0).startsWith("http")?await this.sharedWebExtracterService.readImage(r,ye.None):(await this.fileService.readFile(r)).value;if(!a)return;const c={...o};return c.value=rb(o)&&o.isPasted?a.buffer:await LK(a.buffer),c}catch(a){this.logService.error("Failed to fetch and reference.",a);return}}return o}))).filter(o=>o!==void 0)),this._attachmentModel.clearAndSetContext(...i),Kc(t.text),this.setValue(t.text,!0),this._onDidLoadInputState.fire(t.state);const n=this._inputEditor.getModel();if(n)if(e){const o=this._inputEditor._getViewModel()?.getLineLength(1)??1,r=n.getLineLength(1);o===r?this._inputEditor.setPosition({lineNumber:1,column:o+1}):this._inputEditor.setPosition({lineNumber:1,column:o})}else this._inputEditor.setPosition(tJ(n))}setValue(e,t){this.inputEditor.setValue(e),this.inputEditor.setPosition({lineNumber:1,column:e.length+1}),t||this.saveCurrentValue(this.getInputState())}saveCurrentValue(e){const t=this.getFilteredEntry(this._inputEditor.getValue(),e);this.history.replaceLast(t)}focus(){this._inputEditor.focus()}hasFocus(){return this._inputEditor.hasWidgetFocus()}async acceptInput(e){if(e){const t=this._inputEditor.getValue(),i=this.getInputState(),n=this.getFilteredEntry(t,i);this.history.replaceLast(n),this.history.add({text:""})}this.attachmentModel.clear(),this._onDidLoadInputState.fire({}),this.accessibilityService.isScreenReaderOptimized()&&qt?this._acceptInputForVoiceover():(this._inputEditor.focus(),this._inputEditor.setValue(""))}validateAgentMode(){!this.agentService.hasToolsAgent&&this._currentMode.kind===jt.Agent&&this.setChatMode(jt.Edit)}getFilteredEntry(e,t){const i=t.chatContextAttachments?.map(o=>{if(rb(o)&&o.references?.length&&o.value){const r={...o};return r.value=void 0,r}return o});return t.chatContextAttachments=i,{text:e,state:t}}_acceptInputForVoiceover(){const e=this._inputEditor.getDomNode();e&&(e.remove(),this._inputEditor.setValue(""),this._inputEditorElement.appendChild(e),this._inputEditor.focus())}_handleAttachedContextChange(){this._hasFileAttachmentContextKey.set(!!this._attachmentModel.attachments.find(e=>e.kind==="file")),this.renderAttachedContext()}render(e,t,i){let n;this.options.renderStyle==="compact"?n=rn(".interactive-input-part",[rn(".interactive-input-and-edit-session",[rn(".chat-editing-session@chatEditingSessionWidgetContainer"),rn(".interactive-input-and-side-toolbar@inputAndSideToolbar",[rn(".chat-input-container@inputContainer",[rn(".chat-editor-container@editorContainer"),rn(".chat-input-toolbars@inputToolbars")])]),rn(".chat-attachments-container@attachmentsContainer",[rn(".chat-attachment-toolbar@attachmentToolbar"),rn(".chat-attached-context@attachedContextContainer"),rn(".chat-related-files@relatedFilesContainer")]),rn(".interactive-input-followups@followupsContainer")])]):n=rn(".interactive-input-part",[rn(".interactive-input-followups@followupsContainer"),rn(".chat-editing-session@chatEditingSessionWidgetContainer"),rn(".interactive-input-and-side-toolbar@inputAndSideToolbar",[rn(".chat-input-container@inputContainer",[rn(".chat-attachments-container@attachmentsContainer",[rn(".chat-attachment-toolbar@attachmentToolbar"),rn(".chat-related-files@relatedFilesContainer"),rn(".chat-attached-context@attachedContextContainer")]),rn(".chat-editor-container@editorContainer"),rn(".chat-input-toolbars@inputToolbars")])])]),this.container=n.root,e.append(this.container),this.container.classList.toggle("compact",this.options.renderStyle==="compact"),this.followupsContainer=n.followupsContainer;const o=n.inputAndSideToolbar,r=n.inputContainer,a=n.editorContainer;this.attachmentsContainer=n.attachmentsContainer,this.attachedContextContainer=n.attachedContextContainer,this.relatedFilesContainer=n.relatedFilesContainer;const c=n.inputToolbars,d=n.attachmentToolbar;this.chatEditingSessionWidgetContainer=n.chatEditingSessionWidgetContainer,this.options.enableImplicitContext&&(this._implicitContext=this._register(this.instantiationService.createInstance(D2)),this._register(this._implicitContext.onDidChangeValue(()=>{this._indexOfLastAttachedContextDeletedWithKeyboard=-1,this._handleAttachedContextChange()}))),this.renderAttachedContext(),this._register(this._attachmentModel.onDidChange(k=>{k.added.length>0&&(this._indexOfLastAttachedContextDeletedWithKeyboard=-1),this._handleAttachedContextChange()})),this.renderChatEditingSessionState(null),this.options.renderWorkingSet&&(this._relatedFiles=this._register(new DFe),this._register(this._relatedFiles.onDidChange(()=>this.renderChatRelatedFiles()))),this.renderChatRelatedFiles(),this.dnd.addOverlay(this.options.dndContainer??e,this.options.dndContainer??e);const l=this._register(this.contextKeyService.createScoped(r));ve.inChatInput.bindTo(l).set(!0);const u=this._register(this.instantiationService.createChild(new pf([me,l]))),{historyNavigationBackwardsEnablement:g,historyNavigationForwardsEnablement:m}=this._register(IO(l,this));this.historyNavigationBackwardsEnablement=g,this.historyNavigationForewardsEnablement=m;const v=rMe(this.configurationService);v.overflowWidgetsDomNode=this.options.editorOverflowWidgetsDomNode,v.pasteAs=rI.pasteAs.defaultValue,v.readOnly=!1,v.ariaLabel=this._getAriaLabel(),v.fontFamily=CSe,v.fontSize=13,v.lineHeight=20,v.padding=this.options.renderStyle==="compact"?{top:2,bottom:2}:{top:8,bottom:8},v.cursorWidth=1,v.wrappingStrategy="advanced",v.bracketPairColorization={enabled:!1},v.suggest={showIcons:!0,showSnippets:!1,showWords:!0,showStatusBar:!1,insertMode:"replace"},v.scrollbar={...v.scrollbar??{},vertical:"hidden"},v.stickyScroll={enabled:!1},this._inputEditorElement=ee(a,Of(Oue));const y=aMe();y.contributions?.push(...xE.getSomeEditorContributions([ps.ID,Hy.ID,cg.ID,md.ID,gv.ID])),this._inputEditor=this._register(u.createInstance(hI,this._inputEditorElement,v,y)),ea.get(this._inputEditor)?.forceRenderingAbove(),v.overflowWidgetsDomNode?.classList.add("hideSuggestTextIcons"),this._inputEditorElement.classList.add("hideSuggestTextIcons"),this._register(this._inputEditor.onDidChangeModelContent(()=>{const k=Math.min(this._inputEditor.getContentHeight(),this.inputEditorMaxHeight);k!==this.inputEditorHeight&&(this.inputEditorHeight=k,this._onDidChangeHeight.fire());const A=this._inputEditor.getModel(),B=!!A&&A.getValue().trim().length>0;this.inputEditorHasText.set(B)})),this._register(this._inputEditor.onDidContentSizeChange(k=>{k.contentHeightChanged&&(this.inputEditorHeight=k.contentHeight,this._onDidChangeHeight.fire())})),this._register(this._inputEditor.onDidFocusEditorText(()=>{this.inputEditorHasFocus.set(!0),this._onDidFocus.fire(),r.classList.toggle("focused",!0)})),this._register(this._inputEditor.onDidBlurEditorText(()=>{this.inputEditorHasFocus.set(!1),r.classList.toggle("focused",!1),this._onDidBlur.fire()})),this._register(this._inputEditor.onDidBlurEditorWidget(()=>{md.get(this._inputEditor)?.clearWidgets(),cg.get(this._inputEditor)?.clearWidgets()}));const w=this._register(Km());if(this._register(co(c,pe.CLICK,k=>this.inputEditor.focus())),this._register(co(this.attachmentsContainer,pe.CLICK,k=>this.inputEditor.focus())),this.inputActionsToolbar=this._register(this.instantiationService.createInstance(z_,c,N.ChatInput,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{shouldForwardArgs:!0},hiddenItemStrategy:Ak.Ignore,hoverDelegate:w,actionViewItemProvider:(k,A)=>{if(k.id===nle&&k instanceof va){if(this._currentLanguageModel||this.setCurrentLanguageModelToDefault(),this._currentLanguageModel){const B={getCurrentModel:()=>this._currentLanguageModel,onDidChangeModel:this._onDidChangeCurrentLanguageModel.event,setModel:z=>{this._waitForPersistedLanguageModel.clear(),this.setCurrentLanguageModel(z),this.renderAttachedContext()},getModels:()=>this.getModels()};return this.modelWidget=this.instantiationService.createInstance(T2,k,this._currentLanguageModel,B)}}else if(k.id===Jde&&k instanceof va){const B={getMode:()=>this.currentMode2,onDidChangeMode:this._onDidChangeCurrentChatMode.event};return this.instantiationService.createInstance(A2,k,B)}}})),this.inputActionsToolbar.getElement().classList.add("chat-input-toolbar"),this.inputActionsToolbar.context={widget:i},this._register(this.inputActionsToolbar.onDidChangeMenuItems(()=>{this.cachedDimensions&&typeof this.cachedInputToolbarWidth=="number"&&this.cachedInputToolbarWidth!==this.inputActionsToolbar.getItemsWidth()&&this.layout(this.cachedDimensions.height,this.cachedDimensions.width)})),this.executeToolbar=this._register(this.instantiationService.createInstance(z_,c,this.options.menus.executeToolbar,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{shouldForwardArgs:!0},hoverDelegate:w,hiddenItemStrategy:Ak.Ignore,actionViewItemProvider:(k,A)=>{if((this.location===Vi.Panel||this.location===Vi.Editor)&&(k.id===XK.ID||k.id===JK.ID||k.id===ZK.ID)&&k instanceof va){const B=this.instantiationService.createInstance(va,{id:"chat.moreExecuteActions",title:h(4840,"More..."),icon:j.chevronDown},void 0,void 0,void 0,void 0);return this.instantiationService.createInstance(P2,k,B,{...A,menuAsChild:!1})}}})),this.executeToolbar.getElement().classList.add("chat-execute-toolbar"),this.executeToolbar.context={widget:i},this._register(this.executeToolbar.onDidChangeMenuItems(()=>{this.cachedDimensions&&typeof this.cachedExecuteToolbarWidth=="number"&&this.cachedExecuteToolbarWidth!==this.executeToolbar.getItemsWidth()&&this.layout(this.cachedDimensions.height,this.cachedDimensions.width)})),this.options.menus.inputSideToolbar){const k=this._register(this.instantiationService.createInstance(z_,o,this.options.menus.inputSideToolbar,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{shouldForwardArgs:!0},hoverDelegate:w}));this.inputSideToolbarContainer=k.getElement(),k.getElement().classList.add("chat-side-toolbar"),k.context={widget:i}}let C=this.modelService.getModel(this.inputUri);if(C||(C=this.modelService.createModel("",null,this.inputUri,!0)),this.textModelResolverService.createModelReference(this.inputUri).then(k=>{if(this._store.isDisposed){k.dispose();return}this._register(k)}),this.inputModel=C,this.inputModel.updateOptions({bracketColorizationOptions:{enabled:!1,independentColorPoolPerBracketType:!1}}),this._inputEditor.setModel(this.inputModel),t){this.inputModel.setValue(t);const k=this.inputModel.getLineCount();this._inputEditor.setPosition({lineNumber:k,column:this.inputModel.getLineMaxColumn(k)})}const T=()=>{const k=this._inputEditor.getModel();if(!k)return;const A=this._inputEditor.getPosition();if(!A)return;const B=A.lineNumber===1&&A.column-1<=(this._inputEditor._getViewModel()?.getLineLength(1)??0);this.chatCursorAtTop.set(B),this.historyNavigationBackwardsEnablement.set(B),this.historyNavigationForewardsEnablement.set(A.equals(tJ(k)))};this._register(this._inputEditor.onDidChangeCursorPosition(k=>T())),T(),this._register(this.themeService.onDidFileIconThemeChange(()=>{this.renderAttachedContext()})),this.addFilesToolbar=this._register(this.instantiationService.createInstance(z_,d,N.ChatInputAttachmentToolbar,{telemetrySource:this.options.menus.telemetrySource,label:!0,menuOptions:{shouldForwardArgs:!0,renderShortTitle:!0},hiddenItemStrategy:Ak.Ignore,hoverDelegate:w,actionViewItemProvider:(k,A)=>{if(k.id==="workbench.action.chat.attachContext")return this.instantiationService.createInstance(AFe,void 0,k,A)}})),this.addFilesToolbar.context={widget:i,placeholder:h(4841,"Search for files and context to add to your request")},this._register(this.addFilesToolbar.onDidChangeMenuItems(()=>{this.cachedDimensions&&this._onDidChangeHeight.fire()}))}renderAttachedContext(){const e=this.attachedContextContainer,t=this.attachmentsContainer.offsetHeight,i=new U;this.attachedContextDisposables.value=i,Yi(e);const n=i.add(Km());i.add(co(this.attachmentsContainer,pe.KEY_DOWN,a=>{this.handleAttachmentNavigation(a)}));const o=[...this.attachmentModel.attachments.entries()],r=!!o.length||!!this.implicitContext?.value||!this.promptInstructionsAttachmentsPart.empty;if(AS(!!(r||this.addFilesToolbar&&!this.addFilesToolbar.isEmpty()),this.attachmentsContainer),AS(r,this.attachedContextContainer),o.length||(this._indexOfLastAttachedContextDeletedWithKeyboard=-1,this._indexOfLastOpenedContext=-1),this.implicitContext?.value){const a=i.add(this.instantiationService.createInstance(OH,this.implicitContext,this._contextResourceLabels));e.appendChild(a.domNode)}this.promptFileAttached.set(this.hasPromptFileAttachments),this.promptInstructionsAttachmentsPart.render(e);for(const[a,c]of o){const d=R.isUri(c.value)?c.value:c.value&&typeof c.value=="object"&&"uri"in c.value&&R.isUri(c.value.uri)?c.value.uri:void 0,l=c.value&&typeof c.value=="object"&&"range"in c.value&&P.isIRange(c.value.range)?c.value.range:void 0,u=a===Math.min(this._indexOfLastAttachedContextDeletedWithKeyboard,this.attachmentModel.size-1)&&this._indexOfLastAttachedContextDeletedWithKeyboard>-1;let g;const m={shouldFocusClearButton:u,supportsDeletion:!0};c.kind==="tool"||c.kind==="toolset"?g=this.instantiationService.createInstance(JP,c,this._currentLanguageModel,m,e,this._contextResourceLabels,n):d&&uce(c)?g=this.instantiationService.createInstance(eL,d,c,this._currentLanguageModel,m,e,this._contextResourceLabels,n):d&&(c.kind==="file"||c.kind==="directory")?g=this.instantiationService.createInstance(YP,d,l,c,void 0,this._currentLanguageModel,m,e,this._contextResourceLabels,n):rb(c)?g=this.instantiationService.createInstance(QP,d,c,this._currentLanguageModel,m,e,this._contextResourceLabels,n):gce(c)?g=this.instantiationService.createInstance(tL,c,this._currentLanguageModel,m,e,this._contextResourceLabels,n):hce(c)?g=this.instantiationService.createInstance(XP,c,this._currentLanguageModel,m,e,this._contextResourceLabels,n):pce(c)?g=this.instantiationService.createInstance(iL,c,this._currentLanguageModel,m,e,this._contextResourceLabels,n):g=this.instantiationService.createInstance(ZP,d,l,c,void 0,this._currentLanguageModel,m,e,this._contextResourceLabels,n),u&&g.element.focus(),a===Math.min(this._indexOfLastOpenedContext,this.attachmentModel.size-1)&&g.element.focus(),i.add(g),i.add(g.onDidDelete(v=>{this.handleAttachmentDeletion(v,a,c)})),i.add(g.onDidOpen(v=>{this.handleAttachmentOpen(a,c)}))}t!==this.attachmentsContainer.offsetHeight&&this._onDidChangeHeight.fire(),this._indexOfLastOpenedContext=-1}handleAttachmentDeletion(e,t,i){FF(e)&&(this._indexOfLastAttachedContextDeletedWithKeyboard=t),this._attachmentModel.delete(i.id),this._attachmentModel.size===0&&this.focus(),this._onDidChangeContext.fire({removed:[i]}),this.renderAttachedContext()}handleAttachmentOpen(e,t){this._indexOfLastOpenedContext=e,this._indexOfLastAttachedContextDeletedWithKeyboard=-1,this._attachmentModel.size===0&&this.focus()}handleAttachmentNavigation(e){if(!e.equals(S.LeftArrow)&&!e.equals(S.RightArrow))return;const t=this.addFilesToolbar?.getElement().querySelector(".action-label");if(!t)return;const i=Array.from(this.attachedContextContainer.querySelectorAll(".chat-attached-context-attachment"));if(!i.length)return;i.unshift(t);const n=bt(this.attachmentsContainer).document.activeElement,o=i.findIndex(a=>a===n);let r=o;e.equals(S.LeftArrow)?r=o>0?o-1:i.length-1:e.equals(S.RightArrow)&&(r=o<i.length-1?o+1:0),r!==-1&&(i[r].focus(),e.preventDefault(),e.stopPropagation())}async renderChatEditingSessionState(e){AS(!!e,this.chatEditingSessionWidgetContainer);const t=new Fp,i=e?.entries.get().map(v=>(t.add(v.modifiedURI),{reference:v.modifiedURI,state:v.state.get(),kind:"reference"}))??[];if(!e||!this.options.renderWorkingSet||!i.length){Yi(this.chatEditingSessionWidgetContainer),this._chatEditsDisposables.clear(),this._chatEditList=void 0;return}const n=this.chatEditingSessionWidgetContainer.querySelector(".chat-editing-session-container.show-file-icons")??ee(this.chatEditingSessionWidgetContainer,Of(".chat-editing-session-container.show-file-icons"));for(const v of e.entries.get())t.has(v.modifiedURI)||(i.unshift({reference:v.modifiedURI,state:v.state.get(),kind:"reference"}),t.add(v.modifiedURI));i.sort((v,y)=>v.kind==="reference"&&y.kind==="reference"?v.state===y.state||v.state===void 0||y.state===void 0?v.reference.toString().localeCompare(y.reference.toString()):v.state-y.state:0);const o=n.querySelector(".chat-editing-session-overview")??ee(n,Of(".chat-editing-session-overview")),r=o.querySelector(".working-set-title")??ee(o,Of(".working-set-title")),a=r.querySelector("span.working-set-count")??ee(r,Of("span.working-set-count"));a.textContent=i.length===1?h(4842,"1 file changed"):h(4843,"{0} files changed",i.length),r.ariaLabel=a.textContent,r.tabIndex=0,this._chatEditsActionsDisposables.clear();const c=o.querySelector(".chat-editing-session-actions")??ee(o,Of(".chat-editing-session-actions"));if(this._chatEditsActionsDisposables.add(this.instantiationService.createInstance(CH,c,N.ChatEditingWidgetToolbar,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{arg:{sessionId:e.chatSessionId}},buttonConfigProvider:v=>{if(v.id===Bb.ID||v.id===NO.ID||v.id===Vb.Id)return{showIcon:!0,showLabel:!1,isSecondary:!0}}})),!e)return;const d=n.querySelector(".chat-editing-session-list")??ee(n,Of(".chat-editing-session-list"));if(!this._chatEditList){this._chatEditList=this._chatEditsListPool.get();const v=this._chatEditList.object;this._chatEditsDisposables.add(this._chatEditList),this._chatEditsDisposables.add(v.onDidFocus(()=>{this._onDidFocus.fire()})),this._chatEditsDisposables.add(v.onDidOpen(async y=>{if(y.element?.kind==="reference"&&R.isUri(y.element.reference)){const w=y.element.reference,C=e.getEntry(w),T=await this.editorService.openEditor({resource:w,options:y.editorOptions},y.sideBySide?xr:cl);T&&C?.getEditorIntegration(T).reveal(!0,y.editorOptions.preserveFocus)}})),this._chatEditsDisposables.add(re(v.getHTMLElement(),"click",y=>{this.hasFocus()||this._onDidFocus.fire()},!0)),ee(d,v.getHTMLElement()),ee(n,d)}const g=Math.min(i.length,6)*22,m=this._chatEditList.object;m.layout(g),m.getHTMLElement().style.height=`${g}px`,m.splice(0,m.length,i),this._onDidChangeHeight.fire()}async renderChatRelatedFiles(){const e=this.relatedFilesContainer;Yi(e);const t=this.configurationService.getValue("chat.renderRelatedFiles");if(AS(!!(this.relatedFiles?.value.length&&t),e),!t||!this.relatedFiles?.value.length)return;const i=yr("element");for(const{uri:n,description:o}of this.relatedFiles.value){const r=this._chatEditsActionsDisposables.add(new Xu(e,{supportIcons:!0,secondary:!0,hoverDelegate:i}));r.label=this.labelService.getUriBasenameLabel(n),r.element.classList.add("monaco-icon-label"),r.element.title=h(4844,"{0} - {1}",this.labelService.getUriLabel(n,{relative:!0}),o??""),this._chatEditsActionsDisposables.add(r.onDidClick(async()=>{d.remove(),await this._attachmentModel.addFile(n),this.relatedFiles?.remove(n)}));const a=this._chatEditsActionsDisposables.add(new Xu(e,{supportIcons:!1,secondary:!0,hoverDelegate:i,ariaLabel:h(4845,"Add suggestion {0}",this.labelService.getUriLabel(n,{relative:!0}))}));a.icon=j.add,a.setTitle(h(4846,"Add suggestion")),this._chatEditsActionsDisposables.add(a.onDidClick(async()=>{d.remove(),await this._attachmentModel.addFile(n),this.relatedFiles?.remove(n)}));const c=document.createElement("div");c.classList.add("separator");const d=document.createElement("span");d.classList.add("monaco-button-dropdown","sidebyside-button"),d.appendChild(a.element),d.appendChild(c),d.appendChild(r.element),ee(e,d),this._chatEditsActionsDisposables.add(Ee(()=>{d.remove()}))}this._onDidChangeHeight.fire()}async renderFollowups(e,t){this.options.renderFollowups&&(this.followupsDisposables.clear(),Yi(this.followupsContainer),e&&e.length>0&&this.followupsDisposables.add(this.instantiationService.createInstance(S2,this.followupsContainer,e,this.location,void 0,i=>this._onDidAcceptFollowup.fire({followup:i,response:t}))),this._onDidChangeHeight.fire())}get contentHeight(){const e=this.getLayoutData();return e.followupsHeight+e.inputPartEditorHeight+e.inputPartVerticalPadding+e.inputEditorBorder+e.attachmentsHeight+e.toolbarsHeight+e.chatEditingStateHeight}layout(e,t){return this.cachedDimensions=new Ke(t,e),this._layout(e,t)}_layout(e,t,i=!0){const n=this.getLayoutData(),o=Math.min(n.inputPartEditorHeight,e-n.followupsHeight-n.attachmentsHeight-n.inputPartVerticalPadding-n.toolbarsHeight),r=t-n.inputPartHorizontalPadding;this.followupsContainer.style.width=`${r}px`,this._inputPartHeight=n.inputPartVerticalPadding+n.followupsHeight+o+n.inputEditorBorder+n.attachmentsHeight+n.toolbarsHeight+n.chatEditingStateHeight,this._followupsHeight=n.followupsHeight,this._editSessionWidgetHeight=n.chatEditingStateHeight;const a=this._inputEditor.getScrollWidth(),d={width:t-n.inputPartHorizontalPadding-n.editorBorder-n.inputPartHorizontalPaddingInside-n.toolbarsWidth-n.sideToolbarWidth,height:o};if((!this.previousInputEditorDimension||this.previousInputEditorDimension.width!==d.width||this.previousInputEditorDimension.height!==d.height)&&(this._inputEditor.layout(d),this.previousInputEditorDimension=d),i&&a<10)return this._layout(e,t,!1)}getLayoutData(){const e=this.cachedExecuteToolbarWidth=this.executeToolbar.getItemsWidth(),t=this.cachedInputToolbarWidth=this.inputActionsToolbar.getItemsWidth(),i=(this.executeToolbar.getItemsLength()-1)*4,n=this.inputActionsToolbar.getItemsLength()?(this.inputActionsToolbar.getItemsLength()-1)*4:0;return{inputEditorBorder:2,followupsHeight:this.followupsContainer.offsetHeight,inputPartEditorHeight:Math.min(this._inputEditor.getContentHeight(),this.inputEditorMaxHeight),inputPartHorizontalPadding:this.options.renderStyle==="compact"?16:32,inputPartVerticalPadding:this.options.renderStyle==="compact"?12:28,attachmentsHeight:this.attachmentsHeight,editorBorder:2,inputPartHorizontalPaddingInside:12,toolbarsWidth:this.options.renderStyle==="compact"?e+i+t+n:0,toolbarsHeight:this.options.renderStyle==="compact"?0:22,chatEditingStateHeight:this.chatEditingSessionWidgetContainer.offsetHeight,sideToolbarWidth:this.inputSideToolbarContainer?$a(this.inputSideToolbarContainer)+4:0}}getViewState(){return this.getInputState()}saveState(){this.history.isAtEnd()&&this.saveCurrentValue(this.getInputState());const e=[...this.history];this.historyService.saveHistory(this.location,e)}};R2=dT=f([p(4,rre),p(5,ai),p(6,J),p(7,me),p(8,ne),p(9,Ve),p(10,Tr),p(11,Cw),p(12,Pe),p(13,Xe),p(14,de),p(15,ft),p(16,yi),p(17,tt),p(18,di),p(19,yz),p(20,ff),p(21,jN),p(22,Gse),p(23,VN),p(24,Ude)],R2);const eJ=s=>JSON.stringify({...s,state:{...s.state,chatMode:void 0}});function tJ(s){return{lineNumber:s.getLineCount(),column:s.getLineLength(s.getLineCount())+1}}let P2=class extends ZR{constructor(e,t,i,n,o,r,a,c,d,l){super(e,t,[],"",{...i,getKeyBinding:m=>a.lookupKeybinding(m.id,r)},o,a,c,r,d,l);const u=n.createMenu(N.ChatExecuteSecondary,r),g=()=>{const m=oI(u.getActions({shouldForwardArgs:!0}));this.update(t,m)};g(),this._register(u.onDidChange(()=>g()))}};P2=f([p(3,tn),p(4,mi),p(5,me),p(6,Ve),p(7,At),p(8,ft),p(9,Tr)],P2);const Oue=".interactive-input-editor";cMe(Oue);class AFe extends qm{constructor(e,t,i){super(e,t,{...i,icon:!1,label:!0,keybindingNotRenderedWithLabel:!0})}render(e){e.classList.add("chat-attachment-button"),super.render(e)}updateLabel(){St(this.label);const e=`$(attach) ${this.action.label}`;ig(this.label,...Lv(e))}}const RFe=/^@([\w_\-\.]+)(?=(\s|$|\b))/i,PFe=/^#([\w_\-]+)(:\d+)?(?=(\s|$|\b))/i,LFe=/^\/([\w_\-\.:]+)(?=(\s|$|\b))/i;let L2=class{constructor(e,t,i,n){this.agentService=e,this.variableService=t,this.slashCommandService=i,this.promptsService=n}parseChatRequest(e,t,i=Vi.Panel,n){const o=[],r=this.variableService.getDynamicVariables(e),a=new Map(this.variableService.getSelectedTools(e).filter(m=>m.canBeReferencedInPrompt&&m.toolReferenceName).map(m=>[m.toolReferenceName,m])),c=new Map(this.variableService.getSelectedToolSets(e).map(m=>[m.referenceName,m]));let d=1,l=1;for(let m=0;m<t.length;m++){const v=t.charAt(m-1),y=t.charAt(m);let w;if((v.match(/\s/)||m===0)&&(y===$w?w=this.tryToParseVariable(t.slice(m),m,new _e(d,l),o,a,c):y===CK?w=this.tryToParseAgent(t.slice(m),t,m,new _e(d,l),o,i,n):y===av&&(w=this.tryToParseSlashCommand(t.slice(m),t,m,new _e(d,l),o,i,n)),w||(w=this.tryToParseDynamicVariable(t.slice(m),m,new _e(d,l),r))),w){if(m!==0){const C=o.at(-1),T=C?.range.endExclusive??0,k=C?.editorRange.endLineNumber??1,A=C?.editorRange.endColumn??1;o.push(new xu(new bi(T,m),new P(k,A,d,l),t.slice(T,m)))}o.push(w)}y===`
`?(d++,l=1):l++}const u=o.at(-1),g=u?.range.endExclusive??0;return g<t.length&&o.push(new xu(new bi(g,t.length),new P(u?.editorRange.endLineNumber??1,u?.editorRange.endColumn??1,d,l),t.slice(g,t.length))),{parts:o,text:t}}tryToParseAgent(e,t,i,n,o,r,a){const c=e.match(RFe);if(!c||a?.mode!==void 0&&a.mode!==jt.Ask)return;const[d,l]=c,u=new bi(i,i+d.length),g=new P(n.lineNumber,n.column,n.lineNumber,n.column+d.length);let m=this.agentService.getAgentsByName(l);if(!m.length){const T=this.agentService.getAgentByFullyQualifiedId(l);T&&(m=[T])}const v=m.length>1&&a?.selectedAgent?a.selectedAgent:m.find(T=>T.locations.includes(r));if(!v||o.some(T=>T instanceof sh)||o.some(T=>T instanceof xu&&T.text.trim()!==""||!(T instanceof sh)))return;const w=o.at(-1)?.range.endExclusive??0;if(t.slice(w,i).trim()==="")return new sh(u,g,v)}tryToParseVariable(e,t,i,n,o,r){const a=e.match(PFe);if(!a)return;const[c,d]=a,l=new bi(t,t+c.length),u=new P(i.lineNumber,i.column,i.lineNumber,i.column+c.length),g=o.get(d);if(g)return new Cy(l,u,d,g.id,g.displayName,g.icon);const m=r.get(d);if(m){const v=Array.from(m.getTools()).map(y=>new Cy(l,u,y.toolReferenceName??y.displayName,y.id,y.displayName,y.icon).toVariableEntry());return new YE(l,u,m.id,m.referenceName,m.icon,v)}}tryToParseSlashCommand(e,t,i,n,o,r,a){const c=e.match(LFe);if(!c||o.some(C=>!(C instanceof sh)&&!(C instanceof xu&&C.text.trim()==="")))return;const l=o.at(-1)?.range.endExclusive??0;if(t.slice(l,i).trim()!=="")return;const[g,m]=c,v=new bi(i,i+g.length),y=new P(n.lineNumber,n.column,n.lineNumber,n.column+g.length),w=o.find(C=>C instanceof sh);if(w){const C=w.agent.slashCommands.find(T=>T.name===m);if(C)return new Ey(v,y,C)}else{const T=this.slashCommandService.getCommands(r,a?.mode??jt.Ask).find(A=>A.command===m);if(T)return new QE(v,y,T);{const B=this.agentService.getDefaultAgent(r,a?.mode)?.slashCommands.find(z=>z.name===m);if(B)return new Ey(v,y,B)}const k=this.promptsService.asPromptSlashCommand(m);if(k)return new XE(v,y,k)}}tryToParseDynamicVariable(e,t,i,n){const o=n.find(r=>r.range.startLineNumber===i.lineNumber&&r.range.startColumn===i.column);if(o){const r=o.range.endColumn-o.range.startColumn,a=e.substring(0,r),c=new bi(t,t+r);return new ZE(c,o.range,a,o.id,o.modelDescription,o.data,o.fullName,o.icon,o.isFile,o.isDirectory)}}};L2=f([p(0,ff),p(1,yz),p(2,ore),p(3,HN)],L2);var br;(function(s){function e(m){return{mime:m.mime,valueBytes:m.data}}s.toNotebookOutputItemDto=e;function t(m){return{outputId:m.outputId,metadata:m.metadata,items:m.outputs.map(e)}}s.toNotebookOutputDto=t;function i(m){return{cellKind:m.cellKind,language:m.language,mime:m.mime,source:m.source,internalMetadata:m.internalMetadata,metadata:m.metadata,outputs:m.outputs.map(t)}}s.toNotebookCellDataDto=i;function n(m){return{metadata:m.metadata,cells:m.cells.map(i)}}s.toNotebookDataDto=n;function o(m){return{mime:m.mime,data:m.valueBytes}}s.fromNotebookOutputItemDto=o;function r(m){return{outputId:m.outputId,metadata:m.metadata,outputs:m.items.map(o)}}s.fromNotebookOutputDto=r;function a(m){return{cellKind:m.cellKind,language:m.language,mime:m.mime,source:m.source,outputs:m.outputs.map(r),metadata:m.metadata,internalMetadata:m.internalMetadata}}s.fromNotebookCellDataDto=a;function c(m){return{metadata:m.metadata,cells:m.cells.map(a)}}s.fromNotebookDataDto=c;function d(m){return{handle:m.handle,uri:m.uri,source:m.textBuffer.getLinesContent(),eol:m.textBuffer.getEOL(),language:m.language,cellKind:m.cellKind,outputs:m.outputs.map(t),metadata:m.metadata,internalMetadata:m.internalMetadata}}s.toNotebookCellDto=d;function l(m){return m.editType===IR.Output?{editType:m.editType,cellHandle:m.cellHandle,append:m.append,outputs:m.outputs.map(r)}:m.editType===IR.OutputItems?{editType:m.editType,append:m.append,outputId:m.outputId,items:m.items.map(o)}:m}s.fromCellExecuteUpdateDto=l;function u(m){return m}s.fromCellExecuteCompleteDto=u;function g(m){return m.editType===al.Replace?{editType:m.editType,index:m.index,count:m.count,cells:m.cells.map(a)}:m}s.fromCellEditOperationDto=g})(br||(br={}));const MFe="workbench.action.chat.addDynamicVariable";class NFe{get onDidAddProgress(){return this._onDidAddProgress.event}constructor(e){this.content=e,this.kind="progressTask",this.deferred=new Zo,this._onDidAddProgress=new M,this.progress=[]}task(){return this.deferred.p}isSettled(){return this.deferred.isSettled}complete(e){this.deferred.complete(e)}add(e){this.progress.push(e),this._onDidAddProgress.fire(e)}toJSON(){return{kind:"progressTaskSerialized",content:this.content,progress:this.progress}}}let iJ=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this._chatAgentService=t,this._chatService=i,this._chatEditingService=n,this._languageFeaturesService=o,this._chatWidgetService=r,this._instantiationService=a,this._logService=c,this._extensionService=d,this._uriIdentityService=l,this._agents=this._register(new ei),this._agentCompletionProviders=this._register(new ei),this._agentIdsToCompletionProviders=this._register(new ei),this._chatParticipantDetectionProviders=this._register(new ei),this._chatRelatedFilesProviders=this._register(new ei),this._pendingProgress=new Map,this._activeTasks=new Map,this._unresolvedAnchors=new Map,this._proxy=e.getProxy(Ye.ExtHostChatAgents2),this._register(this._chatService.onDidDisposeSession(u=>{this._proxy.$releaseSession(u.sessionId)})),this._register(this._chatService.onDidPerformUserAction(u=>{if(typeof u.agentId=="string"){for(const[g,m]of this._agents)if(m.id===u.agentId){u.action.kind==="vote"?this._proxy.$acceptFeedback(g,u.result??{},u.action):this._proxy.$acceptAction(g,u.result||{},u);break}}}))}$unregisterAgent(e){this._agents.deleteAndDispose(e)}$transferActiveChatSession(e){const t=this._chatWidgetService.lastFocusedWidget,i=t?.viewModel?.model.sessionId;if(!i){this._logService.error("MainThreadChat#$transferActiveChatSession: No active chat session found");return}const n=t?.inputEditor.getValue()??"",o=t.location,r=t.input.currentMode;this._chatService.transferChatSession({sessionId:i,inputValue:n,location:o,mode:r},R.revive(e))}async $registerAgent(e,t,i,n,o){await this._extensionService.whenInstalledExtensionsRegistered();const r=this._chatAgentService.getAgent(i,!0);if(!r&&!o)throw this._chatAgentService.getAgentsByName(i).length?new Error(`chatParticipant must be declared with an ID in package.json. The "id" property may be missing! "${i}"`):new Error(`chatParticipant must be declared in package.json: ${i}`);const a={invoke:async(d,l,u,g)=>{this._pendingProgress.set(d.requestId,l);try{return await this._proxy.$invokeAgent(e,d,{history:u},g)??{}}finally{this._pendingProgress.delete(d.requestId)}},setRequestPaused:(d,l)=>{this._proxy.$setRequestPaused(e,d,l)},provideFollowups:async(d,l,u,g)=>this._agents.get(e)?.hasFollowups?this._proxy.$provideFollowups(d,e,l,{history:u},g):[],provideChatTitle:(d,l)=>this._proxy.$provideChatTitle(e,d,l)};let c;if(!r&&o){const d=this._extensionService.extensions.find(l=>Es.equals(l.identifier,t));c=this._chatAgentService.registerDynamicAgent({id:i,name:o.name,description:o.description,extensionId:t,extensionDisplayName:d?.displayName??t.value,extensionPublisherId:d?.publisher??"",publisherDisplayName:o.publisherName,fullName:o.fullName,metadata:cn(n),slashCommands:[],disambiguation:[],locations:[Vi.Panel],modes:[jt.Ask]},a)}else c=this._chatAgentService.registerAgentImplementation(i,a);this._agents.set(e,{id:i,extensionId:t,dispose:c.dispose,hasFollowups:n.hasFollowups})}async $updateAgent(e,t){await this._extensionService.whenInstalledExtensionsRegistered();const i=this._agents.get(e);if(!i){this._logService.error(`MainThreadChatAgents2#$updateAgent: No agent with handle ${e} registered`);return}i.hasFollowups=t.hasFollowups,this._chatAgentService.updateAgent(i.id,cn(t))}async $handleProgressChunk(e,t){const i=[];t.forEach(n=>{const[o,r]=Array.isArray(n)?n:[n],a=o.kind==="notebookEdit"?M2.fromChatEdit(cn(o)):cn(o);if((a.kind==="notebookEdit"||a.kind==="textEdit"||a.kind==="codeblockUri")&&(a.uri=this._uriIdentityService.asCanonicalUri(a.uri)),r!==void 0){if(a.kind==="progressTask"){const d=`${e}_${r}`,l=new NFe(a.content);this._activeTasks.set(d,l),i.push(l);return}else if(r!==void 0){const c=`${e}_${r}`,d=this._activeTasks.get(c);switch(a.kind){case"progressTaskResult":d&&a.content?(d.complete(a.content.value),this._activeTasks.delete(c)):d?.complete(void 0);return;case"warning":case"reference":d?.add(a);return}}}a.kind==="inlineReference"&&a.resolveId&&(this._unresolvedAnchors.has(e)||this._unresolvedAnchors.set(e,new Map),this._unresolvedAnchors.get(e)?.set(a.resolveId,a)),i.push(a)}),this._pendingProgress.get(e)?.(i)}$handleAnchorResolve(e,t,i){const n=this._unresolvedAnchors.get(e)?.get(t);if(n&&(this._unresolvedAnchors.get(e)?.delete(t),i)){const o=cn(i);n.inlineReference=o.inlineReference}}$registerAgentCompletionsProvider(e,t,i){const n=async(o,r)=>(await this._proxy.$invokeCompletionProvider(e,o,r)).map(c=>({...c,icon:c.icon?Te.fromId(c.icon):void 0}));this._agentIdsToCompletionProviders.set(t,this._chatAgentService.registerAgentCompletionProvider(t,n)),this._agentCompletionProviders.set(e,this._languageFeaturesService.completionProvider.register({scheme:R2.INPUT_SCHEME,hasAccessToAllModels:!0},{_debugDisplayName:"chatAgentCompletions:"+e,triggerCharacters:i,provideCompletionItems:async(o,r,a,c)=>{const d=this._chatWidgetService.getWidgetByInputUri(o.uri);if(!d||!d.viewModel)return;const l=i.map(k=>ny(k)).join(""),u=new RegExp(`[${l}]\\S*`,"g"),g=Wne(r.column,u,o.getLineContent(r.lineNumber),0)?.word??"";if(g&&!i.some(k=>g.startsWith(k)))return;const v=this._instantiationService.createInstance(L2).parseChatRequest(d.viewModel.sessionId,o.getValue()).parts.find(k=>k instanceof sh),y=this._agents.get(e)?.id;if(v?.agent.id!==y)return;const w=OFe(o,r,u);return w?{suggestions:(await n(g,c)).map(k=>{const A=k.insertText??(typeof k.label=="string"?k.label:k.label.label),B=new P(w.insert.startLineNumber,w.insert.startColumn,w.insert.endLineNumber,w.insert.startColumn+A.length);return{label:k.label,range:w,insertText:A+" ",kind:De.Text,detail:k.detail,documentation:k.documentation,command:{id:MFe,title:"",arguments:[{id:k.id,widget:d,range:B,variableData:cn(k.value),command:k.command}]}}})}:null}}))}$unregisterAgentCompletionsProvider(e,t){this._agentCompletionProviders.deleteAndDispose(e),this._agentIdsToCompletionProviders.deleteAndDispose(t)}$registerChatParticipantDetectionProvider(e){this._chatParticipantDetectionProviders.set(e,this._chatAgentService.registerChatParticipantDetectionProvider(e,{provideParticipantDetection:async(t,i,n,o)=>await this._proxy.$detectChatParticipant(e,t,{history:i},n,o)}))}$unregisterChatParticipantDetectionProvider(e){this._chatParticipantDetectionProviders.deleteAndDispose(e)}$registerRelatedFilesProvider(e,t){this._chatRelatedFilesProviders.set(e,this._chatEditingService.registerRelatedFilesProvider(e,{description:t.description,provideRelatedFiles:async(i,n)=>(await this._proxy.$provideRelatedFiles(e,i,n))?.map(o=>({uri:R.from(o.uri),description:o.description}))??[]}))}$unregisterRelatedFilesProvider(e){this._chatRelatedFilesProviders.deleteAndDispose(e)}};iJ=f([ht($e.MainThreadChatAgents2),p(1,ff),p(2,mf),p(3,bg),p(4,Ne),p(5,Pr),p(6,J),p(7,Pe),p(8,hn),p(9,Zi)],iJ);function OFe(s,e,t){const i=Wne(e.column,t,s.getLineContent(e.lineNumber),0);if(!i&&s.getWordUntilPosition(e).word)return;let n,o;return i?(n=new P(e.lineNumber,i.startColumn,e.lineNumber,e.column),o=new P(e.lineNumber,i.startColumn,e.lineNumber,i.endColumn)):n=o=P.fromPositions(e),{insert:n,replace:o}}var M2;(function(s){function e(t){return{kind:"notebookEdit",uri:t.uri,done:t.done,edits:t.edits.map(br.fromCellEditOperationDto)}}s.fromChatEdit=e})(M2||(M2={}));var N2;let nJ=class extends F{static{N2=this}static{this._requestHandlePool=0}constructor(e,t){super(),this.codeMapperService=t,this.providers=this._register(new ei),this._responseMap=new Map,this._proxy=e.getProxy(Ye.ExtHostCodeMapper)}$registerCodeMapperProvider(e,t){const i={displayName:t,mapCode:async(o,r,a)=>{const c=String(N2._requestHandlePool++);this._responseMap.set(c,r);const d={requestId:c,codeBlocks:o.codeBlocks,chatRequestId:o.chatRequestId,chatRequestModel:o.chatRequestModel,chatSessionId:o.chatSessionId,location:o.location};try{return await this._proxy.$mapCode(e,d,a).then(l=>l??void 0)}finally{this._responseMap.delete(c)}}},n=this.codeMapperService.registerCodeMapperProvider(e,i);this.providers.set(e,n)}$unregisterCodeMapperProvider(e){this.providers.deleteAndDispose(e)}$handleProgress(e,t){const i=this._responseMap.get(e);if(i){const n=t.edits,o=R.revive(t.uri);n.length?n.every(Uie.isTextEdit)?i.textEdit(o,n):i.notebookEdit(o,n.map(br.fromCellEditOperationDto)):i.textEdit(o,[])}return Promise.resolve()}};nJ=N2=f([ht($e.MainThreadCodeMapper),p(1,sre)],nJ);let sJ=class extends F{constructor(e,t){super(),this._languageModelToolsService=t,this._tools=this._register(new ei),this._runningToolCalls=new Map,this._proxy=e.getProxy(Ye.ExtHostLanguageModelTools),this._register(this._languageModelToolsService.onDidChangeTools(i=>this._proxy.$onDidChangeTools(this.getToolDtos())))}getToolDtos(){return Array.from(this._languageModelToolsService.getTools()).map(e=>({id:e.id,displayName:e.displayName,toolReferenceName:e.toolReferenceName,tags:e.tags,userDescription:e.userDescription,modelDescription:e.modelDescription,inputSchema:e.inputSchema}))}async $getTools(){return this.getToolDtos()}async $invokeTool(e,t){const i=await this._languageModelToolsService.invokeTool(e,(o,r)=>this._proxy.$countTokensForInvocation(e.callId,o,r),t??ye.None),n={content:i.content};return HAe(i)?new Jr(n):n}$acceptToolProgress(e,t){this._runningToolCalls.get(e)?.progress.report(t)}$countTokensForInvocation(e,t,i){const n=this._runningToolCalls.get(e);if(!n)throw new Error(`Tool invocation call ${e} not found`);return n.countTokens(t,i)}$registerTool(e){const t=this._languageModelToolsService.registerToolImplementation(e,{invoke:async(i,n,o,r)=>{try{this._runningToolCalls.set(i.callId,{countTokens:n,progress:o});const a=await this._proxy.$invokeTool(i,r),c=a instanceof Jr?a.value:a;return cn(c)}finally{this._runningToolCalls.delete(i.callId)}},prepareToolInvocation:(i,n)=>this._proxy.$prepareToolInvocation(e,i,n)});this._tools.set(e,t)}$unregisterTool(e){this._tools.deleteAndDispose(e)}};sJ=f([ht($e.MainThreadLanguageModelTools),p(1,CI)],sJ);const Fue=Z("embeddingsService");class FFe{constructor(){this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this.providers=new Map}get allProviders(){return this.providers.keys()}registerProvider(e,t){return this.providers.set(e,t),this._onDidChange.fire(),{dispose:()=>{this.providers.delete(e),this._onDidChange.fire()}}}computeEmbeddings(e,t,i){const n=this.providers.get(e);return n?n.provideEmbeddings(t,i):Promise.reject(new Error(`No embeddings provider registered with id: ${e}`))}}$(Fue,FFe,G.Delayed);let oJ=class{constructor(e,t){this.embeddingsService=t,this._store=new U,this._providers=this._store.add(new ei),this._proxy=e.getProxy(Ye.ExtHostEmbeddings),this._store.add(t.onDidChange(()=>{this._proxy.$acceptEmbeddingModels(Array.from(t.allProviders))}))}dispose(){this._store.dispose()}$registerEmbeddingProvider(e,t){const i=this.embeddingsService.registerProvider(t,{provideEmbeddings:(n,o)=>this._proxy.$provideEmbeddings(e,n,o)});this._providers.set(e,i)}$unregisterEmbeddingProvider(e){this._providers.deleteAndDispose(e)}$computeEmbeddings(e,t,i){return this.embeddingsService.computeEmbeddings(e,t,i)}};oJ=f([ht($e.MainThreadEmbeddings),p(1,Fue)],oJ);var O2;let F2=class extends F{static{O2=this}static{this.standardSupportedLinkSchemes=new Set([ae.http,ae.https,ae.mailto,ae.vscode,"vscode-insider"])}constructor(e,t,i){super(),this._openerService=t,this._productService=i,this._webviews=new Map,this._proxy=e.getProxy(Ye.ExtHostWebviews)}addWebview(e,t,i){if(this._webviews.has(e))throw new Error("Webview already registered");this._webviews.set(e,t),this.hookupWebviewEventDelegate(e,t,i)}$setHtml(e,t){this.tryGetWebview(e)?.setHtml(t)}$setOptions(e,t){const i=this.tryGetWebview(e);i&&(i.contentOptions=lL(t))}async $postMessage(e,t,...i){const n=this.tryGetWebview(e);if(!n)return!1;const{message:o,arrayBuffers:r}=VAe(t,i);return n.postMessage(o,r)}hookupWebviewEventDelegate(e,t,i){const n=new U;n.add(t.onDidClickLink(o=>this.onDidClickLink(e,o))),n.add(t.onMessage(o=>{const r=WAe(o.message,i);this._proxy.$onMessage(e,r.message,new Jr(r.buffers))})),n.add(t.onMissingCsp(o=>this._proxy.$onMissingCsp(e,o.value))),n.add(t.onDidDispose(()=>{n.dispose(),this._webviews.delete(e)}))}onDidClickLink(e,t){const i=this.getWebview(e);this.isSupportedLink(i,R.parse(t))&&this._openerService.open(t,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:Array.isArray(i.contentOptions.enableCommandUris)||i.contentOptions.enableCommandUris===!0,fromWorkspace:!0})}isSupportedLink(e,t){return O2.standardSupportedLinkSchemes.has(t.scheme)||!$t&&this._productService.urlProtocol===t.scheme?!0:t.scheme===ae.command?Array.isArray(e.contentOptions.enableCommandUris)?e.contentOptions.enableCommandUris.includes(t.path):e.contentOptions.enableCommandUris===!0:!1}tryGetWebview(e){return this._webviews.get(e)}getWebview(e){const t=this.tryGetWebview(e);if(!t)throw new Error(`Unknown webview handle:${e}`);return t}getWebviewResolvedFailedContent(e){return`<!DOCTYPE html>
		<html>
			<head>
				<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
				<meta http-equiv="Content-Security-Policy" content="default-src 'none';">
			</head>
			<body>${h(2460,"An error occurred while loading view: {0}",Fq(e))}</body>
		</html>`}};F2=O2=f([p(1,hi),p(2,Fn)],F2);function dL(s){return{id:s.id,location:R.revive(s.location)}}function lL(s){return{allowScripts:s.enableScripts,allowForms:s.enableForms,enableCommandUris:s.enableCommandUris,localResourceRoots:Array.isArray(s.localResourceRoots)?s.localResourceRoots.map(e=>R.revive(e)):void 0,portMapping:s.portMapping}}class WFe{constructor(e,t,i,n){this.editor=e,this.line=t,this.height=i,this.webview=n,this.domNode=document.createElement("div"),this.domNode.style.zIndex="10",this.afterLineNumber=t,this.afterColumn=1,this.heightInLines=i,e.changeViewZones(o=>this._id=o.addZone(this)),n.mountTo(this.domNode,bt(e.getDomNode()))}dispose(){this.editor.changeViewZones(e=>this._id&&e.removeZone(this._id))}}let rJ=class{constructor(e,t,i){this._editorService=t,this._webviewService=i,this._disposables=new U,this._insets=new Map,this._proxy=e.getProxy(Ye.ExtHostEditorInsets)}dispose(){this._disposables.dispose()}async $createEditorInset(e,t,i,n,o,r,a,c){let d;t=t.substr(0,t.indexOf(","));for(const v of this._editorService.listCodeEditors())if(v.getId()===t&&v.hasModel()&&Dt(v.getModel().uri,R.revive(i))){d=v;break}if(!d){setTimeout(()=>this._proxy.$onDidDispose(e));return}const l=new U,u=this._webviewService.createWebviewElement({title:void 0,options:{enableFindWidget:!1},contentOptions:lL(r),extension:{id:a,location:R.revive(c)}}),g=new WFe(d,n,o,u),m=()=>{l.dispose(),this._proxy.$onDidDispose(e),this._insets.delete(e)};l.add(d.onDidChangeModel(m)),l.add(d.onDidDispose(m)),l.add(g),l.add(u),l.add(u.onMessage(v=>this._proxy.$onDidReceiveMessage(e,v.message))),this._insets.set(e,g)}$disposeEditorInset(e){const t=this.getInset(e);this._insets.delete(e),t.dispose()}$setHtml(e,t){this.getInset(e).webview.setHtml(t)}$setOptions(e,t){const i=this.getInset(e);i.webview.contentOptions=lL(t)}async $postMessage(e,t){return this.getInset(e).webview.postMessage(t),!0}getInset(e){const t=this._insets.get(e);if(!t)throw new Error("Unknown inset");return t}};rJ=f([ht($e.MainThreadEditorInsets),p(1,Ot),p(2,MN)],rJ);const BFe=s=>h(1792,"Extension '{0}' not found.",s),aJ=h(1793,"Make sure you use the full extension ID, including the publisher, e.g.: {0}","ms-dotnettools.csharp");let W2=class{constructor(e,t,i){this.logger=e,this.extensionManagementService=t,this.extensionGalleryService=i}get location(){}async listExtensions(e,t,i){let n=await this.extensionManagementService.getInstalled(Pn.User,i);const o=cbe.map(a=>a.toLowerCase());if(t&&t!==""){if(o.indexOf(t.toLowerCase())<0){this.logger.info("Invalid category please enter a valid category. To list valid categories run --category without a category specified");return}n=n.filter(a=>a.manifest.categories?a.manifest.categories.map(d=>d.toLowerCase()).indexOf(t.toLowerCase())>-1:!1)}else if(t===""){this.logger.info("Possible Categories: "),o.forEach(a=>{this.logger.info(a)});return}this.location&&this.logger.info(h(1794,"Extensions installed on {0}:",this.location)),n=n.sort((a,c)=>a.identifier.id.localeCompare(c.identifier.id));let r;for(const a of n)r!==a.identifier.id&&(r=a.identifier.id,this.logger.info(e?`${r}@${a.manifest.version}`:r))}async installExtensions(e,t,i,n){const o=[];try{e.length&&this.logger.info(this.location?h(1795,"Installing extensions on {0}...",this.location):h(1796,"Installing extensions..."));const r=[],a=[],c=(l,u,g)=>{a.push({id:l,version:u!=="prerelease"?u:void 0,installOptions:{...i,isBuiltin:g,installPreReleaseVersion:u==="prerelease"||i.installPreReleaseVersion}})};for(const l of e)if(l instanceof R)r.push({vsix:l,installOptions:i});else{const[u,g]=M7(l);c(u,g,!1)}for(const l of t)if(l instanceof R)r.push({vsix:l,installOptions:{...i,isBuiltin:!0,donotIncludePackAndDependencies:!0}});else{const[u,g]=M7(l);c(u,g,!0)}const d=await this.extensionManagementService.getInstalled(void 0,i.profileLocation);if(r.length&&await Promise.all(r.map(async({vsix:l,installOptions:u})=>{try{await this.installVSIX(l,u,n,d)}catch(g){this.logger.error(g),o.push(l.toString())}})),a.length){const l=await this.installGalleryExtensions(a,d,n);o.push(...l)}}catch(r){throw this.logger.error(h(1797,"Error while installing extensions: {0}",ba(r))),r}if(o.length)throw new Error(h(1798,"Failed Installing Extensions: {0}",o.join(", ")))}async updateExtensions(e){const t=await this.extensionManagementService.getInstalled(Pn.User,e),i=[];for(const a of t)a.identifier.uuid&&i.push({...a.identifier,preRelease:a.preRelease});this.logger.trace(h(1799,"Fetching latest versions for {0} extensions",i.length));const n=await this.extensionGalleryService.getExtensions(i,{compatible:!0},ye.None),o=[];for(const a of n)for(const c of t)ja(c.identifier,a.identifier)&&My.gt(a.version,c.manifest.version)&&o.push({extension:a,options:{operation:jie.Update,installPreReleaseVersion:c.preRelease,profileLocation:e,isApplicationScoped:c.isApplicationScoped}});if(!o.length){this.logger.info(h(1800,"No extension to update"));return}this.logger.info(h(1801,"Updating extensions: {0}",o.map(a=>a.extension.identifier.id).join(", ")));const r=await this.extensionManagementService.installGalleryExtensions(o);for(const a of r)a.error?this.logger.error(h(1802,"Error while updating extension {0}: {1}",a.identifier.id,ba(a.error))):this.logger.info(h(1803,"Extension '{0}' v{1} was successfully updated.",a.identifier.id,a.local?.manifest.version))}async installGalleryExtensions(e,t,i){if(e=e.filter(a=>{const{id:c,version:d,installOptions:l}=a,u=t.find(g=>ja(g.identifier,{id:c}));if(u){if(!i&&(!d||d==="prerelease"&&u.preRelease))return this.logger.info(h(1804,"Extension '{0}' v{1} is already installed. Use '--force' option to update to latest version or provide '@<version>' to install a specific version, for example: '{2}@1.2.3'.",c,u.manifest.version,c)),!1;if(d&&u.manifest.version===d)return this.logger.info(h(1805,"Extension '{0}' is already installed.",`${c}@${d}`)),!1;u.preRelease&&d!=="prerelease"&&(l.preRelease=!1)}return!0}),!e.length)return[];const n=[],o=[],r=await this.getGalleryExtensions(e);if(await Promise.all(e.map(async({id:a,version:c,installOptions:d})=>{const l=r.get(a.toLowerCase());if(!l){this.logger.error(`${BFe(c?`${a}@${c}`:a)}
${aJ}`),n.push(a);return}try{const g=await this.extensionGalleryService.getManifest(l,ye.None);if(g&&!this.validateExtensionKind(g))return}catch(g){this.logger.error(g.message||g.stack||g),n.push(a);return}const u=t.find(g=>ja(g.identifier,l.identifier));if(u){if(l.version===u.manifest.version){this.logger.info(h(1805,"Extension '{0}' is already installed.",c?`${a}@${c}`:a));return}this.logger.info(h(1806,"Updating the extension '{0}' to the version {1}",a,l.version))}d.isBuiltin?this.logger.info(c?h(1807,"Installing builtin extension '{0}' v{1}...",a,c):h(1808,"Installing builtin extension '{0}'...",a)):this.logger.info(c?h(1809,"Installing extension '{0}' v{1}...",a,c):h(1810,"Installing extension '{0}'...",a)),o.push({extension:l,options:{...d,installGivenVersion:!!c,isApplicationScoped:d.isApplicationScoped||u?.isApplicationScoped}})})),o.length){const a=await this.extensionManagementService.installGalleryExtensions(o);for(const c of a)c.error?(this.logger.error(h(1811,"Error while installing extension {0}: {1}",c.identifier.id,ba(c.error))),n.push(c.identifier.id)):this.logger.info(h(1812,"Extension '{0}' v{1} was successfully installed.",c.identifier.id,c.local?.manifest.version))}return n}async installVSIX(e,t,i,n){const o=await this.extensionManagementService.getManifest(e);if(!o)throw new Error("Invalid vsix");if(await this.validateVSIX(o,i,t.profileLocation,n))try{await this.extensionManagementService.install(e,{...t,installGivenVersion:!0}),this.logger.info(h(1813,"Extension '{0}' was successfully installed.",je(e)))}catch(a){if(gs(a))this.logger.info(h(1814,"Cancelled installing extension '{0}'.",je(e)));else throw a}}async getGalleryExtensions(e){const t=new Map,i=e.some(r=>r.installOptions.installPreReleaseVersion),n=await this.extensionManagementService.getTargetPlatform(),o=[];for(const r of e)dbe.test(r.id)&&o.push({...r,preRelease:i});if(o.length){const r=await this.extensionGalleryService.getExtensions(o,{targetPlatform:n},ye.None);for(const a of r)t.set(a.identifier.id.toLowerCase(),a)}return t}validateExtensionKind(e){return!0}async validateVSIX(e,t,i,n){if(!t){const o={id:du(e.publisher,e.name)},r=n.find(a=>ja(o,a.identifier)&&My.gt(a.manifest.version,e.version));if(r)return this.logger.info(h(1815,"A newer version of extension '{0}' v{1} is already installed. Use '--force' option to downgrade to older version.",r.identifier.id,r.manifest.version,e.version)),!1}return this.validateExtensionKind(e)}async uninstallExtensions(e,t,i){const n=async o=>{if(o instanceof R){const r=await this.extensionManagementService.getManifest(o);return _q(r.publisher,r.name)}return o};for(const o of e){const r=await n(o),c=(await this.extensionManagementService.getInstalled(void 0,i)).filter(d=>ja(d.identifier,{id:r}));if(!c.length)throw new Error(`${this.notInstalled(r)}
${aJ}`);if(c.some(d=>d.type===Pn.System)){this.logger.info(h(1816,"Extension '{0}' is a Built-in extension and cannot be uninstalled",r));return}if(!t&&c.some(d=>d.isBuiltin)){this.logger.info(h(1817,"Extension '{0}' is marked as a Built-in extension by user. Please use '--force' option to uninstall it.",r));return}this.logger.info(h(1818,"Uninstalling {0}...",r));for(const d of c)await this.extensionManagementService.uninstall(d,{profileLocation:i});this.location?this.logger.info(h(1819,"Extension '{0}' was successfully uninstalled from {1}!",r,this.location)):this.logger.info(h(1820,"Extension '{0}' was successfully uninstalled!",r))}}async locateExtension(e){const t=await this.extensionManagementService.getInstalled();e.forEach(i=>{t.forEach(n=>{if(n.identifier.id===i&&n.location.scheme===ae.file){this.logger.info(n.location.fsPath);return}})})}notInstalled(e){return this.location?h(1821,"Extension '{0}' is not installed on {1}.",e,this.location):h(1822,"Extension '{0}' is not installed.",e)}};W2=f([p(1,yI),p(2,dz)],W2);Ce.registerCommand("_remoteCLI.openExternal",function(s,e){return s.get(hi).open(It(e)?e:R.revive(e),{openExternal:!0,allowTunneling:!0})});Ce.registerCommand("_remoteCLI.windowOpen",function(s,e,t){const i=s.get(qe);return e.length?i.executeCommand("_files.windowOpen",e,t):i.executeCommand("_files.newWindow",t)});Ce.registerCommand("_remoteCLI.getSystemStatus",function(s){return s.get(qe).executeCommand("_issues.getSystemStatus")});Ce.registerCommand("_remoteCLI.manageExtensions",async function(s,e){const t=s.get(J),n=s.get(Wre).remoteExtensionManagementServer?.extensionManagementService;if(!n)return;const o=[],r=new class extends lbe{log(c,d){o.push(d)}},a=t.createChild(new pf([yI,n]));try{const c=a.createInstance(B2,r);if(e.list)await c.listExtensions(!!e.list.showVersions,e.list.category,void 0);else{const d=l=>l.map(u=>It(u)?u:R.revive(u));if(Array.isArray(e.install)&&e.install.length)try{await c.installExtensions(d(e.install),[],{isMachineScoped:!0},!!e.force)}catch(l){o.push(l.message)}if(Array.isArray(e.uninstall)&&e.uninstall.length)try{await c.uninstallExtensions(d(e.uninstall),!!e.force,void 0)}catch(l){o.push(l.message)}}return o.join(`
`)}finally{a.dispose()}});let B2=class extends W2{constructor(e,t,i,n,o,r){super(e,t,i),this._extensionManifestPropertiesService=r;const a=o.remoteAuthority;this._location=a?n.getHostLabel(ae.vscodeRemote,a):void 0}get location(){return this._location}validateExtensionKind(e){return!this._extensionManifestPropertiesService.canExecuteOnWorkspace(e)&&!($t&&this._extensionManifestPropertiesService.canExecuteOnWeb(e))?(this.logger.info(h(2403,"Cannot install the '{0}' extension because it is declared to not run in this setup.",_q(e.publisher,e.name))),!1):!0}};B2=f([p(1,yI),p(2,dz),p(3,di),p(4,mn),p(5,$v)],B2);let cJ=class{constructor(e,t){this._clipboardService=t}dispose(){}$readText(){return this._clipboardService.readText()}$writeText(e){return this._clipboardService.writeText(e)}};cJ=f([ht($e.MainThreadClipboard),p(1,Is)],cJ);let dJ=class{constructor(e,t,i){this._commandService=t,this._extensionService=i,this._commandRegistrations=new ei,this._proxy=e.getProxy(Ye.ExtHostCommands),this._generateCommandsDocumentationRegistration=Ce.registerCommand("_generateCommandsDocumentation",()=>this._generateCommandsDocumentation())}dispose(){this._commandRegistrations.dispose(),this._generateCommandsDocumentationRegistration.dispose()}async _generateCommandsDocumentation(){const e=await this._proxy.$getContributedCommandMetadata(),t=Ce.getCommands();for(const[n,o]of t)o.metadata&&(e[n]=o.metadata);const i=[];for(const n in e)i.push("`"+n+"` - "+VFe(e[n]));console.log(i.join(`
`))}$registerCommand(e){this._commandRegistrations.set(e,Ce.registerCommand(e,(t,...i)=>this._proxy.$executeContributedCommand(e,...i).then(n=>cn(n))))}$unregisterCommand(e){this._commandRegistrations.deleteAndDispose(e)}$fireCommandActivationEvent(e){const t=`onCommand:${e}`;this._extensionService.activationEventIsDone(t)||this._extensionService.activateByEvent(t)}async $executeCommand(e,t,i){t instanceof Jr&&(t=t.value);for(let n=0;n<t.length;n++)t[n]=cn(t[n]);if(i&&t.length>0&&!Ce.getCommand(e))throw await this._extensionService.activateByEvent(`onCommand:${e}`),new Error("$executeCommand:retry");return this._commandService.executeCommand(e,...t)}$getCommands(){return Promise.resolve([...Ce.getCommands().keys()])}};dJ=f([ht($e.MainThreadCommands),p(1,qe),p(2,hn)],dJ);function VFe(s){if(typeof s=="string")return s;{const t=[It(s.description)?s.description:s.description.original];if(t.push(`

`),s.args)for(const i of s.args)t.push(`* _${i.name}_ - ${i.description||""}
`);return s.returns&&t.push(`* _(returns)_ - ${s.returns}`),t.push(`

`),t.join("")}}let lJ=class{constructor(e,t,i,n){this._workspaceContextService=t,this.configurationService=i,this._environmentService=n;const o=e.getProxy(Ye.ExtHostConfiguration);o.$initializeConfiguration(this._getConfigurationData()),this._configurationListener=i.onDidChangeConfiguration(r=>{o.$acceptConfigurationChanged(this._getConfigurationData(),r.change)})}_getConfigurationData(){const e={...this.configurationService.getConfigurationData(),configurationScopes:[]};return(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment)&&(e.configurationScopes=hbe()),e}dispose(){this._configurationListener.dispose()}$updateConfigurationOption(e,t,i,n,o){return n={resource:n?.resource?R.revive(n.resource):void 0,overrideIdentifier:n?.overrideIdentifier},this.writeConfiguration(e,t,i,n,o)}$removeConfigurationOption(e,t,i,n){return i={resource:i?.resource?R.revive(i.resource):void 0,overrideIdentifier:i?.overrideIdentifier},this.writeConfiguration(e,t,void 0,i,n)}writeConfiguration(e,t,i,n,o){e=e??this.deriveConfigurationTarget(t,n);const r=this.configurationService.inspect(t,n);switch(e){case ur.MEMORY:return this._updateValue(t,i,e,r?.memory?.override,n,o);case ur.WORKSPACE_FOLDER:return this._updateValue(t,i,e,r?.workspaceFolder?.override,n,o);case ur.WORKSPACE:return this._updateValue(t,i,e,r?.workspace?.override,n,o);case ur.USER_REMOTE:return this._updateValue(t,i,e,r?.userRemote?.override,n,o);default:return this._updateValue(t,i,e,r?.userLocal?.override,n,o)}}_updateValue(e,t,i,n,o,r){return o=r===!0?o:r===!1?{resource:o.resource}:o.overrideIdentifier&&n!==void 0?o:{resource:o.resource},this.configurationService.updateValue(e,t,o,i,{donotNotifyError:!0})}deriveConfigurationTarget(e,t){if(t.resource&&this._workspaceContextService.getWorkbenchState()===zo.WORKSPACE){const i=Ge.as(qs.Configuration).getConfigurationProperties();if(i[e]&&(i[e].scope===Bt.RESOURCE||i[e].scope===Bt.LANGUAGE_OVERRIDABLE))return ur.WORKSPACE_FOLDER}return ur.WORKSPACE}};lJ=f([ht($e.MainThreadConfiguration),p(1,Tt),p(2,ne),p(3,po)],lJ);function L4(s){const e=[];let t;try{const i=JSON.parse(s.arguments),n=i[i.length-1];n&&n.__$stack&&(i.pop(),t=n.__$stack),e.push(...i)}catch{e.push("Unable to log remote console arguments",s.arguments)}return{args:e,stack:t}}function HFe(s){if(!s)return s;const e=s.indexOf(`
`);return e===-1?s:s.substring(0,e)}function UFe(s,e){const{args:t,stack:i}=L4(s),n=typeof t[0]=="string"&&t.length===1;let o=HFe(i);o&&(o=`(${o.trim()})`);let r=[];if(typeof t[0]=="string"?o&&n?r=[`%c[${e}] %c${t[0]} %c${o}`,w_("blue"),w_(""),w_("grey")]:r=[`%c[${e}] %c${t[0]}`,w_("blue"),w_(""),...t.slice(1)]:r=[`%c[${e}]%`,w_("blue"),...t],o&&!n&&r.push(o),typeof console[s.severity]!="function")throw new Error("Unknown console method");console[s.severity].apply(console,r)}function w_(s){return`color: ${s}`}function $Fe(s,e,t=null){const i=L4(e).args;let n=i.shift();if(typeof n=="string")switch(e.severity||(e.severity="info"),t&&(/^\[/.test(t)||(t=`[${t}]`),/ $/.test(t)||(t=`${t} `),n=t+n),e.severity){case"log":case"info":s.info(n,...i);break;case"warn":s.warn(n,...i);break;case"error":s.error(n,...i);break}}function GFe(s,e,t){const i=L4(e).args,n=i.shift();typeof n!="string"||e.severity!=="error"||(/^\[/.test(t)||(t=`[${t}]`),/ $/.test(t)||(t=`${t} `),s.error(t+n,...i))}let hJ=class{constructor(e,t,i){this._environmentService=t,this._logService=i;const n=RK(this._environmentService);this._isExtensionDevTestFromCli=n.isExtensionDevTestFromCli}dispose(){}$logExtensionHostMessage(e){this._isExtensionDevTestFromCli?$Fe(this._logService,e):(GFe(this._logService,e,"Extension Host"),UFe(e,"Extension Host"))}};hJ=f([ht($e.MainThreadConsole),p(1,po),p(2,Pe)],hJ);let uJ=class{constructor(e,t,i){this.debugService=t,this.visualizerService=i,this._toDispose=new U,this._debugAdaptersHandleCounter=1,this._visualizerHandles=new Map,this._visualizerTreeHandles=new Map,this._proxy=e.getProxy(Ye.ExtHostDebugService);const n=new ei;this._toDispose.add(n),this._toDispose.add(t.onDidNewSession(r=>{this._proxy.$acceptDebugSessionStarted(this.getSessionDto(r)),n.get(r)?.add(r.onDidChangeName(c=>{this._proxy.$acceptDebugSessionNameChanged(this.getSessionDto(r),c)}))})),this._toDispose.add(t.onWillNewSession(r=>{let a=n.get(r);a||(a=new U,n.set(r,a)),a.add(r.onDidCustomEvent(c=>this._proxy.$acceptDebugSessionCustomEvent(this.getSessionDto(r),c)))})),this._toDispose.add(t.onDidEndSession(({session:r,restart:a})=>{this._proxy.$acceptDebugSessionTerminated(this.getSessionDto(r)),this._extHostKnownSessions.delete(r.getId()),a||n.deleteAndDispose(r);for(const[c,d]of this._debugAdapters)d.session===r&&this._debugAdapters.delete(c)})),this._toDispose.add(t.getViewModel().onDidFocusSession(r=>{this._proxy.$acceptDebugSessionActiveChanged(this.getSessionDto(r))})),this._toDispose.add(Ee(()=>{for(const[r,a]of this._debugAdapters)a.fireError(r,new Error("Extension host shut down"))})),this._debugAdapters=new Map,this._debugConfigurationProviders=new Map,this._debugAdapterDescriptorFactories=new Map,this._extHostKnownSessions=new Set;const o=this.debugService.getViewModel();this._toDispose.add(D.any(o.onDidFocusStackFrame,o.onDidFocusThread)(()=>{const r=o.focusedStackFrame,a=o.focusedThread;r?this._proxy.$acceptStackFrameFocus({kind:"stackFrame",threadId:r.thread.threadId,frameId:r.frameId,sessionId:r.thread.session.getId()}):a?this._proxy.$acceptStackFrameFocus({kind:"thread",threadId:a.threadId,sessionId:a.session.getId()}):this._proxy.$acceptStackFrameFocus(void 0)})),this.sendBreakpointsAndListen()}$registerDebugVisualizerTree(e,t){this._visualizerTreeHandles.set(e,this.visualizerService.registerTree(e,{disposeItem:i=>this._proxy.$disposeVisualizedTree(i),getChildren:i=>this._proxy.$getVisualizerTreeItemChildren(e,i),getTreeItem:i=>this._proxy.$getVisualizerTreeItem(e,i),editItem:t?(i,n)=>this._proxy.$editVisualizerTreeItem(i,n):void 0}))}$unregisterDebugVisualizerTree(e){this._visualizerTreeHandles.get(e)?.dispose(),this._visualizerTreeHandles.delete(e)}$registerDebugVisualizer(e,t){const i=this.visualizerService.register({extensionId:new Es(e),id:t,disposeDebugVisualizers:n=>this._proxy.$disposeDebugVisualizers(n),executeDebugVisualizerCommand:n=>this._proxy.$executeDebugVisualizerCommand(n),provideDebugVisualizers:(n,o)=>this._proxy.$provideDebugVisualizers(e,t,n,o).then(r=>r.map($W.deserialize)),resolveDebugVisualizer:(n,o)=>this._proxy.$resolveDebugVisualizer(n.id,o)});this._visualizerHandles.set(`${e}/${t}`,i)}$unregisterDebugVisualizer(e,t){const i=`${e}/${t}`;this._visualizerHandles.get(i)?.dispose(),this._visualizerHandles.delete(i)}sendBreakpointsAndListen(){this._toDispose.add(this.debugService.getModel().onDidChangeBreakpoints(n=>{if(n&&!n.sessionOnly){const o={};n.added&&(o.added=this.convertToDto(n.added)),n.removed&&(o.removed=n.removed.map(r=>r.getId())),n.changed&&(o.changed=this.convertToDto(n.changed)),(o.added||o.removed||o.changed)&&this._proxy.$acceptBreakpointsDelta(o)}}));const e=this.debugService.getModel().getBreakpoints(),t=this.debugService.getModel().getFunctionBreakpoints(),i=this.debugService.getModel().getDataBreakpoints();(e.length>0||t.length>0)&&this._proxy.$acceptBreakpointsDelta({added:this.convertToDto(e).concat(this.convertToDto(t)).concat(this.convertToDto(i))})}dispose(){this._toDispose.dispose()}createDebugAdapter(e){const t=this._debugAdaptersHandleCounter++,i=new qFe(this,t,this._proxy,e);return this._debugAdapters.set(t,i),i}substituteVariables(e,t){return Promise.resolve(this._proxy.$substituteVariables(e?e.uri:void 0,t))}runInTerminal(e,t){return this._proxy.$runInTerminal(e,t)}$registerDebugTypes(e){this._toDispose.add(this.debugService.getAdapterManager().registerDebugAdapterFactory(e,this))}$registerBreakpoints(e){for(const t of e)if(t.type==="sourceMulti"){const i=t.lines.map(n=>({id:n.id,enabled:n.enabled,lineNumber:n.line+1,column:n.character>0?n.character+1:void 0,condition:n.condition,hitCondition:n.hitCondition,logMessage:n.logMessage,mode:n.mode}));this.debugService.addBreakpoints(R.revive(t.uri),i)}else t.type==="function"?this.debugService.addFunctionBreakpoint({name:t.functionName,mode:t.mode,condition:t.condition,hitCondition:t.hitCondition,enabled:t.enabled,logMessage:t.logMessage},t.id):t.type==="data"&&this.debugService.addDataBreakpoint({description:t.label,src:{type:xA.Variable,dataId:t.dataId},canPersist:t.canPersist,accessTypes:t.accessTypes,accessType:t.accessType,mode:t.mode});return Promise.resolve()}$unregisterBreakpoints(e,t,i){return e.forEach(n=>this.debugService.removeBreakpoints(n)),t.forEach(n=>this.debugService.removeFunctionBreakpoints(n)),i.forEach(n=>this.debugService.removeDataBreakpoints(n)),Promise.resolve()}$registerDebugConfigurationProvider(e,t,i,n,o,r){const a={type:e,triggerKind:t};return i&&(a.provideDebugConfigurations=(c,d)=>this._proxy.$provideDebugConfigurations(r,c,d)),n&&(a.resolveDebugConfiguration=(c,d,l)=>this._proxy.$resolveDebugConfiguration(r,c,d,l)),o&&(a.resolveDebugConfigurationWithSubstitutedVariables=(c,d,l)=>this._proxy.$resolveDebugConfigurationWithSubstitutedVariables(r,c,d,l)),this._debugConfigurationProviders.set(r,a),this._toDispose.add(this.debugService.getConfigurationManager().registerDebugConfigurationProvider(a)),Promise.resolve(void 0)}$unregisterDebugConfigurationProvider(e){const t=this._debugConfigurationProviders.get(e);t&&(this._debugConfigurationProviders.delete(e),this.debugService.getConfigurationManager().unregisterDebugConfigurationProvider(t))}$registerDebugAdapterDescriptorFactory(e,t){const i={type:e,createDebugAdapterDescriptor:n=>Promise.resolve(this._proxy.$provideDebugAdapter(t,this.getSessionDto(n)))};return this._debugAdapterDescriptorFactories.set(t,i),this._toDispose.add(this.debugService.getAdapterManager().registerDebugAdapterDescriptorFactory(i)),Promise.resolve(void 0)}$unregisterDebugAdapterDescriptorFactory(e){const t=this._debugAdapterDescriptorFactories.get(e);t&&(this._debugAdapterDescriptorFactories.delete(e),this.debugService.getAdapterManager().unregisterDebugAdapterDescriptorFactory(t))}getSession(e){if(e)return this.debugService.getModel().getSession(e,!0)}async $startDebugging(e,t,i){const n=e?R.revive(e):void 0,o=this.debugService.getConfigurationManager().getLaunch(n),r=this.getSession(i.parentSessionID),a=typeof i.suppressSaveBeforeStart=="boolean"?!i.suppressSaveBeforeStart:void 0,c={noDebug:i.noDebug,parentSession:r,lifecycleManagedByParent:i.lifecycleManagedByParent,repl:i.repl,compact:i.compact,compoundRoot:r?.compoundRoot,saveBeforeRestart:a,testRun:i.testRun,suppressDebugStatusbar:i.suppressDebugStatusbar,suppressDebugToolbar:i.suppressDebugToolbar,suppressDebugView:i.suppressDebugView};try{return this.debugService.startDebugging(o,t,c,a)}catch(d){throw new hr(d&&d.message?d.message:"cannot start debugging")}}$setDebugSessionName(e,t){this.debugService.getModel().getSession(e)?.setName(t)}$customDebugAdapterRequest(e,t,i){const n=this.debugService.getModel().getSession(e,!0);return n?n.customRequest(t,i).then(o=>o&&o.success?o.body:Promise.reject(new hr(o?o.message:"custom request failed"))):Promise.reject(new hr("debug session not found"))}$getDebugProtocolBreakpoint(e,t){const i=this.debugService.getModel().getSession(e,!0);return i?Promise.resolve(i.getDebugProtocolBreakpoint(t)):Promise.reject(new hr("debug session not found"))}$stopDebugging(e){if(e){const t=this.debugService.getModel().getSession(e,!0);if(t)return this.debugService.stopSession(t,xce(t))}else return this.debugService.stopSession(void 0);return Promise.reject(new hr("debug session not found"))}$appendDebugConsole(e){this.debugService.getViewModel().focusedSession?.appendToRepl({output:e,sev:Me.Warning})}$acceptDAMessage(e,t){this.getDebugAdapter(e).acceptMessage($Te(t,!1))}$acceptDAError(e,t,i,n){this._debugAdapters.get(e)?.fireError(e,new Error(`${t}: ${i}
${n}`))}$acceptDAExit(e,t,i){this._debugAdapters.get(e)?.fireExit(e,t,i)}getDebugAdapter(e){const t=this._debugAdapters.get(e);if(!t)throw new Error("Invalid debug adapter");return t}$sessionCached(e){this._extHostKnownSessions.add(e)}getSessionDto(e){if(e){const t=e.getId();return this._extHostKnownSessions.has(t)?t:{id:t,type:e.configuration.type,name:e.name,folderUri:e.root?e.root.uri:void 0,configuration:e.configuration,parent:e.parentSession?.getId()}}}convertToDto(e){return e.map(t=>{if("name"in t){const i=t;return{type:"function",id:i.getId(),enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,functionName:i.name}}else if("src"in t){const i=t;return{type:"data",id:i.getId(),dataId:i.src.type===xA.Variable?i.src.dataId:i.src.address,enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,accessType:i.accessType,label:i.description,canPersist:i.canPersist}}else if("uri"in t){const i=t;return{type:"source",id:i.getId(),enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,uri:i.uri,line:i.lineNumber>0?i.lineNumber-1:0,character:typeof i.column=="number"&&i.column>0?i.column-1:0}}else return}).filter(ya)}};uJ=f([ht($e.MainThreadDebugService),p(1,Cz),p(2,cre)],uJ);class qFe extends BTe{constructor(e,t,i,n){super(),this._ds=e,this._handle=t,this._proxy=i,this.session=n}fireError(e,t){this._onError.fire(t)}fireExit(e,t,i){this._onExit.fire(t)}startSession(){return Promise.resolve(this._proxy.$startDASession(this._handle,this._ds.getSessionDto(this.session)))}sendMessage(e){this._proxy.$sendDAMessage(this._handle,UTe(e,!0))}async stopSession(){return await this.cancelPendingRequests(),Promise.resolve(this._proxy.$stopDASession(this._handle))}}class zFe{constructor(e,t){this._proxy=e,this._handle=t,this._idPool=0,this._requests=new Map,this._resolver=new Map}enqueue(e,t){const i=++this._idPool,n=new Zo;this._requests.set(i,{id:i,uri:e}),this._resolver.set(i,n),this._processQueue();const o=t.onCancellationRequested(()=>{this._requests.delete(i),this._resolver.delete(i),n.error(new $s)});return n.p.finally(()=>o.dispose())}_processQueue(){this._timer===void 0&&(this._timer=setTimeout(()=>{const e=this._requests,t=this._resolver;this._proxy.$provideDecorations(this._handle,[...e.values()],ye.None).then(i=>{for(const[n,o]of t)o.complete(i[n])}),this._requests=new Map,this._resolver=new Map,this._timer=void 0},0))}}let gJ=class{constructor(e,t){this._decorationsService=t,this._provider=new Map,this._proxy=e.getProxy(Ye.ExtHostDecorations)}dispose(){this._provider.forEach(e=>Qe(e)),this._provider.clear()}$registerDecorationProvider(e,t){const i=new M,n=new zFe(this._proxy,e),o=this._decorationsService.registerDecorationsProvider({label:t,onDidChange:i.event,provideDecorations:async(r,a)=>{const c=await n.enqueue(r,a);if(!c)return;const[d,l,u,g]=c;return{weight:10,bubble:d??!1,color:g?.id,tooltip:l,letter:u}}});this._provider.set(e,[i,o])}$onDidChange(e,t){const i=this._provider.get(e);if(i){const[n]=i;n.fire(t&&t.map(o=>R.revive(o)))}}$unregisterDecorationProvider(e){const t=this._provider.get(e);t&&(Qe(t),this._provider.delete(e))}};gJ=f([ht($e.MainThreadDecorations),p(1,kv)],gJ);let pJ=class{constructor(e,t,i){this._markerService=t,this._uriIdentService=i,this._activeOwners=new Set,this._proxy=e.getProxy(Ye.ExtHostDiagnostics),this._markerListener=this._markerService.onMarkerChanged(this._forwardMarkers,this)}dispose(){this._markerListener.dispose(),this._activeOwners.forEach(e=>this._markerService.changeAll(e,[])),this._activeOwners.clear()}_forwardMarkers(e){const t=[];for(const i of e){const n=this._markerService.read({resource:i,ignoreResourceFilters:!0});if(n.length===0)t.push([i,[]]);else{const o=n.filter(r=>!this._activeOwners.has(r.owner));o.length>0&&t.push([i,o])}}t.length>0&&this._proxy.$acceptMarkersChange(t)}$changeMany(e,t){for(const i of t){const[n,o]=i;if(o)for(const r of o){if(r.relatedInformation)for(const a of r.relatedInformation)a.resource=R.revive(a.resource);r.code&&typeof r.code!="string"&&(r.code.target=R.revive(r.code.target))}this._markerService.changeOne(e,this._uriIdentService.asCanonicalUri(R.revive(n)),o)}this._activeOwners.add(e)}$clear(e){this._markerService.changeAll(e,[]),this._activeOwners.delete(e)}};pJ=f([ht($e.MainThreadDiagnostics),p(1,FM),p(2,Zi)],pJ);var lT;let fJ=lT=class{constructor(e,t){this._fileDialogService=t}dispose(){}async $showOpenDialog(e){const t=lT._convertOpenOptions(e);return t.defaultUri||(t.defaultUri=await this._fileDialogService.defaultFilePath()),Promise.resolve(this._fileDialogService.showOpenDialog(t))}async $showSaveDialog(e){const t=lT._convertSaveOptions(e);return t.defaultUri||(t.defaultUri=await this._fileDialogService.defaultFilePath()),Promise.resolve(this._fileDialogService.showSaveDialog(t))}static _convertOpenOptions(e){const t={openLabel:e?.openLabel||void 0,canSelectFiles:e?.canSelectFiles||!e?.canSelectFiles&&!e?.canSelectFolders,canSelectFolders:e?.canSelectFolders,canSelectMany:e?.canSelectMany,defaultUri:e?.defaultUri?R.revive(e.defaultUri):void 0,title:e?.title||void 0,availableFileSystems:[]};if(e?.filters){t.filters=[];for(const[i,n]of Object.entries(e.filters))t.filters.push({name:i,extensions:n})}return t}static _convertSaveOptions(e){const t={defaultUri:e?.defaultUri?R.revive(e.defaultUri):void 0,saveLabel:e?.saveLabel||void 0,title:e?.title||void 0};if(e?.filters){t.filters=[];for(const[i,n]of Object.entries(e.filters))t.filters.push({name:i,extensions:n})}return t}};fJ=lT=f([ht($e.MainThreadDialogs),p(1,js)],fJ);let mJ=class{constructor(e,t,i,n,o){this._textModelResolverService=t,this._languageService=i,this._modelService=n,this._editorWorkerService=o,this._resourceContentProvider=new ei,this._pendingUpdate=new Map,this._proxy=e.getProxy(Ye.ExtHostDocumentContentProviders)}dispose(){this._resourceContentProvider.dispose(),Qe(this._pendingUpdate.values())}$registerTextContentProvider(e,t){const i=this._textModelResolverService.registerTextModelContentProvider(t,{provideTextContent:n=>this._proxy.$provideTextDocumentContent(e,n).then(o=>{if(typeof o=="string"){const r=o.substr(0,1+o.search(/\r?\n/)),a=this._languageService.createByFilepathOrFirstLine(n,r);return this._modelService.createModel(o,a,n)}return null})});this._resourceContentProvider.set(e,i)}$unregisterTextContentProvider(e){this._resourceContentProvider.deleteAndDispose(e)}async $onVirtualDocumentChange(e,t){const i=this._modelService.getModel(R.revive(e));if(!i)return;this._pendingUpdate.get(i.id)?.cancel();const o=new ri;this._pendingUpdate.set(i.id,o);try{const r=await this._editorWorkerService.computeMoreMinimalEdits(i.uri,[{text:t,range:i.getFullModelRange()}]);if(this._pendingUpdate.delete(i.id),o.token.isCancellationRequested)return;r&&r.length>0&&i.applyEdits(r.map(a=>Ki.replace(P.lift(a.range),a.text)))}catch(r){mt(r)}}};mJ=f([ht($e.MainThreadDocumentContentProviders),p(1,yi),p(2,fi),p(3,ai),p(4,vc)],mJ);class Wue{constructor(e,t=1e3*60*3,i=1024*1024*80,n=50){this._extUri=e,this._maxAge=t,this._maxLength=i,this._maxSize=n,this._data=new Array,this._length=0}dispose(){this._data=Qe(this._data)}remove(e){for(const t of[...this._data])this._extUri.isEqualOrParent(t.uri,e)&&t.dispose()}add(e,t,i=0){const n=()=>{const a=this._data.indexOf(r);a>=0&&(this._length-=i,t.dispose(),clearTimeout(o),this._data.splice(a,1))},o=setTimeout(n,this._maxAge),r={uri:e,length:i,dispose:n};this._data.push(r),this._length+=i,this._cleanup()}_cleanup(){for(;this._length>this._maxLength;)this._data[0].dispose();const e=Math.ceil(this._maxSize*1.2);this._data.length>=e&&Qe(this._data.slice(0,e-this._maxSize))}}class KFe extends F{constructor(e,t,i,n){super(),this._model=e,this._onIsCaughtUpWithContentChanges=t,this._proxy=i,this._textFileService=n,this._knownVersionId=this._model.getVersionId(),this._store.add(this._model.onDidChangeContent(o=>{this._knownVersionId=o.versionId,this._proxy.$acceptModelChanged(this._model.uri,o,this._textFileService.isDirty(this._model.uri)),this.isCaughtUpWithContentChanges()&&this._onIsCaughtUpWithContentChanges.fire(this._model.uri)}))}isCaughtUpWithContentChanges(){return this._model.getVersionId()===this._knownVersionId}}let V2=class extends F{constructor(e,t,i,n,o,r,a,c,d){super(),this._modelService=t,this._textFileService=i,this._fileService=n,this._textModelResolverService=o,this._environmentService=r,this._uriIdentityService=a,this._pathService=d,this._onIsCaughtUpWithContentChanges=this._store.add(new M),this.onIsCaughtUpWithContentChanges=this._onIsCaughtUpWithContentChanges.event,this._modelTrackers=new wn,this._modelReferenceCollection=this._store.add(new Wue(a.extUri)),this._proxy=e.getProxy(Ye.ExtHostDocuments),this._store.add(t.onModelLanguageChanged(this._onModelModeChanged,this)),this._store.add(i.files.onDidSave(l=>{this._shouldHandleFileEvent(l.model.resource)&&this._proxy.$acceptModelSaved(l.model.resource)})),this._store.add(i.files.onDidChangeDirty(l=>{this._shouldHandleFileEvent(l.resource)&&this._proxy.$acceptDirtyStateChanged(l.resource,l.isDirty())})),this._store.add(D.any(i.files.onDidChangeEncoding,i.untitled.onDidChangeEncoding)(l=>{if(this._shouldHandleFileEvent(l.resource)){const u=l.getEncoding();u&&this._proxy.$acceptEncodingChanged(l.resource,u)}})),this._store.add(c.onDidRunWorkingCopyFileOperation(l=>{const u=l.operation===ga.MOVE;if(u||l.operation===ga.DELETE)for(const g of l.files){const m=u?g.source:g.target;m&&this._modelReferenceCollection.remove(m)}}))}dispose(){Qe(this._modelTrackers.values()),this._modelTrackers.clear(),super.dispose()}isCaughtUpWithContentChanges(e){const t=this._modelTrackers.get(e);return t?t.isCaughtUpWithContentChanges():!0}_shouldHandleFileEvent(e){const t=this._modelService.getModel(e);return!!t&&Au(t)}handleModelAdded(e){Au(e)&&this._modelTrackers.set(e.uri,new KFe(e,this._onIsCaughtUpWithContentChanges,this._proxy,this._textFileService))}_onModelModeChanged(e){const{model:t}=e;this._modelTrackers.has(t.uri)&&this._proxy.$acceptModelLanguageChanged(t.uri,t.getLanguageId())}handleModelRemoved(e){this._modelTrackers.has(e)&&(this._modelTrackers.get(e).dispose(),this._modelTrackers.delete(e))}async $trySaveDocument(e){return!!await this._textFileService.save(R.revive(e))}async $tryOpenDocument(e,t){const i=R.revive(e);if(!i.scheme||!(i.fsPath||i.authority))throw new hr("Invalid uri. Scheme and authority or path must be set.");const n=this._uriIdentityService.asCanonicalUri(i);let o;switch(n.scheme){case ae.untitled:o=this._handleUntitledScheme(n,t);break;case ae.file:default:o=this._handleAsResourceInput(n,t);break}let r;try{r=await o}catch(a){throw new hr(`cannot open ${n.toString()}. Detail: ${ho(a)}`)}if(r)if(vE.isEqual(r,n)){if(this._modelTrackers.has(n))return n;throw new hr(`cannot open ${n.toString()}. Detail: Files above 50MB cannot be synchronized with extensions.`)}else throw new hr(`cannot open ${n.toString()}. Detail: Actual document opened as ${r.toString()}`);else throw new hr(`cannot open ${n.toString()}`)}$tryCreateDocument(e){return this._doCreateUntitled(void 0,e)}async _handleAsResourceInput(e,t){if(t?.encoding){const n=await this._textFileService.files.resolve(e,{encoding:t.encoding,reason:Xse.REFERENCE});if(n.isDirty())throw new hr("Cannot re-open a dirty text document with different encoding. Save it first.");await n.setEncoding(t.encoding,DCe.Decode)}const i=await this._textModelResolverService.createModelReference(e);return this._modelReferenceCollection.add(e,i,i.object.textEditorModel.getValueLength()),i.object.textEditorModel.uri}async _handleUntitledScheme(e,t){const i=Iq(e,this._environmentService.remoteAuthority,this._pathService.defaultUriScheme);return await this._fileService.exists(i)?Promise.reject(new Error("file already exists")):await this._doCreateUntitled(e.path?e:void 0,t)}async _doCreateUntitled(e,t){const i=this._textFileService.untitled.create({associatedResource:e,languageId:t?.language,initialValue:t?.content,encoding:t?.encoding}),n=i.resource,o=await this._textModelResolverService.createModelReference(n);if(!this._modelTrackers.has(n))throw o.dispose(),new Error(`expected URI ${n.toString()} to have come to LIFE`);return this._modelReferenceCollection.add(n,o,o.object.textEditorModel.getValueLength()),D.once(i.onDidRevert)(()=>this._modelReferenceCollection.remove(n)),this._proxy.$acceptDirtyStateChanged(n,!0),n}};V2=f([p(1,ai),p(2,Ds),p(3,Xe),p(4,yi),p(5,mn),p(6,Zi),p(7,mg),p(8,_c)],V2);class Xl{static readFromEditor(e,t,i){const n=Xl._readSelectionsFromCodeEditor(e,i),o=Xl._readOptionsFromCodeEditor(e,t,i),r=Xl._readVisibleRangesFromCodeEditor(e,i);return new Xl(n,o,r)}static _readSelectionsFromCodeEditor(e,t){let i=null;return t&&(i=t.getSelections()),!i&&e&&(i=e.selections),i||(i=[new at(1,1,1,1)]),i}static _readOptionsFromCodeEditor(e,t,i){if(t.isDisposed()){if(e)return e.options;throw new Error("No valid properties")}let n,o;if(i){const a=i.getOptions(),c=a.get(L.lineNumbers);n=a.get(L.cursorStyle),o=c.renderType}else e?(n=e.options.cursorStyle,o=e.options.lineNumbers):(n=gbe.Line,o=cs.On);const r=t.getOptions();return{insertSpaces:r.insertSpaces,tabSize:r.tabSize,indentSize:r.indentSize,originalIndentSize:r.originalIndentSize,cursorStyle:n,lineNumbers:o}}static _readVisibleRangesFromCodeEditor(e,t){return t?t.getVisibleRanges():[]}constructor(e,t,i){this.selections=e,this.options=t,this.visibleRanges=i}generateDelta(e,t){const i={options:null,selections:null,visibleRanges:null};return(!e||!Xl._selectionsEqual(e.selections,this.selections))&&(i.selections={selections:this.selections,source:t??void 0}),(!e||!Xl._optionsEqual(e.options,this.options))&&(i.options=this.options),(!e||!Xl._rangesEqual(e.visibleRanges,this.visibleRanges))&&(i.visibleRanges=this.visibleRanges),i.selections||i.options||i.visibleRanges?i:null}static _selectionsEqual(e,t){return ns(e,t,(i,n)=>i.equalsSelection(n))}static _rangesEqual(e,t){return ns(e,t,(i,n)=>i.equalsRange(n))}static _optionsEqual(e,t){return e&&!t||!e&&t?!1:!e&&!t?!0:e.tabSize===t.tabSize&&e.indentSize===t.indentSize&&e.insertSpaces===t.insertSpaces&&e.cursorStyle===t.cursorStyle&&e.lineNumbers===t.lineNumbers}}class jFe{constructor(e,t,i,n,o,r,a){this._modelListeners=new U,this._codeEditorListeners=new U,this._id=e,this._model=t,this._codeEditor=null,this._properties=null,this._focusTracker=n,this._mainThreadDocuments=o,this._modelService=r,this._clipboardService=a,this._onPropertiesChanged=new M,this._modelListeners.add(this._model.onDidChangeOptions(c=>{this._updatePropertiesNow(null)})),this.setCodeEditor(i),this._updatePropertiesNow(null)}dispose(){this._modelListeners.dispose(),this._codeEditor=null,this._codeEditorListeners.dispose()}_updatePropertiesNow(e){this._setProperties(Xl.readFromEditor(this._properties,this._model,this._codeEditor),e)}_setProperties(e,t){const i=e.generateDelta(this._properties,t);this._properties=e,i&&this._onPropertiesChanged.fire(i)}getId(){return this._id}getModel(){return this._model}getCodeEditor(){return this._codeEditor}hasCodeEditor(e){return this._codeEditor===e}setCodeEditor(e){if(!this.hasCodeEditor(e)&&(this._codeEditorListeners.clear(),this._codeEditor=e,this._codeEditor)){this._codeEditorListeners.add(this._codeEditor.onDidChangeModel(()=>{this.setCodeEditor(null)})),this._codeEditorListeners.add(this._codeEditor.onDidFocusEditorWidget(()=>{this._focusTracker.onGainedFocus()})),this._codeEditorListeners.add(this._codeEditor.onDidBlurEditorWidget(()=>{this._focusTracker.onLostFocus()}));let t=null;this._codeEditorListeners.add(this._mainThreadDocuments.onIsCaughtUpWithContentChanges(o=>{if(o.toString()===this._model.uri.toString()){const r=t;t=null,this._updatePropertiesNow(r)}}));const i=()=>this._codeEditor&&this._codeEditor.getModel()===this._model,n=o=>{this._mainThreadDocuments.isCaughtUpWithContentChanges(this._model.uri)?(t=null,this._updatePropertiesNow(o)):t=o};this._codeEditorListeners.add(this._codeEditor.onDidChangeCursorSelection(o=>{i()&&n(o.source)})),this._codeEditorListeners.add(this._codeEditor.onDidChangeConfiguration(o=>{i()&&n(null)})),this._codeEditorListeners.add(this._codeEditor.onDidLayoutChange(()=>{i()&&n(null)})),this._codeEditorListeners.add(this._codeEditor.onDidScrollChange(()=>{i()&&n(null)})),this._updatePropertiesNow(null)}}isVisible(){return!!this._codeEditor}getProperties(){return this._properties}get onPropertiesChanged(){return this._onPropertiesChanged.event}setSelections(e){if(this._codeEditor){this._codeEditor.setSelections(e);return}const t=e.map(at.liftSelection);this._setProperties(new Xl(t,this._properties.options,this._properties.visibleRanges),null)}_setIndentConfiguration(e){const t=this._modelService.getCreationOptions(this._model.getLanguageId(),this._model.uri,this._model.isForSimpleWidget);if(e.tabSize==="auto"||e.insertSpaces==="auto"){let n=t.insertSpaces,o=t.tabSize;e.insertSpaces!=="auto"&&typeof e.insertSpaces<"u"&&(n=e.insertSpaces),e.tabSize!=="auto"&&typeof e.tabSize<"u"&&(o=e.tabSize),this._model.detectIndentation(n,o);return}const i={};typeof e.insertSpaces<"u"&&(i.insertSpaces=e.insertSpaces),typeof e.tabSize<"u"&&(i.tabSize=e.tabSize),typeof e.indentSize<"u"&&(i.indentSize=e.indentSize),this._model.updateOptions(i)}setConfiguration(e){if(this._setIndentConfiguration(e),!!this._codeEditor){if(e.cursorStyle){const t=ube(e.cursorStyle);this._codeEditor.updateOptions({cursorStyle:t})}if(typeof e.lineNumbers<"u"){let t;switch(e.lineNumbers){case cs.On:t="on";break;case cs.Relative:t="relative";break;case cs.Interval:t="interval";break;default:t="off"}this._codeEditor.updateOptions({lineNumbers:t})}}}setDecorations(e,t){this._codeEditor&&this._codeEditor.setDecorationsByType("exthost-api",e,t)}setDecorationsFast(e,t){if(!this._codeEditor)return;const i=[];for(let n=0,o=Math.floor(t.length/4);n<o;n++)i[n]=new P(t[4*n],t[4*n+1],t[4*n+2],t[4*n+3]);this._codeEditor.setDecorationsByTypeFast(e,i)}revealRange(e,t){if(this._codeEditor)switch(t){case nb.Default:this._codeEditor.revealRange(e,ji.Smooth);break;case nb.InCenter:this._codeEditor.revealRangeInCenter(e,ji.Smooth);break;case nb.InCenterIfOutsideViewport:this._codeEditor.revealRangeInCenterIfOutsideViewport(e,ji.Smooth);break;case nb.AtTop:this._codeEditor.revealRangeAtTop(e,ji.Smooth);break;default:console.warn(`Unknown revealType: ${t}`);break}}isFocused(){return this._codeEditor?this._codeEditor.hasTextFocus():!1}matches(e){return e?e.getControl()===this._codeEditor:!1}applyEdits(e,t,i){if(this._model.getVersionId()!==e||!this._codeEditor)return!1;typeof i.setEndOfLine<"u"&&this._model.pushEOL(i.setEndOfLine);const n=t.map(o=>({range:P.lift(o.range),text:o.text,forceMoveMarkers:o.forceMoveMarkers}));return i.undoStopBefore&&this._codeEditor.pushUndoStop(),this._codeEditor.executeEdits("MainThreadTextEditor",n),i.undoStopAfter&&this._codeEditor.pushUndoStop(),!0}async insertSnippet(e,t,i,n){if(!this._codeEditor||!this._codeEditor.hasModel())return!1;let o;if(fd.guessNeedsClipboard(t)){const d=new dN(this._codeEditor,ds.Value|ds.Position);if(o=await this._clipboardService.readText(),!d.validate(this._codeEditor))return!1}if(this._codeEditor.getModel().getVersionId()!==e)return!1;const a=os.get(this._codeEditor);if(!a)return!1;this._codeEditor.focus();const c=i.map(d=>({range:P.lift(d),template:t}));return a.apply(c,{overwriteBefore:0,overwriteAfter:0,undoStopBefore:n.undoStopBefore,undoStopAfter:n.undoStopAfter,adjustWhitespace:!n.keepWhitespace,clipboardText:o}),!0}}var H2;let U2=class{static{H2=this}static{this.INSTANCE_COUNT=0}constructor(e,t,i,n,o,r,a,c){this._editorLocator=e,this._codeEditorService=i,this._editorService=n,this._editorGroupService=o,this._configurationService=r,this._quickDiffModelService=a,this._uriIdentityService=c,this._toDispose=new U,this._instanceId=String(++H2.INSTANCE_COUNT),this._proxy=t.getProxy(Ye.ExtHostEditors),this._textEditorsListenersMap=Object.create(null),this._editorPositionData=null,this._toDispose.add(this._editorService.onDidVisibleEditorsChange(()=>this._updateActiveAndVisibleTextEditors())),this._toDispose.add(this._editorGroupService.onDidRemoveGroup(()=>this._updateActiveAndVisibleTextEditors())),this._toDispose.add(this._editorGroupService.onDidMoveGroup(()=>this._updateActiveAndVisibleTextEditors())),this._registeredDecorationTypes=Object.create(null)}dispose(){Object.keys(this._textEditorsListenersMap).forEach(e=>{Qe(this._textEditorsListenersMap[e])}),this._textEditorsListenersMap=Object.create(null),this._toDispose.dispose();for(const e in this._registeredDecorationTypes)this._codeEditorService.removeDecorationType(e);this._registeredDecorationTypes=Object.create(null)}handleTextEditorAdded(e){const t=e.getId(),i=[];i.push(e.onPropertiesChanged(o=>{this._proxy.$acceptEditorPropertiesChanged(t,o)}));const n=this._getTextEditorDiffInformation(e,i);i.push(ki(o=>{const r=n.read(o);this._proxy.$acceptEditorDiffInformation(t,r)})),this._textEditorsListenersMap[t]=i}handleTextEditorRemoved(e){Qe(this._textEditorsListenersMap[e]),delete this._textEditorsListenersMap[e]}_updateActiveAndVisibleTextEditors(){const e=this._getTextEditorPositionData();ma(this._editorPositionData,e)||(this._editorPositionData=e,this._proxy.$acceptEditorPositionData(this._editorPositionData))}_getTextEditorPositionData(){const e=Object.create(null);for(const t of this._editorService.visibleEditorPanes){const i=this._editorLocator.findTextEditorIdFor(t);i&&(e[i]=Jp(this._editorGroupService,t.group))}return e}_getTextEditorDiffInformation(e,t){const i=e.getCodeEditor();if(!i)return Fi(void 0);const[n]=this._codeEditorService.listDiffEditors().filter(a=>a.getOriginalEditor().getId()===i.getId()||a.getModifiedEditor().getId()===i.getId()),o=n?On(this,n.onDidChangeModel,()=>n.getModel()):On(this,i.onDidChangeModel,()=>i.getModel()),r=fe(a=>{const c=o.read(a);if(!c)return Fi(void 0);const d=t0(c)?c.uri:c.modified.uri;if(t0(c)){const g=this._quickDiffModelService.createQuickDiffModelReference(d);return g?(t.push(g),On(this,g.object.onDidChange,()=>g.object.getQuickDiffResults().map(m=>({original:m.original,modified:m.modified,changes:m.changes2})))):Fi(void 0)}const l=this._configurationService.getValue("diffEditor.diffAlgorithm"),u=this._quickDiffModelService.createQuickDiffModelReference(d,{algorithm:l});return u?(t.push(u),On(D.any(u.object.onDidChange,n.onDidUpdateDiff),()=>{const g=u.object.getQuickDiffResults().map(y=>({original:y.original,modified:y.modified,changes:y.changes2})),m=n.getDiffComputationResult()?.changes2??[],v=[{original:c.original.uri,modified:c.modified.uri,changes:m.map(y=>y)}];return[...g,...v]})):Fi(void 0)});return Jl({owner:this,equalsFn:(a,c)=>ns(a,c,(d,l)=>pbe(this._uriIdentityService,d,l))},a=>{const c=o.read(a),d=r.read(a).read(a);if(!c||!d)return;const l=t0(c)?c.getVersionId():c.modified.getVersionId();return d.map(u=>{const g=u.changes.map(m=>[m.original.startLineNumber,m.original.endLineNumberExclusive,m.modified.startLineNumber,m.modified.endLineNumberExclusive]);return{documentVersion:l,original:u.original,modified:u.modified,changes:g}})})}async $tryShowTextDocument(e,t){const i=R.revive(e),n={preserveFocus:t.preserveFocus,pinned:t.pinned,selection:t.selection,activation:t.preserveFocus?Yc.RESTORE:void 0,override:jT.EXCLUSIVE_ONLY},o={resource:i,options:n},r=await this._editorService.openEditor(o,Nm(this._editorGroupService,this._configurationService,t.position));if(!r)return;const a=r.getControl(),c=vw(a);return c?this._editorLocator.getIdOfCodeEditor(c):void 0}async $tryShowEditor(e,t){const i=this._editorLocator.getEditor(e);if(i){const n=i.getModel();await this._editorService.openEditor({resource:n.uri,options:{preserveFocus:!1}},Nm(this._editorGroupService,this._configurationService,t));return}}async $tryHideEditor(e){const t=this._editorLocator.getEditor(e);if(t){const i=this._editorService.visibleEditorPanes;for(const n of i)if(t.matches(n)){await n.group.closeEditor(n.input);return}}}$trySetSelections(e,t){const i=this._editorLocator.getEditor(e);return i?(i.setSelections(t),Promise.resolve(void 0)):Promise.reject(Mt(`TextEditor(${e})`))}$trySetDecorations(e,t,i){t=`${this._instanceId}-${t}`;const n=this._editorLocator.getEditor(e);return n?(n.setDecorations(t,i),Promise.resolve(void 0)):Promise.reject(Mt(`TextEditor(${e})`))}$trySetDecorationsFast(e,t,i){t=`${this._instanceId}-${t}`;const n=this._editorLocator.getEditor(e);return n?(n.setDecorationsFast(t,i),Promise.resolve(void 0)):Promise.reject(Mt(`TextEditor(${e})`))}$tryRevealRange(e,t,i){const n=this._editorLocator.getEditor(e);return n?(n.revealRange(t,i),Promise.resolve()):Promise.reject(Mt(`TextEditor(${e})`))}$trySetOptions(e,t){const i=this._editorLocator.getEditor(e);return i?(i.setConfiguration(t),Promise.resolve(void 0)):Promise.reject(Mt(`TextEditor(${e})`))}$tryApplyEdits(e,t,i,n){const o=this._editorLocator.getEditor(e);return o?Promise.resolve(o.applyEdits(t,i,n)):Promise.reject(Mt(`TextEditor(${e})`))}$tryInsertSnippet(e,t,i,n,o){const r=this._editorLocator.getEditor(e);return r?Promise.resolve(r.insertSnippet(t,i,n,o)):Promise.reject(Mt(`TextEditor(${e})`))}$registerTextEditorDecorationType(e,t,i){t=`${this._instanceId}-${t}`,this._registeredDecorationTypes[t]=!0,this._codeEditorService.registerDecorationType(`exthost-api-${e}`,t,i)}$removeTextEditorDecorationType(e){e=`${this._instanceId}-${e}`,delete this._registeredDecorationTypes[e],this._codeEditorService.removeDecorationType(e)}$getDiffInformation(e){const t=this._editorLocator.getEditor(e);if(!t)return Promise.reject(new Error("No such TextEditor"));const i=t.getCodeEditor();if(!i)return Promise.reject(new Error("No such CodeEditor"));const n=i.getId(),o=this._codeEditorService.listDiffEditors(),[r]=o.filter(c=>c.getOriginalEditor().getId()===n||c.getModifiedEditor().getId()===n);if(r)return Promise.resolve(r.getLineChanges()||[]);if(!i.hasModel())return Promise.resolve([]);const a=this._quickDiffModelService.createQuickDiffModelReference(i.getModel().uri);if(!a)return Promise.resolve([]);try{const c=a.object.quickDiffs.find(l=>l.kind==="primary"),d=a.object.changes.filter(l=>l.providerId===c?.id);return Promise.resolve(d.map(l=>l.change)??[])}finally{a.dispose()}}};U2=H2=f([p(2,Ot),p(3,de),p(4,Ie),p(5,ne),p(6,Iz),p(7,Zi)],U2);Ce.registerCommand("_workbench.revertAllDirty",async function(s){if(!s.get(po).extensionTestsLocationURI)throw new Error("Command is only available when running extension tests.");const t=s.get(vg);for(const i of t.dirtyWorkingCopies)await i.revert({soft:!0})});class YFe{constructor(e){this.editor=e,this.id=`${e.getId()},${e.getModel().id}`}}class $2{constructor(e,t,i,n,o,r){this.removedDocuments=e,this.addedDocuments=t,this.removedEditors=i,this.addedEditors=n,this.oldActiveEditor=o,this.newActiveEditor=r,this.isEmpty=this.removedDocuments.length===0&&this.addedDocuments.length===0&&this.removedEditors.length===0&&this.addedEditors.length===0&&o===r}toString(){let e=`DocumentAndEditorStateDelta
`;return e+=`	Removed Documents: [${this.removedDocuments.map(t=>t.uri.toString(!0)).join(", ")}]
`,e+=`	Added Documents: [${this.addedDocuments.map(t=>t.uri.toString(!0)).join(", ")}]
`,e+=`	Removed Editors: [${this.removedEditors.map(t=>t.id).join(", ")}]
`,e+=`	Added Editors: [${this.addedEditors.map(t=>t.id).join(", ")}]
`,e+=`	New Active Editor: ${this.newActiveEditor}
`,e}}class G0{static compute(e,t){if(!e)return new $2([],[...t.documents.values()],[],[...t.textEditors.values()],void 0,t.activeEditor);const i=Bne(e.documents,t.documents),n=WF(e.textEditors,t.textEditors),o=e.activeEditor!==t.activeEditor?e.activeEditor:void 0,r=e.activeEditor!==t.activeEditor?t.activeEditor:void 0;return new $2(i.removed,i.added,n.removed,n.added,o,r)}constructor(e,t,i){this.documents=e,this.textEditors=t,this.activeEditor=i}}var tm;(function(s){s[s.Editor=0]="Editor",s[s.Panel=1]="Panel"})(tm||(tm={}));let G2=class{constructor(e,t,i,n,o){this._onDidChangeState=e,this._modelService=t,this._codeEditorService=i,this._editorService=n,this._paneCompositeService=o,this._toDispose=new U,this._toDisposeOnEditorRemove=new ei,this._activeEditorOrder=tm.Editor,this._modelService.onModelAdded(this._updateStateOnModelAdd,this,this._toDispose),this._modelService.onModelRemoved(r=>this._updateState(),this,this._toDispose),this._editorService.onDidActiveEditorChange(r=>this._updateState(),this,this._toDispose),this._codeEditorService.onCodeEditorAdd(this._onDidAddEditor,this,this._toDispose),this._codeEditorService.onCodeEditorRemove(this._onDidRemoveEditor,this,this._toDispose),this._codeEditorService.listCodeEditors().forEach(this._onDidAddEditor,this),D.filter(this._paneCompositeService.onDidPaneCompositeOpen,r=>r.viewContainerLocation===Fe.Panel)(r=>this._activeEditorOrder=tm.Panel,void 0,this._toDispose),D.filter(this._paneCompositeService.onDidPaneCompositeClose,r=>r.viewContainerLocation===Fe.Panel)(r=>this._activeEditorOrder=tm.Editor,void 0,this._toDispose),this._editorService.onDidVisibleEditorsChange(r=>this._activeEditorOrder=tm.Editor,void 0,this._toDispose),this._updateState()}dispose(){this._toDispose.dispose(),this._toDisposeOnEditorRemove.dispose()}_onDidAddEditor(e){this._toDisposeOnEditorRemove.set(e.getId(),Lo(e.onDidChangeModel(()=>this._updateState()),e.onDidFocusEditorText(()=>this._updateState()),e.onDidFocusEditorWidget(()=>this._updateState(e)))),this._updateState()}_onDidRemoveEditor(e){const t=e.getId();this._toDisposeOnEditorRemove.has(t)&&(this._toDisposeOnEditorRemove.deleteAndDispose(t),this._updateState())}_updateStateOnModelAdd(e){if(Au(e)){if(!this._currentState){this._updateState();return}this._currentState=new G0(this._currentState.documents.add(e),this._currentState.textEditors,this._currentState.activeEditor),this._onDidChangeState(new $2([],[e],[],[],void 0,void 0))}}_updateState(e){const t=new Set;for(const a of this._modelService.getModels())Au(a)&&t.add(a);const i=new Map;let n=null;for(const a of this._codeEditorService.listCodeEditors()){if(a.isSimpleWidget)continue;const c=a.getModel();if(a.hasModel()&&c&&Au(c)&&!c.isDisposed()&&this._modelService.getModel(c.uri)){const d=new YFe(a);i.set(d.id,d),(a.hasTextFocus()||e===a&&a.hasWidgetFocus())&&(n=d.id)}}if(!n){let a;if(this._activeEditorOrder===tm.Editor?a=this._getActiveEditorFromEditorPart()||this._getActiveEditorFromPanel():a=this._getActiveEditorFromPanel()||this._getActiveEditorFromEditorPart(),a)for(const c of i.values())a===c.editor&&(n=c.id)}const o=new G0(t,i,n),r=G0.compute(this._currentState,o);r.isEmpty||(this._currentState=o,this._onDidChangeState(r))}_getActiveEditorFromPanel(){const e=this._paneCompositeService.getActivePaneComposite(Fe.Panel);if(e!==void 0){const t=e.getControl();if(Ao(t))return t}}_getActiveEditorFromEditorPart(){let e=this._editorService.activeTextEditorControl;return $p(e)&&(e=e.getModifiedEditor()),e}};G2=f([p(1,ai),p(2,Ot),p(3,de),p(4,aa)],G2);let vJ=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w){this._modelService=t,this._textFileService=i,this._editorService=n,this._editorGroupService=c,this._clipboardService=m,this._toDispose=new U,this._textEditors=new Map,this._proxy=e.getProxy(Ye.ExtHostDocumentsAndEditors),this._mainThreadDocuments=this._toDispose.add(new V2(e,this._modelService,this._textFileService,r,a,l,g,u,v)),e.set($e.MainThreadDocuments,this._mainThreadDocuments),this._mainThreadEditors=this._toDispose.add(new U2(this,e,o,this._editorService,this._editorGroupService,y,w,g)),e.set($e.MainThreadTextEditors,this._mainThreadEditors),this._toDispose.add(new G2(C=>this._onDelta(C),t,o,this._editorService,d))}dispose(){this._toDispose.dispose()}_onDelta(e){const t=[],i=[],n=e.removedDocuments.map(a=>a.uri);for(const a of e.addedEditors){const c=new jFe(a.id,a.editor.getModel(),a.editor,{onGainedFocus(){},onLostFocus(){}},this._mainThreadDocuments,this._modelService,this._clipboardService);this._textEditors.set(a.id,c),i.push(c)}for(const{id:a}of e.removedEditors){const c=this._textEditors.get(a);c&&(c.dispose(),this._textEditors.delete(a),t.push(a))}const o=Object.create(null);let r=!0;e.newActiveEditor!==void 0&&(r=!1,o.newActiveEditor=e.newActiveEditor),n.length>0&&(r=!1,o.removedDocuments=n),t.length>0&&(r=!1,o.removedEditors=t),e.addedDocuments.length>0&&(r=!1,o.addedDocuments=e.addedDocuments.map(a=>this._toModelAddData(a))),e.addedEditors.length>0&&(r=!1,o.addedEditors=i.map(a=>this._toTextEditorAddData(a))),r||(this._proxy.$acceptDocumentsAndEditorsDelta(o),n.forEach(this._mainThreadDocuments.handleModelRemoved,this._mainThreadDocuments),e.addedDocuments.forEach(this._mainThreadDocuments.handleModelAdded,this._mainThreadDocuments),t.forEach(this._mainThreadEditors.handleTextEditorRemoved,this._mainThreadEditors),i.forEach(this._mainThreadEditors.handleTextEditorAdded,this._mainThreadEditors))}_toModelAddData(e){return{uri:e.uri,versionId:e.getVersionId(),lines:e.getLinesContent(),EOL:e.getEOL(),languageId:e.getLanguageId(),isDirty:this._textFileService.isDirty(e.uri),encoding:this._textFileService.getEncoding(e.uri)}}_toTextEditorAddData(e){const t=e.getProperties();return{id:e.getId(),documentUri:e.getModel().uri,options:t.options,selections:t.selections,visibleRanges:t.visibleRanges,editorPosition:this._findEditorPosition(e)}}_findEditorPosition(e){for(const t of this._editorService.visibleEditorPanes)if(e.matches(t))return Jp(this._editorGroupService,t.group)}findTextEditorIdFor(e){for(const[t,i]of this._textEditors)if(i.matches(e))return t}getIdOfCodeEditor(e){for(const[t,i]of this._textEditors)if(i.getCodeEditor()===e)return t}getEditor(e){return this._textEditors.get(e)}};vJ=f([n_,p(1,ai),p(2,Ds),p(3,de),p(4,Ot),p(5,Xe),p(6,yi),p(7,Ie),p(8,aa),p(9,mn),p(10,mg),p(11,Zi),p(12,Is),p(13,_c),p(14,ne),p(15,Iz)],vJ);class QFe extends F{constructor(e,t){super();const i=()=>{t()?.windowDidDragStart()},n=()=>{t()?.windowDidDragEnd()};this._register(re(e,pe.DRAG_START,()=>{i()})),this._register(re(e,pe.DRAG_END,n)),this._register(re(e,pe.MOUSE_MOVE,o=>{o.buttons===0&&n()})),this._register(re(e,pe.DRAG,o=>{o.shiftKey?n():i()})),this._register(re(e,pe.DRAG_OVER,o=>{o.shiftKey?n():i()}))}}class lr extends gl{static{this.typeId="workbench.editors.webviewInput"}get typeId(){return lr.typeId}get editorId(){return this.viewType}get capabilities(){return Ze.Readonly|Ze.Singleton|Ze.CanDropIntoEditor}get resource(){return R.from({scheme:ae.webviewPanel,path:`webview-panel/webview-${this._resourceId}`})}constructor(e,t,i){super(),this._iconManager=i,this._resourceId=Dn(),this._hasTransfered=!1,this.viewType=e.viewType,this.providedId=e.providedId,this._name=e.name,this._webview=t}dispose(){this.isDisposed()||this._hasTransfered||this._webview?.dispose(),super.dispose()}getName(){return this._name}getTitle(e){return this.getName()}getDescription(){}setName(e){this._name=e,this.webview.setTitle(e),this._onDidChangeLabel.fire()}get webview(){return this._webview}get extension(){return this.webview.extension}get iconPath(){return this._iconPath}set iconPath(e){this._iconPath=e,this._iconManager.setIcons(this._resourceId,e)}matches(e){return super.matches(e)||e===this}get group(){return this._group}updateGroup(e){this._group=e}transfer(e){if(!this._hasTransfered)return this._hasTransfered=!0,e._webview=this._webview,e}claim(e,t,i){return this._webview.claim(e,t,i)}}var q2;const XFe=new O("activeWebviewPanelId","",{type:"string",description:h(11747,"The viewType of the currently active webview panel.")});let _J=class extends Hu{static{q2=this}static{this.ID="WebviewEditor"}get onDidFocus(){return this._onDidFocusWebview.event}constructor(e,t,i,n,o,r,a,c,d){super(q2.ID,e,t,i,n),this._editorGroupsService=o,this._editorService=r,this._workbenchLayoutService=a,this._hostService=c,this._contextKeyService=d,this._visible=!1,this._isDisposed=!1,this._webviewVisibleDisposables=this._register(new U),this._onFocusWindowHandler=this._register(new kt),this._onDidFocusWebview=this._register(new M),this._scopedContextKeyService=this._register(new kt);const l=o.getPart(e);this._register(D.any(l.onDidScroll,l.onDidAddGroup,l.onDidRemoveGroup,l.onDidMoveGroup)(()=>{this.webview&&this._visible&&this.synchronizeWebviewContainerDimensions(this.webview)}))}get webview(){return this.input instanceof lr?this.input.webview:void 0}get scopedContextKeyService(){return this._scopedContextKeyService.value}createEditor(e){const t=document.createElement("div");this._element=t,this._element.id=`webview-editor-element-${Dn()}`,e.appendChild(t),this._scopedContextKeyService.value=this._register(this._contextKeyService.createScoped(t))}dispose(){this._isDisposed=!0,this._element?.remove(),this._element=void 0,super.dispose()}layout(e){this._dimension=e,this.webview&&this._visible&&this.synchronizeWebviewContainerDimensions(this.webview,e)}focus(){super.focus(),!this._onFocusWindowHandler.value&&!$t&&(this._onFocusWindowHandler.value=this._hostService.onDidChangeFocus(e=>{e&&this._editorService.activeEditorPane===this&&this._workbenchLayoutService.hasFocus(ot.EDITOR_PART)&&this.focus()})),this.webview?.focus()}setEditorVisible(e){this._visible=e,this.input instanceof lr&&this.webview&&(e?this.claimWebview(this.input):this.webview.release(this)),super.setEditorVisible(e)}clearInput(){this.webview&&(this.webview.release(this),this._webviewVisibleDisposables.clear()),super.clearInput()}async setInput(e,t,i,n){if(this.input&&e.matches(this.input))return;const o=e instanceof lr&&e.webview===this.webview;this.webview&&!o&&this.webview.release(this),await super.setInput(e,t,i,n),await e.resolve(),!(n.isCancellationRequested||this._isDisposed)&&e instanceof lr&&(e.updateGroup(this.group.id),o||this.claimWebview(e),this._dimension&&this.layout(this._dimension))}claimWebview(e){e.claim(this,this.window,this.scopedContextKeyService),this._element&&(this._element.setAttribute("aria-flowto",e.webview.container.id),fbe(e.webview.container,this._element)),this._webviewVisibleDisposables.clear(),this._webviewVisibleDisposables.add(this._editorGroupsService.createEditorDropTarget(e.webview.container,{containsGroup:t=>this.group.id===t.id})),this._webviewVisibleDisposables.add(new QFe(this.window,()=>this.webview)),this.synchronizeWebviewContainerDimensions(e.webview),this._webviewVisibleDisposables.add(this.trackFocus(e.webview))}synchronizeWebviewContainerDimensions(e,t){if(!this._element?.isConnected)return;const i=this._workbenchLayoutService.getContainer(this.window,ot.EDITOR_PART);e.layoutWebviewOverElement(this._element.parentElement,t,i)}trackFocus(e){const t=new U,i=Po(e.container);return t.add(i),t.add(i.onDidFocus(()=>this._onDidFocusWebview.fire())),t.add(e.onDidFocus(()=>this._onDidFocusWebview.fire())),t}};_J=q2=f([p(1,li),p(2,ft),p(3,tt),p(4,Ie),p(5,de),p(6,vi),p(7,Wn),p(8,me)],_J);let z2=class extends F{constructor(e,t){super(),this._lifecycleService=e,this._configService=t,this._icons=new Map,this._register(this._configService.onDidChangeConfiguration(i=>{i.affectsConfiguration("workbench.iconTheme")&&this.updateStyleSheet()}))}dispose(){super.dispose(),this._styleElement=void 0}get styleElement(){return this._styleElement||(this._styleElement=tN(void 0,void 0,this._store),this._styleElement.className="webview-icons"),this._styleElement}setIcons(e,t){t?this._icons.set(e,t):this._icons.delete(e),this.updateStyleSheet()}async updateStyleSheet(){await this._lifecycleService.when(mc.Starting);const e=[];if(this._configService.getValue("workbench.iconTheme")!==null)for(const[t,i]of this._icons){const n=`.show-file-icons .webview-${t}-name-file-icon::before`;try{e.push(`.monaco-workbench.vs ${n}, .monaco-workbench.hc-light ${n} { content: ""; background-image: ${oy(i.light)}; }`,`.monaco-workbench.vs-dark ${n}, .monaco-workbench.hc-black ${n} { content: ""; background-image: ${oy(i.dark)}; }`)}catch{}}this.styleElement.textContent=e.join(`
`)}};z2=f([p(0,wd),p(1,ne)],z2);function hL(s,e){return s.canResolve(e)}let vv=class extends lr{constructor(e,t,i){super(e,t,i.iconManager),this._webviewWorkbenchService=i,this._resolved=!1}dispose(){super.dispose(),this._resolvePromise?.cancel(),this._resolvePromise=void 0}async resolve(){if(!this._resolved){this._resolved=!0,this._resolvePromise=En(e=>this._webviewWorkbenchService.resolveWebview(this,e));try{await this._resolvePromise}catch(e){if(!gs(e))throw e}}return super.resolve()}transfer(e){if(super.transfer(e))return e._resolved=this._resolved,e}};vv.__decorator=f([Ht],vv.prototype,"resolve",null);vv=f([p(2,II)],vv);class ZFe{constructor(){this._awaitingRevival=[]}enqueueForRestoration(e,t){const i=new Zo,n=()=>{const r=this._awaitingRevival.findIndex(a=>e===a.input);r>=0&&this._awaitingRevival.splice(r,1)},o=Lo(e.webview.onDidDispose(n),t.onCancellationRequested(()=>{n(),i.cancel()}));return this._awaitingRevival.push({input:e,promise:i,disposable:o}),i.p}reviveFor(e,t){const i=this._awaitingRevival.filter(({input:n})=>hL(e,n));this._awaitingRevival=this._awaitingRevival.filter(({input:n})=>!hL(e,n));for(const{input:n,promise:o,disposable:r}of i)e.resolveWebview(n,t).then(a=>o.complete(a),a=>o.error(a)).finally(()=>{r.dispose()})}}let bJ=class extends F{constructor(e,t,i,n){super(),this._editorService=t,this._instantiationService=i,this._webviewService=n,this._revivers=new Set,this._revivalPool=new ZFe,this._onDidChangeActiveWebviewEditor=this._register(new M),this.onDidChangeActiveWebviewEditor=this._onDidChangeActiveWebviewEditor.event,this._iconManager=this._register(this._instantiationService.createInstance(z2)),this._register(e.registerContextKeyProvider({contextKey:XFe,getGroupContextKeyValue:o=>this.getWebviewId(o.activeEditor)})),this._register(t.onDidActiveEditorChange(()=>{this.updateActiveWebview()})),this._register(n.onDidChangeActiveWebview(()=>{this.updateActiveWebview()})),this.updateActiveWebview()}get iconManager(){return this._iconManager}getWebviewId(e){let t;return e instanceof lr?t=e:e instanceof ro&&(e.primary instanceof lr?t=e.primary:e.secondary instanceof lr&&(t=e.secondary)),t?.webview.providedViewType??""}updateActiveWebview(){const e=this._editorService.activeEditor;let t;e instanceof lr?t=e:e instanceof ro&&(e.primary instanceof lr&&e.primary.webview===this._webviewService.activeWebview?t=e.primary:e.secondary instanceof lr&&e.secondary.webview===this._webviewService.activeWebview&&(t=e.secondary)),t!==this._activeWebview&&(this._activeWebview=t,this._onDidChangeActiveWebviewEditor.fire(t))}openWebview(e,t,i,n){const o=this._webviewService.createWebviewOverlay(e),r=this._instantiationService.createInstance(lr,{viewType:t,name:i,providedId:e.providedViewType},o,this.iconManager);return this._editorService.openEditor(r,{pinned:!0,preserveFocus:n.preserveFocus,activation:n.preserveFocus?Yc.RESTORE:void 0},n.group),r}revealWebview(e,t,i){const n=this.findTopLevelEditorForWebview(e);this._editorService.openEditor(n,{preserveFocus:i,activation:i?Yc.RESTORE:void 0},t)}findTopLevelEditorForWebview(e){for(const t of this._editorService.editors)if(t===e||t instanceof ro&&(e===t.primary||e===t.secondary))return t;return e}openRevivedWebview(e){const t=this._webviewService.createWebviewOverlay(e.webviewInitInfo);t.state=e.state;const i=this._instantiationService.createInstance(vv,{viewType:e.viewType,providedId:e.webviewInitInfo.providedViewType,name:e.title},t);return i.iconPath=e.iconPath,typeof e.group=="number"&&i.updateGroup(e.group),i}registerResolver(e){this._revivers.add(e);const t=new ri;return this._revivalPool.reviveFor(e,t.token),Ee(()=>{this._revivers.delete(e),t.dispose(!0)})}shouldPersist(e){return e instanceof vv?!0:dn.some(this._revivers.values(),t=>hL(t,e))}async tryRevive(e,t){for(const i of this._revivers.values())if(hL(i,e))return await i.resolveWebview(e,t),!0;return!1}async resolveWebview(e,t){if(!await this.tryRevive(e,t)&&!t.isCancellationRequested)return this._revivalPool.enqueueForRestoration(e,t)}setIcons(e,t){this._iconManager.setIcons(e,t)}};bJ=f([p(0,Ie),p(1,de),p(2,J),p(3,MN)],bJ);var P_;let qb=class extends vv{static{P_=this}static create(e,t,i,n,o){return e.invokeFunction(r=>{const a=r.get(Qq).getValue(t),c=a?Re.fromString(a):void 0,d=r.get(MN).createWebviewOverlay({providedViewType:i,title:void 0,options:{customClasses:o?.customClasses},contentOptions:{},extension:void 0}),l=e.createInstance(P_,{resource:t,viewType:i},d,{untitledDocumentData:c,oldResource:o?.oldResource});return typeof n<"u"&&l.updateGroup(n),l})}static{this.typeId="workbench.editors.webviewEditor"}get resource(){return this._editorResource}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super({providedId:e.viewType,viewType:e.viewType,name:""},t,n),this.instantiationService=o,this.labelService=r,this.customEditorService=a,this.fileDialogService=c,this.undoRedoService=d,this.fileService=l,this.filesConfigurationService=u,this.editorGroupsService=g,this.layoutService=m,this.customEditorLabelService=v,this._editorName=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._editorResource=e.resource,this.oldResource=i.oldResource,this._defaultDirtyState=i.startsDirty,this._backupId=i.backupId,this._untitledDocumentData=i.untitledDocumentData,this.registerListeners()}registerListeners(){this._register(this.labelService.onDidChangeFormatters(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onLabelEvent(e.scheme))),this._register(this.customEditorLabelService.onDidChange(()=>this.updateLabel())),this._register(this.filesConfigurationService.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire()))}onLabelEvent(e){e===this.resource.scheme&&this.updateLabel()}updateLabel(){this._editorName=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._onDidChangeLabel.fire()}get typeId(){return P_.typeId}get editorId(){return this.viewType}get capabilities(){let e=Ze.None;return e|=Ze.CanDropIntoEditor,this.customEditorService.getCustomEditorCapabilities(this.viewType)?.supportsMultipleEditorsPerDocument||(e|=Ze.Singleton),this._modelRef?this._modelRef.object.isReadonly()&&(e|=Ze.Readonly):this.filesConfigurationService.isReadonly(this.resource)&&(e|=Ze.Readonly),this.resource.scheme===ae.untitled&&(e|=Ze.Untitled),e}getName(){return typeof this._editorName!="string"&&(this._editorName=this.customEditorLabelService.getName(this.resource)??Sn(this.labelService.getUriLabel(this.resource))),this._editorName}getDescription(e=Nt.MEDIUM){switch(e){case Nt.SHORT:return this.shortDescription;case Nt.LONG:return this.longDescription;case Nt.MEDIUM:default:return this.mediumDescription}}get shortDescription(){return typeof this._shortDescription!="string"&&(this._shortDescription=this.labelService.getUriBasenameLabel(hs(this.resource))),this._shortDescription}get mediumDescription(){return typeof this._mediumDescription!="string"&&(this._mediumDescription=this.labelService.getUriLabel(hs(this.resource),{relative:!0})),this._mediumDescription}get longDescription(){return typeof this._longDescription!="string"&&(this._longDescription=this.labelService.getUriLabel(hs(this.resource))),this._longDescription}get shortTitle(){return typeof this._shortTitle!="string"&&(this._shortTitle=this.getName()),this._shortTitle}get mediumTitle(){return typeof this._mediumTitle!="string"&&(this._mediumTitle=this.labelService.getUriLabel(this.resource,{relative:!0})),this._mediumTitle}get longTitle(){return typeof this._longTitle!="string"&&(this._longTitle=this.labelService.getUriLabel(this.resource)),this._longTitle}getTitle(e){switch(e){case Nt.SHORT:return this.shortTitle;case Nt.LONG:return this.longTitle;default:case Nt.MEDIUM:return this.mediumTitle}}matches(e){return super.matches(e)?!0:this===e||e instanceof P_&&this.viewType===e.viewType&&Dt(this.resource,e.resource)}copy(){return P_.create(this.instantiationService,this.resource,this.viewType,this.group,this.webview.options)}isReadonly(){return this._modelRef?this._modelRef.object.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}isDirty(){return this._modelRef?this._modelRef.object.isDirty():!!this._defaultDirtyState}async save(e,t){if(!this._modelRef)return;const i=await this._modelRef.object.saveCustomEditor(t);if(i)return Dt(i,this.resource)?this:{resource:i}}async saveAs(e,t){if(!this._modelRef)return;const i=this._editorResource,n=await this.fileDialogService.pickFileToSave(i,t?.availableFileSystems);if(n&&await this._modelRef.object.saveCustomEditorAs(this._editorResource,n,t))return(await this.rename(e,n))?.editor}async revert(e,t){if(this._modelRef)return this._modelRef.object.revert(t);this._defaultDirtyState=!1,this._onDidChangeDirty.fire()}async resolve(){if(await super.resolve(),this.isDisposed())return null;if(!this._modelRef){const e=this.capabilities;this._modelRef=this._register(Gt(await this.customEditorService.models.tryRetain(this.resource,this.viewType))),this._register(this._modelRef.object.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this._modelRef.object.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire())),this._untitledDocumentData&&(this._defaultDirtyState=!0),this.isDirty()&&this._onDidChangeDirty.fire(),this.capabilities!==e&&this._onDidChangeCapabilities.fire()}return null}async rename(e,t){return{editor:{resource:t}}}undo(){return Gt(this._modelRef),this.undoRedoService.undo(this.resource)}redo(){return Gt(this._modelRef),this.undoRedoService.redo(this.resource)}onMove(e){this._moveHandler=e}transfer(e){if(super.transfer(e))return e._moveHandler=this._moveHandler,this._moveHandler=void 0,e}get backupId(){return this._modelRef?this._modelRef.object.backupId:this._backupId}get untitledDocumentData(){return this._untitledDocumentData}toUntyped(){return{resource:this.resource,options:{override:this.viewType}}}claim(e,t,i){if(this.doCanMove(t.vscodeWindowId)!==!0)throw kCe(h(5519,"Unable to open the editor in this window, it contains modifications that can only be saved in the original window."),[Ci({id:"openInOriginalWindow",label:h(5520,"Open in Original Window"),run:async()=>{const n=this.editorGroupsService.getPart(this.layoutService.getContainer(bt(this.webview.container).window));this.editorGroupsService.getPart(this.layoutService.getContainer(t.window)).activeGroup.moveEditor(this,n.activeGroup)}})],{forceMessage:!0});return super.claim(e,t,i)}canMove(e,t){const i=this.editorGroupsService.getGroup(t);if(i){const n=this.doCanMove(i.windowId);if(typeof n=="string")return n}return super.canMove(e,t)}doCanMove(e){return this.isModified()&&this._modelRef?.object.canHotExit===!1&&bt(this.webview.container).vscodeWindowId!==e?h(5521,"Unable to move '{0}': The editor contains changes that can only be saved in its current window.",this.getName()):!0}};qb=P_=f([p(3,II),p(4,J),p(5,di),p(6,Sz),p(7,js),p(8,HM),p(9,Xe),p(10,Ns),p(11,Ie),p(12,vi),p(13,wg)],qb);var L_;let K2=class extends gl{static{L_=this}static create(e,t,i,n,o){return e.createInstance(L_,t,i,n,o)}static{this.windowNames={}}static setName(e,t){t&&(this.windowNames[e.path]=t)}static{this.ID="workbench.input.interactive"}get editorId(){return"interactive"}get typeId(){return L_.ID}get language(){return this._inputModelRef?.object.textEditorModel.getLanguageId()??this._initLanguage}get notebookEditorInput(){return this._notebookEditorInput}get editorInputs(){return[this._notebookEditorInput]}get resource(){return this._resource}get inputResource(){return this._inputResource}get primary(){return this._notebookEditorInput}constructor(e,t,i,n,o,r,a,c,d,l,u){const g=Lm.getOrCreate(o,e,void 0,"interactive",{});super(),this._notebookService=d,this._fileDialogService=l,this.isScratchpad=u.getValue(yoe.InteractiveWindowPromptToSave)!==!0,this._notebookEditorInput=g,this._register(this._notebookEditorInput),this.name=i??L_.windowNames[e.path]??Sn(e.path,QM(e.path)),this._initLanguage=n,this._resource=e,this._inputResource=t,this._inputResolver=null,this._editorModelReference=null,this._inputModelRef=null,this._textModelService=r,this._interactiveDocumentService=a,this._historyService=c,this._registerListeners()}_registerListeners(){const e=D.once(this.primary.onWillDispose);this._register(e(()=>{this.isDisposed()||this.dispose()})),this._register(this.primary.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.primary.onDidChangeLabel(()=>this._onDidChangeLabel.fire())),this._register(this.primary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire()))}get capabilities(){const e=this.isScratchpad?Ze.Scratchpad:0;return Ze.Untitled|Ze.Readonly|e}async _resolveEditorModel(){return this._editorModelReference||(this._editorModelReference=await this._notebookEditorInput.resolve()),this._editorModelReference}async resolve(){return this._editorModelReference?this._editorModelReference:this._inputResolver?this._inputResolver:(this._inputResolver=this._resolveEditorModel(),this._inputResolver)}async resolveInput(e){if(this._inputModelRef)return this._inputModelRef.object.textEditorModel;const t=e??this._initLanguage??WM;return this._interactiveDocumentService.willCreateInteractiveDocument(this.resource,this.inputResource,t),this._inputModelRef=await this._textModelService.createModelReference(this.inputResource),this._inputModelRef.object.textEditorModel}async save(e,t){if(this._editorModelReference)return this.hasCapability(Ze.Untitled)?this.saveAs(e,t):(await this._editorModelReference.save(t),this)}async saveAs(e,t){if(!this._editorModelReference||!this._notebookService.getContributedNotebookType("interactive"))return;const n=this.getName()+".ipynb",o=xt(await this._fileDialogService.defaultFilePath(),n),r=await this._fileDialogService.pickFileToSave(o,t?.availableFileSystems);if(!r)return;const a=await this._editorModelReference.saveAs(r);return a&&"resource"in a&&a.resource&&this._notebookService.getNotebookTextModel(a.resource)?.dispose(),a}matches(e){return super.matches(e)?!0:e instanceof L_?Dt(this.resource,e.resource)&&Dt(this.inputResource,e.inputResource):!1}getName(){return this.name}isDirty(){return this.isScratchpad?!1:this._editorModelReference?.isDirty()??!1}isModified(){return this._editorModelReference?.isModified()??!1}async revert(e,t){this._editorModelReference&&this._editorModelReference.isDirty()&&await this._editorModelReference.revert(t)}dispose(){this._editorModelReference?.revert({soft:!0}),this._notebookEditorInput?.dispose(),this._editorModelReference?.dispose(),this._editorModelReference=null,this._interactiveDocumentService.willRemoveInteractiveDocument(this.resource,this.inputResource),this._inputModelRef?.dispose(),this._inputModelRef=null,super.dispose()}get historyService(){return this._historyService}};K2=L_=f([p(4,J),p(5,yi),p(6,xz),p(7,lre),p(8,$h),p(9,js),p(10,ne)],K2);const JFe={start:"<<<<<<<"};class Us extends Go{static fromLineNumbers(e,t){return Us.fromLength(e,t-e)}static fromLength(e,t){return new Us(e,e+t)}join(e){return Us.fromLineNumbers(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}isAfter(e){return this.startLineNumber>=e.endLineNumberExclusive}isBefore(e){return e.startLineNumber>=this.endLineNumberExclusive}delta(e){return Us.fromLength(this.startLineNumber+e,this.length)}deltaEnd(e){return Us.fromLength(this.startLineNumber,this.length+e)}deltaStart(e){return Us.fromLength(this.startLineNumber+e,this.length-e)}getLines(e){const t=new Array(this.length);for(let i=0;i<this.length;i++)t[i]=e.getLineContent(this.startLineNumber+i);return t}toInclusiveRangeOrEmpty(){return this.isEmpty?new P(this.startLineNumber,1,this.startLineNumber,1):new P(this.startLineNumber,1,this.endLineNumberExclusive-1,dc.MAX_SAFE_SMALL_INTEGER)}}class Ax{constructor(e,t){this.range=e,this.newLines=t}equals(e){return this.range.equals(e.range)&&ns(this.newLines,e.newLines)}toEdits(e){return new tWe([this]).toEdits(e)}}class eWe{constructor(e,t){this.range=e,this.newText=t}equals(e){return P.equalsRange(this.range,e.range)&&this.newText===e.newText}}class tWe{constructor(e){this.edits=e}toEdits(e){return this.edits.map(t=>t.range.endLineNumberExclusive<=e?{range:new P(t.range.startLineNumber,1,t.range.endLineNumberExclusive,1),text:t.newLines.map(i=>i+`
`).join("")}:t.range.startLineNumber===1?{range:new P(1,1,e,Number.MAX_SAFE_INTEGER),text:t.newLines.join(`
`)}:{range:new P(t.range.startLineNumber-1,Number.MAX_SAFE_INTEGER,e,Number.MAX_SAFE_INTEGER),text:t.newLines.map(i=>`
`+i).join("")})}}function iWe(s,e){return!(e.lineNumber<s.startLineNumber||e.lineNumber>s.endLineNumber||e.lineNumber===s.startLineNumber&&e.column<s.startColumn||e.lineNumber===s.endLineNumber&&e.column>=s.endColumn)}function UJe(s){return s.startLineNumber===s.endLineNumber?new nc(0,s.endColumn-s.startColumn):new nc(s.endLineNumber-s.startLineNumber,s.endColumn-1)}function nWe(s,e){return s.lineNumber===e.lineNumber?new nc(0,e.column-s.column):new nc(e.lineNumber-s.lineNumber,e.column-1)}function sWe(s,e){return e.lineCount===0?new _e(s.lineNumber,s.column+e.columnCount):new _e(s.lineNumber+e.lineCount,e.columnCount+1)}function yJ(s,e){return s.endLineNumber<e.startLineNumber||s.endLineNumber===e.startLineNumber&&s.endColumn<=e.startColumn}class mr{static join(e){return e.reduce((t,i)=>t?t.join(i):i,void 0)}constructor(e,t){this.inputRange=e,this.outputRange=t}extendInputRange(e){if(!e.containsRange(this.inputRange))throw new ln;const t=e.startLineNumber-this.inputRange.startLineNumber,i=e.endLineNumberExclusive-this.inputRange.endLineNumberExclusive;return new mr(e,Us.fromLength(this.outputRange.startLineNumber+t,this.outputRange.length-t+i))}join(e){return new mr(this.inputRange.join(e.inputRange),this.outputRange.join(e.outputRange))}get resultingDeltaFromOriginalToModified(){return this.outputRange.endLineNumberExclusive-this.inputRange.endLineNumberExclusive}toString(){return`${this.inputRange.toString()} -> ${this.outputRange.toString()}`}addOutputLineDelta(e){return new mr(this.inputRange,this.outputRange.delta(e))}addInputLineDelta(e){return new mr(this.inputRange.delta(e),this.outputRange)}reverse(){return new mr(this.outputRange,this.inputRange)}}class mm{static betweenOutputs(e,t,i){const o=m1.compute(e,t).map(r=>new mr(r.output1Range,r.output2Range));return new mm(o,i)}constructor(e,t){this.lineRangeMappings=e,this.inputLineCount=t,aI(()=>nN(e,(i,n)=>i.inputRange.isBefore(n.inputRange)&&i.outputRange.isBefore(n.outputRange)&&n.inputRange.startLineNumber-i.inputRange.endLineNumberExclusive===n.outputRange.startLineNumber-i.outputRange.endLineNumberExclusive))}project(e){const t=GM(this.lineRangeMappings,o=>o.inputRange.startLineNumber<=e);if(!t)return new mr(Us.fromLength(e,1),Us.fromLength(e,1));if(t.inputRange.contains(e))return t;const i=Us.fromLength(e,1),n=Us.fromLength(e+t.outputRange.endLineNumberExclusive-t.inputRange.endLineNumberExclusive,1);return new mr(i,n)}get outputLineCount(){const e=this.lineRangeMappings.at(-1),t=e?e.outputRange.endLineNumberExclusive-e.inputRange.endLineNumberExclusive:0;return this.inputLineCount+t}reverse(){return new mm(this.lineRangeMappings.map(e=>e.reverse()),this.outputLineCount)}}class m1{static compute(e,t){const i=ul(l=>l.inputRange.startLineNumber,Oh),n=Vne(e.map(l=>({source:0,diff:l})),t.map(l=>({source:1,diff:l}))).sort(ul(l=>l.diff,i)),o=[new Array,new Array],r=[0,0],a=new Array;function c(l){const u=mr.join(o[0])||new mr(l,l.delta(r[0])),g=mr.join(o[1])||new mr(l,l.delta(r[1]));a.push(new m1(d,u.extendInputRange(d).outputRange,o[0],g.extendInputRange(d).outputRange,o[1])),o[0]=[],o[1]=[]}let d;for(const l of n){const u=l.diff.inputRange;d&&!d.intersectsOrTouches(u)&&(c(d),d=void 0),r[l.source]=l.diff.resultingDeltaFromOriginalToModified,d=d?d.join(u):u,o[l.source].push(l.diff)}return d&&c(d),a}constructor(e,t,i,n,o){this.inputRange=e,this.output1Range=t,this.output1LineMappings=i,this.output2Range=n,this.output2LineMappings=o}toString(){return`${this.output1Range} <- ${this.inputRange} -> ${this.output2Range}`}}class Rp extends mr{static join(e){return e.reduce((t,i)=>t?t.join(i):i,void 0)}constructor(e,t,i,n,o){super(e,i),this.inputTextModel=t,this.outputTextModel=n,this.rangeMappings=o||[new Uu(this.inputRange.toExclusiveRange(),this.outputRange.toExclusiveRange())]}addOutputLineDelta(e){return new Rp(this.inputRange,this.inputTextModel,this.outputRange.delta(e),this.outputTextModel,this.rangeMappings.map(t=>t.addOutputLineDelta(e)))}addInputLineDelta(e){return new Rp(this.inputRange.delta(e),this.inputTextModel,this.outputRange,this.outputTextModel,this.rangeMappings.map(t=>t.addInputLineDelta(e)))}join(e){return new Rp(this.inputRange.join(e.inputRange),this.inputTextModel,this.outputRange.join(e.outputRange),this.outputTextModel)}getLineEdit(){return new Ax(this.inputRange,this.getOutputLines())}getReverseLineEdit(){return new Ax(this.outputRange,this.getInputLines())}getOutputLines(){return this.outputRange.getLines(this.outputTextModel)}getInputLines(){return this.inputRange.getLines(this.inputTextModel)}}class Uu{constructor(e,t){this.inputRange=e,this.outputRange=t}toString(){function e(t){return`[${t.startLineNumber}:${t.startColumn}, ${t.endLineNumber}:${t.endColumn})`}return`${e(this.inputRange)} -> ${e(this.outputRange)}`}addOutputLineDelta(e){return new Uu(this.inputRange,new P(this.outputRange.startLineNumber+e,this.outputRange.startColumn,this.outputRange.endLineNumber+e,this.outputRange.endColumn))}addInputLineDelta(e){return new Uu(new P(this.inputRange.startLineNumber+e,this.inputRange.startColumn,this.inputRange.endLineNumber+e,this.inputRange.endColumn),this.outputRange)}reverse(){return new Uu(this.outputRange,this.inputRange)}}class gb{constructor(e,t){this.rangeMappings=e,this.inputLineCount=t,aI(()=>nN(e,(i,n)=>yJ(i.inputRange,n.inputRange)&&yJ(i.outputRange,n.outputRange)))}project(e){const t=GM(this.rangeMappings,o=>o.inputRange.getStartPosition().isBeforeOrEqual(e));if(!t)return new Uu(P.fromPositions(e,e),P.fromPositions(e,e));if(iWe(t.inputRange,e))return t;const i=nWe(t.inputRange.getEndPosition(),e),n=sWe(t.outputRange.getEndPosition(),i);return new Uu(P.fromPositions(e),P.fromPositions(n))}projectRange(e){const t=this.project(e.getStartPosition()),i=this.project(e.getEndPosition());return new Uu(t.inputRange.plusRange(i.inputRange),t.outputRange.plusRange(i.outputRange))}get outputLineCount(){const e=this.rangeMappings.at(-1),t=e?e.outputRange.endLineNumber-e.inputRange.endLineNumber:0;return this.inputLineCount+t}reverse(){return new gb(this.rangeMappings.map(e=>e.reverse()),this.outputLineCount)}}let uL=class{constructor(e,t){this.editorWorkerService=e,this.configurationService=t,this.mergeAlgorithm=Dse("mergeEditor.diffAlgorithm","advanced",this.configurationService).map(i=>i==="smart"?"legacy":i==="experimental"?"advanced":i)}async computeDiff(e,t,i){const n=this.mergeAlgorithm.read(i),o=e.getVersionId(),r=t.getVersionId(),a=await this.editorWorkerService.computeDiff(e.uri,t.uri,{ignoreTrimWhitespace:!1,maxComputationTimeMs:0,computeMoves:!1},n);if(!a)throw new Error("Diff computation failed");if(e.isDisposed()||t.isDisposed())return{diffs:null};const c=a.changes.map(u=>new Rp(wJ(u.original),e,wJ(u.modified),t,u.innerChanges?.map(g=>oWe(g)))),d=e.getVersionId(),l=t.getVersionId();return o!==d||r!==l?{diffs:null}:(aI(()=>{for(const u of c){const g=u.inputRange,m=u.outputRange,v=u.inputTextModel,y=u.outputTextModel;for(const w of u.rangeMappings){let C=g.startLineNumber-1<=w.inputRange.startLineNumber&&w.inputRange.endLineNumber<=g.endLineNumberExclusive;C&&w.inputRange.startLineNumber===g.startLineNumber-1&&(C=w.inputRange.endColumn>=v.getLineMaxColumn(w.inputRange.startLineNumber)),C&&w.inputRange.endLineNumber===g.endLineNumberExclusive&&(C=w.inputRange.endColumn===1);let T=m.startLineNumber-1<=w.outputRange.startLineNumber&&w.outputRange.endLineNumber<=m.endLineNumberExclusive;if(T&&w.outputRange.startLineNumber===m.startLineNumber-1&&(T=w.outputRange.endColumn>=y.getLineMaxColumn(w.outputRange.endLineNumber)),T&&w.outputRange.endLineNumber===m.endLineNumberExclusive&&(T=w.outputRange.endColumn===1),!C||!T)return!1}}return c.length===0||c[0].inputRange.startLineNumber===c[0].outputRange.startLineNumber&&nN(c,(u,g)=>g.inputRange.startLineNumber-u.inputRange.endLineNumberExclusive===g.outputRange.startLineNumber-u.outputRange.endLineNumberExclusive&&u.inputRange.endLineNumberExclusive<g.inputRange.startLineNumber&&u.outputRange.endLineNumberExclusive<g.outputRange.startLineNumber)}),{diffs:c})}};uL=f([p(0,vc),p(1,ne)],uL);function wJ(s){return Us.fromLength(s.startLineNumber,s.length)}function oWe(s){return new Uu(s.originalRange,s.modifiedRange)}class rWe{constructor(){this._isOccupied=!1}runExclusivelyOrSkip(e){if(!this._isOccupied){this._isOccupied=!0;try{e()}finally{this._isOccupied=!1}}}runExclusivelyOrThrow(e){if(this._isOccupied)throw new ln("ReentrancyBarrier: reentrant call detected!");this._isOccupied=!0;try{e()}finally{this._isOccupied=!1}}get isOccupied(){return this._isOccupied}makeExclusiveOrSkip(e){return(...t)=>{if(!this._isOccupied){this._isOccupied=!0;try{return e(...t)}finally{this._isOccupied=!1}}}}}class q0 extends F{get isApplyingChange(){return this._barrier.isOccupied}constructor(e,t,i){super(),this.baseTextModel=e,this.textModel=t,this.diffComputer=i,this._recomputeCount=0,this._state=oi(this,Ka.initializing),this._diffs=oi(this,[]),this._barrier=new rWe,this._isDisposed=!1,this._isInitializing=!0;const n=jd("recompute");this._register(ki(o=>{n.read(o),this._recompute(o)})),this._register(e.onDidChangeContent(this._barrier.makeExclusiveOrSkip(()=>{n.trigger(void 0)}))),this._register(t.onDidChangeContent(this._barrier.makeExclusiveOrSkip(()=>{n.trigger(void 0)}))),this._register(Ee(()=>{this._isDisposed=!0}))}get state(){return this._state}get diffs(){return this._diffs}_recompute(e){this._recomputeCount++;const t=this._recomputeCount;this._state.get()===Ka.initializing&&(this._isInitializing=!0),ys(n=>{this._state.set(this._isInitializing?Ka.initializing:Ka.updating,n,vu.other)}),this.diffComputer.computeDiff(this.baseTextModel,this.textModel,e).then(n=>{this._isDisposed||t===this._recomputeCount&&ys(o=>{n.diffs?(this._state.set(Ka.upToDate,o,vu.textChange),this._diffs.set(n.diffs,o,vu.textChange)):this._state.set(Ka.error,o,vu.textChange),this._isInitializing=!1})})}ensureUpToDate(){if(this.state.get()!==Ka.upToDate)throw new ln("Cannot remove diffs when the model is not up to date")}removeDiffs(e,t,i){this.ensureUpToDate(),e.sort(ul(o=>o.inputRange.startLineNumber,Oh)),e.reverse();let n=this._diffs.get();for(const o of e){const r=n.length;if(n=n.filter(a=>a!==o),r===n.length)throw new ln;this._barrier.runExclusivelyOrThrow(()=>{const a=o.getReverseLineEdit().toEdits(this.textModel.getLineCount());this.textModel.pushEditOperations(null,a,()=>null,i)}),n=n.map(a=>a.outputRange.isAfter(o.outputRange)?a.addOutputLineDelta(o.inputRange.length-o.outputRange.length):a)}this._diffs.set(n,t,vu.other)}applyEditRelativeToOriginal(e,t,i){this.ensureUpToDate();const n=new Rp(e.range,this.baseTextModel,Us.fromLength(e.range.startLineNumber,e.newLines.length),this.textModel);let o=!1,r=0;const a=new Array;for(const c of this.diffs.get()){if(c.inputRange.intersectsOrTouches(e.range))throw new ln("Edit must be conflict free.");c.inputRange.isAfter(e.range)?(o||(o=!0,a.push(n.addOutputLineDelta(r))),a.push(c.addOutputLineDelta(e.newLines.length-e.range.length))):a.push(c),o||(r+=c.outputRange.length-c.inputRange.length)}o||(o=!0,a.push(n.addOutputLineDelta(r))),this._barrier.runExclusivelyOrThrow(()=>{const c=new Ax(e.range.delta(r),e.newLines).toEdits(this.textModel.getLineCount());this.textModel.pushEditOperations(null,c,()=>null,i)}),this._diffs.set(a,t,vu.other)}findTouchingDiffs(e){return this.diffs.get().filter(t=>t.inputRange.intersectsOrTouches(e))}getResultLine(e,t){let i=0;const n=t?this.diffs.read(t):this.diffs.get();for(const o of n){if(o.inputRange.contains(e)||o.inputRange.endLineNumberExclusive===e)return o;if(o.inputRange.endLineNumberExclusive<e)i=o.resultingDeltaFromOriginalToModified;else break}return e+i}getResultLineRange(e,t){let i=this.getResultLine(e.startLineNumber,t);typeof i!="number"&&(i=i.outputRange.startLineNumber);let n=this.getResultLine(e.endLineNumberExclusive,t);return typeof n!="number"&&(n=n.outputRange.endLineNumberExclusive),Us.fromLineNumbers(i,n)}}var vu;(function(s){s[s.other=0]="other",s[s.textChange=1]="textChange"})(vu||(vu={}));var Ka;(function(s){s[s.initializing=1]="initializing",s[s.upToDate=2]="upToDate",s[s.updating=3]="updating",s[s.error=4]="error"})(Ka||(Ka={}));function GJe(s,e){Object.entries(e).forEach(([t,i])=>{s.style.setProperty(t,aWe(i))})}function aWe(s){return typeof s=="number"?`${s}px`:s}function qJe(s,e){const t=new U;let i=[];return t.add(mbe({debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const o=e.read(n);s.changeDecorations(r=>{i=r.deltaDecorations(i,o)})})),t.add({dispose:()=>{s.changeDecorations(n=>{i=n.deltaDecorations(i,[])})}}),t}function*cWe(s,e,t){const i=new Hne(e);for(const n of s){i.takeWhile(r=>TE.isGreaterThan(t(n,r)));const o=i.takeWhile(r=>TE.isNeitherLessOrGreaterThan(t(n,r)));yield{left:n,rights:o||[]}}}function*zJe(s,e,t){const i=new Hne(e);for(const n of s){const o=i.takeWhile(a=>TE.isGreaterThan(t(n,a)));o&&(yield{rights:o});const r=i.takeWhile(a=>TE.isNeitherLessOrGreaterThan(t(n,a)));yield{left:n,rights:r||[]}}}function KJe(s,e){return Object.assign(s,e)}function dWe(s,e){const t={};for(const i in s)t[i]=s[i];for(const i in e){const n=e[i];typeof t[i]=="object"&&n&&typeof n=="object"?t[i]=dWe(t[i],n):t[i]=n}return t}let SJ=class{constructor(e,t){this.key=e,this.storageService=t,this.hasValue=!1,this.value=void 0}get(){if(!this.hasValue){const e=this.storageService.get(this.key,he.PROFILE);if(e!==void 0)try{this.value=JSON.parse(e)}catch(t){mt(t)}this.hasValue=!0}return this.value}set(e){this.value=e,this.storageService.store(this.key,JSON.stringify(this.value),he.PROFILE,pt.USER)}};SJ=f([p(1,tt)],SJ);class M4{static fromDiffs(e,t,i,n,o){return m1.compute(e,t).map(a=>new M4(a.inputRange,i,a.output1Range,n,a.output1LineMappings,a.output2Range,o,a.output2LineMappings))}constructor(e,t,i,n,o,r,a,c){if(this.baseRange=e,this.baseTextModel=t,this.input1Range=i,this.input1TextModel=n,this.input1Diffs=o,this.input2Range=r,this.input2TextModel=a,this.input2Diffs=c,this.input1CombinedDiff=Rp.join(this.input1Diffs),this.input2CombinedDiff=Rp.join(this.input2Diffs),this.isEqualChange=ns(this.input1Diffs,this.input2Diffs,(d,l)=>d.getLineEdit().equals(l.getLineEdit())),this.smartInput1LineRangeEdit=null,this.smartInput2LineRangeEdit=null,this.dumbInput1LineRangeEdit=null,this.dumbInput2LineRangeEdit=null,this.input1Diffs.length===0&&this.input2Diffs.length===0)throw new ln("must have at least one diff")}getInputRange(e){return e===1?this.input1Range:this.input2Range}getInputCombinedDiff(e){return e===1?this.input1CombinedDiff:this.input2CombinedDiff}getInputDiffs(e){return e===1?this.input1Diffs:this.input2Diffs}get isConflicting(){return this.input1Diffs.length>0&&this.input2Diffs.length>0}get canBeCombined(){return this.smartCombineInputs(1)!==void 0}get isOrderRelevant(){const e=this.smartCombineInputs(1),t=this.smartCombineInputs(2);return!e||!t?!1:!e.equals(t)}getEditForBase(e){const t=[];if(e.includesInput1&&this.input1CombinedDiff&&t.push({diff:this.input1CombinedDiff,inputNumber:1}),e.includesInput2&&this.input2CombinedDiff&&t.push({diff:this.input2CombinedDiff,inputNumber:2}),t.length===0)return{edit:void 0,effectiveState:Zs.base};if(t.length===1)return{edit:t[0].diff.getLineEdit(),effectiveState:Zs.base.withInputValue(t[0].inputNumber,!0,!1)};if(e.kind!==Wi.both)throw new ln;const i=e.smartCombination?this.smartCombineInputs(e.firstInput):this.dumbCombineInputs(e.firstInput);return i?{edit:i,effectiveState:e}:{edit:t[j2(e.firstInput)-1].diff.getLineEdit(),effectiveState:Zs.base.withInputValue(j2(e.firstInput),!0,!1)}}smartCombineInputs(e){if(e===1&&this.smartInput1LineRangeEdit!==null)return this.smartInput1LineRangeEdit;if(e===2&&this.smartInput2LineRangeEdit!==null)return this.smartInput2LineRangeEdit;const i=Vne(this.input1Diffs.flatMap(o=>o.rangeMappings.map(r=>({diff:r,input:1}))),this.input2Diffs.flatMap(o=>o.rangeMappings.map(r=>({diff:r,input:2})))).sort(vbe(ul(o=>o.diff.inputRange,P.compareRangesUsingStarts),ul(o=>o.input===e?1:2,Oh))).map(o=>{const r=o.input===1?this.input1TextModel:this.input2TextModel;return new eWe(o.diff.inputRange,r.getValueInRange(o.diff.outputRange))}),n=lWe(this.baseRange,i,this.baseTextModel);return e===1?this.smartInput1LineRangeEdit=n:this.smartInput2LineRangeEdit=n,n}dumbCombineInputs(e){if(e===1&&this.dumbInput1LineRangeEdit!==null)return this.dumbInput1LineRangeEdit;if(e===2&&this.dumbInput2LineRangeEdit!==null)return this.dumbInput2LineRangeEdit;let t=this.input1Range.getLines(this.input1TextModel),i=this.input2Range.getLines(this.input2TextModel);e===2&&([t,i]=[i,t]);const n=new Ax(this.baseRange,t.concat(i));return e===1?this.dumbInput1LineRangeEdit=n:this.dumbInput2LineRangeEdit=n,n}}function lWe(s,e,t){let i="";const n=s.startLineNumber>1;let o=n?new _e(s.startLineNumber-1,t.getLineMaxColumn(s.startLineNumber-1)):new _e(s.startLineNumber,1);for(const l of e){const u=l.range.getStartPosition();if(!o.isBeforeOrEqual(u))return;let g=t.getValueInRange(P.fromPositions(o,u));u.lineNumber>t.getLineCount()&&(g+=`
`),i+=g,i+=l.newText,o=l.range.getEndPosition()}const r=s.endLineNumberExclusive<=t.getLineCount(),a=r?new _e(s.endLineNumberExclusive,1):new _e(s.endLineNumberExclusive-1,dc.MAX_SAFE_SMALL_INTEGER),c=t.getValueInRange(P.fromPositions(o,a));i+=c;const d=Ih(i);if(n){if(d[0]!=="")return;d.shift()}if(r){if(d[d.length-1]!=="")return;d.pop()}return new Ax(s,d)}var Wi;(function(s){s[s.base=0]="base",s[s.input1=1]="input1",s[s.input2=2]="input2",s[s.both=3]="both",s[s.unrecognized=4]="unrecognized"})(Wi||(Wi={}));function j2(s){return s===1?2:1}class mD{constructor(){}get includesInput1(){return!1}get includesInput2(){return!1}includesInput(e){return e===1?this.includesInput1:this.includesInput2}isInputIncluded(e){return e===1?this.includesInput1:this.includesInput2}toggle(e){return this.withInputValue(e,!this.includesInput(e),!0)}getInput(e){return this.isInputIncluded(e)?Ky.first:Ky.excluded}}class N4 extends mD{get kind(){return Wi.base}toString(){return"base"}swap(){return this}withInputValue(e,t,i=!1){return e===1?t?new v1:this:t?new _v:this}equals(e){return e.kind===Wi.base}}class v1 extends mD{get kind(){return Wi.input1}get includesInput1(){return!0}toString(){return"1✓"}swap(){return new _v}withInputValue(e,t,i=!1){return e===1?t?this:new N4:t?new _1(1,i):new _v}equals(e){return e.kind===Wi.input1}}class _v extends mD{get kind(){return Wi.input2}get includesInput2(){return!0}toString(){return"2✓"}swap(){return new v1}withInputValue(e,t,i=!1){return e===2?t?this:new N4:t?new _1(2,i):new _v}equals(e){return e.kind===Wi.input2}}class _1 extends mD{constructor(e,t){super(),this.firstInput=e,this.smartCombination=t}get kind(){return Wi.both}get includesInput1(){return!0}get includesInput2(){return!0}toString(){return"2✓"}swap(){return new _1(j2(this.firstInput),this.smartCombination)}withInputValue(e,t,i=!1){return t?this:e===1?new _v:new v1}equals(e){return e.kind===Wi.both&&this.firstInput===e.firstInput&&this.smartCombination===e.smartCombination}getInput(e){return e===this.firstInput?Ky.first:Ky.second}}class hWe extends mD{get kind(){return Wi.unrecognized}toString(){return"unrecognized"}swap(){return this}withInputValue(e,t,i=!1){return t?e===1?new v1:new _v:this}equals(e){return e.kind===Wi.unrecognized}}var Zs;(function(s){s.base=new N4,s.unrecognized=new hWe})(Zs||(Zs={}));var Ky;(function(s){s[s.excluded=0]="excluded",s[s.first=1]="first",s[s.second=2]="second",s[s.unrecognized=3]="unrecognized"})(Ky||(Ky={}));let gL=class extends Bv{constructor(e,t,i,n,o,r,a,c,d){super(),this.base=e,this.input1=t,this.input2=i,this.resultTextModel=n,this.diffComputer=o,this.options=r,this.telemetry=a,this.languageService=c,this.undoRedoService=d,this.input1TextModelDiffs=this._register(new q0(this.base,this.input1.textModel,this.diffComputer)),this.input2TextModelDiffs=this._register(new q0(this.base,this.input2.textModel,this.diffComputer)),this.resultTextModelDiffs=this._register(new q0(this.base,this.resultTextModel,this.diffComputer)),this.modifiedBaseRanges=fe(this,u=>{const g=this.input1TextModelDiffs.diffs.read(u),m=this.input2TextModelDiffs.diffs.read(u);return M4.fromDiffs(g,m,this.base,this.input1.textModel,this.input2.textModel)}),this.modifiedBaseRangeResultStates=fe(this,u=>new Map(this.modifiedBaseRanges.read(u).map(m=>[m,new CJ(m)]))),this.resultSnapshot=this.resultTextModel.createSnapshot(),this.baseInput1Diffs=this.input1TextModelDiffs.diffs,this.baseInput2Diffs=this.input2TextModelDiffs.diffs,this.baseResultDiffs=this.resultTextModelDiffs.diffs,this.input1ResultMapping=fe(this,u=>this.getInputResultMapping(this.baseInput1Diffs.read(u),this.baseResultDiffs.read(u),this.input1.textModel.getLineCount())),this.resultInput1Mapping=fe(this,u=>this.input1ResultMapping.read(u).reverse()),this.input2ResultMapping=fe(this,u=>this.getInputResultMapping(this.baseInput2Diffs.read(u),this.baseResultDiffs.read(u),this.input2.textModel.getLineCount())),this.resultInput2Mapping=fe(this,u=>this.input2ResultMapping.read(u).reverse()),this.baseResultMapping=fe(this,u=>{const g=new mm(this.baseResultDiffs.read(u),-1);return new mm(g.lineRangeMappings.map(m=>m.inputRange.isEmpty||m.outputRange.isEmpty?new mr(m.inputRange.deltaStart(-1),m.outputRange.deltaStart(-1)):m),g.inputLineCount)}),this.resultBaseMapping=fe(this,u=>this.baseResultMapping.read(u).reverse()),this.diffComputingState=fe(this,u=>{const g=[this.input1TextModelDiffs,this.input2TextModelDiffs,this.resultTextModelDiffs].map(m=>m.state.read(u));return g.some(m=>m===Ka.initializing)?Lc.initializing:g.some(m=>m===Ka.updating)?Lc.updating:Lc.upToDate}),this.inputDiffComputingState=fe(this,u=>{const g=[this.input1TextModelDiffs,this.input2TextModelDiffs].map(m=>m.state.read(u));return g.some(m=>m===Ka.initializing)?Lc.initializing:g.some(m=>m===Ka.updating)?Lc.updating:Lc.upToDate}),this.isUpToDate=fe(this,u=>this.diffComputingState.read(u)===Lc.upToDate),this.firstRun=!0,this.unhandledConflictsCount=fe(this,u=>{const g=this.modifiedBaseRangeResultStates.read(u);let m=0;for(const[v,y]of g)y.handled.read(u)||m++;return m}),this.hasUnhandledConflicts=this.unhandledConflictsCount.map(u=>u>0),this._register(i0(this.modifiedBaseRangeResultStates)),this._register(i0(this.input1ResultMapping)),this._register(i0(this.input2ResultMapping));const l=this.initialize();this.onInitialized=Rk(this.diffComputingState,u=>u===Lc.upToDate).then(async()=>{await l}),l.then(()=>{let u=!0;this._register(_be({changeTracker:{createChangeSummary:()=>{},handleChange:g=>(g.didChange(this.modifiedBaseRangeResultStates)&&(u=!0),g.didChange(this.resultTextModelDiffs.diffs)?g.change===vu.textChange:!0)}},g=>{const m=this.modifiedBaseRangeResultStates.read(g);if(!this.isUpToDate.read(g))return;const v=this.resultTextModelDiffs.diffs.read(g);ys(y=>{if(this.updateBaseRangeAcceptedState(v,m,y),u){u=!1;for(const[w,C]of m){const T=C.accepted.get(),k=!(T.kind===Wi.base||T.kind===Wi.unrecognized);C.handledInput1.set(k,y),C.handledInput2.set(k,y)}}})}))})}async initialize(){this.options.resetResult&&await this.reset()}async reset(){await Rk(this.inputDiffComputingState,t=>t===Lc.upToDate);const e=this.modifiedBaseRangeResultStates.get();ys(t=>{for(const[i,n]of e){let o,r=!1;i.input1Diffs.length===0?(o=Zs.base.withInputValue(2,!0),r=!0):i.input2Diffs.length===0||i.isEqualChange?(o=Zs.base.withInputValue(1,!0),r=!0):(o=Zs.base,r=!1),n.accepted.set(o,t),n.computedFromDiffing=!1,n.previousNonDiffingState=void 0,n.handledInput1.set(r,t),n.handledInput2.set(r,t)}this.resultTextModel.pushEditOperations(null,[{range:new P(1,1,Number.MAX_SAFE_INTEGER,1),text:this.computeAutoMergedResult()}],()=>null)})}computeAutoMergedResult(){const e=this.modifiedBaseRanges.get(),t=this.base.getLinesContent(),i=this.input1.textModel.getLinesContent(),n=this.input2.textModel.getLinesContent(),o=[];function r(c,d){for(let l=d.startLineNumber;l<d.endLineNumberExclusive;l++)o.push(c[l-1])}let a=1;for(const c of e)r(t,Us.fromLineNumbers(a,c.baseRange.startLineNumber)),a=c.baseRange.endLineNumberExclusive,c.input1Diffs.length===0?r(n,c.input2Range):c.input2Diffs.length===0||c.isEqualChange?r(i,c.input1Range):r(t,c.baseRange);return r(t,Us.fromLineNumbers(a,t.length+1)),o.join(this.resultTextModel.getEOL())}hasBaseRange(e){return this.modifiedBaseRangeResultStates.get().has(e)}get isApplyingEditInResult(){return this.resultTextModelDiffs.isApplyingChange}getInputResultMapping(e,t,i){const n=mm.betweenOutputs(e,t,i);return new mm(n.lineRangeMappings.map(o=>o.inputRange.isEmpty||o.outputRange.isEmpty?new mr(o.inputRange.deltaStart(-1),o.outputRange.deltaStart(-1)):o),n.inputLineCount)}translateInputRangeToBase(e,t){const i=e===1?this.baseInput1Diffs.get():this.baseInput2Diffs.get();return new gb(i.flatMap(o=>o.rangeMappings),0).reverse().projectRange(t).outputRange}translateBaseRangeToInput(e,t){const i=e===1?this.baseInput1Diffs.get():this.baseInput2Diffs.get();return new gb(i.flatMap(o=>o.rangeMappings),0).projectRange(t).outputRange}getLineRangeInResult(e,t){return this.resultTextModelDiffs.getResultLineRange(e,t)}translateResultRangeToBase(e){return new gb(this.baseResultDiffs.get().flatMap(i=>i.rangeMappings),0).reverse().projectRange(e).outputRange}translateBaseRangeToResult(e){return new gb(this.baseResultDiffs.get().flatMap(i=>i.rangeMappings),0).projectRange(e).outputRange}findModifiedBaseRangesInRange(e){return this.modifiedBaseRanges.get().filter(t=>t.baseRange.intersectsOrTouches(e))}updateBaseRangeAcceptedState(e,t,i){const n=cWe(t,e,(o,r)=>o[0].baseRange.intersectsOrTouches(r.inputRange)?TE.neitherLessOrGreaterThan:Us.compareByStart(o[0].baseRange,r.inputRange));for(const o of n){const r=this.computeState(o.left[0],o.rights),a=o.left[1],c=a.accepted.get();c.equals(r)||(!this.firstRun&&!a.computedFromDiffing&&(a.computedFromDiffing=!0,a.previousNonDiffingState=c),a.accepted.set(r,i))}this.firstRun&&(this.firstRun=!1)}computeState(e,t){if(t.length===0)return Zs.base;const i=t.map(r=>r.getLineEdit());function n(r){return ns(i,r.map(a=>a.getLineEdit()),(a,c)=>a.equals(c))}if(n(e.input1Diffs))return Zs.base.withInputValue(1,!0);if(n(e.input2Diffs))return Zs.base.withInputValue(2,!0);const o=[Zs.base.withInputValue(1,!0).withInputValue(2,!0,!0),Zs.base.withInputValue(2,!0).withInputValue(1,!0,!0),Zs.base.withInputValue(1,!0).withInputValue(2,!0,!1),Zs.base.withInputValue(2,!0).withInputValue(1,!0,!1)];for(const r of o){const{edit:a}=e.getEditForBase(r);if(a){const d=this.resultTextModelDiffs.getResultLineRange(e.baseRange).getLines(this.resultTextModel);if(ns(a.newLines,d,(l,u)=>l===u))return r}}return Zs.unrecognized}getState(e){const t=this.modifiedBaseRangeResultStates.get().get(e);if(!t)throw new ln("object must be from this instance");return t.accepted}setState(e,t,i,n,o=!1){if(!this.isUpToDate.get())throw new ln("Cannot set state while updating");const r=this.modifiedBaseRangeResultStates.get().get(e);if(!r)throw new ln("object must be from this instance");const a=this.resultTextModelDiffs.findTouchingDiffs(e.baseRange),c=new bbe;a&&this.resultTextModelDiffs.removeDiffs(a,n,c);const{edit:d,effectiveState:l}=e.getEditForBase(t);r.accepted.set(l,n),r.previousNonDiffingState=void 0,r.computedFromDiffing=!1;const u=r.handledInput1.get(),g=r.handledInput2.get();(!u||!g)&&this.undoRedoService.pushElement(new uWe(this.resultTextModel.uri,new WeakRef(this),new WeakRef(r),u,g),c),d&&(this.resultTextModel.pushStackElement(),this.resultTextModelDiffs.applyEditRelativeToOriginal(d,n,c),this.resultTextModel.pushStackElement()),r.handledInput1.set(!0,n),r.handledInput2.set(!0,n)}resetDirtyConflictsToBase(){ys(e=>{this.resultTextModel.pushStackElement();for(const t of this.modifiedBaseRanges.get())this.getState(t).get().kind===Wi.unrecognized&&this.setState(t,Zs.base,!1,e,!1);this.resultTextModel.pushStackElement()})}isHandled(e){return this.modifiedBaseRangeResultStates.get().get(e).handled}isInputHandled(e,t){const i=this.modifiedBaseRangeResultStates.get().get(e);return t===1?i.handledInput1:i.handledInput2}setInputHandled(e,t,i,n){const o=this.modifiedBaseRangeResultStates.get().get(e);if(o.handled.get()===i)return;const r=new WeakRef(CJ),a=new WeakRef(this);this.undoRedoService.pushElement({type:Wq.Resource,resource:this.resultTextModel.uri,code:"setInputHandled",label:h(8069,"Set Input Handled"),redo(){const c=a.deref(),d=r.deref();c&&!c.isDisposed()&&d&&ys(l=>{t===1?o.handledInput1.set(i,l):o.handledInput2.set(i,l)})},undo(){const c=a.deref(),d=r.deref();c&&!c.isDisposed()&&d&&ys(l=>{t===1?o.handledInput1.set(!i,l):o.handledInput2.set(!i,l)})}}),t===1?o.handledInput1.set(i,n):o.handledInput2.set(i,n)}setHandled(e,t,i){const n=this.modifiedBaseRangeResultStates.get().get(e);n.handled.get()!==t&&(n.handledInput1.set(t,i),n.handledInput2.set(t,i))}setLanguageId(e,t){const i=this.languageService.createById(e);this.base.setLanguage(i,t),this.input1.textModel.setLanguage(i,t),this.input2.textModel.setLanguage(i,t),this.resultTextModel.setLanguage(i,t)}getInitialResultValue(){const e=[];for(;;){const t=this.resultSnapshot.read();if(t===null)break;e.push(t)}return e.join()}async getResultValueWithConflictMarkers(){if(await Rk(this.diffComputingState,c=>c===Lc.upToDate),this.unhandledConflictsCount.get()===0)return this.resultTextModel.getValue();const e=this.resultTextModel.getLinesContent(),t=this.input1.textModel.getLinesContent(),i=this.input2.textModel.getLinesContent(),n=this.modifiedBaseRangeResultStates.get(),o=[];function r(c,d){for(let l=d.startLineNumber;l<d.endLineNumberExclusive;l++)o.push(c[l-1])}let a=1;for(const[c,d]of n){if(d.handled.get())continue;const l=this.resultTextModelDiffs.getResultLineRange(c.baseRange);r(e,Us.fromLineNumbers(a,Math.max(a,l.startLineNumber))),a=l.endLineNumberExclusive,o.push("<<<<<<<"),d.accepted.get().kind===Wi.unrecognized?r(e,l):r(t,c.input1Range),o.push("======="),r(i,c.input2Range),o.push(">>>>>>>")}return r(e,Us.fromLineNumbers(a,e.length+1)),o.join(`
`)}get conflictCount(){return Ur(this.modifiedBaseRanges.get(),e=>e.isConflicting)}get combinableConflictCount(){return Ur(this.modifiedBaseRanges.get(),e=>e.isConflicting&&e.canBeCombined)}get conflictsResolvedWithBase(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.base)}get conflictsResolvedWithInput1(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.input1)}get conflictsResolvedWithInput2(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.input2)}get conflictsResolvedWithSmartCombination(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.both&&i.smartCombination})}get manuallySolvedConflictCountThatEqualNone(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.unrecognized)}get manuallySolvedConflictCountThatEqualSmartCombine(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===Wi.both&&i.smartCombination})}get manuallySolvedConflictCountThatEqualInput1(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===Wi.input1})}get manuallySolvedConflictCountThatEqualInput2(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===Wi.input2})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBase(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.base})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.input1})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.input2})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.both&&!t.previousNonDiffingState?.smartCombination})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart(){return Ur(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.both&&t.previousNonDiffingState?.smartCombination})}};gL=f([p(7,fi),p(8,HM)],gL);function Ur(s,e){let t=0;for(const i of s)e(i)&&t++;return t}class CJ{constructor(e){this.baseRange=e,this.accepted=oi(`BaseRangeState${this.baseRange.baseRange}`,Zs.base),this.handledInput1=oi(`BaseRangeHandledState${this.baseRange.baseRange}.Input1`,!1),this.handledInput2=oi(`BaseRangeHandledState${this.baseRange.baseRange}.Input2`,!1),this.computedFromDiffing=!1,this.previousNonDiffingState=void 0,this.handled=fe(this,t=>this.handledInput1.read(t)&&this.handledInput2.read(t))}}var Lc;(function(s){s[s.initializing=1]="initializing",s[s.upToDate=2]="upToDate",s[s.updating=3]="updating"})(Lc||(Lc={}));class uWe{constructor(e,t,i,n,o){this.resource=e,this.mergeEditorModelRef=t,this.stateRef=i,this.input1Handled=n,this.input2Handled=o,this.code="undoMarkAsHandled",this.label=h(8070,"Undo Mark As Handled"),this.type=Wq.Resource}redo(){const e=this.mergeEditorModelRef.deref();if(!e||e.isDisposed())return;const t=this.stateRef.deref();t&&ys(i=>{t.handledInput1.set(!0,i),t.handledInput2.set(!0,i)})}undo(){const e=this.mergeEditorModelRef.deref();if(!e||e.isDisposed())return;const t=this.stateRef.deref();t&&ys(i=>{t.handledInput1.set(this.input1Handled,i),t.handledInput2.set(this.input2Handled,i)})}}const QJe=new O("isMergeEditor",!1,{type:"boolean",description:h(8122,"The editor is a merge editor")}),XJe=new O("isMergeResultEditor",!1,{type:"boolean",description:h(8123,"The editor is a the result editor of a merge editor.")}),ZJe=new O("mergeEditorLayout","mixed",{type:"string",description:h(8124,"The layout mode of a merge editor")}),JJe=new O("mergeEditorShowBase",!1,{type:"boolean",description:h(8125,"If the merge editor shows the base version")}),eet=new O("mergeEditorShowBaseAtTop",!1,{type:"boolean",description:h(8126,"If base should be shown at the top")}),tet=new O("mergeEditorShowNonConflictingChanges",!1,{type:"boolean",description:h(8127,"If the merge editor shows non-conflicting changes")}),iet=new O("mergeEditorBaseUri","",{type:"string",description:h(8128,"The uri of the baser of a merge editor")}),net=new O("mergeEditorResultUri","",{type:"string",description:h(8129,"The uri of the result of a merge editor")}),EJ="mergeEditorCloseWithConflicts";var Y2;let Q2=class{constructor(e,t,i,n){this._mergeEditorTelemetry=e,this._instantiationService=t,this._textModelService=i,this._modelService=n}async createInputModel(e){const t=new U,[i,n,o,r]=await Promise.all([this._textModelService.createModelReference(e.base),this._textModelService.createModelReference(e.result),pL(e.input1,this._textModelService,t),pL(e.input2,this._textModelService,t)]);t.add(i),t.add(n);const a=n.object.textEditorModel.uri.with({scheme:"merge-result"}),c=this._modelService.createModel("",{languageId:n.object.textEditorModel.getLanguageId(),onDidChange:D.None},a);t.add(c);const d=this._instantiationService.createInstance(uL),l=this._instantiationService.createInstance(gL,i.object.textEditorModel,o,r,c,d,{resetResult:!0},this._mergeEditorTelemetry);return t.add(l),await l.onInitialized,this._instantiationService.createInstance(X2,l,t,n.object,e.result)}};Q2=f([p(1,J),p(2,yi),p(3,ai)],Q2);let X2=class extends Bv{constructor(e,t,i,n,o,r,a){super(),this.model=e,this.disposable=t,this.result=i,this.resultUri=n,this.textFileService=o,this.dialogService=r,this.editorService=a,this.savedAltVersionId=oi(this,this.model.resultTextModel.getAlternativeVersionId()),this.altVersionId=On(this,c=>this.model.resultTextModel.onDidChangeContent(c),()=>this.model.resultTextModel.getAlternativeVersionId()),this.isDirty=fe(this,c=>this.altVersionId.read(c)!==this.savedAltVersionId.read(c)),this.finished=!1}dispose(){this.disposable.dispose(),super.dispose()}async accept(){const e=await this.model.resultTextModel.getValue();this.result.textEditorModel.setValue(e),this.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(),void 0),await this.textFileService.save(this.result.textEditorModel.uri),this.finished=!0}async _discard(){await this.textFileService.revert(this.model.resultTextModel.uri),this.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(),void 0),this.finished=!0}shouldConfirmClose(){return!0}async confirmClose(e){aI(()=>e.some(n=>n===this));const t=e.some(n=>n.isDirty.get());let i;if(t){const n=e.length>1,o=n?h(8040,"Do you want keep the merge result of {0} files?",e.length):h(8041,"Do you want keep the merge result of {0}?",je(e[0].model.resultTextModel.uri)),r=e.some(c=>c.model.hasUnhandledConflicts.get()),a=[{label:r?h(8042,"&&Save With Conflicts"):h(8043,"&&Save"),run:()=>zi.SAVE},{label:h(8044,"Do&&n't Save"),run:()=>zi.DONT_SAVE}];i=(await this.dialogService.prompt({type:Me.Info,message:o,detail:r?n?h(8045,"The files contain unhandled conflicts. The merge results will be lost if you don't save them."):h(8046,"The file contains unhandled conflicts. The merge result will be lost if you don't save it."):n?h(8047,"The merge results will be lost if you don't save them."):h(8048,"The merge result will be lost if you don't save it."),buttons:a,cancelButton:{run:()=>zi.CANCEL}})).result}else i=zi.DONT_SAVE;return i===zi.SAVE?await Promise.all(e.map(n=>n.accept())):i===zi.DONT_SAVE&&await Promise.all(e.map(n=>n._discard())),i}async save(e){this.finished||(async()=>{const{confirmed:t}=await this.dialogService.confirm({message:h(8049,"Do you want to accept the merge result?"),detail:h(8050,"This will write the merge result to the original file and close the merge editor."),primaryButton:h(8051,"&&Accept Merge")});if(t){await this.accept();const i=this.editorService.findEditors(this.resultUri).filter(n=>n.editor.typeId==="mergeEditor.Input");await this.editorService.closeEditors(i)}})()}async revert(e){}};X2=f([p(4,Ds),p(5,Qt),p(6,de)],X2);let Z2=class{static{Y2=this}constructor(e,t,i,n,o,r){this._mergeEditorTelemetry=e,this._instantiationService=t,this._textModelService=i,this.textFileService=n,this._modelService=o,this._languageService=r}static{this.FILE_SAVED_SOURCE=TCe.registerSource("merge-editor.source",h(8052,"Before Resolving Conflicts In Merge Editor"))}async createInputModel(e){const t=new U;let i;const n=t.add(new U),o=y=>{Dt(e.result,y.resource)&&(n.clear(),i=y)};n.add(this.textFileService.files.onDidCreate(o)),this.textFileService.files.models.forEach(o);let[r,a,c,d]=await Promise.all([this._textModelService.createModelReference(e.base).then(y=>({object:y.object.textEditorModel,dispose:()=>y.dispose()})).catch(y=>{mt(y),console.error(y)}),this._textModelService.createModelReference(e.result),pL(e.input1,this._textModelService,t),pL(e.input2,this._textModelService,t)]);if(r===void 0){const y=this._modelService.createModel("",this._languageService.createById(a.object.getLanguageId()));r={dispose:()=>{y.dispose()},object:y}}if(t.add(r),t.add(a),!i)throw new ln;await i.save({source:Y2.FILE_SAVED_SOURCE});const g=i.textEditorModel.getLinesContent().some(y=>y.startsWith(JFe.start)),m=this._instantiationService.createInstance(uL),v=this._instantiationService.createInstance(gL,r.object,c,d,a.object.textEditorModel,m,{resetResult:g},this._mergeEditorTelemetry);return t.add(v),await v.onInitialized,this._instantiationService.createInstance(J2,v,t,i,this._mergeEditorTelemetry)}};Z2=Y2=f([p(1,J),p(2,yi),p(3,Ds),p(4,ai),p(5,fi)],Z2);let J2=class extends Bv{constructor(e,t,i,n,o,r){super(),this.model=e,this.disposableStore=t,this.resultTextFileModel=i,this.telemetry=n,this._dialogService=o,this._storageService=r,this.isDirty=On(this,D.any(this.resultTextFileModel.onDidChangeDirty,this.resultTextFileModel.onDidSaveError),()=>this.resultTextFileModel.isDirty()),this.reported=!1,this.dateTimeOpened=new Date}dispose(){this.disposableStore.dispose(),super.dispose(),this.reportClose(!1)}reportClose(e){if(!this.reported){const t=this.model.unhandledConflictsCount.get(),i=new Date().getTime()-this.dateTimeOpened.getTime();this.telemetry.reportMergeEditorClosed({durationOpenedSecs:i/1e3,remainingConflictCount:t,accepted:e,conflictCount:this.model.conflictCount,combinableConflictCount:this.model.combinableConflictCount,conflictsResolvedWithBase:this.model.conflictsResolvedWithBase,conflictsResolvedWithInput1:this.model.conflictsResolvedWithInput1,conflictsResolvedWithInput2:this.model.conflictsResolvedWithInput2,conflictsResolvedWithSmartCombination:this.model.conflictsResolvedWithSmartCombination,manuallySolvedConflictCountThatEqualNone:this.model.manuallySolvedConflictCountThatEqualNone,manuallySolvedConflictCountThatEqualSmartCombine:this.model.manuallySolvedConflictCountThatEqualSmartCombine,manuallySolvedConflictCountThatEqualInput1:this.model.manuallySolvedConflictCountThatEqualInput1,manuallySolvedConflictCountThatEqualInput2:this.model.manuallySolvedConflictCountThatEqualInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBase:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBase,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart}),this.reported=!0}}async accept(){this.reportClose(!0),await this.resultTextFileModel.save()}get resultUri(){return this.resultTextFileModel.resource}async save(e){await this.resultTextFileModel.save(e)}async revert(e){await this.resultTextFileModel.revert(e)}shouldConfirmClose(){return!0}async confirmClose(e){const t=e.length>1,i=e.some(o=>o.isDirty.get()),n=e.some(o=>o.model.hasUnhandledConflicts.get());if(i){const o=t?h(8053,"Do you want to save the changes you made to {0} files?",e.length):h(8054,"Do you want to save the changes you made to {0}?",je(e[0].resultUri)),{result:r}=await this._dialogService.prompt({type:Me.Info,message:o,detail:n?t?h(8055,"The files contain unhandled conflicts. Your changes will be lost if you don't save them."):h(8056,"The file contains unhandled conflicts. Your changes will be lost if you don't save them."):t?h(8057,"Your changes will be lost if you don't save them."):h(8058,"Your changes will be lost if you don't save them."),buttons:[{label:n?h(8059,"&&Save with Conflicts"):h(8060,"&&Save"),run:()=>zi.SAVE},{label:h(8061,"Do&&n't Save"),run:()=>zi.DONT_SAVE}],cancelButton:{run:()=>zi.CANCEL}});return r}else if(n&&!this._storageService.getBoolean(EJ,he.PROFILE,!1)){const{confirmed:o,checkboxChecked:r}=await this._dialogService.confirm({message:t?h(8062,"Do you want to close {0} merge editors?",e.length):h(8063,"Do you want to close the merge editor for {0}?",je(e[0].resultUri)),detail:n?t?h(8064,"The files contain unhandled conflicts."):h(8065,"The file contains unhandled conflicts."):void 0,primaryButton:n?h(8066,"&&Close with Conflicts"):h(8067,"&&Close"),checkbox:{label:h(8068,"Do not ask me again")}});return r&&this._storageService.store(EJ,!0,he.PROFILE,pt.USER),o?zi.SAVE:zi.CANCEL}else return zi.SAVE}};J2=f([p(4,Qt),p(5,tt)],J2);async function pL(s,e,t){const i=await e.createModelReference(s.uri);return t.add(i),{textModel:i.object.textEditorModel,title:s.title,description:s.description,detail:s.detail}}let e$=class{constructor(e){this.telemetryService=e}reportMergeEditorOpened(e){this.telemetryService.publicLog2("mergeEditor.opened",{conflictCount:e.conflictCount,combinableConflictCount:e.combinableConflictCount,baseVisible:e.baseVisible,isColumnView:e.isColumnView,baseTop:e.baseTop})}reportLayoutChange(e){this.telemetryService.publicLog2("mergeEditor.layoutChanged",{baseVisible:e.baseVisible,isColumnView:e.isColumnView,baseTop:e.baseTop})}reportMergeEditorClosed(e){this.telemetryService.publicLog2("mergeEditor.closed",{conflictCount:e.conflictCount,combinableConflictCount:e.combinableConflictCount,durationOpenedSecs:e.durationOpenedSecs,remainingConflictCount:e.remainingConflictCount,accepted:e.accepted,conflictsResolvedWithBase:e.conflictsResolvedWithBase,conflictsResolvedWithInput1:e.conflictsResolvedWithInput1,conflictsResolvedWithInput2:e.conflictsResolvedWithInput2,conflictsResolvedWithSmartCombination:e.conflictsResolvedWithSmartCombination,manuallySolvedConflictCountThatEqualNone:e.manuallySolvedConflictCountThatEqualNone,manuallySolvedConflictCountThatEqualSmartCombine:e.manuallySolvedConflictCountThatEqualSmartCombine,manuallySolvedConflictCountThatEqualInput1:e.manuallySolvedConflictCountThatEqualInput1,manuallySolvedConflictCountThatEqualInput2:e.manuallySolvedConflictCountThatEqualInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBase:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBase,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart})}reportAcceptInvoked(e,t){this.telemetryService.publicLog2("mergeEditor.action.accept",{otherAccepted:t,isInput1:e===1})}reportSmartCombinationInvoked(e){this.telemetryService.publicLog2("mergeEditor.action.smartCombination",{otherAccepted:e})}reportRemoveInvoked(e,t){this.telemetryService.publicLog2("mergeEditor.action.remove",{otherAccepted:t,isInput1:e===1})}reportResetToBaseInvoked(){this.telemetryService.publicLog2("mergeEditor.action.resetToBase",{})}reportNavigationToNextConflict(){this.telemetryService.publicLog2("mergeEditor.action.goToNextConflict",{})}reportNavigationToPreviousConflict(){this.telemetryService.publicLog2("mergeEditor.action.goToPreviousConflict",{})}reportConflictCounterClicked(){this.telemetryService.publicLog2("mergeEditor.action.conflictCounterClicked",{})}};e$=f([p(0,li)],e$);var ZS;class det{constructor(e,t,i,n){this.uri=e,this.title=t,this.detail=i,this.description=n}}let t$=class extends Zd{static{ZS=this}static{this.ID="mergeEditor.Input"}get useWorkingCopy(){return this.configurationService.getValue("mergeEditor.useWorkingCopy")??!1}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(n,void 0,r,a,c,d,u,g,m),this.base=e,this.input1=t,this.input2=i,this.result=n,this._instaService=o,this.configurationService=l,this.logService=v,this._focusedEditor="result",this.closeHandler={showConfirm:()=>this._inputModel?.shouldConfirmClose()??!1,confirm:async y=>{aI(()=>y.every(C=>C.editor instanceof ZS));const w=y.map(C=>C.editor._inputModel).filter(ya);return await this._inputModel.confirmClose(w)}},this.mergeEditorModeFactory=this._instaService.createInstance(this.useWorkingCopy?Q2:Z2,this._instaService.createInstance(e$))}dispose(){super.dispose()}get typeId(){return ZS.ID}get editorId(){return od.id}get capabilities(){let e=super.capabilities|Ze.MultipleEditors;return this.useWorkingCopy&&(e|=Ze.Untitled),e}getName(){return h(8036,"Merging: {0}",super.getName())}async resolve(){if(!this._inputModel){const e=this._register(await this.mergeEditorModeFactory.createInputModel({base:this.base,input1:this.input1,input2:this.input2,result:this.result}));this._inputModel=e,this._register(ki(t=>{e.isDirty.read(t),this._onDidChangeDirty.fire()})),await this._inputModel.model.onInitialized}return this._inputModel}async accept(){await this._inputModel?.accept()}async save(e,t){await this._inputModel?.save(t)}toUntyped(){return{input1:{resource:this.input1.uri,label:this.input1.title,description:this.input1.description,detail:this.input1.detail},input2:{resource:this.input2.uri,label:this.input2.title,description:this.input2.description,detail:this.input2.detail},base:{resource:this.base},result:{resource:this.result},options:{override:this.typeId}}}matches(e){return this===e?!0:e instanceof ZS?Dt(this.base,e.base)&&Dt(this.input1.uri,e.input1.uri)&&Dt(this.input2.uri,e.input2.uri)&&Dt(this.result,e.result):_C(e)?(this.editorId===e.options?.override||e.options?.override===void 0)&&Dt(this.base,e.base.resource)&&Dt(this.input1.uri,e.input1.resource)&&Dt(this.input2.uri,e.input2.resource)&&Dt(this.result,e.result.resource):!1}async revert(e,t){return this._inputModel?.revert(t)}isDirty(){return this._inputModel?.isDirty.get()??!1}setLanguageId(e,t){this._inputModel?.model.setLanguageId(e,t)}updateFocusedEditor(e){this._focusedEditor!==e&&(this._focusedEditor=e,this.logService.trace("alertFocusedEditor",e),gWe(e))}};t$=ZS=f([p(4,J),p(5,de),p(6,Ds),p(7,di),p(8,Xe),p(9,ne),p(10,Ns),p(11,Xo),p(12,wg),p(13,Pe)],t$);function gWe(s){switch(s){case"input1":ta(h(8037,"Incoming, Left Input"));break;case"input2":ta(h(8038,"Current, Right Input"));break;case"result":ta(h(8039,"Merge Result"));break}}const pWe=Ae("multi-diff-editor-label-icon",j.diffMultiple,h(8133,"Icon of the multi diff editor label."));class xJ{constructor(e,t,i,n){if(this.originalUri=e,this.modifiedUri=t,this.goToFileUri=i,this.contextKeys=n,!e&&!t)throw new ln("Invalid arguments")}getKey(){return JSON.stringify([this.modifiedUri?.toString(),this.originalUri?.toString()])}}var M_;let zb=class extends gl{static{M_=this}static fromResourceMultiDiffEditorInput(e,t){if(!e.multiDiffSource&&!e.resources)throw new ln("MultiDiffEditorInput requires either multiDiffSource or resources");const i=e.multiDiffSource??R.parse(`multi-diff-editor:${new Date().getMilliseconds().toString()+Math.random().toString()}`);return t.createInstance(M_,i,e.label,e.resources?.map(n=>new xJ(n.original.resource,n.modified.resource,n.goToFileResource)),e.isTransient??!1)}static fromSerialized(e,t){return t.createInstance(M_,R.parse(e.multiDiffSourceUri),e.label,e.resources?.map(i=>new xJ(i.originalUri?R.parse(i.originalUri):void 0,i.modifiedUri?R.parse(i.modifiedUri):void 0,i.goToFileUri?R.parse(i.goToFileUri):void 0)),!1)}static{this.ID="workbench.input.multiDiffEditor"}get resource(){return this.multiDiffSource}get capabilities(){return Ze.Readonly}get typeId(){return M_.ID}getName(){return this._name}get editorId(){return od.id}getIcon(){return pWe}constructor(e,t,i,n=!1,o,r,a,c,d){super(),this.multiDiffSource=e,this.label=t,this.initialResources=i,this.isTransient=n,this._textModelService=o,this._textResourceConfigurationService=r,this._instantiationService=a,this._multiDiffSourceResolverService=c,this._textFileService=d,this._name="",this._viewModel=new ybe(async()=>{const l=await this._createModel();this._register(l);const u=new ESe(l,this._instantiationService);return this._register(u),await Bq(u.waitForDiffs(),1e3),u}),this._resolvedSource=new wbe(async()=>{const l=this.initialResources?{resources:Sbe.const(this.initialResources)}:await this._multiDiffSourceResolverService.resolve(this.multiDiffSource);return{source:l,resources:l?xSe(this,l.resources):Fi([])}}),this.resources=fe(this,l=>this._resolvedSource.cachedPromiseResult.read(l)?.data?.resources.read(l)),this.textFileServiceOnDidChange=new fWe(this._textFileService.files.onDidChangeDirty,l=>l.resource.toString(),l=>l.toString()),this._isDirtyObservables=ZT(this,this.resources.map(l=>l??[]),l=>{const u=l.modifiedUri?IJ(this.textFileServiceOnDidChange,this._textFileService,l.modifiedUri):Fi(!1),g=l.originalUri?IJ(this.textFileServiceOnDidChange,this._textFileService,l.originalUri):Fi(!1);return fe(m=>u.read(m)||g.read(m))},l=>l.getKey()),this._isDirtyObservable=fe(this,l=>this._isDirtyObservables.read(l).some(u=>u.read(l))).keepObserved(this._store),this.onDidChangeDirty=D.fromObservableLight(this._isDirtyObservable),this.closeHandler={async confirm(){return zi.DONT_SAVE},showConfirm(){return!1}},this._register(ki(l=>{const u=this.resources.read(l),g=this.label??h(8135,"Multi Diff Editor");u&&u.length===1?this._name=h(8136,"{0} (1 file)",g):u?this._name=h(8137,"{0} ({1} files)",g,u.length):this._name=g,this._onDidChangeLabel.fire()}))}serialize(){return{label:this.label,multiDiffSourceUri:this.multiDiffSource.toString(),resources:this.initialResources?.map(e=>({originalUri:e.originalUri?.toString(),modifiedUri:e.modifiedUri?.toString(),goToFileUri:e.goToFileUri?.toString()}))}}setLanguageId(e,t){const n=this._viewModel.requireValue().activeDiffItem.get()?.documentDiffItem;if(!n)return;const o=n.modified??n.original;o&&o.setLanguage(e,t)}async getViewModel(){return this._viewModel.getPromise()}async _createModel(){const e=await this._resolvedSource.getPromise(),t=this._textResourceConfigurationService,i=ZT(this,e.resources,async(c,d)=>{let l,u;const g=new U;try{[l,u]=await Promise.all([c.originalUri?this._textModelService.createModelReference(c.originalUri):void 0,c.modifiedUri?this._textModelService.createModelReference(c.modifiedUri):void 0]),l&&g.add(l),u&&g.add(u)}catch(y){console.error(y),mt(y);return}const m=c.modifiedUri??c.originalUri,v={multiDiffEditorItem:c,original:l?.object.textEditorModel,modified:u?.object.textEditorModel,contextKeys:c.contextKeys,get options(){return{...mWe(u?.object.isReadonly()??!0),...vWe(t.getValue(m))}},onOptionsDidChange:y=>this._textResourceConfigurationService.onDidChangeConfiguration(w=>{(w.affectsConfiguration(m,"editor")||w.affectsConfiguration(m,"diffEditor"))&&y()})};return d.add(DSe.createOfNonDisposable(v,g,this))},c=>JSON.stringify([c.modifiedUri?.toString(),c.originalUri?.toString()])),n=oi("documents","loading"),o=fe(async c=>{const d=i.read(c),u=(await Promise.all(d)).filter(ya);n.set(u,void 0)}),r=Une(o);return await o.get(),{dispose:()=>r.dispose(),documents:new ISe(n),contextKeys:e.source?.contextKeys}}matches(e){return super.matches(e)?!0:e instanceof M_?this.multiDiffSource.toString()===e.multiDiffSource.toString():!1}isDirty(){return this._isDirtyObservable.get()}async save(e,t){return await this.doSaveOrRevert("save",e,t),this}revert(e,t){return this.doSaveOrRevert("revert",e,t)}async doSaveOrRevert(e,t,i){const n=this._viewModel.currentValue?.items.get();n&&await Promise.all(n.map(async o=>{const r=o.diffEditorViewModel.model,a=r.original.uri.scheme!==ae.untitled&&this._textFileService.isDirty(r.original.uri);await Promise.all([a?e==="save"?this._textFileService.save(r.original.uri,i):this._textFileService.revert(r.original.uri,i):Promise.resolve(),e==="save"?this._textFileService.save(r.modified.uri,i):this._textFileService.revert(r.modified.uri,i)])}))}};zb=M_=f([p(4,yi),p(5,Xo),p(6,J),p(7,hre),p(8,Ds)],zb);class fWe{constructor(e,t,i){this._event=e,this._getEventArgsKey=t,this._keyToString=i,this._count=0,this._buckets=new Map,this._handleEventChange=n=>{const o=this._getEventArgsKey(n),r=this._buckets.get(o);if(r)for(const a of r)a(n)}}filteredEvent(e){return t=>{const i=this._keyToString(e);let n=this._buckets.get(i);return n||(n=new Set,this._buckets.set(i,n)),n.add(t),this._count++,this._count===1&&(this._eventSubscription=this._event(this._handleEventChange)),{dispose:()=>{n.delete(t),n.size===0&&this._buckets.delete(i),this._count--,this._count===0&&(this._eventSubscription?.dispose(),this._eventSubscription=void 0)}}}}}function IJ(s,e,t){return On(s.filteredEvent(t),()=>e.isDirty(t))}function mWe(s){return{readOnly:!!s,readOnlyMessage:typeof s!="boolean"?s:void 0}}function vWe(s){const e=Cr(s.editor);if(oa(s.diffEditor)){const t=Cr(s.diffEditor);t.diffCodeLens=t.codeLens,delete t.codeLens,t.diffWordWrap=t.wordWrap,delete t.wordWrap,Object.assign(e,t)}return e}let DJ=class extends F{static{this.ID="workbench.contrib.multiDiffEditorResolver"}constructor(e,t){super(),this._register(e.registerEditor("*",{id:od.id,label:od.displayName,detail:od.providerDisplayName,priority:um.builtin},{},{createMultiDiffEditorInput:i=>({editor:zb.fromResourceMultiDiffEditorInput(i,t)})}))}};DJ=f([p(0,vf),p(1,J)],DJ);H("terminal.background",null,h(10547,"The background color of the terminal, this allows coloring the terminal differently to the panel."));H("terminal.foreground",{light:"#333333",dark:"#CCCCCC",hcDark:"#FFFFFF",hcLight:"#292929"},h(10548,"The foreground color of the terminal."));H("terminalCursor.foreground",null,h(10549,"The foreground color of the terminal cursor."));H("terminalCursor.background",null,h(10550,"The background color of the terminal cursor. Allows customizing the color of a character overlapped by a block cursor."));const ik=H("terminal.selectionBackground",fne,h(10551,"The selection background color of the terminal."));H("terminal.inactiveSelectionBackground",{light:Je(ik,.5),dark:Je(ik,.5),hcDark:Je(ik,.7),hcLight:Je(ik,.5)},h(10552,"The selection background color of the terminal when it does not have focus."));H("terminal.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:"#ffffff"},h(10553,"The selection foreground color of the terminal. When this is null the selection foreground will be retained and have the minimum contrast ratio feature applied."));H("terminalCommandDecoration.defaultBackground",{light:"#00000040",dark:"#ffffff40",hcDark:"#ffffff80",hcLight:"#00000040"},h(10554,"The default terminal command decoration background color."));H("terminalCommandDecoration.successBackground",{dark:"#1B81A8",light:"#2090D3",hcDark:"#1B81A8",hcLight:"#007100"},h(10555,"The terminal command decoration background color for successful commands."));H("terminalCommandDecoration.errorBackground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F14C4C",hcLight:"#B5200D"},h(10556,"The terminal command decoration background color for error commands."));H("terminalOverviewRuler.cursorForeground","#A0A0A0CC",h(10557,"The overview ruler cursor color."));H("terminal.border",UE,h(10558,"The color of the border that separates split panes within the terminal. This defaults to panel.border."));H("terminalOverviewRuler.border",Cbe,h(10559,"The overview ruler left-side border color."));H("terminal.findMatchBackground",{dark:N7,light:N7,hcDark:null,hcLight:"#0F4A85"},h(10560,"Color of the current search match in the terminal. The color must not be opaque so as not to hide underlying terminal content."),!0);H("terminal.hoverHighlightBackground",Je(Ebe,.5),h(10561,"Border color of the other search matches in the terminal."));H("terminal.findMatchBorder",{dark:null,light:null,hcDark:"#f38518",hcLight:"#0F4A85"},h(10562,"Border color of the current search match in the terminal."));H("terminal.findMatchHighlightBackground",{dark:BF,light:BF,hcDark:null,hcLight:null},h(10563,"Color of the other search matches in the terminal. The color must not be opaque so as not to hide underlying terminal content."),!0);H("terminal.findMatchHighlightBorder",{dark:null,light:null,hcDark:"#f38518",hcLight:"#0F4A85"},h(10561,"Border color of the other search matches in the terminal."));H("terminalOverviewRuler.findMatchForeground",{dark:pC,light:pC,hcDark:"#f38518",hcLight:"#0F4A85"},h(10564,"Overview ruler marker color for find matches in the terminal."));H("terminal.dropBackground",TN,h(10565,"Background color when dragging on top of terminals. The color should have transparency so that the terminal contents can still shine through."),!0);H("terminal.tab.activeBorder",DA,h(10566,"Border on the side of the terminal tab in the panel. This defaults to tab.activeBorder."));H("terminal.initialHintForeground",{dark:"#ffffff56",light:"#0007",hcDark:null,hcLight:null},h(10567,"Foreground color of the terminal initial hint."));function _We(s){let e;if(typeof s=="string"?e=s:s.color?e=s.color.replace(/\./g,"_"):Te.isThemeIcon(s.icon)&&s.icon.color&&(e=s.icon.color.id.replace(/\./g,"_")),e)return`terminal-icon-${e.replace(/\./g,"_")}`}function bWe(s,e,t){const i=s.icon;if(!i)return;const n=[];let o;if(i instanceof R?o=i:i instanceof Object&&"light"in i&&"dark"in i&&(o=e===yk.LIGHT?i.light:i.dark),o instanceof R){const a=`terminal-uri-icon-${cc(o.path).toString(36)}`;n.push(a),n.push("terminal-uri-icon")}return n}var i$;(function(s){s.FocusAccessibleBuffer="workbench.action.terminal.focusAccessibleBuffer",s.AccessibleBufferGoToNextCommand="workbench.action.terminal.accessibleBufferGoToNextCommand",s.AccessibleBufferGoToPreviousCommand="workbench.action.terminal.accessibleBufferGoToPreviousCommand",s.ScrollToBottomAccessibleView="workbench.action.terminal.scrollToBottomAccessibleView",s.ScrollToTopAccessibleView="workbench.action.terminal.scrollToTopAccessibleView"})(i$||(i$={}));const yWe=[i$.FocusAccessibleBuffer];var fL;(function(s){s.AccessibleViewPreserveCursorPosition="terminal.integrated.accessibleViewPreserveCursorPosition",s.AccessibleViewFocusOnCommandExecution="terminal.integrated.accessibleViewFocusOnCommandExecution"})(fL||(fL={}));fL.AccessibleViewPreserveCursorPosition+"",h(10791,"Preserve the cursor position on reopen of the terminal's accessible view rather than setting it to the bottom of the buffer."),fL.AccessibleViewFocusOnCommandExecution+"",h(10792,"Focus the terminal accessible view when a command is executed.");var n$;(function(s){s.AutoReplies="terminal.integrated.autoReplies"})(n$||(n$={}));n$.AutoReplies+"",h(10793,`A set of messages that, when encountered in the terminal, will be automatically responded to. Provided the message is specific enough, this can help automate away common responses.

Remarks:

- Use {0} to automatically respond to the terminate batch job prompt on Windows.
- The message includes escape sequences so the reply might not happen with styled text.
- Each reply can only happen once every second.
- Use {1} in the reply to mean the enter key.
- To unset a default key, set the value to null.
- Restart VS Code if new don't apply.`,'`"Terminate batch job (Y/N)": "Y\\r"`','`"\\r"`'),h(10794,"The reply to send to the process.");var s$;(function(s){s.Enabled="terminal.integrated.initialHint"})(s$||(s$={}));s$.Enabled+"",h(10836,"Controls if the first terminal without input will show a hint about available actions when it is focused.");var o$;(function(s){s.ShowCommandGuide="terminal.integrated.shellIntegration.showCommandGuide"})(o$||(o$={}));o$.ShowCommandGuide+"",h(10851,"Whether to show the command guide when hovering over a command in the terminal.");var Kl;(function(s){s.FindFocus="workbench.action.terminal.focusFind",s.FindHide="workbench.action.terminal.hideFind",s.FindNext="workbench.action.terminal.findNext",s.FindPrevious="workbench.action.terminal.findPrevious",s.ToggleFindRegex="workbench.action.terminal.toggleFindRegex",s.ToggleFindWholeWord="workbench.action.terminal.toggleFindWholeWord",s.ToggleFindCaseSensitive="workbench.action.terminal.toggleFindCaseSensitive",s.SearchWorkspace="workbench.action.terminal.searchWorkspace"})(Kl||(Kl={}));const wWe=[Kl.FindFocus,Kl.FindHide,Kl.FindNext,Kl.FindPrevious,Kl.ToggleFindRegex,Kl.ToggleFindWholeWord,Kl.ToggleFindCaseSensitive,Kl.SearchWorkspace];var mL;(function(s){s.ClearPreviousSessionHistory="workbench.action.terminal.clearPreviousSessionHistory",s.GoToRecentDirectory="workbench.action.terminal.goToRecentDirectory",s.RunRecentCommand="workbench.action.terminal.runRecentCommand"})(mL||(mL={}));const SWe=[mL.GoToRecentDirectory,mL.RunRecentCommand];var r$;(function(s){s.ShellIntegrationCommandHistory="terminal.integrated.shellIntegration.history"})(r$||(r$={}));r$.ShellIntegrationCommandHistory+"",h(10882,"Controls the number of recently used commands to keep in the terminal command history. Set to 0 to disable terminal command history.");var vL;(function(s){s.Enabled="terminal.integrated.stickyScroll.enabled",s.MaxLineCount="terminal.integrated.stickyScroll.maxLineCount"})(vL||(vL={}));vL.Enabled+"",h(10932,"Shows the current command at the top of the terminal. This feature requires [shell integration]({0}) to be activated. See {1}.","https://code.visualstudio.com/docs/terminal/shell-integration",`\`#${qc.ShellIntegrationEnabled}#\``),vL.MaxLineCount+"",h(10933,"Defines the maximum number of sticky lines to show. Sticky scroll lines will never exceed 40% of the viewport regardless of this setting.");var Mc;(function(s){s.SelectPrevSuggestion="workbench.action.terminal.selectPrevSuggestion",s.SelectPrevPageSuggestion="workbench.action.terminal.selectPrevPageSuggestion",s.SelectNextSuggestion="workbench.action.terminal.selectNextSuggestion",s.SelectNextPageSuggestion="workbench.action.terminal.selectNextPageSuggestion",s.AcceptSelectedSuggestion="workbench.action.terminal.acceptSelectedSuggestion",s.AcceptSelectedSuggestionEnter="workbench.action.terminal.acceptSelectedSuggestionEnter",s.HideSuggestWidget="workbench.action.terminal.hideSuggestWidget",s.HideSuggestWidgetAndNavigateHistory="workbench.action.terminal.hideSuggestWidgetAndNavigateHistory",s.RequestCompletions="workbench.action.terminal.requestCompletions",s.ResetWidgetSize="workbench.action.terminal.resetSuggestWidgetSize",s.ToggleDetails="workbench.action.terminal.suggestToggleDetails",s.ToggleDetailsFocus="workbench.action.terminal.suggestToggleDetailsFocus",s.ConfigureSettings="workbench.action.terminal.configureSuggestSettings"})(Mc||(Mc={}));const CWe=[Mc.SelectPrevSuggestion,Mc.SelectPrevPageSuggestion,Mc.SelectNextSuggestion,Mc.SelectNextPageSuggestion,Mc.AcceptSelectedSuggestion,Mc.AcceptSelectedSuggestionEnter,Mc.HideSuggestWidget,Mc.RequestCompletions,Mc.ToggleDetails,Mc.ToggleDetailsFocus];var Ba;(function(s){s.Enabled="terminal.integrated.suggest.enabled",s.QuickSuggestions="terminal.integrated.suggest.quickSuggestions",s.SuggestOnTriggerCharacters="terminal.integrated.suggest.suggestOnTriggerCharacters",s.RunOnEnter="terminal.integrated.suggest.runOnEnter",s.WindowsExecutableExtensions="terminal.integrated.suggest.windowsExecutableExtensions",s.Providers="terminal.integrated.suggest.providers",s.ShowStatusBar="terminal.integrated.suggest.showStatusBar",s.CdPath="terminal.integrated.suggest.cdPath",s.InlineSuggestion="terminal.integrated.suggest.inlineSuggestion",s.UpArrowNavigatesHistory="terminal.integrated.suggest.upArrowNavigatesHistory"})(Ba||(Ba={}));const EWe=["exe","bat","cmd","com","msi","ps1","vbs","js","jar","py","rb","pl","sh"];Ba.Enabled+"",h(10976,`Enables terminal intellisense suggestions (preview) for supported shells ({0}) when {1} is set to {2}.

If shell integration is installed manually, {3} needs to be set to {4} before calling the shell integration script.`,"PowerShell v7+, zsh, bash, fish",`\`#${qc.ShellIntegrationEnabled}#\``,"`true`","`VSCODE_SUGGEST`","`1`"),Ba.Providers+"",h(10977,"Providers are enabled by default. Omit them by setting the id of the provider to `false`."),Ba.QuickSuggestions+"",h(10978,"Controls whether suggestions should automatically show up while typing. Also be aware of the {0}-setting which controls if suggestions are triggered by special characters.",`\`#${Ba.SuggestOnTriggerCharacters}#\``),h(10979,"Enable quick suggestions for commands, the first word in a command line input."),h(10980,"Enable quick suggestions for arguments, anything after the first word in a command line input."),h(10981,"Enable quick suggestions when it's unclear what the best suggestion is, if this is on files and folders will be suggested as a fallback."),Ba.SuggestOnTriggerCharacters+"",h(10982,"Controls whether suggestions should automatically show up when typing trigger characters."),Ba.RunOnEnter+"",h(10983,"Controls whether suggestions should run immediately when `Enter` (not `Tab`) is used to accept the result."),h(10984,"Ignore suggestions and send the enter directly to the shell without completing. This is used as the default value so the suggest widget is as unobtrusive as possible."),h(10985,"Never run on `Enter`."),h(10986,"Run on `Enter` when the suggestion is typed in its entirety."),h(10987,"Run on `Enter` when the suggestion is typed in its entirety or when a file is typed without its extension included."),h(10988,"Always run on `Enter`."),Ba.WindowsExecutableExtensions+"",h(10989,`A set of windows command executable extensions that will be included as suggestions in the terminal.

Many executables are included by default, listed below:

{0}.

To exclude an extension, set it to \`false\`

. To include one not in the list, add it and set it to \`true\`.`,EWe.sort().map(s=>`- ${s}`).join(`
`)),Ba.ShowStatusBar+"",h(10990,"Controls whether the terminal suggestions status bar should be shown."),Ba.CdPath+"",h(10991,"Controls whether to enable $CDPATH support which exposes children of the folders in the $CDPATH variable regardless of the current working directory. $CDPATH is expected to be semi colon-separated on Windows and colon-separated on other platforms."),h(10992,"Disable the feature."),h(10993,"Enable the feature and use relative paths."),h(10994,"Enable the feature and use absolute paths. This is useful when the shell doesn't natively support `$CDPATH`."),Ba.InlineSuggestion+"",h(10995,"Controls whether the shell's inline suggestion should be detected and how it is scored."),h(10996,"Disable the feature."),h(10997,"Enable the feature and sort the inline suggestion without forcing it to be on top. This means that exact matches will be will be above the inline suggestion."),h(10998,"Enable the feature and always put the inline suggestion on top."),Ba.UpArrowNavigatesHistory+"",h(10999,"Determines whether the up arrow key navigates the command history when focus is on the first suggestion and navigation has not yet occurred. When set to false, the up arrow will move focus to the last suggestion instead.");var pb;(function(s){s.LocalEchoLatencyThreshold="terminal.integrated.localEchoLatencyThreshold",s.LocalEchoEnabled="terminal.integrated.localEchoEnabled",s.LocalEchoExcludePrograms="terminal.integrated.localEchoExcludePrograms",s.LocalEchoStyle="terminal.integrated.localEchoStyle"})(pb||(pb={}));pb.LocalEchoLatencyThreshold+"",h(11e3,"Length of network delay, in milliseconds, where local edits will be echoed on the terminal without waiting for server acknowledgement. If '0', local echo will always be on, and if '-1' it will be disabled."),pb.LocalEchoEnabled+"",h(11001,"When local echo should be enabled. This will override {0}","`#terminal.integrated.localEchoLatencyThreshold#`"),h(11002,"Always enabled"),h(11003,"Always disabled"),h(11004,"Enabled only for remote workspaces"),pb.LocalEchoExcludePrograms+"",h(11005,"Local echo will be disabled when any of these program names are found in the terminal title."),pb.LocalEchoStyle+"",h(11006,"Terminal style of locally echoed text; either a font style or an RGB color.");var kJ;(function(s){s.FontZoomIn="workbench.action.terminal.fontZoomIn",s.FontZoomOut="workbench.action.terminal.fontZoomOut",s.FontZoomReset="workbench.action.terminal.fontZoomReset"})(kJ||(kJ={}));var a$;(function(s){s.MouseWheelZoom="terminal.integrated.mouseWheelZoom"})(a$||(a$={}));a$.MouseWheelZoom+"",qt?h(11012,"Zoom the font of the terminal when using mouse wheel and holding `Cmd`."):h(11013,"Zoom the font of the terminal when using mouse wheel and holding `Ctrl`.");var TJ;(function(s){s.A11yFocusAccessibleBuffer="workbench.action.terminal.focusAccessibleBuffer",s.DeveloperRestartPtyHost="workbench.action.terminal.restartPtyHost"})(TJ||(TJ={}));var AJ;(function(s){s.SuggestEnabled="terminal.integrated.suggest.enabled",s.StickyScrollEnabled="terminal.integrated.stickyScroll.enabled"})(AJ||(AJ={}));const xWe=[...yWe,...wWe,...SWe,...CWe],IWe="terminal";var RJ;(function(s){s[s.Uninitialized=1]="Uninitialized",s[s.Launching=2]="Launching",s[s.Running=3]="Running",s[s.KilledDuringLaunch=4]="KilledDuringLaunch",s[s.KilledByUser=5]="KilledByUser",s[s.KilledByProcess=6]="KilledByProcess"})(RJ||(RJ={}));var Pt;(function(s){s.Toggle="workbench.action.terminal.toggleTerminal",s.Kill="workbench.action.terminal.kill",s.KillViewOrEditor="workbench.action.terminal.killViewOrEditor",s.KillEditor="workbench.action.terminal.killEditor",s.KillActiveTab="workbench.action.terminal.killActiveTab",s.KillAll="workbench.action.terminal.killAll",s.QuickKill="workbench.action.terminal.quickKill",s.ConfigureTerminalSettings="workbench.action.terminal.openSettings",s.ShellIntegrationLearnMore="workbench.action.terminal.learnMore",s.CopyLastCommand="workbench.action.terminal.copyLastCommand",s.CopyLastCommandOutput="workbench.action.terminal.copyLastCommandOutput",s.CopyLastCommandAndLastCommandOutput="workbench.action.terminal.copyLastCommandAndLastCommandOutput",s.CopyAndClearSelection="workbench.action.terminal.copyAndClearSelection",s.CopySelection="workbench.action.terminal.copySelection",s.CopySelectionAsHtml="workbench.action.terminal.copySelectionAsHtml",s.SelectAll="workbench.action.terminal.selectAll",s.DeleteWordLeft="workbench.action.terminal.deleteWordLeft",s.DeleteWordRight="workbench.action.terminal.deleteWordRight",s.DeleteToLineStart="workbench.action.terminal.deleteToLineStart",s.MoveToLineStart="workbench.action.terminal.moveToLineStart",s.MoveToLineEnd="workbench.action.terminal.moveToLineEnd",s.New="workbench.action.terminal.new",s.NewWithCwd="workbench.action.terminal.newWithCwd",s.NewLocal="workbench.action.terminal.newLocal",s.NewInActiveWorkspace="workbench.action.terminal.newInActiveWorkspace",s.NewWithProfile="workbench.action.terminal.newWithProfile",s.Split="workbench.action.terminal.split",s.SplitActiveTab="workbench.action.terminal.splitActiveTab",s.SplitInActiveWorkspace="workbench.action.terminal.splitInActiveWorkspace",s.Unsplit="workbench.action.terminal.unsplit",s.JoinActiveTab="workbench.action.terminal.joinActiveTab",s.Join="workbench.action.terminal.join",s.Relaunch="workbench.action.terminal.relaunch",s.FocusPreviousPane="workbench.action.terminal.focusPreviousPane",s.CreateTerminalEditor="workbench.action.createTerminalEditor",s.CreateTerminalEditorSameGroup="workbench.action.createTerminalEditorSameGroup",s.CreateTerminalEditorSide="workbench.action.createTerminalEditorSide",s.FocusTabs="workbench.action.terminal.focusTabs",s.FocusNextPane="workbench.action.terminal.focusNextPane",s.ResizePaneLeft="workbench.action.terminal.resizePaneLeft",s.ResizePaneRight="workbench.action.terminal.resizePaneRight",s.ResizePaneUp="workbench.action.terminal.resizePaneUp",s.SizeToContentWidth="workbench.action.terminal.sizeToContentWidth",s.SizeToContentWidthActiveTab="workbench.action.terminal.sizeToContentWidthActiveTab",s.ResizePaneDown="workbench.action.terminal.resizePaneDown",s.Focus="workbench.action.terminal.focus",s.FocusNext="workbench.action.terminal.focusNext",s.FocusPrevious="workbench.action.terminal.focusPrevious",s.Paste="workbench.action.terminal.paste",s.PasteSelection="workbench.action.terminal.pasteSelection",s.SelectDefaultProfile="workbench.action.terminal.selectDefaultShell",s.RunSelectedText="workbench.action.terminal.runSelectedText",s.RunActiveFile="workbench.action.terminal.runActiveFile",s.SwitchTerminal="workbench.action.terminal.switchTerminal",s.ScrollDownLine="workbench.action.terminal.scrollDown",s.ScrollDownPage="workbench.action.terminal.scrollDownPage",s.ScrollToBottom="workbench.action.terminal.scrollToBottom",s.ScrollUpLine="workbench.action.terminal.scrollUp",s.ScrollUpPage="workbench.action.terminal.scrollUpPage",s.ScrollToTop="workbench.action.terminal.scrollToTop",s.Clear="workbench.action.terminal.clear",s.ClearSelection="workbench.action.terminal.clearSelection",s.ChangeIcon="workbench.action.terminal.changeIcon",s.ChangeIconActiveTab="workbench.action.terminal.changeIconActiveTab",s.ChangeColor="workbench.action.terminal.changeColor",s.ChangeColorActiveTab="workbench.action.terminal.changeColorActiveTab",s.Rename="workbench.action.terminal.rename",s.RenameActiveTab="workbench.action.terminal.renameActiveTab",s.RenameWithArgs="workbench.action.terminal.renameWithArg",s.ScrollToPreviousCommand="workbench.action.terminal.scrollToPreviousCommand",s.ScrollToNextCommand="workbench.action.terminal.scrollToNextCommand",s.SelectToPreviousCommand="workbench.action.terminal.selectToPreviousCommand",s.SelectToNextCommand="workbench.action.terminal.selectToNextCommand",s.SelectToPreviousLine="workbench.action.terminal.selectToPreviousLine",s.SelectToNextLine="workbench.action.terminal.selectToNextLine",s.SendSequence="workbench.action.terminal.sendSequence",s.AttachToSession="workbench.action.terminal.attachToSession",s.DetachSession="workbench.action.terminal.detachSession",s.MoveToEditor="workbench.action.terminal.moveToEditor",s.MoveToTerminalPanel="workbench.action.terminal.moveToTerminalPanel",s.MoveIntoNewWindow="workbench.action.terminal.moveIntoNewWindow",s.SetDimensions="workbench.action.terminal.setDimensions",s.FocusHover="workbench.action.terminal.focusHover",s.ShowEnvironmentContributions="workbench.action.terminal.showEnvironmentContributions",s.StartVoice="workbench.action.terminal.startVoice",s.StopVoice="workbench.action.terminal.stopVoice"})(Pt||(Pt={}));[Pt.ClearSelection,Pt.Clear,Pt.CopyAndClearSelection,Pt.CopySelection,Pt.CopySelectionAsHtml,Pt.CopyLastCommand,Pt.CopyLastCommandOutput,Pt.CopyLastCommandAndLastCommandOutput,Pt.DeleteToLineStart,Pt.DeleteWordLeft,Pt.DeleteWordRight,Pt.FocusNextPane,Pt.FocusNext,Pt.FocusPreviousPane,Pt.FocusPrevious,Pt.Focus,Pt.SizeToContentWidth,Pt.Kill,Pt.KillEditor,Pt.MoveToEditor,Pt.MoveToLineEnd,Pt.MoveToLineStart,Pt.MoveToTerminalPanel,Pt.NewInActiveWorkspace,Pt.New,Pt.Paste,Pt.PasteSelection,Pt.ResizePaneDown,Pt.ResizePaneLeft,Pt.ResizePaneRight,Pt.ResizePaneUp,Pt.RunActiveFile,Pt.RunSelectedText,Pt.ScrollDownLine,Pt.ScrollDownPage,Pt.ScrollToBottom,Pt.ScrollToNextCommand,Pt.ScrollToPreviousCommand,Pt.ScrollToTop,Pt.ScrollUpLine,Pt.ScrollUpPage,Pt.SendSequence,Pt.SelectAll,Pt.SelectToNextCommand,Pt.SelectToNextLine,Pt.SelectToPreviousCommand,Pt.SelectToPreviousLine,Pt.SplitInActiveWorkspace,Pt.Split,Pt.Toggle,Pt.FocusHover,Mo.OpenAccessibilityHelp,...xWe];h(10540,"Contributes terminal functionality."),h(10541,"Defines additional terminal profiles that the user can create."),h(10542,"The ID of the terminal profile provider."),h(10543,"Title for this terminal profile."),h(10544,"A codicon, URI, or light and dark URIs to associate with this terminal type."),h(10545,"Icon path when a light theme is used"),h(10546,"Icon path when a dark theme is used");var qi;(function(s){s.IsOpen="terminalIsOpen",s.Count="terminalCount",s.GroupCount="terminalGroupCount",s.TabsNarrow="isTerminalTabsNarrow",s.HasFixedWidth="terminalHasFixedWidth",s.ProcessSupported="terminalProcessSupported",s.Focus="terminalFocus",s.FocusInAny="terminalFocusInAny",s.AccessibleBufferFocus="terminalAccessibleBufferFocus",s.AccessibleBufferOnLastLine="terminalAccessibleBufferOnLastLine",s.EditorFocus="terminalEditorFocus",s.TabsFocus="terminalTabsFocus",s.WebExtensionContributedProfile="terminalWebExtensionContributedProfile",s.TerminalHasBeenCreated="terminalHasBeenCreated",s.TerminalEditorActive="terminalEditorActive",s.TabsMouse="terminalTabsMouse",s.AltBufferActive="terminalAltBufferActive",s.SuggestWidgetVisible="terminalSuggestWidgetVisible",s.A11yTreeFocus="terminalA11yTreeFocus",s.ViewShowing="terminalViewShowing",s.TextSelected="terminalTextSelected",s.TextSelectedInFocused="terminalTextSelectedInFocused",s.FindVisible="terminalFindVisible",s.FindInputFocused="terminalFindInputFocused",s.FindFocused="terminalFindFocused",s.TabsSingularSelection="terminalTabsSingularSelection",s.SplitTerminal="terminalSplitTerminal",s.ShellType="terminalShellType",s.InTerminalRunCommandPicker="inTerminalRunCommandPicker",s.TerminalShellIntegrationEnabled="terminalShellIntegrationEnabled"})(qi||(qi={}));var c$;(function(s){s.isOpen=new O(qi.IsOpen,!1,!0),s.focus=new O(qi.Focus,!1,h(10727,"Whether the terminal is focused.")),s.focusInAny=new O(qi.FocusInAny,!1,h(10728,"Whether any terminal is focused, including detached terminals used in other UI.")),s.editorFocus=new O(qi.EditorFocus,!1,h(10729,"Whether a terminal in the editor area is focused.")),s.count=new O(qi.Count,0,h(10730,"The current number of terminals.")),s.groupCount=new O(qi.GroupCount,0,!0),s.tabsNarrow=new O(qi.TabsNarrow,!1,!0),s.terminalHasFixedWidth=new O(qi.HasFixedWidth,!1,!0),s.tabsFocus=new O(qi.TabsFocus,!1,h(10731,"Whether the terminal tabs widget is focused.")),s.webExtensionContributedProfile=new O(qi.WebExtensionContributedProfile,!1,!0),s.terminalHasBeenCreated=new O(qi.TerminalHasBeenCreated,!1,!0),s.terminalEditorActive=new O(qi.TerminalEditorActive,!1,!0),s.tabsMouse=new O(qi.TabsMouse,!1,!0),s.shellType=new O(qi.ShellType,void 0,{type:"string",description:h(10732,"The shell type of the active terminal, this is set if the type can be detected.")}),s.altBufferActive=new O(qi.AltBufferActive,!1,h(10733,"Whether the terminal's alt buffer is active.")),s.suggestWidgetVisible=new O(qi.SuggestWidgetVisible,!1,h(10734,"Whether the terminal's suggest widget is visible.")),s.notFocus=s.focus.toNegated(),s.viewShowing=new O(qi.ViewShowing,!1,h(10735,"Whether the terminal view is showing")),s.textSelected=new O(qi.TextSelected,!1,h(10736,"Whether text is selected in the active terminal.")),s.textSelectedInFocused=new O(qi.TextSelectedInFocused,!1,h(10737,"Whether text is selected in a focused terminal.")),s.notTextSelected=s.textSelected.toNegated(),s.findVisible=new O(qi.FindVisible,!1,!0),s.notFindVisible=s.findVisible.toNegated(),s.findInputFocus=new O(qi.FindInputFocused,!1,!0),s.findFocus=new O(qi.FindFocused,!1,!0),s.notFindFocus=s.findInputFocus.toNegated(),s.processSupported=new O(qi.ProcessSupported,!1,h(10738,"Whether terminal processes can be launched in the current workspace.")),s.tabsSingularSelection=new O(qi.TabsSingularSelection,!1,h(10739,"Whether one terminal is selected in the terminal tabs list.")),s.splitTerminal=new O(qi.SplitTerminal,!1,h(10740,"Whether the focused tab's terminal is a split terminal.")),s.inTerminalRunCommandPicker=new O(qi.InTerminalRunCommandPicker,!1,h(10741,"Whether the terminal run command picker is currently open.")),s.terminalShellIntegrationEnabled=new O(qi.TerminalShellIntegrationEnabled,!1,h(10742,"Whether shell integration is enabled in the active terminal")),s.shouldShowViewInlineActions=x.and(x.equals("view",IWe),x.notEquals(`config.${qc.TabsHideCondition}`,"never"),x.or(x.not(`config.${qc.TabsEnabled}`),x.and(x.equals(`config.${qc.TabsShowActions}`,"singleTerminal"),x.equals(qi.GroupCount,1)),x.and(x.equals(`config.${qc.TabsShowActions}`,"singleTerminalOrNarrow"),x.or(x.equals(qi.GroupCount,1),x.has(qi.TabsNarrow))),x.and(x.equals(`config.${qc.TabsShowActions}`,"singleGroup"),x.equals(qi.GroupCount,1)),x.equals(`config.${qc.TabsShowActions}`,"always")))})(c$||(c$={}));var hT;let d$=class extends gl{static{hT=this}static{this.ID="workbench.editors.terminal"}setGroup(e){this._group=e,e?.scopedContextKeyService&&this._terminalInstance?.setParentContextKeyService(e.scopedContextKeyService)}get group(){return this._group}get typeId(){return hT.ID}get editorId(){return ej}get capabilities(){return Ze.Readonly|Ze.Singleton|Ze.CanDropIntoEditor|Ze.ForceDescription}setTerminalInstance(e){if(this._terminalInstance)throw new Error("cannot set instance that has already been set");this._terminalInstance=e,this._setupInstanceListeners()}copy(){const e=this._terminalInstanceService.createInstance(this._copyLaunchConfig||{},fy.Editor);return e.focusWhenReady(),this._copyLaunchConfig=void 0,this._instantiationService.createInstance(hT,e.resource,e)}setCopyLaunchConfig(e){this._copyLaunchConfig=e}get terminalInstance(){return this._isDetached?void 0:this._terminalInstance}showConfirm(){if(this._isReverted)return!1;const e=this._configurationService.getValue(qc.ConfirmOnKill);return(e==="editor"||e==="always")&&this._terminalInstance?.hasChildProcesses||!1}async confirm(e){const{confirmed:t}=await this._dialogService.confirm({type:Me.Warning,message:h(10410,"Do you want to terminate running processes?"),primaryButton:h(10411,"&&Terminate"),detail:e.length>1?e.map(i=>i.editor.getName()).join(`
`)+`

`+h(10412,"Closing will terminate the running processes in the terminals."):h(10413,"Closing will terminate the running processes in this terminal.")});return t?zi.DONT_SAVE:zi.CANCEL}async revert(){this._isReverted=!0}constructor(e,t,i,n,o,r,a,c,d){super(),this.resource=e,this._terminalInstance=t,this._themeService=i,this._terminalInstanceService=n,this._instantiationService=o,this._configurationService=r,this._lifecycleService=a,this._contextKeyService=c,this._dialogService=d,this.closeHandler=this,this._isDetached=!1,this._isShuttingDown=!1,this._isReverted=!1,this._onDidRequestAttach=this._register(new M),this.onDidRequestAttach=this._onDidRequestAttach.event,this._terminalEditorFocusContextKey=c$.editorFocus.bindTo(c),t&&this._setupInstanceListeners()}_setupInstanceListeners(){const e=this._terminalInstance;if(!e)return;const t=e.onDidFocus(()=>this._terminalEditorFocusContextKey.set(!0)),i=e.onDidBlur(()=>this._terminalEditorFocusContextKey.reset());this._register(Ee(()=>{!this._isDetached&&!this._isShuttingDown&&e.dispose(Im.User),Qe([t,i])}));const n=[e.onExit(o=>{e.waitOnExit||this.dispose()}),e.onDisposed(()=>this.dispose()),e.onTitleChanged(()=>this._onDidChangeLabel.fire()),e.onIconChanged(()=>this._onDidChangeLabel.fire()),t,i,e.statusList.onDidChangePrimaryStatus(()=>this._onDidChangeLabel.fire())];this._lifecycleService.onWillShutdown(o=>{this._isShuttingDown=!0,Qe(n),this._configurationService.getValue(qc.EnablePersistentSessions)&&o.reason===Cb.RELOAD?e.detachProcessAndDispose(Im.Shutdown):e.dispose(Im.Shutdown)})}getName(){return this._terminalInstance?.title||this.resource.fragment}getIcon(){if(!(!this._terminalInstance||!Te.isThemeIcon(this._terminalInstance.icon)))return this._terminalInstance.icon}getLabelExtraClasses(){if(!this._terminalInstance)return[];const e=["terminal-tab","predefined-file-icon"],t=_We(this._terminalInstance);t&&e.push(t);const i=bWe(this._terminalInstance,this._themeService.getColorTheme().type);return i&&e.push(...i),e}detachInstance(){this._isShuttingDown||(this._terminalInstance?.detachFromElement(),this._terminalInstance?.setParentContextKeyService(this._contextKeyService),this._isDetached=!0)}getDescription(){return this._terminalInstance?.description}toUntyped(){return{resource:this.resource,options:{override:ej,pinned:!0,forceReload:!0}}}};d$=hT=f([p(2,ft),p(3,Sre),p(4,J),p(5,ne),p(6,wd),p(7,me),p(8,Qt)],d$);let PJ=class{constructor(e,t,i,n,o){this._editorGroupsService=t,this._configurationService=i,this._logService=n,this._dispoables=new U,this._tabGroupModel=[],this._groupLookup=new Map,this._tabInfoLookup=new Map,this._multiDiffEditorInputListeners=new ei,this._proxy=e.getProxy(Ye.ExtHostEditorTabs),this._dispoables.add(o.onDidEditorsChange(r=>{try{this._updateTabsModel(r)}catch{this._logService.error("Failed to update model, rebuilding"),this._createTabsModel()}})),this._dispoables.add(this._multiDiffEditorInputListeners),this._dispoables.add(this._editorGroupsService.onDidAddGroup(()=>this._createTabsModel())),this._dispoables.add(this._editorGroupsService.onDidRemoveGroup(()=>this._createTabsModel())),this._editorGroupsService.whenReady.then(()=>this._createTabsModel())}dispose(){this._groupLookup.clear(),this._tabInfoLookup.clear(),this._dispoables.dispose()}_buildTabObject(e,t,i){const n=t.editorId;return{id:this._generateTabId(t,e.id),label:t.getName(),editorId:n,input:this._editorInputToDto(t),isPinned:e.isSticky(i),isPreview:!e.isPinned(i),isActive:e.isActive(t),isDirty:t.isDirty()}}_editorInputToDto(e){if(e instanceof t$)return{kind:Oo.TextMergeInput,base:e.base,input1:e.input1.uri,input2:e.input2.uri,result:e.resource};if(e instanceof Zd)return{kind:Oo.TextInput,uri:e.resource};if(e instanceof ws&&!(e instanceof ro)){const t=e.primary.resource,i=e.secondary.resource;return e.primary instanceof Zd&&e.secondary instanceof Zd&&Dt(t,i)&&t&&i?{kind:Oo.TextInput,uri:t}:{kind:Oo.UnknownInput}}if(e instanceof Lm)return{kind:Oo.NotebookInput,notebookType:e.viewType,uri:e.resource};if(e instanceof qb)return{kind:Oo.CustomEditorInput,viewType:e.viewType,uri:e.resource};if(e instanceof lr)return{kind:Oo.WebviewEditorInput,viewType:e.viewType};if(e instanceof d$)return{kind:Oo.TerminalEditorInput};if(e instanceof ro){if(e.modified instanceof Zd&&e.original instanceof Zd)return{kind:Oo.TextDiffInput,modified:e.modified.resource,original:e.original.resource};if(e.modified instanceof Lm&&e.original instanceof Lm)return{kind:Oo.NotebookDiffInput,notebookType:e.original.viewType,modified:e.modified.resource,original:e.original.resource}}if(e instanceof K2)return{kind:Oo.InteractiveEditorInput,uri:e.resource,inputBoxUri:e.inputResource};if(e instanceof NH)return{kind:Oo.ChatEditorInput};if(e instanceof zb){const t=[];for(const i of e?.resources.get()??[])i.originalUri&&i.modifiedUri&&t.push({kind:Oo.TextDiffInput,original:i.originalUri,modified:i.modifiedUri});return{kind:Oo.MultiDiffEditorInput,diffEditors:t}}return{kind:Oo.UnknownInput}}_generateTabId(e,t){let i;const n=xi.getCanonicalUri(e,{supportSideBySide:Ut.BOTH});return n instanceof R?i=n.toString():i=`${n?.primary?.toString()}-${n?.secondary?.toString()}`,`${t}~${e.editorId}-${e.typeId}-${i} `}_onDidGroupActivate(){const e=this._editorGroupsService.activeGroup.id,t=this._groupLookup.get(e);t&&(t.isActive=!0,this._proxy.$acceptTabGroupUpdate(t))}_onDidTabLabelChange(e,t,i){const n=this._generateTabId(t,e),o=this._tabInfoLookup.get(n);o?(o.tab.label=t.getName(),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:o.tab,kind:Od.TAB_UPDATE})):(this._logService.error("Invalid model for label change, rebuilding"),this._createTabsModel())}_onDidTabOpen(e,t,i){const n=this._editorGroupsService.getGroup(e),o=this._groupLookup.get(e)!==void 0;if(!n||!o){this._createTabsModel();return}const r=this._groupLookup.get(e)?.tabs;if(!r)return;const a=this._buildTabObject(n,t,i);r.splice(i,0,a);const c=this._generateTabId(t,e);this._tabInfoLookup.set(c,{group:n,editorInput:t,tab:a}),t instanceof zb&&this._multiDiffEditorInputListeners.set(t,D.fromObservableLight(t.resources)(()=>{const d=this._tabInfoLookup.get(c);d&&(d.tab=this._buildTabObject(n,t,i),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:d.tab,kind:Od.TAB_UPDATE}))})),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:a,kind:Od.TAB_OPEN})}_onDidTabClose(e,t){const i=this._editorGroupsService.getGroup(e),n=this._groupLookup.get(e)?.tabs;if(!i||!n){this._createTabsModel();return}const o=n.splice(t,1);o.length!==0&&(this._tabInfoLookup.delete(o[0]?.id??""),o[0]?.input instanceof zb&&this._multiDiffEditorInputListeners.deleteAndDispose(o[0]?.input),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:o[0],kind:Od.TAB_CLOSE}))}_onDidTabActiveChange(e,t){const i=this._groupLookup.get(e)?.tabs;if(!i)return;const n=i[t];n.isActive=!0,this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:n,kind:Od.TAB_UPDATE})}_onDidTabDirty(e,t,i){const n=this._generateTabId(i,e),o=this._tabInfoLookup.get(n);if(!o){this._logService.error("Invalid model for dirty change, rebuilding"),this._createTabsModel();return}o.tab.isDirty=i.isDirty(),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:o.tab,kind:Od.TAB_UPDATE})}_onDidTabPinChange(e,t,i){const n=this._generateTabId(i,e),o=this._tabInfoLookup.get(n),r=o?.group,a=o?.tab;if(!r||!a){this._logService.error("Invalid model for sticky change, rebuilding"),this._createTabsModel();return}a.isPinned=r.isSticky(t),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:a,kind:Od.TAB_UPDATE})}_onDidTabPreviewChange(e,t,i){const n=this._generateTabId(i,e),o=this._tabInfoLookup.get(n),r=o?.group,a=o?.tab;if(!r||!a){this._logService.error("Invalid model for sticky change, rebuilding"),this._createTabsModel();return}a.isPreview=!r.isPinned(t),this._proxy.$acceptTabOperation({kind:Od.TAB_UPDATE,groupId:e,tabDto:a,index:t})}_onDidTabMove(e,t,i,n){const o=this._groupLookup.get(e)?.tabs;if(!o){this._logService.error("Invalid model for move change, rebuilding"),this._createTabsModel();return}const r=o.splice(i,1);r.length!==0&&(o.splice(t,0,r[0]),this._proxy.$acceptTabOperation({kind:Od.TAB_MOVE,groupId:e,tabDto:r[0],index:t,oldIndex:i}))}_createTabsModel(){if(this._editorGroupsService.groups.length===0)return;this._tabGroupModel=[],this._groupLookup.clear(),this._tabInfoLookup.clear();let e=[];for(const t of this._editorGroupsService.groups){const i={groupId:t.id,isActive:t.id===this._editorGroupsService.activeGroup.id,viewColumn:Jp(this._editorGroupsService,t),tabs:[]};t.editors.forEach((n,o)=>{const r=this._buildTabObject(t,n,o);e.push(r),this._tabInfoLookup.set(this._generateTabId(n,t.id),{group:t,tab:r,editorInput:n})}),i.tabs=e,this._tabGroupModel.push(i),this._groupLookup.set(t.id,i),e=[]}this._proxy.$acceptEditorTabModel(this._tabGroupModel)}_updateTabsModel(e){const t=e.event,i=e.groupId;switch(t.kind){case ct.GROUP_ACTIVE:if(i===this._editorGroupsService.activeGroup.id){this._onDidGroupActivate();break}else return;case ct.EDITOR_LABEL:if(t.editor!==void 0&&t.editorIndex!==void 0){this._onDidTabLabelChange(i,t.editor,t.editorIndex);break}case ct.EDITOR_OPEN:if(t.editor!==void 0&&t.editorIndex!==void 0){this._onDidTabOpen(i,t.editor,t.editorIndex);break}case ct.EDITOR_CLOSE:if(t.editorIndex!==void 0){this._onDidTabClose(i,t.editorIndex);break}case ct.EDITOR_ACTIVE:if(t.editorIndex!==void 0){this._onDidTabActiveChange(i,t.editorIndex);break}case ct.EDITOR_DIRTY:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabDirty(i,t.editorIndex,t.editor);break}case ct.EDITOR_STICKY:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabPinChange(i,t.editorIndex,t.editor);break}case ct.EDITOR_PIN:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabPreviewChange(i,t.editorIndex,t.editor);break}case ct.EDITOR_TRANSIENT:break;case ct.EDITOR_MOVE:if(o0e(t)&&t.editor&&t.editorIndex!==void 0&&t.oldEditorIndex!==void 0){this._onDidTabMove(i,t.editorIndex,t.oldEditorIndex,t.editor);break}default:this._createTabsModel()}}$moveTab(e,t,i,n){const o=Nm(this._editorGroupsService,this._configurationService,i),r=this._tabInfoLookup.get(e);if(!r?.tab)throw new Error(`Attempted to close tab with id ${e} which does not exist`);let c;const d=this._editorGroupsService.getGroup(r.group.id);if(!d)return;if(this._groupLookup.get(o)===void 0){let u=Xt.RIGHT;i===xr&&(u=Vv(this._configurationService)),c=this._editorGroupsService.addGroup(this._editorGroupsService.groups[this._editorGroupsService.groups.length-1],u)}else c=this._editorGroupsService.getGroup(o);if(!c)return;(t<0||t>c.editors.length)&&(t=c.editors.length);const l=r?.editorInput;l&&d.moveEditor(l,c,{index:t,preserveFocus:n})}async $closeTab(e,t){const i=new Map;for(const o of e){const r=this._tabInfoLookup.get(o),a=r?.tab,c=r?.group,d=r?.editorInput;if(!c||!a||!r||!d)continue;const l=i.get(c);l?l.push(d):i.set(c,[d])}const n=[];for(const[o,r]of i)n.push(await o.closeEditors(r,{preserveFocus:t}));return n.every(o=>o)}async $closeGroup(e,t){const i=[];for(const n of e){const o=this._editorGroupsService.getGroup(n);o&&(i.push(await o.closeAllEditors()),o.count===0&&this._editorGroupsService.getGroup(o.id)&&this._editorGroupsService.removeGroup(o))}return i.every(n=>n)}};PJ=f([ht($e.MainThreadEditorTabs),p(1,Ie),p(2,ne),p(3,Pe),p(4,de)],PJ);let LJ=class{dispose(){}$onUnexpectedError(e){e&&e.$isError&&(e=HT(e)),mt(e)}};LJ=f([ht($e.MainThreadErrors)],LJ);let MJ=class{constructor(e,t,i,n,o,r,a,c,d){this._extensionService=t,this._notificationService=i,this._extensionsWorkbenchService=n,this._hostService=o,this._extensionEnablementService=r,this._timerService=a,this._commandService=c,this._environmentService=d,this._extensionHostKind=e.extensionHostKind;const l=e;this._internalExtensionService=l.internalExtensionService,l._setExtensionHostProxy(new DWe(e.getProxy(Ye.ExtHostExtensionService))),l._setAllMainProxyIdentifiers(Object.keys($e).map(u=>$e[u]))}dispose(){}$getExtension(e){return this._extensionService.getExtension(e)}$activateExtension(e,t){return this._internalExtensionService._activateById(e,t)}async $onWillActivateExtension(e){this._internalExtensionService._onWillActivateExtension(e)}$onDidActivateExtension(e,t,i,n,o){this._internalExtensionService._onDidActivateExtension(e,t,i,n,o)}$onExtensionRuntimeError(e,t){const i=HT(t);this._internalExtensionService._onExtensionRuntimeError(e,i),console.error(`[${e.value}]${i.message}`),console.error(i.stack)}async $onExtensionActivationError(e,t,i){const n=HT(t);if(this._internalExtensionService._onDidActivateExtensionError(e,n),i){const r=await this._extensionService.getExtension(e.value);if(r){const c=(await this._extensionsWorkbenchService.queryLocal()).find(d=>ja(d.identifier,{id:i.dependency}));if(c?.local){await this._handleMissingInstalledDependency(r,c.local);return}else{await this._handleMissingNotInstalledDependency(r,i.dependency);return}}}if(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment){this._notificationService.error(n);return}console.error(n.message)}async _handleMissingInstalledDependency(e,t){const i=e.displayName||e.name;if(this._extensionEnablementService.isEnabled(t))this._notificationService.notify({severity:Me.Error,message:h(2408,"Cannot activate the '{0}' extension because it depends on the '{1}' extension, which is not loaded. Would you like to reload the window to load the extension?",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Kt("reload",h(2409,"Reload Window"),"",!0,()=>this._hostService.reload())]}});else{const n=this._extensionEnablementService.getEnablementState(t);n===bu.DisabledByVirtualWorkspace?this._notificationService.notify({severity:Me.Error,message:h(2410,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in the current workspace",i,t.manifest.displayName||t.manifest.name)}):n===bu.DisabledByTrustRequirement?this._notificationService.notify({severity:Me.Error,message:h(2411,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in Restricted Mode",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Kt("manageWorkspaceTrust",h(2412,"Manage Workspace Trust"),"",!0,()=>this._commandService.executeCommand("workbench.trust.manage"))]}}):this._extensionEnablementService.canChangeEnablement(t)?this._notificationService.notify({severity:Me.Error,message:h(2413,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled. Would you like to enable the extension and reload the window?",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Kt("enable",h(2414,"Enable and Reload"),"",!0,()=>this._extensionEnablementService.setEnablement([t],n===bu.DisabledGlobally?bu.EnabledGlobally:bu.EnabledWorkspace).then(()=>this._hostService.reload(),o=>this._notificationService.error(o)))]}}):this._notificationService.notify({severity:Me.Error,message:h(2415,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled.",i,t.manifest.displayName||t.manifest.name)})}}async _handleMissingNotInstalledDependency(e,t){const i=e.displayName||e.name;let n=null;try{n=(await this._extensionsWorkbenchService.getExtensions([{id:t}],ye.None))[0]}catch{}n?this._notificationService.notify({severity:Me.Error,message:h(2416,"Cannot activate the '{0}' extension because it depends on the '{1}' extension from '{2}', which is not installed. Would you like to install the extension and reload the window?",i,n.displayName,n.publisherDisplayName),actions:{primary:[new Kt("install",h(2417,"Install and Reload"),"",!0,()=>this._extensionsWorkbenchService.install(n).then(()=>this._hostService.reload(),o=>this._notificationService.error(o)))]}}):this._notificationService.error(h(2418,"Cannot activate the '{0}' extension because it depends on an unknown '{1}' extension.",i,t))}async $setPerformanceMarks(e){this._extensionHostKind===Lt.LocalProcess?this._timerService.setPerformanceMarks("localExtHost",e):this._extensionHostKind===Lt.LocalWebWorker?this._timerService.setPerformanceMarks("workerExtHost",e):this._timerService.setPerformanceMarks("remoteExtHost",e)}async $asBrowserUri(e){return tc.uriToBrowserUri(R.revive(e))}async $getAllStaticBrowserUris(){return Array.from(tc.getRegisteredBrowserUris(),e=>[e,tc.uriToBrowserUri(e)])}};MJ=f([ht($e.MainThreadExtensionService),p(1,hn),p(2,At),p(3,EI),p(4,Wn),p(5,gd),p(6,Ure),p(7,qe),p(8,mn)],MJ);class DWe{constructor(e){this._actual=e}async resolveAuthority(e,t){return kWe(await this._actual.$resolveAuthority(e,t))}async getCanonicalURI(e,t){const i=await this._actual.$getCanonicalURI(e,t);return i&&R.revive(i)}startExtensionHost(e){return this._actual.$startExtensionHost(e)}extensionTestsExecute(){return this._actual.$extensionTestsExecute()}activateByEvent(e,t){return this._actual.$activateByEvent(e,t)}activate(e,t){return this._actual.$activate(e,t)}setRemoteEnvironment(e){return this._actual.$setRemoteEnvironment(e)}updateRemoteConnectionData(e){return this._actual.$updateRemoteConnectionData(e)}deltaExtensions(e){return this._actual.$deltaExtensions(e)}test_latency(e){return this._actual.$test_latency(e)}test_up(e){return this._actual.$test_up(e)}test_down(e){return this._actual.$test_down(e)}}function kWe(s){return s.type==="ok"?{type:"ok",value:{...s.value,authority:TWe(s.value.authority)}}:s}function TWe(s){return{...s,connectTo:AWe(s.connectTo)}}function AWe(s){return s.type===uy.WebSocket?new GCe(s.host,s.port):new $Ce(s.id)}var Tc;let NJ=Tc=class{constructor(e,t){this._fileService=t,this._fileProvider=new ei,this._disposables=new U,this._proxy=e.getProxy(Ye.ExtHostFileSystem);const i=e.getProxy(Ye.ExtHostFileSystemInfo);for(const n of t.listCapabilities())i.$acceptProviderInfos(R.from({scheme:n.scheme,path:"/dummy"}),n.capabilities);this._disposables.add(t.onDidChangeFileSystemProviderRegistrations(n=>i.$acceptProviderInfos(R.from({scheme:n.scheme,path:"/dummy"}),n.provider?.capabilities??null))),this._disposables.add(t.onDidChangeFileSystemProviderCapabilities(n=>i.$acceptProviderInfos(R.from({scheme:n.scheme,path:"/dummy"}),n.provider.capabilities)))}dispose(){this._disposables.dispose(),this._fileProvider.dispose()}async $registerFileSystemProvider(e,t,i,n){this._fileProvider.set(e,new O4(this._fileService,t,i,n,e,this._proxy))}$unregisterProvider(e){this._fileProvider.deleteAndDispose(e)}$onFileSystemChange(e,t){const i=this._fileProvider.get(e);if(!i)throw new Error("Unknown file provider");i.$onFileSystemChange(t)}async $stat(e){try{const t=await this._fileService.stat(R.revive(e));return{ctime:t.ctime,mtime:t.mtime,size:t.size,permissions:t.readonly?xbe.Readonly:void 0,type:Tc._asFileType(t)}}catch(t){return Tc._handleError(t)}}async $readdir(e){try{const t=await this._fileService.resolve(R.revive(e),{resolveMetadata:!1});if(!t.isDirectory){const i=new Error(t.name);throw i.name=cr.FileNotADirectory,i}return t.children?t.children.map(i=>[i.name,Tc._asFileType(i)]):[]}catch(t){return Tc._handleError(t)}}static _asFileType(e){let t=0;return e.isFile?t+=dC.File:e.isDirectory&&(t+=dC.Directory),e.isSymbolicLink&&(t+=dC.SymbolicLink),t}async $readFile(e){try{return(await this._fileService.readFile(R.revive(e))).value}catch(t){return Tc._handleError(t)}}async $writeFile(e,t){try{await this._fileService.writeFile(R.revive(e),t)}catch(i){return Tc._handleError(i)}}async $rename(e,t,i){try{await this._fileService.move(R.revive(e),R.revive(t),i.overwrite)}catch(n){return Tc._handleError(n)}}async $copy(e,t,i){try{await this._fileService.copy(R.revive(e),R.revive(t),i.overwrite)}catch(n){return Tc._handleError(n)}}async $mkdir(e){try{await this._fileService.createFolder(R.revive(e))}catch(t){return Tc._handleError(t)}}async $delete(e,t){try{return await this._fileService.del(R.revive(e),t)}catch(i){return Tc._handleError(i)}}static _handleError(e){if(e instanceof Ibe)switch(e.fileOperationResult){case $n.FILE_NOT_FOUND:e.name=cr.FileNotFound;break;case $n.FILE_IS_DIRECTORY:e.name=cr.FileIsADirectory;break;case $n.FILE_PERMISSION_DENIED:e.name=cr.NoPermissions;break;case $n.FILE_MOVE_CONFLICT:e.name=cr.FileExists;break}else if(e instanceof Error){const t=Dbe(e);t!==cr.Unknown&&(e.name=t)}throw e}$ensureActivation(e){return this._fileService.activateProvider(e)}};NJ=Tc=f([ht($e.MainThreadFileSystem),p(1,Xe)],NJ);class O4{constructor(e,t,i,n,o,r){this.readOnlyMessage=n,this._handle=o,this._proxy=r,this._onDidChange=new M,this.onDidChangeFile=this._onDidChange.event,this.onDidChangeCapabilities=D.None,this.capabilities=i,this._registration=e.registerProvider(t,this)}dispose(){this._registration.dispose(),this._onDidChange.dispose()}watch(e,t){const i=Math.random();return this._proxy.$watch(this._handle,i,e,t),Ee(()=>{this._proxy.$unwatch(this._handle,i)})}$onFileSystemChange(e){this._onDidChange.fire(e.map(O4._createFileChange))}static _createFileChange(e){return{resource:R.revive(e.resource),type:e.type}}async stat(e){try{return await this._proxy.$stat(this._handle,e)}catch(t){throw t}}async readFile(e){return(await this._proxy.$readFile(this._handle,e)).buffer}writeFile(e,t,i){return this._proxy.$writeFile(this._handle,e,Re.wrap(t),i)}delete(e,t){return this._proxy.$delete(this._handle,e,t)}mkdir(e){return this._proxy.$mkdir(this._handle,e)}readdir(e){return this._proxy.$readdir(this._handle,e)}rename(e,t,i){return this._proxy.$rename(this._handle,e,t,i)}copy(e,t,i){return this._proxy.$copy(this._handle,e,t,i)}open(e,t){return this._proxy.$open(this._handle,e,t)}close(e){return this._proxy.$close(this._handle,e)}async read(e,t,i,n,o){const r=await this._proxy.$read(this._handle,e,t,o);return i.set(r.buffer,n),r.byteLength}write(e,t,i,n,o){return this._proxy.$write(this._handle,e,t,Re.wrap(i).slice(n,n+o))}}var uT;let l$=class{static{uT=this}static{this.MementoKeyAdditionalEdits="file.particpants.additionalEdits"}constructor(e,t,i,n,o,r,a,c,d,l,u){this._fileService=t,this._logService=u,this._listener=new U,this._watches=new ei,this._proxy=e.getProxy(Ye.ExtHostFileSystemEventService),this._listener.add(t.onDidFilesChange(v=>{this._proxy.$onFileEvent({created:v.rawAdded,changed:v.rawUpdated,deleted:v.rawDeleted})}));const g=this,m=new class{async participate(v,y,w,C,T){if(w?.isUndoing)return;const k=new ri(T),A=setTimeout(()=>k.cancel(),C),B=await o.withProgress({location:qo.Notification,title:this._progressLabel(y),cancellable:!0,delay:Math.min(C/2,3e3)},()=>{const ie=g._proxy.$onWillRunFileOperation(y,v,C,k.token);return xh(ie,k.token)},()=>{k.cancel()}).finally(()=>{k.dispose(),clearTimeout(A)});if(!B||B.edit.edits.length===0)return;const z=B.edit.edits.some(ie=>ie.metadata?.needsConfirmation);let Q=a.getBoolean(uT.MementoKeyAdditionalEdits,he.PROFILE);if(d.extensionTestsLocationURI&&(Q=!1),Q===void 0){let ie;if(B.extensionNames.length===1?y===ga.CREATE?ie=h(2419,"Extension '{0}' wants to make refactoring changes with this file creation",B.extensionNames[0]):y===ga.COPY?ie=h(2420,"Extension '{0}' wants to make refactoring changes with this file copy",B.extensionNames[0]):y===ga.MOVE?ie=h(2421,"Extension '{0}' wants to make refactoring changes with this file move",B.extensionNames[0]):ie=h(2422,"Extension '{0}' wants to make refactoring changes with this file deletion",B.extensionNames[0]):y===ga.CREATE?ie=h(2423,"{0} extensions want to make refactoring changes with this file creation",B.extensionNames.length):y===ga.COPY?ie=h(2424,"{0} extensions want to make refactoring changes with this file copy",B.extensionNames.length):y===ga.MOVE?ie=h(2425,"{0} extensions want to make refactoring changes with this file move",B.extensionNames.length):ie=h(2426,"{0} extensions want to make refactoring changes with this file deletion",B.extensionNames.length),z){const{confirmed:oe}=await r.confirm({type:Me.Info,message:ie,primaryButton:h(2427,"Show &&Preview"),cancelButton:h(2428,"Skip Changes")});if(Q=!0,!oe)return}else{let oe;(function(Ft){Ft[Ft.OK=0]="OK",Ft[Ft.Preview=1]="Preview",Ft[Ft.Cancel=2]="Cancel"})(oe||(oe={}));const{result:xe,checkboxChecked:Se}=await r.prompt({type:Me.Info,message:ie,buttons:[{label:h(2429,"&&OK"),run:()=>oe.OK},{label:h(2427,"Show &&Preview"),run:()=>oe.Preview}],cancelButton:{label:h(2428,"Skip Changes"),run:()=>oe.Cancel},checkbox:{label:h(2430,"Do not ask me again")}});if(xe===oe.Cancel)return;Q=xe===oe.Preview,Se&&a.store(uT.MementoKeyAdditionalEdits,Q,he.PROFILE,pt.USER)}}c.info("[onWill-handler] applying additional workspace edit from extensions",B.extensionNames),await n.apply(Fu(B.edit,l),{undoRedoGroupId:w?.undoRedoGroupId,showPreview:Q})}_progressLabel(v){switch(v){case ga.CREATE:return h(2431,"Running 'File Create' participants...");case ga.MOVE:return h(2432,"Running 'File Rename' participants...");case ga.COPY:return h(2433,"Running 'File Copy' participants...");case ga.DELETE:return h(2434,"Running 'File Delete' participants...");case ga.WRITE:return h(2435,"Running 'File Write' participants...")}}};this._listener.add(i.addFileOperationParticipant(m)),this._listener.add(i.onDidRunWorkingCopyFileOperation(v=>this._proxy.$onDidRunFileOperation(v.operation,v.files)))}async $watch(e,t,i,n,o){const r=R.revive(i),a={...n};if(a.recursive)try{(await this._fileService.stat(r)).isDirectory||(a.recursive=!1)}catch{}if(o&&!a.recursive){this._logService.trace(`MainThreadFileSystemEventService#$watch(): request to start watching correlated (extension: ${e}, path: ${r.toString(!0)}, recursive: ${a.recursive}, session: ${t}, excludes: ${JSON.stringify(a.excludes)}, includes: ${JSON.stringify(a.includes)})`);const c=new U,d=c.add(this._fileService.createWatcher(r,{...a,recursive:!1}));c.add(d.onDidChange(l=>{this._proxy.$onFileEvent({session:t,created:l.rawAdded,changed:l.rawUpdated,deleted:l.rawDeleted})})),this._watches.set(t,c)}else{this._logService.trace(`MainThreadFileSystemEventService#$watch(): request to start watching uncorrelated (extension: ${e}, path: ${r.toString(!0)}, recursive: ${a.recursive}, session: ${t}, excludes: ${JSON.stringify(a.excludes)}, includes: ${JSON.stringify(a.includes)})`);const c=this._fileService.watch(r,a);this._watches.set(t,c)}}$unwatch(e){this._watches.has(e)&&(this._logService.trace(`MainThreadFileSystemEventService#$unwatch(): request to stop watching (session: ${e})`),this._watches.deleteAndDispose(e))}dispose(){this._listener.dispose(),this._watches.dispose()}};l$=uT=f([ht($e.MainThreadFileSystemEventService),p(1,Xe),p(2,mg),p(3,gw),p(4,bl),p(5,Qt),p(6,tt),p(7,Pe),p(8,po),p(9,Zi),p(10,Pe)],l$);K(class extends X{constructor(){super({id:"files.participants.resetChoice",title:{value:h(2436,"Reset choice for 'File operation needs preview'"),original:"Reset choice for 'File operation needs preview'"},f1:!0})}run(e){e.get(tt).remove(l$.MementoKeyAdditionalEdits,he.PROFILE)}});class F4{constructor(){this.requestIdPool=0,this.dataTransferFiles=new Map}add(e){const t=this.requestIdPool++;return this.dataTransferFiles.set(t,Vt(Array.from(e,([,i])=>i.asFile()))),{id:t,dispose:()=>{this.dataTransferFiles.delete(t)}}}async resolveFileData(e,t){const i=this.dataTransferFiles.get(e);if(!i)throw new Error("No data transfer found");const n=i.find(o=>o.id===t);if(!n)throw new Error("No matching file found in data transfer");return Re.wrap(await n.data())}dispose(){this.dataTransferFiles.clear()}}var OJ;(function(s){s.CallsTo="incomingCalls",s.CallsFrom="outgoingCalls"})(OJ||(OJ={}));const Bue=new Pi;class _L{static async create(e,t,i){const[n]=Bue.ordered(e);if(!n)return;const o=await n.prepareCallHierarchy(e,t,i);if(o)return new _L(o.roots.reduce((r,a)=>r+a._sessionId,""),n,o.roots,new Vq(o))}constructor(e,t,i,n){this.id=e,this.provider=t,this.roots=i,this.ref=n,this.root=i[0]}dispose(){this.ref.release()}fork(e){const t=this;return new class extends _L{constructor(){super(t.id,t.provider,[e],t.ref.acquire())}}}async resolveIncomingCalls(e,t){try{const i=await this.provider.provideIncomingCalls(e,t);if(xn(i))return i}catch(i){kn(i)}return[]}async resolveOutgoingCalls(e,t){try{const i=await this.provider.provideOutgoingCalls(e,t);if(xn(i))return i}catch(i){kn(i)}return[]}}const XC=new Map;Ce.registerCommand("_executePrepareCallHierarchy",async(s,...e)=>{const[t,i]=e;St(R.isUri(t)),St(_e.isIPosition(i));let o=s.get(ai).getModel(t),r;if(!o){const c=await s.get(yi).createModelReference(t);o=c.object.textEditorModel,r=c}try{const a=await _L.create(o,i,ye.None);return a?(XC.set(a.id,a),XC.forEach((c,d,l)=>{l.size>10&&(c.dispose(),XC.delete(d))}),[a.root]):[]}finally{r?.dispose()}});function Vue(s){return!0}Ce.registerCommand("_executeProvideIncomingCalls",async(s,...e)=>{const[t]=e;St(Vue());const i=XC.get(t._sessionId);return i?i.resolveIncomingCalls(t,ye.None):[]});Ce.registerCommand("_executeProvideOutgoingCalls",async(s,...e)=>{const[t]=e;St(Vue());const i=XC.get(t._sessionId);return i?i.resolveOutgoingCalls(t,ye.None):[]});var h$;(function(s){const e=[];function t(n){let o=n;return o&&e.push(o),{dispose(){if(o){const r=e.indexOf(o);r>=0&&(e.splice(r,1),o=void 0)}}}}s.register=t;function i(){return e.slice(0)}s.all=i})(h$||(h$={}));var u$;(function(s){s[s.Idle=0]="Idle",s[s.Searching=1]="Searching",s[s.SlowSearch=2]="SlowSearch"})(u$||(u$={}));new O("searchState",u$.Idle);var FJ;(function(s){s.Subtypes="subtypes",s.Supertypes="supertypes"})(FJ||(FJ={}));const Hue=new Pi;class bL{static async create(e,t,i){const[n]=Hue.ordered(e);if(!n)return;const o=await n.prepareTypeHierarchy(e,t,i);if(o)return new bL(o.roots.reduce((r,a)=>r+a._sessionId,""),n,o.roots,new Vq(o))}constructor(e,t,i,n){this.id=e,this.provider=t,this.roots=i,this.ref=n,this.root=i[0]}dispose(){this.ref.release()}fork(e){const t=this;return new class extends bL{constructor(){super(t.id,t.provider,[e],t.ref.acquire())}}}async provideSupertypes(e,t){try{const i=await this.provider.provideSupertypes(e,t);if(xn(i))return i}catch(i){kn(i)}return[]}async provideSubtypes(e,t){try{const i=await this.provider.provideSubtypes(e,t);if(xn(i))return i}catch(i){kn(i)}return[]}}const ZC=new Map;Ce.registerCommand("_executePrepareTypeHierarchy",async(s,...e)=>{const[t,i]=e;St(R.isUri(t)),St(_e.isIPosition(i));let o=s.get(ai).getModel(t),r;if(!o){const c=await s.get(yi).createModelReference(t);o=c.object.textEditorModel,r=c}try{const a=await bL.create(o,i,ye.None);if(!a)return[];ZC.forEach((c,d,l)=>{l.size>10&&(c.dispose(),ZC.delete(d))});for(const c of a.roots)ZC.set(c._sessionId,a);return a.roots}finally{r?.dispose()}});function Uue(s){const e=s;return typeof s=="object"&&typeof e.name=="string"&&typeof e.kind=="number"&&R.isUri(e.uri)&&P.isIRange(e.range)&&P.isIRange(e.selectionRange)}Ce.registerCommand("_executeProvideSupertypes",async(s,...e)=>{const[t]=e;St(Uue(t));const i=ZC.get(t._sessionId);return i?i.provideSupertypes(t,ye.None):[]});Ce.registerCommand("_executeProvideSubtypes",async(s,...e)=>{const[t]=e;St(Uue(t));const i=ZC.get(t._sessionId);return i?i.provideSubtypes(t,ye.None):[]});var Ri;let WJ=Ri=class extends F{constructor(e,t,i,n,o){if(super(),this._languageService=t,this._languageConfigurationService=i,this._languageFeaturesService=n,this._uriIdentService=o,this._registrations=this._register(new ei),this._pasteEditProviders=new Map,this._documentOnDropEditProviders=new Map,this._proxy=e.getProxy(Ye.ExtHostLanguageFeatures),this._languageService){const r=()=>{const a=[];for(const c of t.getRegisteredLanguageIds()){const d=this._languageConfigurationService.getLanguageConfiguration(c).getWordDefinition();a.push({languageId:c,regexSource:d.source,regexFlags:d.flags})}this._proxy.$setWordDefinitions(a)};this._register(this._languageConfigurationService.onDidChange(a=>{if(!a.languageId)r();else{const c=this._languageConfigurationService.getLanguageConfiguration(a.languageId).getWordDefinition();this._proxy.$setWordDefinitions([{languageId:a.languageId,regexSource:c.source,regexFlags:c.flags}])}})),r()}}$unregister(e){this._registrations.deleteAndDispose(e)}static _reviveLocationDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>Ri._reviveLocationDto(t)),e):(e.uri=R.revive(e.uri),e))}static _reviveLocationLinkDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>Ri._reviveLocationLinkDto(t)),e):(e.uri=R.revive(e.uri),e))}static _reviveWorkspaceSymbolDto(e){return e&&(Array.isArray(e)?(e.forEach(Ri._reviveWorkspaceSymbolDto),e):(e.location=Ri._reviveLocationDto(e.location),e))}static _reviveCodeActionDto(e,t){return e?.forEach(i=>Fu(i.edit,t)),e}static _reviveLinkDTO(e){return e.url&&typeof e.url!="string"&&(e.url=R.revive(e.url)),e}static _reviveCallHierarchyItemDto(e){return e&&(e.uri=R.revive(e.uri)),e}static _reviveTypeHierarchyItemDto(e){return e&&(e.uri=R.revive(e.uri)),e}$registerDocumentSymbolProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentSymbolProvider.register(t,{displayName:i,provideDocumentSymbols:(n,o)=>this._proxy.$provideDocumentSymbols(e,n.uri,o)}))}$registerCodeLensSupport(e,t,i){const n={provideCodeLenses:async(o,r)=>{const a=await this._proxy.$provideCodeLenses(e,o.uri,r);if(a)return{lenses:a.lenses,dispose:()=>a.cacheId&&this._proxy.$releaseCodeLenses(e,a.cacheId)}},resolveCodeLens:async(o,r,a)=>{const c=await this._proxy.$resolveCodeLens(e,r,a);if(c)return{...c,range:o.validateRange(c.range)}}};if(typeof i=="number"){const o=new M;this._registrations.set(i,o),n.onDidChange=o.event}this._registrations.set(e,this._languageFeaturesService.codeLensProvider.register(t,n))}$emitCodeLensEvent(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$registerDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.definitionProvider.register(t,{provideDefinition:(i,n,o)=>this._proxy.$provideDefinition(e,i.uri,n,o).then(Ri._reviveLocationLinkDto)}))}$registerDeclarationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.declarationProvider.register(t,{provideDeclaration:(i,n,o)=>this._proxy.$provideDeclaration(e,i.uri,n,o).then(Ri._reviveLocationLinkDto)}))}$registerImplementationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.implementationProvider.register(t,{provideImplementation:(i,n,o)=>this._proxy.$provideImplementation(e,i.uri,n,o).then(Ri._reviveLocationLinkDto)}))}$registerTypeDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.typeDefinitionProvider.register(t,{provideTypeDefinition:(i,n,o)=>this._proxy.$provideTypeDefinition(e,i.uri,n,o).then(Ri._reviveLocationLinkDto)}))}$registerHoverProvider(e,t){this._registrations.set(e,this._languageFeaturesService.hoverProvider.register(t,{provideHover:async(i,n,o,r)=>{const a={verbosityRequest:r?.verbosityRequest?{verbosityDelta:r.verbosityRequest.verbosityDelta,previousHover:{id:r.verbosityRequest.previousHover.id}}:void 0};return await this._proxy.$provideHover(e,i.uri,n,a,o)}}))}$registerEvaluatableExpressionProvider(e,t){this._registrations.set(e,this._languageFeaturesService.evaluatableExpressionProvider.register(t,{provideEvaluatableExpression:(i,n,o)=>this._proxy.$provideEvaluatableExpression(e,i.uri,n,o)}))}$registerInlineValuesProvider(e,t,i){const n={provideInlineValues:(o,r,a,c)=>this._proxy.$provideInlineValues(e,o.uri,r,a,c)};if(typeof i=="number"){const o=new M;this._registrations.set(i,o),n.onDidChangeInlineValues=o.event}this._registrations.set(e,this._languageFeaturesService.inlineValuesProvider.register(t,n))}$emitInlineValuesEvent(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$registerDocumentHighlightProvider(e,t){this._registrations.set(e,this._languageFeaturesService.documentHighlightProvider.register(t,{provideDocumentHighlights:(i,n,o)=>this._proxy.$provideDocumentHighlights(e,i.uri,n,o)}))}$registerMultiDocumentHighlightProvider(e,t){this._registrations.set(e,this._languageFeaturesService.multiDocumentHighlightProvider.register(t,{selector:t,provideMultiDocumentHighlights:(i,n,o,r)=>this._proxy.$provideMultiDocumentHighlights(e,i.uri,n,o.map(a=>a.uri),r).then(a=>{if(a==null)return;const c=new wn;return a?.forEach(d=>{const l=R.revive(d.uri);c.has(l)?c.get(l).push(...d.highlights):c.set(l,d.highlights)}),c})}))}$registerLinkedEditingRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.linkedEditingRangeProvider.register(t,{provideLinkedEditingRanges:async(i,n,o)=>{const r=await this._proxy.$provideLinkedEditingRanges(e,i.uri,n,o);if(r)return{ranges:r.ranges,wordPattern:r.wordPattern?Ri._reviveRegExp(r.wordPattern):void 0}}}))}$registerReferenceSupport(e,t){this._registrations.set(e,this._languageFeaturesService.referenceProvider.register(t,{provideReferences:(i,n,o,r)=>this._proxy.$provideReferences(e,i.uri,n,o,r).then(Ri._reviveLocationDto)}))}$registerCodeActionSupport(e,t,i,n,o,r){const a={provideCodeActions:async(c,d,l,u)=>{const g=await this._proxy.$provideCodeActions(e,c.uri,d,l,u);if(g)return{actions:Ri._reviveCodeActionDto(g.actions,this._uriIdentService),dispose:()=>{typeof g.cacheId=="number"&&this._proxy.$releaseCodeActions(e,g.cacheId)}}},providedCodeActionKinds:i.providedKinds,documentation:i.documentation,displayName:n,extensionId:o};r&&(a.resolveCodeAction=async(c,d)=>{const l=await this._proxy.$resolveCodeAction(e,c.cacheId,d);return l.edit&&(c.edit=Fu(l.edit,this._uriIdentService)),l.command&&(c.command=l.command),c}),this._registrations.set(e,this._languageFeaturesService.codeActionProvider.register(t,a))}$registerPasteEditProvider(e,t,i){const n=new g$(e,this._proxy,i,this._uriIdentService);this._pasteEditProviders.set(e,n),this._registrations.set(e,Lo(this._languageFeaturesService.documentPasteEditProvider.register(t,n),Ee(()=>this._pasteEditProviders.delete(e))))}$resolvePasteFileData(e,t,i){const n=this._pasteEditProviders.get(e);if(!n)throw new Error("Could not find provider");return n.resolveFileData(t,i)}$registerDocumentFormattingSupport(e,t,i,n){this._registrations.set(e,this._languageFeaturesService.documentFormattingEditProvider.register(t,{extensionId:i,displayName:n,provideDocumentFormattingEdits:(o,r,a)=>this._proxy.$provideDocumentFormattingEdits(e,o.uri,r,a)}))}$registerRangeFormattingSupport(e,t,i,n,o){this._registrations.set(e,this._languageFeaturesService.documentRangeFormattingEditProvider.register(t,{extensionId:i,displayName:n,provideDocumentRangeFormattingEdits:(r,a,c,d)=>this._proxy.$provideDocumentRangeFormattingEdits(e,r.uri,a,c,d),provideDocumentRangesFormattingEdits:o?(r,a,c,d)=>this._proxy.$provideDocumentRangesFormattingEdits(e,r.uri,a,c,d):void 0}))}$registerOnTypeFormattingSupport(e,t,i,n){this._registrations.set(e,this._languageFeaturesService.onTypeFormattingEditProvider.register(t,{extensionId:n,autoFormatTriggerCharacters:i,provideOnTypeFormattingEdits:(o,r,a,c,d)=>this._proxy.$provideOnTypeFormattingEdits(e,o.uri,r,a,c,d)}))}$registerNavigateTypeSupport(e,t){let i;const n={provideWorkspaceSymbols:async(o,r)=>{const a=await this._proxy.$provideWorkspaceSymbols(e,o,r);return i!==void 0&&this._proxy.$releaseWorkspaceSymbols(e,i),i=a.cacheId,Ri._reviveWorkspaceSymbolDto(a.symbols)}};t&&(n.resolveWorkspaceSymbol=async(o,r)=>{const a=await this._proxy.$resolveWorkspaceSymbol(e,o,r);return a&&Ri._reviveWorkspaceSymbolDto(a)}),this._registrations.set(e,h$.register(n))}$registerRenameSupport(e,t,i){this._registrations.set(e,this._languageFeaturesService.renameProvider.register(t,{provideRenameEdits:(n,o,r,a)=>this._proxy.$provideRenameEdits(e,n.uri,o,r,a).then(c=>Fu(c,this._uriIdentService)),resolveRenameLocation:i?(n,o,r)=>this._proxy.$resolveRenameLocation(e,n.uri,o,r):void 0}))}$registerNewSymbolNamesProvider(e,t){this._registrations.set(e,this._languageFeaturesService.newSymbolNamesProvider.register(t,{supportsAutomaticNewSymbolNamesTriggerKind:this._proxy.$supportsAutomaticNewSymbolNamesTriggerKind(e),provideNewSymbolNames:(i,n,o,r)=>this._proxy.$provideNewSymbolNames(e,i.uri,n,o,r)}))}$registerDocumentSemanticTokensProvider(e,t,i,n){let o;if(typeof n=="number"){const r=new M;this._registrations.set(n,r),o=r.event}this._registrations.set(e,this._languageFeaturesService.documentSemanticTokensProvider.register(t,new RWe(this._proxy,e,i,o)))}$emitDocumentSemanticTokensEvent(e){const t=this._registrations.get(e);t instanceof M&&t.fire(void 0)}$registerDocumentRangeSemanticTokensProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentRangeSemanticTokensProvider.register(t,new PWe(this._proxy,e,i)))}static _inflateSuggestDto(e,t,i){const n=t[yo.label],o=t[yo.commandId],r=t[yo.commandIdent],a=t[yo.commitCharacters];let c;return o&&(c={$ident:r,id:o,title:"",arguments:r?[r]:t[yo.commandArguments]}),{label:n,extensionId:i,kind:t[yo.kind]??De.Property,tags:t[yo.kindModifier],detail:t[yo.detail],documentation:t[yo.documentation],sortText:t[yo.sortText],filterText:t[yo.filterText],preselect:t[yo.preselect],insertText:t[yo.insertText]??(typeof n=="string"?n:n.label),range:t[yo.range]??e,insertTextRules:t[yo.insertTextRules],commitCharacters:a?Array.from(a):void 0,additionalTextEdits:t[yo.additionalTextEdits],command:c,_id:t.x}}$registerCompletionsProvider(e,t,i,n,o){const r={triggerCharacters:i,_debugDisplayName:`${o.value}(${i.join("")})`,provideCompletionItems:async(a,c,d,l)=>{const u=await this._proxy.$provideCompletionItems(e,a.uri,c,d,l);return u&&{suggestions:u[ob.completions].map(g=>Ri._inflateSuggestDto(u[ob.defaultRanges],g,o)),incomplete:u[ob.isIncomplete]||!1,duration:u[ob.duration],dispose:()=>{typeof u.x=="number"&&this._proxy.$releaseCompletionItems(e,u.x)}}}};n&&(r.resolveCompletionItem=(a,c)=>this._proxy.$resolveCompletionItem(e,a._id,c).then(d=>{if(!d)return a;const l=Ri._inflateSuggestDto(a.range,d,o);return zu(a,l,!0)})),this._registrations.set(e,this._languageFeaturesService.completionProvider.register(t,r))}$registerInlineCompletionsSupport(e,t,i,n,o,r,a,c){const d={provideInlineCompletions:async(l,u,g,m)=>this._proxy.$provideInlineCompletions(e,l.uri,u,g,m),provideInlineEditsForRange:async(l,u,g,m)=>this._proxy.$provideInlineEditsForRange(e,l.uri,u,g,m),handleItemDidShow:async(l,u,g)=>{i&&await this._proxy.$handleInlineCompletionDidShow(e,l.pid,u.idx,g)},handlePartialAccept:async(l,u,g,m)=>{i&&await this._proxy.$handleInlineCompletionPartialAccept(e,l.pid,u.idx,g,m)},handleEndOfLifetime:async(l,u,g)=>{function m(v,y){return v.kind===Wp.Ignored?{...v,supersededBy:v.supersededBy?y(v.supersededBy):void 0}:v}i&&await this._proxy.$handleInlineCompletionEndOfLifetime(e,l.pid,u.idx,m(g,v=>({pid:l.pid,idx:v.idx})))},freeInlineCompletions:l=>{this._proxy.$freeInlineCompletionsList(e,l.pid)},handleRejection:async(l,u)=>{i&&await this._proxy.$handleInlineCompletionRejection(e,l.pid,u.idx)},groupId:n,yieldsToGroupIds:o,debounceDelayMs:a,displayName:r,toString(){return`InlineCompletionsProvider(${n})`}};if(this._registrations.set(e,this._languageFeaturesService.inlineCompletionsProvider.register(t,d)),typeof c=="number"){const l=new M;this._registrations.set(c,l),d.onDidChangeInlineCompletions=l.event}}$emitInlineCompletionsChange(e){const t=this._registrations.get(e);t instanceof M&&t.fire(void 0)}$registerInlineEditProvider(e,t,i,n){const o={displayName:n,provideInlineEdit:async(r,a,c)=>this._proxy.$provideInlineEdit(e,r.uri,a,c),freeInlineEdit:r=>{this._proxy.$freeInlineEdit(e,r.pid)}};this._registrations.set(e,this._languageFeaturesService.inlineEditProvider.register(t,o))}$registerSignatureHelpProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.signatureHelpProvider.register(t,{signatureHelpTriggerCharacters:i.triggerCharacters,signatureHelpRetriggerCharacters:i.retriggerCharacters,provideSignatureHelp:async(n,o,r,a)=>{const c=await this._proxy.$provideSignatureHelp(e,n.uri,o,a,r);if(c)return{value:c,dispose:()=>{this._proxy.$releaseSignatureHelp(e,c.id)}}}}))}$registerInlayHintsProvider(e,t,i,n,o){const r={displayName:o,provideInlayHints:async(a,c,d)=>{const l=await this._proxy.$provideInlayHints(e,a.uri,c,d);if(l)return{hints:cn(l.hints),dispose:()=>{l.cacheId&&this._proxy.$releaseInlayHints(e,l.cacheId)}}}};if(i&&(r.resolveInlayHint=async(a,c)=>{const d=a;if(!d.cacheId)return a;const l=await this._proxy.$resolveInlayHint(e,d.cacheId,c);if(c.isCancellationRequested)throw new $s;return l?{...a,tooltip:l.tooltip,label:cn(l.label),textEdits:l.textEdits}:a}),typeof n=="number"){const a=new M;this._registrations.set(n,a),r.onDidChangeInlayHints=a.event}this._registrations.set(e,this._languageFeaturesService.inlayHintsProvider.register(t,r))}$emitInlayHintsEvent(e){const t=this._registrations.get(e);t instanceof M&&t.fire(void 0)}$registerDocumentLinkProvider(e,t,i){const n={provideLinks:(o,r)=>this._proxy.$provideDocumentLinks(e,o.uri,r).then(a=>{if(a)return{links:a.links.map(Ri._reviveLinkDTO),dispose:()=>{typeof a.cacheId=="number"&&this._proxy.$releaseDocumentLinks(e,a.cacheId)}}})};i&&(n.resolveLink=(o,r)=>{const a=o;return a.cacheId?this._proxy.$resolveDocumentLink(e,a.cacheId,r).then(c=>c&&Ri._reviveLinkDTO(c)):o}),this._registrations.set(e,this._languageFeaturesService.linkProvider.register(t,n))}$registerDocumentColorProvider(e,t){const i=this._proxy;this._registrations.set(e,this._languageFeaturesService.colorProvider.register(t,{provideDocumentColors:(n,o)=>i.$provideDocumentColors(e,n.uri,o).then(r=>r.map(a=>{const[c,d,l,u]=a.color;return{color:{red:c,green:d,blue:l,alpha:u},range:a.range}})),provideColorPresentations:(n,o,r)=>i.$provideColorPresentations(e,n.uri,{color:[o.color.red,o.color.green,o.color.blue,o.color.alpha],range:o.range},r)}))}$registerFoldingRangeProvider(e,t,i,n){const o={id:i.value,provideFoldingRanges:(r,a,c)=>this._proxy.$provideFoldingRanges(e,r.uri,a,c)};if(typeof n=="number"){const r=new M;this._registrations.set(n,r),o.onDidChange=r.event}this._registrations.set(e,this._languageFeaturesService.foldingRangeProvider.register(t,o))}$emitFoldingRangeEvent(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$registerSelectionRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.selectionRangeProvider.register(t,{provideSelectionRanges:(i,n,o)=>this._proxy.$provideSelectionRanges(e,i.uri,n,o)}))}$registerCallHierarchyProvider(e,t){this._registrations.set(e,Bue.register(t,{prepareCallHierarchy:async(i,n,o)=>{const r=await this._proxy.$prepareCallHierarchy(e,i.uri,n,o);if(!(!r||r.length===0))return{dispose:()=>{for(const a of r)this._proxy.$releaseCallHierarchy(e,a._sessionId)},roots:r.map(Ri._reviveCallHierarchyItemDto)}},provideOutgoingCalls:async(i,n)=>{const o=await this._proxy.$provideCallHierarchyOutgoingCalls(e,i._sessionId,i._itemId,n);return o&&(o.forEach(r=>{r.to=Ri._reviveCallHierarchyItemDto(r.to)}),o)},provideIncomingCalls:async(i,n)=>{const o=await this._proxy.$provideCallHierarchyIncomingCalls(e,i._sessionId,i._itemId,n);return o&&(o.forEach(r=>{r.from=Ri._reviveCallHierarchyItemDto(r.from)}),o)}}))}static _reviveRegExp(e){return new RegExp(e.pattern,e.flags)}static _reviveIndentationRule(e){return{decreaseIndentPattern:Ri._reviveRegExp(e.decreaseIndentPattern),increaseIndentPattern:Ri._reviveRegExp(e.increaseIndentPattern),indentNextLinePattern:e.indentNextLinePattern?Ri._reviveRegExp(e.indentNextLinePattern):void 0,unIndentedLinePattern:e.unIndentedLinePattern?Ri._reviveRegExp(e.unIndentedLinePattern):void 0}}static _reviveOnEnterRule(e){return{beforeText:Ri._reviveRegExp(e.beforeText),afterText:e.afterText?Ri._reviveRegExp(e.afterText):void 0,previousLineText:e.previousLineText?Ri._reviveRegExp(e.previousLineText):void 0,action:e.action}}static _reviveOnEnterRules(e){return e.map(Ri._reviveOnEnterRule)}$setLanguageConfiguration(e,t,i){const n={comments:i.comments,brackets:i.brackets,wordPattern:i.wordPattern?Ri._reviveRegExp(i.wordPattern):void 0,indentationRules:i.indentationRules?Ri._reviveIndentationRule(i.indentationRules):void 0,onEnterRules:i.onEnterRules?Ri._reviveOnEnterRules(i.onEnterRules):void 0,autoClosingPairs:void 0,surroundingPairs:void 0,__electricCharacterSupport:void 0};i.autoClosingPairs?n.autoClosingPairs=i.autoClosingPairs:i.__characterPairSupport&&(n.autoClosingPairs=i.__characterPairSupport.autoClosingPairs),i.__electricCharacterSupport&&i.__electricCharacterSupport.docComment&&(n.__electricCharacterSupport={docComment:{open:i.__electricCharacterSupport.docComment.open,close:i.__electricCharacterSupport.docComment.close}}),this._languageService.isRegisteredLanguageId(t)&&this._registrations.set(e,this._languageConfigurationService.register(t,n,100))}$registerTypeHierarchyProvider(e,t){this._registrations.set(e,Hue.register(t,{prepareTypeHierarchy:async(i,n,o)=>{const r=await this._proxy.$prepareTypeHierarchy(e,i.uri,n,o);if(r)return{dispose:()=>{for(const a of r)this._proxy.$releaseTypeHierarchy(e,a._sessionId)},roots:r.map(Ri._reviveTypeHierarchyItemDto)}},provideSupertypes:async(i,n)=>{const o=await this._proxy.$provideTypeHierarchySupertypes(e,i._sessionId,i._itemId,n);return o&&o.map(Ri._reviveTypeHierarchyItemDto)},provideSubtypes:async(i,n)=>{const o=await this._proxy.$provideTypeHierarchySubtypes(e,i._sessionId,i._itemId,n);return o&&o.map(Ri._reviveTypeHierarchyItemDto)}}))}$registerDocumentOnDropEditProvider(e,t,i){const n=new p$(e,this._proxy,i,this._uriIdentService);this._documentOnDropEditProviders.set(e,n),this._registrations.set(e,Lo(this._languageFeaturesService.documentDropEditProvider.register(t,n),Ee(()=>this._documentOnDropEditProviders.delete(e))))}async $resolveDocumentOnDropFileData(e,t,i){const n=this._documentOnDropEditProviders.get(e);if(!n)throw new Error("Could not find provider");return n.resolveDocumentOnDropFileData(t,i)}};WJ=Ri=f([ht($e.MainThreadLanguageFeatures),p(1,fi),p(2,rs),p(3,Ne),p(4,Zi)],WJ);let g$=class{constructor(e,t,i,n){this._handle=e,this._proxy=t,this._uriIdentService=n,this.dataTransfers=new F4,this.copyMimeTypes=i.copyMimeTypes??[],this.pasteMimeTypes=i.pasteMimeTypes??[],this.providedPasteEditKinds=i.providedPasteEditKinds?.map(o=>new Zt(o))??[],i.supportsCopy&&(this.prepareDocumentPaste=async(o,r,a,c)=>{const d=await Py.fromList(a);if(c.isCancellationRequested)return;const l=await this._proxy.$prepareDocumentPaste(e,o.uri,r,d,c);if(!l)return;const u=new yO;for(const[g,m]of l.items)u.replace(g,ZI(m.asString,m.id));return u}),i.supportsPaste&&(this.provideDocumentPasteEdits=async(o,r,a,c,d)=>{const l=this.dataTransfers.add(a);try{const u=await Py.fromList(a);if(d.isCancellationRequested)return;const g=await this._proxy.$providePasteEdits(this._handle,l.id,o.uri,r,u,{only:c.only?.value,triggerKind:c.triggerKind},d);return g?{edits:g.map(m=>({...m,kind:m.kind?new Zt(m.kind.value):new Zt(""),yieldTo:m.yieldTo?.map(v=>({kind:new Zt(v)})),additionalEdit:m.additionalEdit?Fu(m.additionalEdit,this._uriIdentService,v=>this.resolveFileData(l.id,v)):void 0})),dispose:()=>{this._proxy.$releasePasteEdits(this._handle,l.id)}}:void 0}finally{l.dispose()}}),i.supportsResolve&&(this.resolveDocumentPasteEdit=async(o,r)=>{const a=await this._proxy.$resolvePasteEdit(this._handle,o._cacheId,r);return typeof a.insertText<"u"&&(o.insertText=a.insertText),a.additionalEdit&&(o.additionalEdit=Fu(a.additionalEdit,this._uriIdentService)),o})}resolveFileData(e,t){return this.dataTransfers.resolveFileData(e,t)}};g$=f([p(3,Zi)],g$);let p$=class{constructor(e,t,i,n){this._handle=e,this._proxy=t,this._uriIdentService=n,this.dataTransfers=new F4,this.dropMimeTypes=i?.dropMimeTypes??["*/*"],this.providedDropEditKinds=i?.providedDropKinds?.map(o=>new Zt(o)),i?.supportsResolve&&(this.resolveDocumentDropEdit=async(o,r)=>{const a=await this._proxy.$resolvePasteEdit(this._handle,o._cacheId,r);return a.additionalEdit&&(o.additionalEdit=Fu(a.additionalEdit,this._uriIdentService)),o})}async provideDocumentDropEdits(e,t,i,n){const o=this.dataTransfers.add(i);try{const r=await Py.fromList(i);if(n.isCancellationRequested)return;const a=await this._proxy.$provideDocumentOnDropEdits(this._handle,o.id,e.uri,t,r,n);return a?{edits:a.map(c=>({...c,yieldTo:c.yieldTo?.map(d=>({kind:new Zt(d)})),kind:c.kind?new Zt(c.kind):void 0,additionalEdit:Fu(c.additionalEdit,this._uriIdentService,d=>this.resolveDocumentOnDropFileData(o.id,d))})),dispose:()=>{this._proxy.$releaseDocumentOnDropEdits(this._handle,o.id)}}:void 0}finally{o.dispose()}}resolveDocumentOnDropFileData(e,t){return this.dataTransfers.resolveFileData(e,t)}};p$=f([p(3,Zi)],p$);class RWe{constructor(e,t,i,n){this._proxy=e,this._handle=t,this._legend=i,this.onDidChange=n}releaseDocumentSemanticTokens(e){e&&this._proxy.$releaseDocumentSemanticTokens(this._handle,parseInt(e,10))}getLegend(){return this._legend}async provideDocumentSemanticTokens(e,t,i){const n=t?parseInt(t,10):0,o=await this._proxy.$provideDocumentSemanticTokens(this._handle,e.uri,n,i);if(!o||i.isCancellationRequested)return null;const r=Wce(o);return r.type==="full"?{resultId:String(r.id),data:r.data}:{resultId:String(r.id),edits:r.deltas}}}class PWe{constructor(e,t,i){this._proxy=e,this._handle=t,this._legend=i}getLegend(){return this._legend}async provideDocumentRangeSemanticTokens(e,t,i){const n=await this._proxy.$provideDocumentRangeSemanticTokens(this._handle,e.uri,t,i);if(!n||i.isCancellationRequested)return null;const o=Wce(n);if(o.type==="full")return{resultId:String(o.id),data:o.data};throw new Error("Unexpected")}}let BJ=class{constructor(e,t,i,n,o){this._languageService=t,this._modelService=i,this._resolverService=n,this._languageStatusService=o,this._disposables=new U,this._status=new ei,this._proxy=e.getProxy(Ye.ExtHostLanguages),this._proxy.$acceptLanguageIds(t.getRegisteredLanguageIds()),this._disposables.add(t.onDidChange(r=>{this._proxy.$acceptLanguageIds(t.getRegisteredLanguageIds())}))}dispose(){this._disposables.dispose(),this._status.dispose()}async $changeLanguage(e,t){if(!this._languageService.isRegisteredLanguageId(t))return Promise.reject(new Error(`Unknown language id: ${t}`));const i=R.revive(e),n=await this._resolverService.createModelReference(i);try{n.object.textEditorModel.setLanguage(this._languageService.createById(t))}finally{n.dispose()}}async $tokensAtPosition(e,t){const i=R.revive(e),n=this._modelService.getModel(i);if(!n)return;n.tokenization.tokenizeIfCheap(t.lineNumber);const o=n.tokenization.getLineTokens(t.lineNumber),r=o.findTokenIndexAtOffset(t.column-1);return{type:o.getStandardTokenType(r),range:new P(t.lineNumber,1+o.getStartOffset(r),t.lineNumber,1+o.getEndOffset(r))}}$setLanguageStatus(e,t){this._status.get(e)?.dispose(),this._status.set(e,this._languageStatusService.addStatus(t))}$removeLanguageStatus(e){this._status.get(e)?.dispose()}};BJ=f([ht($e.MainThreadLanguages),p(1,fi),p(2,ai),p(3,yi),p(4,Rz)],BJ);let VJ=class{constructor(e,t){this.loggerService=t,this.disposables=new U;const i=e.getProxy(Ye.ExtHostLogLevelServiceShape);this.disposables.add(t.onDidChangeLogLevel(n=>{Tbe(n)?i.$setLogLevel(n):i.$setLogLevel(n[1],n[0])}))}$log(e,t){const i=this.loggerService.getLogger(R.revive(e));if(!i)throw new Error("Create the logger before logging");for(const[n,o]of t)Abe(i,n,o)}async $createLogger(e,t){this.loggerService.createLogger(R.revive(e),t)}async $registerLogger(e){this.loggerService.registerLogger({...e,resource:R.revive(e.resource)})}async $deregisterLogger(e){this.loggerService.deregisterLogger(R.revive(e))}async $setVisibility(e,t){this.loggerService.setVisibility(R.revive(e),t)}$flush(e){const t=this.loggerService.getLogger(R.revive(e));if(!t)throw new Error("Create the logger before flushing");t.flush()}dispose(){this.disposables.dispose()}};VJ=f([ht($e.MainThreadLogger),p(1,eI)],VJ);Ce.registerCommand("_extensionTests.setLogLevel",function(s,e){const t=s.get(eI),i=s.get(po);if(i.isExtensionDevelopment&&i.extensionTestsLocationURI){const n=kbe(e);n!==void 0&&t.setLogLevel(n)}});Ce.registerCommand("_extensionTests.getLogLevel",function(s){const e=s.get(Pe);return VF(e.getLevel())});let HJ=class{constructor(e,t,i,n,o){this._notificationService=t,this._commandService=i,this._dialogService=n,this.extensionsListener=o.onDidChangeExtensions(r=>{for(const a of r.removed)this._notificationService.removeFilter(a.identifier.value)})}dispose(){this.extensionsListener.dispose()}$showMessage(e,t,i,n){return i.modal?this._showModalMessage(e,t,i.detail,n,i.useCustom):this._showMessage(e,t,n,i)}_showMessage(e,t,i,n){return new Promise(o=>{const r=i.map(l=>Ci({id:`_extension_message_handle_${l.handle}`,label:l.title,enabled:!0,run:()=>(o(l.handle),Promise.resolve())}));let a;n.source&&(a={label:n.source.label,id:n.source.identifier.value}),a||(a=h(2445,"Extension"));const c=[];n.source&&c.push(Ci({id:n.source.identifier.value,label:h(2446,"Manage Extension"),run:()=>this._commandService.executeCommand("_extensions.manage",n.source.identifier.value)}));const d=this._notificationService.notify({severity:e,message:t,actions:{primary:r,secondary:c},source:a});D.once(d.onDidClose)(()=>{o(void 0)})})}async _showModalMessage(e,t,i,n,o){const r=[];let a;for(const d of n){const l={label:d.title,run:()=>d.handle};d.isCloseAffordance?a=l:r.push(l)}a||(r.length>0?a={label:h(2447,"Cancel"),run:()=>{}}:a={label:h(2448,"&&OK"),run:()=>{}});const{result:c}=await this._dialogService.prompt({type:e,message:t,detail:i,buttons:r,cancelButton:a,custom:o});return c}};HJ=f([ht($e.MainThreadMessageService),p(1,At),p(2,qe),p(3,Qt),p(4,hn)],HJ);const LWe=(s,e,t)=>{const i=new Uint8Array(16);for(let r=0;r<16;r++)i[r]=Math.round(Math.random()*256);const n=Xx(Re.wrap(i));return[`GET ws://localhost${s}?${e}&skipWebSocketFrames=true HTTP/1.1`,"Connection: Upgrade","Upgrade: websocket",`Sec-WebSocket-Key: ${n}`].join(`\r
`)+`\r
\r
`},UJ=Re.fromString(`\r
\r
`);async function MWe(s,e,t,i,n){s.write(Re.fromString(LWe(e,t)));const o=new U;try{return await new Promise((r,a)=>{let c;o.add(s.onData(d=>{c?c=Re.concat([c,d],c.byteLength+d.byteLength):c=d;const l=c.indexOf(UJ);if(l===-1)return;r(s),s.pauseData();const u=c.slice(l+UJ.byteLength);u.byteLength&&n.onData.fire(u)})),o.add(s.onClose(d=>a(d??new Error("socket closed")))),o.add(s.onEnd(()=>a(new Error("socket ended"))))})}catch(r){throw s.dispose(),r}finally{o.dispose()}}class NWe extends F{constructor(e,t){super(),this.debugLabel=e,this.pausableDataEmitter=this._register(new AF),this.onData=(...i)=>(this.pausableDataEmitter.isPaused&&queueMicrotask(()=>this.pausableDataEmitter.resume()),this.pausableDataEmitter.event(...i)),this.didDisposeEmitter=this._register(new M),this.onDidDispose=this.didDisposeEmitter.event,this.ended=!1,this._register(t.onData),this._register(t.onData.event(i=>this.pausableDataEmitter.fire(i))),this.onClose=this._register(t.onClose).event,this.onEnd=this._register(t.onEnd).event}pauseData(){this.pausableDataEmitter.pause()}drain(){return Promise.resolve()}end(){this.ended=!0,this.closeRemote()}traceSocketEvent(e,t){bV.traceSocketEvent(this,this.debugLabel,e,t)}dispose(){this.ended||this.closeRemote(),this.didDisposeEmitter.fire(),super.dispose()}}let $J=class extends F{constructor(e,t){super(),this._remoteSocketFactoryService=t,this._registrations=new Map,this._remoteSockets=new Map,this._proxy=e.getProxy(Ye.ExtHostManagedSockets)}async $registerSocketFactory(e){const t=this,i=new class{supports(n){return n.id===e}connect(n,o,r,a){return new Promise((c,d)=>{if(n.id!==e)return d(new Error("Invalid connectTo"));const l=n.id;t._proxy.$openRemoteSocket(l).then(u=>{const g={onClose:new M,onData:new M,onEnd:new M};t._remoteSockets.set(u,g),W4.connect(u,t._proxy,o,r,a,g).then(m=>{m.onDidDispose(()=>t._remoteSockets.delete(u)),c(m)},m=>{t._remoteSockets.delete(u),d(m)})}).catch(d)})}};this._registrations.set(e,this._remoteSocketFactoryService.register(uy.Managed,i))}async $unregisterSocketFactory(e){this._registrations.get(e)?.dispose()}$onDidManagedSocketHaveData(e,t){this._remoteSockets.get(e)?.onData.fire(t)}$onDidManagedSocketClose(e,t){this._remoteSockets.get(e)?.onClose.fire({type:ER.NodeSocketCloseEvent,error:t?new Error(t):void 0,hadError:!!t}),this._remoteSockets.delete(e)}$onDidManagedSocketEnd(e){this._remoteSockets.get(e)?.onEnd.fire()}};$J=f([ht($e.MainThreadManagedSockets),p(1,uz)],$J);class W4 extends NWe{static connect(e,t,i,n,o,r){const a=new W4(e,t,o,r);return MWe(a,i,n,o,r)}constructor(e,t,i,n){super(i,n),this.socketId=e,this.proxy=t}write(e){this.proxy.$remoteSocketWrite(this.socketId,e)}closeRemote(){this.proxy.$remoteSocketEnd(this.socketId)}drain(){return this.proxy.$remoteSocketDrain(this.socketId)}}var gT;let GJ=class extends F{static{gT=this}static{this._extensionIdPool=new Map}constructor(e,t,i,n,o){super(),this._outputStatusItem=this._register(new kt),this._outputService=t,this._viewsService=i,this._configurationService=n,this._statusbarService=o,this._proxy=e.getProxy(Ye.ExtHostOutputService);const r=()=>{const a=this._viewsService.isViewVisible(__)?this._outputService.getActiveChannel():void 0;this._proxy.$setVisibleChannel(a?a.id:null),this._outputStatusItem.value=void 0};this._register(D.any(this._outputService.onActiveOutputChannel,D.filter(this._viewsService.onDidChangeViewVisibility,({id:a})=>a===__))(()=>r())),r()}async $register(e,t,i,n){const o=(gT._extensionIdPool.get(n)||0)+1;gT._extensionIdPool.set(n,o);const r=`extension-output-${n}-#${o}-${e}`,a=R.revive(t);return Ge.as(rce.OutputChannels).registerChannel({id:r,label:e,source:{resource:a},log:!1,languageId:i,extensionId:n}),this._register(Ee(()=>this.$dispose(r))),r}async $update(e,t,i){const n=this._getChannel(e);n&&(t===TB.Append?n.update(t):Ja(i)&&n.update(t,i))}async $reveal(e,t){const i=this._getChannel(e);if(!i)return;const n=this._configurationService.getValue("workbench.view.showQuietly")??{};if(!this._viewsService.isViewVisible(__)&&n[__]){this._showChannelQuietly(i);return}this._outputService.showChannel(i.id,t)}_showChannelQuietly(e){const t={name:h(2450,"Show Output"),text:"$(output)",ariaLabel:h(2451,"Show {0} Output Channel",e.label),command:`workbench.action.output.show.${e.id}`,tooltip:h(2452,"Show {0} Output Channel",e.label),kind:"prominent"};this._outputStatusItem.value?this._outputStatusItem.value.update(t):this._outputStatusItem.value=this._statusbarService.addEntry(t,"status.view.showQuietly",iv.RIGHT,{location:{id:"status.notifications",priority:Number.NEGATIVE_INFINITY},alignment:iv.LEFT})}async $close(e){if(this._viewsService.isViewVisible(__)){const t=this._outputService.getActiveChannel();t&&e===t.id&&this._viewsService.closeView(__)}}async $dispose(e){this._getChannel(e)?.dispose()}_getChannel(e){return this._outputService.getChannel(e)}};GJ=gT=f([ht($e.MainThreadOutputService),p(1,FN),p(2,mo),p(3,ne),p(4,kN)],GJ);let qJ=class{constructor(e,t,i){this._commandService=i,this._progress=new Map,this._proxy=e.getProxy(Ye.ExtHostProgress),this._progressService=t}dispose(){this._progress.forEach(e=>e.resolve()),this._progress.clear()}async $startProgress(e,t,i){const n=this._createTask(e);t.location===qo.Notification&&i&&(t={...t,location:qo.Notification,secondaryActions:[Ci({id:i,label:h(2453,"Manage Extension"),run:()=>this._commandService.executeCommand("_extensions.manage",i)})]});try{this._progressService.withProgress(t,n,()=>this._proxy.$acceptProgressCanceled(e))}catch(o){kn(o)}}$progressReport(e,t){this._progress.get(e)?.progress.report(t)}$progressEnd(e){const t=this._progress.get(e);t&&(t.resolve(),this._progress.delete(e))}_createTask(e){return t=>new Promise(i=>{this._progress.set(e,{resolve:i,progress:t})})}};qJ=f([ht($e.MainThreadProgress),p(1,bl),p(2,qe)],qJ);let zJ=class{constructor(e,t){this.quickDiffService=t,this.providerDisposables=new ei,this.proxy=e.getProxy(Ye.ExtHostQuickDiff)}async $registerQuickDiffProvider(e,t,i,n,o){const r={id:i,label:n,rootUri:R.revive(o),selector:t,kind:"contributed",getOriginalResource:async c=>R.revive(await this.proxy.$provideOriginalResource(e,c,ye.None))},a=this.quickDiffService.addQuickDiffProvider(r);this.providerDisposables.set(e,a)}async $unregisterQuickDiffProvider(e){this.providerDisposables.has(e)&&this.providerDisposables.deleteAndDispose(e)}dispose(){this.providerDisposables.dispose()}};zJ=f([ht($e.MainThreadQuickDiff),p(1,RN)],zJ);function KJ(s){s.dark=R.revive(s.dark),s.light&&(s.light=R.revive(s.light))}let jJ=class{constructor(e,t){this._items={},this.sessions=new Map,this._proxy=e.getProxy(Ye.ExtHostQuickOpen),this._quickInputService=t}dispose(){for(const[e,t]of this.sessions)t.store.dispose()}$show(e,t,i){const n=new Promise((o,r)=>{this._items[e]={resolve:o,reject:r}});return t={...t,onDidFocus:o=>{o&&this._proxy.$onItemSelected(o.handle)}},t.canPickMany?this._quickInputService.pick(n,t,i).then(o=>{if(o)return o.map(r=>r.handle)}):this._quickInputService.pick(n,t,i).then(o=>{if(o)return o.handle})}$setItems(e,t){return this._items[e]&&(this._items[e].resolve(t),delete this._items[e]),Promise.resolve()}$setError(e,t){return this._items[e]&&(this._items[e].reject(t),delete this._items[e]),Promise.resolve()}$input(e,t,i){const n=Object.create(null);return e&&(n.title=e.title,n.password=e.password,n.placeHolder=e.placeHolder,n.valueSelection=e.valueSelection,n.prompt=e.prompt,n.value=e.value,n.ignoreFocusLost=e.ignoreFocusOut),t&&(n.validateInput=o=>this._proxy.$validateInput(o)),this._quickInputService.input(n,i)}$createOrUpdate(e){const t=e.id;let i=this.sessions.get(t);if(!i){const r=new U,a=e.type==="quickPick"?this._quickInputService.createQuickPick():this._quickInputService.createInputBox();if(r.add(a),r.add(a.onDidAccept(()=>{this._proxy.$onDidAccept(t)})),r.add(a.onDidTriggerButton(c=>{this._proxy.$onDidTriggerButton(t,c.handle)})),r.add(a.onDidChangeValue(c=>{this._proxy.$onDidChangeValue(t,c)})),r.add(a.onDidHide(()=>{this._proxy.$onDidHide(t)})),e.type==="quickPick"){const c=a;r.add(c.onDidChangeActive(d=>{this._proxy.$onDidChangeActive(t,d.map(l=>l.handle))})),r.add(c.onDidChangeSelection(d=>{this._proxy.$onDidChangeSelection(t,d.map(l=>l.handle))})),r.add(c.onDidTriggerItemButton(d=>{this._proxy.$onDidTriggerItemButton(t,d.item.handle,d.button.handle)}))}i={input:a,handlesToItems:new Map,store:r},this.sessions.set(t,i)}const{input:n,handlesToItems:o}=i;for(const r in e)r==="id"||r==="type"||(r==="visible"?e.visible?n.show():n.hide():r==="items"?(o.clear(),e[r].forEach(a=>{a.type!=="separator"&&(a.buttons&&(a.buttons=a.buttons.map(c=>(c.iconPath&&KJ(c.iconPath),c))),o.set(a.handle,a))}),n[r]=e[r]):r==="activeItems"||r==="selectedItems"?n[r]=e[r].filter(a=>o.has(a)).map(a=>o.get(a)):r==="buttons"?n[r]=e.buttons.map(a=>a.handle===-1?this._quickInputService.backButton:(a.iconPath&&KJ(a.iconPath),a)):n[r]=e[r]);return Promise.resolve(void 0)}$dispose(e){const t=this.sessions.get(e);return t&&(t.store.dispose(),this.sessions.delete(e)),Promise.resolve(void 0)}};jJ=f([ht($e.MainThreadQuickOpen),p(1,zt)],jJ);let YJ=class extends F{constructor(e,t,i){super(),this._environmentService=t,this._proxy=e.getProxy(Ye.ExtHostExtensionService);const n=this._environmentService.remoteAuthority;n&&this._register(i.onDidChangeConnectionData(()=>{const o=i.getConnectionData(n);o&&this._proxy.$updateRemoteConnectionData(o)}))}};YJ=f([n_,p(1,mn),p(2,Hh)],YJ);class OWe{constructor(e){this._proxy=e.getProxy(Ye.ExtHostDocumentSaveParticipant)}async participate(e,t,i,n){if(!e.textEditorModel||!Au(e.textEditorModel))return;const o=new Promise((r,a)=>{setTimeout(()=>a(new Error(h(2454,"Aborted onWillSaveTextDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason).then(c=>{if(!c.every(d=>d))return Promise.reject(new Error("listener failed"))}).then(r,a)});return KM(o,n)}}let QJ=class{constructor(e,t,i){this._textFileService=i,this._saveParticipantDisposable=this._textFileService.files.addSaveParticipant(t.createInstance(OWe,e))}dispose(){this._saveParticipantDisposable.dispose()}};QJ=f([n_,p(1,J),p(2,Ds)],QJ);let XJ=class{constructor(e,t,i){this.speechService=t,this.logService=i,this.providerRegistrations=new Map,this.speechToTextSessions=new Map,this.textToSpeechSessions=new Map,this.keywordRecognitionSessions=new Map,this.proxy=e.getProxy(Ye.ExtHostSpeech)}$registerProvider(e,t,i){this.logService.trace("[Speech] extension registered provider",i.extension.value);const n=this.speechService.registerSpeechProvider(t,{metadata:i,createSpeechToTextSession:(o,r)=>{if(o.isCancellationRequested)return{onDidChange:D.None};const a=new U,c=Math.random();this.proxy.$createSpeechToTextSession(e,c,r?.language);const d=a.add(new M);return this.speechToTextSessions.set(c,{onDidChange:d}),a.add(o.onCancellationRequested(()=>{this.proxy.$cancelSpeechToTextSession(c),this.speechToTextSessions.delete(c),a.dispose()})),{onDidChange:d.event}},createTextToSpeechSession:(o,r)=>{if(o.isCancellationRequested)return{onDidChange:D.None,synthesize:async()=>{}};const a=new U,c=Math.random();this.proxy.$createTextToSpeechSession(e,c,r?.language);const d=a.add(new M);return this.textToSpeechSessions.set(c,{onDidChange:d}),a.add(o.onCancellationRequested(()=>{this.proxy.$cancelTextToSpeechSession(c),this.textToSpeechSessions.delete(c),a.dispose()})),{onDidChange:d.event,synthesize:async l=>{await this.proxy.$synthesizeSpeech(c,l);const u=new U;try{await xh(D.toPromise(D.filter(d.event,g=>g.status===IH.Stopped,u),u),o)}finally{u.dispose()}}}},createKeywordRecognitionSession:o=>{if(o.isCancellationRequested)return{onDidChange:D.None};const r=new U,a=Math.random();this.proxy.$createKeywordRecognitionSession(e,a);const c=r.add(new M);return this.keywordRecognitionSessions.set(a,{onDidChange:c}),r.add(o.onCancellationRequested(()=>{this.proxy.$cancelKeywordRecognitionSession(a),this.keywordRecognitionSessions.delete(a),r.dispose()})),{onDidChange:c.event}}});this.providerRegistrations.set(e,{dispose:()=>{n.dispose()}})}$unregisterProvider(e){const t=this.providerRegistrations.get(e);t&&(t.dispose(),this.providerRegistrations.delete(e))}$emitSpeechToTextEvent(e,t){this.speechToTextSessions.get(e)?.onDidChange.fire(t)}$emitTextToSpeechEvent(e,t){this.textToSpeechSessions.get(e)?.onDidChange.fire(t)}$emitKeywordRecognitionEvent(e,t){this.keywordRecognitionSessions.get(e)?.onDidChange.fire(t)}dispose(){this.providerRegistrations.forEach(e=>e.dispose()),this.providerRegistrations.clear(),this.speechToTextSessions.forEach(e=>e.onDidChange.dispose()),this.speechToTextSessions.clear(),this.textToSpeechSessions.forEach(e=>e.onDidChange.dispose()),this.textToSpeechSessions.clear(),this.keywordRecognitionSessions.forEach(e=>e.onDidChange.dispose()),this.keywordRecognitionSessions.clear()}};XJ=f([ht($e.MainThreadSpeech),p(1,LN),p(2,Pe)],XJ);class FWe{constructor(e){this.timeout=2e4,this._proxy=e.getProxy(Ye.ExtHostWorkspace)}async participate(e,t){const i=new Promise((n,o)=>{setTimeout(()=>o(new Error(h(2407,"Aborted onWillCreateEditSessionIdentity-event after 10000ms"))),this.timeout),this._proxy.$onWillCreateEditSessionIdentity(e.uri,t,this.timeout).then(n,o)});return KM(i,t)}}let ZJ=class{constructor(e,t,i){this._editSessionIdentityService=i,this._saveParticipantDisposable=this._editSessionIdentityService.addEditSessionIdentityCreateParticipant(t.createInstance(FWe,e))}dispose(){this._saveParticipantDisposable.dispose()}};ZJ=f([n_,p(1,J),p(2,gz)],ZJ);function yL(s){if(s!==void 0){if(Te.isThemeIcon(s))return s;if(MT(s))return R.revive(s);{const e=s;return{light:R.revive(e.light),dark:R.revive(e.dark)}}}}function WWe(s){const e=yL(s.authorIcon),t=s.references?.map(i=>({...i,icon:yL(i.icon)}));return{...s,authorIcon:e,references:t}}function S_(s,e){return s?{...s,icon:yL(s.icon),color:e}:void 0}class BWe extends F{constructor(e,t,i){super(),this.modelService=t,this.languageService=i,this._register(e.registerTextModelContentProvider(ae.vscodeSourceControl,this))}async provideTextContent(e){const t=this.modelService.getModel(e);return t||this.modelService.createModel("",this.languageService.createById("scminput"),e)}}class VWe{get resourceTree(){if(!this._resourceTree){const e=this.provider.rootUri??R.file("/");this._resourceTree=new B0e(this,e,this._uriIdentService.extUri);for(const t of this.resources)this._resourceTree.add(t.sourceUri,t)}return this._resourceTree}get hideWhenEmpty(){return!!this.features.hideWhenEmpty}get contextValue(){return this.features.contextValue}constructor(e,t,i,n,o,r,a,c){this.sourceControlHandle=e,this.handle=t,this.provider=i,this.features=n,this.label=o,this.id=r,this.multiDiffEditorEnableViewChanges=a,this._uriIdentService=c,this.resources=[],this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._onDidChangeResources=new M,this.onDidChangeResources=this._onDidChangeResources.event}toJSON(){return{$mid:Nn.ScmResourceGroup,sourceControlHandle:this.sourceControlHandle,groupHandle:this.handle}}splice(e,t,i){this.resources.splice(e,t,...i),this._resourceTree=void 0,this._onDidChangeResources.fire()}$updateGroup(e){this.features={...this.features,...e},this._onDidChange.fire()}$updateGroupLabel(e){this.label=e,this._onDidChange.fire()}}class HWe{constructor(e,t,i,n,o,r,a,c,d,l,u){this.proxy=e,this.sourceControlHandle=t,this.groupHandle=i,this.handle=n,this.sourceUri=o,this.resourceGroup=r,this.decorations=a,this.contextValue=c,this.command=d,this.multiDiffEditorOriginalUri=l,this.multiDiffEditorModifiedUri=u}open(e){return this.proxy.$executeResourceCommand(this.sourceControlHandle,this.groupHandle,this.handle,e)}toJSON(){return{$mid:Nn.ScmResource,sourceControlHandle:this.sourceControlHandle,groupHandle:this.groupHandle,handle:this.handle}}}class UWe{get historyItemRef(){return this._historyItemRef}get historyItemRemoteRef(){return this._historyItemRemoteRef}get historyItemBaseRef(){return this._historyItemBaseRef}get historyItemRefChanges(){return this._historyItemRefChanges}constructor(e,t){this.proxy=e,this.handle=t,this._historyItemRef=aC({owner:this,equalsFn:kk},void 0),this._historyItemRemoteRef=aC({owner:this,equalsFn:kk},void 0),this._historyItemBaseRef=aC({owner:this,equalsFn:kk},void 0),this._historyItemRefChanges=oi(this,{added:[],modified:[],removed:[],silent:!1})}async resolveHistoryItemChatContext(e,t){return this.proxy.$resolveHistoryItemChatContext(this.handle,e,t??ye.None)}async resolveHistoryItemRefsCommonAncestor(e,t){return this.proxy.$resolveHistoryItemRefsCommonAncestor(this.handle,e,t??ye.None)}async provideHistoryItemRefs(e,t){return(await this.proxy.$provideHistoryItemRefs(this.handle,e,t??ye.None))?.map(n=>({...n,icon:yL(n.icon)}))}async provideHistoryItems(e,t){return(await this.proxy.$provideHistoryItems(this.handle,e,t??ye.None))?.map(n=>WWe(n))}async provideHistoryItemChanges(e,t,i){return(await this.proxy.$provideHistoryItemChanges(this.handle,e,t,i??ye.None))?.map(o=>({uri:R.revive(o.uri),originalUri:o.originalUri&&R.revive(o.originalUri),modifiedUri:o.modifiedUri&&R.revive(o.modifiedUri)}))}$onDidChangeCurrentHistoryItemRefs(e,t,i){ys(n=>{this._historyItemRef.set(S_(e,V0e),n),this._historyItemRemoteRef.set(S_(t,H0e),n),this._historyItemBaseRef.set(S_(i,U0e),n)})}$onDidChangeHistoryItemRefs(e){const t=e.added.map(o=>S_(o)),i=e.modified.map(o=>S_(o)),n=e.removed.map(o=>S_(o));this._historyItemRefChanges.set({added:t,modified:i,removed:n,silent:e.silent},void 0)}}class B4{static{this.ID_HANDLE=0}get id(){return this._id}get handle(){return this._handle}get label(){return this._label}get rootUri(){return this._rootUri}get inputBoxTextModel(){return this._inputBoxTextModel}get contextValue(){return this._providerId}get acceptInputCommand(){return this.features.acceptInputCommand}get count(){return this._count}get statusBarCommands(){return this._statusBarCommands}get name(){return this._name??this._label}get commitTemplate(){return this._commitTemplate}get actionButton(){return this._actionButton}get historyProvider(){return this._historyProvider}constructor(e,t,i,n,o,r,a,c,d){if(this.proxy=e,this._handle=t,this._providerId=i,this._label=n,this._rootUri=o,this._inputBoxTextModel=r,this._quickDiffService=a,this._uriIdentService=c,this._workspaceContextService=d,this._id=`scm${B4.ID_HANDLE++}`,this.groups=[],this._onDidChangeResourceGroups=new M,this.onDidChangeResourceGroups=this._onDidChangeResourceGroups.event,this._onDidChangeResources=new M,this.onDidChangeResources=this._onDidChangeResources.event,this._groupsByHandle=Object.create(null),this.features={},this._count=oi(this,void 0),this._statusBarCommands=oi(this,void 0),this._commitTemplate=oi(this,""),this._actionButton=oi(this,void 0),this._historyProvider=oi(this,void 0),o){const l=this._workspaceContextService.getWorkspaceFolder(o);l?.uri.toString()===o.toString()?this._name=l.name:o.path!=="/"&&(this._name=je(o))}}$updateSourceControl(e){if(this.features={...this.features,...e},typeof e.commitTemplate<"u"&&this._commitTemplate.set(e.commitTemplate,void 0),typeof e.actionButton<"u"&&this._actionButton.set(e.actionButton??void 0,void 0),typeof e.count<"u"&&this._count.set(e.count,void 0),typeof e.statusBarCommands<"u"&&this._statusBarCommands.set(e.statusBarCommands,void 0),e.hasQuickDiffProvider&&!this._quickDiff?this._quickDiff=this._quickDiffService.addQuickDiffProvider({id:`${this._providerId}.quickDiffProvider`,label:e.quickDiffLabel??this.label,rootUri:this.rootUri,kind:"primary",getOriginalResource:async t=>{if(!this.features.hasQuickDiffProvider)return null;const i=await this.proxy.$provideOriginalResource(this.handle,t,ye.None);return i&&R.revive(i)}}):e.hasQuickDiffProvider===!1&&this._quickDiff&&(this._quickDiff.dispose(),this._quickDiff=void 0),e.hasSecondaryQuickDiffProvider&&!this._stagedQuickDiff?this._stagedQuickDiff=this._quickDiffService.addQuickDiffProvider({id:`${this._providerId}.secondaryQuickDiffProvider`,label:e.secondaryQuickDiffLabel??this.label,rootUri:this.rootUri,kind:"secondary",getOriginalResource:async t=>{if(!this.features.hasSecondaryQuickDiffProvider)return null;const i=await this.proxy.$provideSecondaryOriginalResource(this.handle,t,ye.None);return i&&R.revive(i)}}):e.hasSecondaryQuickDiffProvider===!1&&this._stagedQuickDiff&&(this._stagedQuickDiff.dispose(),this._stagedQuickDiff=void 0),e.hasHistoryProvider&&!this.historyProvider.get()){const t=new UWe(this.proxy,this.handle);this._historyProvider.set(t,void 0)}else e.hasHistoryProvider===!1&&this.historyProvider.get()&&this._historyProvider.set(void 0,void 0)}$registerGroups(e){const t=e.map(([i,n,o,r,a])=>{const c=new VWe(this.handle,i,this,r,o,n,a,this._uriIdentService);return this._groupsByHandle[i]=c,c});this.groups.splice(this.groups.length,0,...t),this._onDidChangeResourceGroups.fire()}$updateGroup(e,t){const i=this._groupsByHandle[e];i&&i.$updateGroup(t)}$updateGroupLabel(e,t){const i=this._groupsByHandle[e];i&&i.$updateGroupLabel(t)}$spliceGroupResourceStates(e){for(const[t,i]of e){const n=this._groupsByHandle[t];if(!n){console.warn(`SCM group ${t} not found in provider ${this.label}`);continue}i.reverse();for(const[o,r,a]of i){const c=a.map(d=>{const[l,u,g,m,v,y,w,C,T,k]=d,[A,B]=g,z=Te.isThemeIcon(A)?A:R.revive(A),Q=(Te.isThemeIcon(B)?B:R.revive(B))||z,ie={icon:z,iconDark:Q,tooltip:m,strikeThrough:v,faded:y};return new HWe(this.proxy,this.handle,t,l,R.revive(u),n,ie,w||void 0,C,R.revive(T),R.revive(k))});n.splice(o,r,c)}}this._onDidChangeResources.fire()}$unregisterGroup(e){const t=this._groupsByHandle[e];t&&(delete this._groupsByHandle[e],this.groups.splice(this.groups.indexOf(t),1),this._onDidChangeResourceGroups.fire())}async getOriginalResource(e){if(!this.features.hasQuickDiffProvider)return null;const t=await this.proxy.$provideOriginalResource(this.handle,e,ye.None);return t&&R.revive(t)}$onDidChangeHistoryProviderCurrentHistoryItemRefs(e,t,i){this.historyProvider.get()&&this._historyProvider.get()?.$onDidChangeCurrentHistoryItemRefs(e,t,i)}$onDidChangeHistoryProviderHistoryItemRefs(e){this.historyProvider.get()&&this._historyProvider.get()?.$onDidChangeHistoryItemRefs(e)}toJSON(){return{$mid:Nn.ScmProvider,handle:this.handle}}dispose(){this._stagedQuickDiff?.dispose(),this._quickDiff?.dispose()}}let JJ=class{constructor(e,t,i,n,o,r,a,c,d){this.scmService=t,this.scmViewService=i,this.languageService=n,this.modelService=o,this.textModelService=r,this.quickDiffService=a,this._uriIdentService=c,this.workspaceContextService=d,this._repositories=new Map,this._repositoryBarriers=new Map,this._repositoryDisposables=new Map,this._disposables=new U,this._proxy=e.getProxy(Ye.ExtHostSCM),this._disposables.add(new BWe(this.textModelService,this.modelService,this.languageService))}dispose(){Qe(this._repositories.values()),this._repositories.clear(),Qe(this._repositoryDisposables.values()),this._repositoryDisposables.clear(),this._disposables.dispose()}async $registerSourceControl(e,t,i,n,o){this._repositoryBarriers.set(e,new Np);const r=await this.textModelService.createModelReference(R.revive(o)),a=new B4(this._proxy,e,t,i,n?R.revive(n):void 0,r.object.textEditorModel,this.quickDiffService,this._uriIdentService,this.workspaceContextService),c=this.scmService.registerSCMProvider(a);this._repositories.set(e,c);const d=Lo(r,D.filter(this.scmViewService.onDidFocusRepository,l=>l===c)(l=>this._proxy.$setSelectedSourceControl(e)),c.input.onDidChange(({value:l})=>this._proxy.$onInputBoxValueChange(e,l)));this._repositoryDisposables.set(e,d),this.scmViewService.focusedRepository===c&&setTimeout(()=>this._proxy.$setSelectedSourceControl(e),0),c.input.value&&setTimeout(()=>this._proxy.$onInputBoxValueChange(e,c.input.value),0),this._repositoryBarriers.get(e)?.open()}async $updateSourceControl(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$updateSourceControl(t)}async $unregisterSourceControl(e){await this._repositoryBarriers.get(e)?.wait();const t=this._repositories.get(e);t&&(this._repositoryDisposables.get(e).dispose(),this._repositoryDisposables.delete(e),t.dispose(),this._repositories.delete(e))}async $registerGroups(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);if(!n)return;const o=n.provider;o.$registerGroups(t),o.$spliceGroupResourceStates(i)}async $updateGroup(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);if(!n)return;n.provider.$updateGroup(t,i)}async $updateGroupLabel(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);if(!n)return;n.provider.$updateGroupLabel(t,i)}async $spliceResourceStates(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$spliceGroupResourceStates(t)}async $unregisterGroup(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$unregisterGroup(t)}async $setInputBoxValue(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&i.input.setValue(t,!1)}async $setInputBoxPlaceholder(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(i.input.placeholder=t)}async $setInputBoxEnablement(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(i.input.enabled=t)}async $setInputBoxVisibility(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(i.input.visible=t)}async $showValidationMessage(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);n&&n.input.showValidationMessage(t,i)}async $setValidationProviderIsEnabled(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(t?i.input.validateInput=async(n,o)=>{const r=await this._proxy.$validateInput(e,n,o);return r&&{message:r[0],type:r[1]}}:i.input.validateInput=async()=>{})}async $onDidChangeHistoryProviderCurrentHistoryItemRefs(e,t,i,n){await this._repositoryBarriers.get(e)?.wait();const o=this._repositories.get(e);if(!o)return;o.provider.$onDidChangeHistoryProviderCurrentHistoryItemRefs(t,i,n)}async $onDidChangeHistoryProviderHistoryItemRefs(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$onDidChangeHistoryProviderHistoryItemRefs(t)}};JJ=f([ht($e.MainThreadSCM),p(1,vre),p(2,_re),p(3,fi),p(4,ai),p(5,yi),p(6,RN),p(7,Zi),p(8,Tt)],JJ);var eee;(function(s){s.FindInFilesActionId="workbench.action.findInFiles",s.FocusActiveEditorCommandId="search.action.focusActiveEditor",s.FocusSearchFromResults="search.action.focusSearchFromResults",s.OpenMatch="search.action.openResult",s.OpenMatchToSide="search.action.openResultToSide",s.RemoveActionId="search.action.remove",s.CopyPathCommandId="search.action.copyPath",s.CopyMatchCommandId="search.action.copyMatch",s.CopyAllCommandId="search.action.copyAll",s.OpenInEditorCommandId="search.action.openInEditor",s.ClearSearchHistoryCommandId="search.action.clearHistory",s.FocusSearchListCommandID="search.action.focusSearchList",s.ReplaceActionId="search.action.replace",s.ReplaceAllInFileActionId="search.action.replaceAllInFile",s.ReplaceAllInFolderActionId="search.action.replaceAllInFolder",s.CloseReplaceWidgetActionId="closeReplaceInFilesWidget",s.ToggleCaseSensitiveCommandId="toggleSearchCaseSensitive",s.ToggleWholeWordCommandId="toggleSearchWholeWord",s.ToggleRegexCommandId="toggleSearchRegex",s.TogglePreserveCaseId="toggleSearchPreserveCase",s.AddCursorsAtSearchResults="addCursorsAtSearchResults",s.RevealInSideBarForSearchResults="search.action.revealInSideBar",s.ReplaceInFilesActionId="workbench.action.replaceInFiles",s.ShowAllSymbolsActionId="workbench.action.showAllSymbols",s.QuickTextSearchActionId="workbench.action.quickTextSearch",s.CancelSearchActionId="search.action.cancel",s.RefreshSearchResultsActionId="search.action.refreshSearchResults",s.FocusNextSearchResultActionId="search.action.focusNextSearchResult",s.FocusPreviousSearchResultActionId="search.action.focusPreviousSearchResult",s.ToggleSearchOnTypeActionId="workbench.action.toggleSearchOnType",s.CollapseSearchResultsActionId="search.action.collapseSearchResults",s.ExpandSearchResultsActionId="search.action.expandSearchResults",s.ExpandRecursivelyCommandId="search.action.expandRecursively",s.ClearSearchResultsActionId="search.action.clearSearchResults",s.GetSearchResultsActionId="search.action.getSearchResults",s.ViewAsTreeActionId="search.action.viewAsTree",s.ViewAsListActionId="search.action.viewAsList",s.ShowAIResultsActionId="search.action.showAIResults",s.HideAIResultsActionId="search.action.hideAIResults",s.SearchWithAIActionId="search.action.searchWithAI",s.ToggleQueryDetailsActionId="workbench.action.search.toggleQueryDetails",s.ExcludeFolderFromSearchId="search.action.excludeFromSearch",s.FocusNextInputActionId="search.focus.nextInputBox",s.FocusPreviousInputActionId="search.focus.previousInputBox",s.RestrictSearchToFolderId="search.action.restrictSearchToFolder",s.FindInFolderId="filesExplorer.findInFolder",s.FindInWorkspaceId="filesExplorer.findInWorkspace"})(eee||(eee={}));const $We={SearchViewVisibleKey:new O("searchViewletVisible",!0),SearchViewFocusedKey:new O("searchViewletFocus",!1),SearchResultListFocusedKey:new O("searchResultListFocused",!0),InputBoxFocusedKey:new O("inputBoxFocus",!1),SearchInputBoxFocusedKey:new O("searchInputBoxFocus",!1),ReplaceInputBoxFocusedKey:new O("replaceInputBoxFocus",!1),PatternIncludesFocusedKey:new O("patternIncludesInputBoxFocus",!1),PatternExcludesFocusedKey:new O("patternExcludesInputBoxFocus",!1),ReplaceActiveKey:new O("replaceActive",!1),HasSearchResults:new O("hasSearchResult",!1),FirstMatchFocusKey:new O("firstMatchFocus",!1),FileMatchOrMatchFocusKey:new O("fileMatchOrMatchFocus",!1),FileMatchOrFolderMatchFocusKey:new O("fileMatchOrFolderMatchFocus",!1),FileMatchOrFolderMatchWithResourceFocusKey:new O("fileMatchOrFolderMatchWithResourceFocus",!1),FileFocusKey:new O("fileMatchFocus",!1),FolderFocusKey:new O("folderMatchFocus",!1),ResourceFolderFocusKey:new O("folderMatchWithResourceFocus",!1),IsEditableItemKey:new O("isEditableItem",!0),MatchFocusKey:new O("matchFocus",!1),SearchResultHeaderFocused:new O("searchResultHeaderFocused",!1),ViewHasSearchPatternKey:new O("viewHasSearchPattern",!1),ViewHasReplacePatternKey:new O("viewHasReplacePattern",!1),ViewHasFilePatternKey:new O("viewHasFilePattern",!1),ViewHasSomeCollapsibleKey:new O("viewHasSomeCollapsibleResult",!1),InTreeViewKey:new O("inTreeView",!1),hasAIResultProvider:new O("hasAIResultProviderKey",!1),AIResultsTitle:new O("aiResultsTitle",!1),AIResultsRequested:new O("aiResultsRequested",!1)};let tee=class{constructor(e,t,i,n,o){this._searchService=t,this._telemetryService=i,this.contextKeyService=o,this._searchProvider=new Map,this._proxy=e.getProxy(Ye.ExtHostSearch),this._proxy.$enableExtensionHostSearch()}dispose(){this._searchProvider.forEach(e=>e.dispose()),this._searchProvider.clear()}$registerTextSearchProvider(e,t){this._searchProvider.set(e,new z0(this._searchService,MC.text,t,e,this._proxy))}$registerAITextSearchProvider(e,t){$We.hasAIResultProvider.bindTo(this.contextKeyService).set(!0),this._searchProvider.set(e,new z0(this._searchService,MC.aiText,t,e,this._proxy))}$registerFileSearchProvider(e,t){this._searchProvider.set(e,new z0(this._searchService,MC.file,t,e,this._proxy))}$unregisterProvider(e){Qe(this._searchProvider.get(e)),this._searchProvider.delete(e)}$handleFileMatch(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleFindMatch(t,i)}$handleTextMatch(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleFindMatch(t,i)}$handleKeywordResult(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleKeywordResult(t,i)}$handleTelemetry(e,t){this._telemetryService.publicLog(e,t)}};tee=f([ht($e.MainThreadSearch),p(1,DI),p(2,li),p(3,ne),p(4,me)],tee);class V4{static{this._idPool=0}constructor(e,t=++V4._idPool,i=new Map,n=[]){this.progress=e,this.id=t,this.matches=i,this.keywords=n}addMatch(e){const t=this.matches.get(e.resource.toString());t?t.results&&e.results&&t.results.push(...e.results):this.matches.set(e.resource.toString(),e),this.progress?.(e)}addKeyword(e){this.keywords.push(e),this.progress?.(e)}}class z0{constructor(e,t,i,n,o){this._scheme=i,this._handle=n,this._proxy=o,this._registrations=new U,this._searches=new Map,this._registrations.add(e.registerSearchResultProvider(this._scheme,t,this))}async getAIName(){return this.cachedAIName===void 0&&(this.cachedAIName=await this._proxy.$getAIName(this._handle)),this.cachedAIName}dispose(){this._registrations.dispose()}fileSearch(e,t=ye.None){return this.doSearch(e,void 0,t)}textSearch(e,t,i=ye.None){return this.doSearch(e,t,i)}doSearch(e,t,i=ye.None){if(!e.folderQueries.length)throw new Error("Empty folderQueries");const n=new V4(t);this._searches.set(n.id,n);const o=this._provideSearchResults(e,n.id,i);return Promise.resolve(o).then(r=>(this._searches.delete(n.id),{results:Array.from(n.matches.values()),aiKeywords:Array.from(n.keywords),stats:r.stats,limitHit:r.limitHit,messages:r.messages}),r=>(this._searches.delete(n.id),Promise.reject(r)))}clearCache(e){return Promise.resolve(this._proxy.$clearCache(e))}handleFindMatch(e,t){const i=this._searches.get(e);i&&t.forEach(n=>{n.results?i.addMatch(cn(n)):i.addMatch({resource:R.revive(n)})})}handleKeywordResult(e,t){const i=this._searches.get(e);i&&i.addKeyword(t)}_provideSearchResults(e,t,i){switch(e.type){case Ep.File:return this._proxy.$provideFileSearchResults(this._handle,t,e,i);case Ep.Text:return this._proxy.$provideTextSearchResults(this._handle,t,e,i);default:return this._proxy.$provideAITextSearchResults(this._handle,t,e,i)}}}let iee=class{constructor(e,t){this.statusbarService=t,this._store=new U,this._proxy=e.getProxy(Ye.ExtHostStatusBar);const i=[];for(const[o,r]of t.getEntries())i.push(n(o,r));this._proxy.$acceptStaticEntries(i),this._store.add(t.onDidChange(o=>{o.added&&this._proxy.$acceptStaticEntries([n(o.added[0],o.added[1])])}));function n(o,r){return{entryId:o,name:r.entry.name,text:r.entry.text,tooltip:r.entry.tooltip,command:typeof r.entry.command=="string"?r.entry.command:typeof r.entry.command=="object"?r.entry.command.id:void 0,priority:r.priority,alignLeft:r.alignment===iv.LEFT,accessibilityInformation:r.entry.ariaLabel?{label:r.entry.ariaLabel,role:r.entry.role}:void 0}}}dispose(){this._store.dispose()}$setEntry(e,t,i,n,o,r,a,c,d,l,u,g,m){const v=a?{markdown:w=>this._proxy.$provideTooltip(e,w),markdownNotSupportedFallback:void 0}:r;this.statusbarService.setOrUpdateEntry(e,t,i,n,o,v,c,d,l,u,g,m)===my.DidDefine&&this._store.add(Ee(()=>this.statusbarService.unsetEntry(e)))}$disposeEntry(e){this.statusbarService.unsetEntry(e)}};iee=f([ht($e.MainThreadStatusBar),p(1,_z)],iee);async function GWe(s,e,t,i){return i.invokeFunction(async n=>{const o=n.get(po),r=n.get(Wv),a=n.get(lz),c=n.get(tt),d=n.get(Zi),l=n.get(Xe),u=n.get(Tt),g=n.get(Pe),m=`extensionStorage.migrate.${s}-${e}`,v=s.toLowerCase()===e.toLowerCase()?`extension.storage.migrateFromLowerCaseKey.${s.toLowerCase()}`:void 0;if(s===e)return;const y=(C,T)=>T?d.extUri.joinPath(r.defaultProfile.globalStorageHome,C.toLowerCase()):d.extUri.joinPath(o.workspaceStorageHome,u.getWorkspace().id,C),w=t?he.PROFILE:he.WORKSPACE;if(!c.getBoolean(m,w,!1)&&!(v&&c.getBoolean(v,w,!1))){g.info(`Migrating ${t?"global":"workspace"} extension storage from ${s} to ${e}...`);const C=a.getExtensionState(s,t);C&&(a.setExtensionState(e,C,t),a.setExtensionState(s,void 0,t));const T=y(s,t),k=y(e,t);if(!d.extUri.isEqual(T,k))try{await l.move(T,k,!0)}catch(A){A.code!==cr.FileNotFound&&g.info(`Error while migrating ${t?"global":"workspace"} file storage from '${s}' to '${e}'`,ba(A))}g.info(`Migrated ${t?"global":"workspace"} extension storage from ${s} to ${e}`),c.store(m,!0,w,pt.MACHINE)}})}let nee=class{constructor(e,t,i,n,o){this._extensionStorageService=t,this._storageService=i,this._instantiationService=n,this._logService=o,this._storageListener=new U,this._sharedStorageKeysToWatch=new Map,this._proxy=e.getProxy(Ye.ExtHostStorage),this._storageListener.add(this._storageService.onDidChangeValue(he.PROFILE,void 0,this._storageListener)(r=>{if(this._sharedStorageKeysToWatch.has(r.key)){const a=this._extensionStorageService.getExtensionStateRaw(r.key,!0);typeof a=="string"&&this._proxy.$acceptValue(!0,r.key,a)}}))}dispose(){this._storageListener.dispose()}async $initializeExtensionStorage(e,t){return await this.checkAndMigrateExtensionStorage(t,e),e&&this._sharedStorageKeysToWatch.set(t,!0),this._extensionStorageService.getExtensionStateRaw(t,e)}async $setValue(e,t,i){this._extensionStorageService.setExtensionState(t,i,e)}$registerExtensionStorageKeysToSync(e,t){this._extensionStorageService.setKeysForSync(e,t)}async checkAndMigrateExtensionStorage(e,t){try{let i=this._extensionStorageService.getSourceExtensionToMigrate(e);!i&&$t&&e!==e.toLowerCase()&&(i=e.toLowerCase()),i&&($t&&i!==i.toLowerCase()&&this._extensionStorageService.getExtensionState(i.toLowerCase(),t)&&!this._extensionStorageService.getExtensionState(i,t)&&(i=i.toLowerCase()),await GWe(i,e,t,this._instantiationService))}catch(i){this._logService.error(i)}}};nee=f([ht($e.MainThreadStorage),p(1,lz),p(2,tt),p(3,J),p(4,Pe)],nee);var f$;let see=class extends F{static{f$=this}static{this._name="pluginHostTelemetry"}constructor(e,t,i,n,o){super(),this._telemetryService=t,this._configurationService=i,this._environmentService=n,this._productService=o,this._proxy=e.getProxy(Ye.ExtHostTelemetry),xk(this._productService,this._environmentService)&&this._register(this._configurationService.onDidChangeConfiguration(r=>{(r.affectsConfiguration(Rbe)||r.affectsConfiguration(Pbe))&&this._proxy.$onDidChangeTelemetryLevel(this.telemetryLevel)})),this._proxy.$initializeTelemetryLevel(this.telemetryLevel,xk(this._productService,this._environmentService),this._productService.enabledTelemetryLevels)}get telemetryLevel(){return xk(this._productService,this._environmentService)?this._telemetryService.telemetryLevel:vq.NONE}$publicLog(e,t=Object.create(null)){t[f$._name]=!0,this._telemetryService.publicLog(e,t)}$publicLog2(e,t){this.$publicLog(e,t)}};see=f$=f([ht($e.MainThreadTelemetry),p(1,li),p(2,ne),p(3,po),p(4,Fn)],see);let m$=class extends F{get onProcessReady(){return this._onProcessReady.event}constructor(e,t,i,n){super(),this.instanceId=e,this._cols=t,this._rows=i,this._terminalService=n,this.id=0,this.shouldPersist=!1,this._onProcessData=this._register(new M),this.onProcessData=this._onProcessData.event,this._onProcessReady=this._register(new M),this._onStart=this._register(new M),this.onStart=this._onStart.event,this._onInput=this._register(new M),this.onInput=this._onInput.event,this._onBinary=this._register(new M),this.onBinary=this._onBinary.event,this._onResize=this._register(new M),this.onResize=this._onResize.event,this._onAcknowledgeDataEvent=this._register(new M),this.onAcknowledgeDataEvent=this._onAcknowledgeDataEvent.event,this._onShutdown=this._register(new M),this.onShutdown=this._onShutdown.event,this._onRequestInitialCwd=this._register(new M),this.onRequestInitialCwd=this._onRequestInitialCwd.event,this._onRequestCwd=this._register(new M),this.onRequestCwd=this._onRequestCwd.event,this._onDidChangeProperty=this._register(new M),this.onDidChangeProperty=this._onDidChangeProperty.event,this._onProcessExit=this._register(new M),this.onProcessExit=this._onProcessExit.event,this._pendingInitialCwdRequests=[],this._pendingCwdRequests=[]}emitData(e){this._onProcessData.fire(e)}emitTitle(e){this._onDidChangeProperty.fire({type:Hd.Title,value:e})}emitReady(e,t){this._onProcessReady.fire({pid:e,cwd:t,windowsPty:void 0})}emitProcessProperty({type:e,value:t}){switch(e){case Hd.Cwd:this.emitCwd(t);break;case Hd.InitialCwd:this.emitInitialCwd(t);break;case Hd.Title:this.emitTitle(t);break;case Hd.OverrideDimensions:this.emitOverrideDimensions(t);break;case Hd.ResolvedShellLaunchConfig:this.emitResolvedShellLaunchConfig(t);break}}emitExit(e){this._onProcessExit.fire(e),this.dispose()}emitOverrideDimensions(e){this._onDidChangeProperty.fire({type:Hd.OverrideDimensions,value:e})}emitResolvedShellLaunchConfig(e){this._onDidChangeProperty.fire({type:Hd.ResolvedShellLaunchConfig,value:e})}emitInitialCwd(e){for(;this._pendingInitialCwdRequests.length>0;)this._pendingInitialCwdRequests.pop()(e)}emitCwd(e){for(;this._pendingCwdRequests.length>0;)this._pendingCwdRequests.pop()(e)}async start(){return this._terminalService.requestStartExtensionTerminal(this,this._cols,this._rows)}shutdown(e){this._onShutdown.fire(e)}input(e){this._onInput.fire(e)}resize(e,t){this._onResize.fire({cols:e,rows:t})}clearBuffer(){}acknowledgeDataEvent(){}async setUnicodeVersion(e){}async processBinary(e){this._onBinary.fire(e)}getInitialCwd(){return new Promise(e=>{this._onRequestInitialCwd.fire(),this._pendingInitialCwdRequests.push(e)})}getCwd(){return new Promise(e=>{this._onRequestCwd.fire(),this._pendingCwdRequests.push(e)})}async refreshProperty(e){}async updateProperty(e,t){}};m$=f([p(3,Ew)],m$);var JC;(function(s){s[s.TerminalCommand=0]="TerminalCommand",s[s.Opener=1]="Opener",s[s.Port=2]="Port",s[s.VscodeCommand=3]="VscodeCommand"})(JC||(JC={}));var Zl;(function(s){s[s.CwdDetection=0]="CwdDetection",s[s.NaiveCwdDetection=1]="NaiveCwdDetection",s[s.CommandDetection=2]="CommandDetection",s[s.PartialCommandDetection=3]="PartialCommandDetection",s[s.BufferMarkDetection=4]="BufferMarkDetection",s[s.ShellEnvDetection=5]="ShellEnvDetection"})(Zl||(Zl={}));var oee;(function(s){s.Windows="windows",s.NoProblemsReported="noProblemsReported"})(oee||(oee={}));let ree=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){this._terminalService=t,this._terminalLinkProviderService=i,this._terminalQuickFixService=n,this._instantiationService=o,this._environmentVariableService=r,this._logService=a,this._terminalProfileResolverService=c,this._terminalGroupService=l,this._terminalEditorService=u,this._terminalProfileService=g,this._terminalCompletionService=m,this._environmentService=v,this._store=new U,this._extHostTerminals=new Map,this._terminalProcessProxies=new Map,this._profileProviders=new Map,this._completionProviders=new Map,this._quickFixProviders=new Map,this._dataEventTracker=new kt,this._sendCommandEventListener=new kt,this._linkProvider=this._store.add(new kt),this._os=Yu,this._proxy=e.getProxy(Ye.ExtHostTerminalService),this._store.add(t.onDidCreateInstance(w=>{this._onTerminalOpened(w),this._onInstanceDimensionsChanged(w)})),this._store.add(t.onDidDisposeInstance(w=>this._onTerminalDisposed(w))),this._store.add(t.onAnyInstanceProcessIdReady(w=>this._onTerminalProcessIdReady(w))),this._store.add(t.onDidChangeInstanceDimensions(w=>this._onInstanceDimensionsChanged(w))),this._store.add(t.onAnyInstanceMaximumDimensionsChange(w=>this._onInstanceMaximumDimensionsChanged(w))),this._store.add(t.onDidRequestStartExtensionTerminal(w=>this._onRequestStartExtensionTerminal(w))),this._store.add(t.onDidChangeActiveInstance(w=>this._onActiveTerminalChanged(w?w.instanceId:null))),this._store.add(t.onAnyInstanceTitleChange(w=>w&&this._onTitleChanged(w.instanceId,w.title))),this._store.add(t.onAnyInstanceDataInput(w=>this._proxy.$acceptTerminalInteraction(w.instanceId))),this._store.add(t.onAnyInstanceSelectionChange(w=>this._proxy.$acceptTerminalSelection(w.instanceId,w.selection))),this._store.add(t.onAnyInstanceShellTypeChanged(w=>this._onShellTypeChanged(w.instanceId)));for(const w of this._terminalService.instances)this._onTerminalOpened(w),w.processReady.then(()=>this._onTerminalProcessIdReady(w)),w.shellType&&this._proxy.$acceptTerminalShellType(w.instanceId,w.shellType);const y=this._terminalService.activeInstance;if(y&&this._proxy.$acceptActiveTerminalChanged(y.instanceId),this._environmentVariableService.collections.size>0){const C=[...this._environmentVariableService.collections.entries()].map(T=>[T[0],RTe(T[1].map)]);this._proxy.$initEnvironmentVariableCollections(C)}d.getEnvironment().then(async w=>{this._os=w?.os||Yu,this._updateDefaultProfile()}),this._store.add(this._terminalProfileService.onDidChangeAvailableProfiles(()=>this._updateDefaultProfile()))}dispose(){this._store.dispose();for(const e of this._profileProviders.values())e.dispose();for(const e of this._quickFixProviders.values())e.dispose()}async _updateDefaultProfile(){const e=this._environmentService.remoteAuthority,t=this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:e,os:this._os}),i=this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:e,os:this._os,allowAutomationShell:!0});this._proxy.$acceptDefaultProfile(...await Promise.all([t,i]))}async _getTerminalInstance(e){return typeof e=="string"?this._extHostTerminals.get(e):this._terminalService.getInstanceFromId(e)}async $createTerminal(e,t){const i={name:t.name,executable:t.shellPath,args:t.shellArgs,cwd:typeof t.cwd=="string"?t.cwd:R.revive(t.cwd),icon:t.icon,color:t.color,initialText:t.initialText,waitOnExit:t.waitOnExit,ignoreConfigurationCwd:!0,env:t.env,strictEnv:t.strictEnv,hideFromUser:t.hideFromUser,customPtyImplementation:t.isExtensionCustomPtyTerminal?(r,a,c)=>new m$(r,a,c,this._terminalService):void 0,extHostTerminalId:e,forceShellIntegration:t.forceShellIntegration,isFeatureTerminal:t.isFeatureTerminal,isExtensionOwnedTerminal:t.isExtensionOwnedTerminal,useShellEnvironment:t.useShellEnvironment,isTransient:t.isTransient},n=Op.withAsyncBody(async r=>{const a=await this._terminalService.createTerminal({config:i,location:await this._deserializeParentTerminal(t.location)});r(a)});this._extHostTerminals.set(e,n);const o=await n;this._store.add(o.onDisposed(()=>{this._extHostTerminals.delete(e)}))}async _deserializeParentTerminal(e){if(typeof e=="object"&&"parentTerminal"in e){const t=await this._extHostTerminals.get(e.parentTerminal.toString());return t?{parentTerminal:t}:void 0}return e}async $show(e,t){const i=await this._getTerminalInstance(e);i&&(this._terminalService.setActiveInstance(i),i.target===fy.Editor?await this._terminalEditorService.revealActiveEditor(t):await this._terminalGroupService.showPanel(!t))}async $hide(e){const t=await this._getTerminalInstance(e),i=this._terminalService.activeInstance;i&&i.instanceId===t?.instanceId&&i.target!==fy.Editor&&this._terminalGroupService.hidePanel()}async $dispose(e){(await this._getTerminalInstance(e))?.dispose(Im.Extension)}async $sendText(e,t,i){await(await this._getTerminalInstance(e))?.sendText(t,i)}$sendProcessExit(e,t){this._terminalProcessProxies.get(e)?.emitExit(t)}$startSendingDataEvents(){if(!this._dataEventTracker.value){this._dataEventTracker.value=this._instantiationService.createInstance(v$,(e,t)=>{this._onTerminalData(e,t)});for(const e of this._terminalService.instances)for(const t of e.initialDataEvents||[])this._onTerminalData(e.instanceId,t)}}$stopSendingDataEvents(){this._dataEventTracker.clear()}$startSendingCommandEvents(){if(this._sendCommandEventListener.value)return;const e=this._terminalService.createOnInstanceCapabilityEvent(Zl.CommandDetection,i=>i.onCommandFinished),t=e.event(i=>{this._onDidExecuteCommand(i.instance.instanceId,{commandLine:i.data.command,cwd:i.data.cwd,exitCode:i.data.exitCode,output:i.data.getOutput()})});this._sendCommandEventListener.value=Lo(e,t)}$stopSendingCommandEvents(){this._sendCommandEventListener.clear()}$startLinkProvider(){this._linkProvider.value=this._terminalLinkProviderService.registerLinkProvider(new qWe(this._proxy))}$stopLinkProvider(){this._linkProvider.clear()}$registerProcessSupport(e){this._terminalService.registerProcessSupport(e)}$registerCompletionProvider(e,t,...i){this._completionProviders.set(e,this._terminalCompletionService.registerTerminalCompletionProvider(t,e,{id:e,provideCompletions:async(n,o,r,a)=>{const c=await this._proxy.$provideTerminalCompletions(e,{commandLine:n,cursorPosition:o,allowFallbackCompletions:r},a);return{items:c?.items.map(d=>({...d,provider:e})),resourceRequestConfig:c?.resourceRequestConfig}}},...i))}$unregisterCompletionProvider(e){this._completionProviders.get(e)?.dispose(),this._completionProviders.delete(e)}$registerProfileProvider(e,t){this._profileProviders.set(e,this._terminalProfileService.registerTerminalProfileProvider(t,e,{createContributedTerminalProfile:async i=>this._proxy.$createContributedProfileTerminal(e,i)}))}$unregisterProfileProvider(e){this._profileProviders.get(e)?.dispose(),this._profileProviders.delete(e)}async $registerQuickFixProvider(e,t){this._quickFixProviders.set(e,this._terminalQuickFixService.registerQuickFixProvider(e,{provideTerminalQuickFixes:async(i,n,o,r)=>{if(r.isCancellationRequested)return;o.outputMatcher?.length&&o.outputMatcher.length>40&&(o.outputMatcher.length=40,this._logService.warn("Cannot exceed output matcher length of 40"));const a=i.command.match(o.commandLineMatcher);if(!a||!n)return;const c=o.outputMatcher;let d;if(c&&(d=zWe(n,c)),!d)return;const l={commandLineMatch:a,outputMatch:d,commandLine:i.command};if(l){const u=await this._proxy.$provideTerminalQuickFixes(e,l,r);if(u&&Array.isArray(u))return u.map(g=>aee(e,t,g));if(u)return aee(e,t,u)}}}))}$unregisterQuickFixProvider(e){this._quickFixProviders.get(e)?.dispose(),this._quickFixProviders.delete(e)}_onActiveTerminalChanged(e){this._proxy.$acceptActiveTerminalChanged(e)}_onTerminalData(e,t){this._proxy.$acceptTerminalProcessData(e,t)}_onDidExecuteCommand(e,t){this._proxy.$acceptDidExecuteCommand(e,t)}_onTitleChanged(e,t){this._proxy.$acceptTerminalTitleChange(e,t)}_onShellTypeChanged(e){const t=this._terminalService.getInstanceFromId(e);t&&this._proxy.$acceptTerminalShellType(e,t.shellType)}_onTerminalDisposed(e){this._proxy.$acceptTerminalClosed(e.instanceId,e.exitCode,e.exitReason??Im.Unknown)}_onTerminalOpened(e){const t=e.shellLaunchConfig.extHostTerminalId,i={name:e.shellLaunchConfig.name,executable:e.shellLaunchConfig.executable,args:e.shellLaunchConfig.args,cwd:e.shellLaunchConfig.cwd,env:e.shellLaunchConfig.env,hideFromUser:e.shellLaunchConfig.hideFromUser,tabActions:e.shellLaunchConfig.tabActions};this._proxy.$acceptTerminalOpened(e.instanceId,t,e.title,i)}_onTerminalProcessIdReady(e){e.processId!==void 0&&this._proxy.$acceptTerminalProcessId(e.instanceId,e.processId)}_onInstanceDimensionsChanged(e){this._proxy.$acceptTerminalDimensions(e.instanceId,e.cols,e.rows)}_onInstanceMaximumDimensionsChanged(e){this._proxy.$acceptTerminalMaximumDimensions(e.instanceId,e.maxCols,e.maxRows)}_onRequestStartExtensionTerminal(e){const t=e.proxy;this._terminalProcessProxies.set(t.instanceId,t);const i=e.cols&&e.rows?{columns:e.cols,rows:e.rows}:void 0;this._proxy.$startExtensionTerminal(t.instanceId,i).then(e.callback),t.onInput(n=>this._proxy.$acceptProcessInput(t.instanceId,n)),t.onShutdown(n=>this._proxy.$acceptProcessShutdown(t.instanceId,n)),t.onRequestCwd(()=>this._proxy.$acceptProcessRequestCwd(t.instanceId)),t.onRequestInitialCwd(()=>this._proxy.$acceptProcessRequestInitialCwd(t.instanceId))}$sendProcessData(e,t){this._terminalProcessProxies.get(e)?.emitData(t)}$sendProcessReady(e,t,i,n){this._terminalProcessProxies.get(e)?.emitReady(t,i,n)}$sendProcessProperty(e,t){t.type===Hd.Title&&this._terminalService.getInstanceFromId(e)?.rename(t.value),this._terminalProcessProxies.get(e)?.emitProcessProperty(t)}$setEnvironmentVariableCollection(e,t,i,n){if(i){const o={persistent:t,map:PTe(i),descriptionMap:LTe(n)};this._environmentVariableService.set(e,o)}else this._environmentVariableService.delete(e)}};ree=f([ht($e.MainThreadTerminalService),p(1,Ew),p(2,Ire),p(3,Dre),p(4,J),p(5,Cre),p(6,Pe),p(7,Ere),p(8,Nh),p(9,Dz),p(10,wre),p(11,xre),p(12,kre),p(13,mn)],ree);let v$=class extends F{constructor(e,t){super(),this._callback=e,this._terminalService=t,this._register(this._bufferer=new MTe(this._callback));for(const i of this._terminalService.instances)this._registerInstance(i);this._register(this._terminalService.onDidCreateInstance(i=>this._registerInstance(i))),this._register(this._terminalService.onDidDisposeInstance(i=>this._bufferer.stopBuffering(i.instanceId)))}_registerInstance(e){this._register(this._bufferer.startBuffering(e.instanceId,e.onData))}};v$=f([p(1,Ew)],v$);class qWe{constructor(e){this._proxy=e}async provideLinks(e,t){const i=this._proxy;return(await i.$provideLinks(e.instanceId,t)).map(o=>({id:o.id,startIndex:o.startIndex,length:o.length,label:o.label,activate:()=>i.$activateLink(e.instanceId,o.id)}))}}function zWe(s,e){const t=s.join(`
`).match(e.lineMatcher);return t?{regexMatch:t,outputLines:s}:void 0}function aee(s,e,t){let i=JC.TerminalCommand;return"uri"in t?(t.uri=R.revive(t.uri),i=JC.Opener):"id"in t&&(i=JC.VscodeCommand),{id:s,type:i,source:e,...t}}let cee=class extends F{constructor(e,t,i){super(),this._terminalService=t,this._proxy=e.getProxy(Ye.ExtHostTerminalShellIntegration);const n=new Map;this._register(Ee(()=>{for(const u of n.values())u.dispose()}));for(const u of this._terminalService.instances)u.capabilities.get(Zl.CommandDetection)&&this._enableShellIntegration(u);const o=this._store.add(this._terminalService.createOnInstanceEvent(u=>D.map(D.filter(u.capabilities.onDidAddCapabilityType,g=>g===Zl.CommandDetection),()=>u))).event;this._store.add(o(u=>this._enableShellIntegration(u)));const r=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(Zl.CwdDetection,u=>u.onDidChangeCwd));this._store.add(r.event(u=>{this._proxy.$cwdChange(u.instance.instanceId,this._convertCwdToUri(u.data))}));const a=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(Zl.ShellEnvDetection,u=>u.onDidChangeEnv));this._store.add(a.event(u=>{if(u.data.value&&typeof u.data.value=="object"){const g=u.data.value,m=Object.keys(g),v=Object.values(g);this._proxy.$shellEnvChange(u.instance.instanceId,m,v,u.data.isTrusted)}}));const c=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(Zl.CommandDetection,u=>u.onCommandExecuted));let d;this._store.add(c.event(u=>{if(u.data===d)return;d=u.data;const g=u.instance.instanceId;this._proxy.$shellExecutionStart(g,u.data.command,dee(u.data),u.data.isTrusted,this._convertCwdToUri(u.data.cwd)),n.get(g)?.dispose(),n.set(g,D.accumulate(u.instance.onData,50,this._store)(m=>{this._proxy.$shellExecutionData(g,m.join(""))}))}));const l=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(Zl.CommandDetection,u=>u.onCommandFinished));this._store.add(l.event(u=>{d=void 0;const g=u.instance.instanceId;n.get(g)?.dispose(),this._proxy.$shellExecutionEnd(g,u.data.command,dee(u.data),u.data.isTrusted,u.data.exitCode)})),this._store.add(this._terminalService.onDidDisposeInstance(u=>this._proxy.$closeTerminal(u.instanceId)))}$executeCommand(e,t){this._terminalService.getInstanceFromId(e)?.runCommand(t,!0)}_convertCwdToUri(e){return e?R.file(e):void 0}_enableShellIntegration(e){this._proxy.$shellIntegrationChange(e.instanceId);const t=e.capabilities.get(Zl.CwdDetection);t&&this._proxy.$cwdChange(e.instanceId,this._convertCwdToUri(t.getCwd()))}};cee=f([ht($e.MainThreadTerminalShellIntegration),p(1,Ew),p(2,mn)],cee);function dee(s){switch(s.commandLineConfidence){case"high":return xC.High;case"medium":return xC.Medium;case"low":default:return xC.Low}}let lee=class{constructor(e,t){this._themeService=t,this._proxy=e.getProxy(Ye.ExtHostTheming),this._themeChangeListener=this._themeService.onDidColorThemeChange(i=>{this._proxy.$onColorThemeChange(this._themeService.getColorTheme().type)}),this._proxy.$onColorThemeChange(this._themeService.getColorTheme().type)}dispose(){this._themeChangeListener.dispose()}};lee=f([ht($e.MainThreadTheming),p(1,ft)],lee);let hee=class extends F{constructor(e,t,i,n,o){super(),this.viewsService=t,this.notificationService=i,this.extensionService=n,this.logService=o,this._dataProviders=this._register(new ei),this._dndControllers=new Map,this._proxy=e.getProxy(Ye.ExtHostTreeViews)}async $registerTreeViewDataProvider(e,t){this.logService.trace("MainThreadTreeViews#$registerTreeViewDataProvider",e,t),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{const i=new jWe(e,this._proxy,this.notificationService),n=new U;this._dataProviders.set(e,{dataProvider:i,dispose:()=>n.dispose()});const o=t.hasHandleDrag||t.hasHandleDrop?new KWe(e,t.dropMimeTypes,t.dragMimeTypes,t.hasHandleDrag,this._proxy):void 0,r=this.getTreeView(e);r?(r.showCollapseAllAction=t.showCollapseAll,r.canSelectMany=t.canSelectMany,r.manuallyManageCheckboxes=t.manuallyManageCheckboxes,r.dragAndDropController=o,o&&this._dndControllers.set(e,o),r.dataProvider=i,this.registerListeners(e,r,n),this._proxy.$setVisible(e,r.visible)):this.notificationService.error("No view is registered with id: "+e)})}$reveal(e,t,i){return this.logService.trace("MainThreadTreeViews#$reveal",e,t?.item,t?.parentChain,i),this.viewsService.openView(e,i.focus).then(()=>{const n=this.getTreeView(e);if(n&&t)return this.reveal(n,this._dataProviders.get(e).dataProvider,t.item,t.parentChain,i)})}$refresh(e,t){this.logService.trace("MainThreadTreeViews#$refresh",e,t);const i=this.getTreeView(e),n=this._dataProviders.get(e);if(i&&n){const o=n.dataProvider.getItemsToRefresh(t);return i.refresh(o.items.length?o.items:void 0,o.checkboxes.length?o.checkboxes:void 0)}return Promise.resolve()}$setMessage(e,t){this.logService.trace("MainThreadTreeViews#$setMessage",e,t.toString());const i=this.getTreeView(e);i&&(i.message=t)}$setTitle(e,t,i){this.logService.trace("MainThreadTreeViews#$setTitle",e,t,i);const n=this.getTreeView(e);n&&(n.title=t,n.description=i)}$setBadge(e,t){this.logService.trace("MainThreadTreeViews#$setBadge",e,t?.value,t?.tooltip);const i=this.getTreeView(e);i&&(i.badge=t)}$resolveDropFileData(e,t,i){const n=this._dndControllers.get(e);if(!n)throw new Error("Unknown tree");return n.resolveDropFileData(t,i)}async $disposeTree(e){const t=this.getTreeView(e);t&&(t.dataProvider=void 0),this._dataProviders.deleteAndDispose(e)}async reveal(e,t,i,n,o){o=o||{select:!1,focus:!1};const r=_p(o.select)?!1:o.select,a=_p(o.focus)?!1:o.focus;let c=Math.min(Ja(o.expand)?o.expand:o.expand===!0?1:0,3);t.isEmpty()&&await e.refresh();for(const l of n){const u=t.getItem(l.handle);u&&await e.expand(u)}const d=t.getItem(i.handle);if(d){await e.reveal(d),r&&e.setSelection([d]),a===!1?e.setFocus():a&&e.setFocus(d);let l=[d];for(;l.length>0&&c>0;c--)await e.expand(l),l=l.reduce((u,g)=>{const m=t.getItem(g.handle);return m&&m.children&&m.children.length&&u.push(...m.children),u},[])}}registerListeners(e,t,i){i.add(t.onDidExpandItem(n=>this._proxy.$setExpanded(e,n.handle,!0))),i.add(t.onDidCollapseItem(n=>this._proxy.$setExpanded(e,n.handle,!1))),i.add(t.onDidChangeSelectionAndFocus(n=>this._proxy.$setSelectionAndFocus(e,n.selection.map(({handle:o})=>o),n.focus.handle))),i.add(t.onDidChangeVisibility(n=>this._proxy.$setVisible(e,n))),i.add(t.onDidChangeCheckboxState(n=>{this._proxy.$changeCheckboxState(e,n.map(o=>({treeItemHandle:o.handle,newState:o.checkbox?.isChecked??!1})))}))}getTreeView(e){const t=Ge.as(Yp.ViewsRegistry).getView(e);return t?t.treeView:null}dispose(){for(const e of this._dataProviders){const t=this.getTreeView(e[0]);t&&(t.dataProvider=void 0)}this._dataProviders.dispose(),this._dndControllers.clear(),super.dispose()}};hee=f([ht($e.MainThreadTreeViews),p(1,mo),p(2,At),p(3,hn),p(4,Pe)],hee);class KWe{constructor(e,t,i,n,o){this.treeViewId=e,this.dropMimeTypes=t,this.dragMimeTypes=i,this.hasWillDrop=n,this._proxy=o,this.dataTransfersCache=new F4}async handleDrop(e,t,i,n,o,r){const a=this.dataTransfersCache.add(e);try{const c=await Py.fromList(e);return i.isCancellationRequested?void 0:await this._proxy.$handleDrop(this.treeViewId,a.id,c,t?.handle,i,n,o,r)}finally{a.dispose()}}async handleDrag(e,t,i){if(!this.hasWillDrop)return;const n=await this._proxy.$handleDrag(this.treeViewId,e,t,i);if(!n)return;const o=new yO;return n.items.forEach(([r,a])=>{o.replace(r,ZI(a.asString))}),o}resolveDropFileData(e,t){return this.dataTransfersCache.resolveFileData(e,t)}}class jWe{constructor(e,t,i){this.treeViewId=e,this._proxy=t,this.notificationService=i,this.itemsMap=new Map,this.hasResolve=this._proxy.$hasResolve(this.treeViewId)}async getChildren(e){return(await this.getChildrenBatch(e?[e]:void 0))?.[0]}getChildrenBatch(e){return e||this.itemsMap.clear(),this._proxy.$getChildren(this.treeViewId,e?e.map(t=>t.handle):void 0).then(t=>{const i=this.convertTransferChildren(e??[],t);return this.postGetChildren(i)},t=>(jAe.is(t)||this.notificationService.error(t),[]))}convertTransferChildren(e,t){const i=Array(e.length);if(t)for(const n of t){const o=n[0];i[o]=n.slice(1)}return i}getItemsToRefresh(e){const t=[],i=[];if(e)for(const n of Object.keys(e)){const o=this.getItem(n);if(o){const r=e[n];if(o.checkbox?.isChecked!==r.checkbox?.isChecked&&i.push(o),this.updateTreeItem(o,r),n===r.handle)t.push(o);else{this.itemsMap.delete(n),this.itemsMap.set(o.handle,o);const a=r.parentHandle?this.itemsMap.get(r.parentHandle):null;a&&t.push(a)}}}return{items:t,checkboxes:i}}getItem(e){return this.itemsMap.get(e)}isEmpty(){return this.itemsMap.size===0}async postGetChildren(e){if(e===void 0)return;const t=[],i=await this.hasResolve;if(e)for(const n of e){const o=[];if(t.push(o),!!n)for(const r of n){const a=new C0(r,i?c=>this._proxy.$resolve(this.treeViewId,r.handle,c):void 0);this.itemsMap.set(r.handle,a),o.push(a)}}return t}updateTreeItem(e,t){if(t.children=t.children?t.children:void 0,e){const i=tI([...Object.keys(e instanceof C0?e.asTreeItem():e),...Object.keys(t)]);for(const n of i)e[n]=t[n];e instanceof C0&&e.resetResolve()}}}let uee=class extends F{constructor(e,t){super(),this.downloadService=t}$download(e,t){return this.downloadService.download(R.revive(e),R.revive(t))}};uee=f([ht($e.MainThreadDownloadService),p(1,Vie)],uee);class YWe{constructor(e,t,i,n){this.proxy=e,this.handle=t,this.extensionId=i,this.extensionDisplayName=n}async handleURL(e,t){return Es.equals(this.extensionId,e.authority)?(await this.proxy.$handleExternalUri(this.handle,e),!0):!1}}let gee=class extends F{constructor(e,t,i,n){super(),this.urlService=i,this.extensionUrlHandler=n,this.handlers=new Map,this.proxy=e.getProxy(Ye.ExtHostUrls)}async $registerUriHandler(e,t,i){const n=new YWe(this.proxy,e,t,i),o=this.urlService.registerHandler(n);this.handlers.set(e,{extensionId:t,disposable:o}),this.extensionUrlHandler.registerExtensionHandler(t,n)}async $unregisterUriHandler(e){const t=this.handlers.get(e);if(!t)return;const{extensionId:i,disposable:n}=t;this.extensionUrlHandler.unregisterExtensionHandler(i),this.handlers.delete(e),n.dispose()}async $createAppUri(e){return this.urlService.create(e)}dispose(){super.dispose(),this.handlers.forEach(({disposable:e})=>e.dispose()),this.handlers.clear()}};gee=f([ht($e.MainThreadUrls),p(1,mq),p(2,$M),p(3,Bre)],gee);const $ue="default",QWe="workbench.externalUriOpeners",_$={type:"string",enum:[]},pee="\n- `https://microsoft.com`: Matches this specific domain using https\n- `https://microsoft.com:8080`: Matches this specific domain on this port using https\n- `https://microsoft.com:*`: Matches this specific domain on any port using https\n- `https://microsoft.com/foo`: Matches `https://microsoft.com/foo` and `https://microsoft.com/foo/bar`, but not `https://microsoft.com/foobar` or `https://microsoft.com/bar`\n- `https://*.microsoft.com`: Match all domains ending in `microsoft.com` using https\n- `microsoft.com`: Match this specific domain using either http or https\n- `*.microsoft.com`: Match all domains ending in `microsoft.com` using either http or https\n- `http://192.168.0.1`: Matches this specific IP using http\n- `http://192.168.0.*`: Matches all IP's with this prefix using http\n- `*`: Match all domains using either http or https",XWe={...fN,properties:{[QWe]:{type:"object",markdownDescription:h(6939,"Configure the opener to use for external URIs (http, https)."),defaultSnippets:[{body:{"example.com":"$1"}}],additionalProperties:{anyOf:[{type:"string",markdownDescription:h(6940,`Map URI pattern to an opener id.
Example patterns: 
{0}`,pee)},{type:"string",markdownDescription:h(6940,`Map URI pattern to an opener id.
Example patterns: 
{0}`,pee),enum:[$ue],enumDescriptions:[h(6941,"Open using VS Code's standard opener.")]},_$]}}}};function ZWe(s,e){_$.enum=s,_$.enumDescriptions=e,Ge.as(qs.Configuration).notifyConfigurationSchemaUpdated(XWe)}var b$;let y$=class extends F{static{b$=this}static{this.STORAGE_ID="externalUriOpeners"}constructor(e,t){super(),this._extensionService=t,this._openers=new Map,this._memento=new uw(b$.STORAGE_ID,e),this._mementoObject=this._memento.getMemento(he.PROFILE,pt.MACHINE);for(const[i,n]of Object.entries(this._mementoObject||{}))this.add(i,n.extensionId,{isCurrentlyRegistered:!1});this.invalidateOpenersOnExtensionsChanged(),this._register(this._extensionService.onDidChangeExtensions(()=>this.invalidateOpenersOnExtensionsChanged())),this._register(this._extensionService.onDidChangeExtensionsStatus(()=>this.invalidateOpenersOnExtensionsChanged()))}didRegisterOpener(e,t){this.add(e,t,{isCurrentlyRegistered:!0})}add(e,t,i){const n=this._openers.get(e);if(n){n.isCurrentlyRegistered=n.isCurrentlyRegistered||i.isCurrentlyRegistered;return}const o={extensionId:t,isCurrentlyRegistered:i.isCurrentlyRegistered};this._openers.set(e,o),this._mementoObject[e]=o,this._memento.saveMemento(),this.updateSchema()}delete(e){this._openers.delete(e),delete this._mementoObject[e],this._memento.saveMemento(),this.updateSchema()}async invalidateOpenersOnExtensionsChanged(){await this._extensionService.whenInstalledExtensionsRegistered();const e=this._extensionService.extensions;for(const[t,i]of this._openers){const n=e.find(o=>o.identifier.value===i.extensionId);n?this._extensionService.canRemoveExtension(n)||i.isCurrentlyRegistered||this.delete(t):this.delete(t)}}updateSchema(){const e=[],t=[];for(const[i,n]of this._openers)e.push(i),t.push(n.extensionId);ZWe(e,t)}};y$=b$=f([p(0,tt),p(1,hn)],y$);let fee=class extends F{constructor(e,t,i,n,o,r){super(),this.extensionService=n,this.openerService=o,this.notificationService=r,this._registeredOpeners=new Map,this.proxy=e.getProxy(Ye.ExtHostUriOpeners),this._register(i.registerExternalOpenerProvider(this)),this._contributedExternalUriOpenersStore=this._register(new y$(t,n))}async*getOpeners(e){if(!(e.scheme!==ae.http&&e.scheme!==ae.https)){await this.extensionService.activateByEvent(`onOpenExternalUri:${e.scheme}`);for(const[t,i]of this._registeredOpeners)i.schemes.has(e.scheme)&&(yield this.createOpener(t,i))}}createOpener(e,t){return{id:e,label:t.label,canOpen:(i,n)=>this.proxy.$canOpenUri(e,i,n),openExternalUri:async(i,n,o)=>{try{await this.proxy.$openUri(e,{resolvedUri:i,sourceUri:n.sourceUri},o)}catch(r){if(!gs(r)){const a=new Kt("default",h(2458,"Open using default opener"),void 0,void 0,async()=>{await this.openerService.open(i,{allowTunneling:!1,allowContributedOpeners:$ue})});a.tooltip=i.toString(),this.notificationService.notify({severity:Me.Error,message:h(2459,"Could not open uri with '{0}': {1}",e,r.toString()),actions:{primary:[a]}})}}return!0}}}async $registerUriOpener(e,t,i,n){if(this._registeredOpeners.has(e))throw new Error(`Opener with id '${e}' already registered`);this._registeredOpeners.set(e,{schemes:new Set(t),label:n,extensionId:i}),this._contributedExternalUriOpenersStore.didRegisterOpener(e,i.value)}async $unregisterUriOpener(e){this._registeredOpeners.delete(e),this._contributedExternalUriOpenersStore.delete(e)}dispose(){super.dispose(),this._registeredOpeners.clear()}};fee=f([ht($e.MainThreadUriOpeners),p(1,tt),p(2,dre),p(3,hn),p(4,hi),p(5,At)],fee);let mee=class{constructor(e,t,i,n){this.hostService=t,this.openerService=i,this.userActivityService=n,this.disposables=new U,this.proxy=e.getProxy(Ye.ExtHostWindow),D.latch(t.onDidChangeFocus)(this.proxy.$onDidChangeWindowFocus,this.proxy,this.disposables),n.onDidChangeIsActive(this.proxy.$onDidChangeWindowActive,this.proxy,this.disposables),this.registerNativeHandle()}dispose(){this.disposables.dispose()}registerNativeHandle(){D.latch(this.hostService.onDidChangeActiveWindow)(async e=>{const t=await this.hostService.getNativeWindowHandle(e);this.proxy.$onDidChangeActiveNativeWindowHandle(t?Xx(t):void 0)},this,this.disposables)}$getInitialState(){return Promise.resolve({isFocused:this.hostService.hasFocus,isActive:this.userActivityService.isActive})}async $openUri(e,t,i){const n=R.from(e);let o;return t&&R.parse(t).toString()===n.toString()?o=t:o=n,this.openerService.open(o,{openExternal:!0,allowTunneling:i.allowTunneling,allowContributedOpeners:i.allowContributedOpeners})}async $asExternalUri(e,t){return(await this.openerService.resolveExternalUri(R.revive(e),t)).resolved}};mee=f([ht($e.MainThreadWindow),p(1,Wn),p(2,hi),p(3,Wie)],mee);var w$;let S$=w$=class extends F{static async create(e,t,i){return e.invokeFunction(async n=>{const r=await n.get(yi).createModelReference(i);return e.createInstance(w$,t,i,r)})}constructor(e,t,i,n,o,r){super(),this.viewType=e,this._resource=t,this._model=i,this.textFileService=n,this._labelService=o,this._onDidChangeOrphaned=this._register(new M),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this._onDidChangeReadonly=this._register(new M),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this._onDidChangeDirty=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._register(i),this._textFileModel=this.textFileService.files.get(t),this._textFileModel&&(this._register(this._textFileModel.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire())),this._register(this._textFileModel.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))),this._register(this.textFileService.files.onDidChangeDirty(a=>{Dt(this.resource,a.resource)&&(this._onDidChangeDirty.fire(),this._onDidChangeContent.fire())})),this._register(r.onWillStop(a=>{a.veto(!0,h(5524,"An extension provided text editor for '{0}' is still open that would close otherwise.",this.name))}))}get resource(){return this._resource}get name(){return Sn(this._labelService.getUriLabel(this._resource))}isReadonly(){return this._model.object.isReadonly()}get backupId(){}get canHotExit(){return!0}isDirty(){return this.textFileService.isDirty(this.resource)}isOrphaned(){return!!this._textFileModel?.hasState(Mk.ORPHAN)}async revert(e){return this.textFileService.revert(this.resource,e)}saveCustomEditor(e){return this.textFileService.save(this.resource,e)}async saveCustomEditorAs(e,t,i){return!!await this.textFileService.saveAs(e,t,i)}};S$=w$=f([p(3,Ds),p(4,di),p(5,hn)],S$);const ett=new O("webviewFindWidgetVisible",!1),ttt=new O("webviewFindWidgetFocused",!1),itt=new O("webviewFindWidgetEnabled",!1);var vee;(function(s){s.NotebookRenderer="notebookRenderer",s.CustomEditor="customEditor",s.WebviewView="webviewView"})(vee||(vee={}));function ntt(s,e){return s.allowMultipleAPIAcquire===e.allowMultipleAPIAcquire&&s.allowScripts===e.allowScripts&&s.allowForms===e.allowForms&&ns(s.localResourceRoots,e.localResourceRoots,Dt)&&ns(s.portMapping,e.portMapping,(t,i)=>t.extensionHostPort===i.extensionHostPort&&t.webviewPort===i.webviewPort)&&JWe(s,e)}function JWe(s,e){return s.enableCommandUris===e.enableCommandUris?!0:Array.isArray(s.enableCommandUris)&&Array.isArray(e.enableCommandUris)?ns(s.enableCommandUris,e.enableCommandUris):!1}let C$=class{constructor(e,t){this._memento=new uw(e,t),this._state=this._memento.getMemento(he.APPLICATION,pt.MACHINE)}getOrigin(e,t){const i=this._getKey(e,t),n=this._state[i];if(n&&typeof n=="string")return n;const o=Dn();return this._state[i]=o,this._memento.saveMemento(),o}_getKey(e,t){return JSON.stringify({viewType:e,key:t})}};C$=f([p(1,tt)],C$);let wL=class{constructor(e,t){this._store=new C$(e,t)}getOrigin(e,t){return this._store.getOrigin(e,t.value)}};wL=f([p(1,tt)],wL);let SL=class extends F{constructor(e,t){super(),this.resource=e,this.fileService=t,this._onDidChangeOrphaned=this._register(new M),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this.orphaned=!1,this._onWillDispose=this._register(new M),this.onWillDispose=this._onWillDispose.event,this._register(this.fileService.onDidFilesChange(i=>this.onDidFilesChange(i)))}isOrphaned(){return this.orphaned}async onDidFilesChange(e){let t=!1,i;if(this.orphaned?e.contains(this.resource,mh.ADDED)&&(i=!1,t=!0):e.contains(this.resource,mh.DELETED)&&(i=!0,t=!0),t&&this.orphaned!==i){let n=!1;i&&(await Ia(100,ye.None),this.isDisposed()?n=!0:n=!await this.fileService.exists(this.resource)),this.orphaned!==n&&!this.isDisposed()&&this.setOrphaned(n)}}setOrphaned(e){this.orphaned!==e&&(this.orphaned=e,this._onDidChangeOrphaned.fire())}isDisposed(){return this._store.isDisposed}dispose(){this.orphaned=!1,this._onWillDispose.fire(),super.dispose()}isModified(){return this.isDirty()}};SL=f([p(1,Xe)],SL);var pT,fb;(function(s){s[s.Custom=0]="Custom",s[s.Text=1]="Text"})(fb||(fb={}));let E$=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.mainThreadWebview=t,this.mainThreadWebviewPanels=i,this._customEditorService=c,this._editorGroupService=d,this._editorService=l,this._instantiationService=u,this._webviewWorkbenchService=g,this._uriIdentityService=m,this._editorProviders=this._register(new ei),this._editorRenameBackups=new Map,this._webviewOriginStore=new wL("mainThreadCustomEditors.origins",o),this._proxyCustomEditors=e.getProxy(Ye.ExtHostCustomEditors),this._register(a.registerWorkingCopyProvider(v=>{const y=[];for(const w of r.workingCopies)w instanceof mb&&cd(v,w.editorResource)&&y.push(w);return y})),this._register(g.registerResolver({canResolve:v=>(v instanceof qb&&n.activateByEvent(`onCustomEditor:${v.viewType}`),!1),resolveWebview:()=>{throw new Error("not implemented")}})),this._register(a.onWillRunWorkingCopyFileOperation(async v=>this.onWillRunWorkingCopyFileOperation(v)))}$registerTextEditorProvider(e,t,i,n,o){this.registerEditorProvider(fb.Text,dL(e),t,i,n,!0,o)}$registerCustomEditorProvider(e,t,i,n,o){this.registerEditorProvider(fb.Custom,dL(e),t,i,{},n,o)}registerEditorProvider(e,t,i,n,o,r,a){if(this._editorProviders.has(i))throw new Error(`Provider for ${i} already registered`);const c=new U;c.add(this._customEditorService.registerCustomEditorCapabilities(i,{supportsMultipleEditorsPerDocument:r})),c.add(this._webviewWorkbenchService.registerResolver({canResolve:d=>d instanceof qb&&d.viewType===i,resolveWebview:async(d,l)=>{const u=Dn(),g=d.resource;d.webview.origin=this._webviewOriginStore.getOrigin(i,t.id),this.mainThreadWebviewPanels.addWebviewInput(u,d,{serializeBuffersForPostMessage:a}),d.webview.options=n,d.webview.extension=t;let m=d.backupId;d.oldResource&&!d.backupId&&(m=this._editorRenameBackups.get(d.oldResource.toString())?.backupId,this._editorRenameBackups.delete(d.oldResource.toString()));let v;try{v=await this.getOrCreateCustomEditorModel(e,g,i,{backupId:m},l)}catch(w){mt(w),d.webview.setHtml(this.mainThreadWebview.getWebviewResolvedFailedContent(i));return}if(l.isCancellationRequested){v.dispose();return}const y=d.webview.onDidDispose(()=>{if(y.dispose(),v.object.isDirty()){const w=v.object.onDidChangeDirty(()=>{v.object.isDirty()||(w.dispose(),v.dispose())});return}v.dispose()});o.supportsMove&&d.onMove(async w=>{const C=v;v=await this.getOrCreateCustomEditorModel(e,w,i,{},ye.None),this._proxyCustomEditors.$onMoveCustomEditor(u,w,i),C.dispose()});try{await this._proxyCustomEditors.$resolveCustomEditor(this._uriIdentityService.asCanonicalUri(g),u,i,{title:d.getTitle(),contentOptions:d.webview.contentOptions,options:d.webview.options,active:d===this._editorService.activeEditor},Jp(this._editorGroupService,d.group||0),l)}catch(w){mt(w),d.webview.setHtml(this.mainThreadWebview.getWebviewResolvedFailedContent(i)),v.dispose();return}}})),this._editorProviders.set(i,c)}$unregisterEditorProvider(e){if(!this._editorProviders.has(e))throw new Error(`No provider for ${e} registered`);this._editorProviders.deleteAndDispose(e),this._customEditorService.models.disposeAllModelsForView(e)}async getOrCreateCustomEditorModel(e,t,i,n,o){const r=this._customEditorService.models.tryRetain(t,i);if(r)return r;switch(e){case fb.Text:{const a=S$.create(this._instantiationService,i,t);return this._customEditorService.models.add(t,i,a)}case fb.Custom:{const a=mb.create(this._instantiationService,this._proxyCustomEditors,i,t,n,()=>Array.from(this.mainThreadWebviewPanels.webviewInputs).filter(c=>c instanceof qb&&Dt(c.resource,t)),o);return this._customEditorService.models.add(t,i,a)}}}async $onDidEdit(e,t,i,n){(await this.getCustomEditorModel(e,t)).pushEdit(i,n)}async $onContentChange(e,t){(await this.getCustomEditorModel(e,t)).changeContent()}async getCustomEditorModel(e,t){const i=R.revive(e),n=await this._customEditorService.models.get(i,t);if(!n||!(n instanceof mb))throw new Error("Could not find model for webview editor");return n}async onWillRunWorkingCopyFileOperation(e){e.operation===ga.MOVE&&e.waitUntil((async()=>{const t=[];for(const i of e.files)i.source&&t.push(...await this._customEditorService.models.getAllModels(i.source));for(const i of t)if(i instanceof mb&&i.isDirty()){const n=await i.backup(ye.None);n.meta&&this._editorRenameBackups.set(i.editorResource.toString(),n.meta)}})())}};E$=f([p(3,hn),p(4,tt),p(5,vg),p(6,mg),p(7,Sz),p(8,Ie),p(9,de),p(10,J),p(11,II),p(12,Zi)],E$);var uu;(function(s){let e;(function(i){i[i.Allowed=0]="Allowed",i[i.NotAllowed=1]="NotAllowed",i[i.Pending=2]="Pending"})(e=s.Type||(s.Type={})),s.Allowed=Object.freeze({type:e.Allowed}),s.NotAllowed=Object.freeze({type:e.NotAllowed});class t{constructor(n){this.operation=n,this.type=e.Pending}}s.Pending=t})(uu||(uu={}));let mb=pT=class extends SL{static async create(e,t,i,n,o,r,a){const c=r();let d;c.length!==0&&(d=c[0].untitledDocumentData);const{editable:l}=await t.$createCustomDocument(n,i,o.backupId,d,a);return e.createInstance(pT,t,i,n,!!o.backupId,l,!!d,r)}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){super(pT.toWorkingCopyResource(t,i),d),this._proxy=e,this._viewType=t,this._editorResource=i,this._editable=o,this._getEditors=a,this._fileDialogService=c,this._labelService=l,this._undoService=u,this._environmentService=g,this._pathService=v,this._fromBackup=!1,this._hotExitState=uu.Allowed,this._currentEditIndex=-1,this._savePoint=-1,this._edits=[],this._isDirtyFromContentChange=!1,this.typeId=ACe,this._onDidChangeDirty=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidSave=this._register(new M),this.onDidSave=this._onDidSave.event,this.onDidChangeReadonly=D.None,this._fromBackup=n,o&&(this._register(m.registerWorkingCopy(this)),this._register(y.onWillStop(w=>{w.veto(!0,h(2405,"An extension provided editor for '{0}' is still open that would close otherwise.",this.name))}))),r&&(this._isDirtyFromContentChange=!0)}get editorResource(){return this._editorResource}dispose(){this._editable&&this._undoService.removeElements(this._editorResource),this._proxy.$disposeCustomDocument(this._editorResource,this._viewType),super.dispose()}static toWorkingCopyResource(e,t){const i=e.replace(/[^a-z0-9\-_]/gi,"-"),n=`/${IE(t.with({query:null,fragment:null}).toString(!0))}`;return R.from({scheme:ae.vscodeCustomEditor,authority:i,path:n,query:JSON.stringify(t.toJSON())})}get name(){return Sn(this._labelService.getUriLabel(this._editorResource))}get capabilities(){return this.isUntitled()?NE.Untitled:NE.None}isDirty(){return this._isDirtyFromContentChange?!0:this._edits.length>0?this._savePoint!==this._currentEditIndex:this._fromBackup}isUntitled(){return this._editorResource.scheme===ae.untitled}isReadonly(){return!this._editable}get viewType(){return this._viewType}get backupId(){return this._backupId}pushEdit(e,t){if(!this._editable)throw new Error("Document is not editable");this.change(()=>{this.spliceEdits(e),this._currentEditIndex=this._edits.length-1}),this._undoService.pushElement({type:Wq.Resource,resource:this._editorResource,label:t??h(2406,"Edit"),code:"undoredo.customEditorEdit",undo:()=>this.undo(),redo:()=>this.redo()})}changeContent(){this.change(()=>{this._isDirtyFromContentChange=!0})}async undo(){if(!this._editable||this._currentEditIndex<0)return;const e=this._edits[this._currentEditIndex];this.change(()=>{--this._currentEditIndex}),await this._proxy.$undo(this._editorResource,this.viewType,e,this.isDirty())}async redo(){if(!this._editable||this._currentEditIndex>=this._edits.length-1)return;const e=this._edits[this._currentEditIndex+1];this.change(()=>{++this._currentEditIndex}),await this._proxy.$redo(this._editorResource,this.viewType,e,this.isDirty())}spliceEdits(e){const t=this._currentEditIndex+1,i=this._edits.length-this._currentEditIndex,n=typeof e=="number"?this._edits.splice(t,i,e):this._edits.splice(t,i);n.length&&this._proxy.$disposeEdits(this._editorResource,this._viewType,n)}change(e){const t=this.isDirty();e(),this._onDidChangeContent.fire(),this.isDirty()!==t&&this._onDidChangeDirty.fire()}async revert(e){this._editable&&(this._currentEditIndex===this._savePoint&&!this._isDirtyFromContentChange&&!this._fromBackup||(e?.soft||this._proxy.$revert(this._editorResource,this.viewType,ye.None),this.change(()=>{this._isDirtyFromContentChange=!1,this._fromBackup=!1,this._currentEditIndex=this._savePoint,this.spliceEdits()})))}async save(e){const t=!!await this.saveCustomEditor(e);return t&&this._onDidSave.fire({reason:e?.reason,source:e?.source}),t}async saveCustomEditor(e){if(!this._editable)return;if(this.isUntitled()){const i=await this.suggestUntitledSavePath(e);return i?(await this.saveCustomEditorAs(this._editorResource,i,e),i):void 0}const t=En(i=>this._proxy.$onSave(this._editorResource,this.viewType,i));this._ongoingSave?.cancel(),this._ongoingSave=t;try{await t,this._ongoingSave===t&&this.change(()=>{this._isDirtyFromContentChange=!1,this._savePoint=this._currentEditIndex,this._fromBackup=!1})}finally{this._ongoingSave===t&&(this._ongoingSave=void 0)}return this._editorResource}suggestUntitledSavePath(e){if(!this.isUntitled())throw new Error("Resource is not untitled");const t=this._environmentService.remoteAuthority,i=Iq(this._editorResource,t,this._pathService.defaultUriScheme);return this._fileDialogService.pickFileToSave(i,e?.availableFileSystems)}async saveCustomEditorAs(e,t,i){return this._editable?(await En(n=>this._proxy.$onSaveAs(this._editorResource,this.viewType,t,n)),this.change(()=>{this._savePoint=this._currentEditIndex}),!0):(await this.fileService.copy(e,t,!1),!0)}get canHotExit(){return typeof this._backupId=="string"&&this._hotExitState.type===uu.Type.Allowed}async backup(e){const t=this._getEditors();if(!t.length)throw new Error("No editors found for resource, cannot back up");const i=t[0],o={meta:{viewType:this.viewType,editorResource:this._editorResource,backupId:"",extension:i.extension?{id:i.extension.id.value,location:i.extension.location}:void 0,webview:{origin:i.webview.origin,options:i.webview.options,state:i.webview.state}}};if(!this._editable)return o;this._hotExitState.type===uu.Type.Pending&&this._hotExitState.operation.cancel();const r=new uu.Pending(En(c=>this._proxy.$backup(this._editorResource.toJSON(),this.viewType,c)));this._hotExitState=r,e.onCancellationRequested(()=>{r.operation.cancel()});let a="";try{const c=await r.operation;this._hotExitState===r&&(this._hotExitState=uu.Allowed,o.meta.backupId=c,this._backupId=c)}catch(c){if(gs(c))throw c;this._hotExitState===r&&(this._hotExitState=uu.NotAllowed),c.message&&(a=c.message)}if(this._hotExitState===uu.Allowed)return o;throw new Error(`Cannot backup in this state: ${a}`)}};mb=pT=f([p(7,js),p(8,Xe),p(9,di),p(10,HM),p(11,mn),p(12,vg),p(13,_c),p(14,hn)],mb);class eBe{constructor(){this._handlesToInputs=new Map,this._inputsToHandles=new Map}add(e,t){this._handlesToInputs.set(e,t),this._inputsToHandles.set(t,e)}getHandleForInput(e){return this._inputsToHandles.get(e)}getInputForHandle(e){return this._handlesToInputs.get(e)}delete(e){const t=this.getInputForHandle(e);this._handlesToInputs.delete(e),t&&this._inputsToHandles.delete(t)}get size(){return this._handlesToInputs.size}[Symbol.iterator](){return this._handlesToInputs.values()}}class tBe{constructor(e){this.prefix=e}fromExternal(e){return this.prefix+e}toExternal(e){return e.startsWith(this.prefix)?e.substr(this.prefix.length):void 0}}let x$=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this._mainThreadWebviews=t,this._configurationService=i,this._editorGroupService=n,this._editorService=o,this._webviewWorkbenchService=c,this.webviewPanelViewType=new tBe("mainThreadWebview-"),this._webviewInputs=new eBe,this._revivers=this._register(new ei),this.webviewOriginStore=new wL("mainThreadWebviewPanel.origins",a),this._proxy=e.getProxy(Ye.ExtHostWebviewPanels),this._register(D.any(o.onDidActiveEditorChange,o.onDidVisibleEditorsChange,n.onDidAddGroup,n.onDidRemoveGroup,n.onDidMoveGroup)(()=>{this.updateWebviewViewStates(this._editorService.activeEditor)})),this._register(c.onDidChangeActiveWebviewEditor(d=>{this.updateWebviewViewStates(d)})),this._register(c.registerResolver({canResolve:d=>{const l=this.webviewPanelViewType.toExternal(d.viewType);return typeof l=="string"&&r.activateByEvent(`onWebviewPanel:${l}`),!1},resolveWebview:()=>{throw new Error("not implemented")}}))}get webviewInputs(){return this._webviewInputs}addWebviewInput(e,t,i){this._webviewInputs.add(e,t),this._mainThreadWebviews.addWebview(e,t.webview,i);const n=t.webview.onDidDispose(()=>{n.dispose(),this._proxy.$onDidDisposeWebviewPanel(e).finally(()=>{this._webviewInputs.delete(e)})})}$createWebviewPanel(e,t,i,n,o){const r=this.getTargetGroupFromShowOptions(o),a=o?{preserveFocus:!!o.preserveFocus,group:r}:{},c=dL(e),d=this.webviewOriginStore.getOrigin(i,c.id),l=this._webviewWorkbenchService.openWebview({origin:d,providedViewType:i,title:n.title,options:nBe(n.panelOptions),contentOptions:lL(n.webviewOptions),extension:c},this.webviewPanelViewType.fromExternal(i),n.title,a);this.addWebviewInput(t,l,{serializeBuffersForPostMessage:n.serializeBuffersForPostMessage})}$disposeWebview(e){const t=this.tryGetWebviewInput(e);t&&t.dispose()}$setTitle(e,t){this.tryGetWebviewInput(e)?.setName(t)}$setIconPath(e,t){const i=this.tryGetWebviewInput(e);i&&(i.iconPath=iBe(t))}$reveal(e,t){const i=this.tryGetWebviewInput(e);if(!i||i.isDisposed())return;const n=this.getTargetGroupFromShowOptions(t);this._webviewWorkbenchService.revealWebview(i,n,!!t.preserveFocus)}getTargetGroupFromShowOptions(e){if(typeof e.viewColumn>"u"||e.viewColumn===cl||this._editorGroupService.count===1&&this._editorGroupService.activeGroup.isEmpty)return cl;if(e.viewColumn===xr)return xr;if(e.viewColumn>=0){const t=this._editorGroupService.getGroups(Ko.GRID_APPEARANCE)[e.viewColumn];if(t)return t.id;const i=this._editorGroupService.findGroup({location:Xa.LAST});if(i){const n=Vv(this._configurationService);return this._editorGroupService.addGroup(i,n)}}return cl}$registerSerializer(e,t){if(this._revivers.has(e))throw new Error(`Reviver for ${e} already registered`);this._revivers.set(e,this._webviewWorkbenchService.registerResolver({canResolve:i=>i.viewType===this.webviewPanelViewType.fromExternal(e),resolveWebview:async i=>{const n=this.webviewPanelViewType.toExternal(i.viewType);if(!n){i.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(i.viewType));return}const o=Dn();this.addWebviewInput(o,i,t);let r;if(i.webview.state)try{r=JSON.parse(i.webview.state)}catch(a){console.error("Could not load webview state",a,i.webview.state)}try{await this._proxy.$deserializeWebviewPanel(o,n,{title:i.getTitle(),state:r,panelOptions:i.webview.options,webviewOptions:i.webview.contentOptions,active:i===this._editorService.activeEditor},Jp(this._editorGroupService,i.group||0))}catch(a){mt(a),i.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(n))}}}))}$unregisterSerializer(e){if(!this._revivers.has(e))throw new Error(`No reviver for ${e} registered`);this._revivers.deleteAndDispose(e)}updateWebviewViewStates(e){if(!this._webviewInputs.size)return;const t={},i=(n,o,r)=>{if(!(r instanceof lr))return;r.updateGroup(n.id);const a=this._webviewInputs.getHandleForInput(r);a&&(t[a]={visible:o===n.activeEditor,active:r===e,position:Jp(this._editorGroupService,n.id)})};for(const n of this._editorGroupService.groups)for(const o of n.editors)o instanceof ro?(i(n,o,o.primary),i(n,o,o.secondary)):i(n,o,o);Object.keys(t).length&&this._proxy.$onDidChangeWebviewPanelViewStates(t)}tryGetWebviewInput(e){return this._webviewInputs.getInputForHandle(e)}};x$=f([p(2,ne),p(3,Ie),p(4,de),p(5,hn),p(6,tt),p(7,II)],x$);function iBe(s){if(s)return{light:R.revive(s.light),dark:R.revive(s.dark)}}function nBe(s){return{enableFindWidget:s.enableFindWidget,retainContextWhenHidden:s.retainContextWhenHidden}}let I$=class extends F{constructor(e,t,i,n){super(),this.mainThreadWebviews=t,this._telemetryService=i,this._webviewViewService=n,this._webviewViews=this._register(new ei),this._webviewViewProviders=this._register(new ei),this._proxy=e.getProxy(Ye.ExtHostWebviewViews)}$setWebviewViewTitle(e,t){const i=this.getWebviewView(e);i.title=t}$setWebviewViewDescription(e,t){const i=this.getWebviewView(e);i.description=t}$setWebviewViewBadge(e,t){const i=this.getWebviewView(e);i.badge=t}$show(e,t){this.getWebviewView(e).show(t)}$registerWebviewViewProvider(e,t,i){if(this._webviewViewProviders.has(t))throw new Error(`View provider for ${t} already registered`);const n=dL(e),o=this._webviewViewService.register(t,{resolve:async(r,a)=>{const c=Dn();this._webviewViews.set(c,r),this.mainThreadWebviews.addWebview(c,r.webview,{serializeBuffersForPostMessage:i.serializeBuffersForPostMessage});let d;if(r.webview.state)try{d=JSON.parse(r.webview.state)}catch(u){console.error("Could not load webview state",u,r.webview.state)}r.webview.extension=n,i&&(r.webview.options=i);const l=new U;l.add(r.onDidChangeVisibility(u=>{this._proxy.$onDidChangeWebviewViewVisibility(c,u)})),l.add(r.onDispose(()=>{this._proxy.$disposeWebviewView(c),this._webviewViews.deleteAndDispose(c),l.dispose()})),this._telemetryService.publicLog2("webviews:createWebviewView",{extensionId:n.id.value,id:t});try{await this._proxy.$resolveWebviewView(c,t,r.title,d,a)}catch(u){mt(u),r.webview.setHtml(this.mainThreadWebviews.getWebviewResolvedFailedContent(t))}}});this._webviewViewProviders.set(t,o)}$unregisterWebviewViewProvider(e){if(!this._webviewViewProviders.has(e))throw new Error(`No view provider for ${e} registered`);this._webviewViewProviders.deleteAndDispose(e)}getWebviewView(e){const t=this._webviewViews.get(e);if(!t)throw new Error("unknown webview view");return t}};I$=f([p(2,li),p(3,Lre)],I$);let _ee=class extends F{constructor(e,t){super();const i=this._register(t.createInstance(F2,e));e.set($e.MainThreadWebviews,i);const n=this._register(t.createInstance(x$,e,i));e.set($e.MainThreadWebviewPanels,n);const o=this._register(t.createInstance(E$,e,i,n));e.set($e.MainThreadCustomEditors,o);const r=this._register(t.createInstance(I$,e,i));e.set($e.MainThreadWebviewViews,r)}};_ee=f([n_,p(1,J)],_ee);let bee=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w){this._searchService=t,this._contextService=i,this._editSessionIdentityService=n,this._canonicalUriService=o,this._editorService=r,this._workspaceEditingService=a,this._notificationService=c,this._requestService=d,this._instantiationService=l,this._labelService=u,this._environmentService=g,this._workspaceTrustManagementService=v,this._workspaceTrustRequestService=y,this._textFileService=w,this._toDispose=new U,this._activeCancelTokens=Object.create(null),this.registeredEditSessionProviders=new Map,this.registeredCanonicalUriProviders=new Map,this._queryBuilder=this._instantiationService.createInstance(SR),this._proxy=e.getProxy(Ye.ExtHostWorkspace);const C=this._contextService.getWorkspace();C.configuration&&!ra&&!m.hasProvider(C.configuration)?this._proxy.$initializeWorkspace(this.getWorkspaceData(C),this.isWorkspaceTrusted()):this._contextService.getCompleteWorkspace().then(T=>this._proxy.$initializeWorkspace(this.getWorkspaceData(T),this.isWorkspaceTrusted())),this._contextService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspace,this,this._toDispose),this._contextService.onDidChangeWorkbenchState(this._onDidChangeWorkspace,this,this._toDispose),this._workspaceTrustManagementService.onDidChangeTrust(this._onDidGrantWorkspaceTrust,this,this._toDispose)}dispose(){this._toDispose.dispose();for(const e in this._activeCancelTokens)this._activeCancelTokens[e].cancel()}$updateWorkspaceFolders(e,t,i,n){const o=n.map(r=>({uri:R.revive(r.uri),name:r.name}));return this._notificationService.status(this.getStatusMessage(e,o.length,i),{hideAfter:10*1e3}),this._workspaceEditingService.updateFolders(t,i,o,!0)}getStatusMessage(e,t,i){let n;const o=t>0,r=i>0;return o&&!r?t===1?n=h(2461,"Extension '{0}' added 1 folder to the workspace",e):n=h(2462,"Extension '{0}' added {1} folders to the workspace",e,t):r&&!o?i===1?n=h(2463,"Extension '{0}' removed 1 folder from the workspace",e):n=h(2464,"Extension '{0}' removed {1} folders from the workspace",e,i):n=h(2465,"Extension '{0}' changed folders of the workspace",e),n}_onDidChangeWorkspace(){this._proxy.$acceptWorkspaceData(this.getWorkspaceData(this._contextService.getWorkspace()))}getWorkspaceData(e){return this._contextService.getWorkbenchState()===zo.EMPTY?null:{configuration:e.configuration||void 0,isUntitled:e.configuration?Lbe(e.configuration,this._environmentService):!1,folders:e.folders,id:e.id,name:this._labelService.getWorkspaceLabel(e),transient:e.transient}}$startFileSearch(e,t,i){const n=R.revive(e),o=this._contextService.getWorkspace(),r=this._queryBuilder.file(n?[n]:o.folders,cn(t));return this._searchService.fileSearch(r,i).then(a=>a.results.map(c=>c.resource),a=>gs(a)?null:Promise.reject(a))}$startTextSearch(e,t,i,n,o){const r=R.revive(t),a=this._contextService.getWorkspace(),c=r?[r]:a.folders.map(g=>g.uri),d=this._queryBuilder.text(e,c,cn(i));d._reason="startTextSearch";const l=g=>{g.results&&this._proxy.$handleTextSearchResult(g,n)};return this._searchService.textSearch(d,o,l).then(g=>({limitHit:g.limitHit}),g=>gs(g)?null:Promise.reject(g))}$checkExists(e,t,i){return this._instantiationService.invokeFunction(n=>Rce(n,e,t,i))}async $save(e,t){const i=R.revive(e),n=[...this._editorService.findEditors(i,{supportSideBySide:Ut.PRIMARY})],o=await this._editorService.save(n,{reason:ui.EXPLICIT,saveAs:t.saveAs,force:!t.saveAs});return this._saveResultToUris(o).at(0)}_saveResultToUris(e){return e.success?Vt(e.editors.map(t=>xi.getCanonicalUri(t,{supportSideBySide:Ut.PRIMARY}))):[]}$saveAll(e){return this._editorService.saveAll({includeUntitled:e}).then(t=>t.success)}$resolveProxy(e){return this._requestService.resolveProxy(e)}$lookupAuthorization(e){return this._requestService.lookupAuthorization(e)}$lookupKerberosAuthorization(e){return this._requestService.lookupKerberosAuthorization(e)}$loadCertificates(){return this._requestService.loadCertificates()}$requestWorkspaceTrust(e){return this._workspaceTrustRequestService.requestWorkspaceTrust(e)}isWorkspaceTrusted(){return this._workspaceTrustManagementService.isWorkspaceTrusted()}_onDidGrantWorkspaceTrust(){this._proxy.$onDidGrantWorkspaceTrust()}$registerEditSessionIdentityProvider(e,t){const i=this._editSessionIdentityService.registerEditSessionIdentityProvider({scheme:t,getEditSessionIdentifier:async(n,o)=>this._proxy.$getEditSessionIdentifier(n.uri,o),provideEditSessionIdentityMatch:async(n,o,r,a)=>this._proxy.$provideEditSessionIdentityMatch(n.uri,o,r,a)});this.registeredEditSessionProviders.set(e,i),this._toDispose.add(i)}$unregisterEditSessionIdentityProvider(e){this.registeredEditSessionProviders.get(e)?.dispose(),this.registeredEditSessionProviders.delete(e)}$registerCanonicalUriProvider(e,t){const i=this._canonicalUriService.registerCanonicalUriProvider({scheme:t,provideCanonicalUri:async(n,o,r)=>{const a=await this._proxy.$provideCanonicalUri(n,o,r);return a&&R.revive(a)}});this.registeredCanonicalUriProviders.set(e,i),this._toDispose.add(i)}$unregisterCanonicalUriProvider(e){this.registeredCanonicalUriProviders.get(e)?.dispose(),this.registeredCanonicalUriProviders.delete(e)}$resolveDecoding(e,t){return this._textFileService.resolveDecoding(R.revive(e),t)}$validateDetectedEncoding(e,t,i){return this._textFileService.validateDetectedEncoding(R.revive(e),t,i)}$resolveEncoding(e,t){return this._textFileService.resolveEncoding(R.revive(e),t)}};bee=f([ht($e.MainThreadWorkspace),p(1,DI),p(2,Tt),p(3,gz),p(4,Bie),p(5,de),p(6,uc),p(7,At),p(8,UM),p(9,J),p(10,di),p(11,po),p(12,Xe),p(13,Tv),p(14,Fie),p(15,Ds)],bee);const sBe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let Uc=class{constructor(e,t,i,n,o){this.uniqueOwner=e,this.owner=t,this.resource=i,this.comment=n,this.thread=o,this.isRoot=!1,this.replies=[],this.threadId=o.threadId,this.range=o.range,this.threadState=o.state,this.threadRelevance=o.applicability,this.contextValue=o.contextValue,this.controllerHandle=o.controllerHandle,this.threadHandle=o.commentThreadHandle}hasReply(){return this.replies&&this.replies.length!==0}get lastUpdatedAt(){if(this._lastUpdatedAt===void 0){let e=this.comment.timestamp||"";if(this.replies.length){const i=this.replies[this.replies.length-1].lastUpdatedAt;i>e&&(e=i)}this._lastUpdatedAt=e}return this._lastUpdatedAt}};class fr{constructor(e,t,i,n){this.uniqueOwner=e,this.owner=t,this.id=i.toString(),this.resource=i,this.commentThreads=n.filter(o=>o.comments&&o.comments.length).map(o=>fr.createCommentNode(e,t,i,o))}static createCommentNode(e,t,i,n){const{comments:o}=n,r=o.map(a=>new Uc(e,t,i,a,n));return r.length>1&&(r[0].replies=r.slice(1,r.length)),r[0].isRoot=!0,r[0]}get lastUpdatedAt(){if(this._lastUpdatedAt===void 0){let e="";if(!this.commentThreads.length)return e;for(const t of this.commentThreads){const i=t.lastUpdatedAt;i&&i>e&&(e=i)}this._lastUpdatedAt=e}return this._lastUpdatedAt}}const b1="comments";class D$ extends F{constructor(e,t,i,n){super(),this.configurationService=e,this._date=ee(i,Y("span.timestamp")),this._date.style.display="none",this._useRelativeTime=this.useRelativeTimeSetting,this.hover=this._register(t.setupManagedHover(yr("mouse"),this._date,"")),this.setTimestamp(n)}get useRelativeTimeSetting(){return this.configurationService.getValue(b1).useRelativeTime}async setTimestamp(e){(e!==this._timestamp||this.useRelativeTimeSetting!==this._useRelativeTime)&&this.updateDate(e),this._timestamp=e,this._useRelativeTime=this.useRelativeTimeSetting}updateDate(e){if(!e)this._date.textContent="",this._date.style.display="none";else if(e!==this._timestamp||this.useRelativeTimeSetting!==this._useRelativeTime){this._date.style.display="";let t,i;this.useRelativeTimeSetting?(t=this.getRelative(e),i=this.getDateString(e)):t=this.getDateString(e),this._date.textContent=t,this.hover.update(i??"")}}getRelative(e){return Mne(e,!0,!0)}getDateString(e){return e.toLocaleString(sl)}}const k$=H("commentsView.resolvedIcon",{dark:O7,light:O7,hcDark:et,hcLight:et},h(5379,"Icon color for resolved comments.")),T$=H("commentsView.unresolvedIcon",{dark:F7,light:F7,hcDark:et,hcLight:et},h(5380,"Icon color for unresolved comments."));H("editorCommentsWidget.replyInputBackground",Jre,h(5381,"Background color for comment reply input box."));const oBe=H("editorCommentsWidget.resolvedBorder",{dark:k$,light:k$,hcDark:et,hcLight:et},h(5382,"Color of borders and arrow for resolved comments.")),H4=H("editorCommentsWidget.unresolvedBorder",{dark:T$,light:T$,hcDark:et,hcLight:et},h(5383,"Color of borders and arrow for unresolved comments."));H("editorCommentsWidget.rangeBackground",Je(H4,.1),h(5384,"Color of background for comment ranges."));H("editorCommentsWidget.rangeActiveBackground",Je(H4,.1),h(5385,"Color of background for currently selected or hovered comment range."));const rBe=new Map([[ld.Unresolved,H4],[ld.Resolved,oBe]]),aBe=new Map([[ld.Unresolved,T$],[ld.Resolved,k$]]),Gue="--comment-thread-state-color",yee="--comment-view-thread-state-color",que="--comment-thread-state-background-color";function zue(s,e,t){const i=s!==void 0?t.get(s):void 0;return i!==void 0?e.getColor(i):void 0}function cBe(s,e){return zue(s,e,rBe)}function dBe(s,e){return zue(s,e,aBe)}class im{static{this._filter=Mbe}static{this._messageFilter=$ne}constructor(e,t,i){this.filter=e,this.showResolved=!0,this.showUnresolved=!0,e=e.trim(),this.showResolved=t,this.showUnresolved=i;const n=e.startsWith("!");this.textFilter={text:(n?Gne(e,"!"):e).trim(),negate:n}}}function U4(s){return!!s.comments&&!!s.comments.length&&s.comments.some(e=>ec(e.body)?e.body.value.length>0:e.body.length>0)}class Kb extends F{get resourceCommentThreads(){return this._resourceCommentThreads}constructor(){super(),this._resourceCommentThreads=[],this.commentThreadsMap=new Map}updateResourceCommentThreads(){const e=this.commentThreadsMap.size>1;this._resourceCommentThreads=[...this.commentThreadsMap.values()].map(t=>t.resourceWithCommentThreads.map(i=>(i.ownerLabel=e?t.ownerLabel:void 0,i)).flat()).flat()}setCommentThreads(e,t,i,n){this.commentThreadsMap.set(e,{ownerLabel:i,resourceWithCommentThreads:this.groupByResource(e,t,n)}),this.updateResourceCommentThreads()}deleteCommentsByOwner(e){if(e){const t=this.commentThreadsMap.get(e);this.commentThreadsMap.set(e,{ownerLabel:t?.ownerLabel,resourceWithCommentThreads:[]})}else this.commentThreadsMap.clear();this.updateResourceCommentThreads()}updateCommentThreads(e){const{uniqueOwner:t,owner:i,ownerLabel:n,removed:o,changed:r,added:a}=e,c=this.commentThreadsMap.get(t)?.resourceWithCommentThreads||[];return o.forEach(d=>{const l=c.findIndex(m=>m.id===d.resource),u=l>=0?c[l]:void 0,g=u?.commentThreads.findIndex(m=>m.threadId===d.threadId)??0;g>=0&&u?.commentThreads.splice(g,1),u?.commentThreads.length===0&&c.splice(l,1)}),r.forEach(d=>{const l=c.findIndex(m=>m.id===d.resource),u=l>=0?c[l]:void 0;if(!u)return;const g=u.commentThreads.findIndex(m=>m.threadId===d.threadId);g>=0?u.commentThreads[g]=fr.createCommentNode(t,i,R.parse(u.id),d):d.comments&&d.comments.length&&u.commentThreads.push(fr.createCommentNode(t,i,R.parse(u.id),d))}),a.forEach(d=>{const l=c.filter(u=>u.resource.toString()===d.resource);if(l.length){const u=l[0];d.comments&&d.comments.length&&u.commentThreads.push(fr.createCommentNode(t,i,u.resource,d))}else c.push(new fr(t,i,R.parse(d.resource),[d]))}),this.commentThreadsMap.set(t,{ownerLabel:n,resourceWithCommentThreads:c}),this.updateResourceCommentThreads(),o.length>0||r.length>0||a.length>0}hasCommentThreads(){return!!this._resourceCommentThreads.length&&this._resourceCommentThreads.some(e=>e.commentThreads.length>0&&e.commentThreads.some(t=>U4(t.thread)))}getMessage(){return this._resourceCommentThreads.length?"":h(5463,"There are no comments in this workspace yet.")}groupByResource(e,t,i){const n=[],o=new Map;for(const r of VT(i,Kb._compareURIs))o.set(r[0].resource,new fr(e,t,R.parse(r[0].resource),r));return o.forEach((r,a,c)=>{n.push(r)}),n}static _compareURIs(e,t){const i=e.resource.toString(),n=t.resource.toString();return i<n?-1:i>n?1:0}}const qn="workbench.panel.comments",lBe="Comments",A$=I(5464,"Comments");class CL{static{this.RESOURCE_ID="resource-with-comments"}static{this.COMMENT_ID="comment-node"}getHeight(e){return e instanceof Uc&&e.hasReply()?44:22}getTemplateId(e){return e instanceof fr?CL.RESOURCE_ID:e instanceof Uc?CL.COMMENT_ID:""}}class hBe{constructor(e){this.labels=e,this.templateId="resource-with-comments"}renderTemplate(e){const t=ee(e,Y(".resource-container")),i=this.labels.create(t),n=ee(t,Y(".separator")),o=t.appendChild(Y(".owner"));return{resourceLabel:i,owner:o,separator:n}}renderElement(e,t,i){i.resourceLabel.setFile(e.element.resource),i.separator.innerText="·",e.element.ownerLabel?(i.owner.innerText=e.element.ownerLabel,i.separator.style.display="inline"):(i.owner.innerText="",i.separator.style.display="none")}disposeTemplate(e){e.resourceLabel.dispose()}}let R$=class{constructor(e){this.menuService=e}getResourceActions(e){return{actions:this.getActions(N.CommentsViewThreadActions,e).primary}}getResourceContextActions(e){return this.getActions(N.CommentsViewThreadActions,e).secondary}setContextKeyService(e){this.contextKeyService=e}getActions(e,t){if(!this.contextKeyService)return{primary:[],secondary:[]};const i=[["commentController",t.owner],["resourceScheme",t.resource.scheme],["commentThread",t.contextValue],["canReply",t.thread.canReply]],n=this.contextKeyService.createOverlay(i),o=this.menuService.getMenuActions(e,n,{shouldForwardArgs:!0});return qne(o,"inline")}dispose(){this.contextKeyService=void 0}};R$=f([p(0,tn)],R$);let P$=class{constructor(e,t,i,n,o,r){this.actionViewItemProvider=e,this.menus=t,this.openerService=i,this.configurationService=n,this.hoverService=o,this.themeService=r,this.templateId="comment-node"}renderTemplate(e){const t=ee(e,Y(".comment-thread-container")),i=ee(t,Y(".comment-metadata-container")),n=ee(i,Y(".comment-metadata")),o=ee(n,Y(".icon")),r=ee(n,Y(".user")),a=new D$(this.configurationService,this.hoverService,ee(n,Y(".timestamp-container"))),c=ee(n,Y(".relevance")),d=ee(n,Y(".separator")),l=ee(n,Y(".text")),u=ee(n,Y(".range")),g=Y("p");u.appendChild(g);const m={icon:o,userNames:r,timestamp:a,relevance:c,separator:d,commentPreview:l,range:g};m.separator.innerText="·";const v=ee(i,Y(".actions")),y=new Er(v,{actionViewItemProvider:this.actionViewItemProvider}),w=ee(t,Y(".comment-snippet-container")),C={container:w,icon:ee(w,Y(".icon")),count:ee(w,Y(".count")),lastReplyDetail:ee(w,Y(".reply-detail")),separator:ee(w,Y(".separator")),timestamp:new D$(this.configurationService,this.hoverService,ee(w,Y(".timestamp-container")))};C.separator.innerText="·",C.icon.classList.add(...Te.asClassNameArray(j.indent));const T=[m.timestamp,C.timestamp];return{threadMetadata:m,repliesMetadata:C,actionBar:y,disposables:T}}getCountString(e){return e>2?h(5465,"{0} replies",e-1):e===2?h(5466,"1 reply"):h(5467,"1 comment")}getRenderedComment(e,t){const i=lq(e,{inline:!0,actionHandler:{callback:r=>Mie(this.openerService,r,e.isTrusted),disposables:t}}),n=i.element.getElementsByTagName("img");for(let r=0;r<n.length;r++){const a=n[r],c=Y("");c.textContent=a.alt?h(5468,"Image: {0}",a.alt):h(5469,"Image"),a.parentNode.replaceChild(c,a)}const o=[...i.element.getElementsByTagName("h1"),...i.element.getElementsByTagName("h2"),...i.element.getElementsByTagName("h3"),...i.element.getElementsByTagName("h4"),...i.element.getElementsByTagName("h5"),...i.element.getElementsByTagName("h6")];for(const r of o){const a=document.createTextNode(r.textContent||"");r.parentNode.replaceChild(a,r)}for(;i.element.children.length>1&&i.element.firstElementChild?.tagName==="HR";)i.element.removeChild(i.element.firstElementChild);return i}getIcon(e){return e===ld.Unresolved?j.commentUnresolved:j.comment}renderElement(e,t,i){i.actionBar.clear();const n=e.element.replies.length+1;if(e.element.threadRelevance===zne.Outdated?(i.threadMetadata.relevance.style.display="",i.threadMetadata.relevance.innerText=h(5470,"Outdated"),i.threadMetadata.separator.style.display="none"):(i.threadMetadata.relevance.innerText="",i.threadMetadata.relevance.style.display="none",i.threadMetadata.separator.style.display=""),i.threadMetadata.icon.classList.remove(...Array.from(i.threadMetadata.icon.classList.values()).filter(c=>c.startsWith("codicon"))),i.threadMetadata.icon.classList.add(...Te.asClassNameArray(this.getIcon(e.element.threadState))),e.element.threadState!==void 0){const c=this.getCommentThreadWidgetStateColor(e.element.threadState,this.themeService.getColorTheme());i.threadMetadata.icon.style.setProperty(yee,`${c}`),i.threadMetadata.icon.style.color=`var(${yee})`}i.threadMetadata.userNames.textContent=e.element.comment.userName,i.threadMetadata.timestamp.setTimestamp(e.element.comment.timestamp?new Date(e.element.comment.timestamp):void 0);const o=e.element;if(i.threadMetadata.commentPreview.innerText="",i.threadMetadata.commentPreview.style.height="22px",typeof o.comment.body=="string")i.threadMetadata.commentPreview.innerText=o.comment.body;else{const c=new U;i.disposables.push(c);const d=this.getRenderedComment(o.comment.body,c);i.disposables.push(d);for(let l=d.element.children.length-1;l>=1;l--)d.element.removeChild(d.element.children[l]);i.threadMetadata.commentPreview.appendChild(d.element),i.disposables.push(this.hoverService.setupManagedHover(yr("mouse"),i.threadMetadata.commentPreview,d.element.textContent??""))}e.element.range&&(e.element.range.startLineNumber===e.element.range.endLineNumber?i.threadMetadata.range.textContent=h(5471,"[Ln {0}]",e.element.range.startLineNumber):i.threadMetadata.range.textContent=h(5472,"[Ln {0}-{1}]",e.element.range.startLineNumber,e.element.range.endLineNumber));const r=this.menus.getResourceActions(e.element);if(i.actionBar.push(r.actions,{icon:!0,label:!1}),i.actionBar.context={commentControlHandle:e.element.controllerHandle,commentThreadHandle:e.element.threadHandle,$mid:Nn.CommentThread},!e.element.hasReply()){i.repliesMetadata.container.style.display="none";return}i.repliesMetadata.container.style.display="",i.repliesMetadata.count.textContent=this.getCountString(n);const a=e.element.replies[e.element.replies.length-1].comment;i.repliesMetadata.lastReplyDetail.textContent=h(5473,"Last reply from {0}",a.userName),i.repliesMetadata.timestamp.setTimestamp(a.timestamp?new Date(a.timestamp):void 0)}getCommentThreadWidgetStateColor(e,t){return e!==void 0?dBe(e,t):void 0}disposeTemplate(e){e.disposables.forEach(t=>t.dispose()),e.actionBar.dispose()}};P$=f([p(2,hi),p(3,ne),p(4,wi),p(5,ft)],P$);var EL;(function(s){s[s.Resource=0]="Resource",s[s.Comment=1]="Comment"})(EL||(EL={}));class uBe{constructor(e){this.options=e}filter(e,t){return this.options.filter===""&&this.options.showResolved&&this.options.showUnresolved?cm.Visible:e instanceof fr?this.filterResourceMarkers(e):this.filterCommentNode(e,t)}filterResourceMarkers(e){if(this.options.textFilter.text&&!this.options.textFilter.negate){const t=im._filter(this.options.textFilter.text,je(e.resource));if(t)return{visibility:!0,data:{type:EL.Resource,uriMatches:t||[]}}}return cm.Recurse}filterCommentNode(e,t){if(!(e.threadState===void 0||this.options.showResolved&&ld.Resolved===e.threadState||this.options.showUnresolved&&ld.Unresolved===e.threadState))return!1;if(!this.options.textFilter.text)return!0;const n=im._messageFilter(this.options.textFilter.text,typeof e.comment.body=="string"?e.comment.body:e.comment.body.value)||im._messageFilter(this.options.textFilter.text,e.comment.userName)||e.replies.map(o=>im._messageFilter(this.options.textFilter.text,o.comment.userName)||im._messageFilter(this.options.textFilter.text,typeof o.comment.body=="string"?o.comment.body:o.comment.body.value)).filter(o=>!!o).flat();return n.length&&!this.options.textFilter.negate?{visibility:!0,data:{type:EL.Comment,textMatches:n}}:n.length&&this.options.textFilter.negate&&t===cm.Recurse?!1:n.length===0&&this.options.textFilter.negate&&t===cm.Recurse?!0:t}}let L$=class extends Nbe{constructor(e,t,i,n,o,r,a,c,d){const l=new CL,u=dw.bind(void 0,r),g=r.createInstance(R$);g.setContextKeyService(n);const m=[r.createInstance(hBe,e),r.createInstance(P$,u,g)];super("CommentsTree",t,l,m,{accessibilityProvider:i.accessibilityProvider,identityProvider:{getId:v=>v instanceof Kb?"root":v instanceof fr?`${v.uniqueOwner}-${v.id}`:v instanceof Uc?`${v.uniqueOwner}-${v.resource.toString()}-${v.threadId}-${v.comment.uniqueIdInThread}`+(v.isRoot?"-root":""):""},expandOnlyOnTwistieClick:!0,collapseByDefault:!1,overrideStyles:i.overrideStyles,filter:i.filter,sorter:i.sorter,findWidgetEnabled:!1,multipleSelectionSupport:!1},r,n,o,a),this.contextMenuService=c,this.keybindingService=d,this.menus=g,this.disposables.add(this.onContextMenu(v=>this.commentsOnContextMenu(v)))}commentsOnContextMenu(e){const t=e.element;if(!(t instanceof Uc))return;const i=e.browserEvent;i.preventDefault(),i.stopPropagation(),this.setFocus([t]);const n=this.menus.getResourceContextActions(t);n.length&&this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>n,getActionViewItem:o=>{const r=this.keybindingService.lookupKeybinding(o.id);if(r)return new qm(o,o,{label:!0,keybinding:r.getLabel()})},onHide:o=>{o&&this.domFocus()},getActionsContext:()=>({commentControlHandle:t.controllerHandle,commentThreadHandle:t.threadHandle,$mid:Nn.CommentThread,thread:t.thread})})}filterComments(){this.refilter()}getVisibleItemCount(){let e=0;const t=this.getNode();for(const i of t.children)for(const n of i.children)n.visible&&i.visible&&e++;return e}};L$=f([p(3,me),p(4,Si),p(5,J),p(6,ne),p(7,mi),p(8,Ve)],L$);const $4=new O("commentsFilterFocus",!1);var hl;(function(s){s.ResourceAscending="resourceAscending",s.UpdatedAtDescending="updatedAtDescending"})(hl||(hl={}));const Kue=new O("commentsView.showResolvedFilter",!0),jue=new O("commentsView.showUnResolvedFilter",!0),G4=new O("commentsView.sortBy",hl.ResourceAscending);class gBe extends F{constructor(e,t){super(),this.contextKeyService=t,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._showUnresolved=jue.bindTo(this.contextKeyService),this._showResolved=Kue.bindTo(this.contextKeyService),this._sortBy=G4.bindTo(this.contextKeyService),this._showResolved.set(e.showResolved),this._showUnresolved.set(e.showUnresolved),this._sortBy.set(e.sortBy)}get showUnresolved(){return!!this._showUnresolved.get()}set showUnresolved(e){this._showUnresolved.get()!==e&&(this._showUnresolved.set(e),this._onDidChange.fire({showUnresolved:!0}))}get showResolved(){return!!this._showResolved.get()}set showResolved(e){this._showResolved.get()!==e&&(this._showResolved.set(e),this._onDidChange.fire({showResolved:!0}))}get sortBy(){return this._sortBy.get()??hl.ResourceAscending}set sortBy(e){this._sortBy.get()!==e&&(this._sortBy.set(e),this._onDidChange.fire({sortBy:e}))}}K(class extends u_{constructor(){super({id:"commentsFocusViewFromFilter",title:h(5488,"Focus Comments view"),keybinding:{when:$4,weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.DownArrow},viewId:qn})}async runInView(s,e){e.focus()}});K(class extends u_{constructor(){super({id:"commentsClearFilterText",title:h(5489,"Clear filter text"),keybinding:{when:$4,weight:W.WorkbenchContrib,primary:S.Escape},viewId:qn})}async runInView(s,e){e.clearFilterText()}});K(class extends u_{constructor(){super({id:"commentsFocusFilter",title:h(5490,"Focus comments filter"),keybinding:{when:pl.isEqualTo(qn),weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyF},viewId:qn})}async runInView(s,e){e.focusFilter()}});K(class extends u_{constructor(){super({id:`workbench.actions.${qn}.toggleUnResolvedComments`,title:h(5491,"Show Unresolved"),category:h(5492,"Comments"),toggled:{condition:jue,title:h(5493,"Show Unresolved")},menu:{id:gD,group:"1_filter",when:x.equals("view",qn),order:1},viewId:qn})}async runInView(s,e){e.filters.showUnresolved=!e.filters.showUnresolved}});K(class extends u_{constructor(){super({id:`workbench.actions.${qn}.toggleResolvedComments`,title:h(5494,"Show Resolved"),category:h(5492,"Comments"),toggled:{condition:Kue,title:h(5495,"Show Resolved")},menu:{id:gD,group:"1_filter",when:x.equals("view",qn),order:1},viewId:qn})}async runInView(s,e){e.filters.showResolved=!e.filters.showResolved}});const q4=new N("submenu.filter.commentSort");ge.appendMenuItem(gD,{submenu:q4,title:h(5496,"Sort By"),group:"2_sort",icon:j.history,when:x.equals("view",qn)});K(class extends u_{constructor(){super({id:`workbench.actions.${qn}.toggleSortByUpdatedAt`,title:h(5497,"Updated Time"),category:h(5492,"Comments"),icon:j.history,viewId:qn,toggled:{condition:x.equals(G4.key,hl.UpdatedAtDescending),title:h(5498,"Updated Time")},menu:{id:q4,group:"navigation",order:1,isHiddenByDefault:!1}})}async runInView(s,e){e.filters.sortBy=hl.UpdatedAtDescending}});K(class extends u_{constructor(){super({id:`workbench.actions.${qn}.toggleSortByResource`,title:h(5499,"Position in File"),category:h(5492,"Comments"),icon:j.history,viewId:qn,toggled:{condition:x.equals(G4.key,hl.ResourceAscending),title:h(5500,"Position in File")},menu:{id:q4,group:"navigation",order:0,isHiddenByDefault:!1}})}async runInView(s,e){e.filters.sortBy=hl.ResourceAscending}});const Yue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),pBe=H("editorGutter.commentRangeForeground",{dark:W7(B7,ts),light:vr(W7(B7,ts),.05),hcDark:be.white,hcLight:be.black},h(5386,"Editor gutter decoration color for commenting ranges. This color should be opaque.")),Que=H("editorOverviewRuler.commentForeground",pBe,h(5387,"Editor overview ruler decoration color for resolved comments. This color should be opaque.")),fBe=H("editorOverviewRuler.commentUnresolvedForeground",Que,h(5388,"Editor overview ruler decoration color for unresolved comments. This color should be opaque.")),mBe=H("editorGutter.commentGlyphForeground",{dark:ao,light:ao,hcDark:be.black,hcLight:be.white},h(5389,"Editor gutter decoration color for commenting glyphs."));H("editorGutter.commentUnresolvedGlyphForeground",mBe,h(5390,"Editor gutter decoration color for commenting glyphs for unresolved comment threads."));class vD extends F{static{this.description="comment-glyph-widget"}constructor(e,t){super(),this._onDidChangeLineNumber=this._register(new M),this.onDidChangeLineNumber=this._onDidChangeLineNumber.event,this._commentsOptions=this.createDecorationOptions(),this._editor=e,this._commentsDecorations=this._editor.createDecorationsCollection(),this._register(this._commentsDecorations.onDidChange(i=>{const n=this._commentsDecorations.length>0?this._commentsDecorations.getRange(0):null;n&&n.endLineNumber!==this._lineNumber&&(this._lineNumber=n.endLineNumber,this._onDidChangeLineNumber.fire(this._lineNumber))})),this._register(Ee(()=>this._commentsDecorations.clear())),this.setLineNumber(t)}createDecorationOptions(){const e=this._threadState===ld.Unresolved,t={description:vD.description,isWholeLine:!0,overviewRuler:{color:es(e?fBe:Que),position:ol.Center},collapseOnReplaceEdit:!0,linesDecorationsClassName:`comment-range-glyph comment-thread${e?"-unresolved":""}`};return Yt.createDynamic(t)}setThreadState(e){this._threadState!==e&&(this._threadState=e,this._commentsOptions=this.createDecorationOptions(),this._updateDecorations())}_updateDecorations(){const e=[{range:{startLineNumber:this._lineNumber,startColumn:1,endLineNumber:this._lineNumber,endColumn:1},options:this._commentsOptions}];this._commentsDecorations.set(e)}setLineNumber(e){this._lineNumber=e,this._updateDecorations()}getPosition(){const e=this._commentsDecorations.length>0?this._commentsDecorations.getRange(0):null;return{position:{lineNumber:e?e.endLineNumber:this._lineNumber,column:1},preference:[Oi.EXACT]}}}var Vc;(function(s){s.Add="workbench.action.addComment",s.FocusCommentOnCurrentLine="workbench.action.focusCommentOnCurrentLine",s.NextThread="editor.action.nextCommentThreadAction",s.PreviousThread="editor.action.previousCommentThreadAction",s.NextCommentedRange="editor.action.nextCommentedRangeAction",s.PreviousCommentedRange="editor.action.previousCommentedRangeAction",s.NextRange="editor.action.nextCommentingRange",s.PreviousRange="editor.action.previousCommentingRange",s.ToggleCommenting="workbench.action.toggleCommenting",s.Submit="editor.action.submitComment",s.Hide="workbench.action.hideComment",s.CollapseAll="workbench.action.collapseAllComments",s.ExpandAll="workbench.action.expandAllComments",s.ExpandUnresolved="workbench.action.expandUnresolvedComments"})(Vc||(Vc={}));class Rx{constructor(e,t,i,n,o,r,a){this.keybindingService=e,this.contextKeyService=t,this.contextMenuService=i,this.container=n,this.actionHandler=o,this.maxActions=r,this.supportDropdowns=a,this._buttonElements=[],this._toDispose=new U,this._actions=[]}setActions(e,t=!1){this._toDispose.clear(),this._buttonElements.forEach(o=>o.remove()),this._buttonElements=[];const i=e.getActions({shouldForwardArgs:!0});let n=!t;for(const o of i){const[,r]=o;this._actions=r;for(const a of r){const c=this.supportDropdowns&&a instanceof kh?a.actions:[],d=c.length?c[0]:a;let l=this.keybindingService.lookupKeybinding(d.id,this.contextKeyService)?.getLabel();!l&&n&&(l=this.keybindingService.lookupKeybinding(Vc.Submit,this.contextKeyService)?.getLabel());const u=l?`${d.label} (${l})`:d.label,g=this.actionHandler,m=c.length?new Obe(this.container,{contextMenuProvider:this.contextMenuService,actions:c,actionRunner:this._toDispose.add(new class extends _g{async runAction(v,y){return g(v)}}),secondary:!n,title:u,addPrimaryActionToDropdown:!1,...XT}):new Xu(this.container,{secondary:!n,title:u,...XT});if(n=!1,this._buttonElements.push(m.element),this._toDispose.add(m),this._toDispose.add(m.onDidClick(()=>this.actionHandler(d))),m.enabled=d.enabled,m.label=d.label,this.maxActions!==void 0&&this._buttonElements.length>=this.maxActions){console.warn("An extension has contributed more than the allowable number of actions to a comments menu.");return}}}}triggerDefaultAction(){if(this._actions.length){const e=this._actions[0];if(e.enabled)return this.actionHandler(e)}}dispose(){this._toDispose.dispose()}}var Za;(function(s){s.activeCursorHasCommentingRange=new O("activeCursorHasCommentingRange",!1,{description:h(5508,"Whether the position at the active cursor has a commenting range"),type:"boolean"}),s.activeCursorHasComment=new O("activeCursorHasComment",!1,{description:h(5509,"Whether the position at the active cursor has a comment"),type:"boolean"}),s.activeEditorHasCommentingRange=new O("activeEditorHasCommentingRange",!1,{description:h(5510,"Whether the active editor has a commenting range"),type:"boolean"}),s.WorkspaceHasCommenting=new O("workspaceHasCommenting",!1,{description:h(5511,"Whether the open workspace has either comments or commenting ranges."),type:"boolean"}),s.commentThreadIsEmpty=new O("commentThreadIsEmpty",!1,{type:"boolean",description:h(5512,"Set when the comment thread has no comments")}),s.commentIsEmpty=new O("commentIsEmpty",!1,{type:"boolean",description:h(5513,"Set when the comment has no input")}),s.commentContext=new O("comment",void 0,{type:"string",description:h(5514,"The context value of the comment")}),s.commentThreadContext=new O("commentThread",void 0,{type:"string",description:h(5515,"The context value of the comment thread")}),s.commentControllerContext=new O("commentController",void 0,{type:"string",description:h(5516,"The comment controller id associated with a comment thread")}),s.commentFocused=new O("commentFocused",!1,{type:"boolean",description:h(5517,"Set when the comment is focused")}),s.commentingEnabled=new O("commentingEnabled",!0,{description:h(5518,"Whether commenting functionality is enabled"),type:"boolean"})})(Za||(Za={}));const vBe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var fT;Be(vBe);const Xue=new O("editorDictation.inProgress",!1),Zue=I(5245,"Voice");class _Be extends Rr{constructor(){super({id:"workbench.action.editorDictation.start",title:I(5246,"Start Dictation in Editor"),category:Zue,precondition:x.and(KLe,jLe.toNegated(),V.readOnly.toNegated()),f1:!0,keybinding:{primary:E.CtrlCmd|E.Alt|S.KeyV,weight:W.WorkbenchContrib,secondary:pn?[E.Alt|S.Backquote]:void 0}})}runEditorCommand(e,t){const n=e.get(Ve).enableKeybindingHoldMode(this.desc.id);if(n){let o=!1;const r=setTimeout(()=>{o=!0},500);n.finally(()=>{clearTimeout(r),o&&Lh.get(t)?.stop()})}Lh.get(t)?.start()}}class Px extends Rr{static{this.ID="workbench.action.editorDictation.stop"}constructor(){super({id:Px.ID,title:I(5247,"Stop Dictation in Editor"),category:Zue,precondition:Xue,f1:!0,keybinding:{primary:S.Escape,weight:W.WorkbenchContrib+100}})}runEditorCommand(e,t){Lh.get(t)?.stop()}}class bBe extends F{constructor(e,t){super(),this.editor=e,this.suppressMouseDown=!0,this.allowEditorOverflow=!0,this.domNode=document.createElement("div");const i=this._register(new Er(this.domNode)),n=t.lookupKeybinding(Px.ID)?.getLabel();i.push(Ci({id:Px.ID,label:n?h(5248,"Stop Dictation ({0})",n):h(5249,"Stop Dictation"),class:Te.asClassName(j.micFilled),run:()=>Lh.get(e)?.stop()}),{icon:!0,label:!1,keybinding:n}),this.domNode.classList.add("editor-dictation-widget"),this.domNode.appendChild(i.domNode)}getId(){return"editorDictation"}getDomNode(){return this.domNode}getPosition(){if(!this.editor.hasModel())return null;const e=this.editor.getSelection();return{position:e.getPosition(),preference:[e.getPosition().equals(e.getStartPosition())?Oi.ABOVE:Oi.BELOW,Oi.EXACT]}}beforeRender(){const e=this.editor.getPosition(),t=e?this.editor.getLineHeightForPosition(e):this.editor.getOption(L.lineHeight),i=this.editor.getLayoutInfo().contentWidth*.7;return this.domNode.style.setProperty("--vscode-editor-dictation-widget-height",`${t}px`),this.domNode.style.setProperty("--vscode-editor-dictation-widget-width",`${i}px`),null}show(){this.editor.addContentWidget(this)}layout(){this.editor.layoutContentWidget(this)}active(){this.domNode.classList.add("recording")}hide(){this.domNode.classList.remove("recording"),this.editor.removeContentWidget(this)}}let Lh=class extends F{static{fT=this}static{this.ID="editorDictation"}static get(e){return e.getContribution(fT.ID)}constructor(e,t,i,n){super(),this.editor=e,this.speechService=t,this.sessionDisposables=this._register(new kt),this.widget=this._register(new bBe(this.editor,n)),this.editorDictationInProgress=Xue.bindTo(i)}async start(){const e=new U;this.sessionDisposables.value=e,this.widget.show(),e.add(Ee(()=>this.widget.hide())),this.editorDictationInProgress.set(!0),e.add(Ee(()=>this.editorDictationInProgress.reset()));const t=this.editor.createDecorationsCollection();e.add(Ee(()=>t.clear())),e.add(this.editor.onDidChangeCursorPosition(()=>this.widget.layout()));let i,n=0;const o=(c,d)=>{i||(i=Gt(this.editor.getPosition()));const l=new _e(i.lineNumber,i.column+c.length);this.editor.executeEdits(fT.ID,[Ki.replace(P.fromPositions(i,i.with(void 0,i.column+n)),c)],[at.fromPositions(l)]),d?t.set([{range:P.fromPositions(i,i.with(void 0,i.column+c.length)),options:{description:"editor-dictation-preview",inlineClassName:"ghost-text-decoration-preview"}}]):t.clear(),n=c.length,d||(i=void 0,n=0),this.editor.revealPositionInCenterIfOutsideViewport(l)},r=new ri;e.add(Ee(()=>r.dispose(!0)));const a=await this.speechService.createSpeechToTextSession(r.token,"editor");e.add(a.onDidChange(c=>{if(!r.token.isCancellationRequested)switch(c.status){case ub.Started:this.widget.active();break;case ub.Stopped:e.dispose();break;case ub.Recognizing:{if(!c.text)return;o(c.text,!0);break}case ub.Recognized:{if(!c.text)return;o(`${c.text} `,!1);break}}}))}stop(){this.sessionDisposables.clear()}};Lh=fT=f([p(1,LN),p(2,me),p(3,Ve)],Lh);Rt(Lh.ID,Lh,vt.Lazy);K(_Be);K(Px);const gi=new class{constructor(){this.QuickFix=new Zt("quickfix"),this.Refactor=new Zt("refactor"),this.RefactorExtract=this.Refactor.append("extract"),this.RefactorInline=this.Refactor.append("inline"),this.RefactorMove=this.Refactor.append("move"),this.RefactorRewrite=this.Refactor.append("rewrite"),this.Notebook=new Zt("notebook"),this.Source=new Zt("source"),this.SourceOrganizeImports=this.Source.append("organizeImports"),this.SourceFixAll=this.Source.append("fixAll"),this.SurroundWith=this.Refactor.append("surround")}};var Gs;(function(s){s.IfSingle="ifSingle",s.First="first",s.Never="never"})(Gs||(Gs={}));var Dr;(function(s){s.Refactor="refactor",s.RefactorPreview="refactor preview",s.Lightbulb="lightbulb",s.Default="other (default)",s.SourceAction="source action",s.QuickFix="quick fix action",s.FixAll="fix all",s.OrganizeImports="organize imports",s.AutoFix="auto fix",s.QuickFixHover="quick fix hover window",s.OnSave="save participants",s.ProblemsView="problems view"})(Dr||(Dr={}));function yBe(s,e){return!(s.include&&!s.include.intersects(e)||s.excludes&&s.excludes.some(t=>Jue(e,t,s.include))||!s.includeSourceActions&&gi.Source.contains(e))}function wBe(s,e){const t=e.kind?new Zt(e.kind):void 0;return!(s.include&&(!t||!s.include.contains(t))||s.excludes&&t&&s.excludes.some(i=>Jue(t,i,s.include))||!s.includeSourceActions&&t&&gi.Source.contains(t)||s.onlyIncludePreferredActions&&!e.isPreferred)}function Jue(s,e,t){return!(!e.contains(s)||t&&e.contains(t))}class rh{static fromUser(e,t){return!e||typeof e!="object"?new rh(t.kind,t.apply,!1):new rh(rh.getKindFromUser(e,t.kind),rh.getApplyFromUser(e,t.apply),rh.getPreferredUser(e))}static getApplyFromUser(e,t){switch(typeof e.apply=="string"?e.apply.toLowerCase():""){case"first":return Gs.First;case"never":return Gs.Never;case"ifsingle":return Gs.IfSingle;default:return t}}static getKindFromUser(e,t){return typeof e.kind=="string"?new Zt(e.kind):t}static getPreferredUser(e){return typeof e.preferred=="boolean"?e.preferred:!1}constructor(e,t,i){this.kind=e,this.apply=t,this.preferred=i}}class SBe{constructor(e,t,i){this.action=e,this.provider=t,this.highlightRange=i}async resolve(e){if(this.provider?.resolveCodeAction&&!this.action.edit){let t;try{t=await this.provider.resolveCodeAction(this.action,e)}catch(i){kn(i)}t&&(this.action.edit=t.edit)}return this}}const z4="editor.action.codeAction",K4="editor.action.quickFix",ege="editor.action.autoFix",j4="editor.action.refactor",Y4="editor.action.sourceAction",M$="editor.action.organizeImports",N$="editor.action.fixAll",CBe=1e3;class eE extends F{static codeActionsPreferredComparator(e,t){return e.isPreferred&&!t.isPreferred?-1:!e.isPreferred&&t.isPreferred?1:0}static codeActionsComparator({action:e},{action:t}){return e.isAI&&!t.isAI?1:!e.isAI&&t.isAI?-1:xn(e.diagnostics)?xn(t.diagnostics)?eE.codeActionsPreferredComparator(e,t):-1:xn(t.diagnostics)?1:eE.codeActionsPreferredComparator(e,t)}constructor(e,t,i){super(),this.documentation=t,this._register(i),this.allActions=[...e].sort(eE.codeActionsComparator),this.validActions=this.allActions.filter(({action:n})=>!n.disabled)}get hasAutoFix(){return this.validActions.some(({action:e})=>!!e.kind&&gi.QuickFix.contains(new Zt(e.kind))&&!!e.isPreferred)}get hasAIFix(){return this.validActions.some(({action:e})=>!!e.isAI)}get allAIFixes(){return this.validActions.every(({action:e})=>!!e.isAI)}}const wee={actions:[],documentation:void 0};async function vm(s,e,t,i,n,o){const r=i.filter||{},a={...r,excludes:[...r.excludes||[],gi.Notebook]},c={only:r.include?.value,trigger:i.type},d=new kSe(e,o),l=i.type===Bo.Auto,u=EBe(s,e,l?a:r),g=new U,m=u.map(async y=>{const w=setTimeout(()=>n.report(y),1250);try{const C=await y.provideCodeActions(e,t,c,d.token);if(C&&g.add(C),d.token.isCancellationRequested)return wee;const T=(C?.actions||[]).filter(A=>A&&wBe(r,A)),k=IBe(y,T,r.include);return{actions:T.map(A=>new SBe(A,y)),documentation:k}}catch(C){if(gs(C))throw C;return kn(C),wee}finally{clearTimeout(w)}}),v=s.onDidChange(()=>{const y=s.all(e);ns(y,u)||d.cancel()});try{const y=await Promise.all(m),w=y.map(k=>k.actions).flat(),C=[...Vt(y.map(k=>k.documentation)),...xBe(s,e,i,w)],T=new eE(w,C,g);return g.add(T),T}catch(y){throw g.dispose(),y}finally{v.dispose(),d.dispose()}}function EBe(s,e,t){return s.all(e).filter(i=>i.providedCodeActionKinds?i.providedCodeActionKinds.some(n=>yBe(t,new Zt(n))):!0)}function*xBe(s,e,t,i){if(e&&i.length)for(const n of s.all(e))n._getAdditionalMenuItems&&(yield*n._getAdditionalMenuItems?.({trigger:t.type,only:t.filter?.include?.value},i.map(o=>o.action)))}function IBe(s,e,t){if(!s.documentation)return;const i=s.documentation.map(n=>({kind:new Zt(n.kind),command:n.command}));if(t){let n;for(const o of i)o.kind.contains(t)&&(n?n.kind.contains(o.kind)&&(n=o):n=o);if(n)return n?.command}for(const n of e)if(n.kind){for(const o of i)if(o.kind.contains(new Zt(n.kind)))return o.command}}var ku;(function(s){s.OnSave="onSave",s.FromProblemsView="fromProblemsView",s.FromCodeActions="fromCodeActions",s.FromAILightbulb="fromAILightbulb",s.FromProblemsHover="fromProblemsHover"})(ku||(ku={}));async function tge(s,e,t,i,n=ye.None){const o=s.get(gw),r=s.get(qe),a=s.get(li),c=s.get(At),d=s.get(cI);if(a.publicLog2("codeAction.applyCodeAction",{codeActionTitle:e.action.title,codeActionKind:e.action.kind,codeActionIsPreferred:!!e.action.isPreferred,reason:t}),d.playSignal(Up.codeActionTriggered),await e.resolve(n),!n.isCancellationRequested&&!(e.action.edit?.edits.length&&!(await o.apply(e.action.edit,{editor:i?.editor,label:e.action.title,quotableLabel:e.action.title,code:"undoredo.codeAction",respectAutoSaveConfig:t!==ku.OnSave,showPreview:i?.preview})).isApplied)){if(e.action.command)try{await r.executeCommand(e.action.command.id,...e.action.command.arguments||[])}catch(l){const u=DBe(l);c.error(typeof u=="string"?u:h(896,"An unknown error occurred while applying the code action"))}setTimeout(()=>d.playSignal(Up.codeActionApplied),CBe)}}function DBe(s){return typeof s=="string"?s:s instanceof Error&&typeof s.message=="string"?s.message:void 0}Ce.registerCommand("_executeCodeActionProvider",async function(s,e,t,i,n){if(!(e instanceof R))throw Mt();const{codeActionProvider:o}=s.get(Ne),r=s.get(ai).getModel(e);if(!r)throw Mt();const a=at.isISelection(t)?at.liftSelection(t):P.isIRange(t)?r.validateRange(t):void 0;if(!a)throw Mt();const c=typeof i=="string"?new Zt(i):void 0,d=await vm(o,r,a,{type:Bo.Invoke,triggerAction:Dr.Default,filter:{includeSourceActions:!0,include:c}},Jc.None,ye.None),l=[],u=Math.min(d.validActions.length,typeof n=="number"?n:0);for(let g=0;g<u;g++)l.push(d.validActions[g].resolve(ye.None));try{return await Promise.all(l),d.validActions.map(g=>g.action)}finally{setTimeout(()=>d.dispose(),100)}});var O$;let F$=class{static{O$=this}static{this.codeActionCommands=[j4,z4,Y4,M$,N$]}constructor(e){this.keybindingService=e}getResolver(){const e=new Ju(()=>this.keybindingService.getKeybindings().filter(t=>O$.codeActionCommands.indexOf(t.command)>=0).filter(t=>t.resolvedKeybinding).map(t=>{let i=t.commandArgs;return t.command===M$?i={kind:gi.SourceOrganizeImports.value}:t.command===N$&&(i={kind:gi.SourceFixAll.value}),{resolvedKeybinding:t.resolvedKeybinding,...rh.fromUser(i,{kind:Zt.None,apply:Gs.Never})}}));return t=>{if(t.kind)return this.bestKeybindingForCodeAction(t,e.value)?.resolvedKeybinding}}bestKeybindingForCodeAction(e,t){if(!e.kind)return;const i=new Zt(e.kind);return t.filter(n=>n.kind.contains(i)).filter(n=>n.preferred?e.isPreferred:!0).reduceRight((n,o)=>n?n.kind.contains(o.kind)?o:n:o,void 0)}};F$=O$=f([p(0,Ve)],F$);const ige=Object.freeze({kind:Zt.Empty,title:h(932,"More Actions...")}),kBe=Object.freeze([{kind:gi.QuickFix,title:h(933,"Quick Fix")},{kind:gi.RefactorExtract,title:h(934,"Extract"),icon:j.wrench},{kind:gi.RefactorInline,title:h(935,"Inline"),icon:j.wrench},{kind:gi.RefactorRewrite,title:h(936,"Rewrite"),icon:j.wrench},{kind:gi.RefactorMove,title:h(937,"Move"),icon:j.wrench},{kind:gi.SurroundWith,title:h(938,"Surround With"),icon:j.surroundWith},{kind:gi.Source,title:h(939,"Source Action"),icon:j.symbolFile},ige]);function TBe(s,e,t){if(!e)return s.map(o=>({kind:Uo.Action,item:o,group:ige,disabled:!!o.action.disabled,label:o.action.disabled||o.action.title,canPreview:!!o.action.edit?.edits.length}));const i=kBe.map(o=>({group:o,actions:[]}));for(const o of s){const r=o.action.kind?new Zt(o.action.kind):Zt.None;for(const a of i)if(a.group.kind.contains(r)){a.actions.push(o);break}}const n=[];for(const o of i)if(o.actions.length){n.push({kind:Uo.Header,group:o.group});for(const r of o.actions){const a=o.group;n.push({kind:Uo.Action,item:r,group:r.action.isAI?{title:a.title,kind:a.kind,icon:j.sparkle}:a,label:r.action.title,disabled:!!r.action.disabled,keybinding:t(r.action)})}}return n}const nge=new O("supportedCodeAction",""),See="_typescript.applyFixAllCodeAction";class ABe extends F{constructor(e,t,i,n=250){super(),this._editor=e,this._markerService=t,this._signalChange=i,this._delay=n,this._autoTriggerTimer=this._register(new iI),this._register(this._markerService.onMarkerChanged(o=>this._onMarkerChanges(o))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(e){const t=this._getRangeOfSelectionUnlessWhitespaceEnclosed(e);this._signalChange(t?{trigger:e,selection:t}:void 0)}_onMarkerChanges(e){const t=this._editor.getModel();t&&e.some(i=>Dt(i,t.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:Bo.Auto,triggerAction:Dr.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(e){if(!this._editor.hasModel())return;const t=this._editor.getSelection();if(e.type===Bo.Invoke)return t;const i=this._editor.getOption(L.lightbulb).enabled;if(i!==n0.Off){{if(i===n0.On)return t;if(i===n0.OnCode){if(!t.isEmpty())return t;const o=this._editor.getModel(),{lineNumber:r,column:a}=t.getPosition(),c=o.getLineContent(r);if(c.length===0)return;if(a===1){if(/\s/.test(c[0]))return}else if(a===o.getLineMaxColumn(r)){if(/\s/.test(c[c.length-1]))return}else if(/\s/.test(c[a-2])&&/\s/.test(c[a-1]))return}}return t}}}var Gd;(function(s){let e;(function(i){i[i.Empty=0]="Empty",i[i.Triggered=1]="Triggered"})(e=s.Type||(s.Type={})),s.Empty={type:e.Empty};class t{constructor(n,o,r){this.trigger=n,this.position=o,this._cancellablePromise=r,this.type=e.Triggered,this.actions=r.catch(a=>{if(gs(a))return W$;throw a})}cancel(){this._cancellablePromise.cancel()}}s.Triggered=t})(Gd||(Gd={}));const W$=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1,hasAIFix:!1,allAIFixes:!1});class RBe extends F{constructor(e,t,i,n,o,r){super(),this._editor=e,this._registry=t,this._markerService=i,this._progressService=o,this._configurationService=r,this._codeActionOracle=this._register(new kt),this._state=Gd.Empty,this._onDidChangeState=this._register(new M),this.onDidChangeState=this._onDidChangeState.event,this.codeActionsDisposable=this._register(new kt),this._disposed=!1,this._supportedCodeActions=nge.bindTo(n),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._register(this._editor.onDidChangeConfiguration(a=>{a.hasChanged(L.lightbulb)&&this._update()})),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState(Gd.Empty,!0))}_settingEnabledNearbyQuickfixes(){const e=this._editor?.getModel();return this._configurationService?this._configurationService.getValue("editor.codeActionWidget.includeNearbyQuickFixes",{resource:e?.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState(Gd.Empty);const e=this._editor.getModel();if(e&&this._registry.has(e)&&!this._editor.getOption(L.readOnly)){const t=this._registry.all(e).flatMap(i=>i.providedCodeActionKinds??[]);this._supportedCodeActions.set(t.join(" ")),this._codeActionOracle.value=new ABe(this._editor,this._markerService,i=>{if(!i){this.setState(Gd.Empty);return}const n=i.selection.getStartPosition(),o=En(async c=>{if(this._settingEnabledNearbyQuickfixes()&&i.trigger.type===Bo.Invoke&&(i.trigger.triggerAction===Dr.QuickFix||i.trigger.filter?.include?.contains(gi.QuickFix))){const l=await vm(this._registry,e,i.selection,i.trigger,Jc.None,c);this.codeActionsDisposable.value=l;const u=[...l.allActions];if(c.isCancellationRequested)return l.dispose(),W$;const g=l.validActions?.some(v=>v.action.kind?gi.QuickFix.contains(new Zt(v.action.kind)):!1),m=this._markerService.read({resource:e.uri});if(g){for(const v of l.validActions)v.action.command?.arguments?.some(y=>typeof y=="string"&&y.includes(See))&&(v.action.diagnostics=[...m.filter(y=>y.relatedInformation)]);return{validActions:l.validActions,allActions:u,documentation:l.documentation,hasAutoFix:l.hasAutoFix,hasAIFix:l.hasAIFix,allAIFixes:l.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=l}}}else if(!g&&m.length>0){const v=i.selection.getPosition();let y=v,w=Number.MAX_VALUE;const C=[...l.validActions];for(const k of m){const A=k.endColumn,B=k.endLineNumber,z=k.startLineNumber;if(B===v.lineNumber||z===v.lineNumber){y=new _e(B,A);const Q={type:i.trigger.type,triggerAction:i.trigger.triggerAction,filter:{include:i.trigger.filter?.include?i.trigger.filter?.include:gi.QuickFix},autoApply:i.trigger.autoApply,context:{notAvailableMessage:i.trigger.context?.notAvailableMessage||"",position:y}},ie=new at(y.lineNumber,y.column,y.lineNumber,y.column),oe=await vm(this._registry,e,ie,Q,Jc.None,c);if(c.isCancellationRequested)return oe.dispose(),W$;if(oe.validActions.length!==0){for(const xe of oe.validActions)xe.action.command?.arguments?.some(Se=>typeof Se=="string"&&Se.includes(See))&&(xe.action.diagnostics=[...m.filter(Se=>Se.relatedInformation)]);l.allActions.length===0&&u.push(...oe.allActions),Math.abs(v.column-A)<w?C.unshift(...oe.validActions):C.push(...oe.validActions)}w=Math.abs(v.column-A)}}const T=C.filter((k,A,B)=>B.findIndex(z=>z.action.title===k.action.title)===A);return T.sort((k,A)=>k.action.isPreferred&&!A.action.isPreferred?-1:!k.action.isPreferred&&A.action.isPreferred||k.action.isAI&&!A.action.isAI?1:!k.action.isAI&&A.action.isAI?-1:0),{validActions:T,allActions:u,documentation:l.documentation,hasAutoFix:l.hasAutoFix,hasAIFix:l.hasAIFix,allAIFixes:l.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=l}}}}if(i.trigger.type===Bo.Invoke){const l=await vm(this._registry,e,i.selection,i.trigger,Jc.None,c);return this.codeActionsDisposable.value=l,l}const d=await vm(this._registry,e,i.selection,i.trigger,Jc.None,c);return this.codeActionsDisposable.value=d,d});i.trigger.type===Bo.Invoke&&this._progressService?.showWhile(o,250);const r=new Gd.Triggered(i.trigger,n,o);let a=!1;this._state.type===Gd.Type.Triggered&&(a=this._state.trigger.type===Bo.Invoke&&r.type===Gd.Type.Triggered&&r.trigger.type===Bo.Auto&&this._state.position!==r.position),a?setTimeout(()=>{this.setState(r)},500):this.setState(r)},void 0),this._codeActionOracle.value.trigger({type:Bo.Auto,triggerAction:Dr.Default})}else this._supportedCodeActions.reset()}trigger(e){this._codeActionOracle.value?.trigger(e),this.codeActionsDisposable.dispose()}setState(e,t){e!==this._state&&(this._state.type===Gd.Type.Triggered&&this._state.cancel(),this._state=e,!t&&!this._disposed&&this._onDidChangeState.fire(e))}}const PBe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var N_;Be(PBe);const Cee=Ae("gutter-lightbulb",j.lightBulb,h(940,"Icon which spawns code actions menu from the gutter when there is no space in the editor.")),Eee=Ae("gutter-lightbulb-auto-fix",j.lightbulbAutofix,h(941,"Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.")),xee=Ae("gutter-lightbulb-sparkle",j.lightbulbSparkle,h(942,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.")),Iee=Ae("gutter-lightbulb-aifix-auto-fix",j.lightbulbSparkleAutofix,h(943,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.")),Dee=Ae("gutter-lightbulb-sparkle-filled",j.sparkleFilled,h(944,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available."));var Qs;(function(s){let e;(function(i){i[i.Hidden=0]="Hidden",i[i.Showing=1]="Showing"})(e=s.Type||(s.Type={})),s.Hidden={type:e.Hidden};class t{constructor(n,o,r,a){this.actions=n,this.trigger=o,this.editorPosition=r,this.widgetPosition=a,this.type=e.Showing}}s.Showing=t})(Qs||(Qs={}));let Lx=class extends F{static{N_=this}static{this.GUTTER_DECORATION=Yt.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:Te.asClassName(j.lightBulb),glyphMargin:{position:TF.Left},stickiness:Di.NeverGrowsWhenTypingAtEdges})}static{this.ID="editor.contrib.lightbulbWidget"}static{this._posPref=[Oi.EXACT]}constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._onClick=this._register(new M),this.onClick=this._onClick.event,this._state=Qs.Hidden,this._gutterState=Qs.Hidden,this._iconClasses=[],this.lightbulbClasses=["codicon-"+Cee.id,"codicon-"+Iee.id,"codicon-"+Eee.id,"codicon-"+xee.id,"codicon-"+Dee.id],this.gutterDecoration=N_.GUTTER_DECORATION,this._domNode=Y("div.lightBulbWidget"),this._domNode.role="listbox",this._register(Th.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(i=>{const n=this._editor.getModel();(this.state.type!==Qs.Type.Showing||!n||this.state.editorPosition.lineNumber>=n.getLineCount())&&this.hide(),(this.gutterState.type!==Qs.Type.Showing||!n||this.gutterState.editorPosition.lineNumber>=n.getLineCount())&&this.gutterHide()})),this._register(Fbe(this._domNode,i=>{if(this.state.type!==Qs.Type.Showing)return;this._editor.focus(),i.preventDefault();const{top:n,height:o}=Ms(this._domNode),r=this._editor.getOption(L.lineHeight);let a=Math.floor(r/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(a+=r),this._onClick.fire({x:i.posx,y:n+o+a,actions:this.state.actions,trigger:this.state.trigger})})),this._register(re(this._domNode,"mouseenter",i=>{(i.buttons&1)===1&&this.hide()})),this._register(D.runAndSubscribe(this._keybindingService.onDidUpdateKeybindings,()=>{this._preferredKbLabel=this._keybindingService.lookupKeybinding(ege)?.getLabel()??void 0,this._quickFixKbLabel=this._keybindingService.lookupKeybinding(K4)?.getLabel()??void 0,this._updateLightBulbTitleAndIcon()})),this._register(this._editor.onMouseDown(async i=>{if(!i.target.element||!this.lightbulbClasses.some(c=>i.target.element&&i.target.element.classList.contains(c))||this.gutterState.type!==Qs.Type.Showing)return;this._editor.focus();const{top:n,height:o}=Ms(i.target.element),r=this._editor.getOption(L.lineHeight);let a=Math.floor(r/3);this.gutterState.widgetPosition.position!==null&&this.gutterState.widgetPosition.position.lineNumber<this.gutterState.editorPosition.lineNumber&&(a+=r),this._onClick.fire({x:i.event.posx,y:n+o+a,actions:this.gutterState.actions,trigger:this.gutterState.trigger})}))}dispose(){super.dispose(),this._editor.removeContentWidget(this),this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID)}getId(){return"LightBulbWidget"}getDomNode(){return this._domNode}getPosition(){return this._state.type===Qs.Type.Showing?this._state.widgetPosition:null}update(e,t,i){if(e.validActions.length<=0)return this.gutterHide(),this.hide();if(!this._editor.hasTextFocus())return this.gutterHide(),this.hide();if(!this._editor.getOptions().get(L.lightbulb).enabled)return this.gutterHide(),this.hide();const r=this._editor.getModel();if(!r)return this.gutterHide(),this.hide();const{lineNumber:a,column:c}=r.validatePosition(i),d=r.getOptions().tabSize,l=this._editor.getOptions().get(L.fontInfo),u=r.getLineContent(a),g=Wbe(u,d),m=l.spaceWidth*g>22,v=B=>B>2&&this._editor.getTopForLineNumber(B)===this._editor.getTopForLineNumber(B-1),y=this._editor.getLineDecorations(a);let w=!1;if(y)for(const B of y){const z=B.options.glyphMarginClassName;if(z&&!this.lightbulbClasses.some(Q=>z.includes(Q))){w=!0;break}}let C=a,T=1;if(!m){const B=z=>{const Q=r.getLineContent(z);return/^\s*$|^\s+/.test(Q)||Q.length<=T};if(a>1&&!v(a-1)){const z=r.getLineCount(),Q=a===z,ie=a>1&&B(a-1),oe=!Q&&B(a+1),xe=B(a),Se=!oe&&!ie;if(!oe&&!ie&&!w)return this.gutterState=new Qs.Showing(e,t,i,{position:{lineNumber:C,column:T},preference:N_._posPref}),this.renderGutterLightbub(),this.hide();ie||Q||ie&&!xe?C-=1:(oe||Se&&xe)&&(C+=1)}else if(a===1&&(a===r.getLineCount()||!B(a+1)&&!B(a)))if(this.gutterState=new Qs.Showing(e,t,i,{position:{lineNumber:C,column:T},preference:N_._posPref}),w)this.gutterHide();else return this.renderGutterLightbub(),this.hide();else if(a<r.getLineCount()&&!v(a+1))C+=1;else if(c*l.spaceWidth<22)return this.hide();T=/^\S\s*$/.test(r.getLineContent(C))?2:1}this.state=new Qs.Showing(e,t,i,{position:{lineNumber:C,column:T},preference:N_._posPref}),this._gutterDecorationID&&(this._removeGutterDecoration(this._gutterDecorationID),this.gutterHide());const k=e.validActions,A=e.validActions[0].action.kind;if(k.length!==1||!A){this._editor.layoutContentWidget(this);return}this._editor.layoutContentWidget(this)}hide(){this.state!==Qs.Hidden&&(this.state=Qs.Hidden,this._editor.layoutContentWidget(this))}gutterHide(){this.gutterState!==Qs.Hidden&&(this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID),this.gutterState=Qs.Hidden)}get state(){return this._state}set state(e){this._state=e,this._updateLightBulbTitleAndIcon()}get gutterState(){return this._gutterState}set gutterState(e){this._gutterState=e,this._updateGutterLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this._domNode.classList.remove(...this._iconClasses),this._iconClasses=[],this.state.type!==Qs.Type.Showing)return;let e,t=!1;this.state.actions.allAIFixes?(e=j.sparkleFilled,this.state.actions.validActions.length===1&&(t=!0)):this.state.actions.hasAutoFix?this.state.actions.hasAIFix?e=j.lightbulbSparkleAutofix:e=j.lightbulbAutofix:this.state.actions.hasAIFix?e=j.lightbulbSparkle:e=j.lightBulb,this._updateLightbulbTitle(this.state.actions.hasAutoFix,t),this._iconClasses=Te.asClassNameArray(e),this._domNode.classList.add(...this._iconClasses)}_updateGutterLightBulbTitleAndIcon(){if(this.gutterState.type!==Qs.Type.Showing)return;let e,t=!1;this.gutterState.actions.allAIFixes?(e=Dee,this.gutterState.actions.validActions.length===1&&(t=!0)):this.gutterState.actions.hasAutoFix?this.gutterState.actions.hasAIFix?e=Iee:e=Eee:this.gutterState.actions.hasAIFix?e=xee:e=Cee,this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix,t);const i=Yt.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:Te.asClassName(e),glyphMargin:{position:TF.Left},stickiness:Di.NeverGrowsWhenTypingAtEdges});this.gutterDecoration=i}renderGutterLightbub(){const e=this._editor.getSelection();e&&(this._gutterDecorationID===void 0?this._addGutterDecoration(e.startLineNumber):this._updateGutterDecoration(this._gutterDecorationID,e.startLineNumber))}_addGutterDecoration(e){this._editor.changeDecorations(t=>{this._gutterDecorationID=t.addDecoration(new P(e,0,e,0),this.gutterDecoration)})}_removeGutterDecoration(e){this._editor.changeDecorations(t=>{t.removeDecoration(e),this._gutterDecorationID=void 0})}_updateGutterDecoration(e,t){this._editor.changeDecorations(i=>{i.changeDecoration(e,new P(t,0,t,0)),i.changeDecorationOptions(e,this.gutterDecoration)})}_updateLightbulbTitle(e,t){this.state.type===Qs.Type.Showing&&(t?this.title=h(945,"Run: {0}",this.state.actions.validActions[0].action.title):e&&this._preferredKbLabel?this.title=h(946,"Show Code Actions. Preferred Quick Fix Available ({0})",this._preferredKbLabel):!e&&this._quickFixKbLabel?this.title=h(947,"Show Code Actions ({0})",this._quickFixKbLabel):e||(this.title=h(948,"Show Code Actions")))}set title(e){this._domNode.title=e}};Lx=N_=f([p(1,Ve)],Lx);var O_;const LBe="quickfix-edit-highlight";let ef=class extends F{static{O_=this}static{this.ID="editor.contrib.codeActionController"}static get(e){return e.getContribution(O_.ID)}constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this._commandService=a,this._configurationService=c,this._actionWidgetService=d,this._instantiationService=l,this._progressService=u,this._activeCodeActions=this._register(new kt),this._showDisabled=!1,this._disposed=!1,this._editor=e,this._model=this._register(new RBe(this._editor,o.codeActionProvider,t,i,r,c)),this._register(this._model.onDidChangeState(g=>this.update(g))),this._lightBulbWidget=new Ju(()=>{const g=this._editor.getContribution(Lx.ID);return g&&this._register(g.onClick(m=>this.showCodeActionsFromLightbulb(m.actions,m))),g}),this._resolver=n.createInstance(F$),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}async showCodeActionsFromLightbulb(e,t){if(e.allAIFixes&&e.validActions.length===1){const i=e.validActions[0],n=i.action.command;n&&n.id==="inlineChat.start"&&n.arguments&&n.arguments.length>=1&&(n.arguments[0]={...n.arguments[0],autoSend:!1}),await this.applyCodeAction(i,!1,!1,ku.FromAILightbulb);return}await this.showCodeActionList(e,t,{includeDisabledActions:!1,fromLightbulb:!0})}showCodeActions(e,t,i){return this.showCodeActionList(t,i,{includeDisabledActions:!1,fromLightbulb:!1})}hideCodeActions(){this._actionWidgetService.hide()}manualTriggerAtCurrentPosition(e,t,i,n){if(!this._editor.hasModel())return;wr.get(this._editor)?.closeMessage();const o=this._editor.getPosition();this._trigger({type:Bo.Invoke,triggerAction:t,filter:i,autoApply:n,context:{notAvailableMessage:e,position:o}})}_trigger(e){return this._model.trigger(e)}async applyCodeAction(e,t,i,n){const o=this._progressService.show(!0,500);try{await this._instantiationService.invokeFunction(tge,e,n,{preview:i,editor:this._editor})}finally{t&&this._trigger({type:Bo.Auto,triggerAction:Dr.QuickFix,filter:{}}),o.done()}}hideLightBulbWidget(){this._lightBulbWidget.rawValue?.hide(),this._lightBulbWidget.rawValue?.gutterHide()}async update(e){if(e.type!==Gd.Type.Triggered){this.hideLightBulbWidget();return}let t;try{t=await e.actions}catch(n){mt(n);return}if(!(this._disposed||this._editor.getSelection()?.startLineNumber!==e.position.lineNumber))if(this._lightBulbWidget.value?.update(t,e.trigger,e.position),e.trigger.type===Bo.Invoke){if(e.trigger.filter?.include){const o=this.tryGetValidActionToApply(e.trigger,t);if(o){try{this.hideLightBulbWidget(),await this.applyCodeAction(o,!1,!1,ku.FromCodeActions)}finally{t.dispose()}return}if(e.trigger.context){const r=this.getInvalidActionThatWouldHaveBeenApplied(e.trigger,t);if(r&&r.action.disabled){wr.get(this._editor)?.showMessage(r.action.disabled,e.trigger.context.position),t.dispose();return}}}const n=!!e.trigger.filter?.include;if(e.trigger.context&&(!t.allActions.length||!n&&!t.validActions.length)){wr.get(this._editor)?.showMessage(e.trigger.context.notAvailableMessage,e.trigger.context.position),this._activeCodeActions.value=t,t.dispose();return}this._activeCodeActions.value=t,this.showCodeActionList(t,this.toCoords(e.position),{includeDisabledActions:n,fromLightbulb:!1})}else this._actionWidgetService.isVisible?t.dispose():this._activeCodeActions.value=t}getInvalidActionThatWouldHaveBeenApplied(e,t){if(t.allActions.length&&(e.autoApply===Gs.First&&t.validActions.length===0||e.autoApply===Gs.IfSingle&&t.allActions.length===1))return t.allActions.find(({action:i})=>i.disabled)}tryGetValidActionToApply(e,t){if(t.validActions.length&&(e.autoApply===Gs.First&&t.validActions.length>0||e.autoApply===Gs.IfSingle&&t.validActions.length===1))return t.validActions[0]}static{this.DECORATION=Yt.register({description:"quickfix-highlight",className:LBe})}async showCodeActionList(e,t,i){const n=this._editor.createDecorationsCollection(),o=this._editor.getDomNode();if(!o)return;const r=i.includeDisabledActions&&(this._showDisabled||e.validActions.length===0)?e.allActions:e.validActions;if(!r.length)return;const a=_e.isIPosition(t)?this.toCoords(t):t,c={onSelect:async(d,l)=>{this.applyCodeAction(d,!0,!!l,i.fromLightbulb?ku.FromAILightbulb:ku.FromCodeActions),this._actionWidgetService.hide(!1),n.clear()},onHide:d=>{this._editor?.focus(),n.clear()},onHover:async(d,l)=>{if(l.isCancellationRequested)return;let u=!1;const g=d.action.kind;if(g){const m=new Zt(g);u=[gi.RefactorExtract,gi.RefactorInline,gi.RefactorRewrite,gi.RefactorMove,gi.Source].some(y=>y.contains(m))}return{canPreview:u||!!d.action.edit?.edits.length}},onFocus:d=>{if(d&&d.action){const l=d.action.ranges,u=d.action.diagnostics;if(n.clear(),l&&l.length>0){const g=u&&u?.length>1?u.map(m=>({range:m,options:O_.DECORATION})):l.map(m=>({range:m,options:O_.DECORATION}));n.set(g)}else if(u&&u.length>0){const g=u.map(v=>({range:v,options:O_.DECORATION}));n.set(g);const m=u[0];if(m.startLineNumber&&m.startColumn){const v=this._editor.getModel()?.getWordAtPosition({lineNumber:m.startLineNumber,column:m.startColumn})?.word;Kc(h(929,"Context: {0} at line {1} and column {2}.",v,m.startLineNumber,m.startColumn))}}}else n.clear()}};this._actionWidgetService.show("codeActionWidget",!0,TBe(r,this._shouldShowHeaders(),this._resolver.getResolver()),c,a,o,this._getActionBarActions(e,t,i))}toCoords(e){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(e,ji.Immediate),this._editor.render();const t=this._editor.getScrolledVisiblePosition(e),i=Ms(this._editor.getDomNode()),n=i.left+t.left,o=i.top+t.top+t.height;return{x:n,y:o}}_shouldShowHeaders(){const e=this._editor?.getModel();return this._configurationService.getValue("editor.codeActionWidget.showHeaders",{resource:e?.uri})}_getActionBarActions(e,t,i){if(i.fromLightbulb)return[];const n=e.documentation.map(o=>({id:o.id,label:o.title,tooltip:o.tooltip??"",class:void 0,enabled:!0,run:()=>this._commandService.executeCommand(o.id,...o.arguments??[])}));return i.includeDisabledActions&&e.validActions.length>0&&e.allActions.length!==e.validActions.length&&n.push(this._showDisabled?{id:"hideMoreActions",label:h(930,"Hide Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(e,t,i))}:{id:"showMoreActions",label:h(931,"Show Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(e,t,i))}),n}};ef=O_=f([p(1,FM),p(2,me),p(3,J),p(4,Ne),p(5,ju),p(6,qe),p(7,ne),p(8,Ed),p(9,J),p(10,ju)],ef);Pv((s,e)=>{((n,o)=>{o&&e.addRule(`.monaco-editor ${n} { background-color: ${o}; }`)})(".quickfix-edit-highlight",s.getColor(BF));const i=s.getColor(Kne);i&&e.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${sy(s.type)?"dotted":"solid"} ${i}; box-sizing: border-box; }`)});function MBe(s){return s instanceof sge?s._instance:s}let sge=class{constructor(e){this.instantiationService=e}init(...e){}};function NBe(s,e){return class extends e{constructor(){super(...arguments),this._autorun=void 0}init(...i){this._autorun=Da((n,o)=>{const r=s.read(n);this._instance=o.add(this.instantiationService.createInstance(r,...i))})}dispose(){this._autorun?.dispose()}}}function OBe(s){return kse()?NBe(s,B$):s.get()}let B$=class extends sge{constructor(e,t){super(t),this.init(e)}};B$=f([p(1,J)],B$);function FBe(s){return s.sourceId+" @@ "+JSON.stringify({...s,sourceId:void 0})}let xL=class extends F{static cast(){return this}constructor(e,t,i){super(),this._contextKey=e,this._contextKeyService=t,this._commandService=i,this._contextKeyValue=WBe(this._contextKey,this._contextKeyService).recomputeInitiallyAndOnChange(this._store),this.isEnabled=this._contextKeyValue.map(n=>n!==void 0)}log(e){const t=this._contextKeyValue.get();if(!t)return!1;try{this._commandService.executeCommand(t,e).catch(()=>{})}catch{}return!0}};xL=f([p(1,me),p(2,qe)],xL);function WBe(s,e){return On(e.onDidChangeContext,()=>e.getContextKeyValue(s))}let V$=class extends F{constructor(e,t){super(),this._editor=e,this._instantiationService=t,this._structuredLogger=this._register(this._instantiationService.createInstance(xL.cast(),"editor.inlineSuggest.logChangeReason.commandId")),this._register(Da((i,n)=>{if(!(this._editor instanceof hI)||!this._structuredLogger.isEnabled.read(i))return;const o=[];n.add(this._editor.onBeforeExecuteEdit(({source:r})=>{r&&o.push(r)})),n.add(this._editor.onDidChangeModelContent(r=>{const a=this._editor.getModel();if(!a)return;const c=PS._getCurrentMetadata();o.length===0&&c.source&&o.push(c.source);for(const d of o){const l={...c,sourceId:"TextModel.setChangeReason",source:d,time:Date.now(),modelUri:a.uri,modelVersion:a.getVersionId()};setTimeout(()=>{this._structuredLogger.log(l)},0)}o.length=0}))}))}};V$=f([p(1,J)],V$);function Mx(s){return new BBe(s)}class BBe extends Bbe{constructor(e){super(),this._textModel=e}getOffset(e){return this._textModel.getOffsetAt(e)}getPosition(e){return this._textModel.getPositionAt(e)}}const VBe=[];function HBe(){return VBe}function UBe(s,e){return new _e(s.lineNumber+e.lineNumber-1,e.lineNumber===1?s.column+e.column-1:e.column)}function kee(s,e){return new _e(s.lineNumber-e.lineNumber+1,s.lineNumber-e.lineNumber===0?s.column-e.column+1:s.column)}function $Be(s,e){const i=new Vbe(s).getOffset(e);return s.substring(i)}function Tee(s){return GBe(s).map(t=>t.getEndPosition())}function GBe(s){const e=Hbe.createSortPermutation(s,ul(n=>n.range,P.compareRangesUsingStarts)),i=new hc(e.apply(s)).getNewRanges();return e.inverse().apply(i)}function qBe(s,e){const t=Mx(e),i=e.getValue();return s.map(r=>t.getStringReplacement(r)).map(r=>r.removeCommonSuffixPrefix(i)).map(r=>t.getSingleTextEdit(r))}function zBe(s,e){const t=oi("result",[]),i=[];return e.add(ki(n=>{const o=s.read(n);ys(r=>{if(o.length!==i.length){i.length=o.length;for(let a=0;a<i.length;a++)i[a]||(i[a]=oi("item",o[a]));t.set([...i],r)}i.forEach((a,c)=>a.set(o[c],r))})})),t}class KBe{constructor(e){this._contextKeyService=e}bind(e,t){return TSe(e,this._contextKeyService,t instanceof Function?t:i=>t.read(i))}}function jBe(s,e){return new Promise(t=>{let i;const n=setTimeout(()=>{i&&i.dispose(),t()},s);e&&(i=e.onCancellationRequested(()=>{clearTimeout(n),i&&i.dispose(),t()}))})}class y1{static const(e){return new y1(e,e,0)}constructor(e,t,i,n=YBe){this.startValue=e,this.endValue=t,this.durationMs=i,this._interpolationFunction=n,this.startTimeMs=Date.now(),e===t&&(this.durationMs=0)}isFinished(){return Date.now()>=this.startTimeMs+this.durationMs}getValue(){const e=Date.now()-this.startTimeMs;return e>=this.durationMs?this.endValue:this._interpolationFunction(e,this.startValue,this.endValue-this.startValue,this.durationMs)}}function YBe(s,e,t,i){return s===i?e+t:t*(-Math.pow(2,-10*s/i)+1)+e}function QBe(s,e,t,i){return t*((s=s/i-1)*s*s+1)+e}class Q4{static const(e){return new Q4(y1.const(e))}constructor(e){this._value=oi(this,e)}setAnimation(e,t){this._value.set(e,t)}changeAnimation(e,t){const i=e(this._value.get());this._value.set(i,t)}getValue(e){const t=this._value.read(e);return t.isFinished()||X4.instance.invalidateOnNextAnimationFrame(e),t.getValue()}}class X4{constructor(){this._counter=jd(this),this._isScheduled=!1}static{this.instance=new X4}invalidateOnNextAnimationFrame(e){this._counter.read(e),this._isScheduled||(this._isScheduled=!0,Vp().requestAnimationFrame(()=>{this._isScheduled=!1,this._update()}))}_update(){this._counter.trigger(void 0)}}class Nx{constructor(e,t){this.lineNumber=e,this.parts=t}equals(e){return this.lineNumber===e.lineNumber&&this.parts.length===e.parts.length&&this.parts.every((t,i)=>t.equals(e.parts[i]))}render(e,t=!1){return new hc([...this.parts.map(i=>new Cs(P.fromPositions(new _e(this.lineNumber,i.column)),t?`[${i.lines.map(n=>n.line).join(`
`)}]`:i.lines.map(n=>n.line).join(`
`)))]).applyToString(e)}renderForScreenReader(e){if(this.parts.length===0)return"";const t=this.parts[this.parts.length-1],i=e.substr(0,t.column-1);return new hc([...this.parts.map(o=>new Cs(P.fromPositions(new _e(1,o.column)),o.lines.map(r=>r.line).join(`
`)))]).applyToString(i).substring(this.parts[0].column-1)}isEmpty(){return this.parts.every(e=>e.lines.length===0)}get lineCount(){return 1+this.parts.reduce((e,t)=>e+t.lines.length-1,0)}}class IL{constructor(e,t,i,n=[]){this.column=e,this.text=t,this.preview=i,this._inlineDecorations=n,this.lines=Ih(this.text).map((o,r)=>({line:o,lineDecorations:RE.filter(this._inlineDecorations,r+1,1,o.length+1)}))}equals(e){return this.column===e.column&&this.lines.length===e.lines.length&&this.lines.every((t,i)=>t.line===e.lines[i].line&&RE.equalsArr(t.lineDecorations,e.lines[i].lineDecorations))}}class H${constructor(e,t,i,n=0){this.lineNumber=e,this.columnRange=t,this.text=i,this.additionalReservedLineCount=n,this.parts=[new IL(this.columnRange.endColumnExclusive,this.text,!1)],this.newLines=Ih(this.text)}renderForScreenReader(e){return this.newLines.join(`
`)}render(e,t=!1){const i=this.columnRange.toRange(this.lineNumber);return t?new hc([new Cs(P.fromPositions(i.getStartPosition()),"("),new Cs(P.fromPositions(i.getEndPosition()),`)[${this.newLines.join(`
`)}]`)]).applyToString(e):new hc([new Cs(i,this.newLines.join(`
`))]).applyToString(e)}get lineCount(){return this.newLines.length}isEmpty(){return this.parts.every(e=>e.lines.length===0)}equals(e){return this.lineNumber===e.lineNumber&&this.columnRange.equals(e.columnRange)&&this.newLines.length===e.newLines.length&&this.newLines.every((t,i)=>t===e.newLines[i])&&this.additionalReservedLineCount===e.additionalReservedLineCount}}function Aee(s,e){return ns(s,e,oge)}function oge(s,e){return s===e?!0:!s||!e?!1:s instanceof Nx&&e instanceof Nx||s instanceof H$&&e instanceof H$?s.equals(e):!1}function Tu(s,e,t){const i=t?s.range.intersectRanges(t):s.range;if(!i)return s;const n=s.text.replaceAll(`\r
`,`
`),o=e.getValueInRange(i,ry.LF),r=rf(o,n),a=nc.ofText(o.substring(0,r)).addToPosition(s.range.getStartPosition()),c=n.substring(r),d=P.fromPositions(a,s.range.getEndPosition());return new Cs(d,c)}function rge(s,e){return s.text.startsWith(e.text)&&XBe(s.range,e.range)}function XBe(s,e){return e.getStartPosition().equals(s.getStartPosition())&&e.getEndPosition().isBeforeOrEqual(s.getEndPosition())}function Ree(s,e,t,i,n=0){let o=Tu(s,e);if(o.range.endLineNumber!==o.range.startLineNumber)return;const r=e.getLineContent(o.range.startLineNumber),a=to(r).length;if(o.range.startColumn-1<=a){const v=to(o.text).length,y=r.substring(o.range.startColumn-1,a),[w,C]=[o.range.getStartPosition(),o.range.getEndPosition()],T=w.column+y.length<=C.column?w.delta(0,y.length):C,k=P.fromPositions(T,C),A=o.text.startsWith(y)?o.text.substring(y.length):o.text.substring(v);o=new Cs(k,A)}const d=e.getValueInRange(o.range),l=ZBe(d,o.text);if(!l)return;const u=o.range.startLineNumber,g=new Array;if(t==="prefix"){const v=l.filter(y=>y.originalLength===0);if(v.length>1||v.length===1&&v[0].originalStart!==d.length)return}const m=o.text.length-n;for(const v of l){const y=o.range.startColumn+v.originalStart+v.originalLength;if(t==="subwordSmart"&&i&&i.lineNumber===o.range.startLineNumber&&y<i.column||v.originalLength>0)return;if(v.modifiedLength===0)continue;const w=v.modifiedStart+v.modifiedLength,C=Math.max(v.modifiedStart,Math.min(w,m)),T=o.text.substring(v.modifiedStart,C),k=o.text.substring(C,Math.max(v.modifiedStart,w));T.length>0&&g.push(new IL(y,T,!1)),k.length>0&&g.push(new IL(y,k,!0))}return new Nx(u,g)}let nk;function ZBe(s,e){if(nk?.originalValue===s&&nk?.newValue===e)return nk?.changes;{let t=Lee(s,e,!0);if(t){const i=Pee(t);if(i>0){const n=Lee(s,e,!1);n&&Pee(n)<i&&(t=n)}}return nk={originalValue:s,newValue:e,changes:t},t}}function Pee(s){let e=0;for(const t of s)e+=t.originalLength;return e}function Lee(s,e,t){if(s.length>5e3||e.length>5e3)return;function i(d){let l=0;for(let u=0,g=d.length;u<g;u++){const m=d.charCodeAt(u);m>l&&(l=m)}return l}const n=Math.max(i(s),i(e));function o(d){if(d<0)throw new Error("unexpected");return n+d+1}function r(d){let l=0,u=0;const g=new Int32Array(d.length);for(let m=0,v=d.length;m<v;m++)if(t&&d[m]==="("){const y=u*100+l;g[m]=o(2*y),l++}else if(t&&d[m]===")"){l=Math.max(l-1,0);const y=u*100+l;g[m]=o(2*y+1),l===0&&u++}else g[m]=d.charCodeAt(m);return g}const a=r(s),c=r(e);return new Ube({getElements:()=>a},{getElements:()=>c}).ComputeDiff(!1).changes}function JBe(s,e){let t,i=!1;const n=new $be(new One(s,void 0,e.update),(o,r)=>{i||(t=e.initial instanceof Function?e.initial():e.initial,i=!0);const a=e.update(o,t,r);return t=a,a},e.changeTracker,()=>{i&&(e.disposeFinal?.(t),i=!1)},e.equalityComparer??Fne,(o,r,a)=>{if(!i)throw new ln("Can only set when there is a listener! This is to prevent leaks.");Tk(r,c=>{t=o,n.setValue(o,c,a)})});return n}class Ua extends Gbe{static{this.empty=new Ua([])}static fromEdit(e){return new Ua(e.replacements.map(t=>new yu(t.replaceRange,t.getNewLength())))}static create(e){return new Ua(e)}static single(e){return new Ua([e])}static replace(e,t){return new Ua([new yu(e,t)])}static insert(e,t){return new Ua([new yu(bi.emptyAt(e),t)])}static delete(e){return new Ua([new yu(e,0)])}static compose(e){let t=Ua.empty;for(const i of e)t=t.compose(i);return t}inverse(){const e=[];let t=0;for(const i of this.replacements)e.push(new yu(bi.ofStartAndLength(i.replaceRange.start+t,i.newLength),i.replaceRange.length)),t+=i.newLength-i.replaceRange.length;return new Ua(e)}_createNew(e){return new Ua(e)}applyArray(e,t){const i=new Array(this.getNewDataLength(e.length));let n=0,o=0;for(const r of this.replacements){for(let a=n;a<r.replaceRange.start;a++)i[o++]=e[a];n=r.replaceRange.endExclusive;for(let a=0;a<r.newLength;a++)i[o++]=t}for(;n<e.length;)i[o++]=e[n++];return i}}class yu extends qbe{static create(e,t,i){return new yu(new bi(e,t),i)}constructor(e,t){super(e),this.newLength=t}equals(e){return this.replaceRange.equals(e.replaceRange)&&this.newLength===e.newLength}getNewLength(){return this.newLength}tryJoinTouching(e){return new yu(this.replaceRange.joinRightTouching(e.replaceRange),this.newLength+e.newLength)}slice(e,t){return new yu(e,t.length)}toString(){return`[${this.replaceRange.start}, +${this.replaceRange.length}) -> +${this.newLength}}`}}function eVe(s){const e=s.map(i=>new wa(bi.ofStartAndLength(i.rangeOffset,i.rangeLength),i.text));return e.reverse(),new jm(e)}function Itt(s){const t=s.slice().reverse().map(n=>Ua.replace(new bi(n.range.startLineNumber-1,n.range.endLineNumber),zbe(n.text)[0]+1));return Ua.compose(t)}var U$;(function(s){function e(t,i){return t.isInlineEdit?iE.create(t,i):tE.create(t,i)}s.create=e})(U$||(U$={}));class age{constructor(e,t,i){this._data=e,this.identity=t,this.displayLocation=i}get source(){return this._data.source}get isFromExplicitRequest(){return this._data.context.triggerKind===zc.Explicit}get forwardStable(){return this.source.inlineSuggestions.enableForwardStability??!1}get editRange(){return this.getSingleTextEdit().range}get targetRange(){return this.displayLocation?.range??this.editRange}get insertText(){return this.getSingleTextEdit().text}get semanticId(){return this.hash}get action(){return this._sourceInlineCompletion.action}get command(){return this._sourceInlineCompletion.command}get warning(){return this._sourceInlineCompletion.warning}get showInlineEditMenu(){return!!this._sourceInlineCompletion.showInlineEditMenu}get hash(){return JSON.stringify([this.getSingleTextEdit().text,this.getSingleTextEdit().range.getStartPosition().toString()])}get shownCommand(){return this._sourceInlineCompletion.shownCommand}get requestUuid(){return this._data.context.requestUuid}get _sourceInlineCompletion(){return this._data.sourceInlineCompletion}addRef(){this.identity.addRef(),this.source.addRef()}removeRef(){this.identity.removeRef(),this.source.removeRef()}reportInlineEditShown(e){this._data.reportInlineEditShown(e,this.insertText)}reportPartialAccept(e,t){this._data.reportPartialAccept(e,t)}reportEndOfLife(e){this._data.reportEndOfLife(e)}setEndOfLifeReason(e){this._data.setEndOfLifeReason(e)}getSourceCompletion(){return this._sourceInlineCompletion}}class w1{constructor(){this._onDispose=jd(this),this.onDispose=this._onDispose,this._refCount=1,this.id="InlineCompletionIdentity"+w1.idCounter++}static{this.idCounter=0}addRef(){this._refCount++}removeRef(){this._refCount--,this._refCount===0&&this._onDispose.trigger(void 0)}}class Ox{static create(e,t){const i=new bi(t.getOffsetAt(e.range.getStartPosition()),t.getOffsetAt(e.range.getEndPosition()));return new Ox(i,e.range,e.label)}constructor(e,t,i){this._offsetRange=e,this.range=t,this.label=i}withEdit(e,t){const i=jne([this._offsetRange],e)[0];if(!i||i.length!==this._offsetRange.length)return;const n=t.getRange(i);return new Ox(i,n,this.label)}}class tE extends age{static create(e,t){const i=new w1,n=Mx(t),o=e.insertText.replace(/\r\n|\r|\n/g,t.getEOL()),r=iVe(new wa(n.getOffsetRange(e.range),o),t),a=n.getSingleTextEdit(r),c=e.displayLocation?Ox.create(e.displayLocation,t):void 0;return new tE(r,a,a.range,e.snippetInfo,e.additionalTextEdits,e,i,c)}constructor(e,t,i,n,o,r,a,c){super(r,a,c),this._edit=e,this._textEdit=t,this._originalRange=i,this.snippetInfo=n,this.additionalTextEdits=o,this.isInlineEdit=!1}getSingleTextEdit(){return this._textEdit}withIdentity(e){return new tE(this._edit,this._textEdit,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,e,this.displayLocation)}withEdit(e,t){const i=jne([this._edit.replaceRange],e);if(i.length===0)return;const n=new wa(i[0],this._textEdit.text),o=Mx(t),r=o.getSingleTextEdit(n);let a=this.displayLocation;if(!(a&&(a=a.withEdit(e,o),!a)))return new tE(n,r,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,this.identity,a)}canBeReused(e,t){const i=this._textEdit.range;return!!i&&i.containsPosition(t)&&this.isVisible(e,t)&&nc.ofRange(i).isGreaterThanOrEqualTo(nc.ofRange(this._originalRange))}isVisible(e,t){const i=Tu(this.getSingleTextEdit(),e);if(!this.editRange||!this._originalRange.getStartPosition().equals(this.editRange.getStartPosition())||t.lineNumber!==i.range.startLineNumber||i.isEmpty)return!1;const n=e.getValueInRange(i.range,ry.LF),o=i.text,r=Math.max(0,t.column-i.range.startColumn);let a=o.substring(0,r),c=o.substring(r),d=n.substring(0,r),l=n.substring(r);const u=e.getLineIndentColumn(i.range.startLineNumber);return i.range.startColumn<=u&&(d=d.trimStart(),d.length===0&&(l=l.trimStart()),a=a.trimStart(),a.length===0&&(c=c.trimStart())),a.startsWith(d)&&!!Kbe(l,c)}}class iE extends age{static create(e,t){const i=tVe(t,e.range,e.insertText),n=new dy(t),r=hc.fromStringEdit(i,n).toReplacement(n),a=new w1,c=i.replacements.map(l=>{const u=P.fromPositions(t.getPositionAt(l.replaceRange.start),t.getPositionAt(l.replaceRange.endExclusive)),g=t.getValueInRange(u);return DL.create(l,g)}),d=e.displayLocation?Ox.create(e.displayLocation,t):void 0;return new iE(i,r,e,a,c,d,!1,t.getVersionId())}constructor(e,t,i,n,o,r,a=!1,c){super(i,n,r),this._edit=e,this._textEdit=t,this._edits=o,this._lastChangePartOfInlineEdit=a,this._inlineEditModelVersion=c,this.snippetInfo=void 0,this.additionalTextEdits=[],this.isInlineEdit=!0}get updatedEditModelVersion(){return this._inlineEditModelVersion}get updatedEdit(){return this._edit}getSingleTextEdit(){return this._textEdit}withIdentity(e){return new iE(this._edit,this._textEdit,this._data,e,this._edits,this.displayLocation,this._lastChangePartOfInlineEdit,this._inlineEditModelVersion)}canBeReused(e,t){return this._lastChangePartOfInlineEdit&&this.updatedEditModelVersion===e.getVersionId()}withEdit(e,t){return this._applyTextModelChanges(e,this._edits,t)}_applyTextModelChanges(e,t,i){if(t=t.map(u=>u.applyTextModelChanges(e)),t.some(u=>u.edit===void 0))return;const n=i.getVersionId();let o=this._inlineEditModelVersion;const r=t.some(u=>u.lastChangeUpdatedEdit);if(r&&(o=n??-1),n===null||o+20<n||(t=t.filter(u=>!u.edit.isEmpty),t.length===0))return;const a=new jm(t.map(u=>u.edit)),c=Mx(i),d=c.getTextEdit(a).toReplacement(new dy(i));let l=this.displayLocation;if(!(l&&(l=l.withEdit(e,c),!l)))return new iE(a,d,this._data,this.identity,t,l,r,o)}}function tVe(s,e,t){const i=s.getEOL(),n=s.getValueInRange(e),o=t.replace(/\r\n|\r|\n/g,i),c=jbe.getDefault().computeDiff(Ih(n),Ih(o),{ignoreTrimWhitespace:!1,computeMoves:!1,extendToSubwords:!0,maxComputationTimeMs:500}).changes.flatMap(g=>g.innerChanges??[]);function d(g,m){const v=nc.fromPosition(m.getStartPosition());return nc.ofRange(m).createRange(v.addToPosition(g))}const l=new G_(o);return new jm(c.map(g=>{const m=d(e.getStartPosition(),g.originalRange),v=Mx(s).getOffsetRange(m),y=l.getValueOfRange(g.modifiedRange),w=new wa(v,y),C=s.getValueInRange(m);return nVe(w,C,c.length,s)}))}class DL{static create(e,t){const i=rf(e.newText,t),n=Hq(e.newText,t),o=e.newText.substring(i,e.newText.length-n);return new DL(e,o,i,n)}get edit(){return this._edit}get lastChangeUpdatedEdit(){return this._lastChangeUpdatedEdit}constructor(e,t,i,n,o=!1){this._edit=e,this._trimmedNewText=t,this._prefixLength=i,this._suffixLength=n,this._lastChangeUpdatedEdit=o}applyTextModelChanges(e){const t=this._clone();return t._applyTextModelChanges(e),t}_clone(){return new DL(this._edit,this._trimmedNewText,this._prefixLength,this._suffixLength,this._lastChangeUpdatedEdit)}_applyTextModelChanges(e){if(this._lastChangeUpdatedEdit=!1,!this._edit)throw new ln("UpdatedInnerEdits: No edit to apply changes to");const t=this._applyChanges(this._edit,e);if(!t){this._edit=void 0;return}this._edit=t.edit,this._lastChangeUpdatedEdit=t.editHasChanged}_applyChanges(e,t){let i=e.replaceRange.start,n=e.replaceRange.endExclusive,o=e.newText,r=!1;const a=this._prefixLength>0||this._suffixLength>0;for(let c=t.replacements.length-1;c>=0;c--){const d=t.replacements[c],l=d.newText.length>0&&d.replaceRange.isEmpty;if(l&&!a&&d.replaceRange.start===i&&o.startsWith(d.newText)){i+=d.newText.length,o=o.substring(d.newText.length),n=Math.max(i,n),r=!0;continue}if(l&&a&&d.replaceRange.start===i+this._prefixLength&&this._trimmedNewText.startsWith(d.newText)){n+=d.newText.length,r=!0,this._prefixLength+=d.newText.length,this._trimmedNewText=this._trimmedNewText.substring(d.newText.length);continue}if(d.newText.length===0&&d.replaceRange.length>0&&d.replaceRange.start>=i+this._prefixLength&&d.replaceRange.endExclusive<=n-this._suffixLength){n-=d.replaceRange.length,r=!0;continue}if(d.equals(e)){r=!0,i=d.replaceRange.endExclusive,o="";continue}if(!(d.replaceRange.start>n)){if(d.replaceRange.endExclusive<i){i+=d.newText.length-d.replaceRange.length,n+=d.newText.length-d.replaceRange.length;continue}return}}return this._trimmedNewText.length===0&&i+this._prefixLength===n-this._suffixLength?{edit:new wa(new bi(i+this._prefixLength,i+this._prefixLength),""),editHasChanged:!0}:{edit:new wa(new bi(i,n),o),editHasChanged:r}}}function iVe(s,e){const t=e.getEOL();return s.replaceRange.isEmpty&&s.newText.includes(t)&&(s=cge(s,e)),s}function nVe(s,e,t,i){const n=i.getEOL();if(s.newText.endsWith(n)&&e.endsWith(n)&&(s=new wa(s.replaceRange.deltaEnd(-n.length),s.newText.slice(0,-n.length))),t===1&&s.replaceRange.isEmpty&&s.newText.includes(n)){const o=i.getPositionAt(s.replaceRange.start);i.getLineLength(o.lineNumber)!==0&&(s=cge(s,i))}if(t===1){const o=rf(e,s.newText),r=Hq(e.slice(o),s.newText.slice(o));if(o+r===e.length)return new wa(s.replaceRange.deltaStart(o).deltaEnd(-r),s.newText.substring(o,s.newText.length-r));if(o+r===s.newText.length)return new wa(s.replaceRange.deltaStart(o).deltaEnd(-r),"")}return s}function cge(s,e){if(!s.replaceRange.isEmpty)throw new ln("Unexpected original range");if(s.replaceRange.start===0)return s;const t=e.getEOL(),i=e.getPositionAt(s.replaceRange.start),n=i.column,o=i.lineNumber;return n===1&&o>1&&s.newText.endsWith(t)&&!s.newText.startsWith(t)?new wa(s.replaceRange.delta(-1),t+s.newText.slice(0,-t.length)):s}function sVe(s,e){const t=new Zbe,i=new Qbe(t,d=>e.getLanguageConfiguration(d)),n=new Ybe(new oVe([s]),i),o=Xbe(n,[],void 0,!0);let r="";const a=s.getLineContent();function c(d,l){if(d.kind===vS.Pair)if(c(d.openingBracket,l),l=_S(l,d.openingBracket.length),d.child&&(c(d.child,l),l=_S(l,d.child.length)),d.closingBracket)c(d.closingBracket,l),l=_S(l,d.closingBracket.length);else{const g=i.getSingleLanguageBracketTokens(d.openingBracket.languageId).findClosingTokenText(d.openingBracket.bracketIds);r+=g}else if(d.kind!==vS.UnexpectedClosingBracket){if(d.kind===vS.Text||d.kind===vS.Bracket)r+=a.substring(V7(l),V7(_S(l,d.length)));else if(d.kind===vS.List)for(const u of d.children)c(u,l),l=_S(l,u.length)}}return c(o,Jbe),r}class oVe{constructor(e){this.lines=e,this.tokenization={getLineTokens:t=>this.lines[t-1]}}getValue(){return this.lines.map(e=>e.getLineContent()).join(`
`)}getLineCount(){return this.lines.length}getLineLength(e){return this.lines[e-1].getLineContent().length}}async function rVe(s,e,t,i,n=ye.None,o){const r=Dn(),a=new ri(n),c=a.token,d={...i,requestUuid:r},l=e instanceof _e?uVe(e,t):e,u=new Kie;for(const k of s)k.groupId&&u.add(k.groupId,k);function g(k){if(!k.yieldsToGroupIds)return[];const A=[];for(const B of k.yieldsToGroupIds||[]){const z=u.get(B);for(const Q of z)A.push(Q)}return A}function m(k,A,B){if(A=[...A,k],B.has(k))return A;B.add(k);try{const z=g(k);for(const Q of z){const ie=m(Q,A,B);if(ie)return ie}}finally{B.delete(k)}}function v(k,A){const B=A.get(k);if(B)return B;const z=m(k,[],new Set);z&&kn(new Error(`Inline completions: cyclic yield-to dependency detected. Path: ${z.map(ie=>ie.toString?ie.toString():""+ie).join(" -> ")}`));const Q=new Zo;return A.set(k,Q.p),(async()=>{if(!z){const ie=g(k);for(const oe of ie){const xe=await v(oe,A);if(xe&&xe.inlineSuggestions.items.length>0)return}}return y(k)})().then(ie=>Q.complete(ie),ie=>Q.error(ie)),Q.p}async function y(k){let A;try{e instanceof _e?A=await k.provideInlineCompletions(t,e,d,c):A=await k.provideInlineEditsForRange?.(t,e,d,c)}catch(Q){kn(Q);return}if(!A)return;const B=[],z=new hVe(A,B,k);for(const Q of A.items)B.push(dVe(Q,z,l,t,o,d));return aVe(c,()=>z.removeRef()),z}const w=new Map,C=Qa.fromPromisesResolveOrder(s.map(k=>v(k,w)));if(c.isCancellationRequested)return a.dispose(!0),new dge([],new Set,[]);const T=await cVe(d,C,t);return a.dispose(!0),T}function aVe(s,e){if(s.isCancellationRequested)return e(),F.None;{const t=s.onCancellationRequested(()=>{t.dispose(),e()});return{dispose:()=>t.dispose()}}}async function cVe(s,e,t){const i=new Map;let n=!1;const o=[];for await(const r of e)if(r){r.addRef(),o.push(r);for(const a of r.inlineSuggestionsData)!s.includeInlineEdits&&(a.isInlineEdit||a.showInlineEditMenu)||!s.includeInlineCompletions&&!(a.isInlineEdit||a.showInlineEditMenu)||(i.set(lge(a.getSingleTextEdit()),a),!(a.isInlineEdit||a.showInlineEditMenu)&&s.triggerKind===zc.Automatic&&(a.getSingleTextEdit().removeCommonPrefix(new dy(t)).isEmpty||(n=!0)));if(n)break}return new dge(Array.from(i.values()),new Set(i.keys()),o)}class dge{constructor(e,t,i){this.completions=e,this.hashs=t,this.providerResults=i}has(e){return this.hashs.has(lge(e))}isEmpty(){return this.completions.length===0||this.completions.every(e=>e.range.isEmpty()&&e.insertText.length===0)}dispose(){for(const e of this.providerResults)e.removeRef()}}function lge(s){return JSON.stringify([s.text,s.range.getStartPosition().toString()])}function dVe(s,e,t,i,n,o){let r,a,c=s.range?P.lift(s.range):t;if(typeof s.insertText=="string"){if(r=s.insertText,n&&s.completeBracketPairs){r=Mee(r,c.getStartPosition(),i,n);const l=r.length-s.insertText.length;l!==0&&(c=new P(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn+l))}a=void 0}else if("snippet"in s.insertText){const l=s.insertText.snippet.length;if(n&&s.completeBracketPairs){s.insertText.snippet=Mee(s.insertText.snippet,c.getStartPosition(),i,n);const g=s.insertText.snippet.length-l;g!==0&&(c=new P(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn+g))}const u=new fd().parse(s.insertText.snippet);u.children.length===1&&u.children[0]instanceof pr?(r=u.children[0].value,a=void 0):(r=u.toString(),a={snippet:s.insertText.snippet,range:c})}else ad();const d=s.displayLocation?{range:P.lift(s.displayLocation.range),label:s.displayLocation.label}:void 0;return new lVe(c,r,a,d,s.additionalTextEdits||HBe(),s,e,o,s.isInlineEdit??!1)}class lVe{constructor(e,t,i,n,o,r,a,c,d){this.range=e,this.insertText=t,this.snippetInfo=i,this.displayLocation=n,this.additionalTextEdits=o,this.sourceInlineCompletion=r,this.source=a,this.context=c,this.isInlineEdit=d,this._didShow=!1,this._didReportEndOfLife=!1,this._lastSetEndOfLifeReason=void 0}get showInlineEditMenu(){return this.sourceInlineCompletion.showInlineEditMenu??!1}getSingleTextEdit(){return new Cs(this.range,this.insertText)}async reportInlineEditShown(e,t){this._didShow||(this._didShow=!0,this.source.provider.handleItemDidShow?.(this.source.inlineSuggestions,this.sourceInlineCompletion,t),this.sourceInlineCompletion.shownCommand&&await e.executeCommand(this.sourceInlineCompletion.shownCommand.id,...this.sourceInlineCompletion.shownCommand.arguments||[]))}reportPartialAccept(e,t){this.source.provider.handlePartialAccept?.(this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}reportEndOfLife(e){this._didReportEndOfLife||(this._didReportEndOfLife=!0,e||(e=this._lastSetEndOfLifeReason??{kind:Wp.Ignored,userTypingDisagreed:!1,supersededBy:void 0}),e.kind===Wp.Rejected&&this.source.provider.handleRejection&&this.source.provider.handleRejection(this.source.inlineSuggestions,this.sourceInlineCompletion),this.source.provider.handleEndOfLifetime&&this.source.provider.handleEndOfLifetime(this.source.inlineSuggestions,this.sourceInlineCompletion,e))}setEndOfLifeReason(e){this._lastSetEndOfLifeReason=e}}class hVe{constructor(e,t,i){this.inlineSuggestions=e,this.inlineSuggestionsData=t,this.provider=i,this.refCount=1}addRef(){this.refCount++}removeRef(){if(this.refCount--,this.refCount===0){for(const e of this.inlineSuggestionsData)e.reportEndOfLife();this.provider.freeInlineCompletions(this.inlineSuggestions)}}}function uVe(s,e){const t=e.getWordAtPosition(s),i=e.getLineMaxColumn(s.lineNumber);return t?new P(s.lineNumber,t.startColumn,s.lineNumber,i):P.fromPositions(s,s.with(void 0,i))}function Mee(s,e,t,i){const n=t.getLineContent(e.lineNumber),o=wa.replace(new bi(e.column-1,n.length),s),a=t.tokenization.tokenizeLinesAt(e.lineNumber,[o.replace(n)])?.[0].sliceZeroCopy(o.getRangeAfterReplace());return a?sVe(a,i):s}var $$;let G$=class extends F{static{$$=this}static{this._requestId=0}constructor(e,t,i,n,o,r,a){super(),this._textModel=e,this._versionId=t,this._debounceValue=i,this._languageConfigurationService=n,this._logService=o,this._configurationService=r,this._instantiationService=a,this._updateOperation=this._register(new kt),this._loggingEnabled=Dse("editor.inlineSuggest.logFetch",!1,this._configurationService).recomputeInitiallyAndOnChange(this._store),this._structuredFetchLogger=this._register(this._instantiationService.createInstance(xL.cast(),"editor.inlineSuggest.logFetch.commandId")),this._state=JBe(this,{initial:()=>({inlineCompletions:$c.createEmpty(),suggestWidgetInlineCompletions:$c.createEmpty()}),disposeFinal:c=>{c.inlineCompletions.dispose(),c.suggestWidgetInlineCompletions.dispose()},changeTracker:eye({versionId:this._versionId}),update:(c,d,l)=>{const u=jm.compose(l.changes.map(g=>g.change?eVe(g.change.changes):jm.empty).filter(ya));if(u.isEmpty())return d;try{return{inlineCompletions:d.inlineCompletions.createStateWithAppliedEdit(u,this._textModel),suggestWidgetInlineCompletions:d.suggestWidgetInlineCompletions.createStateWithAppliedEdit(u,this._textModel)}}finally{d.inlineCompletions.dispose(),d.suggestWidgetInlineCompletions.dispose()}}}),this.inlineCompletions=this._state.map(this,c=>c.inlineCompletions),this.suggestWidgetInlineCompletions=this._state.map(this,c=>c.suggestWidgetInlineCompletions),this.clearOperationOnTextModelChange=fe(this,c=>{this._versionId.read(c),this._updateOperation.clear()}),this._loadingCount=oi(this,0),this.loading=this._loadingCount.map(this,c=>c>0),this.clearOperationOnTextModelChange.recomputeInitiallyAndOnChange(this._store)}_log(e){this._loggingEnabled.get()&&this._logService.info(FBe(e)),this._structuredFetchLogger.log(e)}fetch(e,t,i,n,o,r,a){const c=new gVe(t,i,this._textModel.getVersionId()),d=i.selectedSuggestionInfo?this.suggestWidgetInlineCompletions.get():this.inlineCompletions.get();if(!a&&this._updateOperation.value?.request.satisfies(c))return this._updateOperation.value.promise;if(d?.request?.satisfies(c))return Promise.resolve(!0);const l=!!this._updateOperation.value;this._updateOperation.clear();const u=new ri,g=(async()=>{this._loadingCount.set(this._loadingCount.get()+1,void 0);try{const v=this._debounceValue.get(this._textModel),y=tye(e.map(z=>z.debounceDelayMs),iye(Oh))??v;if((l||o&&i.triggerKind===zc.Automatic)&&await jBe(y,u.token),u.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)return!1;const C=$$._requestId++;(this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get())&&this._log({sourceId:"InlineCompletions.fetch",kind:"start",requestId:C,modelUri:this._textModel.uri,modelVersion:this._textModel.getVersionId(),context:{triggerKind:i.triggerKind},time:Date.now()});const T=new Date;let k,A;try{k=await rVe(e,t,this._textModel,i,u.token,this._languageConfigurationService)}catch(z){throw A=z,z}finally{if(this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get()){(u.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)&&(A="canceled");const z=k?.completions.map(Q=>({range:Q.range.toString(),text:Q.insertText,isInlineEdit:!!Q.isInlineEdit,source:Q.source.provider.groupId}));this._log({sourceId:"InlineCompletions.fetch",kind:"end",requestId:C,durationMs:Date.now()-T.getTime(),error:A,result:z,time:Date.now()})}}if(u.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId||r.get())return k.dispose(),!1;const B=new Date;this._debounceValue.update(this._textModel,B.getTime()-T.getTime()),this._updateOperation.clear(),ys(z=>{const Q=this._state.get();i.selectedSuggestionInfo?this._state.set({inlineCompletions:$c.createEmpty(),suggestWidgetInlineCompletions:Q.suggestWidgetInlineCompletions.createStateWithAppliedResults(k,c,this._textModel,n)},z):this._state.set({inlineCompletions:Q.inlineCompletions.createStateWithAppliedResults(k,c,this._textModel,n),suggestWidgetInlineCompletions:$c.createEmpty()},z),k.dispose(),Q.inlineCompletions.dispose(),Q.suggestWidgetInlineCompletions.dispose()})}finally{this._loadingCount.set(this._loadingCount.get()-1,void 0)}return!0})(),m=new pVe(c,u,g);return this._updateOperation.value=m,g}clear(e){this._updateOperation.clear();const t=this._state.get();this._state.set({inlineCompletions:$c.createEmpty(),suggestWidgetInlineCompletions:$c.createEmpty()},e),t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()}seedInlineCompletionsWithSuggestWidget(){const e=this.inlineCompletions.get(),t=this.suggestWidgetInlineCompletions.get();t&&ys(i=>{if(!e||(t.request?.versionId??-1)>(e.request?.versionId??-1)){e?.dispose();const n=this._state.get();this._state.set({inlineCompletions:t.clone(),suggestWidgetInlineCompletions:$c.createEmpty()},i),n.inlineCompletions.dispose(),n.suggestWidgetInlineCompletions.dispose()}this.clearSuggestWidgetInlineCompletions(i)})}clearSuggestWidgetInlineCompletions(e){this._updateOperation.value?.request.context.selectedSuggestionInfo&&this._updateOperation.clear()}cancelUpdate(){this._updateOperation.clear()}};G$=$$=f([p(3,rs),p(4,Pe),p(5,ne),p(6,J)],G$);class gVe{constructor(e,t,i){this.position=e,this.context=t,this.versionId=i}satisfies(e){return this.position.equals(e.position)&&Yne(this.context.selectedSuggestionInfo,e.context.selectedSuggestionInfo,Qne())&&(e.context.triggerKind===zc.Automatic||this.context.triggerKind===zc.Explicit)&&this.versionId===e.versionId}get isExplicitRequest(){return this.context.triggerKind===zc.Explicit}}class pVe{constructor(e,t,i){this.request=e,this.cancellationTokenSource=t,this.promise=i}dispose(){this.cancellationTokenSource.cancel()}}class $c extends F{static createEmpty(){return new $c([],void 0)}constructor(e,t){for(const i of e)i.addRef();super(),this.inlineCompletions=e,this.request=t,this._register({dispose:()=>{for(const i of this.inlineCompletions)i.removeRef()}})}_findById(e){return this.inlineCompletions.find(t=>t.identity===e)}_findByHash(e){return this.inlineCompletions.find(t=>t.hash===e)}createStateWithAppliedEdit(e,t){const i=this.inlineCompletions.map(n=>n.withEdit(e,t)).filter(ya);return new $c(i,this.request)}createStateWithAppliedResults(e,t,i,n){const o=[];for(const r of e.completions){const a=U$.create(r,i),c=this._findByHash(a.hash);c?(o.push(a.withIdentity(c.identity)),c.setEndOfLifeReason({kind:Wp.Ignored,userTypingDisagreed:!1,supersededBy:a.getSourceCompletion()})):o.push(a)}if(n){const r=this._findById(n);r&&!e.has(r.getSingleTextEdit())&&r.canBeReused(i,t.position)&&o.unshift(r)}return new $c(o,t)}clone(){return new $c(this.inlineCompletions,this.request)}}class fVe{constructor(e,t,i){this.edit=e,this.commands=t,this.inlineCompletion=i}get range(){return this.edit.range}get text(){return this.edit.text}equals(e){return this.edit.equals(e.edit)&&this.inlineCompletion===e.inlineCompletion}}let q$=class extends F{get isAcceptingPartially(){return this._isAcceptingPartially}constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(),this.textModel=e,this._selectedSuggestItem=t,this._textModelVersionId=i,this._positions=n,this._debounceValue=o,this._enabled=r,this._editor=a,this._instantiationService=c,this._commandService=d,this._languageConfigurationService=l,this._accessibilityService=u,this._languageFeaturesService=g,this._source=this._register(this._instantiationService.createInstance(G$,this.textModel,this._textModelVersionId,this._debounceValue)),this._isActive=oi(this,!1),this._onlyRequestInlineEditsSignal=jd(this),this._forceUpdateExplicitlySignal=jd(this),this._noDelaySignal=jd(this),this._fetchSpecificProviderSignal=jd(this),this._selectedInlineCompletionId=oi(this,void 0),this.primaryPosition=fe(this,w=>this._positions.read(w)[0]??new _e(1,1)),this._isAcceptingPartially=!1,this._onDidAccept=new M,this.onDidAccept=this._onDidAccept.event,this._editorObs=xs(this._editor),this._suggestPreviewEnabled=this._editorObs.getOption(L.suggest).map(w=>w.preview),this._suggestPreviewMode=this._editorObs.getOption(L.suggest).map(w=>w.previewMode),this._inlineSuggestMode=this._editorObs.getOption(L.inlineSuggest).map(w=>w.mode),this._suppressedInlineCompletionGroupIds=this._editorObs.getOption(L.inlineSuggest).map(w=>new Set(w.experimental.suppressInlineSuggestions)),this._inlineEditsEnabled=this._editorObs.getOption(L.inlineSuggest).map(w=>!!w.edits.enabled),this._inlineEditsShowCollapsedEnabled=this._editorObs.getOption(L.inlineSuggest).map(w=>w.edits.showCollapsed),this._lastShownInlineCompletionInfo=void 0,this._lastAcceptedInlineCompletionInfo=void 0,this._didUndoInlineEdits=H7({owner:this,changeTracker:{createChangeSummary:()=>({didUndo:!1}),handleChange:(w,C)=>(C.didUndo=w.didChange(this._textModelVersionId)&&!!w.change?.isUndoing,!0)}},(w,C)=>{const T=this._textModelVersionId.read(w);return T!==null&&this._lastAcceptedInlineCompletionInfo&&this._lastAcceptedInlineCompletionInfo.textModelVersionIdAfter===T-1&&this._lastAcceptedInlineCompletionInfo.inlineCompletion.isInlineEdit&&C.didUndo?(this._lastAcceptedInlineCompletionInfo=void 0,!0):!1}),this._preserveCurrentCompletionReasons=new Set([gu.Redo,gu.Undo,gu.AcceptWord]),this.dontRefetchSignal=jd(this),this._fetchInlineCompletionsPromise=H7({owner:this,changeTracker:{createChangeSummary:()=>({dontRefetch:!1,preserveCurrentCompletion:!1,inlineCompletionTriggerKind:zc.Automatic,onlyRequestInlineEdits:!1,shouldDebounce:!0,provider:void 0}),handleChange:(w,C)=>(w.didChange(this._textModelVersionId)&&this._preserveCurrentCompletionReasons.has(this._getReason(w.change))?C.preserveCurrentCompletion=!0:w.didChange(this._forceUpdateExplicitlySignal)?C.inlineCompletionTriggerKind=zc.Explicit:w.didChange(this.dontRefetchSignal)?C.dontRefetch=!0:w.didChange(this._onlyRequestInlineEditsSignal)?C.onlyRequestInlineEdits=!0:w.didChange(this._fetchSpecificProviderSignal)&&(C.provider=w.change),!0)}},(w,C)=>{if(this._source.clearOperationOnTextModelChange.read(w),this._noDelaySignal.read(w),this.dontRefetchSignal.read(w),this._onlyRequestInlineEditsSignal.read(w),this._forceUpdateExplicitlySignal.read(w),this._fetchSpecificProviderSignal.read(w),!(this._enabled.read(w)&&this._selectedSuggestItem.read(w)||this._isActive.read(w))){this._source.cancelUpdate();return}this._textModelVersionId.read(w);const k=this._source.suggestWidgetInlineCompletions.get(),A=this._selectedSuggestItem.read(w);k&&!A&&this._source.seedInlineCompletionsWithSuggestWidget();const B=this.primaryPosition.get();if(C.dontRefetch)return Promise.resolve(!0);if(this._didUndoInlineEdits.read(w)&&C.inlineCompletionTriggerKind!==zc.Explicit){ys(it=>{this._source.clear(it)});return}let z={triggerKind:C.inlineCompletionTriggerKind,selectedSuggestionInfo:A?.toSelectedSuggestionInfo(),includeInlineCompletions:!C.onlyRequestInlineEdits,includeInlineEdits:this._inlineEditsEnabled.read(w)};z.triggerKind===zc.Automatic&&this.textModel.getAlternativeVersionId()===this._lastShownInlineCompletionInfo?.alternateTextModelVersionId&&(z={...z,includeInlineCompletions:!this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit,includeInlineEdits:this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit});const Q=this.selectedInlineCompletion.get()??this._inlineCompletionItems.get()?.inlineEdit,ie=C.preserveCurrentCompletion||Q?.forwardStable?Q:void 0,oe=this._jumpedToId.map(it=>!!it&&it===this._inlineCompletionItems.get()?.inlineEdit?.semanticId),xe=C.provider?[C.provider]:this._languageFeaturesService.inlineCompletionsProvider.all(this.textModel),Se=this._suppressedInlineCompletionGroupIds.get(),Ft=xe.filter(it=>!(it.groupId&&Se.has(it.groupId)));return this._source.fetch(Ft,B,z,ie?.identity,C.shouldDebounce,oe,!!C.provider)}),this._inlineCompletionItems=Jl({owner:this},w=>{const C=this._source.inlineCompletions.read(w);if(!C)return;const T=this.primaryPosition.read(w);let k;const A=[];for(const B of C.inlineCompletions)B.isInlineEdit?k=B:B.isVisible(this.textModel,T)&&A.push(B);return A.length!==0&&(k=void 0),{inlineCompletions:A,inlineEdit:k}}),this._filteredInlineCompletionItems=Jl({owner:this,equalsFn:U7()},w=>this._inlineCompletionItems.read(w)?.inlineCompletions??[]),this.selectedInlineCompletionIndex=fe(this,w=>{const C=this._selectedInlineCompletionId.read(w),T=this._filteredInlineCompletionItems.read(w),k=this._selectedInlineCompletionId===void 0?-1:T.findIndex(A=>A.semanticId===C);return k===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):k}),this.selectedInlineCompletion=fe(this,w=>{const C=this._filteredInlineCompletionItems.read(w),T=this.selectedInlineCompletionIndex.read(w);return C[T]}),this.activeCommands=Jl({owner:this,equalsFn:U7()},w=>this.selectedInlineCompletion.read(w)?.source.inlineSuggestions.commands??[]),this.lastTriggerKind=this._source.inlineCompletions.map(this,w=>w?.request?.context.triggerKind),this.inlineCompletionsCount=fe(this,w=>{if(this.lastTriggerKind.read(w)===zc.Explicit)return this._filteredInlineCompletionItems.read(w).length}),this._hasVisiblePeekWidgets=fe(this,w=>this._editorObs.openedPeekWidgets.read(w)>0),this.state=Jl({owner:this,equalsFn:(w,C)=>!w||!C?w===C:w.kind==="ghostText"&&C.kind==="ghostText"?Aee(w.ghostTexts,C.ghostTexts)&&w.inlineCompletion===C.inlineCompletion&&w.suggestItem===C.suggestItem:w.kind==="inlineEdit"&&C.kind==="inlineEdit"?w.inlineEdit.equals(C.inlineEdit):!1},w=>{const C=this.textModel,k=this._inlineCompletionItems.read(w)?.inlineEdit;if(k){if(this._hasVisiblePeekWidgets.read(w))return;let B=k.getSingleTextEdit();B=Tu(B,C);const z=this.primaryPosition.map(Se=>Go.fromRangeInclusive(k.targetRange).addMargin(1,1).contains(Se.lineNumber)),Q=k.source.inlineSuggestions.commands,ie=new fVe(B,Q??[],k),oe=k.updatedEdit,xe=oe?hc.fromStringEdit(oe,new dy(this.textModel)).replacements:[B];return{kind:"inlineEdit",inlineEdit:ie,inlineCompletion:k,edits:xe,cursorAtInlineEdit:z}}const A=this._selectedSuggestItem.read(w);if(A){const B=Tu(A.getSingleTextEdit(),C),z=this._computeAugmentation(B,w);if(!this._suggestPreviewEnabled.read(w)&&!z)return;const ie=z?.edit??B,oe=z?z.edit.text.length-B.text.length:0,xe=this._suggestPreviewMode.read(w),Se=this._positions.read(w),Ft=[ie,...K0(this.textModel,Se,ie)],it=Ft.map((ci,Xn)=>Ree(ci,C,xe,Se[Xn],oe)).filter(ya),ti=it[0]??new Nx(ie.range.endLineNumber,[]);return{kind:"ghostText",edits:Ft,primaryGhostText:ti,ghostTexts:it,inlineCompletion:z?.completion,suggestItem:A}}else{if(!this._isActive.read(w))return;const B=this.selectedInlineCompletion.read(w);if(!B)return;const z=B.getSingleTextEdit(),Q=this._inlineSuggestMode.read(w),ie=this._positions.read(w),oe=[z,...K0(this.textModel,ie,z)],xe=oe.map((Se,Ft)=>Ree(Se,C,Q,ie[Ft],0)).filter(ya);return xe[0]?{kind:"ghostText",edits:oe,primaryGhostText:xe[0],ghostTexts:xe,inlineCompletion:B,suggestItem:void 0}:void 0}}),this.status=fe(this,w=>{if(this._source.loading.read(w))return"loading";const C=this.state.read(w);return C?.kind==="ghostText"?"ghostText":C?.kind==="inlineEdit"?"inlineEdit":"noSuggestion"}),this.inlineCompletionState=fe(this,w=>{const C=this.state.read(w);if(!(!C||C.kind!=="ghostText")&&!this._editorObs.inComposition.read(w))return C}),this.inlineEditState=fe(this,w=>{const C=this.state.read(w);if(!(!C||C.kind!=="inlineEdit"))return C}),this.inlineEditAvailable=fe(this,w=>!!this.inlineEditState.read(w)),this.warning=fe(this,w=>this.inlineCompletionState.read(w)?.inlineCompletion?.warning),this.ghostTexts=Jl({owner:this,equalsFn:Aee},w=>{const C=this.inlineCompletionState.read(w);if(C)return C.ghostTexts}),this.primaryGhostText=Jl({owner:this,equalsFn:oge},w=>{const C=this.inlineCompletionState.read(w);if(C)return C?.primaryGhostText}),this._jumpedToId=oi(this,void 0),this._inAcceptFlow=oi(this,!1),this.inAcceptFlow=this._inAcceptFlow;const m=fe(this,w=>{const C=this.state.read(w);if(!C||!C.inlineCompletion)return!1;const T=C.inlineCompletion.targetRange,k=this._editorObs.editor.getVisibleRanges();return k.length<1?!1:new P(k[0].startLineNumber,k[0].startColumn,k[k.length-1].endLineNumber,k[k.length-1].endColumn).containsRange(T)});this.showCollapsed=fe(this,w=>{const C=this.state.read(w);if(!C||C.kind!=="inlineEdit"||C.inlineCompletion.displayLocation)return!1;const T=C.inlineCompletion.updatedEditModelVersion===this._textModelVersionId.read(w);return(this._inlineEditsShowCollapsedEnabled.read(w)||!T)&&this._jumpedToId.read(w)!==C.inlineCompletion.semanticId&&!this._inAcceptFlow.read(w)}),this._tabShouldIndent=fe(this,w=>{if(this._inAcceptFlow.read(w))return!1;function C(A){return A.startLineNumber!==A.endLineNumber}function T(A,B){const z=A.getLineIndentColumn(B),Q=A.getLineLastNonWhitespaceColumn(B),ie=Math.max(Q,z);return new P(B,z,B,ie)}return this._editorObs.selections.read(w)?.some(A=>A.isEmpty()?this.textModel.getLineLength(A.startLineNumber)===0:C(A)||A.containsRange(T(this.textModel,A.startLineNumber)))}),this.tabShouldJumpToInlineEdit=fe(this,w=>{if(this._tabShouldIndent.read(w))return!1;const C=this.inlineEditState.read(w);return C?this.showCollapsed.read(w)?!0:this._inAcceptFlow.read(w)&&m.read(w)?!1:!C.cursorAtInlineEdit.read(w):!1}),this.tabShouldAcceptInlineEdit=fe(this,w=>{const C=this.inlineEditState.read(w);return!C||this.showCollapsed.read(w)?!1:this._inAcceptFlow.read(w)&&m.read(w)||C.inlineCompletion.targetRange.startLineNumber===this._editorObs.cursorLineNumber.read(w)||this._jumpedToId.read(w)===C.inlineCompletion.semanticId?!0:this._tabShouldIndent.read(w)?!1:C.cursorAtInlineEdit.read(w)}),this._register(Une(this._fetchInlineCompletionsPromise)),this._register(ki(w=>{const T=this.inlineCompletionState.read(w)?.inlineCompletion;T&&this.handleInlineSuggestionShown(T)})),this._register(ki(w=>{this._editorObs.versionId.read(w),this._inAcceptFlow.set(!1,void 0)})),this._register(ki(w=>{this.state.map((T,k)=>!T||T.kind==="inlineEdit"&&!T.cursorAtInlineEdit.read(k)).read(w)&&this._jumpedToId.set(void 0,void 0)}));const v=this.inlineEditState.map(w=>w?.inlineCompletion.semanticId);this._register(ki(w=>{v.read(w)&&(this._editor.pushUndoStop(),this._lastShownInlineCompletionInfo={alternateTextModelVersionId:this.textModel.getAlternativeVersionId(),inlineCompletion:this.state.get().inlineCompletion})}));const y=On(this._languageFeaturesService.inlineCompletionsProvider.onDidChange,()=>this._languageFeaturesService.inlineCompletionsProvider.all(e));this._register(Da((w,C)=>{const T=y.read(w);for(const k of T)k.onDidChangeInlineCompletions&&C.add(k.onDidChangeInlineCompletions(()=>{if(!this._enabled.get())return;const A=this.state.get();A&&(A.inlineCompletion||A.edits)&&A.inlineCompletion?.source.provider!==k||ys(B=>{this._fetchSpecificProviderSignal.trigger(B,k),this.trigger(B)})}))})),this._didUndoInlineEdits.recomputeInitiallyAndOnChange(this._store)}debugGetSelectedSuggestItem(){return this._selectedSuggestItem}getIndentationInfo(e){let t=!1,i=!0;const n=this?.primaryGhostText.read(e);if(this?._selectedSuggestItem&&n&&n.parts.length>0){const{column:o,lines:r}=n.parts[0],a=r[0].line,c=this.textModel.getLineIndentColumn(n.lineNumber);if(o<=c){let l=HF(a);l===-1&&(l=a.length-1),t=l>0;const u=this.textModel.getOptions().tabSize;i=nye.visibleColumnFromColumn(a,l+1,u)<u}}return{startsWithIndentation:t,startsWithIndentationLessThanTabSize:i}}_getReason(e){return e?.isUndoing?gu.Undo:e?.isRedoing?gu.Redo:this.isAcceptingPartially?gu.AcceptWord:gu.Other}async trigger(e,t){Tk(e,i=>{t?.onlyFetchInlineEdits&&this._onlyRequestInlineEditsSignal.trigger(i),t?.noDelay&&this._noDelaySignal.trigger(i),this._isActive.set(!0,i)}),await this._fetchInlineCompletionsPromise.get()}async triggerExplicitly(e,t=!1){Tk(e,i=>{t&&this._onlyRequestInlineEditsSignal.trigger(i),this._isActive.set(!0,i),this._inAcceptFlow.set(!0,i),this._forceUpdateExplicitlySignal.trigger(i)}),await this._fetchInlineCompletionsPromise.get()}stop(e="automatic",t){Tk(t,i=>{if(e==="explicitCancel"){const n=this.state.get()?.inlineCompletion;n&&n.reportEndOfLife({kind:Wp.Rejected})}this._isActive.set(!1,i),this._source.clear(i)})}_computeAugmentation(e,t){const i=this.textModel,n=this._source.suggestWidgetInlineCompletions.read(t),o=n?n.inlineCompletions.filter(a=>!a.isInlineEdit):[this.selectedInlineCompletion.read(t)].filter(ya);return sye(o,a=>{let c=a.getSingleTextEdit();return c=Tu(c,i,P.fromPositions(c.range.getStartPosition(),e.range.getEndPosition())),rge(c,e)?{completion:a,edit:c}:void 0})}async _deltaSelectedInlineCompletionIndex(e){await this.triggerExplicitly();const t=this._filteredInlineCompletionItems.get()||[];if(t.length>0){const i=(this.selectedInlineCompletionIndex.get()+e+t.length)%t.length;this._selectedInlineCompletionId.set(t[i].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)}async next(){await this._deltaSelectedInlineCompletionIndex(1)}async previous(){await this._deltaSelectedInlineCompletionIndex(-1)}_getMetadata(e,t=void 0){return new PS({extensionId:e.source.provider.groupId,nes:e.isInlineEdit,type:t,requestUuid:e.requestUuid})}async accept(e=this._editor){if(e.getModel()!==this.textModel)throw new ln;let t;const i=this.state.get();if(i?.kind==="ghostText"){if(!i||i.primaryGhostText.isEmpty()||!i.inlineCompletion)return;t=i.inlineCompletion}else if(i?.kind==="inlineEdit")t=i.inlineCompletion;else return;if(t.reportEndOfLife({kind:Wp.Accepted}),t.command&&t.source.addRef(),e.pushUndoStop(),t.snippetInfo)PS.editWithReason(this._getMetadata(t),()=>{e.executeEdits("inlineSuggestion.accept",[Ki.replace(t.editRange,""),...t.additionalTextEdits])}),e.setPosition(t.snippetInfo.range.getStartPosition(),"inlineCompletionAccept"),os.get(e)?.insert(t.snippetInfo.snippet,{undoStopBefore:!1});else{const n=i.edits;let o=n;i.kind==="ghostText"&&(o=qBe(n,this.textModel));const r=Tee(o).map(a=>at.fromPositions(a));if(PS.editWithReason(this._getMetadata(t),()=>{e.executeEdits("inlineSuggestion.accept",[...n.map(a=>Ki.replace(a.range,a.text)),...t.additionalTextEdits])}),t.displayLocation===void 0&&e.setSelections(i.kind==="inlineEdit"?r.slice(-1):r,"inlineCompletionAccept"),i.kind==="inlineEdit"&&!this._accessibilityService.isMotionReduced()){const a=new hc(n).getNewRanges(),c=this._store.add(new mVe(e,a,()=>{this._store.delete(c)}))}}this._onDidAccept.fire(),this.stop(),t.command&&(await this._commandService.executeCommand(t.command.id,...t.command.arguments||[]).then(void 0,kn),t.source.removeRef()),this._inAcceptFlow.set(!0,void 0),this._lastAcceptedInlineCompletionInfo={textModelVersionIdAfter:this.textModel.getVersionId(),inlineCompletion:t}}async acceptNextWord(){await this._acceptNext(this._editor,"word",(e,t)=>{const i=this.textModel.getLanguageIdAtPosition(e.lineNumber,e.column),n=this._languageConfigurationService.getLanguageConfiguration(i),o=new RegExp(n.wordDefinition.source,n.wordDefinition.flags.replace("g","")),r=t.match(o);let a=0;r&&r.index!==void 0?r.index===0?a=r[0].length:a=r.index:a=t.length;const d=/\s+/g.exec(t);return d&&d.index!==void 0&&d.index+d[0].length<a&&(a=d.index+d[0].length),a},xb.Word)}async acceptNextLine(){await this._acceptNext(this._editor,"line",(e,t)=>{const i=t.match(/\n/);return i&&i.index!==void 0?i.index+1:t.length},xb.Line)}async _acceptNext(e,t,i,n){if(e.getModel()!==this.textModel)throw new ln;const o=this.inlineCompletionState.get();if(!o||o.primaryGhostText.isEmpty()||!o.inlineCompletion)return;const r=o.primaryGhostText,a=o.inlineCompletion;if(a.snippetInfo){await this.accept(e);return}const c=r.parts[0],d=new _e(r.lineNumber,c.column),l=c.text,u=i(d,l);if(u===l.length&&r.parts.length===1){this.accept(e);return}const g=l.substring(0,u),m=this._positions.get(),v=m[0];a.source.addRef();try{this._isAcceptingPartially=!0;try{e.pushUndoStop();const T=P.fromPositions(v,d),k=e.getModel().getValueInRange(T)+g,A=new Cs(T,k),B=[A,...K0(this.textModel,m,A)],z=Tee(B).map(Q=>at.fromPositions(Q));PS.editWithReason(this._getMetadata(a,t),()=>{e.executeEdits("inlineSuggestion.accept",B.map(Q=>Ki.replace(Q.range,Q.text)))}),e.setSelections(z,"inlineCompletionPartialAccept"),e.revealPositionInCenterIfOutsideViewport(e.getPosition(),ji.Immediate)}finally{this._isAcceptingPartially=!1}const y=P.fromPositions(a.editRange.getStartPosition(),nc.ofText(g).addToPosition(d)),C=e.getModel().getValueInRange(y,ry.LF).length;a.reportPartialAccept(C,{kind:n,acceptedLength:C})}finally{a.source.removeRef()}}handleSuggestAccepted(e){const t=Tu(e.getSingleTextEdit(),this.textModel),i=this._computeAugmentation(t,void 0);if(!i)return;const o=this.textModel.getValueInRange(i.completion.editRange,ry.LF).length+t.text.length;i.completion.reportPartialAccept(t.text.length,{kind:xb.Suggest,acceptedLength:o})}extractReproSample(){const e=this.textModel.getValue(),t=this.state.get()?.inlineCompletion;return{documentValue:e,inlineCompletion:t?.getSourceCompletion()}}jump(){const e=this.inlineEditState.get();e&&ys(t=>{this._jumpedToId.set(e.inlineCompletion.semanticId,t),this.dontRefetchSignal.trigger(t);const i=e.inlineCompletion.targetRange,n=i.getStartPosition();if(this._editor.setPosition(n,"inlineCompletions.jump"),i.isSingleLine()&&(e.inlineCompletion.displayLocation||!e.inlineCompletion.insertText.includes(`
`)))this._editor.revealPosition(n);else{const r=new P(i.startLineNumber-1,1,i.endLineNumber+1,1);this._editor.revealRange(r,ji.Immediate)}this._editor.focus()})}async handleInlineSuggestionShown(e){await e.reportInlineEditShown(this._commandService)}};q$=f([p(7,J),p(8,qe),p(9,rs),p(10,Tr),p(11,Ne)],q$);var gu;(function(s){s[s.Undo=0]="Undo",s[s.Redo=1]="Redo",s[s.AcceptWord=2]="AcceptWord",s[s.Other=3]="Other"})(gu||(gu={}));function K0(s,e,t){if(e.length===1)return[];const i=e[0],n=e.slice(1),o=t.range.getStartPosition(),r=t.range.getEndPosition(),a=s.getValueInRange(P.fromPositions(i,r)),c=kee(i,o);if(c.lineNumber<1)return mt(new ln(`positionWithinTextEdit line number should be bigger than 0.
			Invalid subtraction between ${i.toString()} and ${o.toString()}`)),[];const d=$Be(t.text,c);return n.map(l=>{const u=UBe(kee(l,o),r),g=s.getValueInRange(P.fromPositions(l,u)),m=rf(a,g),v=P.fromPositions(l,l.delta(0,m));return new Cs(v,d)})}class mVe extends F{constructor(e,t,i){super(),i&&this._register({dispose:()=>i()}),this._register(xs(e).setDecorations(Fi(t.map(r=>({range:r,options:{description:"animation",className:"edits-fadeout-decoration",zIndex:1}})))));const n=new y1(1,0,1e3,QBe),o=new Q4(n);this._register(ki(r=>{const a=o.getValue(r);e.getContainerDomNode().style.setProperty("--animation-opacity",a.toString()),n.isFinished()&&this.dispose()}))}}class vVe extends F{get selectedItem(){return this._currentSuggestItemInfo}constructor(e,t,i){super(),this.editor=e,this.suggestControllerPreselector=t,this.onWillAccept=i,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this._onDidSelectedItemChange=this._register(new M),this.onDidSelectedItemChange=this._onDidSelectedItemChange.event,this._register(e.onKeyDown(o=>{o.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(e.onKeyUp(o=>{o.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));const n=ea.get(this.editor);if(n){this._register(n.registerSelector({priority:100,select:(a,c,d)=>{const l=this.editor.getModel();if(!l)return-1;const u=this.suggestControllerPreselector(),g=u?Tu(u,l):void 0;if(!g)return-1;const m=_e.lift(c),v=d.map((w,C)=>{const T=nE.fromSuggestion(n,l,m,w,this.isShiftKeyPressed),k=Tu(T.getSingleTextEdit(),l),A=rge(g,k);return{index:C,valid:A,prefixLength:k.text.length,suggestItem:w}}).filter(w=>w&&w.valid&&w.prefixLength>0),y=oye(v,ul(w=>w.prefixLength,Oh));return y?y.index:-1}}));let o=!1;const r=()=>{o||(o=!0,this._register(n.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(n.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.update(!1)})),this._register(n.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(D.once(n.model.onDidTrigger)(a=>{r()})),this._register(n.onWillInsertSuggestItem(a=>{const c=this.editor.getPosition(),d=this.editor.getModel();if(!c||!d)return;const l=nE.fromSuggestion(n,d,c,a.item,this.isShiftKeyPressed);this.onWillAccept(l)}))}this.update(this._isActive)}update(e){const t=this.getSuggestItemInfo();(this._isActive!==e||!_Ve(this._currentSuggestItemInfo,t))&&(this._isActive=e,this._currentSuggestItemInfo=t,this._onDidSelectedItemChange.fire())}getSuggestItemInfo(){const e=ea.get(this.editor);if(!e||!this.isSuggestWidgetVisible)return;const t=e.widget.value.getFocusedItem(),i=this.editor.getPosition(),n=this.editor.getModel();if(!(!t||!i||!n))return nE.fromSuggestion(e,n,i,t.item,this.isShiftKeyPressed)}stopForceRenderingAbove(){ea.get(this.editor)?.stopForceRenderingAbove()}forceRenderingAbove(){ea.get(this.editor)?.forceRenderingAbove()}}class nE{static fromSuggestion(e,t,i,n,o){let{insertText:r}=n.completion,a=!1;if(n.completion.insertTextRules&dh.InsertAsSnippet){const d=new fd().parse(r);d.children.length<100&&YR.adjustWhitespace(t,i,!0,d),r=d.toString(),a=!0}const c=e.getOverwriteInfo(n,o);return new nE(P.fromPositions(i.delta(0,-c.overwriteBefore),i.delta(0,Math.max(c.overwriteAfter,0))),r,n.completion.kind,a)}constructor(e,t,i,n){this.range=e,this.insertText=t,this.completionItemKind=i,this.isSnippetText=n}equals(e){return this.range.equalsRange(e.range)&&this.insertText===e.insertText&&this.completionItemKind===e.completionItemKind&&this.isSnippetText===e.isSnippetText}toSelectedSuggestionInfo(){return new rye(this.range,this.insertText,this.completionItemKind,this.isSnippetText)}getSingleTextEdit(){return new Cs(this.range,this.insertText)}}function _Ve(s,e){return s===e?!0:!s||!e?!1:s.equals(e)}class bVe extends F{constructor(e,t,i){super(),this._editorObs=e,this._handleSuggestAccepted=t,this._suggestControllerPreselector=i,this._suggestWidgetAdaptor=this._register(new vVe(this._editorObs.editor,()=>(this._editorObs.forceUpdate(),this._suggestControllerPreselector()),n=>this._editorObs.forceUpdate(o=>{this._handleSuggestAccepted(n)}))),this.selectedItem=On(this,n=>this._suggestWidgetAdaptor.onDidSelectedItemChange(()=>{this._editorObs.forceUpdate(o=>n(void 0))}),()=>this._suggestWidgetAdaptor.selectedItem)}stopForceRenderingAbove(){this._suggestWidgetAdaptor.stopForceRenderingAbove()}forceRenderingAbove(){this._suggestWidgetAdaptor.forceRenderingAbove()}}class Fx{static fromOffsetRange(e){return new Fx(e.start+1,e.endExclusive+1)}constructor(e,t){if(this.startColumn=e,this.endColumnExclusive=t,e>t)throw new ln(`startColumn ${e} cannot be after endColumnExclusive ${t}`)}toRange(e){return new P(e,this.startColumn,e,this.endColumnExclusive)}equals(e){return this.startColumn===e.startColumn&&this.endColumnExclusive===e.endColumnExclusive}toZeroBasedOffsetRange(){return new bi(this.startColumn-1,this.endColumnExclusive-1)}}class Z4{static fromRange(e){if(e.endLineNumber===e.startLineNumber)return new Z4(e.startLineNumber,new Fx(e.startColumn,e.endColumn))}constructor(e,t){this.lineNumber=e,this.columnRange=t}toRange(){return new P(this.lineNumber,this.columnRange.startColumn,this.lineNumber,this.columnRange.endColumnExclusive)}}const yVe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class _m{static fromLineTokens(e){const t=[];for(let i=0;i<e.getCount();i++)t.push(new Nee(e.getTokenText(i),e.getMetadata(i)));return _m.create(t)}static create(e){return new _m(e)}constructor(e){this._tokenInfo=e}toLineTokens(e){return mw.createFromTextAndMetadata(this.map((t,i)=>({text:i.text,metadata:i.metadata})),e)}forEach(e){let t=0;for(const i of this._tokenInfo){const n=new bi(t,t+i.text.length);e(n,i),t+=i.text.length}}map(e){const t=[];let i=0;for(const n of this._tokenInfo){const o=new bi(i,i+n.text.length);t.push(e(o,n)),i+=n.text.length}return t}slice(e){const t=[];let i=0;for(const n of this._tokenInfo){const o=i,r=o+n.text.length;if(r>e.start){if(o>=e.endExclusive)break;const a=Math.max(0,e.start-o),c=Math.max(0,r-e.endExclusive);t.push(new Nee(n.text.slice(a,n.text.length-c),n.metadata))}i+=n.text.length}return _m.create(t)}append(e){const t=this._tokenInfo.concat(e._tokenInfo);return _m.create(t)}}class Nee{constructor(e,t){this.text=e,this.metadata=t}}var z$;Be(yVe);const hge="ghost-text";let Wx=class extends F{static{z$=this}static{this.hot=cN(z$)}constructor(e,t,i,n,o,r){super(),this._editor=e,this._model=t,this._options=i,this._shouldKeepCursorStable=n,this._isClickable=o,this._languageService=r,this._isDisposed=oi(this,!1),this._editorObs=xs(this._editor),this._warningState=fe(a=>{const c=this._model.ghostText.read(a);if(!c)return;const d=this._model.warning.read(a);if(d)return{lineNumber:c.lineNumber,position:new _e(c.lineNumber,c.parts[0].column),icon:d.icon}}),this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._useSyntaxHighlighting=this._options.map(a=>a.syntaxHighlightingEnabled),this._extraClassNames=fe(this,a=>{const c=[...this._options.read(a).extraClasses??[]];return this._useSyntaxHighlighting.read(a)&&c.push("syntax-highlighted"),this._warningState.read(a)&&c.push("warning"),c.map(l=>` ${l}`).join("")}),this.uiState=fe(this,a=>{if(this._isDisposed.read(a))return;const c=this._editorObs.model.read(a);if(c!==this._model.targetTextModel.read(a))return;const d=this._model.ghostText.read(a);if(!d)return;const l=d instanceof H$?d.columnRange:void 0,u=this._useSyntaxHighlighting.read(a),g=this._extraClassNames.read(a),{inlineTexts:m,additionalLines:v,hiddenRange:y,additionalLinesOriginalSuffix:w}=wVe(d,c,hge+g),C=c.getLineContent(d.lineNumber),T=new jm(m.map(Q=>wa.insert(Q.column-1,Q.text))),k=u?c.tokenization.tokenizeLinesAt(d.lineNumber,[T.apply(C),...v.map(Q=>Q.content)]):void 0,A=T.getNewRanges(),B=m.map((Q,ie)=>({...Q,tokens:k?.[0]?.getTokensInRange(A[ie])})),z=v.map((Q,ie)=>{let oe=k?.[ie+1]??mw.createEmpty(Q.content,this._languageService.languageIdCodec);if(ie===v.length-1&&w){const Se=_m.fromLineTokens(c.tokenization.getLineTokens(w.lineNumber)).slice(w.columnRange.toZeroBasedOffsetRange());oe=_m.fromLineTokens(oe).append(Se).toLineTokens(oe.languageIdCodec)}return{content:oe,decorations:Q.decorations}});return{replacedRange:l,inlineTexts:B,additionalLines:z,hiddenRange:y,lineNumber:d.lineNumber,additionalReservedLineCount:this._model.minReservedLineCount.read(a),targetTextModel:c,syntaxHighlightingEnabled:u}}),this.decorations=fe(this,a=>{const c=this.uiState.read(a);if(!c)return[];const d=[],l=this._extraClassNames.read(a);c.replacedRange&&d.push({range:c.replacedRange.toRange(c.lineNumber),options:{inlineClassName:"inline-completion-text-to-replace"+l,description:"GhostTextReplacement"}}),c.hiddenRange&&d.push({range:c.hiddenRange.toRange(c.lineNumber),options:{inlineClassName:"ghost-text-hidden",description:"ghost-text-hidden"}});for(const u of c.inlineTexts)d.push({range:P.fromPositions(new _e(c.lineNumber,u.column)),options:{description:"ghost-text-decoration",after:{content:u.text,tokens:u.tokens,inlineClassName:(u.preview?"ghost-text-decoration-preview":"ghost-text-decoration")+(this._isClickable?" clickable":"")+l+u.lineDecorations.map(g=>" "+g.className).join(" "),cursorStops:zf.Left,attachedData:new j0(this)},showIfCollapsed:!0}});return d}),this._additionalLinesWidget=this._register(new SVe(this._editor,fe(a=>{const c=this.uiState.read(a);return c?{lineNumber:c.lineNumber,additionalLines:c.additionalLines,minReservedLineCount:c.additionalReservedLineCount,targetTextModel:c.targetTextModel}:void 0}),this._shouldKeepCursorStable,this._isClickable)),this._isInlineTextHovered=this._editorObs.isTargetHovered(a=>a.target.type===Ei.CONTENT_TEXT&&a.target.detail.injectedText?.options.attachedData instanceof j0&&a.target.detail.injectedText.options.attachedData.owner===this,this._store),this.isHovered=fe(this,a=>this._isDisposed.read(a)?!1:this._isInlineTextHovered.read(a)||this._additionalLinesWidget.isHovered.read(a)),this.height=fe(this,a=>this._editorObs.getOption(L.lineHeight).read(a)+(this._additionalLinesWidget.viewZoneHeight.read(a)??0)),this._register(Ee(()=>{this._isDisposed.set(!0,void 0)})),this._register(this._editorObs.setDecorations(this.decorations)),this._isClickable&&(this._register(this._additionalLinesWidget.onDidClick(a=>this._onDidClick.fire(a))),this._register(this._editor.onMouseUp(a=>{if(a.target.type!==Ei.CONTENT_TEXT)return;const c=a.target.detail.injectedText?.options.attachedData;c instanceof j0&&c.owner===this&&this._onDidClick.fire(a.event)}))),this._register(Da((a,c)=>{}))}static getWarningWidgetContext(e){const t=e.ghostTextViewWarningWidgetData;if(t)return t;if(e.parentElement)return this.getWarningWidgetContext(e.parentElement)}ownsViewZone(e){return this._additionalLinesWidget.viewZoneId===e}};Wx=z$=f([p(5,fi)],Wx);class j0{constructor(e){this.owner=e}}function wVe(s,e,t){const i=[],n=[];function o(u,g){if(n.length>0){const m=n[n.length-1];g&&m.decorations.push(new RE(m.content.length+1,m.content.length+1+u[0].line.length,g,Rb.Regular)),m.content+=u[0].line,u=u.slice(1)}for(const m of u)n.push({content:m.line,decorations:g?[new RE(1,m.line.length+1,g,Rb.Regular),...m.lineDecorations]:[...m.lineDecorations]})}const r=e.getLineContent(s.lineNumber);let a,c=0;for(const u of s.parts){let g=u.lines;a===void 0?(i.push({column:u.column,text:g[0].line,preview:u.preview,lineDecorations:g[0].lineDecorations}),g=g.slice(1)):o([{line:r.substring(c,u.column-1),lineDecorations:[]}],void 0),g.length>0&&(o(g,t),a===void 0&&u.column<=r.length&&(a=u.column)),c=u.column-1}let d;a!==void 0&&(d=new Z4(s.lineNumber,new Fx(c+1,r.length+1)));const l=a!==void 0?new Fx(a,r.length+1):void 0;return{inlineTexts:i,additionalLines:n,hiddenRange:l,additionalLinesOriginalSuffix:d}}class SVe extends F{get viewZoneId(){return this._viewZoneInfo?.viewZoneId}get viewZoneHeight(){return this._viewZoneHeight}constructor(e,t,i,n){super(),this._editor=e,this._lines=t,this._shouldKeepCursorStable=i,this._isClickable=n,this._viewZoneHeight=oi("viewZoneHeight",void 0),this.editorOptionsChanged=AE("editorOptionChanged",D.filter(this._editor.onDidChangeConfiguration,o=>o.hasChanged(L.disableMonospaceOptimizations)||o.hasChanged(L.stopRenderingLineAfter)||o.hasChanged(L.renderWhitespace)||o.hasChanged(L.renderControlCharacters)||o.hasChanged(L.fontLigatures)||o.hasChanged(L.fontInfo)||o.hasChanged(L.lineHeight))),this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._viewZoneListener=this._register(new kt),this.isHovered=xs(this._editor).isTargetHovered(o=>Oee(o.target.element),this._store),this.hasBeenAccepted=!1,this._editor instanceof hI&&this._shouldKeepCursorStable&&this._register(this._editor.onBeforeExecuteEdit(o=>this.hasBeenAccepted=o.source==="inlineSuggestion.accept")),this._register(ki(o=>{const r=this._lines.read(o);this.editorOptionsChanged.read(o),r?(this.hasBeenAccepted=!1,this.updateLines(r.lineNumber,r.additionalLines,r.minReservedLineCount)):this.clear()}))}dispose(){super.dispose(),this.clear()}clear(){this._viewZoneListener.clear(),this._editor.changeViewZones(e=>{this.removeActiveViewZone(e)})}updateLines(e,t,i){const n=this._editor.getModel();if(!n)return;const{tabSize:o}=n.getOptions();this._editor.changeViewZones(r=>{const a=new U;this.removeActiveViewZone(r);const c=Math.max(t.length,i);if(c>0){const d=document.createElement("div");CVe(d,o,t,this._editor.getOptions(),this._isClickable),this._isClickable&&(a.add(re(d,"mousedown",l=>{l.preventDefault()})),a.add(re(d,"click",l=>{Oee(l.target)&&this._onDidClick.fire(new us(bt(l),l))}))),this.addViewZone(r,e,c,d)}this._viewZoneListener.value=a})}addViewZone(e,t,i,n){const o=e.addZone({afterLineNumber:t,heightInLines:i,domNode:n,afterColumnAffinity:Jx.Right,onComputedHeight:r=>{this._viewZoneHeight.set(r,void 0)}});this.keepCursorStable(t,i),this._viewZoneInfo={viewZoneId:o,heightInLines:i,lineNumber:t}}removeActiveViewZone(e){this._viewZoneInfo&&(e.removeZone(this._viewZoneInfo.viewZoneId),this.hasBeenAccepted||this.keepCursorStable(this._viewZoneInfo.lineNumber,-this._viewZoneInfo.heightInLines),this._viewZoneInfo=void 0,this._viewZoneHeight.set(void 0,void 0))}keepCursorStable(e,t){if(!this._shouldKeepCursorStable)return;const i=this._editor.getSelection()?.getStartPosition()?.lineNumber;i!==void 0&&e<i&&this._editor.setScrollTop(this._editor.getScrollTop()+t*this._editor.getOption(L.lineHeight))}}function Oee(s){return Mh(s)&&s.classList.contains(hge)}function CVe(s,e,t,i,n){const o=i.get(L.disableMonospaceOptimizations),r=i.get(L.stopRenderingLineAfter),a="none",c=i.get(L.renderControlCharacters),d=i.get(L.fontLigatures),l=i.get(L.fontInfo),u=i.get(L.lineHeight);let g="suggest-preview-text";n&&(g+=" clickable");const m=new Xne(1e4);m.appendString(`<div class="${g}">`);for(let w=0,C=t.length;w<C;w++){const T=t[w],k=T.content;m.appendString('<div class="view-line'),m.appendString('" style="top:'),m.appendString(String(w*u)),m.appendString('px;width:1000000px;">');const A=k.getLineContent(),B=Zne(A),z=aye(A);Tse(new Ase(l.isMonospace&&!o,l.canUseHalfwidthRightwardsArrow,A,!1,B,z,0,k,T.decorations,e,0,l.spaceWidth,l.middotWidth,l.wsmiddotWidth,r,a,c,d!==cye.OFF,null),m),m.appendString("</div>")}m.appendString("</div>"),Jne(s,l);const v=m.build(),y=Fee?Fee.createHTML(v):v;s.innerHTML=y}const Fee=ese("editorGhostText",{createHTML:s=>s});class _u{static{this.empty=new _u([])}static deserialize(e){return new _u(e.map(t=>Pp.deserialize(t)))}static fromEdit(e,t){const i=hc.fromStringEdit(e,t);return _u.fromTextEdit(i,t)}static fromTextEdit(e,t){const i=e.replacements,n=[],o=[];for(let r=0;r<i.length;r++){const a=i[r],c=r+1<i.length?i[r+1]:void 0;if(o.push(a),c&&c.range.startLineNumber===a.range.endLineNumber)continue;const d=Cs.joinReplacements(o,t);o.length=0;const l=Pp.fromSingleTextEdit(d,t);n.push(l)}return new _u(n)}static createFromUnsorted(e){const t=e.slice();return t.sort(ul(i=>i.lineRange.startLineNumber,Oh)),new _u(t)}constructor(e){this.edits=e,ze(nN(e,(t,i)=>t.lineRange.endLineNumberExclusive<=i.lineRange.startLineNumber))}toEdit(e){const t=[];for(const i of this.edits){const n=i.toSingleEdit(e);t.push(n)}return new jm(t)}toString(){return this.edits.map(e=>e.toString()).join(",")}serialize(){return this.edits.map(e=>e.serialize())}getNewLineRanges(){const e=[];let t=0;for(const i of this.edits)e.push(Go.ofLength(i.lineRange.startLineNumber+t,i.newLines.length)),t+=i.newLines.length-i.lineRange.length;return e}mapLineNumber(e){let t=0;for(const i of this.edits){if(i.lineRange.endLineNumberExclusive>e)break;t+=i.newLines.length-i.lineRange.length}return e+t}mapLineRange(e){return new Go(this.mapLineNumber(e.startLineNumber),this.mapLineNumber(e.endLineNumberExclusive))}rebase(e){return new _u(this.edits.map(t=>new Pp(e.mapLineRange(t.lineRange),t.newLines)))}humanReadablePatch(e){const t=[];function i(a,c,d,l){const u=d==="unmodified"?" ":d==="deleted"?"-":"+";l===void 0&&(l="[[[[[ WARNING: LINE DOES NOT EXIST ]]]]]");const g=a===-1?"   ":a.toString().padStart(3," "),m=c===-1?"   ":c.toString().padStart(3," ");t.push(`${u} ${g} ${m} ${l}`)}function n(){t.push("---")}let o=0,r=!0;for(const a of dye(this.edits,(c,d)=>c.lineRange.distanceToRange(d.lineRange)<=5)){r?r=!1:n();let c=a[0].lineRange.startLineNumber-2;for(const d of a){for(let g=Math.max(1,c);g<d.lineRange.startLineNumber;g++)i(g,g+o,"unmodified",e[g-1]);const l=d.lineRange,u=d.newLines;for(const g of l.mapToLineArray(m=>m)){const m=e[g-1];i(g,-1,"deleted",m)}for(let g=0;g<u.length;g++){const m=u[g];i(-1,l.startLineNumber+o+g,"added",m)}c=l.endLineNumberExclusive,o+=d.newLines.length-d.lineRange.length}for(let d=c;d<=Math.min(c+2,e.length);d++)i(d,d+o,"unmodified",e[d-1])}return t.join(`
`)}apply(e){const t=[];let i=0;for(const n of this.edits){for(;i<n.lineRange.startLineNumber-1;)t.push(e[i]),i++;for(const o of n.newLines)t.push(o);i=n.lineRange.endLineNumberExclusive-1}for(;i<e.length;)t.push(e[i]),i++;return t}toSingleEdit(){}}class Pp{static deserialize(e){return new Pp(Go.ofLength(e[0],e[1]-e[0]),e[2])}static fromSingleTextEdit(e,t){const i=Ih(e.text);let n=e.range.startLineNumber;const o=t.getValueOfRange(P.fromPositions(new _e(e.range.startLineNumber,1),e.range.getStartPosition()));i[0]=o+i[0];let r=e.range.endLineNumber+1;const a=t.getTransformer().getLineLength(e.range.endLineNumber)+1,c=t.getValueOfRange(P.fromPositions(e.range.getEndPosition(),new _e(e.range.endLineNumber,a)));i[i.length-1]=i[i.length-1]+c;const d=e.range.startColumn===t.getTransformer().getLineLength(e.range.startLineNumber)+1,l=e.range.endColumn===1;return d&&i[0].length===o.length&&(n++,i.shift()),i.length>0&&n<r&&l&&i[i.length-1].length===c.length&&(r--,i.pop()),new Pp(new Go(n,r),i)}constructor(e,t){this.lineRange=e,this.newLines=t}toSingleTextEdit(e){if(this.newLines.length===0){const t=e.getTransformer().textLength;if(this.lineRange.endLineNumberExclusive===t.lineCount+2){let i;if(this.lineRange.startLineNumber>1){const o=this.lineRange.startLineNumber-1,r=e.getTransformer().getLineLength(o)+1;i=new _e(o,r)}else i=new _e(1,1);const n=t.addToPosition(new _e(1,1));return new Cs(P.fromPositions(i,n),"")}else return new Cs(new P(this.lineRange.startLineNumber,1,this.lineRange.endLineNumberExclusive,1),"")}else if(this.lineRange.isEmpty){let t,i,n;const o=this.lineRange.startLineNumber;return o===e.getTransformer().textLength.lineCount+2?(t=o-1,i=e.getTransformer().getLineLength(t)+1,n=this.newLines.map(r=>`
`+r).join("")):(t=o,i=1,n=this.newLines.map(r=>r+`
`).join("")),new Cs(P.fromPositions(new _e(t,i)),n)}else{const t=this.lineRange.endLineNumberExclusive-1,i=e.getTransformer().getLineLength(t)+1,n=new P(this.lineRange.startLineNumber,1,t,i),o=this.newLines.join(`
`);return new Cs(n,o)}}toSingleEdit(e){const t=this.toSingleTextEdit(e),i=e.getTransformer().getOffsetRange(t.range);return new wa(i,t.text)}toString(){return`${this.lineRange}->${JSON.stringify(this.newLines)}`}serialize(){return[this.lineRange.startLineNumber,this.lineRange.endLineNumberExclusive,this.newLines]}removeCommonSuffixPrefixLines(e){let t=this.lineRange.startLineNumber,i=this.lineRange.endLineNumberExclusive,n=0;for(;t<i&&n<this.newLines.length&&this.newLines[n]===e.getLineAt(t);)t++,n++;let o=0;for(;t<i&&o+n<this.newLines.length&&this.newLines[this.newLines.length-1-o]===e.getLineAt(i-1);)i--,o++;return n===0&&o===0?this:new Pp(new Go(t,i),this.newLines.slice(n,this.newLines.length-o))}toLineEdit(){return new _u([this])}}class uge{get lineEdit(){return Pp.fromSingleTextEdit(this.edit.toReplacement(this.originalText),this.originalText)}get originalLineRange(){return this.lineEdit.lineRange}get modifiedLineRange(){return this.lineEdit.toLineEdit().getNewLineRanges()[0]}get displayRange(){return this.originalText.lineRange.intersect(this.originalLineRange.join(Go.ofLength(this.originalLineRange.startLineNumber,this.lineEdit.newLines.length)))}constructor(e,t,i,n,o){this.originalText=e,this.edit=t,this.cursorPosition=i,this.commands=n,this.inlineCompletion=o}equals(e){return this.originalText.getValue()===e.originalText.getValue()&&this.edit.equals(e.edit)&&this.cursorPosition.equals(e.cursorPosition)&&this.commands===e.commands&&this.inlineCompletion===e.inlineCompletion}}var so;(function(s){s.Jump="jump",s.Accept="accept",s.Inactive="inactive"})(so||(so={}));class gge{constructor(e,t,i){this._model=e,this.inlineEdit=t,this.tabAction=i,this.action=this.inlineEdit.inlineCompletion.action,this.displayName=this.inlineEdit.inlineCompletion.source.provider.displayName??h(1280,"Inline Edit"),this.extensionCommands=this.inlineEdit.inlineCompletion.source.inlineSuggestions.commands??[],this.displayLocation=this.inlineEdit.inlineCompletion.displayLocation,this.showCollapsed=this._model.showCollapsed}accept(){this._model.accept()}jump(){this._model.jump()}abort(e){console.error(e),this._model.stop()}handleInlineEditShown(){this._model.handleInlineSuggestionShown(this.inlineEdit.inlineCompletion)}}class EVe{constructor(e){this._model=e,this.onDidAccept=this._model.onDidAccept,this.inAcceptFlow=this._model.inAcceptFlow}}class xVe{constructor(e,t,i,n){this.lineRange=i;const o=xs(e),r=fe(this,a=>o.isFocused.read(a)&&n.showInlineEditMenu?so.Accept:so.Inactive);this.model=new gge(t,new uge(new G_(""),new hc([n.getSingleTextEdit()]),t.primaryPosition.get(),n.source.inlineSuggestions.commands??[],n),r)}}class ni{static fromPoint(e){return new ni(e.x,e.y,e.x,e.y)}static fromPoints(e,t){return new ni(e.x,e.y,t.x,t.y)}static fromPointSize(e,t){return new ni(e.x,e.y,e.x+t.x,e.y+t.y)}static fromLeftTopRightBottom(e,t,i,n){return new ni(e,t,i,n)}static fromLeftTopWidthHeight(e,t,i,n){return new ni(e,t,e+i,t+n)}static fromRanges(e,t){return new ni(e.start,t.start,e.endExclusive,t.endExclusive)}static hull(e){let t=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(const r of e)t=Math.min(t,r.left),i=Math.min(i,r.top),n=Math.max(n,r.right),o=Math.max(o,r.bottom);return new ni(t,i,n,o)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}constructor(e,t,i,n){if(this.left=e,this.top=t,this.right=i,this.bottom=n,e>i||t>n)throw new ln("Invalid arguments")}withMargin(e,t,i,n){let o,r,a,c;return t===void 0&&i===void 0&&n===void 0?o=r=a=c=e:i===void 0&&n===void 0?(o=r=t,a=c=e):(o=n,r=t,a=e,c=i),new ni(this.left-o,this.top-a,this.right+r,this.bottom+c)}intersectVertical(e){const t=Math.max(this.top,e.start),i=Math.min(this.bottom,e.endExclusive);return new ni(this.left,t,this.right,Math.max(t,i))}intersectHorizontal(e){const t=Math.max(this.left,e.start),i=Math.min(this.right,e.endExclusive);return new ni(t,this.top,Math.max(t,i),this.bottom)}toString(){return`Rect{(${this.left},${this.top}), (${this.right},${this.bottom})}`}intersect(e){const t=Math.max(this.left,e.left),i=Math.min(this.right,e.right),n=Math.max(this.top,e.top),o=Math.min(this.bottom,e.bottom);if(!(t>i||n>o))return new ni(t,n,i,o)}union(e){return new ni(Math.min(this.left,e.left),Math.min(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom))}containsRect(e){return this.left<=e.left&&this.top<=e.top&&this.right>=e.right&&this.bottom>=e.bottom}containsPoint(e){return this.left<=e.x&&this.top<=e.y&&this.right>=e.x&&this.bottom>=e.y}moveToBeContainedIn(e){const t=this.width,i=this.height;let n=this.left,o=this.top;return n<e.left?n=e.left:n+t>e.right&&(n=e.right-t),o<e.top?o=e.top:o+i>e.bottom&&(o=e.bottom-i),new ni(n,o,n+t,o+i)}withWidth(e){return new ni(this.left,this.top,this.left+e,this.bottom)}withHeight(e){return new ni(this.left,this.top,this.right,this.top+e)}withTop(e){return new ni(this.left,e,this.right,this.bottom)}withLeft(e){return new ni(e,this.top,this.right,this.bottom)}translateX(e){return new ni(this.left+e,this.top,this.right+e,this.bottom)}translateY(e){return new ni(this.left,this.top+e,this.right,this.bottom+e)}deltaRight(e){return new ni(this.left,this.top,this.right+e,this.bottom)}deltaTop(e){return new ni(this.left,this.top+e,this.right,this.bottom)}deltaLeft(e){return new ni(this.left+e,this.top,this.right,this.bottom)}deltaBottom(e){return new ni(this.left,this.top,this.right,this.bottom+e)}getLeftBottom(){return new Su(this.left,this.bottom)}getRightBottom(){return new Su(this.right,this.bottom)}getLeftTop(){return new Su(this.left,this.top)}getRightTop(){return new Su(this.right,this.top)}toStyles(){return{position:"absolute",left:`${this.left}px`,top:`${this.top}px`,width:`${this.width}px`,height:`${this.height}px`}}}const IVe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(IVe);class vb{constructor(e,t,i,n=null){this.startLineNumbers=e,this.endLineNumbers=t,this.lastLineRelativePosition=i,this.showEndForLine=n}equals(e){return!!e&&this.lastLineRelativePosition===e.lastLineRelativePosition&&this.showEndForLine===e.showEndForLine&&ns(this.startLineNumbers,e.startLineNumbers)&&ns(this.endLineNumbers,e.endLineNumbers)}static get Empty(){return new vb([],[],0)}}const Wee=ese("stickyScrollViewLayer",{createHTML:s=>s}),Y0="data-sticky-line-index",Bee="data-sticky-is-line",DVe="data-sticky-is-line-number",Vee="data-sticky-is-folding-icon";class kVe extends F{get height(){return this._height}constructor(e){super(),this._foldingIconStore=new U,this._rootDomNode=document.createElement("div"),this._lineNumbersDomNode=document.createElement("div"),this._linesDomNodeScrollable=document.createElement("div"),this._linesDomNode=document.createElement("div"),this._renderedStickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._height=-1,this._onDidChangeStickyScrollHeight=this._register(new M),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._editor=e,this._lineHeight=e.getOption(L.lineHeight),this._lineNumbersDomNode.className="sticky-widget-line-numbers",this._lineNumbersDomNode.setAttribute("role","none"),this._linesDomNode.className="sticky-widget-lines",this._linesDomNode.setAttribute("role","list"),this._linesDomNodeScrollable.className="sticky-widget-lines-scrollable",this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className="sticky-widget",this._rootDomNode.classList.toggle("peek",e instanceof pd),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable),this._setHeight(0);const t=()=>{this._linesDomNode.style.left=this._editor.getOption(L.stickyScroll).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:"0px"};this._register(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(L.stickyScroll)&&t(),i.hasChanged(L.lineHeight)&&(this._lineHeight=this._editor.getOption(L.lineHeight))})),this._register(this._editor.onDidScrollChange(i=>{i.scrollLeftChanged&&t(),i.scrollWidthChanged&&this._updateWidgetWidth()})),this._register(this._editor.onDidChangeModel(()=>{t(),this._updateWidgetWidth()})),this._register(this._foldingIconStore),t(),this._register(this._editor.onDidLayoutChange(i=>{this._updateWidgetWidth()})),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getRenderedStickyLine(e){return this._renderedStickyLines.find(t=>t.lineNumber===e)}getCurrentLines(){return this._lineNumbers}setState(e,t,i){if(i===void 0&&(!this._previousState&&!e||this._previousState&&this._previousState.equals(e)))return;const n=this._isWidgetHeightZero(e),o=n?void 0:e,r=n?0:this._findLineToRebuildWidgetFrom(e,i);this._renderRootNode(o,t,r),this._previousState=e}_isWidgetHeightZero(e){if(!e)return!0;const t=this._getHeightOfLines(e.startLineNumbers,e.lastLineRelativePosition);if(t>0){this._lastLineRelativePosition=e.lastLineRelativePosition;const i=[...e.startLineNumbers];e.showEndForLine!==null&&(i[e.showEndForLine]=e.endLineNumbers[e.showEndForLine]),this._lineNumbers=i}else this._lastLineRelativePosition=0,this._lineNumbers=[];return t===0}_findLineToRebuildWidgetFrom(e,t){if(!e||!this._previousState)return 0;if(t!==void 0)return t;const i=this._previousState,n=e.startLineNumbers.findIndex(o=>!i.startLineNumbers.includes(o));return n===-1?0:n}_updateWidgetWidth(){const e=this._editor.getLayoutInfo(),t=e.contentLeft;this._lineNumbersDomNode.style.width=`${t}px`,this._linesDomNodeScrollable.style.setProperty("--vscode-editorStickyScroll-scrollableWidth",`${this._editor.getScrollWidth()-e.verticalScrollbarWidth}px`),this._rootDomNode.style.width=`${e.width-e.verticalScrollbarWidth}px`}_clearStickyLinesFromLine(e){this._foldingIconStore.clear();for(let t=e;t<this._renderedStickyLines.length;t++){const i=this._renderedStickyLines[t];i.lineNumberDomNode.remove(),i.lineDomNode.remove()}this._renderedStickyLines=this._renderedStickyLines.slice(0,e)}_useFoldingOpacityTransition(e){this._lineNumbersDomNode.style.setProperty("--vscode-editorStickyScroll-foldingOpacityTransition",`opacity ${e?.5:0}s`)}_setFoldingIconsVisibility(e){for(const t of this._renderedStickyLines){const i=t.foldingIcon;i&&i.setVisible(e?!0:i.isCollapsed)}}async _renderRootNode(e,t,i){if(this._clearStickyLinesFromLine(i),!e){this._setHeight(0);return}let n=0;for(const c of this._renderedStickyLines)this._updatePosition(c,n),n+=c.height;const o=this._editor.getLayoutInfo(),r=this._lineNumbers.slice(i);for(const[c,d]of r.entries()){const l=this._renderChildNode(c+i,d,n,t,o);l&&(n+=l.height,this._linesDomNode.appendChild(l.lineDomNode),this._lineNumbersDomNode.appendChild(l.lineNumberDomNode),this._renderedStickyLines.push(l))}t&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin));const a=n+this._lastLineRelativePosition;this._setHeight(a),this._rootDomNode.style.marginLeft="0px",this._minContentWidthInPx=Math.max(...this._renderedStickyLines.map(c=>c.scrollWidth))+o.verticalScrollbarWidth,this._editor.layoutOverlayWidget(this)}_getHeightOfLines(e,t){let i=0;for(let n=0;n<e.length;n++)i+=this._editor.getLineHeightForPosition(new _e(e[n],1));return i+t}_setHeight(e){this._height!==e&&(this._height=e,this._height===0?this._rootDomNode.style.display="none":(this._rootDomNode.style.display="block",this._lineNumbersDomNode.style.height=`${this._height}px`,this._linesDomNodeScrollable.style.height=`${this._height}px`,this._rootDomNode.style.height=`${this._height}px`),this._onDidChangeStickyScrollHeight.fire({height:this._height}))}_setFoldingHoverListeners(){this._editor.getOption(L.showFoldingControls)==="mouseover"&&(this._foldingIconStore.add(re(this._lineNumbersDomNode,pe.MOUSE_ENTER,()=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)})),this._foldingIconStore.add(re(this._lineNumbersDomNode,pe.MOUSE_LEAVE,()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)})))}_renderChildNode(e,t,i,n,o){const r=this._editor._getViewModel();if(!r)return;const a=r.coordinatesConverter.convertModelPositionToViewPosition(new _e(t,1)).lineNumber,c=r.getViewLineRenderingData(a),d=this._editor.getOption(L.lineNumbers);let l;try{l=RE.filter(c.inlineDecorations,a,c.minColumn,c.maxColumn)}catch{l=[]}const u=this._editor.getLineHeightForPosition(new _e(t,1)),g=new Ase(!0,!0,c.content,c.continuesWithWrappedLine,c.isBasicASCII,c.containsRTL,0,c.tokens,l,c.tabSize,c.startVisibleColumn,1,1,1,500,"none",!0,!0,null),m=new Xne(2e3),v=Tse(g,m);let y;Wee?y=Wee.createHTML(m.build()):y=m.build();const w=document.createElement("span");w.setAttribute(Y0,String(e)),w.setAttribute(Bee,""),w.setAttribute("role","listitem"),w.tabIndex=0,w.className="sticky-line-content",w.classList.add(`stickyLine${t}`),w.style.lineHeight=`${u}px`,w.innerHTML=y;const C=document.createElement("span");C.setAttribute(Y0,String(e)),C.setAttribute(DVe,""),C.className="sticky-line-number",C.style.lineHeight=`${u}px`;const T=o.contentLeft;C.style.width=`${T}px`;const k=document.createElement("span");d.renderType===cs.On||d.renderType===cs.Interval&&t%10===0?k.innerText=t.toString():d.renderType===cs.Relative&&(k.innerText=Math.abs(t-this._editor.getPosition().lineNumber).toString()),k.className="sticky-line-number-inner",k.style.width=`${o.lineNumbersWidth}px`,k.style.paddingLeft=`${o.lineNumbersLeft}px`,C.appendChild(k);const A=this._renderFoldingIconForLine(n,t);A&&(C.appendChild(A.domNode),A.domNode.style.left=`${o.lineNumbersWidth+o.lineNumbersLeft}px`,A.domNode.style.lineHeight=`${u}px`),this._editor.applyFontInfo(w),this._editor.applyFontInfo(C),C.style.lineHeight=`${u}px`,w.style.lineHeight=`${u}px`,C.style.height=`${u}px`,w.style.height=`${u}px`;const B=new TVe(e,t,w,C,A,v.characterMapping,w.scrollWidth,u);return this._updatePosition(B,i)}_updatePosition(e,t){const i=e.index,n=e.lineDomNode,o=e.lineNumberDomNode;if(i===this._lineNumbers.length-1){const a="0";n.style.zIndex=a,o.style.zIndex=a;const c=`${t+this._lastLineRelativePosition+(e.foldingIcon?.isCollapsed?1:0)}px`;n.style.top=c,o.style.top=c}else{const a="1";n.style.zIndex=a,o.style.zIndex=a,n.style.top=`${t}px`,o.style.top=`${t}px`}return e}_renderFoldingIconForLine(e,t){const i=this._editor.getOption(L.showFoldingControls);if(!e||i==="never")return;const n=e.regions,o=n.findRange(t),r=n.getStartLineNumber(o);if(!(t===r))return;const c=n.isCollapsed(o),d=new AVe(c,r,n.getEndLineNumber(o),this._lineHeight);return d.setVisible(this._isOnGlyphMargin?!0:c||i==="always"),d.domNode.setAttribute(Vee,""),d}getId(){return"editor.contrib.stickyScrollWidget"}getDomNode(){return this._rootDomNode}getPosition(){return{preference:bI.TOP_CENTER,stackOridinal:10}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(e){0<=e&&e<this._renderedStickyLines.length&&this._renderedStickyLines[e].lineDomNode.focus()}getEditorPositionFromNode(e){if(!e||e.children.length>0)return null;const t=this._getRenderedStickyLineFromChildDomNode(e);if(!t)return null;const i=ASe(t.characterMapping,e,0);return new _e(t.lineNumber,i)}getLineNumberFromChildDomNode(e){return this._getRenderedStickyLineFromChildDomNode(e)?.lineNumber??null}_getRenderedStickyLineFromChildDomNode(e){const t=this.getLineIndexFromChildDomNode(e);return t===null||t<0||t>=this._renderedStickyLines.length?null:this._renderedStickyLines[t]}getLineIndexFromChildDomNode(e){const t=this._getAttributeValue(e,Y0);return t?parseInt(t,10):null}isInStickyLine(e){return this._getAttributeValue(e,Bee)!==void 0}isInFoldingIconDomNode(e){return this._getAttributeValue(e,Vee)!==void 0}_getAttributeValue(e,t){for(;e&&e!==this._rootDomNode;){const i=e.getAttribute(t);if(i!==null)return i;e=e.parentElement}}}class TVe{constructor(e,t,i,n,o,r,a,c){this.index=e,this.lineNumber=t,this.lineDomNode=i,this.lineNumberDomNode=n,this.foldingIcon=o,this.characterMapping=r,this.scrollWidth=a,this.height=c}}class AVe{constructor(e,t,i,n){this.isCollapsed=e,this.foldingStartLine=t,this.foldingEndLine=i,this.dimension=n,this.domNode=document.createElement("div"),this.domNode.style.width="26px",this.domNode.style.height=`${n}px`,this.domNode.style.lineHeight=`${n}px`,this.domNode.className=Te.asClassName(e?RSe:PSe)}setVisible(e){this.domNode.style.cursor=e?"pointer":"default",this.domNode.style.opacity=e?"1":"0"}}class sE{constructor(e,t){this.startLineNumber=e,this.endLineNumber=t}}class kL{constructor(e,t,i){this.range=e,this.children=t,this.parent=i}}class pge{constructor(e,t,i,n){this.uri=e,this.version=t,this.element=i,this.outlineProviderId=n}}var oE;(function(s){s.OUTLINE_MODEL="outlineModel",s.FOLDING_PROVIDER_MODEL="foldingProviderModel",s.INDENTATION_MODEL="indentationModel"})(oE||(oE={}));var fp;(function(s){s[s.VALID=0]="VALID",s[s.INVALID=1]="INVALID",s[s.CANCELED=2]="CANCELED"})(fp||(fp={}));let K$=class extends F{constructor(e,t,i,n){switch(super(),this._editor=e,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new tg(300)),this._updateOperation=this._register(new U),this._editor.getOption(L.stickyScroll).defaultModel){case oE.OUTLINE_MODEL:this._modelProviders.push(new j$(this._editor,n));case oE.FOLDING_PROVIDER_MODEL:this._modelProviders.push(new Q$(this._editor,t,n));case oE.INDENTATION_MODEL:this._modelProviders.push(new Y$(this._editor,i));break}}dispose(){this._modelProviders.forEach(e=>e.dispose()),this._updateOperation.clear(),this._cancelModelPromise(),super.dispose()}_cancelModelPromise(){this._modelPromise&&(this._modelPromise.cancel(),this._modelPromise=null)}async update(e){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),await this._updateScheduler.trigger(async()=>{for(const t of this._modelProviders){const{statusPromise:i,modelPromise:n}=t.computeStickyModel(e);this._modelPromise=n;const o=await i;if(this._modelPromise!==n)return null;switch(o){case fp.CANCELED:return this._updateOperation.clear(),null;case fp.VALID:return t.stickyModel}}return null}).catch(t=>(mt(t),null))}};K$=f([p(2,J),p(3,Ne)],K$);class fge extends F{constructor(e){super(),this._editor=e,this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,fp.INVALID}computeStickyModel(e){if(e.isCancellationRequested||!this.isProviderValid())return{statusPromise:this._invalid(),modelPromise:null};const t=En(i=>this.createModelFromProvider(i));return{statusPromise:t.then(i=>this.isModelValid(i)?e.isCancellationRequested?fp.CANCELED:(this._stickyModel=this.createStickyModel(e,i),fp.VALID):this._invalid()).then(void 0,i=>(mt(i),fp.CANCELED)),modelPromise:t}}isModelValid(e){return!0}isProviderValid(){return!0}}let j$=class extends fge{constructor(e,t){super(e),this._languageFeaturesService=t}createModelFromProvider(e){return Yl.create(this._languageFeaturesService.documentSymbolProvider,this._editor.getModel(),e)}createStickyModel(e,t){const{stickyOutlineElement:i,providerID:n}=this._stickyModelFromOutlineModel(t,this._stickyModel?.outlineProviderId),o=this._editor.getModel();return new pge(o.uri,o.getVersionId(),i,n)}isModelValid(e){return e&&e.children.size>0}_stickyModelFromOutlineModel(e,t){let i;if(dn.first(e.children.values())instanceof oB){const a=dn.find(e.children.values(),c=>c.id===t);if(a)i=a.children;else{let c="",d=-1,l;for(const[u,g]of e.children.entries()){const m=this._findSumOfRangesOfGroup(g);m>d&&(l=g,d=m,c=g.id)}t=c,i=l.children}}else i=e.children;const n=[],o=Array.from(i.values()).sort((a,c)=>{const d=new sE(a.symbol.range.startLineNumber,a.symbol.range.endLineNumber),l=new sE(c.symbol.range.startLineNumber,c.symbol.range.endLineNumber);return this._comparator(d,l)});for(const a of o)n.push(this._stickyModelFromOutlineElement(a,a.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new kL(void 0,n,void 0),providerID:t}}_stickyModelFromOutlineElement(e,t){const i=[];for(const o of e.children.values())if(o.symbol.selectionRange.startLineNumber!==o.symbol.range.endLineNumber)if(o.symbol.selectionRange.startLineNumber!==t)i.push(this._stickyModelFromOutlineElement(o,o.symbol.selectionRange.startLineNumber));else for(const r of o.children.values())i.push(this._stickyModelFromOutlineElement(r,o.symbol.selectionRange.startLineNumber));i.sort((o,r)=>this._comparator(o.range,r.range));const n=new sE(e.symbol.selectionRange.startLineNumber,e.symbol.range.endLineNumber);return new kL(n,i,void 0)}_comparator(e,t){return e.startLineNumber!==t.startLineNumber?e.startLineNumber-t.startLineNumber:t.endLineNumber-e.endLineNumber}_findSumOfRangesOfGroup(e){let t=0;for(const i of e.children.values())t+=this._findSumOfRangesOfGroup(i);return e instanceof RA?t+e.symbol.range.endLineNumber-e.symbol.selectionRange.startLineNumber:t}};j$=f([p(1,Ne)],j$);class mge extends fge{constructor(e){super(e),this._foldingLimitReporter=this._register(new NSe(e))}createStickyModel(e,t){const i=this._fromFoldingRegions(t),n=this._editor.getModel();return new pge(n.uri,n.getVersionId(),i,void 0)}isModelValid(e){return e!==null}_fromFoldingRegions(e){const t=e.length,i=[],n=new kL(void 0,[],void 0);for(let o=0;o<t;o++){const r=e.getParentIndex(o);let a;r!==-1?a=i[r]:a=n;const c=new kL(new sE(e.getStartLineNumber(o),e.getEndLineNumber(o)+1),[],a);a.children.push(c),i.push(c)}return n}}let Y$=class extends mge{constructor(e,t){super(e),this._languageConfigurationService=t,this.provider=this._register(new LSe(e.getModel(),this._languageConfigurationService,this._foldingLimitReporter))}async createModelFromProvider(e){return this.provider.compute(e)}};Y$=f([p(1,rs)],Y$);let Q$=class extends mge{constructor(e,t,i){super(e),this._languageFeaturesService=i;const n=Kq.getFoldingRangeProviders(this._languageFeaturesService,e.getModel());n.length>0&&(this.provider=this._register(new MSe(e.getModel(),n,t,this._foldingLimitReporter,void 0)))}isProviderValid(){return this.provider!==void 0}async createModelFromProvider(e){return this.provider?.compute(e)??null}};Q$=f([p(2,Ne)],Q$);class RVe{constructor(e,t,i,n){this.startLineNumber=e,this.endLineNumber=t,this.top=i,this.height=n}}let X$=class extends F{static{this.ID="store.contrib.stickyScrollController"}constructor(e,t,i){super(),this._languageFeaturesService=t,this._languageConfigurationService=i,this._onDidChangeStickyScroll=this._register(new M),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=e,this._sessionStore=this._register(new U),this._updateSoon=this._register(new fn(()=>this.update(),50)),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.stickyScroll)&&this.readConfiguration()})),this.readConfiguration()}readConfiguration(){this._sessionStore.clear(),this._editor.getOption(L.stickyScroll).enabled&&(this._sessionStore.add(this._editor.onDidChangeModel(()=>{this._model=null,this.updateStickyModelProvider(),this._onDidChangeStickyScroll.fire(),this.update()})),this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update())),this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule())),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update())),this._sessionStore.add(Ee(()=>{this._stickyModelProvider?.dispose(),this._stickyModelProvider=null})),this.updateStickyModelProvider(),this.update())}getVersionId(){return this._model?.version}updateStickyModelProvider(){this._stickyModelProvider?.dispose(),this._stickyModelProvider=null;const e=this._editor;e.hasModel()&&(this._stickyModelProvider=new K$(e,()=>this._updateSoon.schedule(),this._languageConfigurationService,this._languageFeaturesService))}async update(){this._cts?.dispose(!0),this._cts=new ri,await this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()}async updateStickyModel(e){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization()){this._model=null;return}const t=await this._stickyModelProvider.update(e);e.isCancellationRequested||(this._model=t)}updateIndex(e){return e===-1?e=0:e<0&&(e=-e-2),e}getCandidateStickyLinesIntersectingFromStickyModel(e,t,i,n,o,r){if(t.children.length===0)return;let a=r;const c=[];for(let u=0;u<t.children.length;u++){const g=t.children[u];g.range&&c.push(g.range.startLineNumber)}const d=this.updateIndex(AT(c,e.startLineNumber,(u,g)=>u-g)),l=this.updateIndex(AT(c,e.endLineNumber,(u,g)=>u-g));for(let u=d;u<=l;u++){const g=t.children[u];if(!g)return;const m=g.range;if(m){const v=m.startLineNumber,y=m.endLineNumber;if(e.startLineNumber<=y+1&&v-1<=e.endLineNumber&&v!==a){a=v;const w=this._editor.getLineHeightForPosition(new _e(v,1));i.push(new RVe(v,y-1,o,w)),this.getCandidateStickyLinesIntersectingFromStickyModel(e,g,i,n+1,o+w,v)}}else this.getCandidateStickyLinesIntersectingFromStickyModel(e,g,i,n,o,r)}}getCandidateStickyLinesIntersecting(e){if(!this._model?.element)return[];let t=[];this.getCandidateStickyLinesIntersectingFromStickyModel(e,this._model.element,t,0,0,-1);const i=this._editor._getViewModel()?.getHiddenAreas();if(i)for(const n of i)t=t.filter(o=>!(o.startLineNumber>=n.startLineNumber&&o.endLineNumber<=n.endLineNumber+1));return t}};X$=f([p(1,Ne),p(2,rs)],X$);var Z$;let bd=class extends F{static{Z$=this}static{this.ID="store.contrib.stickyScrollController"}constructor(e,t,i,n,o,r,a){super(),this._editor=e,this._contextMenuService=t,this._languageFeaturesService=i,this._instaService=n,this._contextKeyService=a,this._sessionStore=new U,this._maxStickyLines=Number.MAX_SAFE_INTEGER,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._mouseTarget=null,this._onDidChangeStickyScrollHeight=this._register(new M),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._stickyScrollWidget=new kVe(this._editor),this._stickyLineCandidateProvider=new X$(this._editor,i,o),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=vb.Empty;const c=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeLineHeight(l=>{l.changes.forEach(u=>{const g=u.lineNumber;this._widgetState.startLineNumbers.includes(g)&&this._renderStickyScroll(g)})})),this._register(this._editor.onDidChangeConfiguration(l=>{this._readConfigurationChange(l)})),this._register(re(c,pe.CONTEXT_MENU,async l=>{this._onContextMenu(bt(c),l)})),this._stickyScrollFocusedContextKey=V.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=V.stickyScrollVisible.bindTo(this._contextKeyService);const d=this._register(Po(c));this._register(d.onDidBlur(l=>{this._positionRevealed===!1&&c.clientHeight===0?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()})),this._register(d.onDidFocus(l=>{this.focus()})),this._registerMouseListeners(),this._register(re(c,pe.MOUSE_DOWN,l=>{this._onMouseDown=!0})),this._register(this._stickyScrollWidget.onDidChangeStickyScrollHeight(l=>{this._onDidChangeStickyScrollHeight.fire(l)})),this._onDidResize(),this._readConfiguration()}get stickyScrollCandidateProvider(){return this._stickyLineCandidateProvider}get stickyScrollWidgetState(){return this._widgetState}get stickyScrollWidgetHeight(){return this._stickyScrollWidget.height}static get(e){return e.getContribution(Z$.ID)}_disposeFocusStickyScrollStore(){this._stickyScrollFocusedContextKey.set(!1),this._focusDisposableStore?.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}isFocused(){return this._focused}focus(){if(this._onMouseDown){this._onMouseDown=!1,this._editor.focus();return}this._stickyScrollFocusedContextKey.get()!==!0&&(this._focused=!0,this._focusDisposableStore=new U,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(e){this._focusedStickyElementIndex=e?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){const e=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:e[this._focusedStickyElementIndex],column:1})}_revealPosition(e){this._reveaInEditor(e,()=>this._editor.revealPosition(e))}_revealLineInCenterIfOutsideViewport(e){this._reveaInEditor(e,()=>this._editor.revealLineInCenterIfOutsideViewport(e.lineNumber,ji.Smooth))}_reveaInEditor(e,t){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,t(),this._editor.setSelection(P.fromPositions(e)),this._editor.focus()}_registerMouseListeners(){const e=this._register(new U),t=this._register(new zN(this._editor,{extractLineNumberFromMouseEvent:c=>{const d=this._stickyScrollWidget.getEditorPositionFromNode(c.target.element);return d?d.lineNumber:0}})),i=c=>{if(!this._editor.hasModel()||c.target.type!==Ei.OVERLAY_WIDGET||c.target.detail!==this._stickyScrollWidget.getId())return null;const d=c.target.element;if(!d||d.innerText!==d.innerHTML)return null;const l=this._stickyScrollWidget.getEditorPositionFromNode(d);return l?{range:new P(l.lineNumber,l.column,l.lineNumber,l.column+d.innerText.length),textElement:d}:null},n=this._stickyScrollWidget.getDomNode();this._register(co(n,pe.CLICK,c=>{if(c.ctrlKey||c.altKey||c.metaKey||!c.leftButton)return;if(c.shiftKey){const g=this._stickyScrollWidget.getLineIndexFromChildDomNode(c.target);if(g===null)return;const m=new _e(this._endLineNumbers[g],1);this._revealLineInCenterIfOutsideViewport(m);return}if(this._stickyScrollWidget.isInFoldingIconDomNode(c.target)){const g=this._stickyScrollWidget.getLineNumberFromChildDomNode(c.target);this._toggleFoldingRegionForLine(g);return}if(!this._stickyScrollWidget.isInStickyLine(c.target))return;let u=this._stickyScrollWidget.getEditorPositionFromNode(c.target);if(!u){const g=this._stickyScrollWidget.getLineNumberFromChildDomNode(c.target);if(g===null)return;u=new _e(g,1)}this._revealPosition(u)}));const o=c=>{this._mouseTarget=c.target,this._onMouseMoveOrKeyDown(c)},r=c=>{this._onMouseMoveOrKeyDown(c)},a=c=>{this._showEndForLine!==void 0&&(this._showEndForLine=void 0,this._renderStickyScroll())};$i.addEventListener(pe.MOUSE_MOVE,o),$i.addEventListener(pe.KEY_DOWN,r),$i.addEventListener(pe.KEY_UP,a),this._register(Ee(()=>{$i.removeEventListener(pe.MOUSE_MOVE,o),$i.removeEventListener(pe.KEY_DOWN,r),$i.removeEventListener(pe.KEY_UP,a)})),this._register(t.onMouseMoveOrRelevantKeyDown(([c,d])=>{const l=i(c);if(!l||!c.hasTriggerModifier||!this._editor.hasModel()){e.clear();return}const{range:u,textElement:g}=l;if(!u.equalsRange(this._stickyRangeProjectedOnEditor))this._stickyRangeProjectedOnEditor=u,e.clear();else if(g.style.textDecoration==="underline")return;const m=new ri;e.add(Ee(()=>m.dispose(!0)));let v;AI(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new _e(u.startLineNumber,u.startColumn+1),!1,m.token).then(y=>{if(!m.token.isCancellationRequested)if(y.length!==0){this._candidateDefinitionsLength=y.length;const w=g;v!==w?(e.clear(),v=w,v.style.textDecoration="underline",e.add(Ee(()=>{v.style.textDecoration="none"}))):v||(v=w,v.style.textDecoration="underline",e.add(Ee(()=>{v.style.textDecoration="none"})))}else e.clear()})})),this._register(t.onCancel(()=>{e.clear()})),this._register(t.onExecute(async c=>{if(c.target.type!==Ei.OVERLAY_WIDGET||c.target.detail!==this._stickyScrollWidget.getId())return;const d=this._stickyScrollWidget.getEditorPositionFromNode(c.target.element);d&&(!this._editor.hasModel()||!this._stickyRangeProjectedOnEditor||(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:d.lineNumber,column:1})),this._instaService.invokeFunction(fae,c,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor})))}))}_onContextMenu(e,t){const i=new us(e,t);this._contextMenuService.showContextMenu({menuId:N.StickyScrollContext,getAnchor:()=>i})}_onMouseMoveOrKeyDown(e){if(!e.shiftKey||!this._mouseTarget||!Mh(this._mouseTarget))return;const t=this._stickyScrollWidget.getLineIndexFromChildDomNode(this._mouseTarget);t===null||this._showEndForLine===t||(this._showEndForLine=t,this._renderStickyScroll())}_toggleFoldingRegionForLine(e){if(!this._foldingModel||e===null)return;const t=this._stickyScrollWidget.getRenderedStickyLine(e),i=t?.foldingIcon;if(!i)return;OSe(this._foldingModel,1,[e]),i.isCollapsed=!i.isCollapsed;const n=(i.isCollapsed?this._editor.getTopForLineNumber(i.foldingEndLine):this._editor.getTopForLineNumber(i.foldingStartLine))-this._editor.getOption(L.lineHeight)*t.index+1;this._editor.setScrollTop(n),this._renderStickyScroll(e)}_readConfiguration(){const e=this._editor.getOption(L.stickyScroll);if(e.enabled===!1){this._editor.removeOverlayWidget(this._stickyScrollWidget),this._resetState(),this._sessionStore.clear(),this._enabled=!1;return}else e.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange(i=>{i.scrollTopChanged&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize())),this._sessionStore.add(this._editor.onDidChangeModelTokens(i=>this._onTokensChange(i))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{this._showEndForLine=void 0,this._renderStickyScroll()})),this._enabled=!0);this._editor.getOption(L.lineNumbers).renderType===cs.Relative&&this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{this._showEndForLine=void 0,this._renderStickyScroll(0)}))}_readConfigurationChange(e){(e.hasChanged(L.stickyScroll)||e.hasChanged(L.minimap)||e.hasChanged(L.lineHeight)||e.hasChanged(L.showFoldingControls)||e.hasChanged(L.lineNumbers))&&this._readConfiguration(),(e.hasChanged(L.lineNumbers)||e.hasChanged(L.folding)||e.hasChanged(L.showFoldingControls))&&this._renderStickyScroll(0)}_needsUpdate(e){const t=this._stickyScrollWidget.getCurrentLines();for(const i of t)for(const n of e.ranges)if(i>=n.fromLineNumber&&i<=n.toLineNumber)return!0;return!1}_onTokensChange(e){this._needsUpdate(e)&&this._renderStickyScroll(0)}_onDidResize(){const t=this._editor.getLayoutInfo().height/this._editor.getOption(L.lineHeight);this._maxStickyLines=Math.round(t*.25),this._renderStickyScroll(0)}async _renderStickyScroll(e){const t=this._editor.getModel();if(!t||t.isTooLargeForTokenization()){this._resetState();return}const i=this._updateAndGetMinRebuildFromLine(e),n=this._stickyLineCandidateProvider.getVersionId();if(n===void 0||n===t.getVersionId())if(!this._focused)await this._updateState(i);else if(this._focusedStickyElementIndex===-1)await this._updateState(i),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,this._focusedStickyElementIndex!==-1&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{const r=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];await this._updateState(i),this._stickyScrollWidget.lineNumberCount===0?this._focusedStickyElementIndex=-1:(this._stickyScrollWidget.lineNumbers.includes(r)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}}_updateAndGetMinRebuildFromLine(e){if(e!==void 0){const t=this._minRebuildFromLine!==void 0?this._minRebuildFromLine:1/0;this._minRebuildFromLine=Math.min(e,t)}return this._minRebuildFromLine}async _updateState(e){this._minRebuildFromLine=void 0,this._foldingModel=await Kq.get(this._editor)?.getFoldingModel()??void 0,this._widgetState=this.findScrollWidgetState();const t=this._widgetState.startLineNumbers.length>0;this._stickyScrollVisibleContextKey.set(t),this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e)}async _resetState(){this._minRebuildFromLine=void 0,this._foldingModel=void 0,this._widgetState=vb.Empty,this._stickyScrollVisibleContextKey.set(!1),this._stickyScrollWidget.setState(void 0,void 0)}findScrollWidgetState(){if(!this._editor.hasModel())return vb.Empty;const e=this._editor.getModel(),t=Math.min(this._maxStickyLines,this._editor.getOption(L.stickyScroll).maxLineCount),i=this._editor.getScrollTop();let n=0;const o=[],r=[],a=this._editor.getVisibleRanges();if(a.length!==0){const c=new sE(a[0].startLineNumber,a[a.length-1].endLineNumber),d=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(c);for(const l of d){const u=l.startLineNumber,g=l.endLineNumber;if(e.isValidRange({startLineNumber:u,endLineNumber:g,startColumn:1,endColumn:1})&&g-u>0){const v=l.top,y=v+l.height,w=this._editor.getTopForLineNumber(u)-i,C=this._editor.getBottomForLineNumber(g)-i;if(v>w&&v<=C&&(o.push(u),r.push(g+1),y>C&&(n=C-y)),o.length===t)break}}}return this._endLineNumbers=r,new vb(o,r,n,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}};bd=Z$=f([p(1,mi),p(2,Ne),p(3,J),p(4,rs),p(5,Sd),p(6,me)],bd);const rE=H("inlineEdit.originalBackground",Je(dm,.2),h(1281,"Background color for the original text in inline edits."),!0),vge=H("inlineEdit.modifiedBackground",Je(q_,.3),h(1282,"Background color for the modified text in inline edits."),!0);H("inlineEdit.originalChangedLineBackground",Je(dm,.8),h(1283,"Background color for the changed lines in the original text of inline edits."),!0);const PVe=H("inlineEdit.originalChangedTextBackground",Je(dm,.8),h(1284,"Overlay color for the changed text in the original text of inline edits."),!0),LVe=H("inlineEdit.modifiedChangedLineBackground",{light:Je(OD,.7),dark:Je(OD,.7),hcDark:OD,hcLight:OD},h(1285,"Background color for the changed lines in the modified text of inline edits."),!0),MVe=H("inlineEdit.modifiedChangedTextBackground",Je(q_,.7),h(1286,"Overlay color for the changed text in the modified text of inline edits."),!0),NVe=H("inlineEdit.gutterIndicator.primaryForeground",iN,h(1287,"Foreground color for the primary inline edit gutter indicator.")),_b=H("inlineEdit.gutterIndicator.primaryBorder",Uq,h(1288,"Border color for the primary inline edit gutter indicator.")),_ge=H("inlineEdit.gutterIndicator.primaryBackground",{light:Je(_b,.5),dark:Je(_b,.4),hcDark:Je(_b,.4),hcLight:Je(_b,.5)},h(1289,"Background color for the primary inline edit gutter indicator.")),OVe=H("inlineEdit.gutterIndicator.secondaryForeground",lye,h(1290,"Foreground color for the secondary inline edit gutter indicator.")),bge=H("inlineEdit.gutterIndicator.secondaryBorder",hye,h(1291,"Border color for the secondary inline edit gutter indicator.")),yge=H("inlineEdit.gutterIndicator.secondaryBackground",bge,h(1292,"Background color for the secondary inline edit gutter indicator.")),FVe=H("inlineEdit.gutterIndicator.successfulForeground",iN,h(1293,"Foreground color for the successful inline edit gutter indicator.")),wge=H("inlineEdit.gutterIndicator.successfulBorder",Uq,h(1294,"Border color for the successful inline edit gutter indicator.")),Sge=H("inlineEdit.gutterIndicator.successfulBackground",wge,h(1295,"Background color for the successful inline edit gutter indicator.")),WVe=H("inlineEdit.gutterIndicator.background",{hcDark:Je("tab.inactiveBackground",.5),hcLight:Je("tab.inactiveBackground",.5),dark:Je("tab.inactiveBackground",.5),light:"#5f5f5f18"},h(1296,"Background color for the inline edit gutter indicator.")),JS=H("inlineEdit.originalBorder",{light:dm,dark:dm,hcDark:dm,hcLight:dm},h(1297,"Border color for the original text in inline edits.")),eC=H("inlineEdit.modifiedBorder",{light:vr(q_,.6),dark:q_,hcDark:q_,hcLight:q_},h(1298,"Border color for the modified text in inline edits.")),BVe=H("inlineEdit.tabWillAcceptModifiedBorder",{light:vr(eC,0),dark:vr(eC,0),hcDark:vr(eC,0),hcLight:vr(eC,0)},h(1299,"Modified border color for the inline edits widget when tab will accept it.")),VVe=H("inlineEdit.tabWillAcceptOriginalBorder",{light:vr(JS,0),dark:vr(JS,0),hcDark:vr(JS,0),hcLight:vr(JS,0)},h(1300,"Original border color for the inline edits widget over the original text when tab will accept it."));function Bx(s){return s.map(e=>e===so.Accept?BVe:eC)}function S1(s){return s.map(e=>e===so.Accept?VVe:JS)}function qa(s,e){let t;typeof s=="string"?t=Q0(s,e):t=s.map((n,o)=>Q0(n,e).read(o));const i=Q0(ts,e);return t.map((n,o)=>n.makeOpaque(i.read(o)))}function Q0(s,e){return uye({owner:{observeColor:s},equalsFn:(t,i)=>t.equals(i)},e.onDidColorThemeChange,()=>{const t=e.getColorTheme().getColor(s);if(!t)throw new ln(`Missing color: ${s}`);return t})}function Om(s,e,t){s.layoutInfo.read(t),s.value.read(t);const i=s.model.read(t);if(!i)return 0;let n=0;s.scrollTop.read(t);for(let r=e.startLineNumber;r<e.endLineNumberExclusive;r++){const a=i.getLineMaxColumn(r);let c=s.editor.getOffsetForColumn(r,a);if(c===-1){const d=s.editor.getOption(L.fontInfo).typicalHalfwidthCharacterWidth;c=a*d}n=Math.max(n,c)}const o=e.mapToLineArray(r=>i.getLineContent(r));return n<5&&o.some(r=>r.length>0)&&i.uri.scheme!=="file"&&console.error("unexpected width"),n}function HVe(s,e,t){return s.layoutInfo.read(t),s.value.read(t),s.model.read(t)?(s.scrollTop.read(t),s.editor.getOffsetForColumn(e.lineNumber,e.column)):0}function J4(s,e,t,i){const n=i.getModel();if(!n)return{prefixTrim:0,prefixLeftOffset:0};const o=s.map(u=>u.isSingleLine()?u.startColumn-1:0),r=e.mapToLineArray(u=>$7(n.getLineContent(u))),a=t.filter(u=>u!=="").map(u=>$7(u)),c=Math.min(...o,...r,...a);let d;if(n.getLineIndentColumn(e.startLineNumber)>=c+1)d=i.getOffsetForColumn(e.startLineNumber,c+1);else if(t.length>0)d=Cge(t[0].slice(0,c),i,n);else return{prefixTrim:0,prefixLeftOffset:0};return{prefixTrim:c,prefixLeftOffset:d}}function Cge(s,e,t){const i=e.getOption(L.fontInfo).typicalHalfwidthCharacterWidth,n=t.getOptions().tabSize*i,o=s.split("	").length-1;return(s.length-o)*i+o*n}function e5(s){const e=s.layoutInfoContentLeft,t=fe(n=>{const o=s.layoutInfoMinimap.read(n).minimapLeft!==0,r=s.layoutInfoWidth.read(n)-e.read(n);if(o){const a=s.layoutInfoMinimap.read(n).minimapWidth+s.layoutInfoVerticalScrollbarWidth.read(n);return r-a}return r}),i=fe(n=>s.layoutInfoHeight.read(n)+s.contentHeight.read(n));return fe(n=>ni.fromLeftTopWidthHeight(e.read(n),0,t.read(n),i.read(n)))}function UVe(s,e){const t=[];for(const i of s){const n=e.mapRange(i.modifiedRange);t.push(new rq(i.originalRange,n))}return t}function X0(...s){return s.filter(e=>typeof e=="string").join(" ")}function $Ve(s,e){return new P(e.lineNumber,e.column+s.start,e.lineNumber,e.column+s.endExclusive)}function GVe(s,e){const t=Ih(s),i=[],n=gye(e.mapToLineArray(o=>pye(t[o-1])),Oh);return e.forEach(o=>{i.push(new Cs($Ve(new bi(0,n),new _e(o,1)),""))}),new hc(i)}class J${constructor(){this._data=""}moveTo(e){return this._data+=`M ${e.x} ${e.y} `,this}lineTo(e){return this._data+=`L ${e.x} ${e.y} `,this}curveTo(e,t){return this._data+=`Q ${e.x} ${e.y} ${t.x} ${t.y} `,this}curveTo2(e,t,i){return this._data+=`C ${e.x} ${e.y} ${t.x} ${t.y} ${i.x} ${i.y} `,this}build(){return this._data}}function tf(s){const e=Av(void 0,(t,i)=>s.read(t)||i);return Jl({debugName:()=>`${s.debugName}.mapOutFalsy`},t=>{if(e.read(t),!!s.read(t))return e})}function td(s){return{left:fe(e=>s(e).left),top:fe(e=>s(e).top),width:fe(e=>s(e).right-s(e).left),height:fe(e=>s(e).bottom-s(e).top)}}let e3=class{constructor(e,t,i,n,o,r){this._model=e,this._close=t,this._editorObs=i,this._contextKeyService=n,this._keybindingService=o,this._commandService=r,this._inlineEditsShowCollapsed=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.showCollapsed)}toDisposableLiveElement(){return this._createHoverContent().toDisposableLiveElement()}_createHoverContent(){const e=oi("active",void 0),t=u=>({title:u.title,icon:u.icon,keybinding:typeof u.commandId=="string"?this._getKeybinding(u.commandArgs?void 0:u.commandId):fe(g=>typeof u.commandId=="string"?void 0:this._getKeybinding(u.commandArgs?void 0:u.commandId.read(g)).read(g)),isActive:e.map(g=>g===u.id),onHoverChange:g=>e.set(g?u.id:void 0,void 0),onAction:()=>(this._close(!0),this._commandService.executeCommand(typeof u.commandId=="string"?u.commandId:u.commandId.get(),...u.commandArgs??[]))}),i=zVe(this._model.displayName),n=C_(t({id:"gotoAndAccept",title:`${h(1274,"Go To")} / ${h(1275,"Accept")}`,icon:j.check,commandId:lx})),o=C_(t({id:"reject",title:h(1276,"Reject"),icon:j.close,commandId:vde})),r=this._model.extensionCommands.map((u,g)=>C_(t({id:u.id+"_"+g,title:u.title,icon:j.symbolEvent,commandId:u.id,commandArgs:u.arguments}))),a=this._inlineEditsShowCollapsed.map(u=>C_(t(u?{id:"showExpanded",title:h(1277,"Show Expanded"),icon:j.expandAll,commandId:QV}:{id:"showCollapsed",title:h(1278,"Show Collapsed"),icon:j.collapseAll,commandId:QV}))),c=C_(t({id:"settings",title:h(1279,"Settings"),icon:j.gear,commandId:"workbench.action.openSettings",commandArgs:["@tag:nextEditSuggestions"]})),d=this._model.action?[this._model.action]:[],l=d.length>0?KVe(d.map(u=>({id:u.id,label:u.title,enabled:!0,run:()=>this._commandService.executeCommand(u.id,...u.arguments??[]),class:void 0,tooltip:u.tooltip??u.title})),{hoverDelegate:fye}):void 0;return qVe([i,n,o,a,c,r.length?Hee():void 0,...r,l?Hee():void 0,l])}_getKeybinding(e){return e?On(this._contextKeyService.onDidChangeContext,()=>this._keybindingService.lookupKeybinding(e)):Fi(void 0)}};e3=f([p(3,me),p(4,Ve),p(5,qe)],e3);function qVe(s){return dt.div({class:"content",style:{margin:4,minWidth:150}},s)}function zVe(s){return dt.div({class:"header",style:{color:gt(mye),fontSize:"12px",fontWeight:"600",padding:"0 10px",lineHeight:26}},[s])}function C_(s){return fe(e=>dt.div({class:["monaco-menu-option",s.isActive?.map(t=>t&&"active")],onmouseenter:()=>s.onHoverChange?.(!0),onmouseleave:()=>s.onHoverChange?.(!1),onclick:s.onAction,onkeydown:t=>{t.key==="Enter"&&s.onAction?.()},tabIndex:0,style:{borderRadius:3}},[dt.elem("span",{style:{fontSize:16,display:"flex"}},[Te.isThemeIcon(s.icon)?ay(s.icon):s.icon.map(t=>ay(t))]),dt.elem("span",{},[s.title]),dt.div({style:{marginLeft:"auto"},ref:t=>{const i=e.store.add(new VM(t,Yu,{disableTitle:!0,...Ine,keybindingLabelShadow:void 0,keybindingLabelBackground:gt(vye),keybindingLabelBorder:"transparent",keybindingLabelBottomBorder:void 0}));e.store.add(ki(n=>{i.set(s.keybinding.read(n))}))}})]))}function KVe(s,e){return fe(t=>dt.div({class:["action-widget-action-bar"],style:{padding:"0 10px"}},[dt.div({ref:i=>{t.store.add(new Er(i,e)).push(s,{icon:!1,label:!0})}})]))}function Hee(){return dt.div({id:"inline-edit-gutter-indicator-menu-separator",class:"menu-separator",style:{color:gt(_ye),padding:"4px 0"}},dt.div({style:{borderBottom:`1px solid ${gt(tse)}`}}))}let t3=class extends F{get model(){const e=this._model.get();if(!e)throw new ln("Inline Edit Model not available");return e}constructor(e,t,i,n,o,r,a,c,d,l){super(),this._editorObs=e,this._originalRange=t,this._verticalOffset=i,this._model=n,this._isHoveringOverInlineEdit=o,this._focusIsInMenu=r,this._hoverService=a,this._instantiationService=c,this._accessibilityService=d,this._tabAction=fe(this,u=>{const g=this._model.read(u);return g?g.tabAction.read(u):so.Inactive}),this._hoverVisible=oi(this,!1),this.isHoverVisible=this._hoverVisible,this._isHoveredOverIcon=oi(this,!1),this._isHoveredOverIconDebounced=G7(this._isHoveredOverIcon,100),this.isHoveredOverIcon=this._isHoveredOverIconDebounced,this._isHoveredOverInlineEditDebounced=G7(this._isHoveringOverInlineEdit,100),this._gutterIndicatorStyles=this._tabAction.map((u,g)=>{switch(u){case so.Inactive:return{background:qa(yge,l).read(g).toString(),foreground:qa(OVe,l).read(g).toString(),border:qa(bge,l).read(g).toString()};case so.Jump:return{background:qa(_ge,l).read(g).toString(),foreground:qa(NVe,l).read(g).toString(),border:qa(_b,l).read(g).toString()};case so.Accept:return{background:qa(Sge,l).read(g).toString(),foreground:qa(FVe,l).read(g).toString(),border:qa(wge,l).read(g).toString()}}}),this._originalRangeObs=tf(this._originalRange),this._state=fe(u=>{const g=this._originalRangeObs.read(u);if(g)return{range:g,lineOffsetRange:this._editorObs.observeLineOffsetRange(g,this._store)}}),this._stickyScrollController=bd.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?On(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):Fi(0),this._lineNumberToRender=fe(this,u=>{if(this._verticalOffset.read(u)!==0)return"";const g=this._originalRange.read(u)?.startLineNumber,m=this._editorObs.getOption(L.lineNumbers).read(u);if(g===void 0||m.renderType===cs.Off)return"";if(m.renderType===cs.Interval){const v=this._editorObs.cursorPosition.read(u);return g%10===0||v&&v.lineNumber===g?g.toString():""}if(m.renderType===cs.Relative){const v=this._editorObs.cursorPosition.read(u);if(!v)return"";const y=Math.abs(g-v.lineNumber);return y===0?g.toString():y.toString()}return m.renderType===cs.Custom?m.renderFn?m.renderFn(g):"":g.toString()}),this._availableWidthForIcon=fe(this,u=>{const g=this._editorObs.editor.getModel(),m=this._editorObs.editor,v=this._editorObs.layoutInfo.read(u),y=v.decorationsLeft+v.decorationsWidth-v.glyphMarginLeft;if(!g||y<=0)return()=>0;if(v.lineNumbersLeft===0)return()=>y;const w=this._editorObs.getOption(L.lineNumbers).read(u);if(w.renderType===cs.Relative||w.renderType===cs.Off)return()=>y;const C=m.getOption(L.fontInfo).typicalHalfwidthCharacterWidth,T=v.lineNumbersLeft+v.lineNumbersWidth,A=(g.getLineCount()+1).toString().length,B=[];for(let z=1;z<=A;z++){const Q=10**(z-1),ie=m.getTopForLineNumber(Q),oe=z*C,xe=Math.min(y,Math.max(0,T-oe-v.glyphMarginLeft));B.push({firstLineNumberWithDigitCount:Q,topOfLineNumber:ie,usableWidthLeftOfLineNumber:xe})}return z=>{for(let Q=B.length-1;Q>=0;Q--)if(z>=B[Q].topOfLineNumber)return B[Q].usableWidthLeftOfLineNumber;throw new ln("Could not find avilable width for icon")}}),this._layout=fe(this,u=>{const g=this._state.read(u);if(!g)return;const m=this._editorObs.layoutInfo.read(u),v=this._editorObs.getOption(L.lineHeight).read(u),y=1,w=m.decorationsLeft+m.decorationsWidth-m.glyphMarginLeft-2*y,C=m.height-2*y,T=ni.fromLeftTopWidthHeight(y,y,w,C),k=T.withTop(this._stickyScrollHeight.read(u)),A=T.withTop(k.top+y),B=g.lineOffsetRange.read(u),z=ni.fromRanges(bi.fromTo(A.left,A.right),B),Q=v,ie=this._verticalOffset.read(u),oe=z.withHeight(Q).translateY(ie),xe=k.containsRect(oe),Se=this._tabAction.map(Bn=>Bn===so.Accept?j.keyboardTab:j.arrowRight),Ft=fe(Bn=>{if(this._isHoveredOverIconDebounced.read(Bn)||this._isHoveredOverInlineEditDebounced.read(Bn))return j.check;if(this._tabAction.read(Bn)===so.Accept)return j.keyboardTab;const Br=this._editorObs.cursorLineNumber.read(Bn)??0,Pl=g.range.read(Bn).startLineNumber;return Br<=Pl?j.keyboardTabAbove:j.keyboardTabBelow}),it=22,ti=16,ci=Bn=>{const Br=this._availableWidthForIcon.get()(Bn.bottom+this._editorObs.editor.getScrollTop())-y;return Math.max(Math.min(Br,it),ti)};if(xe){const Bn=oe;let Br;m.lineNumbersWidth===0?Br=Math.min(Math.max(m.lineNumbersLeft-T.left,0),Bn.width-it):Br=Math.max(m.lineNumbersLeft+m.lineNumbersWidth-T.left,0);const Pl=Bn.withWidth(Br),Rf=Math.max(Math.min(m.decorationsWidth,it),ti),Ad=Bn.withWidth(Rf).translateX(Br);return{gutterEditArea:z,icon:Ft,iconDirection:"right",iconRect:Ad,pillRect:Bn,lineNumberRect:Pl}}const Xn=T.intersect(z);if(Xn&&Xn.height>=Q){const Bn=oe.moveToBeContainedIn(A).moveToBeContainedIn(Xn),Br=Bn.withWidth(ci(Bn));return{gutterEditArea:z,icon:Ft,iconDirection:"right",iconRect:Br,pillRect:Br}}const Fr=oe.moveToBeContainedIn(T),Wr=Fr.withWidth(ci(Fr)),Cc=Wr,Ec=Wr.top<oe.top?"top":"bottom";return{gutterEditArea:z,icon:Se,iconDirection:Ec,iconRect:Cc,pillRect:Wr}}),this._iconRef=dt.ref(),this.isVisible=this._layout.map(u=>!!u),this._indicator=dt.div({class:"inline-edits-view-gutter-indicator",onclick:()=>{const g=this._layout.get()?.icon.get()===j.check;this._editorObs.editor.focus(),g?this.model.accept():this.model.jump()},tabIndex:0,style:{position:"absolute",overflow:"visible"}},tf(this._layout).map(u=>u?[dt.div({style:{position:"absolute",background:gt(WVe),borderRadius:"4px",...td(g=>u.read(g).gutterEditArea)}}),dt.div({class:"icon",ref:this._iconRef,onmouseenter:()=>{this._showHover()},style:{cursor:"pointer",zIndex:"20",position:"absolute",backgroundColor:this._gutterIndicatorStyles.map(g=>g.background),"--vscodeIconForeground":this._gutterIndicatorStyles.map(g=>g.foreground),border:this._gutterIndicatorStyles.map(g=>`1px solid ${g.border}`),boxSizing:"border-box",borderRadius:"4px",display:"flex",justifyContent:"flex-end",transition:"background-color 0.2s ease-in-out, width 0.2s ease-in-out",...td(g=>u.read(g).pillRect)}},[dt.div({className:"line-number",style:{lineHeight:u.map(g=>g.lineNumberRect?g.lineNumberRect.height:0),display:u.map(g=>g.lineNumberRect?"flex":"none"),alignItems:"center",justifyContent:"flex-end",width:u.map(g=>g.lineNumberRect?g.lineNumberRect.width:0),height:"100%",color:this._gutterIndicatorStyles.map(g=>g.foreground)}},this._lineNumberToRender),dt.div({style:{rotate:u.map(g=>`${jVe(g.iconDirection)}deg`),transition:"rotate 0.2s ease-in-out",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",marginRight:u.map(g=>g.pillRect.width-g.iconRect.width-(g.lineNumberRect?.width??0)),width:u.map(g=>g.iconRect.width)}},[u.map((g,m)=>ay(g.icon.read(m)))])])]:[])).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._indicator.element,position:Fi(null),allowEditorOverflow:!1,minContentWidthInPx:Fi(0)})),this._register(this._editorObs.editor.onMouseMove(u=>{if(this._state.get()===void 0)return;const v=this._iconRef.element.getBoundingClientRect(),y=ni.fromLeftTopWidthHeight(v.left,v.top,v.width,v.height),w=new Su(u.event.posx,u.event.posy);this._isHoveredOverIcon.set(y.containsPoint(w),void 0)})),this._register(this._editorObs.editor.onDidScrollChange(()=>{this._isHoveredOverIcon.set(!1,void 0)})),this._register(fC(this._isHoveredOverInlineEditDebounced,u=>{u&&this.triggerAnimation()})),this._register(ki(u=>{this._indicator.readEffect(u),this._indicator.element&&this._editorObs.editor.applyFontInfo(this._indicator.element)}))}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{outline:`2px solid ${this._gutterIndicatorStyles.map(t=>t.border).get()}`,outlineOffset:"-1px",offset:0},{outline:"2px solid transparent",outlineOffset:"10px",offset:1}],{duration:500}).finished}_showHover(){if(this._hoverVisible.get())return;const e=new U,t=e.add(this._instantiationService.createInstance(e3,this.model,o=>{o&&this._editorObs.editor.focus(),n?.dispose()},this._editorObs).toDisposableLiveElement()),i=e.add(Po(t.element));e.add(i.onDidBlur(()=>this._focusIsInMenu.set(!1,void 0))),e.add(i.onDidFocus(()=>this._focusIsInMenu.set(!0,void 0))),e.add(Ee(()=>this._focusIsInMenu.set(!1,void 0)));const n=this._hoverService.showInstantHover({target:this._iconRef.element,content:t.element});n?(this._hoverVisible.set(!0,void 0),e.add(this._editorObs.editor.onDidScrollChange(()=>n.dispose())),e.add(n.onDispose(()=>{this._hoverVisible.set(!1,void 0),e.dispose()}))):e.dispose()}};t3=f([p(6,wi),p(7,J),p(8,Tr),p(9,ft)],t3);function jVe(s){switch(s){case"top":return 90;case"bottom":return-90;case"right":return 0}}var ua;(function(s){s.FirstTime="firstTime",s.SecondTime="secondTime",s.Active="active"})(ua||(ua={}));let i3=class extends F{constructor(e,t,i,n,o,r){super(),this._host=e,this._model=t,this._indicator=i,this._collapsedView=n,this._storageService=o,this._configurationService=r,this._disposables=this._register(new kt),this._setupDone=oi({name:"setupDone"},!1),this._activeCompletionId=fe(a=>{const c=this._model.read(a);if(!c||!this._setupDone.read(a))return;const d=this._indicator.read(a);if(!(!d||!d.isVisible.read(a)))return c.inlineEdit.inlineCompletion.identity.id}),this._register(this._initializeDebugSetting()),this._disposables.value=this.setupNewUserExperience(),this._setupDone.set(!0,void 0)}setupNewUserExperience(){if(this.getNewUserType()===ua.Active)return;const e=new U;let t=!1,i=!1,n=0,o=0;return e.add(bye(this._activeCompletionId,async(r,a,c,d)=>{if(r===void 0)return;let l=this.getNewUserType();switch(l){case ua.FirstTime:{(n++>=5||t)&&(l=ua.SecondTime,this.setNewUserType(l));break}case ua.SecondTime:{o++>=3&&i&&(l=ua.Active,this.setNewUserType(l));break}}switch(l){case ua.FirstTime:{for(let u=0;u<3&&!d.isCancellationRequested;u++)await this._indicator.get()?.triggerAnimation(),await Ia(500);break}case ua.SecondTime:{this._indicator.get()?.triggerAnimation();break}}})),e.add(ki(r=>{this._collapsedView.isVisible.read(r)&&this.getNewUserType()!==ua.Active&&this._collapsedView.triggerAnimation()})),e.add(Da((r,a)=>{const c=this._indicator.read(r);c&&a.add(fC(c.isHoveredOverIcon,async d=>{d&&(t=!0)}))})),e.add(Da((r,a)=>{const c=this._host.read(r);c&&a.add(c.onDidAccept(()=>{i=!0}))})),e}getNewUserType(){return this._storageService.get("inlineEditsGutterIndicatorUserKind",he.APPLICATION,ua.FirstTime)}setNewUserType(e){switch(e){case ua.FirstTime:throw new ln("UserKind should not be set to first time");case ua.SecondTime:break;case ua.Active:this._disposables.clear();break}this._storageService.store("inlineEditsGutterIndicatorUserKind",e,he.APPLICATION,pt.USER)}_initializeDebugSetting(){const e="editor.inlineSuggest.edits.resetNewUserExperience";return this._configurationService.getValue(e)&&this._storageService.remove("inlineEditsGutterIndicatorUserKind",he.APPLICATION),this._configurationService.onDidChangeConfiguration(i=>{i.affectsConfiguration(e)&&this._configurationService.getValue(e)&&(this._storageService.remove("inlineEditsGutterIndicatorUserKind",he.APPLICATION),this._disposables.value=this.setupNewUserExperience())})}};i3=f([p(4,tt),p(5,ne)],i3);let n3=class extends F{constructor(e,t,i){super(),this._editor=e,this._edit=t,this._accessibilityService=i,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._iconRef=dt.ref(),this.isHovered=Fi(!1),this._editorObs=xs(this._editor);const o=this._edit.map(d=>d?.edit.replacements[0]??null).map(d=>d?Tu(d,this._editor.getModel()).range.getStartPosition():null),r=this._editorObs.observePosition(o,this._store),a=fe(d=>{const l=r.read(d);if(!l)return null;const u=this._editorObs.layoutInfoContentLeft.read(d),g=this._editorObs.scrollLeft.read(d);return new Su(u+l.x-g,l.y)}),c=dt.div({class:"inline-edits-collapsed-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:"block"}},[[this.getCollapsedIndicator(a)]]).keepUpdated(this._store).element;this._register(this._editorObs.createOverlayWidget({domNode:c,position:Fi(null),allowEditorOverflow:!1,minContentWidthInPx:Fi(0)})),this.isVisible=this._edit.map((d,l)=>!!d&&a.read(l)!==null)}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{offset:0,transform:"translateY(-3px)"},{offset:.2,transform:"translateY(1px)"},{offset:.36,transform:"translateY(-1px)"},{offset:.52,transform:"translateY(1px)"},{offset:.68,transform:"translateY(-1px)"},{offset:.84,transform:"translateY(1px)"},{offset:1,transform:"translateY(0px)"}],{duration:2e3}).finished}getCollapsedIndicator(e){const t=this._editorObs.layoutInfoContentLeft,i=e.map((o,r)=>o?o.deltaX(-t.read(r)):null),n=this.createIconPath(i);return dt.svg({class:"collapsedView",ref:this._iconRef,style:{position:"absolute",...td(o=>e5(this._editorObs).read(o)),overflow:"hidden",pointerEvents:"none"}},[dt.svgElem("path",{class:"collapsedViewPath",d:n,fill:gt(_b)})])}createIconPath(e){return e.map(o=>{if(!o)return new J$().build();const r=o.deltaX(-6/2).deltaY(-1),a=r.deltaX(6),c=r.deltaY(1),d=a.deltaY(1),l=c.deltaX(6/2).deltaY(3);return new J$().moveTo(r).lineTo(a).lineTo(d).lineTo(l).lineTo(c).lineTo(r).build()})}};n3=f([p(2,Tr)],n3);let s3=class extends F{constructor(e,t,i,n,o){super(),this._editor=e,this._languageService=o,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._isHovered=oi(this,!1),this.isHovered=this._isHovered,this._viewRef=dt.ref(),this._editorObs=xs(this._editor);const r=i.map((l,u)=>{let g;switch(l){case so.Inactive:g=yge;break;case so.Jump:g=_ge;break;case so.Accept:g=Sge;break}return{border:qa(g,n).read(u).toString(),background:gt(ts)}}),c=t.map(l=>l?this.getState(l):void 0).map(l=>l?this.getRendering(l,r):void 0),d=dt.div({class:"inline-edits-custom-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:"block"}},[c]).keepUpdated(this._store);this._register(this._editorObs.createOverlayWidget({domNode:d.element,position:Fi(null),allowEditorOverflow:!1,minContentWidthInPx:Fi(0)})),this._register(ki(l=>{if(!c.read(l)){this._isHovered.set(!1,void 0);return}this._isHovered.set(d.isHovered.read(l),void 0)}))}getState(e){const t=fe(d=>{const l=e.range.startLineNumber,u=e.range.endLineNumber,g=e.range.startColumn,m=e.range.endColumn,v=this._editor.getModel()?.getLineCount()??0,y=Om(this._editorObs,new Go(l,l+1),d),w=l+1<=v?Om(this._editorObs,new Go(l+1,l+2),d):void 0,C=l-1>=1?Om(this._editorObs,new Go(l-1,l),d):void 0,T=this._editor.getOffsetForColumn(l,g),k=this._editor.getOffsetForColumn(u,m);return{lineWidth:y,lineWidthBelow:w,lineWidthAbove:C,startContentLeftOffset:T,endContentLeftOffset:k}}),i=14,n=0,o=4,r=4,a=2;return{rect:fe(d=>{const l=this._editorObs.getOption(L.fontInfo).read(d).typicalHalfwidthCharacterWidth,u=e.range.startLineNumber,g=e.range.endLineNumber,{lineWidth:m,lineWidthBelow:v,lineWidthAbove:y,startContentLeftOffset:w,endContentLeftOffset:C}=t.read(d),T=this._editorObs.layoutInfoContentLeft.read(d),k=this._editorObs.getOption(L.lineHeight).read(d),A=this._editorObs.scrollTop.read(d),B=this._editorObs.scrollLeft.read(d);let z;u===g&&C+5*l>=m?z="end":v!==void 0&&v+i-r-o<w?z="below":y!==void 0&&y+i-r-o<w?z="above":z="end";let Q,ie,oe=0,xe=0;switch(z){case"end":{Q=this._editorObs.editor.getTopForLineNumber(u),ie=m,oe=o+i;break}case"below":{Q=this._editorObs.editor.getTopForLineNumber(u+1),ie=w,oe=o+r,xe=n+a;break}case"above":{Q=this._editorObs.editor.getTopForLineNumber(u-1),ie=w,oe=o+r,xe=-0+a;break}}return ni.fromLeftTopWidthHeight(T+ie-B,Q-A,l*e.label.length,k).withMargin(n,o).translateX(oe).translateY(xe)}),label:e.label}}getRendering(e,t){const i=document.createElement("div"),n=this._editor.getModel().tokenization.tokenizeLinesAt(1,[e.label])?.[0];let o;n?o=sN.fromLineTokens(n).toLineTokens(e.label,this._languageService.languageIdCodec):o=mw.createEmpty(e.label,this._languageService.languageIdCodec);const r=lN(new uN([o]),hN.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],i,!0);i.style.width=`${r.minWidthInPx}px`;const a=e.rect.map(c=>c.withMargin(0,4));return dt.div({class:"collapsedView",ref:this._viewRef,style:{position:"absolute",...td(c=>a.read(c)),overflow:"hidden",boxSizing:"border-box",cursor:"pointer",border:t.map(c=>`1px solid ${c.border}`),borderRadius:"4px",backgroundColor:t.map(c=>c.background),display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap"},onclick:c=>{this._onDidClick.fire(new us(bt(c),c))}},[i])}};s3=f([p(3,ft),p(4,fi)],s3);const YVe=0,QVe=0,Z0=1,J0=1,eF=4;class XVe extends F{constructor(e,t,i,n){super(),this._editor=e,this._edit=t,this._uiState=i,this._tabAction=n,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._display=fe(this,a=>this._uiState.read(a)?"block":"none"),this._editorMaxContentWidthInRange=fe(this,a=>{const c=this._originalDisplayRange.read(a);return c?(this._editorObs.versionId.read(a),Av(this,(d,l)=>{const u=Om(this._editorObs,c,d);return Math.max(u,l??0)})):Fi(0)}).map((a,c)=>a.read(c)),this._maxPrefixTrim=fe(a=>{const c=this._uiState.read(a);return c?J4(c.deletions,c.originalRange,[],this._editor):{prefixTrim:0,prefixLeftOffset:0}}),this._editorLayoutInfo=fe(this,a=>{const c=this._edit.read(a);if(!c||!this._uiState.read(a))return null;const l=this._editorObs.layoutInfo.read(a),u=this._editorObs.scrollLeft.read(a),g=this._editorObs.getOption(L.fontInfo).map(k=>k.typicalHalfwidthCharacterWidth).read(a),m=l.contentLeft+Math.max(this._editorMaxContentWidthInRange.read(a),g)-u,v=c.originalLineRange,y=this._originalVerticalStartPosition.read(a)??this._editor.getTopForLineNumber(v.startLineNumber)-this._editorObs.scrollTop.read(a),w=this._originalVerticalEndPosition.read(a)??this._editor.getTopForLineNumber(v.endLineNumberExclusive)-this._editorObs.scrollTop.read(a),C=l.contentLeft+this._maxPrefixTrim.read(a).prefixLeftOffset-u;return m<=C?null:{codeRect:ni.fromLeftTopRightBottom(C,y,m,w).withMargin(QVe,YVe),contentLeft:l.contentLeft}}).recomputeInitiallyAndOnChange(this._store),this._originalOverlay=dt.div({style:{pointerEvents:"none"}},fe(a=>{const c=tf(this._editorLayoutInfo).read(a);if(!c)return;const d=c.map(g=>ni.fromLeftTopRightBottom(g.contentLeft-eF-Z0,g.codeRect.top,g.contentLeft,g.codeRect.bottom)),l=fe(g=>{const m=c.read(g).codeRect,v=d.read(g);return m.intersectHorizontal(new bi(v.left,Number.MAX_SAFE_INTEGER))}),u=l.map(g=>g.withMargin(J0,J0));return[dt.div({class:"originalSeparatorDeletion",style:{...u.read(a).toStyles(),borderRadius:`${eF}px`,border:`${Z0+J0}px solid ${gt(ts)}`,boxSizing:"border-box"}}),dt.div({class:"originalOverlayDeletion",style:{...l.read(a).toStyles(),borderRadius:`${eF}px`,border:S1(this._tabAction).map(g=>`${Z0}px solid ${gt(g)}`),boxSizing:"border-box",backgroundColor:gt(rE)}}),dt.div({class:"originalOverlayHiderDeletion",style:{...d.read(a).toStyles(),backgroundColor:gt(ts)}})]})).keepUpdated(this._store),this._nonOverflowView=dt.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[[this._originalOverlay]]).keepUpdated(this._store),this.isHovered=Fi(!1),this._editorObs=xs(this._editor);const o=fe(this,a=>{const c=this._edit.read(a);return c?new _e(c.originalLineRange.startLineNumber,1):null}),r=fe(this,a=>{const c=this._edit.read(a);return c?new _e(c.originalLineRange.endLineNumberExclusive,1):null});this._originalDisplayRange=this._uiState.map(a=>a?.originalRange),this._originalVerticalStartPosition=this._editorObs.observePosition(o,this._store).map(a=>a?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(r,this._store).map(a=>a?.y),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:Fi(null),allowEditorOverflow:!1,minContentWidthInPx:fe(a=>{const c=this._editorLayoutInfo.read(a);return c===null?0:c.codeRect.width})}))}}const DS=1,tF=1,iF=4;let o3=class extends F{constructor(e,t,i,n,o){super(),this._editor=e,this._input=t,this._tabAction=i,this._languageService=o,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._state=fe(this,r=>{const a=this._input.read(r);if(!a)return;const c=this._editor.getModel(),d=c.getEOL();if(a.startColumn===1&&a.lineNumber>1&&c.getLineLength(a.lineNumber)!==0&&a.text.endsWith(d)&&!a.text.startsWith(d)){const l=c.getLineLength(a.lineNumber-1)+1;return{lineNumber:a.lineNumber-1,column:l,text:d+a.text.slice(0,-d.length)}}return{lineNumber:a.lineNumber,column:a.startColumn,text:a.text}}),this._trimVertically=fe(this,r=>{const a=this._state.read(r)?.text;if(!a||a.trim()==="")return{topOffset:0,bottomOffset:0,linesTop:0,linesBottom:0};const c=this._editor.getOption(L.lineHeight),d=this._editor.getModel().getEOL();let l=0,u=0,g=0;for(;g<a.length&&a.startsWith(d,g);g+=d.length)l+=1;for(let m=a.length;m>g&&a.endsWith(d,m);m-=d.length)u+=1;return{topOffset:l*c,bottomOffset:u*c,linesTop:l,linesBottom:u}}),this._maxPrefixTrim=fe(r=>{const a=this._state.read(r);if(!a)return{prefixLeftOffset:0,prefixTrim:0};const c=this._editor.getModel(),d=c.getEOL(),l=this._trimVertically.read(r),u=a.text.split(d),g=u.slice(l.linesTop,u.length-l.linesBottom);l.linesTop===0&&(g[0]=c.getLineContent(a.lineNumber)+g[0]);const m=new Go(a.lineNumber,a.lineNumber+(l.linesTop>0?0:1));return J4([],m,g,this._editor)}),this._ghostText=fe(r=>{const a=this._state.read(r),c=this._maxPrefixTrim.read(r);if(!a)return;const l=this._editor.getModel().getEOL(),g=a.text.split(l).map((m,v)=>new Pk(new P(v+1,v===0?1:c.prefixTrim+1,v+1,m.length+1),"modified-background",Rb.Regular));return new Nx(a.lineNumber,[new IL(a.column,a.text,!1,g)])}),this._display=fe(this,r=>this._state.read(r)?"block":"none"),this._editorMaxContentWidthInRange=fe(this,r=>{const a=this._state.read(r);if(!a)return 0;this._editorObs.versionId.read(r);const c=this._editor.getModel(),d=c.getEOL(),l=a.text.startsWith(d)?"":c.getValueInRange(new P(a.lineNumber,1,a.lineNumber,a.column)),u=c.getValueInRange(new P(a.lineNumber,a.column,a.lineNumber,c.getLineLength(a.lineNumber)+1)),m=(l+a.text+u).split(d),v=hN.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),y=m.map(w=>{const C=c.tokenization.tokenizeLinesAt(a.lineNumber,[w])?.[0];let T;return C?T=sN.fromLineTokens(C).toLineTokens(w,this._languageService.languageIdCodec):T=mw.createEmpty(w,this._languageService.languageIdCodec),lN(new uN([T]),v,[],Y("div"),!0).minWidthInPx});return Math.max(...y)}),this.startLineOffset=this._trimVertically.map(r=>r.topOffset),this.originalLines=this._state.map(r=>r?new Go(r.lineNumber,Math.min(r.lineNumber+2,this._editor.getModel().getLineCount()+1)):void 0),this._overlayLayout=fe(this,r=>{this._ghostText.read(r);const a=this._state.read(r);if(!a)return null;this._editorObs.observePosition(oi(this,new _e(a.lineNumber,a.column)),r.store).read(r);const c=this._editorObs.layoutInfo.read(r),d=this._editorObs.scrollLeft.read(r),l=this._editorObs.layoutInfoVerticalScrollbarWidth.read(r),u=c.contentLeft+this._editorMaxContentWidthInRange.read(r)-d,g=this._maxPrefixTrim.read(r).prefixLeftOffset??0,m=c.contentLeft+g-d;if(u<=m)return null;const{topOffset:v,bottomOffset:y}=this._trimVertically.read(r),w=this._editorObs.scrollTop.read(r),C=this._ghostTextView.height.read(r)-v-y,T=this._editor.getTopForLineNumber(a.lineNumber)-w+v,k=T+C,A=new ni(m,T,u,k);return{overlay:A,startsAtContentLeft:g===0,contentLeft:c.contentLeft,minContentWidthRequired:g+A.width+l}}).recomputeInitiallyAndOnChange(this._store),this._modifiedOverlay=dt.div({style:{pointerEvents:"none"}},fe(r=>{const a=tf(this._overlayLayout).read(r);if(!a)return;const c=a.map(u=>ni.fromLeftTopRightBottom(u.contentLeft-iF-DS,u.overlay.top,u.contentLeft,u.overlay.bottom)).read(r),d=a.map(u=>u.overlay.withMargin(0,DS,0,u.startsAtContentLeft?0:DS).intersectHorizontal(new bi(c.left,Number.MAX_SAFE_INTEGER))),l=d.map(u=>u.withMargin(tF,tF));return[dt.div({class:"originalUnderlayInsertion",style:{...l.read(r).toStyles(),borderRadius:iF,border:`${DS+tF}px solid ${gt(ts)}`,boxSizing:"border-box"}}),dt.div({class:"originalOverlayInsertion",style:{...d.read(r).toStyles(),borderRadius:iF,border:Bx(this._tabAction).map(u=>`${DS}px solid ${gt(u)}`),boxSizing:"border-box",backgroundColor:gt(vge)}}),dt.div({class:"originalOverlayHiderInsertion",style:{...c.toStyles(),backgroundColor:gt(ts)}})]})).keepUpdated(this._store),this._view=dt.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[[this._modifiedOverlay]]).keepUpdated(this._store),this._editorObs=xs(this._editor),this._ghostTextView=this._register(n.createInstance(Wx,this._editor,{ghostText:this._ghostText,minReservedLineCount:Fi(0),targetTextModel:this._editorObs.model.map(r=>r??void 0),warning:Fi(void 0)},oi(this,{syntaxHighlightingEnabled:!0,extraClasses:["inline-edit"]}),!0,!0)),this.isHovered=this._ghostTextView.isHovered,this._register(this._ghostTextView.onDidClick(r=>{this._onDidClick.fire(r)})),this._register(this._editorObs.createOverlayWidget({domNode:this._view.element,position:Fi(null),allowEditorOverflow:!1,minContentWidthInPx:fe(r=>{const a=this._overlayLayout.read(r);return a===null?0:a.minContentWidthRequired})}))}};o3=f([p(3,J),p(4,fi)],o3);let r3=class extends F{constructor(e,t,i,n,o){super(),this._editor=e,this._edit=t,this._tabAction=i,this._languageService=n,this._themeService=o,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._originalBubblesDecorationCollection=this._editor.editor.createDecorationsCollection(),this._originalBubblesDecorationOptions={description:"inlineCompletions-original-bubble",className:"inlineCompletions-original-bubble",stickiness:Di.NeverGrowsWhenTypingAtEdges},this._maxPrefixTrim=this._edit.map(r=>r?J4(r.replacements.flatMap(a=>[a.originalRange,a.modifiedRange]),r.originalRange,r.modifiedLines,this._editor.editor):void 0),this._modifiedLineElements=fe(r=>{const a=[];let c=0;const d=this._maxPrefixTrim.read(r),l=this._edit.read(r);if(!l||!d)return;const u=d.prefixTrim,g=Uee(l.replacements.map(y=>y.modifiedRange)).map(y=>new P(y.startLineNumber,y.startColumn-u,y.endLineNumber,y.endColumn-u)),m=this._editor.model.get(),v=l.modifiedRange.startLineNumber;for(let y=0;y<l.modifiedRange.length;y++){const w=document.createElement("div"),C=v+y,T=l.modifiedLines[y].slice(u),k=m.tokenization.tokenizeLinesAt(C,[T])?.[0];let A;k?A=sN.fromLineTokens(k).toLineTokens(T,this._languageService.languageIdCodec):A=mw.createEmpty(T,this._languageService.languageIdCodec);const B=[];for(const Q of g.filter(ie=>ie.startLineNumber===C)){const ie=Math.min(Q.endColumn,T.length+1);B.push(new Pk(new P(1,Q.startColumn,1,ie),"inlineCompletions-modified-bubble",Rb.Regular)),B.push(new Pk(new P(1,Q.startColumn,1,Q.startColumn+1),"start",Rb.Regular)),B.push(new Pk(new P(1,ie-1,1,ie),"end",Rb.Regular))}const z=lN(new uN([A]),hN.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),B,w,!0);this._editor.getOption(L.fontInfo).read(r),c=Math.max(c,z.minWidthInPx),a.push(w)}return{lines:a,requiredWidth:c}}),this._layout=fe(this,r=>{const a=this._modifiedLineElements.read(r),c=this._maxPrefixTrim.read(r),d=this._edit.read(r);if(!a||!c||!d)return;const{prefixLeftOffset:l}=c,{requiredWidth:u}=a,g=this._editor.getOption(L.lineHeight).read(r),m=this._editor.layoutInfoContentLeft.read(r),v=this._editor.layoutInfoVerticalScrollbarWidth.read(r),y=this._editor.scrollLeft.read(r),w=this._editor.scrollTop.read(r),C=m-y,T=this._editor.editor.getModel(),k=d.originalRange.mapToLineArray(ti=>this._editor.editor.getOffsetForColumn(ti,T.getLineMaxColumn(ti))-l),A=Math.max(...k,u),B=d.originalRange.startLineNumber,z=d.originalRange.endLineNumberExclusive-1,Q=this._editor.editor.getTopForLineNumber(B)-w,ie=this._editor.editor.getBottomForLineNumber(z)-w,oe=ni.fromLeftTopWidthHeight(C+l,Q,A,ie-Q),xe=ni.fromLeftTopWidthHeight(oe.left,oe.bottom,oe.width,d.modifiedRange.length*g),Se=ni.hull([oe,xe]),Ft=Se.intersectVertical(new bi(oe.bottom,Number.MAX_SAFE_INTEGER)),it=new ni(Ft.left,Ft.top,Ft.right,Ft.bottom);return{originalLinesOverlay:oe,modifiedLinesOverlay:xe,background:Se,lowerBackground:Ft,lowerText:it,minContentWidthRequired:l+A+v}}),this._viewZoneInfo=fe(r=>{if(!this._editor.getOption(L.inlineSuggest).map(g=>g.edits.allowCodeShifting==="always").read(r))return;const c=this._layout.read(r),d=this._edit.read(r);if(!c||!d)return;const l=c.lowerBackground.height,u=d.originalRange.endLineNumberExclusive;return{height:l,lineNumber:u}}),this._div=dt.div({class:"line-replacement"},[fe(r=>{const a=tf(this._layout).read(r),c=this._modifiedLineElements.read(r);if(!a||!c)return[];const d=a.read(r),l=this._editor.layoutInfoContentLeft.read(r),u=this._editor.getOption(L.lineHeight).read(r);c.lines.forEach(v=>{v.style.width=`${d.lowerText.width}px`,v.style.height=`${u}px`,v.style.position="relative"});const g=Bx(this._tabAction).read(r),m=S1(this._tabAction).read(r);return[dt.div({style:{position:"absolute",...td(v=>e5(this._editor).read(v)),overflow:"hidden",pointerEvents:"none"}},[dt.div({class:"originalOverlayLineReplacement",style:{position:"absolute",...td(v=>a.read(v).background.translateX(-l)),borderRadius:"4px",border:qa(m,this._themeService).map(v=>`1px solid ${v.toString()}`),pointerEvents:"none",boxSizing:"border-box",background:gt(rE)}}),dt.div({class:"modifiedOverlayLineReplacement",style:{position:"absolute",...td(v=>a.read(v).lowerBackground.translateX(-l)),borderRadius:"0 0 4px 4px",background:gt(ts),boxShadow:`${gt(sq)} 0 6px 6px -6px`,border:`1px solid ${gt(g)}`,boxSizing:"border-box",overflow:"hidden",cursor:"pointer",pointerEvents:"auto"},onmousedown:v=>{v.preventDefault()},onclick:v=>this._onDidClick.fire(new us(bt(v),v))},[dt.div({style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:gt(LVe)}})]),dt.div({class:"modifiedLinesLineReplacement",style:{position:"absolute",boxSizing:"border-box",...td(v=>a.read(v).lowerText.translateX(-l)),fontFamily:this._editor.getOption(L.fontFamily),fontSize:this._editor.getOption(L.fontSize),fontWeight:this._editor.getOption(L.fontWeight),pointerEvents:"none",whiteSpace:"nowrap",borderRadius:"0 0 4px 4px",overflow:"hidden"}},[...c.lines])])]})]).keepUpdated(this._store),this.isHovered=this._editor.isTargetHovered(r=>this._isMouseOverWidget(r),this._store),this._previousViewZoneInfo=void 0,this._register(Ee(()=>this._originalBubblesDecorationCollection.clear())),this._register(Ee(()=>this._editor.editor.changeViewZones(r=>this.removePreviousViewZone(r)))),this._register(yye(this._viewZoneInfo,({lastValue:r,newValue:a})=>{r===a||r?.height===a?.height&&r?.lineNumber===a?.lineNumber||this._editor.editor.changeViewZones(c=>{this.removePreviousViewZone(c),a&&this.addViewZone(a,c)})})),this._register(ki(r=>{const a=this._edit.read(r),c=[];a&&c.push(...Uee(a.replacements.map(d=>d.originalRange))),this._originalBubblesDecorationCollection.set(c.map(d=>({range:d,options:this._originalBubblesDecorationOptions})))})),this._register(this._editor.createOverlayWidget({domNode:this._div.element,minContentWidthInPx:fe(r=>this._layout.read(r)?.minContentWidthRequired??0),position:Fi({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}_isMouseOverWidget(e){const t=this._layout.get();return!t||!(e.event instanceof FSe)?!1:t.lowerBackground.containsPoint(new Su(e.event.relativePos.x,e.event.relativePos.y))}removePreviousViewZone(e){if(!this._previousViewZoneInfo)return;e.removeZone(this._previousViewZoneInfo.id);const t=this._editor.cursorLineNumber.get();t!==null&&t>=this._previousViewZoneInfo.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()-this._previousViewZoneInfo.height),this._previousViewZoneInfo=void 0}addViewZone(e,t){const i=t.addZone({afterLineNumber:e.lineNumber-1,heightInPx:e.height,domNode:Y("div")});this._previousViewZoneInfo={height:e.height,lineNumber:e.lineNumber,id:i};const n=this._editor.cursorLineNumber.get();n!==null&&n>=e.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()+e.height)}};r3=f([p(3,fi),p(4,ft)],r3);function Uee(s){const e=[];for(;s.length;){let t=s.shift();t.startLineNumber!==t.endLineNumber&&(s.push(new P(t.startLineNumber+1,1,t.endLineNumber,t.endColumn)),t=new P(t.startLineNumber,t.startColumn,t.startLineNumber,Number.MAX_SAFE_INTEGER)),e.push(t)}return e}const kS=0,sk=0,Rd=1,Wg=1,su=4,nF=20,$ee=12;let TL=class extends F{static fitsInsideViewport(e,t,i,n){const o=xs(e),r=o.layoutInfoWidth.read(n),a=o.layoutInfoContentLeft.read(n),c=e.getLayoutInfo().verticalScrollbarWidth,d=o.layoutInfoMinimap.read(n).minimapLeft!==0?o.layoutInfoMinimap.read(n).minimapWidth:0,l=Om(o,i.displayRange,void 0),u=i.lineEdit.newLines.reduce((v,y)=>Math.max(v,Cge(y,e,t)),0),g=nF,m=$ee+2*Rd;return l+u+g+m<r-a-c-d}constructor(e,t,i,n,o,r,a){super(),this._editor=e,this._edit=t,this._previewTextModel=i,this._uiState=n,this._tabAction=o,this._instantiationService=r,this._themeService=a,this._editorObs=xs(this._editor),this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._display=fe(this,c=>this._uiState.read(c)?"block":"none"),this.previewRef=dt.ref(),this._editorContainer=dt.div({class:["editorContainer"],style:{position:"absolute",overflow:"hidden",cursor:"pointer"},onmousedown:c=>{c.preventDefault()},onclick:c=>{this._onDidClick.fire(new us(bt(c),c))}},[dt.div({class:"preview",style:{pointerEvents:"none"},ref:this.previewRef})]).keepUpdated(this._store),this.isHovered=this._editorContainer.didMouseMoveDuringHover,this.previewEditor=this._register(this._instantiationService.createInstance(pd,this.previewRef.element,{glyphMargin:!1,lineNumbers:"off",minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},rulers:[],padding:{top:0,bottom:0},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0,revealHorizontalRightPadding:0,bracketPairColorization:{enabled:!0,independentColorPoolPerBracketType:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"hidden",horizontal:"hidden",handleMouseWheel:!1},readOnly:!0,wordWrap:"off",wordWrapOverride1:"off",wordWrapOverride2:"off"},{contextKeyValues:{[Ti.inInlineEditsPreviewEditor.key]:!0},contributions:[]},this._editor)),this._previewEditorObs=xs(this.previewEditor),this._activeViewZones=[],this._updatePreviewEditor=fe(c=>{this._editorContainer.readEffect(c),this._previewEditorObs.model.read(c),this._display.read(c),this._nonOverflowView&&(this._nonOverflowView.element.style.display=this._display.read(c));const d=this._uiState.read(c),l=this._edit.read(c);if(!d||!l)return;const u=l.originalLineRange,g=[];u.startLineNumber>1&&g.push(new P(1,1,u.startLineNumber-1,1)),u.startLineNumber+d.newTextLineCount<this._previewTextModel.getLineCount()+1&&g.push(new P(u.startLineNumber+d.newTextLineCount,1,this._previewTextModel.getLineCount()+1,1)),this.previewEditor.setHiddenAreas(g,void 0,!0);const m=[...this._activeViewZones];this._activeViewZones=[];const v=u.endLineNumberExclusive-u.startLineNumber-d.newTextLineCount;this.previewEditor.changeViewZones(y=>{m.forEach(w=>y.removeZone(w)),v>0&&this._activeViewZones.push(y.addZone({afterLineNumber:u.startLineNumber+d.newTextLineCount-1,heightInLines:v,showInHiddenAreas:!0,domNode:Y("div.diagonal-fill.inline-edits-view-zone")}))})}),this._previewEditorWidth=fe(this,c=>{const d=this._edit.read(c);return d?(this._updatePreviewEditor.read(c),Om(this._previewEditorObs,d.modifiedLineRange,c)):0}),this._cursorPosIfTouchesEdit=fe(this,c=>{const d=this._editorObs.cursorPosition.read(c),l=this._edit.read(c);if(!(!l||!d))return l.modifiedLineRange.contains(d.lineNumber)?d:void 0}),this._originalStartPosition=fe(this,c=>{const d=this._edit.read(c);return d?new _e(d.originalLineRange.startLineNumber,1):null}),this._originalEndPosition=fe(this,c=>{const d=this._edit.read(c);return d?new _e(d.originalLineRange.endLineNumberExclusive,1):null}),this._originalVerticalStartPosition=this._editorObs.observePosition(this._originalStartPosition,this._store).map(c=>c?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(this._originalEndPosition,this._store).map(c=>c?.y),this._originalDisplayRange=this._edit.map(c=>c?.displayRange),this._editorMaxContentWidthInRange=fe(this,c=>{const d=this._originalDisplayRange.read(c);return d?(this._editorObs.versionId.read(c),Av(this,(l,u)=>{const g=Om(this._editorObs,d,l);return Math.max(g,u??0)})):Fi(0)}).map((c,d)=>c.read(d)),this._previewEditorLayoutInfo=fe(this,c=>{const d=this._edit.read(c);if(!d||!this._uiState.read(c))return null;const u=d.originalLineRange,g=this._editorObs.scrollLeft.read(c),m=this._editorMaxContentWidthInRange.read(c),v=this._editorObs.layoutInfo.read(c),y=this._previewEditorWidth.read(c),w=v.contentWidth-v.verticalScrollbarWidth,C=this._editor.getContainerDomNode().getBoundingClientRect(),T=v.contentLeft+v.contentWidth+C.left,k=bt(this._editor.getContainerDomNode()).innerWidth-T,A=bt(this._editor.getContainerDomNode()).innerWidth-C.right,B=Math.min(v.contentWidth*.3,y,100),z=0,Q=z+k,ie=this._cursorPosIfTouchesEdit.read(c),oe=Math.max(w+g-z-Math.max(0,B-Q),Math.min(ie?HVe(this._editorObs,ie,c)+50:0,w+g)),xe=Math.min(m+nF,oe),Se=m+nF+y+70,Ft=oe-xe;let it,ti;xe>g?(it=0,ti=v.contentLeft+xe-g):(it=g-xe,ti=v.contentLeft);const ci=this._originalVerticalStartPosition.read(c)??this._editor.getTopForLineNumber(u.startLineNumber)-this._editorObs.scrollTop.read(c),Xn=this._originalVerticalEndPosition.read(c)??this._editor.getBottomForLineNumber(u.endLineNumberExclusive-1)-this._editorObs.scrollTop.read(c),tu=v.contentLeft-g;let Fr=ni.fromLeftTopRightBottom(tu,ci,ti,Xn);const Wr=Fr.height===0;Wr||(Fr=Fr.withMargin(sk,kS));const Cc=this._editor.getOption(L.lineHeight)*d.modifiedLineRange.length,Ec=Xn-ci,Bn=Math.max(Ec,Cc),Br=Ft===0,Pl=0,Rf=Math.min(y+$ee,A+v.width-v.contentLeft-Pl);let Ad=ni.fromLeftTopWidthHeight(Fr.right+Pl,ci,Rf,Bn);return Wr?Ad=Ad.withMargin(sk,kS).translateY(sk):Ad=Ad.withMargin(sk,kS).translateX(kS+Rd),{codeRect:Fr,editRect:Ad,codeScrollLeft:g,contentLeft:v.contentLeft,isInsertion:Wr,maxContentWidth:Se,shouldShowShadow:Br,desiredPreviewEditorScrollLeft:it,previewEditorWidth:Rf}}),this._stickyScrollController=bd.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?On(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):Fi(0),this._shouldOverflow=fe(c=>!1),this._originalBackgroundColor=On(this,this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme().getColor(rE)??be.transparent),this._backgroundSvg=dt.svg({transform:"translate(-0.5 -0.5)",style:{overflow:"visible",pointerEvents:"none",position:"absolute"}},[dt.svgElem("path",{class:"rightOfModifiedBackgroundCoverUp",d:fe(c=>{const d=this._previewEditorLayoutInfo.read(c);if(!(!d||this._originalBackgroundColor.read(c).isTransparent()))return new J$().moveTo(d.codeRect.getRightTop()).lineTo(d.codeRect.getRightTop().deltaX(1e3)).lineTo(d.codeRect.getRightBottom().deltaX(1e3)).lineTo(d.codeRect.getRightBottom()).build()}),style:{fill:UF(ts,"transparent")}})]).keepUpdated(this._store),this._originalOverlay=dt.div({style:{pointerEvents:"none",display:this._previewEditorLayoutInfo.map(c=>c?.isInsertion?"none":"block")}},fe(c=>{const d=tf(this._previewEditorLayoutInfo).read(c);if(!d)return;const l=S1(this._tabAction).map(A=>`${Rd}px solid ${gt(A)}`),u=`${Rd+Wg}px solid ${gt(ts)}`,g=d.read(c).codeScrollLeft!==0,m=d.map(A=>A.codeRect.bottom<A.editRect.bottom),v=su*2+Rd*2,y=d.map(A=>ni.fromLeftTopRightBottom(A.contentLeft-su-Rd,A.codeRect.top,A.contentLeft,A.codeRect.bottom+v)).read(c),w=new bi(y.left,Number.MAX_SAFE_INTEGER),C=d.map(A=>A.codeRect.intersectHorizontal(w)),T=C.map(A=>A.withMargin(Wg,0,Wg,Wg).intersectHorizontal(w)),k=C.map(A=>ni.fromLeftTopWidthHeight(A.right-v+Rd,A.bottom-Rd,v,v).intersectHorizontal(w));return[dt.div({class:"originalSeparatorSideBySide",style:{...T.read(c).toStyles(),boxSizing:"border-box",borderRadius:`${su}px 0 0 ${su}px`,borderTop:u,borderBottom:u,borderLeft:g?"none":u}}),dt.div({class:"originalOverlaySideBySide",style:{...C.read(c).toStyles(),boxSizing:"border-box",borderRadius:`${su}px 0 0 ${su}px`,borderTop:l,borderBottom:l,borderLeft:g?"none":l,backgroundColor:gt(rE)}}),dt.div({class:"originalCornerCutoutSideBySide",style:{pointerEvents:"none",display:m.map(A=>A?"block":"none"),...k.read(c).toStyles()}},[dt.div({class:"originalCornerCutoutBackground",style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",backgroundColor:qa(rE,this._themeService).map(A=>A.toString())}}),dt.div({class:"originalCornerCutoutBorder",style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",boxSizing:"border-box",borderTop:l,borderRight:l,borderRadius:"0 100% 0 0",backgroundColor:gt(ts)}})]),dt.div({class:"originalOverlaySideBySideHider",style:{...y.toStyles(),backgroundColor:gt(ts)}})]})).keepUpdated(this._store),this._modifiedOverlay=dt.div({style:{pointerEvents:"none"}},fe(c=>{const d=tf(this._previewEditorLayoutInfo).read(c);if(!d)return;const u=d.map(C=>C.codeRect.bottom<C.editRect.bottom).map(C=>`0 ${su}px ${su}px ${C?su:0}px`),g=qa(Bx(this._tabAction),this._themeService).map(C=>`1px solid ${C.toString()}`),m=`${Rd+Wg}px solid ${gt(ts)}`,v=d.map(C=>C.editRect.withMargin(0,Rd)),y=v.map(C=>C.withMargin(Wg,Wg,Wg,0)),w=fe(C=>{const T=v.read(C),k=d.read(C);return!k.isInsertion||k.contentLeft>=T.left?ni.fromLeftTopWidthHeight(T.left,T.top,0,0):new ni(k.contentLeft,T.top,T.left,T.top+Rd*2)});return[dt.div({class:"modifiedInsertionSideBySide",style:{...w.read(c).toStyles(),backgroundColor:Bx(this._tabAction).map(C=>gt(C))}}),dt.div({class:"modifiedSeparatorSideBySide",style:{...y.read(c).toStyles(),borderRadius:u,borderTop:m,borderBottom:m,borderRight:m,boxSizing:"border-box"}}),dt.div({class:"modifiedOverlaySideBySide",style:{...v.read(c).toStyles(),borderRadius:u,border:g,boxSizing:"border-box",backgroundColor:gt(vge)}})]})).keepUpdated(this._store),this._nonOverflowView=dt.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[this._backgroundSvg,fe(this,c=>this._shouldOverflow.read(c)?[]:[this._editorContainer,this._originalOverlay,this._modifiedOverlay])]).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:Fi(null),allowEditorOverflow:!1,minContentWidthInPx:fe(c=>{const d=this._previewEditorLayoutInfo.read(c)?.maxContentWidth;return d===void 0?0:d})})),this.previewEditor.setModel(this._previewTextModel),this._register(ki(c=>{const d=this._previewEditorLayoutInfo.read(c);if(!d)return;const l=d.editRect.withMargin(-0,-0);this.previewEditor.layout({height:l.height,width:d.previewEditorWidth+15}),this._editorContainer.element.style.top=`${l.top}px`,this._editorContainer.element.style.left=`${l.left}px`,this._editorContainer.element.style.width=`${d.previewEditorWidth+kS}px`})),this._register(ki(c=>{const d=this._previewEditorLayoutInfo.read(c);d&&this._previewEditorObs.editor.setScrollLeft(d.desiredPreviewEditorScrollLeft)})),this._updatePreviewEditor.recomputeInitiallyAndOnChange(this._store)}};TL=f([p(5,J),p(6,ft)],TL);let bb=class extends F{static{this.MAX_LENGTH=100}constructor(e,t,i,n){super(),this._editor=e,this._edit=t,this._tabAction=i,this._languageService=n,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._start=this._editor.observePosition(Fi(this._edit.range.getStartPosition()),this._store),this._end=this._editor.observePosition(Fi(this._edit.range.getEndPosition()),this._store),this._line=document.createElement("div"),this._hoverableElement=oi(this,null),this.isHovered=this._hoverableElement.map((o,r)=>o?.didMouseMoveDuringHover.read(r)??!1),this._renderTextEffect=fe(o=>{const r=this._editor.model.get(),a=r.getLineContent(this._edit.range.startLineNumber),c=wa.replace(new bi(this._edit.range.startColumn-1,this._edit.range.endColumn-1),this._edit.text),d=c.replace(a),l=r.tokenization.tokenizeLinesAt(this._edit.range.startLineNumber,[d])?.[0];let u;l?u=sN.fromLineTokens(l).slice(c.getRangeAfterReplace()).toLineTokens(this._edit.text,this._languageService.languageIdCodec):u=mw.createEmpty(this._edit.text,this._languageService.languageIdCodec);const g=lN(new uN([u]),hN.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],this._line,!0);this._line.style.width=`${g.minWidthInPx}px`}),this._layout=fe(this,o=>{this._renderTextEffect.read(o);const r=this._start.read(o),a=this._end.read(o);if(!r||!a||r.x>a.x||r.y>a.y)return;const c=this._editor.getOption(L.lineHeight).read(o),d=this._editor.scrollLeft.read(o),l=this._editor.getOption(L.fontInfo).read(o).typicalHalfwidthCharacterWidth,u=3*l,g=4,m=new Su(u,g),v=ni.fromPoints(r,a).withHeight(c).translateX(-d),y=ni.fromPointSize(v.getLeftBottom().add(m),new Su(this._edit.text.length*l,v.height)),w=y.withLeft(v.left);return{originalLine:v,modifiedLine:y,lowerBackground:w,lineHeight:c}}),this._root=dt.div({class:"word-replacement"},[fe(o=>{const r=tf(this._layout).read(o);if(!r)return[];const a=1,c=S1(this._tabAction).map(l=>gt(l)).read(o),d=Bx(this._tabAction).map(l=>gt(l)).read(o);return[dt.div({style:{position:"absolute",...td(l=>e5(this._editor).read(l)),overflow:"hidden",pointerEvents:"none"}},[dt.div({style:{position:"absolute",...td(l=>r.read(l).lowerBackground.withMargin(a,2*a,a,0)),background:gt(ts),cursor:"pointer",pointerEvents:"auto"},onmousedown:l=>{l.preventDefault()},onmouseup:l=>this._onDidClick.fire(new us(bt(l),l)),obsRef:l=>{this._hoverableElement.set(l,void 0)}}),dt.div({style:{position:"absolute",...td(l=>r.read(l).modifiedLine.withMargin(1,2)),fontFamily:this._editor.getOption(L.fontFamily),fontSize:this._editor.getOption(L.fontSize),fontWeight:this._editor.getOption(L.fontWeight),pointerEvents:"none",boxSizing:"border-box",borderRadius:"4px",border:`${a}px solid ${d}`,background:gt(MVe),display:"flex",justifyContent:"center",alignItems:"center",outline:`2px solid ${gt(ts)}`}},[this._line]),dt.div({style:{position:"absolute",...td(l=>r.read(l).originalLine.withMargin(1)),boxSizing:"border-box",borderRadius:"4px",border:`${a}px solid ${c}`,background:gt(PVe),pointerEvents:"none"}},[]),dt.svg({width:11,height:14,viewBox:"0 0 11 14",fill:"none",style:{position:"absolute",left:r.map(l=>l.modifiedLine.left-16),top:r.map(l=>l.modifiedLine.top+Math.round((l.lineHeight-14-5)/2))}},[dt.svgElem("path",{d:"M1 0C1 2.98966 1 5.92087 1 8.49952C1 9.60409 1.89543 10.5 3 10.5H10.5",stroke:gt(q7)}),dt.svgElem("path",{d:"M6 7.5L9.99999 10.49998L6 13.5",stroke:gt(q7)})])])]})]).keepUpdated(this._store),this._register(this._editor.createOverlayWidget({domNode:this._root.element,minContentWidthInPx:Fi(0),position:Fi({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}};bb=f([p(3,fi)],bb);class ZVe extends F{static supportsInlineDiffRendering(e){return Gee(e)}constructor(e,t,i){super(),this._originalEditor=e,this._state=t,this._modifiedTextModel=i,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this.isHovered=xs(this._originalEditor).isTargetHovered(o=>o.target.type===Ei.CONTENT_TEXT&&o.target.detail.injectedText?.options.attachedData instanceof sF&&o.target.detail.injectedText.options.attachedData.owner===this,this._store),this._tokenizationFinished=eHe(this._modifiedTextModel),this._decorations=fe(this,o=>{const r=this._state.read(o);if(!r)return;const a=r.modifiedText,c=r.mode==="insertionInline",d=r.diff.length===1&&r.diff[0].innerChanges?.length===1,l=!0,u=[],g=[],m=Yt.register({className:"inlineCompletions-line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),v=Yt.register({className:"inlineCompletions-line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),y=Yt.register({className:"inlineCompletions-char-delete",description:"char-delete",isWholeLine:!1}),w=Yt.register({className:"inlineCompletions-char-insert",description:"char-insert",isWholeLine:!0}),C=Yt.register({className:"inlineCompletions-char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),T=Yt.register({className:"inlineCompletions-char-insert diff-range-empty",description:"char-insert diff-range-empty"});for(const k of r.diff)if(r.mode!=="sideBySide"&&r.mode!=="deletion"&&r.mode!=="insertionInline"&&(k.original.isEmpty||u.push({range:k.original.toInclusiveRange(),options:v}),k.modified.isEmpty||g.push({range:k.modified.toInclusiveRange(),options:m})),k.modified.isEmpty||k.original.isEmpty)k.original.isEmpty||u.push({range:k.original.toInclusiveRange(),options:y}),k.modified.isEmpty||g.push({range:k.modified.toInclusiveRange(),options:w});else{const B=c&&Gee(k);for(const z of k.innerChanges||[]){if(k.original.contains(z.originalRange.startLineNumber)){const Q=this._originalEditor.getModel()?.getValueInRange(z.originalRange,ry.LF);u.push({range:z.originalRange,options:{description:"char-delete",shouldFillLineOnLineBreak:!1,className:X0("inlineCompletions-char-delete",z.originalRange.isSingleLine()&&r.mode==="insertionInline"&&"single-line-inline",z.originalRange.isEmpty()&&"empty",(z.originalRange.isEmpty()&&d||r.mode==="deletion"&&Q===`
`)&&l&&!B&&"diff-range-empty"),inlineClassName:B?X0("strike-through","inlineCompletions"):null,zIndex:1}})}if(k.modified.contains(z.modifiedRange.startLineNumber)&&g.push({range:z.modifiedRange,options:z.modifiedRange.isEmpty()&&l&&!B&&d?T:C}),B){const Q=a.getValueOfRange(z.modifiedRange),ie=Q.length>3?[{text:Q.slice(0,1),extraClasses:["start"],offsetRange:new bi(z.modifiedRange.startColumn-1,z.modifiedRange.startColumn)},{text:Q.slice(1,-1),extraClasses:[],offsetRange:new bi(z.modifiedRange.startColumn,z.modifiedRange.endColumn-2)},{text:Q.slice(-1),extraClasses:["end"],offsetRange:new bi(z.modifiedRange.endColumn-2,z.modifiedRange.endColumn-1)}]:[{text:Q,extraClasses:["start","end"],offsetRange:new bi(z.modifiedRange.startColumn-1,z.modifiedRange.endColumn)}];this._tokenizationFinished.read(o);const oe=this._modifiedTextModel.tokenization.getLineTokens(z.modifiedRange.startLineNumber);for(const{text:xe,extraClasses:Se,offsetRange:Ft}of ie)u.push({range:P.fromPositions(z.originalRange.getEndPosition()),options:{description:"inserted-text",before:{tokens:oe.getTokensInRange(Ft),content:xe,inlineClassName:X0("inlineCompletions-char-insert",z.modifiedRange.isSingleLine()&&r.mode==="insertionInline"&&"single-line-inline",...Se),cursorStops:zf.None,attachedData:new sF(this)},zIndex:2,showIfCollapsed:!0}})}}}return{originalDecorations:u,modifiedDecorations:g}}),this._register(xs(this._originalEditor).setDecorations(this._decorations.map(o=>o?.originalDecorations??[])));const n=this._state.map(o=>o?.modifiedCodeEditor);this._register(Da((o,r)=>{const a=n.read(o);a&&r.add(xs(a).setDecorations(this._decorations.map(c=>c?.modifiedDecorations??[])))})),this._register(this._originalEditor.onMouseUp(o=>{if(o.target.type!==Ei.CONTENT_TEXT)return;const r=o.target.detail.injectedText?.options.attachedData;r instanceof sF&&r.owner===this&&this._onDidClick.fire(o.event)}))}}class sF{constructor(e){this.owner=e}}function Gee(s){return s.innerChanges?s.innerChanges.every(e=>c6(e.modifiedRange)&&c6(e.originalRange)):!1}let JVe=0;function eHe(s){return On(s.onDidChangeTokens,()=>JVe++)}const tHe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(tHe);let a3=class extends F{constructor(e,t,i,n,o,r){super(),this._editor=e,this._host=t,this._model=i,this._ghostTextIndicator=n,this._focusIsInMenu=o,this._instantiationService=r,this._editorObs=xs(this._editor),this._tabAction=fe(a=>this._model.read(a)?.tabAction.read(a)??so.Inactive),this._constructorDone=oi(this,!1),this._uiState=fe(this,a=>{const c=this._model.read(a);if(!c||!this._constructorDone.read(a))return;c.handleInlineEditShown();const d=c.inlineEdit;let l=rq.fromEdit(d.edit),u=d.edit.apply(d.originalText),g=z7(l,d.originalText,new G_(u)),m=this.determineRenderState(c,a,g,new G_(u));if(!m){c.abort(`unable to determine view: tried to render ${this._previousView?.view}`);return}if(m.kind==="sideBySide"){const y=GVe(u,d.modifiedLineRange);u=y.applyToString(u),l=UVe(l,y),g=z7(l,d.originalText,new G_(u))}return this._previewTextModel.setLanguage(this._editor.getModel().getLanguageId()),this._previewTextModel.getValue()!==u&&this._previewTextModel.setValue(u),c.showCollapsed.read(a)&&!this._indicator.read(a)?.isHoverVisible.read(a)&&(m={kind:"collapsed"}),{state:m,diff:g,edit:d,newText:u,newTextLineCount:d.modifiedLineRange.length}}),this._previewTextModel=this._register(this._instantiationService.createInstance(ty,"",this._editor.getModel().getLanguageId(),{...ty.DEFAULT_CREATION_OPTIONS,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},null)),this._indicatorCyclicDependencyCircuitBreaker=oi(this,!1),this._indicator=fe(this,a=>{if(!this._indicatorCyclicDependencyCircuitBreaker.read(a))return;const c=Jl({owner:this,equalsFn:Yne(Qne())},l=>{const u=this._ghostTextIndicator.read(l);if(u)return u.lineRange;const g=this._uiState.read(l);if(g){if(g.state?.kind==="custom"){const m=g.state.displayLocation?.range;if(!m)throw new ln("custom view should have a range");return new Go(m.startLineNumber,m.endLineNumber)}return g.state?.kind==="insertionMultiLine"?this._insertion.originalLines.read(l):g.edit.displayRange}}),d=fe(this,l=>{const u=this._model.read(l);if(u)return u;const g=this._ghostTextIndicator.read(l);return g?g.model:u});return a.store.add(this._instantiationService.createInstance(t3,this._editorObs,c,this._gutterIndicatorOffset,d,this._inlineEditsIsHovered,this._focusIsInMenu))}),this._inlineEditsIsHovered=fe(this,a=>this._sideBySide.isHovered.read(a)||this._wordReplacementViews.read(a).some(c=>c.isHovered.read(a))||this._deletion.isHovered.read(a)||this._inlineDiffView.isHovered.read(a)||this._lineReplacementView.isHovered.read(a)||this._insertion.isHovered.read(a)||this._customView.isHovered.read(a)),this._gutterIndicatorOffset=fe(this,a=>{if(this._uiState.read(a)?.state?.kind==="insertionMultiLine")return this._insertion.startLineOffset.read(a);const c=this._ghostTextIndicator.read(a);return c?oHe(c,this._editor):0}),this._sideBySide=this._register(this._instantiationService.createInstance(TL,this._editor,this._model.map(a=>a?.inlineEdit),this._previewTextModel,this._uiState.map(a=>a&&a.state?.kind==="sideBySide"?{newTextLineCount:a.newTextLineCount}:void 0),this._tabAction)),this._deletion=this._register(this._instantiationService.createInstance(XVe,this._editor,this._model.map(a=>a?.inlineEdit),this._uiState.map(a=>a&&a.state?.kind==="deletion"?{originalRange:a.state.originalRange,deletions:a.state.deletions}:void 0),this._tabAction)),this._insertion=this._register(this._instantiationService.createInstance(o3,this._editor,this._uiState.map(a=>a&&a.state?.kind==="insertionMultiLine"?{lineNumber:a.state.lineNumber,startColumn:a.state.column,text:a.state.text}:void 0),this._tabAction)),this._inlineDiffViewState=fe(this,a=>{const c=this._uiState.read(a);if(!(!c||!c.state)&&!(c.state.kind==="wordReplacements"||c.state.kind==="lineReplacement"||c.state.kind==="insertionMultiLine"||c.state.kind==="collapsed"||c.state.kind==="custom"))return{modifiedText:new G_(c.newText),diff:c.diff,mode:c.state.kind,modifiedCodeEditor:this._sideBySide.previewEditor}}),this._inlineCollapsedView=this._register(this._instantiationService.createInstance(n3,this._editor,this._model.map((a,c)=>this._uiState.read(c)?.state?.kind==="collapsed"?a?.inlineEdit:void 0))),this._customView=this._register(this._instantiationService.createInstance(s3,this._editor,this._model.map((a,c)=>this._uiState.read(c)?.state?.kind==="custom"?a?.displayLocation:void 0),this._tabAction)),this._inlineDiffView=this._register(new ZVe(this._editor,this._inlineDiffViewState,this._previewTextModel)),this._wordReplacementViews=ZT(this,this._uiState.map(a=>a?.state?.kind==="wordReplacements"?a.state.replacements:[]),(a,c)=>c.add(this._instantiationService.createInstance(bb,this._editorObs,a,this._tabAction))),this._lineReplacementView=this._register(this._instantiationService.createInstance(r3,this._editorObs,this._uiState.map(a=>a?.state?.kind==="lineReplacement"?{originalRange:a.state.originalRange,modifiedRange:a.state.modifiedRange,modifiedLines:a.state.modifiedLines,replacements:a.state.replacements}:void 0),this._tabAction)),this._useCodeShifting=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.allowCodeShifting),this._renderSideBySide=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.renderSideBySide),this._useMultiLineGhostText=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.useMultiLineGhostText),this._register(Da((a,c)=>{const d=this._model.read(a);d&&c.add(D.any(this._sideBySide.onDidClick,this._deletion.onDidClick,this._lineReplacementView.onDidClick,this._insertion.onDidClick,...this._wordReplacementViews.read(a).map(l=>l.onDidClick),this._inlineDiffView.onDidClick,this._customView.onDidClick)(l=>{this._viewHasBeenShownLongerThan(350)&&(l.preventDefault(),d.accept())}))})),this._indicator.recomputeInitiallyAndOnChange(this._store),this._wordReplacementViews.recomputeInitiallyAndOnChange(this._store),this._indicatorCyclicDependencyCircuitBreaker.set(!0,void 0),this._register(this._instantiationService.createInstance(i3,this._host,this._model,this._indicator,this._inlineCollapsedView)),this._constructorDone.set(!0,void 0)}getCacheId(e){return e.inlineEdit.inlineCompletion.identity.id}determineView(e,t,i,n){const o=e.inlineEdit,r=this._previousView?.id===this.getCacheId(e),a=this._previousView?.editorWidth!==this._editorObs.layoutInfoWidth.read(t)&&(this._previousView?.view==="sideBySide"||this._previousView?.view==="lineReplacement");if(r&&!a)return this._previousView.view;if(e.displayLocation)return"custom";const c=i.flatMap(v=>v.innerChanges??[]),d=c.length===1;if(d&&this._useCodeShifting.read(t)!=="never"&&Ege(i))return iHe(i,o.cursorPosition)?"insertionInline":"lineReplacement";if(c.map(v=>({original:o.originalText.getValueOfRange(v.originalRange),modified:n.getValueOfRange(v.modifiedRange)})).every(({original:v,modified:y})=>y.trim()===""&&v.length>0&&(v.length>y.length||v.trim()!=="")))return"deletion";if(nHe(i)&&this._useMultiLineGhostText.read(t)&&this._useCodeShifting.read(t)==="always")return"insertionMultiLine";const u=o.originalLineRange.length,g=o.modifiedLineRange.length;return c.every(v=>nc.ofRange(v.originalRange).columnCount<bb.MAX_LENGTH&&nc.ofRange(v.modifiedRange).columnCount<bb.MAX_LENGTH)&&d&&u===1&&g===1&&(!c.some(v=>v.originalRange.isEmpty())||!qee(c.map(v=>new Cs(v.originalRange,"")),o.originalText).some(v=>v.range.isEmpty()&&nc.ofRange(v.range).columnCount<bb.MAX_LENGTH))?"wordReplacements":u>0&&g>0?u===1&&g===1?"lineReplacement":this._renderSideBySide.read(t)!=="never"&&TL.fitsInsideViewport(this._editor,this._previewTextModel,o,t)?"sideBySide":"lineReplacement":"sideBySide"}determineRenderState(e,t,i,n){const o=e.inlineEdit,r=this.determineView(e,t,i,n);switch(this._previousView={id:this.getCacheId(e),view:r,editorWidth:this._editor.getLayoutInfo().width,timestamp:Date.now()},r){case"custom":return{kind:"custom",displayLocation:e.displayLocation};case"insertionInline":return{kind:"insertionInline"};case"sideBySide":return{kind:"sideBySide"};case"collapsed":return{kind:"collapsed"}}const a=i.flatMap(d=>d.innerChanges??[]);if(r==="deletion")return{kind:"deletion",originalRange:o.originalLineRange,deletions:a.map(d=>d.originalRange)};if(r==="insertionMultiLine"){const d=a[0];return{kind:"insertionMultiLine",lineNumber:d.originalRange.startLineNumber,column:d.originalRange.startColumn,text:n.getValueOfRange(d.modifiedRange)}}const c=a.map(d=>new Cs(d.originalRange,n.getValueOfRange(d.modifiedRange)));if(c.length!==0){if(r==="wordReplacements"){let d=sHe(c,o.originalText);return d.some(l=>l.range.isEmpty())&&(d=qee(c,o.originalText)),{kind:"wordReplacements",replacements:d}}if(r==="lineReplacement")return{kind:"lineReplacement",originalRange:o.originalLineRange,modifiedRange:o.modifiedLineRange,modifiedLines:o.modifiedLineRange.mapToLineArray(d=>n.getLineAt(d)),replacements:a.map(d=>({originalRange:d.originalRange,modifiedRange:d.modifiedRange}))}}}_viewHasBeenShownLongerThan(e){const t=this._previousView?.timestamp;if(!t)throw new ln("viewHasBeenShownLongThan called before a view has been shown");return Date.now()-t>=e}};a3=f([p(5,J)],a3);function Ege(s){return s.every(t=>t.innerChanges.every(i=>e(i)));function e(t){return!(!t.originalRange.isEmpty()||!(t.modifiedRange.startLineNumber===t.modifiedRange.endLineNumber))}}function iHe(s,e){if(!e||!Ege(s))return!1;const t=e;return s.every(n=>n.innerChanges.every(o=>i(o)));function i(n){const o=n.originalRange.getStartPosition();return!!(t.isBeforeOrEqual(o)||o.lineNumber<t.lineNumber)}}function nHe(s){const e=s.flatMap(i=>i.innerChanges??[]);if(e.length!==1)return!1;const t=e[0];return!(!t.originalRange.isEmpty()||t.modifiedRange.startLineNumber===t.modifiedRange.endLineNumber)}function sHe(s,e){return xge(s,e,t=>/^[a-zA-Z]$/.test(t))}function qee(s,e){return xge(s,e,t=>!/^\s$/.test(t))}function xge(s,e,t){const i=[];s.sort((o,r)=>P.compareRangesUsingStarts(o.range,r.range));for(const o of s){let r=o.range.startColumn-1,a=o.range.endColumn-2,c="",d="";const l=e.getLineAt(o.range.startLineNumber),u=e.getLineAt(o.range.endLineNumber);if(n(l[r]))for(;n(l[r-1]);)c=l[r-1]+c,r--;if(n(u[a])||a<r)for(;n(u[a+1]);)d+=u[a+1],a++;let g=new Cs(new P(o.range.startLineNumber,r+1,o.range.endLineNumber,a+2),c+o.text+d);i.length>0&&P.areIntersectingOrTouching(i[i.length-1].range,g.range)&&(g=Cs.joinReplacements([i.pop(),g],e)),i.push(g)}function n(o){return o===void 0?!1:t(o)}return i}function oHe(s,e){const t=s.model.inlineEdit.edit.replacements;if(t.length!==1)return 0;const i=e.getModel();if(!i)return 0;const n=i.getEOL(),o=t[0];if(o.range.isEmpty()&&o.text.startsWith(n)){const r=e.getLineHeightForPosition(o.range.getStartPosition());return rHe(o.text,n)*r}return 0}function rHe(s,e){if(!e.length)return 0;let t=0,i=0;for(;s.startsWith(e,i);)t++,i+=e.length;return t}var c3;let d3=class extends F{static{c3=this}static{this.hot=cN(c3)}constructor(e,t,i,n,o){super(),this._editor=e,this._edit=t,this._model=i,this._focusIsInMenu=n,this._inlineEdit=fe(this,r=>{const a=this._model.read(r);if(!a)return;const c=this._edit.read(r);if(!c)return;const d=this._editor.getModel();if(!d)return;const l=a.inlineEditState.get()?.inlineCompletion.updatedEdit;if(!l)return;const u=l.replacements.map(v=>{const y=P.fromPositions(d.getPositionAt(v.replaceRange.start),d.getPositionAt(v.replaceRange.endExclusive));return new Cs(y,v.newText)}),g=new hc(u),m=new dy(d);return new uge(m,g,a.primaryPosition.get(),c.commands,c.inlineCompletion)}),this._inlineEditModel=fe(this,r=>{const a=this._model.read(r);if(!a)return;const c=this._inlineEdit.read(r);if(!c)return;const d=fe(this,l=>{if(this._editorObs.isFocused.read(l)){if(a.tabShouldJumpToInlineEdit.read(l))return so.Jump;if(a.tabShouldAcceptInlineEdit.read(l))return so.Accept}return so.Inactive});return new gge(a,c,d)}),this._inlineEditHost=fe(this,r=>{const a=this._model.read(r);if(a)return new EVe(a)}),this._ghostTextIndicator=fe(this,r=>{const a=this._model.read(r);if(!a)return;const c=a.inlineCompletionState.read(r);if(!c)return;const d=c.inlineCompletion;if(!d||!d.showInlineEditMenu)return;const l=Go.ofLength(c.primaryGhostText.lineNumber,1);return new xVe(this._editor,a,l,d)}),this._editorObs=xs(this._editor),this._register(o.createInstance(a3,this._editor,this._inlineEditHost,this._inlineEditModel,this._ghostTextIndicator,this._focusIsInMenu))}};d3=c3=f([p(4,J)],d3);function aHe(s){const e=new U,t=e.add(wye());return e.add(ki(i=>{t.setStyle(s.read(i))})),e}let l3=class extends F{constructor(e,t,i,n){super(),this._editor=e,this._model=t,this._focusIsInMenu=i,this._instantiationService=n,this._ghostTexts=fe(this,o=>this._model.read(o)?.ghostTexts.read(o)??[]),this._stablizedGhostTexts=zBe(this._ghostTexts,this._store),this._editorObs=xs(this._editor),this._ghostTextWidgets=ZT(this,this._stablizedGhostTexts,(o,r)=>$F(a=>this._instantiationService.createInstance(Wx.hot.read(a),this._editor,{ghostText:o,warning:this._model.map((c,d)=>{const l=c?.warning?.read(d);return l?{icon:l.icon}:void 0}),minReservedLineCount:Fi(0),targetTextModel:this._model.map(c=>c?.textModel)},this._editorObs.getOption(L.inlineSuggest).map(c=>({syntaxHighlightingEnabled:c.syntaxHighlightingEnabled})),!1,!1)).recomputeInitiallyAndOnChange(r)).recomputeInitiallyAndOnChange(this._store),this._inlineEdit=fe(this,o=>this._model.read(o)?.inlineEditState.read(o)?.inlineEdit),this._everHadInlineEdit=Av(this,(o,r)=>r||!!this._inlineEdit.read(o)||!!this._model.read(o)?.inlineCompletionState.read(o)?.inlineCompletion?.showInlineEditMenu),this._inlineEditWidget=$F(o=>{if(this._everHadInlineEdit.read(o))return this._instantiationService.createInstance(d3.hot.read(o),this._editor,this._inlineEdit,this._model,this._focusIsInMenu)}).recomputeInitiallyAndOnChange(this._store),this._fontFamily=this._editorObs.getOption(L.inlineSuggest).map(o=>o.fontFamily),this._register(aHe(fe(o=>{const r=this._fontFamily.read(o);return r===""||r==="default"?"":`
.monaco-editor .ghost-text-decoration,
.monaco-editor .ghost-text-decoration-preview,
.monaco-editor .ghost-text {
	font-family: ${r};
}`}))),this._register(new XV(this._editor,this._model,this._instantiationService))}shouldShowHoverAtViewZone(e){return this._ghostTextWidgets.get()[0]?.get().ownsViewZone(e)??!1}};l3=f([p(3,J)],l3);var qg;let Ks=class extends F{static{qg=this}static{this._instances=new Set}static{this.hot=cN(qg)}static{this.ID="editor.contrib.inlineCompletionsController"}static getInFocusedEditorOrParent(e){const t=Xre(e);return t?qg.get(t):null}static get(e){return MBe(e.getContribution(qg.ID))}constructor(e,t,i,n,o,r,a,c,d,l){super(),this.editor=e,this._instantiationService=t,this._contextKeyService=i,this._configurationService=n,this._commandService=o,this._debounceService=r,this._languageFeaturesService=a,this._accessibilitySignalService=c,this._keybindingService=d,this._accessibilityService=l,this._editorObs=xs(this.editor),this._positions=fe(this,m=>this._editorObs.selections.read(m)?.map(v=>v.getEndPosition())??[new _e(1,1)]),this._suggestWidgetAdapter=this._register(new bVe(this._editorObs,m=>this.model.get()?.handleSuggestAccepted(m),()=>this.model.get()?.selectedInlineCompletion.get()?.getSingleTextEdit())),this._enabledInConfig=On(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(L.inlineSuggest).enabled),this._isScreenReaderEnabled=On(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this._editorDictationInProgress=On(this,this._contextKeyService.onDidChangeContext,()=>this._contextKeyService.getContext(this.editor.getDomNode()).getValue("editorDictation.inProgress")===!0),this._enabled=fe(this,m=>this._enabledInConfig.read(m)&&(!this._isScreenReaderEnabled.read(m)||!this._editorDictationInProgress.read(m))),this._debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,"InlineCompletionsDebounce",{min:50,max:50}),this._focusIsInMenu=oi(this,!1),this._focusIsInEditorOrMenu=fe(this,m=>{const v=this._editorObs.isFocused.read(m),y=this._focusIsInMenu.read(m);return v||y}),this._cursorIsInIndentation=fe(this,m=>{const v=this._editorObs.cursorPosition.read(m);if(v===null)return!1;const y=this._editorObs.model.read(m);if(!y)return!1;this._editorObs.versionId.read(m);const w=y.getLineIndentColumn(v.lineNumber);return v.column<=w}),this.model=$F(this,m=>{if(this._editorObs.isReadonly.read(m))return;const v=this._editorObs.model.read(m);return v?this._instantiationService.createInstance(q$,v,this._suggestWidgetAdapter.selectedItem,this._editorObs.versionId,this._positions,this._debounceValue,this._enabled,this.editor):void 0}).recomputeInitiallyAndOnChange(this._store),this._playAccessibilitySignal=jd(this),this._hideInlineEditOnSelectionChange=this._editorObs.getOption(L.inlineSuggest).map(m=>!0),this._view=this._register(this._instantiationService.createInstance(l3,this.editor,this.model,this._focusIsInMenu)),qg._instances.add(this),this._register(Ee(()=>qg._instances.delete(this))),this._register(ki(m=>{const v=this.model.read(m);if(v&&v.state.read(m)!==void 0)for(const y of qg._instances)y!==this&&y.reject()})),this._register(fC(this._editorObs.onDidType,(m,v)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(fC(this._editorObs.onDidPaste,(m,v)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(this._commandService.onDidExecuteCommand(m=>{if(new Set([Lk.Tab.id,Lk.DeleteLeft.id,Lk.DeleteRight.id,lx,"acceptSelectedSuggestion"]).has(m.commandId)&&e.hasTextFocus()&&this._enabled.get()){let y=!1;m.commandId===lx&&(y=!0),this._editorObs.forceUpdate(w=>{this.model.get()?.trigger(w,{noDelay:y})})}})),this._register(fC(this._editorObs.selections,(m,v,y)=>{if(y.some(w=>w.reason===Ls.Explicit||w.source==="api")){if(!this._hideInlineEditOnSelectionChange.get()&&this.model.get()?.state.get()?.kind==="inlineEdit")return;const w=this.model.get();if(!w)return;w.state.get()?.kind==="ghostText"&&this.model.get()?.stop()}})),this._register(ki(m=>{if(this._focusIsInEditorOrMenu.read(m)||this._contextKeyService.getContextKeyValue("accessibleViewIsShown")||this._configurationService.getValue("editor.inlineSuggest.keepOnBlur")||e.getOption(L.inlineSuggest).keepOnBlur||By.dropDownVisible)return;const y=this.model.get();y&&(y.state.get()?.inlineCompletion?.isFromExplicitRequest&&y.inlineEditAvailable.get()||ys(w=>{y.stop("automatic",w)}))})),this._register(ki(m=>{const v=this.model.read(m)?.inlineCompletionState.read(m);v?.suggestItem?v.primaryGhostText.lineCount>=2&&this._suggestWidgetAdapter.forceRenderingAbove():this._suggestWidgetAdapter.stopForceRenderingAbove()})),this._register(Ee(()=>{this._suggestWidgetAdapter.stopForceRenderingAbove()}));const u=Av(this,(m,v)=>{const w=this.model.read(m)?.state.read(m);return this._suggestWidgetAdapter.selectedItem.get()?v:w?.inlineCompletion?.semanticId});this._register(Sye(fe(m=>(this._playAccessibilitySignal.read(m),u.read(m),{})),async(m,v,y,w)=>{const C=this.model.get(),T=C?.state.get();if(!T||!C)return;const k=T.kind==="ghostText"?C.textModel.getLineContent(T.primaryGhostText.lineNumber):"";await Ia(50,K7(w)),await Rk(this._suggestWidgetAdapter.selectedItem,Gm,()=>!1,K7(w)),await this._accessibilitySignalService.playSignal(T.kind==="ghostText"?Up.inlineSuggestion:Up.nextEditSuggestion),this.editor.getOption(L.screenReaderAnnounceInlineSuggestion)&&(T.kind==="ghostText"?this._provideScreenReaderUpdate(T.primaryGhostText.renderForScreenReader(k)):this._provideScreenReaderUpdate(""))})),this._register(this._configurationService.onDidChangeConfiguration(m=>{m.affectsConfiguration("accessibility.verbosity.inlineCompletions")&&this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue("accessibility.verbosity.inlineCompletions")})})),this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue("accessibility.verbosity.inlineCompletions")});const g=new KBe(this._contextKeyService);this._register(g.bind(Ti.cursorInIndentation,this._cursorIsInIndentation)),this._register(g.bind(Ti.hasSelection,m=>!this._editorObs.cursorSelection.read(m)?.isEmpty())),this._register(g.bind(Ti.cursorAtInlineEdit,this.model.map((m,v)=>m?.inlineEditState?.read(v)?.cursorAtInlineEdit.read(v)))),this._register(g.bind(Ti.tabShouldAcceptInlineEdit,this.model.map((m,v)=>!!m?.tabShouldAcceptInlineEdit.read(v)))),this._register(g.bind(Ti.tabShouldJumpToInlineEdit,this.model.map((m,v)=>!!m?.tabShouldJumpToInlineEdit.read(v)))),this._register(g.bind(Ti.inlineEditVisible,m=>this.model.read(m)?.inlineEditState.read(m)!==void 0)),this._register(g.bind(Ti.inlineSuggestionHasIndentation,m=>this.model.read(m)?.getIndentationInfo(m)?.startsWithIndentation)),this._register(g.bind(Ti.inlineSuggestionHasIndentationLessThanTabSize,m=>this.model.read(m)?.getIndentationInfo(m)?.startsWithIndentationLessThanTabSize)),this._register(g.bind(Ti.suppressSuggestions,m=>{const y=this.model.read(m)?.inlineCompletionState.read(m);return y?.primaryGhostText&&y?.inlineCompletion?y.inlineCompletion.source.inlineSuggestions.suppressSuggestions:void 0})),this._register(g.bind(Ti.inlineSuggestionVisible,m=>{const y=this.model.read(m)?.inlineCompletionState.read(m);return!!y?.inlineCompletion&&y?.primaryGhostText!==void 0&&!y?.primaryGhostText.isEmpty()})),this._register(this._instantiationService.createInstance(V$,this.editor))}playAccessibilitySignal(e){this._playAccessibilitySignal.trigger(e)}_provideScreenReaderUpdate(e){const t=this._contextKeyService.getContextKeyValue("accessibleViewIsShown"),i=this._keybindingService.lookupKeybinding("editor.action.accessibleView");let n;!t&&i&&this.editor.getOption(L.inlineCompletionsAccessibilityVerbose)&&(n=h(1266,"Inspect this in the accessible view ({0})",i.getAriaLabel())),ta(n?e+", "+n:e)}shouldShowHoverAt(e){const t=this.model.get()?.primaryGhostText.get();return t?t.parts.some(i=>e.containsPosition(new _e(t.lineNumber,i.column))):!1}shouldShowHoverAtViewZone(e){return this._view.shouldShowHoverAtViewZone(e)}reject(){ys(e=>{const t=this.model.get();t&&t.stop("explicitCancel",e)})}jump(){const e=this.model.get();e&&e.jump()}testOnlyDisableUi(){this._view.dispose()}};Ks=qg=f([p(1,J),p(2,me),p(3,ne),p(4,qe),p(5,Sd),p(6,Ne),p(7,cI),p(8,Ve),p(9,Tr)],Ks);class Vx extends F{static get(e){return e.getContribution(Vx.ID)}static{this.ID="editor.contrib.placeholderText"}constructor(e){super(),this._editor=e,this._editorObs=xs(this._editor),this._placeholderText=this._editorObs.getOption(L.placeholder),this._state=Jl({owner:this,equalsFn:kk},t=>{const i=this._placeholderText.read(t);if(i&&this._editorObs.valueIsEmpty.read(t))return{placeholder:i}}),this._shouldViewBeAlive=cHe(this,t=>this._state.read(t)?.placeholder!==void 0),this._view=fe(t=>{if(!this._shouldViewBeAlive.read(t))return;const i=rn("div.editorPlaceholder");t.store.add(ki(n=>{const o=this._state.read(n),r=o?.placeholder!==void 0;i.root.style.display=r?"block":"none",i.root.innerText=o?.placeholder??""})),t.store.add(ki(n=>{const o=this._editorObs.layoutInfo.read(n);i.root.style.left=`${o.contentLeft}px`,i.root.style.width=o.contentWidth-o.verticalScrollbarWidth+"px",i.root.style.top=`${this._editor.getTopForLineNumber(0)}px`})),t.store.add(ki(n=>{i.root.style.fontFamily=this._editorObs.getOption(L.fontFamily).read(n),i.root.style.fontSize=this._editorObs.getOption(L.fontSize).read(n)+"px",i.root.style.lineHeight=this._editorObs.getOption(L.lineHeight).read(n)+"px"})),t.store.add(this._editorObs.createOverlayWidget({allowEditorOverflow:!1,minContentWidthInPx:Fi(0),position:Fi(null),domNode:i.root}))}),this._view.recomputeInitiallyAndOnChange(this._store)}}function cHe(s,e){return Av(s,(t,i)=>i===!0?!0:e(t))}const dHe=new O("commentEditorFocused",!1),aE=5*18,lHe=25*18;let jy=class extends hI{constructor(e,t,i,n,o,r,a,c,d,l,u,g){const m={contributions:[{id:fx.ID,ctor:fx,instantiation:vt.BeforeFirstInteraction},{id:Xp.ID,ctor:Xp,instantiation:vt.BeforeFirstInteraction},{id:ea.ID,ctor:ea,instantiation:vt.Eager},{id:os.ID,ctor:os,instantiation:vt.Lazy},{id:lg.ID,ctor:lg,instantiation:vt.Eager},{id:Lh.ID,ctor:Lh,instantiation:vt.Lazy},...xE.getSomeEditorContributions([md.ID,cg.ID,gv.ID,wr.ID,ps.ID,Hy.ID,Fde,Ks.ID,ef.ID,Vx.ID])],contextMenuId:N.SimpleEditorContext};super(e,t,m,o,r,a,i,c,d,l,u,g),this._commentEditorFocused=dHe.bindTo(i),this._commentEditorEmpty=Za.commentIsEmpty.bindTo(i),this._commentEditorEmpty.set(!this.getModel()?.getValueLength()),this._parentThread=n,this._register(this.onDidFocusEditorWidget(v=>this._commentEditorFocused.set(!0))),this._register(this.onDidChangeModelContent(v=>this._commentEditorEmpty.set(!this.getModel()?.getValueLength()))),this._register(this.onDidBlurEditorWidget(v=>this._commentEditorFocused.reset()))}getParentThread(){return this._parentThread}_getActions(){return xE.getEditorActions()}updateOptions(e){const t={...e,lineNumbers:"off"};super.updateOptions(t)}static getEditorOptions(e){return{wordWrap:"on",glyphMargin:!1,lineNumbers:"off",folding:!1,selectOnLineNumbers:!1,scrollbar:{vertical:"visible",verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!1},overviewRulerLanes:2,lineDecorationsWidth:0,scrollBeyondLastLine:!1,renderLineHighlight:"none",fixedOverflowWidgets:!0,acceptSuggestionOnEnter:"smart",minimap:{enabled:!1},dropIntoEditor:{enabled:!0},autoClosingBrackets:e.getValue("editor.autoClosingBrackets"),quickSuggestions:!1,accessibilitySupport:e.getValue("editor.accessibilitySupport"),fontFamily:e.getValue("editor.fontFamily"),fontSize:e.getValue("editor.fontSize")}}};jy=f([p(4,J),p(5,Ot),p(6,qe),p(7,ft),p(8,At),p(9,Tr),p(10,rs),p(11,Ne)],jy);function Ige(s,e,t){const i=e.getLayoutInfo(),n=e.getOption(L.lineHeight),o=e._getViewModel()?.getLineCount()*n;if(o>i.height||o<i.height&&t>aE){const r=Math.ceil((o-i.height)/n),a=i.height+n*r;return om(a,aE,om(s.getLayoutInfo().height-90,aE,lHe))}return t}let hHe=0;const uHe="commenteditordecoration";let h3=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T){super(),this.owner=e,this._parentEditor=i,this._commentThread=n,this._scopedInstatiationService=o,this._contextKeyService=r,this._commentMenus=a,this._commentOptions=c,this._pendingComment=d,this._parentThread=l,this._actionRunDelegate=g,this.commentService=m,this.keybindingService=y,this.contextMenuService=w,this.hoverService=C,this.textModelService=T,this._commentThreadDisposables=[],this._editorHeight=aE,this._container=ee(t,Y(".comment-form-container")),this._form=ee(this._container,Y(".comment-form")),this.commentEditor=this._register(this._scopedInstatiationService.createInstance(jy,this._form,jy.getEditorOptions(v),r,this._parentThread)),this.commentEditorIsEmpty=Za.commentIsEmpty.bindTo(this._contextKeyService),this.commentEditorIsEmpty.set(!this._pendingComment),this.initialize(u)}async initialize(e){this.avatar=ee(this._form,Y(".avatar-container")),this.updateAuthorInfo();const t=this._commentThread.comments&&this._commentThread.comments.length>0,i=Dn()+"-"+(t?this._commentThread.threadId:++hHe),n=JSON.stringify({extensionId:this._commentThread.extensionId,commentThreadId:this._commentThread.threadId});let o=R.from({scheme:ae.commentsInput,path:`/${this._commentThread.extensionId}/commentinput-${i}.md?${n}`});const r=this.commentService.getCommentController(this.owner);r&&(o=o.with({authority:r.id}));const a=await this.textModelService.createModelReference(o);a.object.textEditorModel.setValue(this._pendingComment?.body||""),this._register(a),this.commentEditor.setModel(a.object.textEditorModel),this._pendingComment&&this.commentEditor.setPosition(this._pendingComment.cursor),this.calculateEditorHeight(),this._register(a.object.textEditorModel.onDidChangeContent(()=>{this.setCommentEditorDecorations(),this.commentEditorIsEmpty?.set(!this.commentEditor.getValue()),this.calculateEditorHeight()&&(this.commentEditor.layout({height:this._editorHeight,width:this.commentEditor.getLayoutInfo().width}),this.commentEditor.render(!0))})),this.createTextModelListener(this.commentEditor,this._form),this.setCommentEditorDecorations(),this._pendingComment?this.expandReplyArea():t?this.createReplyButton(this.commentEditor,this._form):e&&this._commentThread.comments&&this._commentThread.comments.length===0&&this.expandReplyArea(),this._error=ee(this._container,Y(".validation-error.hidden"));const c=ee(this._container,Y(".form-actions"));this._formActions=ee(c,Y(".other-actions")),this.createCommentWidgetFormActions(this._formActions,a.object.textEditorModel),this._editorActions=ee(c,Y(".editor-actions")),this.createCommentWidgetEditorActions(this._editorActions,a.object.textEditorModel)}calculateEditorHeight(){const e=Ige(this._parentEditor,this.commentEditor,this._editorHeight);return e!==this._editorHeight?(this._editorHeight=e,!0):!1}updateCommentThread(e){const t=this.commentEditor.hasTextFocus(),i=!this._commentThread.comments?.length&&!e.comments?.length;this._reviewThreadReplyButton||this.createReplyButton(this.commentEditor,this._form),this._commentThread.comments&&this._commentThread.comments.length===0&&!i&&this.expandReplyArea(),t&&this.commentEditor.focus()}getPendingComment(){const e=this.commentEditor.getModel();if(e&&e.getValueLength()>0)return{body:e.getValue(),cursor:this.commentEditor.getPosition()??new _e(1,1)}}setPendingComment(e){this._pendingComment=e,this.expandReplyArea(),this.commentEditor.setValue(e.body),this.commentEditor.setPosition(e.cursor)}layout(e){this.commentEditor.layout({height:this._editorHeight,width:e-54})}focusIfNeeded(){!this._commentThread.comments||!this._commentThread.comments.length?this.commentEditor.focus():(this.commentEditor.getModel()?.getValueLength()??0)>0&&this.expandReplyArea()}focusCommentEditor(){this.commentEditor.focus()}expandReplyAreaAndFocusCommentEditor(){this.expandReplyArea(),this.commentEditor.focus()}isCommentEditorFocused(){return this.commentEditor.hasWidgetFocus()}updateAuthorInfo(){if(this.avatar.textContent="",typeof this._commentThread.canReply!="boolean"&&this._commentThread.canReply.iconPath){this.avatar.style.display="block";const e=ee(this.avatar,Y("img.avatar"));e.src=tc.uriToBrowserUri(R.revive(this._commentThread.canReply.iconPath)).toString(!0)}else this.avatar.style.display="none"}updateCanReply(){this.updateAuthorInfo(),this._commentThread.canReply?this._container.style.display="block":this._container.style.display="none"}async submitComment(){await this._commentFormActions?.triggerDefaultAction(),this._pendingComment=void 0}setCommentEditorDecorations(){const t=this._commentThread.comments&&this._commentThread.comments.length>0?this._commentOptions?.placeHolder||h(5398,"Reply..."):this._commentOptions?.placeHolder||h(5399,"Type a new comment");this.commentEditor.updateOptions({placeholder:t})}createTextModelListener(e,t){this._commentThreadDisposables.push(e.onDidFocusEditorWidget(()=>{this._commentThread.input={uri:e.getModel().uri,value:e.getValue()},this.commentService.setActiveEditingCommentThread(this._commentThread),this.commentService.setActiveCommentAndThread(this.owner,{thread:this._commentThread})})),this._commentThreadDisposables.push(e.getModel().onDidChangeContent(()=>{const i=e.getValue();if(this._commentThread.input&&this._commentThread.input.uri===e.getModel().uri&&this._commentThread.input.value!==i){const n=this._commentThread.input;n.value=i,this._commentThread.input=n}this.commentService.setActiveEditingCommentThread(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeInput(i=>{const n=this._commentThread,o=e.getModel();n.input&&o&&n.input.uri!==o.uri||i&&e.getValue()!==i.value&&(e.setValue(i.value),i.value===""&&(this._pendingComment={body:"",cursor:new _e(1,1)},t.classList.remove("expand"),e.getDomNode().style.outline="",this._error.textContent="",this._error.classList.add("hidden")))}))}createCommentWidgetFormActions(e,t){const i=this._commentMenus.getCommentThreadActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentFormActions.setActions(i)})),this._commentFormActions=new Rx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,async n=>{await this._actionRunDelegate?.(),await n.run({thread:this._commentThread,text:this.commentEditor.getValue(),$mid:Nn.CommentThreadReply}),this.hideReplyArea()}),this._register(this._commentFormActions),this._commentFormActions.setActions(i)}createCommentWidgetEditorActions(e,t){const i=this._commentMenus.getCommentEditorActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentEditorActions.setActions(i,!0)})),this._commentEditorActions=new Rx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,async n=>{this._actionRunDelegate?.(),n.run({thread:this._commentThread,text:this.commentEditor.getValue(),$mid:Nn.CommentThreadReply}),this.focusCommentEditor()}),this._register(this._commentEditorActions),this._commentEditorActions.setActions(i,!0)}get isReplyExpanded(){return this._container.classList.contains("expand")}expandReplyArea(){this.isReplyExpanded||(this._container.classList.add("expand"),this.commentEditor.focus(),this.commentEditor.layout())}clearAndExpandReplyArea(){this.isReplyExpanded||(this.commentEditor.setValue(""),this.expandReplyArea())}hideReplyArea(){const e=this.commentEditor.getDomNode();e&&(e.style.outline=""),this.commentEditor.setValue(""),this._pendingComment={body:"",cursor:new _e(1,1)},this._container.classList.remove("expand"),this._error.textContent="",this._error.classList.add("hidden")}createReplyButton(e,t){this._reviewThreadReplyButton=ee(t,Y(`button.review-thread-reply-button.${KF}`)),this._register(this.hoverService.setupManagedHover(yr("mouse"),this._reviewThreadReplyButton,this._commentOptions?.prompt||h(5398,"Reply..."))),this._reviewThreadReplyButton.textContent=this._commentOptions?.prompt||h(5398,"Reply..."),this._register(re(this._reviewThreadReplyButton,"click",i=>this.clearAndExpandReplyArea())),this._register(re(this._reviewThreadReplyButton,"focus",i=>this.clearAndExpandReplyArea())),this._register(e.onDidBlurEditorWidget(()=>{e.getModel().getValueLength()===0&&t.classList.contains("expand")&&t.classList.remove("expand")}))}dispose(){super.dispose(),Qe(this._commentThreadDisposables)}};h3=f([p(12,yg),p(13,ne),p(14,Ve),p(15,mi),p(16,wi),p(17,yi)],h3);class nm extends Kt{static{this.ID="toolbar.toggle.pickReactions"}constructor(e,t){super(nm.ID,t||h(5501,"Pick Reactions..."),"toggle-reactions",!0),this._menuActions=[],this.toggleDropdownMenu=e}run(){return this.toggleDropdownMenu(),Promise.resolve(!0)}get menuActions(){return this._menuActions}set menuActions(e){this._menuActions=e}}class gHe extends qm{constructor(e){super(null,e,{})}updateLabel(){if(!this.label)return;const e=this.action;if(e.class&&this.label.classList.add(e.class),e.icon){const t=ee(this.label,Y(".reaction-icon")),i=R.revive(e.icon);t.style.backgroundImage=oy(i)}else{const t=ee(this.label,Y("span.reaction-label"));t.innerText=e.label}if(e.count){const t=ee(this.label,Y("span.reaction-count"));t.innerText=`${e.count}`}}getTooltip(){const e=this.action,t=e.enabled?h(5502,"Toggle reaction, "):"";if(e.count===void 0)return h(5503,"{0}{1} reaction",t,e.label);if(e.reactors===void 0||e.reactors.length===0){if(e.count===1)return h(5504,"{0}1 reaction with {1}",t,e.label);if(e.count>1)return h(5505,"{0}{1} reactions with {2}",t,e.count,e.label)}else{if(e.reactors.length<=10&&e.reactors.length===e.count)return h(5506,"{0}{1} reacted with {2}",t,e.reactors.join(", "),e.label);if(e.count>1){const i=e.reactors.slice(0,10);return h(5507,"{0}{1} and {2} more reacted with {3}",t,i.join(", "),e.count-i.length,e.label)}}}}class AL extends Kt{static{this.ID="toolbar.toggle.reaction"}constructor(e,t="",i="",n=!0,o,r,a,c){super(AL.ID,t,i,n,o),this.reactors=r,this.icon=a,this.count=c}}class pHe extends _g{async runAction(e,t){await e.run(...t)}}let u3=class extends F{get domNode(){return this._domNode}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C){super(),this.parentEditor=e,this.commentThread=t,this.comment=i,this.pendingEdit=n,this.owner=o,this.resource=r,this.parentThread=a,this.markdownRenderer=c,this.instantiationService=d,this.commentService=l,this.notificationService=u,this.contextMenuService=g,this.configurationService=v,this.hoverService=y,this.keybindingService=w,this.textModelService=C,this._md=this._register(new kt),this._editAction=null,this._commentEditContainer=null,this._reactionsActionBar=this._register(new kt),this._reactionActions=this._register(new U),this._commentEditor=null,this._commentEditorModel=null,this._editorHeight=aE,this._actionRunner=this._register(new pHe),this.toolbar=this._register(new kt),this._commentFormActions=null,this._commentEditorActions=null,this._onDidClick=new M,this.isEditing=!1,this._editModeDisposables=this._register(new U),this._domNode=Y("div.review-comment"),this._contextKeyService=this._register(m.createScoped(this._domNode)),this._commentContextValue=Za.commentContext.bindTo(this._contextKeyService),this.comment.contextValue&&this._commentContextValue.set(this.comment.contextValue),this._commentMenus=this.commentService.getCommentMenus(this.owner),this._domNode.tabIndex=-1,this._avatar=ee(this._domNode,Y("div.avatar-container")),this.updateCommentUserIcon(this.comment.userIconPath),this._commentDetailsContainer=ee(this._domNode,Y(".review-comment-contents")),this.createHeader(this._commentDetailsContainer),this._body=document.createElement("div"),this._body.classList.add("comment-body",KF),v.getValue(b1)?.maxHeight!==!1&&this._body.classList.add("comment-body-max-height"),this.createScroll(this._commentDetailsContainer,this._body),this.updateCommentBody(this.comment.body),this.createReactionsContainer(this._commentDetailsContainer),this._domNode.setAttribute("aria-label",`${i.userName}, ${this.commentBodyValue}`),this._domNode.setAttribute("role","treeitem"),this._clearTimeout=null,this._register(re(this._domNode,pe.CLICK,()=>this.isEditing||this._onDidClick.fire(this))),this._register(re(this._domNode,pe.CONTEXT_MENU,T=>this.onContextMenu(T))),n&&this.switchToEditMode(),this.activeCommentListeners()}activeCommentListeners(){this._register(re(this._domNode,pe.FOCUS_IN,()=>{this.commentService.setActiveCommentAndThread(this.owner,{thread:this.commentThread,comment:this.comment})},!0))}createScroll(e,t){this._scrollable=this._register(new Cye({forceIntegerValues:!0,smoothScrollDuration:125,scheduleAtNextAnimationFrame:n=>kE(bt(e),n)})),this._scrollableElement=this._register(new Eye(t,{horizontal:dd.Visible,vertical:dd.Visible},this._scrollable)),this._register(this._scrollableElement.onScroll(n=>{n.scrollLeftChanged&&(t.scrollLeft=n.scrollLeft),n.scrollTopChanged&&(t.scrollTop=n.scrollTop)}));const i=this._register(new Wo(t,"scroll")).event;this._register(i(n=>{const o=this._scrollableElement.getScrollPosition(),r=Math.abs(t.scrollLeft-o.scrollLeft)<=1?void 0:t.scrollLeft,a=Math.abs(t.scrollTop-o.scrollTop)<=1?void 0:t.scrollTop;(r!==void 0||a!==void 0)&&this._scrollableElement.setScrollPosition({scrollLeft:r,scrollTop:a})})),e.appendChild(this._scrollableElement.getDomNode())}updateCommentBody(e){this._body.innerText="",this._md.clear(),this._plainText=void 0,typeof e=="string"?(this._plainText=ee(this._body,Y(".comment-body-plainstring")),this._plainText.innerText=e):(this._md.value=this.markdownRenderer.render(e),this._body.appendChild(this._md.value.element))}updateCommentUserIcon(e){if(this._avatar.textContent="",e){const t=ee(this._avatar,Y("img.avatar"));t.src=tc.uriToBrowserUri(R.revive(e)).toString(!0),t.onerror=i=>t.remove()}}get onDidClick(){return this._onDidClick.event}createTimestamp(e){this._timestamp=ee(e,Y("span.timestamp-container")),this.updateTimestamp(this.comment.timestamp)}updateTimestamp(e){if(!this._timestamp)return;const t=e!==void 0?new Date(e):void 0;t?this._timestampWidget?this._timestampWidget.setTimestamp(t):(this._timestampWidget=new D$(this.configurationService,this.hoverService,this._timestamp,t),this._register(this._timestampWidget)):this._timestampWidget?.dispose()}createHeader(e){const t=ee(e,Y(`div.comment-title.${KF}`)),i=ee(t,Y("comment-header-info")),n=ee(i,Y("strong.author"));n.innerText=this.comment.userName,this.createTimestamp(i),this._isPendingLabel=ee(i,Y("span.isPending")),this.comment.label?this._isPendingLabel.innerText=this.comment.label:this._isPendingLabel.innerText="",this._actionsToolbarContainer=ee(t,Y(".comment-actions")),this.createActionsToolbar()}getToolbarActions(e){const t=e.getActions({shouldForwardArgs:!0}),o={primary:[],secondary:[]};return fHe(t,o,!1,r=>/^inline/.test(r)),o}get commentNodeContext(){return[{thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,$mid:Nn.CommentNode},{commentControlHandle:this.commentThread.controllerHandle,commentThreadHandle:this.commentThread.commentThreadHandle,$mid:Nn.CommentThread}]}createToolbar(){this.toolbar.value=new WSe(this._actionsToolbarContainer,this.contextMenuService,{actionViewItemProvider:(e,t)=>e.id===nm.ID?new gC(e,e.menuActions,this.contextMenuService,{...t,actionViewItemProvider:(i,n)=>this.actionViewItemProvider(i,n),classNames:["toolbar-toggle-pickReactions",...Te.asClassNameArray(j.reactions)],anchorAlignmentProvider:()=>kb.RIGHT}):this.actionViewItemProvider(e,t),orientation:xa.HORIZONTAL}),this.toolbar.value.context=this.commentNodeContext,this.toolbar.value.actionRunner=this._actionRunner}createActionsToolbar(){const e=[],t=this._commentMenus.getCommentTitleActions(this.comment,this._contextKeyService);this._register(t),this._register(t.onDidChange(o=>{const{primary:r,secondary:a}=this.getToolbarActions(t);!this.toolbar&&(r.length||a.length)&&this.createToolbar(),this.toolbar.value.setActions(r,a)}));const{primary:i,secondary:n}=this.getToolbarActions(t);e.push(...i),(e.length||n.length)&&(this.createToolbar(),this.toolbar.value.setActions(e,n))}actionViewItemProvider(e,t){return e.id===nm.ID?t={label:!1,icon:!0}:t={label:!1,icon:!0},e.id===AL.ID?new gHe(e):e instanceof va?this.instantiationService.createInstance(yq,e,{hoverDelegate:t.hoverDelegate}):e instanceof kh?this.instantiationService.createInstance(Sne,e,t):new qm({},e,t)}async submitComment(){this._commentEditor&&this._commentFormActions&&(await this._commentFormActions.triggerDefaultAction(),this.pendingEdit=void 0)}createReactionPicker(e){const t=this._reactionActions.add(new nm(()=>{n?.show()},h(5391,"Toggle Reaction")));let i=[];e&&e.length&&(i=e.map(o=>this._reactionActions.add(new Kt(`reaction.command.${o.label}`,`${o.label}`,"",!0,async()=>{try{await this.commentService.toggleReaction(this.owner,this.resource,this.commentThread,this.comment,o)}catch(r){const a=r.message?h(5392,"Toggling the comment reaction failed: {0}.",r.message):h(5393,"Toggling the comment reaction failed");this.notificationService.error(a)}})))),t.menuActions=i;const n=this._reactionActions.add(new gC(t,t.menuActions,this.contextMenuService,{actionViewItemProvider:(o,r)=>o.id===nm.ID?n:this.actionViewItemProvider(o,r),classNames:"toolbar-toggle-pickReactions",anchorAlignmentProvider:()=>kb.RIGHT}));return t}createReactionsContainer(e){this._reactionActionsContainer?.remove(),this._reactionsActionBar.clear(),this._reactionActions.clear(),this._reactionActionsContainer=ee(e,Y("div.comment-reactions")),this._reactionsActionBar.value=new Er(this._reactionActionsContainer,{actionViewItemProvider:(i,n)=>i.id===nm.ID?new gC(i,i.menuActions,this.contextMenuService,{actionViewItemProvider:(o,r)=>this.actionViewItemProvider(o,r),classNames:["toolbar-toggle-pickReactions",...Te.asClassNameArray(j.reactions)],anchorAlignmentProvider:()=>kb.RIGHT}):this.actionViewItemProvider(i,n)});const t=this.commentService.hasReactionHandler(this.owner);if(this.comment.commentReactions?.filter(i=>!!i.count).map(i=>{const n=this._reactionActions.add(new AL(`reaction.${i.label}`,`${i.label}`,i.hasReacted&&(i.canEdit||t)?"active":"",i.canEdit||t,async()=>{try{await this.commentService.toggleReaction(this.owner,this.resource,this.commentThread,this.comment,i)}catch(o){let r;i.hasReacted?r=o.message?h(5394,"Deleting the comment reaction failed: {0}.",o.message):h(5395,"Deleting the comment reaction failed"):r=o.message?h(5396,"Deleting the comment reaction failed: {0}.",o.message):h(5397,"Deleting the comment reaction failed"),this.notificationService.error(r)}},i.reactors,i.iconPath,i.count));this._reactionsActionBar.value?.push(n,{label:!0,icon:!0})}),t){const i=this.createReactionPicker(this.comment.commentReactions||[]);this._reactionsActionBar.value?.push(i,{label:!1,icon:!0})}}get commentBodyValue(){return typeof this.comment.body=="string"?this.comment.body:this.comment.body.value}async createCommentEditor(e){this._editModeDisposables.clear();const t=ee(e,Y(".edit-textarea"));this._commentEditor=this.instantiationService.createInstance(jy,t,jy.getEditorOptions(this.configurationService),this._contextKeyService,this.parentThread),this._editModeDisposables.add(this._commentEditor);const i=R.from({scheme:ae.commentsInput,path:`/commentinput-${this.comment.uniqueIdInThread}-${Date.now()}.md`}),n=await this.textModelService.createModelReference(i);if(this._commentEditorModel=n,this._editModeDisposables.add(this._commentEditorModel),this._commentEditor.setModel(this._commentEditorModel.object.textEditorModel),this._commentEditor.setValue(this.pendingEdit?.body??this.commentBodyValue),this.pendingEdit)this._commentEditor.setPosition(this.pendingEdit.cursor);else{const r=this._commentEditorModel.object.textEditorModel.getLineCount(),a=this._commentEditorModel.object.textEditorModel.getLineLength(r)+1;this._commentEditor.setPosition(new _e(r,a))}this.pendingEdit=void 0,this._commentEditor.layout({width:t.clientWidth-14,height:this._editorHeight}),this._commentEditor.focus(),kE(bt(e),()=>{this._commentEditor.layout({width:t.clientWidth-14,height:this._editorHeight}),this._commentEditor.focus()});const o=this.commentThread;o.input={uri:this._commentEditor.getModel().uri,value:this.commentBodyValue},this.commentService.setActiveEditingCommentThread(o),this.commentService.setActiveCommentAndThread(this.owner,{thread:o,comment:this.comment}),this._editModeDisposables.add(this._commentEditor.onDidFocusEditorWidget(()=>{o.input={uri:this._commentEditor.getModel().uri,value:this.commentBodyValue},this.commentService.setActiveEditingCommentThread(o),this.commentService.setActiveCommentAndThread(this.owner,{thread:o,comment:this.comment})})),this._editModeDisposables.add(this._commentEditor.onDidChangeModelContent(r=>{if(o.input&&this._commentEditor&&this._commentEditor.getModel().uri===o.input.uri){const a=this._commentEditor.getValue();if(a!==o.input.value){const c=o.input;c.value=a,o.input=c,this.commentService.setActiveEditingCommentThread(o),this.commentService.setActiveCommentAndThread(this.owner,{thread:o,comment:this.comment})}}})),this.calculateEditorHeight(),this._editModeDisposables.add(this._commentEditorModel.object.textEditorModel.onDidChangeContent(()=>{this._commentEditor&&this.calculateEditorHeight()&&(this._commentEditor.layout({height:this._editorHeight,width:this._commentEditor.getLayoutInfo().width}),this._commentEditor.render(!0))}))}calculateEditorHeight(){if(this._commentEditor){const e=Ige(this.parentEditor,this._commentEditor,this._editorHeight);if(e!==this._editorHeight)return this._editorHeight=e,!0}return!1}getPendingEdit(){const e=this._commentEditor?.getModel();if(this._commentEditor&&e&&e.getValueLength()>0)return{body:e.getValue(),cursor:this._commentEditor.getPosition()}}removeCommentEditor(){this.isEditing=!1,this._editAction&&(this._editAction.enabled=!0),this._body.classList.remove("hidden"),this._editModeDisposables.clear(),this._commentEditor=null,this._commentEditContainer.remove()}layout(e){const t=e!==void 0?e-72:this._commentEditor?.getLayoutInfo().width??0;this._commentEditor?.layout({width:t,height:this._editorHeight});const i=this._body.scrollWidth,n=xye(this._body),o=this._body.scrollHeight,r=Iye(this._body)+4;this._scrollableElement.setScrollDimensions({width:n,scrollWidth:i,height:r,scrollHeight:o})}async switchToEditMode(){if(this.isEditing)return;this.isEditing=!0,this._body.classList.add("hidden"),this._commentEditContainer=ee(this._commentDetailsContainer,Y(".edit-container")),await this.createCommentEditor(this._commentEditContainer);const e=ee(this._commentEditContainer,Y(".form-actions")),t=ee(e,Y(".other-actions"));this.createCommentWidgetFormActions(t);const i=ee(e,Y(".editor-actions"));this.createCommentWidgetEditorActions(i)}createCommentWidgetFormActions(e){const i=this.commentService.getCommentMenus(this.owner).getCommentActions(this.comment,this._contextKeyService);this._editModeDisposables.add(i),this._editModeDisposables.add(i.onDidChange(()=>{this._commentFormActions?.setActions(i)})),this._commentFormActions=new Rx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,n=>{const o=this._commentEditor.getValue();n.run({thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,text:o,$mid:Nn.CommentThreadNode}),this.removeCommentEditor()}),this._editModeDisposables.add(this._commentFormActions),this._commentFormActions.setActions(i)}createCommentWidgetEditorActions(e){const i=this.commentService.getCommentMenus(this.owner).getCommentEditorActions(this._contextKeyService);this._editModeDisposables.add(i),this._editModeDisposables.add(i.onDidChange(()=>{this._commentEditorActions?.setActions(i,!0)})),this._commentEditorActions=new Rx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,n=>{const o=this._commentEditor.getValue();n.run({thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,text:o,$mid:Nn.CommentThreadNode}),this._commentEditor?.focus()}),this._editModeDisposables.add(this._commentEditorActions),this._commentEditorActions.setActions(i,!0)}setFocus(e,t=!1){e?(this._domNode.focus(),this._actionsToolbarContainer.classList.add("tabfocused"),this._domNode.tabIndex=0,this.comment.mode===JT.Editing&&this._commentEditor?.focus()):(this._actionsToolbarContainer.classList.contains("tabfocused")&&!this._actionsToolbarContainer.classList.contains("mouseover")&&(this._domNode.tabIndex=-1),this._actionsToolbarContainer.classList.remove("tabfocused"))}async update(e){e.body!==this.comment.body&&this.updateCommentBody(e.body),this.comment.userIconPath&&e.userIconPath&&R.from(this.comment.userIconPath).toString()!==R.from(e.userIconPath).toString()&&this.updateCommentUserIcon(e.userIconPath);const t=e.mode!==void 0&&e.mode!==this.comment.mode;this.comment=e,t&&(e.mode===JT.Editing?await this.switchToEditMode():this.removeCommentEditor()),e.label?this._isPendingLabel.innerText=e.label:this._isPendingLabel.innerText="",this.createReactionsContainer(this._commentDetailsContainer),this.comment.contextValue?this._commentContextValue.set(this.comment.contextValue):this._commentContextValue.reset(),this.comment.timestamp&&this.updateTimestamp(this.comment.timestamp)}onContextMenu(e){const t=new us(bt(this._domNode),e);this.contextMenuService.showContextMenu({getAnchor:()=>t,menuId:N.CommentThreadCommentContext,menuActionOptions:{shouldForwardArgs:!0},contextKeyService:this._contextKeyService,actionRunner:this._actionRunner,getActionsContext:()=>this.commentNodeContext})}focus(){this.domNode.focus(),this._clearTimeout||(this.domNode.classList.add("focus"),this._clearTimeout=setTimeout(()=>{this.domNode.classList.remove("focus")},3e3))}dispose(){super.dispose()}};u3=f([p(8,J),p(9,yg),p(10,At),p(11,mi),p(12,me),p(13,ne),p(14,wi),p(15,Ve),p(16,yi)],u3);function fHe(s,e,t,i=n=>n==="navigation"){for(const n of s){let[o,r]=n;if(i(o))(Array.isArray(e)?e:e.primary).unshift(...r);else{const a=Array.isArray(e)?e:e.secondary;a.length>0&&a.push(new is),a.push(...r)}}}let g3=class extends F{get length(){return this._commentThread.comments?this._commentThread.comments.length:0}get activeComment(){return this._commentElements.filter(e=>e.isEditing)[0]}constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(),this._parentEditor=e,this.owner=t,this.parentResourceUri=i,this.container=n,this._options=o,this._commentThread=r,this._pendingEdits=a,this._scopedInstatiationService=c,this._parentCommentThreadWidget=d,this.commentService=l,this.openerService=u,this.languageService=g,this._commentElements=[],this._focusedComment=void 0,this._onDidResize=new M,this.onDidResize=this._onDidResize.event,this._commentDisposable=new ei,this._register(re(n,pe.FOCUS_IN,m=>{this.commentService.setActiveEditingCommentThread(this._commentThread)})),this._markdownRenderer=new Rv(this._options,this.languageService,this.openerService)}focus(e){if(e!==void 0){const t=this._commentElements.find(i=>i.comment.uniqueIdInThread===e);if(t){t.focus();return}}this._commentsElement.focus()}hasCommentsInEditMode(){return this._commentElements.some(e=>e.isEditing)}ensureFocusIntoNewEditingComment(){this._commentElements.length===1&&this._commentElements[0].isEditing&&this._commentElements[0].setFocus(!0)}async display(){if(this._commentsElement=ee(this.container,Y("div.comments-container")),this._commentsElement.setAttribute("role","presentation"),this._commentsElement.tabIndex=0,this._updateAriaLabel(),this._register(re(this._commentsElement,pe.KEY_DOWN,e=>{const t=new zs(e);if((t.equals(S.UpArrow)||t.equals(S.DownArrow))&&(!this._focusedComment||!this._commentElements[this._focusedComment].isEditing)){const i=n=>{if(this._focusedComment===void 0&&n>=0)return 0;if(this._focusedComment===void 0&&n<0)return this._commentElements.length-1;const o=this._focusedComment+n;return Math.min(Math.max(0,o),this._commentElements.length-1)};this._setFocusedComment(t.equals(S.UpArrow)?i(-1):i(1))}})),this._commentDisposable.clearAndDisposeAll(),this._commentElements=[],this._commentThread.comments)for(const e of this._commentThread.comments){const t=this.createNewCommentNode(e);this._commentElements.push(t),this._commentsElement.appendChild(t.domNode),e.mode===JT.Editing&&await t.switchToEditMode()}this._resizeObserver=new MutationObserver(this._refresh.bind(this)),this._resizeObserver.observe(this.container,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}_refresh(){const e=Zu(this.container);this._onDidResize.fire(e)}getDimensions(){return Zu(this.container)}layout(e){this._commentElements.forEach(t=>{t.layout(e)})}getPendingEdits(){const e={};return this._commentElements.forEach(t=>{if(t.isEditing){const i=t.getPendingEdit();i&&(e[t.comment.uniqueIdInThread]=i)}}),e}getCommentCoords(e){const t=this._commentElements.filter(i=>i.comment.uniqueIdInThread===e);if(t&&t.length){const i=Ms(this._commentElements[0].domNode),n=Ms(t[0].domNode);return{thread:i,comment:n}}}async updateCommentThread(e,t){const i=this._commentElements.length,n=e.comments?e.comments.length:0,o=[],r=[];for(let u=0;u<i;u++){const g=this._commentElements[u].comment,m=e.comments?e.comments.filter(v=>v.uniqueIdInThread===g.uniqueIdInThread):[];m.length?this._commentElements[u].update(m[0]):(r.push(u),o.push(this._commentElements[u]))}for(let u=o.length-1;u>=0;u--){const g=o[u];this._commentDisposable.deleteAndDispose(g),this._commentElements.splice(r[u],1),g.domNode.remove()}let a=null;const c=[],d=[],l=[];for(let u=n-1;u>=0;u--){const g=e.comments[u],m=this._commentElements.filter(v=>v.comment.uniqueIdInThread===g.uniqueIdInThread);if(m.length)a=m[0].domNode,c.unshift(m[0]);else{const v=this.createNewCommentNode(g);c.unshift(v),a?(this._commentsElement.insertBefore(v.domNode,a),a=v.domNode):(this._commentsElement.appendChild(v.domNode),a=v.domNode),g.mode===JT.Editing&&(l.push(v.switchToEditMode()),d.push(v))}}if(this._commentThread=e,this._commentElements=c,await Promise.all(l),d.length){const u=this._commentElements.indexOf(d[d.length-1]);this._focusedComment=u}this._updateAriaLabel(),t||this._setFocusedComment(this._focusedComment)}_updateAriaLabel(){this._commentThread.isDocumentCommentThread()?this._commentThread.range?this._commentsElement.ariaLabel=h(5400,"Comment thread with {0} comments on lines {1} through {2}. {3}.",this._commentThread.comments?.length,this._commentThread.range.startLineNumber,this._commentThread.range.endLineNumber,this._commentThread.label):this._commentsElement.ariaLabel=h(5401,"Comment thread with {0} comments on the entire document. {1}.",this._commentThread.comments?.length,this._commentThread.label):this._commentsElement.ariaLabel=h(5402,"Comment thread with {0} comments. {1}.",this._commentThread.comments?.length,this._commentThread.label)}_setFocusedComment(e){this._focusedComment!==void 0&&this._commentElements[this._focusedComment]?.setFocus(!1),this._commentElements.length===0||e===void 0?this._focusedComment=void 0:(this._focusedComment=Math.min(e,this._commentElements.length-1),this._commentElements[this._focusedComment].setFocus(!0))}createNewCommentNode(e){const t=this._scopedInstatiationService.createInstance(u3,this._parentEditor,this._commentThread,e,this._pendingEdits?this._pendingEdits[e.uniqueIdInThread]:void 0,this.owner,this.parentResourceUri,this._parentCommentThreadWidget,this._markdownRenderer),i=new U;return i.add(t.onDidClick(n=>this._setFocusedComment(this._commentElements.findIndex(o=>o.comment.uniqueIdInThread===n.comment.uniqueIdInThread)))),i.add(t),this._commentDisposable.set(t,i),t}dispose(){super.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this._commentDisposable.dispose()}};g3=f([p(9,yg),p(10,hi),p(11,fi)],g3);const mHe=Ae("review-comment-collapse",j.chevronUp,h(5403,"Icon to collapse a review comment.")),zee="expand-review-action "+Te.asClassName(mHe),vHe="expand-review-action "+Te.asClassName(j.trashcan);function oF(s){return!!s&&s.length>0}let p3=class extends F{constructor(e,t,i,n,o,r,a){super(),this._delegate=t,this._commentMenus=i,this._commentThread=n,this._contextKeyService=o,this._instantiationService=r,this._contextMenuService=a,this._headElement=Y(".head"),e.appendChild(this._headElement),this._register(Ee(()=>this._headElement.remove())),this._fillHead()}_fillHead(){const e=ee(this._headElement,Y(".review-title"));this._headingLabel=ee(e,Y("span.filename")),this.createThreadLabel();const t=ee(this._headElement,Y(".review-actions"));this._actionbarWidget=new Er(t,{actionViewItemProvider:dw.bind(void 0,this._instantiationService)}),this._register(this._actionbarWidget);const i=oF(this._commentThread.comments)?zee:vHe;if(this._collapseAction=new Kt(Vc.Hide,h(5404,"Collapse"),i,!0,()=>this._delegate.collapse()),!oF(this._commentThread.comments)){const o=this._register(new kt);o.value=this._commentThread.onDidChangeComments(()=>{oF(this._commentThread.comments)&&(this._collapseAction.class=zee,o.clear())})}const n=this._commentMenus.getCommentThreadTitleActions(this._contextKeyService);this._register(n),this.setActionBarActions(n),this._register(n),this._register(n.onDidChange(o=>{this.setActionBarActions(n)})),this._register(re(this._headElement,pe.CONTEXT_MENU,o=>this.onContextMenu(o))),this._actionbarWidget.context=this._commentThread}setActionBarActions(e){const t=e.getActions({shouldForwardArgs:!0}).reduce((i,[,n])=>[...i,...n],[]);this._actionbarWidget.clear(),this._actionbarWidget.push([...t,this._collapseAction],{label:!1,icon:!0})}updateCommentThread(e){this._commentThread=e,this._actionbarWidget.context=this._commentThread,this.createThreadLabel()}createThreadLabel(){let e;e=this._commentThread.label,e===void 0&&(this._commentThread.comments&&this._commentThread.comments.length||(e=h(5405,"Start discussion"))),e&&(this._headingLabel.textContent=Fq(e),this._headingLabel.setAttribute("aria-label",e))}updateHeight(e){this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height}onContextMenu(e){const t=this._commentMenus.getCommentThreadTitleContextActions(this._contextKeyService);if(!t.length)return;const i=new us(bt(this._headElement),e);this._contextMenuActionRunner||(this._contextMenuActionRunner=this._register(new _g)),this._contextMenuService.showContextMenu({getAnchor:()=>i,getActions:()=>t,actionRunner:this._contextMenuActionRunner,getActionsContext:()=>({commentControlHandle:this._commentThread.controllerHandle,commentThreadHandle:this._commentThread.commentThreadHandle,$mid:Nn.CommentThread})})}};p3=f([p(4,me),p(5,J),p(6,mi)],p3);let f3=class extends F{constructor(e,t,i,n,o,r,a){super(),this._commentThread=t,this._contextKeyService=i,this._commentMenus=n,this._actionRunDelegate=o,this._keybindingService=r,this._contextMenuService=a,this._container=ee(e,Y(".comment-additional-actions")),ee(this._container,Y(".section-separator")),this._buttonBar=ee(this._container,Y(".button-bar")),this._createAdditionalActions(this._buttonBar)}_showMenu(){this._container?.classList.remove("hidden")}_hideMenu(){this._container?.classList.add("hidden")}_enableDisableMenu(e){const t=e.getActions({shouldForwardArgs:!0});for(const i of t){const[,n]=i;for(const o of n){if(o.enabled){this._showMenu();return}for(const r of o.actions??[])if(r.enabled){this._showMenu();return}}}this._hideMenu()}_createAdditionalActions(e){const t=this._commentMenus.getCommentThreadAdditionalActions(this._contextKeyService);this._register(t),this._register(t.onDidChange(()=>{this._commentFormActions.setActions(t,!0),this._enableDisableMenu(t)})),this._commentFormActions=new Rx(this._keybindingService,this._contextKeyService,this._contextMenuService,e,async i=>{this._actionRunDelegate?.(),i.run({thread:this._commentThread,$mid:Nn.CommentThreadInstance})},4,!0),this._register(this._commentFormActions),this._commentFormActions.setActions(t,!0),this._enableDisableMenu(t)}};f3=f([p(5,Ve),p(6,mi)],f3);var mT;function _He(s,e,t){const i=new Set;return Lo(...s.map((n,o)=>Lo(n.onDidFocus(()=>{t?.(o,"focus"),i.size||e(!0),i.add(o)}),n.onDidBlur(()=>{t?.(o,"blur"),i.delete(o),i.size||e(!1)}))))}const t5=new O("navigableContainerFocused",!1);let bv=class{static{mT=this}static{this.ID="workbench.contrib.navigableContainerManager"}constructor(e,t,i){this.logService=t,this.configurationService=i,this.containers=new Set,this.focused=t5.bindTo(e),mT.INSTANCE=this}dispose(){this.containers.clear(),this.focused.reset(),mT.INSTANCE=void 0}get debugEnabled(){return this.configurationService.getValue("workbench.navigibleContainer.enableDebug")}log(e,...t){this.debugEnabled&&this.logService.debug(e,...t)}static register(e){const t=this.INSTANCE;return t?(t.containers.add(e),t.log("NavigableContainerManager.register",e.name),Lo(_He(e.focusNotifiers,i=>{i?(t.log("NavigableContainerManager.focus",e.name),t.focused.set(!0),t.lastContainer=e):(t.log("NavigableContainerManager.blur",e.name,t.lastContainer?.name),t.lastContainer===e&&(t.focused.set(!1),t.lastContainer=void 0))},(i,n)=>{t.log("NavigableContainerManager.partFocusChange",e.name,i,n)}),Ee(()=>{t.containers.delete(e),t.log("NavigableContainerManager.unregister",e.name,t.lastContainer?.name),t.lastContainer===e&&(t.focused.set(!1),t.lastContainer=void 0)}))):F.None}static getActive(){return this.INSTANCE?.lastContainer}};bv=mT=f([p(0,me),p(1,Pe),p(2,ne)],bv);function Dge(s){return bv.register(s)}sc(bv.ID,bv,oc.BlockStartup);Le.registerCommandAndKeybindingRule({id:"widgetNavigation.focusPrevious",weight:W.WorkbenchContrib,when:x.and(t5,x.or(af?.negate(),Dye)),primary:E.CtrlCmd|S.UpArrow,handler:()=>{bv.getActive()?.focusPreviousWidget()}});Le.registerCommandAndKeybindingRule({id:"widgetNavigation.focusNext",weight:W.WorkbenchContrib,when:x.and(t5,x.or(af?.negate(),kye)),primary:E.CtrlCmd|S.DownArrow,handler:()=>{bv.getActive()?.focusNextWidget()}});Be(Yue);let m3=class extends F{get commentThread(){return this._commentThread}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){super(),this.container=e,this._parentEditor=t,this._owner=i,this._parentResourceUri=n,this._contextKeyService=o,this._scopedInstantiationService=r,this._commentThread=a,this._pendingComment=c,this._pendingEdits=d,this._markdownOptions=l,this._commentOptions=u,this._containerDelegate=g,this.commentService=m,this.configurationService=v,this._keybindingService=y,this._commentThreadDisposables=[],this._onDidResize=new M,this.onDidResize=this._onDidResize.event,this._threadIsEmpty=Za.commentThreadIsEmpty.bindTo(this._contextKeyService),this._threadIsEmpty.set(!a.comments||!a.comments.length),this._focusedContextKey=Za.commentFocused.bindTo(this._contextKeyService),this._commentMenus=this.commentService.getCommentMenus(this._owner),this._register(this._header=this._scopedInstantiationService.createInstance(p3,e,{collapse:this._containerDelegate.collapse.bind(this)},this._commentMenus,this._commentThread)),this._header.updateCommentThread(this._commentThread);const w=Y(".body");e.appendChild(w),this._register(Ee(()=>w.remove()));const C=this._register(Po(w));this._register(Dge({name:"commentThreadWidget",focusNotifiers:[C],focusNextWidget:()=>{this._commentReply?.isCommentEditorFocused()||this._commentReply?.expandReplyAreaAndFocusCommentEditor()},focusPreviousWidget:()=>{this._commentReply?.isCommentEditorFocused()&&this._commentThread.comments?.length&&this._body.focus()}})),this._register(C.onDidFocus(()=>this._focusedContextKey.set(!0))),this._register(C.onDidBlur(()=>this._focusedContextKey.reset())),this._register(this.configurationService.onDidChangeConfiguration(A=>{A.affectsConfiguration(Un.Comments)&&this._setAriaLabel()})),this._body=this._scopedInstantiationService.createInstance(g3,this._parentEditor,this._owner,this._parentResourceUri,w,this._markdownOptions,this._commentThread,this._pendingEdits,this._scopedInstantiationService,this),this._register(this._body),this._setAriaLabel(),this._styleElement=tN(this.container),this._commentThreadContextValue=Za.commentThreadContext.bindTo(this._contextKeyService),this._commentThreadContextValue.set(a.contextValue);const T=Za.commentControllerContext.bindTo(this._contextKeyService),k=this.commentService.getCommentController(this._owner);k?.contextValue&&T.set(k.contextValue),this.currentThreadListeners()}get hasUnsubmittedComments(){return!!this._commentReply?.commentEditor.getValue()||this._body.hasCommentsInEditMode()}_setAriaLabel(){let e=h(5406,"Comment"),t;const i=this.configurationService.getValue(Un.Comments);i&&(t=this._keybindingService.lookupKeybinding(Mo.OpenAccessibilityHelp,this._contextKeyService)?.getLabel()??void 0),t?e=h(5407,"{0}, use ({1}) for accessibility help",e,t):i&&(e=h(5408,"{0}, run the command Open Accessibility Help which is currently not triggerable via keybinding.",e)),this._body.container.ariaLabel=e}updateCurrentThread(e,t){e||t?this.commentService.setCurrentCommentThread(this.commentThread):this.commentService.setCurrentCommentThread(void 0)}currentThreadListeners(){let e=!1,t=!1;this._register(re(this.container,pe.MOUSE_ENTER,i=>{i.toElement===this.container&&(e=!0,this.updateCurrentThread(e,t))},!0)),this._register(re(this.container,pe.MOUSE_LEAVE,i=>{i.fromElement===this.container&&(e=!1,this.updateCurrentThread(e,t))},!0)),this._register(re(this.container,pe.FOCUS_IN,()=>{t=!0,this.updateCurrentThread(e,t)},!0)),this._register(re(this.container,pe.FOCUS_OUT,()=>{t=!1,this.updateCurrentThread(e,t)},!0))}async updateCommentThread(e){const t=this._commentThread.collapsibleState===sr.Expanded&&this._commentThreadState===ld.Unresolved&&e.state===ld.Resolved;this._commentThreadState=e.state,this._commentThread=e,Qe(this._commentThreadDisposables),this._commentThreadDisposables=[],this._bindCommentThreadListeners(),await this._body.updateCommentThread(e,this._commentReply?.isCommentEditorFocused()??!1),this._threadIsEmpty.set(!this._body.length),this._header.updateCommentThread(e),this._commentReply?.updateCommentThread(e),this._commentThread.contextValue?this._commentThreadContextValue.set(this._commentThread.contextValue):this._commentThreadContextValue.reset(),t&&this.configurationService.getValue(b1).collapseOnResolve&&this.collapse()}async display(e,t){const i=Math.max(23,Math.ceil(e*1.2));this._header.updateHeight(i),await this._body.display(),this._commentThread.canReply&&this._createCommentForm(t),this._createAdditionalActions(),this._register(this._body.onDidResize(n=>{this._refresh(n)})),this._commentThread.canReply&&this._commentReply&&this._commentReply.focusIfNeeded(),this._bindCommentThreadListeners()}_refresh(e){this._body.layout(),this._onDidResize.fire(e)}dispose(){super.dispose(),Qe(this._commentThreadDisposables),this.updateCurrentThread(!1,!1)}_bindCommentThreadListeners(){this._commentThreadDisposables.push(this._commentThread.onDidChangeCanReply(()=>{this._commentReply?this._commentReply.updateCanReply():this._commentThread.canReply&&this._createCommentForm(!1)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async e=>{await this.updateCommentThread(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeLabel(e=>{this._header.createThreadLabel()}))}_createCommentForm(e){this._commentReply=this._scopedInstantiationService.createInstance(h3,this._owner,this._body.container,this._parentEditor,this._commentThread,this._scopedInstantiationService,this._contextKeyService,this._commentMenus,this._commentOptions,this._pendingComment,this,e,this._containerDelegate.actionRunner),this._register(this._commentReply)}_createAdditionalActions(){this._additionalActions=this._scopedInstantiationService.createInstance(f3,this._body.container,this._commentThread,this._contextKeyService,this._commentMenus,this._containerDelegate.actionRunner),this._register(this._additionalActions)}getCommentCoords(e){return this._body.getCommentCoords(e)}getPendingEdits(){return this._body.getPendingEdits()}getPendingComment(){if(this._commentReply)return this._commentReply.getPendingComment()}setPendingComment(e){this._pendingComment=e,this._commentReply?.setPendingComment(e)}getDimensions(){return this._body.getDimensions()}layout(e){this._body.layout(e),e!==void 0&&this._commentReply?.layout(e)}ensureFocusIntoNewEditingComment(){this._body.ensureFocusIntoNewEditingComment()}focusCommentEditor(){this._commentReply?.expandReplyAreaAndFocusCommentEditor()}focus(e){this._body.focus(e)}async submitComment(){const e=this._body.activeComment;if(e)return e.submitComment();if((this._commentReply?.getPendingComment()?.body.length??0)>0)return this._commentReply?.submitComment()}async collapse(){await this._containerDelegate.collapse()&&P.isIRange(this.commentThread.range)&&Ao(this._parentEditor)&&this._parentEditor.setSelection(this.commentThread.range)}applyTheme(e,t){const i=[];i.push(`.monaco-editor .review-widget > .body { border-top: 1px solid var(${Gue}) }`),i.push(`.monaco-editor .review-widget > .head { background-color: var(${que}) }`);const n=e.getColor(xie);n&&i.push(`.review-widget .body .comment-body a { color: ${n} }`);const o=e.getColor(Tye);o&&i.push(`.review-widget .body .comment-body a:hover, a:active { color: ${o} }`);const r=e.getColor(kT);r&&(i.push(`.review-widget .body .comment-body a:focus { outline: 1px solid ${r}; }`),i.push(`.review-widget .body .monaco-editor.focused { outline: 1px solid ${r}; }`));const a=e.getColor(Aye);a&&i.push(`.review-widget .body .review-comment blockquote { background: ${a}; }`);const c=e.getColor(Rye);c&&i.push(`.review-widget .body .review-comment blockquote { border-color: ${c}; }`);const d=e.getColor(UE);d&&i.push(`.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label { border-color: ${d}; }`);const l=e.getColor(et);l&&(i.push(`.review-widget .body .comment-form .review-thread-reply-button { outline-color: ${l}; }`),i.push(`.review-widget .body .monaco-editor { outline: 1px solid ${l}; }`));const u=e.getColor(Pye);u&&i.push(`.review-widget .validation-error { border: 1px solid ${u}; }`);const g=e.getColor(Lye);g&&i.push(`.review-widget .validation-error { background: ${g}; }`);const m=e.getColor(Mye);m&&i.push(`.review-widget .body .comment-form .validation-error { color: ${m}; }`);const v="--comment-thread-editor-font-family",y="--comment-thread-editor-font-size",w="--comment-thread-editor-font-weight";this.container?.style.setProperty(v,t.fontFamily),this.container?.style.setProperty(y,`${t.fontSize}px`),this.container?.style.setProperty(w,t.fontWeight),i.push(`.review-widget .body code {
			font-family: var(${v});
			font-weight: var(${w});
		}`),this._styleElement.textContent=i.join(`
`),this._commentReply?.setCommentEditorDecorations()}};m3=f([p(12,yg),p(13,ne),p(14,Ve)],m3);function Kee(s,e){return cBe(s,e)??e.getColor(iae)}var il;(function(s){s[s.None=0]="None",s[s.Widget=1]="Widget",s[s.Editor=2]="Editor"})(il||(il={}));function bHe(s){const e=s.target.range;if(!e||!s.event.leftButton||s.target.type!==Ei.GUTTER_LINE_DECORATIONS)return null;const t=s.target.detail;return t.offsetX-t.glyphMarginWidth-t.lineNumbersWidth-t.glyphMarginLeft>20?null:{lineNumber:e.startLineNumber}}function yHe(s,e){if(!s)return null;const{lineNumber:t}=s;return e.target.range?t:null}let v3=class extends Zre{get uniqueOwner(){return this._uniqueOwner}get commentThread(){return this._commentThread}get expanded(){return this._isExpanded}constructor(e,t,i,n,o,r,a,c,d,l,u){super(e,{keepEditorSelection:!0,isAccessible:!0,showArrow:!!i.range}),this._uniqueOwner=t,this._commentThread=i,this._pendingComment=n,this._pendingEdits=o,this.themeService=a,this.commentService=c,this.configurationService=l,this.dialogService=u,this._onDidClose=new M,this._onDidCreateThread=new M,this._globalToDispose=new U,this._commentThreadDisposables=[],this._contextKeyService=d.createScoped(this.domNode),this._scopedInstantiationService=this._globalToDispose.add(r.createChild(new pf([me,this._contextKeyService])));const g=this.commentService.getCommentController(this._uniqueOwner);g&&(this._commentOptions=g.options),this._initialCollapsibleState=n?sr.Expanded:i.initialCollapsibleState,i.initialCollapsibleState=this._initialCollapsibleState,this._commentThreadDisposables=[],this.create(),this._globalToDispose.add(this.themeService.onDidColorThemeChange(this._applyTheme,this)),this._globalToDispose.add(this.editor.onDidChangeConfiguration(m=>{m.hasChanged(L.fontInfo)&&this._applyTheme(this.themeService.getColorTheme())})),this._applyTheme(this.themeService.getColorTheme())}get onDidClose(){return this._onDidClose.event}get onDidCreateThread(){return this._onDidCreateThread.event}getPosition(){if(this.position)return this.position;if(this._commentGlyph)return this._commentGlyph.getPosition().position??void 0}revealRange(){}reveal(e,t=il.None){this.makeVisible(e,t);const i=this._commentThread.comments?.find(n=>n.uniqueIdInThread===e)??this._commentThread.comments?.[0];this.commentService.setActiveCommentAndThread(this.uniqueOwner,{thread:this._commentThread,comment:i})}_expandAndShowZoneWidget(){this._isExpanded||this.show(this.arrowPosition(this._commentThread.range),2)}_setFocus(e,t){t===il.Widget?this._commentThreadWidget.focus(e):t===il.Editor&&this._commentThreadWidget.focusCommentEditor()}_goToComment(e,t){const i=this.editor.getLayoutInfo().height,n=this._commentThreadWidget.getCommentCoords(e);if(n){let o=1;if(this._commentThread.range){const r=n.thread,a=n.comment;o=this.editor.getTopForLineNumber(this._commentThread.range.startLineNumber)-i/2+a.top-r.top}this.editor.setScrollTop(o),this._setFocus(e,t)}else this._goToThread(t)}_goToThread(e){const t=this._commentThread.range?new P(this._commentThread.range.startLineNumber,this._commentThread.range.startColumn,this._commentThread.range.endLineNumber+1,1):new P(1,1,1,1);this.editor.revealRangeInCenter(t),this._setFocus(void 0,e)}makeVisible(e,t=il.None){this._expandAndShowZoneWidget(),e!==void 0?this._goToComment(e,t):this._goToThread(t)}getPendingComments(){return{newComment:this._commentThreadWidget.getPendingComment(),edits:this._commentThreadWidget.getPendingEdits()}}setPendingComment(e){this._pendingComment=e,this.expand(),this._commentThreadWidget.setPendingComment(e)}_fillContainer(e){this.setCssClass("review-widget"),this._commentThreadWidget=this._scopedInstantiationService.createInstance(m3,e,this.editor,this._uniqueOwner,this.editor.getModel().uri,this._contextKeyService,this._scopedInstantiationService,this._commentThread,this._pendingComment,this._pendingEdits,{editor:this.editor,codeBlockFontSize:"",codeBlockFontFamily:this.configurationService.getValue("editor").fontFamily||BM.fontFamily},this._commentOptions,{actionRunner:async()=>{if(!this._commentThread.comments||!this._commentThread.comments.length){const t=this.getPosition();if(t){const i=this._commentThread.range;if(!i)return;let n;if(t.lineNumber!==i.endLineNumber){const o=t.lineNumber-i.endLineNumber;n=new P(i.startLineNumber+o,i.startColumn,i.endLineNumber+o,i.endColumn)}else n=new P(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn);await this.commentService.updateCommentThreadTemplate(this.uniqueOwner,this._commentThread.commentThreadHandle,n)}}},collapse:()=>this.collapse(!0)}),this._disposables.add(this._commentThreadWidget)}arrowPosition(e){if(e)return{lineNumber:e.endLineNumber,column:e.endLineNumber===e.startLineNumber?(e.startColumn+e.endColumn+1)/2:1}}deleteCommentThread(){this.dispose(),this.commentService.disposeCommentThread(this.uniqueOwner,this._commentThread.threadId)}doCollapse(){this._commentThread.collapsibleState=sr.Collapsed}async collapse(e=!1){return!e||await this.confirmCollapse()?(this.doCollapse(),!0):!1}async confirmCollapse(){if(this.configurationService.getValue("comments.thread.confirmOnCollapse")==="whenHasUnsubmittedComments"&&this._commentThreadWidget.hasUnsubmittedComments){const t=await this.dialogService.confirm({message:h(5409,"Collapsing this comment thread will discard unsubmitted comments. Are you sure you want to discard these comments?"),primaryButton:h(5410,"Discard"),type:Me.Warning,checkbox:{label:h(5411,"Never ask me again"),checked:!1}});return t.checkboxChecked&&await this.configurationService.updateValue("comments.thread.confirmOnCollapse","never"),t.confirmed}return!0}expand(e){this._commentThread.collapsibleState=sr.Expanded,e&&this.commentService.setActiveCommentAndThread(this.uniqueOwner,{thread:this._commentThread})}getGlyphPosition(){return this._commentGlyph?this._commentGlyph.getPosition().position.lineNumber:0}async update(e){this._commentThread!==e&&(this._commentThreadDisposables.forEach(n=>n.dispose()),this._commentThread=e,this._commentThreadDisposables=[],this.bindCommentThreadListeners()),await this._commentThreadWidget.updateCommentThread(e);const t=this._commentThread.range?.endLineNumber??1;let i=!1;this._commentGlyph&&(this._commentGlyph.setThreadState(e.state),this._commentGlyph.getPosition().position.lineNumber!==t&&(i=!0,this._commentGlyph.setLineNumber(t))),i&&this._isExpanded||this._commentThread.collapsibleState===sr.Expanded&&!this._isExpanded?this.show(this.arrowPosition(this._commentThread.range),2):this._commentThread.collapsibleState!==sr.Expanded&&this.hide()}_onWidth(e){this._commentThreadWidget.layout(e)}_doLayout(e,t){this._commentThreadWidget.layout(t)}async display(e,t){e&&(this._commentGlyph=new vD(this.editor,e?.endLineNumber??-1),this._commentGlyph.setThreadState(this._commentThread.state),this._globalToDispose.add(this._commentGlyph.onDidChangeLineNumber(async i=>{if(!this._commentThread.range)return;const n=i-this._commentThread.range.endLineNumber,o=new P(this._commentThread.range.startLineNumber+n,this._commentThread.range.startColumn,this._commentThread.range.endLineNumber+n,this._commentThread.range.endColumn);this._commentThread.range=o}))),await this._commentThreadWidget.display(this.editor.getOption(L.lineHeight),t),this._disposables.add(this._commentThreadWidget.onDidResize(i=>{this._refresh(i)})),this._commentThread.collapsibleState===sr.Expanded&&this.show(this.arrowPosition(e),2),t&&this.makeVisible(),this.bindCommentThreadListeners()}bindCommentThreadListeners(){if(this._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async e=>{await this.update(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeCollapsibleState(e=>{if(e===sr.Expanded&&!this._isExpanded){this.show(this.arrowPosition(this._commentThread.range),2),this._commentThreadWidget.ensureFocusIntoNewEditingComment();return}if(e===sr.Collapsed&&this._isExpanded){this.hide();return}})),this._initialCollapsibleState===void 0){const e=this._commentThread.onDidChangeInitialCollapsibleState(t=>{this._initialCollapsibleState=t,this._commentThread.collapsibleState=this._initialCollapsibleState,e.dispose()});this._commentThreadDisposables.push(e)}this._commentThreadDisposables.push(this._commentThread.onDidChangeState(()=>{const e=Kee(this._commentThread.state,this.themeService.getColorTheme())||be.transparent;this.style({frameColor:e,arrowColor:e}),this.container?.style.setProperty(Gue,`${e}`),this.container?.style.setProperty(que,`${e.transparent(.1)}`)}))}async submitComment(){return this._commentThreadWidget.submitComment()}_refresh(e){if(this._isExpanded===void 0&&e.height===0&&e.width===0){this.commentThread.collapsibleState=sr.Collapsed;return}if(this._isExpanded){this._commentThreadWidget.layout();const t=Math.ceil(this.editor.getOption(L.lineHeight)*1.2),i=this.editor.getOption(L.lineHeight),n=Math.round(i/3),o=Math.round(i/9)*2,r=Math.ceil((t+e.height+n+o+8)/i);if(this._viewZone?.heightInLines===r)return;const a=this.getPosition();this._viewZone&&a&&a.lineNumber!==this._viewZone.afterLineNumber&&this._viewZone.afterLineNumber!==0&&(this._viewZone.afterLineNumber=a.lineNumber);const c=cy.capture(this.editor);this._relayout(r),c.restore(this.editor)}}_applyTheme(e){const t=Kee(this._commentThread.state,this.themeService.getColorTheme())||be.transparent;this.style({arrowColor:t,frameColor:t});const i=this.editor.getOption(L.fontInfo);this._commentThreadWidget.applyTheme(e,i)}show(e,t){const i=this._commentGlyph?.getPosition();let n=P.isIRange(e)?e:e?P.fromPositions(e):void 0;if(i?.position&&n&&i.position.lineNumber!==n.endLineNumber){const o=i.position.lineNumber-n.endLineNumber;n=new P(n.startLineNumber+o,n.startColumn,n.endLineNumber+o,n.endColumn)}this._isExpanded=!0,super.show(n??new P(0,0,0,0),t),this._commentThread.collapsibleState=sr.Expanded,this._refresh(this._commentThreadWidget.getDimensions())}async collapseAndFocusRange(){await this.collapse(!0)&&P.isIRange(this.commentThread.range)&&Ao(this.editor)&&this.editor.setSelection(this.commentThread.range)}hide(){this._isExpanded&&(this._isExpanded=!1,this.editor.hasWidgetFocus()&&this.editor.focus(),(!this._commentThread.comments||!this._commentThread.comments.length)&&this.deleteCommentThread()),super.hide()}dispose(){super.dispose(),this._commentGlyph&&(this._commentGlyph.dispose(),this._commentGlyph=void 0),this._globalToDispose.dispose(),this._commentThreadDisposables.forEach(e=>e.dispose()),this._onDidClose.fire(void 0)}};v3=f([p(5,J),p(6,ft),p(7,yg),p(8,me),p(9,ne),p(10,Qt)],v3);class jee{get id(){return this._decorationId}set id(e){this._decorationId=e}constructor(e,t){this.range=e,this.options=t}}class RL extends F{static{this.description="comment-thread-range-decorator"}constructor(e){super(),this.decorationIds=[],this.activeDecorationIds=[],this.threadCollapseStateListeners=[];const t={description:RL.description,isWholeLine:!1,zIndex:20,className:"comment-thread-range",shouldFillLineOnLineBreak:!0};this.decorationOptions=Yt.createDynamic(t);const i={description:RL.description,isWholeLine:!1,zIndex:20,className:"comment-thread-range-current",shouldFillLineOnLineBreak:!0};this.activeDecorationOptions=Yt.createDynamic(i),this._register(e.onDidChangeCurrentCommentThread(n=>{this.updateCurrent(n)})),this._register(e.onDidUpdateCommentThreads(()=>{this.updateCurrent(void 0)}))}updateCurrent(e){if(!this.editor||e?.resource&&e.resource?.toString()!==this.editor.getModel()?.uri.toString())return;this.currentThreadCollapseStateListener?.dispose();const t=[];if(e){const i=e.range;i&&!(i.startLineNumber===i.endLineNumber&&i.startColumn===i.endColumn)&&e.collapsibleState===sr.Expanded&&(this.currentThreadCollapseStateListener=e.onDidChangeCollapsibleState(n=>{n===sr.Collapsed&&this.updateCurrent(void 0)}),t.push(new jee(i,this.activeDecorationOptions)))}this.editor.changeDecorations(i=>{this.activeDecorationIds=i.deltaDecorations(this.activeDecorationIds,t),t.forEach((n,o)=>n.id=this.decorationIds[o])})}update(e,t){const i=e?.getModel();if(!e||!i)return;Qe(this.threadCollapseStateListeners),this.editor=e;const n=[];for(const o of t)o.threads.forEach(r=>{if(r.isDisposed)return;const a=r.range;!a||a.startLineNumber===a.endLineNumber&&a.startColumn===a.endColumn||(this.threadCollapseStateListeners.push(r.onDidChangeCollapsibleState(()=>{this.update(e,t)})),r.collapsibleState!==sr.Collapsed&&n.push(new jee(a,this.decorationOptions)))});e.changeDecorations(o=>{this.decorationIds=o.deltaDecorations(this.decorationIds,n),n.forEach((r,a)=>r.id=this.decorationIds[a])})}dispose(){Qe(this.threadCollapseStateListeners),this.currentThreadCollapseStateListener?.dispose(),super.dispose()}}Be(Yue);const wHe="editor.contrib.review";class Bg{get id(){return this._decorationId}set id(e){this._decorationId=e}get range(){return{startLineNumber:this._startLineNumber,startColumn:1,endLineNumber:this._endLineNumber,endColumn:1}}constructor(e,t,i,n,o,r,a,c=!1){this._editor=e,this._ownerId=t,this._extensionId=i,this._label=n,this._range=o,this.options=r,this.commentingRangesInfo=a,this.isHover=c,this._startLineNumber=o.startLineNumber,this._endLineNumber=o.endLineNumber}getCommentAction(){return{extensionId:this._extensionId,label:this._label,ownerId:this._ownerId,commentingRangesInfo:this.commentingRangesInfo}}getOriginalRange(){return this._range}getActiveRange(){return this.id?this._editor.getModel().getDecorationRange(this.id):void 0}}class jb{static{this.description="commenting-range-decorator"}constructor(){this.commentingRangeDecorations=[],this.decorationIds=[],this._lastHover=-1,this._onDidChangeDecorationsCount=new M,this.onDidChangeDecorationsCount=this._onDidChangeDecorationsCount.event;const e={description:jb.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph comment-diff-added"};this.decorationOptions=Yt.createDynamic(e);const t={description:jb.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph line-hover"};this.hoverDecorationOptions=Yt.createDynamic(t);const i={description:jb.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph multiline-add"};this.multilineDecorationOptions=Yt.createDynamic(i)}updateHover(e){this._editor&&this._infos&&e!==this._lastHover&&this._doUpdate(this._editor,this._infos,e),this._lastHover=e??-1}updateSelection(e,t=new P(0,0,0,0)){this._lastSelection=t.isEmpty()?void 0:t,this._lastSelectionCursor=t.isEmpty()?void 0:e,this._editor&&this._infos&&this._doUpdate(this._editor,this._infos,e,t)}update(e,t,i,n){e&&(this._editor=e,this._infos=t,this._doUpdate(e,t,i,n))}_lineHasThread(e,t){return e.getDecorationsInRange(t)?.find(i=>i.options.description===vD.description)}_doUpdate(e,t,i=-1,n=this._lastSelection){if(!e.getModel())return;i=this._lastSelectionCursor??i;const r=[];for(const c of t)c.commentingRanges.ranges.forEach(d=>{const l=new P(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn);let u=n?l.intersectRanges(n):void 0;if(n&&i>=0&&u&&!(u.startLineNumber===u.endLineNumber&&i===u.startLineNumber)){let g;i<=u.startLineNumber?(g=u.collapseToStart(),u=new P(u.startLineNumber+1,1,u.endLineNumber,1)):(g=new P(u.endLineNumber,1,u.endLineNumber,1),u=new P(u.startLineNumber,1,u.endLineNumber-1,1)),r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,u,this.multilineDecorationOptions,c.commentingRanges,!0)),this._lineHasThread(e,g)||r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,g,this.hoverDecorationOptions,c.commentingRanges,!0));const m=Math.min(g.startLineNumber,u.startLineNumber)-1,v=l.startLineNumber<=m,y=Math.max(g.endLineNumber,u.endLineNumber)+1,w=l.endLineNumber>=y;if(v){const C=new P(d.startLineNumber,1,m,1);r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,C,this.decorationOptions,c.commentingRanges,!0))}if(w){const C=new P(y,1,d.endLineNumber,1);r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,C,this.decorationOptions,c.commentingRanges,!0))}}else if(l.startLineNumber<=i&&i<=l.endLineNumber){if(l.startLineNumber<i){const m=new P(d.startLineNumber,1,i-1,1);r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,m,this.decorationOptions,c.commentingRanges,!0))}const g=new P(i,1,i,1);if(this._lineHasThread(e,g)||r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,g,this.hoverDecorationOptions,c.commentingRanges,!0)),i<l.endLineNumber){const m=new P(i+1,1,d.endLineNumber,1);r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,m,this.decorationOptions,c.commentingRanges,!0))}}else r.push(new Bg(e,c.uniqueOwner,c.extensionId,c.label,d,this.decorationOptions,c.commentingRanges))});e.changeDecorations(c=>{this.decorationIds=c.deltaDecorations(this.decorationIds,r),r.forEach((d,l)=>d.id=this.decorationIds[l])});const a=this.commentingRangeDecorations.length-r.length;this.commentingRangeDecorations=r,a&&this._onDidChangeDecorationsCount.fire(this.commentingRangeDecorations.length)}areRangesIntersectingOrTouchingByLine(e,t){return!(e.endLineNumber<t.startLineNumber-1||t.endLineNumber+1<e.startLineNumber)}getMatchedCommentAction(e){if(e===void 0){const n=this._infos?.filter(o=>o.commentingRanges.fileComments);return n?n.map(o=>({action:{ownerId:o.uniqueOwner,extensionId:o.extensionId,label:o.label,commentingRangesInfo:o.commentingRanges}})):[]}const t=new Map;for(const n of this.commentingRangeDecorations){const o=n.getActiveRange();if(o&&this.areRangesIntersectingOrTouchingByLine(o,e)){const r=n.getCommentAction(),a=t.get(r.ownerId);if(a?.action.commentingRangesInfo===r.commentingRangesInfo){const c=new P(o.startLineNumber<a.range.startLineNumber?o.startLineNumber:a.range.startLineNumber,o.startColumn<a.range.startColumn?o.startColumn:a.range.startColumn,o.endLineNumber>a.range.endLineNumber?o.endLineNumber:a.range.endLineNumber,o.endColumn>a.range.endColumn?o.endColumn:a.range.endColumn);t.set(r.ownerId,{range:c,action:r})}else t.set(r.ownerId,{range:o,action:r})}}const i=new Set;return Array.from(t.values()).filter(n=>i.has(n.action.ownerId)?!1:(i.add(n.action.ownerId),!0))}getNearestCommentingRange(e,t){let i,n;if(t){n=[];for(let o=this.commentingRangeDecorations.length-1;o>=0;o--)n.push(this.commentingRangeDecorations[o])}else n=this.commentingRangeDecorations;for(const o of n){const r=o.getActiveRange();if(r){if(i&&this.areRangesIntersectingOrTouchingByLine(r,i)){i=P.plusRange(i,r);continue}if(r.startLineNumber<=e.lineNumber&&e.lineNumber<=r.endLineNumber){i=new P(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn);continue}if(!(!t&&r.endLineNumber<e.lineNumber)&&!(t&&r.startLineNumber>e.lineNumber))return r}}return n.length>0?n[0].getActiveRange()??void 0:void 0}dispose(){this.commentingRangeDecorations=[]}}function kge(s,e,t,i,n,o,r,a,c){if(!i.resource)return;s.isCommentingEnabled||s.enableCommenting(!0);const d=i.range,l=o?il.Editor:a?il.None:il.Widget,u=e.activeTextEditorControl,g=$p(u)?[u.getOriginalEditor(),u.getModifiedEditor()]:u?[u]:[],m=i.threadId,v=n?.uniqueIdInThread,y=R.parse(i.resource);for(const w of g){const C=w.getModel();if(C instanceof ty&&t.extUri.isEqual(y,C.uri)){m&&Ao(w)&&PL.get(w)?.revealCommentThread(m,v,!0,l);return}}e.openEditor({resource:y,options:{pinned:r,preserveFocus:a,selection:d??new P(1,1,1,1)}},c?xr:cl).then(w=>{if(w){const C=w.getControl();m&&Ao(C)&&PL.get(C)?.revealCommentThread(m,v,!0,l)}})}let PL=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){this.commentService=t,this.instantiationService=i,this.codeEditorService=n,this.contextMenuService=o,this.quickInputService=r,this.viewsService=a,this.configurationService=c,this.editorService=l,this.keybindingService=u,this.accessibilityService=g,this.notificationService=m,this.globalToDispose=new U,this.localToDispose=new U,this.mouseDownInfo=null,this._commentingRangeSpaceReserved=!1,this._commentingRangeAmountReserved=0,this._emptyThreadsToAddQueue=[],this._inProcessContinueOnComments=new Map,this._editorDisposables=[],this._hasRespondedToEditorChange=!1,this._commentInfos=[],this._commentWidgets=[],this._pendingNewCommentCache={},this._pendingEditsCache={},this._computePromise=null,this._activeCursorHasCommentingRange=Za.activeCursorHasCommentingRange.bindTo(d),this._activeCursorHasComment=Za.activeCursorHasComment.bindTo(d),this._activeEditorHasCommentingRange=Za.activeEditorHasCommentingRange.bindTo(d),!(e instanceof pd)&&(this.editor=e,this._commentingRangeDecorator=new jb,this.globalToDispose.add(this._commentingRangeDecorator.onDidChangeDecorationsCount(v=>{v===0?this.clearEditorListeners():this._editorDisposables.length===0&&this.registerEditorListeners()})),this.globalToDispose.add(this._commentThreadRangeDecorator=new RL(this.commentService)),this.globalToDispose.add(this.commentService.onDidDeleteDataProvider(v=>{v?(delete this._pendingNewCommentCache[v],delete this._pendingEditsCache[v]):(this._pendingNewCommentCache={},this._pendingEditsCache={}),this.beginCompute()})),this.globalToDispose.add(this.commentService.onDidSetDataProvider(v=>this.beginComputeAndHandleEditorChange())),this.globalToDispose.add(this.commentService.onDidUpdateCommentingRanges(v=>this.beginComputeAndHandleEditorChange())),this.globalToDispose.add(this.commentService.onDidSetResourceCommentInfos(async v=>{const y=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;y&&y.toString()===v.resource.toString()&&await this.setComments(v.commentInfos.filter(w=>w!==null))})),this.globalToDispose.add(this.commentService.onDidChangeCommentingEnabled(v=>{v?(this.registerEditorListeners(),this.beginCompute()):(this.tryUpdateReservedSpace(),this.clearEditorListeners(),this._commentingRangeDecorator.update(this.editor,[]),this._commentThreadRangeDecorator.update(this.editor,[]),Qe(this._commentWidgets),this._commentWidgets=[])})),this.globalToDispose.add(this.editor.onWillChangeModel(v=>this.onWillChangeModel(v))),this.globalToDispose.add(this.editor.onDidChangeModel(v=>this.onModelChanged())),this.globalToDispose.add(this.configurationService.onDidChangeConfiguration(v=>{v.affectsConfiguration("diffEditor.renderSideBySide")&&this.beginCompute()})),this.onModelChanged(),this.codeEditorService.registerDecorationType("comment-controller",uHe,{}),this.globalToDispose.add(this.commentService.registerContinueOnCommentProvider({provideContinueOnComments:()=>{const v=[];if(this._commentWidgets)for(const y of this._commentWidgets){const C=y.getPendingComments().newComment;if(!C)continue;let T;if(y.commentThread.comments&&y.commentThread.comments.length){const k=y.commentThread.comments[y.commentThread.comments.length-1];typeof k.body=="string"?T=k.body:T=k.body.value}C.body!==T&&v.push({uniqueOwner:y.uniqueOwner,uri:y.editor.getModel().uri,range:y.commentThread.range,comment:C,isReply:y.commentThread.comments!==void 0&&y.commentThread.comments.length>0})}return v}})))}registerEditorListeners(){this._editorDisposables=[],this.editor&&(this._editorDisposables.push(this.editor.onMouseMove(e=>this.onEditorMouseMove(e))),this._editorDisposables.push(this.editor.onMouseLeave(()=>this.onEditorMouseLeave())),this._editorDisposables.push(this.editor.onDidChangeCursorPosition(e=>this.onEditorChangeCursorPosition(e.position))),this._editorDisposables.push(this.editor.onDidFocusEditorWidget(()=>this.onEditorChangeCursorPosition(this.editor?.getPosition()??null))),this._editorDisposables.push(this.editor.onDidChangeCursorSelection(e=>this.onEditorChangeCursorSelection(e))),this._editorDisposables.push(this.editor.onDidBlurEditorWidget(()=>this.onEditorChangeCursorSelection())))}clearEditorListeners(){Qe(this._editorDisposables),this._editorDisposables=[]}onEditorMouseLeave(){this._commentingRangeDecorator.updateHover()}onEditorMouseMove(e){const t=e.target.position?.lineNumber;e.event.leftButton.valueOf()&&t&&this.mouseDownInfo?this._commentingRangeDecorator.updateSelection(t,new P(this.mouseDownInfo.lineNumber,1,t,1)):this._commentingRangeDecorator.updateHover(t)}onEditorChangeCursorSelection(e){const t=this.editor?.getPosition()?.lineNumber;t&&this._commentingRangeDecorator.updateSelection(t,e?.selection)}onEditorChangeCursorPosition(e){if(!e)return;const t=P.fromPositions(e,{column:-1,lineNumber:e.lineNumber}),i=this.editor?.getDecorationsInRange(t);let n=!1;if(i)for(const o of i)if(o.options.description===vD.description){n=!1;break}else o.options.description===jb.description&&(n=!0);this._activeCursorHasCommentingRange.set(n),this._activeCursorHasComment.set(this.getCommentsAtLine(t).length>0)}isEditorInlineOriginal(e){return this.configurationService.getValue("diffEditor.renderSideBySide")?!1:!!this.editorService.visibleTextEditorControls.find(i=>i.getEditorType()===Nye.IDiffEditor?i.getOriginalEditor()===e:!1)}beginCompute(){return this._computePromise=En(e=>{const t=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;return t?this.commentService.getDocumentComments(t):Promise.resolve([])}),this._computeAndSetPromise=this._computePromise.then(async e=>{await this.setComments(Vt(e)),this._computePromise=null},e=>console.log(e)),this._computePromise.then(()=>this._computeAndSetPromise=void 0),this._computeAndSetPromise}beginComputeCommentingRanges(){this._computeCommentingRangeScheduler&&(this._computeCommentingRangePromise&&(this._computeCommentingRangePromise.cancel(),this._computeCommentingRangePromise=null),this._computeCommentingRangeScheduler.trigger(()=>{const e=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;return e?this.commentService.getDocumentComments(e):Promise.resolve([])}).then(e=>{if(this.commentService.isCommentingEnabled){const t=Vt(e);this._commentingRangeDecorator.update(this.editor,t,this.editor?.getPosition()?.lineNumber,this.editor?.getSelection()??void 0)}},e=>(mt(e),null)))}static get(e){return e.getContribution(wHe)}revealCommentThread(e,t,i,n){const o=this._commentWidgets.filter(r=>r.commentThread.threadId===e);o.length===1?o[0].reveal(t,n):i&&(this._computeAndSetPromise?this._computeAndSetPromise.then(r=>{this.revealCommentThread(e,t,!1,n)}):this.beginCompute().then(r=>{this.revealCommentThread(e,t,!1,n)}))}collapseAll(){for(const e of this._commentWidgets)e.collapse(!0)}expandAll(){for(const e of this._commentWidgets)e.expand()}expandUnresolved(){for(const e of this._commentWidgets)e.commentThread.state===ld.Unresolved&&e.expand()}nextCommentThread(e){this._findNearestCommentThread(e)}_findNearestCommentThread(e,t){if(!this._commentWidgets.length||!this.editor?.hasModel())return;const i=t?this.editor.getSelection().getStartPosition():this.editor.getSelection().getEndPosition(),n=this._commentWidgets.sort((a,c)=>{if(t){const d=a;a=c,c=d}return a.commentThread.range===void 0?-1:c.commentThread.range===void 0?1:a.commentThread.range.startLineNumber<c.commentThread.range.startLineNumber?-1:a.commentThread.range.startLineNumber>c.commentThread.range.startLineNumber?1:a.commentThread.range.startColumn<c.commentThread.range.startColumn?-1:a.commentThread.range.startColumn>c.commentThread.range.startColumn?1:0}),o=ise(n,a=>{const c=t?i.lineNumber:a.commentThread.range?.startLineNumber??0,d=t?a.commentThread.range?.startLineNumber??0:i.lineNumber,l=t?i.column:a.commentThread.range?.startColumn??0,u=t?a.commentThread.range?.startColumn??0:i.column;return c>d?!0:c<d?!1:l>u}),r=n[o];r!==void 0&&(this.editor.setSelection(r.commentThread.range??new P(1,1,1,1)),r.reveal(void 0,e?il.Widget:il.None))}previousCommentThread(e){this._findNearestCommentThread(e,!0)}_findNearestCommentingRange(e){if(!this.editor?.hasModel())return;const t=this.editor.getSelection().getEndPosition(),i=this._commentingRangeDecorator.getNearestCommentingRange(t,e);if(i){const n=e?i.getEndPosition():i.getStartPosition();this.editor.setPosition(n),this.editor.revealLineInCenterIfOutsideViewport(n.lineNumber)}if(this.accessibilityService.isScreenReaderOptimized()){const n=i?.getStartPosition().lineNumber,o=i?.getEndPosition().lineNumber;n&&o&&(n===o?Kc(h(5443,"Line {0}",n)):Kc(h(5444,"Lines {0} to {1}",n,o)))}}nextCommentingRange(){this._findNearestCommentingRange()}previousCommentingRange(){this._findNearestCommentingRange(!0)}dispose(){this.globalToDispose.dispose(),this.localToDispose.dispose(),Qe(this._editorDisposables),Qe(this._commentWidgets),this.editor=null}onWillChangeModel(e){e.newModelUrl&&this.tryUpdateReservedSpace(e.newModelUrl)}async handleCommentAdded(e,t,i){if(this._commentWidgets.filter(u=>u.uniqueOwner===t&&u.commentThread.threadId===i.threadId).length)return;const o=this._commentWidgets.filter(u=>u.uniqueOwner===t&&u.commentThread.commentThreadHandle===-1&&P.equalsRange(u.commentThread.range,i.range));if(o.length){o[0].update(i);return}const r=this._inProcessContinueOnComments.get(t)?.findIndex(u=>u.range===void 0?i.range===void 0:P.lift(u.range).equalsRange(i.range));let a;r!==void 0&&r>=0&&(a=this._inProcessContinueOnComments.get(t)?.splice(r,1)[0].comment.body);const c=(this._pendingNewCommentCache[t]&&this._pendingNewCommentCache[t][i.threadId])??a,d=this._pendingEditsCache[t]&&this._pendingEditsCache[t][i.threadId],l=i.canReply&&i.isTemplate&&(!i.comments||i.comments.length===0)&&(!i.editorId||i.editorId===e);await this.displayCommentThread(t,i,l,c,d),this._commentInfos.filter(u=>u.uniqueOwner===t)[0].threads.push(i),this.tryUpdateReservedSpace()}onModelChanged(){this.localToDispose.clear(),this.tryUpdateReservedSpace(),this.removeCommentWidgetsAndStoreCache(),this.editor&&(this._hasRespondedToEditorChange=!1,this.localToDispose.add(this.editor.onMouseDown(e=>this.onEditorMouseDown(e))),this.localToDispose.add(this.editor.onMouseUp(e=>this.onEditorMouseUp(e))),this._editorDisposables.length&&(this.clearEditorListeners(),this.registerEditorListeners()),this._computeCommentingRangeScheduler=new tg(200),this.localToDispose.add({dispose:()=>{this._computeCommentingRangeScheduler?.cancel(),this._computeCommentingRangeScheduler=null}}),this.localToDispose.add(this.editor.onDidChangeModelContent(async()=>{this.beginComputeCommentingRanges()})),this.localToDispose.add(this.commentService.onDidUpdateCommentThreads(async e=>{const t=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;if(!t||!this.commentService.isCommentingEnabled)return;this._computePromise&&await this._computePromise;const i=this._commentInfos.filter(d=>d.uniqueOwner===e.uniqueOwner);if(!i||!i.length)return;const n=e.added.filter(d=>d.resource&&d.resource===t.toString()),o=e.removed.filter(d=>d.resource&&d.resource===t.toString()),r=e.changed.filter(d=>d.resource&&d.resource===t.toString()),a=e.pending.filter(d=>d.uri.toString()===t.toString());o.forEach(d=>{const l=this._commentWidgets.filter(g=>g.uniqueOwner===e.uniqueOwner&&g.commentThread.threadId===d.threadId&&g.commentThread.threadId!=="");if(l.length){const g=l[0],m=this._commentWidgets.indexOf(g);this._commentWidgets.splice(m,1),g.dispose()}const u=this._commentInfos.filter(g=>g.uniqueOwner===e.uniqueOwner)[0].threads;for(let g=0;g<u.length;g++)u[g]===d&&(u.splice(g,1),g--)});for(const d of r){const l=this._commentWidgets.filter(u=>u.uniqueOwner===e.uniqueOwner&&u.commentThread.threadId===d.threadId);l.length&&(l[0].update(d),this.openCommentsView(d))}const c=this.editor?.getId();for(const d of n)await this.handleCommentAdded(c,e.uniqueOwner,d);for(const d of a)await this.resumePendingComment(t,d);this._commentThreadRangeDecorator.update(this.editor,i)})),this.beginComputeAndHandleEditorChange())}async resumePendingComment(e,t){const i=this._commentWidgets.filter(n=>n.uniqueOwner===t.uniqueOwner&&P.lift(n.commentThread.range)?.equalsRange(t.range));if(t.isReply&&i.length)this.commentService.removeContinueOnComment({uniqueOwner:t.uniqueOwner,uri:e,range:t.range,isReply:!0}),i[0].setPendingComment(t.comment);else if(i.length){this.commentService.removeContinueOnComment({uniqueOwner:t.uniqueOwner,uri:e,range:t.range,isReply:!1});const n=i[0].getPendingComments().newComment;let o;!n||t.comment.body.includes(n.body)?o=t.comment:n.body.includes(t.comment.body)?o=n:o={body:`${n}
${t.comment.body}`,cursor:t.comment.cursor},i[0].setPendingComment(o)}else if(!t.isReply){if(!this.commentService.removeContinueOnComment({uniqueOwner:t.uniqueOwner,uri:e,range:t.range,isReply:!1}))return;this._inProcessContinueOnComments.has(t.uniqueOwner)||this._inProcessContinueOnComments.set(t.uniqueOwner,[]),this._inProcessContinueOnComments.get(t.uniqueOwner)?.push(t),await this.commentService.createCommentThreadTemplate(t.uniqueOwner,t.uri,t.range?P.lift(t.range):void 0)}}beginComputeAndHandleEditorChange(){this.beginCompute().then(()=>{if(!this._hasRespondedToEditorChange&&this._commentInfos.some(e=>e.commentingRanges.ranges.length>0||e.commentingRanges.fileComments))if(this._hasRespondedToEditorChange=!0,this.configurationService.getValue(Un.Comments)){const t=this.keybindingService.lookupKeybinding(Mo.OpenAccessibilityHelp)?.getAriaLabel();t?Kc(h(5445,"Editor has commenting ranges, run the command Open Accessibility Help ({0}), for more information.",t)):Kc(h(5446,"Editor has commenting ranges, run the command Open Accessibility Help, which is currently not triggerable via keybinding, for more information."))}else Kc(h(5447,"Editor has commenting ranges."))})}async openCommentsView(e){if(e.comments&&e.comments.length>0&&U4(e)){const t=this.configurationService.getValue(b1).openView;if(t==="file")return this.viewsService.openView(qn);if((t==="firstFile"||t==="firstFileUnresolved"&&e.state===ld.Unresolved)&&!this.viewsService.getViewWithId(qn)?.hasRendered)return this.viewsService.openView(qn)}}async displayCommentThread(e,t,i,n,o){const r=this.editor?.getModel();if(!r||!this.editor||this.isEditorInlineOriginal(this.editor))return;let a;t.range&&!n&&(a=this.commentService.removeContinueOnComment({uniqueOwner:e,uri:r.uri,range:t.range,isReply:!0}));const c=this.instantiationService.createInstance(v3,this.editor,e,t,n??a?.comment,o);await c.display(t.range,i),this._commentWidgets.push(c),this.openCommentsView(t)}onEditorMouseDown(e){this.mouseDownInfo=this._activeEditorHasCommentingRange.get()?bHe(e):null}onEditorMouseUp(e){const t=yHe(this.mouseDownInfo,e);if(this.mouseDownInfo=null,!this.editor||t===null||!e.target.element)return;const i=e.target.element.className.indexOf("comment-range-glyph")>=0,n=e.target.position.lineNumber;let o,r;t!==n?t>n?r=new P(t,this.editor.getModel().getLineLength(t)+1,n,1):r=new P(t,1,n,this.editor.getModel().getLineLength(n)+1):i&&(r=this.editor.getSelection()),r&&r.startLineNumber<=n&&n<=r.endLineNumber?(o=r,this.editor.setSelection(new P(r.endLineNumber,1,r.endLineNumber,1))):i&&(o=new P(n,1,n,1)),o&&this.addOrToggleCommentAtLine(o,e)}getCommentsAtLine(e){return this._commentWidgets.filter(t=>t.getGlyphPosition()===(e?e.endLineNumber:0))}async addOrToggleCommentAtLine(e,t){if(this._addInProgress)this._emptyThreadsToAddQueue.push([e,t]);else{this._addInProgress=!0;const i=this.getCommentsAtLine(e);if(i.length){const n=i.every(o=>o.expanded);i.forEach(n?o=>o.collapse(!0):o=>o.expand(!0)),this.processNextThreadToAdd();return}else this.addCommentAtLine(e,t)}}processNextThreadToAdd(){this._addInProgress=!1;const e=this._emptyThreadsToAddQueue.shift();e&&this.addOrToggleCommentAtLine(e[0],e[1])}clipUserRangeToCommentRange(e,t){return e.startLineNumber<t.startLineNumber&&(e=new P(t.startLineNumber,t.startColumn,e.endLineNumber,e.endColumn)),e.endLineNumber>t.endLineNumber&&(e=new P(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn)),e}addCommentAtLine(e,t){const i=this._commentingRangeDecorator.getMatchedCommentAction(e);if(!i.length||!this.editor?.hasModel())return this._addInProgress=!1,i.length||(e?this.notificationService.error(h(5448,"The cursor must be within a commenting range to add a comment.")):this.notificationService.error(h(5449,"File comments are not allowed on this file."))),Promise.resolve();if(i.length>1){if(t&&e)return this.contextMenuService.showContextMenu({getAnchor:()=>t.event,getActions:()=>this.getContextMenuActions(i,e),getActionsContext:()=>i.length?i[0]:void 0,onHide:()=>{this._addInProgress=!1}}),Promise.resolve();{const n=this.getCommentProvidersQuickPicks(i);return this.quickInputService.pick(n,{placeHolder:h(5450,"Select Comment Provider"),matchOnDescription:!0}).then(o=>{if(!o)return;const r=i.filter(a=>a.action.ownerId===o.id);if(r.length){const{ownerId:a}=r[0].action,c=e&&r[0].range?this.clipUserRangeToCommentRange(e,r[0].range):e;this.addCommentAtLine2(c,a)}}).then(()=>{this._addInProgress=!1})}}else{const{ownerId:n}=i[0].action,o=e&&i[0].range?this.clipUserRangeToCommentRange(e,i[0].range):e;this.addCommentAtLine2(o,n)}return Promise.resolve()}getCommentProvidersQuickPicks(e){return e.map(i=>{const{ownerId:n,extensionId:o,label:r}=i.action;return{label:r??o??n,id:n}})}getContextMenuActions(e,t){const i=[];return e.forEach(n=>{const{ownerId:o,extensionId:r,label:a}=n.action;i.push(new Kt("addCommentThread",`${a||r}`,void 0,!0,()=>{const c=n.range?this.clipUserRangeToCommentRange(t,n.range):t;return this.addCommentAtLine2(c,o),Promise.resolve()}))}),i}addCommentAtLine2(e,t){this.editor&&(this.commentService.createCommentThreadTemplate(t,this.editor.getModel().uri,e,this.editor.getId()),this.processNextThreadToAdd())}getExistingCommentEditorOptions(e){const t=e.getOption(L.lineDecorationsWidth);let i=[];const n=e.getRawOptions().extraEditorClassName;return n&&(i=n.split(" ")),{lineDecorationsWidth:t,extraEditorClassName:i}}getWithoutCommentsEditorOptions(e,t,i){let n=i;const o=t.findIndex(a=>a==="inline-comment");o>=0&&t.splice(o,1);const r=e.getOptions();return r.get(L.folding)&&r.get(L.showFoldingControls)!=="never"&&(n+=11),n-=24,{extraEditorClassName:t,lineDecorationsWidth:n}}getWithCommentsLineDecorationWidth(e,t){let i=t;const n=e.getOptions();return n.get(L.folding)&&n.get(L.showFoldingControls)!=="never"&&(i-=11),i+=24,this._commentingRangeAmountReserved=i,this._commentingRangeAmountReserved}getWithCommentsEditorOptions(e,t,i){return t.push("inline-comment"),{lineDecorationsWidth:this.getWithCommentsLineDecorationWidth(e,i),extraEditorClassName:t}}updateEditorLayoutOptions(e,t,i){e.updateOptions({extraEditorClassName:t.join(" "),lineDecorationsWidth:i})}ensureCommentingRangeReservedAmount(e){const t=this.getExistingCommentEditorOptions(e);t.lineDecorationsWidth!==this._commentingRangeAmountReserved&&e.updateOptions({lineDecorationsWidth:this.getWithCommentsLineDecorationWidth(e,t.lineDecorationsWidth)})}tryUpdateReservedSpace(e){if(!this.editor)return;const t=this._commentInfos.some(o=>!!(o.commentingRanges&&(Array.isArray(o.commentingRanges)?o.commentingRanges:o.commentingRanges.ranges).length)||o.threads.length>0);e=e??this.editor.getModel()?.uri;const i=e?this.commentService.resourceHasCommentingRanges(e):!1,n=t||i;if(n&&this.commentService.isCommentingEnabled)if(this._commentingRangeSpaceReserved)this.ensureCommentingRangeReservedAmount(this.editor);else{this._commentingRangeSpaceReserved=!0;const{lineDecorationsWidth:o,extraEditorClassName:r}=this.getExistingCommentEditorOptions(this.editor),a=this.getWithCommentsEditorOptions(this.editor,r,o);this.updateEditorLayoutOptions(this.editor,a.extraEditorClassName,a.lineDecorationsWidth)}else if((!n||!this.commentService.isCommentingEnabled)&&this._commentingRangeSpaceReserved){this._commentingRangeSpaceReserved=!1;const{lineDecorationsWidth:o,extraEditorClassName:r}=this.getExistingCommentEditorOptions(this.editor),a=this.getWithoutCommentsEditorOptions(this.editor,r,o);this.updateEditorLayoutOptions(this.editor,a.extraEditorClassName,a.lineDecorationsWidth)}}async setComments(e){if(!this.editor||!this.commentService.isCommentingEnabled)return;this._commentInfos=e,this.tryUpdateReservedSpace(),this.removeCommentWidgetsAndStoreCache();let t=!1;for(const i of this._commentInfos){!t&&(i.commentingRanges.ranges.length>0||i.commentingRanges.fileComments)&&(t=!0);const n=this._pendingNewCommentCache[i.uniqueOwner],o=this._pendingEditsCache[i.uniqueOwner];i.threads=i.threads.filter(r=>!r.isDisposed);for(const r of i.threads){let a;n&&(a=n[r.threadId]);let c;o&&(c=o[r.threadId]),await this.displayCommentThread(i.uniqueOwner,r,!1,a,c)}for(const r of i.pendingCommentThreads??[])this.resumePendingComment(this.editor.getModel().uri,r)}this._commentingRangeDecorator.update(this.editor,this._commentInfos),this._commentThreadRangeDecorator.update(this.editor,this._commentInfos),t?this._activeEditorHasCommentingRange.set(!0):this._activeEditorHasCommentingRange.set(!1)}collapseAndFocusRange(e){this._commentWidgets?.find(t=>t.commentThread.threadId===e)?.collapseAndFocusRange()}removeCommentWidgetsAndStoreCache(){this._commentWidgets&&this._commentWidgets.forEach(e=>{const t=e.getPendingComments(),i=t.newComment,n=this._pendingNewCommentCache[e.uniqueOwner];let o;if(e.commentThread.comments&&e.commentThread.comments.length){const c=e.commentThread.comments[e.commentThread.comments.length-1];typeof c.body=="string"?o=c.body:o=c.body.value}i&&i.body!==o?(n||(this._pendingNewCommentCache[e.uniqueOwner]={}),this._pendingNewCommentCache[e.uniqueOwner][e.commentThread.threadId]=i):n&&delete n[e.commentThread.threadId];const r=t.edits,a=this._pendingEditsCache[e.uniqueOwner];Object.keys(r).length>0?(a||(this._pendingEditsCache[e.uniqueOwner]={}),this._pendingEditsCache[e.uniqueOwner][e.commentThread.threadId]=r):a&&delete a[e.commentThread.threadId],e.dispose()}),this._commentWidgets=[]}};PL=f([p(1,yg),p(2,J),p(3,Ot),p(4,mi),p(5,zt),p(6,mo),p(7,ne),p(8,me),p(9,de),p(10,Ve),p(11,Tr),p(12,At)],PL);var sa;(function(s){s.Terminal="terminal",s.TerminalChat="terminal-chat",s.TerminalHelp="terminal-help",s.DiffEditor="diffEditor",s.MergeEditor="mergeEditor",s.PanelChat="panelChat",s.InlineChat="inlineChat",s.AgentChat="agentChat",s.QuickChat="quickChat",s.InlineCompletions="inlineCompletions",s.KeybindingsEditor="keybindingsEditor",s.Notebook="notebook",s.ReplEditor="replEditor",s.Editor="editor",s.Hover="hover",s.Notification="notification",s.EmptyEditorHint="emptyEditorHint",s.Comments="comments",s.CommentThread="commentThread",s.Repl="repl",s.ReplHelp="replHelp",s.RunAndDebug="runAndDebug",s.Walkthrough="walkthrough",s.SourceControl="scm"})(sa||(sa={}));var fc;(function(s){s.Help="help",s.View="view"})(fc||(fc={}));var Yee;(function(s){s.Previous="previous",s.Next="next"})(Yee||(Yee={}));class Tge extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.id=e,this.options=t,this.provideContent=i,this.onClose=n,this.verbositySettingKey=o,this.onOpen=r,this.actions=a,this.provideNextContent=c,this.providePreviousContent=d,this.onDidChangeContent=l,this.onKeyDown=u,this.getSymbols=g,this.onDidRequestClearLastProvider=m}}const _D={id:N.AccessibleView,group:"navigation",when:Ta},bD={id:N.CommandPalette,group:"",order:1};class SHe extends X{constructor(){super({id:Mo.ShowNext,precondition:x.and(Ta,JR),keybinding:{primary:E.Alt|S.BracketRight,weight:W.WorkbenchContrib},menu:[bD,{..._D,when:x.and(Ta,JR)}],icon:j.arrowDown,title:h(4237,"Show Next in Accessible View")})}run(e){e.get(Vh).next()}}K(SHe);class CHe extends X{constructor(){super({id:Mo.NextCodeBlock,precondition:x.and(eP,x.or(x.equals(Dp.key,sa.PanelChat),x.equals(Dp.key,sa.InlineChat),x.equals(Dp.key,sa.QuickChat))),keybinding:{primary:E.CtrlCmd|E.Alt|S.PageDown,mac:{primary:E.CtrlCmd|E.Alt|S.PageDown},weight:W.WorkbenchContrib},icon:j.arrowRight,menu:{..._D,when:x.and(Ta,eP)},title:h(4238,"Accessible View: Next Code Block")})}run(e){e.get(Vh).navigateToCodeBlock("next")}}K(CHe);class EHe extends X{constructor(){super({id:Mo.PreviousCodeBlock,precondition:x.and(eP,x.or(x.equals(Dp.key,sa.PanelChat),x.equals(Dp.key,sa.InlineChat),x.equals(Dp.key,sa.QuickChat))),keybinding:{primary:E.CtrlCmd|E.Alt|S.PageUp,mac:{primary:E.CtrlCmd|E.Alt|S.PageUp},weight:W.WorkbenchContrib},icon:j.arrowLeft,menu:{..._D,when:x.and(Ta,eP)},title:h(4239,"Accessible View: Previous Code Block")})}run(e){e.get(Vh).navigateToCodeBlock("previous")}}K(EHe);class xHe extends X{constructor(){super({id:Mo.ShowPrevious,precondition:x.and(Ta,JR),keybinding:{primary:E.Alt|S.BracketLeft,weight:W.WorkbenchContrib},icon:j.arrowUp,menu:[bD,{..._D,when:x.and(Ta,JR)}],title:h(4240,"Show Previous in Accessible View")})}run(e){e.get(Vh).previous()}}K(xHe);class IHe extends X{constructor(){super({id:Mo.GoToSymbol,precondition:x.and(x.or(Ta,dg),NX),keybinding:{primary:E.CtrlCmd|E.Shift|S.KeyO,secondary:[E.CtrlCmd|E.Shift|S.Period],weight:W.WorkbenchContrib+10},icon:j.symbolMisc,menu:[bD,{..._D,when:x.and(x.or(Ta,dg),NX)}],title:h(4241,"Go To Symbol in Accessible View")})}run(e){e.get(Vh).goToSymbol()}}K(IHe);function Age(s){return s.register(),s}Age(new dI({id:Mo.OpenAccessibilityHelp,precondition:void 0,kbOpts:{primary:E.Alt|S.F1,weight:W.WorkbenchContrib,linux:{primary:E.Alt|E.Shift|S.F1,secondary:[E.Alt|S.F1]},kbExpr:dg.toNegated()},menuOpts:[{menuId:N.CommandPalette,group:"",title:h(4242,"Open Accessibility Help"),order:1}]}));const DHe=Age(new dI({id:Mo.OpenAccessibleView,precondition:void 0,kbOpts:{primary:E.Alt|S.F2,weight:W.WorkbenchContrib,linux:{primary:E.Alt|E.Shift|S.F2,secondary:[E.Alt|S.F2]}},menuOpts:[{menuId:N.CommandPalette,group:"",title:h(4243,"Open Accessible View"),order:1}]}));class kHe extends X{constructor(){super({id:Mo.DisableVerbosityHint,precondition:x.and(x.or(Ta,dg),MX),keybinding:{primary:E.Alt|S.F6,weight:W.WorkbenchContrib},icon:j.bellSlash,menu:[bD,{id:N.AccessibleView,group:"navigation",when:x.and(x.or(Ta,dg),MX)}],title:h(4244,"Disable Accessible View Hint")})}run(e){e.get(Vh).disableHint()}}K(kHe);class THe extends X{constructor(){super({id:Mo.AccessibilityHelpConfigureKeybindings,precondition:x.and(dg,OX),icon:j.recordKeys,keybinding:{primary:E.Alt|S.KeyK,weight:W.WorkbenchContrib},menu:[{id:N.AccessibleView,group:"navigation",order:3,when:OX}],title:h(4245,"Accessibility Help Configure Unassigned Keybindings")})}async run(e){await e.get(Vh).configureKeybindings(!0)}}K(THe);class AHe extends X{constructor(){super({id:Mo.AccessibilityHelpConfigureAssignedKeybindings,precondition:x.and(dg,FX),icon:j.recordKeys,keybinding:{primary:E.Alt|S.KeyA,weight:W.WorkbenchContrib},menu:[{id:N.AccessibleView,group:"navigation",order:4,when:FX}],title:h(4246,"Accessibility Help Configure Assigned Keybindings")})}async run(e){await e.get(Vh).configureKeybindings(!1)}}K(AHe);class RHe extends X{constructor(){super({id:Mo.AccessibilityHelpOpenHelpLink,precondition:x.and(dg),keybinding:{primary:E.Alt|S.KeyH,weight:W.WorkbenchContrib},title:h(4247,"Accessibility Help Open Help Link")})}run(e){e.get(Vh).openHelpLink()}}K(RHe);class PHe extends X{constructor(){super({id:Mo.AccessibleViewAcceptInlineCompletion,precondition:x.and(Ta,x.equals(Dp.key,sa.InlineCompletions)),keybinding:{primary:E.CtrlCmd|S.Slash,mac:{primary:E.WinCtrl|S.Slash},weight:W.WorkbenchContrib},icon:j.check,menu:[bD,{id:N.AccessibleView,group:"navigation",order:0,when:x.and(Ta,x.equals(Dp.key,sa.InlineCompletions))}],title:h(4248,"Accept Inline Completion")})}async run(e){const t=e.get(Ot),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)return;const n=Ks.get(i)?.model.get(),o=n?.state.get();!n||!o||(await n.accept(i),n.stop(),i.focus())}}K(PHe);Be(sBe);const LHe=new O("commentsView.hasComments",!1),MHe=new O("commentsView.someCommentsExpanded",!1),NHe=new O("commentsView.commentFocused",!1),OHe="commentsViewState";function FHe(s){const e=[];for(const t of s.resourceCommentThreads){const i=[];for(const n of t.commentThreads)U4(n.thread)&&i.push({element:n});i.length>0&&e.push({element:t,children:i})}return e}let _3=class extends UU{get focusedCommentNode(){const e=this.tree?.getFocus();if(e?.length===1&&e[0]instanceof Uc)return e[0]}get focusedCommentInfo(){if(this.focusedCommentNode)return this.getScreenReaderInfoForNode(this.focusedCommentNode)}focusNextNode(){if(!this.tree)return;const e=this.tree.getFocus()?.[0];if(!e)return;let t=this.tree.navigate(e).next();for(;t&&!(t instanceof Uc);)t=this.tree.navigate(t).next();t&&this.tree.setFocus([t])}focusPreviousNode(){if(!this.tree)return;const e=this.tree.getFocus()?.[0];if(!e)return;let t=this.tree.navigate(e).previous();for(;t&&!(t instanceof Uc);)t=this.tree.navigate(t).previous();t&&this.tree.setFocus([t])}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){const w=new uw(OHe,v),C=w.getMemento(he.WORKSPACE,pt.MACHINE);super({...e,filterOptions:{placeholder:h(5474,"Filter (e.g. text, author)"),ariaLabel:h(5475,"Filter comments"),history:C.filterHistory||[],text:C.filter||"",focusContextKey:$4.key}},c,a,o,r,i,t,d,l,g),this.editorService=n,this.commentService=u,this.uriIdentityService=m,this.pathService=y,this.totalComments=0,this.currentHeight=0,this.currentWidth=0,this.cachedFilterStats=void 0,this.onDidChangeVisibility=this.onDidChangeBodyVisibility,this.hasCommentsContextKey=LHe.bindTo(r),this.someCommentsExpandedContextKey=MHe.bindTo(r),this.commentsFocusedContextKey=NHe.bindTo(r),this.stateMemento=w,this.viewState=C,this.filters=this._register(new gBe({showResolved:this.viewState.showResolved!==!1,showUnresolved:this.viewState.showUnresolved!==!1,sortBy:this.viewState.sortBy??hl.ResourceAscending},this.contextKeyService)),this.filter=new uBe(new im(this.filterWidget.getFilterText(),this.filters.showResolved,this.filters.showUnresolved)),this._register(this.filters.onDidChange(T=>{(T.showResolved||T.showUnresolved)&&this.updateFilter(),T.sortBy&&this.refresh()})),this._register(this.filterWidget.onDidChangeFilterText(()=>this.updateFilter()))}saveState(){this.viewState.filter=this.filterWidget.getFilterText(),this.viewState.filterHistory=this.filterWidget.getHistory(),this.viewState.showResolved=this.filters.showResolved,this.viewState.showUnresolved=this.filters.showUnresolved,this.viewState.sortBy=this.filters.sortBy,this.stateMemento.saveMemento(),super.saveState()}render(){super.render(),this._register(Dge({name:"commentsView",focusNotifiers:[this,this.filterWidget],focusNextWidget:()=>{this.filterWidget.hasFocus()&&this.focus()},focusPreviousWidget:()=>{this.filterWidget.hasFocus()||this.focusFilter()}}))}focusFilter(){this.filterWidget.focus()}clearFilterText(){this.filterWidget.setFilterText("")}getFilterStats(){return this.cachedFilterStats||(this.cachedFilterStats={total:this.totalComments,filtered:this.tree?.getVisibleItemCount()??0}),this.cachedFilterStats}updateFilter(){this.filter.options=new im(this.filterWidget.getFilterText(),this.filters.showResolved,this.filters.showUnresolved),this.tree?.filterComments(),this.cachedFilterStats=void 0;const{total:e,filtered:t}=this.getFilterStats();this.filterWidget.updateBadge(e===t||e===0?void 0:h(5476,"Showing {0} of {1}",t,e)),this.filterWidget.checkMoreFilters(!this.filters.showResolved||!this.filters.showUnresolved)}renderBody(e){super.renderBody(e),e.classList.add("comments-panel");const t=ee(e,Y(".comments-panel-container"));this.treeContainer=ee(t,Y(".tree-container")),this.treeContainer.classList.add("file-icon-themable-tree","show-file-icons"),this.cachedFilterStats=void 0,this.createTree(),this.createMessageBox(t),this._register(this.commentService.onDidSetAllCommentThreads(this.onAllCommentsChanged,this)),this._register(this.commentService.onDidUpdateCommentThreads(this.onCommentsUpdated,this)),this._register(this.commentService.onDidDeleteDataProvider(this.onDataProviderDeleted,this)),this._register(this.onDidChangeBodyVisibility(i=>{i&&this.refresh()})),this.renderComments()}focus(){super.focus();const e=this.tree?.getHTMLElement();e&&gf(e)||(!this.commentService.commentsModel.hasCommentThreads()&&this.messageBoxContainer?this.messageBoxContainer.focus():this.tree&&this.tree.domFocus())}renderComments(){this.treeContainer.classList.toggle("hidden",!this.commentService.commentsModel.hasCommentThreads()),this.renderMessage(),this.tree?.setChildren(null,FHe(this.commentService.commentsModel))}collapseAll(){this.tree&&(this.tree.collapseAll(),this.tree.setSelection([]),this.tree.setFocus([]),this.tree.domFocus(),this.tree.focusFirst())}expandAll(){this.tree&&(this.tree.expandAll(),this.tree.setSelection([]),this.tree.setFocus([]),this.tree.domFocus(),this.tree.focusFirst())}get hasRendered(){return!!this.tree}layoutBodyContent(e=this.currentHeight,t=this.currentWidth){this.messageBoxContainer&&(this.messageBoxContainer.style.height=`${e}px`),this.tree?.layout(e,t),this.currentHeight=e,this.currentWidth=t}createMessageBox(e){this.messageBoxContainer=ee(e,Y(".message-box-container")),this.messageBoxContainer.setAttribute("tabIndex","0")}renderMessage(){this.messageBoxContainer.textContent=this.commentService.commentsModel.getMessage(),this.messageBoxContainer.classList.toggle("hidden",this.commentService.commentsModel.hasCommentThreads())}makeCommentLocationLabel(e,t){const i=je(e);return t?t.startLineNumber===t.endLineNumber?h(5478,"at line {0} column {1} in {2}",t.startLineNumber,t.startColumn,i):h(5479,"from line {0} to line {1} in {2}",t.startLineNumber,t.endLineNumber,i):h(5477,"in {0}",i)}makeScreenReaderLabelInfo(e,t){const i=e.comment.userName,n=this.makeCommentLocationLabel(e.resource,e.range),o=this.getReplyCountAsString(e,t),r=typeof e.comment.body=="string"?e.comment.body:e.comment.body.value;return{userName:i,locationLabel:n,replyCountLabel:o,bodyLabel:r}}getScreenReaderInfoForNode(e,t){let i="";if(t&&this.configurationService.getValue(Un.Comments)){const d=this.keybindingService.lookupKeybinding(DHe.id)?.getAriaLabel();i=d?h(5480,`
Inspect this in the accessible view ({0}).`,d):h(5481,`
Inspect this in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding.`)}const n=this.getRepliesAsString(e,t),o=this.editorService.findEditors(e.resource),r=this.editorService.activeEditorPane?.getControl();let a;e.range&&o?.length&&Ao(r)&&(a=r.getModel()?.getValueInRange(e.range),a&&(a=`
Corresponding code: 
`+a)),a||(a="");const c=this.makeScreenReaderLabelInfo(e,t);return e.threadRelevance===zne.Outdated?h(5482,`Outdated from {0}: {1}
{2}
{3}
{4}`,c.userName,c.bodyLabel,c.locationLabel,c.replyCountLabel,a)+n+i:h(5483,`{0}: {1}
{2}
{3}
{4}`,c.userName,c.bodyLabel,c.locationLabel,c.replyCountLabel,a)+n+i}getRepliesAsString(e,t){return!e.replies.length||t?"":`
`+e.replies.map(i=>h(5484,"{0} {1}",i.comment.userName,typeof i.comment.body=="string"?i.comment.body:i.comment.body.value)).join(`
`)}getReplyCountAsString(e,t){return e.replies.length&&!t?h(5485," {0} replies,",e.replies.length):""}createTree(){this.treeLabels=this._register(this.instantiationService.createInstance(vd,this)),this.tree=this._register(this.instantiationService.createInstance(L$,this.treeLabels,this.treeContainer,{overrideStyles:this.getLocationBasedColors().listOverrideStyles,selectionNavigation:!0,filter:this.filter,sorter:{compare:(e,t)=>{if(e instanceof Kb||t instanceof Kb)return 0;if(this.filters.sortBy===hl.UpdatedAtDescending)return e.lastUpdatedAt>t.lastUpdatedAt?-1:1;if(this.filters.sortBy===hl.ResourceAscending){if(e instanceof fr&&t instanceof fr){const i=this.pathService.defaultUriScheme;return e.resource.scheme!==t.resource.scheme&&(e.resource.scheme===i||t.resource.scheme===i)?t.resource.scheme===i?1:-1:e.resource.toString()>t.resource.toString()?1:-1}else if(e instanceof Uc&&t instanceof Uc&&e.thread.range&&t.thread.range)return e.thread.range?.startLineNumber>t.thread.range?.startLineNumber?1:-1}return 0}},keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:e=>{}},accessibilityProvider:{getAriaLabel:e=>e instanceof Kb?h(5486,"Comments for current workspace"):e instanceof fr?h(5487,"Comments in {0}, full path {1}",je(e.resource),e.resource.fsPath):e instanceof Uc?this.getScreenReaderInfoForNode(e,!0):"",getWidgetAriaLabel(){return A$.value}}})),this._register(this.tree.onDidOpen(e=>{this.openFile(e.element,e.editorOptions.pinned,e.editorOptions.preserveFocus,e.sideBySide)})),this._register(this.tree.onDidChangeModel(()=>{this.updateSomeCommentsExpanded()})),this._register(this.tree.onDidChangeCollapseState(()=>{this.updateSomeCommentsExpanded()})),this._register(this.tree.onDidFocus(()=>this.commentsFocusedContextKey.set(!0))),this._register(this.tree.onDidBlur(()=>this.commentsFocusedContextKey.set(!1)))}openFile(e,t,i,n){if(!e||!(e instanceof fr||e instanceof Uc))return;const o=e instanceof fr?e.commentThreads[0].thread:e.thread,r=e instanceof fr?e.commentThreads[0].comment:void 0;return kge(this.commentService,this.editorService,this.uriIdentityService,o,r,!1,t,i,n)}async refresh(){if(this.tree&&this.isVisible()&&(this.hasCommentsContextKey.set(this.commentService.commentsModel.hasCommentThreads()),this.cachedFilterStats=void 0,this.renderComments(),this.tree.getSelection().length===0&&this.commentService.commentsModel.hasCommentThreads())){const e=this.commentService.commentsModel.resourceCommentThreads[0].commentThreads[0];e&&(this.tree.setFocus([e]),this.tree.setSelection([e]))}}onAllCommentsChanged(e){this.cachedFilterStats=void 0,this.totalComments+=e.commentThreads.length;for(const t of e.commentThreads);this.refresh()}onCommentsUpdated(e){this.cachedFilterStats=void 0,this.totalComments+=e.added.length,this.totalComments-=e.removed.length;for(const t of this.commentService.commentsModel.resourceCommentThreads)for(const i of t.commentThreads);this.refresh()}onDataProviderDeleted(e){this.cachedFilterStats=void 0,this.totalComments=0,this.refresh()}updateSomeCommentsExpanded(){this.someCommentsExpandedContextKey.set(this.isSomeCommentsExpanded())}areAllCommentsExpanded(){if(!this.tree)return!1;const e=this.tree.navigate();for(;e.next();)if(this.tree.isCollapsed(e.current()))return!1;return!0}isSomeCommentsExpanded(){if(!this.tree)return!1;const e=this.tree.navigate();for(;e.next();)if(!this.tree.isCollapsed(e.current()))return!0;return!1}};_3=f([p(1,J),p(2,Os),p(3,de),p(4,ne),p(5,me),p(6,mi),p(7,Ve),p(8,hi),p(9,ft),p(10,yg),p(11,wi),p(12,Zi),p(13,tt),p(14,_c)],_3);Be(oue);const WHe=new N("Views");ge.appendMenuItem(N.ViewContainerTitle,{submenu:WHe,title:h(3544,"Views"),order:1});var xo;(function(s){s[s.UP=0]="UP",s[s.DOWN=1]="DOWN",s[s.LEFT=2]="LEFT",s[s.RIGHT=3]="RIGHT"})(xo||(xo={}));class yb extends pw{static{this.OVERLAY_ID="monaco-pane-drop-overlay"}get currentDropOperation(){return this._currentDropOperation}constructor(e,t,i,n,o){super(o),this.paneElement=e,this.orientation=t,this.bounds=i,this.location=n,this.cleanupOverlayScheduler=this._register(new fn(()=>this.dispose(),300)),this.create()}get disposed(){return!!this._disposed}create(){this.container=Y("div",{id:yb.OVERLAY_ID}),this.container.style.top="0px",this.paneElement.appendChild(this.container),this.paneElement.classList.add("dragged-over"),this._register(Ee(()=>{this.container.remove(),this.paneElement.classList.remove("dragged-over")})),this.overlay=Y(".pane-overlay-indicator"),this.container.appendChild(this.overlay),this.registerListeners(),this.updateStyles()}updateStyles(){this.overlay.style.backgroundColor=this.getColor(this.location===Fe.Panel?fz:vz)||"";const e=this.getColor(Sr);this.overlay.style.outlineColor=e||"",this.overlay.style.outlineOffset=e?"-2px":"",this.overlay.style.outlineStyle=e?"dashed":"",this.overlay.style.outlineWidth=e?"2px":"",this.overlay.style.borderColor=e||"",this.overlay.style.borderStyle="solid",this.overlay.style.borderWidth="0px"}registerListeners(){this._register(new Hp(this.container,{onDragOver:e=>{this.positionOverlay(e.offsetX,e.offsetY),this.cleanupOverlayScheduler.isScheduled()&&this.cleanupOverlayScheduler.cancel()},onDragLeave:e=>this.dispose(),onDragEnd:e=>this.dispose(),onDrop:e=>{this.dispose()}})),this._register(re(this.container,pe.MOUSE_OVER,()=>{this.cleanupOverlayScheduler.isScheduled()||this.cleanupOverlayScheduler.schedule()}))}positionOverlay(e,t){const i=this.paneElement.clientWidth,n=this.paneElement.clientHeight,o=i/2,r=n/2;let a;switch(this.orientation===wt.VERTICAL?t<r?a=xo.UP:t>=r&&(a=xo.DOWN):this.orientation===wt.HORIZONTAL&&(e<o?a=xo.LEFT:e>=o&&(a=xo.RIGHT)),a){case xo.UP:this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"50%"});break;case xo.DOWN:this.doPositionOverlay({bottom:"0",left:"0",width:"100%",height:"50%"});break;case xo.LEFT:this.doPositionOverlay({top:"0",left:"0",width:"50%",height:"100%"});break;case xo.RIGHT:this.doPositionOverlay({top:"0",right:"0",width:"50%",height:"100%"});break;default:{let c="0",d="0",l="100%",u="100%";if(this.bounds){const g=this.container.getBoundingClientRect();c=`${this.bounds.top-g.top}px`,d=`${this.bounds.left-g.left}px`,u=`${this.bounds.bottom-this.bounds.top}px`,l=`${this.bounds.right-this.bounds.left}px`}this.doPositionOverlay({top:c,left:d,width:l,height:u})}}this.orientation===wt.VERTICAL&&n<=25||this.orientation===wt.HORIZONTAL&&i<=25?this.doUpdateOverlayBorder(a):this.doUpdateOverlayBorder(void 0),this.overlay.style.opacity="1",setTimeout(()=>this.overlay.classList.add("overlay-move-transition"),0),this._currentDropOperation=a}doUpdateOverlayBorder(e){this.overlay.style.borderTopWidth=e===xo.UP?"2px":"0px",this.overlay.style.borderLeftWidth=e===xo.LEFT?"2px":"0px",this.overlay.style.borderBottomWidth=e===xo.DOWN?"2px":"0px",this.overlay.style.borderRightWidth=e===xo.RIGHT?"2px":"0px"}doPositionOverlay(e){this.container.style.height="100%",this.overlay.style.top=e.top||"",this.overlay.style.left=e.left||"",this.overlay.style.bottom=e.bottom||"",this.overlay.style.right=e.right||"",this.overlay.style.width=e.width,this.overlay.style.height=e.height}contains(e){return e===this.container||e===this.overlay}dispose(){super.dispose(),this._disposed=!0}}let b3=class extends WP{constructor(e,t,i,n,o){const r=n.createScoped(e);r.createKey("viewContainer",t.id);const a=r.createKey("viewContainerLocation",ed(i.getViewContainerLocation(t)));super(N.ViewContainerTitle,N.ViewContainerTitleContext,{shouldForwardArgs:!0,renderShortTitle:!0},r,o),this._register(r),this._register(D.filter(i.onDidChangeContainerLocation,c=>c.viewContainer===t)(()=>a.set(ed(i.getViewContainerLocation(t)))))}};b3=f([p(2,Os),p(3,me),p(4,tn)],b3);let y3=class extends KO{get onDidSashChange(){return Gt(this.paneview).onDidSashChange}get panes(){return this.paneItems.map(e=>e.pane)}get views(){return this.panes}get length(){return this.paneItems.length}get menuActions(){return this._menuActions}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(e,d,l),this.options=t,this.instantiationService=i,this.configurationService=n,this.layoutService=o,this.contextMenuService=r,this.telemetryService=a,this.extensionService=c,this.storageService=l,this.contextService=u,this.viewDescriptorService=g,this.logService=m,this.paneItems=[],this.visible=!1,this.areExtensionsReady=!1,this.didLayout=!1,this._onTitleAreaUpdate=this._register(new M),this.onTitleAreaUpdate=this._onTitleAreaUpdate.event,this._onDidChangeVisibility=this._register(new M),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._onDidAddViews=this._register(new M),this.onDidAddViews=this._onDidAddViews.event,this._onDidRemoveViews=this._register(new M),this.onDidRemoveViews=this._onDidRemoveViews.event,this._onDidChangeViewVisibility=this._register(new M),this.onDidChangeViewVisibility=this._onDidChangeViewVisibility.event,this._onDidFocusView=this._register(new M),this.onDidFocusView=this._onDidFocusView.event,this._onDidBlurView=this._register(new M),this.onDidBlurView=this._onDidBlurView.event;const v=this.viewDescriptorService.getViewContainerById(e);if(!v)throw new Error("Could not find container");this.viewContainer=v,this.visibleViewsStorageId=`${e}.numberOfVisibleViews`,this.visibleViewsCountFromCache=this.storageService.getNumber(this.visibleViewsStorageId,he.WORKSPACE,void 0),this.viewContainerModel=this.viewDescriptorService.getViewContainerModel(v)}create(e){const t=this.options;t.orientation=this.orientation,this.paneview=this._register(new K1e(e,this.options)),this._boundarySashes&&this.paneview.setBoundarySashes(this._boundarySashes),this._register(this.paneview.onDidDrop(({from:c,to:d})=>this.movePane(c,d))),this._register(this.paneview.onDidScroll(c=>this.onDidScrollPane())),this._register(this.paneview.onDidSashReset(c=>this.onDidSashReset(c))),this._register(re(e,pe.CONTEXT_MENU,c=>this.showContextMenu(new us(bt(e),c)))),this._register(Th.addTarget(e)),this._register(re(e,Vo.Contextmenu,c=>this.showContextMenu(new us(bt(e),c)))),this._menuActions=this._register(this.instantiationService.createInstance(b3,this.paneview.element,this.viewContainer)),this._register(this._menuActions.onDidChange(()=>this.updateTitleArea()));let i;const n=()=>{const c=e.getBoundingClientRect(),d=this.panes[this.panes.length-1].element.getBoundingClientRect(),l=this.orientation===wt.VERTICAL?d.bottom:c.top,u=this.orientation===wt.HORIZONTAL?d.right:c.left;return{top:l,bottom:c.bottom,left:u,right:c.right}},o=(c,d)=>d.x>=c.left&&d.x<=c.right&&d.y>=c.top&&d.y<=c.bottom;let r;this._register(Jd.INSTANCE.registerTarget(e,{onDragEnter:c=>{if(r=n(),i&&i.disposed&&(i=void 0),!i&&o(r,c.eventData)){const d=c.dragAndDropData.getData();if(d.type==="view"){const l=this.viewDescriptorService.getViewContainerByViewId(d.id),u=this.viewDescriptorService.getViewDescriptorById(d.id);if(l!==this.viewContainer&&(!u||!u.canMoveView||this.viewContainer.rejectAddedViews))return;i=new yb(e,void 0,r,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService)}if(d.type==="composite"&&d.id!==this.viewContainer.id){const l=this.viewDescriptorService.getViewContainerById(d.id),u=this.viewDescriptorService.getViewContainerModel(l).allViewDescriptors;!u.some(g=>!g.canMoveView)&&u.length>0&&(i=new yb(e,void 0,r,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService))}}},onDragOver:c=>{i&&i.disposed&&(i=void 0),i&&!o(r,c.eventData)&&(i.dispose(),i=void 0),o(r,c.eventData)&&OP(c.eventData.dataTransfer,"move",i!==void 0)},onDragLeave:c=>{i?.dispose(),i=void 0},onDrop:c=>{if(i){const d=c.dragAndDropData.getData(),l=[];if(d.type==="composite"&&d.id!==this.viewContainer.id){const g=this.viewDescriptorService.getViewContainerById(d.id),m=this.viewDescriptorService.getViewContainerModel(g).allViewDescriptors;m.some(v=>!v.canMoveView)||l.push(...m)}else if(d.type==="view"){const g=this.viewDescriptorService.getViewContainerByViewId(d.id),m=this.viewDescriptorService.getViewDescriptorById(d.id);g!==this.viewContainer&&m&&m.canMoveView&&this.viewDescriptorService.moveViewsToContainer([m],this.viewContainer,void 0,"dnd")}const u=this.panes.length;if(l.length>0&&this.viewDescriptorService.moveViewsToContainer(l,this.viewContainer,void 0,"dnd"),u>0)for(const g of l){const m=this.panes.find(v=>v.id===g.id);m&&this.movePane(m,this.panes[this.panes.length-1])}}i?.dispose(),i=void 0}})),this._register(this.onDidSashChange(()=>this.saveViewSizes())),this._register(this.viewContainerModel.onDidAddVisibleViewDescriptors(c=>this.onDidAddViewDescriptors(c))),this._register(this.viewContainerModel.onDidRemoveVisibleViewDescriptors(c=>this.onDidRemoveViewDescriptors(c)));const a=this.viewContainerModel.visibleViewDescriptors.map((c,d)=>{const l=this.viewContainerModel.getSize(c.id),u=this.viewContainerModel.isCollapsed(c.id);return{viewDescriptor:c,index:d,size:l,collapsed:u}});a.length&&this.onDidAddViewDescriptors(a),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this.areExtensionsReady=!0,this.panes.length&&(this.updateTitleArea(),this.updateViewHeaders()),this._register(this.configurationService.onDidChangeConfiguration(c=>{c.affectsConfiguration(si.ACTIVITY_BAR_LOCATION)&&this.updateViewHeaders()}))}),this._register(this.viewContainerModel.onDidChangeActiveViewDescriptors(()=>this._onTitleAreaUpdate.fire()))}getTitle(){const e=this.viewContainerModel.title;if(this.isViewMergedWithContainer()){const t=this.paneItems[0].pane.singleViewPaneContainerTitle;if(t)return t;const i=this.paneItems[0].pane.title;return e===i?i:i?`${e}: ${i}`:e}return e}showContextMenu(e){for(const t of this.paneItems)if(Ku(e.target,t.pane.element))return;e.stopPropagation(),e.preventDefault(),this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>this.menuActions?.getContextMenuActions()??[]})}getActionsContext(){if(this.isViewMergedWithContainer())return this.panes[0].getActionsContext()}getActionViewItem(e,t){return this.isViewMergedWithContainer()?this.paneItems[0].pane.createActionViewItem(e,t):dw(this.instantiationService,e,t)}focus(){let e;if(this.lastFocusedPane)e=this.lastFocusedPane;else if(this.paneItems.length>0){for(const{pane:t}of this.paneItems)if(t.isExpanded()){e=t;break}}e&&e.focus()}get orientation(){switch(this.viewDescriptorService.getViewContainerLocation(this.viewContainer)){case Fe.Sidebar:case Fe.AuxiliaryBar:return wt.VERTICAL;case Fe.Panel:return goe(this.layoutService.getPanelPosition())?wt.HORIZONTAL:wt.VERTICAL}return wt.VERTICAL}layout(e){this.paneview&&(this.paneview.orientation!==this.orientation&&this.paneview.flipOrientation(e.height,e.width),this.paneview.layout(e.height,e.width)),this.dimension=e,this.didLayout?this.saveViewSizes():(this.didLayout=!0,this.restoreViewSizes())}setBoundarySashes(e){this._boundarySashes=e,this.paneview?.setBoundarySashes(e)}getOptimalWidth(){return Math.max(...this.panes.map(i=>i.getOptimalWidth()||0))+16}addPanes(e){const t=this.isViewMergedWithContainer();for(const{pane:i,size:n,index:o,disposable:r}of e)this.addPane(i,n,r,o);this.updateViewHeaders(),this.isViewMergedWithContainer()!==t&&this.updateTitleArea(),this._onDidAddViews.fire(e.map(({pane:i})=>i))}setVisible(e){this.visible!==!!e&&(this.visible=e,this._onDidChangeVisibility.fire(e)),this.panes.filter(t=>t.isVisible()!==e).forEach(t=>t.setVisible(e))}isVisible(){return this.visible}updateTitleArea(){this._onTitleAreaUpdate.fire()}createView(e,t){return this.instantiationService.createInstance(e.ctorDescriptor.ctor,...e.ctorDescriptor.staticArguments||[],t)}getView(e){return this.panes.filter(t=>t.id===e)[0]}saveViewSizes(){this.didLayout&&this.viewContainerModel.setSizes(this.panes.map(e=>({id:e.id,size:this.getPaneSize(e)})))}restoreViewSizes(){if(this.didLayout){let e;for(let t=0;t<this.viewContainerModel.visibleViewDescriptors.length;t++){const i=this.panes[t],n=this.viewContainerModel.visibleViewDescriptors[t],o=this.viewContainerModel.getSize(n.id);typeof o=="number"?this.resizePane(i,o):(e=e||this.computeInitialSizes(),this.resizePane(i,e.get(i.id)||200))}}}computeInitialSizes(){const e=new Map;if(this.dimension){const t=this.viewContainerModel.visibleViewDescriptors.reduce((i,{weight:n})=>i+(n||20),0);for(const i of this.viewContainerModel.visibleViewDescriptors)this.orientation===wt.VERTICAL?e.set(i.id,this.dimension.height*(i.weight||20)/t):e.set(i.id,this.dimension.width*(i.weight||20)/t)}return e}saveState(){this.panes.forEach(e=>e.saveState()),this.storageService.store(this.visibleViewsStorageId,this.length,he.WORKSPACE,pt.MACHINE)}onContextMenu(e,t){e.stopPropagation(),e.preventDefault();const i=t.menuActions.getContextMenuActions();this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>i})}openView(e,t){let i=this.getView(e);return i||this.toggleViewVisibility(e),i=this.getView(e),i&&(i.setExpanded(!0),t&&i.focus()),i}onDidAddViewDescriptors(e){const t=[];for(const{viewDescriptor:n,collapsed:o,index:r,size:a}of e){const c=this.createView(n,{id:n.id,title:n.name.value,fromExtensionId:n.extensionId,expanded:!o,singleViewPaneContainerTitle:n.singleViewPaneContainerTitle});try{c.render()}catch(d){this.logService.error(`Fail to render view ${n.id}`,d);continue}if(c.draggableElement){const d=re(c.draggableElement,"contextmenu",u=>{u.stopPropagation(),u.preventDefault(),this.onContextMenu(new us(bt(c.draggableElement),u),c)}),l=D.latch(D.map(c.onDidChange,()=>!c.isExpanded()))(u=>{this.viewContainerModel.setCollapsed(n.id,u)});t.push({pane:c,size:a||c.minimumSize,index:r,disposable:Lo(d,l)})}}this.addPanes(t),this.restoreViewSizes();const i=[];for(const{pane:n}of t)n.setVisible(this.isVisible()),i.push(n);return i}onDidRemoveViewDescriptors(e){e=e.sort((i,n)=>n.index-i.index);const t=[];for(const{index:i}of e)this.paneItems[i]&&t.push(this.paneItems[i].pane);if(t.length){this.removePanes(t);for(const i of t)i.setVisible(!1)}}toggleViewVisibility(e){if(this.viewContainerModel.activeViewDescriptors.some(t=>t.id===e)){const t=!this.viewContainerModel.isVisible(e);this.viewContainerModel.setVisible(e,t)}}addPane(e,t,i,n=this.paneItems.length-1){const o=e.onDidFocus(()=>{this._onDidFocusView.fire(e),this.lastFocusedPane=e}),r=e.onDidBlur(()=>this._onDidBlurView.fire(e)),a=e.onDidChangeTitleArea(()=>{this.isViewMergedWithContainer()&&this.updateTitleArea()}),c=e.onDidChangeBodyVisibility(()=>this._onDidChangeViewVisibility.fire(e)),d=e.onDidChange(()=>{e===this.lastFocusedPane&&!e.isExpanded()&&(this.lastFocusedPane=void 0)}),l=this.viewDescriptorService.getViewContainerLocation(this.viewContainer)===Fe.Panel;e.style({headerForeground:gt(l?Fxe:qxe),headerBackground:gt(l?Oxe:Gxe),headerBorder:gt(l?Wxe:ere),dropBackground:gt(l?fz:vz),leftBorder:l?gt(Bxe):void 0});const u=new U;u.add(i),u.add(Lo(e,o,r,a,d,c));const g={pane:e,disposable:u};this.paneItems.splice(n,0,g),Gt(this.paneview).addPane(e,t,n);let m;e.draggableElement&&u.add(Jd.INSTANCE.registerDraggable(e.draggableElement,()=>({type:"view",id:e.id}),{})),u.add(Jd.INSTANCE.registerTarget(e.dropTargetElement,{onDragEnter:v=>{if(!m){const y=v.dragAndDropData.getData();if(y.type==="view"&&y.id!==e.id){const w=this.viewDescriptorService.getViewContainerByViewId(y.id),C=this.viewDescriptorService.getViewDescriptorById(y.id);if(w!==this.viewContainer&&(!C||!C.canMoveView||this.viewContainer.rejectAddedViews))return;m=new yb(e.dropTargetElement,this.orientation??wt.VERTICAL,void 0,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService)}if(y.type==="composite"&&y.id!==this.viewContainer.id&&!this.viewContainer.rejectAddedViews){const w=this.viewDescriptorService.getViewContainerById(y.id),C=this.viewDescriptorService.getViewContainerModel(w).allViewDescriptors;!C.some(T=>!T.canMoveView)&&C.length>0&&(m=new yb(e.dropTargetElement,this.orientation??wt.VERTICAL,void 0,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService))}}},onDragOver:v=>{OP(v.eventData.dataTransfer,"move",m!==void 0)},onDragLeave:v=>{m?.dispose(),m=void 0},onDrop:v=>{if(m){const y=v.dragAndDropData.getData(),w=[];let C;if(y.type==="composite"&&y.id!==this.viewContainer.id&&!this.viewContainer.rejectAddedViews){const T=this.viewDescriptorService.getViewContainerById(y.id),k=this.viewDescriptorService.getViewContainerModel(T).allViewDescriptors;k.length>0&&!k.some(A=>!A.canMoveView)&&(w.push(...k),C=k[0])}else if(y.type==="view"){const T=this.viewDescriptorService.getViewContainerByViewId(y.id),k=this.viewDescriptorService.getViewDescriptorById(y.id);T!==this.viewContainer&&k&&k.canMoveView&&!this.viewContainer.rejectAddedViews&&w.push(k),k&&(C=k)}if(w&&this.viewDescriptorService.moveViewsToContainer(w,this.viewContainer,void 0,"dnd"),C){if(m.currentDropOperation===xo.DOWN||m.currentDropOperation===xo.RIGHT){const T=this.panes.findIndex(A=>A.id===C.id);let k=this.panes.findIndex(A=>A.id===e.id);T>=0&&k>=0&&(T>k&&k++,k<this.panes.length&&k!==T&&this.movePane(this.panes[T],this.panes[k]))}if(m.currentDropOperation===xo.UP||m.currentDropOperation===xo.LEFT){const T=this.panes.findIndex(A=>A.id===C.id);let k=this.panes.findIndex(A=>A.id===e.id);T>=0&&k>=0&&(T<k&&k--,k>=0&&k!==T&&this.movePane(this.panes[T],this.panes[k]))}w.length>1&&w.slice(1).forEach(T=>{let k=this.panes.findIndex(B=>B.id===C.id);const A=this.panes.findIndex(B=>B.id===T.id);A>=0&&k>=0&&(A>k&&k++,k<this.panes.length&&k!==A&&(this.movePane(this.panes[A],this.panes[k]),C=T))})}}m?.dispose(),m=void 0}}))}removePanes(e){const t=this.isViewMergedWithContainer();e.forEach(i=>this.removePane(i)),this.updateViewHeaders(),t!==this.isViewMergedWithContainer()&&this.updateTitleArea(),this._onDidRemoveViews.fire(e)}removePane(e){const t=this.paneItems.findIndex(n=>n.pane===e);if(t===-1)return;this.lastFocusedPane===e&&(this.lastFocusedPane=void 0),Gt(this.paneview).removePane(e);const[i]=this.paneItems.splice(t,1);i.disposable.dispose()}movePane(e,t){const i=this.paneItems.findIndex(c=>c.pane===e),n=this.paneItems.findIndex(c=>c.pane===t),o=this.viewContainerModel.visibleViewDescriptors[i],r=this.viewContainerModel.visibleViewDescriptors[n];if(i<0||i>=this.paneItems.length||n<0||n>=this.paneItems.length)return;const[a]=this.paneItems.splice(i,1);this.paneItems.splice(n,0,a),Gt(this.paneview).movePane(e,t),this.viewContainerModel.move(o.id,r.id),this.updateTitleArea()}resizePane(e,t){Gt(this.paneview).resizePane(e,t)}getPaneSize(e){return Gt(this.paneview).getPaneSize(e)}updateViewHeaders(){this.isViewMergedWithContainer()?(this.paneItems[0].pane.isExpanded()?this.lastMergedCollapsedPane=void 0:(this.lastMergedCollapsedPane=this.paneItems[0].pane,this.paneItems[0].pane.setExpanded(!0)),this.paneItems[0].pane.headerVisible=!1,this.paneItems[0].pane.collapsible=!0):(this.paneItems.length===1?(this.paneItems[0].pane.headerVisible=!0,this.paneItems[0].pane===this.lastMergedCollapsedPane&&this.paneItems[0].pane.setExpanded(!1),this.paneItems[0].pane.collapsible=!1):this.paneItems.forEach(e=>{e.pane.headerVisible=!0,e.pane.collapsible=!0,e.pane===this.lastMergedCollapsedPane&&e.pane.setExpanded(!1)}),this.lastMergedCollapsedPane=void 0)}isViewMergedWithContainer(){return this.options.mergeViewWithContainerWhenSingleView&&this.paneItems.length===1?this.areExtensionsReady?!0:this.visibleViewsCountFromCache===void 0?this.paneItems[0].pane.isExpanded():this.visibleViewsCountFromCache===1:!1}onDidScrollPane(){for(const e of this.panes)e.onDidScrollRoot()}onDidSashReset(e){let t,i;for(let n=e;n>=0;n--)if(this.paneItems[n].pane?.isVisible()&&this.paneItems[n]?.pane.isExpanded()){t=this.paneItems[n].pane;break}for(let n=e+1;n<this.paneItems.length;n++)if(this.paneItems[n].pane?.isVisible()&&this.paneItems[n]?.pane.isExpanded()){i=this.paneItems[n].pane;break}if(t&&i){const n=this.getPaneSize(t),o=this.getPaneSize(i),r=Math.ceil((n+o)/2),a=Math.floor((n+o)/2);n>o?(this.resizePane(t,r),this.resizePane(i,a)):(this.resizePane(i,a),this.resizePane(t,r))}}dispose(){super.dispose(),this.paneItems.forEach(e=>e.disposable.dispose()),this.paneview&&this.paneview.dispose()}};y3=f([p(2,J),p(3,ne),p(4,vi),p(5,mi),p(6,li),p(7,hn),p(8,ft),p(9,tt),p(10,Tt),p(11,Os),p(12,Pe)],y3);class cit extends X{constructor(e){super(e),this.desc=e}run(e,...t){const i=e.get(mo).getActiveViewPaneContainerWithId(this.desc.viewPaneContainerId);if(i)return this.runInViewPaneContainer(e,i,...t)}}class C1 extends X{constructor(e,t){super(e),this.offset=t}async run(e){const t=e.get(Os),i=e.get(me),n=pl.getValue(i);if(n===void 0)return;const o=t.getViewContainerByViewId(n),r=t.getViewContainerModel(o),a=r.visibleViewDescriptors.find(l=>l.id===n),c=r.visibleViewDescriptors.indexOf(a);if(c+this.offset<0||c+this.offset>=r.visibleViewDescriptors.length)return;const d=r.visibleViewDescriptors[c+this.offset];r.move(a.id,d.id)}}K(class extends C1{constructor(){super({id:"views.moveViewUp",title:h(3545,"Move View Up"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.UpArrow),weight:W.WorkbenchContrib+1,when:pl.notEqualsTo("")}},-1)}});K(class extends C1{constructor(){super({id:"views.moveViewLeft",title:h(3546,"Move View Left"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.LeftArrow),weight:W.WorkbenchContrib+1,when:pl.notEqualsTo("")}},-1)}});K(class extends C1{constructor(){super({id:"views.moveViewDown",title:h(3547,"Move View Down"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.DownArrow),weight:W.WorkbenchContrib+1,when:pl.notEqualsTo("")}},1)}});K(class extends C1{constructor(){super({id:"views.moveViewRight",title:h(3548,"Move View Right"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.RightArrow),weight:W.WorkbenchContrib+1,when:pl.notEqualsTo("")}},1)}});K(class extends X{constructor(){super({id:"vscode.moveViews",title:h(3549,"Move Views")})}async run(e,t){if(!Array.isArray(t?.viewIds)||typeof t?.destinationId!="string")return Promise.reject("Invalid arguments");const i=e.get(Os),n=i.getViewContainerById(t.destinationId);if(n){for(const o of t.viewIds){const r=i.getViewDescriptorById(o);r?.canMoveView&&i.moveViewsToContainer([r],n,CV.Default,this.desc.id)}await e.get(mo).openViewContainer(n.id,!0)}}});class BHe{get input(){return this._input}set input(e){this._input=e,this._onDidChangeInput.fire(e)}get onDidChangeInput(){return this._onDidChangeInput.event}get label(){return this._label}set label(e){this._label=e,this._onDidChangeLabel.fire(this._label)}get contextValue(){return this._contextValue}set contextValue(e){this._contextValue=e}get comments(){return this._comments}set comments(e){this._comments=e,this._onDidChangeComments.fire(this._comments)}get onDidChangeComments(){return this._onDidChangeComments.event}set range(e){this._range=e}get range(){return this._range}get onDidChangeCanReply(){return this._onDidChangeCanReply.event}set canReply(e){this._canReply=e,this._onDidChangeCanReply.fire(!!this._canReply)}get canReply(){return this._canReply}get collapsibleState(){return this._collapsibleState}set collapsibleState(e){this.initialCollapsibleState===void 0&&(this.initialCollapsibleState=e),e!==this._collapsibleState&&(this._collapsibleState=e,this._onDidChangeCollapsibleState.fire(this._collapsibleState))}get initialCollapsibleState(){return this._initialCollapsibleState}set initialCollapsibleState(e){this._initialCollapsibleState=e,this._onDidChangeInitialCollapsibleState.fire(e)}get isDisposed(){return this._isDisposed}isDocumentCommentThread(){return this._range===void 0||P.isIRange(this._range)}get state(){return this._state}set state(e){this._state=e,this._onDidChangeState.fire(this._state)}get applicability(){return this._applicability}set applicability(e){this._applicability=e,this._onDidChangeApplicability.fire(e)}get isTemplate(){return this._isTemplate}constructor(e,t,i,n,o,r,a,c,d,l){this.commentThreadHandle=e,this.controllerHandle=t,this.extensionId=i,this.threadId=n,this.resource=o,this._range=r,this._canReply=c,this._isTemplate=d,this.editorId=l,this._onDidChangeInput=new M,this._onDidChangeLabel=new M,this.onDidChangeLabel=this._onDidChangeLabel.event,this._onDidChangeComments=new M,this._onDidChangeCanReply=new M,this._collapsibleState=sr.Collapsed,this._onDidChangeCollapsibleState=new M,this.onDidChangeCollapsibleState=this._onDidChangeCollapsibleState.event,this._onDidChangeInitialCollapsibleState=new M,this.onDidChangeInitialCollapsibleState=this._onDidChangeInitialCollapsibleState.event,this._onDidChangeApplicability=new M,this.onDidChangeApplicability=this._onDidChangeApplicability.event,this._onDidChangeState=new M,this.onDidChangeState=this._onDidChangeState.event,this._isDisposed=!1,d?this.comments=[]:a&&(this._comments=a)}batchUpdate(e){const t=i=>Object.prototype.hasOwnProperty.call(e,i);t("range")&&(this._range=e.range),t("label")&&(this._label=e.label),t("contextValue")&&(this._contextValue=e.contextValue===null?void 0:e.contextValue),t("comments")&&(this.comments=e.comments),t("collapseState")&&(this.collapsibleState=e.collapseState),t("canReply")&&(this.canReply=e.canReply),t("state")&&(this.state=e.state),t("applicability")&&(this.applicability=e.applicability),t("isTemplate")&&(this._isTemplate=e.isTemplate)}hasComments(){return!!this.comments&&this.comments.length>0}dispose(){this._isDisposed=!0,this._onDidChangeCollapsibleState.dispose(),this._onDidChangeComments.dispose(),this._onDidChangeInput.dispose(),this._onDidChangeLabel.dispose(),this._onDidChangeState.dispose()}toJSON(){return{$mid:Nn.CommentThread,commentControlHandle:this.controllerHandle,commentThreadHandle:this.commentThreadHandle}}}class VHe{constructor(e){this.thread=e,this.disposableStore=new U}dispose(){this.disposableStore.dispose()}}class HHe extends F{get handle(){return this._handle}get id(){return this._id}get contextValue(){return this._id}get proxy(){return this._proxy}get label(){return this._label}get reactions(){return this._reactions}set reactions(e){this._reactions=e}get options(){return this._features.options}get features(){return this._features}get owner(){return this._id}constructor(e,t,i,n,o,r,a){super(),this._proxy=e,this._commentService=t,this._handle=i,this._uniqueId=n,this._id=o,this._label=r,this._features=a,this._threads=this._register(new ei)}get activeComment(){return this._activeComment}async setActiveCommentAndThread(e){return this._activeComment=e,this._proxy.$setActiveComment(this._handle,e?{commentThreadHandle:e.thread.commentThreadHandle,uniqueIdInThread:e.comment?.uniqueIdInThread}:void 0)}updateFeatures(e){this._features=e}createCommentThread(e,t,i,n,o,r,a,c){const d=new BHe(t,this.handle,e,i,R.revive(n).toString(),o,r,!0,a,c),l=new VHe(d);return this._threads.set(t,l),l.disposableStore.add(d.onDidChangeCollapsibleState(()=>{this.proxy.$updateCommentThread(this.handle,d.commentThreadHandle,{collapseState:d.collapsibleState})})),d.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[d],removed:[],changed:[],pending:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[d],removed:[],changed:[],pending:[]}),d}updateCommentThread(e,t,i,n){const o=this.getKnownThread(e);o.batchUpdate(n),o.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[],removed:[],changed:[o],pending:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[],removed:[],changed:[o],pending:[]})}deleteCommentThread(e){const t=this.getKnownThread(e);this._threads.deleteAndDispose(e),t.dispose(),t.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[],removed:[t],changed:[],pending:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[],removed:[t],changed:[],pending:[]})}deleteCommentThreadMain(e){for(const{thread:t}of this._threads.values())t.threadId===e&&this._proxy.$deleteCommentThread(this._handle,t.commentThreadHandle)}updateInput(e){const t=this.activeEditingCommentThread;if(t&&t.input){const i=t.input;i.value=e,t.input=i}}updateCommentingRanges(e){this._commentService.updateCommentingRanges(this._uniqueId,e)}getKnownThread(e){const t=this._threads.get(e);if(!t)throw new Error("unknown thread");return t.thread}async getDocumentComments(e,t){if(e.scheme===ae.vscodeNotebookCell)return{uniqueOwner:this._uniqueId,label:this.label,threads:[],commentingRanges:{resource:e,ranges:[],fileComments:!1}};const i=[];for(const o of[...this._threads.keys()]){const r=this._threads.get(o);r.thread.resource===e.toString()&&r.thread.isDocumentCommentThread()&&i.push(r.thread)}const n=await this._proxy.$provideCommentingRanges(this.handle,e,t);return{uniqueOwner:this._uniqueId,label:this.label,threads:i,commentingRanges:{resource:e,ranges:n?.ranges||[],fileComments:!!n?.fileComments}}}async getNotebookComments(e,t){if(e.scheme!==ae.vscodeNotebookCell)return{uniqueOwner:this._uniqueId,label:this.label,threads:[]};const i=[];for(const n of[...this._threads.keys()]){const o=this._threads.get(n);o.thread.resource===e.toString()&&(o.thread.isDocumentCommentThread()||i.push(o.thread))}return{uniqueOwner:this._uniqueId,label:this.label,threads:i}}async toggleReaction(e,t,i,n,o){return this._proxy.$toggleReaction(this._handle,t.commentThreadHandle,e,i,n)}getAllComments(){const e=[];for(const t of[...this._threads.keys()])e.push(this._threads.get(t).thread);return e}createCommentThreadTemplate(e,t,i){return this._proxy.$createCommentThreadTemplate(this.handle,e,t,i)}async updateCommentThreadTemplate(e,t){await this._proxy.$updateCommentThreadTemplate(this.handle,e,t)}toJSON(){return{$mid:Nn.CommentController,handle:this.handle}}}const Qee=Ae("comments-view-icon",j.commentDiscussion,h(2404,"View icon of the comments view."));let Xee=class extends F{constructor(e,t,i,n,o,r){super(),this._commentService=t,this._viewsService=i,this._viewDescriptorService=n,this._uriIdentityService=o,this._editorService=r,this._handlers=new Map,this._commentControllers=new Map,this._activeEditingCommentThreadDisposables=this._register(new U),this._openViewListener=this._register(new kt),this._onChangeContainerListener=this._register(new kt),this._onChangeContainerLocationListener=this._register(new kt),this._proxy=e.getProxy(Ye.ExtHostComments),this._commentService.unregisterCommentController(),this._register(this._commentService.onDidChangeActiveEditingCommentThread(async a=>{const c=a.controllerHandle,d=this._commentControllers.get(c);d&&(this._activeEditingCommentThreadDisposables.clear(),this._activeEditingCommentThread=a,d.activeEditingCommentThread=this._activeEditingCommentThread)}))}$registerCommentController(e,t,i,n){const o=`${t}-${n}`;this._handlers.set(e,o);const r=new HHe(this._proxy,this._commentService,e,o,t,i,{});this._commentService.registerCommentController(o,r),this._commentControllers.set(e,r),this._register(this._commentService.onResourceHasCommentingRanges(a=>{this.registerView()})),this._register(this._commentService.onDidUpdateCommentThreads(a=>{this.registerView()})),this._commentService.setWorkspaceComments(String(e),[])}$unregisterCommentController(e){const t=this._handlers.get(e);this._handlers.delete(e),this._commentControllers.get(e)?.dispose(),this._commentControllers.delete(e),typeof t=="string"&&this._commentService.unregisterCommentController(t)}$updateCommentControllerFeatures(e,t){const i=this._commentControllers.get(e);i&&i.updateFeatures(t)}$createCommentThread(e,t,i,n,o,r,a,c,d){const l=this._commentControllers.get(e);if(l)return l.createCommentThread(a.value,t,i,n,o,r,c,d)}$updateCommentThread(e,t,i,n,o){const r=this._commentControllers.get(e);if(r)return r.updateCommentThread(t,i,n,o)}$deleteCommentThread(e,t){const i=this._commentControllers.get(e);if(i)return i.deleteCommentThread(t)}$updateCommentingRanges(e,t){const i=this._commentControllers.get(e);i&&i.updateCommentingRanges(t)}async $revealCommentThread(e,t,i,n){const o=this._commentControllers.get(e);if(!o)return Promise.resolve();const r=o.getAllComments().find(c=>c.commentThreadHandle===t);if(!r||!r.isDocumentCommentThread())return Promise.resolve();const a=r.comments?.find(c=>c.uniqueIdInThread===i);kge(this._commentService,this._editorService,this._uriIdentityService,r,a,n.focusReply,void 0,n.preserveFocus)}async $hideCommentThread(e,t){const i=this._commentControllers.get(e);if(!i)return Promise.resolve();const n=i.getAllComments().find(o=>o.commentThreadHandle===t);if(!n||!n.isDocumentCommentThread())return Promise.resolve();n.collapsibleState=sr.Collapsed}registerView(){const e=!!this._viewDescriptorService.getViewDescriptorById(qn);if(!e){const t=Ge.as(Yp.ViewContainersRegistry).registerViewContainer({id:qn,title:A$,ctorDescriptor:new _r(y3,[qn,{mergeViewWithContainerWhenSingleView:!0}]),storageId:lBe,hideIfEmpty:!0,icon:Qee,order:10},Fe.Panel);Ge.as(Yp.ViewsRegistry).registerViews([{id:qn,name:A$,canToggleVisibility:!1,ctorDescriptor:new _r(_3),canMoveView:!0,containerIcon:Qee,focusCommand:{id:"workbench.action.focusCommentsPanel"}}],t)}this.registerViewListeners(e)}setComments(){[...this._commentControllers.keys()].forEach(e=>{const t=this._commentControllers.get(e).getAllComments();if(t.length){const i=this.getHandler(e);this._commentService.setWorkspaceComments(i,t)}})}registerViewOpenedListener(){this._openViewListener.value||(this._openViewListener.value=this._viewsService.onDidChangeViewVisibility(e=>{e.id===qn&&e.visible&&(this.setComments(),this._openViewListener&&this._openViewListener.dispose())}))}registerViewListeners(e){e||this.registerViewOpenedListener(),this._onChangeContainerListener.value||(this._onChangeContainerListener.value=this._viewDescriptorService.onDidChangeContainer(t=>{t.views.find(i=>i.id===qn)&&(this.setComments(),this.registerViewOpenedListener())})),this._onChangeContainerLocationListener.value||(this._onChangeContainerLocationListener.value=this._viewDescriptorService.onDidChangeContainerLocation(t=>{const i=this._viewDescriptorService.getViewContainerByViewId(qn);t.viewContainer.id===i?.id&&(this.setComments(),this.registerViewOpenedListener())}))}getHandler(e){if(!this._handlers.has(e))throw new Error("Unknown handler");return this._handlers.get(e)}};Xee=f([ht($e.MainThreadComments),p(1,yg),p(2,mo),p(3,Os),p(4,Zi),p(5,de)],Xee);let Zee=class{constructor(e,t,i,n){this._notebookService=t,this._cellStatusBarService=i,this._logService=n,this._disposables=new U,this._notebookSerializer=new Map,this._notebookCellStatusBarRegistrations=new Map,this._proxy=e.getProxy(Ye.ExtHostNotebook)}dispose(){this._disposables.dispose(),Qe(this._notebookSerializer.values())}$registerNotebookSerializer(e,t,i,n,o){const r=new U;r.add(this._notebookService.registerNotebookSerializer(i,t,{options:n,dataToNotebook:async a=>{const c=new zn;let d;if(a.byteLength===0&&i==="interactive")d=br.fromNotebookDataDto({cells:[],metadata:{}});else{const l=await this._proxy.$dataToNotebook(e,a,ye.None);d=br.fromNotebookDataDto(l.value)}return this._logService.trace(`[NotebookSerializer] dataToNotebook DONE after ${c.elapsed()}ms`,{viewType:i,extensionId:t.id.value}),d},notebookToData:a=>{const c=new zn,d=this._proxy.$notebookToData(e,new Jr(br.toNotebookDataDto(a)),ye.None);return this._logService.trace(`[NotebookSerializer] notebookToData DONE after ${c.elapsed()}`,{viewType:i,extensionId:t.id.value}),d},save:async(a,c,d,l)=>({...await this._proxy.$saveNotebook(e,a,c,d,l),children:void 0,resource:a}),searchInNotebooks:async(a,c,d)=>{const l=this._notebookService.getContributedNotebookType(i);if(!l)return{results:[],limitHit:!1};const g=l.selectors.map(C=>(C.include||C).toString());if(!g.length)return{results:[],limitHit:!1};const m=Vt([{isFromSettings:!1,filenamePatterns:g},...d.get(i)??[]]),v=Array.from(d.keys()).flatMap(C=>C!==i?d.get(C)??[]:[]),y=await this._proxy.$searchInNotebooks(e,a,m,v,c);return{results:y.results.map(C=>({resource:R.revive(C.resource),cellResults:C.cellResults.map(k=>cn(k))})),limitHit:y.limitHit}}})),o&&r.add(this._notebookService.registerContributedNotebookType(i,o)),this._notebookSerializer.set(e,r),this._logService.trace("[NotebookSerializer] registered notebook serializer",{viewType:i,extensionId:t.id.value})}$unregisterNotebookSerializer(e){this._notebookSerializer.get(e)?.dispose(),this._notebookSerializer.delete(e)}$emitCellStatusBarEvent(e){const t=this._notebookCellStatusBarRegistrations.get(e);t instanceof M&&t.fire(void 0)}async $registerNotebookCellStatusBarItemProvider(e,t,i){const n=this,o={async provideCellStatusBarItems(a,c,d){const l=await n._proxy.$provideNotebookCellStatusBarItems(e,a,c,d);return{items:l?.items??[],dispose(){l&&n._proxy.$releaseNotebookCellStatusBarItems(l.cacheId)}}},viewType:i};if(typeof t=="number"){const a=new M;this._notebookCellStatusBarRegistrations.set(t,a),o.onDidChangeStatusBarItems=a.event}const r=this._cellStatusBarService.registerCellStatusBarItemProvider(o);this._notebookCellStatusBarRegistrations.set(e,r)}async $unregisterNotebookCellStatusBarItemProvider(e,t){const i=n=>{this._notebookCellStatusBarRegistrations.get(n)&&(this._notebookCellStatusBarRegistrations.get(n)?.dispose(),this._notebookCellStatusBarRegistrations.delete(n))};i(e),typeof t=="number"&&i(t)}};Zee=f([ht($e.MainThreadNotebook),p(1,$h),p(2,ure),p(3,Pe)],Zee);Ce.registerCommand("_executeDataToNotebook",async(s,...e)=>{const[t,i]=e;St(typeof t=="string","string"),St(i instanceof Re,"VSBuffer");const o=await s.get($h).withNotebookDataProvider(t);if(!(o instanceof SO))return;const r=await o.serializer.dataToNotebook(i);return new Jr(br.toNotebookDataDto(r))});Ce.registerCommand("_executeNotebookToData",async(s,...e)=>{const[t,i]=e;St(typeof t=="string","string"),St(typeof i=="object");const o=await s.get($h).withNotebookDataProvider(t);if(!(o instanceof SO))return;const r=br.fromNotebookDataDto(i.value);return await o.serializer.notebookToData(r)});class UHe{get preloadUris(){return this.preloads.map(e=>e.uri)}get preloadProvides(){return this.preloads.flatMap(e=>e.provides)}constructor(e,t){this._languageService=t,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this.id=e.id,this.viewType=e.notebookType,this.extension=e.extensionId,this.implementsInterrupt=e.supportsInterrupt??!1,this.label=e.label,this.description=e.description,this.detail=e.detail,this.supportedLanguages=xn(e.supportedLanguages)?e.supportedLanguages:t.getRegisteredLanguageIds(),this.implementsExecutionOrder=e.supportsExecutionOrder??!1,this.hasVariableProvider=e.hasVariableProvider??!1,this.localResourceRoot=R.revive(e.extensionLocation),this.preloads=e.preloads?.map(i=>({uri:R.revive(i.uri),provides:i.provides}))??[]}update(e){const t=Object.create(null);e.label!==void 0&&(this.label=e.label,t.label=!0),e.description!==void 0&&(this.description=e.description,t.description=!0),e.detail!==void 0&&(this.detail=e.detail,t.detail=!0),e.supportedLanguages!==void 0&&(this.supportedLanguages=xn(e.supportedLanguages)?e.supportedLanguages:this._languageService.getRegisteredLanguageIds(),t.supportedLanguages=!0),e.supportsExecutionOrder!==void 0&&(this.implementsExecutionOrder=e.supportsExecutionOrder,t.hasExecutionOrder=!0),e.supportsInterrupt!==void 0&&(this.implementsInterrupt=e.supportsInterrupt,t.hasInterruptHandler=!0),e.hasVariableProvider!==void 0&&(this.hasVariableProvider=e.hasVariableProvider,t.hasVariableProvider=!0),this._onDidChange.fire(t)}}class $He{constructor(e){this.notebookType=e}}let Jee=class{constructor(e,t,i,n,o,r){this._languageService=t,this._notebookKernelService=i,this._notebookExecutionStateService=n,this._notebookService=o,this._editors=new ei,this._disposables=new U,this._kernels=new Map,this._kernelDetectionTasks=new Map,this._kernelSourceActionProviders=new Map,this._kernelSourceActionProvidersEventRegistrations=new Map,this._executions=new Map,this._notebookExecutions=new Map,this.variableRequestIndex=0,this.variableRequestMap=new Map,this._proxy=e.getProxy(Ye.ExtHostNotebookKernels),r.listNotebookEditors().forEach(this._onEditorAdd,this),r.onDidAddNotebookEditor(this._onEditorAdd,this,this._disposables),r.onDidRemoveNotebookEditor(this._onEditorRemove,this,this._disposables),this._disposables.add(Ee(()=>{this._executions.forEach(a=>{a.complete({})}),this._notebookExecutions.forEach(a=>a.complete())})),this._disposables.add(this._notebookKernelService.onDidChangeSelectedNotebooks(a=>{for(const[c,[d]]of this._kernels)a.oldKernel===d.id?this._proxy.$acceptNotebookAssociation(c,a.notebook,!1):a.newKernel===d.id&&this._proxy.$acceptNotebookAssociation(c,a.notebook,!0)}))}dispose(){this._disposables.dispose();for(const[,e]of this._kernels.values())e.dispose();for(const[,e]of this._kernelDetectionTasks.values())e.dispose();for(const[,e]of this._kernelSourceActionProviders.values())e.dispose();this._editors.dispose()}_onEditorAdd(e){const t=e.onDidReceiveMessage(i=>{if(!e.hasModel())return;const{selected:n}=this._notebookKernelService.getMatchingKernel(e.textModel);if(n){for(const[o,r]of this._kernels)if(r[0]===n){this._proxy.$acceptKernelMessageFromRenderer(o,e.getId(),i.message);break}}});this._editors.set(e,t)}_onEditorRemove(e){this._editors.deleteAndDispose(e)}async $postMessage(e,t,i){const n=this._kernels.get(e);if(!n)throw new Error("kernel already disposed");const[o]=n;let r=!1;for(const[a]of this._editors)if(a.hasModel()&&this._notebookKernelService.getMatchingKernel(a.textModel).selected===o){if(t===void 0)a.postMessage(i),r=!0;else if(a.getId()===t){a.postMessage(i),r=!0;break}}return r}$receiveVariable(e,t){const i=this.variableRequestMap.get(e);i&&i.emitOne(t)}async $addKernel(e,t){const i=this,n=new class extends UHe{async executeNotebookCellsRequest(r,a){await i._proxy.$executeCells(e,r,a)}async cancelNotebookCellExecution(r,a){await i._proxy.$cancelCells(e,r,a)}provideVariables(r,a,c,d,l){const u=`${e}variables${i.variableRequestIndex++}`;if(i.variableRequestMap.has(u))return i.variableRequestMap.get(u).asyncIterable;const g=new ene;return i.variableRequestMap.set(u,g),i._proxy.$provideVariables(e,u,r,a,c,d,l).then(()=>{g.resolve(),i.variableRequestMap.delete(u)}).catch(m=>{g.reject(m),i.variableRequestMap.delete(u)}),g.asyncIterable}}(t,this._languageService),o=this._disposables.add(new U);this._kernels.set(e,[n,o]),o.add(this._notebookKernelService.registerKernel(n))}$updateKernel(e,t){const i=this._kernels.get(e);i&&i[0].update(t)}$removeKernel(e){const t=this._kernels.get(e);t&&(t[1].dispose(),this._kernels.delete(e))}$updateNotebookPriority(e,t,i){const n=this._kernels.get(e);n&&this._notebookKernelService.updateKernelNotebookAffinity(n[0],R.revive(t),i)}$createExecution(e,t,i,n){const o=R.revive(i),r=this._notebookService.getNotebookTextModel(o);if(!r)throw new Error(`Notebook not found: ${o.toString()}`);const a=this._notebookKernelService.getMatchingKernel(r);if(!a.selected||a.selected.id!==t)throw new Error(`Kernel is not selected: ${a.selected?.id} !== ${t}`);const c=this._notebookExecutionStateService.createCellExecution(o,n);c.confirm(),this._executions.set(e,c)}$updateExecution(e,t){const i=t.value;try{this._executions.get(e)?.update(i.map(br.fromCellExecuteUpdateDto))}catch(n){mt(n)}}$completeExecution(e,t){try{this._executions.get(e)?.complete(br.fromCellExecuteCompleteDto(t.value))}catch(i){mt(i)}finally{this._executions.delete(e)}}$createNotebookExecution(e,t,i){const n=R.revive(i),o=this._notebookService.getNotebookTextModel(n);if(!o)throw new Error(`Notebook not found: ${n.toString()}`);const r=this._notebookKernelService.getMatchingKernel(o);if(!r.selected||r.selected.id!==t)throw new Error(`Kernel is not selected: ${r.selected?.id} !== ${t}`);const a=this._notebookExecutionStateService.createExecution(n);a.confirm(),this._notebookExecutions.set(e,a)}$beginNotebookExecution(e){try{this._notebookExecutions.get(e)?.begin()}catch(t){mt(t)}}$completeNotebookExecution(e){try{this._notebookExecutions.get(e)?.complete()}catch(t){mt(t)}finally{this._notebookExecutions.delete(e)}}async $addKernelDetectionTask(e,t){const i=new $He(t),n=this._notebookKernelService.registerNotebookKernelDetectionTask(i);this._kernelDetectionTasks.set(e,[i,n])}$removeKernelDetectionTask(e){const t=this._kernelDetectionTasks.get(e);t&&(t[1].dispose(),this._kernelDetectionTasks.delete(e))}async $addKernelSourceActionProvider(e,t,i){const n={viewType:i,provideKernelSourceActions:async()=>(await this._proxy.$provideKernelSourceActions(e,ye.None)).map(a=>{let c=a.documentation;return a.documentation&&typeof a.documentation!="string"&&(c=R.revive(a.documentation)),{label:a.label,command:a.command,description:a.description,detail:a.detail,documentation:c}})};if(typeof t=="number"){const r=new M;this._kernelSourceActionProvidersEventRegistrations.set(t,r),n.onDidChangeSourceActions=r.event}const o=this._notebookKernelService.registerKernelSourceActionProvider(i,n);this._kernelSourceActionProviders.set(e,[n,o])}$removeKernelSourceActionProvider(e,t){const i=this._kernelSourceActionProviders.get(e);i&&(i[1].dispose(),this._kernelSourceActionProviders.delete(e)),typeof t=="number"&&this._kernelSourceActionProvidersEventRegistrations.delete(t)}$emitNotebookKernelSourceActionsChangeEvent(e){const t=this._kernelSourceActionProvidersEventRegistrations.get(e);t instanceof M&&t.fire(void 0)}$variablesUpdated(e){this._notebookKernelService.notifyVariablesChange(R.revive(e))}};Jee=f([ht($e.MainThreadNotebookKernels),p(1,fi),p(2,pre),p(3,gre),p(4,$h),p(5,AN)],Jee);let w3=class{constructor(e,t,i){this._notebookEditorModelResolverService=t,this._uriIdentityService=i,this._disposables=new U,this._documentEventListenersMapping=new wn,this._proxy=e.getProxy(Ye.ExtHostNotebookDocuments),this._modelReferenceCollection=new Wue(this._uriIdentityService.extUri),this._disposables.add(this._notebookEditorModelResolverService.onDidChangeDirty(n=>this._proxy.$acceptDirtyStateChanged(n.resource,n.isDirty()))),this._disposables.add(this._notebookEditorModelResolverService.onDidSaveNotebook(n=>this._proxy.$acceptModelSaved(n))),this._disposables.add(t.onWillFailWithConflict(n=>{this._modelReferenceCollection.remove(n.resource)}))}dispose(){this._disposables.dispose(),this._modelReferenceCollection.dispose(),Qe(this._documentEventListenersMapping.values())}handleNotebooksAdded(e){for(const t of e){const i=new U;i.add(t.onDidChangeContent(n=>{const o={versionId:n.versionId,rawEvents:[]};for(const a of n.rawEvents)switch(a.kind){case Fc.ModelChange:o.rawEvents.push({kind:a.kind,changes:a.changes.map(c=>[c[0],c[1],c[2].map(d=>br.toNotebookCellDto(d))])});break;case Fc.Move:o.rawEvents.push({kind:a.kind,index:a.index,length:a.length,newIdx:a.newIdx});break;case Fc.Output:o.rawEvents.push({kind:a.kind,index:a.index,outputs:a.outputs.map(br.toNotebookOutputDto)});break;case Fc.OutputItem:o.rawEvents.push({kind:a.kind,index:a.index,outputId:a.outputId,outputItems:a.outputItems.map(br.toNotebookOutputItemDto),append:a.append});break;case Fc.ChangeCellLanguage:case Fc.ChangeCellContent:case Fc.ChangeCellMetadata:case Fc.ChangeCellInternalMetadata:o.rawEvents.push(a);break}const r=n.rawEvents.find(a=>a.kind===Fc.ChangeDocumentMetadata);this._proxy.$acceptModelChanged(t.uri,new Jr(o),this._notebookEditorModelResolverService.isDirty(t.uri),r?t.metadata:void 0)})),this._documentEventListenersMapping.set(t.uri,i)}}handleNotebooksRemoved(e){for(const t of e)this._documentEventListenersMapping.get(t)?.dispose(),this._documentEventListenersMapping.delete(t)}async $tryCreateNotebook(e){if(e.content){const t=await this._notebookEditorModelResolverService.resolve({untitledResource:void 0},e.viewType);if(D.once(t.object.notebook.onWillDispose)(()=>{t.dispose()}),this._proxy.$acceptDirtyStateChanged(t.object.resource,!0),e.content){const i=br.fromNotebookDataDto(e.content);t.object.notebook.reset(i.cells,i.metadata,t.object.notebook.transientOptions)}return t.object.notebook.uri}else return(await this._notebookEditorModelResolverService.createUntitledNotebookTextModel(e.viewType)).uri}async $tryOpenNotebook(e){const t=R.revive(e),i=await this._notebookEditorModelResolverService.resolve(t,void 0);return e.scheme==="untitled"&&i.object.notebook.onWillDispose(()=>{i.dispose()}),this._modelReferenceCollection.add(t,i),t}async $trySaveNotebook(e){const t=R.revive(e),i=await this._notebookEditorModelResolverService.resolve(t),n=await i.object.save();return i.dispose(),n}};w3=f([p(1,xI),p(2,Zi)],w3);class GHe{constructor(e,t){this.editor=e,this.disposables=t}dispose(){this.disposables.dispose()}}let S3=class{constructor(e,t,i,n,o){this._editorService=t,this._notebookEditorService=i,this._editorGroupService=n,this._configurationService=o,this._disposables=new U,this._mainThreadEditors=new Map,this._proxy=e.getProxy(Ye.ExtHostNotebookEditors),this._editorService.onDidActiveEditorChange(()=>this._updateEditorViewColumns(),this,this._disposables),this._editorGroupService.onDidRemoveGroup(()=>this._updateEditorViewColumns(),this,this._disposables),this._editorGroupService.onDidMoveGroup(()=>this._updateEditorViewColumns(),this,this._disposables)}dispose(){this._disposables.dispose(),Qe(this._mainThreadEditors.values())}handleEditorsAdded(e){for(const t of e){const i=new U;i.add(t.onDidChangeVisibleRanges(()=>{this._proxy.$acceptEditorPropertiesChanged(t.getId(),{visibleRanges:{ranges:t.visibleRanges}})})),i.add(t.onDidChangeSelection(()=>{this._proxy.$acceptEditorPropertiesChanged(t.getId(),{selections:{selections:t.getSelections()}})}));const n=new GHe(t,i);this._mainThreadEditors.set(t.getId(),n)}}handleEditorsRemoved(e){for(const t of e)this._mainThreadEditors.get(t)?.dispose(),this._mainThreadEditors.delete(t)}_updateEditorViewColumns(){const e=Object.create(null);for(const t of this._editorService.visibleEditorPanes){const i=dl(t);i&&this._mainThreadEditors.has(i.getId())&&(e[i.getId()]=Jp(this._editorGroupService,t.group))}ma(e,this._currentViewColumnInfo)||(this._currentViewColumnInfo=e,this._proxy.$acceptEditorViewColumns(e))}async $tryShowNotebookDocument(e,t,i){const n={cellSelections:i.selections,preserveFocus:i.preserveFocus,pinned:i.pinned,activation:i.preserveFocus?Yc.RESTORE:void 0,label:i.label,override:t},o=await this._editorService.openEditor({resource:R.revive(e),options:n},Nm(this._editorGroupService,this._configurationService,i.position)),r=dl(o);if(r)return r.getId();throw new Error(`Notebook Editor creation failure for document ${JSON.stringify(e)}`)}async $tryRevealRange(e,t,i){const n=this._notebookEditorService.getNotebookEditor(e);if(!n)return;const o=n;if(!o.hasModel()||t.start>=o.getLength())return;const r=o.cellAt(t.start);switch(i){case sb.Default:return o.revealCellRangeInView(t);case sb.InCenter:return o.revealInCenter(r);case sb.InCenterIfOutsideViewport:return o.revealInCenterIfOutsideViewport(r);case sb.AtTop:return o.revealInViewAtTop(r)}}$trySetSelections(e,t){const i=this._notebookEditorService.getNotebookEditor(e);i&&(i.setSelections(t),t.length&&i.setFocus({start:t[0].start,end:t[0].start+1}))}};S3=f([p(1,de),p(2,AN),p(3,Ie),p(4,ne)],S3);var vT;class ete{static delta(e,t){if(!e)return{addedDocuments:[...t.documents],removedDocuments:[],addedEditors:[...t.textEditors.values()],removedEditors:[],visibleEditors:[...t.visibleEditors].map(a=>a[0])};const i=Bne(e.documents,t.documents),n=WF(e.textEditors,t.textEditors),o=e.activeEditor!==t.activeEditor?t.activeEditor:void 0,r=WF(e.visibleEditors,t.visibleEditors);return{addedDocuments:i.added,removedDocuments:i.removed.map(a=>a.uri),addedEditors:n.added,removedEditors:n.removed.map(a=>a.getId()),newActiveEditor:o,visibleEditors:r.added.length===0&&r.removed.length===0?void 0:[...t.visibleEditors].map(a=>a[0])}}constructor(e,t,i,n){this.documents=e,this.textEditors=t,this.activeEditor=i,this.visibleEditors=n}}let tte=vT=class{constructor(e,t,i,n,o,r,a){this._notebookService=i,this._notebookEditorService=n,this._editorService=o,this._editorGroupService=r,this._logService=a,this._disposables=new U,this._editorListeners=new ei,this._proxy=e.getProxy(Ye.ExtHostNotebook),this._mainThreadNotebooks=t.createInstance(w3,e),this._mainThreadEditors=t.createInstance(S3,e),e.set($e.MainThreadNotebookDocuments,this._mainThreadNotebooks),e.set($e.MainThreadNotebookEditors,this._mainThreadEditors),this._notebookService.onWillAddNotebookDocument(()=>this._updateState(),this,this._disposables),this._notebookService.onDidRemoveNotebookDocument(()=>this._updateState(),this,this._disposables),this._editorService.onDidActiveEditorChange(()=>this._updateState(),this,this._disposables),this._editorService.onDidVisibleEditorsChange(()=>this._updateState(),this,this._disposables),this._notebookEditorService.onDidAddNotebookEditor(this._handleEditorAdd,this,this._disposables),this._notebookEditorService.onDidRemoveNotebookEditor(this._handleEditorRemove,this,this._disposables),this._updateState()}dispose(){this._mainThreadNotebooks.dispose(),this._mainThreadEditors.dispose(),this._disposables.dispose(),this._editorListeners.dispose()}_handleEditorAdd(e){this._editorListeners.set(e.getId(),Lo(e.onDidChangeModel(()=>this._updateState()),e.onDidFocusWidget(()=>this._updateState(e)))),this._updateState()}_handleEditorRemove(e){this._editorListeners.deleteAndDispose(e.getId()),this._updateState()}_updateState(e){const t=new Map,i=new Map;for(const a of this._notebookEditorService.listNotebookEditors())a.hasModel()&&t.set(a.getId(),a);const n=dl(this._editorService.activeEditorPane);let o=null;n?o=n.getId():e?.textModel&&(o=e.getId()),o&&!t.has(o)&&(this._logService.trace("MainThreadNotebooksAndEditors#_updateState: active editor is not in editors list",o,t.keys()),o=null);for(const a of this._editorService.visibleEditorPanes){const c=dl(a);c?.hasModel()&&t.has(c.getId())&&i.set(c.getId(),c)}const r=new ete(new Set(this._notebookService.listNotebookDocuments()),t,o,i);this._onDelta(ete.delta(this._currentState,r)),this._currentState=r}_onDelta(e){if(vT._isDeltaEmpty(e))return;const t={removedDocuments:e.removedDocuments,removedEditors:e.removedEditors,newActiveEditor:e.newActiveEditor,visibleEditors:e.visibleEditors,addedDocuments:e.addedDocuments.map(vT._asModelAddData),addedEditors:e.addedEditors.map(this._asEditorAddData,this)};this._proxy.$acceptDocumentAndEditorsDelta(new Jr(t)),this._mainThreadEditors.handleEditorsRemoved(e.removedEditors),this._mainThreadNotebooks.handleNotebooksRemoved(e.removedDocuments),this._mainThreadNotebooks.handleNotebooksAdded(e.addedDocuments),this._mainThreadEditors.handleEditorsAdded(e.addedEditors)}static _isDeltaEmpty(e){return!(e.addedDocuments!==void 0&&e.addedDocuments.length>0||e.removedDocuments!==void 0&&e.removedDocuments.length>0||e.addedEditors!==void 0&&e.addedEditors.length>0||e.removedEditors!==void 0&&e.removedEditors.length>0||e.visibleEditors!==void 0&&e.visibleEditors.length>0||e.newActiveEditor!==void 0)}static _asModelAddData(e){return{viewType:e.viewType,uri:e.uri,metadata:e.metadata,versionId:e.versionId,cells:e.cells.map(br.toNotebookCellDto)}}_asEditorAddData(e){const t=this._editorService.visibleEditorPanes.find(i=>dl(i)===e);return{id:e.getId(),documentUri:e.textModel.uri,selections:e.getSelections(),visibleRanges:e.visibleRanges,viewColumn:t&&Jp(this._editorGroupService,t.group),viewType:e.getViewModel().viewType}}};tte=vT=f([n_,p(1,J),p(2,$h),p(3,AN),p(4,de),p(5,Ie),p(6,Pe)],tte);let ite=class extends F{constructor(e,t){super(),this.messaging=t,this.proxy=e.getProxy(Ye.ExtHostNotebookRenderers),this._register(t.onShouldPostMessage(i=>{this.proxy.$postRendererMessage(i.editorId,i.rendererId,i.message)}))}$postMessage(e,t,i){return this.messaging.receiveMessage(e,t,i)}};ite=f([ht($e.MainThreadNotebookRenderers),p(1,mre)],ite);var LL;(function(s){s[s.Save=1]="Save",s[s.Backup=2]="Backup"})(LL||(LL={}));var _T,za;(function(s){s[s.SAVED=0]="SAVED",s[s.DIRTY=1]="DIRTY",s[s.PENDING_SAVE=2]="PENDING_SAVE",s[s.CONFLICT=3]="CONFLICT",s[s.ORPHAN=4]="ORPHAN",s[s.ERROR=5]="ERROR"})(za||(za={}));let nte=class extends SL{static{_T=this}get model(){return this._model}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w){super(t,r),this.typeId=e,this.name=i,this.modelFactory=n,this.externalResolver=o,this.logService=a,this.workingCopyFileService=c,this.filesConfigurationService=d,this.workingCopyBackupService=l,this.notificationService=g,this.workingCopyEditorService=m,this.editorService=v,this.elevatedFileService=y,this.progressService=w,this.capabilities=NE.None,this._model=void 0,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidResolve=this._register(new M),this.onDidResolve=this._onDidResolve.event,this._onDidChangeDirty=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidSaveError=this._register(new M),this.onDidSaveError=this._onDidSaveError.event,this._onDidSave=this._register(new M),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new M),this.onDidRevert=this._onDidRevert.event,this._onDidChangeReadonly=this._register(new M),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this.dirty=!1,this.ignoreDirtyOnModelContentChange=!1,this.versionId=0,this.lastContentChangeFromUndoRedo=void 0,this.saveSequentializer=new Oye,this.ignoreSaveFromSaveParticipants=!1,this.inConflictMode=!1,this.inErrorMode=!1,this._register(u.registerWorkingCopy(this)),this.registerListeners()}registerListeners(){this._register(this.filesConfigurationService.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))}isDirty(){return this.dirty}markModified(){this.setDirty(!0)}setDirty(e){if(!this.isResolved())return;const t=this.dirty;this.doSetDirty(e),e!==t&&this._onDidChangeDirty.fire()}doSetDirty(e){const t=this.dirty,i=this.inConflictMode,n=this.inErrorMode,o=this.savedVersionId;return e?this.dirty=!0:(this.dirty=!1,this.inConflictMode=!1,this.inErrorMode=!1,this.isResolved()&&(this.savedVersionId=this.model.versionId)),()=>{this.dirty=t,this.inConflictMode=i,this.inErrorMode=n,this.savedVersionId=o}}isResolved(){return!!this.model}async resolve(e){if(this.trace("resolve() - enter"),this.isDisposed()){this.trace("resolve() - exit - without resolving because file working copy is disposed");return}if(!e?.contents&&(this.dirty||this.saveSequentializer.isRunning())){this.trace("resolve() - exit - without resolving because file working copy is dirty or being saved");return}return this.doResolve(e)}async doResolve(e){if(e?.contents)return this.resolveFromBuffer(e.contents);if(!(!this.isResolved()&&await this.resolveFromBackup()))return this.resolveFromFile(e)}async resolveFromBuffer(e){this.trace("resolveFromBuffer()");let t,i,n,o;try{const r=await this.fileService.stat(this.resource);t=r.mtime,i=r.ctime,n=r.size,o=r.etag,this.setOrphaned(!1)}catch(r){t=Date.now(),i=Date.now(),n=0,o=FD,this.setOrphaned(r.fileOperationResult===$n.FILE_NOT_FOUND)}return this.resolveFromContent({resource:this.resource,name:this.name,mtime:t,ctime:i,size:n,etag:o,value:e,readonly:!1,locked:!1},!0)}async resolveFromBackup(){const e=await this.workingCopyBackupService.resolve(this);return this.isResolved()?(this.trace("resolveFromBackup() - exit - withoutresolving because previously new file working copy got created meanwhile"),!0):e?(await this.doResolveFromBackup(e),!0):!1}async doResolveFromBackup(e){this.trace("doResolveFromBackup()"),await this.resolveFromContent({resource:this.resource,name:this.name,mtime:e.meta?e.meta.mtime:Date.now(),ctime:e.meta?e.meta.ctime:Date.now(),size:e.meta?e.meta.size:0,etag:e.meta?e.meta.etag:FD,value:e.value,readonly:!1,locked:!1},!0),e.meta&&e.meta.orphaned&&this.setOrphaned(!0)}async resolveFromFile(e){this.trace("resolveFromFile()");const t=e?.forceReadFromFile;let i;t?i=FD:this.lastResolvedFileStat&&(i=this.lastResolvedFileStat.etag);const n=this.versionId;try{const o=await this.fileService.readFileStream(this.resource,{etag:i,limits:e?.limits});if(this.setOrphaned(!1),n!==this.versionId){this.trace("resolveFromFile() - exit - without resolving because file working copy content changed");return}await this.resolveFromContent(o,!1)}catch(o){const r=o.fileOperationResult;if(this.setOrphaned(r===$n.FILE_NOT_FOUND),this.isResolved()&&r===$n.FILE_NOT_MODIFIED_SINCE){o instanceof Fye&&this.updateLastResolvedFileStat(o.stat);return}if(this.isResolved()&&r===$n.FILE_NOT_FOUND&&!t)return;throw o}}async resolveFromContent(e,t){if(this.trace("resolveFromContent() - enter"),this.isDisposed()){this.trace("resolveFromContent() - exit - because working copy is disposed");return}this.updateLastResolvedFileStat({resource:this.resource,name:e.name,mtime:e.mtime,ctime:e.ctime,size:e.size,etag:e.etag,readonly:e.readonly,locked:e.locked,isFile:!0,isDirectory:!1,isSymbolicLink:!1,children:void 0}),this.isResolved()?await this.doUpdateModel(e.value):await this.doCreateModel(e.value),this.setDirty(!!t),this._onDidResolve.fire()}async doCreateModel(e){this.trace("doCreateModel()"),this._model=this._register(await this.modelFactory.createModel(this.resource,e,ye.None)),this.installModelListeners(this._model)}async doUpdateModel(e){this.trace("doUpdateModel()"),this.ignoreDirtyOnModelContentChange=!0;try{await this.model?.update(e,ye.None)}finally{this.ignoreDirtyOnModelContentChange=!1}}installModelListeners(e){this._register(e.onDidChangeContent(t=>this.onModelContentChanged(e,t.isUndoing||t.isRedoing))),this._register(e.onWillDispose(()=>this.dispose()))}onModelContentChanged(e,t){if(this.trace("onModelContentChanged() - enter"),this.versionId++,this.trace(`onModelContentChanged() - new versionId ${this.versionId}`),t&&(this.lastContentChangeFromUndoRedo=Date.now()),!this.ignoreDirtyOnModelContentChange&&!this.isReadonly())if(e.versionId===this.savedVersionId){this.trace("onModelContentChanged() - model content changed back to last saved version");const i=this.dirty;this.setDirty(!1),i&&this._onDidRevert.fire()}else this.trace("onModelContentChanged() - model content changed and marked as dirty"),this.setDirty(!0);this._onDidChangeContent.fire()}async forceResolveFromFile(){this.isDisposed()||await this.externalResolver({forceReadFromFile:!0})}get backupDelay(){return this.model?.configuration?.backupDelay}async backup(e){let t;this.lastResolvedFileStat&&(t={mtime:this.lastResolvedFileStat.mtime,ctime:this.lastResolvedFileStat.ctime,size:this.lastResolvedFileStat.size,etag:this.lastResolvedFileStat.etag,orphaned:this.isOrphaned()});let i;return this.isResolved()&&(i=await xh(this.model.snapshot(LL.Backup,e),e)),{meta:t,content:i}}static{this.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD=500}async save(e=Object.create(null)){return this.isResolved()?this.isReadonly()?(this.trace("save() - ignoring request for readonly resource"),!1):(this.hasState(za.CONFLICT)||this.hasState(za.ERROR))&&(e.reason===ui.AUTO||e.reason===ui.FOCUS_CHANGE||e.reason===ui.WINDOW_CHANGE)?(this.trace("save() - ignoring auto save request for file working copy that is in conflict or error"),!1):(this.trace("save() - enter"),await this.doSave(e),this.trace("save() - exit"),this.hasState(za.SAVED)):!1}async doSave(e){typeof e.reason!="number"&&(e.reason=ui.EXPLICIT);const t=this.versionId;if(this.trace(`doSave(${t}) - enter with versionId ${t}`),this.ignoreSaveFromSaveParticipants){this.trace(`doSave(${t}) - exit - refusing to save() recursively from save participant`);return}if(this.saveSequentializer.isRunning(t))return this.trace(`doSave(${t}) - exit - found a running save for versionId ${t}`),this.saveSequentializer.running;if(!e.force&&!this.dirty){this.trace(`doSave(${t}) - exit - because not dirty and/or versionId is different (this.isDirty: ${this.dirty}, this.versionId: ${this.versionId})`);return}if(this.saveSequentializer.isRunning())return this.trace(`doSave(${t}) - exit - because busy saving`),this.saveSequentializer.cancelRunning(),this.saveSequentializer.queue(()=>this.doSave(e));this.isResolved()&&this.model.pushStackElement();const i=new ri;return this.progressService.withProgress({title:h(13205,"Saving '{0}'",this.name),location:qo.Window,cancellable:!0,delay:this.isDirty()?3e3:5e3},n=>this.doSaveSequential(t,e,n,i),()=>{i.cancel()}).finally(()=>{i.dispose()})}doSaveSequential(e,t,i,n){return this.saveSequentializer.run(e,(async()=>{if(this.isResolved()&&!t.skipSaveParticipants&&this.workingCopyFileService.hasSaveParticipants)try{if(t.reason===ui.AUTO&&typeof this.lastContentChangeFromUndoRedo=="number"){const a=Date.now()-this.lastContentChangeFromUndoRedo;a<_T.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD&&await Ia(_T.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD-a)}if(!n.token.isCancellationRequested){this.ignoreSaveFromSaveParticipants=!0;try{await this.workingCopyFileService.runSaveParticipants(this,{reason:t.reason??ui.EXPLICIT,savedFrom:t.from},i,n.token)}catch(a){gs(a)&&!n.token.isCancellationRequested&&n.cancel()}finally{this.ignoreSaveFromSaveParticipants=!1}}}catch(a){this.logService.error(`[stored file working copy] runSaveParticipants(${e}) - resulted in an error: ${a.toString()}`,this.resource.toString(),this.typeId)}if(n.token.isCancellationRequested||this.isDisposed()||!this.isResolved())return;e=this.versionId,this.inErrorMode=!1,i.report({message:h(13206,"Writing into file...")}),this.trace(`doSave(${e}) - before write()`);const o=Gt(this.lastResolvedFileStat),r=this;return this.saveSequentializer.run(e,(async()=>{try{const a={mtime:o.mtime,etag:t.ignoreModifiedSince||!this.filesConfigurationService.preventSaveConflicts(o.resource)?FD:o.etag,unlock:t.writeUnlock};let c;if(typeof r.model.save=="function")try{c=await r.model.save(a,n.token)}catch(d){if(n.token.isCancellationRequested)return;throw d}else{const d=await xh(r.model.snapshot(LL.Save,n.token),n.token);if(n.token.isCancellationRequested)return;n.dispose(),t?.writeElevated&&this.elevatedFileService.isSupported(o.resource)?c=await this.elevatedFileService.writeFileElevated(o.resource,Gt(d),a):c=await this.fileService.writeFile(o.resource,Gt(d),a)}this.handleSaveSuccess(c,e,t)}catch(a){this.handleSaveError(a,e,t)}})(),()=>n.cancel())})(),()=>n.cancel())}handleSaveSuccess(e,t,i){this.updateLastResolvedFileStat(e),t===this.versionId?(this.trace(`handleSaveSuccess(${t}) - setting dirty to false because versionId did not change`),this.setDirty(!1)):this.trace(`handleSaveSuccess(${t}) - not setting dirty to false because versionId did change meanwhile`),this.setOrphaned(!1),this._onDidSave.fire({reason:i.reason,stat:e,source:i.source})}handleSaveError(e,t,i){if((i.ignoreErrorHandler?this.logService.trace:this.logService.error).apply(this.logService,[`[stored file working copy] handleSaveError(${t}) - exit - resulted in a save error: ${e.toString()}`,this.resource.toString(),this.typeId]),i.ignoreErrorHandler)throw e;this.setDirty(!0),this.inErrorMode=!0,e.fileOperationResult===$n.FILE_MODIFIED_SINCE&&(this.inConflictMode=!0),this.doHandleSaveError(e,i),this._onDidSaveError.fire()}doHandleSaveError(e,t){const i=e,n=[];let o;if(i.fileOperationResult===$n.FILE_MODIFIED_SINCE)o=h(13207,"Failed to save '{0}': The content of the file is newer. Do you want to overwrite the file with your changes?",this.name),n.push(Ci({id:"fileWorkingCopy.overwrite",label:h(13208,"Overwrite"),run:()=>this.save({...t,ignoreModifiedSince:!0,reason:ui.EXPLICIT})})),n.push(Ci({id:"fileWorkingCopy.revert",label:h(13209,"Revert"),run:()=>this.revert()}));else{const c=i.fileOperationResult===$n.FILE_WRITE_LOCKED,d=c&&i.options?.unlock,l=i.fileOperationResult===$n.FILE_PERMISSION_DENIED,u=this.elevatedFileService.isSupported(this.resource);Wye(e)&&n.push(...e.actions),u&&(l||d)?n.push(Ci({id:"fileWorkingCopy.saveElevated",label:d?pn?h(13210,"Overwrite as Admin..."):h(13211,"Overwrite as Sudo..."):pn?h(13212,"Retry as Admin..."):h(13213,"Retry as Sudo..."),run:()=>{this.save({...t,writeElevated:!0,writeUnlock:d,reason:ui.EXPLICIT})}})):c?n.push(Ci({id:"fileWorkingCopy.unlock",label:h(13208,"Overwrite"),run:()=>this.save({...t,writeUnlock:!0,reason:ui.EXPLICIT})})):n.push(Ci({id:"fileWorkingCopy.retry",label:h(13214,"Retry"),run:()=>this.save({...t,reason:ui.EXPLICIT})})),n.push(Ci({id:"fileWorkingCopy.saveAs",label:h(13215,"Save As..."),run:async()=>{const g=this.workingCopyEditorService.findEditor(this);g&&((await this.editorService.save(g,{saveAs:!0,reason:ui.EXPLICIT})).success||this.doHandleSaveError(e,t))}})),n.push(Ci({id:"fileWorkingCopy.revert",label:h(13209,"Revert"),run:()=>this.revert()})),c?d&&u?o=pn?h(13216,"Failed to save '{0}': File is read-only. Select 'Overwrite as Admin' to retry as administrator.",this.name):h(13217,"Failed to save '{0}': File is read-only. Select 'Overwrite as Sudo' to retry as superuser.",this.name):o=h(13218,"Failed to save '{0}': File is read-only. Select 'Overwrite' to attempt to make it writeable.",this.name):u&&l?o=pn?h(13219,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Admin' to retry as administrator.",this.name):h(13220,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Sudo' to retry as superuser.",this.name):o=h(13221,"Failed to save '{0}': {1}",this.name,ho(e,!1))}const r=this.notificationService.notify({id:`${cc(this.resource.toString())}`,severity:Me.Error,message:o,actions:{primary:n}}),a=this._register(D.once(D.any(this.onDidSave,this.onDidRevert))(()=>r.close()));this._register(D.once(r.onDidClose)(()=>a.dispose()))}updateLastResolvedFileStat(e){const t=this.isReadonly();this.lastResolvedFileStat?this.lastResolvedFileStat.mtime<=e.mtime?this.lastResolvedFileStat=e:this.lastResolvedFileStat={...this.lastResolvedFileStat,readonly:e.readonly,locked:e.locked}:this.lastResolvedFileStat=e,this.isReadonly()!==t&&this._onDidChangeReadonly.fire()}async revert(e){if(!this.isResolved()||!this.dirty&&!e?.force)return;this.trace("revert()");const t=this.dirty,i=this.doSetDirty(!1);if(!e?.soft)try{await this.forceResolveFromFile()}catch(o){if(o.fileOperationResult!==$n.FILE_NOT_FOUND)throw i(),o}this._onDidRevert.fire(),t&&this._onDidChangeDirty.fire()}hasState(e){switch(e){case za.CONFLICT:return this.inConflictMode;case za.DIRTY:return this.dirty;case za.ERROR:return this.inErrorMode;case za.ORPHAN:return this.isOrphaned();case za.PENDING_SAVE:return this.saveSequentializer.isRunning();case za.SAVED:return!this.dirty}}async joinState(e){return this.saveSequentializer.running}isReadonly(){return this.filesConfigurationService.isReadonly(this.resource,this.lastResolvedFileStat)}trace(e){this.logService.trace(`[stored file working copy] ${e}`,this.resource.toString(),this.typeId)}dispose(){this.trace("dispose()"),this.inConflictMode=!1,this.inErrorMode=!1,this._model=void 0,super.dispose()}};nte=_T=f([p(5,Xe),p(6,Pe),p(7,mg),p(8,Ns),p(9,Xq),p(10,vg),p(11,At),p(12,$re),p(13,de),p(14,$se),p(15,bl)],nte);var F_;let ste=F_=class extends Bv{constructor(e,t,i,n,o,r){super(),this.resource=e,this._hasAssociatedFilePath=t,this.viewType=i,this._workingCopyManager=n,this._filesConfigurationService=r,this._onDidChangeDirty=this._register(new M),this._onDidSave=this._register(new M),this._onDidChangeOrphaned=this._register(new M),this._onDidChangeReadonly=this._register(new M),this._onDidRevertUntitled=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this.onDidSave=this._onDidSave.event,this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this.onDidChangeReadonly=this._onDidChangeReadonly.event,this.onDidRevertUntitled=this._onDidRevertUntitled.event,this._workingCopyListeners=this._register(new U),this.scratchPad=o}dispose(){this._workingCopy?.dispose(),super.dispose()}get notebook(){return this._workingCopy?.model?.notebookModel}isResolved(){return!!this._workingCopy?.model?.notebookModel}async canDispose(){return this._workingCopy&&F_._isStoredFileWorkingCopy(this._workingCopy)?this._workingCopyManager.stored.canDispose(this._workingCopy):!0}isDirty(){return this._workingCopy?.isDirty()??!1}isModified(){return this._workingCopy?.isModified()??!1}isOrphaned(){return F_._isStoredFileWorkingCopy(this._workingCopy)&&this._workingCopy.hasState(za.ORPHAN)}hasAssociatedFilePath(){return!F_._isStoredFileWorkingCopy(this._workingCopy)&&!!this._workingCopy?.hasAssociatedFilePath}isReadonly(){return F_._isStoredFileWorkingCopy(this._workingCopy)?this._workingCopy?.isReadonly():this._filesConfigurationService.isReadonly(this.resource)}get hasErrorState(){return this._workingCopy&&"hasState"in this._workingCopy?this._workingCopy.hasState(za.ERROR):!1}async revert(e){return St(this.isResolved()),this._workingCopy.revert(e)}async save(e){return St(this.isResolved()),this._workingCopy.save(e)}async load(e){return!this._workingCopy||!this._workingCopy.model?(this.resource.scheme===ae.untitled?(this._hasAssociatedFilePath?this._workingCopy=await this._workingCopyManager.resolve({associatedResource:this.resource}):this._workingCopy=await this._workingCopyManager.resolve({untitledResource:this.resource,isScratchpad:this.scratchPad}),this._register(this._workingCopy.onDidRevert(()=>this._onDidRevertUntitled.fire()))):(this._workingCopy=await this._workingCopyManager.resolve(this.resource,{limits:e?.limits,reload:e?.forceReadFromFile?{async:!1,force:!0}:void 0}),this._workingCopyListeners.add(this._workingCopy.onDidSave(t=>this._onDidSave.fire(t))),this._workingCopyListeners.add(this._workingCopy.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire())),this._workingCopyListeners.add(this._workingCopy.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))),this._workingCopyListeners.add(this._workingCopy.onDidChangeDirty(()=>this._onDidChangeDirty.fire(),void 0)),this._workingCopyListeners.add(this._workingCopy.onWillDispose(()=>{this._workingCopyListeners.clear(),this._workingCopy?.model?.dispose()}))):await this._workingCopyManager.resolve(this.resource,{reload:{async:!e?.forceReadFromFile,force:e?.forceReadFromFile},limits:e?.limits}),St(this.isResolved()),this}async saveAs(e){const t=await this._workingCopyManager.saveAs(this.resource,e);if(t)return{resource:t.resource}}static _isStoredFileWorkingCopy(e){return!(e&&e.capabilities&NE.Untitled)}};ste=F_=f([p(5,Ns)],ste);class Rge extends F{constructor(e,t,i,n,o){super(),this._notebookModel=e,this._notebookService=t,this._configurationService=i,this._telemetryService=n,this._notebookLogService=o,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this.configuration=void 0,this.onWillDispose=e.onWillDispose.bind(e),this._register(e.onDidChangeContent(a=>{for(const c of a.rawEvents)if(c.kind!==Fc.Initialize&&!c.transient){this._onDidChangeContent.fire({isRedoing:!1,isUndoing:!1,isInitial:!1});break}}));const r=this._configurationService.getValue(yoe.remoteSaving);(r||e.uri.scheme===ae.vscodeRemote)&&(this.configuration={backupDelay:1e4}),r&&this.setSaveDelegate().catch(console.error)}async setSaveDelegate(){await this.getNotebookSerializer(),this.save=async(e,t)=>{try{let i=this._notebookService.tryGetDataProviderSync(this.notebookModel.viewType)?.serializer;if(i||(this._notebookLogService.info("WorkingCopyModel","No serializer found for notebook model, checking if provider still needs to be resolved"),i=await this.getNotebookSerializer()),t.isCancellationRequested)throw new $s;return await i.save(this._notebookModel.uri,this._notebookModel.versionId,e,t)}catch(i){if(!t.isCancellationRequested){const n=this._notebookModel.viewType==="jupyter-notebook"||this._notebookModel.viewType==="interactive";this._telemetryService.publicLogError2("notebook/SaveError",{isRemote:this._notebookModel.uri.scheme===ae.vscodeRemote,isIPyNbWorkerSerializer:n&&this._configurationService.getValue("ipynb.experimental.serialization"),error:i})}throw i}}}dispose(){this._notebookModel.dispose(),super.dispose()}get notebookModel(){return this._notebookModel}async snapshot(e,t){return this._notebookService.createNotebookTextDocumentSnapshot(this._notebookModel.uri,e,t)}async update(e,t){const i=await this.getNotebookSerializer(),n=await Bye(e),o=await i.dataToNotebook(n);if(t.isCancellationRequested)throw new $s;this._notebookLogService.info("WorkingCopyModel","Notebook content updated from file system - "+this._notebookModel.uri.toString()),this._notebookModel.reset(o.cells,o.metadata,i.options)}async getNotebookSerializer(){const e=await this._notebookService.withNotebookDataProvider(this.notebookModel.viewType);if(!(e instanceof SO))throw new Error("CANNOT open file notebook with this provider");return e.serializer}get versionId(){return this._notebookModel.alternativeVersionId}pushStackElement(){this._notebookModel.pushStackElement()}}let ote=class{constructor(e,t,i,n,o){this._viewType=e,this._notebookService=t,this._configurationService=i,this._telemetryService=n,this._notebookLogService=o}async createModel(e,t,i){const n=this._notebookService.getNotebookTextModel(e)??await this._notebookService.createNotebookTextModel(this._viewType,e,t);return new Rge(n,this._notebookService,this._configurationService,this._telemetryService,this._notebookLogService)}};ote=f([p(1,$h),p(2,ne),p(3,li),p(4,fre)],ote);class qHe{constructor(e){this._proxy=e.getProxy(Ye.ExtHostNotebookDocumentSaveParticipant)}async participate(e,t,i,n){if(!e.model||!(e.model instanceof Rge))return;let o;const r=new Promise((a,c)=>{o=setTimeout(()=>c(new Error(h(2449,"Aborted onWillSaveNotebookDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason,n).then(d=>{clearTimeout(o)}).then(a,c)});return KM(r,n)}}let rte=class{constructor(e,t,i){this.workingCopyFileService=i,this._saveParticipantDisposable=this.workingCopyFileService.addSaveParticipant(t.createInstance(qHe,e))}dispose(){this._saveParticipantDisposable.dispose()}};rte=f([n_,p(1,J),p(2,mg)],rte);let ate=class{constructor(e,t){this._disposables=new U,this._proxy=e.getProxy(Ye.ExtHostInteractive),this._disposables.add(t.onWillAddInteractiveDocument(i=>{this._proxy.$willAddInteractiveDocument(i.inputUri,`
`,WM,i.notebookUri)})),this._disposables.add(t.onWillRemoveInteractiveDocument(i=>{this._proxy.$willRemoveInteractiveDocument(i.inputUri,i.notebookUri)}))}dispose(){this._disposables.dispose()}};ate=f([ht($e.MainThreadInteractive),p(1,xz)],ate);var jl;(function(s){s.Changed="changed",s.ProcessStarted="processStarted",s.ProcessEnded="processEnded",s.Terminated="terminated",s.Start="start",s.AcquiredInput="acquiredInput",s.DependsOnStarted="dependsOnStarted",s.Active="active",s.Inactive="inactive",s.End="end",s.ProblemMatcherStarted="problemMatcherStarted",s.ProblemMatcherEnded="problemMatcherEnded",s.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(jl||(jl={}));var ML;(function(s){function e(t){return{id:t.id,task:nr.from(t.task)}}s.from=e})(ML||(ML={}));var C3;(function(s){function e(t){return{execution:{id:t.execution.id,task:nr.from(t.execution.task)}}}s.from=e})(C3||(C3={}));var NL;(function(s){function e(t){return{execution:{id:t.execution.id,task:nr.from(t.execution.task)},hasErrors:t.hasErrors}}s.from=e})(NL||(NL={}));var E3;(function(s){function e(t,i){return{id:t.id,processId:i}}s.from=e})(E3||(E3={}));var x3;(function(s){function e(t,i){return{id:t.id,exitCode:i}}s.from=e})(x3||(x3={}));var OL;(function(s){function e(i){const n=Object.assign(Object.create(null),i);return delete n._key,n}s.from=e;function t(i,n){let o=fV.createTaskIdentifier(i,console);return o===void 0&&n&&(o={_key:Dn(),type:"$executeOnly"}),o}s.to=t})(OL||(OL={}));var FL;(function(s){function e(i){if(i!=null)return Object.assign(Object.create(null),i)}s.from=e;function t(i){return i==null?mR.defaults:Object.assign(Object.create(null),mR.defaults,i)}s.to=t})(FL||(FL={}));var WL;(function(s){function e(i){if(i!=null)return Object.assign(Object.create(null),i)}s.from=e;function t(i){return i==null?vR.defaults:Object.assign(Object.create(null),vR.defaults,i)}s.to=t})(WL||(WL={}));var BL;(function(s){function e(i){if(i!=null)return{cwd:i.cwd,env:i.env}}s.from=e;function t(i){return i==null?ox.defaults:{cwd:i.cwd||ox.defaults.cwd,env:i.env}}s.to=t})(BL||(BL={}));var cE;(function(s){function e(n){const o=n;return o&&!!o.process}s.is=e;function t(n){const o=It(n.name)?n.name:n.name.value,r=n.args?n.args.map(c=>It(c)?c:c.value):[],a={process:o,args:r};return n.options&&(a.options=BL.from(n.options)),a}s.from=t;function i(n){const o={runtime:ac.Process,name:n.process,args:n.args,presentation:void 0};return o.options=BL.to(n.options),o}s.to=i})(cE||(cE={}));var VL;(function(s){function e(i){if(i==null)return;const n={cwd:i.cwd||ox.defaults.cwd,env:i.env};return i.shell&&(n.executable=i.shell.executable,n.shellArgs=i.shell.args,n.shellQuoting=i.shell.quoting),n}s.from=e;function t(i){if(i==null)return;const n={cwd:i.cwd,env:i.env};return i.executable&&(n.shell={executable:i.executable},i.shellArgs&&(n.shell.args=i.shellArgs),i.shellQuoting&&(n.shell.quoting=i.shellQuoting)),n}s.to=t})(VL||(VL={}));var dE;(function(s){function e(n){const o=n;return o&&(!!o.commandLine||!!o.command)}s.is=e;function t(n){const o={};return n.name&&It(n.name)&&(n.args===void 0||n.args===null||n.args.length===0)?o.commandLine=n.name:(o.command=n.name,o.args=n.args),n.options&&(o.options=VL.from(n.options)),o}s.from=t;function i(n){const o={runtime:ac.Shell,name:n.commandLine?n.commandLine:n.command,args:n.args,presentation:void 0};return n.options&&(o.options=VL.to(n.options)),o}s.to=i})(dE||(dE={}));var bm;(function(s){function e(n){const o=n;return o&&o.customExecution==="customExecution"}s.is=e;function t(n){return{customExecution:"customExecution"}}s.from=t;function i(n){return{runtime:ac.CustomExecution,presentation:void 0}}s.to=i})(bm||(bm={}));var HL;(function(s){function e(i){const n={label:i.label};return i.kind===Ou.Extension?(n.extensionId=i.extension,i.workspaceFolder?n.scope=i.workspaceFolder.uri:n.scope=i.scope):i.kind===Ou.Workspace&&(n.extensionId="$core",n.scope=i.config.workspaceFolder?i.config.workspaceFolder.uri:rp.Global),n}s.from=e;function t(i,n){let o,r;return i.scope===void 0||typeof i.scope=="number"&&i.scope!==rp.Global?n.getWorkspace().folders.length===0?(o=rp.Global,r=void 0):(o=rp.Folder,r=n.getWorkspace().folders[0]):typeof i.scope=="number"?o=i.scope:(o=rp.Folder,r=n.getWorkspaceFolder(R.revive(i.scope))??void 0),{kind:Ou.Extension,label:i.label,extension:i.extensionId,scope:o,workspaceFolder:r}}s.to=t})(HL||(HL={}));var UL;(function(s){function e(t){const i=t;return i&&It(i.id)&&!!i.workspaceFolder}s.is=e})(UL||(UL={}));var nr;(function(s){function e(i){if(i==null||!NC.is(i)&&!Tm.is(i)&&!OC.is(i))return;const n={_id:i._id,name:i.configurationProperties.name,definition:OL.from(i.getDefinition(!0)),source:HL.from(i._source),execution:void 0,presentationOptions:!OC.is(i)&&i.command?FL.from(i.command.presentation):void 0,isBackground:i.configurationProperties.isBackground,problemMatchers:[],hasDefinedMatchers:Tm.is(i)?i.hasDefinedMatchers:!1,runOptions:WL.from(i.runOptions)};if(n.group=I3.from(i.configurationProperties.group),i.configurationProperties.detail&&(n.detail=i.configurationProperties.detail),!OC.is(i)&&i.command)switch(i.command.runtime){case ac.Process:n.execution=cE.from(i.command);break;case ac.Shell:n.execution=dE.from(i.command);break;case ac.CustomExecution:n.execution=bm.from(i.command);break}if(i.configurationProperties.problemMatchers)for(const o of i.configurationProperties.problemMatchers)It(o)&&n.problemMatchers.push(o);return n}s.from=e;function t(i,n,o,r,a){if(!i||typeof i.name!="string")return;let c;if(i.execution&&(dE.is(i.execution)?c=dE.to(i.execution):cE.is(i.execution)?c=cE.to(i.execution):bm.is(i.execution)&&(c=bm.to(i.execution))),!c)return;c.presentation=FL.to(i.presentationOptions);const d=HL.to(i.source,n),l=h(2455,"{0}: {1}",d.label,i.name),u=OL.to(i.definition,o),g=bm.is(i.execution)&&i._id?i._id:`${i.source.extensionId}.${u._key}`;return new Tm(g,d,l,u.type,u,c,i.hasDefinedMatchers,WL.to(i.runOptions),{name:i.name,identifier:l,group:i.group,isBackground:!!i.isBackground,problemMatchers:i.problemMatchers.slice(),detail:i.detail,icon:r,hide:a})}s.to=t})(nr||(nr={}));var I3;(function(s){function e(t){if(t!==void 0)return{_id:typeof t=="string"?t:t._id,isDefault:typeof t=="string"||typeof t.isDefault=="string"?!1:t.isDefault}}s.from=e})(I3||(I3={}));var D3;(function(s){function e(i){return i}s.from=e;function t(i){return i}s.to=t})(D3||(D3={}));let cte=class extends F{constructor(e,t,i,n){super(),this._taskService=t,this._workspaceContextServer=i,this._configurationResolverService=n,this._proxy=e.getProxy(Ye.ExtHostTask),this._providers=new Map,this._register(this._taskService.onDidStateChange(async o=>{if(o.kind===jl.Changed)return;const r=o.__task;if(o.kind===jl.Start){const a=ML.from(r.getTaskExecution());let c=a.task.definition;if(a.task?.execution&&bm.is(a.task.execution)&&o.resolvedVariables){const d=RCe.parse(a.task.definition);for(const l of d.unresolved()){const u=o.resolvedVariables.get(l.inner);u!==void 0&&d.resolve(l,u)}c=await this._configurationResolverService.resolveAsync(r.getWorkspaceFolder(),d)}this._proxy.$onDidStartTask(a,o.terminalId,c)}else o.kind===jl.ProcessStarted?this._proxy.$onDidStartTaskProcess(E3.from(r.getTaskExecution(),o.processId)):o.kind===jl.ProcessEnded?this._proxy.$onDidEndTaskProcess(x3.from(r.getTaskExecution(),o.exitCode)):o.kind===jl.End?this._proxy.$OnDidEndTask(ML.from(r.getTaskExecution())):o.kind===jl.ProblemMatcherStarted?this._proxy.$onDidStartTaskProblemMatchers(C3.from({execution:r.getTaskExecution()})):o.kind===jl.ProblemMatcherEnded?this._proxy.$onDidEndTaskProblemMatchers(NL.from({execution:r.getTaskExecution(),hasErrors:!1})):o.kind===jl.ProblemMatcherFoundErrors&&this._proxy.$onDidEndTaskProblemMatchers(NL.from({execution:r.getTaskExecution(),hasErrors:!0}))}))}dispose(){for(const e of this._providers.values())e.disposable.dispose();this._providers.clear(),super.dispose()}$createTaskId(e){return new Promise((t,i)=>{const n=nr.to(e,this._workspaceContextServer,!0);n?t(n._id):i(new Error("Task could not be created from DTO"))})}$registerTaskProvider(e,t){const i={provideTasks:o=>Promise.resolve(this._proxy.$provideTasks(e,o)).then(r=>{const a=[];for(const d of r.tasks){const l=nr.to(d,this._workspaceContextServer,!0);l?a.push(l):console.error(`Task System: can not convert task: ${JSON.stringify(d.definition,void 0,0)}. Task will be dropped`)}const c={...r.extension,extensionLocation:R.revive(r.extension.extensionLocation)};return{tasks:a,extension:c}}),resolveTask:o=>{const r=nr.from(o);return r?(r.name=r.name===void 0?"":r.name,Promise.resolve(this._proxy.$resolveTask(e,r)).then(a=>{if(a)return nr.to(a,this._workspaceContextServer,!0,o.configurationProperties.icon,o.configurationProperties.hide)})):Promise.resolve(void 0)}},n=this._taskService.registerTaskProvider(i,t);return this._providers.set(e,{disposable:n,provider:i}),Promise.resolve(void 0)}$unregisterTaskProvider(e){const t=this._providers.get(e);return t&&(t.disposable.dispose(),this._providers.delete(e)),Promise.resolve(void 0)}$fetchTasks(e){return this._taskService.tasks(D3.to(e)).then(t=>{const i=[];for(const n of t){const o=nr.from(n);o&&i.push(o)}return i})}getWorkspace(e){let t;if(typeof e=="string")t=e;else{const i=this._workspaceContextServer.getWorkspace(),n=R.revive(e);i.configuration?.toString()===n.toString()?t=i:t=this._workspaceContextServer.getWorkspaceFolder(n)}return t}async $getTaskExecution(e){if(UL.is(e)){const t=this.getWorkspace(e.workspaceFolder);if(t){const i=await this._taskService.getTask(t,e.id,!0);if(i)return{id:i._id,task:nr.from(i)};throw new Error("Task not found")}else throw new Error("No workspace folder")}else{const t=nr.to(e,this._workspaceContextServer,!0);return{id:t._id,task:nr.from(t)}}}$executeTask(e){return new Promise((t,i)=>{if(UL.is(e)){const n=this.getWorkspace(e.workspaceFolder);n?this._taskService.getTask(n,e.id,!0).then(o=>{if(!o)i(new Error("Task not found"));else{const r={id:e.id,task:nr.from(o)};this._taskService.run(o).then(a=>{(a?.exitCode===void 0||a.exitCode!==0)&&this._proxy.$OnDidEndTask(r)},a=>{}),t(r)}},o=>{i(new Error("Task not found"))}):i(new Error("No workspace folder"))}else{const n=nr.to(e,this._workspaceContextServer,!0);this._taskService.run(n).then(void 0,r=>{});const o={id:n._id,task:nr.from(n)};t(o)}})}$customExecutionComplete(e,t){return new Promise((i,n)=>{this._taskService.getActiveTasks().then(o=>{for(const r of o)if(e===r._id){this._taskService.extensionCallbackTaskComplete(r,t).then(a=>{i(void 0)},a=>{n(a)});return}n(new Error("Task to mark as complete not found"))})})}$terminateTask(e){return new Promise((t,i)=>{this._taskService.getActiveTasks().then(n=>{for(const o of n)if(e===o._id){this._taskService.terminate(o).then(r=>{t(void 0)},r=>{i(void 0)});return}i(new hr("Task to terminate not found"))})})}$registerTaskSystem(e,t){let i;switch(t.platform){case"Web":i=WD.Web;break;case"win32":i=WD.Windows;break;case"darwin":i=WD.Mac;break;case"linux":i=WD.Linux;break;default:i=Vye}this._taskService.registerTaskSystem(e,{platform:i,uriProvider:n=>R.from({scheme:t.scheme,authority:t.authority,path:n}),context:this._extHostContext,resolveVariables:(n,o,r)=>{const a=[];return o.variables.forEach(c=>a.push(c)),Promise.resolve(this._proxy.$resolveVariables(n.uri,{process:o.process,variables:a})).then(c=>{const d=Array.from(Object.values(c.variables));return new Promise((l,u)=>{this._configurationResolverService.resolveWithInteraction(n,d,"tasks",void 0,r).then(g=>{g||l(void 0);const m={process:void 0,variables:new Map};for(let v=0;v<d.length;v++){const y=a[v].substring(2,a[v].length-1);if(g&&c.variables[a[v]]===a[v]){const w=g.get(y);typeof w=="string"&&m.variables.set(y,w)}else m.variables.set(y,d[v])}It(c.process)&&(m.process=c.process),l(m)},g=>{u(g)})})})},findExecutable:(n,o,r)=>this._proxy.$findExecutable(n,o,r)})}async $registerSupportedExecutions(e,t,i){return this._taskService.registerSupportedExecutions(e,t,i)}};cte=f([ht($e.MainThreadTask),p(1,yre),p(2,Tt),p(3,Use)],cte);let dte=class extends F{constructor(e,t){super(),this._labelService=t,this._resourceLabelFormatters=this._register(new ei)}$registerResourceLabelFormatter(e,t){t.priority=!0;const i=this._labelService.registerCachedFormatter(t);this._resourceLabelFormatters.set(e,i)}$unregisterResourceLabelFormatter(e){this._resourceLabelFormatters.deleteAndDispose(e)}};dte=f([ht($e.MainThreadLabelService),p(1,di)],dte);let lte=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this.remoteExplorerService=t,this.tunnelService=i,this.notificationService=n,this.configurationService=o,this.logService=r,this.remoteAgentService=a,this.contextKeyService=c,this.elevateionRetry=!1,this.portsAttributesProviders=new Map,this._alreadyRegistered=!1,this._proxy=e.getProxy(Ye.ExtHostTunnelService),this._register(i.onTunnelOpened(()=>this._proxy.$onDidTunnelsChange())),this._register(i.onTunnelClosed(()=>this._proxy.$onDidTunnelsChange()))}processFindingEnabled(){return(!!this.configurationService.getValue(dj)||this.tunnelService.hasTunnelProvider)&&this.configurationService.getValue(lj)!==hj}async $setRemoteTunnelService(e){this.remoteExplorerService.namedProcesses.set(e,"Code Extension Host"),this.remoteExplorerService.portsFeaturesEnabled===Nu.AdditionalFeatures?this._proxy.$registerCandidateFinder(this.processFindingEnabled()):this._register(this.remoteExplorerService.onEnabledPortsFeatures(()=>this._proxy.$registerCandidateFinder(this.processFindingEnabled()))),this._register(this.configurationService.onDidChangeConfiguration(async t=>{if(this.remoteExplorerService.portsFeaturesEnabled===Nu.AdditionalFeatures&&(t.affectsConfiguration(dj)||t.affectsConfiguration(lj)))return this._proxy.$registerCandidateFinder(this.processFindingEnabled())})),this._register(this.tunnelService.onAddedTunnelProvider(async()=>{if(this.remoteExplorerService.portsFeaturesEnabled===Nu.AdditionalFeatures)return this._proxy.$registerCandidateFinder(this.processFindingEnabled())}))}async $registerPortsAttributesProvider(e,t){this.portsAttributesProviders.set(t,e),this._alreadyRegistered||(this.remoteExplorerService.tunnelModel.addAttributesProvider(this),this._alreadyRegistered=!0)}async $unregisterPortsAttributesProvider(e){this.portsAttributesProviders.delete(e)}async providePortAttributes(e,t,i,n){if(this.portsAttributesProviders.size===0)return[];const o=Array.from(this.portsAttributesProviders.entries()).filter(r=>{const a=r[1],c=typeof a.portRange=="number"?[a.portRange,a.portRange+1]:a.portRange,d=c?e.some(u=>c[0]<=u&&u<c[1]):!0,l=!a.commandPattern||i&&i.match(a.commandPattern);return d&&l}).map(r=>r[0]);return o.length===0?[]:this._proxy.$providePortAttributes(o,e,t,i,n)}async $openTunnel(e,t){const i=await this.remoteExplorerService.forward({remote:e.remoteAddress,local:e.localAddressPort,name:e.label,source:{source:Xd.Extension,description:t},elevateIfNeeded:!1});if(!(!i||typeof i=="string"))return!this.elevateionRetry&&e.localAddressPort!==void 0&&i.tunnelLocalPort!==void 0&&this.tunnelService.isPortPrivileged(e.localAddressPort)&&i.tunnelLocalPort!==e.localAddressPort&&this.tunnelService.canElevate&&this.elevationPrompt(e,i,t),wR.fromServiceTunnel(i)}async elevationPrompt(e,t,i){return this.notificationService.prompt(Me.Info,h(2456,"The extension {0} has forwarded port {1}. You'll need to run as superuser to use port {2} locally.",i,e.remoteAddress.port,e.localAddressPort),[{label:h(2457,"Use Port {0} as Sudo...",t.tunnelRemotePort),run:async()=>{this.elevateionRetry=!0,await this.remoteExplorerService.close({host:t.tunnelRemoteHost,port:t.tunnelRemotePort},Dm.Other),await this.remoteExplorerService.forward({remote:e.remoteAddress,local:e.localAddressPort,name:e.label,source:{source:Xd.Extension,description:i},elevateIfNeeded:!0}),this.elevateionRetry=!1}}])}async $closeTunnel(e){return this.remoteExplorerService.close(e,Dm.Other)}async $getTunnels(){return(await this.tunnelService.tunnels).map(e=>({remoteAddress:{port:e.tunnelRemotePort,host:e.tunnelRemoteHost},localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol}))}async $onFoundNewCandidates(e){this.remoteExplorerService.onFoundNewCandidates(e)}async $setTunnelProvider(e,t){const i={forwardPort:(n,o)=>this._proxy.$forwardPort(n,o).then(a=>{if(a){if(typeof a=="string")return a}else return;const c=a;return this.logService.trace(`ForwardedPorts: (MainThreadTunnelService) New tunnel established by tunnel provider: ${c?.remoteAddress.host}:${c?.remoteAddress.port}`),{tunnelRemotePort:c.remoteAddress.port,tunnelRemoteHost:c.remoteAddress.host,localAddress:typeof c.localAddress=="string"?c.localAddress:qr(c.localAddress.host,c.localAddress.port),tunnelLocalPort:typeof c.localAddress!="string"?c.localAddress.port:void 0,public:c.public,privacy:c.privacy,protocol:c.protocol??Va.Http,dispose:async d=>(this.logService.trace(`ForwardedPorts: (MainThreadTunnelService) Closing tunnel from tunnel provider: ${c?.remoteAddress.host}:${c?.remoteAddress.port}`),this._proxy.$closeTunnel({host:c.remoteAddress.host,port:c.remoteAddress.port},d))}})};e&&this.tunnelService.setTunnelFeatures(e),this.tunnelService.setTunnelProvider(i),t&&this.contextKeyService.createKey(KIe.key,!0)}async $setCandidateFilter(){this.remoteExplorerService.setCandidateFilter(e=>this._proxy.$applyCandidateFilter(e))}async $setCandidatePortSource(e){this.remoteAgentService.getEnvironment().then(()=>{switch(e){case AC.None:{Ge.as(qs.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPorts":!1}}]);break}case AC.Output:{Ge.as(qs.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPortsSource":hj}}]);break}case AC.Hybrid:{Ge.as(qs.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPortsSource":XIe}}]);break}}}).catch(()=>{})}};lte=f([ht($e.MainThreadTunnelService),p(1,WN),p(2,DN),p(3,At),p(4,ne),p(5,Pe),p(6,Nh),p(7,me)],lte);function Pge(s){return`onAuthenticationRequest:${s}`}async function zHe(s,e){const t=await s.get(`${e.urlProtocol}.loginAccount`);if(t)try{const i=JSON.parse(t);if(i&&It(i.id)&&It(i.accessToken)&&It(i.providerId))return i}catch(i){console.error(`Failed parsing current auth session value: ${i}`)}}const KHe={type:"object",additionalProperties:!1,properties:{id:{type:"string",description:h(12322,"The id of the authentication provider.")},label:{type:"string",description:h(12323,"The human readable name of the authentication provider.")},authorizationServerGlobs:{type:"array",items:{type:"string",description:h(12324,"A list of globs that match the authorization servers that this provider supports.")},description:h(12325,"A list of globs that match the authorization servers that this provider supports.")}}},jHe=_l.registerExtensionPoint({extensionPoint:"authentication",jsonSchema:{description:h(12326,"Contributes authentication"),type:"array",items:KHe},activationEventsGenerator:(s,e)=>{for(const t of s)t.id&&e.push(`onAuthenticationRequest:${t.id}`)}});let hte=class extends F{constructor(e,t,i,n){super(),this._extensionService=e,this._environmentService=i,this._logService=n,this._onDidRegisterAuthenticationProvider=this._register(new M),this.onDidRegisterAuthenticationProvider=this._onDidRegisterAuthenticationProvider.event,this._onDidUnregisterAuthenticationProvider=this._register(new M),this.onDidUnregisterAuthenticationProvider=this._onDidUnregisterAuthenticationProvider.event,this._onDidChangeSessions=this._register(new M),this.onDidChangeSessions=this._onDidChangeSessions.event,this._onDidChangeDeclaredProviders=this._register(new M),this.onDidChangeDeclaredProviders=this._onDidChangeDeclaredProviders.event,this._authenticationProviders=new Map,this._authenticationProviderDisposables=this._register(new ei),this._delegates=[],this._declaredProviders=[],this._register(t.onDidChangeExtensionSessionAccess(o=>{this._onDidChangeSessions.fire({providerId:o.providerId,label:o.accountName,event:{added:[],changed:[],removed:[]}})})),this._registerEnvContributedAuthenticationProviders(),this._registerAuthenticationExtentionPointHandler()}get declaredProviders(){return this._declaredProviders}_registerEnvContributedAuthenticationProviders(){if(this._environmentService.options?.authenticationProviders?.length)for(const e of this._environmentService.options.authenticationProviders)this.registerDeclaredAuthenticationProvider(e),this.registerAuthenticationProvider(e.id,e)}_registerAuthenticationExtentionPointHandler(){this._register(jHe.setHandler((e,{added:t,removed:i})=>{this._logService.debug(`Found authentication providers. added: ${t.length}, removed: ${i.length}`),t.forEach(o=>{for(const r of o.value){if(wu(r.id)){o.collector.error(h(12327,"An authentication contribution must specify an id."));continue}if(wu(r.label)){o.collector.error(h(12328,"An authentication contribution must specify a label."));continue}this.declaredProviders.some(a=>a.id===r.id)?o.collector.error(h(12329,"This authentication id '{0}' has already been registered",r.id)):(this.registerDeclaredAuthenticationProvider(r),this._logService.debug(`Declared authentication provider: ${r.id}`))}}),i.flatMap(o=>o.value).forEach(o=>{const r=this.declaredProviders.find(a=>a.id===o.id);r&&(this.unregisterDeclaredAuthenticationProvider(r.id),this._logService.debug(`Undeclared authentication provider: ${r.id}`))})}))}registerDeclaredAuthenticationProvider(e){if(wu(e.id))throw new Error(h(12327,"An authentication contribution must specify an id."));if(wu(e.label))throw new Error(h(12328,"An authentication contribution must specify a label."));if(this.declaredProviders.some(t=>t.id===e.id))throw new Error(h(12329,"This authentication id '{0}' has already been registered",e.id));this._declaredProviders.push(e),this._onDidChangeDeclaredProviders.fire()}unregisterDeclaredAuthenticationProvider(e){const t=this.declaredProviders.findIndex(i=>i.id===e);t>-1&&this.declaredProviders.splice(t,1),this._onDidChangeDeclaredProviders.fire()}isAuthenticationProviderRegistered(e){return this._authenticationProviders.has(e)}registerAuthenticationProvider(e,t){this._authenticationProviders.set(e,t);const i=new U;i.add(t.onDidChangeSessions(n=>this._onDidChangeSessions.fire({providerId:e,label:t.label,event:n}))),NM(t)&&i.add(t),this._authenticationProviderDisposables.set(e,i),this._onDidRegisterAuthenticationProvider.fire({id:e,label:t.label})}unregisterAuthenticationProvider(e){const t=this._authenticationProviders.get(e);t&&(this._authenticationProviders.delete(e),this._onDidUnregisterAuthenticationProvider.fire({id:e,label:t.label})),this._authenticationProviderDisposables.deleteAndDispose(e)}getProviderIds(){const e=[];return this._authenticationProviders.forEach(t=>{e.push(t.id)}),e}getProvider(e){if(this._authenticationProviders.has(e))return this._authenticationProviders.get(e);throw new Error(`No authentication provider '${e}' is currently registered.`)}async getAccounts(e){const t=await this.getSessions(e),i=new Array,n=new Set;for(const o of t)n.has(o.account.label)||(n.add(o.account.label),i.push(o.account));return i}async getSessions(e,t,i,n=!1){const o=this._authenticationProviders.get(e)||await this.tryActivateProvider(e,n);if(o){if(i?.authorizationServer){const r=i.authorizationServer.toString(!0);if(!o.authorizationServers?.some(a=>a.toString(!0)===r||ch(a.toString(!0),r)))throw new Error(`The authorization server '${r}' is not supported by the authentication provider '${e}'.`)}return await o.getSessions(t,{account:i?.account,authorizationServer:i?.authorizationServer})}else throw new Error(`No authentication provider '${e}' is currently registered.`)}async createSession(e,t,i){const n=this._authenticationProviders.get(e)||await this.tryActivateProvider(e,!!i?.activateImmediate);if(n)return await n.createSession(t,{account:i?.account,authorizationServer:i?.authorizationServer});throw new Error(`No authentication provider '${e}' is currently registered.`)}async removeSession(e,t){const i=this._authenticationProviders.get(e);if(i)return i.removeSession(t);throw new Error(`No authentication provider '${e}' is currently registered.`)}async getOrActivateProviderIdForServer(e){for(const n of this._authenticationProviders.values())if(n.authorizationServers?.some(o=>o.toString(!0)===e.toString(!0)||ch(o.toString(!0),e.toString(!0))))return n.id;const t=e.toString(!0),i=this._declaredProviders.filter(n=>!this._authenticationProviders.has(n.id)).filter(n=>!!n.authorizationServerGlobs?.some(o=>ch(o,t)));for(const n of i){const o=await this.tryActivateProvider(n.id,!0);if(o.authorizationServers?.some(r=>ch(r.toString(!0),t)))return o.id}}async createDynamicAuthenticationProvider(e,t,i){const n=this._delegates[0];if(!n){this._logService.error("No authentication provider host delegate found");return}const o=await n.create(e,t,i),r=this._authenticationProviders.get(o);if(r)return this._logService.debug(`Created dynamic authentication provider: ${o}`),r;this._logService.error(`Failed to create dynamic authentication provider: ${o}`)}registerAuthenticationProviderHostDelegate(e){return this._delegates.push(e),this._delegates.sort((t,i)=>i.priority-t.priority),{dispose:()=>{const t=this._delegates.indexOf(e);t!==-1&&this._delegates.splice(t,1)}}}async tryActivateProvider(e,t){await this._extensionService.activateByEvent(Pge(e),t?Bp.Immediate:Bp.Normal);let i=this._authenticationProviders.get(e);if(i)return i;const n=new U,o=new Promise((a,c)=>{n.add(D.once(this.onDidRegisterAuthenticationProvider)(d=>{if(d.id===e)if(i=this._authenticationProviders.get(e),i)a(i);else throw new Error(`No authentication provider '${e}' is currently registered.`)}))}),r=new Promise((a,c)=>{const d=setTimeout(()=>{c("Timed out waiting for authentication provider to register")},5e3);n.add(Ee(()=>clearTimeout(d)))});return Promise.race([o,r]).finally(()=>n.dispose())}};hte=f([p(0,hn),p(1,NN),p(2,lf),p(3,Pe)],hte);class YHe extends F{constructor(e,t,i,n,o,r,a){super(),this._proxy=e,this.id=t,this.label=i,this.supportsMultipleAccounts=n,this.authorizationServers=o,this.notificationService=r,this.onDidChangeSessions=a.event}async getSessions(e,t){return this._proxy.$getSessions(this.id,e,t)}createSession(e,t){return this._proxy.$createSession(this.id,e,t)}async removeSession(e){await this._proxy.$removeSession(this.id,e),this.notificationService.info(h(2387,"Successfully signed out."))}}let ute=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(),this.authenticationService=t,this.authenticationExtensionsService=i,this.authenticationAccessService=n,this.authenticationUsageService=o,this.dialogService=r,this.notificationService=a,this.extensionService=c,this.telemetryService=d,this.openerService=l,this.logService=u,this.urlService=g,this.dynamicAuthProviderStorageService=m,this.clipboardService=v,this._registrations=this._register(new ei),this._sentProviderUsageEvents=new Set,this._sentClientIdUsageEvents=new Set,this._proxy=e.getProxy(Ye.ExtHostAuthentication),this._register(this.authenticationService.onDidChangeSessions(y=>this._proxy.$onDidChangeAuthenticationSessions(y.providerId,y.label))),this._register(this.authenticationService.onDidUnregisterAuthenticationProvider(y=>this._proxy.$onDidUnregisterAuthenticationProvider(y.id))),this._register(this.authenticationExtensionsService.onDidChangeAccountPreference(y=>{const w=this.authenticationService.getProvider(y.providerId);this._proxy.$onDidChangeAuthenticationSessions(w.id,w.label,y.extensionIds)})),this._register(this.dynamicAuthProviderStorageService.onDidChangeTokens(y=>{this._proxy.$onDidChangeDynamicAuthProviderTokens(y.authProviderId,y.clientId,y.tokens)})),this._register(t.registerAuthenticationProviderHostDelegate({priority:e.extensionHostKind===Lt.LocalWebWorker?0:1,create:async(y,w,C)=>{const T=y.toString(!0),k=this.dynamicAuthProviderStorageService.getClientId(T);let A;return k&&(A=await this.dynamicAuthProviderStorageService.getSessionsForDynamicAuthProvider(T,k)),await this._proxy.$registerDynamicAuthProvider(y,w,C,k,A)}}))}async $registerAuthenticationProvider(e,t,i,n=[]){this.authenticationService.declaredProviders.find(c=>c.id===e)||(this.logService.warn(`Authentication provider ${e} was not declared in the Extension Manifest.`),this.telemetryService.publicLog2("authentication.providerNotDeclared",{id:e}));const o=new M;this._registrations.set(e,o);const r=n.map(c=>R.revive(c)),a=new YHe(this._proxy,e,t,i,r,this.notificationService,o);this.authenticationService.registerAuthenticationProvider(e,a)}async $unregisterAuthenticationProvider(e){this._registrations.deleteAndDispose(e),this.authenticationService.unregisterAuthenticationProvider(e)}async $ensureProvider(e){if(!this.authenticationService.isAuthenticationProviderRegistered(e))return await this.extensionService.activateByEvent(Pge(e),Bp.Immediate)}async $sendDidChangeSessions(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$removeSession(e,t){return this.authenticationService.removeSession(e,t)}async $waitForUriHandler(e){const t=new Zo,i=this.urlService.registerHandler({handleURL:async o=>o.scheme!==e.scheme||o.authority!==e.authority||o.path!==e.path?!1:(t.complete(o),i.dispose(),!0)});if(!await Bq(t.p,5*60*1e3))throw new Error("Timed out waiting for URI handler");return await t.p}$showContinueNotification(e){const t=h(2388,"Yes"),i=h(2389,"No"),n=new Zo;let o=!1;const a=this.notificationService.prompt(Me.Warning,e,[{label:t,run:()=>o=!0},{label:i,run:()=>o=!1}]).onDidClose(()=>{n.complete(o),a.dispose()});return n.p}async $registerDynamicAuthenticationProvider(e,t,i,n){await this.$registerAuthenticationProvider(e,t,!1,[i]),this.dynamicAuthProviderStorageService.storeClientId(e,R.revive(i).toString(!0),n,t)}async $setSessionsForDynamicAuthProvider(e,t,i){await this.dynamicAuthProviderStorageService.setSessionsForDynamicAuthProvider(e,t,i)}async loginPrompt(e,t,i,n){let o;e.id.startsWith(Ace)?o=h(2390,"The extension '{0}' wants to access the language models provided by {1}.",t,e.label):o=i?h(2391,"The extension '{0}' wants you to sign in again using {1}.",t,e.label):h(2392,"The extension '{0}' wants to sign in using {1}.",t,e.label);const r=[{label:h(2393,"&&Allow"),run(){return!0}}];n?.learnMore&&r.push({label:h(2394,"Learn more"),run:async()=>{const c=this.loginPrompt(e,t,i,n);return await this.openerService.open(R.revive(n.learnMore),{allowCommands:!0}),await c}});const{result:a}=await this.dialogService.prompt({type:Me.Info,message:o,buttons:r,detail:n?.detail,cancelButton:!0});return a??!1}async continueWithIncorrectAccountPrompt(e,t){const i=await this.dialogService.prompt({message:h(2395,"Incorrect account detected"),detail:h(2396,"The chosen account, {0}, does not match the requested account, {1}.",e,t),type:Me.Warning,cancelButton:!0,buttons:[{label:h(2397,"Keep {0}",e),run:()=>e},{label:h(2398,"Login with {0}",t),run:()=>t}]});if(!i.result)throw new $s;return i.result===e}async doGetSession(e,t,i,n,o){const r=R.revive(o.authorizationServer),a=await this.authenticationService.getSessions(e,t,{account:o.account,authorizationServer:r},!0),c=this.authenticationService.getProvider(e);if(o.forceNewSession&&o.createIfNone)throw new Error("Invalid combination of options. Please remove one of the following: forceNewSession, createIfNone");if(o.forceNewSession&&o.silent)throw new Error("Invalid combination of options. Please remove one of the following: forceNewSession, silent");if(o.createIfNone&&o.silent)throw new Error("Invalid combination of options. Please remove one of the following: createIfNone, silent");o.clearSessionPreference&&this._removeAccountPreference(i,e,t);const d=o.account?a[0]:this._getAccountPreference(i,e,t,a);if(!o.forceNewSession&&a.length){if(d&&this.authenticationAccessService.isAccessAllowed(e,d.account.label,i))return d;if(!c.supportsMultipleAccounts&&this.authenticationAccessService.isAccessAllowed(e,a[0].account.label,i))return a[0]}if(o.createIfNone||o.forceNewSession){let l;typeof o.forceNewSession=="object"?l=o.forceNewSession:typeof o.createIfNone=="object"&&(l=o.createIfNone);const u=!!(o.forceNewSession&&a.length);if(!await this.loginPrompt(c,n,u,l))throw new Error("User did not consent to login.");let m;if(a?.length&&!o.forceNewSession)m=c.supportsMultipleAccounts&&!o.account?await this.authenticationExtensionsService.selectSession(e,i,n,t,a):a[0];else{const v=o.account??d?.account;do m=await this.authenticationService.createSession(e,t,{activateImmediate:!0,account:v,authorizationServer:r});while(v&&v.label!==m.account.label&&!await this.continueWithIncorrectAccountPrompt(m.account.label,v.label))}return this.authenticationAccessService.updateAllowedExtensions(e,m.account.label,[{id:i,name:n,allowed:!0}]),this._updateAccountPreference(i,e,m),m}if(!d&&!this.authenticationExtensionsService.getAccountPreference(i,e)){const l=a.find(u=>this.authenticationAccessService.isAccessAllowed(e,u.account.label,i));if(l)return l}o.silent||(a.length?this.authenticationExtensionsService.requestSessionAccess(e,i,n,t,a):await this.authenticationExtensionsService.requestNewSession(e,t,i,n))}async $getSession(e,t,i,n,o){this.sendClientIdUsageTelemetry(i,e,t);const r=await this.doGetSession(e,t,i,n,o);return r&&(this.sendProviderUsageTelemetry(i,e),this.authenticationUsageService.addAccountUsage(e,r.account.label,t,i,n)),r}async $getAccounts(e){return await this.authenticationService.getAccounts(e)}sendClientIdUsageTelemetry(e,t,i){const n=i.some(r=>r.startsWith("VSCODE_CLIENT_ID:")),o=`${e}|${t}|${n}`;this._sentClientIdUsageEvents.has(o)||(this._sentClientIdUsageEvents.add(o),n&&this.telemetryService.publicLog2("authentication.clientIdUsage",{extensionId:e}))}sendProviderUsageTelemetry(e,t){const i=`${e}|${t}`;this._sentProviderUsageEvents.has(i)||(this._sentProviderUsageEvents.add(i),this.telemetryService.publicLog2("authentication.providerUsage",{providerId:t,extensionId:e}))}_getAccountPreference(e,t,i,n){if(n.length===0)return;const o=this.authenticationExtensionsService.getAccountPreference(e,t);if(o)return n.find(c=>c.account.label===o);const r=this.authenticationExtensionsService.getSessionPreference(t,e,i);if(r){const a=n.find(c=>c.id===r);if(a)return this.authenticationExtensionsService.updateAccountPreference(e,t,a.account),a}}_updateAccountPreference(e,t,i){this.authenticationExtensionsService.updateAccountPreference(e,t,i.account),this.authenticationExtensionsService.updateSessionPreference(t,e,i)}_removeAccountPreference(e,t,i){this.authenticationExtensionsService.removeAccountPreference(e,t),this.authenticationExtensionsService.removeSessionPreference(t,e,i)}async $showDeviceCodeModal(e,t){const{result:i}=await this.dialogService.prompt({type:Me.Info,message:h(2399,"Device Code Authentication"),detail:h(2400,`Your code: {0}

To complete authentication, navigate to {1} and enter the code above.`,e,t),buttons:[{label:h(2401,"Copy & Continue"),run:()=>!0}],cancelButton:!0});if(i)try{return await this.clipboardService.writeText(e),await this.openerService.open(R.parse(t))}catch{this.notificationService.error(h(2402,"Failed to open {0}",t))}return!1}};ute=f([ht($e.MainThreadAuthentication),p(1,Uv),p(2,Tz),p(3,NN),p(4,Nre),p(5,Qt),p(6,At),p(7,hn),p(8,li),p(9,hi),p(10,Pe),p(11,$M),p(12,Eae),p(13,Is)],ute);let gte=class{constructor(e,t,i){this.logService=t,this._timelineService=i,this._providerEmitters=new Map,this._proxy=e.getProxy(Ye.ExtHostTimeline)}$registerTimelineProvider(e){this.logService.trace(`MainThreadTimeline#registerTimelineProvider: id=${e.id}`);const t=this._proxy,i=this._providerEmitters;let n=i.get(e.id);n===void 0&&(n=new M,i.set(e.id,n)),this._timelineService.registerTimelineProvider({...e,onDidChange:n.event,async provideTimeline(o,r,a){return cn(await t.$getTimeline(e.id,o,r,a))},dispose(){i.delete(e.id),n?.dispose()}})}$unregisterTimelineProvider(e){this.logService.trace(`MainThreadTimeline#unregisterTimelineProvider: id=${e}`),this._timelineService.unregisterTimelineProvider(e)}$emitTimelineChangeEvent(e){this.logService.trace(`MainThreadTimeline#emitChangeEvent: id=${e.id}, uri=${e.uri?.toString(!0)}`),this._providerEmitters.get(e.id)?.fire(e)}dispose(){}};gte=f([ht($e.MainThreadTimeline),p(1,Pe),p(2,Pre)],gte);let Lge=0;class QHe{constructor(e,t,i,n){this.result=e,this.fromTaskId=t,this.uriIdentityService=i,this.accessor=n,this.fileCoverage=new wn,this.didAddCoverage=jd(this),this.tree=new WA,this.associatedData=new Map}*allPerTestIDs(){const e=new Set;for(const t of this.tree.nodes)if(t.value&&t.value.perTestData)for(const i of t.value.perTestData)e.has(i)||(e.add(i),yield i)}append(e,t){const i=this.getComputedForUri(e.uri),n=this.result,o=(c,d)=>{d[c]?(d[c].covered+=(e[c]?.covered||0)-(i?.[c]?.covered||0),d[c].total+=(e[c]?.total||0)-(i?.[c]?.total||0)):e[c]&&(d[c]={...e[c]})},r=[...this.treePathForUri(e.uri,!0)],a=[];this.tree.mutatePath(this.treePathForUri(e.uri,!1),c=>{if(a.push(c),a.length===r.length)if(c.value){const d=c.value;d.id=e.id,d.statement=e.statement,d.branch=e.branch,d.declaration=e.declaration}else{const d=c.value=new pte(e,n,this.accessor);this.fileCoverage.set(e.uri,d)}else if(c.value)o("statement",c.value),o("branch",c.value),o("declaration",c.value),c.value.didChange.trigger(t);else{const d=Cr(e);d.id=String(Lge++),d.uri=this.treePathToUri(r.slice(0,a.length)),c.value=new Nge(d,n)}if(e.testIds){c.value.perTestData??=new Set;for(const d of e.testIds)c.value.perTestData.add(d)}}),a&&this.didAddCoverage.trigger(t,a)}filterTreeForTest(e){const t=new WA;for(const i of this.tree.values())if(i instanceof pte){if(!i.perTestData?.has(e.toString()))continue;const n=[...this.treePathForUri(i.uri,!0)],o=[];t.mutatePath(this.treePathForUri(i.uri,!1),r=>{o.push(r),r.value??=new ZHe(this.treePathToUri(n.slice(0,o.length)),i.fromResult)})}return t}getAllFiles(){return this.fileCoverage}getUri(e){return this.fileCoverage.get(e)}getComputedForUri(e){return this.tree.find(this.treePathForUri(e,!1))}*treePathForUri(e,t){yield e.scheme,yield e.authority,yield*(!t&&this.uriIdentityService.extUri.ignorePathCasing(e)?e.path.toLowerCase():e.path).split("/")}treePathToUri(e){return R.from({scheme:e[0],authority:e[1],path:e.slice(2).join("/")})}}const XHe=(s,e,t)=>{let i=s.covered,n=s.total;return e&&(i+=e.covered,n+=e.total),t&&(i+=t.covered,n+=t.total),n===0?1:i/n};class Mge{get tpc(){return XHe(this.statement,this.branch,this.declaration)}constructor(e,t){this.fromResult=t,this.didChange=jd(this),this.id=e.id,this.uri=e.uri,this.statement=e.statement,this.branch=e.branch,this.declaration=e.declaration}}class Nge extends Mge{}class ZHe extends Nge{constructor(e,t){super({id:String(Lge++),uri:e,statement:{covered:0,total:0}},t)}}class pte extends Mge{get hasSynchronousDetails(){return this._details instanceof Array||this.resolved}constructor(e,t,i){super(e,t),this.accessor=i}async detailsForTest(e,t=ye.None){this._detailsForTest??=new Map;const i=e.toString(),n=this._detailsForTest.get(i);if(n)return n;const o=(async()=>{try{return await this.accessor.getCoverageDetails(this.id,i,t)}catch(r){throw this._detailsForTest?.delete(i),r}})();return this._detailsForTest.set(i,o),o}async details(e=ye.None){this._details??=this.accessor.getCoverageDetails(this.id,void 0,e);try{const t=await this._details;return this.resolved=!0,t}catch(t){throw this._details=void 0,t}}}const id={[Mi.Running]:6,[Mi.Errored]:5,[Mi.Failed]:4,[Mi.Queued]:3,[Mi.Passed]:2,[Mi.Unset]:0,[Mi.Skipped]:1};Hye(id,(s,e)=>({statusNode:!0,state:Number(e),priority:s}));const JHe=(s,e)=>id[e]-id[s],Oge=(...s)=>{switch(s.length){case 0:return Mi.Unset;case 1:return s[0];case 2:return id[s[0]]>id[s[1]]?s[0]:s[1];default:{let e=s[0];for(let t=1;t<s.length;t++)id[e]<id[s[t]]&&(e=s[t]);return e}}},eUe=Object.keys(id).map(s=>Number(s)).sort(JHe),fte={[Mi.Passed]:0,[Mi.Skipped]:1,[Mi.Failed]:2,[Mi.Errored]:3},Fge=()=>new Uint32Array(eUe.length),tUe=s=>"getOwnDuration"in s,k3=(s,e,t=!1)=>{let i=s.getCurrentComputedState(e);if(i===void 0||t){i=s.getOwnState(e)??Mi.Unset;let n=0;const o=Fge();for(const r of s.getChildren(e)){const a=k3(s,r);n++,o[a]++,i=a===Mi.Skipped&&i===Mi.Unset?Mi.Skipped:Oge(i,a)}n>iUe&&Bge.set(e,o),s.setComputedState(e,i)}return i},Wge=(s,e,t=!1)=>{let i=s.getCurrentComputedDuration(e);if(i===void 0||t){const n=s.getOwnDuration(e);if(n!==void 0)i=n;else{i=void 0;for(const o of s.getChildren(e)){const r=Wge(s,o);r!==void 0&&(i=(i||0)+r)}}s.setComputedDuration(e,i)}return i},iUe=64,Bge=new WeakMap,nUe=(s,e,t,i=!0)=>{const n=s.getCurrentComputedState(e),o=id[n],r=k3(s,e,!0),a=id[r],c=new Set;if(a!==o){s.setComputedState(e,r),c.add(e);let d=n,l=r;for(const u of s.getParents(e)){const g=Bge.get(u);g&&(g[d]--,g[l]++);const m=s.getCurrentComputedState(u);if(a>o){if(m!==void 0&&id[m]>=a||g&&g[l]>1)break;s.setComputedState(u,r),c.add(u)}else{if(m===void 0||id[m]>o||g&&g[d]>0)break;l=k3(s,u,!0),s.setComputedState(u,l),c.add(u)}d=m}}if(tUe(s)&&i)for(const d of dn.concat(dn.single(e),s.getParents(e))){const l=s.getCurrentComputedDuration(d),u=Wge(s,d,!0);if(l===u)break;s.setComputedDuration(d,u),c.add(d)}return c};D.None,Promise.resolve();class sUe{constructor(){this.writeDataEmitter=new M,this.endDeferred=new Zo,this.offset=0,this.onDidWriteData=this.writeDataEmitter.event,this.endPromise=this.endDeferred.p,this.buffers=[]}get length(){return this.offset}getRange(e,t){const i=Re.alloc(t);let n=0;for(const o of this.getRangeIter(e,t))i.buffer.set(o.buffer,n),n+=o.byteLength;return n<t?i.slice(0,n):i}*getRangeIter(e,t){let i=0,n=0;for(const o of this.buffers){if(n+o.byteLength<=e){n+=o.byteLength;continue}const r=Math.max(0,e-n),a=Math.min(o.byteLength,r+t-i);if(yield o.slice(r,a),i+=a-r,n+=o.byteLength,i===t)break}}append(e,t){const i=this.offset;let n=e.byteLength;if(t===void 0)return this.push(e),{offset:i,length:n};let o;(function(d){d[d.CR=13]="CR",d[d.LF=10]="LF"})(o||(o={}));const r=Re.fromString(mte(t,!0)),a=Re.fromString(mte(t,!1));n+=r.byteLength+a.byteLength,this.push(r);let c=e.byteLength;for(;c>0;c--){const d=e.buffer[c-1];if(d!==o.CR&&d!==o.LF)break}return this.push(e.slice(0,c)),this.push(a),this.push(e.slice(c)),{offset:i,length:n}}push(e){e.byteLength!==0&&(this.buffers.push(e),this.writeDataEmitter.fire(e),this.offset+=e.byteLength)}end(){this.endDeferred.complete()}}const mte=(s,e)=>`\x1B]633;SetMark;Id=${mTe(s,e)};Hidden\x07`,oUe=(s,e,t)=>({controllerId:s,expand:Js.NotExpandable,item:{...e},children:[],tasks:[],ownComputedState:Mi.Unset,computedState:Mi.Unset});var sm;(function(s){s[s.ComputedStateChange=0]="ComputedStateChange",s[s.OwnStateChange=1]="OwnStateChange",s[s.NewMessage=2]="NewMessage"})(sm||(sm={}));let wb=class extends F{get completedAt(){return this._completedAt}get tests(){return this.testById.values()}getTestById(e){return this.testById.get(e)?.item}constructor(e,t,i,n,o){super(),this.id=e,this.persist=t,this.request=i,this.insertOrder=n,this.telemetry=o,this.completeEmitter=this._register(new M),this.newTaskEmitter=this._register(new M),this.endTaskEmitter=this._register(new M),this.changeEmitter=this._register(new M),this.testById=new Map,this.testMarkerCounter=0,this.startedAt=Date.now(),this.onChange=this.changeEmitter.event,this.onComplete=this.completeEmitter.event,this.onNewTask=this.newTaskEmitter.event,this.onEndTask=this.endTaskEmitter.event,this.tasks=[],this.name=h(11321,"Test run at {0}",new Date().toLocaleString(sl)),this.counts=Fge(),this.computedStateAccessor={getOwnState:r=>r.ownComputedState,getCurrentComputedState:r=>r.computedState,setComputedState:(r,a)=>r.computedState=a,getChildren:r=>r.children,getParents:r=>{const{testById:a}=this;return function*(){const c=Ln.fromString(r.item.extId).parentId;if(c)for(const d of c.idsToRoot())yield a.get(d.toString())}()}},this.doSerialize=new Ju(()=>({id:this.id,completedAt:this.completedAt,tasks:this.tasks.map(r=>({id:r.id,name:r.name,ctrlId:r.ctrlId,hasCoverage:!!r.coverage.get()})),name:this.name,request:this.request,items:[...this.testById.values()].map(GA.serializeWithoutMessages)})),this.doSerializeWithMessages=new Ju(()=>({id:this.id,completedAt:this.completedAt,tasks:this.tasks.map(r=>({id:r.id,name:r.name,ctrlId:r.ctrlId,hasCoverage:!!r.coverage.get()})),name:this.name,request:this.request,items:[...this.testById.values()].map(GA.serialize)}))}getStateById(e){return this.testById.get(e)}appendOutput(e,t,i,n){const o=e.byteLength>100?e.slice(0,100).toString()+"…":e.toString();let r;(n||i)&&(r=this.testMarkerCounter++);const a=this.mustGetTaskIndex(t),c=this.tasks[a],{offset:d,length:l}=c.output.append(e,r),u={location:i,message:o,offset:d,length:l,marker:r,type:rd.Output},g=n&&this.testById.get(n);g?(g.tasks[a].messages.push(u),this.changeEmitter.fire({item:g,result:this,reason:sm.NewMessage,message:u})):c.otherMessages.push(u)}addTask(e){this.tasks.push({...e,coverage:oi(this,void 0),otherMessages:[],output:new sUe});for(const t of this.tests)t.tasks.push({duration:void 0,messages:[],state:Mi.Unset});this.newTaskEmitter.fire(this.tasks.length-1)}addTestChainToRun(e,t){let i=this.testById.get(t[0].extId);i||(i=this.addTestToRun(e,t[0],null));for(let n=1;n<t.length;n++)i=this.addTestToRun(e,t[n],i.item.extId)}updateState(e,t,i,n){const o=this.testById.get(e);if(!o)return;const r=this.mustGetTaskIndex(t),a=fte[o.tasks[r].state],c=fte[i];a!==void 0&&(c===void 0||c<a)||this.fireUpdateAndRefresh(o,r,i,n)}appendMessage(e,t,i){const n=this.testById.get(e);n&&(n.tasks[this.mustGetTaskIndex(t)].messages.push(i),this.changeEmitter.fire({item:n,result:this,reason:sm.NewMessage,message:i}))}markTaskComplete(e){const t=this.mustGetTaskIndex(e),i=this.tasks[t];i.running=!1,i.output.end(),this.setAllToState(Mi.Unset,e,n=>n.state===Mi.Queued||n.state===Mi.Running),this.endTaskEmitter.fire(t)}markComplete(){if(this._completedAt!==void 0)throw new Error("cannot complete a test result multiple times");for(const e of this.tasks)e.running&&this.markTaskComplete(e.id);this._completedAt=Date.now(),this.completeEmitter.fire(),this.telemetry.publicLog2("test.outcomes",{failures:this.counts[Mi.Errored]+this.counts[Mi.Failed],passes:this.counts[Mi.Passed],controller:this.request.targets.map(e=>e.controllerId).join(",")})}markRetired(e){for(const[t,i]of this.testById)!i.retired&&(!e||e.hasKeyOrParent(Ln.fromString(t).path))&&(i.retired=!0,this.changeEmitter.fire({reason:sm.ComputedStateChange,item:i,result:this}))}toJSON(){return this.completedAt&&this.persist?this.doSerialize.value:void 0}toJSONWithMessages(){return this.completedAt&&this.persist?this.doSerializeWithMessages.value:void 0}setAllToState(e,t,i){const n=this.mustGetTaskIndex(t);for(const o of this.testById.values())i(o.tasks[n],o)&&this.fireUpdateAndRefresh(o,n,e)}fireUpdateAndRefresh(e,t,i,n){const o=e.ownComputedState,r=e.ownDuration,a={item:e,result:this,reason:sm.OwnStateChange,previousState:o,previousOwnDuration:r};e.tasks[t].state=i,n!==void 0&&(e.tasks[t].duration=n,e.ownDuration=Math.max(e.ownDuration||0,n));const c=Oge(...e.tasks.map(d=>d.state));if(c===o){n!==r&&this.changeEmitter.fire(a);return}e.ownComputedState=c,this.counts[o]--,this.counts[c]++,nUe(this.computedStateAccessor,e).forEach(d=>this.changeEmitter.fire(d===e?a:{item:d,result:this,reason:sm.ComputedStateChange}))}addTestToRun(e,t,i){const n=oUe(e,t);if(this.testById.set(t.extId,n),this.counts[Mi.Unset]++,i&&this.testById.get(i)?.children.push(n),this.tasks.length)for(let o=0;o<this.tasks.length;o++)n.tasks.push({duration:void 0,messages:[],state:Mi.Unset});return n}mustGetTaskIndex(e){const t=this.tasks.findIndex(i=>i.id===e);if(t===-1)throw new Error(`Unknown task ${e} in updateState`);return t}};wb=f([p(4,li)],wb);let vte=class extends F{constructor(e,t,i,n,o){super(),this.uriIdentityService=t,this.testService=i,this.testProfiles=n,this.resultService=o,this.diffListener=this._register(new kt),this.testProviderRegistrations=new Map,this.proxy=e.getProxy(Ye.ExtHostTesting),this._register(this.testService.registerExtHost({provideTestFollowups:(r,a)=>this.proxy.$provideTestFollowups(r,a),executeTestFollowup:r=>this.proxy.$executeTestFollowup(r),disposeTestFollowups:r=>this.proxy.$disposeTestFollowups(r),getTestsRelatedToCode:(r,a,c)=>this.proxy.$getTestsRelatedToCode(r,a,c)})),this._register(this.testService.onDidCancelTestRun(({runId:r,taskId:a})=>{this.proxy.$cancelExtensionTestRun(r,a)})),this._register(D.debounce(n.onDidChange,(r,a)=>a)(()=>{const r={};for(const a of[To.Run,To.Debug,To.Coverage])for(const c of this.testProfiles.getGroupDefaultProfiles(a))r[c.controllerId]??=[],r[c.controllerId].push(c.profileId);this.proxy.$setDefaultRunProfiles(r)})),this._register(o.onResultsChanged(r=>{if("completed"in r){const a=r.completed.toJSONWithMessages();a&&this.proxy.$publishTestResults([a])}else"removed"in r&&r.removed.forEach(a=>{a instanceof wb&&this.proxy.$disposeRun(a.id)})}))}$markTestRetired(e){let t;if(e){t=new WA;for(const i of e)t.insert(Ln.fromString(i).path,void 0)}for(const i of this.resultService.results)i instanceof wb&&i.markRetired(t)}$publishTestRunProfile(e){const t=this.testProviderRegistrations.get(e.controllerId);t&&this.testProfiles.addProfile(t.instance,e)}$updateTestRunConfig(e,t,i){this.testProfiles.updateProfile(e,t,i)}$removeTestProfile(e,t){this.testProfiles.removeProfile(e,t)}$addTestsToRun(e,t,i){this.withLiveRun(t,n=>n.addTestChainToRun(e,i.map(o=>tx.deserialize(this.uriIdentityService,o))))}$appendCoverage(e,t,i){this.withLiveRun(e,n=>{const o=n.tasks.find(a=>a.id===t);if(!o)return;const r=LB.deserialize(this.uriIdentityService,i);ys(a=>{let c=o.coverage.read(void 0);c?c.append(r,a):(c=new QHe(n,t,this.uriIdentityService,{getCoverageDetails:(d,l,u)=>this.proxy.$getCoverageDetails(d,l,u).then(g=>g.map(MB.deserialize))}),c.append(r,a),o.coverage.set(c,a))})})}$startedExtensionTestRun(e){this.resultService.createLiveResult(e)}$startedTestRunTask(e,t){this.withLiveRun(e,i=>i.addTask(t))}$finishedTestRunTask(e,t){this.withLiveRun(e,i=>i.markTaskComplete(t))}$finishedExtensionTestRun(e){this.withLiveRun(e,t=>t.markComplete())}$updateTestStateInRun(e,t,i,n,o){this.withLiveRun(e,r=>r.updateState(i,t,n,o))}$appendOutputToRun(e,t,i,n,o){const r=n&&{uri:R.revive(n.uri),range:P.lift(n.range)};this.withLiveRun(e,a=>a.appendOutput(i,t,r,o))}$appendTestMessagesInRun(e,t,i,n){const o=this.resultService.getResult(e);if(o&&o instanceof wb)for(const r of n)o.appendMessage(i,t,ex.deserialize(this.uriIdentityService,r))}$registerTestController(e,t,i){const n=new U,o=oi(`${e}.label`,t),r=oi(`${e}.cap`,i),a={id:e,label:o,capabilities:r,syncTests:()=>this.proxy.$syncTests(),refreshTests:c=>this.proxy.$refreshTests(e,c),configureRunProfile:c=>this.proxy.$configureRunProfile(e,c),runTests:(c,d)=>this.proxy.$runControllerTests(c,d),startContinuousRun:(c,d)=>this.proxy.$startContinuousRun(c,d),expandTest:(c,d)=>this.proxy.$expandTest(c,isFinite(d)?d:-1),getRelatedCode:(c,d)=>this.proxy.$getCodeRelatedToTest(c,d).then(l=>l.map(u=>({uri:R.revive(u.uri),range:P.lift(u.range)})))};n.add(Ee(()=>this.testProfiles.removeProfile(e))),n.add(this.testService.registerTestController(e,a)),this.testProviderRegistrations.set(e,{instance:a,label:o,capabilities:r,disposable:n})}$updateController(e,t){const i=this.testProviderRegistrations.get(e);i&&ys(n=>{t.label!==void 0&&i.label.set(t.label,n),t.capabilities!==void 0&&i.capabilities.set(t.capabilities,n)})}$unregisterTestController(e){this.testProviderRegistrations.get(e)?.disposable.dispose(),this.testProviderRegistrations.delete(e)}$subscribeToDiffs(){this.proxy.$acceptDiff(this.testService.collection.getReviverDiff().map(jA.serialize)),this.diffListener.value=this.testService.onDidProcessDiff(this.proxy.$acceptDiff,this.proxy)}$unsubscribeFromDiffs(){this.diffListener.clear()}$publishDiff(e,t){this.testService.publishDiff(e,t.map(i=>jA.deserialize(this.uriIdentityService,i)))}async $runTests(e,t){return(await this.testService.runResolvedTests(e,t)).id}async $getCoverageDetails(e,t,i,n){return await this.resultService.getResult(e)?.tasks[t]?.coverage.get()?.getUri(R.from(i))?.details(n)||[]}dispose(){super.dispose();for(const e of this.testProviderRegistrations.values())e.disposable.dispose();this.testProviderRegistrations.clear()}withLiveRun(e,t){const i=this.resultService.getResult(e);return i&&i instanceof wb?t(i):void 0}};vte=f([ht($e.MainThreadTesting),p(1,Zi),p(2,Rre),p(3,Tre),p(4,Are)],vte);let _te=class extends F{constructor(e,t,i,n){super(),this.secretStorageService=t,this.logService=i,this._sequencer=new Uye,this._proxy=e.getProxy(Ye.ExtHostSecretState),this._register(this.secretStorageService.onDidChangeSecret(o=>{try{const{extensionId:r,key:a}=this.parseKey(o);r&&a&&this._proxy.$onDidChangePassword({extensionId:r,key:a})}catch{}}))}$getPassword(e,t){return this.logService.trace(`[mainThreadSecretState] Getting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doGetPassword(e,t))}async doGetPassword(e,t){const i=this.getKey(e,t),n=await this.secretStorageService.get(i);return this.logService.trace(`[mainThreadSecretState] ${n?"P":"No p"}assword found for: `,e,t),n}$setPassword(e,t,i){return this.logService.trace(`[mainThreadSecretState] Setting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doSetPassword(e,t,i))}async doSetPassword(e,t,i){const n=this.getKey(e,t);await this.secretStorageService.set(n,i),this.logService.trace("[mainThreadSecretState] Password set for: ",e,t)}$deletePassword(e,t){return this.logService.trace(`[mainThreadSecretState] Deleting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doDeletePassword(e,t))}async doDeletePassword(e,t){const i=this.getKey(e,t);await this.secretStorageService.delete(i),this.logService.trace("[mainThreadSecretState] Password deleted for: ",e,t)}getKey(e,t){return JSON.stringify({extensionId:e,key:t})}parseKey(e){return JSON.parse(e)}};_te=f([ht($e.MainThreadSecretState),p(1,IN),p(2,Pe),p(3,lf)],_te);let bte=class{constructor(e,t){this.shareService=t,this.providers=new Map,this.providerDisposables=new Map,this.proxy=e.getProxy(Ye.ExtHostShare)}$registerShareProvider(e,t,i,n,o){const r={id:i,label:n,selector:t,priority:o,provideShare:async c=>{const d=await this.proxy.$provideShare(e,c,ye.None);return typeof d=="string"?d:R.revive(d)}};this.providers.set(e,r);const a=this.shareService.registerShareProvider(r);this.providerDisposables.set(e,a)}$unregisterShareProvider(e){this.providers.has(e)&&this.providers.delete(e),this.providerDisposables.has(e)&&this.providerDisposables.delete(e)}dispose(){this.providers.clear(),Qe(this.providerDisposables.values()),this.providerDisposables.clear()}};bte=f([ht($e.MainThreadShare),p(1,bre)],bte);let yte=class extends F{constructor(e,t){super(),this.userDataProfileImportExportService=t,this.registeredHandlers=this._register(new ei),this.proxy=e.getProxy(Ye.ExtHostProfileContentHandlers)}async $registerProfileContentHandler(e,t,i,n){this.registeredHandlers.set(e,this.userDataProfileImportExportService.registerProfileContentHandler(e,{name:t,description:i,extensionId:n,saveProfile:async(o,r,a)=>{const c=await this.proxy.$saveProfile(e,o,r,a);return c?cn(c):null},readProfile:async(o,r)=>this.proxy.$readProfile(e,o,r)}))}async $unregisterProfileContentHandler(e){this.registeredHandlers.deleteAndDispose(e)}};yte=f([ht($e.MainThreadProfileContentHandlers),p(1,qse)],yte);let wte=class extends F{constructor(e,t){super(),this._aiRelatedInformationService=t,this._registrations=this._register(new ei),this._proxy=e.getProxy(Ye.ExtHostAiRelatedInformation)}$getAiRelatedInformation(e,t){return this._aiRelatedInformationService.getRelatedInformation(e,t,ye.None)}$registerAiRelatedInformationProvider(e,t){const i={provideAiRelatedInformation:(n,o)=>this._proxy.$provideAiRelatedInformation(e,n,o)};this._registrations.set(e,this._aiRelatedInformationService.registerAiRelatedInformationProvider(t,i))}$unregisterAiRelatedInformationProvider(e){this._registrations.deleteAndDispose(e)}};wte=f([ht($e.MainThreadAiRelatedInformation),p(1,kz)],wte);let Ste=class extends F{constructor(e,t){super(),this._AiEmbeddingVectorService=t,this._registrations=this._register(new ei),this._proxy=e.getProxy(Ye.ExtHostAiEmbeddingVector)}$registerAiEmbeddingVectorProvider(e,t){const i={provideAiEmbeddingVector:(n,o)=>this._proxy.$provideAiEmbeddingVector(t,n,o)};this._registrations.set(t,this._AiEmbeddingVectorService.registerAiEmbeddingVectorProvider(e,i))}$unregisterAiEmbeddingVectorProvider(e){this._registrations.deleteAndDispose(e)}};Ste=f([ht($e.MainThreadAiEmbeddingVector),p(1,Mre)],Ste);let Cte=class extends F{constructor(e,t){super(),this._settingsSearchService=t,this._registrations=this._register(new ei),this._proxy=e.getProxy(Ye.ExtHostAiSettingsSearch)}$registerAiSettingsSearchProvider(e){const t={searchSettings:(i,n,o)=>this._proxy.$startSearch(e,i,n,o)};this._registrations.set(e,this._settingsSearchService.registerSettingsSearchProvider(t))}$unregisterAiSettingsSearchProvider(e){this._registrations.deleteAndDispose(e)}$handleSearchResult(e,t){if(!this._registrations.has(e))throw new Error("No AI settings search provider found");this._settingsSearchService.handleSearchResult(t)}};Cte=f([ht($e.MainThreadAiSettingsSearch),p(1,Cae)],Cte);let Ete=class extends F{constructor(e,t,i,n,o,r,a){super(),this._extHostContext=e,this._mcpRegistry=t,this.dialogService=i,this._authenticationService=n,this.authenticationMcpServersService=o,this.authenticationMCPServerAccessService=r,this.authenticationMCPServerUsageService=a,this._serverIdCounter=0,this._servers=new Map,this._serverDefinitions=new Map,this._collectionDefinitions=this._register(new ei);const c=this._proxy=e.getProxy(Ye.ExtHostMcp);this._register(this._mcpRegistry.registerDelegate({priority:e.extensionHostKind===Lt.LocalWebWorker?0:1,waitForInitialProviderPromises(){return c.$waitForInitialCollectionProviders()},canStart(d,l){return!(d.remoteAuthority!==e.remoteAuthority||l.launch.type===cv.Stdio&&e.extensionHostKind===Lt.LocalWebWorker)},start:(d,l,u)=>{const g=++this._serverIdCounter,m=new rUe(e.extensionHostKind,()=>c.$stopMcp(g),v=>c.$sendMessage(g,JSON.stringify(v)));return this._servers.set(g,m),this._serverDefinitions.set(g,l),c.$startMcp(g,u),m}}))}$upsertMcpCollection(e,t){const i=t.map(OB.fromSerialized),n=this._collectionDefinitions.get(e.id);if(n)n.servers.set(i,void 0);else{const o=oi("mcpServers",i),r=this._mcpRegistry.registerCollection({...e,resolveServerLanch:e.canResolveLaunch?async a=>{const c=await this._proxy.$resolveMcpLaunch(e.id,a.label);return c?nx.fromSerialized(c):void 0}:void 0,remoteAuthority:this._extHostContext.remoteAuthority,serverDefinitions:o});this._collectionDefinitions.set(e.id,{fromExtHost:e,servers:o,dispose:()=>r.dispose()})}}$deleteMcpCollection(e){this._collectionDefinitions.deleteAndDispose(e)}$onDidChangeState(e,t){const i=this._servers.get(e);i&&(i.state.set(t,void 0),hm.isRunning(t)||(i.dispose(),this._servers.delete(e),this._serverDefinitions.delete(e)))}$onDidPublishLog(e,t,i){typeof t=="string"&&(t=Eb.Info,i=t),this._servers.get(e)?.pushLog(t,i)}$onDidReceiveMessage(e,t){this._servers.get(e)?.pushMessage(t)}async $getTokenFromServerMetadata(e,t,i,n){const o=this._serverDefinitions.get(e);if(!o)return;const r=R.revive(t),a=n?.scopes_supported||i.scopes_supported||[];let c=await this._authenticationService.getOrActivateProviderIdForServer(r);if(!c){const y=await this._authenticationService.createDynamicAuthenticationProvider(r,i,n);if(!y)return;c=y.id}const d=await this._authenticationService.getSessions(c,a,{authorizationServer:r},!0),l=this.authenticationMcpServersService.getAccountPreference(o.id,c);let u;l&&(u=d.find(y=>y.account.label===l));const g=this._authenticationService.getProvider(c);let m;if(d.length){if(u&&this.authenticationMCPServerAccessService.isAccessAllowed(c,u.account.label,o.id))return u.accessToken;if(!g.supportsMultipleAccounts&&this.authenticationMCPServerAccessService.isAccessAllowed(c,d[0].account.label,o.id))return d[0].accessToken}if(!await this.loginPrompt(o.label,g.label,!1))throw new Error("User did not consent to login.");if(d.length)m=g.supportsMultipleAccounts?await this.authenticationMcpServersService.selectSession(c,o.id,o.label,a,d):d[0];else{const y=u?.account;do m=await this._authenticationService.createSession(c,a,{activateImmediate:!0,account:y,authorizationServer:r});while(y&&y.label!==m.account.label&&!await this.continueWithIncorrectAccountPrompt(m.account.label,y.label))}return this.authenticationMCPServerAccessService.updateAllowedMcpServers(c,m.account.label,[{id:o.id,name:o.label,allowed:!0}]),this.authenticationMcpServersService.updateAccountPreference(o.id,c,m.account),this.authenticationMCPServerUsageService.addAccountUsage(c,m.account.label,a,o.id,o.label),m.accessToken}async continueWithIncorrectAccountPrompt(e,t){const i=await this.dialogService.prompt({message:h(2438,"Incorrect account detected"),detail:h(2439,"The chosen account, {0}, does not match the requested account, {1}.",e,t),type:Me.Warning,cancelButton:!0,buttons:[{label:h(2440,"Keep {0}",e),run:()=>e},{label:h(2441,"Login with {0}",t),run:()=>t}]});if(!i.result)throw new $s;return i.result===e}async loginPrompt(e,t,i){const n=i?h(2442,"The MCP Server Definition '{0}' wants you to authenticate to {1}.",e,t):h(2443,"The MCP Server Definition '{0}' wants to authenticate to {1}.",e,t),o=[{label:h(2444,"&&Allow"),run(){return!0}}],{result:r}=await this.dialogService.prompt({type:Me.Info,message:n,buttons:o,cancelButton:!0});return r??!1}dispose(){for(const e of this._servers.values())e.extHostDispose();this._servers.clear(),this._serverDefinitions.clear(),super.dispose()}};Ete=f([ht($e.MainThreadMcp),p(1,yae),p(2,Qt),p(3,Uv),p(4,xae),p(5,Iae),p(6,Dae)],Ete);class rUe extends F{pushLog(e,t){this._onDidLog.fire({message:t,level:e})}pushMessage(e){let t;try{t=JSON.parse(e)}catch{this.pushLog(Eb.Warning,`Failed to parse message: ${JSON.stringify(e)}`)}t&&(Array.isArray(t)?t.forEach(i=>this._onDidReceiveMessage.fire(i)):this._onDidReceiveMessage.fire(t))}constructor(e,t,i){super(),this.stop=t,this.send=i,this.state=oi("mcpServerState",{state:hm.Kind.Starting}),this._onDidLog=this._register(new M),this.onDidLog=this._onDidLog.event,this._onDidReceiveMessage=this._register(new M),this.onDidReceiveMessage=this._onDidReceiveMessage.event,this._register(Hm(()=>{this.pushLog(Eb.Info,`Starting server from ${oh(e)} extension host`)}))}extHostDispose(){hm.isRunning(this.state.get())&&(this.pushLog(Eb.Warning,"Extension host shut down, server will stop."),this.state.set({state:hm.Kind.Stopped},void 0)),this.dispose()}dispose(){hm.isRunning(this.state.get())&&this.stop(),super.dispose()}}let xte=class extends F{constructor(e,t){super(),this._chatStatusItemService=t}$setEntry(e,t){this._chatStatusItemService.setOrUpdateEntry({id:e,label:t.title,description:t.description,detail:t.detail})}$disposeEntry(e){this._chatStatusItemService.deleteEntry(e)}};xte=f([ht($e.MainThreadChatStatus),p(1,Sae)],xte);let T3;function Uit(s){T3=s}let A3=class extends NV{constructor(e,t,i,n,o,r,a,c,d){super(t,i,n,o,r,a,c,d),this.workerConfig=e}createExtensionHost(e,t,i){switch(t.kind){case Lt.LocalProcess:return T3==null?null:this._instantiationService.createInstance(T3,t,fh.EagerAutoStart,this._createLocalExtensionHostDataProvider(e,t,i));case Lt.LocalWebWorker:{if(this.workerConfig==null)return null;const n=i?fh.EagerManualStart:fh.EagerAutoStart;return this._instantiationService.createInstance(MR,t,n,this._createLocalExtensionHostDataProvider(e,t,i),this.workerConfig.url,this.workerConfig.options)}case Lt.Remote:return super.createExtensionHost(e,t,i)}}};A3=f([p(4,J),p(5,Nh),p(6,Hh),p(7,gd),p(8,Pe)],A3);let R3=class extends OV{constructor(e,t){super(t),this.allowedExtHostKinds=e}pickExtensionHostKind(e,t,i,n,o){const r=jRe(e.value);if(r!=null)return r;const a=super.pickExtensionHostKind(e,t,i,n,o);return a!=null&&!this.allowedExtHostKinds.includes(a)?this.allowedExtHostKinds[0]??null:a}};R3=f([p(1,Pe)],R3);let P3=class extends MV{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A,B,z,Q){const ie=t.createInstance(AV),oe=new A3(e,ie,async()=>await this._scanWebExtensions(),()=>this._getExtensionRegistrySnapshotWhenReady(),t,y,T,r,v);super(ie,oe,new R3(e!=null?[Lt.LocalWebWorker,Lt.LocalProcess,Lt.Remote]:[Lt.LocalProcess,Lt.Remote],v),t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A,B,z,Q)}async deltaExtensions(e,t){await this._handleDeltaExtensions(new Uf(e,t))}};P3=f([p(1,J),p(2,At),p(3,lf),p(4,li),p(5,gd),p(6,Xe),p(7,Fn),p(8,ON),p(9,Tt),p(10,ne),p(11,$v),p(12,Az),p(13,Pe),p(14,Nh),p(15,xN),p(16,wd),p(17,Hh),p(18,BN),p(19,Fh),p(20,Tv),p(21,WN),p(22,Qt)],P3);class aUe extends WV{async readExtensionResource(e){return e.scheme===zse.extensionFile?(await this._fileService.readFile(e)).value.toString():await super.readExtensionResource(e)}}let Vge;$Re({"vs/workbench/services/extensions/worker/webWorkerExtensionHostIframe.html":()=>Qce(new URL(""+new URL("webWorkerExtensionHostIframe-636UTAtK.html",import.meta.url).href,import.meta.url).href,Vge)});function cUe(s,e){const t=s!=null?{...s,url:Qce(new URL(s.url,globalThis.location?.href??import.meta.url),Vge)}:void 0;return{[hn.toString()]:new _r(P3,[t],!1),[$v.toString()]:new _r(TV,[],!0),[hz.toString()]:new _r(aUe,[],!0),[xw.toString()]:new _r(VV,[],!0)}}const Ite=_l.registerExtensionPoint({extensionPoint:"jsonValidation",defaultExtensionKind:["workspace","web"],jsonSchema:{description:h(2598,"Contributes json schema configuration."),type:"array",defaultSnippets:[{body:[{fileMatch:"${1:file.json}",url:"${2:url}"}]}],items:{type:"object",defaultSnippets:[{body:{fileMatch:"${1:file.json}",url:"${2:url}"}}],properties:{fileMatch:{type:["string","array"],description:h(2599,`The file pattern (or an array of patterns) to match, for example "package.json" or "*.launch". Exclusion patterns start with '!'`),items:{type:["string"]}},url:{description:h(2600,"A schema URL ('http:', 'https:') or relative path to the extension folder ('./')."),type:"string"}}}}});class dUe{constructor(){Ite.setHandler(e=>{for(const t of e){const i=t.value,n=t.collector,o=t.description.extensionLocation;if(!i||!Array.isArray(i)){n.error(h(2601,"'configuration.jsonValidation' must be a array"));return}i.forEach(r=>{if(!It(r.fileMatch)&&!(Array.isArray(r.fileMatch)&&r.fileMatch.every(It))){n.error(h(2602,"'configuration.jsonValidation.fileMatch' must be defined as a string or an array of strings."));return}const a=r.url;if(!It(a)){n.error(h(2603,"'configuration.jsonValidation.url' must be a URL or relative path"));return}if(a.startsWith("./"))try{const c=xt(o,a);cd(c,o)||n.warn(h(2604,"Expected `contributes.{0}.url` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",Ite.name,c.toString(),o.path))}catch(c){n.error(h(2605,"'configuration.jsonValidation.url' is an invalid relative URL: {0}",c.message))}else if(!/^[^:/?#]+:\/\//.test(a)){n.error(h(2606,"'configuration.jsonValidation.url' must be an absolute URL or start with './'  to reference schemas located in the extension."));return}})}})}}class lUe extends F{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.jsonValidation}render(e){const t=e.contributes?.jsonValidation||[];if(!t.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const i=[h(2607,"File Match"),h(2608,"Schema")],n=t.map(o=>[new Ni().appendMarkdown(`\`${Array.isArray(o.fileMatch)?o.fileMatch.join(", "):o.fileMatch}\``),o.url]);return{data:{headers:i,rows:n},dispose:()=>{}}}}Ge.as(_w.ExtensionFeaturesRegistry).registerExtensionFeature({id:"jsonValidation",label:h(2609,"JSON Validation"),access:{canToggle:!1},renderer:new _r(lUe)});let $L=class{static{this.ID="workbench.contrib.jsonValidationExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(dUe)}};$L=f([p(0,J)],$L);sc($L.ID,$L,oc.BlockStartup);const L3=Ge.as($ye.ColorContribution),ok=L3.getColorReferenceSchema(),Hge="^\\w+[.\\w+]*$",hUe=_l.registerExtensionPoint({extensionPoint:"colors",jsonSchema:{description:h(12906,"Contributes extension defined themable colors"),type:"array",items:{type:"object",properties:{id:{type:"string",description:h(12907,"The identifier of the themable color"),pattern:Hge,patternErrorMessage:h(12908,"Identifiers must only contain letters, digits and dots and can not start with a dot")},description:{type:"string",description:h(12909,"The description of the themable color")},defaults:{type:"object",properties:{light:{description:h(12910,"The default color for light themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default."),type:"string",anyOf:[ok,{type:"string",format:"color-hex"}]},dark:{description:h(12911,"The default color for dark themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default."),type:"string",anyOf:[ok,{type:"string",format:"color-hex"}]},highContrast:{description:h(12912,"The default color for high contrast dark themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default. If not provided, the `dark` color is used as default for high contrast dark themes."),type:"string",anyOf:[ok,{type:"string",format:"color-hex"}]},highContrastLight:{description:h(12913,"The default color for high contrast light themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default. If not provided, the `light` color is used as default for high contrast light themes."),type:"string",anyOf:[ok,{type:"string",format:"color-hex"}]}},required:["light","dark"]}}}}});class uUe{constructor(){hUe.setHandler((e,t)=>{for(const i of t.added){const n=i.value,o=i.collector;if(!n||!Array.isArray(n)){o.error(h(12914,"'configuration.colors' must be a array"));return}const r=(a,c)=>a.length>0?a[0]==="#"?be.Format.CSS.parseHex(a):a:(o.error(h(12915,"{0} must be either a color value in hex (#RRGGBB[AA] or #RGB[A]) or the identifier of a themable color which provides the default.",c)),be.red);for(const a of n){if(typeof a.id!="string"||a.id.length===0){o.error(h(12916,"'configuration.colors.id' must be defined and can not be empty"));return}if(!a.id.match(Hge)){o.error(h(12917,"'configuration.colors.id' must only contain letters, digits and dots and can not start with a dot"));return}if(typeof a.description!="string"||a.id.length===0){o.error(h(12918,"'configuration.colors.description' must be defined and can not be empty"));return}const c=a.defaults;if(!c||typeof c!="object"||typeof c.light!="string"||typeof c.dark!="string"){o.error(h(12919,"'configuration.colors.defaults' must be defined and must contain 'light' and 'dark'"));return}if(c.highContrast&&typeof c.highContrast!="string"){o.error(h(12920,"If defined, 'configuration.colors.defaults.highContrast' must be a string."));return}if(c.highContrastLight&&typeof c.highContrastLight!="string"){o.error(h(12921,"If defined, 'configuration.colors.defaults.highContrastLight' must be a string."));return}L3.registerColor(a.id,{light:r(c.light,"configuration.colors.defaults.light"),dark:r(c.dark,"configuration.colors.defaults.dark"),hcDark:r(c.highContrast??c.dark,"configuration.colors.defaults.highContrast"),hcLight:r(c.highContrastLight??c.light,"configuration.colors.defaults.highContrastLight")},a.description)}}for(const i of t.removed){const n=i.value;for(const o of n)L3.deregisterColor(o.id)}})}}class gUe extends F{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.colors}render(e){const t=e.contributes?.colors||[];if(!t.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const i=[h(12922,"ID"),h(12923,"Description"),h(12924,"Dark Default"),h(12925,"Light Default"),h(12926,"High Contrast Default")],n=r=>r[0]==="#"?be.fromHex(r):void 0,o=t.sort((r,a)=>r.id.localeCompare(a.id)).map(r=>[new Ni().appendMarkdown(`\`${r.id}\``),r.description,n(r.defaults.dark)??new Ni().appendMarkdown(`\`${r.defaults.dark}\``),n(r.defaults.light)??new Ni().appendMarkdown(`\`${r.defaults.light}\``),n(r.defaults.highContrast)??new Ni().appendMarkdown(`\`${r.defaults.highContrast}\``)]);return{data:{headers:i,rows:o},dispose:()=>{}}}}Ge.as(_w.ExtensionFeaturesRegistry).registerExtensionFeature({id:"colors",label:h(12927,"Colors"),access:{canToggle:!1},renderer:new _r(gUe)});let GL=class{static{this.ID="workbench.contrib.colorExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(uUe)}};GL=f([p(0,J)],GL);sc(GL.ID,GL,oc.BlockStartup);const tC=Ge.as(Gye.IconContribution),pUe=tC.getIconReferenceSchema(),Uge=`^${Te.iconNameSegment}(-${Te.iconNameSegment})+$`,fUe=_l.registerExtensionPoint({extensionPoint:"icons",jsonSchema:{description:h(12986,"Contributes extension defined themable icons"),type:"object",propertyNames:{pattern:Uge,description:h(12987,"The identifier of the themable icon"),patternErrorMessage:h(12988,"Identifiers can only contain letters, digits and minuses and need to consist of at least two segments in the form `component-iconname`.")},additionalProperties:{type:"object",properties:{description:{type:"string",description:h(12989,"The description of the themable icon")},default:{anyOf:[pUe,{type:"object",properties:{fontPath:{description:h(12990,"The path of the icon font that defines the icon."),type:"string"},fontCharacter:{description:h(12991,"The character for the icon in the icon font."),type:"string"}},required:["fontPath","fontCharacter"],defaultSnippets:[{body:{fontPath:"${1:myiconfont.woff}",fontCharacter:"${2:\\\\E001}"}}]}],description:h(12992,"The default of the icon. Either a reference to an existing ThemeIcon or an icon in an icon font.")}},required:["description","default"],defaultSnippets:[{body:{description:"${1:my icon}",default:{fontPath:"${2:myiconfont.woff}",fontCharacter:"${3:\\\\E001}"}}}]},defaultSnippets:[{body:{"${1:my-icon-id}":{description:"${2:my icon}",default:{fontPath:"${3:myiconfont.woff}",fontCharacter:"${4:\\\\E001}"}}}}]}});class mUe{constructor(){fUe.setHandler((e,t)=>{for(const i of t.added){const n=i.value,o=i.collector;if(!n||typeof n!="object"){o.error(h(12993,"'configuration.icons' must be an object with the icon names as properties."));return}for(const r in n){if(!r.match(Uge)){o.error(h(12994,"'configuration.icons' keys represent the icon id and can only contain letter, digits and minuses. They need to consist of at least two segments in the form `component-iconname`."));return}const a=n[r];if(typeof a.description!="string"||a.description.length===0){o.error(h(12995,"'configuration.icons.description' must be defined and can not be empty"));return}const c=a.default;if(typeof c=="string")tC.registerIcon(r,{id:c},a.description);else if(typeof c=="object"&&typeof c.fontPath=="string"&&typeof c.fontCharacter=="string"){const d=QM(c.fontPath).substring(1),l=vUe[d];if(!l){o.warn(h(12996,"Expected `contributes.icons.default.fontPath` to have file extension 'woff', woff2' or 'ttf', is '{0}'.",d));return}const u=i.description.extensionLocation,g=xt(u,c.fontPath),m=_Ue(i.description,c.fontPath),v=tC.registerIconFont(m,{src:[{location:g,format:l}]});if(!cd(g,u)){o.warn(h(12997,"Expected `contributes.icons.default.fontPath` ({0}) to be included inside extension's folder ({0}).",g.path,u.path));return}tC.registerIcon(r,{fontCharacter:c.fontCharacter,font:{id:m,definition:v}},a.description)}else o.error(h(12998,"'configuration.icons.default' must be either a reference to the id of an other theme icon (string) or a icon definition (object) with properties `fontPath` and `fontCharacter`."))}}for(const i of t.removed){const n=i.value;for(const o in n)tC.deregisterIcon(o)}})}}const vUe={ttf:"truetype",woff:"woff",woff2:"woff2"};function _Ue(s,e){return Zc.join(s.identifier.value,e)}let qL=class{static{this.ID="workbench.contrib.iconExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(mUe)}};qL=f([p(0,J)],qL);sc(qL.ID,qL,oc.BlockStartup);class bUe extends X{constructor(){super({id:"menu.resetHiddenStates",title:I(1710,"Reset All Menus"),category:te.View,f1:!0})}run(e){e.get(tn).resetHiddenStates(),e.get(Pe).info("did RESET all menu hidden states")}}K(bUe);let M3=class extends sv{constructor(e,t,i,n,o,r,a){super(!1,e,t,i,n,o,r,a)}};M3=f([p(1,me),p(2,Ot),p(3,At),p(4,J),p(5,tt),p(6,ne)],M3);Rt(sv.ID,M3,vt.Lazy);let N3=class extends og{constructor(e,t,i,n,o,r,a,c,d){super(e,n.getRawOptions(),i,o,r,a,c,d),this._parentEditor=n,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(n.onDidChangeConfiguration(l=>this._onParentConfigurationChanged(l)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){zu(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};N3=f([p(4,me),p(5,J),p(6,Ot),p(7,cI),p(8,ju)],N3);const yD=new class{constructor(){this._implementations=[]}register(e){return this._implementations.push(e),{dispose:()=>{const t=this._implementations.indexOf(e);t!==-1&&this._implementations.splice(t,1)}}}getImplementations(){return this._implementations}};class $ge extends uf{constructor(e){super(),this.label=e,this._onClick=this._register(new M),this.onClick=this._onClick.event,this._domNode=Y(".floating-click-widget"),this._domNode.style.padding="6px 11px",this._domNode.style.borderRadius="2px",this._domNode.style.cursor="pointer",this._domNode.style.zIndex="1"}getDomNode(){return this._domNode}render(){Yi(this._domNode),this._domNode.style.backgroundColor=UF(Uq,gt(ts)),this._domNode.style.color=UF(iN,gt(ao)),this._domNode.style.border=`1px solid ${gt(et)}`,ee(this._domNode,Y("")).textContent=this.label,this.onclick(this._domNode,()=>this._onClick.fire())}}let zL=class extends F{constructor(e,t,i){super(),this.renderEmitter=new M,this.onDidRender=this.renderEmitter.event,this.menu=this._register(t.createMenu(e,i))}render(){const e=this._register(new U),t=()=>{if(e.clear(),!this.isVisible())return;const i=oI(this.menu.getActions({renderShortTitle:!0,shouldForwardArgs:!0}));if(i.length===0)return;const[n]=i,o=this.createWidget(n,e);e.add(o),e.add(o.onClick(()=>n.run(this.getActionArg()))),o.render()};this._register(this.menu.onDidChange(t)),t()}getActionArg(){}isVisible(){return!0}};zL=f([p(1,tn),p(2,me)],zL);let Dte=class extends zL{constructor(e,t,i,n){super(e.menuId,i,n),this.options=e,this.instantiationService=t,this.render()}createWidget(e,t){const i=this.instantiationService.createInstance($ge,e.label),n=i.getDomNode();return this.options.container.appendChild(n),t.add(Ee(()=>n.remove())),i}getActionArg(){return this.options.getActionArg()}};Dte=f([p(1,J),p(2,tn),p(3,me)],Dte);var bT;let kte=class extends F{static{bT=this}constructor(e){super(),this.editorService=e,this._onHighlightRemoved=this._register(new M),this.onHighlightRemoved=this._onHighlightRemoved.event,this.rangeHighlightDecorationId=null,this.editor=null,this.editorDisposables=this._register(new U)}removeHighlightRange(){if(this.editor&&this.rangeHighlightDecorationId){const e=this.rangeHighlightDecorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e)}),this._onHighlightRemoved.fire()}this.rangeHighlightDecorationId=null}highlightRange(e,t){t=t??this.getEditor(e),Ao(t)?this.doHighlightRange(t,e):iA(t)&&Ao(t.activeCodeEditor)&&this.doHighlightRange(t.activeCodeEditor,e)}doHighlightRange(e,t){this.removeHighlightRange(),e.changeDecorations(i=>{this.rangeHighlightDecorationId=i.addDecoration(t.range,this.createRangeHighlightDecoration(t.isWholeLine))}),this.setEditor(e)}getEditor(e){const t=this.editorService.activeEditor?.resource;if(t&&Dt(t,e.resource)&&Ao(this.editorService.activeTextEditorControl))return this.editorService.activeTextEditorControl}setEditor(e){this.editor!==e&&(this.editorDisposables.clear(),this.editor=e,this.editorDisposables.add(this.editor.onDidChangeCursorPosition(t=>{(t.reason===Ls.NotSet||t.reason===Ls.Explicit||t.reason===Ls.Undo||t.reason===Ls.Redo)&&this.removeHighlightRange()})),this.editorDisposables.add(this.editor.onDidChangeModel(()=>{this.removeHighlightRange()})),this.editorDisposables.add(this.editor.onDidDispose(()=>{this.removeHighlightRange(),this.editor=null})))}static{this._WHOLE_LINE_RANGE_HIGHLIGHT=Yt.register({description:"codeeditor-range-highlight-whole",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"rangeHighlight",isWholeLine:!0})}static{this._RANGE_HIGHLIGHT=Yt.register({description:"codeeditor-range-highlight",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"rangeHighlight"})}createRangeHighlightDecoration(e=!0){return e?bT._WHOLE_LINE_RANGE_HIGHLIGHT:bT._RANGE_HIGHLIGHT}dispose(){super.dispose(),this.editor?.getModel()&&(this.removeHighlightRange(),this.editor=null)}};kte=bT=f([p(0,de)],kte);let KL=class extends $ge{constructor(e,t,i,n){super(i&&n.lookupKeybinding(i)?`${t} (${n.lookupKeybinding(i).getLabel()})`:t),this.editor=e}getId(){return"editor.overlayWidget.floatingClickWidget"}getPosition(){return{preference:bI.BOTTOM_RIGHT_CORNER}}render(){super.render(),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}};KL=f([p(3,Ve)],KL);let Tte=class extends zL{static{this.ID="editor.contrib.floatingClickMenu"}constructor(e,t,i,n){super(N.EditorContent,i,n),this.editor=e,this.instantiationService=t,this.render()}createWidget(e){return this.instantiationService.createInstance(KL,this.editor,e.label,e.id)}isVisible(){return!(this.editor instanceof pd)&&this.editor?.hasModel()&&!this.editor.getOption(L.inDiffEditor)}getActionArg(){return this.editor.getModel()?.uri}};Tte=f([p(1,J),p(2,tn),p(3,me)],Tte);class yUe extends X{constructor(){super({id:"diffEditor.toggleCollapseUnchangedRegions",title:I(149,"Toggle Collapse Unchanged Regions"),icon:j.map,toggled:x.has("config.diffEditor.hideUnchangedRegions.enabled"),precondition:x.has("isInDiffEditor"),menu:{when:x.has("isInDiffEditor"),id:N.EditorTitle,order:22,group:"navigation"}})}run(e,...t){const i=e.get(ne),n=!i.getValue("diffEditor.hideUnchangedRegions.enabled");i.updateValue("diffEditor.hideUnchangedRegions.enabled",n)}}class Gge extends X{constructor(){super({id:"diffEditor.toggleShowMovedCodeBlocks",title:I(150,"Toggle Show Moved Code Blocks"),precondition:x.has("isInDiffEditor")})}run(e,...t){const i=e.get(ne),n=!i.getValue("diffEditor.experimental.showMoves");i.updateValue("diffEditor.experimental.showMoves",n)}}class qge extends X{constructor(){super({id:"diffEditor.toggleUseInlineViewWhenSpaceIsLimited",title:I(151,"Toggle Use Inline View When Space Is Limited"),precondition:x.has("isInDiffEditor")})}run(e,...t){const i=e.get(ne),n=!i.getValue("diffEditor.useInlineViewWhenSpaceIsLimited");i.updateValue("diffEditor.useInlineViewWhenSpaceIsLimited",n)}}const wD=I(152,"Diff Editor");class wUe extends Rr{constructor(){super({id:"diffEditor.switchSide",title:I(153,"Switch Side"),icon:j.arrowSwap,precondition:x.has("isInDiffEditor"),f1:!0,category:wD})}runEditorCommand(e,t,i){const n=aS(e);if(n instanceof og){if(i&&i.dryRun)return{destinationSelection:n.mapToOtherSide().destinationSelection};n.switchSide()}}}class SUe extends Rr{constructor(){super({id:"diffEditor.exitCompareMove",title:I(154,"Exit Compare Move"),icon:j.close,precondition:V.comparingMovedCode,f1:!1,category:wD,keybinding:{weight:1e4,primary:S.Escape}})}runEditorCommand(e,t,...i){const n=aS(e);n instanceof og&&n.exitCompareMove()}}class CUe extends Rr{constructor(){super({id:"diffEditor.collapseAllUnchangedRegions",title:I(155,"Collapse All Unchanged Regions"),icon:j.fold,precondition:x.has("isInDiffEditor"),f1:!0,category:wD})}runEditorCommand(e,t,...i){const n=aS(e);n instanceof og&&n.collapseAllUnchangedRegions()}}class EUe extends Rr{constructor(){super({id:"diffEditor.showAllUnchangedRegions",title:I(156,"Show All Unchanged Regions"),icon:j.unfold,precondition:x.has("isInDiffEditor"),f1:!0,category:wD})}runEditorCommand(e,t,...i){const n=aS(e);n instanceof og&&n.showAllUnchangedRegions()}}class O3 extends X{constructor(){super({id:"diffEditor.revert",title:I(157,"Revert"),f1:!1,category:wD})}run(e,t){const i=xUe(e,t.originalUri,t.modifiedUri);i instanceof og&&i.revertRangeMappings(t.mapping.innerChanges??[])}}const zge=I(158,"Accessible Diff Viewer");class rS extends X{static{this.id="editor.action.accessibleDiffViewer.next"}constructor(){super({id:rS.id,title:I(159,"Go to Next Difference"),category:zge,precondition:x.has("isInDiffEditor"),keybinding:{primary:S.F7,weight:W.EditorContrib},f1:!0})}run(e){aS(e)?.accessibleDiffViewerNext()}}class SD extends X{static{this.id="editor.action.accessibleDiffViewer.prev"}constructor(){super({id:SD.id,title:I(160,"Go to Previous Difference"),category:zge,precondition:x.has("isInDiffEditor"),keybinding:{primary:E.Shift|S.F7,weight:W.EditorContrib},f1:!0})}run(e){aS(e)?.accessibleDiffViewerPrev()}}function xUe(s,e,t){return s.get(Ot).listDiffEditors().find(o=>{const r=o.getModifiedEditor(),a=o.getOriginalEditor();return r&&r.getModel()?.uri.toString()===t.toString()&&a&&a.getModel()?.uri.toString()===e.toString()})||null}function aS(s){const t=s.get(Ot).listDiffEditors(),i=Eh();if(i){for(const n of t)if(n.getContainerDomNode().contains(i))return n}return null}function IUe(s,e){if(!e.getOption(L.inDiffEditor))return null;const t=s.get(Ot);for(const i of t.listDiffEditors()){const n=i.getOriginalEditor(),o=i.getModifiedEditor();if(n===e||o===e)return i}return null}class E1 extends X{static{this.ID="editor.action.toggleTabFocusMode"}constructor(){super({id:E1.ID,title:I(1575,"Toggle Tab Key Moves Focus"),precondition:void 0,keybinding:{primary:E.CtrlCmd|S.KeyM,mac:{primary:E.WinCtrl|E.Shift|S.KeyM},weight:W.EditorContrib},metadata:{description:I(1576,"Determines whether the tab key moves focus around the workbench or inserts the tab character in the current editor. This is also called tab trapping, tab navigation, or tab focus mode.")},f1:!0})}run(){const t=!d6.getTabFocusMode();d6.setTabFocusMode(t),t?ta(h(1577,"Pressing Tab will now move focus to the next focusable element")):ta(h(1578,"Pressing Tab will now insert the tab character"))}}K(E1);var sp;(function(s){s.intro=h(5431,"The editor contains commentable range(s). Some useful commands include:"),s.tabFocus=h(5432,"This widget contains a text area, for composition of new comments, and actions, that can be tabbed to once tab moves focus mode has been enabled with the command Toggle Tab Key Moves Focus{0}.",`<keybinding:${E1.ID}>`),s.commentCommands=h(5433,"Some useful comment commands include:"),s.escape=h(5434,"- Dismiss Comment (Escape)"),s.nextRange=h(5435,"- Go to Next Commenting Range{0}.",`<keybinding:${Vc.NextRange}>`),s.previousRange=h(5436,"- Go to Previous Commenting Range{0}.",`<keybinding:${Vc.PreviousRange}>`),s.nextCommentThread=h(5437,"- Go to Next Comment Thread{0}.",`<keybinding:${Vc.NextThread}>`),s.previousCommentThread=h(5438,"- Go to Previous Comment Thread{0}.",`<keybinding:${Vc.PreviousThread}>`),s.nextCommentedRange=h(5439,"- Go to Next Commented Range{0}.",`<keybinding:${Vc.NextCommentedRange}>`),s.previousCommentedRange=h(5440,"- Go to Previous Commented Range{0}.",`<keybinding:${Vc.PreviousCommentedRange}>`),s.addComment=h(5441,"- Add Comment on Current Selection{0}.",`<keybinding:${Vc.Add}>`),s.submitComment=h(5442,"- Submit Comment{0}.",`<keybinding:${Vc.Submit}>`)})(sp||(sp={}));const DUe=new O("chatEdits.isGlobalEditingSession",void 0,h(4776,"The current editor is part of the global edit session")),Kge=new O("chatEdits.hasEditorModifications",void 0,h(4777,"The current editor contains chat modifications")),kUe=new O("chatEdits.isReviewModeEnabled",!0,h(4778,"Review mode for chat changes is enabled")),jge=new O("chatEdits.isRequestInProgress",!1,h(4779,"The current editor shows a file from an edit session which is still in progress")),TUe=new O("chatEdits.requestCount",0,h(4780,"The number of turns the editing session in this editor has"));let Ate=class{static{this.ID="chat.edits.editorContextKeys"}constructor(e,t){this._store=new U;const i=this._store.add(new ei),n=On(this,D.any(t.onDidAddGroup,t.onDidRemoveGroup),()=>t.groups);this._store.add(ki(o=>{const r=new Set(i.keys());for(const a of n.read(o))r.delete(a),!i.has(a)&&i.set(a,e.createInstance(F3,a));for(const a of r)i.deleteAndDispose(a)}))}dispose(){this._store.dispose()}};Ate=f([p(0,J),p(1,Ie)],Ate);let F3=class{constructor(e,t,i,n){this._store=new U,this._ctxIsGlobalEditingSession=DUe.bindTo(e.scopedContextKeyService),this._ctxHasEditorModification=Kge.bindTo(e.scopedContextKeyService),this._ctxHasRequestInProgress=jge.bindTo(e.scopedContextKeyService),this._ctxReviewModeEnabled=kUe.bindTo(e.scopedContextKeyService),this._ctxRequestCount=TUe.bindTo(e.scopedContextKeyService);const o=On(this,e.onDidModelChange,()=>e.activeEditor);this._store.add(ki(r=>{const a=o.read(r),c=xi.getOriginalUri(a,{supportSideBySide:Ut.PRIMARY});if(!c){this._reset();return}const d=new W3(c,i,t).value.read(r);if(!d){this._reset();return}const{session:l,entry:u}=d,g=n.getSession(l.chatSessionId);this._ctxHasEditorModification.set(u?.state.read(r)===_d.Modified),this._ctxIsGlobalEditingSession.set(l.isGlobalEditingSession),this._ctxReviewModeEnabled.set(u?u.reviewMode.read(r):!1),this._ctxHasRequestInProgress.set(g?.requestInProgressObs.read(r)??!1);const m=g?On(this,g.onDidChange,()=>g.getRequests().length):Fi(0);this._ctxRequestCount.set(m.read(r))}))}_reset(){this._ctxIsGlobalEditingSession.reset(),this._ctxHasEditorModification.reset(),this._ctxHasRequestInProgress.reset(),this._ctxReviewModeEnabled.reset(),this._ctxRequestCount.reset()}dispose(){this._store.dispose(),this._reset()}};F3=f([p(1,Ez),p(2,bg),p(3,mf)],F3);let W3=class{constructor(e,t,i){const n=On(this,i.onDidChangeSessions,()=>i.getSession2(e)),o=t.editingSessionsObs.map((r,a)=>{for(const c of r){const d=c.readEntry(e,a);if(d)return{session:c,entry:d,isInlineChat:!1}}});this.value=fe(r=>{const a=n.read(r);return a?{session:a.editingSession,entry:a.editingSession.readEntry(e,r),isInlineChat:!0}:o.read(r)})}};W3=f([p(1,bg),p(2,Ez)],W3);let Rte=class extends F{onClose(){this._editor.focus()}constructor(e,t,i,n,o){super(),this._editor=e,this._keybindingService=t,this._contextKeyService=i,this.accessibilityService=n,this._configurationService=o,this.id=sa.Editor,this.options={type:fc.Help,readMoreUrl:"https://go.microsoft.com/fwlink/?linkid=851010"},this.verbositySettingKey=Un.Editor}provideContent(){const e=this._editor.getOptions(),t=[];e.get(L.inDiffEditor)?e.get(L.readOnly)?t.push(_n.readonlyDiffEditor):t.push(_n.editableDiffEditor):e.get(L.readOnly)?t.push(_n.readonlyEditor):t.push(_n.editableEditor),this.accessibilityService.isScreenReaderOptimized()&&this._configurationService.getValue("accessibility.windowTitleOptimized")?t.push(_n.defaultWindowTitleIncludesEditorState):t.push(_n.defaultWindowTitleExcludingEditorState),t.push(_n.toolbar);const i=RUe(this._keybindingService,this._contextKeyService,this._editor);i&&t.push(i),t.push(_n.listSignalSounds),t.push(_n.listAlerts);const n=AUe(this._keybindingService,this._contextKeyService);n&&t.push(n);const o=Yge(this._keybindingService,this._contextKeyService,this._editor);return o&&t.push(o),t.push(_n.suggestActions),t.push(_n.acceptSuggestAction),t.push(_n.toggleSuggestionFocus),e.get(L.stickyScroll).enabled&&t.push(_n.stickScroll),e.get(L.tabFocusMode)?t.push(_n.tabFocusModeOnMsg):t.push(_n.tabFocusModeOffMsg),t.push(_n.codeFolding),t.push(_n.intellisense),t.push(_n.showOrFocusHover),t.push(_n.goToSymbol),t.push(_n.startDebugging),t.push(_n.setBreakpoint),t.push(_n.debugExecuteSelection),t.push(_n.addToWatch),t.join(`
`)}};Rte=f([p(1,Ve),p(2,me),p(3,Tr),p(4,ne)],Rte);function Yge(s,e,t){if(e.getContext(t.getDomNode()).getValue(Za.activeEditorHasCommentingRange.key))return[sp.intro,sp.addComment,sp.nextCommentThread,sp.previousCommentThread,sp.nextRange,sp.previousRange].join(`
`)}function AUe(s,e){if(ve.enabled.getValue(e))return[_n.quickChat,_n.startInlineChat].join(`
`)}function RUe(s,e,t){const i=e.getContext(t.getDomNode());if(i.getValue(Kge.key))return _n.chatEditorModification+`
`+_n.chatEditActions;if(i.getValue(jge.key))return _n.chatEditorRequestInProgress}class PUe{constructor(){this.priority=105,this.name="diff-editor",this.when=nse.create("isInDiffEditor",!0),this.type=fc.Help}getProvider(e){const t=e.get(de),i=e.get(Ot),n=e.get(Ve),o=e.get(me);if(!(t.activeTextEditorControl instanceof og))return;const r=i.getActiveCodeEditor()||i.getFocusedCodeEditor();if(!r)return;const a=h(5250,"Run the command Diff Editor: Switch Side{0} to toggle between the original and modified editors.","<keybinding:diffEditor.switchSide>"),c=h(5251,"The setting, accessibility.verbosity.diffEditorActive, controls if a diff editor announcement is made when it becomes the active editor."),d=["accessibility.signals.diffLineDeleted","accessibility.signals.diffLineInserted","accessibility.signals.diffLineModified"],l=[h(5252,"You are in a diff editor."),h(5253,"View the next{0} or previous{1} diff in diff review mode, which is optimized for screen readers.","<keybinding:"+rS.id+">","<keybinding:"+SD.id+">"),a,c,h(5254,"To control which accessibility signals should be played, the following settings can be configured: {0}.",d.join(", "))],u=Yge(n,o,r);return u&&l.push(u),new Tge(sa.DiffEditor,{type:fc.Help},()=>l.join(`
`),()=>r.focus(),Un.DiffEditor)}}let jL=class extends F{static{this.ID="editor.contrib.diffEditorHelper"}constructor(e,t,i,n){if(super(),this._diffEditor=e,this._instantiationService=t,this._textResourceConfigurationService=i,this._notificationService=n,!(this._diffEditor instanceof N3)){const a=On(this,c=>this._diffEditor.onDidUpdateDiff(c),()=>this._diffEditor.getDiffComputationResult()).map(c=>c&&!c.identical&&c.changes2.length===0);this._register(Da((c,d)=>{if(a.read(c)){const l=d.add(this._instantiationService.createInstance(KL,this._diffEditor.getModifiedEditor(),h(5255,"Show Whitespace Differences"),null));d.add(l.onClick(()=>{this._textResourceConfigurationService.updateValue(this._diffEditor.getModel().modified.uri,"diffEditor.ignoreTrimWhitespace",!1)})),l.render()}})),this._register(this._diffEditor.onDidUpdateDiff(()=>{const c=this._diffEditor.getDiffComputationResult();c&&c.quitEarly&&this._notificationService.prompt(Me.Warning,h(5256,"The diff algorithm was stopped early (after {0} ms.)",this._diffEditor.maxComputationTime),[{label:h(5257,"Remove Limit"),run:()=>{this._textResourceConfigurationService.updateValue(this._diffEditor.getModel().modified.uri,"diffEditor.maxComputationTime",0)}}],{})}))}}};jL=f([p(1,J),p(2,Xo),p(3,At)],jL);sse(jL.ID,jL);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"diffEditor.experimental.collapseUnchangedRegions",migrateFn:(s,e)=>[["diffEditor.hideUnchangedRegions.enabled",{value:s}],["diffEditor.experimental.collapseUnchangedRegions",{value:void 0}]]}]);yD.register(new PUe);let YL=class extends F{static{this.ID="editor.contrib.largeFileOptimizationsWarner"}constructor(e,t,i){super(),this._editor=e,this._notificationService=t,this._configurationService=i,this._register(this._editor.onDidChangeModel(n=>this._update())),this._update()}_update(){const e=this._editor.getModel();if(e&&e.isTooLargeForTokenization()){const t=h(5276,"{0}: tokenization, wrapping, folding, codelens, word highlighting and sticky scroll have been turned off for this large file in order to reduce memory usage and avoid freezing or crashing.",Sn(e.uri.path));this._notificationService.prompt(Me.Info,t,[{label:h(5277,"Forcefully Enable Features"),run:()=>{this._configurationService.updateValue("editor.largeFileOptimizations",!1).then(()=>{this._notificationService.info(h(5278,"Please reopen file in order for this setting to take effect."))},i=>{this._notificationService.error(i)})}}],{neverShowAgain:{id:"editor.contrib.largeFileOptimizationsWarner"}})}}};YL=f([p(1,At),p(2,ne)],YL);Rt(YL.ID,YL,vt.AfterFirstRender);class LUe{constructor(e,t,i){this._selection=e,this._cursors=t,this._selectionId=null,this._trimInRegexesAndStrings=i}getEditOperations(e,t){const i=Qge(e,this._cursors,this._trimInRegexesAndStrings);for(let n=0,o=i.length;n<o;n++){const r=i[n];t.addEditOperation(r.range,r.text)}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function Qge(s,e,t){e.sort((a,c)=>a.lineNumber===c.lineNumber?a.column-c.column:a.lineNumber-c.lineNumber);for(let a=e.length-2;a>=0;a--)e[a].lineNumber===e[a+1].lineNumber&&e.splice(a,1);const i=[];let n=0,o=0;const r=e.length;for(let a=1,c=s.getLineCount();a<=c;a++){const d=s.getLineContent(a),l=d.length+1;let u=0;if(o<r&&e[o].lineNumber===a&&(u=e[o].column,o++,u===l)||d.length===0)continue;const g=Tb(d);let m=0;if(g===-1)m=1;else if(g!==d.length-1)m=g+2;else continue;if(!t){if(!s.tokenization.hasAccurateTokensForLine(a))continue;const v=s.tokenization.getLineTokens(a),y=v.getStandardTokenType(v.findTokenIndexAtOffset(m));if(y===Xc.String||y===Xc.RegEx)continue}m=Math.max(u,m),i[n++]=Ki.delete(new P(a,m,a,l))}return i}var iC;function MUe(s){return(e,t)=>{if(e.rootUri&&!t.rootUri)return-1;if(!e.rootUri&&t.rootUri)return 1;if(!e.rootUri&&!t.rootUri)return 0;const i=cd(s,e.rootUri),n=cd(s,t.rootUri);return i&&n?Xge(e,t):i?-1:n?1:0}}function Xge(s,e){return s.kind==="primary"?-1:e.kind==="primary"?1:s.kind==="secondary"?-1:e.kind==="secondary"?1:0}let Pte=class extends F{static{iC=this}static{this.STORAGE_KEY="workbench.scm.quickDiffProviders.hidden"}get providers(){return Array.from(this.quickDiffProviders).sort(Xge)}constructor(e,t){super(),this.storageService=e,this.uriIdentityService=t,this.quickDiffProviders=new Set,this._onDidChangeQuickDiffProviders=this._register(new M),this.onDidChangeQuickDiffProviders=this._onDidChangeQuickDiffProviders.event,this.hiddenQuickDiffProviders=new Set,this.loadState()}addQuickDiffProvider(e){return this.quickDiffProviders.add(e),this._onDidChangeQuickDiffProviders.fire(),{dispose:()=>{this.quickDiffProviders.delete(e),this._onDidChangeQuickDiffProviders.fire()}}}async getQuickDiffs(e,t="",i=!1){const n=Array.from(this.quickDiffProviders).filter(a=>!a.rootUri||this.uriIdentityService.extUri.isEqualOrParent(e,a.rootUri)).sort(MUe(e)),o=await Promise.allSettled(n.map(async a=>{const d=(a.selector?qN(a.selector,e,t,i,void 0,void 0):10)>0?await a.getOriginalResource(e)??void 0:void 0;return{provider:a,originalResource:d}})),r=[];for(const a of o){if(a.status==="rejected")continue;const{provider:c,originalResource:d}=a.value;d&&r.push({id:c.id,label:c.label,kind:c.kind,originalResource:d})}return r}toggleQuickDiffProviderVisibility(e){this.isQuickDiffProviderVisible(e)?this.hiddenQuickDiffProviders.add(e):this.hiddenQuickDiffProviders.delete(e),this.saveState(),this._onDidChangeQuickDiffProviders.fire()}isQuickDiffProviderVisible(e){return!this.hiddenQuickDiffProviders.has(e)}loadState(){const e=this.storageService.get(iC.STORAGE_KEY,he.PROFILE);if(e)try{this.hiddenQuickDiffProviders=new Set(JSON.parse(e))}catch{}}saveState(){this.hiddenQuickDiffProviders.size===0?this.storageService.remove(iC.STORAGE_KEY,he.PROFILE):this.storageService.store(iC.STORAGE_KEY,JSON.stringify(Array.from(this.hiddenQuickDiffProviders)),he.PROFILE,pt.USER)}};Pte=iC=f([p(0,tt),p(1,Zi)],Pte);async function NUe(s,e,t,i){const n=await s.getQuickDiffs(e,t,i);return n.length>0?n[0].originalResource:null}ue(class extends we{constructor(){super({id:"editor.action.formatChanges",label:I(7356,"Format Modified Lines"),precondition:x.and(V.writable,V.hasDocumentSelectionFormattingProvider)})}async run(e,t){const i=e.get(J);if(!t.hasModel())return;const n=await i.invokeFunction(Zge,t.getModel());if(xn(n))return i.invokeFunction(gN,t,n,Pu.Explicit,Jc.None,ye.None,!0)}});async function Zge(s,e){const t=s.get(RN),i=s.get(vc),n=s.get(yi),o=await NUe(t,e.uri,e.getLanguageId(),Au(e));if(!o)return null;const r=[],a=await n.createModelReference(o);try{if(!i.canComputeDirtyDiff(o,e.uri))return;const c=await i.computeDirtyDiff(o,e.uri,!1);if(!xn(c))return;for(const d of c)r.push(e.validateRange(new P(d.modifiedStartLineNumber,1,d.modifiedEndLineNumber||d.modifiedStartLineNumber,Number.MAX_SAFE_INTEGER)))}finally{a.dispose()}return r}let B3=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){if(!e.textEditorModel)return;const i=this.configurationService.getValue("files.trimTrailingWhitespace",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource}),n=this.configurationService.getValue("files.trimTrailingWhitespaceInRegexAndStrings",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource});i&&this.doTrimTrailingWhitespace(e.textEditorModel,t.reason===ui.AUTO,n)}doTrimTrailingWhitespace(e,t,i){let n=[],o=[];const r=x1(e,this.codeEditorService);if(r&&(n=r.getSelections(),t)){o=n.map(d=>d.getPosition());const c=os.get(r)?.getSessionEnclosingRange();if(c)for(let d=c.startLineNumber;d<=c.endLineNumber;d++)o.push(new _e(d,e.getLineMaxColumn(d)))}const a=Qge(e,o,i);a.length&&e.pushEditOperations(n,a,c=>n)}};B3=f([p(0,ne),p(1,Ot)],B3);function x1(s,e){let t=null;if(s.isAttachedToEditor()){for(const i of e.listCodeEditors())if(i.hasModel()&&i.getModel()===s){if(i.hasTextFocus())return i;t=i}}return t}let V3=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){e.textEditorModel&&this.configurationService.getValue("files.insertFinalNewline",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource})&&this.doInsertFinalNewLine(e.textEditorModel)}doInsertFinalNewLine(e){const t=e.getLineCount(),i=e.getLineContent(t),n=Tb(i)===-1;if(!t||n)return;const o=[Ki.insert(new _e(t,e.getLineMaxColumn(t)),e.getEOL())],r=x1(e,this.codeEditorService);r?r.executeEdits("insertFinalNewLine",o,r.getSelections()):e.pushEditOperations([],o,()=>null)}};V3=f([p(0,ne),p(1,Ot)],V3);let H3=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){e.textEditorModel&&this.configurationService.getValue("files.trimFinalNewlines",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource})&&this.doTrimFinalNewLines(e.textEditorModel,t.reason===ui.AUTO)}findLastNonEmptyLine(e){for(let t=e.getLineCount();t>=1;t--)if(e.getLineLength(t)>0)return t;return 0}doTrimFinalNewLines(e,t){const i=e.getLineCount();if(i===1)return;let n=[],o=0;const r=x1(e,this.codeEditorService);if(r&&(n=r.getSelections(),t))for(let l=0,u=n.length;l<u;l++){const g=n[l].positionLineNumber;g>o&&(o=g)}const a=this.findLastNonEmptyLine(e),c=Math.max(a+1,o+1),d=e.validateRange(new P(c,1,i,e.getLineMaxColumn(i)));d.isEmpty()||(e.pushEditOperations(n,[Ki.delete(d)],l=>n),r?.setSelections(n))}};H3=f([p(0,ne),p(1,Ot)],H3);let U3=class{constructor(e,t,i){this.configurationService=e,this.codeEditorService=t,this.instantiationService=i}async participate(e,t,i,n){if(!e.textEditorModel||t.reason===ui.AUTO)return;const o=e.textEditorModel,r={overrideIdentifier:o.getLanguageId(),resource:o.uri},a=new Jc(u=>{i.report({message:h(5293,"Running '{0}' Formatter ([configure]({1})).",u.displayName||u.extensionId&&u.extensionId.value||"???","command:workbench.action.openSettings?%5B%22editor.formatOnSave%22%5D")})});if(!this.configurationService.getValue("editor.formatOnSave",r))return;const d=x1(o,this.codeEditorService)||o,l=this.configurationService.getValue("editor.formatOnSaveMode",r);if(l==="file")await this.instantiationService.invokeFunction(jF,d,Pu.Silent,a,n);else{const u=await this.instantiationService.invokeFunction(Zge,Ao(d)?d.getModel():d);u===null&&l==="modificationsIfAvailable"?await this.instantiationService.invokeFunction(jF,d,Pu.Silent,a,n):u&&await this.instantiationService.invokeFunction(gN,d,u,Pu.Silent,a,n,!1)}}};U3=f([p(0,ne),p(1,Ot),p(2,J)],U3);let $3=class extends F{constructor(e,t,i,n,o,r){super(),this.configurationService=e,this.instantiationService=t,this.languageFeaturesService=i,this.hostService=n,this.editorService=o,this.codeEditorService=r,this._register(this.hostService.onDidChangeFocus(()=>{this.triggerCodeActionsCommand()})),this._register(this.editorService.onDidActiveEditorChange(()=>{this.triggerCodeActionsCommand()}))}async triggerCodeActionsCommand(){if(this.configurationService.getValue("editor.codeActions.triggerOnFocusChange")&&this.configurationService.getValue("files.autoSave")==="afterDelay"){const e=this.codeEditorService.getActiveCodeEditor()?.getModel();if(!e)return;const t={overrideIdentifier:e.getLanguageId(),resource:e.uri},i=this.configurationService.getValue("editor.codeActionsOnSave",t);if(!i||Array.isArray(i))return;const n=Object.keys(i).filter(a=>i[a]&&i[a]==="always"&&gi.Source.contains(new Zt(a))),o=new ri,r=[];for(const a of n)r.push(new Zt(a));await this.applyOnSaveActions(e,r,[],Jc.None,o.token)}}async participate(e,t,i,n){if(!e.textEditorModel)return;const o=e.textEditorModel,r={overrideIdentifier:o.getLanguageId(),resource:o.uri},a=this.configurationService.getValue("editor.codeActionsOnSave",r);if(!a||t.reason===ui.AUTO||t.reason!==ui.EXPLICIT&&Array.isArray(a))return;const c=Array.isArray(a)?a:Object.keys(a).filter(g=>a[g]&&a[g]!=="never"),d=this.createCodeActionsOnSave(c);if(Array.isArray(a)||d.sort((g,m)=>gi.SourceFixAll.contains(g)?gi.SourceFixAll.contains(m)?0:-1:gi.SourceFixAll.contains(m)?1:0),!d.length)return;const l=Array.isArray(a)?[]:Object.keys(a).filter(g=>a[g]==="never"||!1).map(g=>new Zt(g));i.report({message:h(5294,"Quick Fixes")});const u=Array.isArray(a)?d:d.filter(g=>a[g.value]==="always"||(a[g.value]==="explicit"||a[g.value]===!0)&&t.reason===ui.EXPLICIT);await this.applyOnSaveActions(o,u,l,i,n)}createCodeActionsOnSave(e){const t=e.map(i=>new Zt(i));return t.filter(i=>t.every(n=>n.equals(i)||!n.contains(i)))}async applyOnSaveActions(e,t,i,n,o){const r=new class{constructor(){this._names=new Set}_report(){n.report({message:h(5295,"Getting code actions from {0} ([configure]({1})).",[...this._names].map(a=>`'${a}'`).join(", "),"command:workbench.action.openSettings?%5B%22editor.codeActionsOnSave%22%5D")})}report(a){a.displayName&&!this._names.has(a.displayName)&&(this._names.add(a.displayName),this._report())}};for(const a of t){const c=await this.getActionsToRun(e,a,i,r,o);if(o.isCancellationRequested){c.dispose();return}try{for(const d of c.validActions)if(n.report({message:h(5296,"Applying code action '{0}'.",d.action.title)}),await this.instantiationService.invokeFunction(tge,d,ku.OnSave,{},o),o.isCancellationRequested)return}catch{}finally{c.dispose()}}}getActionsToRun(e,t,i,n,o){return vm(this.languageFeaturesService.codeActionProvider,e,e.getFullModelRange(),{type:Bo.Auto,triggerAction:Dr.OnSave,filter:{include:t,excludes:i,includeSourceActions:!0}},n,o)}};$3=f([p(0,ne),p(1,J),p(2,Ne),p(3,Wn),p(4,de),p(5,Ot)],$3);let G3=class extends F{constructor(e,t){super(),this.instantiationService=e,this.textFileService=t,this.registerSaveParticipants()}registerSaveParticipants(){this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(B3))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance($3))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(U3))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(V3))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(H3)))}};G3=f([p(0,J),p(1,Ds)],G3);const OUe=Ge.as(hf.Workbench);OUe.registerWorkbenchContribution(G3,mc.Restored);class i5 extends X{static{this.ID="editor.action.toggleMinimap"}constructor(){super({id:i5.ID,title:{...I(5297,"Toggle Minimap"),mnemonicTitle:h(5298,"&&Minimap")},category:te.View,f1:!0,toggled:x.equals("config.editor.minimap.enabled",!0),menu:{id:N.MenubarAppearanceMenu,group:"4_editor",order:1}})}async run(e){const t=e.get(ne),i=!t.getValue("editor.minimap.enabled");return t.updateValue("editor.minimap.enabled",i)}}K(i5);class Yy extends X{static{this.ID="workbench.action.toggleMultiCursorModifier"}static{this.multiCursorModifierConfigurationKey="editor.multiCursorModifier"}constructor(){super({id:Yy.ID,title:I(5299,"Toggle Multi-Cursor Modifier"),f1:!0})}run(e){const t=e.get(ne),n=t.getValue("editor").multiCursorModifier==="ctrlCmd"?"alt":"ctrlCmd";return t.updateValue(Yy.multiCursorModifierConfigurationKey,n)}}const n5=new O("multiCursorModifier","altKey");let q3=class extends F{constructor(e,t){super(),this.configurationService=e,this._multiCursorModifier=n5.bindTo(t),this._update(),this._register(e.onDidChangeConfiguration(i=>{i.affectsConfiguration("editor.multiCursorModifier")&&this._update()}))}_update(){const t=this.configurationService.getValue("editor").multiCursorModifier==="ctrlCmd"?"ctrlCmd":"altKey";this._multiCursorModifier.set(t)}};q3=f([p(0,ne),p(1,me)],q3);Ge.as(hf.Workbench).registerWorkbenchContribution(q3,mc.Restored);K(Yy);ge.appendMenuItem(N.MenubarSelectionMenu,{group:"4_config",command:{id:Yy.ID,title:h(5300,"Switch to Alt+Click for Multi-Cursor")},when:n5.isEqualTo("ctrlCmd"),order:1});ge.appendMenuItem(N.MenubarSelectionMenu,{group:"4_config",command:{id:Yy.ID,title:qt?h(5301,"Switch to Cmd+Click for Multi-Cursor"):h(5302,"Switch to Ctrl+Click for Multi-Cursor")},when:n5.isEqualTo("altKey"),order:1});class s5 extends X{static{this.ID="editor.action.toggleRenderControlCharacter"}constructor(){super({id:s5.ID,title:{...I(5303,"Toggle Control Characters"),mnemonicTitle:h(5304,"Render &&Control Characters")},category:te.View,f1:!0,toggled:x.equals("config.editor.renderControlCharacters",!0),menu:{id:N.MenubarAppearanceMenu,group:"4_editor",order:5}})}run(e){const t=e.get(ne),i=!t.getValue("editor.renderControlCharacters");return t.updateValue("editor.renderControlCharacters",i)}}K(s5);const Jge="transientWordWrapState",o5="isWordWrapMinified",r5="isDominatedByLongLines",epe=new O("canToggleWordWrap",!1,!0),tpe=new O("editorWordWrap",!1,h(5307,"Whether the editor is currently using word wrapping."));function QL(s,e,t){t.setTransientModelProperty(s,Jge,e)}function XL(s,e){return e.getTransientModelProperty(s,Jge)}const I1="editor.action.toggleWordWrap";class FUe extends we{constructor(){super({id:I1,label:I(5308,"View: Toggle Word Wrap"),precondition:void 0,kbOpts:{kbExpr:null,primary:E.Alt|S.KeyZ,weight:W.EditorContrib}})}run(e,t){const i=e.get(Ot),n=e.get(J);if(!Qy(i,t))return;const o=t.getModel(),r=XL(o,i);let a;r?a=null:a={wordWrapOverride:t.getOption(L.wrappingInfo).wrappingColumn===-1?"on":"off"},QL(o,a,i);const c=n.invokeFunction(IUe,t);if(c){const d=c.getOriginalEditor(),l=c.getModifiedEditor(),u=d===t?l:d;Qy(i,u)&&(QL(u.getModel(),a,i),c.updateOptions({}))}}}let ZL=class extends F{static{this.ID="editor.contrib.toggleWordWrapController"}constructor(e,t,i){super(),this._editor=e,this._contextKeyService=t,this._codeEditorService=i;const o=this._editor.getOptions().get(L.wrappingInfo),r=this._contextKeyService.createKey(o5,o.isWordWrapMinified),a=this._contextKeyService.createKey(r5,o.isDominatedByLongLines);let c=!1;this._register(e.onDidChangeConfiguration(l=>{if(!l.hasChanged(L.wrappingInfo))return;const g=this._editor.getOptions().get(L.wrappingInfo);r.set(g.isWordWrapMinified),a.set(g.isDominatedByLongLines),c||d()})),this._register(e.onDidChangeModel(l=>{d()})),this._register(i.onDidChangeTransientModelProperty(()=>{d()}));const d=()=>{if(!Qy(this._codeEditorService,this._editor))return;const l=XL(this._editor.getModel(),this._codeEditorService);try{c=!0,this._applyWordWrapState(l)}finally{c=!1}}}_applyWordWrapState(e){const t=e?e.wordWrapOverride:"inherit";this._editor.updateOptions({wordWrapOverride2:t})}};ZL=f([p(1,me),p(2,Ot)],ZL);let JL=class extends F{static{this.ID="diffeditor.contrib.toggleWordWrapController"}constructor(e,t){super(),this._diffEditor=e,this._codeEditorService=t,this._register(this._diffEditor.onDidChangeModel(()=>{this._ensureSyncedWordWrapToggle()}))}_ensureSyncedWordWrapToggle(){const e=this._diffEditor.getOriginalEditor(),t=this._diffEditor.getModifiedEditor();if(!e.hasModel()||!t.hasModel())return;const i=XL(e.getModel(),this._codeEditorService),n=XL(t.getModel(),this._codeEditorService);i&&!n&&Qy(this._codeEditorService,e)&&(QL(t.getModel(),i,this._codeEditorService),this._diffEditor.updateOptions({})),!i&&n&&Qy(this._codeEditorService,t)&&(QL(e.getModel(),n,this._codeEditorService),this._diffEditor.updateOptions({}))}};JL=f([p(1,Ot)],JL);function Qy(s,e){if(!e||e.isSimpleWidget||!e.getModel())return!1;if(e.getOption(L.inDiffEditor)){for(const i of s.listDiffEditors())if(i.getOriginalEditor()===e&&!i.renderSideBySide)return!1}return!0}let eM=class extends F{static{this.ID="workbench.contrib.editorWordWrapContextKeyTracker"}constructor(e,t,i){super(),this._editorService=e,this._codeEditorService=t,this._contextService=i,this._register(D.runAndSubscribe(Em,({window:n,disposables:o})=>{o.add(re(n,"focus",()=>this._update(),!0)),o.add(re(n,"blur",()=>this._update(),!0))},{window:$i,disposables:this._store})),this._register(this._editorService.onDidActiveEditorChange(()=>this._update())),this._canToggleWordWrap=epe.bindTo(this._contextService),this._editorWordWrap=tpe.bindTo(this._contextService),this._activeEditor=null,this._activeEditorListener=new U,this._update()}_update(){const e=this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor();this._activeEditor!==e&&(this._activeEditorListener.clear(),this._activeEditor=e,e&&(this._activeEditorListener.add(e.onDidChangeModel(()=>this._updateFromCodeEditor())),this._activeEditorListener.add(e.onDidChangeConfiguration(t=>{t.hasChanged(L.wrappingInfo)&&this._updateFromCodeEditor()})),this._updateFromCodeEditor()))}_updateFromCodeEditor(){if(Qy(this._codeEditorService,this._activeEditor)){const e=this._activeEditor.getOption(L.wrappingInfo);this._setValues(!0,e.wrappingColumn!==-1)}else return this._setValues(!1,!1)}_setValues(e,t){this._canToggleWordWrap.set(e),this._editorWordWrap.set(t)}};eM=f([p(0,de),p(1,Ot),p(2,me)],eM);sc(eM.ID,eM,oc.AfterRestored);Rt(ZL.ID,ZL,vt.Eager);sse(JL.ID,JL);ue(FUe);ge.appendMenuItem(N.EditorTitle,{command:{id:I1,title:h(5309,"Disable wrapping for this file"),icon:j.wordWrap},group:"navigation",order:1,when:x.and(x.has(r5),x.has(o5))});ge.appendMenuItem(N.EditorTitle,{command:{id:I1,title:h(5310,"Enable wrapping for this file"),icon:j.wordWrap},group:"navigation",order:1,when:x.and(V.inDiffEditor.negate(),x.has(r5),x.not(o5))});ge.appendMenuItem(N.MenubarViewMenu,{command:{id:I1,title:h(5311,"&&Word Wrap"),toggled:tpe,precondition:epe},order:1,group:"6_editor"});class a5 extends X{static{this.ID="editor.action.toggleRenderWhitespace"}constructor(){super({id:a5.ID,title:{...I(5305,"Toggle Render Whitespace"),mnemonicTitle:h(5306,"&&Render Whitespace")},category:te.View,f1:!0,toggled:x.notEquals("config.editor.renderWhitespace","none"),menu:{id:N.MenubarAppearanceMenu,group:"4_editor",order:4}})}run(e){const t=e.get(ne),i=t.getValue("editor.renderWhitespace");let n;return i==="none"?n="all":n="none",t.updateValue("editor.renderWhitespace",n)}}K(a5);class WUe{constructor(){this._registeredGutterActionsGenerators=new Set}registerGutterActionsGenerator(e){return this._registeredGutterActionsGenerators.add(e),{dispose:()=>{this._registeredGutterActionsGenerators.delete(e)}}}getGutterActionsGenerators(){return Array.from(this._registeredGutterActionsGenerators.values())}}Ge.add("gutterActionsRegistry",new WUe);const BUe=Ge.as("gutterActionsRegistry");let tM=class extends F{static{this.ID="workbench.contrib.editorLineNumberContextMenu"}constructor(e,t,i,n,o){super(),this.editor=e,this.contextMenuService=t,this.menuService=i,this.contextKeyService=n,this.instantiationService=o,this._register(this.editor.onMouseDown(r=>this.doShow(r,!1)))}show(e){this.doShow(e,!0)}doShow(e,t){const i=this.editor.getModel();if(!e.event.rightButton&&!(qt&&e.event.leftButton&&e.event.ctrlKey)&&!t||e.target.type!==Ei.GUTTER_LINE_NUMBERS&&e.target.type!==Ei.GUTTER_GLYPH_MARGIN||!e.target.position||!i)return;const n=e.target.position.lineNumber,o=this.contextKeyService.createOverlay([["editorLineNumber",n]]),r=this.menuService.createMenu(N.EditorLineNumberContext,o),a=[];this.instantiationService.invokeFunction(c=>{for(const l of BUe.getGutterActionsGenerators()){const u=new Map;l({lineNumber:n,editor:this.editor,accessor:c},{push:(g,m="navigation")=>{const v=u.get(m)??[];v.push(g),u.set(m,v)}});for(const[g,m]of u.entries())a.push([g,m])}a.sort((l,u)=>l[0].localeCompare(u[0]));const d=r.getActions({arg:{lineNumber:n,uri:i.uri},shouldForwardArgs:!0});if(a.push(...d),e.target.type===Ei.GUTTER_LINE_NUMBERS){const l=this.editor.getSelections(),u={startLineNumber:n,endLineNumber:n,startColumn:1,endColumn:i.getLineLength(n)+1};l?.some(m=>!m.isEmpty()&&m.intersectRanges(u)!==null)||this.editor.setSelection(u,sd.PROGRAMMATIC)}this.contextMenuService.showContextMenu({getAnchor:()=>e.event,getActions:()=>is.join(...a.map(l=>l[1])),onHide:()=>r.dispose()})})}};tM=f([p(1,mi),p(2,tn),p(3,me),p(4,J)],tM);Rt(tM.ID,tM,vt.AfterFirstRender);var tr;let gh=class extends F{static{tr=this}static{this.configName="editor.defaultFormatter"}static{this.extensionIds=[]}static{this.extensionItemLabels=[]}static{this.extensionDescriptions=[]}constructor(e,t,i,n,o,r,a,c,d,l){super(),this._extensionService=e,this._extensionEnablementService=t,this._configService=i,this._notificationService=n,this._dialogService=o,this._quickInputService=r,this._languageService=a,this._languageFeaturesService=c,this._languageStatusService=d,this._editorService=l,this._languageStatusStore=this._store.add(new U),this._store.add(this._extensionService.onDidChangeExtensions(this._updateConfigValues,this)),this._store.add(BSe.setFormatterSelector((u,g,m,v)=>this._selectFormatter(u,g,m,v))),this._store.add(l.onDidActiveEditorChange(this._updateStatus,this)),this._store.add(c.documentFormattingEditProvider.onDidChange(this._updateStatus,this)),this._store.add(c.documentRangeFormattingEditProvider.onDidChange(this._updateStatus,this)),this._store.add(i.onDidChangeConfiguration(u=>u.affectsConfiguration(tr.configName)&&this._updateStatus())),this._updateConfigValues()}async _updateConfigValues(){await this._extensionService.whenInstalledExtensionsRegistered();let e=[...this._extensionService.extensions];e=e.sort((t,i)=>{const n=t.categories?.find(r=>r==="Formatters"||r==="Programming Languages"),o=i.categories?.find(r=>r==="Formatters"||r==="Programming Languages");return n&&!o?-1:!n&&o?1:t.name.localeCompare(i.name)}),tr.extensionIds.length=0,tr.extensionItemLabels.length=0,tr.extensionDescriptions.length=0,tr.extensionIds.push(null),tr.extensionItemLabels.push(h(7333,"None")),tr.extensionDescriptions.push(h(7334,"None"));for(const t of e)(t.main||t.browser)&&(tr.extensionIds.push(t.identifier.value),tr.extensionItemLabels.push(t.displayName??""),tr.extensionDescriptions.push(t.description??""))}static _maybeQuotes(e){return e.match(/\s/)?`'${e}'`:e}async _analyzeFormatter(e,t,i){const n=this._configService.getValue(tr.configName,{resource:i.uri,overrideIdentifier:i.getLanguageId()});if(n){const a=t.find(d=>Es.equals(d.extensionId,n));if(a)return a;const c=await this._extensionService.getExtension(n);if(c&&this._extensionEnablementService.isEnabled(Qie(c))){const d=this._languageService.getLanguageName(i.getLanguageId())||i.getLanguageId();return e===l6.File?h(7335,"Extension '{0}' is configured as formatter but it cannot format '{1}'-files",c.displayName||c.name,d):h(7336,"Extension '{0}' is configured as formatter but it can only format '{1}'-files as a whole, not selections or parts of it.",c.displayName||c.name,d)}}else if(t.length===1)return t[0];const o=this._languageService.getLanguageName(i.getLanguageId())||i.getLanguageId();return n?h(7338,"Extension '{0}' is configured as formatter but not available. Select a different default formatter to continue.",n):h(7337,"There are multiple formatters for '{0}' files. One of them should be configured as default formatter.",tr._maybeQuotes(o))}async _selectFormatter(e,t,i,n){const o=await this._analyzeFormatter(n,e,t);if(typeof o!="string")return o;if(i!==Pu.Silent){const{confirmed:r}=await this._dialogService.confirm({message:h(7339,"Configure Default Formatter"),detail:o,primaryButton:h(7340,"&&Configure...")});if(r)return this._pickAndPersistDefaultFormatter(e,t)}else this._notificationService.prompt(Me.Info,o,[{label:h(7341,"Configure..."),run:()=>this._pickAndPersistDefaultFormatter(e,t)}],{priority:Zie.SILENT})}async _pickAndPersistDefaultFormatter(e,t){const i=e.map((r,a)=>({index:a,label:r.displayName||(r.extensionId?r.extensionId.value:"?"),description:r.extensionId&&r.extensionId.value})),n=this._languageService.getLanguageName(t.getLanguageId())||t.getLanguageId(),o=await this._quickInputService.pick(i,{placeHolder:h(7342,"Select a default formatter for '{0}' files",tr._maybeQuotes(n))});if(!(!o||!e[o.index].extensionId))return this._configService.updateValue(tr.configName,e[o.index].extensionId.value,{resource:t.uri,overrideIdentifier:t.getLanguageId()}),e[o.index]}_updateStatus(){this._languageStatusStore.clear();const e=vw(this._editorService.activeTextEditorControl);if(!e||!e.hasModel())return;const t=e.getModel(),i=Rse(this._languageFeaturesService.documentFormattingEditProvider,this._languageFeaturesService.documentRangeFormattingEditProvider,t);if(i.length===0)return;const n=new ri;this._languageStatusStore.add(Ee(()=>n.dispose(!0))),this._analyzeFormatter(l6.File,i,t).then(o=>{if(n.token.isCancellationRequested||typeof o!="string")return;const r={id:`formatter/configure/dfl/${Dn()}`,title:h(7343,"Configure...")};this._languageStatusStore.add(Ce.registerCommand(r.id,()=>this._pickAndPersistDefaultFormatter(i,t))),this._languageStatusStore.add(this._languageStatusService.addStatus({id:"formatter.conflict",name:h(7344,"Formatter Conflicts"),selector:{language:t.getLanguageId(),pattern:t.uri.fsPath},severity:Me.Error,label:h(7345,"Formatting"),detail:o,busy:!1,source:"",command:r,accessibilityInfo:void 0}))})}};gh=tr=f([p(0,hn),p(1,gd),p(2,ne),p(3,At),p(4,Qt),p(5,zt),p(6,fi),p(7,Ne),p(8,Rz),p(9,de)],gh);Ge.as(hf.Workbench).registerWorkbenchContribution(gh,mc.Restored);Ge.as(qs.Configuration).registerConfiguration({...Nv,properties:{[gh.configName]:{description:h(7346,"Defines a default formatter which takes precedence over all other formatter settings. Must be the identifier of an extension contributing a formatter."),type:["string","null"],default:null,enum:gh.extensionIds,enumItemLabels:gh.extensionItemLabels,markdownEnumDescriptions:gh.extensionDescriptions}}});async function ipe(s,e,t){const i=s.get(zt),n=s.get(ne),o=s.get(fi),r={resource:e.uri,overrideIdentifier:e.getLanguageId()},a=n.getValue(gh.configName,r);let c;const d=t.map((g,m)=>{const v=Es.equals(g.extensionId,a),y={index:m,label:g.displayName||"",description:v?h(7347,"(default)"):void 0};return v&&(c=y),y}),l={label:h(7348,"Configure Default Formatter...")},u=await i.pick([...d,{type:"separator"},l],{placeHolder:h(7349,"Select a formatter"),activeItem:c});if(u)if(u===l){const g=o.getLanguageName(e.getLanguageId())||e.getLanguageId(),m=await i.pick(d,{placeHolder:h(7342,"Select a default formatter for '{0}' files",gh._maybeQuotes(g))});m&&t[m.index].extensionId&&n.updateValue(gh.configName,t[m.index].extensionId.value,r);return}else return u.index;else return}ue(class extends we{constructor(){super({id:"editor.action.formatDocument.multiple",label:h(7350,"Format Document With..."),alias:"Format Document...",precondition:x.and(V.writable,V.hasMultipleDocumentFormattingProvider),contextMenuOpts:{group:"1_modification",order:1.3}})}async run(e,t,i){if(!t.hasModel())return;const n=e.get(J),o=e.get(Ne),r=t.getModel(),a=Rse(o.documentFormattingEditProvider,o.documentRangeFormattingEditProvider,r),c=await n.invokeFunction(ipe,r,a);typeof c=="number"&&await n.invokeFunction(VSe,a[c],t,Pu.Explicit,ye.None)}});ue(class extends we{constructor(){super({id:"editor.action.formatSelection.multiple",label:h(7351,"Format Selection With..."),alias:"Format Code...",precondition:x.and(x.and(V.writable),V.hasMultipleDocumentSelectionFormattingProvider),contextMenuOpts:{when:x.and(V.hasNonEmptySelection),group:"1_modification",order:1.31}})}async run(e,t){if(!t.hasModel())return;const i=e.get(J),n=e.get(Ne),o=t.getModel();let r=t.getSelection();r.isEmpty()&&(r=new P(r.startLineNumber,1,r.startLineNumber,o.getLineMaxColumn(r.startLineNumber)));const a=n.documentRangeFormattingEditProvider.ordered(o),c=await i.invokeFunction(ipe,o,a);typeof c=="number"&&await i.invokeFunction(HSe,a[c],t,r,ye.None,!0)}});ue(class extends we{constructor(){super({id:"editor.action.formatDocument.none",label:I(7352,"Format Document"),precondition:x.and(V.writable,V.hasDocumentFormattingProvider.toNegated()),kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyF,linux:{primary:E.CtrlCmd|E.Shift|S.KeyI},weight:W.EditorContrib}})}async run(e,t){if(!t.hasModel())return;const i=e.get(qe),n=e.get(EI),o=e.get(At),r=e.get(Qt),a=e.get(Ne),c=t.getModel(),d=a.documentFormattingEditProvider.all(c).length;if(d>1)return i.executeCommand("editor.action.formatDocument.multiple");if(d===1)return i.executeCommand("editor.action.formatDocument");if(c.isTooLargeForSyncing())o.warn(h(7353,"This file cannot be formatted because it is too large"));else{const l=c.getLanguageId(),u=h(7354,"There is no formatter for '{0}' files installed.",l),{confirmed:g}=await r.confirm({message:u,primaryButton:h(7355,"&&Install Formatter...")});g&&n.openSearch(`category:formatters ${l}`)}}});var Gr;let ym=class extends F{static{Gr=this}static{this.configName="editor.defaultFoldingRangeProvider"}static{this.extensionIds=[]}static{this.extensionItemLabels=[]}static{this.extensionDescriptions=[]}constructor(e,t){super(),this._extensionService=e,this._configurationService=t,this._store.add(this._extensionService.onDidChangeExtensions(this._updateConfigValues,this)),this._store.add(Kq.setFoldingRangeProviderSelector(this._selectFoldingRangeProvider.bind(this))),this._updateConfigValues()}async _updateConfigValues(){await this._extensionService.whenInstalledExtensionsRegistered(),Gr.extensionIds.length=0,Gr.extensionItemLabels.length=0,Gr.extensionDescriptions.length=0,Gr.extensionIds.push(null),Gr.extensionItemLabels.push(h(7330,"All")),Gr.extensionDescriptions.push(h(7331,"All active folding range providers"));const e=[],t=[];for(const n of this._extensionService.extensions)(n.main||n.browser)&&(n.categories?.find(o=>o==="Programming Languages")?e.push(n):t.push(n));const i=(n,o)=>n.name.localeCompare(o.name);for(const n of e.sort(i))Gr.extensionIds.push(n.identifier.value),Gr.extensionItemLabels.push(n.displayName??""),Gr.extensionDescriptions.push(n.description??"");for(const n of t.sort(i))Gr.extensionIds.push(n.identifier.value),Gr.extensionItemLabels.push(n.displayName??""),Gr.extensionDescriptions.push(n.description??"")}_selectFoldingRangeProvider(e,t){const i=this._configurationService.getValue(Gr.configName,{overrideIdentifier:t.getLanguageId()});if(i)return e.filter(n=>n.id===i)}};ym=Gr=f([p(0,hn),p(1,ne)],ym);Ge.as(qs.Configuration).registerConfiguration({...Nv,properties:{[ym.configName]:{description:h(7332,"Defines a default folding range provider that takes precedence over all other folding range providers. Must be the identifier of an extension contributing a folding range provider."),type:["string","null"],default:null,enum:ym.extensionIds,enumItemLabels:ym.extensionItemLabels,markdownEnumDescriptions:ym.extensionDescriptions}}});Ge.as(hf.Workbench).registerWorkbenchContribution(ym,mc.Restored);var yT;let yv=class{static{yT=this}static{this.IsReading=new O("isReadingLineWithInlayHints",!1,{type:"boolean",description:h(7357,"Whether the current line and its inlay hints are currently focused")})}static{this.ID="editor.contrib.InlayHintsAccessibility"}static get(e){return e.getContribution(yT.ID)??void 0}constructor(e,t,i,n){this._editor=e,this._accessibilitySignalService=i,this._instaService=n,this._sessionDispoosables=new U,this._ariaElement=document.createElement("span"),this._ariaElement.style.position="fixed",this._ariaElement.className="inlayhint-accessibility-element",this._ariaElement.tabIndex=0,this._ariaElement.setAttribute("aria-description",h(7358,"Code with Inlay Hint Information")),this._ctxIsReading=yT.IsReading.bindTo(t)}dispose(){this._sessionDispoosables.dispose(),this._ctxIsReading.reset(),this._ariaElement.remove()}_reset(){Yi(this._ariaElement),this._sessionDispoosables.clear(),this._ctxIsReading.reset()}async _read(e,t){if(this._sessionDispoosables.clear(),this._ariaElement.isConnected||this._editor.getDomNode()?.appendChild(this._ariaElement),!this._editor.hasModel()||!this._ariaElement.isConnected){this._ctxIsReading.set(!1);return}const i=new ri;this._sessionDispoosables.add(i);for(const c of t)await c.resolve(i.token);if(i.token.isCancellationRequested)return;const n=this._editor.getModel(),o=[];let r=0,a=!1;for(const c of t){const d=n.getValueInRange({startLineNumber:e,startColumn:r+1,endLineNumber:e,endColumn:c.hint.position.column});if(d.length>0&&(o.push(d),r=c.hint.position.column-1),r>750){o.push("…"),a=!0;break}const l=document.createElement("em"),{label:u}=c.hint;if(typeof u=="string")l.innerText=u;else for(const g of u)if(g.command){const m=this._instaService.createInstance(xx,l,{href:oae(g.command),label:g.label,title:g.command.title},void 0);this._sessionDispoosables.add(m)}else l.innerText+=g.label;o.push(l)}a||o.push(n.getValueInRange({startLineNumber:e,startColumn:r+1,endLineNumber:e,endColumn:Number.MAX_SAFE_INTEGER})),ig(this._ariaElement,...o),this._ariaElement.focus(),this._ctxIsReading.set(!0),this._sessionDispoosables.add(re(this._ariaElement,"focusout",()=>{this._reset()}))}startInlayHintsReading(){if(!this._editor.hasModel())return;const e=this._editor.getPosition().lineNumber,t=yy.get(this._editor)?.getInlayHintsForLine(e);!t||t.length===0?this._accessibilitySignalService.playSignal(Up.noInlayHints):this._read(e,t)}stopInlayHintsReading(){this._reset(),this._editor.focus()}};yv=yT=f([p(1,me),p(2,cI),p(3,J)],yv);K(class extends Rr{constructor(){super({id:"inlayHints.startReadingLineWithHint",title:I(7359,"Read Line with Inlay Hints"),precondition:V.hasInlayHintsProvider,f1:!0})}runEditorCommand(e,t){yv.get(t)?.startInlayHintsReading()}});K(class extends Rr{constructor(){super({id:"inlayHints.stopReadingLineWithHint",title:I(7360,"Stop Inlay Hints Reading"),precondition:yv.IsReading,f1:!0,keybinding:{weight:W.EditorContrib,primary:S.Escape}})}runEditorCommand(e,t){yv.get(t)?.stopInlayHintsReading()}});Rt(yv.ID,yv,vt.Lazy);const VUe=s=>({type:"string",enum:["always","explicit","never",!0,!1],enumDescriptions:[h(5231,"Triggers Code Actions on explicit saves and auto saves triggered by window or focus changes."),h(5232,"Triggers Code Actions only when explicitly saved"),h(5233,"Never triggers Code Actions on save"),h(5234,'Triggers Code Actions only when explicitly saved. This value will be deprecated in favor of "explicit".'),h(5235,'Never triggers Code Actions on save. This value will be deprecated in favor of "never".')],default:"explicit",description:s}),HUe=s=>({type:["string","boolean"],enum:["explicit","never",!0,!1],enumDescriptions:[h(5236,"Triggers Code Actions only when explicitly saved."),h(5237,"Never triggers Code Actions on save."),h(5238,'Triggers Code Actions only when explicitly saved. This value will be deprecated in favor of "explicit".'),h(5239,'Triggers Code Actions only when explicitly saved. This value will be deprecated in favor of "never".')],default:"explicit",description:s}),z3={oneOf:[{type:"object",additionalProperties:{type:"string"}},{type:"array",items:{type:"string"}}],markdownDescription:h(5240,'Run Code Actions for the editor on save. Code Actions must be specified and the editor must not be shutting down. When {0} is set to `afterDelay`, Code Actions will only be run when the file is saved explicitly. Example: `"source.organizeImports": "explicit" `',"`#files.autoSave#`"),type:["object","array"],additionalProperties:{type:"string",enum:["always","explicit","never",!0,!1]},default:{},scope:Bt.LANGUAGE_OVERRIDABLE},npe=Object.freeze({...Nv,properties:{"editor.codeActionsOnSave":z3}}),K3={oneOf:[{type:"object",additionalProperties:{type:"string"}},{type:"array",items:{type:"string"}}],markdownDescription:h(5241,'Run a series of Code Actions for a notebook on save. Code Actions must be specified and the editor must not be shutting down. When {0} is set to `afterDelay`, Code Actions will only be run when the file is saved explicitly. Example: `"notebook.source.organizeImports": "explicit"`',"`#files.autoSave#`"),type:"object",additionalProperties:{type:["string","boolean"],enum:["explicit","never",!0,!1]},default:{}},UUe=Object.freeze({...Nv,properties:{"notebook.codeActionsOnSave":K3}});let j3=class extends F{constructor(e,t){super(),this.languageFeatures=t,this._onDidChangeSchemaContributions=this._register(new M),this._allProvidedCodeActionKinds=[],this._register(D.runAndSubscribe(D.debounce(t.codeActionProvider.onDidChange,()=>{},1e3),()=>{this._allProvidedCodeActionKinds=this.getAllProvidedCodeActionKinds(),this.updateConfigurationSchema(this._allProvidedCodeActionKinds),this._onDidChangeSchemaContributions.fire()})),e.registerSchemaContribution({getSchemaAdditions:()=>this.getKeybindingSchemaAdditions(),onDidChange:this._onDidChangeSchemaContributions.event})}getAllProvidedCodeActionKinds(){const e=new Map;for(const t of this.languageFeatures.codeActionProvider.allNoModel())for(const i of t.providedCodeActionKinds??[])e.set(i,new Zt(i));return Array.from(e.values())}updateConfigurationSchema(e){const t={...z3.properties},i={...K3.properties};for(const n of e)gi.Source.contains(n)&&!t[n.value]&&(t[n.value]=VUe(h(5242,"Controls whether '{0}' actions should be run on file save.",n.value)),i[n.value]=HUe(h(5242,"Controls whether '{0}' actions should be run on file save.",n.value)));z3.properties=t,K3.properties=i,Ge.as(qs.Configuration).notifyConfigurationSchemaUpdated(npe)}getKeybindingSchemaAdditions(){const e=(i,n)=>({if:{required:["command"],properties:{command:{const:i}}},then:{properties:{args:{required:["kind"],properties:{kind:{anyOf:[{enum:Array.from(n)},{type:"string"}]}}}}}}),t=i=>{const n=new Set;for(const o of this._allProvidedCodeActionKinds)i.contains(o)&&n.add(o.value);return Array.from(n)};return[e(z4,t(Zt.Empty)),e(j4,t(gi.Refactor)),e(Y4,t(gi.Source))]}};j3=f([p(0,Ve),p(1,Ne)],j3);Ge.as(qs.Configuration).registerConfiguration(npe);Ge.as(qs.Configuration).registerConfiguration(UUe);Ge.as(hf.Workbench).registerWorkbenchContribution(j3,mc.Eventually);let Y3=class extends F{constructor(e,t){super(),this._table=e,this._quickInputService=t}async show(){const e=[];this._table.getColumnLabels().forEach((o,r)=>{o&&e.push({label:o,index:r})});const t=await this._quickInputService.pick(e,{placeHolder:h(7576,"Select the column to resize, type to filter.")});if(!t)return;const i=await this._quickInputService.input({placeHolder:h(7577,"i.e. 20, 60, 100..."),prompt:h(7578,"Please enter a width in percentage for the '{0}' column.",t.label),validateInput:o=>this._validateColumnResizeValue(o)}),n=i?Number.parseInt(i):void 0;n&&this._table.resizeColumn(t.index,n)}async _validateColumnResizeValue(e){const t=Number.parseInt(e);return e&&!Number.isInteger(t)?h(7579,"Please enter an integer."):t<0||t>100?h(7580,"Please enter a number greater than 0 and less than or equal to 100."):null}};Y3=f([p(1,zt)],Y3);class $Ue extends X{constructor(){super({id:"list.resizeColumn",title:{value:h(7574,"Resize Column"),original:"Resize Column"},category:{value:h(7575,"List"),original:"List"},precondition:af,f1:!0})}async run(e){const t=e.get(Si),i=e.get(J),n=t.lastFocusedList;n instanceof qye&&await i.createInstance(Y3,n).show()}}let iM=class{static{this.ID="workbench.contrib.listContext"}constructor(e){e.createKey("listSupportsTypeNavigation",!0),e.createKey("listSupportsKeyboardNavigation",!0)}};iM=f([p(0,me)],iM);sc(iM.ID,iM,oc.BlockStartup);K($Ue);const spe=[];function cS(s){spe.push(s)}function GUe(){return spe.slice(0)}let nM=class extends F{static{this.ID="workbench.contrib.editorFeaturesInstantiator"}constructor(e,t){super(),this._instantiationService=t,this._instantiated=!1,this._register(e.onWillCreateCodeEditor(()=>this._instantiate())),this._register(e.onWillCreateDiffEditor(()=>this._instantiate())),(e.listCodeEditors().length>0||e.listDiffEditors().length>0)&&this._instantiate()}_instantiate(){if(this._instantiated)return;this._instantiated=!0;const e=GUe();for(const t of e)try{const i=this._instantiationService.createInstance(t);typeof i.dispose=="function"&&this._register(i)}catch(i){mt(i)}}};nM=f([p(0,Ot),p(1,J)],nM);sc(nM.ID,nM,oc.BlockRestore);let Q3=class extends F{constructor(e,t){super();const i=n=>e.activeContainer.classList.toggle("context-menu-visible",n);this._register(t.onDidShowContextMenu(()=>i(!0))),this._register(t.onDidHideContextMenu(()=>i(!1)))}};Q3=f([p(0,df),p(1,mi)],Q3);Ge.as(hf.Workbench).registerWorkbenchContribution(Q3,mc.Eventually);function qUe(s){return[Ci({id:"undo",label:h(2786,"Undo"),run:()=>Kd().execCommand("undo")}),Ci({id:"redo",label:h(2787,"Redo"),run:()=>Kd().execCommand("redo")}),new is,Ci({id:"editor.action.clipboardCutAction",label:h(2788,"Cut"),run:()=>Kd().execCommand("cut")}),Ci({id:"editor.action.clipboardCopyAction",label:h(2789,"Copy"),run:()=>Kd().execCommand("copy")}),Ci({id:"editor.action.clipboardPasteAction",label:h(2790,"Paste"),run:async e=>{const t=await s.readText();if(ose(e)||rse(e)){const i=e.selectionStart||0,n=e.selectionEnd||0;e.value=`${e.value.substring(0,i)}${t}${e.value.substring(n,e.value.length)}`,e.selectionStart=i+t.length,e.selectionEnd=e.selectionStart,e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}}}),new is,Ci({id:"editor.action.selectAll",label:h(2791,"Select All"),run:()=>Kd().execCommand("selectAll")})]}let sM=class extends F{static{this.ID="workbench.contrib.textInputActionsProvider"}constructor(e,t,i){super(),this.layoutService=e,this.contextMenuService=t,this.clipboardService=i,this.textInputActions=new Ju(()=>qUe(this.clipboardService)),this.registerListeners()}registerListeners(){this._register(D.runAndSubscribe(this.layoutService.onDidAddContainer,({container:e,disposables:t})=>{t.add(re(e,"contextmenu",i=>this.onContextMenu(bt(e),i)))},{container:this.layoutService.mainContainer,disposables:this._store}))}onContextMenu(e,t){if(t.defaultPrevented)return;const i=t.target;if(!ose(i)&&!rse(i))return;Li.stop(t,!0);const n=new us(e,t);this.contextMenuService.showContextMenu({getAnchor:()=>n,getActions:()=>this.textInputActions.value,getActionsContext:()=>i})}};sM=f([p(0,vi),p(1,mi),p(2,Is)],sM);sc(sM.ID,sM,oc.BlockRestore);const zUe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(zUe);class KUe extends X{constructor(){super({id:"workbench.action.inspectContextKeys",title:I(2610,"Inspect Context Keys"),category:te.Developer,f1:!0})}run(e){const t=e.get(me),i=new U,n=tN(void 0,void 0,i);OM("*","cursor: crosshair !important;",n);const o=document.createElement("div"),r=Kd();r.body.appendChild(o),i.add(Ee(()=>o.remove())),o.style.position="absolute",o.style.pointerEvents="none",o.style.backgroundColor="rgba(255, 0, 0, 0.5)",o.style.zIndex="1000";const a=i.add(new Wo(r,"mousemove",!0));i.add(a.event(l=>{const u=l.target,g=Ms(u);o.style.top=`${g.top}px`,o.style.left=`${g.left}px`,o.style.width=`${g.width}px`,o.style.height=`${g.height}px`}));const c=i.add(new Wo(r,"mousedown",!0));D.once(c.event)(l=>{l.preventDefault(),l.stopPropagation()},null,i);const d=i.add(new Wo(r,"mouseup",!0));D.once(d.event)(l=>{l.preventDefault(),l.stopPropagation();const u=t.getContext(l.target);console.log(u.collectAllValues()),Qe(i)},null,i)}}class Sb extends X{constructor(){super({id:"workbench.action.toggleScreencastMode",title:I(2611,"Toggle Screencast Mode"),category:te.Developer,f1:!0})}run(e){if(Sb.disposable){Sb.disposable.dispose(),Sb.disposable=void 0;return}const t=e.get(df),i=e.get(ne),n=e.get(Ve),o=new U,r=t.activeContainer,a=ee(r,Y(".screencast-mouse"));o.add(Ee(()=>a.remove()));const c=ee(r,Y(".screencast-keyboard"));o.add(Ee(()=>c.remove()));const d=o.add(new M),l=o.add(new M),u=o.add(new M);function g(it,ti){ti.add(ti.add(new Wo(it,"mousedown",!0)).event(ci=>d.fire(ci))),ti.add(ti.add(new Wo(it,"mouseup",!0)).event(ci=>l.fire(ci))),ti.add(ti.add(new Wo(it,"mousemove",!0)).event(ci=>u.fire(ci)))}for(const{window:it,disposables:ti}of GF())g(t.getContainer(it),ti);o.add(Em(({window:it,disposables:ti})=>g(t.getContainer(it),ti))),o.add(t.onDidChangeActiveContainer(()=>{t.activeContainer.appendChild(a),t.activeContainer.appendChild(c)}));const m=()=>{a.style.borderColor=be.fromHex(i.getValue("screencastMode.mouseIndicatorColor")).toString()};let v;const y=()=>{v=om(i.getValue("screencastMode.mouseIndicatorSize")||20,20,100),a.style.height=`${v}px`,a.style.width=`${v}px`};m(),y(),o.add(d.event(it=>{a.style.top=`${it.clientY-v/2}px`,a.style.left=`${it.clientX-v/2}px`,a.style.display="block",a.style.transform="scale(1)",a.style.transition="transform 0.1s";const ti=u.event(ci=>{a.style.top=`${ci.clientY-v/2}px`,a.style.left=`${ci.clientX-v/2}px`,a.style.transform=`scale(${.8})`});D.once(l.event)(()=>{a.style.display="none",ti.dispose()})}));const w=()=>{c.style.fontSize=`${om(i.getValue("screencastMode.fontSize")||56,20,100)}px`},C=()=>{c.style.bottom=`${om(i.getValue("screencastMode.verticalOffset")||0,0,90)}%`};let T;const k=()=>{T=om(i.getValue("screencastMode.keyboardOverlayTimeout")||800,500,5e3)};w(),C(),k(),o.add(i.onDidChangeConfiguration(it=>{it.affectsConfiguration("screencastMode.verticalOffset")&&C(),it.affectsConfiguration("screencastMode.fontSize")&&w(),it.affectsConfiguration("screencastMode.keyboardOverlayTimeout")&&k(),it.affectsConfiguration("screencastMode.mouseIndicatorColor")&&m(),it.affectsConfiguration("screencastMode.mouseIndicatorSize")&&y()}));const A=o.add(new M),B=o.add(new M),z=o.add(new M),Q=o.add(new M);function ie(it,ti){ti.add(ti.add(new Wo(it,"keydown",!0)).event(ci=>A.fire(ci))),ti.add(ti.add(new Wo(it,"compositionstart",!0)).event(ci=>B.fire(ci))),ti.add(ti.add(new Wo(it,"compositionupdate",!0)).event(ci=>z.fire(ci))),ti.add(ti.add(new Wo(it,"compositionend",!0)).event(ci=>Q.fire(ci)))}for(const{window:it,disposables:ti}of GF())ie(it,ti);o.add(Em(({window:it,disposables:ti})=>ie(it,ti)));let oe=0,xe,Se=!1;const Ft=new fn(()=>{c.textContent="",xe=void 0,oe=0},T);o.add(B.event(it=>{Se=!0})),o.add(z.event(it=>{it.data&&Se?(oe>20&&(c.innerText="",oe=0),xe=xe??ee(c,Y("span.key")),xe.textContent=it.data):Se&&(c.innerText="",ee(c,Y("span.key",{},"Backspace"))),Ft.schedule()})),o.add(Q.event(it=>{xe=void 0,oe++})),o.add(A.event(it=>{if(it.key==="Process"||/[\uac00-\ud787\u3131-\u314e\u314f-\u3163\u3041-\u3094\u30a1-\u30f4\u30fc\u3005\u3006\u3024\u4e00-\u9fa5]/u.test(it.key)){it.code==="Backspace"||it.code.includes("Key")?Se=!0:(xe=void 0,Se=!1),Ft.schedule();return}if(it.isComposing)return;const ti=i.getValue("screencastMode.keyboardOptions"),ci=new zs(it),Xn=n.softDispatch(ci,ci.target);if(Xn.kind===UT.KbFound&&Xn.commandId&&!(ti.showSingleEditorCursorMoves??!0)&&["cursorLeft","cursorRight","cursorUp","cursorDown"].includes(Xn.commandId))return;(ci.ctrlKey||ci.altKey||ci.metaKey||ci.shiftKey||oe>20||ci.keyCode===S.Backspace||ci.keyCode===S.Escape||ci.keyCode===S.UpArrow||ci.keyCode===S.DownArrow||ci.keyCode===S.LeftArrow||ci.keyCode===S.RightArrow)&&(c.innerText="",oe=0);const tu=n.resolveKeyboardEvent(ci),Fr=this._isKbFound(Xn)&&Xn.commandId?this.getCommandDetails(Xn.commandId):void 0;let Wr=Fr?.title,Cc=tu.getLabel();if(Fr&&((ti.showCommandGroups??!1)&&Fr.category&&(Wr=`${Fr.category}: ${Wr} `),this._isKbFound(Xn)&&Xn.commandId)){const Ec=n.lookupKeybindings(Xn.commandId).filter(Bn=>Bn.getLabel()?.endsWith(Cc??""));Ec.length>0&&(Cc=Ec[Ec.length-1].getLabel())}(ti.showCommands??!0)&&Wr&&ee(c,Y("span.title",{},`${Wr} `)),((ti.showKeys??!0)||(ti.showKeybindings??!0)&&this._isKbFound(Xn))&&(Cc=Cc?.replace("UpArrow","↑")?.replace("DownArrow","↓")?.replace("LeftArrow","←")?.replace("RightArrow","→"),ee(c,Y("span.key",{},Cc??""))),oe++,Ft.schedule()})),Sb.disposable=o}_isKbFound(e){return e.kind===UT.KbFound}getCommandDetails(e){const t=ge.getCommand(e);if(t)return{title:typeof t.title=="string"?t.title:t.title.value,category:t.category?typeof t.category=="string"?t.category:t.category.value:void 0};const i=Ce.getCommand(e);if(i&&i.metadata?.description)return{title:typeof i.metadata.description=="string"?i.metadata.description:i.metadata.description.value}}}class jUe extends X{constructor(){super({id:"workbench.action.logStorage",title:I(2612,"Log Storage Database Contents"),category:te.Developer,f1:!0})}run(e){const t=e.get(tt),i=e.get(Qt);t.log(),i.info(h(2613,"The storage database contents have been logged to the developer tools."),h(2614,"Open developer tools from the menu and select the Console tab."))}}class YUe extends X{constructor(){super({id:"workbench.action.logWorkingCopies",title:I(2615,"Log Working Copies"),category:te.Developer,f1:!0})}async run(e){const t=e.get(vg),i=e.get(Xq),n=e.get(Pe),o=e.get(FN),r=await i.getBackups(),a=["","[Working Copies]",...t.workingCopies.length>0?t.workingCopies.map(c=>`${c.isDirty()?"● ":""}${c.resource.toString(!0)} (typeId: ${c.typeId||"<no typeId>"})`):["<none>"],"","[Backups]",...r.length>0?r.map(c=>`${c.resource.toString(!0)} (typeId: ${c.typeId||"<no typeId>"})`):["<none>"]];n.info(a.join(`
`)),o.showChannel(zye,!0)}}class c5 extends X{static{this.SIZE_THRESHOLD=1024*16}constructor(){super({id:"workbench.action.removeLargeStorageDatabaseEntries",title:I(2616,"Remove Large Storage Database Entries..."),category:te.Developer,f1:!0})}async run(e){const t=e.get(tt),i=e.get(zt),n=e.get(Fh),o=e.get(Qt),r=e.get(po),a=[];for(const u of[he.APPLICATION,he.PROFILE,he.WORKSPACE])if(!(u===he.PROFILE&&n.currentProfile.isDefault))for(const g of[pt.MACHINE,pt.USER])for(const m of t.keys(u,g)){const v=t.get(m,u);v&&(!r.isBuilt||v.length>c5.SIZE_THRESHOLD)&&a.push({key:m,scope:u,target:g,size:v.length,label:m,description:Fo.formatSize(v.length),detail:h(2617,"Scope: {0}, Target: {1}",u===he.APPLICATION?h(2618,"Global"):u===he.PROFILE?h(2619,"Profile"):h(2620,"Workspace"),g===pt.MACHINE?h(2621,"Machine"):h(2622,"User"))})}a.sort((u,g)=>g.size-u.size);const c=await new Promise(u=>{const g=new U,m=g.add(i.createQuickPick());m.items=a,m.canSelectMany=!0,m.ok=!1,m.customButton=!0,m.hideCheckAll=!0,m.customLabel=h(2623,"Remove"),m.placeholder=h(2624,"Select large entries to remove from storage"),a.length===0&&(m.description=h(2625,"There are no large storage entries to remove.")),m.show(),g.add(m.onDidCustom(()=>{u(m.selectedItems),m.hide()})),g.add(m.onDidHide(()=>g.dispose()))});if(c.length===0)return;const{confirmed:d}=await o.confirm({type:"warning",message:h(2626,"Do you want to remove the selected storage entries from the database?"),detail:h(2627,`{0}

This action is irreversible and may result in data loss!`,c.map(u=>u.label).join(`
`)),primaryButton:h(2628,"&&Remove")});if(!d)return;const l=new Set;for(const u of c)t.remove(u.key,u.scope),l.add(u.scope);for(const u of l)await t.optimize(u)}}let wm,oM=new Set;const Fm=new O("dirtyWorkingCopies","stopped");class QUe extends X{constructor(){super({id:"workbench.action.startTrackDisposables",title:I(2629,"Start Tracking Disposables"),category:te.Developer,f1:!0,precondition:x.and(Fm.isEqualTo("pending").negate(),Fm.isEqualTo("started").negate())})}run(e){Fm.bindTo(e.get(me)).set("started"),oM.clear(),wm=new Kye,ase(wm)}}class XUe extends X{constructor(){super({id:"workbench.action.snapshotTrackedDisposables",title:I(2630,"Snapshot Tracked Disposables"),category:te.Developer,f1:!0,precondition:Fm.isEqualTo("started")})}run(e){Fm.bindTo(e.get(me)).set("pending"),oM=new Set(wm?.computeLeakingDisposables(1e3)?.leaks.map(i=>i.value))}}class ZUe extends X{constructor(){super({id:"workbench.action.stopTrackDisposables",title:I(2631,"Stop Tracking Disposables"),category:te.Developer,f1:!0,precondition:Fm.isEqualTo("pending")})}run(e){const t=e.get(de);if(Fm.bindTo(e.get(me)).set("stopped"),wm){const n=new Set;for(const r of new Set(wm.computeLeakingDisposables(1e3)?.leaks)??[])oM.has(r.value)&&n.add(r);const o=wm.computeLeakingDisposables(1e3,Array.from(n));o&&t.openEditor({resource:void 0,contents:o.details})}ase(null),wm=void 0,oM.clear()}}K(KUe);K(Sb);K(jUe);K(YUe);K(c5);Io.commit||(K(QUe),K(XUe),K(ZUe));const JUe=Ge.as(qs.Configuration);JUe.registerConfiguration({id:"screencastMode",order:9,title:h(2632,"Screencast Mode"),type:"object",properties:{"screencastMode.verticalOffset":{type:"number",default:20,minimum:0,maximum:90,description:h(2633,"Controls the vertical offset of the screencast mode overlay from the bottom as a percentage of the workbench height.")},"screencastMode.fontSize":{type:"number",default:56,minimum:20,maximum:100,description:h(2634,"Controls the font size (in pixels) of the screencast mode keyboard.")},"screencastMode.keyboardOptions":{type:"object",description:h(2635,"Options for customizing the keyboard overlay in screencast mode."),properties:{showKeys:{type:"boolean",default:!0,description:h(2636,"Show raw keys.")},showKeybindings:{type:"boolean",default:!0,description:h(2637,"Show keyboard shortcuts.")},showCommands:{type:"boolean",default:!0,description:h(2638,"Show command names.")},showCommandGroups:{type:"boolean",default:!1,description:h(2639,"Show command group names, when commands are also shown.")},showSingleEditorCursorMoves:{type:"boolean",default:!0,description:h(2640,"Show single editor cursor move commands.")}},default:{showKeys:!0,showKeybindings:!0,showCommands:!0,showCommandGroups:!1,showSingleEditorCursorMoves:!0},additionalProperties:!1},"screencastMode.keyboardOverlayTimeout":{type:"number",default:800,minimum:500,maximum:5e3,description:h(2641,"Controls how long (in milliseconds) the keyboard overlay is shown in screencast mode.")},"screencastMode.mouseIndicatorColor":{type:"string",format:"color-hex",default:"#FF0000",description:h(2642,"Controls the color in hex (#RGB, #RGBA, #RRGGBB or #RRGGBBAA) of the mouse indicator in screencast mode.")},"screencastMode.mouseIndicatorSize":{type:"number",default:20,minimum:20,maximum:100,description:h(2643,"Controls the size (in pixels) of the mouse indicator in screencast mode.")}}});K(yUe);K(Gge);K(qge);ge.appendMenuItem(N.EditorTitle,{command:{id:new qge().desc.id,title:h(183,"Use Inline View When Space Is Limited"),toggled:x.has("config.diffEditor.useInlineViewWhenSpaceIsLimited"),precondition:x.has("isInDiffEditor")},order:11,group:"1_diff",when:x.and(V.diffEditorRenderSideBySideInlineBreakpointReached,x.has("isInDiffEditor"))});ge.appendMenuItem(N.EditorTitle,{command:{id:new Gge().desc.id,title:h(184,"Show Moved Code Blocks"),icon:j.move,toggled:nse.create("config.diffEditor.experimental.showMoves",!0),precondition:x.has("isInDiffEditor")},order:10,group:"1_diff",when:x.has("isInDiffEditor")});K(O3);for(const s of[{icon:j.arrowRight,key:V.diffEditorInlineMode.toNegated()},{icon:j.discard,key:V.diffEditorInlineMode}])ge.appendMenuItem(N.DiffEditorHunkToolbar,{command:{id:new O3().desc.id,title:h(185,"Revert Block"),icon:s.icon},when:x.and(V.diffEditorModifiedWritable,s.key),order:5,group:"primary"}),ge.appendMenuItem(N.DiffEditorSelectionToolbar,{command:{id:new O3().desc.id,title:h(186,"Revert Selection"),icon:s.icon},when:x.and(V.diffEditorModifiedWritable,s.key),order:5,group:"primary"});K(wUe);K(SUe);K(CUe);K(EUe);ge.appendMenuItem(N.EditorTitle,{command:{id:rS.id,title:h(187,"Open Accessible Diff Viewer"),precondition:x.has("isInDiffEditor")},order:10,group:"2_diff",when:x.and(V.accessibleDiffViewerVisible.negate(),x.has("isInDiffEditor"))});Ce.registerCommandAlias("editor.action.diffReview.next",rS.id);K(rS);Ce.registerCommandAlias("editor.action.diffReview.prev",SD.id);K(SD);const e2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var X3;Be(e2e);const D1=new O("selectionAnchorSet",!1);let nf=class{static{X3=this}static{this.ID="editor.contrib.selectionAnchorController"}static get(e){return e.getContribution(X3.ID)}constructor(e,t){this.editor=e,this.selectionAnchorSetContextKey=D1.bindTo(t),this.modelChangeListener=e.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}setSelectionAnchor(){if(this.editor.hasModel()){const e=this.editor.getPosition();this.editor.changeDecorations(t=>{this.decorationId&&t.removeDecoration(this.decorationId),this.decorationId=t.addDecoration(at.fromPositions(e,e),{description:"selection-anchor",stickiness:Di.NeverGrowsWhenTypingAtEdges,hoverMessage:new Ni().appendText(h(872,"Selection Anchor")),className:"selection-anchor"})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),ta(h(873,"Anchor set at {0}:{1}",e.lineNumber,e.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){const e=this.editor.getModel().getDecorationRange(this.decorationId);e&&this.editor.setPosition(e.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){const e=this.editor.getModel().getDecorationRange(this.decorationId);if(e){const t=this.editor.getPosition();this.editor.setSelection(at.fromPositions(e.getStartPosition(),t)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){const e=this.decorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};nf=X3=f([p(1,me)],nf);class t2e extends we{constructor(){super({id:"editor.action.setSelectionAnchor",label:I(874,"Set Selection Anchor"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyB),weight:W.EditorContrib}})}async run(e,t){nf.get(t)?.setSelectionAnchor()}}class i2e extends we{constructor(){super({id:"editor.action.goToSelectionAnchor",label:I(875,"Go to Selection Anchor"),precondition:D1})}async run(e,t){nf.get(t)?.goToSelectionAnchor()}}class n2e extends we{constructor(){super({id:"editor.action.selectFromAnchorToCursor",label:I(876,"Select from Anchor to Cursor"),precondition:D1,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyK),weight:W.EditorContrib}})}async run(e,t){nf.get(t)?.selectFromAnchorToCursor()}}class s2e extends we{constructor(){super({id:"editor.action.cancelSelectionAnchor",label:I(877,"Cancel Selection Anchor"),precondition:D1,kbOpts:{kbExpr:V.editorTextFocus,primary:S.Escape,weight:W.EditorContrib}})}async run(e,t){nf.get(t)?.cancelSelectionAnchor()}}Rt(nf.ID,nf,vt.Lazy);ue(t2e);ue(i2e);ue(n2e);ue(s2e);const o2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(o2e);const r2e=H("editorOverviewRuler.bracketMatchForeground","#A0A0A0",h(878,"Overview ruler marker color for matching brackets."));class a2e extends we{constructor(){super({id:"editor.action.jumpToBracket",label:I(879,"Go to Bracket"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Backslash,weight:W.EditorContrib}})}run(e,t){$u.get(t)?.jumpToBracket()}}class c2e extends we{constructor(){super({id:"editor.action.selectToBracket",label:I(880,"Select to Bracket"),precondition:void 0,metadata:{description:I(881,"Select the text inside and including the brackets or curly braces"),args:[{name:"args",schema:{type:"object",properties:{selectBrackets:{type:"boolean",default:!0}}}}]}})}run(e,t,i){let n=!0;i&&i.selectBrackets===!1&&(n=!1),$u.get(t)?.selectToBracket(n)}}class d2e extends we{constructor(){super({id:"editor.action.removeBrackets",label:I(882,"Remove Brackets"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Alt|S.Backspace,weight:W.EditorContrib}})}run(e,t){$u.get(t)?.removeBrackets(this.id)}}class l2e{constructor(e,t,i){this.position=e,this.brackets=t,this.options=i}}class $u extends F{static{this.ID="editor.contrib.bracketMatchingController"}static get(e){return e.getContribution($u.ID)}constructor(e){super(),this._editor=e,this._lastBracketsData=[],this._lastVersionId=0,this._decorations=this._editor.createDecorationsCollection(),this._updateBracketsSoon=this._register(new fn(()=>this._updateBrackets(),50)),this._matchBrackets=this._editor.getOption(L.matchBrackets),this._updateBracketsSoon.schedule(),this._register(e.onDidChangeCursorPosition(t=>{this._matchBrackets!=="never"&&this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelContent(t=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModel(t=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelLanguageConfiguration(t=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeConfiguration(t=>{t.hasChanged(L.matchBrackets)&&(this._matchBrackets=this._editor.getOption(L.matchBrackets),this._decorations.clear(),this._lastBracketsData=[],this._lastVersionId=0,this._updateBracketsSoon.schedule())})),this._register(e.onDidBlurEditorWidget(()=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidFocusEditorWidget(()=>{this._updateBracketsSoon.schedule()}))}jumpToBracket(){if(!this._editor.hasModel())return;const e=this._editor.getModel(),t=this._editor.getSelections().map(i=>{const n=i.getStartPosition(),o=e.bracketPairs.matchBracket(n);let r=null;if(o)o[0].containsPosition(n)&&!o[1].containsPosition(n)?r=o[1].getStartPosition():o[1].containsPosition(n)&&(r=o[0].getStartPosition());else{const a=e.bracketPairs.findEnclosingBrackets(n);if(a)r=a[1].getStartPosition();else{const c=e.bracketPairs.findNextBracket(n);c&&c.range&&(r=c.range.getStartPosition())}}return r?new at(r.lineNumber,r.column,r.lineNumber,r.column):new at(n.lineNumber,n.column,n.lineNumber,n.column)});this._editor.setSelections(t),this._editor.revealRange(t[0])}selectToBracket(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),i=[];this._editor.getSelections().forEach(n=>{const o=n.getStartPosition();let r=t.bracketPairs.matchBracket(o);if(!r&&(r=t.bracketPairs.findEnclosingBrackets(o),!r)){const d=t.bracketPairs.findNextBracket(o);d&&d.range&&(r=t.bracketPairs.matchBracket(d.range.getStartPosition()))}let a=null,c=null;if(r){r.sort(P.compareRangesUsingStarts);const[d,l]=r;if(a=e?d.getStartPosition():d.getEndPosition(),c=e?l.getEndPosition():l.getStartPosition(),l.containsPosition(o)){const u=a;a=c,c=u}}a&&c&&i.push(new at(a.lineNumber,a.column,c.lineNumber,c.column))}),i.length>0&&(this._editor.setSelections(i),this._editor.revealRange(i[0]))}removeBrackets(e){if(!this._editor.hasModel())return;const t=this._editor.getModel();this._editor.getSelections().forEach(i=>{const n=i.getPosition();let o=t.bracketPairs.matchBracket(n);o||(o=t.bracketPairs.findEnclosingBrackets(n)),o&&(this._editor.pushUndoStop(),this._editor.executeEdits(e,[{range:o[0],text:""},{range:o[1],text:""}]),this._editor.pushUndoStop())})}static{this._DECORATION_OPTIONS_WITH_OVERVIEW_RULER=Yt.register({description:"bracket-match-overview",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"bracket-match",overviewRuler:{color:es(r2e),position:ol.Center}})}static{this._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER=Yt.register({description:"bracket-match-no-overview",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"bracket-match"})}_updateBrackets(){if(this._matchBrackets==="never")return;this._recomputeBrackets();const e=[];let t=0;for(const i of this._lastBracketsData){const n=i.brackets;n&&(e[t++]={range:n[0],options:i.options},e[t++]={range:n[1],options:i.options})}this._decorations.set(e)}_recomputeBrackets(){if(!this._editor.hasModel()||!this._editor.hasWidgetFocus()){this._lastBracketsData=[],this._lastVersionId=0;return}const e=this._editor.getSelections();if(e.length>100){this._lastBracketsData=[],this._lastVersionId=0;return}const t=this._editor.getModel(),i=t.getVersionId();let n=[];this._lastVersionId===i&&(n=this._lastBracketsData);const o=[];let r=0;for(let u=0,g=e.length;u<g;u++){const m=e[u];m.isEmpty()&&(o[r++]=m.getStartPosition())}o.length>1&&o.sort(_e.compare);const a=[];let c=0,d=0;const l=n.length;for(let u=0,g=o.length;u<g;u++){const m=o[u];for(;d<l&&n[d].position.isBefore(m);)d++;if(d<l&&n[d].position.equals(m))a[c++]=n[d];else{let v=t.bracketPairs.matchBracket(m,20),y=$u._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;!v&&this._matchBrackets==="always"&&(v=t.bracketPairs.findEnclosingBrackets(m,20),y=$u._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER),a[c++]=new l2e(m,v,y)}}this._lastBracketsData=a,this._lastVersionId=i}}Rt($u.ID,$u,vt.AfterFirstRender);ue(c2e);ue(a2e);ue(d2e);ge.appendMenuItem(N.MenubarGoMenu,{group:"5_infile_nav",command:{id:"editor.action.jumpToBracket",title:h(883,"Go to &&Bracket")},order:2});class h2e{constructor(e,t){this._selection=e,this._isMovingLeft=t}getEditOperations(e,t){if(this._selection.startLineNumber!==this._selection.endLineNumber||this._selection.isEmpty())return;const i=this._selection.startLineNumber,n=this._selection.startColumn,o=this._selection.endColumn;if(!(this._isMovingLeft&&n===1)&&!(!this._isMovingLeft&&o===e.getLineMaxColumn(i)))if(this._isMovingLeft){const r=new P(i,n-1,i,n),a=e.getValueInRange(r);t.addEditOperation(r,null),t.addEditOperation(new P(i,o,i,o),a)}else{const r=new P(i,o,i,o+1),a=e.getValueInRange(r);t.addEditOperation(r,null),t.addEditOperation(new P(i,n,i,n),a)}}computeCursorState(e,t){return this._isMovingLeft?new at(this._selection.startLineNumber,this._selection.startColumn-1,this._selection.endLineNumber,this._selection.endColumn-1):new at(this._selection.startLineNumber,this._selection.startColumn+1,this._selection.endLineNumber,this._selection.endColumn+1)}}class ope extends we{constructor(e,t){super(t),this.left=e}run(e,t){if(!t.hasModel())return;const i=[],n=t.getSelections();for(const o of n)i.push(new h2e(o,this.left));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}}class u2e extends ope{constructor(){super(!0,{id:"editor.action.moveCarretLeftAction",label:I(884,"Move Selected Text Left"),precondition:V.writable})}}class g2e extends ope{constructor(){super(!1,{id:"editor.action.moveCarretRightAction",label:I(885,"Move Selected Text Right"),precondition:V.writable})}}ue(u2e);ue(g2e);class p2e extends we{constructor(){super({id:"editor.action.transposeLetters",label:I(886,"Transpose Letters"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|S.KeyT},weight:W.EditorContrib}})}run(e,t){if(!t.hasModel())return;const i=t.getModel(),n=[],o=t.getSelections();for(const r of o){if(!r.isEmpty())continue;const a=r.startLineNumber,c=r.startColumn,d=i.getLineMaxColumn(a);if(a===1&&(c===1||c===2&&d===2))continue;const l=c===d?r.getPosition():a0.rightPosition(i,r.getPosition().lineNumber,r.getPosition().column),u=a0.leftPosition(i,l),g=a0.leftPosition(i,u),m=i.getValueInRange(P.fromPositions(g,u)),v=i.getValueInRange(P.fromPositions(u,l)),y=P.fromPositions(g,l);n.push(new uI(y,v+m))}n.length>0&&(t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop())}}ue(p2e);const wv="9_cutcopypaste",f2e=ra||document.queryCommandSupported("cut"),rpe=ra||document.queryCommandSupported("copy"),m2e=typeof navigator.clipboard>"u"||XM?document.queryCommandSupported("paste"):!0;function d5(s){return s.register(),s}const v2e=f2e?d5(new dI({id:"editor.action.clipboardCutAction",precondition:void 0,kbOpts:ra?{primary:E.CtrlCmd|S.KeyX,win:{primary:E.CtrlCmd|S.KeyX,secondary:[E.Shift|S.Delete]},weight:W.EditorContrib}:void 0,menuOpts:[{menuId:N.MenubarEditMenu,group:"2_ccp",title:h(887,"Cu&&t"),order:1},{menuId:N.EditorContext,group:wv,title:h(888,"Cut"),when:V.writable,order:1},{menuId:N.CommandPalette,group:"",title:h(888,"Cut"),order:1},{menuId:N.SimpleEditorContext,group:wv,title:h(888,"Cut"),when:V.writable,order:1}]})):void 0,_2e=rpe?d5(new dI({id:"editor.action.clipboardCopyAction",precondition:void 0,kbOpts:ra?{primary:E.CtrlCmd|S.KeyC,win:{primary:E.CtrlCmd|S.KeyC,secondary:[E.CtrlCmd|S.Insert]},weight:W.EditorContrib}:void 0,menuOpts:[{menuId:N.MenubarEditMenu,group:"2_ccp",title:h(889,"&&Copy"),order:2},{menuId:N.EditorContext,group:wv,title:h(890,"Copy"),order:2},{menuId:N.CommandPalette,group:"",title:h(890,"Copy"),order:1},{menuId:N.SimpleEditorContext,group:wv,title:h(890,"Copy"),order:2}]})):void 0;ge.appendMenuItem(N.MenubarEditMenu,{submenu:N.MenubarCopy,title:I(891,"Copy As"),group:"2_ccp",order:3});ge.appendMenuItem(N.EditorContext,{submenu:N.EditorContextCopy,title:I(891,"Copy As"),group:wv,order:3});ge.appendMenuItem(N.EditorContext,{submenu:N.EditorContextShare,title:I(892,"Share"),group:"11_share",order:-1,when:x.and(x.notEquals("resourceScheme","output"),V.editorTextFocus)});ge.appendMenuItem(N.ExplorerContext,{submenu:N.ExplorerContextShare,title:I(892,"Share"),group:"11_share",order:-1});const rF=m2e?d5(new dI({id:"editor.action.clipboardPasteAction",precondition:void 0,kbOpts:ra?{primary:E.CtrlCmd|S.KeyV,win:{primary:E.CtrlCmd|S.KeyV,secondary:[E.Shift|S.Insert]},linux:{primary:E.CtrlCmd|S.KeyV,secondary:[E.Shift|S.Insert]},weight:W.EditorContrib}:void 0,menuOpts:[{menuId:N.MenubarEditMenu,group:"2_ccp",title:h(893,"&&Paste"),order:4},{menuId:N.EditorContext,group:wv,title:h(894,"Paste"),when:V.writable,order:4},{menuId:N.CommandPalette,group:"",title:h(894,"Paste"),order:1},{menuId:N.SimpleEditorContext,group:wv,title:h(894,"Paste"),when:V.writable,order:4}]})):void 0;class b2e extends we{constructor(){super({id:"editor.action.clipboardCopyWithSyntaxHighlightingAction",label:I(895,"Copy with Syntax Highlighting"),precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,weight:W.EditorContrib}})}run(e,t){!t.hasModel()||!t.getOption(L.emptySelectionClipboard)&&t.getSelection().isEmpty()||(h6.forceCopyWithSyntaxHighlighting=!0,t.focus(),t.getContainerDomNode().ownerDocument.execCommand("copy"),h6.forceCopyWithSyntaxHighlighting=!1)}}function ape(s,e){s&&(s.addImplementation(1e4,"code-editor",(t,i)=>{const n=t.get(Ot).getFocusedCodeEditor();if(n&&n.hasTextFocus()){const o=n.getOption(L.emptySelectionClipboard),r=n.getSelection();return r&&r.isEmpty()&&!o||(n.getOption(L.effectiveExperimentalEditContextEnabled)&&e==="cut"?(n.getContainerDomNode().ownerDocument.execCommand("copy"),n.trigger(void 0,bq.Cut,void 0)):n.getContainerDomNode().ownerDocument.execCommand(e)),!0}return!1}),s.addImplementation(0,"generic-dom",(t,i)=>(Kd().execCommand(e),!0)))}ape(v2e,"cut");ape(_2e,"copy");rF&&(rF.addImplementation(1e4,"code-editor",(s,e)=>{const t=s.get(Ot),i=s.get(Is),n=s.get(li),o=s.get(Fn),r=t.getFocusedCodeEditor();if(r&&r.hasModel()&&r.hasTextFocus()){if(r.getOption(L.effectiveExperimentalEditContextEnabled)){const l=USe.get(r.getId());l&&l.onWillPaste()}const c=zn.create(!0),d=i.triggerPaste(Vp().vscodeWindowId);return d?d.then(async()=>{if(o.quality!=="stable"){const l=c.elapsed();n.publicLog2("editorAsyncPaste",{duration:l})}return md.get(r)?.finishedPaste()??Promise.resolve()}):$t?(async()=>{const l=await i.readText();if(l!==""){const u=$Se.INSTANCE.get(l);let g=!1,m=null,v=null;u&&(g=r.getOption(L.emptySelectionClipboard)&&!!u.isFromEmptySelection,m=typeof u.multicursorText<"u"?u.multicursorText:null,v=u.mode),r.trigger("keyboard",bq.Paste,{text:l,pasteOnNewLine:g,multicursorText:m,mode:v})}})():!0}return!1}),rF.addImplementation(0,"generic-dom",(s,e)=>s.get(Is).triggerPaste(Vp().vscodeWindowId)??!1));rpe&&ue(b2e);function CD(s){return x.regex(nge.keys()[0],new RegExp("(\\s|^)"+ny(s.value)+"\\b"))}const l5={type:"object",defaultSnippets:[{body:{kind:""}}],properties:{kind:{type:"string",description:h(897,"Kind of the code action to run.")},apply:{type:"string",description:h(898,"Controls when the returned actions are applied."),default:Gs.IfSingle,enum:[Gs.First,Gs.IfSingle,Gs.Never],enumDescriptions:[h(899,"Always apply the first returned code action."),h(900,"Apply the first returned code action if it is the only one."),h(901,"Do not apply the returned code actions.")]},preferred:{type:"boolean",default:!1,description:h(902,"Controls if only preferred code actions should be returned.")}}};function g_(s,e,t,i,n=Dr.Default){s.hasModel()&&ef.get(s)?.manualTriggerAtCurrentPosition(e,n,t,i)}class y2e extends we{constructor(){super({id:K4,label:I(903,"Quick Fix..."),precondition:x.and(V.writable,V.hasCodeActionsProvider),kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Period,weight:W.EditorContrib}})}run(e,t){return g_(t,h(904,"No code actions available"),void 0,void 0,Dr.QuickFix)}}class w2e extends No{constructor(){super({id:z4,precondition:x.and(V.writable,V.hasCodeActionsProvider),metadata:{description:"Trigger a code action",args:[{name:"args",schema:l5}]}})}runEditorCommand(e,t,i){const n=rh.fromUser(i,{kind:Zt.Empty,apply:Gs.IfSingle});return g_(t,typeof i?.kind=="string"?n.preferred?h(905,"No preferred code actions for '{0}' available",i.kind):h(906,"No code actions for '{0}' available",i.kind):n.preferred?h(907,"No preferred code actions available"):h(908,"No code actions available"),{include:n.kind,includeSourceActions:!0,onlyIncludePreferredActions:n.preferred},n.apply)}}class S2e extends we{constructor(){super({id:j4,label:I(909,"Refactor..."),precondition:x.and(V.writable,V.hasCodeActionsProvider),kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|E.Shift|S.KeyR,mac:{primary:E.WinCtrl|E.Shift|S.KeyR},weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:2,when:x.and(V.writable,CD(gi.Refactor))},metadata:{description:"Refactor...",args:[{name:"args",schema:l5}]}})}run(e,t,i){const n=rh.fromUser(i,{kind:gi.Refactor,apply:Gs.Never});return g_(t,typeof i?.kind=="string"?n.preferred?h(910,"No preferred refactorings for '{0}' available",i.kind):h(911,"No refactorings for '{0}' available",i.kind):n.preferred?h(912,"No preferred refactorings available"):h(913,"No refactorings available"),{include:gi.Refactor.contains(n.kind)?n.kind:Zt.None,onlyIncludePreferredActions:n.preferred},n.apply,Dr.Refactor)}}class C2e extends we{constructor(){super({id:Y4,label:I(914,"Source Action..."),precondition:x.and(V.writable,V.hasCodeActionsProvider),contextMenuOpts:{group:"1_modification",order:2.1,when:x.and(V.writable,CD(gi.Source))},metadata:{description:"Source Action...",args:[{name:"args",schema:l5}]}})}run(e,t,i){const n=rh.fromUser(i,{kind:gi.Source,apply:Gs.Never});return g_(t,typeof i?.kind=="string"?n.preferred?h(915,"No preferred source actions for '{0}' available",i.kind):h(916,"No source actions for '{0}' available",i.kind):n.preferred?h(917,"No preferred source actions available"):h(918,"No source actions available"),{include:gi.Source.contains(n.kind)?n.kind:Zt.None,includeSourceActions:!0,onlyIncludePreferredActions:n.preferred},n.apply,Dr.SourceAction)}}class E2e extends we{constructor(){super({id:M$,label:I(919,"Organize Imports"),precondition:x.and(V.writable,CD(gi.SourceOrganizeImports)),kbOpts:{kbExpr:V.textInputFocus,primary:E.Shift|E.Alt|S.KeyO,weight:W.EditorContrib},metadata:{description:I(920,"Organize imports in the current file. Also called 'Optimize Imports' by some tools")}})}run(e,t){return g_(t,h(921,"No organize imports action available"),{include:gi.SourceOrganizeImports,includeSourceActions:!0},Gs.IfSingle,Dr.OrganizeImports)}}class x2e extends we{constructor(){super({id:N$,label:I(922,"Fix All"),precondition:x.and(V.writable,CD(gi.SourceFixAll))})}run(e,t){return g_(t,h(923,"No fix all action available"),{include:gi.SourceFixAll,includeSourceActions:!0},Gs.IfSingle,Dr.FixAll)}}class I2e extends we{constructor(){super({id:ege,label:I(924,"Auto Fix..."),precondition:x.and(V.writable,CD(gi.QuickFix)),kbOpts:{kbExpr:V.textInputFocus,primary:E.Alt|E.Shift|S.Period,mac:{primary:E.CtrlCmd|E.Alt|S.Period},weight:W.EditorContrib}})}run(e,t){return g_(t,h(925,"No auto fixes available"),{include:gi.QuickFix,onlyIncludePreferredActions:!0},Gs.IfSingle,Dr.AutoFix)}}Rt(ef.ID,ef,vt.Eventually);Rt(Lx.ID,Lx,vt.Lazy);ue(y2e);ue(S2e);ue(C2e);ue(E2e);ue(I2e);ue(x2e);Ue(new w2e);Ge.as(qs.Configuration).registerConfiguration({...Nv,properties:{"editor.codeActionWidget.showHeaders":{type:"boolean",scope:Bt.LANGUAGE_OVERRIDABLE,description:h(926,"Enable/disable showing group headers in the Code Action menu."),default:!0}}});Ge.as(qs.Configuration).registerConfiguration({...Nv,properties:{"editor.codeActionWidget.includeNearbyQuickFixes":{type:"boolean",scope:Bt.LANGUAGE_OVERRIDABLE,description:h(927,"Enable/disable showing nearest Quick Fix within a line when not currently on a diagnostic."),default:!0}}});Ge.as(qs.Configuration).registerConfiguration({...Nv,properties:{"editor.codeActions.triggerOnFocusChange":{type:"boolean",scope:Bt.LANGUAGE_OVERRIDABLE,markdownDescription:h(928,"Enable triggering {0} when {1} is set to {2}. Code Actions must be set to {3} to be triggered for window and focus changes.","`#editor.codeActionsOnSave#`","`#files.autoSave#`","`afterDelay`","`always`"),default:!1}}});const D2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(D2e);class k2e{constructor(e,t,i){this.afterColumn=dc.MAX_SAFE_SMALL_INTEGER,this.afterLineNumber=e,this.heightInPx=t,this._onHeight=i,this.suppressMouseDown=!0,this.domNode=document.createElement("div")}onComputedHeight(e){this._lastHeight===void 0?this._lastHeight=e:this._lastHeight!==e&&(this._lastHeight=e,this._onHeight())}isVisible(){return this._lastHeight!==0&&this.domNode.hasAttribute("monaco-visible-view-zone")}}class rM{static{this._idPool=0}constructor(e,t){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=e,this._id=`codelens.widget-${rM._idPool++}`,this.updatePosition(t),this._domNode=document.createElement("span"),this._domNode.className="codelens-decoration"}withCommands(e,t){this._commands.clear();const i=[];let n=!1;for(let o=0;o<e.length;o++){const r=e[o];if(r&&(n=!0,r.command)){const a=Lv(r.command.title.trim());if(r.command.id){const c=`c${rM._idPool++}`;i.push(Y("a",{id:c,title:r.command.tooltip,role:"button"},...a)),this._commands.set(c,r.command)}else i.push(Y("span",{title:r.command.tooltip},...a));o+1<e.length&&i.push(Y("span",void 0," | "))}}n?(ig(this._domNode,...i),this._isEmpty&&t&&this._domNode.classList.add("fadein"),this._isEmpty=!1):ig(this._domNode,Y("span",void 0,"no commands"))}getCommand(e){return e.parentElement===this._domNode?this._commands.get(e.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(e){const t=this._editor.getModel().getLineFirstNonWhitespaceColumn(e);this._widgetPosition={position:{lineNumber:e,column:t},preference:[Oi.ABOVE]}}getPosition(){return this._widgetPosition||null}}class aF{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(e,t){this._addDecorations.push(e),this._addDecorationsCallbacks.push(t)}removeDecoration(e){this._removeDecorations.push(e)}commit(e){const t=e.deltaDecorations(this._removeDecorations,this._addDecorations);for(let i=0,n=t.length;i<n;i++)this._addDecorationsCallbacks[i](t[i])}}const Lte=Yt.register({collapseOnReplaceEdit:!0,description:"codelens"});class Mte{constructor(e,t,i,n,o,r){this._isDisposed=!1,this._editor=t,this._data=e,this._decorationIds=[];let a;const c=[];this._data.forEach((d,l)=>{d.symbol.command&&c.push(d.symbol),i.addDecoration({range:d.symbol.range,options:Lte},u=>this._decorationIds[l]=u),a?a=P.plusRange(a,d.symbol.range):a=P.lift(d.symbol.range)}),this._viewZone=new k2e(a.startLineNumber-1,o,r),this._viewZoneId=n.addZone(this._viewZone),c.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(c,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new rM(this._editor,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(e,t){this._decorationIds.forEach(e.removeDecoration,e),this._decorationIds=[],t?.removeZone(this._viewZoneId),this._contentWidget&&(this._editor.removeContentWidget(this._contentWidget),this._contentWidget=void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some((e,t)=>{const i=this._editor.getModel().getDecorationRange(e),n=this._data[t].symbol;return!!(i&&P.isEmpty(n.range)===i.isEmpty())})}updateCodeLensSymbols(e,t){this._decorationIds.forEach(t.removeDecoration,t),this._decorationIds=[],this._data=e,this._data.forEach((i,n)=>{t.addDecoration({range:i.symbol.range,options:Lte},o=>this._decorationIds[n]=o)})}updateHeight(e,t){this._viewZone.heightInPx=e,t.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(e){if(!this._viewZone.isVisible())return null;for(let t=0;t<this._decorationIds.length;t++){const i=e.getDecorationRange(this._decorationIds[t]);i&&(this._data[t].symbol.range=i)}return this._data}updateCommands(e){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(e,!0);for(let t=0;t<this._data.length;t++){const i=e[t];if(i){const{symbol:n}=this._data[t];n.command=i.command||n.command}}}getCommand(e){return this._contentWidget?.getCommand(e)}getLineNumber(){const e=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return e?e.startLineNumber:-1}update(e){if(this.isValid()){const t=this._editor.getModel().getDecorationRange(this._decorationIds[0]);t&&(this._viewZone.afterLineNumber=t.startLineNumber-1,e.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(t.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}getItems(){return this._data}}let Hx=class{static{this.ID="css.editor.codeLens"}constructor(e,t,i,n,o,r){this._editor=e,this._languageFeaturesService=t,this._commandService=n,this._notificationService=o,this._codeLensCache=r,this._disposables=new U,this._localToDispose=new U,this._lenses=[],this._oldCodeLensModels=new U,this._provideCodeLensDebounce=i.for(t.codeLensProvider,"CodeLensProvide",{min:250}),this._resolveCodeLensesDebounce=i.for(t.codeLensProvider,"CodeLensResolve",{min:250,salt:"resolve"}),this._resolveCodeLensesScheduler=new fn(()=>this._resolveCodeLensesInViewport(),this._resolveCodeLensesDebounce.default()),this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeConfiguration(a=>{(a.hasChanged(L.fontInfo)||a.hasChanged(L.codeLensFontSize)||a.hasChanged(L.codeLensFontFamily))&&this._updateLensStyle(),a.hasChanged(L.codeLens)&&this._onModelChange()})),this._disposables.add(t.codeLensProvider.onDidChange(this._onModelChange,this)),this._onModelChange(),this._updateLensStyle()}dispose(){this._localDispose(),this._localToDispose.dispose(),this._disposables.dispose(),this._oldCodeLensModels.dispose(),this._currentCodeLensModel?.dispose()}_getLayoutInfo(){const e=Math.max(1.3,this._editor.getOption(L.lineHeight)/this._editor.getOption(L.fontSize));let t=this._editor.getOption(L.codeLensFontSize);return(!t||t<5)&&(t=this._editor.getOption(L.fontSize)*.9|0),{fontSize:t,codeLensHeight:t*e|0}}_updateLensStyle(){const{codeLensHeight:e,fontSize:t}=this._getLayoutInfo(),i=this._editor.getOption(L.codeLensFontFamily),n=this._editor.getOption(L.fontInfo),{style:o}=this._editor.getContainerDomNode();o.setProperty("--vscode-editorCodeLens-lineHeight",`${e}px`),o.setProperty("--vscode-editorCodeLens-fontSize",`${t}px`),o.setProperty("--vscode-editorCodeLens-fontFeatureSettings",n.fontFeatureSettings),i&&(o.setProperty("--vscode-editorCodeLens-fontFamily",i),o.setProperty("--vscode-editorCodeLens-fontFamilyDefault",BM.fontFamily)),this._editor.changeViewZones(r=>{for(const a of this._lenses)a.updateHeight(e,r)})}_localDispose(){this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=void 0,this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0,this._localToDispose.clear(),this._oldCodeLensModels.clear(),this._currentCodeLensModel?.dispose()}_onModelChange(){this._localDispose();const e=this._editor.getModel();if(!e||!this._editor.getOption(L.codeLens)||e.isTooLargeForTokenization())return;const t=this._codeLensCache.get(e);if(t&&this._renderCodeLensSymbols(t),!this._languageFeaturesService.codeLensProvider.has(e)){t&&Hm(()=>{const n=this._codeLensCache.get(e);t===n&&(this._codeLensCache.delete(e),this._onModelChange())},30*1e3,this._localToDispose);return}for(const n of this._languageFeaturesService.codeLensProvider.all(e))if(typeof n.onDidChange=="function"){const o=n.onDidChange(()=>i.schedule());this._localToDispose.add(o)}const i=new fn(()=>{const n=Date.now();this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=En(o=>Qre(this._languageFeaturesService.codeLensProvider,e,o)),this._getCodeLensModelPromise.then(o=>{this._currentCodeLensModel&&this._oldCodeLensModels.add(this._currentCodeLensModel),this._currentCodeLensModel=o,this._codeLensCache.put(e,o);const r=this._provideCodeLensDebounce.update(e,Date.now()-n);i.delay=r,this._renderCodeLensSymbols(o),this._resolveCodeLensesInViewportSoon()},mt)},this._provideCodeLensDebounce.get(e));this._localToDispose.add(i),this._localToDispose.add(Ee(()=>this._resolveCodeLensesScheduler.cancel())),this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._editor.changeDecorations(n=>{this._editor.changeViewZones(o=>{const r=[];let a=-1;this._lenses.forEach(d=>{!d.isValid()||a===d.getLineNumber()?r.push(d):(d.update(o),a=d.getLineNumber())});const c=new aF;r.forEach(d=>{d.dispose(c,o),this._lenses.splice(this._lenses.indexOf(d),1)}),c.commit(n)})}),i.schedule(),this._resolveCodeLensesScheduler.cancel(),this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0})),this._localToDispose.add(this._editor.onDidFocusEditorText(()=>{i.schedule()})),this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{i.cancel()})),this._localToDispose.add(this._editor.onDidScrollChange(n=>{n.scrollTopChanged&&this._lenses.length>0&&this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(this._editor.onDidLayoutChange(()=>{this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(Ee(()=>{if(this._editor.getModel()){const n=cy.capture(this._editor);this._editor.changeDecorations(o=>{this._editor.changeViewZones(r=>{this._disposeAllLenses(o,r)})}),n.restore(this._editor)}else this._disposeAllLenses(void 0,void 0)})),this._localToDispose.add(this._editor.onMouseDown(n=>{if(n.target.type!==Ei.CONTENT_WIDGET)return;let o=n.target.element;if(o?.tagName==="SPAN"&&(o=o.parentElement),o?.tagName==="A")for(const r of this._lenses){const a=r.getCommand(o);if(a){this._commandService.executeCommand(a.id,...a.arguments||[]).catch(c=>this._notificationService.error(c));break}}})),i.schedule()}_disposeAllLenses(e,t){const i=new aF;for(const n of this._lenses)n.dispose(i,t);e&&i.commit(e),this._lenses.length=0}_renderCodeLensSymbols(e){if(!this._editor.hasModel())return;const t=this._editor.getModel().getLineCount(),i=[];let n;for(const a of e.lenses){const c=a.symbol.range.startLineNumber;c<1||c>t||(n&&n[n.length-1].symbol.range.startLineNumber===c?n.push(a):(n=[a],i.push(n)))}if(!i.length&&!this._lenses.length)return;const o=cy.capture(this._editor),r=this._getLayoutInfo();this._editor.changeDecorations(a=>{this._editor.changeViewZones(c=>{const d=new aF;let l=0,u=0;for(;u<i.length&&l<this._lenses.length;){const g=i[u][0].symbol.range.startLineNumber,m=this._lenses[l].getLineNumber();m<g?(this._lenses[l].dispose(d,c),this._lenses.splice(l,1)):m===g?(this._lenses[l].updateCodeLensSymbols(i[u],d),u++,l++):(this._lenses.splice(l,0,new Mte(i[u],this._editor,d,c,r.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),l++,u++)}for(;l<this._lenses.length;)this._lenses[l].dispose(d,c),this._lenses.splice(l,1);for(;u<i.length;)this._lenses.push(new Mte(i[u],this._editor,d,c,r.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),u++;d.commit(a)})}),o.restore(this._editor)}_resolveCodeLensesInViewportSoon(){this._editor.getModel()&&this._resolveCodeLensesScheduler.schedule()}_resolveCodeLensesInViewport(){this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0;const e=this._editor.getModel();if(!e)return;const t=[],i=[];if(this._lenses.forEach(r=>{const a=r.computeIfNecessary(e);a&&(t.push(a),i.push(r))}),t.length===0)return;const n=Date.now(),o=En(r=>{const a=t.map((c,d)=>{const l=new Array(c.length),u=c.map((g,m)=>!g.symbol.command&&typeof g.provider.resolveCodeLens=="function"?Promise.resolve(g.provider.resolveCodeLens(e,g.symbol,r)).then(v=>{l[m]=v},kn):(l[m]=g.symbol,Promise.resolve(void 0)));return Promise.all(u).then(()=>{!r.isCancellationRequested&&!i[d].isDisposed()&&i[d].updateCommands(l)})});return Promise.all(a)});this._resolveCodeLensesPromise=o,this._resolveCodeLensesPromise.then(()=>{const r=this._resolveCodeLensesDebounce.update(e,Date.now()-n);this._resolveCodeLensesScheduler.delay=r,this._currentCodeLensModel&&this._codeLensCache.put(e,this._currentCodeLensModel),this._oldCodeLensModels.clear(),o===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)},r=>{mt(r),o===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)})}async getModel(){return await this._getCodeLensModelPromise,await this._resolveCodeLensesPromise,this._currentCodeLensModel?.isDisposed?void 0:this._currentCodeLensModel}};Hx=f([p(1,Ne),p(2,Sd),p(3,qe),p(4,At),p(5,zre)],Hx);Rt(Hx.ID,Hx,vt.AfterFirstRender);ue(class extends we{constructor(){super({id:"codelens.showLensesInCurrentLine",precondition:V.hasCodeLensProvider,label:I(949,"Show CodeLens Commands for Current Line")})}async run(e,t){if(!t.hasModel())return;const i=e.get(zt),n=e.get(qe),o=e.get(At),r=t.getSelection().positionLineNumber,a=t.getContribution(Hx.ID);if(!a)return;const c=await a.getModel();if(!c)return;const d=[];for(const g of c.lenses)g.symbol.command&&g.symbol.range.startLineNumber===r&&d.push({label:g.symbol.command.title,command:g.symbol.command});if(d.length===0)return;const l=await i.pick(d,{canPickMany:!1,placeHolder:h(950,"Select a command")});if(!l)return;let u=l.command;if(c.isDisposed){const m=(await a.getModel())?.lenses.find(v=>v.symbol.range.startLineNumber===r&&v.symbol.command?.title===u.title);if(!m||!m.symbol.command)return;u=m.symbol.command}try{await n.executeCommand(u.id,...u.arguments||[])}catch(g){o.error(g)}}});class Nte extends F{static{this.ID="editor.contrib.colorContribution"}static{this.RECOMPUTE_TIME=1e3}constructor(e){super(),this._editor=e,this._register(e.onMouseDown(t=>this.onMouseDown(t)))}dispose(){super.dispose()}onMouseDown(e){const t=this._editor.getOption(L.colorDecoratorsActivatedOn);if(t!=="click"&&t!=="clickAndHover"||!Rde(e))return;const i=this._editor.getContribution(ps.ID);if(!i||i.isColorPickerVisible)return;const n=e.target.range;if(!n)return;const o=new P(n.startLineNumber,n.startColumn+1,n.endLineNumber,n.endColumn+1);i.showContentHover(o,Rh.Immediate,ll.Click,!1)}}class h5{constructor(e,t,i,n){this.owner=e,this.range=t,this.model=i,this.provider=n}static fromBaseColor(e,t){return new h5(e,t.range,t.model,t.provider)}}class T2e extends F{constructor(e,t,i,n){super();const o=e.getModel(),r=i.model;this.color=i.model.color,this.colorPicker=this._register(new EO(t.fragment,r,e.getOption(L.pixelRatio),n,uv.Standalone)),this._register(r.onColorFlushed(a=>{this.color=a})),this._register(r.onDidChangeColor(a=>{gx(o,r,a,i.range,i)})),this._register(e.onDidChangeModelContent(a=>{t.hide(),e.focus()})),gx(o,r,this.color,i.range,i)}}let Z3=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}async createColorHover(e,t,i){if(!this._editor.hasModel()||!Vy.get(this._editor))return null;const o=await Ede(i,this._editor.getModel(),ye.None);let r=null,a=null;for(const g of o){const m=g.colorInfo;P.containsRange(m.range,e.range)&&(r=m,a=g.provider)}const c=r??e,d=a??t,l=!!r;return{colorHover:h5.fromBaseColor(this,await kde(this._editor.getModel(),c,d)),foundInEditor:l}}async updateEditorModel(e){if(!this._editor.hasModel())return;const t=e.model;let i=new P(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn);this._color&&(await gx(this._editor.getModel(),t,this._color,i,e),i=Tde(this._editor,i,t))}renderHoverParts(e,t){if(!(t.length===0||!this._editor.hasModel()))return this._setMinimumDimensions(e),this._renderedParts=new T2e(this._editor,e,t[0],this._themeService),this._renderedParts}_setMinimumDimensions(e){const t=this._editor.getOption(L.lineHeight)+8;e.setMinimumDimensions(new Ke(302,t))}get _color(){return this._renderedParts?.color}};Z3=f([p(1,ft)],Z3);var J3;Be(Ef);class A2e{constructor(e,t){this.value=e,this.foundInEditor=t}}const Ote=8,R2e=22;let eG=class extends F{static{J3=this}static{this.ID="editor.contrib.standaloneColorPickerWidget"}constructor(e,t,i,n,o,r,a,c){super(),this._editor=e,this._standaloneColorPickerVisible=t,this._standaloneColorPickerFocused=i,this._keybindingService=o,this._languageFeaturesService=r,this._editorWorkerService=a,this._hoverService=c,this.allowEditorOverflow=!0,this._position=void 0,this._body=document.createElement("div"),this._colorHover=null,this._selectionSetInEditor=!1,this._onResult=this._register(new M),this.onResult=this._onResult.event,this._renderedHoverParts=this._register(new kt),this._renderedStatusBar=this._register(new kt),this._standaloneColorPickerVisible.set(!0),this._standaloneColorPickerParticipant=n.createInstance(Z3,this._editor),this._position=this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;const d=this._editor.getSelection(),l=d?{startLineNumber:d.startLineNumber,startColumn:d.startColumn,endLineNumber:d.endLineNumber,endColumn:d.endColumn}:{startLineNumber:0,endLineNumber:0,endColumn:0,startColumn:0},u=this._register(Po(this._body));this._register(u.onDidBlur(g=>{this.hide()})),this._register(u.onDidFocus(g=>{this.focus()})),this._register(this._editor.onDidChangeCursorPosition(()=>{this._selectionSetInEditor?this._selectionSetInEditor=!1:this.hide()})),this._register(this._editor.onMouseMove(g=>{const m=g.target.element?.classList;m&&m.contains("colorpicker-color-decoration")&&this.hide()})),this._register(this.onResult(g=>{this._render(g.value,g.foundInEditor)})),this._start(l),this._body.style.zIndex="50",this._editor.addContentWidget(this)}updateEditor(){this._colorHover&&this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover)}getId(){return J3.ID}getDomNode(){return this._body}getPosition(){if(!this._position)return null;const e=this._editor.getOption(L.hover).above;return{position:this._position,secondaryPosition:this._position,preference:e?[Oi.ABOVE,Oi.BELOW]:[Oi.BELOW,Oi.ABOVE],positionAffinity:Jx.None}}hide(){this.dispose(),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerFocused.set(!1),this._editor.removeContentWidget(this),this._editor.focus()}focus(){this._standaloneColorPickerFocused.set(!0),this._body.focus()}async _start(e){const t=await this._computeAsync(e);t&&this._onResult.fire(new A2e(t.result,t.foundInEditor))}async _computeAsync(e){if(!this._editor.hasModel())return null;const t={range:e,color:{red:0,green:0,blue:0,alpha:1}},i=await this._standaloneColorPickerParticipant.createColorHover(t,new ux(this._editorWorkerService),this._languageFeaturesService.colorProvider);return i?{result:i.colorHover,foundInEditor:i.foundInEditor}:null}_render(e,t){const i=document.createDocumentFragment();this._renderedStatusBar.value=this._register(new GR(this._keybindingService,this._hoverService));const n={fragment:i,statusBar:this._renderedStatusBar.value,onContentsChanged:()=>{},setMinimumDimensions:()=>{},hide:()=>this.hide(),focus:()=>this.focus()};if(this._colorHover=e,this._renderedHoverParts.value=this._standaloneColorPickerParticipant.renderHoverParts(n,[e]),!this._renderedHoverParts.value){this._renderedStatusBar.clear(),this._renderedHoverParts.clear();return}const o=this._renderedHoverParts.value.colorPicker;this._body.classList.add("standalone-colorpicker-body"),this._body.style.maxHeight=Math.max(this._editor.getLayoutInfo().height/4,250)+"px",this._body.style.maxWidth=Math.max(this._editor.getLayoutInfo().width*.66,500)+"px",this._body.tabIndex=0,this._body.appendChild(i),o.layout();const r=o.body,a=r.saturationBox.domNode.clientWidth,c=r.domNode.clientWidth-a-R2e-Ote,d=o.body.enterButton;d?.onClicked(()=>{this.updateEditor(),this.hide()});const l=o.header,u=l.pickedColorNode;u.style.width=a+Ote+"px";const g=l.originalColorNode;g.style.width=c+"px",o.header.closeButton?.onClicked(()=>{this.hide()}),t&&(d&&(d.button.textContent="Replace"),this._selectionSetInEditor=!0,this._editor.setSelection(e.range)),this._editor.layoutContentWidget(this)}};eG=J3=f([p(3,J),p(4,Ve),p(5,Ne),p(6,vc),p(7,wi)],eG);var tG;let Sv=class extends F{static{tG=this}static{this.ID="editor.contrib.standaloneColorPickerController"}constructor(e,t,i){super(),this._editor=e,this._instantiationService=i,this._standaloneColorPickerWidget=null,this._standaloneColorPickerVisible=V.standaloneColorPickerVisible.bindTo(t),this._standaloneColorPickerFocused=V.standaloneColorPickerFocused.bindTo(t)}showOrFocus(){this._editor.hasModel()&&(this._standaloneColorPickerVisible.get()?this._standaloneColorPickerFocused.get()||this._standaloneColorPickerWidget?.focus():this._standaloneColorPickerWidget=this._instantiationService.createInstance(eG,this._editor,this._standaloneColorPickerVisible,this._standaloneColorPickerFocused))}hide(){this._standaloneColorPickerFocused.set(!1),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerWidget?.hide(),this._editor.focus()}insertColor(){this._standaloneColorPickerWidget?.updateEditor(),this.hide()}static get(e){return e.getContribution(tG.ID)}};Sv=tG=f([p(1,me),p(2,J)],Sv);class P2e extends Rr{constructor(){super({id:"editor.action.showOrFocusStandaloneColorPicker",title:{...I(954,"Show or Focus Standalone Color Picker"),mnemonicTitle:h(955,"&&Show or Focus Standalone Color Picker")},precondition:void 0,menu:[{id:N.CommandPalette}],metadata:{description:I(956,"Show or focus a standalone color picker which uses the default color provider. It displays hex/rgb/hsl colors.")}})}runEditorCommand(e,t){Sv.get(t)?.showOrFocus()}}class L2e extends we{constructor(){super({id:"editor.action.hideColorPicker",label:I(957,"Hide the Color Picker"),precondition:V.standaloneColorPickerVisible.isEqualTo(!0),kbOpts:{primary:S.Escape,weight:W.EditorContrib},metadata:{description:I(958,"Hide the standalone color picker.")}})}run(e,t){Sv.get(t)?.hide()}}class M2e extends we{constructor(){super({id:"editor.action.insertColorWithStandaloneColorPicker",label:I(959,"Insert Color with Standalone Color Picker"),precondition:V.standaloneColorPickerFocused.isEqualTo(!0),kbOpts:{primary:S.Enter,weight:W.EditorContrib},metadata:{description:I(960,"Insert hex/rgb/hsl colors with the focused standalone color picker.")}})}run(e,t){Sv.get(t)?.insertColor()}}ue(L2e);ue(M2e);K(P2e);Rt(Nte.ID,Nte,vt.BeforeFirstInteraction);Rt(Sv.ID,Sv,vt.AfterFirstRender);Rt(Vy.ID,Vy,vt.AfterFirstRender);cS(eH);s_.register(zR);Ce.registerCommand("_executeDocumentColorProvider",function(s,...e){const[t]=e;if(!(t instanceof R))throw Mt();const{model:i,colorProviderRegistry:n,defaultColorDecoratorsEnablement:o}=Ide(s,t);return $K(new QPe,n,i,ye.None,o)});Ce.registerCommand("_executeColorPresentationProvider",function(s,...e){const[t,i]=e,{uri:n,range:o}=i;if(!(n instanceof R)||!Array.isArray(t)||t.length!==4||!P.isIRange(o))throw Mt();const{model:r,colorProviderRegistry:a,defaultColorDecoratorsEnablement:c}=Ide(s,n),[d,l,u,g]=t;return $K(new XPe({range:o,color:{red:d,green:l,blue:u,alpha:g}}),a,r,ye.None,c)});class mp{constructor(e,t,i){this.languageConfigurationService=i,this._selection=e,this._insertSpace=t,this._usedEndToken=null}static _haystackHasNeedleAtOffset(e,t,i){if(i<0)return!1;const n=t.length,o=e.length;if(i+n>o)return!1;for(let r=0;r<n;r++){const a=e.charCodeAt(i+r),c=t.charCodeAt(r);if(a!==c&&!(a>=st.A&&a<=st.Z&&a+32===c)&&!(c>=st.A&&c<=st.Z&&c+32===a))return!1}return!0}_createOperationsForBlockComment(e,t,i,n,o,r){const a=e.startLineNumber,c=e.startColumn,d=e.endLineNumber,l=e.endColumn,u=o.getLineContent(a),g=o.getLineContent(d);let m=u.lastIndexOf(t,c-1+t.length),v=g.indexOf(i,l-1-i.length);if(m!==-1&&v!==-1)if(a===d)u.substring(m+t.length,v).indexOf(i)>=0&&(m=-1,v=-1);else{const w=u.substring(m+t.length),C=g.substring(0,v);(w.indexOf(i)>=0||C.indexOf(i)>=0)&&(m=-1,v=-1)}let y;m!==-1&&v!==-1?(n&&m+t.length<u.length&&u.charCodeAt(m+t.length)===st.Space&&(t=t+" "),n&&v>0&&g.charCodeAt(v-1)===st.Space&&(i=" "+i,v-=1),y=mp._createRemoveBlockCommentOperations(new P(a,m+t.length+1,d,v+1),t,i)):(y=mp._createAddBlockCommentOperations(e,t,i,this._insertSpace),this._usedEndToken=y.length===1?i:null);for(const w of y)r.addTrackedEditOperation(w.range,w.text)}static _createRemoveBlockCommentOperations(e,t,i){const n=[];return P.isEmpty(e)?n.push(Ki.delete(new P(e.startLineNumber,e.startColumn-t.length,e.endLineNumber,e.endColumn+i.length))):(n.push(Ki.delete(new P(e.startLineNumber,e.startColumn-t.length,e.startLineNumber,e.startColumn))),n.push(Ki.delete(new P(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn+i.length)))),n}static _createAddBlockCommentOperations(e,t,i,n){const o=[];return P.isEmpty(e)?o.push(Ki.replace(new P(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),t+"  "+i)):(o.push(Ki.insert(new _e(e.startLineNumber,e.startColumn),t+(n?" ":""))),o.push(Ki.insert(new _e(e.endLineNumber,e.endColumn),(n?" ":"")+i))),o}getEditOperations(e,t){const i=this._selection.startLineNumber,n=this._selection.startColumn;e.tokenization.tokenizeIfCheap(i);const o=e.getLanguageIdAtPosition(i,n),r=this.languageConfigurationService.getLanguageConfiguration(o).comments;!r||!r.blockCommentStartToken||!r.blockCommentEndToken||this._createOperationsForBlockComment(this._selection,r.blockCommentStartToken,r.blockCommentEndToken,this._insertSpace,e,t)}computeCursorState(e,t){const i=t.getInverseEditOperations();if(i.length===2){const n=i[0],o=i[1];return new at(n.range.endLineNumber,n.range.endColumn,o.range.startLineNumber,o.range.startColumn)}else{const n=i[0].range,o=this._usedEndToken?-this._usedEndToken.length-1:0;return new at(n.endLineNumber,n.endColumn+o,n.endLineNumber,n.endColumn+o)}}}var ah;(function(s){s[s.Toggle=0]="Toggle",s[s.ForceAdd=1]="ForceAdd",s[s.ForceRemove=2]="ForceRemove"})(ah||(ah={}));class pu{constructor(e,t,i,n,o,r,a){this.languageConfigurationService=e,this._selection=t,this._indentSize=i,this._type=n,this._insertSpace=o,this._selectionId=null,this._deltaColumn=0,this._moveEndPositionDown=!1,this._ignoreEmptyLines=r,this._ignoreFirstLine=a||!1}static _gatherPreflightCommentStrings(e,t,i,n){e.tokenization.tokenizeIfCheap(t);const o=e.getLanguageIdAtPosition(t,1),r=n.getLanguageConfiguration(o).comments,a=r?r.lineCommentToken:null;if(!a)return null;const c=[];for(let d=0,l=i-t+1;d<l;d++)c[d]={ignore:!1,commentStr:a,commentStrOffset:0,commentStrLength:a.length};return c}static _analyzeLines(e,t,i,n,o,r,a,c){let d=!0,l;e===ah.Toggle?l=!0:e===ah.ForceAdd?l=!1:l=!0;for(let u=0,g=n.length;u<g;u++){const m=n[u],v=o+u;if(v===o&&a){m.ignore=!0;continue}const y=i.getLineContent(v),w=HF(y);if(w===-1){m.ignore=r,m.commentStrOffset=y.length;continue}if(d=!1,m.ignore=!1,m.commentStrOffset=w,l&&!mp._haystackHasNeedleAtOffset(y,m.commentStr,w)&&(e===ah.Toggle?l=!1:e===ah.ForceAdd||(m.ignore=!0)),l&&t){const C=w+m.commentStrLength;C<y.length&&y.charCodeAt(C)===st.Space&&(m.commentStrLength+=1)}}if(e===ah.Toggle&&d){l=!1;for(let u=0,g=n.length;u<g;u++)n[u].ignore=!1}return{supported:!0,shouldRemoveComments:l,lines:n}}static _gatherPreflightData(e,t,i,n,o,r,a,c){const d=pu._gatherPreflightCommentStrings(i,n,o,c);return d===null?{supported:!1}:pu._analyzeLines(e,t,i,d,n,r,a,c)}_executeLineComments(e,t,i,n){let o;i.shouldRemoveComments?o=pu._createRemoveLineCommentsOperations(i.lines,n.startLineNumber):(pu._normalizeInsertionPoint(e,i.lines,n.startLineNumber,this._indentSize),o=this._createAddLineCommentsOperations(i.lines,n.startLineNumber));const r=new _e(n.positionLineNumber,n.positionColumn);for(let a=0,c=o.length;a<c;a++)t.addEditOperation(o[a].range,o[a].text),P.isEmpty(o[a].range)&&P.getStartPosition(o[a].range).equals(r)&&e.getLineContent(r.lineNumber).length+1===r.column&&(this._deltaColumn=(o[a].text||"").length);this._selectionId=t.trackSelection(n)}_attemptRemoveBlockComment(e,t,i,n){let o=t.startLineNumber,r=t.endLineNumber;const a=n.length+Math.max(e.getLineFirstNonWhitespaceColumn(t.startLineNumber),t.startColumn);let c=e.getLineContent(o).lastIndexOf(i,a-1),d=e.getLineContent(r).indexOf(n,t.endColumn-1-i.length);return c!==-1&&d===-1&&(d=e.getLineContent(o).indexOf(n,c+i.length),r=o),c===-1&&d!==-1&&(c=e.getLineContent(r).lastIndexOf(i,d),o=r),t.isEmpty()&&(c===-1||d===-1)&&(c=e.getLineContent(o).indexOf(i),c!==-1&&(d=e.getLineContent(o).indexOf(n,c+i.length))),c!==-1&&e.getLineContent(o).charCodeAt(c+i.length)===st.Space&&(i+=" "),d!==-1&&e.getLineContent(r).charCodeAt(d-1)===st.Space&&(n=" "+n,d-=1),c!==-1&&d!==-1?mp._createRemoveBlockCommentOperations(new P(o,c+i.length+1,r,d+1),i,n):null}_executeBlockComment(e,t,i){e.tokenization.tokenizeIfCheap(i.startLineNumber);const n=e.getLanguageIdAtPosition(i.startLineNumber,1),o=this.languageConfigurationService.getLanguageConfiguration(n).comments;if(!o||!o.blockCommentStartToken||!o.blockCommentEndToken)return;const r=o.blockCommentStartToken,a=o.blockCommentEndToken;let c=this._attemptRemoveBlockComment(e,i,r,a);if(!c){if(i.isEmpty()){const d=e.getLineContent(i.startLineNumber);let l=HF(d);l===-1&&(l=d.length),c=mp._createAddBlockCommentOperations(new P(i.startLineNumber,l+1,i.startLineNumber,d.length+1),r,a,this._insertSpace)}else c=mp._createAddBlockCommentOperations(new P(i.startLineNumber,e.getLineFirstNonWhitespaceColumn(i.startLineNumber),i.endLineNumber,e.getLineMaxColumn(i.endLineNumber)),r,a,this._insertSpace);c.length===1&&(this._deltaColumn=r.length+1)}this._selectionId=t.trackSelection(i);for(const d of c)t.addEditOperation(d.range,d.text)}getEditOperations(e,t){let i=this._selection;if(this._moveEndPositionDown=!1,i.startLineNumber===i.endLineNumber&&this._ignoreFirstLine){t.addEditOperation(new P(i.startLineNumber,e.getLineMaxColumn(i.startLineNumber),i.startLineNumber+1,1),i.startLineNumber===e.getLineCount()?"":`
`),this._selectionId=t.trackSelection(i);return}i.startLineNumber<i.endLineNumber&&i.endColumn===1&&(this._moveEndPositionDown=!0,i=i.setEndPosition(i.endLineNumber-1,e.getLineMaxColumn(i.endLineNumber-1)));const n=pu._gatherPreflightData(this._type,this._insertSpace,e,i.startLineNumber,i.endLineNumber,this._ignoreEmptyLines,this._ignoreFirstLine,this.languageConfigurationService);return n.supported?this._executeLineComments(e,t,n,i):this._executeBlockComment(e,t,i)}computeCursorState(e,t){let i=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(i=i.setEndPosition(i.endLineNumber+1,1)),new at(i.selectionStartLineNumber,i.selectionStartColumn+this._deltaColumn,i.positionLineNumber,i.positionColumn+this._deltaColumn)}static _createRemoveLineCommentsOperations(e,t){const i=[];for(let n=0,o=e.length;n<o;n++){const r=e[n];r.ignore||i.push(Ki.delete(new P(t+n,r.commentStrOffset+1,t+n,r.commentStrOffset+r.commentStrLength+1)))}return i}_createAddLineCommentsOperations(e,t){const i=[],n=this._insertSpace?" ":"";for(let o=0,r=e.length;o<r;o++){const a=e[o];a.ignore||i.push(Ki.insert(new _e(t+o,a.commentStrOffset+1),a.commentStr+n))}return i}static nextVisibleColumn(e,t,i,n){return i?e+(t-e%t):e+n}static _normalizeInsertionPoint(e,t,i,n){let o=dc.MAX_SAFE_SMALL_INTEGER,r,a;for(let c=0,d=t.length;c<d;c++){if(t[c].ignore)continue;const l=e.getLineContent(i+c);let u=0;for(let g=0,m=t[c].commentStrOffset;u<o&&g<m;g++)u=pu.nextVisibleColumn(u,n,l.charCodeAt(g)===st.Tab,1);u<o&&(o=u)}o=Math.floor(o/n)*n;for(let c=0,d=t.length;c<d;c++){if(t[c].ignore)continue;const l=e.getLineContent(i+c);let u=0;for(r=0,a=t[c].commentStrOffset;u<o&&r<a;r++)u=pu.nextVisibleColumn(u,n,l.charCodeAt(r)===st.Tab,1);u>o?t[c].commentStrOffset=r-1:t[c].commentStrOffset=r}}}class u5 extends we{constructor(e,t){super(t),this._type=e}run(e,t){const i=e.get(rs);if(!t.hasModel())return;const n=t.getModel(),o=[],r=n.getOptions(),a=t.getOption(L.comments),c=t.getSelections().map((l,u)=>({selection:l,index:u,ignoreFirstLine:!1}));c.sort((l,u)=>P.compareRangesUsingStarts(l.selection,u.selection));let d=c[0];for(let l=1;l<c.length;l++){const u=c[l];d.selection.endLineNumber===u.selection.startLineNumber&&(d.index<u.index?u.ignoreFirstLine=!0:(d.ignoreFirstLine=!0,d=u))}for(const l of c)o.push(new pu(i,l.selection,r.indentSize,this._type,a.insertSpace,a.ignoreEmptyLines,l.ignoreFirstLine));t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class N2e extends u5{constructor(){super(ah.Toggle,{id:"editor.action.commentLine",label:I(961,"Toggle Line Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.Slash,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"5_insert",title:h(962,"&&Toggle Line Comment"),order:1}})}}class O2e extends u5{constructor(){super(ah.ForceAdd,{id:"editor.action.addCommentLine",label:I(963,"Add Line Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyC),weight:W.EditorContrib}})}}class F2e extends u5{constructor(){super(ah.ForceRemove,{id:"editor.action.removeCommentLine",label:I(964,"Remove Line Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyU),weight:W.EditorContrib}})}}class W2e extends we{constructor(){super({id:"editor.action.blockComment",label:I(965,"Toggle Block Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyA,linux:{primary:E.CtrlCmd|E.Shift|S.KeyA},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"5_insert",title:h(966,"Toggle &&Block Comment"),order:2}})}run(e,t){const i=e.get(rs);if(!t.hasModel())return;const n=t.getOption(L.comments),o=[],r=t.getSelections();for(const a of r)o.push(new mp(a,n.insertSpace,i));t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}ue(N2e);ue(O2e);ue(F2e);ue(W2e);class cF{constructor(e){this.selections=e}equals(e){const t=this.selections.length,i=e.selections.length;if(t!==i)return!1;for(let n=0;n<t;n++)if(!this.selections[n].equalsSelection(e.selections[n]))return!1;return!0}}class dF{constructor(e,t,i){this.cursorState=e,this.scrollTop=t,this.scrollLeft=i}}class Xy extends F{static{this.ID="editor.contrib.cursorUndoRedoController"}static get(e){return e.getContribution(Xy.ID)}constructor(e){super(),this._editor=e,this._isCursorUndoRedo=!1,this._undoStack=[],this._redoStack=[],this._register(e.onDidChangeModel(t=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeModelContent(t=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeCursorSelection(t=>{if(this._isCursorUndoRedo||!t.oldSelections||t.oldModelVersionId!==t.modelVersionId)return;const i=new cF(t.oldSelections);this._undoStack.length>0&&this._undoStack[this._undoStack.length-1].cursorState.equals(i)||(this._undoStack.push(new dF(i,e.getScrollTop(),e.getScrollLeft())),this._redoStack=[],this._undoStack.length>50&&this._undoStack.shift())}))}cursorUndo(){!this._editor.hasModel()||this._undoStack.length===0||(this._redoStack.push(new dF(new cF(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._undoStack.pop()))}cursorRedo(){!this._editor.hasModel()||this._redoStack.length===0||(this._undoStack.push(new dF(new cF(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._redoStack.pop()))}_applyState(e){this._isCursorUndoRedo=!0,this._editor.setSelections(e.cursorState.selections),this._editor.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this._isCursorUndoRedo=!1}}class B2e extends we{constructor(){super({id:"cursorUndo",label:I(977,"Cursor Undo"),precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.KeyU,weight:W.EditorContrib}})}run(e,t,i){Xy.get(t)?.cursorUndo()}}class V2e extends we{constructor(){super({id:"cursorRedo",label:I(978,"Cursor Redo"),precondition:void 0})}run(e,t,i){Xy.get(t)?.cursorRedo()}}Rt(Xy.ID,Xy,vt.Eager);ue(B2e);ue(V2e);const H2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class U2e{constructor(e,t,i){this.selection=e,this.targetPosition=t,this.copy=i,this.targetSelection=null}getEditOperations(e,t){const i=e.getValueInRange(this.selection);if(this.copy||t.addEditOperation(this.selection,null),t.addEditOperation(new P(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column),i),this.selection.containsPosition(this.targetPosition)&&!(this.copy&&(this.selection.getEndPosition().equals(this.targetPosition)||this.selection.getStartPosition().equals(this.targetPosition)))){this.targetSelection=this.selection;return}if(this.copy){this.targetSelection=new at(this.targetPosition.lineNumber,this.targetPosition.column,this.selection.endLineNumber-this.selection.startLineNumber+this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber>this.selection.endLineNumber){this.targetSelection=new at(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber<this.selection.endLineNumber){this.targetSelection=new at(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber+this.selection.endLineNumber-this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}this.selection.endColumn<=this.targetPosition.column?this.targetSelection=new at(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column-this.selection.endColumn+this.selection.startColumn:this.targetPosition.column-this.selection.endColumn+this.selection.startColumn,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column:this.selection.endColumn):this.targetSelection=new at(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column+this.selection.endColumn-this.selection.startColumn)}computeCursorState(e,t){return this.targetSelection}}Be(H2e);function E_(s){return qt?s.altKey:s.ctrlKey}class Sm extends F{static{this.ID="editor.contrib.dragAndDrop"}static{this.TRIGGER_KEY_VALUE=qt?S.Alt:S.Ctrl}static get(e){return e.getContribution(Sm.ID)}constructor(e){super(),this._editor=e,this._dndDecorationIds=this._editor.createDecorationsCollection(),this._register(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._register(this._editor.onMouseUp(t=>this._onEditorMouseUp(t))),this._register(this._editor.onMouseDrag(t=>this._onEditorMouseDrag(t))),this._register(this._editor.onMouseDrop(t=>this._onEditorMouseDrop(t))),this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled())),this._register(this._editor.onKeyDown(t=>this.onEditorKeyDown(t))),this._register(this._editor.onKeyUp(t=>this.onEditorKeyUp(t))),this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur())),this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur())),this._mouseDown=!1,this._modifierPressed=!1,this._dragSelection=null}onEditorBlur(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1}onEditorKeyDown(e){!this._editor.getOption(L.dragAndDrop)||this._editor.getOption(L.columnSelection)||(E_(e)&&(this._modifierPressed=!0),this._mouseDown&&E_(e)&&this._editor.updateOptions({mouseStyle:"copy"}))}onEditorKeyUp(e){!this._editor.getOption(L.dragAndDrop)||this._editor.getOption(L.columnSelection)||(E_(e)&&(this._modifierPressed=!1),this._mouseDown&&e.keyCode===Sm.TRIGGER_KEY_VALUE&&this._editor.updateOptions({mouseStyle:"default"}))}_onEditorMouseDown(e){this._mouseDown=!0}_onEditorMouseUp(e){this._mouseDown=!1,this._editor.updateOptions({mouseStyle:"text"})}_onEditorMouseDrag(e){const t=e.target;if(this._dragSelection===null){const n=(this._editor.getSelections()||[]).filter(o=>t.position&&o.containsPosition(t.position));if(n.length===1)this._dragSelection=n[0];else return}E_(e.event)?this._editor.updateOptions({mouseStyle:"copy"}):this._editor.updateOptions({mouseStyle:"default"}),t.position&&(this._dragSelection.containsPosition(t.position)?this._removeDecoration():this.showAt(t.position))}_onEditorMouseDropCanceled(){this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}_onEditorMouseDrop(e){if(e.target&&(this._hitContent(e.target)||this._hitMargin(e.target))&&e.target.position){const t=new _e(e.target.position.lineNumber,e.target.position.column);if(this._dragSelection===null){let i=null;if(e.event.shiftKey){const n=this._editor.getSelection();if(n){const{selectionStartLineNumber:o,selectionStartColumn:r}=n;i=[new at(o,r,t.lineNumber,t.column)]}}else i=(this._editor.getSelections()||[]).map(n=>n.containsPosition(t)?new at(t.lineNumber,t.column,t.lineNumber,t.column):n);this._editor.setSelections(i||[],"mouse",Ls.Explicit)}else(!this._dragSelection.containsPosition(t)||(E_(e.event)||this._modifierPressed)&&(this._dragSelection.getEndPosition().equals(t)||this._dragSelection.getStartPosition().equals(t)))&&(this._editor.pushUndoStop(),this._editor.executeCommand(Sm.ID,new U2e(this._dragSelection,t,E_(e.event)||this._modifierPressed)),this._editor.pushUndoStop())}this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}static{this._DECORATION_OPTIONS=Yt.register({description:"dnd-target",className:"dnd-target"})}showAt(e){this._dndDecorationIds.set([{range:new P(e.lineNumber,e.column,e.lineNumber,e.column),options:Sm._DECORATION_OPTIONS}]),this._editor.revealPosition(e,ji.Immediate)}_removeDecoration(){this._dndDecorationIds.clear()}_hitContent(e){return e.type===Ei.CONTENT_TEXT||e.type===Ei.CONTENT_EMPTY}_hitMargin(e){return e.type===Ei.GUTTER_GLYPH_MARGIN||e.type===Ei.GUTTER_LINE_NUMBERS||e.type===Ei.GUTTER_LINE_DECORATIONS}dispose(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1,super.dispose()}}Rt(Sm.ID,Sm,vt.BeforeFirstInteraction);const $2e="editor.action.pasteAs";Rt(md.ID,md,vt.Eager);cS(zV);Ue(new class extends No{constructor(){super({id:ude,precondition:BK,kbOpts:{weight:W.EditorContrib,primary:E.CtrlCmd|S.Period}})}runEditorCommand(s,e){return md.get(e)?.changePasteType()}});Ue(new class extends No{constructor(){super({id:"editor.hidePasteWidget",precondition:BK,kbOpts:{weight:W.EditorContrib,primary:S.Escape}})}runEditorCommand(s,e){md.get(e)?.clearWidgets()}});ue(class cpe extends we{static{this.argsSchema={oneOf:[{type:"object",required:["kind"],properties:{kind:{type:"string",description:h(979,`The kind of the paste edit to try pasting with.
If there are multiple edits for this kind, the editor will show a picker. If there are no edits of this kind, the editor will show an error message.`)}}},{type:"object",required:["preferences"],properties:{preferences:{type:"array",description:h(980,`List of preferred paste edit kind to try applying.
The first edit matching the preferences will be applied.`),items:{type:"string"}}}}]}}constructor(){super({id:$2e,label:I(981,"Paste As..."),precondition:V.writable,metadata:{description:"Paste as",args:[{name:"args",schema:cpe.argsSchema}]}})}run(e,t,i){let n;return i&&("kind"in i?n={only:new Zt(i.kind)}:"preferences"in i&&(n={preferences:i.preferences.map(o=>new Zt(o))})),md.get(t)?.pasteAs(n)}});ue(class extends we{constructor(){super({id:"editor.action.pasteAsText",label:I(982,"Paste as Text"),precondition:V.writable})}run(s,e){return md.get(e)?.pasteAs({providerId:lv.id})}});Rt(cg.ID,cg,vt.BeforeFirstInteraction);cS(qV);Ue(new class extends No{constructor(){super({id:gde,precondition:VK,kbOpts:{weight:W.EditorContrib,primary:E.CtrlCmd|S.Period}})}runEditorCommand(s,e,t){cg.get(e)?.changeDropType()}});Ue(new class extends No{constructor(){super({id:"editor.hideDropWidget",precondition:VK,kbOpts:{weight:W.EditorContrib,primary:S.Escape}})}runEditorCommand(s,e,t){cg.get(e)?.clearWidgets()}});class Nc{constructor(e){this._editor=e,this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null,this._startPosition=this._editor.getPosition()}dispose(){this._editor.removeDecorations(this._allDecorations()),this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}reset(){this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}getCount(){return this._decorations.length}getFindScope(){return this._findScopeDecorationIds[0]?this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]):null}getFindScopes(){if(this._findScopeDecorationIds.length){const e=this._findScopeDecorationIds.map(t=>this._editor.getModel().getDecorationRange(t)).filter(t=>!!t);if(e.length)return e}return null}getStartPosition(){return this._startPosition}setStartPosition(e){this._startPosition=e,this.setCurrentFindMatch(null)}_getDecorationIndex(e){const t=this._decorations.indexOf(e);return t>=0?t+1:1}getDecorationRangeAt(e){const t=e<this._decorations.length?this._decorations[e]:null;return t?this._editor.getModel().getDecorationRange(t):null}getCurrentMatchesPosition(e){const t=this._editor.getModel().getDecorationsInRange(e);for(const i of t){const n=i.options;if(n===Nc._FIND_MATCH_DECORATION||n===Nc._CURRENT_FIND_MATCH_DECORATION)return this._getDecorationIndex(i.id)}return 0}setCurrentFindMatch(e){let t=null,i=0;if(e)for(let n=0,o=this._decorations.length;n<o;n++){const r=this._editor.getModel().getDecorationRange(this._decorations[n]);if(e.equalsRange(r)){t=this._decorations[n],i=n+1;break}}return(this._highlightedDecorationId!==null||t!==null)&&this._editor.changeDecorations(n=>{if(this._highlightedDecorationId!==null&&(n.changeDecorationOptions(this._highlightedDecorationId,Nc._FIND_MATCH_DECORATION),this._highlightedDecorationId=null),t!==null&&(this._highlightedDecorationId=t,n.changeDecorationOptions(this._highlightedDecorationId,Nc._CURRENT_FIND_MATCH_DECORATION)),this._rangeHighlightDecorationId!==null&&(n.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),t!==null){let o=this._editor.getModel().getDecorationRange(t);if(o.startLineNumber!==o.endLineNumber&&o.endColumn===1){const r=o.endLineNumber-1,a=this._editor.getModel().getLineMaxColumn(r);o=new P(o.startLineNumber,o.startColumn,r,a)}this._rangeHighlightDecorationId=n.addDecoration(o,Nc._RANGE_HIGHLIGHT_DECORATION)}}),i}set(e,t){this._editor.changeDecorations(i=>{let n=Nc._FIND_MATCH_DECORATION;const o=[];if(e.length>1e3){n=Nc._FIND_MATCH_NO_OVERVIEW_DECORATION;const a=this._editor.getModel().getLineCount(),d=this._editor.getLayoutInfo().height/a,l=Math.max(2,Math.ceil(3/d));let u=e[0].range.startLineNumber,g=e[0].range.endLineNumber;for(let m=1,v=e.length;m<v;m++){const y=e[m].range;g+l>=y.startLineNumber?y.endLineNumber>g&&(g=y.endLineNumber):(o.push({range:new P(u,1,g,1),options:Nc._FIND_MATCH_ONLY_OVERVIEW_DECORATION}),u=y.startLineNumber,g=y.endLineNumber)}o.push({range:new P(u,1,g,1),options:Nc._FIND_MATCH_ONLY_OVERVIEW_DECORATION})}const r=new Array(e.length);for(let a=0,c=e.length;a<c;a++)r[a]={range:e[a].range,options:n};this._decorations=i.deltaDecorations(this._decorations,r),this._overviewRulerApproximateDecorations=i.deltaDecorations(this._overviewRulerApproximateDecorations,o),this._rangeHighlightDecorationId&&(i.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),this._findScopeDecorationIds.length&&(this._findScopeDecorationIds.forEach(a=>i.removeDecoration(a)),this._findScopeDecorationIds=[]),t?.length&&(this._findScopeDecorationIds=t.map(a=>i.addDecoration(a,Nc._FIND_SCOPE_DECORATION)))})}matchBeforePosition(e){if(this._decorations.length===0)return null;for(let t=this._decorations.length-1;t>=0;t--){const i=this._decorations[t],n=this._editor.getModel().getDecorationRange(i);if(!(!n||n.endLineNumber>e.lineNumber)){if(n.endLineNumber<e.lineNumber)return n;if(!(n.endColumn>e.column))return n}}return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length-1])}matchAfterPosition(e){if(this._decorations.length===0)return null;for(let t=0,i=this._decorations.length;t<i;t++){const n=this._decorations[t],o=this._editor.getModel().getDecorationRange(n);if(!(!o||o.startLineNumber<e.lineNumber)){if(o.startLineNumber>e.lineNumber)return o;if(!(o.startColumn<e.column))return o}}return this._editor.getModel().getDecorationRange(this._decorations[0])}_allDecorations(){let e=[];return e=e.concat(this._decorations),e=e.concat(this._overviewRulerApproximateDecorations),this._findScopeDecorationIds.length&&e.push(...this._findScopeDecorationIds),this._rangeHighlightDecorationId&&e.push(this._rangeHighlightDecorationId),e}static{this._CURRENT_FIND_MATCH_DECORATION=Yt.register({description:"current-find-match",stickiness:Di.NeverGrowsWhenTypingAtEdges,zIndex:13,className:"currentFindMatch",inlineClassName:"currentFindMatchInline",showIfCollapsed:!0,overviewRuler:{color:es(pC),position:ol.Center},minimap:{color:es(j7),position:Ym.Inline}})}static{this._FIND_MATCH_DECORATION=Yt.register({description:"find-match",stickiness:Di.NeverGrowsWhenTypingAtEdges,zIndex:10,className:"findMatch",inlineClassName:"findMatchInline",showIfCollapsed:!0,overviewRuler:{color:es(pC),position:ol.Center},minimap:{color:es(j7),position:Ym.Inline}})}static{this._FIND_MATCH_NO_OVERVIEW_DECORATION=Yt.register({description:"find-match-no-overview",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"findMatch",showIfCollapsed:!0})}static{this._FIND_MATCH_ONLY_OVERVIEW_DECORATION=Yt.register({description:"find-match-only-overview",stickiness:Di.NeverGrowsWhenTypingAtEdges,overviewRuler:{color:es(pC),position:ol.Center}})}static{this._RANGE_HIGHLIGHT_DECORATION=Yt.register({description:"find-range-highlight",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"rangeHighlight",isWholeLine:!0})}static{this._FIND_SCOPE_DECORATION=Yt.register({description:"find-scope",className:"findScope",isWholeLine:!0})}}class G2e{constructor(e,t,i){this._editorSelection=e,this._ranges=t,this._replaceStrings=i,this._trackedEditorSelectionId=null}getEditOperations(e,t){if(this._ranges.length>0){const i=[];for(let r=0;r<this._ranges.length;r++)i.push({range:this._ranges[r],text:this._replaceStrings[r]});i.sort((r,a)=>P.compareRangesUsingStarts(r.range,a.range));const n=[];let o=i[0];for(let r=1;r<i.length;r++)o.range.endLineNumber===i[r].range.startLineNumber&&o.range.endColumn===i[r].range.startColumn?(o.range=o.range.plusRange(i[r].range),o.text=o.text+i[r].text):(n.push(o),o=i[r]);n.push(o);for(const r of n)t.addEditOperation(r.range,r.text)}this._trackedEditorSelectionId=t.trackSelection(this._editorSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._trackedEditorSelectionId)}}function dpe(s,e){if(s&&s[0]!==""){const t=Fte(s,e,"-"),i=Fte(s,e,"_");return t&&!i?Wte(s,e,"-"):!t&&i?Wte(s,e,"_"):s[0].toUpperCase()===s[0]?e.toUpperCase():s[0].toLowerCase()===s[0]?e.toLowerCase():SF(s[0][0])&&e.length>0?e[0].toUpperCase()+e.substr(1):s[0][0].toUpperCase()!==s[0][0]&&e.length>0?e[0].toLowerCase()+e.substr(1):e}else return e}function Fte(s,e,t){return s[0].indexOf(t)!==-1&&e.indexOf(t)!==-1&&s[0].split(t).length===e.split(t).length}function Wte(s,e,t){const i=e.split(t),n=s[0].split(t);let o="";return i.forEach((r,a)=>{o+=dpe([n[a]],r)+t}),o.slice(0,-1)}var Zy;(function(s){s[s.StaticValue=0]="StaticValue",s[s.DynamicPieces=1]="DynamicPieces"})(Zy||(Zy={}));class Bte{constructor(e){this.staticValue=e,this.kind=Zy.StaticValue}}class q2e{constructor(e){this.pieces=e,this.kind=Zy.DynamicPieces}}class Jy{static fromStaticValue(e){return new Jy([Lp.staticValue(e)])}get hasReplacementPatterns(){return this._state.kind===Zy.DynamicPieces}constructor(e){!e||e.length===0?this._state=new Bte(""):e.length===1&&e[0].staticValue!==null?this._state=new Bte(e[0].staticValue):this._state=new q2e(e)}buildReplaceString(e,t){if(this._state.kind===Zy.StaticValue)return t?dpe(e,this._state.staticValue):this._state.staticValue;let i="";for(let n=0,o=this._state.pieces.length;n<o;n++){const r=this._state.pieces[n];if(r.staticValue!==null){i+=r.staticValue;continue}let a=Jy._substitute(r.matchIndex,e);if(r.caseOps!==null&&r.caseOps.length>0){const c=[],d=r.caseOps.length;let l=0;for(let u=0,g=a.length;u<g;u++){if(l>=d){c.push(a.slice(u));break}switch(r.caseOps[l]){case"U":c.push(a[u].toUpperCase());break;case"u":c.push(a[u].toUpperCase()),l++;break;case"L":c.push(a[u].toLowerCase());break;case"l":c.push(a[u].toLowerCase()),l++;break;default:c.push(a[u])}}a=c.join("")}i+=a}return i}static _substitute(e,t){if(t===null)return"";if(e===0)return t[0];let i="";for(;e>0;){if(e<t.length)return(t[e]||"")+i;i=String(e%10)+i,e=Math.floor(e/10)}return"$"+i}}class Lp{static staticValue(e){return new Lp(e,-1,null)}static matchIndex(e){return new Lp(null,e,null)}static caseOps(e,t){return new Lp(null,e,t)}constructor(e,t,i){this.staticValue=e,this.matchIndex=t,!i||i.length===0?this.caseOps=null:this.caseOps=i.slice(0)}}class z2e{constructor(e){this._source=e,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=""}emitUnchanged(e){this._emitStatic(this._source.substring(this._lastCharIndex,e)),this._lastCharIndex=e}emitStatic(e,t){this._emitStatic(e),this._lastCharIndex=t}_emitStatic(e){e.length!==0&&(this._currentStaticPiece+=e)}emitMatchIndex(e,t,i){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=Lp.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),this._result[this._resultLen++]=Lp.caseOps(e,i),this._lastCharIndex=t}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=Lp.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),new Jy(this._result)}}function K2e(s){if(!s||s.length===0)return new Jy(null);const e=[],t=new z2e(s);for(let i=0,n=s.length;i<n;i++){const o=s.charCodeAt(i);if(o===st.Backslash){if(i++,i>=n)break;const r=s.charCodeAt(i);switch(r){case st.Backslash:t.emitUnchanged(i-1),t.emitStatic("\\",i+1);break;case st.n:t.emitUnchanged(i-1),t.emitStatic(`
`,i+1);break;case st.t:t.emitUnchanged(i-1),t.emitStatic("	",i+1);break;case st.u:case st.U:case st.l:case st.L:t.emitUnchanged(i-1),t.emitStatic("",i+1),e.push(String.fromCharCode(r));break}continue}if(o===st.DollarSign){if(i++,i>=n)break;const r=s.charCodeAt(i);if(r===st.DollarSign){t.emitUnchanged(i-1),t.emitStatic("$",i+1);continue}if(r===st.Digit0||r===st.Ampersand){t.emitUnchanged(i-1),t.emitMatchIndex(0,i+1,e),e.length=0;continue}if(st.Digit1<=r&&r<=st.Digit9){let a=r-st.Digit0;if(i+1<n){const c=s.charCodeAt(i+1);if(st.Digit0<=c&&c<=st.Digit9){i++,a=a*10+(c-st.Digit0),t.emitUnchanged(i-2),t.emitMatchIndex(a,i+1,e),e.length=0;continue}}t.emitUnchanged(i-1),t.emitMatchIndex(a,i+1,e),e.length=0;continue}}}return t.finalize()}const Mg=new O("findWidgetVisible",!1);Mg.toNegated();const k1=new O("findInputFocussed",!1),g5=new O("replaceInputFocussed",!1),rk={primary:E.Alt|S.KeyC,mac:{primary:E.CtrlCmd|E.Alt|S.KeyC}},ak={primary:E.Alt|S.KeyW,mac:{primary:E.CtrlCmd|E.Alt|S.KeyW}},ck={primary:E.Alt|S.KeyR,mac:{primary:E.CtrlCmd|E.Alt|S.KeyR}},dk={primary:E.Alt|S.KeyL,mac:{primary:E.CtrlCmd|E.Alt|S.KeyL}},lk={primary:E.Alt|S.KeyP,mac:{primary:E.CtrlCmd|E.Alt|S.KeyP}},Bi={StartFindAction:"actions.find",StartFindWithSelection:"actions.findWithSelection",StartFindWithArgs:"editor.actions.findWithArgs",NextMatchFindAction:"editor.action.nextMatchFindAction",PreviousMatchFindAction:"editor.action.previousMatchFindAction",GoToMatchFindAction:"editor.action.goToMatchFindAction",NextSelectionMatchFindAction:"editor.action.nextSelectionMatchFindAction",PreviousSelectionMatchFindAction:"editor.action.previousSelectionMatchFindAction",StartFindReplaceAction:"editor.action.startFindReplaceAction",CloseFindWidgetCommand:"closeFindWidget",ToggleCaseSensitiveCommand:"toggleFindCaseSensitive",ToggleWholeWordCommand:"toggleFindWholeWord",ToggleRegexCommand:"toggleFindRegex",ToggleSearchScopeCommand:"toggleFindInSelection",TogglePreserveCaseCommand:"togglePreserveCase",ReplaceOneAction:"editor.action.replaceOne",ReplaceAllAction:"editor.action.replaceAll",SelectAllMatchesAction:"editor.action.selectAllMatches"},vp=19999,j2e=240;class lE{constructor(e,t){this._toDispose=new U,this._editor=e,this._state=t,this._isDisposed=!1,this._startSearchingTimer=new iI,this._decorations=new Nc(e),this._toDispose.add(this._decorations),this._updateDecorationsScheduler=new fn(()=>{if(this._editor.hasModel())return this.research(!1)},100),this._toDispose.add(this._updateDecorationsScheduler),this._toDispose.add(this._editor.onDidChangeCursorPosition(i=>{(i.reason===Ls.Explicit||i.reason===Ls.Undo||i.reason===Ls.Redo)&&this._decorations.setStartPosition(this._editor.getPosition())})),this._ignoreModelContentChanged=!1,this._toDispose.add(this._editor.onDidChangeModelContent(i=>{this._ignoreModelContentChanged||(i.isFlush&&this._decorations.reset(),this._decorations.setStartPosition(this._editor.getPosition()),this._updateDecorationsScheduler.schedule())})),this._toDispose.add(this._state.onFindReplaceStateChange(i=>this._onStateChanged(i))),this.research(!1,this._state.searchScope)}dispose(){this._isDisposed=!0,Qe(this._startSearchingTimer),this._toDispose.dispose()}_onStateChanged(e){this._isDisposed||this._editor.hasModel()&&(e.searchString||e.isReplaceRevealed||e.isRegex||e.wholeWord||e.matchCase||e.searchScope)&&(this._editor.getModel().isTooLargeForSyncing()?(this._startSearchingTimer.cancel(),this._startSearchingTimer.setIfNotSet(()=>{e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor)},j2e)):e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor))}static _getSearchRange(e,t){return t||e.getFullModelRange()}research(e,t){let i=null;typeof t<"u"?t!==null&&(Array.isArray(t)?i=t:i=[t]):i=this._decorations.getFindScopes(),i!==null&&(i=i.map(a=>{if(a.startLineNumber!==a.endLineNumber){let c=a.endLineNumber;return a.endColumn===1&&(c=c-1),new P(a.startLineNumber,1,c,this._editor.getModel().getLineMaxColumn(c))}return a}));const n=this._findMatches(i,!1,vp);this._decorations.set(n,i);const o=this._editor.getSelection();let r=this._decorations.getCurrentMatchesPosition(o);if(r===0&&n.length>0){const a=ise(n.map(c=>c.range),c=>P.compareRangesUsingStarts(c,o)>=0);r=a>0?a-1+1:r}this._state.changeMatchInfo(r,this._decorations.getCount(),void 0),e&&this._editor.getOption(L.find).cursorMoveOnType&&this._moveToNextMatch(this._decorations.getStartPosition())}_hasMatches(){return this._state.matchesCount>0}_cannotFind(){if(!this._hasMatches()){const e=this._decorations.getFindScope();return e&&this._editor.revealRangeInCenterIfOutsideViewport(e,ji.Smooth),!0}return!1}_setCurrentFindMatch(e){const t=this._decorations.setCurrentFindMatch(e);this._state.changeMatchInfo(t,this._decorations.getCount(),e),this._editor.setSelection(e),this._editor.revealRangeInCenterIfOutsideViewport(e,ji.Smooth)}_prevSearchPosition(e){const t=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:i,column:n}=e;const o=this._editor.getModel();return t||n===1?(i===1?i=o.getLineCount():i--,n=o.getLineMaxColumn(i)):n--,new _e(i,n)}_moveToPrevMatch(e,t=!1){if(!this._state.canNavigateBack()){const l=this._decorations.matchAfterPosition(e);l&&this._setCurrentFindMatch(l);return}if(this._decorations.getCount()<vp){let l=this._decorations.matchBeforePosition(e);l&&l.isEmpty()&&l.getStartPosition().equals(e)&&(e=this._prevSearchPosition(e),l=this._decorations.matchBeforePosition(e)),l&&this._setCurrentFindMatch(l);return}if(this._cannotFind())return;const i=this._decorations.getFindScope(),n=lE._getSearchRange(this._editor.getModel(),i);n.getEndPosition().isBefore(e)&&(e=n.getEndPosition()),e.isBefore(n.getStartPosition())&&(e=n.getEndPosition());const{lineNumber:o,column:r}=e,a=this._editor.getModel();let c=new _e(o,r),d=a.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,!1);if(d&&d.range.isEmpty()&&d.range.getStartPosition().equals(c)&&(c=this._prevSearchPosition(c),d=a.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,!1)),!!d){if(!t&&!n.containsRange(d.range))return this._moveToPrevMatch(d.range.getStartPosition(),!0);this._setCurrentFindMatch(d.range)}}moveToPrevMatch(){this._moveToPrevMatch(this._editor.getSelection().getStartPosition())}_nextSearchPosition(e){const t=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:i,column:n}=e;const o=this._editor.getModel();return t||n===o.getLineMaxColumn(i)?(i===o.getLineCount()?i=1:i++,n=1):n++,new _e(i,n)}_moveToNextMatch(e){if(!this._state.canNavigateForward()){const i=this._decorations.matchBeforePosition(e);i&&this._setCurrentFindMatch(i);return}if(this._decorations.getCount()<vp){let i=this._decorations.matchAfterPosition(e);i&&i.isEmpty()&&i.getStartPosition().equals(e)&&(e=this._nextSearchPosition(e),i=this._decorations.matchAfterPosition(e)),i&&this._setCurrentFindMatch(i);return}const t=this._getNextMatch(e,!1,!0);t&&this._setCurrentFindMatch(t.range)}_getNextMatch(e,t,i,n=!1){if(this._cannotFind())return null;const o=this._decorations.getFindScope(),r=lE._getSearchRange(this._editor.getModel(),o);r.getEndPosition().isBefore(e)&&(e=r.getStartPosition()),e.isBefore(r.getStartPosition())&&(e=r.getStartPosition());const{lineNumber:a,column:c}=e,d=this._editor.getModel();let l=new _e(a,c),u=d.findNextMatch(this._state.searchString,l,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,t);return i&&u&&u.range.isEmpty()&&u.range.getStartPosition().equals(l)&&(l=this._nextSearchPosition(l),u=d.findNextMatch(this._state.searchString,l,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,t)),u?!n&&!r.containsRange(u.range)?this._getNextMatch(u.range.getEndPosition(),t,i,!0):u:null}moveToNextMatch(){this._moveToNextMatch(this._editor.getSelection().getEndPosition())}_moveToMatch(e){const t=this._decorations.getDecorationRangeAt(e);t&&this._setCurrentFindMatch(t)}moveToMatch(e){this._moveToMatch(e)}_getReplacePattern(){return this._state.isRegex?K2e(this._state.replaceString):Jy.fromStaticValue(this._state.replaceString)}replace(){if(!this._hasMatches())return;const e=this._getReplacePattern(),t=this._editor.getSelection(),i=this._getNextMatch(t.getStartPosition(),!0,!1);if(i)if(t.equalsRange(i.range)){const n=e.buildReplaceString(i.matches,this._state.preserveCase),o=new uI(t,n);this._executeEditorCommand("replace",o),this._decorations.setStartPosition(new _e(t.startLineNumber,t.startColumn+n.length)),this.research(!0)}else this._decorations.setStartPosition(this._editor.getPosition()),this._setCurrentFindMatch(i.range)}_findMatches(e,t,i){const n=(e||[null]).map(o=>lE._getSearchRange(this._editor.getModel(),o));return this._editor.getModel().findMatches(this._state.searchString,n,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,t,i)}replaceAll(){if(!this._hasMatches())return;const e=this._decorations.getFindScopes();e===null&&this._state.matchesCount>=vp?this._largeReplaceAll():this._regularReplaceAll(e),this.research(!1)}_largeReplaceAll(){const t=new jye(this._state.searchString,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null).parseSearchRequest();if(!t)return;let i=t.regex;if(!i.multiline){let u="mu";i.ignoreCase&&(u+="i"),i.global&&(u+="g"),i=new RegExp(i.source,u)}const n=this._editor.getModel(),o=n.getValue(ry.LF),r=n.getFullModelRange(),a=this._getReplacePattern();let c;const d=this._state.preserveCase;a.hasReplacementPatterns||d?c=o.replace(i,function(){return a.buildReplaceString(arguments,d)}):c=o.replace(i,a.buildReplaceString(null,d));const l=new Pse(r,c,this._editor.getSelection());this._executeEditorCommand("replaceAll",l)}_regularReplaceAll(e){const t=this._getReplacePattern(),i=this._findMatches(e,t.hasReplacementPatterns||this._state.preserveCase,dc.MAX_SAFE_SMALL_INTEGER),n=[];for(let r=0,a=i.length;r<a;r++)n[r]=t.buildReplaceString(i[r].matches,this._state.preserveCase);const o=new G2e(this._editor.getSelection(),i.map(r=>r.range),n);this._executeEditorCommand("replaceAll",o)}selectAllMatches(){if(!this._hasMatches())return;const e=this._decorations.getFindScopes();let i=this._findMatches(e,!1,dc.MAX_SAFE_SMALL_INTEGER).map(o=>new at(o.range.startLineNumber,o.range.startColumn,o.range.endLineNumber,o.range.endColumn));const n=this._editor.getSelection();for(let o=0,r=i.length;o<r;o++)if(i[o].equalsRange(n)){i=[n].concat(i.slice(0,o)).concat(i.slice(o+1));break}this._editor.setSelections(i)}_executeEditorCommand(e,t){try{this._ignoreModelContentChanged=!0,this._editor.pushUndoStop(),this._editor.executeCommand(e,t),this._editor.pushUndoStop()}finally{this._ignoreModelContentChanged=!1}}}const Y2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(Y2e);class p5 extends uf{static{this.ID="editor.contrib.findOptionsWidget"}constructor(e,t,i){super(),this._hideSoon=this._register(new fn(()=>this._hide(),2e3)),this._isVisible=!1,this._editor=e,this._state=t,this._keybindingService=i,this._domNode=document.createElement("div"),this._domNode.className="findOptionsWidget",this._domNode.style.display="none",this._domNode.style.top="10px",this._domNode.style.zIndex="12",this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true");const n={inputActiveOptionBorder:gt(dse),inputActiveOptionForeground:gt(cse),inputActiveOptionBackground:gt(gq)},o=this._register(Km());this.caseSensitive=this._register(new Yye({appendTitle:this._keybindingLabelFor(Bi.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase,hoverDelegate:o,...n})),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new Qye({appendTitle:this._keybindingLabelFor(Bi.ToggleWholeWordCommand),isChecked:this._state.wholeWord,hoverDelegate:o,...n})),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new Xye({appendTitle:this._keybindingLabelFor(Bi.ToggleRegexCommand),isChecked:this._state.isRegex,hoverDelegate:o,...n})),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(r=>{let a=!1;r.isRegex&&(this.regex.checked=this._state.isRegex,a=!0),r.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,a=!0),r.matchCase&&(this.caseSensitive.checked=this._state.matchCase,a=!0),!this._state.isRevealed&&a&&this._revealTemporarily()})),this._register(re(this._domNode,pe.MOUSE_LEAVE,r=>this._onMouseLeave())),this._register(re(this._domNode,"mouseover",r=>this._onMouseOver()))}_keybindingLabelFor(e){const t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:""}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return p5.ID}getDomNode(){return this._domNode}getPosition(){return{preference:bI.TOP_RIGHT_CORNER}}highlightFindOptions(){this._revealTemporarily()}_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display="block")}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display="none")}}var Do;(function(s){s[s.NotSet=0]="NotSet",s[s.True=1]="True",s[s.False=2]="False"})(Do||(Do={}));function hk(s,e){return s===Do.True?!0:s===Do.False?!1:e}class Q2e extends F{get searchString(){return this._searchString}get replaceString(){return this._replaceString}get isRevealed(){return this._isRevealed}get isReplaceRevealed(){return this._isReplaceRevealed}get isRegex(){return hk(this._isRegexOverride,this._isRegex)}get wholeWord(){return hk(this._wholeWordOverride,this._wholeWord)}get matchCase(){return hk(this._matchCaseOverride,this._matchCase)}get preserveCase(){return hk(this._preserveCaseOverride,this._preserveCase)}get actualIsRegex(){return this._isRegex}get actualWholeWord(){return this._wholeWord}get actualMatchCase(){return this._matchCase}get actualPreserveCase(){return this._preserveCase}get searchScope(){return this._searchScope}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get currentMatch(){return this._currentMatch}get isSearching(){return this._isSearching}get filters(){return this._filters}constructor(){super(),this._onFindReplaceStateChange=this._register(new M),this.onFindReplaceStateChange=this._onFindReplaceStateChange.event,this._searchString="",this._replaceString="",this._isRevealed=!1,this._isReplaceRevealed=!1,this._isRegex=!1,this._isRegexOverride=Do.NotSet,this._wholeWord=!1,this._wholeWordOverride=Do.NotSet,this._matchCase=!1,this._matchCaseOverride=Do.NotSet,this._preserveCase=!1,this._preserveCaseOverride=Do.NotSet,this._searchScope=null,this._matchesPosition=0,this._matchesCount=0,this._currentMatch=null,this._loop=!0,this._isSearching=!1,this._filters=null}changeMatchInfo(e,t,i){const n={moveCursor:!1,updateHistory:!1,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let o=!1;t===0&&(e=0),e>t&&(e=t),this._matchesPosition!==e&&(this._matchesPosition=e,n.matchesPosition=!0,o=!0),this._matchesCount!==t&&(this._matchesCount=t,n.matchesCount=!0,o=!0),typeof i<"u"&&(P.equalsRange(this._currentMatch,i)||(this._currentMatch=i,n.currentMatch=!0,o=!0)),o&&this._onFindReplaceStateChange.fire(n)}change(e,t,i=!0){const n={moveCursor:t,updateHistory:i,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let o=!1;const r=this.isRegex,a=this.wholeWord,c=this.matchCase,d=this.preserveCase;typeof e.searchString<"u"&&this._searchString!==e.searchString&&(this._searchString=e.searchString,n.searchString=!0,o=!0),typeof e.replaceString<"u"&&this._replaceString!==e.replaceString&&(this._replaceString=e.replaceString,n.replaceString=!0,o=!0),typeof e.isRevealed<"u"&&this._isRevealed!==e.isRevealed&&(this._isRevealed=e.isRevealed,n.isRevealed=!0,o=!0),typeof e.isReplaceRevealed<"u"&&this._isReplaceRevealed!==e.isReplaceRevealed&&(this._isReplaceRevealed=e.isReplaceRevealed,n.isReplaceRevealed=!0,o=!0),typeof e.isRegex<"u"&&(this._isRegex=e.isRegex),typeof e.wholeWord<"u"&&(this._wholeWord=e.wholeWord),typeof e.matchCase<"u"&&(this._matchCase=e.matchCase),typeof e.preserveCase<"u"&&(this._preserveCase=e.preserveCase),typeof e.searchScope<"u"&&(e.searchScope?.every(l=>this._searchScope?.some(u=>!P.equalsRange(u,l)))||(this._searchScope=e.searchScope,n.searchScope=!0,o=!0)),typeof e.loop<"u"&&this._loop!==e.loop&&(this._loop=e.loop,n.loop=!0,o=!0),typeof e.isSearching<"u"&&this._isSearching!==e.isSearching&&(this._isSearching=e.isSearching,n.isSearching=!0,o=!0),typeof e.filters<"u"&&(this._filters?this._filters.update(e.filters):this._filters=e.filters,n.filters=!0,o=!0),this._isRegexOverride=typeof e.isRegexOverride<"u"?e.isRegexOverride:Do.NotSet,this._wholeWordOverride=typeof e.wholeWordOverride<"u"?e.wholeWordOverride:Do.NotSet,this._matchCaseOverride=typeof e.matchCaseOverride<"u"?e.matchCaseOverride:Do.NotSet,this._preserveCaseOverride=typeof e.preserveCaseOverride<"u"?e.preserveCaseOverride:Do.NotSet,r!==this.isRegex&&(o=!0,n.isRegex=!0),a!==this.wholeWord&&(o=!0,n.wholeWord=!0),c!==this.matchCase&&(o=!0,n.matchCase=!0),d!==this.preserveCase&&(o=!0,n.preserveCase=!0),o&&this._onFindReplaceStateChange.fire(n)}canNavigateBack(){return this.canNavigateInLoop()||this.matchesPosition!==1}canNavigateForward(){return this.canNavigateInLoop()||this.matchesPosition<this.matchesCount}canNavigateInLoop(){return this._loop||this.matchesCount>=vp}}const X2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(X2e);const Vte=Ae("find-collapsed",j.chevronRight,h(1021,"Icon to indicate that the editor find widget is collapsed.")),Hte=Ae("find-expanded",j.chevronDown,h(1022,"Icon to indicate that the editor find widget is expanded.")),Z2e=Ae("find-selection",j.selection,h(1023,"Icon for 'Find in Selection' in the editor find widget.")),J2e=Ae("find-replace",j.replace,h(1024,"Icon for 'Replace' in the editor find widget.")),e$e=Ae("find-replace-all",j.replaceAll,h(1025,"Icon for 'Replace All' in the editor find widget.")),t$e=Ae("find-previous-match",j.arrowUp,h(1026,"Icon for 'Find Previous' in the editor find widget.")),i$e=Ae("find-next-match",j.arrowDown,h(1027,"Icon for 'Find Next' in the editor find widget.")),n$e=h(1028,"Find / Replace"),s$e=h(1029,"Find"),o$e=h(1030,"Find"),r$e=h(1031,"Previous Match"),a$e=h(1032,"Next Match"),c$e=h(1033,"Find in Selection"),d$e=h(1034,"Close"),l$e=h(1035,"Replace"),h$e=h(1036,"Replace"),u$e=h(1037,"Replace"),g$e=h(1038,"Replace All"),p$e=h(1039,"Toggle Replace"),f$e=h(1040,"Only the first {0} results are highlighted, but all find operations work on the entire text.",vp),m$e=h(1041,"{0} of {1}"),Ute=h(1042,"No results"),Ol=419,v$e=275,_$e=v$e-54;let TS=69;const b$e=33,$te=qt?E.WinCtrl:E.CtrlCmd;class lF{constructor(e){this.afterLineNumber=e,this.heightInPx=b$e,this.suppressMouseDown=!1,this.domNode=document.createElement("div"),this.domNode.className="dock-find-viewzone"}}function Gte(s,e,t){const i=!!e.match(/\n/);if(t&&i&&t.selectionStart>0){s.stopPropagation();return}}function qte(s,e,t){const i=!!e.match(/\n/);if(t&&i&&t.selectionEnd<t.value.length){s.stopPropagation();return}}class f5 extends uf{static{this.ID="editor.contrib.findWidget"}constructor(e,t,i,n,o,r,a,c,d){super(),this._hoverService=a,this._findWidgetSearchHistory=c,this._replaceWidgetHistory=d,this._cachedHeight=null,this._revealTimeouts=[],this._codeEditor=e,this._controller=t,this._state=i,this._contextViewProvider=n,this._keybindingService=o,this._contextKeyService=r,this._isVisible=!1,this._isReplaceVisible=!1,this._ignoreChangeEvent=!1,this._updateHistoryDelayer=new tg(500),this._register(Ee(()=>this._updateHistoryDelayer.cancel())),this._register(this._state.onFindReplaceStateChange(l=>this._onStateChanged(l))),this._buildDomNode(),this._updateButtons(),this._tryUpdateWidgetWidth(),this._findInput.inputBox.layout(),this._register(this._codeEditor.onDidChangeConfiguration(l=>{if(l.hasChanged(L.readOnly)&&(this._codeEditor.getOption(L.readOnly)&&this._state.change({isReplaceRevealed:!1},!1),this._updateButtons()),l.hasChanged(L.layoutInfo)&&this._tryUpdateWidgetWidth(),l.hasChanged(L.accessibilitySupport)&&this.updateAccessibilitySupport(),l.hasChanged(L.find)){const u=this._codeEditor.getOption(L.find).loop;this._state.change({loop:u},!1);const g=this._codeEditor.getOption(L.find).addExtraSpaceOnTop;g&&!this._viewZone&&(this._viewZone=new lF(0),this._showViewZone()),!g&&this._viewZone&&this._removeViewZone()}})),this.updateAccessibilitySupport(),this._register(this._codeEditor.onDidChangeCursorSelection(()=>{this._isVisible&&this._updateToggleSelectionFindButton()})),this._register(this._codeEditor.onDidFocusEditorWidget(async()=>{if(this._isVisible){const l=await this._controller.getGlobalBufferTerm();l&&l!==this._state.searchString&&(this._state.change({searchString:l},!1),this._findInput.select())}})),this._findInputFocused=k1.bindTo(r),this._findFocusTracker=this._register(Po(this._findInput.inputBox.inputElement)),this._register(this._findFocusTracker.onDidFocus(()=>{this._findInputFocused.set(!0),this._updateSearchScope()})),this._register(this._findFocusTracker.onDidBlur(()=>{this._findInputFocused.set(!1)})),this._replaceInputFocused=g5.bindTo(r),this._replaceFocusTracker=this._register(Po(this._replaceInput.inputBox.inputElement)),this._register(this._replaceFocusTracker.onDidFocus(()=>{this._replaceInputFocused.set(!0),this._updateSearchScope()})),this._register(this._replaceFocusTracker.onDidBlur(()=>{this._replaceInputFocused.set(!1)})),this._codeEditor.addOverlayWidget(this),this._codeEditor.getOption(L.find).addExtraSpaceOnTop&&(this._viewZone=new lF(0)),this._register(this._codeEditor.onDidChangeModel(()=>{this._isVisible&&(this._viewZoneId=void 0)})),this._register(this._codeEditor.onDidScrollChange(l=>{if(l.scrollTopChanged){this._layoutViewZone();return}setTimeout(()=>{this._layoutViewZone()},0)}))}getId(){return f5.ID}getDomNode(){return this._domNode}getPosition(){return this._isVisible?{preference:bI.TOP_RIGHT_CORNER}:null}_onStateChanged(e){if(e.searchString){try{this._ignoreChangeEvent=!0,this._findInput.setValue(this._state.searchString)}finally{this._ignoreChangeEvent=!1}this._updateButtons()}if(e.replaceString&&(this._replaceInput.inputBox.value=this._state.replaceString),e.isRevealed&&(this._state.isRevealed?this._reveal():this._hide(!0)),e.isReplaceRevealed&&(this._state.isReplaceRevealed?!this._codeEditor.getOption(L.readOnly)&&!this._isReplaceVisible&&(this._isReplaceVisible=!0,this._replaceInput.width=$a(this._findInput.domNode),this._updateButtons(),this._replaceInput.inputBox.layout()):this._isReplaceVisible&&(this._isReplaceVisible=!1,this._updateButtons())),(e.isRevealed||e.isReplaceRevealed)&&(this._state.isRevealed||this._state.isReplaceRevealed)&&this._tryUpdateHeight()&&this._showViewZone(),e.isRegex&&this._findInput.setRegex(this._state.isRegex),e.wholeWord&&this._findInput.setWholeWords(this._state.wholeWord),e.matchCase&&this._findInput.setCaseSensitive(this._state.matchCase),e.preserveCase&&this._replaceInput.setPreserveCase(this._state.preserveCase),e.searchScope&&(this._state.searchScope?this._toggleSelectionFind.checked=!0:this._toggleSelectionFind.checked=!1,this._updateToggleSelectionFindButton()),e.searchString||e.matchesCount||e.matchesPosition){const t=this._state.searchString.length>0&&this._state.matchesCount===0;this._domNode.classList.toggle("no-results",t),this._updateMatchesCount(),this._updateButtons()}(e.searchString||e.currentMatch)&&this._layoutViewZone(),e.updateHistory&&this._delayedUpdateHistory(),e.loop&&this._updateButtons()}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(void 0,mt)}_updateHistory(){this._state.searchString&&this._findInput.inputBox.addToHistory(),this._state.replaceString&&this._replaceInput.inputBox.addToHistory()}_updateMatchesCount(){this._matchesCount.style.minWidth=TS+"px",this._state.matchesCount>=vp?this._matchesCount.title=f$e:this._matchesCount.title="",this._matchesCount.firstChild?.remove();let e;if(this._state.matchesCount>0){let t=String(this._state.matchesCount);this._state.matchesCount>=vp&&(t+="+");let i=String(this._state.matchesPosition);i==="0"&&(i="?"),e=Eq(m$e,i,t)}else e=Ute;this._matchesCount.appendChild(document.createTextNode(e)),ta(this._getAriaLabel(e,this._state.currentMatch,this._state.searchString)),TS=Math.max(TS,this._matchesCount.clientWidth)}_getAriaLabel(e,t,i){if(e===Ute)return i===""?h(1043,"{0} found",e):h(1044,"{0} found for '{1}'",e,i);if(t){const n=h(1045,"{0} found for '{1}', at {2}",e,i,t.startLineNumber+":"+t.startColumn),o=this._codeEditor.getModel();return o&&t.startLineNumber<=o.getLineCount()&&t.startLineNumber>=1?`${o.getLineContent(t.startLineNumber)}, ${n}`:n}return h(1046,"{0} found for '{1}'",e,i)}_updateToggleSelectionFindButton(){const e=this._codeEditor.getSelection(),t=e?e.startLineNumber!==e.endLineNumber||e.startColumn!==e.endColumn:!1,i=this._toggleSelectionFind.checked;this._isVisible&&(i||t)?this._toggleSelectionFind.enable():this._toggleSelectionFind.disable()}_updateButtons(){this._findInput.setEnabled(this._isVisible),this._replaceInput.setEnabled(this._isVisible&&this._isReplaceVisible),this._updateToggleSelectionFindButton(),this._closeBtn.setEnabled(this._isVisible);const e=this._state.searchString.length>0,t=!!this._state.matchesCount;this._prevBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateBack()),this._nextBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateForward()),this._replaceBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._replaceAllBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._domNode.classList.toggle("replaceToggled",this._isReplaceVisible),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);const i=!this._codeEditor.getOption(L.readOnly);this._toggleReplaceBtn.setEnabled(this._isVisible&&i)}_reveal(){if(this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],!this._isVisible){this._isVisible=!0;const e=this._codeEditor.getSelection();switch(this._codeEditor.getOption(L.find).autoFindInSelection){case"always":this._toggleSelectionFind.checked=!0;break;case"never":this._toggleSelectionFind.checked=!1;break;case"multiline":{const i=!!e&&e.startLineNumber!==e.endLineNumber;this._toggleSelectionFind.checked=i;break}}this._tryUpdateWidgetWidth(),this._updateButtons(),this._revealTimeouts.push(setTimeout(()=>{this._domNode.classList.add("visible"),this._domNode.setAttribute("aria-hidden","false")},0)),this._revealTimeouts.push(setTimeout(()=>{this._findInput.validate()},200)),this._codeEditor.layoutOverlayWidget(this);let t=!0;if(this._codeEditor.getOption(L.find).seedSearchStringFromSelection&&e){const i=this._codeEditor.getDomNode();if(i){const n=Ms(i),o=this._codeEditor.getScrolledVisiblePosition(e.getStartPosition()),r=n.left+(o?o.left:0),a=o?o.top:0;if(this._viewZone&&a<this._viewZone.heightInPx){e.endLineNumber>e.startLineNumber&&(t=!1);const c=Zye(this._domNode).left;r>c&&(t=!1);const d=this._codeEditor.getScrolledVisiblePosition(e.getEndPosition());n.left+(d?d.left:0)>c&&(t=!1)}}}this._showViewZone(t)}}_hide(e){this._revealTimeouts.forEach(t=>{clearTimeout(t)}),this._revealTimeouts=[],this._isVisible&&(this._isVisible=!1,this._updateButtons(),this._domNode.classList.remove("visible"),this._domNode.setAttribute("aria-hidden","true"),this._findInput.clearMessage(),e&&this._codeEditor.focus(),this._codeEditor.layoutOverlayWidget(this),this._removeViewZone())}_layoutViewZone(e){if(!this._codeEditor.getOption(L.find).addExtraSpaceOnTop){this._removeViewZone();return}if(!this._isVisible)return;const i=this._viewZone;this._viewZoneId!==void 0||!i||this._codeEditor.changeViewZones(n=>{i.heightInPx=this._getHeight(),this._viewZoneId=n.addZone(i),this._codeEditor.setScrollTop(e||this._codeEditor.getScrollTop()+i.heightInPx)})}_showViewZone(e=!0){if(!this._isVisible||!this._codeEditor.getOption(L.find).addExtraSpaceOnTop)return;this._viewZone===void 0&&(this._viewZone=new lF(0));const i=this._viewZone;this._codeEditor.changeViewZones(n=>{if(this._viewZoneId!==void 0){const o=this._getHeight();if(o===i.heightInPx)return;const r=o-i.heightInPx;i.heightInPx=o,n.layoutZone(this._viewZoneId),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+r);return}else{let o=this._getHeight();if(o-=this._codeEditor.getOption(L.padding).top,o<=0)return;i.heightInPx=o,this._viewZoneId=n.addZone(i),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+o)}})}_removeViewZone(){this._codeEditor.changeViewZones(e=>{this._viewZoneId!==void 0&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0,this._viewZone&&(this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()-this._viewZone.heightInPx),this._viewZone=void 0))})}_tryUpdateWidgetWidth(){if(!this._isVisible||!this._domNode.isConnected)return;const e=this._codeEditor.getLayoutInfo();if(e.contentWidth<=0){this._domNode.classList.add("hiddenEditor");return}else this._domNode.classList.contains("hiddenEditor")&&this._domNode.classList.remove("hiddenEditor");const i=e.width,n=e.minimap.minimapWidth;let o=!1,r=!1,a=!1;if(this._resized&&$a(this._domNode)>Ol){this._domNode.style.maxWidth=`${i-28-n-15}px`,this._replaceInput.width=$a(this._findInput.domNode);return}if(Ol+28+n>=i&&(r=!0),Ol+28+n-TS>=i&&(a=!0),Ol+28+n-TS>=i+50&&(o=!0),this._domNode.classList.toggle("collapsed-find-widget",o),this._domNode.classList.toggle("narrow-find-widget",a),this._domNode.classList.toggle("reduced-find-widget",r),!a&&!o&&(this._domNode.style.maxWidth=`${i-28-n-15}px`),this._findInput.layout({collapsedFindWidget:o,narrowFindWidget:a,reducedFindWidget:r}),this._resized){const c=this._findInput.inputBox.element.clientWidth;c>0&&(this._replaceInput.width=c)}else this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode))}_getHeight(){let e=0;return e+=4,e+=this._findInput.inputBox.height+2,this._isReplaceVisible&&(e+=4,e+=this._replaceInput.inputBox.height+2),e+=4,e}_tryUpdateHeight(){const e=this._getHeight();return this._cachedHeight!==null&&this._cachedHeight===e?!1:(this._cachedHeight=e,this._domNode.style.height=`${e}px`,!0)}focusFindInput(){this._findInput.select(),this._findInput.focus()}focusReplaceInput(){this._replaceInput.select(),this._replaceInput.focus()}highlightFindOptions(){this._findInput.highlightFindOptions()}_updateSearchScope(){if(this._codeEditor.hasModel()&&this._toggleSelectionFind.checked){const e=this._codeEditor.getSelections();e.map(t=>{t.endColumn===1&&t.endLineNumber>t.startLineNumber&&(t=t.setEndPosition(t.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(t.endLineNumber-1)));const i=this._state.currentMatch;return t.startLineNumber!==t.endLineNumber&&!P.equalsRange(t,i)?t:null}).filter(t=>!!t),e.length&&this._state.change({searchScope:e},!0)}}_onFindInputMouseDown(e){e.middleButton&&e.stopPropagation()}_onFindInputKeyDown(e){if(e.equals($te|S.Enter))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._findInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(S.Tab)){this._isReplaceVisible?this._replaceInput.focus():this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(E.CtrlCmd|S.DownArrow)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(S.UpArrow))return Gte(e,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"));if(e.equals(S.DownArrow))return qte(e,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"))}_onReplaceInputKeyDown(e){if(e.equals($te|S.Enter))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._replaceInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(S.Tab)){this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(E.Shift|S.Tab)){this._findInput.focus(),e.preventDefault();return}if(e.equals(E.CtrlCmd|S.DownArrow)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(S.UpArrow))return Gte(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"));if(e.equals(S.DownArrow))return qte(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"))}getVerticalSashLeft(e){return 0}_keybindingLabelFor(e){const t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:""}_buildDomNode(){const i=this._codeEditor.getOption(L.find).history,n=this._codeEditor.getOption(L.find).replaceHistory;this._findInput=this._register(new gH(null,this._contextViewProvider,{width:_$e,label:s$e,placeholder:o$e,appendCaseSensitiveLabel:this._keybindingLabelFor(Bi.ToggleCaseSensitiveCommand),appendWholeWordsLabel:this._keybindingLabelFor(Bi.ToggleWholeWordCommand),appendRegexLabel:this._keybindingLabelFor(Bi.ToggleRegexCommand),validation:g=>{if(g.length===0||!this._findInput.getRegex())return null;try{return new RegExp(g,"gu"),null}catch(m){return{content:m.message}}},flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showCommonFindToggles:!0,showHistoryHint:()=>WU(this._keybindingService),inputBoxStyles:YT,toggleStyles:Y7,history:i==="workspace"?this._findWidgetSearchHistory:new Set([])},this._contextKeyService)),this._findInput.setRegex(!!this._state.isRegex),this._findInput.setCaseSensitive(!!this._state.matchCase),this._findInput.setWholeWords(!!this._state.wholeWord),this._register(this._findInput.onKeyDown(g=>{g.equals(S.Enter)&&!this._codeEditor.getOption(L.find).findOnType&&this._state.change({searchString:this._findInput.getValue()},!0),this._onFindInputKeyDown(g)})),this._register(this._findInput.inputBox.onDidChange(()=>{this._ignoreChangeEvent||!this._codeEditor.getOption(L.find).findOnType||this._state.change({searchString:this._findInput.getValue()},!0)})),this._register(this._findInput.onDidOptionChange(()=>{this._state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this._findInput.onCaseSensitiveKeyDown(g=>{g.equals(E.Shift|S.Tab)&&this._isReplaceVisible&&(this._replaceInput.focus(),g.preventDefault())})),this._register(this._findInput.onRegexKeyDown(g=>{g.equals(S.Tab)&&this._isReplaceVisible&&(this._replaceInput.focusOnPreserve(),g.preventDefault())})),this._register(this._findInput.inputBox.onDidHeightChange(g=>{this._tryUpdateHeight()&&this._showViewZone()})),vh&&this._register(this._findInput.onMouseDown(g=>this._onFindInputMouseDown(g))),this._matchesCount=document.createElement("div"),this._matchesCount.className="matchesCount",this._updateMatchesCount();const o=this._register(Km());this._prevBtn=this._register(new x_({label:r$e+this._keybindingLabelFor(Bi.PreviousMatchFindAction),icon:t$e,hoverDelegate:o,onTrigger:()=>{Gt(this._codeEditor.getAction(Bi.PreviousMatchFindAction)).run().then(void 0,mt)}},this._hoverService)),this._nextBtn=this._register(new x_({label:a$e+this._keybindingLabelFor(Bi.NextMatchFindAction),icon:i$e,hoverDelegate:o,onTrigger:()=>{Gt(this._codeEditor.getAction(Bi.NextMatchFindAction)).run().then(void 0,mt)}},this._hoverService));const r=document.createElement("div");r.className="find-part",r.appendChild(this._findInput.domNode);const a=document.createElement("div");a.className="find-actions",r.appendChild(a),a.appendChild(this._matchesCount),a.appendChild(this._prevBtn.domNode),a.appendChild(this._nextBtn.domNode),this._toggleSelectionFind=this._register(new rne({icon:Z2e,title:c$e+this._keybindingLabelFor(Bi.ToggleSearchScopeCommand),isChecked:!1,hoverDelegate:o,inputActiveOptionBackground:gt(gq),inputActiveOptionBorder:gt(dse),inputActiveOptionForeground:gt(cse)})),this._register(this._toggleSelectionFind.onChange(()=>{if(this._toggleSelectionFind.checked){if(this._codeEditor.hasModel()){let g=this._codeEditor.getSelections();g=g.map(m=>(m.endColumn===1&&m.endLineNumber>m.startLineNumber&&(m=m.setEndPosition(m.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(m.endLineNumber-1))),m.isEmpty()?null:m)).filter(m=>!!m),g.length&&this._state.change({searchScope:g},!0)}}else this._state.change({searchScope:null},!0)})),a.appendChild(this._toggleSelectionFind.domNode),this._closeBtn=this._register(new x_({label:d$e+this._keybindingLabelFor(Bi.CloseFindWidgetCommand),icon:lse,hoverDelegate:o,onTrigger:()=>{this._state.change({isRevealed:!1,searchScope:null},!1)},onKeyDown:g=>{g.equals(S.Tab)&&this._isReplaceVisible&&(this._replaceBtn.isEnabled()?this._replaceBtn.focus():this._codeEditor.focus(),g.preventDefault())}},this._hoverService)),this._replaceInput=this._register(new pH(null,void 0,{label:l$e,placeholder:h$e,appendPreserveCaseLabel:this._keybindingLabelFor(Bi.TogglePreserveCaseCommand),history:n==="workspace"?this._replaceWidgetHistory:new Set([]),flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showHistoryHint:()=>WU(this._keybindingService),inputBoxStyles:YT,toggleStyles:Y7},this._contextKeyService,!0)),this._replaceInput.setPreserveCase(!!this._state.preserveCase),this._register(this._replaceInput.onKeyDown(g=>this._onReplaceInputKeyDown(g))),this._register(this._replaceInput.inputBox.onDidChange(()=>{this._state.change({replaceString:this._replaceInput.inputBox.value},!1)})),this._register(this._replaceInput.inputBox.onDidHeightChange(g=>{this._isReplaceVisible&&this._tryUpdateHeight()&&this._showViewZone()})),this._register(this._replaceInput.onDidOptionChange(()=>{this._state.change({preserveCase:this._replaceInput.getPreserveCase()},!0)})),this._register(this._replaceInput.onPreserveCaseKeyDown(g=>{g.equals(S.Tab)&&(this._prevBtn.isEnabled()?this._prevBtn.focus():this._nextBtn.isEnabled()?this._nextBtn.focus():this._toggleSelectionFind.enabled?this._toggleSelectionFind.focus():this._closeBtn.isEnabled()&&this._closeBtn.focus(),g.preventDefault())}));const c=this._register(Km());this._replaceBtn=this._register(new x_({label:u$e+this._keybindingLabelFor(Bi.ReplaceOneAction),icon:J2e,hoverDelegate:c,onTrigger:()=>{this._controller.replace()},onKeyDown:g=>{g.equals(E.Shift|S.Tab)&&(this._closeBtn.focus(),g.preventDefault())}},this._hoverService)),this._replaceAllBtn=this._register(new x_({label:g$e+this._keybindingLabelFor(Bi.ReplaceAllAction),icon:e$e,hoverDelegate:c,onTrigger:()=>{this._controller.replaceAll()}},this._hoverService));const d=document.createElement("div");d.className="replace-part",d.appendChild(this._replaceInput.domNode);const l=document.createElement("div");l.className="replace-actions",d.appendChild(l),l.appendChild(this._replaceBtn.domNode),l.appendChild(this._replaceAllBtn.domNode),this._toggleReplaceBtn=this._register(new x_({label:p$e,className:"codicon toggle left",onTrigger:()=>{this._state.change({isReplaceRevealed:!this._isReplaceVisible},!1),this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode),this._replaceInput.inputBox.layout()),this._showViewZone()}},this._hoverService)),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible),this._domNode=document.createElement("div"),this._domNode.className="editor-widget find-widget",this._domNode.setAttribute("aria-hidden","true"),this._domNode.ariaLabel=n$e,this._domNode.role="dialog",this._domNode.style.width=`${Ol}px`,this._domNode.appendChild(this._toggleReplaceBtn.domNode),this._domNode.appendChild(r),this._domNode.appendChild(this._closeBtn.domNode),this._domNode.appendChild(d),this._resizeSash=this._register(new H_(this._domNode,this,{orientation:wt.VERTICAL,size:2})),this._resized=!1;let u=Ol;this._register(this._resizeSash.onDidStart(()=>{u=$a(this._domNode)})),this._register(this._resizeSash.onDidChange(g=>{this._resized=!0;const m=u+g.startX-g.currentX;if(m<Ol)return;const v=parseFloat(Jye(this._domNode).maxWidth)||0;m>v||(this._domNode.style.width=`${m}px`,this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode)),this._findInput.inputBox.layout(),this._tryUpdateHeight())})),this._register(this._resizeSash.onDidReset(()=>{const g=$a(this._domNode);if(g<Ol)return;let m=Ol;if(!this._resized||g===Ol){const v=this._codeEditor.getLayoutInfo();m=v.width-28-v.minimap.minimapWidth-15,this._resized=!0}this._domNode.style.width=`${m}px`,this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode)),this._findInput.inputBox.layout()}))}updateAccessibilitySupport(){const e=this._codeEditor.getOption(L.accessibilitySupport);this._findInput.setFocusInputOnOptionClick(e!==hse.Enabled)}getViewState(){let e=!1;return this._viewZone&&this._viewZoneId&&(e=this._viewZone.heightInPx>this._codeEditor.getScrollTop()),{widgetViewZoneVisible:e,scrollTop:this._codeEditor.getScrollTop()}}setViewState(e){e&&e.widgetViewZoneVisible&&this._layoutViewZone(e.scrollTop)}}class x_ extends uf{constructor(e,t){super(),this._opts=e;let i="button";this._opts.className&&(i=i+" "+this._opts.className),this._opts.icon&&(i=i+" "+Te.asClassName(this._opts.icon)),this._domNode=document.createElement("div"),this._domNode.tabIndex=0,this._domNode.className=i,this._domNode.setAttribute("role","button"),this._domNode.setAttribute("aria-label",this._opts.label),this._register(t.setupManagedHover(e.hoverDelegate??yr("element"),this._domNode,this._opts.label)),this.onclick(this._domNode,n=>{this._opts.onTrigger(),n.preventDefault()}),this.onkeydown(this._domNode,n=>{if(n.equals(S.Space)||n.equals(S.Enter)){this._opts.onTrigger(),n.preventDefault();return}this._opts.onKeyDown?.(n)})}get domNode(){return this._domNode}isEnabled(){return this._domNode.tabIndex>=0}focus(){this._domNode.focus()}setEnabled(e){this._domNode.classList.toggle("disabled",!e),this._domNode.setAttribute("aria-disabled",String(!e)),this._domNode.tabIndex=e?0:-1}setExpanded(e){this._domNode.setAttribute("aria-expanded",String(!!e)),e?(this._domNode.classList.remove(...Te.asClassNameArray(Vte)),this._domNode.classList.add(...Te.asClassNameArray(Hte))):(this._domNode.classList.remove(...Te.asClassNameArray(Hte)),this._domNode.classList.add(...Te.asClassNameArray(Vte)))}}Pv((s,e)=>{const t=s.getColor(Kne);t&&e.addRule(`.monaco-editor .findMatch { border: 1px ${sy(s.type)?"dotted":"solid"} ${t}; box-sizing: border-box; }`);const i=s.getColor(ewe);i&&e.addRule(`.monaco-editor .findScope { border: 1px ${sy(s.type)?"dashed":"solid"} ${i}; }`);const n=s.getColor(et);n&&e.addRule(`.monaco-editor .find-widget { border: 1px solid ${n}; }`);const o=s.getColor(twe);o&&e.addRule(`.monaco-editor .findMatchInline { color: ${o}; }`);const r=s.getColor(iwe);r&&e.addRule(`.monaco-editor .currentFindMatchInline { color: ${r}; }`)});var zg;let iG=class{static{zg=this}static{this.FIND_HISTORY_KEY="workbench.find.history"}static{this._instance=null}static getOrCreate(e){return zg._instance||(zg._instance=new zg(e)),zg._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new M,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){const t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}clear(){this.inMemoryValues.clear(),this.save()}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e;const t=this.storageService.get(zg.FIND_HISTORY_KEY,he.WORKSPACE);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){const e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(zg.FIND_HISTORY_KEY,JSON.stringify(e),he.WORKSPACE,pt.USER),this._onDidChangeEmitter.fire(e),t()})}};iG=zg=f([p(0,tt)],iG);var Kg;let nG=class{static{Kg=this}static{this.FIND_HISTORY_KEY="workbench.replace.history"}static{this._instance=null}static getOrCreate(e){return Kg._instance||(Kg._instance=new Kg(e)),Kg._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new M,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){const t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}clear(){this.inMemoryValues.clear(),this.save()}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e;const t=this.storageService.get(Kg.FIND_HISTORY_KEY,he.WORKSPACE);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){const e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(Kg.FIND_HISTORY_KEY,JSON.stringify(e),he.WORKSPACE,pt.USER),this._onDidChangeEmitter.fire(e),t()})}};nG=Kg=f([p(0,tt)],nG);var sG;const y$e=524288;function oG(s,e="single",t=!1){if(!s.hasModel())return null;const i=s.getSelection();if(e==="single"&&i.startLineNumber===i.endLineNumber||e==="multiple"){if(i.isEmpty()){const n=s.getConfiguredWordAtPosition(i.getStartPosition());if(n&&t===!1)return n.word}else if(s.getModel().getValueLengthInRange(i)<y$e)return s.getModel().getValueInRange(i)}return null}var yd;(function(s){s[s.NoFocusChange=0]="NoFocusChange",s[s.FocusFindInput=1]="FocusFindInput",s[s.FocusReplaceInput=2]="FocusReplaceInput"})(yd||(yd={}));let kr=class extends F{static{sG=this}static{this.ID="editor.contrib.findController"}get editor(){return this._editor}static get(e){return e.getContribution(sG.ID)}constructor(e,t,i,n,o,r){super(),this._editor=e,this._findWidgetVisible=Mg.bindTo(t),this._contextKeyService=t,this._storageService=i,this._clipboardService=n,this._notificationService=o,this._hoverService=r,this._updateHistoryDelayer=new tg(500),this._state=this._register(new Q2e),this.loadQueryState(),this._register(this._state.onFindReplaceStateChange(a=>this._onStateChanged(a))),this._model=null,this._register(this._editor.onDidChangeModel(()=>{const a=this._editor.getModel()&&this._state.isRevealed;this.disposeModel(),this._state.change({searchScope:null,matchCase:this._storageService.getBoolean("editor.matchCase",he.WORKSPACE,!1),wholeWord:this._storageService.getBoolean("editor.wholeWord",he.WORKSPACE,!1),isRegex:this._storageService.getBoolean("editor.isRegex",he.WORKSPACE,!1),preserveCase:this._storageService.getBoolean("editor.preserveCase",he.WORKSPACE,!1)},!1),a&&this._start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:yd.NoFocusChange,shouldAnimate:!1,updateSearchScope:!1,loop:this._editor.getOption(L.find).loop})}))}dispose(){this.disposeModel(),super.dispose()}disposeModel(){this._model&&(this._model.dispose(),this._model=null)}_onStateChanged(e){this.saveQueryState(e),e.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel())),e.searchString&&this.setGlobalBufferTerm(this._state.searchString)}saveQueryState(e){e.isRegex&&this._storageService.store("editor.isRegex",this._state.actualIsRegex,he.WORKSPACE,pt.MACHINE),e.wholeWord&&this._storageService.store("editor.wholeWord",this._state.actualWholeWord,he.WORKSPACE,pt.MACHINE),e.matchCase&&this._storageService.store("editor.matchCase",this._state.actualMatchCase,he.WORKSPACE,pt.MACHINE),e.preserveCase&&this._storageService.store("editor.preserveCase",this._state.actualPreserveCase,he.WORKSPACE,pt.MACHINE)}loadQueryState(){this._state.change({matchCase:this._storageService.getBoolean("editor.matchCase",he.WORKSPACE,this._state.matchCase),wholeWord:this._storageService.getBoolean("editor.wholeWord",he.WORKSPACE,this._state.wholeWord),isRegex:this._storageService.getBoolean("editor.isRegex",he.WORKSPACE,this._state.isRegex),preserveCase:this._storageService.getBoolean("editor.preserveCase",he.WORKSPACE,this._state.preserveCase)},!1)}isFindInputFocused(){return!!k1.getValue(this._contextKeyService)}getState(){return this._state}closeFindWidget(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()}toggleCaseSensitive(){this._state.change({matchCase:!this._state.matchCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleWholeWords(){this._state.change({wholeWord:!this._state.wholeWord},!1),this._state.isRevealed||this.highlightFindOptions()}toggleRegex(){this._state.change({isRegex:!this._state.isRegex},!1),this._state.isRevealed||this.highlightFindOptions()}togglePreserveCase(){this._state.change({preserveCase:!this._state.preserveCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleSearchScope(){if(this._state.searchScope)this._state.change({searchScope:null},!0);else if(this._editor.hasModel()){let e=this._editor.getSelections();e=e.map(t=>(t.endColumn===1&&t.endLineNumber>t.startLineNumber&&(t=t.setEndPosition(t.endLineNumber-1,this._editor.getModel().getLineMaxColumn(t.endLineNumber-1))),t.isEmpty()?null:t)).filter(t=>!!t),e.length&&this._state.change({searchScope:e},!0)}}setSearchString(e){this._state.isRegex&&(e=ny(e)),this._state.change({searchString:e},!1)}highlightFindOptions(e=!1){}async _start(e,t){if(this.disposeModel(),!this._editor.hasModel())return;const i={...t,isRevealed:!0};if(e.seedSearchStringFromSelection==="single"){const n=oG(this._editor,e.seedSearchStringFromSelection,e.seedSearchStringFromNonEmptySelection);n&&(this._state.isRegex?i.searchString=ny(n):i.searchString=n)}else if(e.seedSearchStringFromSelection==="multiple"&&!e.updateSearchScope){const n=oG(this._editor,e.seedSearchStringFromSelection);n&&(i.searchString=n)}if(!i.searchString&&e.seedSearchStringFromGlobalClipboard){const n=await this.getGlobalBufferTerm();if(!this._editor.hasModel())return;n&&(i.searchString=n)}if(e.forceRevealReplace||i.isReplaceRevealed?i.isReplaceRevealed=!0:this._findWidgetVisible.get()||(i.isReplaceRevealed=!1),e.updateSearchScope){const n=this._editor.getSelections();n.some(o=>!o.isEmpty())&&(i.searchScope=n)}i.loop=e.loop,this._state.change(i,!1),this._model||(this._model=new lE(this._editor,this._state))}start(e,t){return this._start(e,t)}moveToNextMatch(){return this._model?(this._model.moveToNextMatch(),!0):!1}moveToPrevMatch(){return this._model?(this._model.moveToPrevMatch(),!0):!1}goToMatch(e){return this._model?(this._model.moveToMatch(e),!0):!1}replace(){return this._model?(this._model.replace(),!0):!1}replaceAll(){return this._model?this._editor.getModel()?.isTooLargeForHeapOperation()?(this._notificationService.warn(h(1006,"The file is too large to perform a replace all operation.")),!1):(this._model.replaceAll(),!0):!1}selectAllMatches(){return this._model?(this._model.selectAllMatches(),this._editor.focus(),!0):!1}async getGlobalBufferTerm(){return this._editor.getOption(L.find).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()?this._clipboardService.readFindText():""}setGlobalBufferTerm(e){this._editor.getOption(L.find).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()&&this._clipboardService.writeFindText(e)}};kr=sG=f([p(1,me),p(2,tt),p(3,Is),p(4,At),p(5,wi)],kr);let rG=class extends kr{constructor(e,t,i,n,o,r,a,c){super(e,i,r,a,o,c),this._contextViewService=t,this._keybindingService=n,this._widget=null,this._findOptionsWidget=null,this._findWidgetSearchHistory=iG.getOrCreate(r),this._replaceWidgetHistory=nG.getOrCreate(r)}async _start(e,t){this._widget||this._createFindWidget();const i=this._editor.getSelection();let n=!1;switch(this._editor.getOption(L.find).autoFindInSelection){case"always":n=!0;break;case"never":n=!1;break;case"multiline":{n=!!i&&i.startLineNumber!==i.endLineNumber;break}}e.updateSearchScope=e.updateSearchScope||n,await super._start(e,t),this._widget&&(e.shouldFocus===yd.FocusReplaceInput?this._widget.focusReplaceInput():e.shouldFocus===yd.FocusFindInput&&this._widget.focusFindInput())}highlightFindOptions(e=!1){this._widget||this._createFindWidget(),this._state.isRevealed&&!e?this._widget.highlightFindOptions():this._findOptionsWidget.highlightFindOptions()}_createFindWidget(){this._widget=this._register(new f5(this._editor,this,this._state,this._contextViewService,this._keybindingService,this._contextKeyService,this._hoverService,this._findWidgetSearchHistory,this._replaceWidgetHistory)),this._findOptionsWidget=this._register(new p5(this._editor,this._state,this._keybindingService))}saveViewState(){return this._widget?.getViewState()}restoreViewState(e){this._widget?.setViewState(e)}};rG=f([p(1,cf),p(2,me),p(3,Ve),p(4,At),p(5,tt),p(6,Is),p(7,wi)],rG);const w$e=use(new gse({id:Bi.StartFindAction,label:I(1007,"Find"),precondition:x.or(V.focus,x.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:E.CtrlCmd|S.KeyF,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"3_find",title:h(1008,"&&Find"),order:1}}));w$e.addImplementation(0,(s,e,t)=>{const i=kr.get(e);return i?i.start({forceRevealReplace:!1,seedSearchStringFromSelection:e.getOption(L.find).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:e.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:e.getOption(L.find).globalFindClipboard,shouldFocus:yd.FocusFindInput,shouldAnimate:!0,updateSearchScope:!1,loop:e.getOption(L.find).loop}):!1});const S$e={description:"Open a new In-Editor Find Widget.",args:[{name:"Open a new In-Editor Find Widget args",schema:{properties:{searchString:{type:"string"},replaceString:{type:"string"},isRegex:{type:"boolean"},matchWholeWord:{type:"boolean"},isCaseSensitive:{type:"boolean"},preserveCase:{type:"boolean"},findInSelection:{type:"boolean"}}}}]};class C$e extends we{constructor(){super({id:Bi.StartFindWithArgs,label:I(1009,"Find with Arguments"),precondition:void 0,kbOpts:{kbExpr:null,primary:0,weight:W.EditorContrib},metadata:S$e})}async run(e,t,i){const n=kr.get(t);if(n){const o=i?{searchString:i.searchString,replaceString:i.replaceString,isReplaceRevealed:i.replaceString!==void 0,isRegex:i.isRegex,wholeWord:i.matchWholeWord,matchCase:i.isCaseSensitive,preserveCase:i.preserveCase}:{};await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:n.getState().searchString.length===0&&t.getOption(L.find).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:t.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:yd.FocusFindInput,shouldAnimate:!0,updateSearchScope:i?.findInSelection||!1,loop:t.getOption(L.find).loop},o),n.setGlobalBufferTerm(n.getState().searchString)}}}class E$e extends we{constructor(){super({id:Bi.StartFindWithSelection,label:I(1010,"Find with Selection"),precondition:void 0,kbOpts:{kbExpr:null,primary:0,mac:{primary:E.CtrlCmd|S.KeyE},weight:W.EditorContrib}})}async run(e,t){const i=kr.get(t);i&&(await i.start({forceRevealReplace:!1,seedSearchStringFromSelection:"multiple",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:yd.NoFocusChange,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(L.find).loop}),i.setGlobalBufferTerm(i.getState().searchString))}}class lpe extends we{async run(e,t){const i=kr.get(t);i&&!this._run(i)&&(await i.start({forceRevealReplace:!1,seedSearchStringFromSelection:i.getState().searchString.length===0&&t.getOption(L.find).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:t.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:yd.NoFocusChange,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(L.find).loop}),this._run(i))}}class x$e extends lpe{constructor(){super({id:Bi.NextMatchFindAction,label:I(1011,"Find Next"),precondition:void 0,kbOpts:[{kbExpr:V.focus,primary:S.F3,mac:{primary:E.CtrlCmd|S.KeyG,secondary:[S.F3]},weight:W.EditorContrib},{kbExpr:x.and(V.focus,k1),primary:S.Enter,weight:W.EditorContrib}]})}_run(e){return e.moveToNextMatch()?(e.editor.pushUndoStop(),!0):!1}}class I$e extends lpe{constructor(){super({id:Bi.PreviousMatchFindAction,label:I(1012,"Find Previous"),precondition:void 0,kbOpts:[{kbExpr:V.focus,primary:E.Shift|S.F3,mac:{primary:E.CtrlCmd|E.Shift|S.KeyG,secondary:[E.Shift|S.F3]},weight:W.EditorContrib},{kbExpr:x.and(V.focus,k1),primary:E.Shift|S.Enter,weight:W.EditorContrib}]})}_run(e){return e.moveToPrevMatch()}}class D$e extends we{constructor(){super({id:Bi.GoToMatchFindAction,label:I(1013,"Go to Match..."),precondition:Mg}),this._highlightDecorations=[]}run(e,t,i){const n=kr.get(t);if(!n)return;const o=n.getState().matchesCount;if(o<1){e.get(At).notify({severity:Me.Warning,message:h(1014,"No matches. Try searching for something else.")});return}const r=e.get(zt),a=new U,c=a.add(r.createInputBox());c.placeholder=h(1015,"Type a number to go to a specific match (between 1 and {0})",o);const d=u=>{const g=parseInt(u);if(isNaN(g))return;const m=n.getState().matchesCount;if(g>0&&g<=m)return g-1;if(g<0&&g>=-m)return m+g},l=u=>{const g=d(u);if(typeof g=="number"){c.validationMessage=void 0,n.goToMatch(g);const m=n.getState().currentMatch;m&&this.addDecorations(t,m)}else c.validationMessage=h(1016,"Please type a number between 1 and {0}",n.getState().matchesCount),this.clearDecorations(t)};a.add(c.onDidChangeValue(u=>{l(u)})),a.add(c.onDidAccept(()=>{const u=d(c.value);typeof u=="number"?(n.goToMatch(u),c.hide()):c.validationMessage=h(1016,"Please type a number between 1 and {0}",n.getState().matchesCount)})),a.add(c.onDidHide(()=>{this.clearDecorations(t),a.dispose()})),c.show()}clearDecorations(e){e.changeDecorations(t=>{this._highlightDecorations=t.deltaDecorations(this._highlightDecorations,[])})}addDecorations(e,t){e.changeDecorations(i=>{this._highlightDecorations=i.deltaDecorations(this._highlightDecorations,[{range:t,options:{description:"find-match-quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:t,options:{description:"find-match-quick-access-range-highlight-overview",overviewRuler:{color:es(pse),position:ol.Full}}}])})}}class hpe extends we{async run(e,t){const i=kr.get(t);if(!i)return;const n=oG(t,"single",!1);n&&i.setSearchString(n),this._run(i)||(await i.start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:yd.NoFocusChange,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(L.find).loop}),this._run(i))}}class k$e extends hpe{constructor(){super({id:Bi.NextSelectionMatchFindAction,label:I(1017,"Find Next Selection"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|S.F3,weight:W.EditorContrib}})}_run(e){return e.moveToNextMatch()}}class T$e extends hpe{constructor(){super({id:Bi.PreviousSelectionMatchFindAction,label:I(1018,"Find Previous Selection"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|E.Shift|S.F3,weight:W.EditorContrib}})}_run(e){return e.moveToPrevMatch()}}const A$e=use(new gse({id:Bi.StartFindReplaceAction,label:I(1019,"Replace"),precondition:x.or(V.focus,x.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:E.CtrlCmd|S.KeyH,mac:{primary:E.CtrlCmd|E.Alt|S.KeyF},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"3_find",title:h(1020,"&&Replace"),order:2}}));A$e.addImplementation(0,(s,e,t)=>{if(!e.hasModel()||e.getOption(L.readOnly))return!1;const i=kr.get(e);if(!i)return!1;const n=e.getSelection(),o=i.isFindInputFocused(),r=!n.isEmpty()&&n.startLineNumber===n.endLineNumber&&e.getOption(L.find).seedSearchStringFromSelection!=="never"&&!o,a=o||r?yd.FocusReplaceInput:yd.FocusFindInput;return i.start({forceRevealReplace:!0,seedSearchStringFromSelection:r?"single":"none",seedSearchStringFromNonEmptySelection:e.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:e.getOption(L.find).seedSearchStringFromSelection!=="never",shouldFocus:a,shouldAnimate:!0,updateSearchScope:!1,loop:e.getOption(L.find).loop})});Rt(kr.ID,rG,vt.Eager);ue(C$e);ue(E$e);ue(x$e);ue(I$e);ue(D$e);ue(k$e);ue(T$e);const Al=No.bindToContribution(kr.get);Ue(new Al({id:Bi.CloseFindWidgetCommand,precondition:Mg,handler:s=>s.closeFindWidget(),kbOpts:{weight:W.EditorContrib+5,kbExpr:x.and(V.focus,x.not("isComposing")),primary:S.Escape,secondary:[E.Shift|S.Escape]}}));Ue(new Al({id:Bi.ToggleCaseSensitiveCommand,precondition:void 0,handler:s=>s.toggleCaseSensitive(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:rk.primary,mac:rk.mac,win:rk.win,linux:rk.linux}}));Ue(new Al({id:Bi.ToggleWholeWordCommand,precondition:void 0,handler:s=>s.toggleWholeWords(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:ak.primary,mac:ak.mac,win:ak.win,linux:ak.linux}}));Ue(new Al({id:Bi.ToggleRegexCommand,precondition:void 0,handler:s=>s.toggleRegex(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:ck.primary,mac:ck.mac,win:ck.win,linux:ck.linux}}));Ue(new Al({id:Bi.ToggleSearchScopeCommand,precondition:void 0,handler:s=>s.toggleSearchScope(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:dk.primary,mac:dk.mac,win:dk.win,linux:dk.linux}}));Ue(new Al({id:Bi.TogglePreserveCaseCommand,precondition:void 0,handler:s=>s.togglePreserveCase(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:lk.primary,mac:lk.mac,win:lk.win,linux:lk.linux}}));Ue(new Al({id:Bi.ReplaceOneAction,precondition:Mg,handler:s=>s.replace(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:E.CtrlCmd|E.Shift|S.Digit1}}));Ue(new Al({id:Bi.ReplaceOneAction,precondition:Mg,handler:s=>s.replace(),kbOpts:{weight:W.EditorContrib+5,kbExpr:x.and(V.focus,g5),primary:S.Enter}}));Ue(new Al({id:Bi.ReplaceAllAction,precondition:Mg,handler:s=>s.replaceAll(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:E.CtrlCmd|E.Alt|S.Enter}}));Ue(new Al({id:Bi.ReplaceAllAction,precondition:Mg,handler:s=>s.replaceAll(),kbOpts:{weight:W.EditorContrib+5,kbExpr:x.and(V.focus,g5),primary:void 0,mac:{primary:E.CtrlCmd|S.Enter}}}));Ue(new Al({id:Bi.SelectAllMatchesAction,precondition:Mg,handler:s=>s.selectAllMatches(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:E.Alt|S.Enter}}));class R$e extends we{constructor(){super({id:"editor.action.fontZoomIn",label:I(1076,"Increase Editor Font Size"),precondition:void 0})}run(e,t){PE.setZoomLevel(PE.getZoomLevel()+1)}}class P$e extends we{constructor(){super({id:"editor.action.fontZoomOut",label:I(1077,"Decrease Editor Font Size"),precondition:void 0})}run(e,t){PE.setZoomLevel(PE.getZoomLevel()-1)}}class L$e extends we{constructor(){super({id:"editor.action.fontZoomReset",label:I(1078,"Reset Editor Font Size"),precondition:void 0})}run(e,t){PE.setZoomLevel(0)}}ue(R$e);ue(P$e);ue(L$e);let aM=class{static{this.ID="editor.contrib.autoFormat"}constructor(e,t,i,n){this._editor=e,this._languageFeaturesService=t,this._workerService=i,this._accessibilitySignalService=n,this._disposables=new U,this._sessionDisposables=new U,this._disposables.add(t.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(o=>{o.hasChanged(L.formatOnType)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(L.formatOnType)||!this._editor.hasModel())return;const e=this._editor.getModel(),[t]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;const i=new GT;for(const n of t.autoFormatTriggerCharacters)i.add(n.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(n=>{const o=n.charCodeAt(n.length-1);i.has(o)&&this._trigger(String.fromCharCode(o))}))}_trigger(e){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;const t=this._editor.getModel(),i=this._editor.getPosition(),n=new ri,o=this._editor.onDidChangeModelContent(r=>{if(r.isFlush){n.cancel(),o.dispose();return}for(let a=0,c=r.changes.length;a<c;a++)if(r.changes[a].range.endLineNumber<=i.lineNumber){n.cancel(),o.dispose();return}});GSe(this._workerService,this._languageFeaturesService,t,i,e,t.getFormattingOptions(),n.token).then(r=>{n.token.isCancellationRequested||xn(r)&&(this._accessibilitySignalService.playSignal(Up.format,{userGesture:!1}),qSe.execute(this._editor,r,!0))}).finally(()=>{o.dispose()})}};aM=f([p(1,Ne),p(2,vc),p(3,cI)],aM);let cM=class{static{this.ID="editor.contrib.formatOnPaste"}constructor(e,t,i){this.editor=e,this._languageFeaturesService=t,this._instantiationService=i,this._callOnDispose=new U,this._callOnModel=new U,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(t.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(L.formatOnPaste)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(gN,this.editor,e,Pu.Silent,Jc.None,ye.None,!1).catch(mt))}};cM=f([p(1,Ne),p(2,J)],cM);class M$e extends we{constructor(){super({id:"editor.action.formatDocument",label:I(1079,"Format Document"),precondition:x.and(V.notInCompositeEditor,V.writable,V.hasDocumentFormattingProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyF,linux:{primary:E.CtrlCmd|E.Shift|S.KeyI},weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:1.3}})}async run(e,t){if(t.hasModel()){const i=e.get(J);await e.get(ju).showWhile(i.invokeFunction(jF,t,Pu.Explicit,Jc.None,ye.None,!0),250)}}}class N$e extends we{constructor(){super({id:"editor.action.formatSelection",label:I(1080,"Format Selection"),precondition:x.and(V.writable,V.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyF),weight:W.EditorContrib},contextMenuOpts:{when:V.hasNonEmptySelection,group:"1_modification",order:1.31}})}async run(e,t){if(!t.hasModel())return;const i=e.get(J),n=t.getModel(),o=t.getSelections().map(a=>a.isEmpty()?new P(a.startLineNumber,1,a.startLineNumber,n.getLineMaxColumn(a.startLineNumber)):a);await e.get(ju).showWhile(i.invokeFunction(gN,t,o,Pu.Explicit,Jc.None,ye.None,!0),250)}}Rt(aM.ID,aM,vt.BeforeFirstInteraction);Rt(cM.ID,cM,vt.BeforeFirstInteraction);ue(M$e);ue(N$e);Ce.registerCommand("editor.action.format",async s=>{const e=s.get(Ot).getFocusedCodeEditor();if(!e||!e.hasModel())return;const t=s.get(qe);e.getSelection().isEmpty()?await t.executeCommand("editor.action.formatDocument"):await t.executeCommand("editor.action.formatSelection")});Ce.registerCommand("_executeDocumentSymbolProvider",async function(s,...e){const[t]=e;St(R.isUri(t));const i=s.get(kI),o=await s.get(yi).createModelReference(t);try{return(await i.getOrCreate(o.object.textEditorModel,ye.None)).getTopLevelSymbols()}finally{o.dispose()}});class m5 extends we{static{this.ID=mde}constructor(){super({id:m5.ID,label:I(1237,"Show Next Inline Suggestion"),precondition:x.and(V.writable,Ti.inlineSuggestionVisible),kbOpts:{weight:100,primary:E.Alt|S.BracketRight}})}async run(e,t){Ks.get(t)?.model.get()?.next()}}class v5 extends we{static{this.ID=fde}constructor(){super({id:v5.ID,label:I(1238,"Show Previous Inline Suggestion"),precondition:x.and(V.writable,Ti.inlineSuggestionVisible),kbOpts:{weight:100,primary:E.Alt|S.BracketLeft}})}async run(e,t){Ks.get(t)?.model.get()?.previous()}}class O$e extends we{constructor(){super({id:"editor.action.inlineSuggest.trigger",label:I(1239,"Trigger Inline Suggestion"),precondition:V.writable})}async run(e,t){const i=Ks.get(t);await nwe(async n=>{await i?.model.get()?.triggerExplicitly(n),i?.playAccessibilitySignal(n)})}}class F$e extends we{constructor(){super({id:"editor.action.inlineSuggest.triggerInlineEditExplicit",label:I(1240,"Trigger Next Edit Suggestion"),precondition:V.writable})}async run(e,t){const i=e.get(At),n=Ks.get(t);await n?.model.get()?.triggerExplicitly(void 0,!0),n?.model.get()?.inlineEditAvailable.get()||i.notify({severity:Me.Info,message:h(1241,"No inline edit is available.")})}}class W$e extends No{constructor(){super({id:"editor.action.inlineSuggest.triggerInlineEdit",precondition:V.writable})}async runEditorCommand(e,t,i){await Ks.get(t)?.model.get()?.trigger(void 0,{onlyFetchInlineEdits:!0})}}class B$e extends we{constructor(){super({id:"editor.action.inlineSuggest.acceptNextWord",label:I(1242,"Accept Next Word Of Inline Suggestion"),precondition:x.and(V.writable,Ti.inlineSuggestionVisible),kbOpts:{weight:W.EditorContrib+1,primary:E.CtrlCmd|S.RightArrow,kbExpr:x.and(V.writable,Ti.inlineSuggestionVisible,lI.negate())},menuOpts:[{menuId:N.InlineSuggestionToolbar,title:h(1243,"Accept Word"),group:"primary",order:2}]})}async run(e,t){await Ks.get(t)?.model.get()?.acceptNextWord()}}class V$e extends we{constructor(){super({id:"editor.action.inlineSuggest.acceptNextLine",label:I(1244,"Accept Next Line Of Inline Suggestion"),precondition:x.and(V.writable,Ti.inlineSuggestionVisible),kbOpts:{weight:W.EditorContrib+1},menuOpts:[{menuId:N.InlineSuggestionToolbar,title:h(1245,"Accept Line"),group:"secondary",order:2}]})}async run(e,t){await Ks.get(t)?.model.get()?.acceptNextLine()}}class H$e extends we{constructor(){super({id:lx,label:I(1246,"Accept Inline Suggestion"),precondition:x.or(Ti.inlineSuggestionVisible,Ti.inlineEditVisible),menuOpts:[{menuId:N.InlineSuggestionToolbar,title:h(1247,"Accept"),group:"primary",order:2},{menuId:N.InlineEditsActions,title:h(1247,"Accept"),group:"primary",order:2}],kbOpts:[{primary:S.Tab,weight:200,kbExpr:x.or(x.and(Ti.inlineSuggestionVisible,V.tabMovesFocus.toNegated(),ut.Visible.toNegated(),V.hoverFocused.toNegated(),Ti.inlineSuggestionHasIndentationLessThanTabSize),x.and(Ti.inlineEditVisible,V.tabMovesFocus.toNegated(),ut.Visible.toNegated(),V.hoverFocused.toNegated(),Ti.tabShouldAcceptInlineEdit))}]})}async run(e,t){const i=Ks.getInFocusedEditorOrParent(e);i&&(i.model.get()?.accept(i.editor),i.editor.focus())}}Le.registerKeybindingRule({id:lx,weight:202,primary:S.Tab,when:x.and(Ti.inInlineEditsPreviewEditor)});class U$e extends we{constructor(){super({id:RPe,label:I(1248,"Jump to next inline edit"),precondition:Ti.inlineEditVisible,menuOpts:[{menuId:N.InlineEditsActions,title:h(1249,"Jump"),group:"primary",order:1,when:Ti.cursorAtInlineEdit.toNegated()}],kbOpts:{primary:S.Tab,weight:201,kbExpr:x.and(Ti.inlineEditVisible,V.tabMovesFocus.toNegated(),ut.Visible.toNegated(),V.hoverFocused.toNegated(),Ti.tabShouldJumpToInlineEdit)}})}async run(e,t){const i=Ks.get(t);i&&i.jump()}}class T1 extends we{static{this.ID=vde}constructor(){super({id:T1.ID,label:I(1250,"Hide Inline Suggestion"),precondition:x.or(Ti.inlineSuggestionVisible,Ti.inlineEditVisible),kbOpts:{weight:W.EditorContrib+90,primary:S.Escape},menuOpts:[{menuId:N.InlineEditsActions,title:h(1251,"Reject"),group:"primary",order:3}]})}async run(e,t){const i=Ks.getInFocusedEditorOrParent(e);ys(n=>{i?.model.get()?.stop("explicitCancel",n)}),i?.editor.focus()}}class _5 extends we{static{this.ID=QV}constructor(){super({id:_5.ID,label:I(1252,"Toggle Inline Suggestions Show Collapsed"),precondition:x.true()})}async run(e,t){const i=e.get(ne),n=i.getValue("editor.inlineSuggest.edits.showCollapsed");i.updateValue("editor.inlineSuggest.edits.showCollapsed",!n)}}Le.registerKeybindingRule({id:T1.ID,weight:-1,primary:S.Escape,secondary:[E.Shift|S.Escape],when:x.and(Ti.inInlineEditsPreviewEditor)});class b5 extends X{static{this.ID="editor.action.inlineSuggest.toggleAlwaysShowToolbar"}constructor(){super({id:b5.ID,title:h(1253,"Always Show Toolbar"),f1:!1,precondition:void 0,menu:[{id:N.InlineSuggestionToolbar,group:"secondary",order:10}],toggled:x.equals("config.editor.inlineSuggest.showToolbar","always")})}async run(e){const t=e.get(ne),n=t.getValue("editor.inlineSuggest.showToolbar")==="always"?"onHover":"always";t.updateValue("editor.inlineSuggest.showToolbar",n)}}class $$e extends we{constructor(){super({id:"editor.action.inlineSuggest.dev.extractRepro",label:h(1254,"Developer: Extract Inline Suggest State"),alias:"Developer: Inline Suggest Extract Repro",precondition:x.or(Ti.inlineEditVisible,Ti.inlineSuggestionVisible)})}async run(e,t){const i=e.get(Is),o=Ks.get(t)?.model.get();if(!o)return;const r=o.extractReproSample(),c=Ih(JSON.stringify({inlineCompletion:r.inlineCompletion},null,4)).map(l=>"// "+l).join(`
`),d=`${r.documentValue}

// <json>
${c}
// </json>
`;return await i.writeText(d),{reproCase:d}}}class G$e{constructor(e,t,i){this.owner=e,this.range=t,this.controller=i}isValidForHoverAnchor(e){return e.type===Qo.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}let aG=class{constructor(e,t,i,n,o,r){this._editor=e,this._languageService=t,this._openerService=i,this.accessibilityService=n,this._instantiationService=o,this._telemetryService=r,this.hoverOrdinal=4}suggestHoverAnchor(e){const t=Ks.get(this._editor);if(!t)return null;const i=e.target;if(i.type===Ei.CONTENT_VIEW_ZONE){const n=i.detail;if(t.shouldShowHoverAtViewZone(n.viewZoneId))return new qS(1e3,this,P.fromPositions(this._editor.getModel().validatePosition(n.positionBefore||n.position)),e.event.posx,e.event.posy,!1)}if(i.type===Ei.CONTENT_EMPTY&&t.shouldShowHoverAt(i.range))return new qS(1e3,this,i.range,e.event.posx,e.event.posy,!1);if(i.type===Ei.CONTENT_TEXT&&i.detail.mightBeForeignElement&&t.shouldShowHoverAt(i.range))return new qS(1e3,this,i.range,e.event.posx,e.event.posy,!1);if(i.type===Ei.CONTENT_WIDGET&&i.element){const n=Wx.getWarningWidgetContext(i.element);if(n&&t.shouldShowHoverAt(n.range))return new qS(1e3,this,n.range,e.event.posx,e.event.posy,!1)}return null}computeSync(e,t){if(this._editor.getOption(L.inlineSuggest).showToolbar!=="onHover")return[];const i=Ks.get(this._editor);return i&&i.shouldShowHoverAt(e.range)?[new G$e(this,e.range,i)]:[]}renderHoverParts(e,t){const i=new U,n=t[0];this._telemetryService.publicLog2("inlineCompletionHover.shown"),this.accessibilityService.isScreenReaderOptimized()&&!this._editor.getOption(L.screenReaderAnnounceInlineSuggestion)&&i.add(this.renderScreenReaderText(e,n));const o=n.controller.model.get(),r=document.createElement("div");e.fragment.appendChild(r),i.add(Da((c,d)=>{const l=d.add(this._instantiationService.createInstance(By.hot.read(c),this._editor,!1,Fi(null),o.selectedInlineCompletionIndex,o.inlineCompletionsCount,o.activeCommands,o.warning,()=>{e.onContentsChanged()}));r.replaceChildren(l.getDomNode())})),o.triggerExplicitly();const a={hoverPart:n,hoverElement:r,dispose(){i.dispose()}};return new hv([a])}getAccessibleContent(e){return h(1267,"There are inline completions here")}renderScreenReaderText(e,t){const i=new U,n=Y,o=n("div.hover-row.markdown-hover"),r=ee(o,n("div.hover-contents",{"aria-live":"assertive"})),a=new Rv({editor:this._editor},this._languageService,this._openerService),c=d=>{const l=h(1268,"Suggestion:"),u=i.add(a.render(new Ni().appendText(l).appendCodeblock("text",d),{asyncRenderCallback:()=>{r.className="hover-contents code-hover-contents",e.onContentsChanged()}}));r.replaceChildren(u.element)};return i.add(ki(d=>{const l=t.controller.model.read(d)?.primaryGhostText.read(d);if(l){const u=this._editor.getModel().getLineContent(l.lineNumber);c(l.renderForScreenReader(u))}else ig(r)})),e.fragment.appendChild(o),i}};aG=f([p(1,fi),p(2,hi),p(3,Tr),p(4,J),p(5,li)],aG);class q$e{constructor(){this.type=fc.View,this.priority=95,this.name="inline-completions",this.when=x.or(Ti.inlineSuggestionVisible,Ti.inlineEditVisible)}getProvider(e){const t=e.get(Ot),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)return;const n=Ks.get(i)?.model.get();if(n?.state.get())return new z$e(i,n)}}class z$e extends F{constructor(e,t){super(),this._editor=e,this._model=t,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this.id=sa.InlineCompletions,this.verbositySettingKey="accessibility.verbosity.inlineCompletions",this.options={language:this._editor.getModel()?.getLanguageId()??void 0,type:fc.View}}provideContent(){const e=this._model.state.get();if(!e)throw new Error("Inline completion is visible but state is not available");if(e.kind==="ghostText"){const t=this._model.textModel.getLineContent(e.primaryGhostText.lineNumber),i=e.primaryGhostText.renderForScreenReader(t);if(!i)throw new Error("Inline completion is visible but ghost text is not available");return t+i}else{const t=new dy(this._model.textModel);return _u.fromTextEdit(new hc(e.edits),t).humanReadablePatch(t.getLines())}}provideNextContent(){this._model.next().then(()=>this._onDidChangeContent.fire())}providePreviousContent(){this._model.previous().then(()=>this._onDidChangeContent.fire())}onClose(){this._model.stop(),this._editor.focus()}}var wT;let dM=class extends F{static{wT=this}static{this.ID="editor.contrib.inlineEditsAdapter"}static{this.isFirst=!0}constructor(e,t){super(),this.instantiationService=t,wT.isFirst&&(wT.isFirst=!1,this.instantiationService.createInstance(cG))}};dM=wT=f([p(1,J)],dM);let cG=class extends F{constructor(e,t){super(),this._languageFeaturesService=e,this._commandService=t;const i=AE("didChangeSignal",this._languageFeaturesService.inlineEditProvider.onDidChange);this._register(Da((n,o)=>{i.read(n),o.add(this._languageFeaturesService.inlineCompletionsProvider.register("*",{async provideInlineCompletions(r,a,c,d){if(!c.includeInlineEdits)return;const l=e.inlineEditProvider.all(r),g=(await Promise.all(l.map(async m=>{const v=await m.provideInlineEdit(r,{triggerKind:swe.Automatic,requestUuid:c.requestUuid},d);if(v)return{result:v,provider:m}}))).filter(m=>!!m);return{edits:g,items:g.map(m=>({range:m.result.range,showRange:m.result.showRange,insertText:m.result.text,command:m.result.accepted,shownCommand:m.result.shown,action:m.result.action,isInlineEdit:!0,edit:m.result})),commands:g.flatMap(m=>m.result.commands??[]),enableForwardStability:!0}},handleRejection:(r,a)=>{a.edit.rejected&&this._commandService.executeCommand(a.edit.rejected.id,...a.edit.rejected.arguments??[])},freeInlineCompletions(r){for(const a of r.edits)a.provider.freeInlineEdit(a.result)},toString(){return"InlineEditsAdapter"}}))}))}};cG=f([p(0,Ne),p(1,qe)],cG);Rt(dM.ID,dM,vt.Eventually);Rt(Ks.ID,OBe(Ks.hot),vt.Eventually);ue(O$e);ue(F$e);Ue(new W$e);ue(m5);ue(v5);ue(B$e);ue(V$e);ue(H$e);ue(_5);ue(T1);ue(U$e);K(b5);ue($$e);s_.register(aG);yD.register(new q$e);const K$e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var nC;Be(K$e);let Ux=class{static{nC=this}static{this.ID="editor.contrib.gotodefinitionatposition"}static{this.MAX_SOURCE_PREVIEW_LINES=8}constructor(e,t,i,n){this.textModelResolverService=t,this.languageService=i,this.languageFeaturesService=n,this.toUnhook=new U,this.toUnhookForKeyboard=new U,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();const o=new zN(e);this.toUnhook.add(o),this.toUnhook.add(o.onMouseMoveOrRelevantKeyDown(([r,a])=>{this.startFindDefinitionFromMouse(r,a??void 0)})),this.toUnhook.add(o.onExecute(r=>{this.isEnabled(r)&&this.gotoDefinition(r.target.position,r.hasSideBySideModifier).catch(a=>{mt(a)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(o.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(e){return e.getContribution(nC.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(t=>{t&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))}startFindDefinitionFromMouse(e,t){if(e.target.type===Ei.CONTENT_WIDGET&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}const i=e.target.position;this.startFindDefinition(i)}async startFindDefinition(e){this.toUnhookForKeyboard.clear();const t=e?this.editor.getModel()?.getWordAtPosition(e):null;if(!t){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===t.startColumn&&this.currentWordAtPosition.endColumn===t.endColumn&&this.currentWordAtPosition.word===t.word)return;this.currentWordAtPosition=t;const i=new dN(this.editor,ds.Position|ds.Value|ds.Selection|ds.Scroll);this.previousPromise&&(this.previousPromise.cancel(),this.previousPromise=null),this.previousPromise=En(r=>this.findDefinition(e,r));let n;try{n=await this.previousPromise}catch(r){mt(r);return}if(!n||!n.length||!i.validate(this.editor)){this.removeLinkDecorations();return}const o=n[0].originSelectionRange?P.lift(n[0].originSelectionRange):new P(e.lineNumber,t.startColumn,e.lineNumber,t.endColumn);if(n.length>1){let r=o;for(const{originSelectionRange:a}of n)a&&(r=P.plusRange(r,a));this.addDecoration(r,new Ni().appendText(h(1138,"Click to show {0} definitions.",n.length)))}else{const r=n[0];return r.uri?this.textModelResolverService.createModelReference(r.uri).then(a=>{if(!a.object||!a.object.textEditorModel){a.dispose();return}const{object:{textEditorModel:c}}=a,{startLineNumber:d}=r.range;if(d<1||d>c.getLineCount()){a.dispose();return}const l=this.getPreviewValue(c,d,r),u=this.languageService.guessLanguageIdByFilepathOrFirstLine(c.uri);this.addDecoration(o,l?new Ni().appendCodeblock(u||"",l):void 0),a.dispose()}):void 0}}getPreviewValue(e,t,i){let n=i.range;return n.endLineNumber-n.startLineNumber>=nC.MAX_SOURCE_PREVIEW_LINES&&(n=this.getPreviewRangeBasedOnIndentation(e,t)),n=e.validateRange(n),this.stripIndentationFromPreviewRange(e,t,n)}stripIndentationFromPreviewRange(e,t,i){let o=e.getLineFirstNonWhitespaceColumn(t);for(let a=t+1;a<i.endLineNumber;a++){const c=e.getLineFirstNonWhitespaceColumn(a);o=Math.min(o,c)}return e.getValueInRange(i).replace(new RegExp(`^\\s{${o-1}}`,"gm"),"").trim()}getPreviewRangeBasedOnIndentation(e,t){const i=e.getLineFirstNonWhitespaceColumn(t),n=Math.min(e.getLineCount(),t+nC.MAX_SOURCE_PREVIEW_LINES);let o=t+1;for(;o<n;o++){const r=e.getLineFirstNonWhitespaceColumn(o);if(i===r)break}return new P(t,1,o+1,1)}addDecoration(e,t){const i={range:e,options:{description:"goto-definition-link",inlineClassName:"goto-definition-link",hoverMessage:t}};this.linkDecorations.set([i])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&e.target.type===Ei.CONTENT_TEXT&&!(e.target.detail.injectedText?.options instanceof uq)&&(e.hasTriggerModifier||(t?t.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){const i=this.editor.getModel();return i?AI(this.languageFeaturesService.definitionProvider,i,e,!1,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(i=>{const n=!t&&this.editor.getOption(L.definitionLinkOpensInPeek)&&!this.isInPeekEditor(i);return new PI({openToSide:t,openInPeek:n,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(i)})}isInPeekEditor(e){const t=e.get(me);return Ir.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}};Ux=nC=f([p(1,yi),p(2,fi),p(3,Ne)],Ux);Rt(Ux.ID,Ux,vt.BeforeFirstInteraction);const j$e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Y$e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(Y$e);var dG;(function(s){function e(t){switch(t){case Me.Ignore:return"severity-ignore "+Te.asClassName(j.info);case Me.Info:return Te.asClassName(j.info);case Me.Warning:return Te.asClassName(j.warning);case Me.Error:return Te.asClassName(j.error);default:return""}}s.className=e})(dG||(dG={}));var lG;Be(j$e);class Q$e{constructor(e,t,i,n,o){this._openerService=n,this._labelService=o,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new U,this._editor=t;const r=document.createElement("div");r.className="descriptioncontainer",this._messageBlock=document.createElement("div"),this._messageBlock.classList.add("message"),this._messageBlock.setAttribute("aria-live","assertive"),this._messageBlock.setAttribute("role","alert"),r.appendChild(this._messageBlock),this._relatedBlock=document.createElement("div"),r.appendChild(this._relatedBlock),this._disposables.add(co(this._relatedBlock,"click",a=>{a.preventDefault();const c=this._relatedDiagnostics.get(a.target);c&&i(c)})),this._scrollable=new Rne(r,{horizontal:dd.Auto,vertical:dd.Auto,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(a=>{r.style.left=`-${a.scrollLeft}px`,r.style.top=`-${a.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){Qe(this._disposables)}update(e){const{source:t,message:i,relatedInformation:n,code:o}=e;let r=(t?.length||0)+2;o&&(typeof o=="string"?r+=o.length:r+=o.value.length);const a=Ih(i);this._lines=a.length,this._longestLineLength=0;for(const g of a)this._longestLineLength=Math.max(g.length+r,this._longestLineLength);Yi(this._messageBlock),this._messageBlock.setAttribute("aria-label",this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let c=this._messageBlock;for(const g of a)c=document.createElement("div"),c.innerText=g,g===""&&(c.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(c);if(t||o){const g=document.createElement("span");if(g.classList.add("details"),c.appendChild(g),t){const m=document.createElement("span");m.innerText=t,m.classList.add("source"),g.appendChild(m)}if(o)if(typeof o=="string"){const m=document.createElement("span");m.innerText=`(${o})`,m.classList.add("code"),g.appendChild(m)}else{this._codeLink=Y("a.code-link"),this._codeLink.setAttribute("href",`${o.target.toString()}`),this._codeLink.onclick=v=>{this._openerService.open(o.target,{allowCommands:!0}),v.preventDefault(),v.stopPropagation()};const m=ee(this._codeLink,Y("span"));m.innerText=o.value,g.appendChild(this._codeLink)}}if(Yi(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),xn(n)){const g=this._relatedBlock.appendChild(document.createElement("div"));g.style.paddingTop=`${Math.floor(this._editor.getOption(L.lineHeight)*.66)}px`,this._lines+=1;for(const m of n){const v=document.createElement("div"),y=document.createElement("a");y.classList.add("filename"),y.innerText=`${this._labelService.getUriBasenameLabel(m.resource)}(${m.startLineNumber}, ${m.startColumn}): `,y.title=this._labelService.getUriLabel(m.resource),this._relatedDiagnostics.set(y,m);const w=document.createElement("span");w.innerText=m.message,v.appendChild(y),v.appendChild(w),this._lines+=1,g.appendChild(v)}}const d=this._editor.getOption(L.fontInfo),l=Math.ceil(d.typicalFullwidthCharacterWidth*this._longestLineLength*.75),u=d.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:l,scrollHeight:u})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t="";switch(e.severity){case Mn.Error:t=h(1089,"Error");break;case Mn.Warning:t=h(1090,"Warning");break;case Mn.Info:t=h(1091,"Info");break;case Mn.Hint:t=h(1092,"Hint");break}let i=h(1093,"{0} at {1}. ",t,e.startLineNumber+":"+e.startColumn);const n=this._editor.getModel();return n&&e.startLineNumber<=n.getLineCount()&&e.startLineNumber>=1&&(i=`${n.getLineContent(e.startLineNumber)}, ${i}`),i}}let $x=class extends LA{static{lG=this}static{this.TitleMenu=new N("gotoErrorTitleMenu")}constructor(e,t,i,n,o,r,a){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},o),this._themeService=t,this._openerService=i,this._menuService=n,this._contextKeyService=r,this._labelService=a,this._callOnDispose=new U,this._onDidSelectRelatedInformation=new M,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=Mn.Warning,this._backgroundColor=be.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(e3e);let t=hG,i=X$e;this._severity===Mn.Warning?(t=ST,i=Z$e):this._severity===Mn.Info&&(t=uG,i=J$e);const n=e.getColor(t),o=e.getColor(i);this.style({arrowColor:n,frameColor:n,headerBackgroundColor:o,primaryHeadingColor:e.getColor(eae),secondaryHeadingColor:e.getColor(tae)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():""),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}focus(){this._parentContainer.focus()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(n=>this.editor.focus()));const t=this._menuService.getMenuActions(lG.TitleMenu,this._contextKeyService),i=oI(t);this._actionbarWidget.push(i,{label:!1,icon:!0,index:0})}_fillTitleIcon(e){this._icon=ee(e,Y(""))}_fillBody(e){this._parentContainer=e,e.classList.add("marker-widget"),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute("role","tooltip"),this._container=document.createElement("div"),e.appendChild(this._container),this._message=new Q$e(this._container,this.editor,t=>this._onDidSelectRelatedInformation.fire(t),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw new Error("call showAtMarker")}showAtMarker(e,t,i){this._container.classList.remove("stale"),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());const n=P.lift(e),o=this.editor.getPosition(),r=o&&n.containsPosition(o)?o:n.getStartPosition();super.show(r,this.computeRequiredHeight());const a=this.editor.getModel();if(a){const c=i>1?h(1094,"{0} of {1} problems",t,i):h(1095,"{0} of {1} problem",t,i);this.setTitle(je(a.uri),c)}this._icon.className=`codicon ${dG.className(Mn.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(r,ji.Smooth),this.editor.focus()}updateMarker(e){this._container.classList.remove("stale"),this._message.update(e)}showStale(){this._container.classList.add("stale"),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};$x=lG=f([p(1,ft),p(2,hi),p(3,tn),p(4,J),p(5,me),p(6,di)],$x);const zte=$q(Iie,owe),Kte=$q(TT,rwe),jte=$q(mE,awe),hG=H("editorMarkerNavigationError.background",{dark:zte,light:zte,hcDark:et,hcLight:et},h(1096,"Editor marker navigation widget error color.")),X$e=H("editorMarkerNavigationError.headerBackground",{dark:Je(hG,.1),light:Je(hG,.1),hcDark:null,hcLight:null},h(1097,"Editor marker navigation widget error heading background.")),ST=H("editorMarkerNavigationWarning.background",{dark:Kte,light:Kte,hcDark:et,hcLight:et},h(1098,"Editor marker navigation widget warning color.")),Z$e=H("editorMarkerNavigationWarning.headerBackground",{dark:Je(ST,.1),light:Je(ST,.1),hcDark:"#0C141F",hcLight:Je(ST,.2)},h(1099,"Editor marker navigation widget warning heading background.")),uG=H("editorMarkerNavigationInfo.background",{dark:jte,light:jte,hcDark:et,hcLight:et},h(1100,"Editor marker navigation widget info color.")),J$e=H("editorMarkerNavigationInfo.headerBackground",{dark:Je(uG,.1),light:Je(uG,.1),hcDark:null,hcLight:null},h(1101,"Editor marker navigation widget info heading background.")),e3e=H("editorMarkerNavigation.background",ts,h(1102,"Editor marker navigation widget background."));var sC;let Cv=class{static{sC=this}static{this.ID="editor.contrib.markerController"}static get(e){return e.getContribution(sC.ID)}constructor(e,t,i,n,o){this._markerNavigationService=t,this._contextKeyService=i,this._editorService=n,this._instantiationService=o,this._sessionDispoables=new U,this._editor=e,this._widgetVisible=upe.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance($x,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(i=>{(!this._model?.selected||!P.containsPosition(this._model?.selected.marker,i.position))&&this._model?.resetIndex()})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;const i=this._model.find(this._editor.getModel().uri,this._widget.position);i?this._widget.updateMarker(i.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(i=>{this._editorService.openCodeEditor({resource:i.resource,options:{pinned:!0,revealIfOpened:!0,selection:P.lift(i).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),i=this._getOrCreateModel(t.uri);i.resetIndex(),i.move(!0,t,new _e(e.startLineNumber,e.startColumn)),i.selected&&this._widget.showAtMarker(i.selected.marker,i.selected.index,i.selected.total)}async navigate(e,t){if(!this._editor.hasModel())return;const i=this._editor.getModel(),n=this._getOrCreateModel(t?void 0:i.uri);if(n.move(e,i,this._editor.getPosition()),!!n.selected)if(n.selected.marker.resource.toString()!==i.uri.toString()){this._cleanUp();const o=await this._editorService.openCodeEditor({resource:n.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:Cm.NearTop,selection:n.selected.marker}},this._editor);o&&(sC.get(o)?.close(),sC.get(o)?.navigate(e,t))}else this._widget.showAtMarker(n.selected.marker,n.selected.index,n.selected.total)}};Cv=sC=f([p(1,qre),p(2,me),p(3,Ot),p(4,J)],Cv);class A1 extends we{constructor(e,t,i){super(i),this._next=e,this._multiFile=t}async run(e,t){t.hasModel()&&await Cv.get(t)?.navigate(this._next,this._multiFile)}}class Yb extends A1{static{this.ID="editor.action.marker.next"}static{this.LABEL=I(1081,"Go to Next Problem (Error, Warning, Info)")}constructor(){super(!0,!1,{id:Yb.ID,label:Yb.LABEL,precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.Alt|S.F8,weight:W.EditorContrib},menuOpts:{menuId:$x.TitleMenu,title:Yb.LABEL.value,icon:Ae("marker-navigation-next",j.arrowDown,h(1082,"Icon for goto next marker.")),group:"navigation",order:1}})}}class hE extends A1{static{this.ID="editor.action.marker.prev"}static{this.LABEL=I(1083,"Go to Previous Problem (Error, Warning, Info)")}constructor(){super(!1,!1,{id:hE.ID,label:hE.LABEL,precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.Shift|E.Alt|S.F8,weight:W.EditorContrib},menuOpts:{menuId:$x.TitleMenu,title:hE.LABEL.value,icon:Ae("marker-navigation-previous",j.arrowUp,h(1084,"Icon for goto previous marker.")),group:"navigation",order:2}})}}class t3e extends A1{constructor(){super(!0,!0,{id:"editor.action.marker.nextInFiles",label:I(1085,"Go to Next Problem in Files (Error, Warning, Info)"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:S.F8,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarGoMenu,title:h(1086,"Next &&Problem"),group:"6_problem_nav",order:1}})}}class i3e extends A1{constructor(){super(!1,!0,{id:"editor.action.marker.prevInFiles",label:I(1087,"Go to Previous Problem in Files (Error, Warning, Info)"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.Shift|S.F8,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarGoMenu,title:h(1088,"Previous &&Problem"),group:"6_problem_nav",order:2}})}}Rt(Cv.ID,Cv,vt.Lazy);ue(Yb);ue(hE);ue(t3e);ue(i3e);const upe=new O("markersNavigationVisible",!1),n3e=No.bindToContribution(Cv.get);Ue(new n3e({id:"closeMarkersNavigation",precondition:upe,handler:s=>s.close(),kbOpts:{weight:W.EditorContrib+50,kbExpr:V.focus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));class s3e extends we{constructor(){super({id:"editor.action.debugEditorGpuRenderer",label:I(1159,"Developer: Debug Editor GPU Renderer"),precondition:x.true()})}async run(e,t){const i=e.get(J),o=await e.get(zt).pick([{label:h(1160,"Log Texture Atlas Stats"),id:"logTextureAtlasStats"},{label:h(1161,"Save Texture Atlas"),id:"saveTextureAtlas"},{label:h(1162,"Draw Glyph"),id:"drawGlyph"}],{canPickMany:!1});if(o)switch(o.id){case"logTextureAtlasStats":i.invokeFunction(r=>{const a=r.get(Pe),c=BD.atlas;if(!BD.atlas){a.error("No texture atlas found");return}const d=c.getStats();a.info(["Texture atlas stats",...d].join(`

`))});break;case"saveTextureAtlas":i.invokeFunction(async r=>{const a=r.get(Tt),c=r.get(Xe),d=a.getWorkspace().folders;if(d.length>0){const l=BD.atlas,u=[];for(const[g,m]of l.pages.entries())u.push(c.writeFile(R.joinPath(d[0].uri,`textureAtlasPage${g}_actual.png`),Re.wrap(new Uint8Array(await(await m.source.convertToBlob()).arrayBuffer()))),c.writeFile(R.joinPath(d[0].uri,`textureAtlasPage${g}_usage.png`),Re.wrap(new Uint8Array(await(await m.getUsagePreview()).arrayBuffer()))));await Promise.all(u)}});break;case"drawGlyph":i.invokeFunction(async r=>{const a=r.get(ne),c=r.get(Xe),d=r.get(zt),u=r.get(Tt).getWorkspace().folders;if(u.length===0)return;const g=BD.atlas,m=a.getValue("editor.fontFamily"),v=a.getValue("editor.fontSize"),y=new zSe(v,m,Vp().devicePixelRatio);let w=await d.input({prompt:"Enter a character to draw (prefix with 0x for code point))"});if(!w)return;const C=w.match(/0x(?<codePoint>[0-9a-f]+)/i)?.groups?.codePoint;C!==void 0&&(w=String.fromCodePoint(parseInt(C,16)));const T=0,A=g.getGlyph(y,w,T,0,0);if(!A)return;const B=g.pages[A.pageIndex].source.getContext("2d")?.getImageData(A.x,A.y,A.w,A.h);if(!B)return;const z=new OffscreenCanvas(B.width,B.height);KSe(z.getContext("2d")).putImageData(B,0,0);const ie=await z.convertToBlob({type:"image/png"}),oe=R.joinPath(u[0].uri,`glyph_${w}_${T}_${v}px_${m.replaceAll(/[,\\\/\.'\s]/g,"_")}.png`);await c.writeFile(oe,Re.wrap(new Uint8Array(await ie.arrayBuffer())))});break}}}ue(s3e);Be(xO);var Bd;(function(s){s.NoAutoFocus="noAutoFocus",s.FocusIfVisible="focusIfVisible",s.AutoFocusImmediately="autoFocusImmediately"})(Bd||(Bd={}));class o3e extends we{constructor(){super({id:pde,label:I(1170,"Show or Focus Hover"),metadata:{description:I(1171,"Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position."),args:[{name:"args",schema:{type:"object",properties:{focus:{description:"Controls if and when the hover should take focus upon being triggered by this action.",enum:[Bd.NoAutoFocus,Bd.FocusIfVisible,Bd.AutoFocusImmediately],enumDescriptions:[h(1172,"The hover will not automatically take focus."),h(1173,"The hover will take focus only if it is already visible."),h(1174,"The hover will automatically take focus when it appears.")],default:Bd.FocusIfVisible}}}}]},precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyI),weight:W.EditorContrib}})}run(e,t,i){if(!t.hasModel())return;const n=ps.get(t);if(!n)return;const o=i?.focus;let r=Bd.FocusIfVisible;Object.values(Bd).includes(o)?r=o:typeof o=="boolean"&&o&&(r=Bd.AutoFocusImmediately);const a=d=>{const l=t.getPosition(),u=new P(l.lineNumber,l.column,l.lineNumber,l.column);n.showContentHover(u,Rh.Immediate,ll.Keyboard,d)},c=t.getOption(L.accessibilitySupport)===hse.Enabled;n.isHoverVisible?r!==Bd.NoAutoFocus?n.focus():a(c):a(c||r===Bd.AutoFocusImmediately)}}class r3e extends we{constructor(){super({id:vPe,label:I(1175,"Show Definition Preview Hover"),precondition:void 0,metadata:{description:I(1176,"Show the definition preview hover in the editor.")}})}run(e,t){const i=ps.get(t);if(!i)return;const n=t.getPosition();if(!n)return;const o=new P(n.lineNumber,n.column,n.lineNumber,n.column),r=Ux.get(t);if(!r)return;r.startFindDefinitionFromCursor(n).then(()=>{i.showContentHover(o,Rh.Immediate,ll.Keyboard,!0)})}}class a3e extends we{constructor(){super({id:_Pe,label:I(1177,"Hide Hover"),alias:"Hide Content Hover",precondition:void 0})}run(e,t){ps.get(t)?.hideContentHover()}}class c3e extends we{constructor(){super({id:bPe,label:I(1178,"Scroll Up Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.UpArrow,weight:W.EditorContrib},metadata:{description:I(1179,"Scroll up the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.scrollUp()}}class d3e extends we{constructor(){super({id:yPe,label:I(1180,"Scroll Down Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.DownArrow,weight:W.EditorContrib},metadata:{description:I(1181,"Scroll down the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.scrollDown()}}class l3e extends we{constructor(){super({id:wPe,label:I(1182,"Scroll Left Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.LeftArrow,weight:W.EditorContrib},metadata:{description:I(1183,"Scroll left the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.scrollLeft()}}class h3e extends we{constructor(){super({id:SPe,label:I(1184,"Scroll Right Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.RightArrow,weight:W.EditorContrib},metadata:{description:I(1185,"Scroll right the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.scrollRight()}}class u3e extends we{constructor(){super({id:CPe,label:I(1186,"Page Up Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.PageUp,secondary:[E.Alt|S.UpArrow],weight:W.EditorContrib},metadata:{description:I(1187,"Page up the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.pageUp()}}class g3e extends we{constructor(){super({id:EPe,label:I(1188,"Page Down Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.PageDown,secondary:[E.Alt|S.DownArrow],weight:W.EditorContrib},metadata:{description:I(1189,"Page down the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.pageDown()}}class p3e extends we{constructor(){super({id:xPe,label:I(1190,"Go To Top Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.Home,secondary:[E.CtrlCmd|S.UpArrow],weight:W.EditorContrib},metadata:{description:I(1191,"Go to the top of the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.goToTop()}}class f3e extends we{constructor(){super({id:IPe,label:I(1192,"Go To Bottom Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.End,secondary:[E.CtrlCmd|S.DownArrow],weight:W.EditorContrib},metadata:{description:I(1193,"Go to the bottom of the editor hover.")}})}run(e,t){const i=ps.get(t);i&&i.goToBottom()}}class m3e extends we{constructor(){super({id:zw,label:kPe,alias:"Increase Hover Verbosity Level",precondition:V.hoverVisible})}run(e,t,i){const n=ps.get(t);if(!n)return;const o=i?.index!==void 0?i.index:n.focusedHoverPartIndex();n.updateHoverVerbosityLevel(Ps.Increase,o,i?.focus)}}class v3e extends we{constructor(){super({id:Kw,label:APe,alias:"Decrease Hover Verbosity Level",precondition:V.hoverVisible})}run(e,t,i){const n=ps.get(t);if(!n)return;const o=i?.index!==void 0?i.index:n.focusedHoverPartIndex();ps.get(t)?.updateHoverVerbosityLevel(Ps.Decrease,o,i?.focus)}}const Dc=Y;class _3e{constructor(e,t,i){this.owner=e,this.range=t,this.marker=i}isValidForHoverAnchor(e){return e.type===Qo.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}const Yte={type:Bo.Invoke,filter:{include:gi.QuickFix},triggerAction:Dr.QuickFixHover};let gG=class{constructor(e,t,i,n){this._editor=e,this._markerDecorationsService=t,this._openerService=i,this._languageFeaturesService=n,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||e.type!==Qo.Range&&!e.supportsMarkerHover)return[];const i=this._editor.getModel(),n=e.range.startLineNumber,o=i.getLineMaxColumn(n),r=[];for(const a of t){const c=a.range.startLineNumber===n?a.range.startColumn:1,d=a.range.endLineNumber===n?a.range.endColumn:o,l=this._markerDecorationsService.getMarker(i.uri,a);if(!l)continue;const u=new P(e.range.startLineNumber,c,e.range.startLineNumber,d);r.push(new _3e(this,u,l))}return r}renderHoverParts(e,t){if(!t.length)return new hv([]);const i=[];t.forEach(r=>{const a=this._renderMarkerHover(r);e.fragment.appendChild(a.hoverElement),i.push(a)});const n=t.length===1?t[0]:t.sort((r,a)=>Mn.compare(r.marker.severity,a.marker.severity))[0],o=this._renderMarkerStatusbar(e,n);return new hv(i,o)}getAccessibleContent(e){return e.marker.message}_renderMarkerHover(e){const t=new U,i=Dc("div.hover-row"),n=ee(i,Dc("div.marker.hover-contents")),{source:o,message:r,code:a,relatedInformation:c}=e.marker;this._editor.applyFontInfo(n);const d=ee(n,Dc("span"));if(d.style.whiteSpace="pre-wrap",d.innerText=r,o||a)if(a&&typeof a!="string"){const u=Dc("span");if(o){const y=ee(u,Dc("span"));y.innerText=o}const g=ee(u,Dc("a.code-link"));g.setAttribute("href",a.target.toString(!0)),t.add(re(g,"click",y=>{this._openerService.open(a.target,{allowCommands:!0}),y.preventDefault(),y.stopPropagation()}));const m=ee(g,Dc("span"));m.innerText=a.value;const v=ee(n,u);v.style.opacity="0.6",v.style.paddingLeft="6px"}else{const u=ee(n,Dc("span"));u.style.opacity="0.6",u.style.paddingLeft="6px",u.innerText=o&&a?`${o}(${a})`:o||`(${a})`}if(xn(c))for(const{message:u,resource:g,startLineNumber:m,startColumn:v}of c){const y=ee(n,Dc("div"));y.style.marginTop="8px";const w=ee(y,Dc("a"));w.innerText=`${je(g)}(${m}, ${v}): `,w.style.cursor="pointer",t.add(re(w,"click",T=>{if(T.stopPropagation(),T.preventDefault(),this._openerService){const k={selection:{startLineNumber:m,startColumn:v}};this._openerService.open(g,{fromUserGesture:!0,editorOptions:k}).catch(mt)}}));const C=ee(y,Dc("span"));C.innerText=u,this._editor.applyFontInfo(C)}return{hoverPart:e,hoverElement:i,dispose:()=>t.dispose()}}_renderMarkerStatusbar(e,t){const i=new U;if(t.marker.severity===Mn.Error||t.marker.severity===Mn.Warning||t.marker.severity===Mn.Info){const n=Cv.get(this._editor);n&&e.statusBar.addAction({label:h(1203,"View Problem"),commandId:Yb.ID,run:()=>{e.hide(),n.showAtMarker(t.marker),this._editor.focus()}})}if(!this._editor.getOption(L.readOnly)){const n=e.statusBar.append(Dc("div"));this.recentMarkerCodeActionsInfo&&(Q7.makeKey(this.recentMarkerCodeActionsInfo.marker)===Q7.makeKey(t.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(n.textContent=h(1204,"No quick fixes available")):this.recentMarkerCodeActionsInfo=void 0);const o=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?F.None:Hm(()=>n.textContent=h(1205,"Checking for quick fixes..."),200,i);n.textContent||(n.textContent=" ");const r=this.getCodeActions(t.marker);i.add(Ee(()=>r.cancel())),r.then(a=>{if(o.dispose(),this.recentMarkerCodeActionsInfo={marker:t.marker,hasCodeActions:a.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){a.dispose(),n.textContent=h(1204,"No quick fixes available");return}n.style.display="none";let c=!1;i.add(Ee(()=>{c||a.dispose()})),e.statusBar.addAction({label:h(1206,"Quick Fix..."),commandId:K4,run:l=>{c=!0;const u=ef.get(this._editor),g=Ms(l);e.hide(),u?.showCodeActions(Yte,a,{x:g.left,y:g.top,width:g.width,height:g.height})}});const d=a.validActions.find(l=>l.action.isAI);d&&e.statusBar.addAction({label:d.action.title,commandId:d.action.command?.id??"",run:()=>{ef.get(this._editor)?.applyCodeAction(d,!1,!1,ku.FromProblemsHover)}})},mt)}return i}getCodeActions(e){return En(t=>vm(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new P(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),Yte,Jc.None,t))}};gG=f([p(1,cwe),p(2,hi),p(3,Ne)],gG);var lM;(function(s){s.increaseVerbosity=h(1166,"- The focused hover part verbosity level can be increased with the Increase Hover Verbosity command.",`<keybinding:${zw}>`),s.decreaseVerbosity=h(1167,"- The focused hover part verbosity level can be decreased with the Decrease Hover Verbosity command.",`<keybinding:${Kw}>`)})(lM||(lM={}));class b3e{constructor(){this.type=fc.View,this.priority=95,this.name="hover",this.when=V.hoverFocused}getProvider(e){const t=e.get(Ot),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)throw new Error("No active or focused code editor");const n=ps.get(i);if(!n)return;const o=e.get(Ve);return e.get(J).createInstance(w3e,o,i,n)}}class y3e{constructor(){this.priority=100,this.name="hover",this.type=fc.Help,this.when=V.hoverVisible}getProvider(e){const t=e.get(Ot),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)throw new Error("No active or focused code editor");const n=ps.get(i);if(n)return e.get(J).createInstance(ppe,n)}}class gpe extends F{constructor(e){super(),this._hoverController=e,this.id=sa.Hover,this.verbositySettingKey="accessibility.verbosity.hover",this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._focusedHoverPartIndex=-1}onOpen(){this._hoverController&&(this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!0,this._focusedHoverPartIndex=this._hoverController.focusedHoverPartIndex(),this._register(this._hoverController.onHoverContentsChanged(()=>{this._onDidChangeContent.fire()})))}onClose(){this._hoverController&&(this._focusedHoverPartIndex===-1?this._hoverController.focus():this._hoverController.focusHoverPartWithIndex(this._focusedHoverPartIndex),this._focusedHoverPartIndex=-1,this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!1)}provideContentAtIndex(e,t){if(e!==-1){const i=this._hoverController.getAccessibleWidgetContentAtIndex(e);if(i===void 0)return"";const n=[];return t&&n.push(...this._descriptionsOfVerbosityActionsForIndex(e)),n.push(i),n.join(`
`)}else{const i=this._hoverController.getAccessibleWidgetContent();if(i===void 0)return"";const n=[];return n.push(i),n.join(`
`)}}_descriptionsOfVerbosityActionsForIndex(e){const t=[],i=this._descriptionOfVerbosityActionForIndex(Ps.Increase,e);i!==void 0&&t.push(i);const n=this._descriptionOfVerbosityActionForIndex(Ps.Decrease,e);return n!==void 0&&t.push(n),t}_descriptionOfVerbosityActionForIndex(e,t){if(this._hoverController.doesHoverAtIndexSupportVerbosityAction(t,e))switch(e){case Ps.Increase:return lM.increaseVerbosity;case Ps.Decrease:return lM.decreaseVerbosity}}}class ppe extends gpe{constructor(e){super(e),this.options={type:fc.Help}}provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class w3e extends gpe{constructor(e,t,i){super(i),this._keybindingService=e,this._editor=t,this.options={type:fc.View},this._initializeOptions(this._editor,i)}provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!1)}get actions(){const e=[];return e.push(this._getActionFor(this._editor,Ps.Increase)),e.push(this._getActionFor(this._editor,Ps.Decrease)),e}_getActionFor(e,t){let i,n,o;switch(t){case Ps.Increase:i=zw,n=DPe,o=j.add;break;case Ps.Decrease:i=Kw,n=TPe,o=j.remove;break}const r=Cde(this._keybindingService,t),a=this._hoverController.doesHoverAtIndexSupportVerbosityAction(this._focusedHoverPartIndex,t);return new Kt(n,r,Te.asClassName(o),a,()=>{e.getAction(i)?.run({index:this._focusedHoverPartIndex,focus:!1})})}_initializeOptions(e,t){const i=this._register(new ppe(t));this.options.language=e.getModel()?.getLanguageId(),this.options.customHelp=()=>i.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class S3e{constructor(){this.type=fc.View,this.priority=90,this.name="extension-hover"}getProvider(e){const i=e.get(cf).getContextViewElement(),n=i?.textContent??void 0,o=e.get(wi);if(!(i.classList.contains("accessible-view-container")||!n))return new Tge(sa.Hover,{language:"typescript",type:fc.View},()=>n,()=>{o.showAndFocusLastHover()},"accessibility.verbosity.hover")}}Be(xO);Rt(ps.ID,ps,vt.BeforeFirstInteraction);Rt(Hy.ID,Hy,vt.BeforeFirstInteraction);ue(o3e);ue(r3e);ue(a3e);ue(c3e);ue(d3e);ue(l3e);ue(h3e);ue(u3e);ue(g3e);ue(p3e);ue(f3e);ue(m3e);ue(v3e);s_.register(hx);s_.register(gG);Pv((s,e)=>{const t=s.getColor(tse);t&&(e.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${t.transparent(.5)}; }`))});yD.register(new b3e);yD.register(new y3e);yD.register(new S3e);function Kr(s,e){let t=0;for(let i=0;i<s.length;i++)s.charAt(i)==="	"?t+=e:t++;return t}function uE(s,e,t){s=s<0?0:s;let i="";if(!t){const n=Math.floor(s/e);s=s%e;for(let o=0;o<n;o++)i+="	"}for(let n=0;n<s;n++)i+=" ";return i}function fpe(s,e,t,i){if(s.getLineCount()===1&&s.getLineMaxColumn(1)===1)return[];const n=e.getLanguageConfiguration(s.getLanguageId()).indentRulesSupport;if(!n)return[];const o=new jSe(s,n,e);for(i=Math.min(i,s.getLineCount());t<=i&&o.shouldIgnore(t);)t++;if(t>i-1)return[];const{tabSize:r,indentSize:a,insertSpaces:c}=s.getOptions(),d=(y,w)=>(w=w||1,ly.shiftIndent(y,y.length+w,r,a,c)),l=(y,w)=>(w=w||1,ly.unshiftIndent(y,y.length+w,r,a,c)),u=[],g=s.getLineContent(t);let m=to(g),v=m;o.shouldIncrease(t)?(v=d(v),m=d(m)):o.shouldIndentNextLine(t)&&(v=d(v)),t++;for(let y=t;y<=i;y++){if(C3e(s,y))continue;const w=s.getLineContent(y),C=to(w),T=v;o.shouldDecrease(y,T)&&(v=l(v),m=l(m)),C!==v&&u.push(Ki.replaceMove(new at(y,1,y,C.length+1),dwe(v,a,c))),!o.shouldIgnore(y)&&(o.shouldIncrease(y,T)?(m=d(m),v=m):o.shouldIndentNextLine(y,T)?v=d(v):v=m)}return u}function C3e(s,e){return s.tokenization.isCheapToTokenize(e)?s.tokenization.getLineTokens(e).getStandardTokenType(0)===Xc.String:!1}class y5 extends we{static{this.ID="editor.action.indentationToSpaces"}constructor(){super({id:y5.ID,label:I(1209,"Convert Indentation to Spaces"),precondition:V.writable,metadata:{description:I(1210,"Convert the tab indentation to spaces.")}})}run(e,t){const i=t.getModel();if(!i)return;const n=i.getOptions(),o=t.getSelection();if(!o)return;const r=new k3e(o,n.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[r]),t.pushUndoStop(),i.updateOptions({insertSpaces:!0})}}class w5 extends we{static{this.ID="editor.action.indentationToTabs"}constructor(){super({id:w5.ID,label:I(1211,"Convert Indentation to Tabs"),precondition:V.writable,metadata:{description:I(1212,"Convert the spaces indentation to tabs.")}})}run(e,t){const i=t.getModel();if(!i)return;const n=i.getOptions(),o=t.getSelection();if(!o)return;const r=new T3e(o,n.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[r]),t.pushUndoStop(),i.updateOptions({insertSpaces:!1})}}class S5 extends we{constructor(e,t,i){super(i),this.insertSpaces=e,this.displaySizeOnly=t}run(e,t){const i=e.get(zt),n=e.get(ai),o=t.getModel();if(!o)return;const r=n.getCreationOptions(o.getLanguageId(),o.uri,o.isForSimpleWidget),a=o.getOptions(),c=[1,2,3,4,5,6,7,8].map(l=>({id:l.toString(),label:l.toString(),description:l===r.tabSize&&l===a.tabSize?h(1213,"Configured Tab Size"):l===r.tabSize?h(1214,"Default Tab Size"):l===a.tabSize?h(1215,"Current Tab Size"):void 0})),d=Math.min(o.getOptions().tabSize-1,7);setTimeout(()=>{i.pick(c,{placeHolder:h(1216,"Select Tab Size for Current File"),activeItem:c[d]}).then(l=>{if(l&&o&&!o.isDisposed()){const u=parseInt(l.label,10);this.displaySizeOnly?o.updateOptions({tabSize:u}):o.updateOptions({tabSize:u,indentSize:u,insertSpaces:this.insertSpaces})}})},50)}}class C5 extends S5{static{this.ID="editor.action.indentUsingTabs"}constructor(){super(!1,!1,{id:C5.ID,label:I(1217,"Indent Using Tabs"),precondition:void 0,metadata:{description:I(1218,"Use indentation with tabs.")}})}}class E5 extends S5{static{this.ID="editor.action.indentUsingSpaces"}constructor(){super(!0,!1,{id:E5.ID,label:I(1219,"Indent Using Spaces"),precondition:void 0,metadata:{description:I(1220,"Use indentation with spaces.")}})}}class x5 extends S5{static{this.ID="editor.action.changeTabDisplaySize"}constructor(){super(!0,!0,{id:x5.ID,label:I(1221,"Change Tab Display Size"),precondition:void 0,metadata:{description:I(1222,"Change the space size equivalent of the tab.")}})}}class I5 extends we{static{this.ID="editor.action.detectIndentation"}constructor(){super({id:I5.ID,label:I(1223,"Detect Indentation from Content"),precondition:void 0,metadata:{description:I(1224,"Detect the indentation from content.")}})}run(e,t){const i=e.get(ai),n=t.getModel();if(!n)return;const o=i.getCreationOptions(n.getLanguageId(),n.uri,n.isForSimpleWidget);n.detectIndentation(o.insertSpaces,o.tabSize)}}class E3e extends we{constructor(){super({id:"editor.action.reindentlines",label:I(1225,"Reindent Lines"),precondition:V.writable,metadata:{description:I(1226,"Reindent the lines of the editor.")}})}run(e,t){const i=e.get(rs),n=t.getModel();if(!n)return;const o=fpe(n,i,1,n.getLineCount());o.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,o),t.pushUndoStop())}}class x3e extends we{constructor(){super({id:"editor.action.reindentselectedlines",label:I(1227,"Reindent Selected Lines"),precondition:V.writable,metadata:{description:I(1228,"Reindent the selected lines of the editor.")}})}run(e,t){const i=e.get(rs),n=t.getModel();if(!n)return;const o=t.getSelections();if(o===null)return;const r=[];for(const a of o){let c=a.startLineNumber,d=a.endLineNumber;if(c!==d&&a.endColumn===1&&d--,c===1){if(c===d)continue}else c--;const l=fpe(n,i,c,d);r.push(...l)}r.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,r),t.pushUndoStop())}}class I3e{constructor(e,t){this._initialSelection=t,this._edits=[],this._selectionId=null;for(const i of e)i.range&&typeof i.text=="string"&&this._edits.push(i)}getEditOperations(e,t){for(const n of this._edits)t.addEditOperation(P.lift(n.range),n.text);let i=!1;Array.isArray(this._edits)&&this._edits.length===1&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(i=!0,this._selectionId=t.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(i=!0,this._selectionId=t.trackSelection(this._initialSelection,!1))),i||(this._selectionId=t.trackSelection(this._initialSelection))}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}let hM=class{static{this.ID="editor.contrib.autoIndentOnPaste"}constructor(e,t){this.editor=e,this._languageConfigurationService=t,this.callOnDispose=new U,this.callOnModel=new U,this.callOnDispose.add(e.onDidChangeConfiguration(()=>this.update())),this.callOnDispose.add(e.onDidChangeModel(()=>this.update())),this.callOnDispose.add(e.onDidChangeModelLanguage(()=>this.update()))}update(){this.callOnModel.clear(),!(this.editor.getOption(L.autoIndent)<fse.Full||!this.editor.getOption(L.formatOnPaste))&&this.editor.hasModel()&&this.callOnModel.add(this.editor.onDidPaste(({range:e})=>{this.trigger(e)}))}trigger(e){const t=this.editor.getSelections();if(t===null||t.length>1)return;const i=this.editor.getModel();if(!i||this.rangeContainsOnlyWhitespaceCharacters(i,e)||D3e(i,e)||!i.tokenization.isCheapToTokenize(e.getStartPosition().lineNumber))return;const o=this.editor.getOption(L.autoIndent),{tabSize:r,indentSize:a,insertSpaces:c}=i.getOptions(),d=[],l={shiftIndent:v=>ly.shiftIndent(v,v.length+1,r,a,c),unshiftIndent:v=>ly.unshiftIndent(v,v.length+1,r,a,c)};let u=e.startLineNumber;for(;u<=e.endLineNumber;){if(this.shouldIgnoreLine(i,u)){u++;continue}break}if(u>e.endLineNumber)return;let g=i.getLineContent(u);if(!/\S/.test(g.substring(0,e.startColumn-1))){const v=vC(o,i,i.getLanguageId(),u,l,this._languageConfigurationService);if(v!==null){const y=to(g),w=Kr(v,r),C=Kr(y,r);if(w!==C){const T=uE(w,r,c);d.push({range:new P(u,1,u,y.length+1),text:T}),g=T+g.substring(y.length)}else{const T=Lse(i,u,this._languageConfigurationService);if(T===0||T===Mse.UNINDENT_MASK)return}}}const m=u;for(;u<e.endLineNumber;){if(!/\S/.test(i.getLineContent(u+1))){u++;continue}break}if(u!==e.endLineNumber){const y=vC(o,{tokenization:{getLineTokens:w=>i.tokenization.getLineTokens(w),getLanguageId:()=>i.getLanguageId(),getLanguageIdAtPosition:(w,C)=>i.getLanguageIdAtPosition(w,C)},getLineContent:w=>w===m?g:i.getLineContent(w)},i.getLanguageId(),u+1,l,this._languageConfigurationService);if(y!==null){const w=Kr(y,r),C=Kr(to(i.getLineContent(u+1)),r);if(w!==C){const T=w-C;for(let k=u+1;k<=e.endLineNumber;k++){const A=i.getLineContent(k),B=to(A),Q=Kr(B,r)+T,ie=uE(Q,r,c);ie!==B&&d.push({range:new P(k,1,k,B.length+1),text:ie})}}}}if(d.length>0){this.editor.pushUndoStop();const v=new I3e(d,this.editor.getSelection());this.editor.executeCommand("autoIndentOnPaste",v),this.editor.pushUndoStop()}}rangeContainsOnlyWhitespaceCharacters(e,t){const i=o=>o.trim().length===0;let n=!0;if(t.startLineNumber===t.endLineNumber){const r=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);n=i(r)}else for(let o=t.startLineNumber;o<=t.endLineNumber;o++){const r=e.getLineContent(o);if(o===t.startLineNumber){const a=r.substring(t.startColumn-1);n=i(a)}else if(o===t.endLineNumber){const a=r.substring(0,t.endColumn-1);n=i(a)}else n=e.getLineFirstNonWhitespaceColumn(o)===0;if(!n)break}return n}shouldIgnoreLine(e,t){e.tokenization.forceTokenization(t);const i=e.getLineFirstNonWhitespaceColumn(t);if(i===0)return!0;const n=e.tokenization.getLineTokens(t);if(n.getCount()>0){const o=n.findTokenIndexAtOffset(i);if(o>=0&&n.getStandardTokenType(o)===Xc.Comment)return!0}return!1}dispose(){this.callOnDispose.dispose(),this.callOnModel.dispose()}};hM=f([p(1,rs)],hM);function D3e(s,e){const t=i=>lwe(s,i)===Xc.String;return t(e.getStartPosition())||t(e.getEndPosition())}function mpe(s,e,t,i){if(s.getLineCount()===1&&s.getLineMaxColumn(1)===1)return;let n="";for(let r=0;r<t;r++)n+=" ";const o=new RegExp(n,"gi");for(let r=1,a=s.getLineCount();r<=a;r++){let c=s.getLineFirstNonWhitespaceColumn(r);if(c===0&&(c=s.getLineMaxColumn(r)),c===1)continue;const d=new P(r,1,r,c),l=s.getValueInRange(d),u=i?l.replace(/\t/ig,n):l.replace(o,"	");e.addEditOperation(d,u)}}class k3e{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),mpe(e,t,this.tabSize,!0)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}}class T3e{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),mpe(e,t,this.tabSize,!1)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}}Rt(hM.ID,hM,vt.BeforeFirstInteraction);ue(y5);ue(w5);ue(C5);ue(E5);ue(x5);ue(I5);ue(E3e);ue(x3e);Rt(yy.ID,yy,vt.AfterFirstRender);s_.register(KR);class A3e{constructor(e,t,i){this._editRange=e,this._originalSelection=t,this._text=i}getEditOperations(e,t){t.addTrackedEditOperation(this._editRange,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return this._originalSelection.isEmpty()?new at(n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn),n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn)):new at(n.endLineNumber,n.endColumn-this._text.length,n.endLineNumber,n.endColumn)}}const R3e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var CT;Be(R3e);let ew=class{static{CT=this}static{this.ID="editor.contrib.inPlaceReplaceController"}static get(e){return e.getContribution(CT.ID)}static{this.DECORATION=Yt.register({description:"in-place-replace",className:"valueSetReplacement"})}constructor(e,t){this.editor=e,this.editorWorkerService=t,this.decorations=this.editor.createDecorationsCollection()}dispose(){}run(e,t){this.currentRequest?.cancel();const i=this.editor.getSelection(),n=this.editor.getModel();if(!n||!i)return;let o=i;if(o.startLineNumber!==o.endLineNumber)return;const r=new dN(this.editor,ds.Value|ds.Position),a=n.uri;return this.editorWorkerService.canNavigateValueSet(a)?(this.currentRequest=En(c=>this.editorWorkerService.navigateValueSet(a,o,t)),this.currentRequest.then(c=>{if(!c||!c.range||!c.value||!r.validate(this.editor))return;const d=P.lift(c.range);let l=c.range;const u=c.value.length-(o.endColumn-o.startColumn);l={startLineNumber:l.startLineNumber,startColumn:l.startColumn,endLineNumber:l.endLineNumber,endColumn:l.startColumn+c.value.length},u>1&&(o=new at(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn+u-1));const g=new A3e(d,o,c.value);this.editor.pushUndoStop(),this.editor.executeCommand(e,g),this.editor.pushUndoStop(),this.decorations.set([{range:l,options:CT.DECORATION}]),this.decorationRemover?.cancel(),this.decorationRemover=Ia(350),this.decorationRemover.then(()=>this.decorations.clear()).catch(mt)}).catch(mt)):Promise.resolve(void 0)}};ew=CT=f([p(1,vc)],ew);class P3e extends we{constructor(){super({id:"editor.action.inPlaceReplace.up",label:I(1207,"Replace with Previous Value"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Comma,weight:W.EditorContrib}})}run(e,t){const i=ew.get(t);return i?i.run(this.id,!1):Promise.resolve(void 0)}}class L3e extends we{constructor(){super({id:"editor.action.inPlaceReplace.down",label:I(1208,"Replace with Next Value"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Period,weight:W.EditorContrib}})}run(e,t){const i=ew.get(t);return i?i.run(this.id,!0):Promise.resolve(void 0)}}Rt(ew.ID,ew,vt.Lazy);ue(P3e);ue(L3e);class M3e{constructor(e){this._selection=e,this._selectionId=null}getEditOperations(e,t){const i=N3e(e);i&&t.addEditOperation(i.range,i.text),this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function N3e(s){const e=s.getLineCount(),t=s.getLineContent(e),i=Tb(t)===-1;if(!(!e||i))return Ki.insert(new _e(e,s.getLineMaxColumn(e)),s.getEOL())}class D5 extends we{static{this.ID="editor.action.insertFinalNewLine"}constructor(){super({id:D5.ID,label:I(1301,"Insert Final New Line"),precondition:V.writable})}run(e,t,i){const n=t.getSelection();if(n===null)return;const o=new M3e(n);t.pushUndoStop(),t.executeCommands(this.id,[o]),t.pushUndoStop()}}ue(D5);class O3e extends we{constructor(){super({id:"expandLineSelection",label:I(1302,"Expand Line Selection"),precondition:void 0,kbOpts:{weight:W.EditorCore,kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.KeyL}})}run(e,t,i){if(i=i||{},!t.hasModel())return;const n=t._getViewModel();n.model.pushStackElement(),n.setCursorStates(i.source,Ls.Explicit,jq.expandLineSelection(n,n.getCursorStates())),n.revealAllCursors(i.source,!0)}}ue(O3e);class vpe{constructor(e,t,i){this._selection=e,this._isCopyingDown=t,this._noop=i||!1,this._selectionDirection=hwe.LTR,this._selectionId=null,this._startLineNumberDelta=0,this._endLineNumberDelta=0}getEditOperations(e,t){let i=this._selection;this._startLineNumberDelta=0,this._endLineNumberDelta=0,i.startLineNumber<i.endLineNumber&&i.endColumn===1&&(this._endLineNumberDelta=1,i=i.setEndPosition(i.endLineNumber-1,e.getLineMaxColumn(i.endLineNumber-1)));const n=[];for(let r=i.startLineNumber;r<=i.endLineNumber;r++)n.push(e.getLineContent(r));const o=n.join(`
`);o===""&&this._isCopyingDown&&(this._startLineNumberDelta++,this._endLineNumberDelta++),this._noop?t.addEditOperation(new P(i.endLineNumber,e.getLineMaxColumn(i.endLineNumber),i.endLineNumber+1,1),i.endLineNumber===e.getLineCount()?"":`
`):this._isCopyingDown?t.addEditOperation(new P(i.startLineNumber,1,i.startLineNumber,1),o+`
`):t.addEditOperation(new P(i.endLineNumber,e.getLineMaxColumn(i.endLineNumber),i.endLineNumber,e.getLineMaxColumn(i.endLineNumber)),`
`+o),this._selectionId=t.trackSelection(i),this._selectionDirection=this._selection.getDirection()}computeCursorState(e,t){let i=t.getTrackedSelection(this._selectionId);if(this._startLineNumberDelta!==0||this._endLineNumberDelta!==0){let n=i.startLineNumber,o=i.startColumn,r=i.endLineNumber,a=i.endColumn;this._startLineNumberDelta!==0&&(n=n+this._startLineNumberDelta,o=1),this._endLineNumberDelta!==0&&(r=r+this._endLineNumberDelta,a=1),i=at.createWithDirection(n,o,r,a,this._selectionDirection)}return i}}let pG=class{constructor(e,t,i,n){this._languageConfigurationService=n,this._selection=e,this._isMovingDown=t,this._autoIndent=i,this._selectionId=null,this._moveEndLineSelectionShrink=!1}getEditOperations(e,t){const i=()=>e.getLanguageId(),n=(u,g)=>e.getLanguageIdAtPosition(u,g),o=e.getLineCount();if(this._isMovingDown&&this._selection.endLineNumber===o){this._selectionId=t.trackSelection(this._selection);return}if(!this._isMovingDown&&this._selection.startLineNumber===1){this._selectionId=t.trackSelection(this._selection);return}this._moveEndPositionDown=!1;let r=this._selection;r.startLineNumber<r.endLineNumber&&r.endColumn===1&&(this._moveEndPositionDown=!0,r=r.setEndPosition(r.endLineNumber-1,e.getLineMaxColumn(r.endLineNumber-1)));const{tabSize:a,indentSize:c,insertSpaces:d}=e.getOptions(),l=this.buildIndentConverter(a,c,d);if(r.startLineNumber===r.endLineNumber&&e.getLineMaxColumn(r.startLineNumber)===1){const u=r.startLineNumber,g=this._isMovingDown?u+1:u-1;e.getLineMaxColumn(g)===1?t.addEditOperation(new P(1,1,1,1),null):(t.addEditOperation(new P(u,1,u,1),e.getLineContent(g)),t.addEditOperation(new P(g,1,g,e.getLineMaxColumn(g)),null)),r=new at(g,1,g,1)}else{let u,g;if(this._isMovingDown){u=r.endLineNumber+1,g=e.getLineContent(u),t.addEditOperation(new P(u-1,e.getLineMaxColumn(u-1),u,e.getLineMaxColumn(u)),null);let m=g;if(this.shouldAutoIndent(e,r)){const v=this.matchEnterRule(e,l,a,u,r.startLineNumber-1);if(v!==null){const w=to(e.getLineContent(u)),C=v+Kr(w,a);m=uE(C,a,d)+this.trimStart(g)}else{const w={tokenization:{getLineTokens:T=>T===r.startLineNumber?e.tokenization.getLineTokens(u):e.tokenization.getLineTokens(T),getLanguageId:i,getLanguageIdAtPosition:n},getLineContent:T=>T===r.startLineNumber?e.getLineContent(u):e.getLineContent(T)},C=vC(this._autoIndent,w,e.getLanguageIdAtPosition(u,1),r.startLineNumber,l,this._languageConfigurationService);if(C!==null){const T=to(e.getLineContent(u)),k=Kr(C,a),A=Kr(T,a);k!==A&&(m=uE(k,a,d)+this.trimStart(g))}}t.addEditOperation(new P(r.startLineNumber,1,r.startLineNumber,1),m+`
`);const y=this.matchEnterRuleMovingDown(e,l,a,r.startLineNumber,u,m);if(y!==null)y!==0&&this.getIndentEditsOfMovingBlock(e,t,r,a,d,y);else{const w={tokenization:{getLineTokens:T=>T===r.startLineNumber?e.tokenization.getLineTokens(u):T>=r.startLineNumber+1&&T<=r.endLineNumber+1?e.tokenization.getLineTokens(T-1):e.tokenization.getLineTokens(T),getLanguageId:i,getLanguageIdAtPosition:n},getLineContent:T=>T===r.startLineNumber?m:T>=r.startLineNumber+1&&T<=r.endLineNumber+1?e.getLineContent(T-1):e.getLineContent(T)},C=vC(this._autoIndent,w,e.getLanguageIdAtPosition(u,1),r.startLineNumber+1,l,this._languageConfigurationService);if(C!==null){const T=to(e.getLineContent(r.startLineNumber)),k=Kr(C,a),A=Kr(T,a);if(k!==A){const B=k-A;this.getIndentEditsOfMovingBlock(e,t,r,a,d,B)}}}}else t.addEditOperation(new P(r.startLineNumber,1,r.startLineNumber,1),m+`
`)}else if(u=r.startLineNumber-1,g=e.getLineContent(u),t.addEditOperation(new P(u,1,u+1,1),null),t.addEditOperation(new P(r.endLineNumber,e.getLineMaxColumn(r.endLineNumber),r.endLineNumber,e.getLineMaxColumn(r.endLineNumber)),`
`+g),this.shouldAutoIndent(e,r)){const m={tokenization:{getLineTokens:y=>y===u?e.tokenization.getLineTokens(r.startLineNumber):e.tokenization.getLineTokens(y),getLanguageId:i,getLanguageIdAtPosition:n},getLineContent:y=>y===u?e.getLineContent(r.startLineNumber):e.getLineContent(y)},v=this.matchEnterRule(e,l,a,r.startLineNumber,r.startLineNumber-2);if(v!==null)v!==0&&this.getIndentEditsOfMovingBlock(e,t,r,a,d,v);else{const y=vC(this._autoIndent,m,e.getLanguageIdAtPosition(r.startLineNumber,1),u,l,this._languageConfigurationService);if(y!==null){const w=to(e.getLineContent(r.startLineNumber)),C=Kr(y,a),T=Kr(w,a);if(C!==T){const k=C-T;this.getIndentEditsOfMovingBlock(e,t,r,a,d,k)}}}}}this._selectionId=t.trackSelection(r)}buildIndentConverter(e,t,i){return{shiftIndent:n=>ly.shiftIndent(n,n.length+1,e,t,i),unshiftIndent:n=>ly.unshiftIndent(n,n.length+1,e,t,i)}}parseEnterResult(e,t,i,n,o){if(o){let r=o.indentation;o.indentAction===VD.None||o.indentAction===VD.Indent?r=o.indentation+o.appendText:o.indentAction===VD.IndentOutdent?r=o.indentation:o.indentAction===VD.Outdent&&(r=t.unshiftIndent(o.indentation)+o.appendText);const a=e.getLineContent(n);if(this.trimStart(a).indexOf(this.trimStart(r))>=0){const c=to(e.getLineContent(n));let d=to(r);const l=Lse(e,n,this._languageConfigurationService);l!==null&&l&Mse.DECREASE_MASK&&(d=t.unshiftIndent(d));const u=Kr(d,i),g=Kr(c,i);return u-g}}return null}matchEnterRuleMovingDown(e,t,i,n,o,r){if(Tb(r)>=0){const a=e.getLineMaxColumn(o),c=c0(this._autoIndent,e,new P(o,a,o,a),this._languageConfigurationService);return this.parseEnterResult(e,t,i,n,c)}else{let a=n-1;for(;a>=1;){const l=e.getLineContent(a);if(Tb(l)>=0)break;a--}if(a<1||n>e.getLineCount())return null;const c=e.getLineMaxColumn(a),d=c0(this._autoIndent,e,new P(a,c,a,c),this._languageConfigurationService);return this.parseEnterResult(e,t,i,n,d)}}matchEnterRule(e,t,i,n,o,r){let a=o;for(;a>=1;){let l;if(a===o&&r!==void 0?l=r:l=e.getLineContent(a),Tb(l)>=0)break;a--}if(a<1||n>e.getLineCount())return null;const c=e.getLineMaxColumn(a),d=c0(this._autoIndent,e,new P(a,c,a,c),this._languageConfigurationService);return this.parseEnterResult(e,t,i,n,d)}trimStart(e){return e.replace(/^\s+/,"")}shouldAutoIndent(e,t){if(this._autoIndent<fse.Full||!e.tokenization.isCheapToTokenize(t.startLineNumber))return!1;const i=e.getLanguageIdAtPosition(t.startLineNumber,1),n=e.getLanguageIdAtPosition(t.endLineNumber,1);return!(i!==n||this._languageConfigurationService.getLanguageConfiguration(i).indentRulesSupport===null)}getIndentEditsOfMovingBlock(e,t,i,n,o,r){for(let a=i.startLineNumber;a<=i.endLineNumber;a++){const c=e.getLineContent(a),d=to(c),u=Kr(d,n)+r,g=uE(u,n,o);g!==d&&(t.addEditOperation(new P(a,1,a,d.length+1),g),a===i.endLineNumber&&i.endColumn<=d.length+1&&g===""&&(this._moveEndLineSelectionShrink=!0))}}computeCursorState(e,t){let i=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(i=i.setEndPosition(i.endLineNumber+1,1)),this._moveEndLineSelectionShrink&&i.startLineNumber<i.endLineNumber&&(i=i.setEndPosition(i.endLineNumber,2)),i}};pG=f([p(3,rs)],pG);class fG{static{this._COLLATOR=Oq.Collator()}constructor(e,t){this.selection=e,this.descending=t,this.selectionId=null}getEditOperations(e,t){const i=F3e(e,this.selection,this.descending);i&&t.addEditOperation(i.range,i.text),this.selectionId=t.trackSelection(this.selection)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}static canRun(e,t,i){if(e===null)return!1;const n=_pe(e,t,i);if(!n)return!1;for(let o=0,r=n.before.length;o<r;o++)if(n.before[o]!==n.after[o])return!0;return!1}}function _pe(s,e,t){const i=e.startLineNumber;let n=e.endLineNumber;if(e.endColumn===1&&n--,i>=n)return null;const o=[];for(let a=i;a<=n;a++)o.push(s.getLineContent(a));let r=o.slice(0);return r.sort(fG._COLLATOR.value.compare),t===!0&&(r=r.reverse()),{startLineNumber:i,endLineNumber:n,before:o,after:r}}function F3e(s,e,t){const i=_pe(s,e,t);return i?Ki.replace(new P(i.startLineNumber,1,i.endLineNumber,s.getLineMaxColumn(i.endLineNumber)),i.after.join(`
`)):null}class bpe extends we{constructor(e,t){super(t),this.down=e}run(e,t){if(!t.hasModel())return;const i=t.getSelections().map((r,a)=>({selection:r,index:a,ignore:!1}));i.sort((r,a)=>P.compareRangesUsingStarts(r.selection,a.selection));let n=i[0];for(let r=1;r<i.length;r++){const a=i[r];n.selection.endLineNumber===a.selection.startLineNumber&&(n.index<a.index?a.ignore=!0:(n.ignore=!0,n=a))}const o=[];for(const r of i)o.push(new vpe(r.selection,this.down,r.ignore));t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class W3e extends bpe{constructor(){super(!1,{id:"editor.action.copyLinesUpAction",label:I(1303,"Copy Line Up"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|E.Shift|S.UpArrow,linux:{primary:E.CtrlCmd|E.Alt|E.Shift|S.UpArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1304,"&&Copy Line Up"),order:1}})}}class B3e extends bpe{constructor(){super(!0,{id:"editor.action.copyLinesDownAction",label:I(1305,"Copy Line Down"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|E.Shift|S.DownArrow,linux:{primary:E.CtrlCmd|E.Alt|E.Shift|S.DownArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1306,"Co&&py Line Down"),order:2}})}}class V3e extends we{constructor(){super({id:"editor.action.duplicateSelection",label:I(1307,"Duplicate Selection"),precondition:V.writable,menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1308,"&&Duplicate Selection"),order:5}})}run(e,t,i){if(!t.hasModel())return;const n=[],o=t.getSelections(),r=t.getModel();for(const a of o)if(a.isEmpty())n.push(new vpe(a,!0));else{const c=new at(a.endLineNumber,a.endColumn,a.endLineNumber,a.endColumn);n.push(new YSe(c,r.getValueInRange(a)))}t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop()}}class ype extends we{constructor(e,t){super(t),this.down=e}run(e,t){const i=e.get(rs),n=[],o=t.getSelections()||[],r=t.getOption(L.autoIndent);for(const a of o)n.push(new pG(a,this.down,r,i));t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop()}}class H3e extends ype{constructor(){super(!1,{id:"editor.action.moveLinesUpAction",label:I(1309,"Move Line Up"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|S.UpArrow,linux:{primary:E.Alt|S.UpArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1310,"Mo&&ve Line Up"),order:3}})}}class U3e extends ype{constructor(){super(!0,{id:"editor.action.moveLinesDownAction",label:I(1311,"Move Line Down"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|S.DownArrow,linux:{primary:E.Alt|S.DownArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1312,"Move &&Line Down"),order:4}})}}class wpe extends we{constructor(e,t){super(t),this.descending=e}run(e,t){if(!t.hasModel())return;const i=t.getModel();let n=t.getSelections();n.length===1&&n[0].isEmpty()&&(n=[new at(1,1,i.getLineCount(),i.getLineMaxColumn(i.getLineCount()))]);for(const r of n)if(!fG.canRun(t.getModel(),r,this.descending))return;const o=[];for(let r=0,a=n.length;r<a;r++)o[r]=new fG(n[r],this.descending);t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class $3e extends wpe{constructor(){super(!1,{id:"editor.action.sortLinesAscending",label:I(1313,"Sort Lines Ascending"),precondition:V.writable})}}class G3e extends wpe{constructor(){super(!0,{id:"editor.action.sortLinesDescending",label:I(1314,"Sort Lines Descending"),precondition:V.writable})}}class q3e extends we{constructor(){super({id:"editor.action.removeDuplicateLines",label:I(1315,"Delete Duplicate Lines"),precondition:V.writable})}run(e,t){if(!t.hasModel())return;const i=t.getModel();if(i.getLineCount()===1&&i.getLineMaxColumn(1)===1)return;const n=[],o=[];let r=0,a=!0,c=t.getSelections();c.length===1&&c[0].isEmpty()&&(c=[new at(1,1,i.getLineCount(),i.getLineMaxColumn(i.getLineCount()))],a=!1);for(const d of c){const l=new Set,u=[];for(let y=d.startLineNumber;y<=d.endLineNumber;y++){const w=i.getLineContent(y);l.has(w)||(u.push(w),l.add(w))}const g=new at(d.startLineNumber,1,d.endLineNumber,i.getLineMaxColumn(d.endLineNumber)),m=d.startLineNumber-r,v=new at(m,1,m+u.length-1,u[u.length-1].length);n.push(Ki.replace(g,u.join(`
`))),o.push(v),r+=d.endLineNumber-d.startLineNumber+1-u.length}t.pushUndoStop(),t.executeEdits(this.id,n,a?o:void 0),t.pushUndoStop()}}class k5 extends we{static{this.ID="editor.action.trimTrailingWhitespace"}constructor(){super({id:k5.ID,label:I(1316,"Trim Trailing Whitespace"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyX),weight:W.EditorContrib}})}run(e,t,i){let n=[];i.reason==="auto-save"&&(n=(t.getSelections()||[]).map(l=>new _e(l.positionLineNumber,l.positionColumn)));const o=t.getSelection();if(o===null)return;const r=e.get(ne),a=t.getModel(),c=r.getValue("files.trimTrailingWhitespaceInRegexAndStrings",{overrideIdentifier:a?.getLanguageId(),resource:a?.uri}),d=new LUe(o,n,c);t.pushUndoStop(),t.executeCommands(this.id,[d]),t.pushUndoStop()}}class z3e extends we{constructor(){super({id:"editor.action.deleteLines",label:I(1317,"Delete Line"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|E.Shift|S.KeyK,weight:W.EditorContrib}})}run(e,t){if(!t.hasModel())return;const i=this._getLinesToRemove(t),n=t.getModel();if(n.getLineCount()===1&&n.getLineMaxColumn(1)===1)return;let o=0;const r=[],a=[];for(let c=0,d=i.length;c<d;c++){const l=i[c];let u=l.startLineNumber,g=l.endLineNumber,m=1,v=n.getLineMaxColumn(g);g<n.getLineCount()?(g+=1,v=1):u>1&&(u-=1,m=n.getLineMaxColumn(u)),r.push(Ki.replace(new at(u,m,g,v),"")),a.push(new at(u-o,l.positionColumn,u-o,l.positionColumn)),o+=l.endLineNumber-l.startLineNumber+1}t.pushUndoStop(),t.executeEdits(this.id,r,a),t.pushUndoStop()}_getLinesToRemove(e){const t=e.getSelections().map(o=>{let r=o.endLineNumber;return o.startLineNumber<o.endLineNumber&&o.endColumn===1&&(r-=1),{startLineNumber:o.startLineNumber,selectionStartColumn:o.selectionStartColumn,endLineNumber:r,positionColumn:o.positionColumn}});t.sort((o,r)=>o.startLineNumber===r.startLineNumber?o.endLineNumber-r.endLineNumber:o.startLineNumber-r.startLineNumber);const i=[];let n=t[0];for(let o=1;o<t.length;o++)n.endLineNumber+1>=t[o].startLineNumber?n.endLineNumber=t[o].endLineNumber:(i.push(n),n=t[o]);return i.push(n),i}}class K3e extends we{constructor(){super({id:"editor.action.indentLines",label:I(1318,"Indent Line"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.BracketRight,weight:W.EditorContrib}})}run(e,t){const i=t._getViewModel();i&&(t.pushUndoStop(),t.executeCommands(this.id,QSe.indent(i.cursorConfig,t.getModel(),t.getSelections())),t.pushUndoStop())}}class j3e extends we{constructor(){super({id:"editor.action.outdentLines",label:I(1319,"Outdent Line"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.BracketLeft,weight:W.EditorContrib}})}run(e,t){Lk.Outdent.runEditorCommand(e,t,null)}}class Y3e extends we{constructor(){super({id:"editor.action.insertLineBefore",label:I(1320,"Insert Line Above"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Enter,weight:W.EditorContrib}})}run(e,t){const i=t._getViewModel();i&&(t.pushUndoStop(),t.executeCommands(this.id,Nse.lineInsertBefore(i.cursorConfig,t.getModel(),t.getSelections())))}}class Q3e extends we{constructor(){super({id:"editor.action.insertLineAfter",label:I(1321,"Insert Line Below"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.Enter,weight:W.EditorContrib}})}run(e,t){const i=t._getViewModel();i&&(t.pushUndoStop(),t.executeCommands(this.id,Nse.lineInsertAfter(i.cursorConfig,t.getModel(),t.getSelections())))}}class Spe extends we{run(e,t){if(!t.hasModel())return;const i=t.getSelection(),n=this._getRangesToDelete(t),o=[];for(let c=0,d=n.length-1;c<d;c++){const l=n[c],u=n[c+1];P.intersectRanges(l,u)===null?o.push(l):n[c+1]=P.plusRange(l,u)}o.push(n[n.length-1]);const r=this._getEndCursorState(i,o),a=o.map(c=>Ki.replace(c,""));t.pushUndoStop(),t.executeEdits(this.id,a,r),t.pushUndoStop()}}class X3e extends Spe{constructor(){super({id:"deleteAllLeft",label:I(1322,"Delete All Left"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.CtrlCmd|S.Backspace},weight:W.EditorContrib}})}_getEndCursorState(e,t){let i=null;const n=[];let o=0;return t.forEach(r=>{let a;if(r.endColumn===1&&o>0){const c=r.startLineNumber-o;a=new at(c,r.startColumn,c,r.startColumn)}else a=new at(r.startLineNumber,r.startColumn,r.startLineNumber,r.startColumn);o+=r.endLineNumber-r.startLineNumber,r.intersectRanges(e)?i=a:n.push(a)}),i&&n.unshift(i),n}_getRangesToDelete(e){const t=e.getSelections();if(t===null)return[];let i=t;const n=e.getModel();return n===null?[]:(i.sort(P.compareRangesUsingStarts),i=i.map(o=>{if(o.isEmpty())if(o.startColumn===1){const r=Math.max(1,o.startLineNumber-1),a=o.startLineNumber===1?1:n.getLineLength(r)+1;return new P(r,a,o.startLineNumber,1)}else return new P(o.startLineNumber,1,o.startLineNumber,o.startColumn);else return new P(o.startLineNumber,1,o.endLineNumber,o.endColumn)}),i)}}class Z3e extends Spe{constructor(){super({id:"deleteAllRight",label:I(1323,"Delete All Right"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|S.KeyK,secondary:[E.CtrlCmd|S.Delete]},weight:W.EditorContrib}})}_getEndCursorState(e,t){let i=null;const n=[];for(let o=0,r=t.length,a=0;o<r;o++){const c=t[o],d=new at(c.startLineNumber-a,c.startColumn,c.startLineNumber-a,c.startColumn);c.intersectRanges(e)?i=d:n.push(d)}return i&&n.unshift(i),n}_getRangesToDelete(e){const t=e.getModel();if(t===null)return[];const i=e.getSelections();if(i===null)return[];const n=i.map(o=>{if(o.isEmpty()){const r=t.getLineMaxColumn(o.startLineNumber);return o.startColumn===r?new P(o.startLineNumber,o.startColumn,o.startLineNumber+1,1):new P(o.startLineNumber,o.startColumn,o.startLineNumber,r)}return o});return n.sort(P.compareRangesUsingStarts),n}}class J3e extends we{constructor(){super({id:"editor.action.joinLines",label:I(1324,"Join Lines"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:0,mac:{primary:E.WinCtrl|S.KeyJ},weight:W.EditorContrib}})}run(e,t){const i=t.getSelections();if(i===null)return;let n=t.getSelection();if(n===null)return;i.sort(P.compareRangesUsingStarts);const o=[],r=i.reduce((g,m)=>g.isEmpty()?g.endLineNumber===m.startLineNumber?(n.equalsSelection(g)&&(n=m),m):m.startLineNumber>g.endLineNumber+1?(o.push(g),m):new at(g.startLineNumber,g.startColumn,m.endLineNumber,m.endColumn):m.startLineNumber>g.endLineNumber?(o.push(g),m):new at(g.startLineNumber,g.startColumn,m.endLineNumber,m.endColumn));o.push(r);const a=t.getModel();if(a===null)return;const c=[],d=[];let l=n,u=0;for(let g=0,m=o.length;g<m;g++){const v=o[g],y=v.startLineNumber,w=1;let C=0,T,k;const A=a.getLineLength(v.endLineNumber)-v.endColumn;if(v.isEmpty()||v.startLineNumber===v.endLineNumber){const Q=v.getStartPosition();Q.lineNumber<a.getLineCount()?(T=y+1,k=a.getLineMaxColumn(T)):(T=Q.lineNumber,k=a.getLineMaxColumn(Q.lineNumber))}else T=v.endLineNumber,k=a.getLineMaxColumn(T);let B=a.getLineContent(y);for(let Q=y+1;Q<=T;Q++){const ie=a.getLineContent(Q),oe=a.getLineFirstNonWhitespaceColumn(Q);if(oe>=1){let xe=!0;B===""&&(xe=!1),xe&&(B.charAt(B.length-1)===" "||B.charAt(B.length-1)==="	")&&(xe=!1,B=B.replace(/[\s\uFEFF\xA0]+$/g," "));const Se=ie.substr(oe-1);B+=(xe?" ":"")+Se,xe?C=Se.length+1:C=Se.length}else C=0}const z=new P(y,w,T,k);if(!z.isEmpty()){let Q;v.isEmpty()?(c.push(Ki.replace(z,B)),Q=new at(z.startLineNumber-u,B.length-C+1,y-u,B.length-C+1)):v.startLineNumber===v.endLineNumber?(c.push(Ki.replace(z,B)),Q=new at(v.startLineNumber-u,v.startColumn,v.endLineNumber-u,v.endColumn)):(c.push(Ki.replace(z,B)),Q=new at(v.startLineNumber-u,v.startColumn,v.startLineNumber-u,B.length-A)),P.intersectRanges(z,n)!==null?l=Q:d.push(Q)}u+=z.endLineNumber-z.startLineNumber}d.unshift(l),t.pushUndoStop(),t.executeEdits(this.id,c,d),t.pushUndoStop()}}class eGe extends we{constructor(){super({id:"editor.action.transpose",label:I(1325,"Transpose Characters around the Cursor"),precondition:V.writable})}run(e,t){const i=t.getSelections();if(i===null)return;const n=t.getModel();if(n===null)return;const o=[];for(let r=0,a=i.length;r<a;r++){const c=i[r];if(!c.isEmpty())continue;const d=c.getStartPosition(),l=n.getLineMaxColumn(d.lineNumber);if(d.column>=l){if(d.lineNumber===n.getLineCount())continue;const u=new P(d.lineNumber,Math.max(1,d.column-1),d.lineNumber+1,1),g=n.getValueInRange(u).split("").reverse().join("");o.push(new uI(new at(d.lineNumber,Math.max(1,d.column-1),d.lineNumber+1,1),g))}else{const u=new P(d.lineNumber,Math.max(1,d.column-1),d.lineNumber,d.column+1),g=n.getValueInRange(u).split("").reverse().join("");o.push(new Pse(u,g,new at(d.lineNumber,d.column+1,d.lineNumber,d.column+1)))}}t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class p_ extends we{run(e,t){const i=t.getSelections();if(i===null)return;const n=t.getModel();if(n===null)return;const o=t.getOption(L.wordSeparators),r=[];for(const a of i)if(a.isEmpty()){const c=a.getStartPosition(),d=t.getConfiguredWordAtPosition(c);if(!d)continue;const l=new P(c.lineNumber,d.startColumn,c.lineNumber,d.endColumn),u=n.getValueInRange(l);r.push(Ki.replace(l,this._modifyText(u,o)))}else{const c=n.getValueInRange(a);r.push(Ki.replace(a,this._modifyText(c,o)))}t.pushUndoStop(),t.executeEdits(this.id,r),t.pushUndoStop()}}class tGe extends p_{constructor(){super({id:"editor.action.transformToUppercase",label:I(1326,"Transform to Uppercase"),precondition:V.writable})}_modifyText(e,t){return e.toLocaleUpperCase()}}class iGe extends p_{constructor(){super({id:"editor.action.transformToLowercase",label:I(1327,"Transform to Lowercase"),precondition:V.writable})}_modifyText(e,t){return e.toLocaleLowerCase()}}class Gu{constructor(e,t){this._pattern=e,this._flags=t,this._actual=null,this._evaluated=!1}get(){if(!this._evaluated){this._evaluated=!0;try{this._actual=new RegExp(this._pattern,this._flags)}catch{}}return this._actual}isSupported(){return this.get()!==null}}class uM extends p_{static{this.titleBoundary=new Gu("(^|[^\\p{L}\\p{N}']|((^|\\P{L})'))\\p{L}","gmu")}constructor(){super({id:"editor.action.transformToTitlecase",label:I(1328,"Transform to Title Case"),precondition:V.writable})}_modifyText(e,t){const i=uM.titleBoundary.get();return i?e.toLocaleLowerCase().replace(i,n=>n.toLocaleUpperCase()):e}}class Qb extends p_{static{this.caseBoundary=new Gu("(\\p{Ll})(\\p{Lu})","gmu")}static{this.singleLetters=new Gu("(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})","gmu")}constructor(){super({id:"editor.action.transformToSnakecase",label:I(1329,"Transform to Snake Case"),precondition:V.writable})}_modifyText(e,t){const i=Qb.caseBoundary.get(),n=Qb.singleLetters.get();return!i||!n?e:e.replace(i,"$1_$2").replace(n,"$1_$2$3").toLocaleLowerCase()}}class gM extends p_{static{this.wordBoundary=new Gu("[_\\s-]","gm")}constructor(){super({id:"editor.action.transformToCamelcase",label:I(1330,"Transform to Camel Case"),precondition:V.writable})}_modifyText(e,t){const i=gM.wordBoundary.get();if(!i)return e;const n=e.split(i);return n.shift()+n.map(r=>r.substring(0,1).toLocaleUpperCase()+r.substring(1)).join("")}}class Gx extends p_{static{this.wordBoundary=new Gu("[_\\s-]","gm")}static{this.wordBoundaryToMaintain=new Gu("(?<=\\.)","gm")}constructor(){super({id:"editor.action.transformToPascalcase",label:I(1331,"Transform to Pascal Case"),precondition:V.writable})}_modifyText(e,t){const i=Gx.wordBoundary.get(),n=Gx.wordBoundaryToMaintain.get();return!i||!n?e:e.split(n).map(a=>a.split(i)).flat().map(a=>a.substring(0,1).toLocaleUpperCase()+a.substring(1)).join("")}}class Xb extends p_{static isSupported(){return[this.caseBoundary,this.singleLetters,this.underscoreBoundary].every(t=>t.isSupported())}static{this.caseBoundary=new Gu("(\\p{Ll})(\\p{Lu})","gmu")}static{this.singleLetters=new Gu("(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})","gmu")}static{this.underscoreBoundary=new Gu("(\\S)(_)(\\S)","gm")}constructor(){super({id:"editor.action.transformToKebabcase",label:I(1332,"Transform to Kebab Case"),precondition:V.writable})}_modifyText(e,t){const i=Xb.caseBoundary.get(),n=Xb.singleLetters.get(),o=Xb.underscoreBoundary.get();return!i||!n||!o?e:e.replace(o,"$1-$3").replace(i,"$1-$2").replace(n,"$1-$2").toLocaleLowerCase()}}ue(W3e);ue(B3e);ue(V3e);ue(H3e);ue(U3e);ue($3e);ue(G3e);ue(q3e);ue(k5);ue(z3e);ue(K3e);ue(j3e);ue(Y3e);ue(Q3e);ue(X3e);ue(Z3e);ue(J3e);ue(eGe);ue(tGe);ue(iGe);Qb.caseBoundary.isSupported()&&Qb.singleLetters.isSupported()&&ue(Qb);gM.wordBoundary.isSupported()&&ue(gM);Gx.wordBoundary.isSupported()&&ue(Gx);uM.titleBoundary.isSupported()&&ue(uM);Xb.isSupported()&&ue(Xb);const nGe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var ET;Be(nGe);const Cpe=new O("LinkedEditingInputVisible",!1),sGe="linked-editing-decoration";let tw=class extends F{static{ET=this}static{this.ID="editor.contrib.linkedEditing"}static{this.DECORATION=Yt.register({description:"linked-editing",stickiness:Di.AlwaysGrowsWhenTypingAtEdges,className:sGe})}static get(e){return e.getContribution(ET.ID)}constructor(e,t,i,n,o){super(),this.languageConfigurationService=n,this._syncRangesToken=0,this._localToDispose=this._register(new U),this._editor=e,this._providers=i.linkedEditingRangeProvider,this._enabled=!1,this._visibleContextKey=Cpe.bindTo(t),this._debounceInformation=o.for(this._providers,"Linked Editing",{max:200}),this._currentDecorations=this._editor.createDecorationsCollection(),this._languageWordPattern=null,this._currentWordPattern=null,this._ignoreChangeEvent=!1,this._localToDispose=this._register(new U),this._rangeUpdateTriggerPromise=null,this._rangeSyncTriggerPromise=null,this._currentRequestCts=null,this._currentRequestPosition=null,this._currentRequestModelVersion=null,this._register(this._editor.onDidChangeModel(()=>this.reinitialize(!0))),this._register(this._editor.onDidChangeConfiguration(r=>{(r.hasChanged(L.linkedEditing)||r.hasChanged(L.renameOnType))&&this.reinitialize(!1)})),this._register(this._providers.onDidChange(()=>this.reinitialize(!1))),this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(!0))),this.reinitialize(!0)}reinitialize(e){const t=this._editor.getModel(),i=t!==null&&(this._editor.getOption(L.linkedEditing)||this._editor.getOption(L.renameOnType))&&this._providers.has(t);if(i===this._enabled&&!e||(this._enabled=i,this.clearRanges(),this._localToDispose.clear(),!i||t===null))return;this._localToDispose.add(D.runAndSubscribe(t.onDidChangeLanguageConfiguration,()=>{this._languageWordPattern=this.languageConfigurationService.getLanguageConfiguration(t.getLanguageId()).getWordDefinition()}));const n=new tg(this._debounceInformation.get(t)),o=()=>{this._rangeUpdateTriggerPromise=n.trigger(()=>this.updateRanges(),this._debounceDuration??this._debounceInformation.get(t))},r=new tg(0),a=c=>{this._rangeSyncTriggerPromise=r.trigger(()=>this._syncRanges(c))};this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{o()})),this._localToDispose.add(this._editor.onDidChangeModelContent(c=>{if(!this._ignoreChangeEvent&&this._currentDecorations.length>0){const d=this._currentDecorations.getRange(0);if(d&&c.changes.every(l=>d.intersectRanges(l.range))){a(this._syncRangesToken);return}}o()})),this._localToDispose.add({dispose:()=>{n.dispose(),r.dispose()}}),this.updateRanges()}_syncRanges(e){if(!this._editor.hasModel()||e!==this._syncRangesToken||this._currentDecorations.length===0)return;const t=this._editor.getModel(),i=this._currentDecorations.getRange(0);if(!i||i.startLineNumber!==i.endLineNumber)return this.clearRanges();const n=t.getValueInRange(i);if(this._currentWordPattern){const r=n.match(this._currentWordPattern);if((r?r[0].length:0)!==n.length)return this.clearRanges()}const o=[];for(let r=1,a=this._currentDecorations.length;r<a;r++){const c=this._currentDecorations.getRange(r);if(c)if(c.startLineNumber!==c.endLineNumber)o.push({range:c,text:n});else{let d=t.getValueInRange(c),l=n,u=c.startColumn,g=c.endColumn;const m=rf(d,l);u+=m,d=d.substr(m),l=l.substr(m);const v=Hq(d,l);g-=v,d=d.substr(0,d.length-v),l=l.substr(0,l.length-v),(u!==g||l.length!==0)&&o.push({range:new P(c.startLineNumber,u,c.endLineNumber,g),text:l})}}if(o.length!==0)try{this._editor.popUndoStop(),this._ignoreChangeEvent=!0;const r=this._editor._getViewModel().getPrevEditOperationType();this._editor.executeEdits("linkedEditing",o),this._editor._getViewModel().setPrevEditOperationType(r)}finally{this._ignoreChangeEvent=!1}}dispose(){this.clearRanges(),super.dispose()}clearRanges(){this._visibleContextKey.set(!1),this._currentDecorations.clear(),this._currentRequestCts&&(this._currentRequestCts.cancel(),this._currentRequestCts=null,this._currentRequestPosition=null)}get currentUpdateTriggerPromise(){return this._rangeUpdateTriggerPromise||Promise.resolve()}get currentSyncTriggerPromise(){return this._rangeSyncTriggerPromise||Promise.resolve()}async updateRanges(e=!1){if(!this._editor.hasModel()){this.clearRanges();return}const t=this._editor.getPosition();if(!this._enabled&&!e||this._editor.getSelections().length>1){this.clearRanges();return}const i=this._editor.getModel(),n=i.getVersionId();if(this._currentRequestPosition&&this._currentRequestModelVersion===n){if(t.equals(this._currentRequestPosition))return;if(this._currentDecorations.length>0){const r=this._currentDecorations.getRange(0);if(r&&r.containsPosition(t))return}}this.clearRanges(),this._currentRequestPosition=t,this._currentRequestModelVersion=n;const o=this._currentRequestCts=new ri;try{const r=new zn(!1),a=await Epe(this._providers,i,t,o.token);if(this._debounceInformation.update(i,r.elapsed()),o!==this._currentRequestCts||(this._currentRequestCts=null,n!==i.getVersionId()))return;let c=[];a?.ranges&&(c=a.ranges),this._currentWordPattern=a?.wordPattern||this._languageWordPattern;let d=!1;for(let u=0,g=c.length;u<g;u++)if(P.containsPosition(c[u],t)){if(d=!0,u!==0){const m=c[u];c.splice(u,1),c.unshift(m)}break}if(!d){this.clearRanges();return}const l=c.map(u=>({range:u,options:ET.DECORATION}));this._visibleContextKey.set(!0),this._currentDecorations.set(l),this._syncRangesToken++}catch(r){gs(r)||mt(r),(this._currentRequestCts===o||!this._currentRequestCts)&&this.clearRanges()}}setDebounceDuration(e){this._debounceDuration=e}};tw=ET=f([p(1,me),p(2,Ne),p(3,rs),p(4,Sd)],tw);class oGe extends we{constructor(){super({id:"editor.action.linkedEditing",label:I(1333,"Start Linked Editing"),precondition:x.and(V.writable,V.hasRenameProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.F2,weight:W.EditorContrib}})}runCommand(e,t){const i=e.get(Ot),[n,o]=Array.isArray(t)&&t||[void 0,void 0];return R.isUri(n)&&_e.isIPosition(o)?i.openCodeEditor({resource:n},i.getActiveCodeEditor()).then(r=>{r&&(r.setPosition(o),r.invokeWithinContext(a=>(this.reportTelemetry(a,r),this.run(a,r))))},mt):super.runCommand(e,t)}run(e,t){const i=tw.get(t);return i?Promise.resolve(i.updateRanges(!0)):Promise.resolve()}}const rGe=No.bindToContribution(tw.get);Ue(new rGe({id:"cancelLinkedEditingInput",precondition:Cpe,handler:s=>s.clearRanges(),kbOpts:{kbExpr:V.editorTextFocus,weight:W.EditorContrib+99,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));function Epe(s,e,t,i){const n=s.ordered(e);return Gq(n.map(o=>async()=>{try{return await o.provideLinkedEditingRanges(e,t,i)}catch(r){kn(r);return}}),o=>!!o&&xn(o?.ranges))}H("editor.linkedEditingBackground",{dark:be.fromHex("#f00").transparent(.3),light:be.fromHex("#f00").transparent(.3),hcDark:be.fromHex("#f00").transparent(.3),hcLight:be.white},h(1334,"Background color when the editor auto renames on type."));Ar("_executeLinkedEditingProvider",(s,e,t)=>{const{linkedEditingRangeProvider:i}=s.get(Ne);return Epe(i,e,t,ye.None)});Rt(tw.ID,tw,vt.AfterFirstRender);ue(oGe);class pM extends F{static{this.ID="editor.contrib.longLinesHelper"}static get(e){return e.getContribution(pM.ID)}constructor(e){super(),this._editor=e,this._register(this._editor.onMouseDown(t=>{const i=this._editor.getOption(L.stopRenderingLineAfter);i>=0&&t.target.type===Ei.CONTENT_TEXT&&t.target.position.column>=i&&this._editor.updateOptions({stopRenderingLineAfter:-1})}))}}Rt(pM.ID,pM,vt.BeforeFirstInteraction);const aGe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(aGe);const cGe=H("editor.wordHighlightBackground",{dark:"#575757B8",light:"#57575740",hcDark:null,hcLight:null},h(1610,"Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations."),!0);H("editor.wordHighlightStrongBackground",{dark:"#004972B8",light:"#0e639c40",hcDark:null,hcLight:null},h(1611,"Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations."),!0);H("editor.wordHighlightTextBackground",cGe,h(1612,"Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0);const dGe=H("editor.wordHighlightBorder",{light:null,dark:null,hcDark:Sr,hcLight:Sr},h(1613,"Border color of a symbol during read-access, like reading a variable."));H("editor.wordHighlightStrongBorder",{light:null,dark:null,hcDark:Sr,hcLight:Sr},h(1614,"Border color of a symbol during write-access, like writing to a variable."));H("editor.wordHighlightTextBorder",dGe,h(1615,"Border color of a textual occurrence for a symbol."));const lGe=H("editorOverviewRuler.wordHighlightForeground","#A0A0A0CC",h(1616,"Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),hGe=H("editorOverviewRuler.wordHighlightStrongForeground","#C0A0C0CC",h(1617,"Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),uGe=H("editorOverviewRuler.wordHighlightTextForeground",mse,h(1618,"Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0),gGe=Yt.register({description:"word-highlight-strong",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"wordHighlightStrong",overviewRuler:{color:es(hGe),position:ol.Center},minimap:{color:es(oN),position:Ym.Inline}}),pGe=Yt.register({description:"word-highlight-text",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"wordHighlightText",overviewRuler:{color:es(uGe),position:ol.Center},minimap:{color:es(oN),position:Ym.Inline}}),fGe=Yt.register({description:"selection-highlight-overview",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"selectionHighlight",overviewRuler:{color:es(mse),position:ol.Center},minimap:{color:es(oN),position:Ym.Inline}}),mGe=Yt.register({description:"selection-highlight",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"selectionHighlight"}),vGe=Yt.register({description:"word-highlight",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"wordHighlight",overviewRuler:{color:es(lGe),position:ol.Center},minimap:{color:es(oN),position:Ym.Inline}});function _Ge(s){return s===eA.Write?gGe:s===eA.Text?pGe:vGe}function bGe(s){return s?mGe:fGe}Pv((s,e)=>{const t=s.getColor(uwe);t&&e.addRule(`.monaco-editor .selectionHighlight { background-color: ${t.transparent(.5)}; }`)});var mG;function Df(s,e){const t=e.filter(i=>!s.find(n=>n.equals(i)));if(t.length>=1){const i=t.map(o=>`line ${o.viewState.position.lineNumber} column ${o.viewState.position.column}`).join(", "),n=t.length===1?h(1346,"Cursor added: {0}",i):h(1347,"Cursors added: {0}",i);Kc(n)}}class yGe extends we{constructor(){super({id:"editor.action.insertCursorAbove",label:I(1348,"Add Cursor Above"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Alt|S.UpArrow,linux:{primary:E.Shift|E.Alt|S.UpArrow,secondary:[E.CtrlCmd|E.Shift|S.UpArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1349,"&&Add Cursor Above"),order:2}})}run(e,t,i){if(!t.hasModel())return;let n=!0;i&&i.logicalLine===!1&&(n=!1);const o=t._getViewModel();if(o.cursorConfig.readOnly)return;o.model.pushStackElement();const r=o.getCursorStates();o.setCursorStates(i.source,Ls.Explicit,jq.addCursorUp(o,r,n)),o.revealTopMostCursor(i.source),Df(r,o.getCursorStates())}}class wGe extends we{constructor(){super({id:"editor.action.insertCursorBelow",label:I(1350,"Add Cursor Below"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Alt|S.DownArrow,linux:{primary:E.Shift|E.Alt|S.DownArrow,secondary:[E.CtrlCmd|E.Shift|S.DownArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1351,"A&&dd Cursor Below"),order:3}})}run(e,t,i){if(!t.hasModel())return;let n=!0;i&&i.logicalLine===!1&&(n=!1);const o=t._getViewModel();if(o.cursorConfig.readOnly)return;o.model.pushStackElement();const r=o.getCursorStates();o.setCursorStates(i.source,Ls.Explicit,jq.addCursorDown(o,r,n)),o.revealBottomMostCursor(i.source),Df(r,o.getCursorStates())}}class SGe extends we{constructor(){super({id:"editor.action.insertCursorAtEndOfEachLineSelected",label:I(1352,"Add Cursors to Line Ends"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyI,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1353,"Add C&&ursors to Line Ends"),order:4}})}getCursorsForSelection(e,t,i){if(!e.isEmpty()){for(let n=e.startLineNumber;n<e.endLineNumber;n++){const o=t.getLineMaxColumn(n);i.push(new at(n,o,n,o))}e.endColumn>1&&i.push(new at(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn))}}run(e,t){if(!t.hasModel())return;const i=t.getModel(),n=t.getSelections(),o=t._getViewModel(),r=o.getCursorStates(),a=[];n.forEach(c=>this.getCursorsForSelection(c,i,a)),a.length>0&&t.setSelections(a),Df(r,o.getCursorStates())}}class CGe extends we{constructor(){super({id:"editor.action.addCursorsToBottom",label:I(1354,"Add Cursors to Bottom"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const i=t.getSelections(),n=t.getModel().getLineCount(),o=[];for(let c=i[0].startLineNumber;c<=n;c++)o.push(new at(c,i[0].startColumn,c,i[0].endColumn));const r=t._getViewModel(),a=r.getCursorStates();o.length>0&&t.setSelections(o),Df(a,r.getCursorStates())}}class EGe extends we{constructor(){super({id:"editor.action.addCursorsToTop",label:I(1355,"Add Cursors to Top"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const i=t.getSelections(),n=[];for(let a=i[0].startLineNumber;a>=1;a--)n.push(new at(a,i[0].startColumn,a,i[0].endColumn));const o=t._getViewModel(),r=o.getCursorStates();n.length>0&&t.setSelections(n),Df(r,o.getCursorStates())}}class uk{constructor(e,t,i){this.selections=e,this.revealRange=t,this.revealScrollType=i}}class qx{static create(e,t){if(!e.hasModel())return null;const i=t.getState();if(!e.hasTextFocus()&&i.isRevealed&&i.searchString.length>0)return new qx(e,t,!1,i.searchString,i.wholeWord,i.matchCase,null);let n=!1,o,r;const a=e.getSelections();a.length===1&&a[0].isEmpty()?(n=!0,o=!0,r=!0):(o=i.wholeWord,r=i.matchCase);const c=e.getSelection();let d,l=null;if(c.isEmpty()){const u=e.getConfiguredWordAtPosition(c.getStartPosition());if(!u)return null;d=u.word,l=new at(c.startLineNumber,u.startColumn,c.startLineNumber,u.endColumn)}else d=e.getModel().getValueInRange(c).replace(/\r\n/g,`
`);return new qx(e,t,n,d,o,r,l)}constructor(e,t,i,n,o,r,a){this._editor=e,this.findController=t,this.isDisconnectedFromFindController=i,this.searchText=n,this.wholeWord=o,this.matchCase=r,this.currentMatch=a}addSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const e=this._getNextMatch();if(!e)return null;const t=this._editor.getSelections();return new uk(t.concat(e),e,ji.Smooth)}moveSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const e=this._getNextMatch();if(!e)return null;const t=this._editor.getSelections();return new uk(t.slice(0,t.length-1).concat(e),e,ji.Smooth)}_getNextMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const n=this.currentMatch;return this.currentMatch=null,n}this.findController.highlightFindOptions();const e=this._editor.getSelections(),t=e[e.length-1],i=this._editor.getModel().findNextMatch(this.searchText,t.getEndPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1);return i?new at(i.range.startLineNumber,i.range.startColumn,i.range.endLineNumber,i.range.endColumn):null}addSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const e=this._getPreviousMatch();if(!e)return null;const t=this._editor.getSelections();return new uk(t.concat(e),e,ji.Smooth)}moveSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const e=this._getPreviousMatch();if(!e)return null;const t=this._editor.getSelections();return new uk(t.slice(0,t.length-1).concat(e),e,ji.Smooth)}_getPreviousMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const n=this.currentMatch;return this.currentMatch=null,n}this.findController.highlightFindOptions();const e=this._editor.getSelections(),t=e[e.length-1],i=this._editor.getModel().findPreviousMatch(this.searchText,t.getStartPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1);return i?new at(i.range.startLineNumber,i.range.startColumn,i.range.endLineNumber,i.range.endColumn):null}selectAll(e){if(!this._editor.hasModel())return[];this.findController.highlightFindOptions();const t=this._editor.getModel();return e?t.findMatches(this.searchText,e,!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,dc.MAX_SAFE_SMALL_INTEGER):t.findMatches(this.searchText,!0,!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,dc.MAX_SAFE_SMALL_INTEGER)}}class iw extends F{static{this.ID="editor.contrib.multiCursorController"}static get(e){return e.getContribution(iw.ID)}constructor(e){super(),this._sessionDispose=this._register(new U),this._editor=e,this._ignoreSelectionChange=!1,this._session=null}dispose(){this._endSession(),super.dispose()}_beginSessionIfNeeded(e){if(!this._session){const t=qx.create(this._editor,e);if(!t)return;this._session=t;const i={searchString:this._session.searchText};this._session.isDisconnectedFromFindController&&(i.wholeWordOverride=Do.True,i.matchCaseOverride=Do.True,i.isRegexOverride=Do.False),e.getState().change(i,!1),this._sessionDispose.add(this._editor.onDidChangeCursorSelection(n=>{this._ignoreSelectionChange||this._endSession()})),this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{this._endSession()})),this._sessionDispose.add(e.getState().onFindReplaceStateChange(n=>{(n.matchCase||n.wholeWord)&&this._endSession()}))}}_endSession(){if(this._sessionDispose.clear(),this._session&&this._session.isDisconnectedFromFindController){const e={wholeWordOverride:Do.NotSet,matchCaseOverride:Do.NotSet,isRegexOverride:Do.NotSet};this._session.findController.getState().change(e,!1)}this._session=null}_setSelections(e){this._ignoreSelectionChange=!0,this._editor.setSelections(e),this._ignoreSelectionChange=!1}_expandEmptyToWord(e,t){if(!t.isEmpty())return t;const i=this._editor.getConfiguredWordAtPosition(t.getStartPosition());return i?new at(t.startLineNumber,i.startColumn,t.startLineNumber,i.endColumn):t}_applySessionResult(e){e&&(this._setSelections(e.selections),e.revealRange&&this._editor.revealRangeInCenterIfOutsideViewport(e.revealRange,e.revealScrollType))}getSession(e){return this._session}addSelectionToNextFindMatch(e){if(this._editor.hasModel()){if(!this._session){const t=this._editor.getSelections();if(t.length>1){const n=e.getState().matchCase;if(!xpe(this._editor.getModel(),t,n)){const r=this._editor.getModel(),a=[];for(let c=0,d=t.length;c<d;c++)a[c]=this._expandEmptyToWord(r,t[c]);this._editor.setSelections(a);return}}}this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToNextFindMatch())}}addSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToPreviousFindMatch())}moveSelectionToNextFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToNextFindMatch())}moveSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToPreviousFindMatch())}selectAll(e){if(!this._editor.hasModel())return;let t=null;const i=e.getState();if(i.isRevealed&&i.searchString.length>0&&i.isRegex){const n=this._editor.getModel();i.searchScope?t=n.findMatches(i.searchString,i.searchScope,i.isRegex,i.matchCase,i.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,dc.MAX_SAFE_SMALL_INTEGER):t=n.findMatches(i.searchString,!0,i.isRegex,i.matchCase,i.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,dc.MAX_SAFE_SMALL_INTEGER)}else{if(this._beginSessionIfNeeded(e),!this._session)return;t=this._session.selectAll(i.searchScope)}if(t.length>0){const n=this._editor.getSelection();for(let o=0,r=t.length;o<r;o++){const a=t[o];if(a.range.intersectRanges(n)){t[o]=t[0],t[0]=a;break}}this._setSelections(t.map(o=>new at(o.range.startLineNumber,o.range.startColumn,o.range.endLineNumber,o.range.endColumn)))}}selectAllUsingSelections(e){e.length>0&&this._setSelections(e)}}class dS extends we{run(e,t){const i=iw.get(t);if(!i)return;const n=t._getViewModel();if(n){const o=n.getCursorStates(),r=kr.get(t);if(r)this._run(i,r);else{const a=e.get(J).createInstance(kr,t);this._run(i,a),a.dispose()}Df(o,n.getCursorStates())}}}class xGe extends dS{constructor(){super({id:"editor.action.addSelectionToNextFindMatch",label:I(1356,"Add Selection to Next Find Match"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|S.KeyD,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1357,"Add &&Next Occurrence"),order:5}})}_run(e,t){e.addSelectionToNextFindMatch(t)}}class IGe extends dS{constructor(){super({id:"editor.action.addSelectionToPreviousFindMatch",label:I(1358,"Add Selection to Previous Find Match"),precondition:void 0,menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1359,"Add P&&revious Occurrence"),order:6}})}_run(e,t){e.addSelectionToPreviousFindMatch(t)}}class DGe extends dS{constructor(){super({id:"editor.action.moveSelectionToNextFindMatch",label:I(1360,"Move Last Selection to Next Find Match"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyD),weight:W.EditorContrib}})}_run(e,t){e.moveSelectionToNextFindMatch(t)}}class kGe extends dS{constructor(){super({id:"editor.action.moveSelectionToPreviousFindMatch",label:I(1361,"Move Last Selection to Previous Find Match"),precondition:void 0})}_run(e,t){e.moveSelectionToPreviousFindMatch(t)}}class TGe extends dS{constructor(){super({id:"editor.action.selectHighlights",label:I(1362,"Select All Occurrences of Find Match"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|E.Shift|S.KeyL,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1363,"Select All &&Occurrences"),order:7}})}_run(e,t){e.selectAll(t)}}class AGe extends dS{constructor(){super({id:"editor.action.changeAll",label:I(1364,"Change All Occurrences"),precondition:x.and(V.writable,V.editorTextFocus),kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.F2,weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:1.2}})}_run(e,t){e.selectAll(t)}}class RGe{constructor(e,t,i,n,o){this._model=e,this._searchText=t,this._matchCase=i,this._wordSeparators=n,this._cachedFindMatches=null,this._modelVersionId=this._model.getVersionId(),o&&this._model===o._model&&this._searchText===o._searchText&&this._matchCase===o._matchCase&&this._wordSeparators===o._wordSeparators&&this._modelVersionId===o._modelVersionId&&(this._cachedFindMatches=o._cachedFindMatches)}findMatches(){return this._cachedFindMatches===null&&(this._cachedFindMatches=this._model.findMatches(this._searchText,!0,!1,this._matchCase,this._wordSeparators,!1).map(e=>e.range),this._cachedFindMatches.sort(P.compareRangesUsingStarts)),this._cachedFindMatches}}let fM=class extends F{static{mG=this}static{this.ID="editor.contrib.selectionHighlighter"}constructor(e,t){super(),this._languageFeaturesService=t,this.editor=e,this._isEnabled=e.getOption(L.selectionHighlight),this._decorations=e.createDecorationsCollection(),this.updateSoon=this._register(new fn(()=>this._update(),300)),this.state=null,this._register(e.onDidChangeConfiguration(n=>{this._isEnabled=e.getOption(L.selectionHighlight)})),this._register(e.onDidChangeCursorSelection(n=>{this._isEnabled&&(n.selection.isEmpty()?n.reason===Ls.Explicit?(this.state&&this._setState(null),this.updateSoon.schedule()):this._setState(null):this._update())})),this._register(e.onDidChangeModel(n=>{this._setState(null)})),this._register(e.onDidChangeModelContent(n=>{this._isEnabled&&this.updateSoon.schedule()}));const i=kr.get(e);i&&this._register(i.getState().onFindReplaceStateChange(n=>{this._update()})),this.updateSoon.schedule()}_update(){this._setState(mG._createState(this.state,this._isEnabled,this.editor))}static _createState(e,t,i){if(!t||!i.hasModel())return null;const n=i.getSelection();if(n.startLineNumber!==n.endLineNumber)return null;const o=iw.get(i);if(!o)return null;const r=kr.get(i);if(!r)return null;let a=o.getSession(r);if(!a){const l=i.getSelections();if(l.length>1){const g=r.getState().matchCase;if(!xpe(i.getModel(),l,g))return null}a=qx.create(i,r)}if(!a||a.currentMatch||/^[ \t]+$/.test(a.searchText)||a.searchText.length>200)return null;const c=r.getState(),d=c.matchCase;if(c.isRevealed){let l=c.searchString;d||(l=l.toLowerCase());let u=a.searchText;if(d||(u=u.toLowerCase()),l===u&&a.matchCase===c.matchCase&&a.wholeWord===c.wholeWord&&!c.isRegex)return null}return new RGe(i.getModel(),a.searchText,a.matchCase,a.wholeWord?i.getOption(L.wordSeparators):null,e)}_setState(e){if(this.state=e,!this.state){this._decorations.clear();return}if(!this.editor.hasModel())return;const t=this.editor.getModel();if(t.isTooLargeForTokenization())return;const i=this.state.findMatches(),n=this.editor.getSelections();n.sort(P.compareRangesUsingStarts);const o=[];for(let d=0,l=0,u=i.length,g=n.length;d<u;){const m=i[d];if(l>=g)o.push(m),d++;else{const v=P.compareRangesUsingStarts(m,n[l]);v<0?((n[l].isEmpty()||!P.areIntersecting(m,n[l]))&&o.push(m),d++):(v>0||d++,l++)}}const r=this.editor.getOption(L.occurrencesHighlight)!=="off",a=this._languageFeaturesService.documentHighlightProvider.has(t)&&r,c=o.map(d=>({range:d,options:bGe(a)}));this._decorations.set(c)}dispose(){this._setState(null),super.dispose()}};fM=mG=f([p(1,Ne)],fM);function xpe(s,e,t){const i=Qte(s,e[0],!t);for(let n=1,o=e.length;n<o;n++){const r=e[n];if(r.isEmpty())return!1;const a=Qte(s,r,!t);if(i!==a)return!1}return!0}function Qte(s,e,t){const i=s.getValueInRange(e);return t?i.toLowerCase():i}class PGe extends we{constructor(){super({id:"editor.action.focusNextCursor",label:I(1365,"Focus Next Cursor"),metadata:{description:h(1366,"Focuses the next cursor"),args:[]},precondition:void 0})}run(e,t,i){if(!t.hasModel())return;const n=t._getViewModel();if(n.cursorConfig.readOnly)return;n.model.pushStackElement();const o=Array.from(n.getCursorStates()),r=o.shift();r&&(o.push(r),n.setCursorStates(i.source,Ls.Explicit,o),n.revealPrimaryCursor(i.source,!0),Df(o,n.getCursorStates()))}}class LGe extends we{constructor(){super({id:"editor.action.focusPreviousCursor",label:I(1367,"Focus Previous Cursor"),metadata:{description:h(1368,"Focuses the previous cursor"),args:[]},precondition:void 0})}run(e,t,i){if(!t.hasModel())return;const n=t._getViewModel();if(n.cursorConfig.readOnly)return;n.model.pushStackElement();const o=Array.from(n.getCursorStates()),r=o.pop();r&&(o.unshift(r),n.setCursorStates(i.source,Ls.Explicit,o),n.revealPrimaryCursor(i.source,!0),Df(o,n.getCursorStates()))}}Rt(iw.ID,iw,vt.Lazy);Rt(fM.ID,fM,vt.AfterFirstRender);ue(yGe);ue(wGe);ue(SGe);ue(xGe);ue(IGe);ue(DGe);ue(kGe);ue(TGe);ue(AGe);ue(CGe);ue(EGe);ue(PGe);ue(LGe);const Ev={Visible:new O("parameterHintsVisible",!1),MultipleSignatures:new O("parameterHintsMultipleSignatures",!1)};async function Ipe(s,e,t,i,n){const o=s.ordered(e);for(const r of o)try{const a=await r.provideSignatureHelp(e,t,n,i);if(a)return a}catch(a){kn(a)}}Ce.registerCommand("_executeSignatureHelpProvider",async(s,...e)=>{const[t,i,n]=e;St(R.isUri(t)),St(_e.isIPosition(i)),St(typeof n=="string"||!n);const o=s.get(Ne),r=await s.get(yi).createModelReference(t);try{const a=await Ipe(o.signatureHelpProvider,r.object.textEditorModel,_e.lift(i),{triggerKind:bp.Invoke,isRetrigger:!1,triggerCharacter:n},ye.None);return a?(setTimeout(()=>a.dispose(),0),a.value):void 0}finally{r.dispose()}});var So;(function(s){let e;(function(n){n[n.Default=0]="Default",n[n.Active=1]="Active",n[n.Pending=2]="Pending"})(e=s.Type||(s.Type={})),s.Default={type:e.Default};class t{constructor(o,r){this.request=o,this.previouslyActiveHints=r,this.type=e.Pending}}s.Pending=t;class i{constructor(o){this.hints=o,this.type=e.Active}}s.Active=i})(So||(So={}));class T5 extends F{static{this.DEFAULT_DELAY=120}constructor(e,t,i=T5.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new M),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=So.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new kt),this.triggerChars=new GT,this.retriggerChars=new GT,this.triggerId=0,this.editor=e,this.providers=t,this.throttledDelayer=new tg(i),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(n=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(n=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(n=>this.onCursorChange(n))),this._register(this.editor.onDidChangeModelContent(n=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(n=>this.onDidType(n))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){this._state.type===So.Type.Pending&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=So.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,t){const i=this.editor.getModel();if(!i||!this.providers.has(i))return;const n=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(n),t).catch(mt)}next(){if(this.state.type!==So.Type.Active)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,i=t%e===e-1,n=this.editor.getOption(L.parameterHints).cycle;if((e<2||i)&&!n){this.cancel();return}this.updateActiveSignature(i&&n?0:t+1)}previous(){if(this.state.type!==So.Type.Active)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,i=t===0,n=this.editor.getOption(L.parameterHints).cycle;if((e<2||i)&&!n){this.cancel();return}this.updateActiveSignature(i&&n?e-1:t-1)}updateActiveSignature(e){this.state.type===So.Type.Active&&(this.state=new So.Active({...this.state.hints,activeSignature:e}),this._onChangedHints.fire(this.state.hints))}async doTrigger(e){const t=this.state.type===So.Type.Active||this.state.type===So.Type.Pending,i=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;const n=this._pendingTriggers.reduce(MGe);this._pendingTriggers=[];const o={triggerKind:n.triggerKind,triggerCharacter:n.triggerCharacter,isRetrigger:t,activeSignatureHelp:i};if(!this.editor.hasModel())return!1;const r=this.editor.getModel(),a=this.editor.getPosition();this.state=new So.Pending(En(c=>Ipe(this.providers,r,a,o,c)),i);try{const c=await this.state.request;return e!==this.triggerId?(c?.dispose(),!1):!c||!c.value.signatures||c.value.signatures.length===0?(c?.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new So.Active(c.value),this._lastSignatureHelpResult.value=c,this._onChangedHints.fire(this.state.hints),!0)}catch(c){return e===this.triggerId&&(this.state=So.Default),mt(c),!1}}getLastActiveHints(){switch(this.state.type){case So.Type.Active:return this.state.hints;case So.Type.Pending:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===So.Type.Active||this.state.type===So.Type.Pending||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();const e=this.editor.getModel();if(e)for(const t of this.providers.ordered(e)){for(const i of t.signatureHelpTriggerCharacters||[])if(i.length){const n=i.charCodeAt(0);this.triggerChars.add(n),this.retriggerChars.add(n)}for(const i of t.signatureHelpRetriggerCharacters||[])i.length&&this.retriggerChars.add(i.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;const t=e.length-1,i=e.charCodeAt(t);(this.triggerChars.has(i)||this.isTriggered&&this.retriggerChars.has(i))&&this.trigger({triggerKind:bp.TriggerCharacter,triggerCharacter:e.charAt(t)})}onCursorChange(e){e.source==="mouse"?this.cancel():this.isTriggered&&this.trigger({triggerKind:bp.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:bp.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(L.parameterHints).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}}function MGe(s,e){switch(e.triggerKind){case bp.Invoke:return e;case bp.ContentChange:return s;case bp.TriggerCharacter:default:return e}}const NGe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var vG;Be(NGe);const ha=Y,OGe=Ae("parameter-hints-next",j.chevronDown,h(1370,"Icon for show next parameter hint.")),FGe=Ae("parameter-hints-previous",j.chevronUp,h(1371,"Icon for show previous parameter hint."));let _G=class extends F{static{vG=this}static{this.ID="editor.widget.parameterHintsWidget"}constructor(e,t,i,n,o){super(),this.editor=e,this.model=t,this.renderDisposeables=this._register(new U),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=new Rv({editor:e},o,n),this.keyVisible=Ev.Visible.bindTo(i),this.keyMultipleSignatures=Ev.MultipleSignatures.bindTo(i)}createParameterHintDOMNodes(){const e=ha(".editor-widget.parameter-hints-widget"),t=ee(e,ha(".phwrapper"));t.tabIndex=-1;const i=ee(t,ha(".controls")),n=ee(i,ha(".button"+Te.asCSSSelector(FGe))),o=ee(i,ha(".overloads")),r=ee(i,ha(".button"+Te.asCSSSelector(OGe)));this._register(re(n,"click",g=>{Li.stop(g),this.previous()})),this._register(re(r,"click",g=>{Li.stop(g),this.next()}));const a=ha(".body"),c=new nI(a,{alwaysConsumeMouseWheel:!0});this._register(c),t.appendChild(c.getDomNode());const d=ee(a,ha(".signature")),l=ee(a,ha(".docs"));e.style.userSelect="text",this.domNodes={element:e,signature:d,overloads:o,docs:l,scrollbar:c},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(g=>{this.visible&&this.editor.layoutContentWidget(this)}));const u=()=>{if(!this.domNodes)return;const g=this.editor.getOption(L.fontInfo),m=this.domNodes.element;m.style.fontSize=`${g.fontSize}px`,m.style.lineHeight=`${g.lineHeight/g.fontSize}`,m.style.setProperty("--vscode-parameterHintsWidget-editorFontFamily",g.fontFamily),m.style.setProperty("--vscode-parameterHintsWidget-editorFontFamilyDefault",BM.fontFamily)};u(),this._register(D.chain(this.editor.onDidChangeConfiguration.bind(this.editor),g=>g.filter(m=>m.hasChanged(L.fontInfo)))(u)),this._register(this.editor.onDidLayoutChange(g=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{this.domNodes?.element.classList.add("visible")},100),this.editor.layoutContentWidget(this))}hide(){this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,this.domNodes?.element.classList.remove("visible"),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[Oi.ABOVE,Oi.BELOW]}:null}render(e){if(this.renderDisposeables.clear(),!this.domNodes)return;const t=e.signatures.length>1;this.domNodes.element.classList.toggle("multiple",t),this.keyMultipleSignatures.set(t),this.domNodes.signature.innerText="",this.domNodes.docs.innerText="";const i=e.signatures[e.activeSignature];if(!i)return;const n=ee(this.domNodes.signature,ha(".code")),o=i.parameters.length>0,r=i.activeParameter??e.activeParameter;if(o)this.renderParameters(n,i,r);else{const d=ee(n,ha("span"));d.textContent=i.label}const a=i.parameters[r];if(a?.documentation){const d=ha("span.documentation");if(typeof a.documentation=="string")d.textContent=a.documentation;else{const l=this.renderMarkdownDocs(a.documentation);d.appendChild(l.element)}ee(this.domNodes.docs,ha("p",{},d))}if(i.documentation!==void 0)if(typeof i.documentation=="string")ee(this.domNodes.docs,ha("p",{},i.documentation));else{const d=this.renderMarkdownDocs(i.documentation);ee(this.domNodes.docs,d.element)}const c=this.hasDocs(i,a);if(this.domNodes.signature.classList.toggle("has-docs",c),this.domNodes.docs.classList.toggle("empty",!c),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,"0")+"/"+e.signatures.length,a){let d="";const l=i.parameters[r];Array.isArray(l.label)?d=i.label.substring(l.label[0],l.label[1]):d=l.label,l.documentation&&(d+=typeof l.documentation=="string"?`, ${l.documentation}`:`, ${l.documentation.value}`),i.documentation&&(d+=typeof i.documentation=="string"?`, ${i.documentation}`:`, ${i.documentation.value}`),this.announcedLabel!==d&&(ta(h(1372,"{0}, hint",d)),this.announcedLabel=d)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){const t=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{this.domNodes?.scrollbar.scanDomNode()}}));return t.element.classList.add("markdown-docs"),t}hasDocs(e,t){return!!(t&&typeof t.documentation=="string"&&Gt(t.documentation).length>0||t&&typeof t.documentation=="object"&&Gt(t.documentation).value.length>0||e.documentation&&typeof e.documentation=="string"&&Gt(e.documentation).length>0||e.documentation&&typeof e.documentation=="object"&&Gt(e.documentation.value).length>0)}renderParameters(e,t,i){const[n,o]=this.getParameterLabelOffsets(t,i),r=document.createElement("span");r.textContent=t.label.substring(0,n);const a=document.createElement("span");a.textContent=t.label.substring(n,o),a.className="parameter active";const c=document.createElement("span");c.textContent=t.label.substring(o),ee(e,r,a,c)}getParameterLabelOffsets(e,t){const i=e.parameters[t];if(i){if(Array.isArray(i.label))return i.label;if(i.label.length){const n=new RegExp(`(\\W|^)${ny(i.label)}(?=\\W|$)`,"g");n.test(e.label);const o=n.lastIndex-i.label.length;return o>=0?[o,n.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return vG.ID}updateMaxHeight(){if(!this.domNodes)return;const t=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=t;const i=this.domNodes.element.getElementsByClassName("phwrapper");i.length&&(i[0].style.maxHeight=t)}};_G=vG=f([p(2,me),p(3,hi),p(4,fi)],_G);H("editorHoverWidget.highlightForeground",lne,h(1373,"Foreground color of the active item in the parameter hint."));var bG;let nw=class extends F{static{bG=this}static{this.ID="editor.controller.parameterHints"}static get(e){return e.getContribution(bG.ID)}constructor(e,t,i){super(),this.editor=e,this.model=this._register(new T5(e,i.signatureHelpProvider)),this._register(this.model.onChangedHints(n=>{n?(this.widget.value.show(),this.widget.value.render(n)):this.widget.rawValue?.hide()})),this.widget=new Ju(()=>this._register(t.createInstance(_G,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){this.widget.rawValue?.previous()}next(){this.widget.rawValue?.next()}trigger(e){this.model.trigger(e,0)}};nw=bG=f([p(1,J),p(2,Ne)],nw);class WGe extends we{constructor(){super({id:"editor.action.triggerParameterHints",label:I(1369,"Trigger Parameter Hints"),precondition:V.hasSignatureHelpProvider,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Space,weight:W.EditorContrib}})}run(e,t){nw.get(t)?.trigger({triggerKind:bp.Invoke})}}Rt(nw.ID,nw,vt.BeforeFirstInteraction);ue(WGe);const A5=W.EditorContrib+75,R5=No.bindToContribution(nw.get);Ue(new R5({id:"closeParameterHints",precondition:Ev.Visible,handler:s=>s.cancel(),kbOpts:{weight:A5,kbExpr:V.focus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));Ue(new R5({id:"showPrevParameterHint",precondition:x.and(Ev.Visible,Ev.MultipleSignatures),handler:s=>s.previous(),kbOpts:{weight:A5,kbExpr:V.focus,primary:S.UpArrow,secondary:[E.Alt|S.UpArrow],mac:{primary:S.UpArrow,secondary:[E.Alt|S.UpArrow,E.WinCtrl|S.KeyP]}}}));Ue(new R5({id:"showNextParameterHint",precondition:x.and(Ev.Visible,Ev.MultipleSignatures),handler:s=>s.next(),kbOpts:{weight:A5,kbExpr:V.focus,primary:S.DownArrow,secondary:[E.Alt|S.DownArrow],mac:{primary:S.DownArrow,secondary:[E.Alt|S.DownArrow,E.WinCtrl|S.KeyN]}}}));const BGe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Dpe{constructor(e){this.instantiationService=e}init(...e){}}function VGe(s,e){return class extends e{constructor(){super(...arguments),this._autorun=void 0}init(...i){this._autorun=Da((n,o)=>{const r=XSe(s(),n);o.add(this.instantiationService.createInstance(r,...i))})}dispose(){this._autorun?.dispose()}}}let Xte=class extends Dpe{constructor(e){super(e),this.init()}};Xte=f([p(0,J)],Xte);function HGe(s){return kse()?VGe(s,yG):s()}let yG=class extends Dpe{constructor(e,t){super(t),this.init(e)}};yG=f([p(1,J)],yG);Be(BGe);Rt(Vx.ID,HGe(()=>Vx),vt.Eager);H("editor.placeholder.foreground",gwe,h(1391,"Foreground color of the placeholder text in the editor."));const UGe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(UGe);const lS=new O("renameInputVisible",!1,h(1442,"Whether the rename input widget is visible"));let wG=class{constructor(e,t,i,n,o,r){this._editor=e,this._acceptKeybindings=t,this._themeService=i,this._keybindingService=n,this._logService=r,this.allowEditorOverflow=!0,this._disposables=new U,this._visibleContextKey=lS.bindTo(o),this._isEditingRenameCandidate=!1,this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,this._candidates=new Set,this._beforeFirstInputFieldEditSW=new zn,this._inputWithButton=new $Ge,this._disposables.add(this._inputWithButton),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration(a=>{a.hasChanged(L.fontInfo)&&this._updateFont()})),this._disposables.add(i.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return"__renameInputWidget"}getDomNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="monaco-editor rename-box",this._domNode.appendChild(this._inputWithButton.domNode),this._renameCandidateListView=this._disposables.add(new P5(this._domNode,{fontInfo:this._editor.getOption(L.fontInfo),onFocusChange:e=>{this._inputWithButton.input.value=e,this._isEditingRenameCandidate=!1},onSelectionChange:()=>{this._isEditingRenameCandidate=!1,this.acceptInput(!1)}})),this._disposables.add(this._inputWithButton.onDidInputChange(()=>{this._renameCandidateListView?.focusedCandidate!==void 0&&(this._isEditingRenameCandidate=!0),this._timeBeforeFirstInputFieldEdit??=this._beforeFirstInputFieldEditSW.elapsed(),this._renameCandidateProvidersCts?.token.isCancellationRequested===!1&&this._renameCandidateProvidersCts.cancel(),this._renameCandidateListView?.clearFocus()})),this._label=document.createElement("div"),this._label.className="rename-label",this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(e){if(!this._domNode)return;const t=e.getColor(kne),i=e.getColor(ey);this._domNode.style.backgroundColor=String(e.getColor(LM)??""),this._domNode.style.boxShadow=t?` 0 0 8px 2px ${t}`:"",this._domNode.style.border=i?`1px solid ${i}`:"",this._domNode.style.color=String(e.getColor(pne)??"");const n=e.getColor(bk);this._inputWithButton.domNode.style.backgroundColor=String(e.getColor(RF)??""),this._inputWithButton.input.style.backgroundColor=String(e.getColor(RF)??""),this._inputWithButton.domNode.style.borderWidth=n?"1px":"0px",this._inputWithButton.domNode.style.borderStyle=n?"solid":"none",this._inputWithButton.domNode.style.borderColor=n?.toString()??"none"}_updateFont(){if(this._domNode===void 0)return;St(this._label!==void 0,"RenameWidget#_updateFont: _label must not be undefined given _domNode is defined"),this._editor.applyFontInfo(this._inputWithButton.input);const e=this._editor.getOption(L.fontInfo);this._label.style.fontSize=`${this._computeLabelFontSize(e.fontSize)}px`}_computeLabelFontSize(e){return e*.8}getPosition(){if(!this._visible||!this._editor.hasModel()||!this._editor.getDomNode())return null;const e=Zu(this.getDomNode().ownerDocument.body),t=Ms(this._editor.getDomNode()),i=this._getTopForPosition();this._nPxAvailableAbove=i+t.top,this._nPxAvailableBelow=e.height-this._nPxAvailableAbove;const n=this._editor.getOption(L.lineHeight),{totalHeight:o}=sw.getLayoutInfo({lineHeight:n}),r=this._nPxAvailableBelow>o*6?[Oi.BELOW,Oi.ABOVE]:[Oi.ABOVE,Oi.BELOW];return{position:this._position,preference:r}}beforeRender(){const[e,t]=this._acceptKeybindings;return this._label.innerText=h(1443,"{0} to Rename, {1} to Preview",this._keybindingService.lookupKeybinding(e)?.getLabel(),this._keybindingService.lookupKeybinding(t)?.getLabel()),this._domNode.style.minWidth="200px",null}afterRender(e){if(e===null){this.cancelInput(!0,"afterRender (because position is null)");return}if(!this._editor.hasModel()||!this._editor.getDomNode())return;St(this._renameCandidateListView),St(this._nPxAvailableAbove!==void 0),St(this._nPxAvailableBelow!==void 0);const t=U_(this._inputWithButton.domNode),i=U_(this._label);let n;e===Oi.BELOW?n=this._nPxAvailableBelow:n=this._nPxAvailableAbove,this._renameCandidateListView.layout({height:n-i-t,width:$a(this._inputWithButton.domNode)})}acceptInput(e){this._trace("invoking acceptInput"),this._currentAcceptInput?.(e)}cancelInput(e,t){this._currentCancelInput?.(e)}focusNextRenameSuggestion(){this._renameCandidateListView?.focusNext()||(this._inputWithButton.input.value=this._currentName)}focusPreviousRenameSuggestion(){this._renameCandidateListView?.focusPrevious()||(this._inputWithButton.input.value=this._currentName)}getInput(e,t,i,n,o){const{start:r,end:a}=this._getSelection(e,t);this._renameCts=o;const c=new U;this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,n===void 0?this._inputWithButton.button.style.display="none":(this._inputWithButton.button.style.display="flex",this._requestRenameCandidatesOnce=n,this._requestRenameCandidates(t,!1),c.add(re(this._inputWithButton.button,"click",()=>this._requestRenameCandidates(t,!0))),c.add(re(this._inputWithButton.button,pe.KEY_DOWN,l=>{const u=new zs(l);(u.equals(S.Enter)||u.equals(S.Space))&&(u.stopPropagation(),u.preventDefault(),this._requestRenameCandidates(t,!0))}))),this._isEditingRenameCandidate=!1,this._domNode.classList.toggle("preview",i),this._position=new _e(e.startLineNumber,e.startColumn),this._currentName=t,this._inputWithButton.input.value=t,this._inputWithButton.input.setAttribute("selectionStart",r.toString()),this._inputWithButton.input.setAttribute("selectionEnd",a.toString()),this._inputWithButton.input.size=Math.max((e.endColumn-e.startColumn)*1.1,20),this._beforeFirstInputFieldEditSW.reset(),c.add(Ee(()=>{this._renameCts=void 0,o.dispose(!0)})),c.add(Ee(()=>{this._renameCandidateProvidersCts!==void 0&&(this._renameCandidateProvidersCts.dispose(!0),this._renameCandidateProvidersCts=void 0)})),c.add(Ee(()=>this._candidates.clear()));const d=new Zo;return d.p.finally(()=>{c.dispose(),this._hide()}),this._currentCancelInput=l=>(this._trace("invoking _currentCancelInput"),this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView?.clearCandidates(),d.complete(l),!0),this._currentAcceptInput=l=>{this._trace("invoking _currentAcceptInput"),St(this._renameCandidateListView!==void 0);const u=this._renameCandidateListView.nCandidates;let g,m;const v=this._renameCandidateListView.focusedCandidate;if(v!==void 0?(this._trace("using new name from renameSuggestion"),g=v,m={k:"renameSuggestion"}):(this._trace("using new name from inputField"),g=this._inputWithButton.input.value,m=this._isEditingRenameCandidate?{k:"userEditedRenameSuggestion"}:{k:"inputField"}),g===t||g.trim().length===0){this.cancelInput(!0,"_currentAcceptInput (because newName === value || newName.trim().length === 0)");return}this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView.clearCandidates(),d.complete({newName:g,wantsPreview:i&&l,stats:{source:m,nRenameSuggestions:u,timeBeforeFirstInputFieldEdit:this._timeBeforeFirstInputFieldEdit,nRenameSuggestionsInvocations:this._nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:this._hadAutomaticRenameSuggestionsInvocation}})},c.add(o.token.onCancellationRequested(()=>this.cancelInput(!0,"cts.token.onCancellationRequested"))),c.add(this._editor.onDidBlurEditorWidget(()=>this.cancelInput(!this._domNode?.ownerDocument.hasFocus(),"editor.onDidBlurEditorWidget"))),this._show(),d.p}_requestRenameCandidates(e,t){if(this._requestRenameCandidatesOnce!==void 0&&(this._renameCandidateProvidersCts!==void 0&&this._renameCandidateProvidersCts.dispose(!0),St(this._renameCts),this._inputWithButton.buttonState!=="stop")){this._renameCandidateProvidersCts=new ri;const i=t?qF.Invoke:qF.Automatic,n=this._requestRenameCandidatesOnce(i,this._renameCandidateProvidersCts.token);if(n.length===0){this._inputWithButton.setSparkleButton();return}t||(this._hadAutomaticRenameSuggestionsInvocation=!0),this._nRenameSuggestionsInvocations+=1,this._inputWithButton.setStopButton(),this._updateRenameCandidates(n,e,this._renameCts.token)}}_getSelection(e,t){St(this._editor.hasModel());const i=this._editor.getSelection();let n=0,o=t.length;return!P.isEmpty(i)&&!P.spansMultipleLines(i)&&P.containsRange(e,i)&&(n=Math.max(0,i.startColumn-e.startColumn),o=Math.min(e.endColumn,i.endColumn)-e.startColumn),{start:n,end:o}}_show(){this._trace("invoking _show"),this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,ji.Smooth),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout(()=>{this._inputWithButton.input.focus(),this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute("selectionStart")),parseInt(this._inputWithButton.input.getAttribute("selectionEnd")))},100)}async _updateRenameCandidates(e,t,i){const n=(...d)=>this._trace("_updateRenameCandidates",...d);n("start");const o=await xh(Promise.allSettled(e),i);if(this._inputWithButton.setSparkleButton(),o===void 0){n("returning early - received updateRenameCandidates results - undefined");return}const r=o.flatMap(d=>d.status==="fulfilled"&&ya(d.value)?d.value:[]);n(`received updateRenameCandidates results - total (unfiltered) ${r.length} candidates.`);const a=tI(r,d=>d.newSymbolName);n(`distinct candidates - ${a.length} candidates.`);const c=a.filter(({newSymbolName:d})=>d.trim().length>0&&d!==this._inputWithButton.input.value&&d!==t&&!this._candidates.has(d));if(n(`valid distinct candidates - ${r.length} candidates.`),c.forEach(d=>this._candidates.add(d.newSymbolName)),c.length<1){n("returning early - no valid distinct candidates");return}n("setting candidates"),this._renameCandidateListView.setCandidates(c),n("asking editor to re-layout"),this._editor.layoutContentWidget(this)}_hide(){this._trace("invoked _hide"),this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}_getTopForPosition(){const e=this._editor.getVisibleRanges();let t;return e.length>0?t=e[0].startLineNumber:(this._logService.warn("RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty"),t=Math.max(1,this._position.lineNumber-5)),this._editor.getTopForLineNumber(this._position.lineNumber)-this._editor.getTopForLineNumber(t)}_trace(...e){this._logService.trace("RenameWidget",...e)}};wG=f([p(2,ft),p(3,Ve),p(4,me),p(5,Pe)],wG);class P5{constructor(e,t){this._disposables=new U,this._availableHeight=0,this._minimumWidth=0,this._lineHeight=t.fontInfo.lineHeight,this._typicalHalfwidthCharacterWidth=t.fontInfo.typicalHalfwidthCharacterWidth,this._listContainer=document.createElement("div"),this._listContainer.className="rename-box rename-candidate-list-container",e.appendChild(this._listContainer),this._listWidget=P5._createListWidget(this._listContainer,this._candidateViewHeight,t.fontInfo),this._listWidget.onDidChangeFocus(i=>{i.elements.length===1&&t.onFocusChange(i.elements[0].newSymbolName)},this._disposables),this._listWidget.onDidChangeSelection(i=>{i.elements.length===1&&t.onSelectionChange()},this._disposables),this._disposables.add(this._listWidget.onDidBlur(i=>{this._listWidget.setFocus([])})),this._listWidget.style(hne({listInactiveFocusForeground:cne,listInactiveFocusBackground:dne}))}dispose(){this._listWidget.dispose(),this._disposables.dispose()}layout({height:e,width:t}){this._availableHeight=e,this._minimumWidth=t}setCandidates(e){this._listWidget.splice(0,0,e);const t=this._pickListHeight(this._listWidget.length),i=this._pickListWidth(e);this._listWidget.layout(t,i),this._listContainer.style.height=`${t}px`,this._listContainer.style.width=`${i}px`,Kc(h(1444,"Received {0} rename suggestions",e.length))}clearCandidates(){this._listContainer.style.height="0px",this._listContainer.style.width="0px",this._listWidget.splice(0,this._listWidget.length,[])}get nCandidates(){return this._listWidget.length}get focusedCandidate(){if(this._listWidget.length===0)return;const e=this._listWidget.getSelectedElements()[0];if(e!==void 0)return e.newSymbolName;const t=this._listWidget.getFocusedElements()[0];if(t!==void 0)return t.newSymbolName}focusNext(){if(this._listWidget.length===0)return!1;const e=this._listWidget.getFocus();if(e.length===0)return this._listWidget.focusFirst(),this._listWidget.reveal(0),!0;if(e[0]===this._listWidget.length-1)return this._listWidget.setFocus([]),this._listWidget.reveal(0),!1;{this._listWidget.focusNext();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}}focusPrevious(){if(this._listWidget.length===0)return!1;const e=this._listWidget.getFocus();if(e.length===0){this._listWidget.focusLast();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}else{if(e[0]===0)return this._listWidget.setFocus([]),!1;{this._listWidget.focusPrevious();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}}}clearFocus(){this._listWidget.setFocus([])}get _candidateViewHeight(){const{totalHeight:e}=sw.getLayoutInfo({lineHeight:this._lineHeight});return e}_pickListHeight(e){const t=this._candidateViewHeight*e;return Math.min(t,this._availableHeight,this._candidateViewHeight*7)}_pickListWidth(e){const t=Math.ceil(Math.max(...e.map(n=>n.newSymbolName.length))*this._typicalHalfwidthCharacterWidth);return Math.max(this._minimumWidth,25+t+10)}static _createListWidget(e,t,i){const n=new class{getTemplateId(r){return"candidate"}getHeight(r){return t}},o=new class{constructor(){this.templateId="candidate"}renderTemplate(r){return new sw(r,i)}renderElement(r,a,c){c.populate(r)}disposeTemplate(r){r.dispose()}};return new Dv("NewSymbolNameCandidates",e,n,[o],{keyboardSupport:!1,mouseSupport:!0,multipleSelectionSupport:!1})}}class $Ge{constructor(){this._buttonHoverContent="",this._onDidInputChange=new M,this.onDidInputChange=this._onDidInputChange.event,this._disposables=new U}get domNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="rename-input-with-button",this._domNode.style.display="flex",this._domNode.style.flexDirection="row",this._domNode.style.alignItems="center",this._inputNode=document.createElement("input"),this._inputNode.className="rename-input",this._inputNode.type="text",this._inputNode.style.border="none",this._inputNode.setAttribute("aria-label",h(1445,"Rename input. Type new name and press Enter to commit.")),this._domNode.appendChild(this._inputNode),this._buttonNode=document.createElement("div"),this._buttonNode.className="rename-suggestions-button",this._buttonNode.setAttribute("tabindex","0"),this._buttonGenHoverText=h(1446,"Generate new name suggestions"),this._buttonCancelHoverText=h(1447,"Cancel"),this._buttonHoverContent=this._buttonGenHoverText,this._disposables.add(Nq().setupDelayedHover(this._buttonNode,()=>({content:this._buttonHoverContent,appearance:{showPointer:!0,compact:!0}}))),this._domNode.appendChild(this._buttonNode),this._disposables.add(re(this.input,pe.INPUT,()=>this._onDidInputChange.fire())),this._disposables.add(re(this.input,pe.KEY_DOWN,e=>{const t=new zs(e);(t.keyCode===S.LeftArrow||t.keyCode===S.RightArrow)&&this._onDidInputChange.fire()})),this._disposables.add(re(this.input,pe.CLICK,()=>this._onDidInputChange.fire())),this._disposables.add(re(this.input,pe.FOCUS,()=>{this.domNode.style.outlineWidth="1px",this.domNode.style.outlineStyle="solid",this.domNode.style.outlineOffset="-1px",this.domNode.style.outlineColor="var(--vscode-focusBorder)"})),this._disposables.add(re(this.input,pe.BLUR,()=>{this.domNode.style.outline="none"}))),this._domNode}get input(){return St(this._inputNode),this._inputNode}get button(){return St(this._buttonNode),this._buttonNode}get buttonState(){return this._buttonState}setSparkleButton(){this._buttonState="sparkle",this._sparkleIcon??=ay(j.sparkle),Yi(this.button),this.button.appendChild(this._sparkleIcon),this.button.setAttribute("aria-label","Generating new name suggestions"),this._buttonHoverContent=this._buttonGenHoverText,this.input.focus()}setStopButton(){this._buttonState="stop",this._stopIcon??=ay(j.stopCircle),Yi(this.button),this.button.appendChild(this._stopIcon),this.button.setAttribute("aria-label","Cancel generating new name suggestions"),this._buttonHoverContent=this._buttonCancelHoverText,this.input.focus()}dispose(){this._disposables.dispose()}}class sw{static{this._PADDING=2}constructor(e,t){this._domNode=document.createElement("div"),this._domNode.className="rename-box rename-candidate",this._domNode.style.display="flex",this._domNode.style.columnGap="5px",this._domNode.style.alignItems="center",this._domNode.style.height=`${t.lineHeight}px`,this._domNode.style.padding=`${sw._PADDING}px`;const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.width=i.style.height=`${t.lineHeight*.8}px`,this._domNode.appendChild(i),this._icon=ay(j.sparkle),this._icon.style.display="none",i.appendChild(this._icon),this._label=document.createElement("div"),Jne(this._label,t),this._domNode.appendChild(this._label),e.appendChild(this._domNode)}populate(e){this._updateIcon(e),this._updateLabel(e)}_updateIcon(e){const t=!!e.tags?.includes(pwe.AIGenerated);this._icon.style.display=t?"inherit":"none"}_updateLabel(e){this._label.innerText=e.newSymbolName}static getLayoutInfo({lineHeight:e}){return{totalHeight:e+sw._PADDING*2}}dispose(){}}var SG;class L5{constructor(e,t,i){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=i.ordered(e)}hasProvider(){return this._providers.length>0}async resolveRenameLocation(e){const t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){const n=this._providers[this._providerRenameIdx];if(!n.resolveRenameLocation)break;const o=await n.resolveRenameLocation(this.model,this.position,e);if(o){if(o.rejectReason){t.push(o.rejectReason);continue}return o}}this._providerRenameIdx=0;const i=this.model.getWordAtPosition(this.position);return i?{range:new P(this.position.lineNumber,i.startColumn,this.position.lineNumber,i.endColumn),text:i.word,rejectReason:t.length>0?t.join(`
`):void 0}:{range:P.fromPositions(this.position),text:"",rejectReason:t.length>0?t.join(`
`):void 0}}async provideRenameEdits(e,t){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}async _provideRenameEdits(e,t,i,n){const o=this._providers[t];if(!o)return{edits:[],rejectReason:i.join(`
`)};const r=await o.provideRenameEdits(this.model,this.position,e,n);if(r){if(r.rejectReason)return this._provideRenameEdits(e,t+1,i.concat(r.rejectReason),n)}else return this._provideRenameEdits(e,t+1,i.concat(h(1431,"No result.")),n);return r}}async function GGe(s,e,t,i){const n=new L5(e,t,s),o=await n.resolveRenameLocation(ye.None);return o?.rejectReason?{edits:[],rejectReason:o.rejectReason}:n.provideRenameEdits(i,ye.None)}let sf=class{static{SG=this}static{this.ID="editor.contrib.renameController"}static get(e){return e.getContribution(SG.ID)}constructor(e,t,i,n,o,r,a,c){this.editor=e,this._instaService=t,this._notificationService=i,this._bulkEditService=n,this._progressService=o,this._logService=r,this._configService=a,this._languageFeaturesService=c,this._disposableStore=new U,this._cts=new ri,this._renameWidget=this._disposableStore.add(this._instaService.createInstance(wG,this.editor,["acceptRenameInput","acceptRenameInputWithPreview"]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}async run(){const e=this._logService.trace.bind(this._logService,"[rename]");if(this._cts.dispose(!0),this._cts=new ri,!this.editor.hasModel()){e("editor has no model");return}const t=this.editor.getPosition(),i=new L5(this.editor.getModel(),t,this._languageFeaturesService.renameProvider);if(!i.hasProvider()){e("skeleton has no provider");return}const n=new Xm(this.editor,ds.Position|ds.Value,void 0,this._cts.token);let o;try{e("resolving rename location");const v=i.resolveRenameLocation(n.token);this._progressService.showWhile(v,250),o=await v,e("resolved rename location")}catch(v){v instanceof $s?e("resolve rename location cancelled",JSON.stringify(v,null,"	")):(e("resolve rename location failed",v instanceof Error?v:JSON.stringify(v,null,"	")),(typeof v=="string"||ec(v))&&wr.get(this.editor)?.showMessage(v||h(1432,"An unknown error occurred while resolving rename location"),t));return}finally{n.dispose()}if(!o){e("returning early - no loc");return}if(o.rejectReason){e(`returning early - rejected with reason: ${o.rejectReason}`,o.rejectReason),wr.get(this.editor)?.showMessage(o.rejectReason,t);return}if(n.token.isCancellationRequested){e("returning early - cts1 cancelled");return}const r=new Xm(this.editor,ds.Position|ds.Value,o.range,this._cts.token),a=this.editor.getModel(),c=this._languageFeaturesService.newSymbolNamesProvider.all(a),d=await Promise.all(c.map(async v=>[v,await v.supportsAutomaticNewSymbolNamesTriggerKind??!1])),l=(v,y)=>{let w=d.slice();return v===qF.Automatic&&(w=w.filter(([C,T])=>T)),w.map(([C])=>C.provideNewSymbolNames(a,o.range,v,y))};e("creating rename input field and awaiting its result");const u=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,"editor.rename.enablePreview"),g=await this._renameWidget.getInput(o.range,o.text,u,c.length>0?l:void 0,r);if(e("received response from rename input field"),typeof g=="boolean"){e(`returning early - rename input field response - ${g}`),g&&this.editor.focus(),r.dispose();return}this.editor.focus(),e("requesting rename edits");const m=xh(i.provideRenameEdits(g.newName,r.token),r.token).then(async v=>{if(!v){e("returning early - no rename edits result");return}if(!this.editor.hasModel()){e("returning early - no model after rename edits are provided");return}if(v.rejectReason){e(`returning early - rejected with reason: ${v.rejectReason}`),this._notificationService.info(v.rejectReason);return}this.editor.setSelection(P.fromPositions(this.editor.getSelection().getPosition())),e("applying edits"),this._bulkEditService.apply(v,{editor:this.editor,showPreview:g.wantsPreview,label:h(1433,"Renaming '{0}' to '{1}'",o?.text,g.newName),code:"undoredo.rename",quotableLabel:h(1434,"Renaming {0} to {1}",o?.text,g.newName),respectAutoSaveConfig:!0}).then(y=>{e("edits applied"),y.ariaSummary&&ta(h(1435,"Successfully renamed '{0}' to '{1}'. Summary: {2}",o.text,g.newName,y.ariaSummary))}).catch(y=>{e(`error when applying edits ${JSON.stringify(y,null,"	")}`),this._notificationService.error(h(1436,"Rename failed to apply edits")),this._logService.error(y)})},v=>{e("error when providing rename edits",JSON.stringify(v,null,"	")),this._notificationService.error(h(1437,"Rename failed to compute edits")),this._logService.error(v)}).finally(()=>{r.dispose()});return e("returning rename operation"),this._progressService.showWhile(m,250),m}acceptRenameInput(e){this._renameWidget.acceptInput(e)}cancelRenameInput(){this._renameWidget.cancelInput(!0,"cancelRenameInput command")}focusNextRenameSuggestion(){this._renameWidget.focusNextRenameSuggestion()}focusPreviousRenameSuggestion(){this._renameWidget.focusPreviousRenameSuggestion()}};sf=SG=f([p(1,J),p(2,At),p(3,gw),p(4,ju),p(5,Pe),p(6,Xo),p(7,Ne)],sf);class qGe extends we{constructor(){super({id:"editor.action.rename",label:I(1438,"Rename Symbol"),precondition:x.and(V.writable,V.hasRenameProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:S.F2,weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:1.1}})}runCommand(e,t){const i=e.get(Ot),[n,o]=Array.isArray(t)&&t||[void 0,void 0];return R.isUri(n)&&_e.isIPosition(o)?i.openCodeEditor({resource:n},i.getActiveCodeEditor()).then(r=>{r&&(r.setPosition(o),r.invokeWithinContext(a=>(this.reportTelemetry(a,r),this.run(a,r))))},mt):super.runCommand(e,t)}run(e,t){const i=e.get(Pe),n=sf.get(t);return n?(i.trace("[RenameAction] got controller, running..."),n.run()):(i.trace("[RenameAction] returning early - controller missing"),Promise.resolve())}}Rt(sf.ID,sf,vt.Lazy);ue(qGe);const M5=No.bindToContribution(sf.get);Ue(new M5({id:"acceptRenameInput",precondition:lS,handler:s=>s.acceptRenameInput(!1),kbOpts:{weight:W.EditorContrib+99,kbExpr:x.and(V.focus,x.not("isComposing")),primary:S.Enter}}));Ue(new M5({id:"acceptRenameInputWithPreview",precondition:x.and(lS,x.has("config.editor.rename.enablePreview")),handler:s=>s.acceptRenameInput(!0),kbOpts:{weight:W.EditorContrib+99,kbExpr:x.and(V.focus,x.not("isComposing")),primary:E.CtrlCmd+S.Enter}}));Ue(new M5({id:"cancelRenameInput",precondition:lS,handler:s=>s.cancelRenameInput(),kbOpts:{weight:W.EditorContrib+99,kbExpr:V.focus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));K(class extends X{constructor(){super({id:"focusNextRenameSuggestion",title:{...I(1439,"Focus Next Rename Suggestion")},precondition:lS,keybinding:[{primary:S.DownArrow,weight:W.EditorContrib+99}]})}run(e){const t=e.get(Ot).getFocusedCodeEditor();if(!t)return;const i=sf.get(t);i&&i.focusNextRenameSuggestion()}});K(class extends X{constructor(){super({id:"focusPreviousRenameSuggestion",title:{...I(1440,"Focus Previous Rename Suggestion")},precondition:lS,keybinding:[{primary:S.UpArrow,weight:W.EditorContrib+99}]})}run(e){const t=e.get(Ot).getFocusedCodeEditor();if(!t)return;const i=sf.get(t);i&&i.focusPreviousRenameSuggestion()}});Ar("_executeDocumentRenameProvider",function(s,e,t,...i){const[n]=i;St(typeof n=="string");const{renameProvider:o}=s.get(Ne);return GGe(o,e,t,n)});Ar("_executePrepareRename",async function(s,e,t){const{renameProvider:i}=s.get(Ne),o=await new L5(e,t,i).resolveRenameLocation(ye.None);if(o?.rejectReason)throw new Error(o.rejectReason);return o});Ge.as(qs.Configuration).registerConfiguration({id:"editor",properties:{"editor.rename.enablePreview":{scope:Bt.LANGUAGE_OVERRIDABLE,description:h(1441,"Enable/disable the ability to preview changes before renaming"),default:!0,type:"boolean"}}});let mM=class extends F{static{this.ID="editor.sectionHeaderDetector"}constructor(e,t,i){super(),this.editor=e,this.languageConfigurationService=t,this.editorWorkerService=i,this.decorations=this.editor.createDecorationsCollection(),this.options=this.createOptions(e.getOption(L.minimap)),this.computePromise=null,this.currentOccurrences={},this._register(e.onDidChangeModel(n=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(L.minimap)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(e.onDidChangeModelLanguage(n=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(L.minimap)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(t.onDidChange(n=>{const o=this.editor.getModel()?.getLanguageId();o&&n.affects(o)&&(this.currentOccurrences={},this.options=this.createOptions(e.getOption(L.minimap)),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(e.onDidChangeConfiguration(n=>{this.options&&!n.hasChanged(L.minimap)||(this.options=this.createOptions(e.getOption(L.minimap)),this.updateDecorations([]),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(this.editor.onDidChangeModelContent(n=>{this.computeSectionHeaders.schedule()})),this._register(e.onDidChangeModelTokens(n=>{this.computeSectionHeaders.isScheduled()||this.computeSectionHeaders.schedule(1e3)})),this.computeSectionHeaders=this._register(new fn(()=>{this.findSectionHeaders()},250)),this.computeSectionHeaders.schedule(0)}createOptions(e){if(!e||!this.editor.hasModel())return;const t=this.editor.getModel().getLanguageId();if(!t)return;const i=this.languageConfigurationService.getLanguageConfiguration(t).comments,n=this.languageConfigurationService.getLanguageConfiguration(t).foldingRules;if(!(!i&&!n?.markers))return{foldingRules:n,markSectionHeaderRegex:e.markSectionHeaderRegex,findMarkSectionHeaders:e.showMarkSectionHeaders,findRegionSectionHeaders:e.showRegionSectionHeaders}}findSectionHeaders(){if(!this.editor.hasModel()||!this.options?.findMarkSectionHeaders&&!this.options?.findRegionSectionHeaders)return;const e=this.editor.getModel();if(e.isDisposed()||e.isTooLargeForSyncing())return;const t=e.getVersionId();this.editorWorkerService.findSectionHeaders(e.uri,this.options).then(i=>{e.isDisposed()||e.getVersionId()!==t||this.updateDecorations(i)})}updateDecorations(e){const t=this.editor.getModel();t&&(e=e.filter(o=>{if(!o.shouldBeInComments)return!0;const r=t.validateRange(o.range),a=t.tokenization.getLineTokens(r.startLineNumber),c=a.findTokenIndexAtOffset(r.startColumn-1),d=a.getStandardTokenType(c);return a.getLanguageId(c)===t.getLanguageId()&&d===Xc.Comment}));const i=Object.values(this.currentOccurrences).map(o=>o.decorationId),n=e.map(o=>zGe(o));this.editor.changeDecorations(o=>{const r=o.deltaDecorations(i,n);this.currentOccurrences={};for(let a=0,c=r.length;a<c;a++){const d={sectionHeader:e[a],decorationId:r[a]};this.currentOccurrences[d.decorationId]=d}})}stop(){this.computeSectionHeaders.cancel(),this.computePromise&&(this.computePromise.cancel(),this.computePromise=null)}dispose(){super.dispose(),this.stop(),this.decorations.clear()}};mM=f([p(1,rs),p(2,vc)],mM);function zGe(s){return{range:s.range,options:Yt.createDynamic({description:"section-header",stickiness:Di.GrowsOnlyWhenTypingAfter,collapseOnReplaceEdit:!0,minimap:{color:void 0,position:Ym.Inline,sectionHeaderStyle:s.hasSeparatorLine?X7.Underlined:X7.Normal,sectionHeaderText:s.text}})}}Rt(mM.ID,mM,vt.AfterFirstRender);function R1(s){return s&&!!s.data}function kpe(s){return s&&Array.isArray(s.edits)}class KGe{constructor(e,t,i){this.provider=e,this.tokens=t,this.error=i}}function Tpe(s,e){return s.has(e)}function jGe(s,e){const t=s.orderedGroups(e);return t.length>0?t[0]:[]}async function Ape(s,e,t,i,n){const o=jGe(s,e),r=await Promise.all(o.map(async a=>{let c,d=null;try{c=await a.provideDocumentSemanticTokens(e,a===t?i:null,n)}catch(l){d=l,c=null}return(!c||!R1(c)&&!kpe(c))&&(c=null),new KGe(a,c,d)}));for(const a of r){if(a.error)throw a.error;if(a.tokens)return a}return r.length>0?r[0]:null}function YGe(s,e){const t=s.orderedGroups(e);return t.length>0?t[0]:null}class QGe{constructor(e,t){this.provider=e,this.tokens=t}}function XGe(s,e){return s.has(e)}function Rpe(s,e){const t=s.orderedGroups(e);return t.length>0?t[0]:[]}async function N5(s,e,t,i){const n=Rpe(s,e),o=await Promise.all(n.map(async r=>{let a;try{a=await r.provideDocumentRangeSemanticTokens(e,t,i)}catch(c){kn(c),a=null}return(!a||!R1(a))&&(a=null),new QGe(r,a)}));for(const r of o)if(r.tokens)return r;return o.length>0?o[0]:null}Ce.registerCommand("_provideDocumentSemanticTokensLegend",async(s,...e)=>{const[t]=e;St(t instanceof R);const i=s.get(ai).getModel(t);if(!i)return;const{documentSemanticTokensProvider:n}=s.get(Ne),o=YGe(n,i);return o?o[0].getLegend():s.get(qe).executeCommand("_provideDocumentRangeSemanticTokensLegend",t)});Ce.registerCommand("_provideDocumentSemanticTokens",async(s,...e)=>{const[t]=e;St(t instanceof R);const i=s.get(ai).getModel(t);if(!i)return;const{documentSemanticTokensProvider:n}=s.get(Ne);if(!Tpe(n,i))return s.get(qe).executeCommand("_provideDocumentRangeSemanticTokens",t,i.getFullModelRange());const o=await Ape(n,i,null,null,ye.None);if(!o)return;const{provider:r,tokens:a}=o;if(!a||!R1(a))return;const c=Fce({id:0,type:"full",data:a.data});return a.resultId&&r.releaseDocumentSemanticTokens(a.resultId),c});Ce.registerCommand("_provideDocumentRangeSemanticTokensLegend",async(s,...e)=>{const[t,i]=e;St(t instanceof R);const n=s.get(ai).getModel(t);if(!n)return;const{documentRangeSemanticTokensProvider:o}=s.get(Ne),r=Rpe(o,n);if(r.length===0)return;if(r.length===1)return r[0].getLegend();if(!i||!P.isIRange(i))return console.warn("provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in"),r[0].getLegend();const a=await N5(o,n,P.lift(i),ye.None);if(a)return a.provider.getLegend()});Ce.registerCommand("_provideDocumentRangeSemanticTokens",async(s,...e)=>{const[t,i]=e;St(t instanceof R),St(P.isIRange(i));const n=s.get(ai).getModel(t);if(!n)return;const{documentRangeSemanticTokensProvider:o}=s.get(Ne),r=await N5(o,n,P.lift(i),ye.None);if(!(!r||!r.tokens))return Fce({id:0,type:"full",data:r.tokens.data})});const O5="editor.semanticHighlighting";function xT(s,e,t){const i=t.getValue(O5,{overrideIdentifier:s.getLanguageId(),resource:s.uri})?.enabled;return typeof i=="boolean"?i:e.getColorTheme().semanticHighlighting}var jg;let CG=class extends F{constructor(e,t,i,n,o,r){super(),this._watchers=new wn;const a=l=>{this._watchers.get(l.uri)?.dispose(),this._watchers.set(l.uri,new EG(l,e,i,o,r))},c=(l,u)=>{u.dispose(),this._watchers.delete(l.uri)},d=()=>{for(const l of t.getModels()){const u=this._watchers.get(l.uri);xT(l,i,n)?u||a(l):u&&c(l,u)}};t.getModels().forEach(l=>{xT(l,i,n)&&a(l)}),this._register(t.onModelAdded(l=>{xT(l,i,n)&&a(l)})),this._register(t.onModelRemoved(l=>{const u=this._watchers.get(l.uri);u&&c(l,u)})),this._register(n.onDidChangeConfiguration(l=>{l.affectsConfiguration(O5)&&d()})),this._register(i.onDidColorThemeChange(d))}dispose(){Qe(this._watchers.values()),this._watchers.clear(),super.dispose()}};CG=f([p(0,$N),p(1,ai),p(2,ft),p(3,ne),p(4,Sd),p(5,Ne)],CG);let EG=class extends F{static{jg=this}static{this.REQUEST_MIN_DELAY=300}static{this.REQUEST_MAX_DELAY=2e3}constructor(e,t,i,n,o){super(),this._semanticTokensStylingService=t,this._isDisposed=!1,this._model=e,this._provider=o.documentSemanticTokensProvider,this._debounceInformation=n.for(this._provider,"DocumentSemanticTokens",{min:jg.REQUEST_MIN_DELAY,max:jg.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new fn(()=>this._fetchDocumentSemanticTokensNow(),jg.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._providersChangedDuringRequest=!1,this._register(this._model.onDidChangeContent(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeAttached(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeLanguage(()=>{this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)}));const r=()=>{Qe(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(const a of this._provider.all(e))typeof a.onDidChange=="function"&&this._documentProvidersChangeListeners.push(a.onDidChange(()=>{if(this._currentDocumentRequestCancellationTokenSource){this._providersChangedDuringRequest=!0;return}this._fetchDocumentSemanticTokens.schedule(0)}))};r(),this._register(this._provider.onDidChange(()=>{r(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(i.onDidColorThemeChange(a=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),Qe(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[],this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!Tpe(this._provider,this._model)){this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1);return}if(!this._model.isAttachedToEditor())return;const e=new ri,t=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,i=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,n=Ape(this._provider,this._model,t,i,e.token);this._currentDocumentRequestCancellationTokenSource=e,this._providersChangedDuringRequest=!1;const o=[],r=this._model.onDidChangeContent(c=>{o.push(c)}),a=new zn(!1);n.then(c=>{if(this._debounceInformation.update(this._model,a.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,r.dispose(),!c)this._setDocumentSemanticTokens(null,null,null,o);else{const{provider:d,tokens:l}=c,u=this._semanticTokensStylingService.getStyling(d);this._setDocumentSemanticTokens(d,l||null,u,o)}},c=>{c&&(gs(c)||typeof c.message=="string"&&c.message.indexOf("busy")!==-1)||mt(c),this._currentDocumentRequestCancellationTokenSource=null,r.dispose(),(o.length>0||this._providersChangedDuringRequest)&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))})}static _copy(e,t,i,n,o){o=Math.min(o,i.length-n,e.length-t);for(let r=0;r<o;r++)i[n+r]=e[t+r]}_setDocumentSemanticTokens(e,t,i,n){const o=this._currentDocumentResponse,r=()=>{(n.length>0||this._providersChangedDuringRequest)&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._isDisposed){e&&t&&e.releaseDocumentSemanticTokens(t.resultId);return}if(!e||!i){this._model.tokenization.setSemanticTokens(null,!1);return}if(!t){this._model.tokenization.setSemanticTokens(null,!0),r();return}if(kpe(t)){if(!o){this._model.tokenization.setSemanticTokens(null,!0);return}if(t.edits.length===0)t={resultId:t.resultId,data:o.data};else{let a=0;for(const g of t.edits)a+=(g.data?g.data.length:0)-g.deleteCount;const c=o.data,d=new Uint32Array(c.length+a);let l=c.length,u=d.length;for(let g=t.edits.length-1;g>=0;g--){const m=t.edits[g];if(m.start>c.length){i.warnInvalidEditStart(o.resultId,t.resultId,g,m.start,c.length),this._model.tokenization.setSemanticTokens(null,!0);return}const v=l-(m.start+m.deleteCount);v>0&&(jg._copy(c,l-v,d,u-v,v),u-=v),m.data&&(jg._copy(m.data,0,d,u-m.data.length,m.data.length),u-=m.data.length),l=m.start}l>0&&jg._copy(c,0,d,0,l),t={resultId:t.resultId,data:d}}}if(R1(t)){this._currentDocumentResponse=new ZGe(e,t.resultId,t.data);const a=vse(t,i,this._model.getLanguageId());if(n.length>0)for(const c of n)for(const d of a)for(const l of c.changes)d.applyEdit(l.range,l.text);this._model.tokenization.setSemanticTokens(a,!0)}else this._model.tokenization.setSemanticTokens(null,!0);r()}};EG=jg=f([p(1,$N),p(2,ft),p(3,Sd),p(4,Ne)],EG);class ZGe{constructor(e,t,i){this.provider=e,this.resultId=t,this.data=i}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}}cS(CG);var xG;let vM=class extends F{static{xG=this}static{this.ID="editor.contrib.viewportSemanticTokens"}static get(e){return e.getContribution(xG.ID)}constructor(e,t,i,n,o,r){super(),this._semanticTokensStylingService=t,this._themeService=i,this._configurationService=n,this._editor=e,this._provider=r.documentRangeSemanticTokensProvider,this._debounceInformation=o.for(this._provider,"DocumentRangeSemanticTokens",{min:100,max:500}),this._tokenizeViewport=this._register(new fn(()=>this._tokenizeViewportNow(),100)),this._outstandingRequests=[];const a=()=>{this._editor.hasModel()&&this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()))};this._register(this._editor.onDidScrollChange(()=>{a()})),this._register(this._editor.onDidChangeModel(()=>{this._cancelAll(),a()})),this._register(this._editor.onDidChangeModelContent(c=>{this._cancelAll(),a()})),this._register(this._provider.onDidChange(()=>{this._cancelAll(),a()})),this._register(this._configurationService.onDidChangeConfiguration(c=>{c.affectsConfiguration(O5)&&(this._cancelAll(),a())})),this._register(this._themeService.onDidColorThemeChange(()=>{this._cancelAll(),a()})),a()}_cancelAll(){for(const e of this._outstandingRequests)e.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(e){for(let t=0,i=this._outstandingRequests.length;t<i;t++)if(this._outstandingRequests[t]===e){this._outstandingRequests.splice(t,1);return}}_tokenizeViewportNow(){if(!this._editor.hasModel())return;const e=this._editor.getModel();if(e.tokenization.hasCompleteSemanticTokens())return;if(!xT(e,this._themeService,this._configurationService)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}if(!XGe(this._provider,e)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}const t=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(t.map(i=>this._requestRange(e,i)))}_requestRange(e,t){const i=e.getVersionId(),n=En(r=>Promise.resolve(N5(this._provider,e,t,r))),o=new zn(!1);return n.then(r=>{if(this._debounceInformation.update(e,o.elapsed()),!r||!r.tokens||e.isDisposed()||e.getVersionId()!==i)return;const{provider:a,tokens:c}=r,d=this._semanticTokensStylingService.getStyling(a);e.tokenization.setPartialSemanticTokens(t,vse(c,d,e.getLanguageId()))}).then(()=>this._removeOutstandingRequest(n),()=>this._removeOutstandingRequest(n)),n}};vM=xG=f([p(1,$N),p(2,ft),p(3,ne),p(4,Sd),p(5,Ne)],vM);Rt(vM.ID,vM,vt.AfterFirstRender);class JGe{constructor(e=!0){this.selectSubwords=e}provideSelectionRanges(e,t){const i=[];for(const n of t){const o=[];i.push(o),this.selectSubwords&&this._addInWordRanges(o,e,n),this._addWordRanges(o,e,n),this._addWhitespaceLine(o,e,n),o.push({range:e.getFullModelRange()})}return i}_addInWordRanges(e,t,i){const n=t.getWordAtPosition(i);if(!n)return;const{word:o,startColumn:r}=n,a=i.column-r;let c=a,d=a,l=0;for(;c>=0;c--){const u=o.charCodeAt(c);if(c!==a&&(u===st.Underline||u===st.Dash))break;if(Z7(u)&&WT(l))break;l=u}for(c+=1;d<o.length;d++){const u=o.charCodeAt(d);if(WT(u)&&Z7(l))break;if(u===st.Underline||u===st.Dash)break;l=u}c<d&&e.push({range:new P(i.lineNumber,r+c,i.lineNumber,r+d)})}_addWordRanges(e,t,i){const n=t.getWordAtPosition(i);n&&e.push({range:new P(i.lineNumber,n.startColumn,i.lineNumber,n.endColumn)})}_addWhitespaceLine(e,t,i){t.getLineLength(i.lineNumber)>0&&t.getLineFirstNonWhitespaceColumn(i.lineNumber)===0&&t.getLineLastNonWhitespaceColumn(i.lineNumber)===0&&e.push({range:new P(i.lineNumber,1,i.lineNumber,t.getLineMaxColumn(i.lineNumber))})}}var IG;class F5{constructor(e,t){this.index=e,this.ranges=t}mov(e){const t=this.index+(e?1:-1);if(t<0||t>=this.ranges.length)return this;const i=new F5(t,this.ranges);return i.ranges[t].equalsRange(this.ranges[this.index])?i.mov(e):i}}let zx=class{static{IG=this}static{this.ID="editor.contrib.smartSelectController"}static get(e){return e.getContribution(IG.ID)}constructor(e,t){this._editor=e,this._languageFeaturesService=t,this._ignoreSelection=!1}dispose(){this._selectionListener?.dispose()}async run(e){if(!this._editor.hasModel())return;const t=this._editor.getSelections(),i=this._editor.getModel();if(this._state||await Lpe(this._languageFeaturesService.selectionRangeProvider,i,t.map(o=>o.getPosition()),this._editor.getOption(L.smartSelect),ye.None).then(o=>{if(!(!xn(o)||o.length!==t.length)&&!(!this._editor.hasModel()||!ns(this._editor.getSelections(),t,(r,a)=>r.equalsSelection(a)))){for(let r=0;r<o.length;r++)o[r]=o[r].filter(a=>a.containsPosition(t[r].getStartPosition())&&a.containsPosition(t[r].getEndPosition())),o[r].unshift(t[r]);this._state=o.map(r=>new F5(0,r)),this._selectionListener?.dispose(),this._selectionListener=this._editor.onDidChangeCursorPosition(()=>{this._ignoreSelection||(this._selectionListener?.dispose(),this._state=void 0)})}}),!this._state)return;this._state=this._state.map(o=>o.mov(e));const n=this._state.map(o=>at.fromPositions(o.ranges[o.index].getStartPosition(),o.ranges[o.index].getEndPosition()));this._ignoreSelection=!0;try{this._editor.setSelections(n)}finally{this._ignoreSelection=!1}}};zx=IG=f([p(1,Ne)],zx);class Ppe extends we{constructor(e,t){super(t),this._forward=e}async run(e,t){const i=zx.get(t);i&&await i.run(this._forward)}}class eqe extends Ppe{constructor(){super(!0,{id:"editor.action.smartSelect.expand",label:I(1448,"Expand Selection"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.RightArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|E.Shift|S.RightArrow,secondary:[E.WinCtrl|E.Shift|S.RightArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"1_basic",title:h(1449,"&&Expand Selection"),order:2}})}}Ce.registerCommandAlias("editor.action.smartSelect.grow","editor.action.smartSelect.expand");class tqe extends Ppe{constructor(){super(!1,{id:"editor.action.smartSelect.shrink",label:I(1450,"Shrink Selection"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.LeftArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|E.Shift|S.LeftArrow,secondary:[E.WinCtrl|E.Shift|S.LeftArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"1_basic",title:h(1451,"&&Shrink Selection"),order:3}})}}Rt(zx.ID,zx,vt.Lazy);ue(eqe);ue(tqe);async function Lpe(s,e,t,i,n){const o=s.all(e).concat(new JGe(i.selectSubwords));o.length===1&&o.unshift(new Bc);const r=[],a=[];for(const c of o)r.push(Promise.resolve(c.provideSelectionRanges(e,t,n)).then(d=>{if(xn(d)&&d.length===t.length)for(let l=0;l<t.length;l++){a[l]||(a[l]=[]);for(const u of d[l])P.isIRange(u.range)&&P.containsPosition(u.range,t[l])&&a[l].push(P.lift(u.range))}},kn));return await Promise.all(r),a.map(c=>{if(c.length===0)return[];c.sort((g,m)=>_e.isBefore(g.getStartPosition(),m.getStartPosition())?1:_e.isBefore(m.getStartPosition(),g.getStartPosition())||_e.isBefore(g.getEndPosition(),m.getEndPosition())?-1:_e.isBefore(m.getEndPosition(),g.getEndPosition())?1:0);const d=[];let l;for(const g of c)(!l||P.containsRange(g,l)&&!P.equalsRange(g,l))&&(d.push(g),l=g);if(!i.selectLeadingAndTrailingWhitespace)return d;const u=[d[0]];for(let g=1;g<d.length;g++){const m=d[g-1],v=d[g];if(v.startLineNumber!==m.startLineNumber||v.endLineNumber!==m.endLineNumber){const y=new P(m.startLineNumber,e.getLineFirstNonWhitespaceColumn(m.startLineNumber),m.endLineNumber,e.getLineLastNonWhitespaceColumn(m.endLineNumber));y.containsRange(m)&&!y.equalsRange(m)&&v.containsRange(y)&&!v.equalsRange(y)&&u.push(y);const w=new P(m.startLineNumber,1,m.endLineNumber,e.getLineMaxColumn(m.endLineNumber));w.containsRange(m)&&!w.equalsRange(y)&&v.containsRange(w)&&!v.equalsRange(w)&&u.push(w)}u.push(v)}return u})}Ce.registerCommand("_executeSelectionRangeProvider",async function(s,...e){const[t,i]=e;St(R.isUri(t));const n=s.get(Ne).selectionRangeProvider,o=await s.get(yi).createModelReference(t);try{return Lpe(n,o.object.textEditorModel,i,{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},ye.None)}finally{o.dispose()}});class iqe extends Rr{constructor(){super({id:"editor.action.toggleStickyScroll",title:{...I(1494,"Toggle Editor Sticky Scroll"),mnemonicTitle:h(1495,"&&Toggle Editor Sticky Scroll")},metadata:{description:I(1496,"Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport")},category:te.View,toggled:{condition:x.equals("config.editor.stickyScroll.enabled",!0),title:h(1497,"Sticky Scroll"),mnemonicTitle:h(1498,"&&Sticky Scroll")},menu:[{id:N.CommandPalette},{id:N.MenubarAppearanceMenu,group:"4_editor",order:3},{id:N.StickyScrollContext}]})}async runEditorCommand(e,t){const i=e.get(ne),n=!i.getValue("editor.stickyScroll.enabled"),o=bd.get(t)?.isFocused();i.updateValue("editor.stickyScroll.enabled",n),o&&t.focus()}}const P1=W.EditorContrib;class nqe extends Rr{constructor(){super({id:"editor.action.focusStickyScroll",title:{...I(1499,"Focus Editor Sticky Scroll"),mnemonicTitle:h(1500,"&&Focus Editor Sticky Scroll")},precondition:x.and(x.has("config.editor.stickyScroll.enabled"),V.stickyScrollVisible),menu:[{id:N.CommandPalette}]})}runEditorCommand(e,t){bd.get(t)?.focus()}}class sqe extends Rr{constructor(){super({id:"editor.action.selectNextStickyScrollLine",title:I(1501,"Select the next editor sticky scroll line"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:P1,primary:S.DownArrow}})}runEditorCommand(e,t){bd.get(t)?.focusNext()}}class oqe extends Rr{constructor(){super({id:"editor.action.selectPreviousStickyScrollLine",title:I(1502,"Select the previous sticky scroll line"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:P1,primary:S.UpArrow}})}runEditorCommand(e,t){bd.get(t)?.focusPrevious()}}class rqe extends Rr{constructor(){super({id:"editor.action.goToFocusedStickyScrollLine",title:I(1503,"Go to the focused sticky scroll line"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:P1,primary:S.Enter}})}runEditorCommand(e,t){bd.get(t)?.goToFocused()}}class aqe extends Rr{constructor(){super({id:"editor.action.selectEditor",title:I(1504,"Select Editor"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:P1,primary:S.Escape}})}runEditorCommand(e,t){bd.get(t)?.selectEditor()}}Rt(bd.ID,bd,vt.AfterFirstRender);K(iqe);K(nqe);K(oqe);K(sqe);K(rqe);K(aqe);class cqe{constructor(e,t,i,n,o,r,a){this.range=e,this.insertText=t,this.filterText=i,this.additionalTextEdits=n,this.command=o,this.action=r,this.completion=a}}let DG=class extends Vq{constructor(e,t,i,n,o,r){super(o.disposable),this.model=e,this.line=t,this.word=i,this.completionModel=n,this._suggestMemoryService=r}canBeReused(e,t,i){return this.model===e&&this.line===t&&this.word.word.length>0&&this.word.startColumn===i.startColumn&&this.word.endColumn<i.endColumn&&this.completionModel.getIncompleteProvider().size===0}get items(){const e=[],{items:t}=this.completionModel,i=this._suggestMemoryService.select(this.model,{lineNumber:this.line,column:this.word.endColumn+this.completionModel.lineContext.characterCountDelta},t),n=dn.slice(t,i),o=dn.slice(t,0,i);let r=5;for(const a of dn.concat(n,o)){if(a.score===_E.Default)continue;const c=new P(a.editStart.lineNumber,a.editStart.column,a.editInsertEnd.lineNumber,a.editInsertEnd.column+this.completionModel.lineContext.characterCountDelta),d=a.completion.insertTextRules&&a.completion.insertTextRules&dh.InsertAsSnippet?{snippet:a.completion.insertText}:a.completion.insertText;e.push(new cqe(c,d,a.filterTextLow??a.labelLow,a.completion.additionalTextEdits,a.completion.command,a.completion.action,a)),r-->=0&&a.resolve(ye.None)}return e}};DG=f([p(5,UN)],DG);let kG=class extends F{constructor(e,t,i,n){super(),this._languageFeatureService=e,this._clipboardService=t,this._suggestMemoryService=i,this._editorService=n,this._store.add(e.inlineCompletionsProvider.register("*",this))}async provideInlineCompletions(e,t,i,n){if(i.selectedSuggestionInfo)return;let o;for(const m of this._editorService.listCodeEditors())if(m.getModel()===e){o=m;break}if(!o)return;const r=o.getOption(L.quickSuggestions);if(hb.isAllOff(r))return;e.tokenization.tokenizeIfCheap(t.lineNumber);const a=e.tokenization.getLineTokens(t.lineNumber),c=a.getStandardTokenType(a.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(hb.valueFor(r,c)!=="inline")return;let d=e.getWordAtPosition(t),l;if(d?.word||(l=this._getTriggerCharacterInfo(e,t)),!d?.word&&!l||(d||(d=e.getWordUntilPosition(t)),d.endColumn!==t.column))return;let u;const g=e.getValueInRange(new P(t.lineNumber,1,t.lineNumber,t.column));if(!l&&this._lastResult?.canBeReused(e,t.lineNumber,d)){const m=new PX(g,t.column-this._lastResult.word.endColumn);this._lastResult.completionModel.lineContext=m,this._lastResult.acquire(),u=this._lastResult}else{const m=await zK(this._languageFeatureService.completionProvider,e,t,new eD(void 0,XR.createSuggestFilter(o).itemKind,l?.providers),l&&{triggerKind:_a.TriggerCharacter,triggerCharacter:l.ch},n);let v;m.needsClipboard&&(v=await this._clipboardService.readText());const y=new cp(m.items,t.column,new PX(g,0),Ql.None,o.getOption(L.suggest),o.getOption(L.snippetSuggestions),{boostFullMatch:!1,firstMatchCanBeWeak:!1},v);u=new DG(e,t.lineNumber,d,y,m,this._suggestMemoryService)}return this._lastResult=u,u}handleItemDidShow(e,t){t.completion.resolve(ye.None)}freeInlineCompletions(e){e.release()}_getTriggerCharacterInfo(e,t){const i=e.getValueInRange(P.fromPositions({lineNumber:t.lineNumber,column:t.column-1},t)),n=new Set;for(const o of this._languageFeatureService.completionProvider.all(e))o.triggerCharacters?.includes(i)&&n.add(o);if(n.size!==0)return{providers:n,ch:i}}};kG=f([p(0,Ne),p(1,Is),p(2,UN),p(3,Ot)],kG);cS(kG);class dqe extends we{constructor(){super({id:"editor.action.forceRetokenize",label:I(1579,"Developer: Force Retokenize"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const i=t.getModel();i.tokenization.resetTokenization();const n=new zn;i.tokenization.forceTokenization(i.getLineCount()),n.stop(),console.log(`tokenization took ${n.elapsed()}`)}}ue(dqe);const lqe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),hqe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(hqe);const uqe=26;let TG=class extends F{constructor(e,t){super(),this._editor=e,this.instantiationService=t,this.banner=this._register(this.instantiationService.createInstance(AG))}hide(){this._editor.setBanner(null,0),this.banner.clear()}show(e){this.banner.show({...e,onClose:()=>{this.hide(),e.onClose?.()}}),this._editor.setBanner(this.banner.element,uqe)}};TG=f([p(1,J)],TG);let AG=class extends F{constructor(e){super(),this.instantiationService=e,this.markdownRenderer=this.instantiationService.createInstance(Rv,{}),this.element=Y("div.editor-banner"),this.element.tabIndex=0}getAriaLabel(e){if(e.ariaLabel)return e.ariaLabel;if(typeof e.message=="string")return e.message}getBannerMessage(e){if(typeof e=="string"){const t=Y("span");return t.innerText=e,t}return this.markdownRenderer.render(e).element}clear(){Yi(this.element)}show(e){Yi(this.element);const t=this.getAriaLabel(e);t&&this.element.setAttribute("aria-label",t);const i=ee(this.element,Y("div.icon-container"));i.setAttribute("aria-hidden","true"),e.icon&&i.appendChild(Y(`div${Te.asCSSSelector(e.icon)}`));const n=ee(this.element,Y("div.message-container"));if(n.setAttribute("aria-hidden","true"),n.appendChild(this.getBannerMessage(e.message)),this.messageActionsContainer=ee(this.element,Y("div.message-actions-container")),e.actions)for(const r of e.actions)this._register(this.instantiationService.createInstance(xx,this.messageActionsContainer,{...r,tabIndex:-1},{}));const o=ee(this.element,Y("div.action-container"));this.actionBar=this._register(new Er(o)),this.actionBar.push(this._register(new Kt("banner.close",h(1580,"Close Banner"),Te.asClassName(lse),!0,()=>{typeof e.onClose=="function"&&e.onClose()})),{icon:!0,label:!1}),this.actionBar.setFocusable(!1)}};AG=f([p(0,J)],AG);Be(lqe);const gqe=Ae("extensions-warning-message",j.warning,h(1581,"Icon shown with a warning message in the extensions editor."));let Kx=class extends F{static{this.ID="editor.contrib.unicodeHighlighter"}constructor(e,t,i,n){super(),this._editor=e,this._editorWorkerService=t,this._workspaceTrustService=i,this._highlighter=null,this._bannerClosed=!1,this._updateState=o=>{if(o&&o.hasMore){if(this._bannerClosed)return;const r=Math.max(o.ambiguousCharacterCount,o.nonBasicAsciiCharacterCount,o.invisibleCharacterCount);let a;if(o.nonBasicAsciiCharacterCount>=r)a={message:h(1582,"This document contains many non-basic ASCII unicode characters"),command:new xD};else if(o.ambiguousCharacterCount>=r)a={message:h(1583,"This document contains many ambiguous unicode characters"),command:new f_};else if(o.invisibleCharacterCount>=r)a={message:h(1584,"This document contains many invisible unicode characters"),command:new ED};else throw new Error("Unreachable");this._bannerController.show({id:"unicodeHighlightBanner",message:a.message,icon:gqe,actions:[{label:a.command.shortLabel,href:`command:${a.command.desc.id}`}],onClose:()=>{this._bannerClosed=!0}})}else this._bannerController.hide()},this._bannerController=this._register(n.createInstance(TG,e)),this._register(this._editor.onDidChangeModel(()=>{this._bannerClosed=!1,this._updateHighlighter()})),this._options=e.getOption(L.unicodeHighlighting),this._register(i.onDidChangeTrust(o=>{this._updateHighlighter()})),this._register(e.onDidChangeConfiguration(o=>{o.hasChanged(L.unicodeHighlighting)&&(this._options=e.getOption(L.unicodeHighlighting),this._updateHighlighter())})),this._updateHighlighter()}dispose(){this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),super.dispose()}_updateHighlighter(){if(this._updateState(null),this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),!this._editor.hasModel())return;const e=pqe(this._workspaceTrustService.isWorkspaceTrusted(),this._options);if([e.nonBasicASCII,e.ambiguousCharacters,e.invisibleCharacters].every(i=>i===!1))return;const t={nonBasicASCII:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments,includeStrings:e.includeStrings,allowedCodePoints:Object.keys(e.allowedCharacters).map(i=>i.codePointAt(0)),allowedLocales:Object.keys(e.allowedLocales).map(i=>i==="_os"?Oq.NumberFormat().value.resolvedOptions().locale:i==="_vscode"?sl:i)};this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)?this._highlighter=new RG(this._editor,t,this._updateState,this._editorWorkerService):this._highlighter=new fqe(this._editor,t,this._updateState)}getDecorationInfo(e){return this._highlighter?this._highlighter.getDecorationInfo(e):null}};Kx=f([p(1,vc),p(2,Tv),p(3,J)],Kx);function pqe(s,e){return{nonBasicASCII:e.nonBasicASCII===s0?!s:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments===s0?!s:e.includeComments,includeStrings:e.includeStrings===s0?!s:e.includeStrings,allowedCharacters:e.allowedCharacters,allowedLocales:e.allowedLocales}}let RG=class extends F{constructor(e,t,i,n){super(),this._editor=e,this._options=t,this._updateState=i,this._editorWorkerService=n,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new fn(()=>this._update(),250)),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const e=this._model.getVersionId();this._editorWorkerService.computedUnicodeHighlights(this._model.uri,this._options).then(t=>{if(this._model.isDisposed()||this._model.getVersionId()!==e)return;this._updateState(t);const i=[];if(!t.hasMore)for(const n of t.ranges)i.push({range:n,options:L1.instance.getDecorationFromOptions(this._options)});this._decorations.set(i)})}getDecorationInfo(e){if(!this._decorations.has(e))return null;const t=this._editor.getModel();if(!Ose(t,e))return null;const i=t.getValueInRange(e.range);return{reason:Npe(i,this._options),inComment:Wse(t,e),inString:Fse(t,e)}}};RG=f([p(3,vc)],RG);class fqe extends F{constructor(e,t,i){super(),this._editor=e,this._options=t,this._updateState=i,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new fn(()=>this._update(),250)),this._register(this._editor.onDidLayoutChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidScrollChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeHiddenAreas(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const e=this._editor.getVisibleRanges(),t=[],i={ranges:[],ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0,hasMore:!1};for(const n of e){const o=_se.computeUnicodeHighlights(this._model,this._options,n);for(const r of o.ranges)i.ranges.push(r);i.ambiguousCharacterCount+=i.ambiguousCharacterCount,i.invisibleCharacterCount+=i.invisibleCharacterCount,i.nonBasicAsciiCharacterCount+=i.nonBasicAsciiCharacterCount,i.hasMore=i.hasMore||o.hasMore}if(!i.hasMore)for(const n of i.ranges)t.push({range:n,options:L1.instance.getDecorationFromOptions(this._options)});this._updateState(i),this._decorations.set(t)}getDecorationInfo(e){if(!this._decorations.has(e))return null;const t=this._editor.getModel(),i=t.getValueInRange(e.range);return Ose(t,e)?{reason:Npe(i,this._options),inComment:Wse(t,e),inString:Fse(t,e)}:null}}const Mpe=h(1585,"Configure Unicode Highlight Options");let PG=class{constructor(e,t,i){this._editor=e,this._languageService=t,this._openerService=i,this.hoverOrdinal=5}computeSync(e,t){if(!this._editor.hasModel()||e.type!==Qo.Range)return[];const i=this._editor.getModel(),n=this._editor.getContribution(Kx.ID);if(!n)return[];const o=[],r=new Set;let a=300;for(const c of t){const d=n.getDecorationInfo(c);if(!d)continue;const u=i.getValueInRange(c.range).codePointAt(0),g=hF(u);let m;switch(d.reason.kind){case lm.Ambiguous:{Zne(d.reason.confusableWith)?m=h(1586,"The character {0} could be confused with the ASCII character {1}, which is more common in source code.",g,hF(d.reason.confusableWith.codePointAt(0))):m=h(1587,"The character {0} could be confused with the character {1}, which is more common in source code.",g,hF(d.reason.confusableWith.codePointAt(0)));break}case lm.Invisible:m=h(1588,"The character {0} is invisible.",g);break;case lm.NonBasicAscii:m=h(1589,"The character {0} is not a basic ASCII character.",g);break}if(r.has(m))continue;r.add(m);const v={codePoint:u,reason:d.reason,inComment:d.inComment,inString:d.inString},y=h(1590,"Adjust settings"),w=`command:${M1.ID}?${encodeURIComponent(JSON.stringify(v))}`,C=new Ni("",!0).appendMarkdown(m).appendText(" ").appendLink(w,y,Mpe);o.push(new Qc(this,c.range,[C],!1,a++))}return o}renderHoverParts(e,t){return jPe(e,t,this._editor,this._languageService,this._openerService)}getAccessibleContent(e){return e.contents.map(t=>t.value).join(`
`)}};PG=f([p(1,fi),p(2,hi)],PG);function LG(s){return`U+${s.toString(16).padStart(4,"0")}`}function hF(s){let e=`\`${LG(s)}\``;return bse.isInvisibleCharacter(s)||(e+=` "${`${mqe(s)}`}"`),e}function mqe(s){return s===st.BackTick?"`` ` ``":"`"+String.fromCodePoint(s)+"`"}function Npe(s,e){return _se.computeUnicodeHighlightReason(s,e)}class L1{constructor(){this.map=new Map}static{this.instance=new L1}getDecorationFromOptions(e){return this.getDecoration(!e.includeComments,!e.includeStrings)}getDecoration(e,t){const i=`${e}${t}`;let n=this.map.get(i);return n||(n=Yt.createDynamic({description:"unicode-highlight",stickiness:Di.NeverGrowsWhenTypingAtEdges,className:"unicode-highlight",showIfCollapsed:!0,overviewRuler:null,minimap:null,hideInCommentTokens:e,hideInStringTokens:t}),this.map.set(i,n)),n}}class vqe extends we{static{this.ID="editor.action.unicodeHighlight.disableHighlightingInComments"}constructor(){super({id:f_.ID,label:I(1591,"Disable highlighting of characters in comments"),precondition:void 0}),this.shortLabel=h(1592,"Disable Highlight In Comments")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(sg.includeComments,!1,ur.USER)}}class _qe extends we{static{this.ID="editor.action.unicodeHighlight.disableHighlightingInStrings"}constructor(){super({id:f_.ID,label:I(1593,"Disable highlighting of characters in strings"),precondition:void 0}),this.shortLabel=h(1594,"Disable Highlight In Strings")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(sg.includeStrings,!1,ur.USER)}}class f_ extends X{static{this.ID="editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters"}constructor(){super({id:f_.ID,title:I(1595,"Disable highlighting of ambiguous characters"),precondition:void 0,f1:!1}),this.shortLabel=h(1596,"Disable Ambiguous Highlight")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(sg.ambiguousCharacters,!1,ur.USER)}}class ED extends X{static{this.ID="editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters"}constructor(){super({id:ED.ID,title:I(1597,"Disable highlighting of invisible characters"),precondition:void 0,f1:!1}),this.shortLabel=h(1598,"Disable Invisible Highlight")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(sg.invisibleCharacters,!1,ur.USER)}}class xD extends X{static{this.ID="editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters"}constructor(){super({id:xD.ID,title:I(1599,"Disable highlighting of non basic ASCII characters"),precondition:void 0,f1:!1}),this.shortLabel=h(1600,"Disable Non ASCII Highlight")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(sg.nonBasicASCII,!1,ur.USER)}}class M1 extends X{static{this.ID="editor.action.unicodeHighlight.showExcludeOptions"}constructor(){super({id:M1.ID,title:I(1601,"Show Exclude Options"),precondition:void 0,f1:!1})}async run(e,t){const{codePoint:i,reason:n,inString:o,inComment:r}=t,a=String.fromCodePoint(i),c=e.get(zt),d=e.get(ne);function l(v){return bse.isInvisibleCharacter(v)?h(1602,"Exclude {0} (invisible character) from being highlighted",LG(v)):h(1603,"Exclude {0} from being highlighted",`${LG(v)} "${a}"`)}const u=[];if(n.kind===lm.Ambiguous)for(const v of n.notAmbiguousInLocales)u.push({label:h(1604,'Allow unicode characters that are more common in the language "{0}".',v),run:async()=>{yqe(d,[v])}});if(u.push({label:l(i),run:()=>bqe(d,[i])}),r){const v=new vqe;u.push({label:v.label,run:async()=>v.runAction(d)})}else if(o){const v=new _qe;u.push({label:v.label,run:async()=>v.runAction(d)})}function g(v){return typeof v.desc.title=="string"?v.desc.title:v.desc.title.value}if(n.kind===lm.Ambiguous){const v=new f_;u.push({label:g(v),run:async()=>v.runAction(d)})}else if(n.kind===lm.Invisible){const v=new ED;u.push({label:g(v),run:async()=>v.runAction(d)})}else if(n.kind===lm.NonBasicAscii){const v=new xD;u.push({label:g(v),run:async()=>v.runAction(d)})}else wqe(n);const m=await c.pick(u,{title:Mpe});m&&await m.run()}}async function bqe(s,e){const t=s.getValue(sg.allowedCharacters);let i;typeof t=="object"&&t?i=t:i={};for(const n of e)i[String.fromCodePoint(n)]=!0;await s.updateValue(sg.allowedCharacters,i,ur.USER)}async function yqe(s,e){const t=s.inspect(sg.allowedLocales).user?.value;let i;typeof t=="object"&&t?i=Object.assign({},t):i={};for(const n of e)i[n]=!0;await s.updateValue(sg.allowedLocales,i,ur.USER)}function wqe(s){throw new Error(`Unexpected value: ${s}`)}K(f_);K(ED);K(xD);K(M1);Rt(Kx.ID,Kx,vt.AfterFirstRender);s_.register(PG);const Ope="ignoreUnusualLineTerminators";function Sqe(s,e,t){s.setModelProperty(e.uri,Ope,t)}function Cqe(s,e){return s.getModelProperty(e.uri,Ope)}let _M=class extends F{static{this.ID="editor.contrib.unusualLineTerminatorsDetector"}constructor(e,t,i){super(),this._editor=e,this._dialogService=t,this._codeEditorService=i,this._isPresentingDialog=!1,this._config=this._editor.getOption(L.unusualLineTerminators),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.unusualLineTerminators)&&(this._config=this._editor.getOption(L.unusualLineTerminators),this._checkForUnusualLineTerminators())})),this._register(this._editor.onDidChangeModel(()=>{this._checkForUnusualLineTerminators()})),this._register(this._editor.onDidChangeModelContent(n=>{n.isUndoing||this._checkForUnusualLineTerminators()})),this._checkForUnusualLineTerminators()}async _checkForUnusualLineTerminators(){if(this._config==="off"||!this._editor.hasModel())return;const e=this._editor.getModel();if(!e.mightContainUnusualLineTerminators()||Cqe(this._codeEditorService,e)===!0||this._editor.getOption(L.readOnly))return;if(this._config==="auto"){e.removeUnusualLineTerminators(this._editor.getSelections());return}if(this._isPresentingDialog)return;let i;try{this._isPresentingDialog=!0,i=await this._dialogService.confirm({title:h(1605,"Unusual Line Terminators"),message:h(1606,"Detected unusual line terminators"),detail:h(1607,"The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).\n\nIt is recommended to remove them from the file. This can be configured via `editor.unusualLineTerminators`.",je(e.uri)),primaryButton:h(1608,"&&Remove Unusual Line Terminators"),cancelButton:h(1609,"Ignore")})}finally{this._isPresentingDialog=!1}if(!i.confirmed){Sqe(this._codeEditorService,e,!0);return}e.removeUnusualLineTerminators(this._editor.getSelections())}};_M=f([p(1,Qt),p(2,Ot)],_M);Rt(_M.ID,_M,vt.AfterFirstRender);class Zte{constructor(){this.selector={language:"*"}}provideDocumentHighlights(e,t,i){const n=[],o=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});return o?e.isDisposed()?void 0:e.findMatches(o.word,!0,!1,!0,J7,!1).map(a=>({range:a.range,kind:eA.Text})):Promise.resolve(n)}provideMultiDocumentHighlights(e,t,i,n){const o=new wn,r=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!r)return Promise.resolve(o);for(const a of[e,...i]){if(a.isDisposed())continue;const d=a.findMatches(r.word,!0,!1,!0,J7,!1).map(l=>({range:l.range,kind:eA.Text}));d&&o.set(a.uri,d)}return o}}let MG=class extends F{constructor(e){super(),this._register(e.documentHighlightProvider.register("*",new Zte)),this._register(e.multiDocumentHighlightProvider.register("*",new Zte))}};MG=f([p(0,Ne)],MG);var sn,NG;const W5=new O("hasWordHighlights",!1);function Fpe(s,e,t,i){const n=s.ordered(e);return Gq(n.map(o=>()=>Promise.resolve(o.provideDocumentHighlights(e,t,i)).then(void 0,kn)),o=>o!=null).then(o=>{if(o){const r=new wn;return r.set(e.uri,o),r}return new wn})}function Eqe(s,e,t,i,n){const o=s.ordered(e);return Gq(o.map(r=>()=>{const a=n.filter(c=>Au(c)).filter(c=>qN(r.selector,c.uri,c.getLanguageId(),!0,void 0,void 0)>0);return Promise.resolve(r.provideMultiDocumentHighlights(e,t,a,i)).then(void 0,kn)}),r=>r!=null)}class Wpe{constructor(e,t,i){this._model=e,this._selection=t,this._wordSeparators=i,this._wordRange=this._getCurrentWordRange(e,t),this._result=null}get result(){return this._result||(this._result=En(e=>this._compute(this._model,this._selection,this._wordSeparators,e))),this._result}_getCurrentWordRange(e,t){const i=e.getWordAtPosition(t.getPosition());return i?new P(t.startLineNumber,i.startColumn,t.startLineNumber,i.endColumn):null}isValid(e,t,i){const n=t.startLineNumber,o=t.startColumn,r=t.endColumn,a=this._getCurrentWordRange(e,t);let c=!!(this._wordRange&&this._wordRange.equalsRange(a));for(let d=0,l=i.length;!c&&d<l;d++){const u=i.getRange(d);u&&u.startLineNumber===n&&u.startColumn<=o&&u.endColumn>=r&&(c=!0)}return c}cancel(){this.result.cancel()}}class xqe extends Wpe{constructor(e,t,i,n){super(e,t,i),this._providers=n}_compute(e,t,i,n){return Fpe(this._providers,e,t.getPosition(),n).then(o=>o||new wn)}}class Iqe extends Wpe{constructor(e,t,i,n,o){super(e,t,i),this._providers=n,this._otherModels=o}_compute(e,t,i,n){return Eqe(this._providers,e,t.getPosition(),n,this._otherModels).then(o=>o||new wn)}}function Dqe(s,e,t,i){return new xqe(e,t,i,s)}function kqe(s,e,t,i,n){return new Iqe(e,t,i,s,n)}Ar("_executeDocumentHighlights",async(s,e,t)=>{const i=s.get(Ne);return(await Fpe(i.documentHighlightProvider,e,t,ye.None))?.get(e.uri)});let OG=class{static{sn=this}static{this.storedDecorationIDs=new wn}static{this.query=null}constructor(e,t,i,n,o,r,a,c){this.toUnhook=new U,this.workerRequestTokenId=0,this.workerRequestCompleted=!1,this.workerRequestValue=new wn,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,this.runDelayer=this.toUnhook.add(new tg(50)),this.editor=e,this.providers=t,this.multiDocumentProviders=i,this.codeEditorService=r,this.textModelService=o,this.configurationService=a,this.logService=c,this._hasWordHighlights=W5.bindTo(n),this._ignorePositionChangeEvent=!1,this.occurrencesHighlightEnablement=this.editor.getOption(L.occurrencesHighlight),this.occurrencesHighlightDelay=this.configurationService.getValue("editor.occurrencesHighlightDelay"),this.model=this.editor.getModel(),this.toUnhook.add(e.onDidChangeCursorPosition(d=>{this._ignorePositionChangeEvent||this.occurrencesHighlightEnablement!=="off"&&this.runDelayer.trigger(()=>{this._onPositionChanged(d)})})),this.toUnhook.add(e.onDidFocusEditorText(d=>{this.occurrencesHighlightEnablement!=="off"&&(this.workerRequest||this.runDelayer.trigger(()=>{this._run()}))})),this.toUnhook.add(e.onDidChangeModelContent(d=>{DE(this.model.uri,"output")||this._stopAll()})),this.toUnhook.add(e.onDidChangeModel(d=>{!d.newModelUrl&&d.oldModelUrl?this._stopSingular():sn.query&&this._run()})),this.toUnhook.add(e.onDidChangeConfiguration(d=>{const l=this.editor.getOption(L.occurrencesHighlight);if(this.occurrencesHighlightEnablement!==l)switch(this.occurrencesHighlightEnablement=l,l){case"off":this._stopAll();break;case"singleFile":this._stopAll(sn.query?.modelInfo?.modelURI);break;case"multiFile":sn.query&&this._run(!0);break;default:console.warn("Unknown occurrencesHighlight setting value:",l);break}})),this.toUnhook.add(this.configurationService.onDidChangeConfiguration(d=>{if(d.affectsConfiguration("editor.occurrencesHighlightDelay")){const l=a.getValue("editor.occurrencesHighlightDelay");this.occurrencesHighlightDelay!==l&&(this.occurrencesHighlightDelay=l)}})),this.toUnhook.add(e.onDidBlurEditorWidget(()=>{const d=this.codeEditorService.getFocusedCodeEditor();d?d.getModel()?.uri.scheme===ae.vscodeNotebookCell&&this.editor.getModel()?.uri.scheme!==ae.vscodeNotebookCell&&this._stopAll():this._stopAll()})),this.decorations=this.editor.createDecorationsCollection(),this.workerRequestTokenId=0,this.workerRequest=null,this.workerRequestCompleted=!1,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=void 0,sn.query&&this._run()}hasDecorations(){return this.decorations.length>0}restore(e){this.occurrencesHighlightEnablement!=="off"&&(this.runDelayer.cancel(),this.runDelayer.trigger(()=>{this._run(!1,e)}))}trigger(){this.runDelayer.cancel(),this._run(!1,0)}stop(){this.occurrencesHighlightEnablement!=="off"&&this._stopAll()}_getSortedHighlights(){return this.decorations.getRanges().sort(P.compareRangesUsingStarts)}moveNext(){const e=this._getSortedHighlights(),i=(e.findIndex(o=>o.containsPosition(this.editor.getPosition()))+1)%e.length,n=e[i];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);const o=this._getWord();if(o){const r=this.editor.getModel().getLineContent(n.startLineNumber);ta(`${r}, ${i+1} of ${e.length} for '${o.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}moveBack(){const e=this._getSortedHighlights(),i=(e.findIndex(o=>o.containsPosition(this.editor.getPosition()))-1+e.length)%e.length,n=e[i];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);const o=this._getWord();if(o){const r=this.editor.getModel().getLineContent(n.startLineNumber);ta(`${r}, ${i+1} of ${e.length} for '${o.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}_removeSingleDecorations(){if(!this.editor.hasModel())return;const e=sn.storedDecorationIDs.get(this.editor.getModel().uri);e&&(this.editor.removeDecorations(e),sn.storedDecorationIDs.delete(this.editor.getModel().uri),this.decorations.length>0&&(this.decorations.clear(),this._hasWordHighlights.set(!1)))}_removeAllDecorations(e){const t=this.codeEditorService.listCodeEditors(),i=[];for(const n of t){if(!n.hasModel()||Dt(n.getModel().uri,e))continue;const o=sn.storedDecorationIDs.get(n.getModel().uri);if(!o)continue;n.removeDecorations(o),i.push(n.getModel().uri);const r=of.get(n);r?.wordHighlighter&&r.wordHighlighter.decorations.length>0&&(r.wordHighlighter.decorations.clear(),r.wordHighlighter.workerRequest=null,r.wordHighlighter._hasWordHighlights.set(!1))}for(const n of i)sn.storedDecorationIDs.delete(n)}_stopSingular(){this._removeSingleDecorations(),this.editor.hasTextFocus()&&(this.editor.getModel()?.uri.scheme!==ae.vscodeNotebookCell&&sn.query?.modelInfo?.modelURI.scheme!==ae.vscodeNotebookCell?(sn.query=null,this._run()):sn.query?.modelInfo&&(sn.query.modelInfo=null)),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||(this.workerRequestTokenId++,this.workerRequestCompleted=!0)}_stopAll(e){this._removeAllDecorations(e),this.renderDecorationsTimer!==void 0&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=void 0),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||(this.workerRequestTokenId++,this.workerRequestCompleted=!0)}_onPositionChanged(e){if(this.occurrencesHighlightEnablement==="off"){this._stopAll();return}if(e.source!=="api"&&e.reason!==Ls.Explicit){this._stopAll();return}this._run()}_getWord(){const e=this.editor.getSelection(),t=e.startLineNumber,i=e.startColumn;return this.model.isDisposed()?null:this.model.getWordAtPosition({lineNumber:t,column:i})}getOtherModelsToHighlight(e){if(!e)return[];if(e.uri.scheme===ae.vscodeNotebookCell){const o=[],r=this.codeEditorService.listCodeEditors();for(const a of r){const c=a.getModel();c&&c!==e&&c.uri.scheme===ae.vscodeNotebookCell&&o.push(c)}return o}const i=[],n=this.codeEditorService.listCodeEditors();for(const o of n){if(!$p(o))continue;const r=o.getModel();r&&e===r.modified&&i.push(r.modified)}if(i.length)return i;if(this.occurrencesHighlightEnablement==="singleFile")return[];for(const o of n){const r=o.getModel();r&&r!==e&&i.push(r)}return i}async _run(e,t){if(this.editor.hasTextFocus()){const n=this.editor.getSelection();if(!n||n.startLineNumber!==n.endLineNumber){sn.query=null,this._stopAll();return}const o=n.startColumn,r=n.endColumn,a=this._getWord();if(!a||a.startColumn>o||a.endColumn<r){sn.query=null,this._stopAll();return}sn.query={modelInfo:{modelURI:this.model.uri,selection:n}}}else if(!sn.query){this._stopAll();return}if(this.lastCursorPositionChangeTime=new Date().getTime(),Dt(this.editor.getModel().uri,sn.query.modelInfo?.modelURI)){if(!e){const a=this.decorations.getRanges();for(const c of a)if(c.containsPosition(this.editor.getPosition()))return}this._stopAll(e?this.model.uri:void 0);const n=++this.workerRequestTokenId;this.workerRequestCompleted=!1;const o=this.getOtherModelsToHighlight(this.editor.getModel());if(!sn.query||!sn.query.modelInfo)return;const r=await this.textModelService.createModelReference(sn.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(r.object.textEditorModel,sn.query.modelInfo.selection,o),this.workerRequest?.result.then(a=>{n===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=a||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},mt)}catch(a){this.logService.error("Unexpected error during occurrence request. Log: ",a)}finally{r.dispose()}}else if(this.model.uri.scheme===ae.vscodeNotebookCell){const n=++this.workerRequestTokenId;if(this.workerRequestCompleted=!1,!sn.query||!sn.query.modelInfo)return;const o=await this.textModelService.createModelReference(sn.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(o.object.textEditorModel,sn.query.modelInfo.selection,[this.model]),this.workerRequest?.result.then(r=>{n===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=r||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},mt)}catch(r){this.logService.error("Unexpected error during occurrence request. Log: ",r)}finally{o.dispose()}}}computeWithModel(e,t,i){return i.length?kqe(this.multiDocumentProviders,e,t,this.editor.getOption(L.wordSeparators),i):Dqe(this.providers,e,t,this.editor.getOption(L.wordSeparators))}_beginRenderDecorations(e){const t=new Date().getTime(),i=this.lastCursorPositionChangeTime+e;t>=i?(this.renderDecorationsTimer=void 0,this.renderDecorations()):this.renderDecorationsTimer=setTimeout(()=>{this.renderDecorations()},i-t)}renderDecorations(){this.renderDecorationsTimer=void 0;const e=this.codeEditorService.listCodeEditors();for(const t of e){const i=of.get(t);if(!i)continue;const n=[],o=t.getModel()?.uri;if(o&&this.workerRequestValue.has(o)){const r=sn.storedDecorationIDs.get(o),a=this.workerRequestValue.get(o);if(a)for(const d of a)d.range&&n.push({range:d.range,options:_Ge(d.kind)});let c=[];t.changeDecorations(d=>{c=d.deltaDecorations(r??[],n)}),sn.storedDecorationIDs=sn.storedDecorationIDs.set(o,c),n.length>0&&(i.wordHighlighter?.decorations.set(n),i.wordHighlighter?._hasWordHighlights.set(!0))}}this.workerRequest=null}dispose(){this._stopSingular(),this.toUnhook.dispose()}};OG=sn=f([p(4,yi),p(5,Ot),p(6,ne),p(7,Pe)],OG);let of=class extends F{static{NG=this}static{this.ID="editor.contrib.wordHighlighter"}static get(e){return e.getContribution(NG.ID)}constructor(e,t,i,n,o,r,a){super(),this._wordHighlighter=null;const c=()=>{e.hasModel()&&!e.getModel().isTooLargeForTokenization()&&e.getModel().uri.scheme!==ae.accessibleView&&(this._wordHighlighter=new OG(e,i.documentHighlightProvider,i.multiDocumentHighlightProvider,t,o,n,r,a))};this._register(e.onDidChangeModel(d=>{this._wordHighlighter&&(!d.newModelUrl&&d.oldModelUrl?.scheme!==ae.vscodeNotebookCell&&this.wordHighlighter?.stop(),this._wordHighlighter.dispose(),this._wordHighlighter=null),c()})),c()}get wordHighlighter(){return this._wordHighlighter}saveViewState(){return!!(this._wordHighlighter&&this._wordHighlighter.hasDecorations())}moveNext(){this._wordHighlighter?.moveNext()}moveBack(){this._wordHighlighter?.moveBack()}restoreViewState(e){this._wordHighlighter&&e&&this._wordHighlighter.restore(250)}stopHighlighting(){this._wordHighlighter?.stop()}dispose(){this._wordHighlighter&&(this._wordHighlighter.dispose(),this._wordHighlighter=null),super.dispose()}};of=NG=f([p(1,me),p(2,Ne),p(3,Ot),p(4,yi),p(5,ne),p(6,Pe)],of);class Bpe extends we{constructor(e,t){super(t),this._isNext=e}run(e,t){const i=of.get(t);i&&(this._isNext?i.moveNext():i.moveBack())}}class Tqe extends Bpe{constructor(){super(!0,{id:"editor.action.wordHighlight.next",label:I(1619,"Go to Next Symbol Highlight"),precondition:W5,kbOpts:{kbExpr:V.editorTextFocus,primary:S.F7,weight:W.EditorContrib}})}}class Aqe extends Bpe{constructor(){super(!1,{id:"editor.action.wordHighlight.prev",label:I(1620,"Go to Previous Symbol Highlight"),precondition:W5,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|S.F7,weight:W.EditorContrib}})}}class Rqe extends we{constructor(){super({id:"editor.action.wordHighlight.trigger",label:I(1621,"Trigger Symbol Highlight"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:0,weight:W.EditorContrib}})}run(e,t,i){const n=of.get(t);n&&n.restoreViewState(!0)}}Rt(of.ID,of,vt.Eager);ue(Tqe);ue(Aqe);ue(Rqe);cS(MG);class N1 extends No{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,i){if(!t.hasModel())return;const n=Ov(t.getOption(L.wordSeparators),t.getOption(L.wordSegmenterLocales)),o=t.getModel(),r=t.getSelections(),a=r.length>1,c=r.map(d=>{const l=new _e(d.positionLineNumber,d.positionColumn),u=this._move(n,o,l,this._wordNavigationType,a);return this._moveTo(d,u,this._inSelectionMode)});if(o.pushStackElement(),t._getViewModel().setCursorStates("moveWordCommand",Ls.Explicit,c.map(d=>ZSe.fromModelSelection(d))),c.length===1){const d=new _e(c[0].positionLineNumber,c[0].positionColumn);t.revealPosition(d,ji.Smooth)}}_moveTo(e,t,i){return i?new at(e.selectionStartLineNumber,e.selectionStartColumn,t.lineNumber,t.column):new at(t.lineNumber,t.column,t.lineNumber,t.column)}}class kf extends N1{_move(e,t,i,n,o){return gI.moveWordLeft(e,t,i,n,o)}}class Tf extends N1{_move(e,t,i,n,o){return gI.moveWordRight(e,t,i,n)}}class Pqe extends kf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordStart,id:"cursorWordStartLeft",precondition:void 0})}}class Lqe extends kf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordEnd,id:"cursorWordEndLeft",precondition:void 0})}}class Mqe extends kf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordStartFast,id:"cursorWordLeft",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(lI,rN)?.negate()),primary:E.CtrlCmd|S.LeftArrow,mac:{primary:E.Alt|S.LeftArrow},weight:W.EditorContrib}})}}class Nqe extends kf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordStart,id:"cursorWordStartLeftSelect",precondition:void 0})}}class Oqe extends kf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordEnd,id:"cursorWordEndLeftSelect",precondition:void 0})}}class Fqe extends kf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordStartFast,id:"cursorWordLeftSelect",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(lI,rN)?.negate()),primary:E.CtrlCmd|E.Shift|S.LeftArrow,mac:{primary:E.Alt|E.Shift|S.LeftArrow},weight:W.EditorContrib}})}}class Wqe extends kf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordAccessibility,id:"cursorWordAccessibilityLeft",precondition:void 0})}_move(e,t,i,n,o){return super._move(Ov(rI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class Bqe extends kf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordAccessibility,id:"cursorWordAccessibilityLeftSelect",precondition:void 0})}_move(e,t,i,n,o){return super._move(Ov(rI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class Vqe extends Tf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordStart,id:"cursorWordStartRight",precondition:void 0})}}class Hqe extends Tf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordEnd,id:"cursorWordEndRight",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(lI,rN)?.negate()),primary:E.CtrlCmd|S.RightArrow,mac:{primary:E.Alt|S.RightArrow},weight:W.EditorContrib}})}}class Uqe extends Tf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordEnd,id:"cursorWordRight",precondition:void 0})}}class $qe extends Tf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordStart,id:"cursorWordStartRightSelect",precondition:void 0})}}class Gqe extends Tf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordEnd,id:"cursorWordEndRightSelect",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(lI,rN)?.negate()),primary:E.CtrlCmd|E.Shift|S.RightArrow,mac:{primary:E.Alt|E.Shift|S.RightArrow},weight:W.EditorContrib}})}}class qqe extends Tf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordEnd,id:"cursorWordRightSelect",precondition:void 0})}}class zqe extends Tf{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordAccessibility,id:"cursorWordAccessibilityRight",precondition:void 0})}_move(e,t,i,n,o){return super._move(Ov(rI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class Kqe extends Tf{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordAccessibility,id:"cursorWordAccessibilityRightSelect",precondition:void 0})}_move(e,t,i,n,o){return super._move(Ov(rI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class O1 extends No{constructor(e){super(e),this._whitespaceHeuristics=e.whitespaceHeuristics,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,i){const n=e.get(rs);if(!t.hasModel())return;const o=Ov(t.getOption(L.wordSeparators),t.getOption(L.wordSegmenterLocales)),r=t.getModel(),a=t.getSelections(),c=t.getOption(L.autoClosingBrackets),d=t.getOption(L.autoClosingQuotes),l=n.getLanguageConfiguration(r.getLanguageId()).getAutoClosingPairs(),u=t._getViewModel(),g=a.map(m=>{const v=this._delete({wordSeparators:o,model:r,selection:m,whitespaceHeuristics:this._whitespaceHeuristics,autoClosingDelete:t.getOption(L.autoClosingDelete),autoClosingBrackets:c,autoClosingQuotes:d,autoClosingPairs:l,autoClosedCharacters:u.getCursorAutoClosedCharacters()},this._wordNavigationType);return new uI(v,"")});t.pushUndoStop(),t.executeCommands(this.id,g),t.pushUndoStop()}}class B5 extends O1{_delete(e,t){const i=gI.deleteWordLeft(e,t);return i||new P(1,1,1,1)}}class V5 extends O1{_delete(e,t){const i=gI.deleteWordRight(e,t);if(i)return i;const n=e.model.getLineCount(),o=e.model.getLineMaxColumn(n);return new P(n,o,n,o)}}class jqe extends B5{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:An.WordStart,id:"deleteWordStartLeft",precondition:V.writable})}}class Yqe extends B5{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:An.WordEnd,id:"deleteWordEndLeft",precondition:V.writable})}}class Qqe extends B5{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:An.WordStart,id:"deleteWordLeft",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Backspace,mac:{primary:E.Alt|S.Backspace},weight:W.EditorContrib}})}}class Xqe extends V5{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:An.WordStart,id:"deleteWordStartRight",precondition:V.writable})}}class Zqe extends V5{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:An.WordEnd,id:"deleteWordEndRight",precondition:V.writable})}}class Jqe extends V5{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:An.WordEnd,id:"deleteWordRight",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Delete,mac:{primary:E.Alt|S.Delete},weight:W.EditorContrib}})}}class eze extends we{constructor(){super({id:"deleteInsideWord",precondition:V.writable,label:I(1622,"Delete Word")})}run(e,t,i){if(!t.hasModel())return;const n=Ov(t.getOption(L.wordSeparators),t.getOption(L.wordSegmenterLocales)),o=t.getModel(),a=t.getSelections().map(c=>{const d=gI.deleteInsideWord(n,o,c);return new uI(d,"")});t.pushUndoStop(),t.executeCommands(this.id,a),t.pushUndoStop()}}Ue(new Pqe);Ue(new Lqe);Ue(new Mqe);Ue(new Nqe);Ue(new Oqe);Ue(new Fqe);Ue(new Vqe);Ue(new Hqe);Ue(new Uqe);Ue(new $qe);Ue(new Gqe);Ue(new qqe);Ue(new Wqe);Ue(new Bqe);Ue(new zqe);Ue(new Kqe);Ue(new jqe);Ue(new Yqe);Ue(new Qqe);Ue(new Xqe);Ue(new Zqe);Ue(new Jqe);ue(eze);class tze extends O1{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:An.WordStart,id:"deleteWordPartLeft",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.Backspace},weight:W.EditorContrib}})}_delete(e,t){const i=pN.deleteWordPartLeft(e);return i||new P(1,1,1,1)}}class ize extends O1{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:An.WordEnd,id:"deleteWordPartRight",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.Delete},weight:W.EditorContrib}})}_delete(e,t){const i=pN.deleteWordPartRight(e);if(i)return i;const n=e.model.getLineCount(),o=e.model.getLineMaxColumn(n);return new P(n,o,n,o)}}class Vpe extends N1{_move(e,t,i,n,o){return pN.moveWordPartLeft(e,t,i,o)}}class nze extends Vpe{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordStart,id:"cursorWordPartLeft",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.LeftArrow},weight:W.EditorContrib}})}}Ce.registerCommandAlias("cursorWordPartStartLeft","cursorWordPartLeft");class sze extends Vpe{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordStart,id:"cursorWordPartLeftSelect",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|E.Shift|S.LeftArrow},weight:W.EditorContrib}})}}Ce.registerCommandAlias("cursorWordPartStartLeftSelect","cursorWordPartLeftSelect");class Hpe extends N1{_move(e,t,i,n,o){return pN.moveWordPartRight(e,t,i)}}class oze extends Hpe{constructor(){super({inSelectionMode:!1,wordNavigationType:An.WordEnd,id:"cursorWordPartRight",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.RightArrow},weight:W.EditorContrib}})}}class rze extends Hpe{constructor(){super({inSelectionMode:!0,wordNavigationType:An.WordEnd,id:"cursorWordPartRightSelect",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|E.Shift|S.RightArrow},weight:W.EditorContrib}})}}Ue(new tze);Ue(new ize);Ue(new nze);Ue(new sze);Ue(new oze);Ue(new rze);class Jte extends F{static{this.ID="editor.contrib.readOnlyMessageController"}constructor(e){super(),this.editor=e,this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()))}_onDidAttemptReadOnlyEdit(){const e=wr.get(this.editor);if(e&&this.editor.hasModel()){let t=this.editor.getOptions().get(L.readOnlyMessage);t||(this.editor.isSimpleWidget?t=new Ni(h(1429,"Cannot edit in read-only input")):t=new Ni(h(1430,"Cannot edit in read-only editor"))),e.showMessage(t,this.editor.getPosition())}}}Rt(Jte.ID,Jte,vt.BeforeFirstInteraction);let FG=class extends F{constructor(e,t,i){super(),this._textModel=e,this._languageFeaturesService=t,this._outlineModelService=i,this._currentModel=oi(this,void 0);const n=AE("documentSymbolProvider.onDidChange",this._languageFeaturesService.documentSymbolProvider.onDidChange),o=AE("_textModel.onDidChangeContent",D.debounce(r=>this._textModel.onDidChangeContent(r),()=>{},100));this._register(Da(async(r,a)=>{n.read(r),o.read(r);const c=a.add(new eCe),d=await this._outlineModelService.getOrCreate(this._textModel,c.token);a.isDisposed||this._currentModel.set(d,void 0)}))}getBreadcrumbItems(e,t){const i=this._currentModel.read(t);if(!i)return[];const n=i.asListOfDocumentSymbols().filter(o=>e.contains(o.range.startLineNumber)&&!e.contains(o.range.endLineNumber));return n.sort(fwe(ul(o=>o.range.endLineNumber-o.range.startLineNumber,Oh))),n.map(o=>({name:o.name,kind:o.kind,startLineNumber:o.range.startLineNumber}))}};FG=f([p(1,Ne),p(2,kI)],FG);JSe.setBreadcrumbsSourceFactory((s,e)=>e.createInstance(FG,s));const aze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(aze);class eie extends F{static{this.ID="editor.contrib.iPadShowKeyboard"}constructor(e){super(),this.editor=e,this.widget=null,EE&&(this._register(e.onDidChangeConfiguration(()=>this.update())),this.update())}update(){const e=!this.editor.getOption(L.readOnly);!this.widget&&e?this.widget=new H5(this.editor):this.widget&&!e&&(this.widget.dispose(),this.widget=null)}dispose(){super.dispose(),this.widget&&(this.widget.dispose(),this.widget=null)}}class H5 extends F{static{this.ID="editor.contrib.ShowKeyboardWidget"}constructor(e){super(),this.editor=e,this._domNode=document.createElement("textarea"),this._domNode.className="iPadShowKeyboard",this._register(re(this._domNode,"touchstart",t=>{this.editor.focus()})),this._register(re(this._domNode,"focus",t=>{this.editor.focus()})),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}getId(){return H5.ID}getDomNode(){return this._domNode}getPosition(){return{preference:bI.BOTTOM_RIGHT_CORNER}}}Rt(eie.ID,eie,vt.Eventually);const Upe="inQuickOpen",cze=new O(Upe,!1,h(3550,"Whether keyboard focus is inside the quick open control")),Rl=x.has(Upe),dze="inFilesPicker",$pe=x.and(Rl,x.has(dze));function hS(s,e){return t=>{const i=t.get(Ve),n=t.get(zt),r={keybindings:i.lookupKeybindings(s)};n.navigate(!!e,r)}}let tie=class extends F{constructor(e,t){super(),this.editorService=e,this.editorGroupsService=t,this._editorViewState=void 0,this.openedTransientEditors=new Set}set(){if(this._editorViewState)return;const e=this.editorService.activeEditorPane;e&&(this._editorViewState={group:e.group,editor:e.input,state:PCe(e.getControl())?.saveViewState()??void 0})}async openTransientEditor(e,t){e.options={...e.options,transient:!0};const i=await this.editorService.openEditor(e,t);return i?.input&&i.input!==this._editorViewState?.editor&&i.group.isTransient(i.input)&&this.openedTransientEditors.add(i.input),i}async restore(){if(this._editorViewState){for(const e of this.openedTransientEditors)if(!e.isDirty())for(const t of this.editorGroupsService.groups)t.isTransient(e)&&await t.closeEditor(e,{preserveFocus:!0});await this._editorViewState.group.openEditor(this._editorViewState.editor,{viewState:this._editorViewState.state,preserveFocus:!0}),this.reset()}}reset(){this._editorViewState=void 0,this.openedTransientEditors.clear()}dispose(){super.dispose(),this.reset()}};tie=f([p(0,de),p(1,Ie)],tie);let WG=class extends mwe{constructor(e,t,i,n,o,r){super(t,n,o,r,e),this.keybindingService=i,this.inQuickInputContext=cze.bindTo(this.contextKeyService),this.registerListeners()}registerListeners(){this._register(this.onShow(()=>this.inQuickInputContext.set(!0))),this._register(this.onHide(()=>this.inQuickInputContext.set(!1)))}createController(){return super.createController(this.layoutService,{ignoreFocusOut:()=>!this.configurationService.getValue("workbench.quickOpen.closeOnFocusLost"),backKeybindingLabel:()=>this.keybindingService.lookupKeybinding("workbench.action.quickInputBack")?.getLabel()||void 0})}};WG=f([p(0,ne),p(1,J),p(2,Ve),p(3,me),p(4,ft),p(5,df)],WG);function lze(s){const e=new Map;for(const t of s)e.set(t,(e.get(t)??0)+1);return e}class gE{constructor(){this.chunkCount=0,this.chunkOccurrences=new Map,this.documents=new Map}calculateScores(e,t){const i=this.computeEmbedding(e),n=new Map,o=[];for(const[r,a]of this.documents){if(t.isCancellationRequested)return[];for(const c of a.chunks){const d=this.computeSimilarityScore(c,i,n);d>0&&o.push({key:r,score:d})}}return o}static termFrequencies(e){return lze(gE.splitTerms(e))}static*splitTerms(e){const t=i=>i.toLowerCase();for(const[i]of e.matchAll(/\b\p{Letter}[\p{Letter}\d]{2,}\b/gu)){yield t(i);const n=i.replace(/([a-z])([A-Z])/g,"$1 $2").split(/\s+/g);if(n.length>1)for(const o of n)o.length>2&&/\p{Letter}{3,}/gu.test(o)&&(yield t(o))}}updateDocuments(e){for(const{key:t}of e)this.deleteDocument(t);for(const t of e){const i=[];for(const n of t.textChunks){const o=gE.termFrequencies(n);for(const r of o.keys())this.chunkOccurrences.set(r,(this.chunkOccurrences.get(r)??0)+1);i.push({text:n,tf:o})}this.chunkCount+=i.length,this.documents.set(t.key,{chunks:i})}return this}deleteDocument(e){const t=this.documents.get(e);if(t){this.documents.delete(e),this.chunkCount-=t.chunks.length;for(const i of t.chunks)for(const n of i.tf.keys()){const o=this.chunkOccurrences.get(n);if(typeof o=="number"){const r=o-1;r<=0?this.chunkOccurrences.delete(n):this.chunkOccurrences.set(n,r)}}}}computeSimilarityScore(e,t,i){let n=0;for(const[o,r]of Object.entries(t)){const a=e.tf.get(o);if(!a)continue;let c=i.get(o);typeof c!="number"&&(c=this.computeIdf(o),i.set(o,c));const d=a*c;n+=d*r}return n}computeEmbedding(e){const t=gE.termFrequencies(e);return this.computeTfidf(t)}computeIdf(e){const t=this.chunkOccurrences.get(e)??0;return t>0?Math.log((this.chunkCount+1)/t):0}computeTfidf(e){const t=Object.create(null);for(const[i,n]of e){const o=this.computeIdf(i);o>0&&(t[i]=n*o)}return t}}function hze(s){const e=s.slice(0);e.sort((i,n)=>n.score-i.score);const t=e[0]?.score??0;if(t>0)for(const i of e)i.score/=t;return e}var qf,gn;let BG=class extends u4{static{qf=this}static{this.PREFIX=">"}static{this.TFIDF_THRESHOLD=.5}static{this.TFIDF_MAX_RESULTS=5}static{this.WORD_FILTER=tA(Dq,Qg,qq)}constructor(e,t,i,n,o,r){super(qf.PREFIX,e),this.keybindingService=i,this.commandService=n,this.telemetryService=o,this.dialogService=r,this.commandsHistory=this._register(t.createInstance(jx)),this.options=e}async _getPicks(e,t,i,n){const o=await this.getCommandPicks(i);if(i.isCancellationRequested)return[];const r=hw(()=>{const m=new gE;m.updateDocuments(o.map(y=>({key:y.commandId,textChunks:[this.getTfIdfChunk(y)]})));const v=m.calculateScores(e,i);return hze(v).filter(y=>y.score>qf.TFIDF_THRESHOLD).slice(0,qf.TFIDF_MAX_RESULTS)}),a=[];for(const m of o){const v=qf.WORD_FILTER(e,m.label)??void 0,y=m.commandAlias?qf.WORD_FILTER(e,m.commandAlias)??void 0:void 0;if(v||y)m.highlights={label:v,detail:this.options.showAlias?y:void 0},a.push(m);else if(e===m.commandId)a.push(m);else if(e.length>=3){const w=r();if(i.isCancellationRequested)return[];const C=w.find(T=>T.key===m.commandId);C&&(m.tfIdfScore=C.score,a.push(m))}}const c=new Map;for(const m of a){const v=c.get(m.label);v?(m.description=m.commandId,v.description=v.commandId):c.set(m.label,m)}a.sort((m,v)=>{if(m.tfIdfScore&&v.tfIdfScore)return m.tfIdfScore===v.tfIdfScore?m.label.localeCompare(v.label):v.tfIdfScore-m.tfIdfScore;if(m.tfIdfScore)return 1;if(v.tfIdfScore)return-1;const y=this.commandsHistory.peek(m.commandId),w=this.commandsHistory.peek(v.commandId);if(y&&w)return y>w?-1:1;if(y)return-1;if(w)return 1;if(this.options.suggestedCommandIds){const C=this.options.suggestedCommandIds.has(m.commandId),T=this.options.suggestedCommandIds.has(v.commandId);if(C&&T)return 0;if(C)return-1;if(T)return 1}return m.label.localeCompare(v.label)});const d=[];let l=!1,u=!0,g=!!this.options.suggestedCommandIds;for(let m=0;m<a.length;m++){const v=a[m];m===0&&this.commandsHistory.peek(v.commandId)&&(d.push({type:"separator",label:h(1943,"recently used")}),l=!0),u&&v.tfIdfScore!==void 0&&(d.push({type:"separator",label:h(1944,"similar commands")}),u=!1),g&&v.tfIdfScore===void 0&&!this.commandsHistory.peek(v.commandId)&&this.options.suggestedCommandIds?.has(v.commandId)&&(d.push({type:"separator",label:h(1945,"commonly used")}),l=!0,g=!1),l&&v.tfIdfScore===void 0&&!this.commandsHistory.peek(v.commandId)&&!this.options.suggestedCommandIds?.has(v.commandId)&&(d.push({type:"separator",label:h(1946,"other commands")}),l=!1),d.push(this.toCommandPick(v,n))}return this.hasAdditionalCommandPicks(e,i)?{picks:d,additionalPicks:(async()=>{const m=await this.getAdditionalCommandPicks(o,a,e,i);if(i.isCancellationRequested)return[];const v=m.map(y=>this.toCommandPick(y,n));return u&&v[0]?.type!=="separator"&&v.unshift({type:"separator",label:h(1944,"similar commands")}),v})()}:d}toCommandPick(e,t){if(e.type==="separator")return e;const i=this.keybindingService.lookupKeybinding(e.commandId),n=i?h(1947,"{0}, {1}",e.label,i.getAriaLabel()):e.label;return{...e,ariaLabel:n,detail:this.options.showAlias&&e.commandAlias!==e.label?e.commandAlias:void 0,keybinding:i,accept:async()=>{this.commandsHistory.push(e.commandId),this.telemetryService.publicLog2("workbenchActionExecuted",{id:e.commandId,from:t?.from??"quick open"});try{e.args?.length?await this.commandService.executeCommand(e.commandId,...e.args):await this.commandService.executeCommand(e.commandId)}catch(o){gs(o)||this.dialogService.error(h(1948,"Command '{0}' resulted in an error",e.label),ho(o))}}}}getTfIdfChunk({label:e,commandAlias:t,commandDescription:i}){let n=e;return t&&t!==e&&(n+=` - ${t}`),i&&i.value!==e&&(n+=` - ${i.value===i.original?i.value:`${i.value} (${i.original})`}`),n}};BG=qf=f([p(1,J),p(2,Ve),p(3,qe),p(4,li),p(5,Qt)],BG);let jx=class extends F{static{gn=this}static{this.DEFAULT_COMMANDS_HISTORY_LENGTH=50}static{this.PREF_KEY_CACHE="commandPalette.mru.cache"}static{this.PREF_KEY_COUNTER="commandPalette.mru.counter"}static{this.counter=1}static{this.hasChanges=!1}constructor(e,t,i){super(),this.storageService=e,this.configurationService=t,this.logService=i,this.configuredCommandsHistoryLength=0,this.updateConfiguration(),this.load(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e))),this._register(this.storageService.onWillSaveState(e=>{e.reason===Zx.SHUTDOWN&&this.saveState()}))}updateConfiguration(e){e&&!e.affectsConfiguration("workbench.commandPalette.history")||(this.configuredCommandsHistoryLength=gn.getConfiguredCommandHistoryLength(this.configurationService),gn.cache&&gn.cache.limit!==this.configuredCommandsHistoryLength&&(gn.cache.limit=this.configuredCommandsHistoryLength,gn.hasChanges=!0))}load(){const e=this.storageService.get(gn.PREF_KEY_CACHE,he.PROFILE);let t;if(e)try{t=JSON.parse(e)}catch(n){this.logService.error(`[CommandsHistory] invalid data: ${n}`)}const i=gn.cache=new Bm(this.configuredCommandsHistoryLength,1);if(t){let n;t.usesLRU?n=t.entries:n=t.entries.sort((o,r)=>o.value-r.value),n.forEach(o=>i.set(o.key,o.value))}gn.counter=this.storageService.getNumber(gn.PREF_KEY_COUNTER,he.PROFILE,gn.counter)}push(e){gn.cache&&(gn.cache.set(e,gn.counter++),gn.hasChanges=!0)}peek(e){return gn.cache?.peek(e)}saveState(){if(!gn.cache||!gn.hasChanges)return;const e={usesLRU:!0,entries:[]};gn.cache.forEach((t,i)=>e.entries.push({key:i,value:t})),this.storageService.store(gn.PREF_KEY_CACHE,JSON.stringify(e),he.PROFILE,pt.USER),this.storageService.store(gn.PREF_KEY_COUNTER,gn.counter,he.PROFILE,pt.USER),gn.hasChanges=!1}static getConfiguredCommandHistoryLength(e){const i=e.getValue().workbench?.commandPalette?.history;return typeof i=="number"?i:gn.DEFAULT_COMMANDS_HISTORY_LENGTH}static clearHistory(e,t){const i=gn.getConfiguredCommandHistoryLength(e);gn.cache=new Bm(i),gn.counter=1,gn.hasChanges=!0}};jx=gn=f([p(0,tt),p(1,ne),p(2,Pe)],jx);class uze extends BG{constructor(e,t,i,n,o,r){super(e,t,i,n,o,r)}getCodeEditorCommandPicks(){const e=this.activeTextEditorControl;if(!e)return[];const t=[];for(const i of e.getSupportedActions()){let n;i.metadata?.description&&(yse(i.metadata.description)?n=i.metadata.description:n={original:i.metadata.description,value:i.metadata.description}),t.push({commandId:i.id,commandAlias:i.alias,commandDescription:n,label:wse(i.label)||i.id})}return t}}const gze="workbench.action.chat.open",pze="workbench.action.quickchat.toggle";var VG;(function(s){s[s.SymbolInformation=1]="SymbolInformation",s[s.CommandInformation=2]="CommandInformation",s[s.SearchInformation=3]="SearchInformation",s[s.SettingInformation=4]="SettingInformation"})(VG||(VG={}));function fze(s){const e=[],t=new Map,i=(n,o)=>{if(!t.has(n)&&(t.set(n,!0),!(n[0]==="_"||n.indexOf("vscode.")===0)&&s.get(n)!==!0)){if(!o){const r=Ce.getCommand(n);if(r&&typeof r.metadata=="object"&&xn(r.metadata.args))return}e.push(n)}};for(const n of ge.getMenuItems(N.CommandPalette))Nie(n)&&i(n.command.id,!0);for(const n of xE.getEditorActions())i(n.id,!0);for(const n of Ce.getCommands().keys())i(n,!1);return e}var Ac;const uF="keybinding.entry.template",iie=h(12769,"System"),nie=h(12770,"Extension"),sie=h(12771,"User");function mze(s,e){const t=e?` +when:${e}`:"";return`@command:${s}${t}`}const vze=tA(Dq,Qg,qq),_ze=/@command:\s*([^\+]+)/i,bze=/\+when:\s*(.+)/i,oie=/@source:\s*(user|default|system|extension)/i,rie=/@ext:\s*((".+")|([^\s]+))/i,yze=/@keybinding:\s*((\".+\")|(\S+))/i;let aie=Ac=class extends Bv{constructor(e,t,i){super(),this.keybindingsService=t,this.extensionService=i,this._keybindingItems=[],this._keybindingItemsSortedByPrecedence=[],this.modifierLabels={ui:bwe.modifierLabels[e],aria:_we.modifierLabels[e],user:vwe.modifierLabels[e]}}fetch(e,t=!1){let i=t?this._keybindingItemsSortedByPrecedence:this._keybindingItems;const n=_ze.exec(e);if(n&&n[1]){const o=n[1].trim();let r=i.filter(a=>a.command===o);if(r.length){const a=bze.exec(e);if(a&&a[1]){const c=a[1].trim();r=this.filterByWhen(r,o,c)}}return r.map(a=>({id:Ac.getId(a),keybindingItem:a,templateId:uF}))}if(oie.test(e))i=this.filterBySource(i,e),e=e.replace(oie,"");else{const o=rie.exec(e);if(o&&(o[2]||o[3])){const r=o[2]?o[2].substring(1,o[2].length-1):o[3];i=this.filterByExtension(i,r),e=e.replace(rie,"")}else{const r=yze.exec(e);r&&(r[2]||r[3])&&(e=r[2]||`"${r[3]}"`)}}return e=e.trim(),e?this.filterByText(i,e):i.map(o=>({id:Ac.getId(o),keybindingItem:o,templateId:uF}))}filterBySource(e,t){return/@source:\s*default/i.test(t)||/@source:\s*system/i.test(t)?e.filter(i=>i.source===iie):/@source:\s*user/i.test(t)?e.filter(i=>i.source===sie):/@source:\s*extension/i.test(t)?e.filter(i=>!It(i.source)||i.source===nie):e}filterByExtension(e,t){return t=t.toLowerCase().trim(),e.filter(i=>!It(i.source)&&(Es.equals(i.source.identifier,t)||i.source.displayName?.toLowerCase()===t.toLowerCase()))}filterByText(e,t){const i=t.charAt(0)==='"',n=t.charAt(t.length-1)==='"',o=i&&n;i&&(t=t.substring(1)),n&&(t=t.substring(0,t.length-1)),t=t.trim();const r=[],a=t.split(" "),c=this.splitKeybindingWords(a);for(const d of e){const l=new wze(this.modifierLabels,d,t,a,c,o);(l.commandIdMatches||l.commandLabelMatches||l.commandDefaultLabelMatches||l.sourceMatches||l.whenMatches||l.keybindingMatches||l.extensionIdMatches||l.extensionLabelMatches)&&r.push({id:Ac.getId(d),templateId:uF,commandLabelMatches:l.commandLabelMatches||void 0,commandDefaultLabelMatches:l.commandDefaultLabelMatches||void 0,keybindingItem:d,keybindingMatches:l.keybindingMatches||void 0,commandIdMatches:l.commandIdMatches||void 0,sourceMatches:l.sourceMatches||void 0,whenMatches:l.whenMatches||void 0,extensionIdMatches:l.extensionIdMatches||void 0,extensionLabelMatches:l.extensionLabelMatches||void 0})}return r}filterByWhen(e,t,i){if(e.length===0)return[];const n=e.filter(c=>c.when===i);if(n.length)return n;const o=e[0].commandLabel,r=new e6(void 0,t,null,x.deserialize(i),!1,null,!1),a=new Map([[t,o]]);return[Ac.toKeybindingEntry(t,r,a,this.getExtensionsMapping())]}splitKeybindingWords(e){const t=[];for(const i of e)t.push(...Vt(i.split("+")));return t}async resolve(e=new Map){const t=this.getExtensionsMapping();this._keybindingItemsSortedByPrecedence=[];const i=new Map;for(const o of this.keybindingsService.getKeybindings())o.command&&(this._keybindingItemsSortedByPrecedence.push(Ac.toKeybindingEntry(o.command,o,e,t)),i.set(o.command,!0));const n=this.keybindingsService.getDefaultKeybindings().map(o=>o.command);for(const o of fze(i)){const r=new e6(void 0,o,null,void 0,n.indexOf(o)===-1,null,!1);this._keybindingItemsSortedByPrecedence.push(Ac.toKeybindingEntry(o,r,e,t))}return this._keybindingItemsSortedByPrecedence=tI(this._keybindingItemsSortedByPrecedence,o=>Ac.getId(o)),this._keybindingItems=this._keybindingItemsSortedByPrecedence.slice(0).sort((o,r)=>Ac.compareKeybindingData(o,r)),super.resolve()}static getId(e){return e.command+(e?.keybinding?.getAriaLabel()??"")+e.when+(It(e.source)?e.source:e.source.identifier.value)}getExtensionsMapping(){const e=new ko;for(const t of this.extensionService.extensions)e.set(t.identifier,t);return e}static compareKeybindingData(e,t){return e.keybinding&&!t.keybinding?-1:t.keybinding&&!e.keybinding?1:e.commandLabel&&!t.commandLabel?-1:t.commandLabel&&!e.commandLabel?1:e.commandLabel&&t.commandLabel&&e.commandLabel!==t.commandLabel?e.commandLabel.localeCompare(t.commandLabel):e.command===t.command?e.keybindingItem.isDefault?1:-1:e.command.localeCompare(t.command)}static toKeybindingEntry(e,t,i,n){const o=ge.getCommand(e),r=i.get(e);let a=sie;if(t.isDefault){const c=t.extensionId??(t.resolvedKeybinding?void 0:o?.source?.id);a=c?n.get(c)??nie:iie}return{keybinding:t.resolvedKeybinding,keybindingItem:t,command:e,commandLabel:Ac.getCommandLabel(o,r),commandDefaultLabel:Ac.getCommandDefaultLabel(o),when:t.when?t.when.serialize():"",source:a}}static getCommandDefaultLabel(e){if(!BT.isDefaultVariant()&&e&&e.title&&e.title.original){const t=e.category?e.category.original:void 0,i=e.title.original;return t?h(12772,"{0}: {1}",t,i):i}return null}static getCommandLabel(e,t){if(e){const i=e.category?typeof e.category=="string"?e.category:e.category.value:void 0,n=typeof e.title=="string"?e.title:e.title.value;return i?h(12772,"{0}: {1}",i,n):n}return t||""}};aie=Ac=f([p(1,Ve),p(2,hn)],aie);class wze{constructor(e,t,i,n,o,r){this.modifierLabels=e,this.commandIdMatches=null,this.commandLabelMatches=null,this.commandDefaultLabelMatches=null,this.sourceMatches=null,this.whenMatches=null,this.keybindingMatches=null,this.extensionIdMatches=null,this.extensionLabelMatches=null,r||(this.commandIdMatches=this.matches(i,t.command,tA(Qg,t6),n),this.commandLabelMatches=t.commandLabel?this.matches(i,t.commandLabel,(a,c)=>Qg(a,t.commandLabel,!0),n):null,this.commandDefaultLabelMatches=t.commandDefaultLabel?this.matches(i,t.commandDefaultLabel,(a,c)=>Qg(a,t.commandDefaultLabel,!0),n):null,this.whenMatches=t.when?this.matches(null,t.when,tA(Qg,t6),n):null,It(t.source)?this.sourceMatches=this.matches(i,t.source,(a,c)=>Qg(a,t.source,!0),n):this.extensionLabelMatches=t.source.displayName?this.matches(i,t.source.displayName,(a,c)=>Qg(a,t.commandLabel,!0),n):null),this.keybindingMatches=t.keybinding?this.matchesKeybinding(t.keybinding,i,o,r):null}matches(e,t,i,n){let o=e?vze(e,t):null;return o||(o=this.matchesWords(n,t,i)),o&&(o=this.filterAndSort(o)),o}matchesWords(e,t,i){let n=[];for(const o of e){const r=i(o,t);if(r)n=[...n||[],...r];else{n=null;break}}return n}filterAndSort(e){return tI(e,t=>t.start+"."+t.end).filter(t=>!e.some(i=>!(i.start===t.start&&i.end===t.end)&&i.start<=t.start&&i.end>=t.end)).sort((t,i)=>t.start-i.start)}matchesKeybinding(e,t,i,n){const[o,r]=e.getChords(),a=e.getUserSettingsLabel(),c=e.getAriaLabel(),d=e.getLabel();if(a&&RS(t,a)===0||c&&RS(t,c)===0||d&&RS(t,d)===0)return{firstPart:this.createCompleteMatch(o),chordPart:this.createCompleteMatch(r)};const l={};let u={};const g=[],m=[];let v=[],y=!0;for(let w=0;w<i.length;w++){const C=i[w];let T=!1,k=!1;y=y&&!l.keyCode;let A=!u.keyCode;if(y&&(T=this.matchPart(o,l,C,n),l.keyCode)){for(const B of v)m.indexOf(B)===-1&&g.splice(g.indexOf(B),1);u={},v=[],A=!1}A&&(k=this.matchPart(r,u,C,n)),T&&m.push(w),k&&v.push(w),(T||k)&&g.push(w),y=y&&this.isModifier(C)}return g.length!==i.length||n&&(!this.isCompleteMatch(o,l)||!FT(u)&&!this.isCompleteMatch(r,u))?null:this.hasAnyMatch(l)||this.hasAnyMatch(u)?{firstPart:l,chordPart:u}:null}matchPart(e,t,i,n){let o=!1;return this.matchesMetaModifier(e,i)&&(o=!0,t.metaKey=!0),this.matchesCtrlModifier(e,i)&&(o=!0,t.ctrlKey=!0),this.matchesShiftModifier(e,i)&&(o=!0,t.shiftKey=!0),this.matchesAltModifier(e,i)&&(o=!0,t.altKey=!0),this.matchesKeyCode(e,i,n)&&(t.keyCode=!0,o=!0),o}matchesKeyCode(e,t,i){if(!e)return!1;const n=e.keyAriaLabel||"";if(i||n.length===1||t.length===1){if(RS(n,t)===0)return!0}else if(qq(t,n))return!0;return!1}matchesMetaModifier(e,t){return!e||!e.metaKey?!1:this.wordMatchesMetaModifier(t)}matchesCtrlModifier(e,t){return!e||!e.ctrlKey?!1:this.wordMatchesCtrlModifier(t)}matchesShiftModifier(e,t){return!e||!e.shiftKey?!1:this.wordMatchesShiftModifier(t)}matchesAltModifier(e,t){return!e||!e.altKey?!1:this.wordMatchesAltModifier(t)}hasAnyMatch(e){return!!e.altKey||!!e.ctrlKey||!!e.metaKey||!!e.shiftKey||!!e.keyCode}isCompleteMatch(e,t){return e?!(!t.keyCode||e.metaKey&&!t.metaKey||e.altKey&&!t.altKey||e.ctrlKey&&!t.ctrlKey||e.shiftKey&&!t.shiftKey):!0}createCompleteMatch(e){const t={};return e&&(t.keyCode=!0,e.metaKey&&(t.metaKey=!0),e.altKey&&(t.altKey=!0),e.ctrlKey&&(t.ctrlKey=!0),e.shiftKey&&(t.shiftKey=!0)),t}isModifier(e){return!!(this.wordMatchesAltModifier(e)||this.wordMatchesCtrlModifier(e)||this.wordMatchesMetaModifier(e)||this.wordMatchesShiftModifier(e))}wordMatchesAltModifier(e){return!!(Xs(this.modifierLabels.ui.altKey,e)||Xs(this.modifierLabels.aria.altKey,e)||Xs(this.modifierLabels.user.altKey,e)||Xs(h(12773,"option"),e))}wordMatchesCtrlModifier(e){return!!(Xs(this.modifierLabels.ui.ctrlKey,e)||Xs(this.modifierLabels.aria.ctrlKey,e)||Xs(this.modifierLabels.user.ctrlKey,e))}wordMatchesMetaModifier(e){return!!(Xs(this.modifierLabels.ui.metaKey,e)||Xs(this.modifierLabels.aria.metaKey,e)||Xs(this.modifierLabels.user.metaKey,e)||Xs(h(12774,"meta"),e))}wordMatchesShiftModifier(e){return!!(Xs(this.modifierLabels.ui.shiftKey,e)||Xs(this.modifierLabels.aria.shiftKey,e)||Xs(this.modifierLabels.user.shiftKey,e))}}var IT;let xv=class extends uze{static{IT=this}static{this.AI_RELATED_INFORMATION_MAX_PICKS=5}static{this.AI_RELATED_INFORMATION_DEBOUNCE=200}get activeTextEditorControl(){return this.editorService.activeTextEditorControl}get defaultFilterValue(){if(this.configuration.preserveInput)return ywe.LAST}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super({showAlias:!BT.isDefaultVariant(),noResultsPick:()=>({label:h(9087,"No matching commands"),commandId:""})},n,o,r,a,c),this.editorService=e,this.menuService=t,this.configurationService=d,this.editorGroupService=l,this.preferencesService=u,this.productService=g,this.aiRelatedInformationService=m,this.chatAgentService=v,this.useAiRelatedInfo=!1,this.extensionRegistrationRace=Bq(i.whenInstalledExtensionsRegistered(),800),this._register(d.onDidChangeConfiguration(y=>this.updateOptions(y))),this.updateOptions()}get configuration(){const e=this.configurationService.getValue().workbench.commandPalette;return{preserveInput:e.preserveInput,experimental:e.experimental}}updateOptions(e){if(e&&!e.affectsConfiguration("workbench.commandPalette.experimental"))return;const t=this.configuration,i=t.experimental.suggestCommands&&this.productService.commandPaletteSuggestedCommandIds?.length?new Set(this.productService.commandPaletteSuggestedCommandIds):void 0;this.options.suggestedCommandIds=i,this.useAiRelatedInfo=t.experimental.enableNaturalLanguageSearch}async getCommandPicks(e){return await this.extensionRegistrationRace,e.isCancellationRequested?[]:[...this.getCodeEditorCommandPicks(),...this.getGlobalCommandPicks()].map(t=>({...t,buttons:[{iconClass:Te.asClassName(j.gear),tooltip:h(9088,"Configure Keybinding")}],trigger:()=>(this.preferencesService.openGlobalKeybindingSettings(!1,{query:mze(t.commandId,t.commandWhen)}),Du.CLOSE_PICKER)}))}hasAdditionalCommandPicks(e,t){return!(!this.useAiRelatedInfo||t.isCancellationRequested||e===""||!this.aiRelatedInformationService.isEnabled())}async getAdditionalCommandPicks(e,t,i,n){if(!this.hasAdditionalCommandPicks(i,n))return[];let o;try{await Ia(IT.AI_RELATED_INFORMATION_DEBOUNCE,n),o=await this.getRelatedInformationPicks(e,t,i,n)}catch{return[]}(t.length||o.length)&&o.push({type:"separator"});const r=this.chatAgentService.getDefaultAgent(Vi.Panel);return r&&o.push({label:h(9089,"Ask {0}: {1}",r.fullName,i),commandId:this.configuration.experimental.askChatLocation==="quickChat"?pze:gze,args:[i]}),o}async getRelatedInformationPicks(e,t,i,n){const o=await this.aiRelatedInformationService.getRelatedInformation(i,[VG.CommandInformation],n);o.sort((c,d)=>d.weight-c.weight);const r=new Set(t.map(c=>c.commandId)),a=new Array;for(const c of o){if(a.length===IT.AI_RELATED_INFORMATION_MAX_PICKS)break;const d=e.find(l=>l.commandId===c.command&&!r.has(l.commandId));d&&a.push(d)}return a}getGlobalCommandPicks(){const e=[],t=this.editorService.activeEditorPane?.scopedContextKeyService||this.editorGroupService.activeGroup.scopedContextKeyService,n=this.menuService.getMenuActions(N.CommandPalette,t).reduce((o,[,r])=>[...o,...r],[]).filter(o=>o instanceof va&&o.enabled);for(const o of n){let r=(typeof o.item.title=="string"?o.item.title:o.item.title.value)||o.item.id;const a=typeof o.item.category=="string"?o.item.category:o.item.category?.value;a&&(r=h(9090,"{0}: {1}",a,r));const c=typeof o.item.title!="string"?o.item.title.original:void 0,d=a&&o.item.category&&typeof o.item.category!="string"?o.item.category.original:void 0,l=c&&a?d?`${d}: ${c}`:`${a}: ${c}`:c,u=o.item.metadata?.description,g=u===void 0||yse(u)?u:{value:u,original:u};e.push({commandId:o.item.id,commandWhen:o.item.precondition?.serialize(),commandAlias:l,label:wse(r),commandDescription:g})}return e}};xv=IT=f([p(0,de),p(1,tn),p(2,hn),p(3,J),p(4,Ve),p(5,qe),p(6,li),p(7,Qt),p(8,ne),p(9,Ie),p(10,Fv),p(11,Fn),p(12,kz),p(13,ff)],xv);class Af extends X{static{this.ID="workbench.action.showCommands"}constructor(){super({id:Af.ID,title:I(9091,"Show All Commands"),keybinding:{weight:W.WorkbenchContrib,when:void 0,primary:XM?void 0:E.CtrlCmd|E.Shift|S.KeyP,secondary:[S.F1]},f1:!0})}async run(e){e.get(zt).quickAccess.show(xv.PREFIX)}}class Sze extends X{constructor(){super({id:"workbench.action.clearCommandHistory",title:I(9092,"Clear Command History"),f1:!0})}async run(e){const t=e.get(ne),i=e.get(tt),n=e.get(Qt);if(jx.getConfiguredCommandHistoryLength(t)>0){const{confirmed:r}=await n.confirm({type:"warning",message:h(9093,"Do you want to clear the history of recently used commands?"),detail:h(9094,"This action is irreversible!"),primaryButton:h(9095,"&&Clear")});if(!r)return;jx.clearHistory(t,i)}}}class Gpe{constructor(e){this.options=e,this.rangeHighlightDecorationId=void 0}provide(e,t,i){const n=new U;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;const o=n.add(new kt);return o.value=this.doProvide(e,t,i),n.add(this.onDidActiveTextEditorControlChange(()=>{o.value=void 0,o.value=this.doProvide(e,t)})),n}doProvide(e,t,i){const n=new U,o=this.activeTextEditorControl;if(o&&this.canProvideWithTextEditor(o)){const r={editor:o},a=vw(o);if(a){let c=o.saveViewState()??void 0;n.add(a.onDidChangeCursorPosition(()=>{c=o.saveViewState()??void 0})),r.restoreViewState=()=>{c&&o===this.activeTextEditorControl&&o.restoreViewState(c)},n.add(hw(t.onCancellationRequested)(()=>r.restoreViewState?.()))}n.add(Ee(()=>this.clearDecorations(o))),n.add(this.provideWithTextEditor(r,e,t,i))}else n.add(this.provideWithoutTextEditor(e,t));return n}canProvideWithTextEditor(e){return!0}gotoLocation({editor:e},t){e.setSelection(t.range,sd.JUMP),e.revealRangeInCenter(t.range,ji.Smooth),t.preserveFocus||e.focus();const i=e.getModel();i&&"getLineContent"in i&&Kc(`${i.getLineContent(t.range.startLineNumber)}`)}getModel(e){return $p(e)?e.getModel()?.modified:e.getModel()}addDecorations(e,t){e.changeDecorations(i=>{const n=[];this.rangeHighlightDecorationId&&(n.push(this.rangeHighlightDecorationId.overviewRulerDecorationId),n.push(this.rangeHighlightDecorationId.rangeHighlightId),this.rangeHighlightDecorationId=void 0);const o=[{range:t,options:{description:"quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:t,options:{description:"quick-access-range-highlight-overview",overviewRuler:{color:es(pse),position:ol.Full}}}],[r,a]=i.deltaDecorations(n,o);this.rangeHighlightDecorationId={rangeHighlightId:r,overviewRulerDecorationId:a}})}clearDecorations(e){const t=this.rangeHighlightDecorationId;t&&(e.changeDecorations(i=>{i.deltaDecorations([t.overviewRulerDecorationId,t.rangeHighlightId],[])}),this.rangeHighlightDecorationId=void 0)}}class F1 extends Gpe{static{this.PREFIX=":"}constructor(){super({canAcceptInBackground:!0})}provideWithoutTextEditor(e){const t=h(1392,"Open a text editor first to go to a line.");return e.items=[{label:t}],e.ariaLabel=t,F.None}provideWithTextEditor(e,t,i){const n=e.editor,o=new U;o.add(t.onDidAccept(c=>{const[d]=t.selectedItems;if(d){if(!this.isValidLineNumber(n,d.lineNumber))return;this.gotoLocation(e,{range:this.toRange(d.lineNumber,d.column),keyMods:t.keyMods,preserveFocus:c.inBackground}),c.inBackground||t.hide()}}));const r=()=>{const c=this.parsePosition(n,t.value.trim().substr(F1.PREFIX.length)),d=this.getPickLabel(n,c.lineNumber,c.column);if(t.items=[{lineNumber:c.lineNumber,column:c.column,label:d}],t.ariaLabel=d,!this.isValidLineNumber(n,c.lineNumber)){this.clearDecorations(n);return}const l=this.toRange(c.lineNumber,c.column);n.revealRangeInCenter(l,ji.Smooth),this.addDecorations(n,l)};r(),o.add(t.onDidChangeValue(()=>r()));const a=vw(n);return a&&a.getOptions().get(L.lineNumbers).renderType===cs.Relative&&(a.updateOptions({lineNumbers:"on"}),o.add(Ee(()=>a.updateOptions({lineNumbers:"relative"})))),o}toRange(e=1,t=1){return{startLineNumber:e,startColumn:t,endLineNumber:e,endColumn:t}}parsePosition(e,t){const i=t.split(/,|:|#/).map(o=>parseInt(o,10)).filter(o=>!isNaN(o)),n=this.lineCount(e)+1;return{lineNumber:i[0]>0?i[0]:n+i[0],column:i[1]}}getPickLabel(e,t,i){if(this.isValidLineNumber(e,t))return this.isValidColumn(e,t,i)?h(1393,"Go to line {0} and character {1}.",t,i):h(1394,"Go to line {0}.",t);const n=e.getPosition()||{lineNumber:1,column:1},o=this.lineCount(e);return o>1?h(1395,"Current Line: {0}, Character: {1}. Type a line number between 1 and {2} to navigate to.",n.lineNumber,n.column,o):h(1396,"Current Line: {0}, Character: {1}. Type a line number to navigate to.",n.lineNumber,n.column)}isValidLineNumber(e,t){return!t||typeof t!="number"?!1:t>0&&t<=this.lineCount(e)}isValidColumn(e,t,i){if(!i||typeof i!="number")return!1;const n=this.getModel(e);if(!n)return!1;const o={lineNumber:t,column:i};return n.validatePosition(o).equals(o)}lineCount(e){return this.getModel(e)?.getLineCount()??0}}let bM=class extends F1{constructor(e,t,i){super(),this.editorService=e,this.editorGroupService=t,this.configurationService=i,this.onDidActiveTextEditorControlChange=this.editorService.onDidActiveEditorChange}get configuration(){const e=this.configurationService.getValue().workbench?.editor;return{openEditorPinned:!e?.enablePreviewFromQuickOpen||!e?.enablePreview}}get activeTextEditorControl(){return this.editorService.activeTextEditorControl}gotoLocation(e,t){if((t.keyMods.alt||this.configuration.openEditorPinned&&t.keyMods.ctrlCmd||t.forceSideBySide)&&this.editorService.activeEditor){e.restoreViewState?.();const i={selection:t.range,pinned:t.keyMods.ctrlCmd||this.configuration.openEditorPinned,preserveFocus:t.preserveFocus};this.editorGroupService.sideGroup.openEditor(this.editorService.activeEditor,i)}else super.gotoLocation(e,t)}};bM=f([p(0,de),p(1,Ie),p(2,ne)],bM);class W1 extends X{static{this.ID="workbench.action.gotoLine"}constructor(){super({id:W1.ID,title:I(5284,"Go to Line/Column..."),f1:!0,keybinding:{weight:W.WorkbenchContrib,when:null,primary:E.CtrlCmd|S.KeyG,mac:{primary:E.WinCtrl|S.KeyG}}})}async run(e){e.get(zt).quickAccess.show(bM.PREFIX)}}K(W1);Ge.as(aN.Quickaccess).registerQuickAccessProvider({ctor:bM,prefix:F1.PREFIX,placeholder:h(5285,"Type the line number and optional column to go to (e.g. 42:5 for line 42 and column 5)."),helpEntries:[{description:h(5286,"Go to Line/Column"),commandId:W1.ID}]});var DT;let Wm=class extends Gpe{static{DT=this}static{this.PREFIX="@"}static{this.SCOPE_PREFIX=":"}static{this.PREFIX_BY_CATEGORY=`${this.PREFIX}${this.SCOPE_PREFIX}`}constructor(e,t,i=Object.create(null)){super(i),this._languageFeaturesService=e,this._outlineModelService=t,this.options=i,this.options.canAcceptInBackground=!0}provideWithoutTextEditor(e){return this.provideLabelPick(e,h(1397,"To go to a symbol, first open a text editor with symbol information.")),F.None}provideWithTextEditor(e,t,i,n){const o=e.editor,r=this.getModel(o);return r?this._languageFeaturesService.documentSymbolProvider.has(r)?this.doProvideWithEditorSymbols(e,r,t,i,n):this.doProvideWithoutEditorSymbols(e,r,t,i):F.None}doProvideWithoutEditorSymbols(e,t,i,n){const o=new U;return this.provideLabelPick(i,h(1398,"The active text editor does not provide symbol information.")),(async()=>!await this.waitForLanguageSymbolRegistry(t,o)||n.isCancellationRequested||o.add(this.doProvideWithEditorSymbols(e,t,i,n)))(),o}provideLabelPick(e,t){e.items=[{label:t,index:0,kind:Et.String}],e.ariaLabel=t}async waitForLanguageSymbolRegistry(e,t){if(this._languageFeaturesService.documentSymbolProvider.has(e))return!0;const i=new Zo,n=t.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>{this._languageFeaturesService.documentSymbolProvider.has(e)&&(n.dispose(),i.complete(!0))}));return t.add(Ee(()=>i.complete(!1))),i.p}doProvideWithEditorSymbols(e,t,i,n,o){const r=e.editor,a=new U;a.add(i.onDidAccept(u=>{const[g]=i.selectedItems;g&&g.range&&(this.gotoLocation(e,{range:g.range.selection,keyMods:i.keyMods,preserveFocus:u.inBackground}),o?.handleAccept?.(g,u.inBackground),u.inBackground||i.hide())})),a.add(i.onDidTriggerItemButton(({item:u})=>{u&&u.range&&(this.gotoLocation(e,{range:u.range.selection,keyMods:i.keyMods,forceSideBySide:!0}),i.hide())}));const c=this.getDocumentSymbols(t,n),d=a.add(new kt),l=async u=>{d?.value?.cancel(),i.busy=!1,d.value=new ri,i.busy=!0;try{const g=yx(i.value.substr(DT.PREFIX.length).trim()),m=await this.doGetSymbolPicks(c,g,void 0,d.value.token,t);if(n.isCancellationRequested)return;if(m.length>0){if(i.items=m,u&&g.original.length===0){const v=GM(m,y=>!!(y.type!=="separator"&&y.range&&P.containsPosition(y.range.decoration,u)));v&&(i.activeItems=[v])}}else g.original.length>0?this.provideLabelPick(i,h(1399,"No matching editor symbols")):this.provideLabelPick(i,h(1400,"No editor symbols"))}finally{n.isCancellationRequested||(i.busy=!1)}};return a.add(i.onDidChangeValue(()=>l(void 0))),l(r.getSelection()?.getPosition()),a.add(i.onDidChangeActive(()=>{const[u]=i.activeItems;u&&u.range&&(r.revealRangeInCenter(u.range.selection,ji.Smooth),this.addDecorations(r,u.range.decoration))})),a}async doGetSymbolPicks(e,t,i,n,o){const r=await e;if(n.isCancellationRequested)return[];const a=t.original.indexOf(DT.SCOPE_PREFIX)===0,c=a?1:0;let d,l;t.values&&t.values.length>1?(d=bZ(t.values[0]),l=bZ(t.values.slice(1))):d=t;let u;const g=this.options?.openSideBySideDirection?.();g&&(u=[{iconClass:g==="right"?Te.asClassName(j.splitHorizontal):Te.asClassName(j.splitVertical),tooltip:g==="right"?h(1401,"Open to the Side"):h(1402,"Open to the Bottom")}]);const m=[];for(let w=0;w<r.length;w++){const C=r[w],T=Aq(C.name),k=`$(${_ne.toIcon(C.kind).id}) ${T}`,A=k.length-T.length;let B=C.containerName;i?.extraContainerLabel&&(B?B=`${i.extraContainerLabel} • ${B}`:B=i.extraContainerLabel);let z,Q,ie,oe;if(t.original.length>c){let Se=!1;if(d!==t&&([z,Q]=B0(k,{...t,values:void 0},c,A),typeof z=="number"&&(Se=!0)),typeof z!="number"&&([z,Q]=B0(k,d,c,A),typeof z!="number"))continue;if(!Se&&l){if(B&&l.original.length>0&&([ie,oe]=B0(B,l)),typeof ie!="number")continue;typeof z=="number"&&(z+=ie)}}const xe=C.tags&&C.tags.indexOf(yF.Deprecated)>=0;m.push({index:w,kind:C.kind,score:z,label:k,ariaLabel:wwe(C.name,C.kind),description:B,highlights:xe?void 0:{label:Q,description:oe},range:{selection:P.collapseToStart(C.selectionRange),decoration:C.range},uri:o.uri,symbolName:T,strikethrough:xe,buttons:u})}const v=m.sort((w,C)=>a?this.compareByKindAndScore(w,C):this.compareByScore(w,C));let y=[];if(a){let k=function(){C&&typeof w=="number"&&T>0&&(C.label=Eq(pF[w]||gF,T))},w,C,T=0;for(const A of v)w!==A.kind?(k(),w=A.kind,T=1,C={type:"separator"},y.push(C)):T++,y.push(A);k()}else v.length>0&&(y=[{label:h(1403,"symbols ({0})",m.length),type:"separator"},...v]);return y}compareByScore(e,t){if(typeof e.score!="number"&&typeof t.score=="number")return 1;if(typeof e.score=="number"&&typeof t.score!="number")return-1;if(typeof e.score=="number"&&typeof t.score=="number"){if(e.score>t.score)return-1;if(e.score<t.score)return 1}return e.index<t.index?-1:e.index>t.index?1:0}compareByKindAndScore(e,t){const i=pF[e.kind]||gF,n=pF[t.kind]||gF,o=i.localeCompare(n);return o===0?this.compareByScore(e,t):o}async getDocumentSymbols(e,t){const i=await this._outlineModelService.getOrCreate(e,t);return t.isCancellationRequested?[]:i.asListOfDocumentSymbols()}};Wm=DT=f([p(0,Ne),p(1,kI)],Wm);const gF=h(1404,"properties ({0})"),pF={[Et.Method]:h(1405,"methods ({0})"),[Et.Function]:h(1406,"functions ({0})"),[Et.Constructor]:h(1407,"constructors ({0})"),[Et.Variable]:h(1408,"variables ({0})"),[Et.Class]:h(1409,"classes ({0})"),[Et.Struct]:h(1410,"structs ({0})"),[Et.Event]:h(1411,"events ({0})"),[Et.Operator]:h(1412,"operators ({0})"),[Et.Interface]:h(1413,"interfaces ({0})"),[Et.Namespace]:h(1414,"namespaces ({0})"),[Et.Package]:h(1415,"packages ({0})"),[Et.TypeParameter]:h(1416,"type parameters ({0})"),[Et.Module]:h(1417,"modules ({0})"),[Et.Property]:h(1404,"properties ({0})"),[Et.Enum]:h(1418,"enumerations ({0})"),[Et.EnumMember]:h(1419,"enumeration members ({0})"),[Et.String]:h(1420,"strings ({0})"),[Et.File]:h(1421,"files ({0})"),[Et.Array]:h(1422,"arrays ({0})"),[Et.Number]:h(1423,"numbers ({0})"),[Et.Boolean]:h(1424,"booleans ({0})"),[Et.Object]:h(1425,"objects ({0})"),[Et.Key]:h(1426,"keys ({0})"),[Et.Field]:h(1427,"fields ({0})"),[Et.Constant]:h(1428,"constants ({0})")};var HG;let yM=class extends Wm{static{HG=this}constructor(e,t,i,n,o,r){super(n,r,{openSideBySideDirection:()=>this.configuration.openSideBySideDirection}),this.editorService=e,this.editorGroupService=t,this.configurationService=i,this.outlineService=o,this.onDidActiveTextEditorControlChange=this.editorService.onDidActiveEditorChange}get configuration(){const e=this.configurationService.getValue().workbench?.editor;return{openEditorPinned:!e?.enablePreviewFromQuickOpen||!e?.enablePreview,openSideBySideDirection:e?.openSideBySideDirection}}get activeTextEditorControl(){if(!iA(this.editorService.activeEditorPane?.getControl()))return this.editorService.activeTextEditorControl}gotoLocation(e,t){if((t.keyMods.alt||this.configuration.openEditorPinned&&t.keyMods.ctrlCmd||t.forceSideBySide)&&this.editorService.activeEditor){e.restoreViewState?.();const i={selection:t.range,pinned:t.keyMods.ctrlCmd||this.configuration.openEditorPinned,preserveFocus:t.preserveFocus};this.editorGroupService.sideGroup.openEditor(this.editorService.activeEditor,i)}else super.gotoLocation(e,t)}static{this.SYMBOL_PICKS_TIMEOUT=8e3}async getSymbolPicks(e,t,i,n,o){return!await Promise.race([this.waitForLanguageSymbolRegistry(e,n),Ia(HG.SYMBOL_PICKS_TIMEOUT)])||o.isCancellationRequested?[]:this.doGetSymbolPicks(this.getDocumentSymbols(e,o),yx(t),i,o,e)}provideWithoutTextEditor(e){return this.canPickWithOutlineService()?this.doGetOutlinePicks(e):super.provideWithoutTextEditor(e)}canPickWithOutlineService(){return this.editorService.activeEditorPane?this.outlineService.canCreateOutline(this.editorService.activeEditorPane):!1}doGetOutlinePicks(e){const t=this.editorService.activeEditorPane;if(!t)return F.None;const i=new ri,n=new U;return n.add(Ee(()=>i.dispose(!0))),e.busy=!0,this.outlineService.createOutline(t,HP.QuickPick,i.token).then(o=>{if(!o)return;if(i.token.isCancellationRequested){o.dispose();return}n.add(o);const r=o.captureViewState();n.add(Ee(()=>{e.selectedItems.length===0&&r.dispose()}));const a=o.config.quickPickDataSource.getQuickPickElements(),c=a.map((u,g)=>({kind:Et.File,index:g,score:0,label:u.label,description:u.description,ariaLabel:u.ariaLabel,iconClasses:u.iconClasses}));n.add(e.onDidAccept(()=>{e.hide();const[u]=e.selectedItems;u&&a[u.index]&&o.reveal(a[u.index].element,{},!1,!1)}));const d=()=>{const u=c.filter(g=>{if(e.value==="@")return g.score=0,g.highlights=void 0,!0;const m=e.value.substring(Wm.PREFIX.length).trim(),v=Swe(g.label),y=Sq(m,m.toLowerCase(),0,v.text,v.text.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return y?(g.score=y[1],g.highlights={label:Cwe(m,v)??void 0},!0):!1});if(u.length===0){const g=h(5287,"No matching entries");e.items=[{label:g,index:-1,kind:Et.String}],e.ariaLabel=g}else e.items=u};d(),n.add(e.onDidChangeValue(d));const l=new kt;n.add(l),n.add(e.onDidChangeActive(()=>{const[u]=e.activeItems;u&&a[u.index]?l.value=o.preview(a[u.index].element):l.clear()}))}).catch(o=>{mt(o),e.hide()}).finally(()=>{e.busy=!1}),n}};yM=HG=f([p(0,de),p(1,Ie),p(2,ne),p(3,Ne),p(4,Pz),p(5,kI)],yM);class B1 extends X{static{this.ID="workbench.action.gotoSymbol"}constructor(){super({id:B1.ID,title:{...I(5288,"Go to Symbol in Editor..."),mnemonicTitle:h(5289,"Go to &&Symbol in Editor...")},f1:!0,keybinding:{when:x.and(Ta.negate(),dg.negate()),weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.KeyO},menu:[{id:N.MenubarGoMenu,group:"4_symbol_nav",order:1}]})}run(e){e.get(zt).quickAccess.show(yM.PREFIX,{itemActivation:fw.NONE})}}K(B1);Ge.as(aN.Quickaccess).registerQuickAccessProvider({ctor:yM,prefix:Wm.PREFIX,contextKey:"inFileSymbolsPicker",placeholder:h(5290,"Type the name of a symbol to go to."),helpEntries:[{description:h(5291,"Go to Symbol in Editor"),prefix:Wm.PREFIX,commandId:B1.ID,commandCenterOrder:40},{description:h(5292,"Go to Symbol in Editor by Category"),prefix:Wm.PREFIX_BY_CATEGORY}]});const qu={primary:E.CtrlCmd|S.KeyP,secondary:[E.CtrlCmd|S.KeyE],mac:{primary:E.CtrlCmd|S.KeyP,secondary:void 0}};Le.registerCommandAndKeybindingRule({id:"workbench.action.closeQuickOpen",weight:W.WorkbenchContrib,when:Rl,primary:S.Escape,secondary:[E.Shift|S.Escape],handler:s=>s.get(zt).cancel()});Le.registerCommandAndKeybindingRule({id:"workbench.action.acceptSelectedQuickOpenItem",weight:W.WorkbenchContrib,when:Rl,primary:0,handler:s=>s.get(zt).accept()});Le.registerCommandAndKeybindingRule({id:"workbench.action.alternativeAcceptSelectedQuickOpenItem",weight:W.WorkbenchContrib,when:Rl,primary:0,handler:s=>s.get(zt).accept({ctrlCmd:!0,alt:!1})});Le.registerCommandAndKeybindingRule({id:"workbench.action.focusQuickOpen",weight:W.WorkbenchContrib,when:Rl,primary:0,handler:s=>{s.get(zt).focus()}});const cie="workbench.action.quickOpenNavigateNextInFilePicker";Le.registerCommandAndKeybindingRule({id:cie,weight:W.WorkbenchContrib+50,handler:hS(cie,!0),when:$pe,primary:qu.primary,secondary:qu.secondary,mac:qu.mac});const die="workbench.action.quickOpenNavigatePreviousInFilePicker";Le.registerCommandAndKeybindingRule({id:die,weight:W.WorkbenchContrib+50,handler:hS(die,!1),when:$pe,primary:qu.primary|E.Shift,secondary:[qu.secondary[0]|E.Shift],mac:{primary:qu.mac.primary|E.Shift,secondary:void 0}});Le.registerCommandAndKeybindingRule({id:"workbench.action.quickPickManyToggle",weight:W.WorkbenchContrib,when:Rl,primary:0,handler:s=>{s.get(zt).toggle()}});Le.registerCommandAndKeybindingRule({id:"workbench.action.quickInputBack",weight:W.WorkbenchContrib+50,when:Rl,primary:0,win:{primary:E.Alt|S.LeftArrow},mac:{primary:E.WinCtrl|S.Minus},linux:{primary:E.CtrlCmd|E.Alt|S.Minus},handler:s=>{s.get(zt).back()}});K(class extends X{constructor(){super({id:"workbench.action.quickOpen",title:I(2780,"Go to File..."),metadata:{description:"Quick access",args:[{name:"prefix",schema:{type:"string"}}]},keybinding:{weight:W.WorkbenchContrib,primary:qu.primary,secondary:qu.secondary,mac:qu.mac},f1:!0})}run(e,t){e.get(zt).quickAccess.show(typeof t=="string"?t:void 0,{preserveValue:typeof t=="string"})}});K(class extends X{constructor(){super({id:"workbench.action.quickOpenWithModes",title:h(2781,"Quick Open"),icon:j.search,menu:{id:N.CommandCenterCenter,order:100}})}run(e){const t=e.get(zt),i={includeHelp:!0,from:"commandCenter"};t.quickAccess.show(void 0,{preserveValue:!0,providerOptions:i})}});Ce.registerCommand("workbench.action.quickOpenPreviousEditor",async s=>{s.get(zt).quickAccess.show("",{itemActivation:fw.SECOND})});class V1 extends X{constructor(e,t,i,n,o){super({id:e,title:t,f1:!0,keybinding:o}),this.id=e,this.next=i,this.quickNavigate=n}async run(e){const t=e.get(Ve),i=e.get(zt),n=t.lookupKeybindings(this.id),o=this.quickNavigate?{keybindings:n}:void 0;i.navigate(this.next,o)}}class Cze extends V1{constructor(){super("workbench.action.quickOpenNavigateNext",I(2782,"Navigate Next in Quick Open"),!0,!0)}}class Eze extends V1{constructor(){super("workbench.action.quickOpenNavigatePrevious",I(2783,"Navigate Previous in Quick Open"),!1,!0)}}class xze extends V1{constructor(){super("workbench.action.quickOpenSelectNext",I(2784,"Select Next in Quick Open"),!0,!1,{weight:W.WorkbenchContrib+50,when:Rl,primary:0,mac:{primary:E.WinCtrl|S.KeyN}})}}class Ize extends V1{constructor(){super("workbench.action.quickOpenSelectPrevious",I(2785,"Select Previous in Quick Open"),!1,!1,{weight:W.WorkbenchContrib+50,when:Rl,primary:0,mac:{primary:E.WinCtrl|S.KeyP}})}}K(xze);K(Ize);K(Cze);K(Eze);var oC;let pE=class{static{oC=this}static{this.PREFIX="?"}constructor(e,t){this.quickInputService=e,this.keybindingService=t,this.registry=Ge.as(aN.Quickaccess)}provide(e){const t=new U;return t.add(e.onDidAccept(()=>{const[i]=e.selectedItems;i&&this.quickInputService.quickAccess.show(i.prefix,{preserveValue:!0})})),t.add(e.onDidChangeValue(i=>{const n=this.registry.getQuickAccessProvider(i.substr(oC.PREFIX.length));n&&n.prefix&&n.prefix!==oC.PREFIX&&this.quickInputService.quickAccess.show(n.prefix,{preserveValue:!0})})),e.items=this.getQuickAccessProviders().filter(i=>i.prefix!==oC.PREFIX),t}getQuickAccessProviders(){return this.registry.getQuickAccessProviders().sort((t,i)=>t.prefix.localeCompare(i.prefix)).flatMap(t=>this.createPicks(t))}createPicks(e){return e.helpEntries.map(t=>{const i=t.prefix||e.prefix,n=i||"…";return{prefix:i,label:n,keybinding:t.commandId?this.keybindingService.lookupKeybinding(t.commandId):void 0,ariaLabel:h(1949,"{0}, {1}",n,t.description),description:t.description}})}};pE=oC=f([p(0,zt),p(1,Ve)],pE);var UG;let ow=class extends u4{static{UG=this}static{this.PREFIX="view "}constructor(e,t,i,n,o,r,a,c){super(UG.PREFIX,{noResultsPick:{label:h(9108,"No matching views"),containerLabel:""}}),this.viewDescriptorService=e,this.viewsService=t,this.outputService=i,this.terminalService=n,this.terminalGroupService=o,this.debugService=r,this.paneCompositeService=a,this.contextKeyService=c}_getPicks(e){const t=this.doGetViewPickItems().filter(r=>e?(r.highlights={label:$ne(e,r.label,!0)??void 0},r.highlights.label||Ewe(r.containerLabel,e)):!0),i=new Map;for(const r of t)i.has(r.label)||i.set(r.label,r.containerLabel);const n=[];let o;for(const r of t){if(o!==r.containerLabel){o=r.containerLabel;let a;i.has(o)?a=`${i.get(o)} / ${o}`:a=o,n.push({type:"separator",label:a})}n.push(r)}return n}doGetViewPickItems(){const e=[],t=(r,a)=>{const c=this.viewDescriptorService.getViewContainerModel(a),d=[];for(const l of c.allViewDescriptors)this.contextKeyService.contextMatchesRules(l.when)&&d.push({label:l.name.value,containerLabel:c.title,accept:()=>this.viewsService.openView(l.id,!0)});return d},i=(r,a)=>{const c=this.paneCompositeService.getPaneComposites(r),d=this.paneCompositeService.getVisiblePaneCompositeIds(r);c.sort((l,u)=>{let g=d.findIndex(v=>l.id===v),m=d.findIndex(v=>u.id===v);return g<0&&(g=c.indexOf(l)+d.length),m<0&&(m=c.indexOf(u)+d.length),g-m});for(const l of c)if(this.includeViewContainer(l)){const u=this.viewDescriptorService.getViewContainerById(l.id);u&&e.push({label:this.viewDescriptorService.getViewContainerModel(u).title,containerLabel:a,accept:()=>this.paneCompositeService.openPaneComposite(l.id,r,!0)})}};i(Fe.Sidebar,h(9109,"Side Bar")),i(Fe.Panel,h(9110,"Panel")),i(Fe.AuxiliaryBar,h(9111,"Secondary Side Bar"));const n=r=>{const a=this.paneCompositeService.getPaneComposites(r);for(const c of a){const d=this.viewDescriptorService.getViewContainerById(c.id);d&&e.push(...t(c,d))}};n(Fe.Sidebar),n(Fe.Panel),n(Fe.AuxiliaryBar),this.terminalGroupService.groups.forEach((r,a)=>{r.terminalInstances.forEach((c,d)=>{const l=h(9112,"{0}: {1}",`${a+1}.${d+1}`,c.title);e.push({label:l,containerLabel:h(9113,"Terminal"),accept:async()=>{await this.terminalGroupService.showPanel(!0),this.terminalService.setActiveInstance(c)}})})}),this.debugService.getModel().getSessions(!0).filter(r=>r.hasSeparateRepl()).forEach((r,a)=>{const c=r.name;e.push({label:c,containerLabel:h(9114,"Debug Console"),accept:async()=>{await this.debugService.focusStackFrame(void 0,void 0,r,{explicit:!0}),this.viewsService.isViewVisible(f8)||await this.viewsService.openView(f8,!0)}})});const o=this.outputService.getChannelDescriptors();for(const r of o)e.push({label:r.label,containerLabel:h(9115,"Output"),accept:()=>this.outputService.showChannel(r.id)});return e}includeViewContainer(e){const t=this.viewDescriptorService.getViewContainerById(e.id);return t?.hideIfEmpty?this.viewDescriptorService.getViewContainerModel(t).activeViewDescriptors.length>0:!0}};ow=UG=f([p(0,Os),p(1,mo),p(2,FN),p(3,Ew),p(4,Dz),p(5,Cz),p(6,aa),p(7,me)],ow);class ID extends X{static{this.ID="workbench.action.openView"}constructor(){super({id:ID.ID,title:I(9116,"Open View"),category:te.View,f1:!0})}async run(e){e.get(zt).quickAccess.show(ow.PREFIX)}}class Zb extends X{static{this.ID="workbench.action.quickOpenView"}static{this.KEYBINDING={primary:E.CtrlCmd|S.KeyQ,mac:{primary:E.WinCtrl|S.KeyQ},linux:{primary:0}}}constructor(){super({id:Zb.ID,title:I(9117,"Quick Open View"),category:te.View,f1:!1,keybinding:{weight:W.WorkbenchContrib,when:void 0,...Zb.KEYBINDING}})}async run(e){const t=e.get(Ve),i=e.get(zt),n=t.lookupKeybindings(Zb.ID);i.quickAccess.show(ow.PREFIX,{quickNavigateConfiguration:{keybindings:n},itemActivation:fw.FIRST})}}const U5=Ge.as(aN.Quickaccess);U5.registerQuickAccessProvider({ctor:pE,prefix:pE.PREFIX,placeholder:h(9096,"Type '{0}' to get help on the actions you can take from here.",pE.PREFIX),helpEntries:[{description:h(9097,"Show all Quick Access Providers"),commandCenterOrder:70,commandCenterLabel:h(9098,"More")}]});U5.registerQuickAccessProvider({ctor:ow,prefix:ow.PREFIX,contextKey:"inViewsPicker",placeholder:h(9099,"Type the name of a view, output channel or terminal to open."),helpEntries:[{description:h(9100,"Open View"),commandId:ID.ID}]});U5.registerQuickAccessProvider({ctor:xv,prefix:xv.PREFIX,contextKey:"inCommandsPicker",placeholder:h(9101,"Type the name of a command to run."),helpEntries:[{description:h(9102,"Show and Run Commands"),commandId:Af.ID,commandCenterOrder:20}]});ge.appendMenuItem(N.MenubarViewMenu,{group:"1_open",command:{id:Af.ID,title:h(9103,"&&Command Palette...")},order:1});ge.appendMenuItem(N.MenubarHelpMenu,{group:"1_welcome",command:{id:Af.ID,title:h(9104,"Show All Commands")},order:2});ge.appendMenuItem(N.MenubarViewMenu,{group:"1_open",command:{id:ID.ID,title:h(9105,"&&Open View...")},order:2});ge.appendMenuItem(N.MenubarGoMenu,{group:"5_infile_nav",command:{id:"workbench.action.gotoLine",title:h(9106,"Go to &&Line/Column...")},order:1});ge.appendMenuItem(N.GlobalActivity,{group:"1_command",command:{id:Af.ID,title:h(9107,"Command Palette...")},order:1});ge.appendMenuItem(N.EditorContext,{group:"z_commands",when:V.editorSimpleInput.toNegated(),command:{id:Af.ID,title:h(9107,"Command Palette...")},order:1});K(Sze);K(Af);K(ID);K(Zb);const Dze="inViewsPicker",qpe=x.and(Rl,x.has(Dze)),Jb=Zb.KEYBINDING,lie="workbench.action.quickOpenNavigateNextInViewPicker";Le.registerCommandAndKeybindingRule({id:lie,weight:W.WorkbenchContrib+50,handler:hS(lie,!0),when:qpe,primary:Jb.primary,linux:Jb.linux,mac:Jb.mac});const hie="workbench.action.quickOpenNavigatePreviousInViewPicker";Le.registerCommandAndKeybindingRule({id:hie,weight:W.WorkbenchContrib+50,handler:hS(hie,!1),when:qpe,primary:Jb.primary|E.Shift,linux:Jb.linux,mac:{primary:Jb.mac.primary|E.Shift}});let wM=class extends F{static{this.ID="workbench.contrib.externalUriResolver"}constructor(e,t){super(),t.options?.resolveExternalUri&&this._register(e.registerExternalUriResolver({resolveExternalUri:async i=>({resolved:await t.options.resolveExternalUri(i),dispose:()=>{}})}))}};wM=f([p(0,hi),p(1,lf)],wM);const kze="trustedDomains",Tze={type:dC.File,ctime:Date.now(),mtime:Date.now(),size:0},zpe=`// Links matching one or more entries in the list below can be opened without link protection.
// The following examples show what entries can look like:
// - "https://microsoft.com": Matches this specific domain using https
// - "https://microsoft.com:8080": Matches this specific domain on this port using https
// - "https://microsoft.com:*": Matches this specific domain on any port using https
// - "https://microsoft.com/foo": Matches https://microsoft.com/foo and https://microsoft.com/foo/bar,
//   but not https://microsoft.com/foobar or https://microsoft.com/bar
// - "https://*.microsoft.com": Match all domains ending in "microsoft.com" using https
// - "microsoft.com": Match this specific domain using either http or https
// - "*.microsoft.com": Match all domains ending in "microsoft.com" using either http or https
// - "http://192.168.0.1: Matches this specific IP using http
// - "http://192.168.0.*: Matches all IP's with this prefix using http
// - "*": Match all domains using either http or https
//
`,Kpe=`//
// You can use the "Manage Trusted Domains" command to open this file.
// Save this file to apply the trusted domains rules.
`,Aze=`[
	// "https://microsoft.com"
]`;function Rze(s,e,t){let i=zpe;return s.length>0?(i+=`// By default, VS Code trusts "localhost" as well as the following domains:
`,s.forEach(n=>{i+=`// - "${n}"
`})):i+=`// By default, VS Code trusts "localhost".
`,i+=Kpe,i+=t?`
// Currently configuring trust for ${t}
`:"",e.length===0?i+=Aze:i+=JSON.stringify(e,null,2),i}let SM=class{static{this.ID="workbench.contrib.trustedDomainsFileSystemProvider"}constructor(e,t,i){this.fileService=e,this.storageService=t,this.instantiationService=i,this.capabilities=ph.FileReadWrite,this.onDidChangeCapabilities=D.None,this.onDidChangeFile=D.None,this.fileService.registerProvider(kze,this)}stat(e){return Promise.resolve(Tze)}async readFile(e){let t=this.storageService.get(i6,he.APPLICATION);const i=e.fragment,{defaultTrustedDomains:n,trustedDomains:o}=await this.instantiationService.invokeFunction(xwe);return(!t||t.indexOf(zpe)===-1||t.indexOf(Kpe)===-1||t.indexOf(i??"")===-1||[...n,...o].some(a=>!Gt(t).includes(a)))&&(t=Rze(n,o,i)),Re.fromString(t).buffer}writeFile(e,t,i){try{const n=Re.wrap(t).toString(),o=Db(n);this.storageService.store(i6,n,he.APPLICATION,pt.USER),this.storageService.store(Iwe,JSON.stringify(o)||"",he.APPLICATION,pt.USER)}catch{}return Promise.resolve()}watch(e,t){return{dispose(){}}}mkdir(e){return Promise.resolve(void 0)}readdir(e){return Promise.resolve(void 0)}delete(e,t){return Promise.resolve(void 0)}rename(e,t,i){return Promise.resolve(void 0)}};SM=f([p(0,Xe),p(1,tt),p(2,J)],SM);let $G=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g){this._openerService=e,this._storageService=t,this._dialogService=i,this._productService=n,this._quickInputService=o,this._editorService=r,this._clipboardService=a,this._telemetryService=c,this._instantiationService=d,this._configurationService=l,this._workspaceTrustService=u,this._trustedDomainService=g,this._openerService.registerValidator({shouldOpen:(m,v)=>this.validateLink(m,v)})}async validateLink(e,t){if(!DE(e,ae.http)&&!DE(e,ae.https)||t?.fromWorkspace&&this._workspaceTrustService.isWorkspaceTrusted()&&!this._configurationService.getValue("workbench.trustedDomains.promptInTrustedWorkspace"))return!0;const i=e;let n;if(typeof e=="string"?n=R.parse(e):n=e,this._trustedDomainService.isValid(n))return!0;{const{scheme:o,authority:r,path:a,query:c,fragment:d}=n;let l=`${o}://${r}${a}`;const u=`${c?"?"+c:""}${d?"#"+d:""}`,g=Math.max(0,60-l.length),m=Math.min(Math.max(5,g),u.length);m===u.length?l+=u:l+=u.charAt(0)+"..."+u.substring(u.length-m+1);const{result:v}=await this._dialogService.prompt({type:Me.Info,message:h(11502,"Do you want {0} to open the external website?",this._productService.nameShort),detail:typeof i=="string"?i:l,buttons:[{label:h(11503,"&&Open"),run:()=>!0},{label:h(11504,"&&Copy"),run:()=>(this._clipboardService.writeText(typeof i=="string"?i:n.toString(!0)),!1)},{label:h(11505,"Configure &&Trusted Domains"),run:async()=>{const{trustedDomains:y}=this._instantiationService.invokeFunction(Dwe),w=`${o}://${r}`,C=await kwe(y,w,n,this._quickInputService,this._storageService,this._editorService);return!!(C.indexOf("*")!==-1||Twe(n,C))}}],cancelButton:{run:()=>!1}});return v}}};$G=f([p(0,hi),p(1,tt),p(2,Qt),p(3,Fn),p(4,zt),p(5,de),p(6,Is),p(7,li),p(8,J),p(9,ne),p(10,Tv),p(11,mq)],$G);class Pze extends X{constructor(){super({id:"workbench.action.url.openUrl",title:I(11506,"Open URL"),category:te.Developer,f1:!0})}async run(e){const t=e.get(zt),i=e.get($M);return t.input({prompt:h(11507,"URL to open")}).then(n=>{if(n){const o=R.parse(n);i.open(o,{originalUrl:n})}})}}K(Pze);Ce.registerCommand(zF);ge.appendMenuItem(N.CommandPalette,{command:{id:zF.id,title:zF.description.description}});Ge.as(hf.Workbench).registerWorkbenchContribution($G,mc.Restored);sc(SM.ID,SM,oc.BlockRestore);sc(wM.ID,wM,oc.BlockRestore);const Lze=Ge.as(qs.Configuration);Lze.registerConfiguration({...fN,properties:{"workbench.trustedDomains.promptInTrustedWorkspace":{scope:Bt.APPLICATION,type:"boolean",default:!1,description:h(11508,"When enabled, trusted domain prompts will appear when opening links in trusted workspaces.")}}});var W_;let CM=class extends F{static{W_=this}static{this.SETTING_ID_PATTERNS="workbench.editor.customLabels.patterns"}static{this.SETTING_ID_ENABLED="workbench.editor.customLabels.enabled"}constructor(e,t){super(),this.configurationService=e,this.workspaceContextService=t,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.patterns=[],this.enabled=!0,this.cache=new Awe(1e3),this._templateRegexValidation=/[a-zA-Z0-9]/,this._parsedTemplateExpression=/\$\{(dirname|filename|extname|extname\((?<extnameN>[-+]?\d+)\)|dirname\((?<dirnameN>[-+]?\d+)\))\}/g,this._filenameCaptureExpression=/(?<filename>^\.*[^.]*)/,this.storeEnablementState(),this.storeCustomPatterns(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration(W_.SETTING_ID_ENABLED)){const t=this.enabled;this.storeEnablementState(),t!==this.enabled&&this.patterns.length>0&&this._onDidChange.fire()}else e.affectsConfiguration(W_.SETTING_ID_PATTERNS)&&(this.cache.clear(),this.storeCustomPatterns(),this._onDidChange.fire())}))}storeEnablementState(){this.enabled=this.configurationService.getValue(W_.SETTING_ID_ENABLED)}storeCustomPatterns(){this.patterns=[];const e=this.configurationService.getValue(W_.SETTING_ID_PATTERNS);for(const t in e){const i=e[t];if(!this._templateRegexValidation.test(i))continue;const n=iy(t),o=Um(t);this.patterns.push({pattern:t,template:i,isAbsolutePath:n,parsedPattern:o})}this.patterns.sort((t,i)=>this.patternWeight(i.pattern)-this.patternWeight(t.pattern))}patternWeight(e){let t=0;for(const i of e.split("/"))i==="**"?t+=1:i==="*"?t+=10:i.includes("*")||i.includes("?")?t+=50:i!==""&&(t+=100);return t}getName(e){if(!this.enabled||this.patterns.length===0)return;const t=e.toString(),i=this.cache.get(t);if(i!==void 0)return i??void 0;const n=this.applyPatterns(e);return this.cache.set(t,n??null),n}applyPatterns(e){const t=this.workspaceContextService.getWorkspaceFolder(e);let i;for(const n of this.patterns){let o;if(t&&!n.isAbsolutePath?(i||(i=Qu(hs(t.uri),e)??e.path),o=i):o=e.path,n.parsedPattern(o))return this.applyTemplate(n.template,e,o)}}applyTemplate(e,t,i){let n;return e.replace(this._parsedTemplateExpression,(o,r,...a)=>{n=n??Rwe(t.path);const{dirnameN:c="0",extnameN:d="0"}=a.pop();if(r==="filename"){const{filename:l}=this._filenameCaptureExpression.exec(n.base)?.groups??{};if(l)return l}else if(r==="extname"){const l=this.getExtnames(n.base);if(l)return l}else if(r.startsWith("extname")){const l=parseInt(d),u=this.getNthExtname(n.base,l);if(u)return u}else if(r.startsWith("dirname")){const l=parseInt(c),u=this.getNthDirname(wq(i),l);if(u)return u}return o})}removeLeadingDot(e){let t=e;for(;t.startsWith(".");)t=t.slice(1);return t}getNthDirname(e,t){e=e.startsWith("/")?e.slice(1):e;const i=e.split("/");return this.getNthFragment(i,t)}getExtnames(e){return this.removeLeadingDot(e).split(".").slice(1).join(".")}getNthExtname(e,t){const i=this.removeLeadingDot(e).split(".");return i.shift(),this.getNthFragment(i,t)}getNthFragment(e,t){const i=e.length;let n;t<0?n=Math.abs(t)-1:n=i-t-1;const o=e[n];if(!(o===void 0||o===""))return o}};CM=W_=f([p(0,ne),p(1,Tt)],CM);var Yg,fu;(function(s){s.titleSeparator="window.titleSeparator",s.title="window.title"})(fu||(fu={}));const jpe=(()=>{if(qt&&ra)return"${activeEditorShort}${separator}${rootName}${separator}${profileName}";const s="${dirty}${activeEditorShort}${separator}${rootName}${separator}${profileName}${separator}${appName}";return $t?s+"${separator}${remoteName}":s})(),Ype=qt?" — ":" - ";let uie=class extends F{static{Yg=this}static{this.NLS_USER_IS_ADMIN=pn?h(3527,"[Administrator]"):h(3528,"[Superuser]")}static{this.NLS_EXTENSION_HOST=h(3529,"[Extension Development Host]")}static{this.TITLE_DIRTY="● "}get value(){return this.title??""}get workspaceName(){return this.labelService.getWorkspaceLabel(this.contextService.getWorkspace())}get fileName(){const e=this.editorService.activeEditor;if(!e)return;const t=e.getTitle(Nt.SHORT);return`${e?.isDirty()&&!e.isSaving()?Yg.TITLE_DIRTY:""}${t}`}constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(),this.configurationService=t,this.contextKeyService=i,this.editorService=n,this.environmentService=o,this.contextService=r,this.labelService=a,this.userDataProfileService=c,this.productService=d,this.viewsService=l,this.decorationsService=u,this.accessibilityService=g,this.properties={isPure:!0,isAdmin:!1,prefix:void 0},this.variables=new Map,this.activeEditorListeners=this._register(new U),this.titleUpdater=this._register(new fn(()=>this.doUpdateTitle(),0)),this.onDidChangeEmitter=new M,this.onDidChange=this.onDidChangeEmitter.event,this.titleIncludesFocusedView=!1,this.titleIncludesEditorState=!1,this.windowId=e.vscodeWindowId,this.checkTitleVariables(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationChanged(e))),this._register(this.editorService.onDidActiveEditorChange(()=>this.onActiveEditorChange())),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.titleUpdater.schedule())),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.titleUpdater.schedule())),this._register(this.contextService.onDidChangeWorkspaceName(()=>this.titleUpdater.schedule())),this._register(this.labelService.onDidChangeFormatters(()=>this.titleUpdater.schedule())),this._register(this.userDataProfileService.onDidChangeCurrentProfile(()=>this.titleUpdater.schedule())),this._register(this.viewsService.onDidChangeFocusedView(()=>{this.titleIncludesFocusedView&&this.titleUpdater.schedule()})),this._register(this.contextKeyService.onDidChangeContext(e=>{e.affectsSome(this.variables)&&this.titleUpdater.schedule()})),this._register(this.accessibilityService.onDidChangeScreenReaderOptimized(()=>this.titleUpdater.schedule()))}onConfigurationChanged(e){const t=e.affectsConfiguration(fu.title);t&&this.checkTitleVariables(),(t||e.affectsConfiguration(fu.titleSeparator))&&this.titleUpdater.schedule()}checkTitleVariables(){const e=this.configurationService.getValue(fu.title);typeof e=="string"&&(this.titleIncludesFocusedView=e.includes("${focusedView}"),this.titleIncludesEditorState=e.includes("${activeEditorState}"))}onActiveEditorChange(){this.activeEditorListeners.clear(),this.titleUpdater.schedule();const e=this.editorService.activeEditor;if(e&&(this.activeEditorListeners.add(e.onDidChangeDirty(()=>this.titleUpdater.schedule())),this.activeEditorListeners.add(e.onDidChangeLabel(()=>this.titleUpdater.schedule()))),this.titleIncludesFocusedView){const t=this.editorService.activeTextEditorControl,i=[];Ao(t)?i.push(t):$p(t)&&i.push(t.getOriginalEditor(),t.getModifiedEditor());for(const n of i)this.activeEditorListeners.add(n.onDidBlurEditorText(()=>this.titleUpdater.schedule())),this.activeEditorListeners.add(n.onDidFocusEditorText(()=>this.titleUpdater.schedule()))}this.titleIncludesEditorState&&this.activeEditorListeners.add(this.decorationsService.onDidChangeDecorations(()=>this.titleUpdater.schedule()))}doUpdateTitle(){const e=this.getFullWindowTitle();if(e!==this.title){let t=e;Aq(t)||(t=this.productService.nameLong);const i=kq(this.windowId,!0).window;!i.document.title&&qt&&t===this.productService.nameLong&&(i.document.title=`${this.productService.nameLong} ${Yg.TITLE_DIRTY}`),i.document.title=t,this.title=e,this.onDidChangeEmitter.fire()}}getFullWindowTitle(){const{prefix:e,suffix:t}=this.getTitleDecorations();let i=this.getWindowTitle()||this.productService.nameLong;return e&&(i=`${e} ${i}`),t&&(i=`${i} ${t}`),i.replace(/[^\S ]/g," ")}getTitleDecorations(){let e,t;return this.properties.prefix&&(e=this.properties.prefix),this.environmentService.isExtensionDevelopment&&(e=e?`${Yg.NLS_EXTENSION_HOST} - ${e}`:Yg.NLS_EXTENSION_HOST),this.properties.isAdmin&&(t=Yg.NLS_USER_IS_ADMIN),{prefix:e,suffix:t}}updateProperties(e){const t=typeof e.isAdmin=="boolean"?e.isAdmin:this.properties.isAdmin,i=typeof e.isPure=="boolean"?e.isPure:this.properties.isPure,n=typeof e.prefix=="string"?e.prefix:this.properties.prefix;(t!==this.properties.isAdmin||i!==this.properties.isPure||n!==this.properties.prefix)&&(this.properties.isAdmin=t,this.properties.isPure=i,this.properties.prefix=n,this.titleUpdater.schedule())}registerVariables(e){let t=!1;for(const{name:i,contextKey:n}of e)this.variables.has(n)||(this.variables.set(n,i),t=!0);t&&this.titleUpdater.schedule()}getWindowTitle(){const e=this.editorService.activeEditor,t=this.contextService.getWorkspace();let i;t.configuration?i=t.configuration:t.folders.length&&(i=t.folders[0].uri);const n=xi.getOriginalUri(e,{supportSideBySide:Ut.PRIMARY});let o=n?hs(n):void 0;o?.path==="."&&(o=void 0);let r;this.contextService.getWorkbenchState()===zo.FOLDER?r=t.folders[0]:n&&(r=this.contextService.getWorkspaceFolder(n)??void 0);let a;if(this.environmentService.remoteAuthority&&!$t)a=this.labelService.getHostLabel(ae.vscodeRemote,this.environmentService.remoteAuthority);else{const Se=Pwe(t);Se&&(a=this.labelService.getHostLabel(Se.scheme,Se.authority))}const c=e?e.getTitle(Nt.SHORT):"",d=e?e.getTitle(Nt.MEDIUM):c,l=e?e.getTitle(Nt.LONG):d,u=o?je(o):"",g=o?this.labelService.getUriLabel(o,{relative:!0}):"",m=o?this.labelService.getUriLabel(o):"",v=this.labelService.getWorkspaceLabel(t),y=this.labelService.getWorkspaceLabel(t,{verbose:Qm.SHORT}),w=i?this.labelService.getUriLabel(i):"",C=r?r.name:"",T=r?this.labelService.getUriLabel(r.uri):"",k=e?.isDirty()&&!e.isSaving()?Yg.TITLE_DIRTY:"",A=this.productService.nameLong,B=this.userDataProfileService.currentProfile.isDefault?"":this.userDataProfileService.currentProfile.name,z=this.viewsService.getFocusedViewName(),Q=n?this.decorationsService.getDecoration(n,!1)?.tooltip:void 0,ie={};for(const[Se,Ft]of this.variables)ie[Ft]=this.contextKeyService.getContextKeyValue(Se)??"";let oe=this.configurationService.getValue(fu.title);typeof oe!="string"&&(oe=jpe),!this.titleIncludesEditorState&&this.accessibilityService.isScreenReaderOptimized()&&this.configurationService.getValue("accessibility.windowTitleOptimized")&&(oe+="${separator}${activeEditorState}");let xe=this.configurationService.getValue(fu.titleSeparator);return typeof xe!="string"&&(xe=Ype),Lwe(oe,{...ie,activeEditorShort:c,activeEditorLong:l,activeEditorMedium:d,activeFolderShort:u,activeFolderMedium:g,activeFolderLong:m,rootName:v,rootPath:w,rootNameShort:y,folderName:C,folderPath:T,dirty:k,appName:A,remoteName:a,profileName:B,focusedView:z,activeEditorState:Q,separator:{label:xe}})}isCustomTitleFormat(){if(this.accessibilityService.isScreenReaderOptimized()||this.titleIncludesEditorState)return!0;const e=this.configurationService.inspect(fu.title),t=this.configurationService.inspect(fu.titleSeparator);return e.value!==e.defaultValue||t.value!==t.defaultValue}};uie=Yg=f([p(1,ne),p(2,me),p(3,de),p(4,lf),p(5,Tt),p(6,di),p(7,Fh),p(8,Fn),p(9,mo),p(10,kv),p(11,Tr)],uie);const gk=Ge.as(qs.Configuration);(function(){sc(p6.ID,p6,oc.Eventually),sc(f6.ID,f6,oc.AfterRestored),gk.registerConfiguration({...fN,properties:{"workbench.externalBrowser":{type:"string",markdownDescription:h(3569,"Configure the browser to use for opening http or https links externally. This can either be the name of the browser (`edge`, `chrome`, `firefox`) or an absolute path to the browser's executable. Will use the system default if not set."),included:ra,restricted:!0},"workbench.editor.titleScrollbarSizing":{type:"string",enum:["default","large"],enumDescriptions:[h(3570,"The default size."),h(3571,"Increases the size, so it can be grabbed more easily with the mouse.")],description:h(3572,"Controls the height of the scrollbars used for tabs and breadcrumbs in the editor title area."),default:"default"},[si.EDITOR_TABS_MODE]:{type:"string",enum:[lo.MULTIPLE,lo.SINGLE,lo.NONE],enumDescriptions:[h(3573,"Each editor is displayed as a tab in the editor title area."),h(3574,"The active editor is displayed as a single large tab in the editor title area."),h(3575,"The editor title area is not displayed.")],description:h(3576,"Controls whether opened editors should show as individual tabs, one single large tab or if the title area should not be shown."),default:"multiple"},[si.EDITOR_ACTIONS_LOCATION]:{type:"string",enum:[rl.DEFAULT,rl.TITLEBAR,rl.HIDDEN],markdownEnumDescriptions:[h(3577,"Show editor actions in the window title bar when {0} is set to {1}. Otherwise, editor actions are shown in the editor tab bar.","`#workbench.editor.showTabs#`","`none`"),h(3578,"Show editor actions in the window title bar. If {0} is set to {1}, editor actions are hidden.","`#window.customTitleBarVisibility#`","`never`"),h(3579,"Editor actions are not shown.")],markdownDescription:h(3580,"Controls where the editor actions are shown."),default:"default"},"workbench.editor.alwaysShowEditorActions":{type:"boolean",markdownDescription:h(3581,"Controls whether to always show the editor actions, even when the editor group is not active."),default:!1},"workbench.editor.wrapTabs":{type:"boolean",markdownDescription:h(3582,"Controls whether tabs should be wrapped over multiple lines when exceeding available space or whether a scrollbar should appear instead. This value is ignored when {0} is not set to '{1}'.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.scrollToSwitchTabs":{type:"boolean",markdownDescription:h(3583,"Controls whether scrolling over tabs will open them or not. By default tabs will only reveal upon scrolling, but not open. You can press and hold the Shift-key while scrolling to change this behavior for that duration. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.highlightModifiedTabs":{type:"boolean",markdownDescription:h(3584,"Controls whether a top border is drawn on tabs for editors that have unsaved changes. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","multiple"),default:!1},"workbench.editor.decorations.badges":{type:"boolean",markdownDescription:h(3585,"Controls whether editor file decorations should use badges."),default:!0},"workbench.editor.decorations.colors":{type:"boolean",markdownDescription:h(3586,"Controls whether editor file decorations should use colors."),default:!0},[CM.SETTING_ID_ENABLED]:{type:"boolean",markdownDescription:h(3587,"Controls whether the custom workbench editor labels should be applied."),default:!0},[CM.SETTING_ID_PATTERNS]:{type:"object",markdownDescription:(()=>{let t=h(3588,"Controls the rendering of the editor label. Each __Item__ is a pattern that matches a file path. Both relative and absolute file paths are supported. The relative path must include the WORKSPACE_FOLDER (e.g `WORKSPACE_FOLDER/src/**.tsx` or `*/src/**.tsx`). Absolute patterns must start with a `/`. In case multiple patterns match, the longest matching path will be picked. Each __Value__ is the template for the rendered editor when the __Item__ matches. Variables are substituted based on the context:");return t+=`
- `+[h(3589,"`${dirname}`: name of the folder in which the file is located (e.g. `WORKSPACE_FOLDER/folder/file.txt -> folder`)."),h(3590,"`${dirname(N)}`: name of the nth parent folder in which the file is located (e.g. `N=2: WORKSPACE_FOLDER/static/folder/file.txt -> WORKSPACE_FOLDER`). Folders can be picked from the start of the path by using negative numbers (e.g. `N=-1: WORKSPACE_FOLDER/folder/file.txt -> WORKSPACE_FOLDER`). If the __Item__ is an absolute pattern path, the first folder (`N=-1`) refers to the first folder in the absolute path, otherwise it corresponds to the workspace folder."),h(3591,"`${filename}`: name of the file without the file extension (e.g. `WORKSPACE_FOLDER/folder/file.txt -> file`)."),h(3592,"`${extname}`: the file extension (e.g. `WORKSPACE_FOLDER/folder/file.txt -> txt`)."),h(3593,"`${extname(N)}`: the nth extension of the file separated by '.' (e.g. `N=2: WORKSPACE_FOLDER/folder/file.ext1.ext2.ext3 -> ext1`). Extension can be picked from the start of the extension by using negative numbers (e.g. `N=-1: WORKSPACE_FOLDER/folder/file.ext1.ext2.ext3 -> ext2`).")].join(`
- `),t+=`

`+h(3594,'Example: `"**/static/**/*.html": "${filename} - ${dirname} (${extname})"` will render a file `WORKSPACE_FOLDER/static/folder/file.html` as `file - folder (html)`.'),t})(),additionalProperties:{type:["string","null"],markdownDescription:h(3595,"The template which should be rendered when the pattern matches. May include the variables ${dirname}, ${filename} and ${extname}."),minLength:1,pattern:".*[a-zA-Z0-9].*"},default:{}},"workbench.editor.labelFormat":{type:"string",enum:["default","short","medium","long"],enumDescriptions:[h(3596,"Show the name of the file. When tabs are enabled and two files have the same name in one group the distinguishing sections of each file's path are added. When tabs are disabled, the path relative to the workspace folder is shown if the editor is active."),h(3597,"Show the name of the file followed by its directory name."),h(3598,"Show the name of the file followed by its path relative to the workspace folder."),h(3599,"Show the name of the file followed by its absolute path.")],default:"default",description:h(3600,"Controls the format of the label for an editor.")},"workbench.editor.untitled.labelFormat":{type:"string",enum:["content","name"],enumDescriptions:[h(3601,"The name of the untitled file is derived from the contents of its first line unless it has an associated file path. It will fallback to the name in case the line is empty or contains no word characters."),h(3602,"The name of the untitled file is not derived from the contents of the file.")],default:"content",description:h(3603,"Controls the format of the label for an untitled editor.")},"workbench.editor.empty.hint":{type:"string",enum:["text","hidden"],default:"text",markdownDescription:h(3604,"Controls if the empty editor text hint should be visible in the editor.")},"workbench.editor.languageDetection":{type:"boolean",default:!0,description:h(3605,"Controls whether the language in a text editor is automatically detected unless the language has been explicitly set by the language picker. This can also be scoped by language so you can specify which languages you do not want to be switched off of. This is useful for languages like Markdown that often contain other languages that might trick language detection into thinking it's the embedded language and not Markdown."),scope:Bt.LANGUAGE_OVERRIDABLE},"workbench.editor.historyBasedLanguageDetection":{type:"boolean",default:!0,description:h(3606,"Enables use of editor history in language detection. This causes automatic language detection to favor languages that have been recently opened and allows for automatic language detection to operate with smaller inputs.")},"workbench.editor.preferHistoryBasedLanguageDetection":{type:"boolean",default:!1,description:h(3607,"When enabled, a language detection model that takes into account editor history will be given higher precedence.")},"workbench.editor.languageDetectionHints":{type:"object",default:{untitledEditors:!0,notebookEditors:!0},description:h(3608,"When enabled, shows a Status bar Quick Fix when the editor language doesn't match detected content language."),additionalProperties:!1,properties:{untitledEditors:{type:"boolean",description:h(3609,"Show in untitled text editors")},notebookEditors:{type:"boolean",description:h(3610,"Show in notebook editors")}}},"workbench.editor.tabActionLocation":{type:"string",enum:["left","right"],default:"right",markdownDescription:h(3611,"Controls the position of the editor's tabs action buttons (close, unpin). This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.tabActionCloseVisibility":{type:"boolean",default:!0,description:h(3612,"Controls the visibility of the tab close action button.")},"workbench.editor.tabActionUnpinVisibility":{type:"boolean",default:!0,description:h(3613,"Controls the visibility of the tab unpin action button.")},"workbench.editor.tabSizing":{type:"string",enum:["fit","shrink","fixed"],default:"fit",enumDescriptions:[h(3614,"Always keep tabs large enough to show the full editor label."),h(3615,"Allow tabs to get smaller when the available space is not enough to show all tabs at once."),h(3616,"Make all tabs the same size, while allowing them to get smaller when the available space is not enough to show all tabs at once.")],markdownDescription:h(3617,"Controls the size of editor tabs. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.tabSizingFixedMinWidth":{type:"number",default:50,minimum:38,markdownDescription:h(3618,"Controls the minimum width of tabs when {0} size is set to {1}.","`#workbench.editor.tabSizing#`","`fixed`")},"workbench.editor.tabSizingFixedMaxWidth":{type:"number",default:160,minimum:38,markdownDescription:h(3619,"Controls the maximum width of tabs when {0} size is set to {1}.","`#workbench.editor.tabSizing#`","`fixed`")},"window.density.editorTabHeight":{type:"string",enum:["default","compact"],default:"default",markdownDescription:h(3620,"Controls the height of editor tabs. Also applies to the title control bar when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.pinnedTabSizing":{type:"string",enum:["normal","compact","shrink"],default:"normal",enumDescriptions:[h(3621,"A pinned tab inherits the look of non pinned tabs."),h(3622,"A pinned tab will show in a compact form with only icon or first letter of the editor name."),h(3623,"A pinned tab shrinks to a compact fixed size showing parts of the editor name.")],markdownDescription:h(3624,"Controls the size of pinned editor tabs. Pinned tabs are sorted to the beginning of all opened tabs and typically do not close until unpinned. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.pinnedTabsOnSeparateRow":{type:"boolean",default:!1,markdownDescription:h(3625,"When enabled, displays pinned tabs in a separate row above all other tabs. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.preventPinnedEditorClose":{type:"string",enum:["keyboardAndMouse","keyboard","mouse","never"],default:"keyboardAndMouse",enumDescriptions:[h(3626,"Always prevent closing the pinned editor when using mouse middle click or keyboard."),h(3627,"Prevent closing the pinned editor when using the keyboard."),h(3628,"Prevent closing the pinned editor when using mouse middle click."),h(3629,"Never prevent closing a pinned editor.")],description:h(3630,"Controls whether pinned editors should close when keyboard or middle mouse click is used for closing.")},"workbench.editor.splitSizing":{type:"string",enum:["auto","distribute","split"],default:"auto",enumDescriptions:[h(3631,"Splits the active editor group to equal parts, unless all editor groups are already in equal parts. In that case, splits all the editor groups to equal parts."),h(3632,"Splits all the editor groups to equal parts."),h(3633,"Splits the active editor group to equal parts.")],description:h(3634,"Controls the size of editor groups when splitting them.")},"workbench.editor.splitOnDragAndDrop":{type:"boolean",default:!0,description:h(3635,"Controls if editor groups can be split from drag and drop operations by dropping an editor or file on the edges of the editor area.")},"workbench.editor.dragToOpenWindow":{type:"boolean",default:!0,markdownDescription:h(3636,"Controls if editors can be dragged out of the window to open them in a new window. Press and hold the `Alt` key while dragging to toggle this dynamically.")},"workbench.editor.focusRecentEditorAfterClose":{type:"boolean",description:h(3637,"Controls whether editors are closed in most recently used order or from left to right."),default:!0},"workbench.editor.showIcons":{type:"boolean",description:h(3638,"Controls whether opened editors should show with an icon or not. This requires a file icon theme to be enabled as well."),default:!0},"workbench.editor.enablePreview":{type:"boolean",description:h(3639,"Controls whether preview mode is used when editors open. There is a maximum of one preview mode editor per editor group. This editor displays its filename in italics on its tab or title label and in the Open Editors view. Its contents will be replaced by the next editor opened in preview mode. Making a change in a preview mode editor will persist it, as will a double-click on its label, or the 'Keep Open' option in its label context menu. Opening a file from Explorer with a double-click persists its editor immediately."),default:!0},"workbench.editor.enablePreviewFromQuickOpen":{type:"boolean",markdownDescription:h(3640,"Controls whether editors opened from Quick Open show as preview editors. Preview editors do not stay open, and are reused until explicitly set to be kept open (via double-click or editing). When enabled, hold Ctrl before selection to open an editor as a non-preview. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.enablePreviewFromCodeNavigation":{type:"boolean",markdownDescription:h(3641,"Controls whether editors remain in preview when a code navigation is started from them. Preview editors do not stay open, and are reused until explicitly set to be kept open (via double-click or editing). This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.closeOnFileDelete":{type:"boolean",description:h(3642,"Controls whether editors showing a file that was opened during the session should close automatically when getting deleted or renamed by some other process. Disabling this will keep the editor open  on such an event. Note that deleting from within the application will always close the editor and that editors with unsaved changes will never close to preserve your data."),default:!1},"workbench.editor.openPositioning":{type:"string",enum:["left","right","first","last"],default:"right",markdownDescription:h(3643,"Controls where editors open. Select {0} or {1} to open editors to the left or right of the currently active one. Select {2} or {3} to open editors independently from the currently active one.","`left`","`right`","`first`","`last`")},"workbench.editor.openSideBySideDirection":{type:"string",enum:["right","down"],default:"right",markdownDescription:h(3644,"Controls the default direction of editors that are opened side by side (for example, from the Explorer). By default, editors will open on the right hand side of the currently active one. If changed to `down`, the editors will open below the currently active one.")},"workbench.editor.closeEmptyGroups":{type:"boolean",description:h(3645,"Controls the behavior of empty editor groups when the last tab in the group is closed. When enabled, empty groups will automatically close. When disabled, empty groups will remain part of the grid."),default:!0},"workbench.editor.revealIfOpen":{type:"boolean",description:h(3646,"Controls whether an editor is revealed in any of the visible groups if opened. If disabled, an editor will prefer to open in the currently active editor group. If enabled, an already opened editor will be revealed instead of opened again in the currently active editor group. Note that there are some cases where this setting is ignored, such as when forcing an editor to open in a specific group or to the side of the currently active group."),default:!1},"workbench.editor.mouseBackForwardToNavigate":{type:"boolean",description:h(3647,"Enables the use of mouse buttons four and five for commands 'Go Back' and 'Go Forward'."),default:!0},"workbench.editor.navigationScope":{type:"string",enum:["default","editorGroup","editor"],default:"default",markdownDescription:h(3648,"Controls the scope of history navigation in editors for commands such as 'Go Back' and 'Go Forward'."),enumDescriptions:[h(3649,"Navigate across all opened editors and editor groups."),h(3650,"Navigate only in editors of the active editor group."),h(3651,"Navigate only in the active editor.")]},"workbench.editor.restoreViewState":{type:"boolean",markdownDescription:h(3652,"Restores the last editor view state (such as scroll position) when re-opening editors after they have been closed. Editor view state is stored per editor group and discarded when a group closes. Use the {0} setting to use the last known view state across all editor groups in case no previous view state was found for a editor group.","`#workbench.editor.sharedViewState#`"),default:!0,scope:Bt.LANGUAGE_OVERRIDABLE},"workbench.editor.sharedViewState":{type:"boolean",description:h(3653,"Preserves the most recent editor view state (such as scroll position) across all editor groups and restores that if no specific editor view state is found for the editor group."),default:!1},"workbench.editor.splitInGroupLayout":{type:"string",enum:["vertical","horizontal"],default:"horizontal",markdownDescription:h(3654,"Controls the layout for when an editor is split in an editor group to be either vertical or horizontal."),enumDescriptions:[h(3655,"Editors are positioned from top to bottom."),h(3656,"Editors are positioned from left to right.")]},"workbench.editor.centeredLayoutAutoResize":{type:"boolean",default:!0,description:h(3657,"Controls if the centered layout should automatically resize to maximum width when more than one group is open. Once only one group is open it will resize back to the original centered width.")},"workbench.editor.centeredLayoutFixedWidth":{type:"boolean",default:!1,description:h(3658,"Controls whether the centered layout tries to maintain constant width when the window is resized.")},"workbench.editor.doubleClickTabToToggleEditorGroupSizes":{type:"string",enum:["maximize","expand","off"],default:"expand",markdownDescription:h(3659,"Controls how the editor group is resized when double clicking on a tab. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),enumDescriptions:[h(3660,"All other editor groups are hidden and the current editor group is maximized to take up the entire editor area."),h(3661,"The editor group takes as much space as possible by making all other editor groups as small as possible."),h(3662,"No editor group is resized when double clicking on a tab.")]},"workbench.editor.limit.enabled":{type:"boolean",default:!1,description:h(3663,"Controls if the number of opened editors should be limited or not. When enabled, less recently used editors will close to make space for newly opening editors.")},"workbench.editor.limit.value":{type:"number",default:10,exclusiveMinimum:0,markdownDescription:h(3664,"Controls the maximum number of opened editors. Use the {0} setting to control this limit per editor group or across all groups.","`#workbench.editor.limit.perEditorGroup#`")},"workbench.editor.limit.excludeDirty":{type:"boolean",default:!1,description:h(3665,"Controls if the maximum number of opened editors should exclude dirty editors for counting towards the configured limit.")},"workbench.editor.limit.perEditorGroup":{type:"boolean",default:!1,description:h(3666,"Controls if the limit of maximum opened editors should apply per editor group or across all editor groups.")},"workbench.localHistory.enabled":{type:"boolean",default:!0,description:h(3667,"Controls whether local file history is enabled. When enabled, the file contents of an editor that is saved will be stored to a backup location to be able to restore or review the contents later. Changing this setting has no effect on existing local file history entries."),scope:Bt.RESOURCE},"workbench.localHistory.maxFileSize":{type:"number",default:256,minimum:1,description:h(3668,"Controls the maximum size of a file (in KB) to be considered for local file history. Files that are larger will not be added to the local file history. Changing this setting has no effect on existing local file history entries."),scope:Bt.RESOURCE},"workbench.localHistory.maxFileEntries":{type:"number",default:50,minimum:0,description:h(3669,"Controls the maximum number of local file history entries per file. When the number of local file history entries exceeds this number for a file, the oldest entries will be discarded."),scope:Bt.RESOURCE},"workbench.localHistory.exclude":{type:"object",patternProperties:{".*":{type:"boolean"}},markdownDescription:h(3670,"Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) for excluding files from the local file history. Glob patterns are always evaluated relative to the path of the workspace folder unless they are absolute paths. Changing this setting has no effect on existing local file history entries."),scope:Bt.RESOURCE},"workbench.localHistory.mergeWindow":{type:"number",default:10,minimum:1,markdownDescription:h(3671,"Configure an interval in seconds during which the last entry in local file history is replaced with the entry that is being added. This helps reduce the overall number of entries that are added, for example when auto save is enabled. This setting is only applied to entries that have the same source of origin. Changing this setting has no effect on existing local file history entries."),scope:Bt.RESOURCE},"workbench.commandPalette.history":{type:"number",description:h(3672,"Controls the number of recently used commands to keep in history for the command palette. Set to 0 to disable command history."),default:50,minimum:0},"workbench.commandPalette.preserveInput":{type:"boolean",description:h(3673,"Controls whether the last typed input to the command palette should be restored when opening it the next time."),default:!1},"workbench.commandPalette.experimental.suggestCommands":{type:"boolean",tags:["experimental"],description:h(3674,"Controls whether the command palette should have a list of commonly used commands."),default:!1},"workbench.commandPalette.experimental.askChatLocation":{type:"string",tags:["experimental"],description:h(3675,"Controls where the command palette should ask chat questions."),default:"chatView",enum:["chatView","quickChat"],enumDescriptions:[h(3676,"Ask chat questions in the Chat view."),h(3677,"Ask chat questions in Quick Chat.")]},"workbench.commandPalette.experimental.enableNaturalLanguageSearch":{type:"boolean",tags:["experimental"],description:h(3678,"Controls whether the command palette should include similar commands. You must have an extension installed that provides Natural Language support."),default:!0},"workbench.quickOpen.closeOnFocusLost":{type:"boolean",description:h(3679,"Controls whether Quick Open should close automatically once it loses focus."),default:!0},"workbench.quickOpen.preserveInput":{type:"boolean",description:h(3680,"Controls whether the last typed input to Quick Open should be restored when opening it the next time."),default:!1},"workbench.settings.openDefaultSettings":{type:"boolean",description:h(3681,"Controls whether opening settings also opens an editor showing all default settings."),default:!1},"workbench.settings.useSplitJSON":{type:"boolean",markdownDescription:h(3682,"Controls whether to use the split JSON editor when editing settings as JSON."),default:!1},"workbench.settings.openDefaultKeybindings":{type:"boolean",description:h(3683,"Controls whether opening keybinding settings also opens an editor showing all default keybindings."),default:!1},"workbench.sideBar.location":{type:"string",enum:["left","right"],default:"left",description:h(3684,"Controls the location of the primary side bar and activity bar. They can either show on the left or right of the workbench. The secondary side bar will show on the opposite side of the workbench.")},"workbench.panel.showLabels":{type:"boolean",default:!0,description:h(3685,"Controls whether activity items in the panel title are shown as label or icon.")},"workbench.panel.defaultLocation":{type:"string",enum:["left","bottom","top","right"],default:"bottom",description:h(3686,"Controls the default location of the panel (Terminal, Debug Console, Output, Problems) in a new workspace. It can either show at the bottom, top, right, or left of the editor area.")},"workbench.panel.opensMaximized":{type:"string",enum:["always","never","preserve"],default:"preserve",description:h(3687,"Controls whether the panel opens maximized. It can either always open maximized, never open maximized, or open to the last state it was in before being closed."),enumDescriptions:[h(3688,"Always maximize the panel when opening it."),h(3689,"Never maximize the panel when opening it. The panel will open un-maximized."),h(3690,"Open the panel to the state that it was in, before it was closed.")]},"workbench.secondarySideBar.defaultVisibility":{type:"string",enum:["hidden","visibleInWorkspace","visible"],default:"hidden",tags:["onExp"],description:h(3691,"Controls the default visibility of the secondary side bar in workspaces or empty windows opened for the first time."),enumDescriptions:[h(3692,"The secondary side bar is hidden by default."),h(3693,"The secondary side bar is visible by default if a workspace is opened."),h(3694,"The secondary side bar is visible by default.")]},"workbench.secondarySideBar.showLabels":{type:"boolean",default:!0,markdownDescription:h(3695,"Controls whether activity items in the secondary side bar title are shown as label or icon. This setting only has an effect when {0} is not set to {1}.","`#workbench.activityBar.location#`","`top`")},"workbench.statusBar.visible":{type:"boolean",default:!0,description:h(3696,"Controls the visibility of the status bar at the bottom of the workbench.")},[si.ACTIVITY_BAR_LOCATION]:{type:"string",enum:["default","top","bottom","hidden"],default:"default",markdownDescription:h(3697,"Controls the location of the Activity Bar relative to the Primary and Secondary Side Bars."),enumDescriptions:[h(3698,"Show the Activity Bar on the side of the Primary Side Bar and on top of the Secondary Side Bar."),h(3699,"Show the Activity Bar on top of the Primary and Secondary Side Bars."),h(3700,"Show the Activity Bar at the bottom of the Primary and Secondary Side Bars."),h(3701,"Hide the Activity Bar in the Primary and Secondary Side Bars.")]},"workbench.activityBar.iconClickBehavior":{type:"string",enum:["toggle","focus"],default:"toggle",markdownDescription:h(3702,"Controls the behavior of clicking an Activity Bar icon in the workbench. This value is ignored when {0} is not set to {1}.","`#workbench.activityBar.location#`","`default`"),enumDescriptions:[h(3703,"Hide the Primary Side Bar if the clicked item is already visible."),h(3704,"Focus the Primary Side Bar if the clicked item is already visible.")]},"workbench.view.alwaysShowHeaderActions":{type:"boolean",default:!1,description:h(3705,"Controls the visibility of view header actions. View header actions may either be always visible, or only visible when that view is focused or hovered over.")},"workbench.view.showQuietly":{type:"object",description:h(3706,"If an extension requests a hidden view to be shown, display a clickable status bar indicator instead."),scope:Bt.WINDOW,properties:{"workbench.panel.output":{type:"boolean",description:h(3707,"Output view")}},additionalProperties:!1},"workbench.fontAliasing":{type:"string",enum:["default","antialiased","none","auto"],default:"default",description:h(3708,"Controls font aliasing method in the workbench."),enumDescriptions:[h(3709,"Sub-pixel font smoothing. On most non-retina displays this will give the sharpest text."),h(3710,"Smooth the font on the level of the pixel, as opposed to the subpixel. Can make the font appear lighter overall."),h(3711,"Disables font smoothing. Text will show with jagged sharp edges."),h(3712,"Applies `default` or `antialiased` automatically based on the DPI of displays.")],included:qt},"workbench.settings.editor":{type:"string",enum:["ui","json"],enumDescriptions:[h(3713,"Use the settings UI editor."),h(3714,"Use the JSON file editor.")],description:h(3715,"Determines which Settings editor to use by default."),default:"ui",scope:Bt.WINDOW},"workbench.settings.showAISearchToggle":{type:"boolean",default:Io.quality!=="stable",description:h(3716,"Controls whether the AI search toggle is shown in the search bar in the Settings editor."),tags:["experimental","onExP"]},"workbench.hover.delay":{type:"number",description:h(3717,"Controls the delay in milliseconds after which the hover is shown for workbench items (ex. some extension provided tree view items). Already visible items may require a refresh before reflecting this setting change."),default:qt?1500:500,minimum:0},"workbench.reduceMotion":{type:"string",description:h(3718,"Controls whether the workbench should render with fewer animations."),enumDescriptions:[h(3719,"Always render with reduced motion."),h(3720,"Do not render with reduced motion"),h(3721,"Render with reduced motion based on OS configuration.")],default:"auto",tags:["accessibility"],enum:["on","off","auto"]},"workbench.navigationControl.enabled":{type:"boolean",default:!0,markdownDescription:$t?h(3722,"Controls whether the navigation control in the title bar is shown."):h(3723,"Controls whether the navigation control is shown in the custom title bar. This setting only has an effect when {0} is not set to {1}.","`#window.customTitleBarVisibility#`","`never`")},[si.LAYOUT_ACTIONS]:{type:"boolean",default:!0,markdownDescription:$t?h(3724,"Controls whether the layout control in the title bar is shown."):h(3725,"Controls whether the layout control is shown in the custom title bar. This setting only has an effect when {0} is not set to {1}.","`#window.customTitleBarVisibility#`","`never`")},"workbench.layoutControl.type":{type:"string",enum:["menu","toggles","both"],enumDescriptions:[h(3726,"Shows a single button with a dropdown of layout options."),h(3727,"Shows several buttons for toggling the visibility of the panels and side bar."),h(3728,"Shows both the dropdown and toggle buttons.")],default:"both",description:h(3729,"Controls whether the layout control in the custom title bar is displayed as a single menu button or with multiple UI toggles.")},"workbench.tips.enabled":{type:"boolean",default:!0,description:h(3730,"When enabled, will show the watermark tips when no editor is open.")}}});let e=h(3731,"Controls the window title based on the current context such as the opened workspace or active editor. Variables are substituted based on the context:");e+=`
- `+[h(3732,"`${activeEditorShort}`: the file name (e.g. myFile.txt)."),h(3733,"`${activeEditorMedium}`: the path of the file relative to the workspace folder (e.g. myFolder/myFileFolder/myFile.txt)."),h(3734,"`${activeEditorLong}`: the full path of the file (e.g. /Users/Development/myFolder/myFileFolder/myFile.txt)."),h(3735,"`${activeFolderShort}`: the name of the folder the file is contained in (e.g. myFileFolder)."),h(3736,"`${activeFolderMedium}`: the path of the folder the file is contained in, relative to the workspace folder (e.g. myFolder/myFileFolder)."),h(3737,"`${activeFolderLong}`: the full path of the folder the file is contained in (e.g. /Users/Development/myFolder/myFileFolder)."),h(3738,"`${folderName}`: name of the workspace folder the file is contained in (e.g. myFolder)."),h(3739,"`${folderPath}`: file path of the workspace folder the file is contained in (e.g. /Users/Development/myFolder)."),h(3740,"`${rootName}`: name of the workspace with optional remote name and workspace indicator if applicable (e.g. myFolder, myRemoteFolder [SSH] or myWorkspace (Workspace))."),h(3741,"`${rootNameShort}`: shortened name of the workspace without suffixes (e.g. myFolder, myRemoteFolder or myWorkspace)."),h(3742,"`${rootPath}`: file path of the opened workspace or folder (e.g. /Users/Development/myWorkspace)."),h(3743,"`${profileName}`: name of the profile in which the workspace is opened (e.g. Data Science (Profile)). Ignored if default profile is used."),h(3744,"`${appName}`: e.g. VS Code."),h(3745,"`${remoteName}`: e.g. SSH"),h(3746,"`${dirty}`: an indicator for when the active editor has unsaved changes."),h(3747,"`${focusedView}`: the name of the view that is currently focused."),h(3748,"`${activeRepositoryName}`: the name of the active repository (e.g. vscode)."),h(3749,"`${activeRepositoryBranchName}`: the name of the active branch in the active repository (e.g. main)."),h(3750,"`${activeEditorState}`: provides information about the state of the active editor (e.g. modified). This will be appended by default when in screen reader mode with {0} enabled.","`accessibility.windowTitleOptimized`"),h(3751,'`${separator}`: a conditional separator (" - ") that only shows when surrounded by variables with values or static text.')].join(`
- `),gk.registerConfiguration({...LCe,properties:{"window.title":{type:"string",default:jpe,markdownDescription:e},"window.titleSeparator":{type:"string",default:Ype,markdownDescription:h(3752,"Separator used by {0}.","`#window.title#`")},[si.COMMAND_CENTER]:{type:"boolean",default:!0,markdownDescription:$t?h(3753,"Show command launcher together with the window title."):h(3754,"Show command launcher together with the window title. This setting only has an effect when {0} is not set to {1}.","`#window.customTitleBarVisibility#`","`never`")},"window.menuBarVisibility":{type:"string",enum:["classic","visible","toggle","hidden","compact"],markdownEnumDescriptions:[h(3755,"Menu is displayed at the top of the window and only hidden in full screen mode."),h(3756,"Menu is always visible at the top of the window even in full screen mode."),qt?h(3757,"Menu is hidden but can be displayed at the top of the window by executing the `Focus Application Menu` command."):h(3758,"Menu is hidden but can be displayed at the top of the window via the Alt key."),h(3759,"Menu is always hidden."),$t?h(3760,"Menu is displayed as a compact button in the side bar."):h(3761,"Menu is displayed as a compact button in the side bar. This value is ignored when {0} is {1} and {2} is either {3} or {4}.","`#window.titleBarStyle#`","`native`","`#window.menuStyle#`","`native`","`inherit`")],default:$t?"compact":"classic",scope:Bt.APPLICATION,markdownDescription:qt?h(3762,"Control the visibility of the menu bar. A setting of 'toggle' means that the menu bar is hidden and executing `Focus Application Menu` will show it. A setting of 'compact' will move the menu into the side bar."):h(3763,"Control the visibility of the menu bar. A setting of 'toggle' means that the menu bar is hidden and a single press of the Alt key will show it. A setting of 'compact' will move the menu into the side bar."),included:pn||vh||$t},"window.enableMenuBarMnemonics":{type:"boolean",default:!0,scope:Bt.APPLICATION,description:h(3764,"Controls whether the main menus can be opened via Alt-key shortcuts. Disabling mnemonics allows to bind these Alt-key shortcuts to editor commands instead."),included:pn||vh},"window.customMenuBarAltFocus":{type:"boolean",default:!0,scope:Bt.APPLICATION,markdownDescription:h(3765,"Controls whether the menu bar will be focused by pressing the Alt-key. This setting has no effect on toggling the menu bar with the Alt-key."),included:pn||vh},"window.openFilesInNewWindow":{type:"string",enum:["on","off","default"],enumDescriptions:[h(3766,"Files will open in a new window."),h(3767,"Files will open in the window with the files' folder open or the last active window."),qt?h(3768,"Files will open in the window with the files' folder open or the last active window unless opened via the Dock or from Finder."):h(3769,"Files will open in a new window unless picked from within the application (e.g. via the File menu).")],default:"off",scope:Bt.APPLICATION,markdownDescription:qt?h(3770,"Controls whether files should open in a new window when using a command line or file dialog.\nNote that there can still be cases where this setting is ignored (e.g. when using the `--new-window` or `--reuse-window` command line option)."):h(3771,"Controls whether files should open in a new window when using a command line or file dialog.\nNote that there can still be cases where this setting is ignored (e.g. when using the `--new-window` or `--reuse-window` command line option).")},"window.openFoldersInNewWindow":{type:"string",enum:["on","off","default"],enumDescriptions:[h(3772,"Folders will open in a new window."),h(3773,"Folders will replace the last active window."),h(3774,"Folders will open in a new window unless a folder is picked from within the application (e.g. via the File menu).")],default:"default",scope:Bt.APPLICATION,markdownDescription:h(3775,"Controls whether folders should open in a new window or replace the last active window.\nNote that there can still be cases where this setting is ignored (e.g. when using the `--new-window` or `--reuse-window` command line option).")},"window.confirmBeforeClose":{type:"string",enum:["always","keyboardOnly","never"],enumDescriptions:[$t?h(3776,"Always try to ask for confirmation. Note that browsers may still decide to close a tab or window without confirmation."):h(3777,"Always ask for confirmation."),$t?h(3778,"Only ask for confirmation if a keybinding was used to close the window. Note that detection may not be possible in some cases."):h(3779,"Only ask for confirmation if a keybinding was used."),$t?h(3780,"Never explicitly ask for confirmation unless data loss is imminent."):h(3781,"Never explicitly ask for confirmation.")],default:$t&&!Mwe()?"keyboardOnly":"never",markdownDescription:$t?h(3782,"Controls whether to show a confirmation dialog before closing the browser tab or window. Note that even if enabled, browsers may still decide to close a tab or window without confirmation and that this setting is only a hint that may not work in all cases."):h(3783,"Controls whether to show a confirmation dialog before closing a window or quitting the application."),scope:Bt.APPLICATION}}}),sc(m6.ID,m6,oc.Eventually),gk.registerConfiguration({...MCe,properties:{"problems.visibility":{type:"boolean",default:!0,description:h(3784,"Controls whether the problems are visible throughout the editor and workbench.")}}}),gk.registerConfiguration({id:"zenMode",order:9,title:h(3785,"Zen Mode"),type:"object",properties:{"zenMode.fullScreen":{type:"boolean",default:!0,description:h(3786,"Controls whether turning on Zen Mode also puts the workbench into full screen mode.")},"zenMode.centerLayout":{type:"boolean",default:!0,description:h(3787,"Controls whether turning on Zen Mode also centers the layout.")},"zenMode.showTabs":{type:"string",enum:["multiple","single","none"],description:h(3788,"Controls whether turning on Zen Mode should show multiple editor tabs, a single editor tab, or hide the editor title area completely."),enumDescriptions:[h(3789,"Each editor is displayed as a tab in the editor title area."),h(3790,"The active editor is displayed as a single large tab in the editor title area."),h(3791,"The editor title area is not displayed.")],default:"multiple"},"zenMode.hideStatusBar":{type:"boolean",default:!0,description:h(3792,"Controls whether turning on Zen Mode also hides the status bar at the bottom of the workbench.")},"zenMode.hideActivityBar":{type:"boolean",default:!0,description:h(3793,"Controls whether turning on Zen Mode also hides the activity bar either at the left or right of the workbench.")},"zenMode.hideLineNumbers":{type:"boolean",default:!0,description:h(3794,"Controls whether turning on Zen Mode also hides the editor line numbers.")},"zenMode.restore":{type:"boolean",default:!0,description:h(3795,"Controls whether a window should restore to Zen Mode if it was exited in Zen Mode.")},"zenMode.silentNotifications":{type:"boolean",default:!0,description:h(3796,"Controls whether notifications do not disturb mode should be enabled while in Zen Mode. If true, only error notifications will pop out.")}}})})();Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"workbench.activityBar.visible",migrateFn:s=>{const e=[];return s!==void 0&&e.push(["workbench.activityBar.visible",{value:void 0}]),s===!1&&e.push([si.ACTIVITY_BAR_LOCATION,{value:jo.HIDDEN}]),e}}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:si.ACTIVITY_BAR_LOCATION,migrateFn:s=>{const e=[];return s==="side"&&e.push([si.ACTIVITY_BAR_LOCATION,{value:jo.DEFAULT}]),e}}]);Ge.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"workbench.editor.doubleClickTabToToggleEditorGroupSizes",migrateFn:s=>{const e=[];return typeof s=="boolean"&&(s=s?"expand":"off",e.push(["workbench.editor.doubleClickTabToToggleEditorGroupSizes",{value:s}])),e}},{key:si.EDITOR_TABS_MODE,migrateFn:s=>{const e=[];return typeof s=="boolean"&&(s=s?lo.MULTIPLE:lo.SINGLE,e.push([si.EDITOR_TABS_MODE,{value:s}])),e}},{key:"workbench.editor.tabCloseButton",migrateFn:s=>{const e=[];return s==="left"||s==="right"?e.push(["workbench.editor.tabActionLocation",{value:s}]):s==="off"&&e.push(["workbench.editor.tabActionCloseVisibility",{value:!1}]),e}},{key:"zenMode.hideTabs",migrateFn:s=>{const e=[["zenMode.hideTabs",{value:void 0}]];return s===!0&&e.push(["zenMode.showTabs",{value:"single"}]),e}}]);let Qpe=()=>!1,Xpe=()=>!1;const Mze=xv.prototype.getCommandPicks;xv.prototype.getCommandPicks=async function(s){let e=await Mze.call(this,s);return Qpe()||(e=e.map(t=>({...t,buttons:void 0}))),e};let GG=class{constructor(e){this.instantiationService=e,this.workbenchQuickInputService=e.createInstance(WG)}toggleHover(){return this.activeService.toggleHover()}get activeService(){const e=Ya.get(Ot).getFocusedCodeEditor();return e==null||Xpe(e,e instanceof Bse)?this.workbenchQuickInputService:(this.standaloneQuickInputService??(this.standaloneQuickInputService=this.instantiationService.createInstance(Nwe)),this.standaloneQuickInputService)}get currentQuickInput(){return this.activeService.currentQuickInput}get quickAccess(){return this.activeService.quickAccess}get backButton(){return this.activeService.backButton}get onShow(){return this.activeService.onShow}get onHide(){return this.activeService.onHide}createQuickWidget(){return this.activeService.createQuickWidget()}pick(e,t={},i=ye.None){return this.activeService.pick(e,t,i)}input(e,t){return this.activeService.input(e,t)}createQuickPick(e={useSeparators:!1}){return this.activeService.createQuickPick(e)}createInputBox(){return this.activeService.createInputBox()}focus(){return this.activeService.focus()}toggle(){return this.activeService.toggle()}navigate(e,t){return this.activeService.navigate(e,t)}accept(){return this.activeService.accept()}back(){return this.activeService.back()}cancel(){return this.activeService.cancel()}setAlignment(e){return this.activeService.setAlignment(e)}};GG=f([p(0,J)],GG);function Nze({isKeybindingConfigurationVisible:s,shouldUseGlobalPicker:e}={}){return s!=null&&(Qpe=s),e!=null&&(Xpe=e),{[zt.toString()]:new _r(GG,[],!0)}}const gie=/^([^.]+\..+)[:=](.+)$/;class Oe{get remoteAuthority(){return this.options.remoteAuthority}get expectsResolverExtension(){return!!this.options.remoteAuthority?.includes("+")&&!this.options.webSocketFactory}get isBuilt(){return!!this.productService.commit}get logLevel(){const e=this.payload?.get("logLevel");return e?e.split(",").find(t=>!gie.test(t)):this.options.developmentOptions?.logLevel!==void 0?VF(this.options.developmentOptions?.logLevel):void 0}get extensionLogLevel(){const e=this.payload?.get("logLevel");if(e){const t=[];for(const i of e.split(",")){const n=gie.exec(i);n&&n[1]&&n[2]&&t.push([n[1],n[2]])}return t.length?t:void 0}return this.options.developmentOptions?.extensionLogLevel!==void 0?this.options.developmentOptions?.extensionLogLevel.map(([t,i])=>[t,VF(i)]):void 0}get profDurationMarkers(){const e=this.payload?.get("profDurationMarkers");if(e){const t=[];for(const i of e.split(","))t.push(i);return t.length===2?t:void 0}}get windowLogsPath(){return this.logsHome}get logFile(){return xt(this.windowLogsPath,"window.log")}get userRoamingDataHome(){return R.file("/User").with({scheme:ae.vscodeUserData})}get argvResource(){return xt(this.userRoamingDataHome,"argv.json")}get cacheHome(){return xt(this.userRoamingDataHome,"caches")}get workspaceStorageHome(){return xt(this.userRoamingDataHome,"workspaceStorage")}get localHistoryHome(){return xt(this.userRoamingDataHome,"History")}get stateResource(){return xt(this.userRoamingDataHome,"State","storage.json")}get userDataSyncHome(){return xt(this.userRoamingDataHome,"sync",this.workspaceId)}get sync(){}get keyboardLayoutResource(){return xt(this.userRoamingDataHome,"keyboardLayout.json")}get untitledWorkspacesHome(){return xt(this.userRoamingDataHome,"Workspaces")}get serviceMachineIdResource(){return xt(this.userRoamingDataHome,"machineid")}get extHostLogsPath(){return xt(this.logsHome,"exthost")}get debugExtensionHost(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.params}get isExtensionDevelopment(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.isExtensionDevelopment}get extensionDevelopmentLocationURI(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionDevelopmentLocationURI}get extensionDevelopmentLocationKind(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionDevelopmentKind}get extensionTestsLocationURI(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionTestsLocationURI}get extensionEnabledProposedApi(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionEnabledProposedApi}get debugRenderer(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.debugRenderer}get enableSmokeTestDriver(){return this.options.developmentOptions?.enableSmokeTestDriver}get disableExtensions(){return this.payload?.get("disableExtensions")==="true"}get enableExtensions(){return this.options.enabledExtensions}get webviewExternalEndpoint(){const e=this.options.webviewEndpoint||this.productService.webviewContentExternalBaseUrlTemplate||"https://{{uuid}}.vscode-cdn.net/{{quality}}/{{commit}}/out/vs/workbench/contrib/webview/browser/pre/",t=this.payload?.get("webviewExternalEndpointCommit");return e.replace("{{commit}}",t??this.productService.commit??"ef65ac1ba57f57f2a3961bfe94aa20481caca4c6").replace("{{quality}}",(t?"insider":this.productService.quality)??"insider")}get extensionTelemetryLogResource(){return xt(this.logsHome,"extensionTelemetry.log")}get disableTelemetry(){return!1}get verbose(){return this.payload?.get("verbose")==="true"}get logExtensionHostCommunication(){return this.payload?.get("logExtensionHostCommunication")==="true"}get skipReleaseNotes(){return this.payload?.get("skipReleaseNotes")==="true"}get skipWelcome(){return this.payload?.get("skipWelcome")==="true"}get disableWorkspaceTrust(){return!this.options.enableWorkspaceTrust}get profile(){return this.payload?.get("profile")}get editSessionId(){return this.options.editSessionId}constructor(e,t,i,n){if(this.workspaceId=e,this.logsHome=t,this.options=i,this.productService=n,this.extensionHostDebugEnvironment=void 0,i.workspaceProvider&&Array.isArray(i.workspaceProvider.payload))try{this.payload=new Map(i.workspaceProvider.payload)}catch(o){mt(o)}}resolveExtensionHostDebugEnvironment(){const e={params:{port:null,break:!1},debugRenderer:!1,isExtensionDevelopment:!1,extensionDevelopmentLocationURI:void 0,extensionDevelopmentKind:void 0};if(this.payload)for(const[i,n]of this.payload)switch(i){case"extensionDevelopmentPath":e.extensionDevelopmentLocationURI||(e.extensionDevelopmentLocationURI=[]),e.extensionDevelopmentLocationURI.push(R.parse(n)),e.isExtensionDevelopment=!0;break;case"extensionDevelopmentKind":e.extensionDevelopmentKind=[n];break;case"extensionTestsPath":e.extensionTestsLocationURI=R.parse(n);break;case"debugRenderer":e.debugRenderer=n==="true";break;case"debugId":e.params.debugId=n;break;case"inspect-brk-extensions":e.params.port=parseInt(n),e.params.break=!0;break;case"inspect-extensions":e.params.port=parseInt(n);break;case"enableProposedApi":e.extensionEnabledProposedApi=[];break}const t=this.options.developmentOptions;return t&&!e.isExtensionDevelopment&&(t.extensions?.length&&(e.extensionDevelopmentLocationURI=t.extensions.map(i=>R.revive(i)),e.isExtensionDevelopment=!0),t.extensionTestsPath&&(e.extensionTestsLocationURI=R.revive(t.extensionTestsPath))),e}get filesToOpenOrCreate(){if(this.payload){const e=this.payload.get("openFile");if(e){const t=R.parse(e);if(this.payload.has("gotoLineMode")){const i=Sse(t.path);return[{fileUri:t.with({path:i.path}),options:{selection:Gm(i.line)?void 0:{startLineNumber:i.line,startColumn:i.column||1}}}]}return[{fileUri:t}]}}}get filesToDiff(){if(this.payload){const e=this.payload.get("diffFilePrimary"),t=this.payload.get("diffFileSecondary");if(e&&t)return[{fileUri:R.parse(t)},{fileUri:R.parse(e)}]}}get filesToMerge(){if(this.payload){const e=this.payload.get("mergeFile1"),t=this.payload.get("mergeFile2"),i=this.payload.get("mergeFileBase"),n=this.payload.get("mergeFileResult");if(e&&t&&i&&n)return[{fileUri:R.parse(e)},{fileUri:R.parse(t)},{fileUri:R.parse(i)},{fileUri:R.parse(n)}]}}}Oe.__decorator=f([Ht],Oe.prototype,"remoteAuthority",null);Oe.__decorator=f([Ht],Oe.prototype,"expectsResolverExtension",null);Oe.__decorator=f([Ht],Oe.prototype,"isBuilt",null);Oe.__decorator=f([Ht],Oe.prototype,"logLevel",null);Oe.__decorator=f([Ht],Oe.prototype,"windowLogsPath",null);Oe.__decorator=f([Ht],Oe.prototype,"logFile",null);Oe.__decorator=f([Ht],Oe.prototype,"userRoamingDataHome",null);Oe.__decorator=f([Ht],Oe.prototype,"argvResource",null);Oe.__decorator=f([Ht],Oe.prototype,"cacheHome",null);Oe.__decorator=f([Ht],Oe.prototype,"workspaceStorageHome",null);Oe.__decorator=f([Ht],Oe.prototype,"localHistoryHome",null);Oe.__decorator=f([Ht],Oe.prototype,"stateResource",null);Oe.__decorator=f([Ht],Oe.prototype,"userDataSyncHome",null);Oe.__decorator=f([Ht],Oe.prototype,"sync",null);Oe.__decorator=f([Ht],Oe.prototype,"keyboardLayoutResource",null);Oe.__decorator=f([Ht],Oe.prototype,"untitledWorkspacesHome",null);Oe.__decorator=f([Ht],Oe.prototype,"serviceMachineIdResource",null);Oe.__decorator=f([Ht],Oe.prototype,"extHostLogsPath",null);Oe.__decorator=f([Ht],Oe.prototype,"debugExtensionHost",null);Oe.__decorator=f([Ht],Oe.prototype,"isExtensionDevelopment",null);Oe.__decorator=f([Ht],Oe.prototype,"extensionDevelopmentLocationURI",null);Oe.__decorator=f([Ht],Oe.prototype,"extensionDevelopmentLocationKind",null);Oe.__decorator=f([Ht],Oe.prototype,"extensionTestsLocationURI",null);Oe.__decorator=f([Ht],Oe.prototype,"extensionEnabledProposedApi",null);Oe.__decorator=f([Ht],Oe.prototype,"debugRenderer",null);Oe.__decorator=f([Ht],Oe.prototype,"enableSmokeTestDriver",null);Oe.__decorator=f([Ht],Oe.prototype,"disableExtensions",null);Oe.__decorator=f([Ht],Oe.prototype,"enableExtensions",null);Oe.__decorator=f([Ht],Oe.prototype,"webviewExternalEndpoint",null);Oe.__decorator=f([Ht],Oe.prototype,"extensionTelemetryLogResource",null);Oe.__decorator=f([Ht],Oe.prototype,"disableTelemetry",null);Oe.__decorator=f([Ht],Oe.prototype,"verbose",null);Oe.__decorator=f([Ht],Oe.prototype,"logExtensionHostCommunication",null);Oe.__decorator=f([Ht],Oe.prototype,"skipReleaseNotes",null);Oe.__decorator=f([Ht],Oe.prototype,"skipWelcome",null);Oe.__decorator=f([Ht],Oe.prototype,"disableWorkspaceTrust",null);Oe.__decorator=f([Ht],Oe.prototype,"profile",null);Oe.__decorator=f([Ht],Oe.prototype,"editSessionId",null);Oe.__decorator=f([Ht],Oe.prototype,"filesToOpenOrCreate",null);Oe.__decorator=f([Ht],Oe.prototype,"filesToDiff",null);Oe.__decorator=f([Ht],Oe.prototype,"filesToMerge",null);let qG=class extends Oe{constructor(e=Owe().id,t=Fwe(),i){super(e,Wwe,t,i)}};qG=f([p(2,Fn)],qG);function Oze(s){return{[po.toString()]:new _r(qG,[void 0,s],!0)}}const Fze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(Fze);class Wze extends KO{get dimension(){return this._dimension}get contentPosition(){return this._contentPosition}constructor(e,t,i,n,o){super(e,i,n),this.options=t,this.layoutService=o,this._onDidVisibilityChange=this._register(new M),this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onDidChange=this._register(new M),this._register(o.registerPart(this))}onThemeChange(e){this.parent&&super.onThemeChange(e)}create(e,t){this.parent=e,this.titleArea=this.createTitleArea(e,t),this.contentArea=this.createContentArea(e,t),this.partLayout=new fE(this.options,this.contentArea),this.updateStyles()}getContainer(){return this.parent}createTitleArea(e,t){}getTitleArea(){return this.titleArea}createContentArea(e,t){}getContentArea(){return this.contentArea}setHeaderArea(e){if(this.headerArea)throw new Error("Header already exists");!this.parent||!this.titleArea||(Bwe(this.parent,e),e.classList.add("header-or-footer"),e.classList.add("header"),this.headerArea=e,this.partLayout?.setHeaderVisibility(!0),this.relayout())}setFooterArea(e){if(this.footerArea)throw new Error("Footer already exists");!this.parent||!this.titleArea||(this.parent.appendChild(e),e.classList.add("header-or-footer"),e.classList.add("footer"),this.footerArea=e,this.partLayout?.setFooterVisibility(!0),this.relayout())}removeHeaderArea(){this.headerArea&&(this.headerArea.remove(),this.headerArea=void 0,this.partLayout?.setHeaderVisibility(!1),this.relayout())}removeFooterArea(){this.footerArea&&(this.footerArea.remove(),this.footerArea=void 0,this.partLayout?.setFooterVisibility(!1),this.relayout())}relayout(){this.dimension&&this.contentPosition&&this.layout(this.dimension.width,this.dimension.height,this.contentPosition.top,this.contentPosition.left)}layoutContents(e,t){return Gt(this.partLayout).layout(e,t)}get onDidChange(){return this._onDidChange.event}layout(e,t,i,n){this._dimension=new Ke(e,t),this._contentPosition={top:i,left:n}}setVisible(e){this._onDidVisibilityChange.fire(e)}}class fE{static{this.HEADER_HEIGHT=35}static{this.TITLE_HEIGHT=35}static{this.Footer_HEIGHT=35}constructor(e,t){this.options=e,this.contentArea=t,this.headerVisible=!1,this.footerVisible=!1}layout(e,t){let i;this.options.hasTitle?i=new Ke(e,Math.min(t,fE.TITLE_HEIGHT)):i=Ke.None;let n;this.headerVisible?n=new Ke(e,Math.min(t,fE.HEADER_HEIGHT)):n=Ke.None;let o;this.footerVisible?o=new Ke(e,Math.min(t,fE.Footer_HEIGHT)):o=Ke.None;let r=e;this.options&&typeof this.options.borderWidth=="function"&&(r-=this.options.borderWidth());const a=new Ke(r,t-i.height-n.height-o.height);return this.contentArea&&Cq(this.contentArea,a.width,a.height),{headerSize:n,titleSize:i,contentSize:a,footerSize:o}}setFooterVisibility(e){this.footerVisible=e}setHeaderVisibility(e){this.headerVisible=e}}class Zst extends KO{constructor(){super(...arguments),this._parts=new Set}get parts(){return Array.from(this._parts)}registerPart(e){return this._parts.add(e),Ee(()=>this.unregisterPart(e))}unregisterPart(e){this._parts.delete(e)}getPart(e){return this.getPartByDocument(e.ownerDocument)}getPartByDocument(e){if(this._parts.size>1){for(const t of this._parts)if(t.element?.ownerDocument===e)return t}return this.mainPart}get activePart(){return this.getPartByDocument(Kd())}}const Bze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Vze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class $5{constructor(e,t){this.descriptorFn=e,this.stylesFn=t}getDescription(){return this.descriptorFn(null)}getColors(e){return this.stylesFn?.(e)}}class zG extends $5{constructor(e,t){super(t,void 0),this.number=e,this.number=e}getDescription(){return this.descriptorFn(this.number)}}class Hze extends $5{constructor(e,t,i){super(t,i),this.icon=e}}class Uze extends $5{constructor(e){super(e,void 0)}}class rw extends Kt{constructor(e){super(e.id,e.name,e.classNames?.join(" "),!0),this.item=e,this._onDidChangeCompositeBarActionItem=this._register(new M),this.onDidChangeCompositeBarActionItem=this._onDidChangeCompositeBarActionItem.event,this._onDidChangeActivity=this._register(new M),this.onDidChangeActivity=this._onDidChangeActivity.event,this._activities=[]}get compositeBarActionItem(){return this.item}set compositeBarActionItem(e){this._label=e.name,this.item=e,this._onDidChangeCompositeBarActionItem.fire(this)}get activities(){return this._activities}set activities(e){this._activities=e,this._onDidChangeActivity.fire(e)}activate(){this.checked||this._setChecked(!0)}deactivate(){this.checked&&this._setChecked(!1)}}let Yx=class extends YM{constructor(e,t,i,n,o,r,a){super(null,e,t),this.badgesEnabled=i,this.themeService=n,this.hoverService=o,this.configurationService=r,this.keybindingService=a,this.badgeDisposable=this._register(new kt),this.options=t,this._register(this.themeService.onDidColorThemeChange(this.onThemeChange,this)),this._register(e.onDidChangeCompositeBarActionItem(()=>this.update())),this._register(D.filter(a.onDidUpdateKeybindings,()=>this.keybindingLabel!==this.computeKeybindingLabel())(()=>this.updateTitle())),this._register(e.onDidChangeActivity(()=>this.updateActivity()))}get compositeBarActionItem(){return this._action.compositeBarActionItem}updateStyles(){const e=this.themeService.getColorTheme(),t=this.options.colors(e);if(this.label){if(this.options.icon){const i=this._action.checked?t.activeForegroundColor:t.inactiveForegroundColor;this.compositeBarActionItem.iconUrl?(this.label.style.backgroundColor=i?i.toString():"",this.label.style.color=""):(this.label.style.color=i?i.toString():"",this.label.style.backgroundColor="")}else{const i=this._action.checked?t.activeForegroundColor:t.inactiveForegroundColor,n=this._action.checked?t.activeBorderBottomColor:null;this.label.style.color=i?i.toString():"",this.label.style.borderBottomColor=n?n.toString():""}this.container.style.setProperty("--insert-border-color",t.dragAndDropBorder?t.dragAndDropBorder.toString():"")}if(this.badgeContent){const i=this.getActivities()[0]?.badge.getColors(e),n=i?.badgeForeground??t.badgeForeground??e.getColor(Lq),o=i?.badgeBackground??t.badgeBackground??e.getColor(JM),r=i?.badgeBorder??e.getColor(et);this.badgeContent.style.color=n?n.toString():"",this.badgeContent.style.backgroundColor=o?o.toString():"",this.badgeContent.style.borderStyle=r&&!this.options.compact?"solid":"",this.badgeContent.style.borderWidth=r?"1px":"",this.badgeContent.style.borderColor=r?r.toString():""}}render(e){super.render(e),this.container=e,this.options.icon&&this.container.classList.add("icon"),this.options.hasPopup?(this.container.setAttribute("role","button"),this.container.setAttribute("aria-haspopup","true")):this.container.setAttribute("role","tab"),this._register(re(this.container,pe.MOUSE_DOWN,()=>{this.container.classList.add("clicked")})),this._register(re(this.container,pe.MOUSE_UP,()=>{this.mouseUpTimeout&&clearTimeout(this.mouseUpTimeout),this.mouseUpTimeout=setTimeout(()=>{this.container.classList.remove("clicked")},800)})),this._register(this.hoverService.setupDelayedHover(this.container,()=>({content:this.computeTitle(),position:{hoverPosition:this.options.hoverOptions.position()},persistence:{hideOnKeyDown:!0},appearance:{showPointer:!0,compact:!0}}),{groupId:"composite-bar-actions"})),this.label=ee(e,Y("a")),this.badge=ee(e,Y(".badge")),this.badgeContent=ee(this.badge,Y(".badge-content")),ee(e,Y(".active-item-indicator")),Hs(this.badge),this.update(),this.updateStyles(),this.updateTitle()}onThemeChange(e){this.updateStyles()}update(){this.updateLabel(),this.updateActivity(),this.updateTitle(),this.updateStyles()}getActivities(){return this._action instanceof rw?this._action.activities:[]}updateActivity(){if(!this.badge||!this.badgeContent||!(this._action instanceof rw))return;const{badges:e,type:t}=this.getVisibleBadges(this.getActivities());this.badgeDisposable.value=new U,Yi(this.badgeContent),Hs(this.badge);const i=this.badgesEnabled(this.compositeBarActionItem.id);if(e.length>0&&i){const n=[];if(this.options.compact&&n.push("compact"),t==="progress")Ho(this.badge),n.push("progress-badge");else if(t==="number"){const o=e.reduce((r,a)=>r+(a instanceof zG?a.number:0),0);if(o>0){let r=o.toString();if(o>999){const a=o/1e3,c=Math.floor(a);r=a>c?`${c}K+`:`${a}K`}this.options.compact&&r.length>=3&&n.push("compact-content"),this.badgeContent.textContent=r,Ho(this.badge)}}else if(t==="icon"){n.push("icon-badge");const o=["icon-overlay",...Te.asClassNameArray(e[0].icon)];this.badgeContent.classList.add(...o),this.badgeDisposable.value.add(Ee(()=>this.badgeContent?.classList.remove(...o))),Ho(this.badge)}n.length&&(this.badge.classList.add(...n),this.badgeDisposable.value.add(Ee(()=>this.badge.classList.remove(...n))))}this.updateTitle(),this.updateStyles()}getVisibleBadges(e){const t=e.filter(o=>o.badge instanceof Uze).map(o=>o.badge);if(t.length>0)return{badges:t,type:"progress"};const i=e.filter(o=>o.badge instanceof Hze).map(o=>o.badge);if(i.length>0)return{badges:i,type:"icon"};const n=e.filter(o=>o.badge instanceof zG).map(o=>o.badge);return n.length>0?{badges:n,type:"number"}:{badges:[],type:void 0}}updateLabel(){this.label.className="action-label",this.compositeBarActionItem.classNames&&this.label.classList.add(...this.compositeBarActionItem.classNames),this.options.icon||(this.label.textContent=this.action.label)}updateTitle(){const e=this.computeTitle();[this.label,this.badge,this.container].forEach(t=>{t&&(t.setAttribute("aria-label",e),t.setAttribute("title",""),t.removeAttribute("title"))})}computeTitle(){this.keybindingLabel=this.computeKeybindingLabel();let e=this.keybindingLabel?h(2890,"{0} ({1})",this.compositeBarActionItem.name,this.keybindingLabel):this.compositeBarActionItem.name;const t=this.getVisibleBadges(this.action.activities).badges;for(const i of t)i.getDescription()&&(e=`${e} - ${i.getDescription()}`);return e}computeKeybindingLabel(){return(this.compositeBarActionItem.keybindingId?this.keybindingService.lookupKeybinding(this.compositeBarActionItem.keybindingId):null)?.getLabel()}dispose(){super.dispose(),this.mouseUpTimeout&&clearTimeout(this.mouseUpTimeout),this.badge.remove()}};Yx=f([p(3,ft),p(4,wi),p(5,ne),p(6,Ve)],Yx);class pie extends rw{constructor(e){super({id:"additionalComposites.action",name:h(2891,"Additional Views"),classNames:Te.asClassNameArray(j.more)}),this.showMenu=e}async run(){this.showMenu()}}let KG=class extends Yx{constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(e,{icon:!0,colors:r,hasPopup:!0,hoverOptions:a},()=>!0,d,l,u,g),this.getOverflowingComposites=t,this.getActiveCompositeId=i,this.getBadge=n,this.getCompositeOpenAction=o,this.contextMenuService=c}showMenu(){this.contextMenuService.showContextMenu({getAnchor:()=>this.container,getActions:()=>this.getActions(),getCheckedActionsRepresentation:()=>"radio"})}getActions(){return this.getOverflowingComposites().map(e=>{const t=this.getCompositeOpenAction(e.id);t.checked=this.getActiveCompositeId()===t.id;const i=this.getBadge(e.id);let n;return i instanceof zG&&(n=i.number),n?t.label=h(2892,"{0} ({1})",e.name,n):t.label=e.name||"",t})}};KG=f([p(7,mi),p(8,ft),p(9,wi),p(10,ne),p(11,Ve)],KG);let jG=class extends Yx{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){super(t,e,c.areBadgesEnabled.bind(c),g,m,v,l),this.toggleCompositePinnedAction=i,this.toggleCompositeBadgeAction=n,this.compositeContextMenuActionsProvider=o,this.contextMenuActionsProvider=r,this.dndHandler=a,this.compositeBar=c,this.contextMenuService=d,this.commandService=y}render(e){super.render(e),this.updateChecked(),this.updateEnabled(),this._register(re(this.container,pe.CONTEXT_MENU,i=>{Li.stop(i,!0),this.showContextMenu(e)}));let t;this._register(Jd.INSTANCE.registerDraggable(this.container,()=>({type:"composite",id:this.compositeBarActionItem.id}),{onDragOver:i=>{const n=i.dragAndDropData.getData().id!==this.compositeBarActionItem.id&&this.dndHandler.onDragOver(i.dragAndDropData,this.compositeBarActionItem.id,i.eventData);OP(i.eventData.dataTransfer,"move",n),t=this.updateFromDragging(e,n,i.eventData)},onDragLeave:i=>{t=this.updateFromDragging(e,!1,i.eventData)},onDragEnd:i=>{t=this.updateFromDragging(e,!1,i.eventData)},onDrop:i=>{Li.stop(i.eventData,!0),this.dndHandler.drop(i.dragAndDropData,this.compositeBarActionItem.id,i.eventData,t),t=this.updateFromDragging(e,!1,i.eventData)},onDragStart:i=>{i.dragAndDropData.getData().id===this.compositeBarActionItem.id&&(i.eventData.dataTransfer&&(i.eventData.dataTransfer.effectAllowed="move"),this.blur())}})),[this.badge,this.label].forEach(i=>this._register(new Nne(i,()=>{this.action.checked||this.action.run()}))),this.updateStyles()}updateFromDragging(e,t,i){const n=e.getBoundingClientRect(),o=i.clientX,r=i.clientY,a=n.bottom-n.top,c=n.right-n.left,d=r<=n.top+a*.4,l=r>n.bottom-a*.4,u=r<=n.top+a*.5,g=o<=n.left+c*.4,m=o>n.right-c*.4,v=o<=n.left+c*.5,y=e.classList,w={vertical:y.contains("top")?"top":y.contains("bottom")?"bottom":void 0,horizontal:y.contains("left")?"left":y.contains("right")?"right":void 0},C=d||u&&!w.vertical||!l&&w.vertical==="top",T=l||!u&&!w.vertical||!d&&w.vertical==="bottom",k=g||v&&!w.horizontal||!m&&w.horizontal==="left",A=m||!v&&!w.horizontal||!g&&w.horizontal==="right";if(e.classList.toggle("top",t&&C),e.classList.toggle("bottom",t&&T),e.classList.toggle("left",t&&k),e.classList.toggle("right",t&&A),!!t)return{verticallyBefore:C,horizontallyBefore:k}}showContextMenu(e){const t=[];this.compositeBarActionItem.keybindingId&&t.push(Vwe(this.commandService,this.keybindingService,this.compositeBarActionItem.keybindingId)),t.push(this.toggleCompositePinnedAction,this.toggleCompositeBadgeAction);const i=this.compositeContextMenuActionsProvider(this.compositeBarActionItem.id);i.length&&t.push(...i),this.compositeBar.isPinned(this.compositeBarActionItem.id)?(this.toggleCompositePinnedAction.label=h(2893,"Hide '{0}'",this.compositeBarActionItem.name),this.toggleCompositePinnedAction.checked=!1,this.toggleCompositePinnedAction.enabled=this.compositeBar.getPinnedCompositeIds().length>1):(this.toggleCompositePinnedAction.label=h(2894,"Keep '{0}'",this.compositeBarActionItem.name),this.toggleCompositePinnedAction.enabled=!0),this.compositeBar.areBadgesEnabled(this.compositeBarActionItem.id)?this.toggleCompositeBadgeAction.label=h(2895,"Hide Badge"):this.toggleCompositeBadgeAction.label=h(2896,"Show Badge");const r=this.contextMenuActionsProvider();r.length&&(t.push(new is),t.push(...r));const a=Ms(e),c={x:Math.floor(a.left+a.width/2),y:a.top+a.height};this.contextMenuService.showContextMenu({getAnchor:()=>c,getActions:()=>t,getActionsContext:()=>this.compositeBarActionItem.id})}updateChecked(){this.action.checked?(this.container.classList.add("checked"),this.container.setAttribute("aria-label",this.getTooltip()??this.container.title),this.container.setAttribute("aria-expanded","true"),this.container.setAttribute("aria-selected","true")):(this.container.classList.remove("checked"),this.container.setAttribute("aria-label",this.getTooltip()??this.container.title),this.container.setAttribute("aria-expanded","false"),this.container.setAttribute("aria-selected","false")),this.updateStyles()}updateEnabled(){this.element&&(this.action.enabled?this.element.classList.remove("disabled"):this.element.classList.add("disabled"))}dispose(){super.dispose(),this.label.remove()}};jG=f([p(8,mi),p(9,Ve),p(10,J),p(11,ft),p(12,wi),p(13,ne),p(14,qe)],jG);class Zpe extends Kt{constructor(e,t){super("show.toggleCompositePinned",e?e.name:h(2897,"Toggle View Pinned")),this.activity=e,this.compositeBar=t,this.checked=!!this.activity&&this.compositeBar.isPinned(this.activity.id)}async run(e){const t=this.activity?this.activity.id:e;this.compositeBar.isPinned(t)?this.compositeBar.unpin(t):this.compositeBar.pin(t)}}class Jpe extends Kt{constructor(e,t){super("show.toggleCompositeBadge",e?e.name:h(2898,"Toggle View Badge")),this.compositeBarActionItem=e,this.compositeBar=t,this.checked=!1}async run(e){const t=this.compositeBarActionItem?this.compositeBarActionItem.id:e;this.compositeBar.toggleBadgeEnablement(t)}}class uS extends X{constructor(e,t,i){super(e),this.location=t,this.offset=i}async run(e){const t=e.get(aa),i=t.getActivePaneComposite(this.location);if(!i)return;let n;const o=t.getVisiblePaneCompositeIds(this.location);for(let r=0;r<o.length;r++)if(o[r]===i.getId()){n=o[(r+o.length+this.offset)%o.length];break}typeof n<"u"&&await t.openPaneComposite(n,this.location,!0)}}const $ze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be($ze);const Gze=Ae("panel-maximize",j.chevronUp,h(3437,"Icon to maximize a panel.")),qze=Ae("panel-restore",j.chevronDown,h(3438,"Icon to restore a panel.")),EM=Ae("panel-close",j.close,h(3439,"Icon to close a panel.")),zze=Ae("panel-layout-icon",j.layoutPanel,h(3440,"Icon to toggle the panel off when it is on.")),Kze=Ae("panel-layout-icon-off",j.layoutPanelOff,h(3441,"Icon to toggle the panel on when it is off."));class aw extends X{static{this.ID="workbench.action.togglePanel"}static{this.LABEL=I(3442,"Toggle Panel Visibility")}constructor(){super({id:aw.ID,title:aw.LABEL,toggled:{condition:SN,title:h(3443,"Hide Panel"),icon:EM,mnemonicTitle:h(3444,"&&Panel")},icon:EM,f1:!0,category:te.View,metadata:{description:h(3445,"Open/Show and Close/Hide Panel")},keybinding:{primary:E.CtrlCmd|S.KeyJ,weight:W.WorkbenchContrib},menu:[{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:5},{id:N.LayoutControlMenuSubmenu,group:"0_workbench_layout",order:4},{id:N.PanelTitle,group:"navigation",order:2}]})}async run(e){const t=e.get(vi);t.setPartHidden(t.isVisible(ot.PANEL_PART),ot.PANEL_PART)}}K(aw);K(class extends X{constructor(){super({id:"workbench.action.closePanel",title:I(3443,"Hide Panel"),category:te.View,precondition:SN,f1:!0})}run(s){s.get(vi).setPartHidden(!0,ot.PANEL_PART)}});K(class extends X{static{this.ID="workbench.action.focusPanel"}static{this.LABEL=h(3446,"Focus into Panel")}constructor(){super({id:"workbench.action.focusPanel",title:I(3446,"Focus into Panel"),category:te.View,f1:!0})}async run(s){const e=s.get(vi),t=s.get(aa);e.isVisible(ot.PANEL_PART)||e.setPartHidden(!1,ot.PANEL_PART),t.getActivePaneComposite(Fe.Panel)?.focus()}});const pk={LEFT:"workbench.action.positionPanelLeft",RIGHT:"workbench.action.positionPanelRight",BOTTOM:"workbench.action.positionPanelBottom",TOP:"workbench.action.positionPanelTop"},fk={LEFT:"workbench.action.alignPanelLeft",RIGHT:"workbench.action.alignPanelRight",CENTER:"workbench.action.alignPanelCenter",JUSTIFY:"workbench.action.alignPanelJustify"};function efe(s,e,t,i,n){return{id:s,title:e,shortLabel:t,value:i,when:n}}function mk(s,e,t,i){return efe(s,e,t,i,Y_.notEqualsTo(dA(i)))}function vk(s,e,t,i){return efe(s,e,t,i,up.notEqualsTo(i))}const jze=[mk(pk.TOP,I(3447,"Move Panel To Top"),h(3448,"Top"),lh.TOP),mk(pk.LEFT,I(3449,"Move Panel Left"),h(3450,"Left"),lh.LEFT),mk(pk.RIGHT,I(3451,"Move Panel Right"),h(3452,"Right"),lh.RIGHT),mk(pk.BOTTOM,I(3453,"Move Panel To Bottom"),h(3454,"Bottom"),lh.BOTTOM)],Yze=[vk(fk.LEFT,I(3455,"Set Panel Alignment to Left"),h(3456,"Left"),"left"),vk(fk.RIGHT,I(3457,"Set Panel Alignment to Right"),h(3458,"Right"),"right"),vk(fk.CENTER,I(3459,"Set Panel Alignment to Center"),h(3460,"Center"),"center"),vk(fk.JUSTIFY,I(3461,"Set Panel Alignment to Justify"),h(3462,"Justify"),"justify")];ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.PanelPositionMenu,title:h(3463,"Panel Position"),group:"3_workbench_layout_move",order:4});jze.forEach((s,e)=>{const{id:t,title:i,shortLabel:n,value:o,when:r}=s;K(class extends X{constructor(){super({id:t,title:i,category:te.View,f1:!0})}run(a){a.get(vi).setPanelPosition(o===void 0?lh.BOTTOM:o)}}),ge.appendMenuItem(N.PanelPositionMenu,{command:{id:t,title:n,toggled:r.negate()},order:5+e})});ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.PanelAlignmentMenu,title:h(3464,"Align Panel"),group:"3_workbench_layout_move",order:5});Yze.forEach(s=>{const{id:e,title:t,shortLabel:i,value:n,when:o}=s;K(class extends X{constructor(){super({id:e,title:t,category:te.View,toggled:o.negate(),f1:!0})}run(r){r.get(vi).setPanelAlignment(n===void 0?"center":n)}}),ge.appendMenuItem(N.PanelAlignmentMenu,{command:{id:e,title:i,toggled:o.negate()},order:5})});K(class extends uS{constructor(){super({id:"workbench.action.previousPanelView",title:I(3465,"Previous Panel View"),category:te.View,f1:!0},Fe.Panel,-1)}});K(class extends uS{constructor(){super({id:"workbench.action.nextPanelView",title:I(3466,"Next Panel View"),category:te.View,f1:!0},Fe.Panel,1)}});K(class extends X{constructor(){super({id:"workbench.action.toggleMaximizedPanel",title:I(3467,"Toggle Maximized Panel"),tooltip:h(3468,"Maximize Panel Size"),category:te.View,f1:!0,icon:Gze,precondition:x.or(up.isEqualTo("center"),x.and(Y_.notEqualsTo("bottom"),Y_.notEqualsTo("top"))),toggled:{condition:NCe,icon:qze,tooltip:h(3469,"Restore Panel Size")},menu:[{id:N.PanelTitle,group:"navigation",order:1,when:x.or(up.isEqualTo("center"),x.and(Y_.notEqualsTo("bottom"),Y_.notEqualsTo("top")))}]})}run(s){const e=s.get(vi),t=s.get(At);if(e.getPanelAlignment()!=="center"&&goe(e.getPanelPosition())){t.warn(h(3470,"Maximizing the panel is only supported when it is center aligned."));return}e.isVisible(ot.PANEL_PART)?e.toggleMaximizedPanel():(e.setPartHidden(!1,ot.PANEL_PART),e.isPanelMaximized()||e.toggleMaximizedPanel())}});ge.appendMenuItems([{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:aw.ID,title:h(3471,"Toggle Panel"),icon:Kze,toggled:{condition:SN,icon:zze}},when:x.and(ev.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both"))),order:1}}]);class H1 extends X{constructor(e,t,i){super(i),this.source=e,this.destination=t}run(e,...t){const i=e.get(Os),n=e.get(vi),o=e.get(mo),r=i.getViewContainersByLocation(this.source),a=i.getViewContainersByLocation(this.destination);if(r.length){const c=o.getVisibleViewContainer(this.source);r.forEach(d=>i.moveViewContainerToLocation(d,this.destination,void 0,this.desc.id)),n.setPartHidden(!1,this.destination===Fe.Panel?ot.PANEL_PART:ot.AUXILIARYBAR_PART),c&&a.length===0&&o.openViewContainer(c.id,!0)}}}class G5 extends H1{static{this.ID="workbench.action.movePanelToSidePanel"}constructor(){super(Fe.Panel,Fe.AuxiliaryBar,{id:G5.ID,title:I(3472,"Move Panel Views To Secondary Side Bar"),category:te.View,f1:!1})}}class q5 extends H1{static{this.ID="workbench.action.movePanelToSecondarySideBar"}constructor(){super(Fe.Panel,Fe.AuxiliaryBar,{id:q5.ID,title:I(3472,"Move Panel Views To Secondary Side Bar"),category:te.View,f1:!0})}}K(G5);K(q5);class z5 extends H1{static{this.ID="workbench.action.moveSidePanelToPanel"}constructor(){super(Fe.AuxiliaryBar,Fe.Panel,{id:z5.ID,title:I(3473,"Move Secondary Side Bar Views To Panel"),category:te.View,f1:!1})}}class K5 extends H1{static{this.ID="workbench.action.moveSecondarySideBarToPanel"}constructor(){super(Fe.AuxiliaryBar,Fe.Panel,{id:K5.ID,title:I(3473,"Move Secondary Side Bar Views To Panel"),category:te.View,f1:!0})}}K(z5);K(K5);const Qze=Ae("auxiliarybar-right-layout-icon",j.layoutSidebarRight,h(2868,"Icon to toggle the auxiliary bar off in its right position.")),Xze=Ae("auxiliarybar-right-off-layout-icon",j.layoutSidebarRightOff,h(2869,"Icon to toggle the auxiliary bar on in its right position.")),Zze=Ae("auxiliarybar-left-layout-icon",j.layoutSidebarLeft,h(2870,"Icon to toggle the auxiliary bar in its left position.")),Jze=Ae("auxiliarybar-left-off-layout-icon",j.layoutSidebarLeftOff,h(2871,"Icon to toggle the auxiliary bar on in its left position."));class Mp extends X{static{this.ID="workbench.action.toggleAuxiliaryBar"}static{this.LABEL=I(2872,"Toggle Secondary Side Bar Visibility")}constructor(){super({id:Mp.ID,title:Mp.LABEL,toggled:{condition:yp,title:h(2873,"Hide Secondary Side Bar"),icon:EM,mnemonicTitle:h(2874,"Secondary Si&&de Bar")},icon:EM,category:te.View,metadata:{description:h(2875,"Open/Show and Close/Hide Secondary Side Bar")},f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Alt|S.KeyB},menu:[{id:N.LayoutControlMenuSubmenu,group:"0_workbench_layout",order:1},{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:2},{id:N.AuxiliaryBarTitle,group:"navigation",order:2,when:x.equals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.DEFAULT)}]})}async run(e){const t=e.get(vi);t.setPartHidden(t.isVisible(ot.AUXILIARYBAR_PART),ot.AUXILIARYBAR_PART)}}K(Mp);K(class extends X{constructor(){super({id:"workbench.action.closeAuxiliaryBar",title:I(2873,"Hide Secondary Side Bar"),category:te.View,precondition:yp,f1:!0})}run(s){s.get(vi).setPartHidden(!0,ot.AUXILIARYBAR_PART)}});K(class YG extends X{static{this.ID="workbench.action.focusAuxiliaryBar"}static{this.LABEL=I(2876,"Focus into Secondary Side Bar")}constructor(){super({id:YG.ID,title:YG.LABEL,category:te.View,f1:!0})}async run(e){const t=e.get(aa),i=e.get(vi);i.isVisible(ot.AUXILIARYBAR_PART)||i.setPartHidden(!1,ot.AUXILIARYBAR_PART),t.getActivePaneComposite(Fe.AuxiliaryBar)?.focus()}});ge.appendMenuItems([{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:Mp.ID,title:h(2877,"Toggle Secondary Side Bar"),toggled:{condition:yp,icon:Zze},icon:Jze},when:x.and(ev.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","right")),order:0}},{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:Mp.ID,title:h(2877,"Toggle Secondary Side Bar"),toggled:{condition:yp,icon:Qze},icon:Xze},when:x.and(ev.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","left")),order:2}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:Mp.ID,title:I(2878,"Hide Secondary Side Bar")},when:x.and(yp,x.equals("viewContainerLocation",ed(Fe.AuxiliaryBar))),order:2}}]);K(class extends uS{constructor(){super({id:"workbench.action.previousAuxiliaryBarView",title:I(2879,"Previous Secondary Side Bar View"),category:te.View,f1:!0},Fe.AuxiliaryBar,-1)}});K(class extends uS{constructor(){super({id:"workbench.action.nextAuxiliaryBarView",title:I(2880,"Next Secondary Side Bar View"),category:te.View,f1:!0},Fe.AuxiliaryBar,1)}});const eKe=Ae("menuBar",j.layoutMenubar,h(2644,"Represents the menu bar")),tKe=Ae("activity-bar-left",j.layoutActivitybarLeft,h(2645,"Represents the activity bar in the left position")),iKe=Ae("activity-bar-right",j.layoutActivitybarRight,h(2646,"Represents the activity bar in the right position")),xM=Ae("panel-left",j.layoutSidebarLeft,h(2647,"Represents a side bar in the left position")),nKe=Ae("panel-left-off",j.layoutSidebarLeftOff,h(2648,"Represents a side bar in the left position toggled off")),IM=Ae("panel-right",j.layoutSidebarRight,h(2649,"Represents side bar in the right position")),sKe=Ae("panel-right-off",j.layoutSidebarRightOff,h(2650,"Represents side bar in the right position toggled off")),oKe=Ae("panel-bottom",j.layoutPanel,h(2651,"Represents the bottom panel")),rKe=Ae("statusBar",j.layoutStatusbar,h(2652,"Represents the status bar")),aKe=Ae("panel-align-left",j.layoutPanelLeft,h(2653,"Represents the bottom panel alignment set to the left")),cKe=Ae("panel-align-right",j.layoutPanelRight,h(2654,"Represents the bottom panel alignment set to the right")),dKe=Ae("panel-align-center",j.layoutPanelCenter,h(2655,"Represents the bottom panel alignment set to the center")),lKe=Ae("panel-align-justify",j.layoutPanelJustify,h(2656,"Represents the bottom panel alignment set to justified")),hKe=Ae("quickInputAlignmentTop",j.arrowUp,h(2657,"Represents quick input alignment set to the top")),uKe=Ae("quickInputAlignmentCenter",j.circle,h(2658,"Represents quick input alignment set to the center")),gKe=Ae("fullscreen",j.screenFull,h(2659,"Represents full screen")),pKe=Ae("centerLayoutIcon",j.layoutCentered,h(2660,"Represents centered layout mode")),fKe=Ae("zenMode",j.target,h(2661,"Represents zen mode")),mKe="workbench.action.toggleActivityBarVisibility";K(class extends X{constructor(){super({id:"workbench.action.toggleCenteredLayout",title:{...I(2662,"Toggle Centered Layout"),mnemonicTitle:h(2663,"&&Centered Layout")},precondition:Sl.toNegated(),category:te.View,f1:!0,toggled:poe,menu:[{id:N.MenubarAppearanceMenu,group:"1_toggle_view",order:3}]})}run(s){const e=s.get(vi),t=s.get(Ie);e.centerMainEditorLayout(!e.isMainEditorLayoutCentered()),t.activeGroup.focus()}});const tfe="workbench.sideBar.location";class ife extends X{constructor(e,t,i){super({id:e,title:t,f1:!1}),this.position=i}async run(e){const t=e.get(vi),i=e.get(ne);if(t.getSideBarPosition()!==this.position)return i.updateValue(tfe,dA(this.position))}}class U1 extends ife{static{this.ID="workbench.action.moveSideBarRight"}constructor(){super(U1.ID,I(2664,"Move Primary Side Bar Right"),lh.RIGHT)}}class $1 extends ife{static{this.ID="workbench.action.moveSideBarLeft"}constructor(){super($1.ID,I(2665,"Move Primary Side Bar Left"),lh.LEFT)}}K(U1);K($1);class nd extends X{static{this.ID="workbench.action.toggleSidebarPosition"}static{this.LABEL=h(2666,"Toggle Primary Side Bar Position")}static getLabel(e){return e.getSideBarPosition()===lh.LEFT?h(2664,"Move Primary Side Bar Right"):h(2665,"Move Primary Side Bar Left")}constructor(){super({id:nd.ID,title:I(2666,"Toggle Primary Side Bar Position"),category:te.View,f1:!0})}run(e){const t=e.get(vi),i=e.get(ne),o=t.getSideBarPosition()===lh.LEFT?"right":"left";return i.updateValue(tfe,o)}}K(nd);const nfe=Ae("configure-layout-icon",j.layout,h(2667,"Icon represents workbench layout configuration."));ge.appendMenuItem(N.LayoutControlMenu,{submenu:N.LayoutControlMenuSubmenu,title:h(2668,"Configure Layout"),icon:nfe,group:"1_workbench_layout",when:x.and(ev.negate(),x.equals("config.workbench.layoutControl.type","menu"))});ge.appendMenuItems([{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:nd.ID,title:h(2669,"Move Primary Side Bar Right")},when:x.and(x.notEquals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",ed(Fe.Sidebar))),order:1}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:nd.ID,title:h(2670,"Move Primary Side Bar Left")},when:x.and(x.equals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",ed(Fe.Sidebar))),order:1}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:nd.ID,title:h(2671,"Move Secondary Side Bar Left")},when:x.and(x.notEquals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",ed(Fe.AuxiliaryBar))),order:1}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:nd.ID,title:h(2672,"Move Secondary Side Bar Right")},when:x.and(x.equals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",ed(Fe.AuxiliaryBar))),order:1}}]);ge.appendMenuItem(N.MenubarAppearanceMenu,{group:"3_workbench_layout_move",command:{id:nd.ID,title:h(2673,"&&Move Primary Side Bar Right")},when:x.notEquals("config.workbench.sideBar.location","right"),order:2});ge.appendMenuItem(N.MenubarAppearanceMenu,{group:"3_workbench_layout_move",command:{id:nd.ID,title:h(2674,"&&Move Primary Side Bar Left")},when:x.equals("config.workbench.sideBar.location","right"),order:2});K(class extends X{constructor(){super({id:"workbench.action.toggleEditorVisibility",title:{...I(2675,"Toggle Editor Area Visibility"),mnemonicTitle:h(2676,"Show &&Editor Area")},category:te.View,f1:!0,toggled:OCe,precondition:x.and(Sl.toNegated(),x.or(up.isEqualTo("center"),Y_.notEqualsTo("bottom")))})}run(s){s.get(vi).toggleMaximizedPanel()}});ge.appendMenuItem(N.MenubarViewMenu,{group:"2_appearance",title:h(2677,"&&Appearance"),submenu:N.MenubarAppearanceMenu,order:1});class Ch extends X{static{this.ID="workbench.action.toggleSidebarVisibility"}static{this.LABEL=h(2678,"Hide Primary Side Bar")}constructor(){super({id:Ch.ID,title:I(2679,"Toggle Primary Side Bar Visibility"),toggled:{condition:xm,title:h(2680,"Primary Side Bar"),mnemonicTitle:h(2681,"&&Primary Side Bar")},metadata:{description:h(2682,"Open/Show and Close/Hide Sidebar")},category:te.View,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyB},menu:[{id:N.LayoutControlMenuSubmenu,group:"0_workbench_layout",order:0},{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:1}]})}run(e){const t=e.get(vi);t.setPartHidden(t.isVisible(ot.SIDEBAR_PART),ot.SIDEBAR_PART)}}K(Ch);ge.appendMenuItems([{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:Ch.ID,title:h(2678,"Hide Primary Side Bar")},when:x.and(xm,x.equals("viewContainerLocation",ed(Fe.Sidebar))),order:2}},{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:Ch.ID,title:h(2683,"Toggle Primary Side Bar"),icon:nKe,toggled:{condition:xm,icon:xM}},when:x.and(ev.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","left")),order:0}},{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:Ch.ID,title:h(2683,"Toggle Primary Side Bar"),icon:sKe,toggled:{condition:xm,icon:IM}},when:x.and(ev.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","right")),order:2}}]);class Qx extends X{static{this.ID="workbench.action.toggleStatusbarVisibility"}static{this.statusbarVisibleKey="workbench.statusBar.visible"}constructor(){super({id:Qx.ID,title:{...I(2684,"Toggle Status Bar Visibility"),mnemonicTitle:h(2685,"S&&tatus Bar")},category:te.View,f1:!0,toggled:x.equals("config.workbench.statusBar.visible",!0),menu:[{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:3}]})}run(e){const t=e.get(vi),i=e.get(ne),o=!t.isVisible(ot.STATUSBAR_PART,$i);return i.updateValue(Qx.statusbarVisibleKey,o)}}K(Qx);class gS extends X{constructor(e,t,i,n,o,r){super({id:n,title:i,category:te.View,precondition:o,metadata:r?{description:r}:void 0,f1:!0}),this.settingName=e,this.value=t}run(e){return e.get(ne).updateValue(this.settingName,this.value)}}class j5 extends gS{static{this.ID="workbench.action.hideEditorTabs"}constructor(){const e=x.and(x.equals(`config.${si.EDITOR_TABS_MODE}`,lo.NONE).negate(),ud.negate()),t=I(2686,"Hide Editor Tabs");super(si.EDITOR_TABS_MODE,lo.NONE,t,j5.ID,e,I(2687,"Hide Tab Bar"))}}class Y5 extends gS{static{this.ID="workbench.action.zenHideEditorTabs"}constructor(){const e=x.and(x.equals(`config.${hy.SHOW_TABS}`,lo.NONE).negate(),ud),t=I(2688,"Hide Editor Tabs in Zen Mode");super(hy.SHOW_TABS,lo.NONE,t,Y5.ID,e,I(2689,"Hide Tab Bar in Zen Mode"))}}class Q5 extends gS{static{this.ID="workbench.action.showMultipleEditorTabs"}constructor(){const e=x.and(x.equals(`config.${si.EDITOR_TABS_MODE}`,lo.MULTIPLE).negate(),ud.negate()),t=I(2690,"Show Multiple Editor Tabs");super(si.EDITOR_TABS_MODE,lo.MULTIPLE,t,Q5.ID,e,I(2691,"Show Tab Bar with multiple tabs"))}}class X5 extends gS{static{this.ID="workbench.action.zenShowMultipleEditorTabs"}constructor(){const e=x.and(x.equals(`config.${hy.SHOW_TABS}`,lo.MULTIPLE).negate(),ud),t=I(2692,"Show Multiple Editor Tabs in Zen Mode");super(hy.SHOW_TABS,lo.MULTIPLE,t,X5.ID,e,I(2693,"Show Tab Bar in Zen Mode"))}}class Z5 extends gS{static{this.ID="workbench.action.showEditorTab"}constructor(){const e=x.and(x.equals(`config.${si.EDITOR_TABS_MODE}`,lo.SINGLE).negate(),ud.negate()),t=I(2694,"Show Single Editor Tab");super(si.EDITOR_TABS_MODE,lo.SINGLE,t,Z5.ID,e,I(2695,"Show Tab Bar with one Tab"))}}class J5 extends gS{static{this.ID="workbench.action.zenShowEditorTab"}constructor(){const e=x.and(x.equals(`config.${hy.SHOW_TABS}`,lo.SINGLE).negate(),ud),t=I(2696,"Show Single Editor Tab in Zen Mode");super(hy.SHOW_TABS,lo.SINGLE,t,J5.ID,e,I(2697,"Show Tab Bar in Zen Mode with one Tab"))}}K(j5);K(Y5);K(Q5);K(X5);K(Z5);K(J5);ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.EditorTabsBarShowTabsSubmenu,title:h(2698,"Tab Bar"),group:"3_workbench_layout_move",order:10,when:ud.negate()});ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.EditorTabsBarShowTabsZenModeSubmenu,title:h(2698,"Tab Bar"),group:"3_workbench_layout_move",order:10,when:ud});class e7 extends X{static{this.ID="workbench.action.editorActionsTitleBar"}constructor(){super({id:e7.ID,title:I(2699,"Move Editor Actions to Title Bar"),category:te.View,precondition:x.equals(`config.${si.EDITOR_ACTIONS_LOCATION}`,rl.TITLEBAR).negate(),metadata:{description:I(2700,"Move Editor Actions from the tab bar to the title bar")},f1:!0})}run(e){return e.get(ne).updateValue(si.EDITOR_ACTIONS_LOCATION,rl.TITLEBAR)}}K(e7);class t7 extends X{static{this.ID="workbench.action.editorActionsDefault"}constructor(){super({id:t7.ID,title:I(2701,"Move Editor Actions to Tab Bar"),category:te.View,precondition:x.and(x.equals(`config.${si.EDITOR_ACTIONS_LOCATION}`,rl.DEFAULT).negate(),x.equals(`config.${si.EDITOR_TABS_MODE}`,lo.NONE).negate()),metadata:{description:I(2702,"Move Editor Actions from the title bar to the tab bar")},f1:!0})}run(e){return e.get(ne).updateValue(si.EDITOR_ACTIONS_LOCATION,rl.DEFAULT)}}K(t7);class i7 extends X{static{this.ID="workbench.action.hideEditorActions"}constructor(){super({id:i7.ID,title:I(2703,"Hide Editor Actions"),category:te.View,precondition:x.equals(`config.${si.EDITOR_ACTIONS_LOCATION}`,rl.HIDDEN).negate(),metadata:{description:I(2704,"Hide Editor Actions in the tab and title bar")},f1:!0})}run(e){return e.get(ne).updateValue(si.EDITOR_ACTIONS_LOCATION,rl.HIDDEN)}}K(i7);class n7 extends X{static{this.ID="workbench.action.showEditorActions"}constructor(){super({id:n7.ID,title:I(2705,"Show Editor Actions"),category:te.View,precondition:x.equals(`config.${si.EDITOR_ACTIONS_LOCATION}`,rl.HIDDEN),metadata:{description:I(2706,"Make Editor Actions visible.")},f1:!0})}run(e){return e.get(ne).updateValue(si.EDITOR_ACTIONS_LOCATION,rl.DEFAULT)}}K(n7);ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.EditorActionsPositionSubmenu,title:h(2707,"Editor Actions Position"),group:"3_workbench_layout_move",order:11});class s7 extends X{static{this.ID="workbench.action.configureEditorTabs"}constructor(){super({id:s7.ID,title:I(2708,"Configure Tabs"),category:te.View})}run(e){e.get(Fv).openSettings({jsonEditor:!1,query:"workbench.editor tab"})}}K(s7);class o7 extends X{static{this.ID="workbench.action.configureEditor"}constructor(){super({id:o7.ID,title:I(2709,"Configure Editors"),category:te.View})}run(e){e.get(Fv).openSettings({jsonEditor:!1,query:"workbench.editor"})}}K(o7);K(class extends X{constructor(){super({id:"workbench.action.toggleSeparatePinnedEditorTabs",title:I(2710,"Separate Pinned Editor Tabs"),category:te.View,precondition:x.equals(`config.${si.EDITOR_TABS_MODE}`,lo.MULTIPLE),metadata:{description:I(2711,"Toggle whether pinned editor tabs are shown on a separate row above unpinned tabs.")},f1:!0})}run(s){const e=s.get(ne),i=!e.getValue("workbench.editor.pinnedTabsOnSeparateRow");return e.updateValue("workbench.editor.pinnedTabsOnSeparateRow",i)}});K(class extends X{constructor(){super({id:"workbench.action.toggleZenMode",title:{...I(2712,"Toggle Zen Mode"),mnemonicTitle:h(2713,"Zen Mode")},precondition:Sl.toNegated(),category:te.View,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyZ)},toggled:ud,menu:[{id:N.MenubarAppearanceMenu,group:"1_toggle_view",order:2}]})}run(s){return s.get(vi).toggleZenMode()}});Le.registerCommandAndKeybindingRule({id:"workbench.action.exitZenMode",weight:W.EditorContrib-1e3,handler(s){const e=s.get(vi),t=s.get(me);ud.getValue(t)&&e.toggleZenMode()},when:ud,primary:lt(S.Escape,S.Escape)});if(pn||vh||$t){K(class extends X{constructor(){super({id:"workbench.action.toggleMenuBar",title:{...I(2714,"Toggle Menu Bar"),mnemonicTitle:h(2715,"Menu &&Bar")},category:te.View,f1:!0,toggled:x.and(eg.toNegated(),x.notEquals(`config.${Qr.MenuBarVisibility}`,"hidden"),x.notEquals(`config.${Qr.MenuBarVisibility}`,"toggle"),x.notEquals(`config.${Qr.MenuBarVisibility}`,"compact")),menu:[{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:0}]})}run(e){return e.get(vi).toggleMenuBar()}});for(const s of[N.TitleBarContext,N.TitleBarTitleContext])ge.appendMenuItem(s,{command:{id:"workbench.action.toggleMenuBar",title:h(2716,"Menu Bar"),toggled:x.and(eg.toNegated(),x.notEquals(`config.${Qr.MenuBarVisibility}`,"hidden"),x.notEquals(`config.${Qr.MenuBarVisibility}`,"toggle"),x.notEquals(`config.${Qr.MenuBarVisibility}`,"compact"))},when:x.and(Sl.toNegated(),x.notEquals(sA.key,zT.NATIVE),Gp.negate()),group:"2_config",order:0})}K(class extends X{constructor(){super({id:"workbench.action.resetViewLocations",title:I(2717,"Reset View Locations"),category:te.View,f1:!0})}run(s){return s.get(Os).reset()}});K(class extends X{constructor(){super({id:"workbench.action.moveView",title:I(2718,"Move View"),category:te.View,f1:!0})}async run(s){const e=s.get(Os),t=s.get(J),i=s.get(zt),n=s.get(me),o=s.get(aa),r=pl.getValue(n);let a;r&&e.getViewDescriptorById(r)?.canMoveView&&(a=r);try{if(a=await this.getView(i,e,o,a),!a)return;const c=new sfe;t.invokeFunction(d=>c.run(d,a))}catch{}}getViewItems(s,e){const t=[];return e.getVisiblePaneCompositeIds(Fe.Sidebar).forEach(r=>{const a=s.getViewContainerById(r),c=s.getViewContainerModel(a);let d=!1;c.visibleViewDescriptors.forEach(l=>{l.canMoveView&&(d||(t.push({type:"separator",label:h(2719,"Side Bar / {0}",c.title)}),d=!0),t.push({id:l.id,label:l.name.value}))})}),e.getPinnedPaneCompositeIds(Fe.Panel).forEach(r=>{const a=s.getViewContainerById(r),c=s.getViewContainerModel(a);let d=!1;c.visibleViewDescriptors.forEach(l=>{l.canMoveView&&(d||(t.push({type:"separator",label:h(2720,"Panel / {0}",c.title)}),d=!0),t.push({id:l.id,label:l.name.value}))})}),e.getPinnedPaneCompositeIds(Fe.AuxiliaryBar).forEach(r=>{const a=s.getViewContainerById(r),c=s.getViewContainerModel(a);let d=!1;c.visibleViewDescriptors.forEach(l=>{l.canMoveView&&(d||(t.push({type:"separator",label:h(2721,"Secondary Side Bar / {0}",c.title)}),d=!0),t.push({id:l.id,label:l.name.value}))})}),t}async getView(s,e,t,i){const n=new U,o=n.add(s.createQuickPick({useSeparators:!0}));return o.placeholder=h(2722,"Select a View to Move"),o.items=this.getViewItems(e,t),o.selectedItems=o.items.filter(r=>r.id===i),new Promise((r,a)=>{n.add(o.onDidAccept(()=>{const c=o.selectedItems[0];c.id?r(c.id):a(),o.hide()})),n.add(o.onDidHide(()=>{n.dispose(),a()})),o.show()})}});class sfe extends X{constructor(){super({id:"workbench.action.moveFocusedView",title:I(2723,"Move Focused View"),category:te.View,precondition:pl.notEqualsTo(""),f1:!0})}run(e,t){const i=e.get(Os),n=e.get(mo),o=e.get(zt),r=e.get(me),a=e.get(Qt),c=e.get(aa),d=t||pl.getValue(r);if(d===void 0||d.trim()===""){a.error(h(2724,"There is no view currently focused."));return}const l=i.getViewDescriptorById(d);if(!l||!l.canMoveView){a.error(h(2725,"The currently focused view is not movable."));return}const u=new U,g=u.add(o.createQuickPick({useSeparators:!0}));g.placeholder=h(2726,"Select a Destination for the View"),g.title=h(2727,"View: Move {0}",l.name.value);const m=[],v=i.getViewContainerByViewId(d),y=i.getViewLocationById(d),w=i.getViewContainerModel(v).allViewDescriptors.length===1;w&&y===Fe.Panel||m.push({id:"_.panel.newcontainer",label:h(2728,"New Panel Entry")}),w&&y===Fe.Sidebar||m.push({id:"_.sidebar.newcontainer",label:h(2729,"New Side Bar Entry")}),w&&y===Fe.AuxiliaryBar||m.push({id:"_.auxiliarybar.newcontainer",label:h(2730,"New Secondary Side Bar Entry")}),m.push({type:"separator",label:h(2731,"Side Bar")});const C=c.getVisiblePaneCompositeIds(Fe.Sidebar);m.push(...C.filter(A=>A===i.getViewContainerByViewId(d).id?!1:!i.getViewContainerById(A).rejectAddedViews).map(A=>({id:A,label:i.getViewContainerModel(i.getViewContainerById(A)).title}))),m.push({type:"separator",label:h(2732,"Panel")});const T=c.getPinnedPaneCompositeIds(Fe.Panel);m.push(...T.filter(A=>A===i.getViewContainerByViewId(d).id?!1:!i.getViewContainerById(A).rejectAddedViews).map(A=>({id:A,label:i.getViewContainerModel(i.getViewContainerById(A)).title}))),m.push({type:"separator",label:h(2733,"Secondary Side Bar")});const k=c.getPinnedPaneCompositeIds(Fe.AuxiliaryBar);m.push(...k.filter(A=>A===i.getViewContainerByViewId(d).id?!1:!i.getViewContainerById(A).rejectAddedViews).map(A=>({id:A,label:i.getViewContainerModel(i.getViewContainerById(A)).title}))),g.items=m,u.add(g.onDidAccept(()=>{const A=g.selectedItems[0];A.id==="_.panel.newcontainer"?(i.moveViewToLocation(l,Fe.Panel,this.desc.id),n.openView(d,!0)):A.id==="_.sidebar.newcontainer"?(i.moveViewToLocation(l,Fe.Sidebar,this.desc.id),n.openView(d,!0)):A.id==="_.auxiliarybar.newcontainer"?(i.moveViewToLocation(l,Fe.AuxiliaryBar,this.desc.id),n.openView(d,!0)):A.id&&(i.moveViewsToContainer([l],i.getViewContainerById(A.id),void 0,this.desc.id),n.openView(d,!0)),g.hide()})),u.add(g.onDidHide(()=>u.dispose())),g.show()}}K(sfe);K(class extends X{constructor(){super({id:"workbench.action.resetFocusedViewLocation",title:I(2734,"Reset Focused View Location"),category:te.View,f1:!0,precondition:pl.notEqualsTo("")})}run(s){const e=s.get(Os),t=s.get(me),i=s.get(Qt),n=s.get(mo),o=pl.getValue(t);let r=null;if(o!==void 0&&o.trim()!==""&&(r=e.getViewDescriptorById(o)),!r){i.error(h(2735,"There is no view currently focused."));return}const a=e.getDefaultContainerById(r.id);!a||a===e.getViewContainerByViewId(r.id)||(e.moveViewsToContainer([r],a,void 0,this.desc.id),n.openView(r.id,!0))}});class Ea extends X{static{this.RESIZE_INCREMENT=60}resizePart(e,t,i,n){let o;if(n===void 0){const r=i.hasFocus(ot.EDITOR_PART),a=i.hasFocus(ot.SIDEBAR_PART),c=i.hasFocus(ot.PANEL_PART),d=i.hasFocus(ot.AUXILIARYBAR_PART);a?o=ot.SIDEBAR_PART:c?o=ot.PANEL_PART:r?o=ot.EDITOR_PART:d&&(o=ot.AUXILIARYBAR_PART)}else o=n;o&&i.resizePart(o,e,t)}}class vKe extends Ea{constructor(){super({id:"workbench.action.increaseViewSize",title:I(2736,"Increase Current View Size"),f1:!0,precondition:Sl.toNegated()})}run(e){this.resizePart(Ea.RESIZE_INCREMENT,Ea.RESIZE_INCREMENT,e.get(vi))}}class _Ke extends Ea{constructor(){super({id:"workbench.action.increaseViewWidth",title:I(2737,"Increase Editor Width"),f1:!0,precondition:Sl.toNegated()})}run(e){this.resizePart(Ea.RESIZE_INCREMENT,0,e.get(vi),ot.EDITOR_PART)}}class bKe extends Ea{constructor(){super({id:"workbench.action.increaseViewHeight",title:I(2738,"Increase Editor Height"),f1:!0,precondition:Sl.toNegated()})}run(e){this.resizePart(0,Ea.RESIZE_INCREMENT,e.get(vi),ot.EDITOR_PART)}}class yKe extends Ea{constructor(){super({id:"workbench.action.decreaseViewSize",title:I(2739,"Decrease Current View Size"),f1:!0,precondition:Sl.toNegated()})}run(e){this.resizePart(-Ea.RESIZE_INCREMENT,-Ea.RESIZE_INCREMENT,e.get(vi))}}class wKe extends Ea{constructor(){super({id:"workbench.action.decreaseViewWidth",title:I(2740,"Decrease Editor Width"),f1:!0,precondition:Sl.toNegated()})}run(e){this.resizePart(-Ea.RESIZE_INCREMENT,0,e.get(vi),ot.EDITOR_PART)}}class SKe extends Ea{constructor(){super({id:"workbench.action.decreaseViewHeight",title:I(2741,"Decrease Editor Height"),f1:!0,precondition:Sl.toNegated()})}run(e){this.resizePart(0,-Ea.RESIZE_INCREMENT,e.get(vi),ot.EDITOR_PART)}}K(vKe);K(_Ke);K(bKe);K(yKe);K(wKe);K(SKe);K(class extends X{constructor(){super({id:"workbench.action.alignQuickInputTop",title:I(2742,"Align Quick Input Top"),f1:!1})}run(e){e.get(zt).setAlignment("top")}});K(class extends X{constructor(){super({id:"workbench.action.alignQuickInputCenter",title:I(2743,"Align Quick Input Center"),f1:!1})}run(e){e.get(zt).setAlignment("center")}});function CKe(s){return s.iconA!==void 0}const B_=(s,e,t,i)=>({id:s,active:e,label:t,visualIcon:i,activeIcon:j.eye,inactiveIcon:j.eyeClosed,activeAriaLabel:h(2744,"Select to Hide"),inactiveAriaLabel:h(2745,"Select to Show"),useButtons:!0}),nl=(s,e,t,i)=>({id:s,active:e,label:t,visualIcon:i,activeIcon:j.check,activeAriaLabel:h(2746,"Active"),useButtons:!1}),EKe=x.and(eg.toNegated(),x.notEquals(`config.${Qr.MenuBarVisibility}`,"hidden"),x.notEquals(`config.${Qr.MenuBarVisibility}`,"toggle"),x.notEquals(`config.${Qr.MenuBarVisibility}`,"compact")),G1=[];(!qt||!ra)&&G1.push(B_("workbench.action.toggleMenuBar",EKe,h(2747,"Menu Bar"),eKe));G1.push(B_(mKe,x.notEquals("config.workbench.activityBar.location","hidden"),h(2748,"Activity Bar"),{whenA:x.equals("config.workbench.sideBar.location","left"),iconA:tKe,iconB:iKe}),B_(Ch.ID,xm,h(2749,"Primary Side Bar"),{whenA:x.equals("config.workbench.sideBar.location","left"),iconA:xM,iconB:IM}),B_(Mp.ID,yp,h(2733,"Secondary Side Bar"),{whenA:x.equals("config.workbench.sideBar.location","left"),iconA:IM,iconB:xM}),B_(aw.ID,SN,h(2732,"Panel"),oKe),B_(Qx.ID,x.equals("config.workbench.statusBar.visible",!0),h(2750,"Status Bar"),rKe));const ofe=[nl($1.ID,x.equals("config.workbench.sideBar.location","left"),h(2751,"Left"),xM),nl(U1.ID,x.equals("config.workbench.sideBar.location","right"),h(2752,"Right"),IM)],rfe=[nl("workbench.action.alignPanelLeft",up.isEqualTo("left"),h(2753,"Left"),aKe),nl("workbench.action.alignPanelRight",up.isEqualTo("right"),h(2754,"Right"),cKe),nl("workbench.action.alignPanelCenter",up.isEqualTo("center"),h(2755,"Center"),dKe),nl("workbench.action.alignPanelJustify",up.isEqualTo("justify"),h(2756,"Justify"),lKe)],afe=[nl("workbench.action.alignQuickInputTop",n6.isEqualTo("top"),h(2757,"Top"),hKe),nl("workbench.action.alignQuickInputCenter",n6.isEqualTo("center"),h(2758,"Center"),uKe)],cfe=[nl("workbench.action.toggleFullScreen",Gp,h(2759,"Full Screen"),gKe),nl("workbench.action.toggleZenMode",ud,h(2760,"Zen Mode"),fKe),nl("workbench.action.toggleCenteredLayout",poe,h(2761,"Centered Layout"),pKe)],dfe=new Set;for(const{active:s}of[...G1,...ofe,...rfe,...afe,...cfe])for(const e of s.keys())dfe.add(e);K(class extends X{constructor(){super({id:"workbench.action.customizeLayout",title:I(2762,"Customize Layout..."),f1:!0,icon:nfe,menu:[{id:N.LayoutControlMenuSubmenu,group:"z_end"},{id:N.LayoutControlMenu,when:x.and(ev.toNegated(),x.equals("config.workbench.layoutControl.type","both")),group:"1_layout"}]})}getItems(e,t){const i=n=>{const o=n.active.evaluate(e.getContext(null));let r=n.useButtons?n.label:n.label+(o&&n.activeIcon?` $(${n.activeIcon.id})`:!o&&n.inactiveIcon?` $(${n.inactiveIcon.id})`:"");const a=n.label+(o&&n.activeAriaLabel?` (${n.activeAriaLabel})`:!o&&n.inactiveAriaLabel?` (${n.inactiveAriaLabel})`:"");if(n.visualIcon){let d=n.visualIcon;CKe(d)&&(d=d.whenA.evaluate(e.getContext(null))?d.iconA:d.iconB),r=`$(${d.id}) ${r}`}const c=o?n.activeIcon:n.inactiveIcon;return{type:"item",id:n.id,label:r,ariaLabel:a,keybinding:t.lookupKeybinding(n.id,e),buttons:n.useButtons?[{alwaysVisible:!1,tooltip:a,iconClass:c?Te.asClassName(c):void 0}]:void 0}};return[{type:"separator",label:h(2763,"Visibility")},...G1.map(i),{type:"separator",label:h(2764,"Primary Side Bar Position")},...ofe.map(i),{type:"separator",label:h(2765,"Panel Alignment")},...rfe.map(i),{type:"separator",label:h(2766,"Quick Input Position")},...afe.map(i),{type:"separator",label:h(2767,"Modes")},...cfe.map(i)]}run(e){if(this._currentQuickPick){this._currentQuickPick.hide();return}const t=e.get(ne),i=e.get(me),n=e.get(qe),o=e.get(zt),r=e.get(Ve),a=new U,c=a.add(o.createQuickPick({useSeparators:!0}));this._currentQuickPick=c,c.items=this.getItems(i,r),c.ignoreFocusOut=!0,c.hideInput=!0,c.title=h(2768,"Customize Layout");const d={alwaysVisible:!0,iconClass:Te.asClassName(j.close),tooltip:h(2769,"Close")},l={alwaysVisible:!0,iconClass:Te.asClassName(j.discard),tooltip:h(2770,"Restore Defaults")};c.buttons=[l,d];let u;a.add(i.onDidChangeContext(g=>{g.affectsSome(dfe)&&(c.items=this.getItems(i,r),u&&(c.activeItems=c.items.filter(m=>m.id===u?.id)),setTimeout(()=>o.focus(),0))})),a.add(c.onDidAccept(g=>{c.selectedItems.length&&(u=c.selectedItems[0],n.executeCommand(u.id))})),a.add(c.onDidTriggerItemButton(g=>{g.item&&(u=g.item,n.executeCommand(u.id))})),a.add(c.onDidTriggerButton(g=>{if(g===d)c.hide();else if(g===l){const m=v=>{const y=t.inspect(v);t.updateValue(v,y.defaultValue)};m("workbench.activityBar.location"),m("workbench.sideBar.location"),m("workbench.statusBar.visible"),m("workbench.panel.defaultLocation"),(!qt||!ra)&&m("window.menuBarVisibility"),n.executeCommand("workbench.action.alignPanelCenter"),n.executeCommand("workbench.action.alignQuickInputTop")}})),a.add(c.onDidHide(()=>{c.dispose()})),a.add(c.onDispose(()=>{this._currentQuickPick=void 0,a.dispose()})),c.show()}});const xKe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),IKe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Be(IKe);const I_=Y;var _s;(function(s){s[s.HIDDEN=0]="HIDDEN",s[s.VISIBLE=1]="VISIBLE",s[s.FOCUSED=2]="FOCUSED",s[s.OPEN=3]="OPEN"})(_s||(_s={}));class as extends F{static{this.OVERFLOW_INDEX=-1}constructor(e,t,i){super(),this.container=e,this.options=t,this.menuStyle=i,this._mnemonicsInUse=!1,this.openedViaKeyboard=!1,this.awaitingAltRelease=!1,this.ignoreNextMouseUp=!1,this.updatePending=!1,this.numMenusShown=0,this.overflowLayoutScheduled=void 0,this.menuDisposables=this._register(new U),this.container.setAttribute("role","menubar"),this.isCompact&&this.container.classList.add("compact"),this.menus=[],this.mnemonics=new Map,this._focusState=_s.VISIBLE,this._onVisibilityChange=this._register(new M),this._onFocusStateChange=this._register(new M),this.createOverflowMenu(),this.menuUpdater=this._register(new fn(()=>this.update(),200)),this.actionRunner=this.options.actionRunner??this._register(new _g),this._register(this.actionRunner.onWillRun(()=>{this.setUnfocusedState()})),this._register(LT.getInstance().event(this.onModifierKeyToggled,this)),this._register(re(this.container,pe.KEY_DOWN,o=>{const r=new zs(o);let a=!0;const c=o.key?o.key.toLocaleLowerCase():"",d=qt&&!this.isCompact;if(r.equals(S.LeftArrow)||d&&r.equals(S.Tab|E.Shift))this.focusPrevious();else if(r.equals(S.RightArrow)||d&&r.equals(S.Tab))this.focusNext();else if(r.equals(S.Escape)&&this.isFocused&&!this.isOpen)this.setUnfocusedState();else if(!this.isOpen&&!r.ctrlKey&&this.options.enableMnemonics&&this.mnemonicsInUse&&this.mnemonics.has(c)){const l=this.mnemonics.get(c);this.onMenuTriggered(l,!1)}else a=!1;!this.isCompact&&(r.equals(S.Tab|E.Shift)||r.equals(S.Tab))&&r.preventDefault(),a&&(r.preventDefault(),r.stopPropagation())}));const n=bt(this.container);this._register(re(n,pe.MOUSE_DOWN,()=>{this.isFocused&&this.setUnfocusedState()})),this._register(re(this.container,pe.FOCUS_IN,o=>{const r=o;r.relatedTarget&&(this.container.contains(r.relatedTarget)||(this.focusToReturn=r.relatedTarget))})),this._register(re(this.container,pe.FOCUS_OUT,o=>{const r=o;r.relatedTarget?r.relatedTarget&&!this.container.contains(r.relatedTarget)&&(this.focusToReturn=void 0,this.setUnfocusedState()):this.setUnfocusedState()})),this._register(re(n,pe.KEY_DOWN,o=>{if(!this.options.enableMnemonics||!o.altKey||o.ctrlKey||o.defaultPrevented)return;const r=o.key.toLocaleLowerCase();if(!this.mnemonics.has(r))return;this.mnemonicsInUse=!0,this.updateMnemonicVisibility(!0);const a=this.mnemonics.get(r);this.onMenuTriggered(a,!1)})),this.setUnfocusedState()}push(e){cw(e).forEach(i=>{const n=this.menus.length,o=s6(i.label),r=o6.exec(i.label);if(r){const a=r[1]?r[1]:r[3];this.registerMnemonic(this.menus.length,a)}if(this.isCompact)this.menus.push(i);else{const a=I_("div.menubar-menu-button",{role:"menuitem",tabindex:-1,"aria-label":o,"aria-haspopup":!0}),c=I_("div.menubar-menu-title",{role:"none","aria-hidden":!0});a.appendChild(c),this.container.insertBefore(a,this.overflowMenu.buttonElement),this.updateLabels(c,a,i.label),this._register(re(a,pe.KEY_UP,d=>{const l=new zs(d);let u=!0;(l.equals(S.DownArrow)||l.equals(S.Enter))&&!this.isOpen?(this.focusedMenu={index:n},this.openedViaKeyboard=!0,this.focusState=_s.OPEN):u=!1,u&&(l.preventDefault(),l.stopPropagation())})),this._register(Th.addTarget(a)),this._register(re(a,Vo.Tap,d=>{this.isOpen&&this.focusedMenu&&this.focusedMenu.holder&&Ku(d.initialTarget,this.focusedMenu.holder)||(this.ignoreNextMouseUp=!1,this.onMenuTriggered(n,!0),d.preventDefault(),d.stopPropagation())})),this._register(re(a,pe.MOUSE_DOWN,d=>{if(!new us(bt(a),d).leftButton){d.preventDefault();return}this.isOpen?this.ignoreNextMouseUp=!1:(this.ignoreNextMouseUp=!0,this.onMenuTriggered(n,!0)),d.preventDefault(),d.stopPropagation()})),this._register(re(a,pe.MOUSE_UP,d=>{d.defaultPrevented||(this.ignoreNextMouseUp?this.ignoreNextMouseUp=!1:this.isFocused&&this.onMenuTriggered(n,!0))})),this._register(re(a,pe.MOUSE_ENTER,()=>{this.isOpen&&!this.isCurrentMenu(n)?(a.focus(),this.cleanupCustomMenu(),this.showCustomMenu(n,!1)):this.isFocused&&!this.isOpen&&(this.focusedMenu={index:n},a.focus())})),this.menus.push({label:i.label,actions:i.actions,buttonElement:a,titleElement:c})}})}createOverflowMenu(){const e=this.isCompact?h(27,"Application Menu"):h(28,"More"),t=I_("div.menubar-menu-button",{role:"menuitem",tabindex:this.isCompact?0:-1,"aria-label":e,"aria-haspopup":!0}),i=I_("div.menubar-menu-title.toolbar-toggle-more"+Te.asCSSSelector(j.menuBarMore),{role:"none","aria-hidden":!0});t.appendChild(i),this.container.appendChild(t),t.style.visibility="hidden",this._register(re(t,pe.KEY_UP,n=>{const o=new zs(n);let r=!0;const a=[S.Enter];this.isCompact?(a.push(S.Space),this.options.compactMode?.horizontal===jf.Right?a.push(S.RightArrow):this.options.compactMode?.horizontal===jf.Left&&a.push(S.LeftArrow)):a.push(S.DownArrow),a.some(c=>o.equals(c))&&!this.isOpen?(this.focusedMenu={index:as.OVERFLOW_INDEX},this.openedViaKeyboard=!0,this.focusState=_s.OPEN):r=!1,r&&(o.preventDefault(),o.stopPropagation())})),this._register(Th.addTarget(t)),this._register(re(t,Vo.Tap,n=>{this.isOpen&&this.focusedMenu&&this.focusedMenu.holder&&Ku(n.initialTarget,this.focusedMenu.holder)||(this.ignoreNextMouseUp=!1,this.onMenuTriggered(as.OVERFLOW_INDEX,!0),n.preventDefault(),n.stopPropagation())})),this._register(re(t,pe.MOUSE_DOWN,n=>{if(!new us(bt(t),n).leftButton){n.preventDefault();return}this.isOpen?this.ignoreNextMouseUp=!1:(this.ignoreNextMouseUp=!0,this.onMenuTriggered(as.OVERFLOW_INDEX,!0)),n.preventDefault(),n.stopPropagation()})),this._register(re(t,pe.MOUSE_UP,n=>{n.defaultPrevented||(this.ignoreNextMouseUp?this.ignoreNextMouseUp=!1:this.isFocused&&this.onMenuTriggered(as.OVERFLOW_INDEX,!0))})),this._register(re(t,pe.MOUSE_ENTER,()=>{this.isOpen&&!this.isCurrentMenu(as.OVERFLOW_INDEX)?(this.overflowMenu.buttonElement.focus(),this.cleanupCustomMenu(),this.showCustomMenu(as.OVERFLOW_INDEX,!1)):this.isFocused&&!this.isOpen&&(this.focusedMenu={index:as.OVERFLOW_INDEX},t.focus())})),this.overflowMenu={buttonElement:t,titleElement:i,label:"More",actions:[]}}updateMenu(e){const t=this.menus.filter(i=>i.label===e.label);t&&t.length&&(t[0].actions=e.actions)}dispose(){super.dispose(),this.menus.forEach(e=>{e.titleElement?.remove(),e.buttonElement?.remove()}),this.overflowMenu.titleElement.remove(),this.overflowMenu.buttonElement.remove(),Qe(this.overflowLayoutScheduled),this.overflowLayoutScheduled=void 0}blur(){this.setUnfocusedState()}getWidth(){if(!this.isCompact&&this.menus){const e=this.menus[0].buttonElement.getBoundingClientRect().left;return(this.hasOverflow?this.overflowMenu.buttonElement.getBoundingClientRect().right:this.menus[this.menus.length-1].buttonElement.getBoundingClientRect().right)-e}return 0}getHeight(){return this.container.clientHeight}toggleFocus(){!this.isFocused&&this.options.visibility!=="hidden"?(this.mnemonicsInUse=!0,this.focusedMenu={index:this.numMenusShown>0?0:as.OVERFLOW_INDEX},this.focusState=_s.FOCUSED):this.isOpen||this.setUnfocusedState()}updateOverflowAction(){if(!this.menus||!this.menus.length)return;const e="overflow-menu-only";this.container.classList.toggle(e,!1);const t=this.container.offsetWidth;let i=0,n=this.isCompact;const o=this.numMenusShown;this.numMenusShown=0;const r=this.menus.filter(a=>a.buttonElement!==void 0&&a.titleElement!==void 0);for(const a of r){if(!n){const c=a.buttonElement.offsetWidth;i+c>t?n=!0:(i+=c,this.numMenusShown++,this.numMenusShown>o&&(a.buttonElement.style.visibility="visible"))}n&&(a.buttonElement.style.visibility="hidden")}if(this.numMenusShown-1<=r.length/4){for(const a of r)a.buttonElement.style.visibility="hidden";n=!0,this.numMenusShown=0,i=0}if(this.isCompact){this.overflowMenu.actions=[];for(let c=this.numMenusShown;c<this.menus.length;c++)this.overflowMenu.actions.push(new Dh(`menubar.submenu.${this.menus[c].label}`,this.menus[c].label,this.menus[c].actions||[]));const a=this.options.getCompactMenuActions?.();a&&a.length&&(this.overflowMenu.actions.push(new is),this.overflowMenu.actions.push(...a)),this.overflowMenu.buttonElement.style.visibility="visible"}else if(n){for(;i+this.overflowMenu.buttonElement.offsetWidth>t&&this.numMenusShown>0;){this.numMenusShown--;const a=r[this.numMenusShown].buttonElement.offsetWidth;r[this.numMenusShown].buttonElement.style.visibility="hidden",i-=a}this.overflowMenu.actions=[];for(let a=this.numMenusShown;a<r.length;a++)this.overflowMenu.actions.push(new Dh(`menubar.submenu.${r[a].label}`,r[a].label,r[a].actions||[]));this.overflowMenu.buttonElement.nextElementSibling!==r[this.numMenusShown].buttonElement&&(this.overflowMenu.buttonElement.remove(),this.container.insertBefore(this.overflowMenu.buttonElement,r[this.numMenusShown].buttonElement)),this.overflowMenu.buttonElement.style.visibility="visible"}else this.overflowMenu.buttonElement.remove(),this.container.appendChild(this.overflowMenu.buttonElement),this.overflowMenu.buttonElement.style.visibility="hidden";this.container.classList.toggle(e,this.numMenusShown===0)}updateLabels(e,t,i){const n=s6(i);if(this.options.enableMnemonics){const r=Fq(i);o0.lastIndex=0;let a=o0.exec(r);for(;a&&a[1];)a=o0.exec(r);const c=d=>d.replace(/&amp;&amp;/g,"&amp;");a?(e.innerText="",e.append(Gne(c(r.substr(0,a.index))," "),I_("mnemonic",{"aria-hidden":"true"},a[3]),$m(c(r.substr(a.index+a[0].length))," "))):e.innerText=c(r).trim()}else e.innerText=n.replace(/&&/g,"&");const o=o6.exec(i);if(o){const r=o[1]?o[1]:o[3];this.options.enableMnemonics?t.setAttribute("aria-keyshortcuts","Alt+"+r.toLocaleLowerCase()):t.removeAttribute("aria-keyshortcuts")}}update(e){if(e&&(this.options=e),this.isFocused){this.updatePending=!0;return}this.menus.forEach(t=>{!t.buttonElement||!t.titleElement||this.updateLabels(t.titleElement,t.buttonElement,t.label)}),this.overflowLayoutScheduled||(this.overflowLayoutScheduled=kE(bt(this.container),()=>{this.updateOverflowAction(),this.overflowLayoutScheduled=void 0})),this.setUnfocusedState()}registerMnemonic(e,t){this.mnemonics.set(t.toLocaleLowerCase(),e)}hideMenubar(){this.container.style.display!=="none"&&(this.container.style.display="none",this._onVisibilityChange.fire(!1))}showMenubar(){this.container.style.display!=="flex"&&(this.container.style.display="flex",this._onVisibilityChange.fire(!0),this.updateOverflowAction())}get focusState(){return this._focusState}set focusState(e){if(this._focusState>=_s.FOCUSED&&e<_s.FOCUSED&&this.updatePending&&(this.menuUpdater.schedule(),this.updatePending=!1),e===this._focusState)return;const t=this.isVisible,i=this.isOpen,n=this.isFocused;switch(this._focusState=e,e){case _s.HIDDEN:t&&this.hideMenubar(),i&&this.cleanupCustomMenu(),n&&(this.focusedMenu=void 0,this.focusToReturn&&(this.focusToReturn.focus(),this.focusToReturn=void 0));break;case _s.VISIBLE:t||this.showMenubar(),i&&this.cleanupCustomMenu(),n&&(this.focusedMenu&&(this.focusedMenu.index===as.OVERFLOW_INDEX?this.overflowMenu.buttonElement.blur():this.menus[this.focusedMenu.index].buttonElement?.blur()),this.focusedMenu=void 0,this.focusToReturn&&(this.focusToReturn.focus(),this.focusToReturn=void 0));break;case _s.FOCUSED:t||this.showMenubar(),i&&this.cleanupCustomMenu(),this.focusedMenu&&(this.focusedMenu.index===0&&this.numMenusShown===0&&(this.focusedMenu.index=as.OVERFLOW_INDEX),this.focusedMenu.index===as.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[this.focusedMenu.index].buttonElement?.focus());break;case _s.OPEN:t||this.showMenubar(),this.focusedMenu&&(this.cleanupCustomMenu(),this.showCustomMenu(this.focusedMenu.index,this.openedViaKeyboard));break}this._focusState=e,this._onFocusStateChange.fire(this.focusState>=_s.FOCUSED)}get isVisible(){return this.focusState>=_s.VISIBLE}get isFocused(){return this.focusState>=_s.FOCUSED}get isOpen(){return this.focusState>=_s.OPEN}get hasOverflow(){return this.isCompact||this.numMenusShown<this.menus.length}get isCompact(){return this.options.compactMode!==void 0}setUnfocusedState(){this.options.visibility==="toggle"||this.options.visibility==="hidden"?this.focusState=_s.HIDDEN:this.options.visibility==="classic"&&Cse($i)?this.focusState=_s.HIDDEN:this.focusState=_s.VISIBLE,this.ignoreNextMouseUp=!1,this.mnemonicsInUse=!1,this.updateMnemonicVisibility(!1)}focusPrevious(){if(!this.focusedMenu||this.numMenusShown===0)return;let e=(this.focusedMenu.index-1+this.numMenusShown)%this.numMenusShown;this.focusedMenu.index===as.OVERFLOW_INDEX?e=this.numMenusShown-1:this.focusedMenu.index===0&&this.hasOverflow&&(e=as.OVERFLOW_INDEX),e!==this.focusedMenu.index&&(this.isOpen?(this.cleanupCustomMenu(),this.showCustomMenu(e)):this.isFocused&&(this.focusedMenu.index=e,e===as.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[e].buttonElement?.focus()))}focusNext(){if(!this.focusedMenu||this.numMenusShown===0)return;let e=(this.focusedMenu.index+1)%this.numMenusShown;this.focusedMenu.index===as.OVERFLOW_INDEX?e=0:this.focusedMenu.index===this.numMenusShown-1&&(e=as.OVERFLOW_INDEX),e!==this.focusedMenu.index&&(this.isOpen?(this.cleanupCustomMenu(),this.showCustomMenu(e)):this.isFocused&&(this.focusedMenu.index=e,e===as.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[e].buttonElement?.focus()))}updateMnemonicVisibility(e){this.menus&&this.menus.forEach(t=>{if(t.titleElement&&t.titleElement.children.length){const i=t.titleElement.children.item(0);i&&(i.style.textDecoration=this.options.alwaysOnMnemonics||e?"underline":"")}})}get mnemonicsInUse(){return this._mnemonicsInUse}set mnemonicsInUse(e){this._mnemonicsInUse=e}get shouldAltKeyFocus(){return qt?!1:!this.options.disableAltFocus||this.options.visibility==="toggle"}get onVisibilityChange(){return this._onVisibilityChange.event}get onFocusStateChange(){return this._onFocusStateChange.event}onMenuTriggered(e,t){this.isOpen?this.isCurrentMenu(e)?this.setUnfocusedState():(this.cleanupCustomMenu(),this.showCustomMenu(e,this.openedViaKeyboard)):(this.focusedMenu={index:e},this.openedViaKeyboard=!t,this.focusState=_s.OPEN)}onModifierKeyToggled(e){const t=!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey;this.options.visibility!=="hidden"&&(e.event&&this.shouldAltKeyFocus&&Hwe.toEnum(e.event.code)===Uwe.AltLeft&&e.event.preventDefault(),this.isFocused&&e.lastKeyPressed==="alt"&&e.altKey&&(this.setUnfocusedState(),this.mnemonicsInUse=!1,this.awaitingAltRelease=!0),t&&e.lastKeyPressed==="alt"&&e.lastKeyReleased==="alt"&&(this.awaitingAltRelease||(!this.isFocused&&this.shouldAltKeyFocus?(this.mnemonicsInUse=!0,this.focusedMenu={index:this.numMenusShown>0?0:as.OVERFLOW_INDEX},this.focusState=_s.FOCUSED):this.isOpen||this.setUnfocusedState())),!e.altKey&&e.lastKeyReleased==="alt"&&(this.awaitingAltRelease=!1),this.options.enableMnemonics&&this.menus&&!this.isOpen&&this.updateMnemonicVisibility(!this.awaitingAltRelease&&e.altKey||this.mnemonicsInUse))}isCurrentMenu(e){return this.focusedMenu?this.focusedMenu.index===e:!1}cleanupCustomMenu(){this.focusedMenu&&(this.focusedMenu.index===as.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[this.focusedMenu.index].buttonElement?.focus(),this.focusedMenu.holder&&(this.focusedMenu.holder.parentElement?.classList.remove("open"),this.focusedMenu.holder.remove()),this.focusedMenu.widget?.dispose(),this.focusedMenu={index:this.focusedMenu.index}),this.menuDisposables.clear()}showCustomMenu(e,t=!0){const i=e>=this.numMenusShown?as.OVERFLOW_INDEX:e,n=i===as.OVERFLOW_INDEX?this.overflowMenu:this.menus[i];if(!n.actions||!n.buttonElement||!n.titleElement)return;const o=I_("div.menubar-menu-items-holder",{title:""});n.buttonElement.classList.add("open");const r=n.titleElement.getBoundingClientRect(),a=$we(n.titleElement);if(this.options.compactMode?.horizontal===jf.Right)o.style.left=`${r.left+this.container.clientWidth}px`;else if(this.options.compactMode?.horizontal===jf.Left){const l=bt(this.container).innerWidth;o.style.right=`${l-r.left}px`,o.style.left="auto"}else o.style.left=`${r.left*a}px`;this.options.compactMode?.vertical===mC.Above?o.style.top=`${r.top-this.menus.length*30+this.container.clientHeight}px`:this.options.compactMode?.vertical===mC.Below?o.style.top=`${r.top}px`:o.style.top=`${r.bottom*a}px`,n.buttonElement.appendChild(o);const c={getKeyBinding:this.options.getKeybinding,actionRunner:this.actionRunner,enableMnemonics:this.options.alwaysOnMnemonics||this.mnemonicsInUse&&this.options.enableMnemonics,ariaLabel:n.buttonElement.getAttribute("aria-label")??void 0,expandDirection:this.isCompact?this.options.compactMode:{horizontal:jf.Right,vertical:mC.Below},useEventAsContext:!0},d=this.menuDisposables.add(new Gwe(o,n.actions,c,this.menuStyle));this.menuDisposables.add(d.onDidCancel(()=>{this.focusState=_s.FOCUSED})),i!==e?d.trigger(e-this.numMenusShown):d.focus(t),this.focusedMenu={index:i,holder:o,widget:d}}}function fie(s){return s&&s.hasOwnProperty("folderUri")}function DKe(s){return s&&s.hasOwnProperty("workspace")}const lfe="inRecentFilesPicker";class hfe extends X{constructor(e){super(e),this.removeFromRecentlyOpened={iconClass:Te.asClassName(j.removeClose),tooltip:h(2792,"Remove from Recently Opened")},this.dirtyRecentlyOpenedFolder={iconClass:"dirty-workspace "+Te.asClassName(j.closeDirty),tooltip:h(2793,"Folder With Unsaved Files"),alwaysVisible:!0},this.dirtyRecentlyOpenedWorkspace={...this.dirtyRecentlyOpenedFolder,tooltip:h(2794,"Workspace With Unsaved Files")}}async run(e){const t=e.get(Wh),i=e.get(zt),n=e.get(Tt),o=e.get(di),r=e.get(Ve),a=e.get(ai),c=e.get(fi),d=e.get(Wn),l=e.get(Qt),u=await t.getRecentlyOpened(),g=await t.getDirtyWorkspaces();let m=!1;const v=new wn,y=new wn;for(const Se of g)fie(Se)?v.set(Se.folderUri,!0):(y.set(Se.workspace.configPath,Se.workspace),m=!0);const w=new wn,C=new wn;for(const Se of u.workspaces)Nk(Se)?w.set(Se.folderUri,!0):(C.set(Se.workspace.configPath,Se.workspace),m=!0);const T=[];for(const Se of u.workspaces){const Ft=Nk(Se)?v.has(Se.folderUri):y.has(Se.workspace.configPath);T.push(this.toQuickPick(a,c,o,Se,Ft))}for(const Se of g)fie(Se)&&!w.has(Se.folderUri)?T.push(this.toQuickPick(a,c,o,Se,!0)):DKe(Se)&&!C.has(Se.workspace.configPath)&&T.push(this.toQuickPick(a,c,o,Se,!0));const k=u.files.map(Se=>this.toQuickPick(a,c,o,Se,!1)),A=u.workspaces[0],B=A&&n.isCurrentWorkspace(ZF(A)?A.workspace:A.folderUri);let z;const Q={type:"separator",label:m?h(2795,"folders & workspaces"):h(2796,"folders")},ie={type:"separator",label:h(2797,"files")},oe=[Q,...T,ie,...k],xe=await i.pick(oe,{contextKey:lfe,activeItem:[...T,...k][B?1:0],placeHolder:qt?h(2798,"Select to open (hold Cmd-key to force new window or Option-key for same window)"):h(2799,"Select to open (hold Ctrl-key to force new window or Alt-key for same window)"),matchOnDescription:!0,onKeyMods:Se=>z=Se,quickNavigate:this.isQuickNavigate()?{keybindings:r.lookupKeybindings(this.desc.id)}:void 0,hideInput:this.isQuickNavigate(),onDidTriggerItemButton:async Se=>{if(Se.button===this.removeFromRecentlyOpened)await t.removeRecentlyOpened([Se.item.resource]),Se.removeItem();else if(Se.button===this.dirtyRecentlyOpenedFolder||Se.button===this.dirtyRecentlyOpenedWorkspace){const Ft=Se.button===this.dirtyRecentlyOpenedWorkspace,{confirmed:it}=await l.confirm({title:Ft?h(2800,"Workspace with Unsaved Files"):h(2801,"Folder with Unsaved Files"),message:Ft?h(2802,"Do you want to open the workspace to review the unsaved files?"):h(2803,"Do you want to open the folder to review the unsaved files?"),detail:Ft?h(2804,"Workspaces with unsaved files cannot be removed until all unsaved files have been saved or reverted."):h(2805,"Folders with unsaved files cannot be removed until all unsaved files have been saved or reverted.")});it&&(d.openWindow([Se.item.openable],{remoteAuthority:Se.item.remoteAuthority||null}),i.cancel())}}});if(xe)return d.openWindow([xe.openable],{forceNewWindow:z?.ctrlCmd,forceReuseWindow:z?.alt,remoteAuthority:xe.remoteAuthority||null})}toQuickPick(e,t,i,n,o){let r,a,c,d,l=!1;Nk(n)?(d=n.folderUri,a=uh(e,t,d,Hi.FOLDER),r={folderUri:d},c=n.label||i.getWorkspaceLabel(d,{verbose:Qm.LONG})):ZF(n)?(d=n.workspace.configPath,a=uh(e,t,d,Hi.ROOT_FOLDER),r={workspaceUri:d},c=n.label||i.getWorkspaceLabel(n.workspace,{verbose:Qm.LONG}),l=!0):(d=n.fileUri,a=uh(e,t,d,Hi.FILE),r={fileUri:d},c=n.label||i.getUriLabel(d,{appendWorkspaceSuffix:!0}));const{name:u,parentPath:g}=zwe(c);return{iconClasses:a,label:u,ariaLabel:o?l?h(2806,"{0}, workspace with unsaved changes",u):h(2807,"{0}, folder with unsaved changes",u):u,description:g,buttons:o?[l?this.dirtyRecentlyOpenedWorkspace:this.dirtyRecentlyOpenedFolder]:[this.removeFromRecentlyOpened],openable:r,resource:d,remoteAuthority:n.remoteAuthority}}}class q1 extends hfe{static{this.ID="workbench.action.openRecent"}constructor(){super({id:q1.ID,title:{...I(2808,"Open Recent..."),mnemonicTitle:h(2809,"&&More...")},category:te.File,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyR,mac:{primary:E.WinCtrl|S.KeyR}},precondition:Jm.toNegated(),menu:{id:N.MenubarRecentMenu,group:"y_more",order:1,when:Jm.toNegated()}})}isQuickNavigate(){return!1}}class kKe extends hfe{constructor(){super({id:"workbench.action.quickOpenRecent",title:I(2810,"Quick Open Recent..."),category:te.File,f1:!1})}isQuickNavigate(){return!0}}class TKe extends X{constructor(){super({id:"workbench.action.toggleFullScreen",title:{...I(2811,"Toggle Full Screen"),mnemonicTitle:h(2812,"&&Full Screen")},category:te.View,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:S.F11,mac:{primary:E.CtrlCmd|E.WinCtrl|S.KeyF}},precondition:Kwe.toNegated(),toggled:Gp,menu:[{id:N.MenubarAppearanceMenu,group:"1_toggle_view",order:1}]})}run(e){return e.get(Wn).toggleFullScreen(Vp())}}class r7 extends X{static{this.ID="workbench.action.reloadWindow"}constructor(){super({id:r7.ID,title:I(2813,"Reload Window"),category:te.Developer,f1:!0,keybinding:{weight:W.WorkbenchContrib+50,when:qwe,primary:E.CtrlCmd|S.KeyR}})}async run(e){return e.get(Wn).reload()}}class AKe extends X{constructor(){super({id:"workbench.action.showAboutDialog",title:{...I(2814,"About"),mnemonicTitle:h(2815,"&&About")},category:te.Help,f1:!0,menu:{id:N.MenubarHelpMenu,group:"z_about",order:1,when:eg.toNegated()}})}run(e){return e.get(Qt).about()}}class RKe extends X{constructor(){super({id:"workbench.action.newWindow",title:{...I(2816,"New Window"),mnemonicTitle:h(2817,"New &&Window")},f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:$t?pn?lt(E.CtrlCmd|S.KeyK,E.Shift|S.KeyN):E.CtrlCmd|E.Alt|E.Shift|S.KeyN:E.CtrlCmd|E.Shift|S.KeyN,secondary:$t?[E.CtrlCmd|E.Shift|S.KeyN]:void 0},precondition:Jm.toNegated(),menu:{id:N.MenubarFileMenu,group:"1_new",order:3,when:Jm.toNegated()}})}run(e){return e.get(Wn).openWindow({remoteAuthority:null})}}class PKe extends X{constructor(){super({id:"workbench.action.blur",title:I(2818,"Remove keyboard focus from focused element")})}run(){const e=Eh();Mh(e)&&e.blur()}}K(RKe);K(TKe);K(kKe);K(q1);K(r7);K(AKe);K(PKe);const ufe=x.and(Rl,x.has(lfe)),mie="workbench.action.quickOpenNavigateNextInRecentFilesPicker";Le.registerCommandAndKeybindingRule({id:mie,weight:W.WorkbenchContrib+50,handler:hS(mie,!0),when:ufe,primary:E.CtrlCmd|S.KeyR,mac:{primary:E.WinCtrl|S.KeyR}});const vie="workbench.action.quickOpenNavigatePreviousInRecentFilesPicker";Le.registerCommandAndKeybindingRule({id:vie,weight:W.WorkbenchContrib+50,handler:hS(vie,!1),when:ufe,primary:E.CtrlCmd|E.Shift|S.KeyR,mac:{primary:E.WinCtrl|E.Shift|S.KeyR}});Ce.registerCommand("workbench.action.toggleConfirmBeforeClose",s=>{const e=s.get(ne),t=e.inspect("window.confirmBeforeClose").userValue;return e.updateValue("window.confirmBeforeClose",t==="never"?"keyboardOnly":"never")});ge.appendMenuItem(N.MenubarFileMenu,{group:"z_ConfirmClose",command:{id:"workbench.action.toggleConfirmBeforeClose",title:h(2819,"Confirm Before Close"),toggled:x.notEquals("config.window.confirmBeforeClose","never")},order:1,when:x.and(Jm.toNegated(),Ru)});ge.appendMenuItem(N.MenubarFileMenu,{title:h(2820,"Open &&Recent"),submenu:N.MenubarRecentMenu,group:"2_open",order:4,when:Jm.toNegated()});Be(xKe);ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarFileMenu,title:{value:"File",original:"File",mnemonicTitle:h(3492,"&&File")},order:1});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarEditMenu,title:{value:"Edit",original:"Edit",mnemonicTitle:h(3493,"&&Edit")},order:2});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarSelectionMenu,title:{value:"Selection",original:"Selection",mnemonicTitle:h(3494,"&&Selection")},order:3});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarViewMenu,title:{value:"View",original:"View",mnemonicTitle:h(3495,"&&View")},order:4});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarGoMenu,title:{value:"Go",original:"Go",mnemonicTitle:h(3496,"&&Go")},order:5});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarTerminalMenu,title:{value:"Terminal",original:"Terminal",mnemonicTitle:h(3497,"&&Terminal")},order:7});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarHelpMenu,title:{value:"Help",original:"Help",mnemonicTitle:h(3498,"&&Help")},order:8});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarPreferencesMenu,title:{value:"Preferences",original:"Preferences",mnemonicTitle:h(3499,"Preferences")},when:eg,order:9});class DM extends F{static{this.MAX_MENU_RECENT_ENTRIES=10}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(),this.menuService=e,this.workspacesService=t,this.contextKeyService=i,this.keybindingService=n,this.configurationService=o,this.labelService=r,this.updateService=a,this.storageService=c,this.notificationService=d,this.preferencesService=l,this.environmentService=u,this.accessibilityService=g,this.hostService=m,this.commandService=v,this.keys=[Qr.MenuBarVisibility,"window.enableMenuBarMnemonics","window.customMenuBarAltFocus","workbench.sideBar.location","window.nativeTabs"],this.menus={},this.topLevelTitles={},this.recentlyOpened={files:[],workspaces:[]},this.mainMenu=this._register(this.menuService.createMenu(N.MenubarMainMenu,this.contextKeyService)),this.mainMenuDisposables=this._register(new U),this.setupMainMenu(),this.menuUpdater=this._register(new fn(()=>this.doUpdateMenubar(!1),200)),this.notifyUserOfCustomMenubarAccessibility()}registerListeners(){this._register(this.hostService.onDidChangeFocus(e=>this.onDidChangeWindowFocus(e))),this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e))),this._register(this.updateService.onStateChange(()=>this.onUpdateStateChange())),this._register(this.workspacesService.onDidChangeRecentlyOpened(()=>{this.onDidChangeRecentlyOpened()})),this._register(this.keybindingService.onDidUpdateKeybindings(()=>this.updateMenubar())),this._register(this.labelService.onDidChangeFormatters(()=>{this.onDidChangeRecentlyOpened()})),this._register(this.mainMenu.onDidChange(()=>{this.setupMainMenu(),this.doUpdateMenubar(!0)}))}setupMainMenu(){this.mainMenuDisposables.clear(),this.menus={},this.topLevelTitles={};const[,e]=this.mainMenu.getActions()[0];for(const t of e)t instanceof kh&&typeof t.item.title!="string"&&(this.menus[t.item.title.original]=this.mainMenuDisposables.add(this.menuService.createMenu(t.item.submenu,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.topLevelTitles[t.item.title.original]=t.item.title.mnemonicTitle??t.item.title.value)}updateMenubar(){this.menuUpdater.schedule()}calculateActionLabel(e){return e.label}onUpdateStateChange(){this.updateMenubar()}onUpdateKeybindings(){this.updateMenubar()}getOpenRecentActions(){if(!this.recentlyOpened)return[];const{workspaces:e,files:t}=this.recentlyOpened,i=[];if(e.length>0){for(let n=0;n<DM.MAX_MENU_RECENT_ENTRIES&&n<e.length;n++)i.push(this.createOpenRecentMenuAction(e[n]));i.push(new is)}if(t.length>0){for(let n=0;n<DM.MAX_MENU_RECENT_ENTRIES&&n<t.length;n++)i.push(this.createOpenRecentMenuAction(t[n]));i.push(new is)}return i}onDidChangeWindowFocus(e){e&&this.onDidChangeRecentlyOpened()}onConfigurationUpdated(e){this.keys.some(t=>e.affectsConfiguration(t))&&this.updateMenubar(),e.affectsConfiguration("editor.accessibilitySupport")&&this.notifyUserOfCustomMenubarAccessibility(),e.affectsConfiguration(Qr.MenuBarVisibility)&&this.onDidChangeRecentlyOpened()}get menubarHidden(){return qt&&ra?!1:Ab(this.configurationService)==="hidden"}onDidChangeRecentlyOpened(){this.menubarHidden||this.workspacesService.getRecentlyOpened().then(e=>{this.recentlyOpened=e,this.updateMenubar()})}createOpenRecentMenuAction(e){let t,i,n,o;const r=e.remoteAuthority;Nk(e)?(i=e.folderUri,t=e.label||this.labelService.getWorkspaceLabel(i,{verbose:Qm.LONG}),n="openRecentFolder",o={folderUri:i}):ZF(e)?(i=e.workspace.configPath,t=e.label||this.labelService.getWorkspaceLabel(e.workspace,{verbose:Qm.LONG}),n="openRecentWorkspace",o={workspaceUri:i}):(i=e.fileUri,t=e.label||this.labelService.getUriLabel(i,{appendWorkspaceSuffix:!0}),n="openRecentFile",o={fileUri:i});const a=Ci({id:n,label:jwe(t),run:c=>{const d=c&&(!qt&&(c.ctrlKey||c.shiftKey)||qt&&(c.metaKey||c.altKey));return this.hostService.openWindow([o],{forceNewWindow:!!d,remoteAuthority:r||null})}});return Object.assign(a,{uri:i,remoteAuthority:r})}notifyUserOfCustomMenubarAccessibility(){if($t||qt)return;const e=this.storageService.getBoolean("menubar/accessibleMenubarNotified",he.APPLICATION,!1),t=!Ywe(this.configurationService);if(e||t||!this.accessibilityService.isScreenReaderOptimized())return;const i=h(3500,"Accessibility support is enabled for you. For the most accessible experience, we recommend the custom menu style.");this.notificationService.prompt(Me.Info,i,[{label:h(3501,"Open Settings"),run:()=>this.preferencesService.openUserSettings({query:Qr.MenuStyle})}]),this.storageService.store("menubar/accessibleMenubarNotified",!0,he.APPLICATION,pt.USER)}}let _k;function LKe(){return _k||(_k=new M,K(class extends X{constructor(){super({id:"workbench.actions.menubar.focus",title:I(3502,"Focus Application Menu"),keybinding:{primary:E.Alt|S.F10,weight:W.WorkbenchContrib,when:Ru},f1:!0})}async run(){_k?.fire()}})),_k}let QG=class extends DM{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y){super(e,t,i,n,o,r,a,c,d,l,u,g,v,y),this.telemetryService=m,this.alwaysOnMnemonics=!1,this.focusInsideMenubar=!1,this.pendingFirstTimeUpdate=!1,this.visible=!0,this.webNavigationMenu=this._register(this.menuService.createMenu(N.MenubarHomeMenu,this.contextKeyService)),this.reinstallDisposables=this._register(new U),this.updateActionsDisposables=this._register(new U),this._onVisibilityChange=this._register(new M),this._onFocusStateChange=this._register(new M),this.actionRunner=this._register(new _g),this.actionRunner.onDidRun(w=>{this.telemetryService.publicLog2("workbenchActionExecuted",{id:w.action.id,from:"menu"})}),this.workspacesService.getRecentlyOpened().then(w=>{this.recentlyOpened=w}),this.registerListeners()}doUpdateMenubar(e){this.focusInsideMenubar||this.setupCustomMenubar(e),e&&(this.pendingFirstTimeUpdate=!0)}getUpdateAction(){switch(this.updateService.state.type){case qd.Idle:return new Kt("update.check",h(3503,"Check for &&Updates..."),void 0,!0,()=>this.updateService.checkForUpdates(!0));case qd.CheckingForUpdates:return new Kt("update.checking",h(3504,"Checking for Updates..."),void 0,!1);case qd.AvailableForDownload:return new Kt("update.downloadNow",h(3505,"D&&ownload Update"),void 0,!0,()=>this.updateService.downloadUpdate());case qd.Downloading:return new Kt("update.downloading",h(3506,"Downloading Update..."),void 0,!1);case qd.Downloaded:return qt?null:new Kt("update.install",h(3507,"Install &&Update..."),void 0,!0,()=>this.updateService.applyUpdate());case qd.Updating:return new Kt("update.updating",h(3508,"Installing Update..."),void 0,!1);case qd.Ready:return new Kt("update.restart",h(3509,"Restart to &&Update"),void 0,!0,()=>this.updateService.quitAndInstall());default:return null}}get currentMenubarVisibility(){return Ab(this.configurationService)}get currentDisableMenuBarAltFocus(){const e=this.configurationService.getValue("window.customMenuBarAltFocus");let t=!1;return typeof e=="boolean"&&(t=!e),t}insertActionsBefore(e,t){switch(e.id){case q1.ID:t.push(...this.getOpenRecentActions());break;case"workbench.action.showAboutDialog":if(!qt&&!$t){const i=this.getUpdateAction();i&&(i.label=Og(i.label),t.push(i),t.push(new is))}break}}get currentEnableMenuBarMnemonics(){let e=this.configurationService.getValue("window.enableMenuBarMnemonics");return typeof e!="boolean"&&(e=!0),e&&(!$t||Cse($i))}get currentCompactMenuMode(){if(this.currentMenubarVisibility!=="compact")return;const t=this.configurationService.getValue("workbench.sideBar.location")==="right"?jf.Left:jf.Right,n=this.configurationService.getValue("workbench.activityBar.location")===jo.BOTTOM?mC.Above:mC.Below;return{horizontal:t,vertical:n}}onDidVisibilityChange(e){this.visible=e,this.onDidChangeRecentlyOpened(),this._onVisibilityChange.fire(e)}toActionsArray(e){return sI(e.getActions({shouldForwardArgs:!0}))}setupCustomMenubar(e){if(!this.container)return;e?(this.menubar&&this.reinstallDisposables.clear(),this.menubar=this.reinstallDisposables.add(new as(this.container,this.getMenuBarOptions(),Qwe)),this.accessibilityService.alwaysUnderlineAccessKeys().then(i=>{this.alwaysOnMnemonics=i,this.menubar?.update(this.getMenuBarOptions())}),this.reinstallDisposables.add(this.menubar.onFocusStateChange(i=>{this._onFocusStateChange.fire(i),i||(this.pendingFirstTimeUpdate?(this.setupCustomMenubar(!0),this.pendingFirstTimeUpdate=!1):this.updateMenubar(),this.focusInsideMenubar=!1)})),this.reinstallDisposables.add(this.menubar.onVisibilityChange(i=>this.onDidVisibilityChange(i))),this.reinstallDisposables.add(re(this.container,pe.FOCUS_IN,()=>{this.focusInsideMenubar=!0})),this.reinstallDisposables.add(re(this.container,pe.FOCUS_OUT,()=>{this.focusInsideMenubar=!1})),this.menubar.isVisible&&this.onDidVisibilityChange(!0)):this.menubar?.update(this.getMenuBarOptions());const t=(i,n,o,r)=>{n.splice(0);for(const a of i)if(this.insertActionsBefore(a,n),a instanceof is)n.push(a);else if(a instanceof kh||a instanceof va){let c=typeof a.item.title=="string"?a.item.title:a.item.title.mnemonicTitle??a.item.title.value;if(a instanceof kh){const d=[];t(a.actions,d,o,r),d.length>0&&n.push(new Dh(a.id,Og(c),d))}else{Jwe(a.item.toggled)&&(c=a.item.toggled.mnemonicTitle??a.item.toggled.title??c);const d=r.add(new Kt(a.id,Og(c),a.class,a.enabled,()=>this.commandService.executeCommand(a.id)));d.tooltip=a.tooltip,d.checked=a.checked,n.push(d)}}if(o==="File"&&this.currentCompactMenuMode===void 0){const a=this.getWebNavigationActions();a.length&&n.push(...a)}};for(const i of Object.keys(this.topLevelTitles)){const n=this.menus[i];if(e&&n){const r=this.reinstallDisposables.add(new U);if(this.reinstallDisposables.add(n.onDidChange(()=>{if(!this.focusInsideMenubar){const a=[];r.clear(),t(this.toActionsArray(n),a,i,r),this.menubar?.updateMenu({actions:a,label:Og(this.topLevelTitles[i])})}})),n===this.menus.File){const a=this.reinstallDisposables.add(new U);this.reinstallDisposables.add(this.webNavigationMenu.onDidChange(()=>{if(!this.focusInsideMenubar){const c=[];a.clear(),t(this.toActionsArray(n),c,i,a),this.menubar?.updateMenu({actions:c,label:Og(this.topLevelTitles[i])})}}))}}const o=[];n&&(this.updateActionsDisposables.clear(),t(this.toActionsArray(n),o,i,this.updateActionsDisposables)),this.menubar&&(e?this.menubar.push({actions:o,label:Og(this.topLevelTitles[i])}):this.menubar.updateMenu({actions:o,label:Og(this.topLevelTitles[i])}))}}getWebNavigationActions(){if(!$t)return[];const e=[];for(const t of this.webNavigationMenu.getActions()){const[,i]=t;for(const n of i)if(n instanceof va){const o=typeof n.item.title=="string"?n.item.title:n.item.title.mnemonicTitle??n.item.title.value;e.push(new Kt(n.id,Og(o),n.class,n.enabled,async r=>{this.commandService.executeCommand(n.id,r)}))}e.push(new is)}return e.length&&e.pop(),e}getMenuBarOptions(){return{enableMnemonics:this.currentEnableMenuBarMnemonics,disableAltFocus:this.currentDisableMenuBarAltFocus,visibility:this.currentMenubarVisibility,actionRunner:this.actionRunner,getKeybinding:e=>this.keybindingService.lookupKeybinding(e.id),alwaysOnMnemonics:this.alwaysOnMnemonics,compactMode:this.currentCompactMenuMode,getCompactMenuActions:()=>$t?this.getWebNavigationActions():[]}}onDidChangeWindowFocus(e){this.visible&&(super.onDidChangeWindowFocus(e),this.container&&(e?this.container.classList.remove("inactive"):(this.container.classList.add("inactive"),this.menubar?.blur())))}onUpdateStateChange(){this.visible&&super.onUpdateStateChange()}onDidChangeRecentlyOpened(){this.visible&&super.onDidChangeRecentlyOpened()}onUpdateKeybindings(){this.visible&&super.onUpdateKeybindings()}registerListeners(){super.registerListeners(),this._register(re($i,pe.RESIZE,()=>{this.menubar&&!(EE&&Xwe.pointerEvents)&&this.menubar.blur()})),$t&&(this._register(Zwe(e=>{e===$i.vscodeWindowId&&this.updateMenubar()})),this._register(this.webNavigationMenu.onDidChange(()=>this.updateMenubar())),this._register(LKe().event(()=>this.menubar?.toggleFocus())))}get onVisibilityChange(){return this._onVisibilityChange.event}get onFocusStateChange(){return this._onFocusStateChange.event}getMenubarItemsDimensions(){return this.menubar?new Ke(this.menubar.getWidth(),this.menubar.getHeight()):new Ke(0,0)}create(e){return this.container=e,this.container&&this.doUpdateMenubar(!0),this.container}layout(e){this.menubar?.update(this.getMenuBarOptions())}toggleFocus(){this.menubar?.toggleFocus()}};QG=f([p(0,tn),p(1,Wh),p(2,me),p(3,Ve),p(4,ne),p(5,di),p(6,zoe),p(7,tt),p(8,At),p(9,Fv),p(10,mn),p(11,Tr),p(12,li),p(13,Wn),p(14,qe)],QG);class MKe{constructor(e,t,i,n,o,r){this.viewDescriptorService=e,this.targetContainerLocation=t,this.orientation=i,this.openComposite=n,this.moveComposite=o,this.getItems=r}drop(e,t,i,n){const o=e.getData();if(o.type==="composite"){const r=this.viewDescriptorService.getViewContainerById(o.id),a=this.viewDescriptorService.getViewContainerLocation(r);let c=!1;a===this.targetContainerLocation?t&&(this.moveComposite(o.id,t,n),c=!0):(this.viewDescriptorService.moveViewContainerToLocation(r,this.targetContainerLocation,this.getTargetIndex(t,n),"dnd"),c=!0),c&&this.openComposite(r.id,!0)}if(o.type==="view"){const r=this.viewDescriptorService.getViewDescriptorById(o.id);if(r&&r.canMoveView){this.viewDescriptorService.moveViewToLocation(r,this.targetContainerLocation,"dnd");const a=this.viewDescriptorService.getViewContainerByViewId(r.id);t&&this.moveComposite(a.id,t,n),this.openComposite(a.id,!0).then(c=>{c?.openView(r.id,!0)})}}}onDragEnter(e,t,i){return this.canDrop(e,t)}onDragOver(e,t,i){return this.canDrop(e,t)}getTargetIndex(e,t){if(!e)return;const i=this.getItems(),n=this.orientation===xa.HORIZONTAL?t?.horizontallyBefore:t?.verticallyBefore;return i.filter(o=>o.visible).findIndex(o=>o.id===e)+(n?0:1)}canDrop(e,t){const i=e.getData();if(i.type==="composite"){const n=this.viewDescriptorService.getViewContainerById(i.id);return this.viewDescriptorService.getViewContainerLocation(n)===this.targetContainerLocation?i.id!==t:!0}else{const n=this.viewDescriptorService.getViewDescriptorById(i.id);return!(!n||!n.canMoveView)}}}class NKe{constructor(e,t,i,n,o){this.compositeBarContainer=e,this.actionBarContainer=t,this.compositeBarModel=i,this.dndHandler=n,this.orientation=o,this.insertDropBefore=void 0}onDragOver(e){const t=this.compositeBarModel.visibleItems;if(!t.length||e.eventData.target&&Ku(e.eventData.target,this.actionBarContainer)){this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!0);return}const i=this.insertAtFront(this.actionBarContainer,e.eventData),n=i?t[0]:t[t.length-1],o=this.dndHandler.onDragOver(e.dragAndDropData,n.id,e.eventData);OP(e.eventData.dataTransfer,"move",o),this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,o,i,!0)}onDragLeave(e){this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!1)}onDragEnd(e){this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!1)}onDrop(e){const t=this.compositeBarModel.visibleItems;let i;t.length&&(i=this.insertAtFront(this.actionBarContainer,e.eventData)?t[0].id:t[t.length-1].id),this.dndHandler.drop(e.dragAndDropData,i,e.eventData,this.insertDropBefore),this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!1)}insertAtFront(e,t){const i=e.getBoundingClientRect(),n=t.clientX,o=t.clientY;switch(this.orientation){case xa.HORIZONTAL:return n<i.left;case xa.VERTICAL:return o<i.top}}updateFromDragging(e,t,i,n){if(e.classList.toggle("dragged-over",n),e.classList.toggle("dragged-over-head",t&&i),e.classList.toggle("dragged-over-tail",t&&!i),!!t)return{verticallyBefore:i,horizontallyBefore:i}}}let XG=class extends uf{constructor(e,t,i,n,o){super(),this.options=t,this.instantiationService=i,this.contextMenuService=n,this.viewDescriptorService=o,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.model=new OKe(e,t),this.visibleComposites=[],this.compositeSizeInBar=new Map,this.computeSizes(this.model.visibleItems)}getCompositeBarItems(){return[...this.model.items]}setCompositeBarItems(e){this.model.setItems(e),this.updateCompositeSwitcher(!0)}getPinnedComposites(){return this.model.pinnedItems}getPinnedCompositeIds(){return this.getPinnedComposites().map(e=>e.id)}getVisibleComposites(){return this.model.visibleItems}create(e){const t=e.appendChild(Y(".composite-bar"));this.compositeSwitcherBar=this._register(new Er(t,{actionViewItemProvider:(n,o)=>{if(n instanceof pie)return this.compositeOverflowActionViewItem;const r=this.model.findItem(n.id);return r&&this.instantiationService.createInstance(jG,{...o,draggable:!0,colors:this.options.colors,icon:this.options.icon,hoverOptions:this.options.activityHoverOptions,compact:this.options.compact},n,r.pinnedAction,r.toggleBadgeAction,a=>this.options.getContextMenuActionsForComposite(a),()=>this.getContextMenuActions(),this.options.dndHandler,this)},orientation:this.options.orientation,ariaLabel:h(2889,"Active View Switcher"),ariaRole:"tablist",preventLoopNavigation:this.options.preventLoopNavigation,triggerKeys:{keyDown:!0}})),this._register(re(e,pe.CONTEXT_MENU,n=>this.showContextMenu(bt(e),n))),this._register(Th.addTarget(e)),this._register(re(e,Vo.Contextmenu,n=>this.showContextMenu(bt(e),n)));const i=new NKe(e,t,this.model,this.options.dndHandler,this.options.orientation);return this._register(Jd.INSTANCE.registerTarget(e,i)),t}focus(e){this.compositeSwitcherBar?.focus(e)}recomputeSizes(){this.computeSizes(this.model.visibleItems),this.updateCompositeSwitcher()}layout(e){this.dimension=e,!(e.height===0||e.width===0)&&(this.compositeSizeInBar.size===0&&this.computeSizes(this.model.visibleItems),this.updateCompositeSwitcher())}addComposite({id:e,name:t,order:i,requestedIndex:n}){this.model.add(e,t,i,n)&&(this.computeSizes([this.model.findItem(e)]),this.updateCompositeSwitcher())}removeComposite(e){this.isPinned(e)&&this.unpin(e),this.model.remove(e)&&this.updateCompositeSwitcher()}hideComposite(e){this.model.hide(e)&&(this.resetActiveComposite(e),this.updateCompositeSwitcher())}activateComposite(e){const t=this.model.activeItem;this.model.activate(e)&&(this.visibleComposites.indexOf(e)===-1||this.model.activeItem&&!this.model.activeItem.pinned||t&&!t.pinned)&&this.updateCompositeSwitcher()}deactivateComposite(e){const t=this.model.activeItem;this.model.deactivate()&&t&&!t.pinned&&this.updateCompositeSwitcher()}async pin(e,t){this.model.setPinned(e,!0)&&(this.updateCompositeSwitcher(),t&&(await this.options.openComposite(e),this.activateComposite(e)))}unpin(e){this.model.setPinned(e,!1)&&(this.updateCompositeSwitcher(),this.resetActiveComposite(e))}areBadgesEnabled(e){return this.viewDescriptorService.getViewContainerBadgeEnablementState(e)}toggleBadgeEnablement(e){this.viewDescriptorService.setViewContainerBadgeEnablementState(e,!this.areBadgesEnabled(e)),this.updateCompositeSwitcher();const t=this.model.findItem(e);t&&(t.activityAction.activities=t.activityAction.activities)}resetActiveComposite(e){const t=this.options.getDefaultCompositeId();if(!(!this.model.activeItem||this.model.activeItem.id!==e))if(this.deactivateComposite(e),t&&t!==e&&this.isPinned(t))this.options.openComposite(t,!0);else{const i=this.visibleComposites.find(n=>n!==e);i&&this.options.openComposite(i)}}isPinned(e){return this.model.findItem(e)?.pinned}move(e,t,i){if(i!==void 0){const n=this.model.items.findIndex(r=>r.id===e);let o=this.model.items.findIndex(r=>r.id===t);n>=0&&o>=0&&(!i&&n>o&&o++,i&&n<o&&o--,o<this.model.items.length&&o>=0&&o!==n&&this.model.move(this.model.items[n].id,this.model.items[o].id)&&setTimeout(()=>this.updateCompositeSwitcher(),0))}else this.model.move(e,t)&&setTimeout(()=>this.updateCompositeSwitcher(),0)}getAction(e){return this.model.findItem(e)?.activityAction}computeSizes(e){const t=this.options.compositeSize;if(t)e.forEach(i=>this.compositeSizeInBar.set(i.id,t));else{const i=this.compositeSwitcherBar;if(i&&this.dimension&&this.dimension.height!==0&&this.dimension.width!==0){const n=i.viewItems.length;i.push(e.map(o=>o.activityAction)),e.forEach((o,r)=>this.compositeSizeInBar.set(o.id,this.options.orientation===xa.VERTICAL?i.getHeight(n+r):i.getWidth(n+r))),e.forEach(()=>i.pull(i.viewItems.length-1))}}}updateCompositeSwitcher(e){const t=this.compositeSwitcherBar;if(!t||!this.dimension)return;let i=this.model.visibleItems.filter(d=>d.pinned||this.model.activeItem&&this.model.activeItem.id===d.id).map(d=>d.id),n=i.length;const o=i.length;let r=0;const a=this.options.orientation===xa.VERTICAL?this.dimension.height:this.dimension.width;for(let d=0;d<i.length;d++){const l=this.compositeSizeInBar.get(i[d]);if(r+l>a){n=d;break}r+=l}for(o>n&&(i=i.slice(0,n)),this.model.activeItem&&i.every(d=>!!this.model.activeItem&&d!==this.model.activeItem.id)&&(r+=this.compositeSizeInBar.get(this.model.activeItem.id),i.push(this.model.activeItem.id));r>a&&i.length;){const d=i.length>1?i.splice(i.length-2,1)[0]:i.pop();r-=this.compositeSizeInBar.get(d)}for(o>i.length&&(r+=this.options.overflowActionSize);r>a&&i.length;){const d=i.length>1&&i[i.length-1]===this.model.activeItem?.id?i.splice(i.length-2,1)[0]:i.pop();r-=this.compositeSizeInBar.get(d)}o===i.length&&this.compositeOverflowAction&&(t.pull(t.length()-1),this.compositeOverflowAction.dispose(),this.compositeOverflowAction=void 0,this.compositeOverflowActionViewItem?.dispose(),this.compositeOverflowActionViewItem=void 0);const c=[];this.visibleComposites.forEach((d,l)=>{i.includes(d)||c.push(l)}),c.reverse().forEach(d=>{t.pull(d),this.visibleComposites.splice(d,1)}),i.forEach((d,l)=>{const u=this.visibleComposites.indexOf(d);l!==u&&(u!==-1&&(t.pull(u),this.visibleComposites.splice(u,1)),t.push(this.model.findItem(d).activityAction,{label:!0,icon:this.options.icon,index:l}),this.visibleComposites.splice(l,0,d))}),o>i.length&&!this.compositeOverflowAction&&(this.compositeOverflowAction=this._register(this.instantiationService.createInstance(pie,()=>{this.compositeOverflowActionViewItem?.showMenu()})),this.compositeOverflowActionViewItem=this._register(this.instantiationService.createInstance(KG,this.compositeOverflowAction,()=>this.getOverflowingComposites(),()=>this.model.activeItem?this.model.activeItem.id:void 0,d=>this.model.findItem(d)?.activity[0]?.badge,this.options.getOnCompositeClickAction,this.options.colors,this.options.activityHoverOptions)),t.push(this.compositeOverflowAction,{label:!1,icon:!0})),e||this._onDidChange.fire()}getOverflowingComposites(){let e=this.model.visibleItems.filter(t=>t.pinned).map(t=>t.id);return this.model.activeItem&&!this.model.activeItem.pinned&&e.push(this.model.activeItem.id),e=e.filter(t=>!this.visibleComposites.includes(t)),this.model.visibleItems.filter(t=>e.includes(t.id)).map(t=>({id:t.id,name:this.getAction(t.id)?.label||t.name}))}showContextMenu(e,t){Li.stop(t,!0);const i=new us(e,t);this.contextMenuService.showContextMenu({getAnchor:()=>i,getActions:()=>this.getContextMenuActions(t)})}getContextMenuActions(e){const t=this.model.visibleItems.map(({id:i,name:n,activityAction:o})=>{const r=this.isPinned(i);return Ci({id:i,label:this.getAction(i).label||n||i,checked:r,enabled:o.enabled&&(!r||this.getPinnedCompositeIds().length>1),run:()=>{this.isPinned(i)?this.unpin(i):this.pin(i,!0)}})});return this.options.fillExtraContextMenuActions(t,e),t}};XG=f([p(2,J),p(3,mi),p(4,Os)],XG);class OKe{get items(){return this._items}constructor(e,t){this._items=[],this.options=t,this.setItems(e)}setItems(e){this._items=[],this._items=e.map(t=>this.createCompositeBarItem(t.id,t.name,t.order,t.pinned,t.visible))}get visibleItems(){return this.items.filter(e=>e.visible)}get pinnedItems(){return this.items.filter(e=>e.visible&&e.pinned)}createCompositeBarItem(e,t,i,n,o){const r=this.options;return{id:e,name:t,pinned:n,order:i,visible:o,activity:[],get activityAction(){return r.getActivityAction(e)},get pinnedAction(){return r.getCompositePinnedAction(e)},get toggleBadgeAction(){return r.getCompositeBadgeAction(e)}}}add(e,t,i,n){const o=this.findItem(e);if(o){let r=!1;return o.name=t,_p(i)||(r=o.order!==i,o.order=i),o.visible||(o.visible=!0,r=!0),r}else{const r=this.createCompositeBarItem(e,t,i,!0,!0);if(_p(n))if(_p(i))this.items.push(r);else{let a=0;for(;a<this.items.length&&typeof this.items[a].order=="number"&&this.items[a].order<i;)a++;this.items.splice(a,0,r)}else{let a=0,c=n;for(;c>0&&a<this.items.length;)this.items[a++].visible&&c--;this.items.splice(a,0,r)}return!0}}remove(e){for(let t=0;t<this.items.length;t++)if(this.items[t].id===e)return this.items.splice(t,1),!0;return!1}hide(e){for(const t of this.items)if(t.id===e)return t.visible?(t.visible=!1,!0):!1;return!1}move(e,t){const i=this.findIndex(e),n=this.findIndex(t);if(i===-1||n===-1)return!1;const o=this.items.splice(i,1)[0];return this.items.splice(n,0,o),o.pinned=!0,!0}setPinned(e,t){for(const i of this.items)if(i.id===e)return i.pinned!==t?(i.pinned=t,!0):!1;return!1}activate(e){if(!this.activeItem||this.activeItem.id!==e){this.activeItem&&this.deactivate();for(const t of this.items)if(t.id===e)return this.activeItem=t,this.activeItem.activityAction.activate(),!0}return!1}deactivate(){return this.activeItem?(this.activeItem.activityAction.deactivate(),this.activeItem=void 0,!0):!1}findItem(e){return this.items.filter(t=>t.id===e)[0]}findIndex(e){for(let t=0;t<this.items.length;t++)if(this.items[t].id===e)return t;return-1}}var ZG;let JG=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.options=e,this.part=t,this.paneCompositePart=i,this.instantiationService=n,this.storageService=o,this.extensionService=r,this.viewDescriptorService=a,this.viewService=c,this.contextKeyService=d,this.environmentService=l,this.layoutService=u,this.viewContainerDisposables=this._register(new ei),this.compositeActions=new Map,this.hasExtensionsRegistered=!1,this._cachedViewContainers=void 0,this.location=i.partId===ot.PANEL_PART?Fe.Panel:i.partId===ot.AUXILIARYBAR_PART?Fe.AuxiliaryBar:Fe.Sidebar,this.dndHandler=new MKe(this.viewDescriptorService,this.location,this.options.orientation,async(m,v)=>await this.paneCompositePart.openPaneComposite(m,v)??null,(m,v,y)=>this.compositeBar.move(m,v,this.options.orientation===xa.VERTICAL?y?.verticallyBefore:y?.horizontallyBefore),()=>this.compositeBar.getCompositeBarItems());const g=this.cachedViewContainers.map(m=>({id:m.id,name:m.name,visible:!this.shouldBeHidden(m.id,m),order:m.order,pinned:m.pinned}));this.compositeBar=this.createCompositeBar(g),this.onDidRegisterViewContainers(this.getViewContainers()),this.registerListeners()}createCompositeBar(e){return this._register(this.instantiationService.createInstance(XG,e,{icon:this.options.icon,compact:this.options.compact,orientation:this.options.orientation,activityHoverOptions:this.options.activityHoverOptions,preventLoopNavigation:this.options.preventLoopNavigation,openComposite:async(t,i)=>await this.paneCompositePart.openPaneComposite(t,!i)??null,getActivityAction:t=>this.getCompositeActions(t).activityAction,getCompositePinnedAction:t=>this.getCompositeActions(t).pinnedAction,getCompositeBadgeAction:t=>this.getCompositeActions(t).badgeAction,getOnCompositeClickAction:t=>this.getCompositeActions(t).activityAction,fillExtraContextMenuActions:(t,i)=>this.options.fillExtraContextMenuActions(t,i),getContextMenuActionsForComposite:t=>this.getContextMenuActionsForComposite(t),getDefaultCompositeId:()=>this.viewDescriptorService.getDefaultViewContainer(this.location)?.id,dndHandler:this.dndHandler,compositeSize:this.options.compositeSize,overflowActionSize:this.options.overflowActionSize,colors:t=>this.options.colors(t)}))}getContextMenuActionsForComposite(e){const t=[new is],i=this.viewDescriptorService.getViewContainerById(e),n=this.viewDescriptorService.getDefaultViewContainerLocation(i),o=this.viewDescriptorService.getViewContainerLocation(i),r=[];for(const a of[Fe.Sidebar,Fe.AuxiliaryBar,Fe.Panel])o!==a&&r.push(this.createMoveAction(i,a,n));if(t.push(new Dh("moveToMenu",h(3429,"Move To"),r)),n!==o)t.push(Ci({id:"resetLocationAction",label:h(3430,"Reset Location"),run:()=>{this.viewDescriptorService.moveViewContainerToLocation(i,n,void 0,"resetLocationAction"),this.viewService.openViewContainer(i.id,!0)}}));else{const a=this.viewDescriptorService.getViewContainerModel(i);if(a.allViewDescriptors.length===1){const c=a.allViewDescriptors[0],d=this.viewDescriptorService.getDefaultContainerById(c.id);d!==i&&t.push(Ci({id:"resetLocationAction",label:h(3430,"Reset Location"),run:()=>{this.viewDescriptorService.moveViewsToContainer([c],d,void 0,"resetLocationAction"),this.viewService.openViewContainer(i.id,!0)}}))}}return t}createMoveAction(e,t,i){return Ci({id:`moveViewContainerTo${t}`,label:t===Fe.Panel?h(3431,"Panel"):t===Fe.Sidebar?h(3432,"Primary Side Bar"):h(3433,"Secondary Side Bar"),run:()=>{let n;t!==i?n=this.viewDescriptorService.getViewContainersByLocation(t).length:n=void 0,this.viewDescriptorService.moveViewContainerToLocation(e,t,n),this.viewService.openViewContainer(e.id,!0)}})}registerListeners(){this._register(this.viewDescriptorService.onDidChangeViewContainers(({added:e,removed:t})=>this.onDidChangeViewContainers(e,t))),this._register(this.viewDescriptorService.onDidChangeContainerLocation(({viewContainer:e,from:t,to:i})=>this.onDidChangeViewContainerLocation(e,t,i))),this._register(this.paneCompositePart.onDidPaneCompositeOpen(e=>this.onDidChangeViewContainerVisibility(e.getId(),!0))),this._register(this.paneCompositePart.onDidPaneCompositeClose(e=>this.onDidChangeViewContainerVisibility(e.getId(),!1))),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this._store.isDisposed||(this.onDidRegisterExtensions(),this._register(this.compositeBar.onDidChange(()=>{this.updateCompositeBarItemsFromStorage(!0),this.saveCachedViewContainers()})),this._register(this.storageService.onDidChangeValue(he.PROFILE,this.options.pinnedViewContainersKey,this._store)(()=>this.updateCompositeBarItemsFromStorage(!1))))})}onDidChangeViewContainers(e,t){t.filter(({location:i})=>i===this.location).forEach(({container:i})=>this.onDidDeregisterViewContainer(i)),this.onDidRegisterViewContainers(e.filter(({location:i})=>i===this.location).map(({container:i})=>i))}onDidChangeViewContainerLocation(e,t,i){t===this.location&&this.onDidDeregisterViewContainer(e),i===this.location&&this.onDidRegisterViewContainers([e])}onDidChangeViewContainerVisibility(e,t){t?this.onDidViewContainerVisible(e):this.compositeBar.deactivateComposite(e)}onDidRegisterExtensions(){this.hasExtensionsRegistered=!0;for(const{id:e}of this.cachedViewContainers){const t=this.getViewContainer(e);t?this.showOrHideViewContainer(t):this.viewDescriptorService.isViewContainerRemovedPermanently(e)?this.removeComposite(e):this.hideComposite(e)}this.saveCachedViewContainers()}onDidViewContainerVisible(e){const t=this.getViewContainer(e);t&&(this.addComposite(t),this.compositeBar.activateComposite(t.id),this.shouldBeHidden(t)&&this.viewDescriptorService.getViewContainerModel(t).activeViewDescriptors.length===0&&this.hideComposite(t.id))}create(e){return this.compositeBar.create(e)}getCompositeActions(e){let t=this.compositeActions.get(e);if(!t){const i=this.getViewContainer(e);if(i){const n=this.viewDescriptorService.getViewContainerModel(i);t={activityAction:this._register(this.instantiationService.createInstance(kM,this.toCompositeBarActionItemFrom(n),this.part,this.paneCompositePart)),pinnedAction:this._register(new Zpe(this.toCompositeBarActionItemFrom(n),this.compositeBar)),badgeAction:this._register(new Jpe(this.toCompositeBarActionItemFrom(n),this.compositeBar))}}else{const n=this.cachedViewContainers.filter(o=>o.id===e)[0];t={activityAction:this._register(this.instantiationService.createInstance(FKe,this.toCompositeBarActionItem(e,n?.name??e,n?.icon,void 0),this.part,this.paneCompositePart)),pinnedAction:this._register(new _ie(e,this.compositeBar)),badgeAction:this._register(new WKe(e,this.compositeBar))}}this.compositeActions.set(e,t)}return t}onDidRegisterViewContainers(e){for(const t of e){this.addComposite(t),this.cachedViewContainers.filter(({id:a})=>a===t.id)[0]||this.compositeBar.pin(t.id),this.paneCompositePart.getActivePaneComposite()?.getId()===t.id&&this.compositeBar.activateComposite(t.id);const o=this.viewDescriptorService.getViewContainerModel(t);this.updateCompositeBarActionItem(t,o),this.showOrHideViewContainer(t);const r=new U;r.add(o.onDidChangeContainerInfo(()=>this.updateCompositeBarActionItem(t,o))),r.add(o.onDidChangeActiveViewDescriptors(()=>this.showOrHideViewContainer(t))),this.viewContainerDisposables.set(t.id,r)}}onDidDeregisterViewContainer(e){this.viewContainerDisposables.deleteAndDispose(e.id),this.removeComposite(e.id)}updateCompositeBarActionItem(e,t){const i=this.toCompositeBarActionItemFrom(t),{activityAction:n,pinnedAction:o}=this.getCompositeActions(e.id);n.updateCompositeBarActionItem(i),o instanceof _ie&&o.setActivity(i),this.options.recomputeSizes&&this.compositeBar.recomputeSizes(),this.saveCachedViewContainers()}toCompositeBarActionItemFrom(e){return this.toCompositeBarActionItem(e.viewContainer.id,e.title,e.icon,e.keybindingId)}toCompositeBarActionItem(e,t,i,n){let o,r;if(this.options.icon)if(R.isUri(i)){r=i;const a=oy(i),c=new eSe;c.update(a);const d=`activity-${e.replace(/\./g,"-")}-${c.digest()}`,l=`.monaco-workbench .${this.options.partContainerClass} .monaco-action-bar .action-label.${d}`;o=[d,"uri-icon"],OM(l,`
				mask: ${a} no-repeat 50% 50%;
				mask-size: ${this.options.iconSize}px;
				-webkit-mask: ${a} no-repeat 50% 50%;
				-webkit-mask-size: ${this.options.iconSize}px;
				mask-origin: padding;
				-webkit-mask-origin: padding;
			`)}else Te.isThemeIcon(i)&&(o=Te.asClassNameArray(i));return{id:e,name:t,classNames:o,iconUrl:r,keybindingId:n}}showOrHideViewContainer(e){this.shouldBeHidden(e)?this.hideComposite(e.id):(this.addComposite(e),this.paneCompositePart.getActivePaneComposite()?.getId()===e.id&&this.compositeBar.activateComposite(e.id))}shouldBeHidden(e,t){const i=It(e)?this.getViewContainer(e):e,n=It(e)?e:e.id;if(i)if(i.hideIfEmpty){if(this.viewService.isViewContainerActive(n))return!1}else return!1;if(!this.hasExtensionsRegistered&&!(this.part===ot.SIDEBAR_PART&&this.environmentService.remoteAuthority&&ra)){if(t=t||this.cachedViewContainers.find(({id:o})=>o===n),!i&&t?.isBuiltin&&t?.visible)return!1;if(t?.views?.length)return t.views.every(({when:o})=>!!o&&!this.contextKeyService.contextMatchesRules(x.deserialize(o)))}return!0}addComposite(e){this.compositeBar.addComposite({id:e.id,name:typeof e.title=="string"?e.title:e.title.value,order:e.order,requestedIndex:e.requestedIndex})}hideComposite(e){this.compositeBar.hideComposite(e);const t=this.compositeActions.get(e);t&&(t.activityAction.dispose(),t.pinnedAction.dispose(),this.compositeActions.delete(e))}removeComposite(e){this.compositeBar.removeComposite(e);const t=this.compositeActions.get(e);t&&(t.activityAction.dispose(),t.pinnedAction.dispose(),this.compositeActions.delete(e))}getPinnedPaneCompositeIds(){const e=this.compositeBar.getPinnedComposites().map(t=>t.id);return this.getViewContainers().filter(t=>this.compositeBar.isPinned(t.id)).sort((t,i)=>e.indexOf(t.id)-e.indexOf(i.id)).map(t=>t.id)}getVisiblePaneCompositeIds(){return this.compositeBar.getVisibleComposites().filter(e=>this.paneCompositePart.getActivePaneComposite()?.getId()===e.id||this.compositeBar.isPinned(e.id)).map(e=>e.id)}getPaneCompositeIds(){return this.compositeBar.getVisibleComposites().map(e=>e.id)}getContextMenuActions(){return this.compositeBar.getContextMenuActions()}focus(e){this.compositeBar.focus(e)}layout(e,t){this.compositeBar.layout(new Ke(e,t))}getViewContainer(e){const t=this.viewDescriptorService.getViewContainerById(e);return t&&this.viewDescriptorService.getViewContainerLocation(t)===this.location?t:void 0}getViewContainers(){return this.viewDescriptorService.getViewContainersByLocation(this.location)}updateCompositeBarItemsFromStorage(e){if(this.pinnedViewContainersValue===this.getStoredPinnedViewContainersValue())return;this._placeholderViewContainersValue=void 0,this._pinnedViewContainersValue=void 0,this._cachedViewContainers=void 0;const t=[],i=this.compositeBar.getCompositeBarItems();for(const n of this.cachedViewContainers)t.push({id:n.id,name:n.name,order:n.order,pinned:n.pinned,visible:n.visible&&!!this.getViewContainer(n.id)});for(const n of this.getViewContainers())if(!t.some(({id:o})=>o===n.id)){const o=i.findIndex(({id:r})=>r===n.id);if(o!==-1){const r=i[o];t.splice(o,0,{id:n.id,name:typeof n.title=="string"?n.title:n.title.value,order:r.order,pinned:r.pinned,visible:r.visible})}else t.push({id:n.id,name:typeof n.title=="string"?n.title:n.title.value,order:n.order,pinned:!0,visible:!this.shouldBeHidden(n)})}if(e)for(const n of i)t.find(({id:r})=>r===n.id)||t.push(n);this.compositeBar.setCompositeBarItems(t)}saveCachedViewContainers(){const e=[],t=this.compositeBar.getCompositeBarItems();for(const i of t){const n=this.getViewContainer(i.id);if(n){const o=this.viewDescriptorService.getViewContainerModel(n),r=[];for(const{when:a}of o.allViewDescriptors)r.push({when:a?a.serialize():void 0});e.push({id:i.id,name:o.title,icon:R.isUri(o.icon)&&this.environmentService.remoteAuthority?void 0:o.icon,views:r,pinned:i.pinned,order:i.order,visible:i.visible,isBuiltin:!n.extensionId})}else e.push({id:i.id,name:i.name,pinned:i.pinned,order:i.order,visible:!1,isBuiltin:!1})}this.storeCachedViewContainersState(e)}get cachedViewContainers(){if(this._cachedViewContainers===void 0){this._cachedViewContainers=this.getPinnedViewContainers();for(const e of this.getPlaceholderViewContainers()){const t=this._cachedViewContainers.find(i=>i.id===e.id);t&&(t.visible=e.visible??t.visible,t.name=e.name,t.icon=e.themeIcon?e.themeIcon:e.iconUrl?R.revive(e.iconUrl):void 0,R.isUri(t.icon)&&this.environmentService.remoteAuthority&&(t.icon=void 0),t.views=e.views,t.isBuiltin=e.isBuiltin)}for(const e of this.getViewContainersWorkspaceState()){const t=this._cachedViewContainers.find(i=>i.id===e.id);t&&(t.visible=e.visible??t.visible)}}return this._cachedViewContainers}storeCachedViewContainersState(e){const t=this.getPinnedViewContainers();this.setPinnedViewContainers(e.map(({id:i,pinned:n,order:o})=>({id:i,pinned:n,visible:!!t.find(({id:r})=>r===i)?.visible,order:o}))),this.setPlaceholderViewContainers(e.map(({id:i,icon:n,name:o,views:r,isBuiltin:a})=>({id:i,iconUrl:R.isUri(n)?n:void 0,themeIcon:Te.isThemeIcon(n)?n:void 0,name:o,isBuiltin:a,views:r}))),this.setViewContainersWorkspaceState(e.map(({id:i,visible:n})=>({id:i,visible:n})))}getPinnedViewContainers(){return JSON.parse(this.pinnedViewContainersValue)}setPinnedViewContainers(e){this.pinnedViewContainersValue=JSON.stringify(e)}get pinnedViewContainersValue(){return this._pinnedViewContainersValue||(this._pinnedViewContainersValue=this.getStoredPinnedViewContainersValue()),this._pinnedViewContainersValue}set pinnedViewContainersValue(e){this.pinnedViewContainersValue!==e&&(this._pinnedViewContainersValue=e,this.setStoredPinnedViewContainersValue(e))}getStoredPinnedViewContainersValue(){return this.storageService.get(this.options.pinnedViewContainersKey,he.PROFILE,"[]")}setStoredPinnedViewContainersValue(e){this.storageService.store(this.options.pinnedViewContainersKey,e,he.PROFILE,pt.USER)}getPlaceholderViewContainers(){return JSON.parse(this.placeholderViewContainersValue)}setPlaceholderViewContainers(e){this.placeholderViewContainersValue=JSON.stringify(e)}get placeholderViewContainersValue(){return this._placeholderViewContainersValue||(this._placeholderViewContainersValue=this.getStoredPlaceholderViewContainersValue()),this._placeholderViewContainersValue}set placeholderViewContainersValue(e){this.placeholderViewContainersValue!==e&&(this._placeholderViewContainersValue=e,this.setStoredPlaceholderViewContainersValue(e))}getStoredPlaceholderViewContainersValue(){return this.storageService.get(this.options.placeholderViewContainersKey,he.PROFILE,"[]")}setStoredPlaceholderViewContainersValue(e){this.storageService.store(this.options.placeholderViewContainersKey,e,he.PROFILE,pt.MACHINE)}getViewContainersWorkspaceState(){return JSON.parse(this.viewContainersWorkspaceStateValue)}setViewContainersWorkspaceState(e){this.viewContainersWorkspaceStateValue=JSON.stringify(e)}get viewContainersWorkspaceStateValue(){return this._viewContainersWorkspaceStateValue||(this._viewContainersWorkspaceStateValue=this.getStoredViewContainersWorkspaceStateValue()),this._viewContainersWorkspaceStateValue}set viewContainersWorkspaceStateValue(e){this.viewContainersWorkspaceStateValue!==e&&(this._viewContainersWorkspaceStateValue=e,this.setStoredViewContainersWorkspaceStateValue(e))}getStoredViewContainersWorkspaceStateValue(){return this.storageService.get(this.options.viewContainersWorkspaceStateKey,he.WORKSPACE,"[]")}setStoredViewContainersWorkspaceStateValue(e){this.storageService.store(this.options.viewContainersWorkspaceStateKey,e,he.WORKSPACE,pt.MACHINE)}};JG=f([p(3,J),p(4,tt),p(5,hn),p(6,Os),p(7,mo),p(8,me),p(9,mn),p(10,vi)],JG);let kM=class extends rw{static{ZG=this}static{this.preventDoubleClickDelay=300}constructor(e,t,i,n,o,r){super(e),this.part=t,this.paneCompositePart=i,this.layoutService=n,this.configurationService=o,this.activityService=r,this.lastRun=0,this.updateActivity(),this._register(this.activityService.onDidChangeActivity(a=>{!It(a)&&a.id===this.compositeBarActionItem.id&&this.updateActivity()}))}updateCompositeBarActionItem(e){this.compositeBarActionItem=e}updateActivity(){this.activities=this.activityService.getViewContainerActivities(this.compositeBarActionItem.id)}async run(e){if(hp(e)&&e.button===2)return;const t=Date.now();if(t>this.lastRun&&t-this.lastRun<ZG.preventDoubleClickDelay)return;this.lastRun=t;const i=e&&"preserveFocus"in e?!e.preserveFocus:!0;if(this.part===ot.ACTIVITYBAR_PART){const n=this.layoutService.isVisible(ot.SIDEBAR_PART),o=this.paneCompositePart.getActivePaneComposite(),r=this.configurationService.getValue("workbench.activityBar.iconClickBehavior");if(n&&o?.getId()===this.compositeBarActionItem.id){switch(r){case"focus":this.paneCompositePart.openPaneComposite(this.compositeBarActionItem.id,i);break;case"toggle":default:this.layoutService.setPartHidden(!0,ot.SIDEBAR_PART);break}return}}return await this.paneCompositePart.openPaneComposite(this.compositeBarActionItem.id,i),this.activate()}};kM=ZG=f([p(3,vi),p(4,ne),p(5,Hv)],kM);class FKe extends kM{}class _ie extends Zpe{constructor(e,t){super({id:e,name:e,classNames:void 0},t)}setActivity(e){this.label=e.name}}class WKe extends Jpe{constructor(e,t){super({id:e,name:e,classNames:void 0},t)}setCompositeBarActionItem(e){this.label=e.name}}const fF=Ae("settings-view-bar-icon",j.settingsGear,h(13139,"Settings icon in the view bar."));var rC;let TM=class extends F{static{rC=this}static{this.ACCOUNTS_ACTION_INDEX=0}static{this.ACCOUNTS_ICON=Ae("accounts-view-bar-icon",j.account,h(3354,"Accounts icon in the view bar."))}constructor(e,t,i,n,o,r,a){super(),this.contextMenuActionsProvider=e,this.colors=t,this.activityHoverOptions=i,this.instantiationService=o,this.storageService=r,this.extensionService=a,this.globalActivityAction=this._register(new Kt(sP)),this.accountAction=this._register(new Kt(oP)),this.element=Y("div");const c=()=>({anchorAlignment:n.getValue("workbench.sideBar.location")==="left"?kb.RIGHT:kb.LEFT,anchorAxisAlignment:tSe.HORIZONTAL});this.globalActivityActionBar=this._register(new Er(this.element,{actionViewItemProvider:(d,l)=>{if(d.id===sP)return this.instantiationService.createInstance(RM,this.contextMenuActionsProvider,{...l,colors:this.colors,hoverOptions:this.activityHoverOptions},c);if(d.id===oP)return this.instantiationService.createInstance(Iv,this.contextMenuActionsProvider,{...l,colors:this.colors,hoverOptions:this.activityHoverOptions},c,u=>{u.unshift(Ci({id:"hideAccounts",label:h(3355,"Hide Accounts"),run:()=>PM(r,!1)}),new is)});throw new Error(`No view item for action '${d.id}'`)},orientation:xa.VERTICAL,ariaLabel:h(3356,"Manage"),preventLoopNavigation:!0})),this.accountsVisibilityPreference&&this.globalActivityActionBar.push(this.accountAction,{index:rC.ACCOUNTS_ACTION_INDEX}),this.globalActivityActionBar.push(this.globalActivityAction),this.registerListeners()}registerListeners(){this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this._store.isDisposed||this._register(this.storageService.onDidChangeValue(he.PROFILE,Iv.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,this._store)(()=>this.toggleAccountsActivity()))})}create(e){e.appendChild(this.element)}focus(){this.globalActivityActionBar.focus(!0)}size(){return this.globalActivityActionBar.viewItems.length}getContextMenuActions(){return[Ci({id:"toggleAccountsVisibility",label:h(3357,"Accounts"),checked:this.accountsVisibilityPreference,run:()=>this.accountsVisibilityPreference=!this.accountsVisibilityPreference})]}toggleAccountsActivity(){this.globalActivityActionBar.length()===2&&this.accountsVisibilityPreference||(this.globalActivityActionBar.length()===2?this.globalActivityActionBar.pull(rC.ACCOUNTS_ACTION_INDEX):this.globalActivityActionBar.push(this.accountAction,{index:rC.ACCOUNTS_ACTION_INDEX}))}get accountsVisibilityPreference(){return eq(this.storageService)}set accountsVisibilityPreference(e){PM(this.storageService,e)}};TM=rC=f([p(3,ne),p(4,J),p(5,tt),p(6,hn)],TM);let AM=class extends Yx{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(t,{draggable:!1,icon:!0,hasPopup:!0,...i},()=>!0,r,a,u,g),this.menuId=e,this.contextMenuActionsProvider=n,this.contextMenuAlignmentOptions=o,this.menuService=c,this.contextMenuService=d,this.contextKeyService=l,this.activityService=m,this.updateItemActivity(),this._register(this.activityService.onDidChangeActivity(v=>{It(v)&&v===this.compositeBarActionItem.id&&this.updateItemActivity()}))}updateItemActivity(){this.action.activities=this.activityService.getActivity(this.compositeBarActionItem.id)}render(e){super.render(e),this._register(re(this.container,pe.MOUSE_DOWN,async t=>{Li.stop(t,!0),t?.button!==2&&this.run()})),this._register(re(this.container,pe.CONTEXT_MENU,async t=>{t.stopPropagation();const i=new U,n=await this.resolveContextMenuActions(i),o=new us(bt(this.container),t);this.contextMenuService.showContextMenu({getAnchor:()=>o,getActions:()=>n,onHide:()=>i.dispose()})})),this._register(re(this.container,pe.KEY_UP,t=>{const i=new zs(t);(i.equals(S.Enter)||i.equals(S.Space))&&(Li.stop(t,!0),this.run())})),this._register(re(this.container,Vo.Tap,t=>{Li.stop(t,!0),this.run()}))}async resolveContextMenuActions(e){return this.contextMenuActionsProvider()}async run(){const e=new U,t=e.add(this.menuService.createMenu(this.menuId,this.contextKeyService)),i=await this.resolveMainMenuActions(t,e),{anchorAlignment:n,anchorAxisAlignment:o}=this.contextMenuAlignmentOptions()??{anchorAlignment:void 0,anchorAxisAlignment:void 0};this.contextMenuService.showContextMenu({getAnchor:()=>this.label,anchorAlignment:n,anchorAxisAlignment:o,getActions:()=>i,onHide:()=>e.dispose(),menuActionOptions:{renderShortTitle:!0}})}async resolveMainMenuActions(e,t){return zm(e.getActions({renderShortTitle:!0})).secondary}};AM=f([p(5,ft),p(6,wi),p(7,tn),p(8,mi),p(9,me),p(10,ne),p(11,Ve),p(12,Hv)],AM);let Iv=class extends AM{static{this.ACCOUNTS_VISIBILITY_PREFERENCE_KEY="workbench.activity.showAccounts"}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k,A){const B=k.createInstance(rw,{id:oP,name:h(3357,"Accounts"),classNames:Te.asClassNameArray(TM.ACCOUNTS_ICON)});super(N.AccountsContext,B,t,e,i,o,a,d,c,l,v,y,T),this.fillContextMenuActions=n,this.lifecycleService=r,this.authenticationService=u,this.productService=m,this.secretStorageService=w,this.logService=C,this.commandService=A,this.groupedAccounts=new Map,this.problematicProviders=new Set,this.initialized=!1,this.sessionFromEmbedder=new Ju(()=>zHe(this.secretStorageService,this.productService)),this._register(B),this.registerListeners(),this.initialize()}registerListeners(){this._register(this.authenticationService.onDidRegisterAuthenticationProvider(async e=>{await this.addAccountsFromProvider(e.id)})),this._register(this.authenticationService.onDidUnregisterAuthenticationProvider(e=>{this.groupedAccounts.delete(e.id),this.problematicProviders.delete(e.id)})),this._register(this.authenticationService.onDidChangeSessions(async e=>{if(e.event.removed)for(const t of e.event.removed)this.removeAccount(e.providerId,t.account);for(const t of[...e.event.changed??[],...e.event.added??[]])try{await this.addOrUpdateAccount(e.providerId,t.account)}catch(i){this.logService.error(i)}}))}async initialize(){if(await this.lifecycleService.when(mc.Restored),this._store.isDisposed)return;const e=this._register(Tie(bt(this.element),async()=>{await this.doInitialize(),e.dispose()}))}async doInitialize(){const e=this.authenticationService.getProviderIds(),t=await Promise.allSettled(e.map(i=>this.addAccountsFromProvider(i)));for(const i of t)i.status==="rejected"&&this.logService.error(i.reason);this.initialized=!0}async resolveMainMenuActions(e,t){await super.resolveMainMenuActions(e,t);const i=this.authenticationService.getProviderIds(),n=e.getActions();let o=[];for(const r of i){if(!this.initialized){const d=t.add(new Kt("noAccountsAvailable",h(3358,"Loading..."),void 0,!1));o.push(d);break}const a=this.authenticationService.getProvider(r).label,c=this.groupedAccounts.get(r);if(!c){if(this.problematicProviders.has(r)){const d=t.add(new Kt("providerUnavailable",h(3359,"{0} is currently unavailable",a),void 0,!1));o.push(d);try{await this.addAccountsFromProvider(r)}catch(l){this.logService.error(l)}}continue}for(const d of c){const l=Ci({id:`configureSessions${d.label}`,label:h(3360,"Manage Trusted Extensions"),enabled:!0,run:()=>this.commandService.executeCommand("_manageTrustedExtensionsForAccount",{providerId:r,accountLabel:d.label})}),u=Ci({id:`configureSessions${d.label}`,label:h(3361,"Manage Trusted MCP Servers"),enabled:!0,run:()=>this.commandService.executeCommand("_manageTrustedMCPServersForAccount",{providerId:r,accountLabel:d.label})}),g=[l,u];d.canSignOut&&g.push(Ci({id:"signOut",label:h(3362,"Sign Out"),enabled:!0,run:()=>this.commandService.executeCommand("_signOutOfAccount",{providerId:r,accountLabel:d.label})}));const m=new Dh("activitybar.submenu",`${d.label} (${a})`,g);o.push(m)}}return o.length&&n.length&&o.push(new is),n.forEach((r,a)=>{const c=r[1];o=o.concat(c),a!==n.length-1&&o.push(new is)}),o}async resolveContextMenuActions(e){const t=await super.resolveContextMenuActions(e);return this.fillContextMenuActions(t),t}async addOrUpdateAccount(e,t){let i=this.groupedAccounts.get(e);i||(i=[],this.groupedAccounts.set(e,i));const n=await this.sessionFromEmbedder.value;let o=!0;n&&!n.canSignOut&&(await this.authenticationService.getSessions(e)).some(a=>a.id===n.id&&a.account.id===t.id)&&(o=!1);const r=i.find(a=>a.label===t.label);r?o||(r.canSignOut=o):i.push({...t,canSignOut:o})}removeAccount(e,t){const i=this.groupedAccounts.get(e);if(!i)return;const n=i.findIndex(o=>o.id===t.id);n!==-1&&(i.splice(n,1),i.length===0&&this.groupedAccounts.delete(e))}async addAccountsFromProvider(e){try{const t=await this.authenticationService.getSessions(e);this.problematicProviders.delete(e);for(const i of t)try{await this.addOrUpdateAccount(e,i.account)}catch(n){this.logService.error(n)}}catch(t){this.logService.error(t),this.problematicProviders.add(e)}}};Iv=f([p(4,ft),p(5,wd),p(6,wi),p(7,mi),p(8,tn),p(9,me),p(10,Uv),p(11,mn),p(12,Fn),p(13,ne),p(14,Ve),p(15,IN),p(16,Pe),p(17,Hv),p(18,J),p(19,qe)],Iv);let RM=class extends AM{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){const y=m.createInstance(rw,{id:sP,name:h(3356,"Manage"),classNames:Te.asClassNameArray(n.currentProfile.icon?Te.fromId(n.currentProfile.icon):fF)});super(N.GlobalActivity,y,t,e,i,o,r,a,c,d,l,g,v),this.userDataProfileService=n,this._register(y),this._register(this.userDataProfileService.onDidChangeCurrentProfile(w=>{y.compositeBarActionItem={...y.compositeBarActionItem,classNames:Te.asClassNameArray(n.currentProfile.icon?Te.fromId(n.currentProfile.icon):fF)}}))}render(e){super.render(e),this.profileBadge=ee(e,Y(".profile-badge")),this.profileBadgeContent=ee(this.profileBadge,Y(".profile-badge-content")),this.updateProfileBadge()}updateProfileBadge(){!this.profileBadge||!this.profileBadgeContent||(Yi(this.profileBadgeContent),Hs(this.profileBadge),!this.userDataProfileService.currentProfile.isDefault&&(this.userDataProfileService.currentProfile.icon&&this.userDataProfileService.currentProfile.icon!==fF.id||this.action.activities.length>0||(Ho(this.profileBadge),this.profileBadgeContent.classList.add("profile-text-overlay"),this.profileBadgeContent.textContent=this.userDataProfileService.currentProfile.name.substring(0,2).toUpperCase())))}updateActivity(){super.updateActivity(),this.updateProfileBadge()}computeTitle(){return this.userDataProfileService.currentProfile.isDefault?super.computeTitle():h(3363,"Manage {0} (Profile)",this.userDataProfileService.currentProfile.name)}};RM=f([p(3,Fh),p(4,ft),p(5,wi),p(6,tn),p(7,mi),p(8,me),p(9,ne),p(10,mn),p(11,Ve),p(12,J),p(13,Hv)],RM);let bie=class extends Iv{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,y,w,C,T,k){super(()=>gfe(y,!0),{...t,colors:A=>({badgeBackground:A.getColor(ww),badgeForeground:A.getColor(Sw)}),hoverOptions:e,compact:!0},()=>{},A=>A,i,n,o,r,a,c,d,l,u,g,m,v,w,C,T,k)}};bie=f([p(2,ft),p(3,wd),p(4,wi),p(5,mi),p(6,tn),p(7,me),p(8,Uv),p(9,mn),p(10,Fn),p(11,ne),p(12,Ve),p(13,IN),p(14,tt),p(15,Pe),p(16,Hv),p(17,J),p(18,qe)],bie);let yie=class extends RM{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(()=>gfe(v,!1),{...t,colors:y=>({badgeBackground:y.getColor(ww),badgeForeground:y.getColor(Sw)}),hoverOptions:e,compact:!0},()=>{},i,n,o,r,a,c,d,l,u,g,m)}};yie=f([p(2,Fh),p(3,ft),p(4,wi),p(5,tn),p(6,mi),p(7,me),p(8,ne),p(9,mn),p(10,Ve),p(11,J),p(12,Hv),p(13,tt)],yie);function gfe(s,e){const t=[];return e&&t.push(Ci({id:"hideAccounts",label:h(3355,"Hide Accounts"),run:()=>PM(s,!1)}),new is),[...t,Ci({id:"toggle.hideAccounts",label:h(3357,"Accounts"),checked:eq(s),run:()=>PM(s,!eq(s))}),Ci({id:"toggle.hideManage",label:h(3356,"Manage"),checked:!0,enabled:!1,run:()=>{throw new Error('"Manage" can not be hidden')}})]}function eq(s){return s.getBoolean(Iv.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,he.PROFILE,!0)}function PM(s,e){s.store(Iv.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,e,he.PROFILE,pt.USER)}var V_;Be(Bze);Be(Vze);let tq=class extends Wze{static{V_=this}static{this.ACTION_HEIGHT=48}static{this.pinnedViewContainersKey="workbench.activity.pinnedViewlets2"}static{this.placeholderViewContainersKey="workbench.activity.placeholderViewlets"}static{this.viewContainersWorkspaceStateKey="workbench.activity.viewletsWorkspaceState"}constructor(e,t,i,n,o){super(ot.ACTIVITYBAR_PART,{hasTitle:!1},n,o,i),this.paneCompositePart=e,this.instantiationService=t,this.minimumWidth=48,this.maximumWidth=48,this.minimumHeight=0,this.maximumHeight=Number.POSITIVE_INFINITY,this.compositeBar=this._register(new kt)}createCompositeBar(){return this.instantiationService.createInstance(iq,{partContainerClass:"activitybar",pinnedViewContainersKey:V_.pinnedViewContainersKey,placeholderViewContainersKey:V_.placeholderViewContainersKey,viewContainersWorkspaceStateKey:V_.viewContainersWorkspaceStateKey,orientation:xa.VERTICAL,icon:!0,iconSize:24,activityHoverOptions:{position:()=>this.layoutService.getSideBarPosition()===lh.LEFT?kF.RIGHT:kF.LEFT},preventLoopNavigation:!0,recomputeSizes:!1,fillExtraContextMenuActions:(e,t)=>{},compositeSize:52,colors:e=>({activeForegroundColor:e.getColor(nv),inactiveForegroundColor:e.getColor(Pxe),activeBorderColor:e.getColor(Qoe),activeBackground:e.getColor(Xoe),badgeBackground:e.getColor(ww),badgeForeground:e.getColor(Sw),dragAndDropBorder:e.getColor(Nxe),activeBackgroundColor:void 0,inactiveBackgroundColor:void 0,activeBorderBottomColor:void 0}),overflowActionSize:V_.ACTION_HEIGHT},ot.ACTIVITYBAR_PART,this.paneCompositePart,!0)}createContentArea(e){return this.element=e,this.content=ee(this.element,Y(".content")),this.layoutService.isVisible(ot.ACTIVITYBAR_PART)&&this.show(),this.content}getPinnedPaneCompositeIds(){return this.compositeBar.value?.getPinnedPaneCompositeIds()??[]}getVisiblePaneCompositeIds(){return this.compositeBar.value?.getVisiblePaneCompositeIds()??[]}getPaneCompositeIds(){return this.compositeBar.value?.getPaneCompositeIds()??[]}focus(){this.compositeBar.value?.focus()}updateStyles(){super.updateStyles();const e=Gt(this.getContainer()),t=this.getColor(Rxe)||"";e.style.backgroundColor=t;const i=this.getColor(Lxe)||this.getColor(et)||"";e.classList.toggle("bordered",!!i),e.style.borderColor=i||""}show(e){this.content&&(this.compositeBar.value||(this.compositeBar.value=this.createCompositeBar(),this.compositeBar.value.create(this.content),this.dimension&&this.layout(this.dimension.width,this.dimension.height)),e&&this.focus())}hide(){this.compositeBar.value&&(this.compositeBar.clear(),this.content&&Yi(this.content))}layout(e,t){if(super.layout(e,t,0,0),!this.compositeBar.value)return;const i=super.layoutContents(e,t).contentSize;this.compositeBar.value.layout(e,i.height)}toJSON(){return{type:ot.ACTIVITYBAR_PART}}};tq=V_=f([p(1,J),p(2,vi),p(3,ft),p(4,tt)],tq);let iq=class extends JG{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super({...e,fillExtraContextMenuActions:(y,w)=>{e.fillExtraContextMenuActions(y,w),this.fillContextMenuActions(y,w)}},t,i,o,r,a,c,d,l,u,v),this.configurationService=g,this.menuService=m,this.menuBar=this._register(new kt),this.keyboardNavigationDisposables=this._register(new U),n&&(this.globalCompositeBar=this._register(o.createInstance(TM,()=>this.getContextMenuActions(),y=>this.options.colors(y),this.options.activityHoverOptions))),this._register(this.configurationService.onDidChangeConfiguration(y=>{y.affectsConfiguration(Qr.MenuBarVisibility)&&(Ab(this.configurationService)==="compact"?this.installMenubar():this.uninstallMenubar())}))}fillContextMenuActions(e,t){const i=Ab(this.configurationService);(i==="compact"||i==="hidden"||i==="toggle")&&e.unshift(Ci({id:"toggleMenuVisibility",label:h(2849,"Menu"),checked:i==="compact",run:()=>this.configurationService.updateValue(Qr.MenuBarVisibility,i==="compact"?"toggle":"compact")}),new is),i==="compact"&&this.menuBarContainer&&t?.target&&Ku(t.target,this.menuBarContainer)&&e.unshift(Ci({id:"hideCompactMenu",label:h(2850,"Hide Menu"),run:()=>this.configurationService.updateValue(Qr.MenuBarVisibility,"toggle")}),new is),this.globalCompositeBar&&(e.push(new is),e.push(...this.globalCompositeBar.getContextMenuActions())),e.push(new is),e.push(...this.getActivityBarContextMenuActions())}uninstallMenubar(){this.menuBar.value&&(this.menuBar.value=void 0),this.menuBarContainer&&(this.menuBarContainer.remove(),this.menuBarContainer=void 0)}installMenubar(){if(this.menuBar.value)return;this.menuBarContainer=Y(".menubar"),Gt(this.element).prepend(this.menuBarContainer),this.menuBar.value=this._register(this.instantiationService.createInstance(QG)),this.menuBar.value.create(this.menuBarContainer)}registerKeyboardNavigationListeners(){this.keyboardNavigationDisposables.clear(),this.menuBarContainer&&this.keyboardNavigationDisposables.add(re(this.menuBarContainer,pe.KEY_DOWN,e=>{const t=new zs(e);(t.equals(S.DownArrow)||t.equals(S.RightArrow))&&this.focus()})),this.compositeBarContainer&&this.keyboardNavigationDisposables.add(re(this.compositeBarContainer,pe.KEY_DOWN,e=>{const t=new zs(e);t.equals(S.DownArrow)||t.equals(S.RightArrow)?this.globalCompositeBar?.focus():(t.equals(S.UpArrow)||t.equals(S.LeftArrow))&&this.menuBar.value?.toggleFocus()})),this.globalCompositeBar&&this.keyboardNavigationDisposables.add(re(this.globalCompositeBar.element,pe.KEY_DOWN,e=>{const t=new zs(e);(t.equals(S.UpArrow)||t.equals(S.LeftArrow))&&this.focus(this.getVisiblePaneCompositeIds().length-1)}))}create(e){return this.element=e,Ab(this.configurationService)==="compact"&&this.installMenubar(),this.compositeBarContainer=super.create(this.element),this.globalCompositeBar&&this.globalCompositeBar.create(this.element),this.registerKeyboardNavigationListeners(),this.compositeBarContainer}layout(e,t){this.menuBarContainer&&(this.options.orientation===xa.VERTICAL?t-=this.menuBarContainer.clientHeight:e-=this.menuBarContainer.clientWidth),this.globalCompositeBar&&(this.options.orientation===xa.VERTICAL?t-=this.globalCompositeBar.size()*tq.ACTION_HEIGHT:e-=this.globalCompositeBar.element.clientWidth),super.layout(e,t)}getActivityBarContextMenuActions(){const e=this.menuService.getMenuActions(N.ActivityBarPositionMenu,this.contextKeyService,{shouldForwardArgs:!0,renderShortTitle:!0}),t=qne(e).secondary,i=[new Dh("workbench.action.panel.position",h(2851,"Activity Bar Position"),t),Ci({id:nd.ID,label:nd.getLabel(this.layoutService),run:()=>this.instantiationService.invokeFunction(n=>new nd().run(n))})];return this.part===ot.SIDEBAR_PART&&i.push(Ci({id:Ch.ID,label:Ch.LABEL,run:()=>this.instantiationService.invokeFunction(n=>new Ch().run(n))})),i}};iq=f([p(4,J),p(5,tt),p(6,hn),p(7,Os),p(8,mo),p(9,me),p(10,mn),p(11,ne),p(12,tn),p(13,vi)],iq);K(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.default",title:{...I(2852,"Move Activity Bar to Side"),mnemonicTitle:h(2853,"&&Default")},shortTitle:h(2854,"Default"),category:te.View,toggled:x.equals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.DEFAULT),menu:[{id:N.ActivityBarPositionMenu,order:1},{id:N.CommandPalette,when:x.notEquals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.DEFAULT)}]})}run(s){s.get(ne).updateValue(si.ACTIVITY_BAR_LOCATION,jo.DEFAULT)}});K(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.top",title:{...I(2855,"Move Activity Bar to Top"),mnemonicTitle:h(2856,"&&Top")},shortTitle:h(2857,"Top"),category:te.View,toggled:x.equals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.TOP),menu:[{id:N.ActivityBarPositionMenu,order:2},{id:N.CommandPalette,when:x.notEquals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.TOP)}]})}run(s){s.get(ne).updateValue(si.ACTIVITY_BAR_LOCATION,jo.TOP)}});K(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.bottom",title:{...I(2858,"Move Activity Bar to Bottom"),mnemonicTitle:h(2859,"&&Bottom")},shortTitle:h(2860,"Bottom"),category:te.View,toggled:x.equals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.BOTTOM),menu:[{id:N.ActivityBarPositionMenu,order:3},{id:N.CommandPalette,when:x.notEquals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.BOTTOM)}]})}run(s){s.get(ne).updateValue(si.ACTIVITY_BAR_LOCATION,jo.BOTTOM)}});K(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.hide",title:{...I(2861,"Hide Activity Bar"),mnemonicTitle:h(2862,"&&Hidden")},shortTitle:h(2863,"Hidden"),category:te.View,toggled:x.equals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.HIDDEN),menu:[{id:N.ActivityBarPositionMenu,order:4},{id:N.CommandPalette,when:x.notEquals(`config.${si.ACTIVITY_BAR_LOCATION}`,jo.HIDDEN)}]})}run(s){s.get(ne).updateValue(si.ACTIVITY_BAR_LOCATION,jo.HIDDEN)}});ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.ActivityBarPositionMenu,title:h(2864,"Activity Bar Position"),group:"3_workbench_layout_move",order:2});ge.appendMenuItem(N.ViewContainerTitleContext,{submenu:N.ActivityBarPositionMenu,title:h(2864,"Activity Bar Position"),when:x.or(x.equals("viewContainerLocation",ed(Fe.Sidebar)),x.equals("viewContainerLocation",ed(Fe.AuxiliaryBar))),group:"3_workbench_layout_move",order:1});K(class extends uS{constructor(){super({id:"workbench.action.previousSideBarView",title:I(2865,"Previous Primary Side Bar View"),category:te.View,f1:!0},Fe.Sidebar,-1)}});K(class extends uS{constructor(){super({id:"workbench.action.nextSideBarView",title:I(2866,"Next Primary Side Bar View"),category:te.View,f1:!0},Fe.Sidebar,1)}});K(class extends X{constructor(){super({id:"workbench.action.focusActivityBar",title:I(2867,"Focus Activity Bar"),category:te.View,f1:!0})}async run(e){e.get(vi).focusPart(ot.ACTIVITYBAR_PART)}});Pv((s,e)=>{const t=s.getColor(Qoe);t&&e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .active-item-indicator:before {
				border-left-color: ${t};
			}
		`);const i=s.getColor(Mxe);i&&e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:focus::before {
				visibility: hidden;
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:focus .active-item-indicator:before {
				visibility: visible;
				border-left-color: ${i};
			}
		`);const n=s.getColor(Xoe);n&&e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .active-item-indicator {
				z-index: 0;
				background-color: ${n};
			}
		`);const o=s.getColor(Sr);if(o)e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item .action-label::before{
				padding: 6px;
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.active .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.active:hover .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:hover .action-label::before {
				outline: 1px solid ${o};
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:hover .action-label::before {
				outline: 1px dashed ${o};
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:focus .active-item-indicator:before {
				border-left-color: ${o};
			}
		`);else{const r=s.getColor(kT);r&&e.addRule(`
				.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:focus .active-item-indicator::before {
						border-left-color: ${r};
					}
				`)}});class pfe extends F{constructor(e=iSe()){super(),this.mainContainer=e,this.setSize=_,this.onDidChangeMainEditorCenteredLayout=D.None,this.whenActiveContainerStylesLoaded=Promise.resolve(),this._onDidLayoutContainer=this._register(new M),this.onDidLayoutContainer=this._onDidLayoutContainer.event,this._onDidAddContainer=this._register(new M),this.onDidAddContainer=this._onDidAddContainer.event,this._onDidRemoveContainer=this._register(new M),this.onDidRemoveContainer=this._onDidRemoveContainer.event,this._onDidLayoutMainContainer=this._register(new M),this.onDidLayoutMainContainer=this._onDidLayoutMainContainer.event,this._onDidLayoutActiveContainer=this._register(new M),this.onDidLayoutActiveContainer=this._onDidLayoutActiveContainer.event,this._onDidChangeActiveContainer=this._register(new M),this.onDidChangeActiveContainer=this._onDidChangeActiveContainer.event,this.mainContainerOffset={top:0,quickPickTop:0},this.activeContainerOffset={top:0,quickPickTop:0},this.onDidChangeFullscreen=D.None,this.onDidChangeZenMode=D.None,this.onDidChangeWindowMaximized=D.None,this.onDidChangeCenteredLayout=D.None,this._onDidChangePanelPosition=this._register(new M),this.onDidChangePanelPosition=this._onDidChangePanelPosition.event,this._onDidChangeSideBarPosition=this._register(new M),this.onDidChangeSideBarPosition=this._onDidChangeSideBarPosition.event,this.onDidChangePanelAlignment=D.None,this.onDidChangeNotificationsVisibility=D.None,this.openedDefaultEditors=!1,this.whenRestored=Promise.resolve(),this.parts=new Map,this.hiddenParts=new Set,this._onDidChangePartVisibility=new M,this.onDidChangePartVisibility=this._onDidChangePartVisibility.event,this.offset={top:0,quickPickTop:0},this._onDidLayout=new M,this.onDidLayout=this._onDidLayout.event,window.addEventListener("resize",()=>this.layout()),this.layout();const i=Vt(["monaco-workbench",pn?"windows":vh?"linux":"mac","web",nSe?"chromium":sSe?"firefox":oSe?"safari":void 0]);e.classList.add(...i)}getSize(e){return this.getPart(e)?.dimension??{height:0,width:0}}whenContainerStylesLoaded(){}hasMainWindowBorder(){return!1}getMainWindowBorderRadius(){}isMainEditorLayoutCentered(){return!1}centerMainEditorLayout(){}get activeContainer(){return this.getContainerFromDocument(Kd())}get containers(){const e=[];for(const{window:t}of GF())e.push(this.getContainerFromDocument(t.document));return e}getContainerFromDocument(e){return e===this.mainContainer.ownerDocument?this.mainContainer:e.body.getElementsByClassName("monaco-workbench")[0]}init(e){this.editorGroupService=e.get(Ie),this.paneCompositeService=e.get(aa),this.statusBarService=e.get(kN),this.viewDescriptorService=e.get(Os),this.configurationService=e.get(ne),this.auxiliaryWindowService=e.get(Ore),this.hostService=e.get(Wn),this._register(this.configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(si.ACTIVITY_BAR_LOCATION)&&this.setPartHidden(this.isActivityBarHidden(),ot.ACTIVITYBAR_PART),t.affectsConfiguration("workbench.statusBar.visible")&&this.setPartHidden(!this.configurationService.getValue("workbench.statusBar.visible"),ot.STATUSBAR_PART),t.affectsConfiguration("workbench.sideBar.location")&&this.setSideBarPosition(HD(this.configurationService.getValue("workbench.sideBar.location")??"left")),t.affectsConfiguration("workbench.panel.defaultLocation")&&this.setPanelPosition(HD(this.configurationService.getValue("workbench.panel.defaultLocation")??"bottom"))})),this.setPartHidden(this.isActivityBarHidden(),ot.ACTIVITYBAR_PART),this.setPartHidden(!this.configurationService.getValue("workbench.statusBar.visible"),ot.STATUSBAR_PART),this.sideBarPosition=HD(this.configurationService.getValue("workbench.sideBar.location")??"left"),this.panelPosition=HD(this.configurationService.getValue("workbench.panel.defaultLocation")??"bottom"),this._register(this.hostService.onDidChangeActiveWindow(()=>this.onActiveWindowChanged())),this._register(this.auxiliaryWindowService.onDidOpenAuxiliaryWindow(({window:t,disposables:i})=>{this._onDidAddContainer.fire({container:t.container,disposables:new U}),i.add(t.onDidLayout(n=>this.handleContainerDidLayout(t.container,n))),i.add(Ee(()=>this._onDidRemoveContainer.fire(t.container)))}))}handleContainerDidLayout(e,t){e===this.mainContainer&&this._onDidLayoutMainContainer.fire(t),rSe(e)&&this._onDidLayoutActiveContainer.fire(t)}getActiveContainerId(){const e=this.activeContainer;return bt(e).vscodeWindowId}onActiveWindowChanged(){const e=this.getActiveContainerId();this.activeContainerId!==e&&(this.activeContainerId=e,this._onDidChangeActiveContainer.fire())}isActivityBarHidden(){const e=this.configurationService.getValue("workbench.activityBar.visible");return e!==void 0?!e:this.configurationService.getValue(si.ACTIVITY_BAR_LOCATION)!==jo.DEFAULT}focusPart(e){switch(e){case ot.EDITOR_PART:this.editorGroupService.activeGroup.focus();break;case ot.PANEL_PART:{this.paneCompositeService.getActivePaneComposite(Fe.Panel)?.focus();break}case ot.SIDEBAR_PART:{this.paneCompositeService.getActivePaneComposite(Fe.Sidebar)?.focus();break}case ot.ACTIVITYBAR_PART:this.getPart(ot.ACTIVITYBAR_PART).focus();break;case ot.STATUSBAR_PART:this.statusBarService.focus();break;default:this.getContainer(e)?.focus()}}getDimension(e){return this.getPart(e)?.dimension}toggleMaximizedPanel(){}toggleMenuBar(){let e=Ab(this.configurationService);typeof e!="string"&&(e="classic");let t;e==="visible"||e==="classic"?t=aSe(this.configurationService)==="native"?"toggle":"compact":t="classic",this.configurationService.updateValue("window.menuBarVisibility",t)}setPanelPosition(e){this.panelPosition=e,this.getPart(ot.PANEL_PART)?.updateStyles(),this._onDidChangePanelPosition.fire(dA(e))}getPanelAlignment(){return"left"}setPanelAlignment(){}toggleZenMode(){}isEditorLayoutCentered(){return!1}centerEditorLayout(){}resizePart(){}isWindowMaximized(){return!1}updateWindowMaximizedState(){}getVisibleNeighborPart(){}getMaximumEditorDimensions(){return new Ke(1/0,1/0)}isPanelMaximized(){return!1}getPanelPosition(){return this.panelPosition}hasFocus(e){const t=document.activeElement;if(t==null)return!1;const i=this.getContainer(e);return i!=null&&cSe(t,i)}getContainer(e){return typeof e=="string"?this.parts.get(e)==null?void 0:this.getPart(e)?.getContainer():e.document===this.mainContainer.ownerDocument?this.mainContainer:e.document.body.getElementsByClassName("monaco-workbench")[0]}getPart(e){return this.parts.get(e)}hasViews(e){const t=this.viewDescriptorService.getViewContainerById(e);if(t==null)return!1;const i=this.viewDescriptorService.getViewContainerModel(t);return i==null?!1:i.activeViewDescriptors.length>=1}setPartHidden(e,t){e?this.hiddenParts.add(t):this.hiddenParts.delete(t),this._onDidChangePartVisibility.fire();const i={[ot.SIDEBAR_PART]:Fe.Sidebar,[ot.AUXILIARYBAR_PART]:Fe.AuxiliaryBar,[ot.PANEL_PART]:Fe.Panel}[t];if(i!=null){const n=this.paneCompositeService.getActivePaneComposite(i);if(n!=null&&e)this.paneCompositeService.hideActivePaneComposite(i);else if(n==null&&!e){let o=this.paneCompositeService.getLastActivePaneCompositeId(i);(o==null||!this.hasViews(o))&&(o=this.viewDescriptorService.getViewContainersByLocation(i).find(r=>this.hasViews(r.id))?.id),o!=null&&this.paneCompositeService.openPaneComposite(o,i,!0)}}this.getPart(t)?.setVisible(!e)}isVisible(e){return!this.hiddenParts.has(e)}getSideBarPosition(){return this.sideBarPosition}setSideBarPosition(e){this.sideBarPosition=e;const t=this.getPart(ot.ACTIVITYBAR_PART),i=this.getPart(ot.SIDEBAR_PART),n=this.getPart(ot.AUXILIARYBAR_PART);t?.updateStyles(),i?.updateStyles(),n?.updateStyles(),this._onDidChangeSideBarPosition.fire(dA(e))}registerPart(e){const t=e.getId();return this.parts.set(t,e),Ee(()=>this.parts.delete(t))}isRestored(){return!0}get mainContainerDimension(){return this._mainContainerDimension}get activeContainerDimension(){const e=this.activeContainer;return e===this.mainContainer?this.mainContainerDimension:Zu(e)}layout(){this._mainContainerDimension=Zu(window.document.body),this._onDidLayout.fire(this._mainContainerDimension)}get hasContainer(){return!0}focus(){const e=this.activeContainer;if(e===this.mainContainer){const t=Ya.get(Ot).getFocusedCodeEditor();t instanceof Bse?t.focus():this.focusPart(ot.EDITOR_PART)}else this.editorGroupService.getPart(e).activeGroup.focus()}}FCe(s=>{const e=s.get(df);e instanceof pfe&&e.init(s)});function BKe(s){return{[df.toString()]:new _r(pfe,[s],!0)}}var Oc;(function(s){s[s.Unknown=1]="Unknown",s[s.Keyboard=2]="Keyboard",s[s.Api=3]="Api"})(Oc||(Oc={}));let fg=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.layoutService=e,this.configurationService=t,this.fileService=i,this.labelService=n,this.environmentService=o,this.instantiationService=r,this.lifecycleService=a,this.logService=c,this.dialogService=d,this.contextService=l,this.userDataProfilesService=u,this.shutdownReason=Oc.Unknown,o.options?.workspaceProvider?this.workspaceProvider=o.options.workspaceProvider:this.workspaceProvider=new class{constructor(){this.workspace=void 0,this.trusted=void 0}async open(){return!0}},this.registerListeners()}registerListeners(){this._register(this.lifecycleService.onBeforeShutdown(e=>this.onBeforeShutdown(e))),this._register(LT.getInstance().event(()=>this.updateShutdownReasonFromEvent()))}onBeforeShutdown(e){switch(this.shutdownReason){case Oc.Unknown:case Oc.Keyboard:{const t=this.configurationService.getValue("window.confirmBeforeClose");(t==="always"||t==="keyboardOnly"&&this.shutdownReason===Oc.Keyboard)&&e.veto(!0,"veto.confirmBeforeClose");break}}this.shutdownReason=Oc.Unknown}updateShutdownReasonFromEvent(){this.shutdownReason!==Oc.Api&&(LT.getInstance().isModifierPressed?this.shutdownReason=Oc.Keyboard:this.shutdownReason=Oc.Unknown)}get onDidChangeFocus(){const e=this._register(new M);return this._register(D.runAndSubscribe(Em,({window:t,disposables:i})=>{const n=i.add(Po(t)),o=i.add(new Wo(t.document,"visibilitychange"));D.any(D.map(n.onDidFocus,()=>this.hasFocus,i),D.map(n.onDidBlur,()=>this.hasFocus,i),D.map(o.event,()=>this.hasFocus,i),D.map(this.onDidChangeActiveWindow,()=>this.hasFocus,i))(r=>e.fire(r),void 0,i)},{window:$i,disposables:this._store})),D.latch(e.event,void 0,this._store)}get hasFocus(){return Kd().hasFocus()}async hadLastFocus(){return!0}async focus(e){e.focus()}get onDidChangeActiveWindow(){const e=this._register(new M);return this._register(D.runAndSubscribe(Em,({window:t,disposables:i})=>{const n=r6(t),o=i.add(Po(t));i.add(o.onDidFocus(()=>e.fire(n))),dSe(t)&&i.add(lSe(t,()=>{const r=t.document.hasFocus();return r&&e.fire(n),r},100,20))},{window:$i,disposables:this._store})),D.latch(e.event,void 0,this._store)}get onDidChangeFullScreen(){const e=this._register(new M);return this._register(D.runAndSubscribe(Em,({window:t,disposables:i})=>{const n=r6(t),o=EE&&t.visualViewport?t.visualViewport:t,r=()=>{const a=pSe(t);return a!==null&&!a.guess};for(const a of[pe.FULLSCREEN_CHANGE,pe.WK_FULLSCREEN_CHANGE])i.add(re(t.document,a,()=>e.fire({windowId:n,fullscreen:r()})));i.add(hSe(o,pe.RESIZE,()=>e.fire({windowId:n,fullscreen:r()}),void 0,qt?2e3:800))},{window:$i,disposables:this._store})),e.event}openWindow(e,t){return Array.isArray(e)?this.doOpenWindow(e,t):this.doOpenEmptyWindow(e)}async doOpenWindow(e,t){const i=this.preservePayload(!1,t),n=[],o=[],r=[];for(const a of e)a.label=a.label||this.getRecentLabel(a),r0(a)?t?.addMode?o.push({uri:a.folderUri}):t?.removeMode?r.push(a.folderUri):this.doOpen({folderUri:a.folderUri},{reuse:this.shouldReuse(t,!1),payload:i}):OF(a)?this.doOpen({workspaceUri:a.workspaceUri},{reuse:this.shouldReuse(t,!1),payload:i}):uSe(a)&&n.push(a);(o.length>0||r.length>0)&&this.withServices(async a=>{const c=a.get(uc);o.length>0&&await c.addFolders(o),r.length>0&&await c.removeFolders(r)}),n.length>0&&this.withServices(async a=>{const c=a.get(de);if(t?.mergeMode&&n.length===4){const l=Vt(await l0(n,this.fileService,this.logService));if(l.length!==4||!eh(l[0])||!eh(l[1])||!eh(l[2])||!eh(l[3]))return;if(this.shouldReuse(t,!0))c.openEditor({input1:{resource:l[0].resource},input2:{resource:l[1].resource},base:{resource:l[2].resource},result:{resource:l[3].resource},options:{pinned:!0}});else{const u=new Map;u.set("mergeFile1",l[0].resource.toString()),u.set("mergeFile2",l[1].resource.toString()),u.set("mergeFileBase",l[2].resource.toString()),u.set("mergeFileResult",l[3].resource.toString()),this.doOpen(void 0,{payload:Array.from(u.entries())})}}else if(t?.diffMode&&n.length===2){const l=Vt(await l0(n,this.fileService,this.logService));if(l.length!==2||!eh(l[0])||!eh(l[1]))return;if(this.shouldReuse(t,!0))c.openEditor({original:{resource:l[0].resource},modified:{resource:l[1].resource},options:{pinned:!0}});else{const u=new Map;u.set("diffFileSecondary",l[0].resource.toString()),u.set("diffFilePrimary",l[1].resource.toString()),this.doOpen(void 0,{payload:Array.from(u.entries())})}}else for(const l of n)if(this.shouldReuse(t,!0)){let u=[];if(t?.gotoLineMode){const g=Sse(l.fileUri.path);u=[{fileUri:l.fileUri.with({path:g.path}),options:{selection:Gm(g.line)?void 0:{startLineNumber:g.line,startColumn:g.column||1}}}]}else u=[l];c.openEditors(Vt(await l0(u,this.fileService,this.logService)),void 0,{validateTrust:!0})}else{const u=new Map;u.set("openFile",l.fileUri.toString()),t?.gotoLineMode&&u.set("gotoLineMode","true"),this.doOpen(void 0,{payload:Array.from(u.entries())})}const d=t?.waitMarkerFileURI;d&&(async()=>{const l=[];t.mergeMode?l.push(n[3].fileUri):l.push(...n.map(u=>u.fileUri)),await this.instantiationService.invokeFunction(u=>fOe(u,l)),await this.fileService.del(d)})()})}withServices(e){this.instantiationService.invokeFunction(t=>e(t))}preservePayload(e,t){const i=new Array;!e&&this.environmentService.extensionDevelopmentLocationURI&&(i.push(["extensionDevelopmentPath",this.environmentService.extensionDevelopmentLocationURI.toString()]),this.environmentService.debugExtensionHost.debugId&&i.push(["debugId",this.environmentService.debugExtensionHost.debugId]),this.environmentService.debugExtensionHost.port&&i.push(["inspect-brk-extensions",String(this.environmentService.debugExtensionHost.port)]));const n=t?.forceProfile?this.userDataProfilesService.profiles.find(o=>o.name===t?.forceProfile):void 0;return n&&!n.isDefault&&i.push(["profile",n.name]),i.length?i:void 0}getRecentLabel(e){return r0(e)?this.labelService.getWorkspaceLabel(e.folderUri,{verbose:Qm.LONG}):OF(e)?this.labelService.getWorkspaceLabel(gSe(e.workspaceUri),{verbose:Qm.LONG}):this.labelService.getUriLabel(e.fileUri,{appendWorkspaceSuffix:!0})}shouldReuse(e=Object.create(null),t){if(e.waitMarkerFileURI)return!0;const i=this.configurationService.getValue("window"),n=t?i?.openFilesInNewWindow||"off":i?.openFoldersInNewWindow||"default";let o=(e.preferNewWindow||!!e.forceNewWindow)&&!e.forceReuseWindow;return!e.forceNewWindow&&!e.forceReuseWindow&&(n==="on"||n==="off")&&(o=n==="on"),!o}async doOpenEmptyWindow(e){return this.doOpen(void 0,{reuse:e?.forceReuseWindow,payload:this.preservePayload(!0,e)})}async doOpen(e,t){if(e&&r0(e)&&e.folderUri.scheme===ae.file&&zM(this.contextService.getWorkspace())){this.withServices(async n=>{await n.get(uc).updateFolders(0,this.contextService.getWorkspace().folders.length,[{uri:e.folderUri}])});return}t?.reuse&&await this.handleExpectedShutdown(Cb.LOAD),await this.workspaceProvider.open(e,t)||await this.dialogService.prompt({type:Me.Warning,message:e?h(12688,"The browser blocked opening a new tab or window for '{0}'. Press 'Retry' to try again.",this.getRecentLabel(e)):h(12689,"The browser blocked opening a new tab or window. Press 'Retry' to try again."),custom:{markdownDetails:[{markdown:new Ni(h(12690,"Please allow pop-ups for this website in your [browser settings]({0}).","https://aka.ms/allow-vscode-popup"),!0)}]},buttons:[{label:h(12691,"&&Retry"),run:()=>this.workspaceProvider.open(e,t)}],cancelButton:!0})}async toggleFullScreen(e){const t=this.layoutService.getContainer(e);if(e.document.fullscreen!==void 0)if(e.document.fullscreen)try{return await e.document.exitFullscreen()}catch{this.logService.warn("toggleFullScreen(): exitFullscreen failed")}else try{return await t.requestFullscreen()}catch{this.logService.warn("toggleFullScreen(): requestFullscreen failed")}if(e.document.webkitIsFullScreen!==void 0)try{e.document.webkitIsFullScreen?e.document.webkitExitFullscreen():t.webkitRequestFullscreen()}catch{this.logService.warn("toggleFullScreen(): requestFullscreen/exitFullscreen failed")}}async moveTop(e){}async getCursorScreenPoint(){}async restart(){this.reload()}async reload(){await this.handleExpectedShutdown(Cb.RELOAD),$i.location.reload()}async close(){await this.handleExpectedShutdown(Cb.CLOSE),$i.close()}async withExpectedShutdown(e){const t=this.shutdownReason;try{return this.shutdownReason=Oc.Api,await e()}finally{this.shutdownReason=t}}async handleExpectedShutdown(e){return this.shutdownReason=Oc.Api,this.lifecycleService.withExpectedShutdown(e)}async getScreenshot(){const e=new U,t=document.createElement("video");e.add(Ee(()=>t.remove()));let i;try{i=await navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}),t.srcObject=i,t.play(),await Promise.all([new Promise(c=>e.add(re(t,"loadedmetadata",()=>c()))),new Promise(c=>e.add(re(t,"canplaythrough",()=>c())))]);const n=document.createElement("canvas");n.width=t.videoWidth,n.height=t.videoHeight;const o=n.getContext("2d");if(!o)return;o.drawImage(t,0,0,n.width,n.height);const r=await new Promise(c=>n.toBlob(d=>c(d),"image/jpeg",.95));if(!r)throw new Error("Failed to create blob from canvas");const a=await r.bytes();return Re.wrap(a)}catch(n){console.error("Error taking screenshot:",n);return}finally{if(e.dispose(),i)for(const n of i.getTracks())n.stop()}}async getBrowserId(){}async getNativeWindowHandle(e){}};fg.__decorator=f([Ht],fg.prototype,"onDidChangeFocus",null);fg.__decorator=f([Ht],fg.prototype,"onDidChangeActiveWindow",null);fg.__decorator=f([Ht],fg.prototype,"onDidChangeFullScreen",null);fg=f([p(0,df),p(1,ne),p(2,Xe),p(3,di),p(4,lf),p(5,J),p(6,wd),p(7,Pe),p(8,Qt),p(9,Tt),p(10,Wv)],fg);class VKe extends F{constructor(){super(),this._onDidSchemeChangeEvent=this._register(new M),this.registerListeners()}registerListeners(){a6($i,"(prefers-color-scheme: dark)",()=>{this._onDidSchemeChangeEvent.fire()}),a6($i,"(forced-colors: active)",()=>{this._onDidSchemeChangeEvent.fire()})}get onDidChangeColorScheme(){return this._onDidSchemeChangeEvent.event}get dark(){return $i.matchMedia("(prefers-color-scheme: light)").matches?!1:!!$i.matchMedia("(prefers-color-scheme: dark)").matches}get highContrast(){return!!$i.matchMedia("(forced-colors: active)").matches}}function HKe(){return{[Wn.toString()]:new _r(fg,[],!0),[Hre.toString()]:new _r(VKe,[],!0)}}if(window.monacoVscodeApiBuildId!=null&&window.monacoVscodeApiBuildId!=="1.101.1-d03b4d69-3987-4c8d-9f1a-4e87b79c8866")throw new Error(`Another version of monaco-vscode-api has already been loaded. Trying to load 1.101.1-d03b4d69-3987-4c8d-9f1a-4e87b79c8866, ${window.monacoVscodeApiBuildId} is already loaded`);window.monacoVscodeApiBuildId="1.101.1-d03b4d69-3987-4c8d-9f1a-4e87b79c8866";async function yot(s,e=document.body,t={},i){VCe(),fSe(e),mSe(e,t,i);const n=zu({_serviceBrand:void 0,...Io},t.productConfiguration),o=Ya.initialize({[Fn.toString()]:n,...BKe(),...Oze(),...cUe(),...HCe(),...Nze(),...HKe(),...vSe(),...s});await UCe(o)}async function wot(s){return await nA(),Ya.get(s)}function Sot(s){if(WCe.isOpen())return Ya.get(J).invokeFunction(s);const e=new U,t=e.add(BCe.event(()=>{t.dispose(),e.add(Ya.get(J).invokeFunction(s))}));return e}export{Hd as $,Jr as A,Ty as B,c9 as C,cW as D,E8 as E,y9 as F,th as G,TY as H,Xke as I,Q_ as J,sY as K,tv as L,$e as M,OS as N,TB as O,en as P,H6 as Q,ls as R,dW as S,I7e as T,py as U,nY as V,xTe as W,O9e as X,nR as Y,EY as Z,MTe as _,eTe as a,h9 as a$,ZY as a0,XY as a1,RTe as a2,K9e as a3,D6 as a4,EW as a5,xW as a6,wA as a7,lEe as a8,i9 as a9,$9 as aA,M9 as aB,nAe as aC,Wk as aD,gr as aE,XKe as aF,$Ce as aG,GCe as aH,foe as aI,Mi as aJ,To as aK,GB as aL,jA as aM,qB as aN,WY as aO,FY as aP,ql as aQ,z9 as aR,T9e as aS,$j as aT,A9e as aU,_Ee as aV,NB as aW,tQ as aX,j9e as aY,d9 as aZ,l9 as a_,e9 as aa,Cce as ab,Od as ac,Oo as ad,Y5e as ae,V5e as af,j5e as ag,K5e as ah,z5e as ai,q5e as aj,G5e as ak,$5e as al,U5e as am,H5e as an,B5e as ao,TK as ap,xY as aq,Ace as ar,IC as as,$Y as at,Nd as au,Gc as av,EA as aw,oo as ax,Qd as ay,Y9e as az,D7e as b,kAe as b$,T9 as b0,f9 as b1,$Te as b2,UTe as b3,Z4e as b4,c5e as b5,a5e as b6,u9 as b7,g9 as b8,p9 as b9,ZA as bA,aY as bB,cY as bC,oY as bD,bY as bE,v5e as bF,Wce as bG,k9 as bH,F6 as bI,mY as bJ,vY as bK,G6 as bL,wY as bM,yA as bN,yY as bO,_Y as bP,IY as bQ,gY as bR,uY as bS,DY as bT,dY as bU,mW as bV,Ah as bW,R6 as bX,T6 as bY,ss as bZ,RY as b_,w8 as ba,zp as bb,BTe as bc,z9e as bd,W9e as be,H9e as bf,q9e as bg,U9e as bh,G9e as bi,Ep as bj,k7e as bk,$9e as bl,xC as bm,nx as bn,cv as bo,hm as bp,aQ as bq,M9e as br,Gj as bs,CQ as bt,CR as bu,S9e as bv,eR as bw,tl as bx,lY as by,_W as bz,S5e as c,gy as c$,jY as c0,KY as c1,rV as c2,Vi as c3,f7e as c4,dV as c5,cV as c6,aV as c7,g7e as c8,zY as c9,oV as cA,gR as cB,ZB as cC,uR as cD,Moe as cE,lR as cF,Aoe as cG,jB as cH,Ooe as cI,YB as cJ,koe as cK,dR as cL,qY as cM,qp as cN,nV as cO,S9 as cP,D9 as cQ,x9 as cR,I9 as cS,DK as cT,VAe as cU,WAe as cV,wV as cW,yV as cX,iY as cY,Ga as cZ,CY as c_,p7e as ca,KB as cb,Rj as cc,t8 as cd,QY as ce,YY as cf,m7e as cg,Woe as ch,IEe as ci,Toe as cj,Loe as ck,CEe as cl,EEe as cm,Foe as cn,xEe as co,i7e as cp,Noe as cq,GY as cr,XB as cs,Roe as ct,hR as cu,Boe as cv,tV as cw,QB as cx,sV as cy,iV as cz,Rc as d,IR as d$,$6 as d0,b9 as d1,hA as d2,_9 as d3,tY as d4,bA as d5,vW as d6,rY as d7,jp as d8,hY as d9,sre as dA,$h as dB,fl as dC,CI as dD,EI as dE,FQ as dF,Z9e as dG,sQ as dH,tb as dI,eY as dJ,A6 as dK,Fc as dL,cR as dM,oR as dN,rR as dO,aR as dP,az as dQ,qKe as dR,W9 as dS,V9e as dT,um as dU,AY as dV,PY as dW,MY as dX,Ioe as dY,i8e as dZ,mEe as d_,pY as da,BY as db,b5e as dc,_5e as dd,Fce as de,fY as df,ob as dg,yo as dh,VB as di,HB as dj,OE as dk,m9 as dl,oQ as dm,JY as dn,eQ as dp,h8 as dq,$B as dr,SY as ds,Py as dt,DW as du,LC as dv,kW as dw,_h as dx,xR as dy,mf as dz,L9e as e,CA as e$,NY as e0,LY as e1,H9 as e2,V9 as e3,R9 as e4,P9 as e5,L9 as e6,a9 as e7,V6 as e8,k4e as e9,n8 as eA,BW as eB,AEe as eC,TEe as eD,J9 as eE,DEe as eF,$l as eG,i8 as eH,Poe as eI,op as eJ,l8 as eK,CC as eL,Z_ as eM,d8 as eN,c8 as eO,r8 as eP,e8 as eQ,ib as eR,X9 as eS,Q9 as eT,j9 as eU,wEe as eV,yEe as eW,bEe as eX,u0 as eY,IW as eZ,TC as e_,_A as ea,U6 as eb,N9 as ec,O9 as ed,HY as ee,SA as ef,s9 as eg,DC as eh,jAe as ei,n9 as ej,rQ as ek,Ye as el,a8 as em,C7e as en,E7e as eo,s8 as ep,x8 as eq,w7e as er,v9 as es,p5e as et,rg as eu,o8 as ev,v7e as ew,y7e as ex,REe as ey,cz as ez,P9e as f,RW as f$,F5e as f0,WW as f1,q9 as f2,R5e as f3,P5e as f4,k5e as f5,lW as f6,B9 as f7,I5e as f8,x5e as f9,Y6 as fA,M4e as fB,N4e as fC,L4e as fD,X6 as fE,J6 as fF,Z6 as fG,pA as fH,on as fI,L6 as fJ,N6 as fK,M6 as fL,t9 as fM,xoe as fN,kC as fO,A9 as fP,Y9 as fQ,P6 as fR,k6 as fS,gW as fT,uW as fU,B6 as fV,W6 as fW,Xg as fX,w9 as fY,K9 as fZ,PW as f_,fEe as fa,FW as fb,vEe as fc,pEe as fd,F9 as fe,eb as ff,U9 as fg,G9 as fh,z6 as fi,QKe as fj,O6 as fk,bW as fl,yW as fm,j4e as fn,o9 as fo,r9 as fp,vA as fq,Ul as fr,Mb as fs,EC as ft,j6 as fu,W4e as fv,Q6 as fw,F4e as fx,K6 as fy,O4e as fz,wot as g,Nze as g$,AW as g0,TW as g1,SW as g2,fW as g3,gA as g4,pW as g5,X_ as g6,uA as g7,hW as g8,J_ as g9,C9e as gA,Zke as gB,FN as gC,aIe as gD,te as gE,rce as gF,Oze as gG,Pi as gH,hz as gI,HV as gJ,Rz as gK,VX as gL,iU as gM,yot as gN,cUe as gO,R8e as gP,P8e as gQ,Lt as gR,Itt as gS,tP as gT,tDe as gU,O5 as gV,KS as gW,Hre as gX,BN as gY,dz as gZ,yI as g_,y5e as ga,_8 as gb,SC as gc,mA as gd,_t as ge,wW as gf,E9 as gg,C9 as gh,CW as gi,fA as gj,AC as gk,dEe as gl,cEe as gm,kEe as gn,Q5e as go,Z9 as gp,x6 as gq,FE as gr,kY as gs,mDe as gt,qN as gu,CS as gv,Uit as gw,T8e as gx,A8e as gy,gie as gz,Yr as h,_z as h$,Os as h0,Fe as h1,tq as h2,y3 as h3,zi as h4,BR as h5,Zd as h6,$D as h7,r6e as h8,c6e as h9,Iv as hA,s6e as hB,Y8 as hC,dxe as hD,tre as hE,hh as hF,o6e as hG,eq as hH,nYe as hI,sYe as hJ,cxe as hK,M7e as hL,P7e as hM,L7e as hN,c0e as hO,R7e as hP,Mu as hQ,q7e as hR,Qx as hS,V7e as hT,H7e as hU,Sp as hV,B7e as hW,G7e as hX,Txe as hY,$7e as hZ,U7e as h_,Qxe as ha,iv as hb,kN as hc,a6e as hd,Ore as he,nDe as hf,LIe as hg,d6e as hh,l6e as hi,Wze as hj,ro as hk,fc as hl,Vh as hm,Tge as hn,sa as ho,yD as hp,Zst as hq,uie as hr,QG as hs,sP as ht,yie as hu,oP as hv,bie as hw,Hu as hx,QOe as hy,uue as hz,rt as i,Mp as i$,my as i0,ZW as i1,xx as i2,VYe as i3,uOe as i4,MZ as i5,WHe as i6,HYe as i7,Q1e as i8,X1e as i9,J7e as iA,Z7e as iB,Q7e as iC,$E as iD,X7e as iE,aw as iF,$ze as iG,Wu as iH,Pc as iI,mu as iJ,MK as iK,Eo as iL,io as iM,F7e as iN,O7e as iO,W7e as iP,bz as iQ,$1e as iR,NP as iS,xr as iT,g6e as iU,u6e as iV,KP as iW,aue as iX,Yoe as iY,N7e as iZ,nd as i_,WP as ia,Jd as ib,OP as ic,JG as id,TN as ie,j8 as ig,i6e as ih,n6e as ii,mz as ij,Joe as ik,vz as il,iq as im,j7e as io,Sw as ip,ww as iq,K7e as ir,HE as is,z7e as it,mKe as iu,Hv as iv,Y7e as iw,Zoe as ix,UE as iy,e6e as iz,CTe as j,Bue as j$,fze as j0,UEe as j1,BIe as j2,uH as j3,WU as j4,VZe as j5,os as j6,n8e as j7,s8e as j8,Yp as j9,Hh as jA,DN as jB,ett as jC,itt as jD,MN as jE,Uze as jF,o8e as jG,bRe as jH,lp as jI,fd as jJ,Fb as jK,gX as jL,Ix as jM,vd as jN,cl as jO,_L as jP,OJ as jQ,LA as jR,iae as jS,tae as jT,eae as jU,Jre as jV,pd as jW,kDe as jX,jre as jY,M6e as jZ,Ir as j_,GAe as ja,CV as jb,ed as jc,cit as jd,mo as je,HQ as jf,ws as jg,e8e as jh,t8e as ji,PZ as jj,wce as jk,F9e as jl,pc as jm,fo as jn,qb as jo,vf as jp,$Ie as jq,Q2e as jr,gH as js,x_ as jt,t$e as ju,i$e as jv,m$e as jw,Ute as jx,ttt as jy,ntt as jz,R9e as k,$re as k$,bL as k0,FJ as k1,Hue as k2,PIe as k3,C0 as k4,UQ as k5,i0e as k6,zG as k7,xZ as k8,IZ as k9,y6e as kA,w6e as kB,XIe as kC,hj as kD,dj as kE,Nu as kF,Lre as kG,wL as kH,KC as kI,vee as kJ,QFe as kK,x7e as kL,mU as kM,tB as kN,nU as kO,cZ as kP,VP as kQ,kU as kR,Tp as kS,xje as kT,E5 as kU,C5 as kV,x5 as kW,I5 as kX,y5 as kY,w5 as kZ,k5 as k_,pg as ka,rde as kb,yO as kc,WN as kd,uj as ke,Va as kf,_6e as kg,qr as kh,jIe as ki,t6e as kj,Eu as kk,Xd as kl,gj as km,qE as kn,zE as ko,YIe as kp,Dm as kq,dre as kr,Hr as ks,Ew as kt,Cz as ku,Jg as kv,m6e as kw,b6e as kx,KIe as ky,lj as kz,zB as l,SXe as l$,iDe as l0,Gb as l1,BYe as l2,zYe as l3,Tte as l4,Rl as l5,qhe as l6,qy as l7,zhe as l8,pU as l9,uQe as lA,gQe as lB,pQe as lC,fQe as lD,mQe as lE,GQe as lF,qQe as lG,zQe as lH,KQe as lI,UQe as lJ,$Qe as lK,_Xe as lL,bXe as lM,MQe as lN,NQe as lO,OQe as lP,FQe as lQ,WQe as lR,BQe as lS,VQe as lT,HQe as lU,yXe as lV,wXe as lW,IXe as lX,DXe as lY,EXe as lZ,xXe as l_,Khe as la,Sx as lb,Hhe as lc,Uhe as ld,jQe as le,YQe as lf,QQe as lg,XQe as lh,ZQe as li,JQe as lj,gXe as lk,pXe as ll,fXe as lm,mXe as ln,$he as lo,Ghe as lp,Ex as lq,RQe as lr,AQe as ls,PQe as lt,LQe as lu,TQe as lv,Whe as lw,dQe as lx,lQe as ly,hQe as lz,Ln as m,kOe as m$,CXe as m0,kXe as m1,TXe as m2,MXe as m3,NXe as m4,PXe as m5,LXe as m6,AXe as m7,RXe as m8,vQe as m9,Zhe as mA,Jhe as mB,tue as mC,eue as mD,VXe as mE,HXe as mF,dXe as mG,lXe as mH,hXe as mI,uXe as mJ,FU as mK,UXe as mL,$Xe as mM,GXe as mN,qXe as mO,zXe as mP,KXe as mQ,hS as mR,jYe as mS,TOe as mT,jO as mU,xOe as mV,bU as mW,yU as mX,wU as mY,SU as mZ,jOe as m_,_Qe as ma,bQe as mb,wQe as mc,yQe as md,SQe as me,CQe as mf,EQe as mg,xQe as mh,OXe as mi,FXe as mj,WXe as mk,BXe as ml,eXe as mm,tXe as mn,iXe as mo,nXe as mp,sXe as mq,oXe as mr,rXe as ms,aXe as mt,cXe as mu,vXe as mv,jhe as mw,Yhe as mx,Qhe as my,Xhe as mz,Ry as n,Ky as n$,zOe as n0,KOe as n1,Q5 as n2,Z5 as n3,j5 as n4,X5 as n5,J5 as n6,Y5 as n7,t7 as n8,e7 as n9,OOe as nA,SZ as nB,wZ as nC,CZ as nD,lr as nE,II as nF,Lm as nG,Sz as nH,_J as nI,$ue as nJ,QWe as nK,XWe as nL,Us as nM,TA as nN,pp as nO,GJe as nP,Hx as nQ,qJe as nR,rWe as nS,mm as nT,Wi as nU,Zs as nV,Uu as nW,UJe as nX,nWe as nY,sWe as nZ,zJe as n_,i7 as na,s7 as nb,iS as nc,ghe as nd,COe as ne,lhe as nf,hhe as ng,phe as nh,IOe as ni,POe as nj,f4 as nk,LOe as nl,NOe as nm,GOe as nn,qOe as no,yZ as np,AOe as nq,DOe as nr,mhe as ns,o7 as nt,vOe as nu,EOe as nv,uhe as nw,FOe as nx,WOe as ny,fhe as nz,vTe as o,KJe as o0,XJe as o1,QJe as o2,ZJe as o3,JJe as o4,eet as o5,net as o6,iet as o7,tet as o8,SJ as o9,dWe as oa,t$ as ob,XL as oc,QL as od,det as oe,EJ as of,Un as og,v2e as oh,_2e as oi,rF as oj,Vy as ok,AU as ol,Qi as om,RZ as on,$Re as oo,wg as op,CM as oq,bJ as or,Uh as os,cZe as ot,iB as ou,Qce as ov,Wt as ow,E6e as ox,C6e as oy,Ud as oz,Tn as p,Dy as q,B9e as r,Jj as s,aEe as t,JA as u,SEe as v,Sot as w,VY as x,L5e as y,OY as z};

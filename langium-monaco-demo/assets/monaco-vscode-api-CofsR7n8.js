import{A as fr,l0 as Zx,V as Le,S as ae,l1 as vz,fB as Si,g as O,_ as f,jL as Nt,ec as Pn,l2 as Mie,l3 as td,ff as ec,W as Tt,aa as ur,U as R,l4 as Gfe,dX as rs,c$ as Gi,ip as Nie,br as In,kX as fw,l5 as Dn,f8 as R6,l6 as vs,T as ra,l7 as Oie,l as h,c as J,R as Ke,a5 as M,l8 as yF,o as p,q as je,h as U,E as T,l9 as zfe,la as qfe,an as hh,iN as H,k1 as ss,gM as ye,jw as et,lb as tt,lc as P6,ld as kr,le as PT,lf as Fie,lg as LM,lh as MD,li as yr,lj as Kfe,hU as wE,gF as po,lk as L6,hT as LT,ll as Sk,lm as _z,ln as M6,lo as oy,lp as Wie,lq as jfe,hR as Bie,lr as Ck,ls as G,lt as z,lu as Yfe,lv as tc,aK as lc,t as Ie,lw as Ye,w as $t,bW as Vie,lx as wF,ly as Qfe,lz as Xfe,D as F,cx as mc,lA as Jx,df as he,e0 as gt,lB as Q0,lC as Ib,ac as dr,lD as Zfe,cr as Rp,aP as Re,d6 as it,$ as ne,cX as Tr,lE as Jfe,bA as wn,a0 as It,bB as ei,p as fe,aO as Ce,cV as gl,I as Z,a6 as ic,ae as Pp,da as I,iD as Pe,bw as K,cH as x,lF as Dm,bc as de,h4 as pt,lG as eme,j as At,fp as Qi,aU as bz,lH as Db,lI as Cu,iQ as tme,iK as xr,iT as yz,jE as Xn,kU as vc,il as ai,hQ as Ne,s as ci,bN as zm,C as li,B as As,jD as Ln,dp as P,cT as we,fC as sf,lJ as MT,cz as yn,ak as Hie,lK as MM,lL as NM,jK as Ee,kT as yt,dU as Uie,aV as zi,bD as Bt,e1 as Ge,bo as Dt,b2 as Nr,fh as ds,lM as Vu,fQ as Ve,lN as qm,fv as wh,hH as Zt,ex as L,ja as $_,jb as St,jc as Bd,lO as ime,lP as N6,lQ as OM,hu as ki,eq as Lt,er as _t,h7 as j,eO as No,lR as ee,ie as Ar,ia as Xt,ih as ke,ib as xa,is as mw,lS as Xi,lT as Qo,lU as Qs,bV as FM,hB as nme,lV as NT,bk as wz,bT as Bn,H as Yt,fn as S,bn as fo,aF as SE,aJ as Xe,k as Qe,bt as mt,lW as sme,eS as Ia,dm as Ci,he as He,bb as ui,lX as vw,lY as Sz,lZ as $ie,l_ as Gie,m as _s,l$ as ome,m0 as CE,m1 as SF,m2 as Ds,m3 as OT,m4 as ry,b0 as WM,m5 as EE,m6 as Zd,m7 as Cz,jF as Tn,fw as Me,jJ as lt,fj as W,fm as E,fl as V,cg as rme,m8 as Ei,m9 as of,ma as zie,mb as qie,aZ as Pt,mc as na,md as Ez,me as Kie,mf as Hu,ci as re,cj as pe,kx as mi,fu as Vo,fk as ze,f2 as eI,mg as Or,mh as xz,jZ as ge,d9 as N,mi as Fr,js as Uu,bm as Sh,mj as ame,d7 as Y,c8 as Eu,ik as bi,mk as jie,im as wr,iq as os,b as Fe,eM as Bs,ml as FT,mm as Lp,mn as Yie,kV as An,dq as qi,mo as Ph,mp as Iz,ez as BM,jz as ns,mq as cme,hp as Qf,mr as O6,ms as dme,mt as lme,mu as hme,mv as ume,mw as gme,mx as pme,my as rf,bX as af,mz as VM,d$ as $u,eR as vt,mA as G_,mB as Rv,mC as fme,et as Et,mD as Dz,d8 as X,cl as Fo,dx as Wo,mE as CF,aW as ya,mF as mme,mG as vme,mH as _me,cw as Ti,mI as bme,mJ as HM,mK as yme,aR as kb,mL as wme,mM as tI,bq as nn,ba as Ps,bp as dg,bi as _c,c4 as Vn,bz as wd,mN as Sme,bU as Hs,e9 as Cme,mO as UM,mP as Qie,a4 as Lh,mQ as Eme,mR as xme,bh as Us,b9 as lg,bE as Pv,bC as to,dP as Xie,mS as kz,mT as Zie,mU as Jie,mV as Tz,mW as $M,mX as ene,mY as Ime,mZ as Az,m_ as Dme,m$ as kme,cs as Qa,n0 as Tme,aS as Ct,n1 as Ame,bH as Mp,dh as iI,iB as GM,ha as si,be as Da,n2 as oo,n3 as gn,i5 as Hi,iA as gs,i2 as ve,a1 as aa,n4 as WT,n5 as tne,n6 as ay,n7 as pu,ho as sd,n8 as BT,n9 as kt,na as De,ed as jc,nb as ND,nc as F6,nd as Rme,ne as EF,nf as ba,ng as VT,nh as sh,gv as hs,hk as OD,bf as Xo,jG as b_,du as HT,gf as wa,ni as jo,gB as _w,G as bn,nj as Tb,nk as Np,nl as ine,y as up,nm as xF,nn as nne,no as Pme,O as zM,bG as Km,np as Lme,nq as Mme,Z as us,bI as cy,cZ as Po,cR as Yc,kW as Nme,nr as xE,dT as Ek,af as Ome,a as jt,ns as IF,nt as Fme,nu as Wme,nv as Bme,nw as jm,Y as Zo,ei as dy,nx as Vme,bg as ys,a8 as Ab,ny as DF,ee as st,h0 as Gt,fd as UT,nz as sne,nA as od,nB as Hme,nC as kF,nD as ja,a3 as Js,nE as xk,nF as one,nG as Op,nH as Ume,nI as Ik,cG as Sr,nJ as Ll,nK as rne,nL as $me,nM as Dk,nN as ane,nO as uh,bs as bo,nP as Gme,nQ as zme,nR as qme,nS as cne,dy as Lv,bM as Kt,e3 as W6,cp as qM,nT as Kme,cL as TF,cM as jme,e7 as hC,dO as IE,nU as bw,dl as B6,nV as Yme,nW as nu,bK as Gu,nX as AF,nY as cf,nZ as Qme,n_ as Xme,ix as nc,n$ as Zme,o0 as Jme,o1 as $T,o2 as dne,o3 as gh,a9 as V6,F as uC,o4 as SS,o5 as Xa,o6 as eve,o7 as tve,o8 as gC,o9 as kk,oa as ive,ob as Rz,oc as nve,bl as lne,cy as df,od as Fn,oe as Xh,as as Xf,z as Kn,d1 as Ym,dn as sve,of as ove,og as rve,L as an,oh as ave,cO as Rb,oi as pC,oj as cve,ok as dve,a$ as lve,ol as hve,om as uve,on as Pz,b8 as ir,oo as gve,op as pve,oq as qo,or as fve,os as GT,ot as mve,ou as yw,ov as hne,ow as sc,hs as ti,ox as une,oy as zT,c0 as ca,oz as gne,oA as pne,oB as RF,k2 as zu,oC as KM,ft as Lz,iW as Vs,d5 as Wt,bj as pl,oD as fC,iE as Mv,oE as dt,iZ as en,hc as fi,ij as fn,oF as Qm,oG as nI,oH as vve,it as Xm,hY as kn,iz as ka,oI as Gc,oJ as Nv,oK as _ve,oL as H6,fR as qu,oM as fne,oN as z_,oO as bve,oP as $a,oQ as yve,oR as Ir,r as vi,oS as DE,oT as Os,hw as rd,i$ as fl,cu as wve,jn as PF,oU as Sve,oV as Cve,oW as Ov,gV as sI,eN as mne,oX as Tk,oY as U6,oZ as lf,fP as tn,gy as Eve,o_ as qT,fX as LF,o$ as xve,jH as ue,jM as Se,p0 as Ive,p1 as vne,p2 as Vi,p3 as _ne,p4 as Dve,p5 as hf,M as jM,eo as lo,fi as Ch,p6 as kve,bF as $6,P as KT,dr as at,p7 as Tve,p8 as bne,p9 as Mz,pa as Ave,pb as OS,pc as Rve,pd as Pve,hl as Lve,eV as Mve,pe as jT,pf as Nve,pg as Zn,iH as oI,ph as Nz,pi as Pi,pj as YT,pk as Ove,pl as yne,pm as Fve,pn as wne,po as Sne,pp as Wve,pq as MF,i6 as Oz,pr as Cne,e$ as ly,fo as zc,hn as G6,ps as dm,pt as Ak,n as YM,pu as Ene,jk as hg,id as Zm,ii as Eh,pv as QM,ig as mC,fE as vo,cC as xne,X as Ht,f1 as Bve,io as xh,fJ as kE,pw as Vve,cm as Fp,N as XM,px as Hve,py as Uve,pz as $ve,pA as Gve,pB as zve,pC as qve,pD as Kve,aQ as ph,hO as TE,fS as Fv,pE as jve,pF as NF,pG as Ine,jx as Dne,pH as Yve,pI as Qve,b_ as Ya,pJ as QT,b$ as Bc,d3 as zo,f3 as Ih,pK as X0,d as Ri,el as kne,pL as qc,pM as Xve,pN as OF,pO as Zve,pP as Jve,pQ as Fz,eL as bs,pR as rI,pS as $e,pT as ad,pU as aI,pV as e_e,v as Tne,b3 as Ane,by as Wz,jp as Rne,h6 as t_e,K as XT,pW as i_e,J as fh,pX as Z0,pY as Bz,pZ as n_e,p_ as z6,p$ as ww,eG as Vz,q0 as s_e,q1 as o_e,q2 as Pne,q3 as AE,k_ as r_e,q4 as Lne,q5 as q6,aB as a_e,q6 as RE,q7 as ZT,q8 as c_e,q9 as d_e,qa as l_e,qb as Hz,qc as K6,aD as h_e,qd as u_e,u as g_e,qe as Sw,qf as p_e,qg as Uz,qh as $z,qi as Mne,qj as f_e,dd as Gz,c9 as Ku,h8 as qd,qk as m_e,ch as km,hP as Wp,fF as Ko,fM as Dh,fN as Yo,eF as ZM,ql as JM,qm as v_e,dB as ju,qn as JT,qo as Nne,qp as eN,qq as zz,hN as uf,qr as __e,qs as hy,qt as b_e,qu as One,qv as Fne,qw as qz,qx as eA,hD as cd,qy as y_e,qz as tA,jo as gf,iI as kh,qA as Kz,qB as lm,qC as w_e,qD as tN,qE as S_e,cq as Wne,qF as C_e,qG as Bne,eQ as iN,qH as E_e,qI as j6,qJ as x_e,qK as Vne,qL as Hne,qM as FF,dS as Yu,qN as I_e,qO as Une,qP as $ne,qQ as Pb,qR as op,qS as D_e,qT as Gne,qU as k_e,es as PE,qV as WF,eJ as T_e,qW as A_e,qX as R_e,qY as zne,qZ as BF,aG as Y6,q_ as qne,q$ as VF,r0 as Q6,r1 as q_,r2 as Qr,r3 as hm,r4 as HF,r5 as P_e,r6 as Wv,r7 as Kne,ic as L_e,r8 as M_e,r9 as FD,ra as N_e,rb as O_e,rc as WD,rd as um,re as F_e,rf as W_e,rg as B_e,rh as V_e,ri as H_e,rj as U_e,rk as $_e,rl as G_e,rm as z_e,rn as q_e,ro as K_e,rp as j_e,rq as Y_e,rr as jne,rs as X6,rt as Q_e,fA as UF,ru as X_e,rv as Z_e,rw as Yne,rx as Qne,ry as J_e,rz as nN,rA as Z6,ey as cI,rB as Xne,rC as jz,rD as ebe,rE as J6,rF as tbe,aX as ibe,rG as nbe,ap as fa,rH as sbe,gT as obe,i8 as Li,rI as J0,i0 as Yl,rJ as rbe,rK as $F,rL as abe,iC as oc,rM as dI,rN as sN,rO as Zne,i3 as Kd,fY as Jne,rP as LE,i4 as cbe,i_ as dbe,rQ as e1,iy as lbe,rR as hbe,rS as Yz,rT as ube,rU as ese,rV as gbe,jt as pbe,ju as iA,iY as tse,iw as fbe,gN as mbe,rW as e8,rX as vbe,rY as GF,rZ as vC,am as _be,x as bbe,aj as ybe,r_ as Qz,r$ as wbe,s0 as zF,s1 as Sbe,a_ as Cbe,s2 as t1,s3 as Ebe,s4 as xbe,s5 as oN,hZ as i1,s6 as Rk,s7 as Ibe,s8 as Dbe,e5 as kbe,s9 as Tbe,sa as t8,sb as i8,sc as dd,sd as Abe,se as ise,sf as nse,sg as sse,sh as ose,si as Rbe,sj as n8,sk as il,sl as s8,sm as Pbe,sn as Qc,iF as lI,so as n1,sp as Lbe,jC as Mbe,sq as rse,hj as Nbe,sr as Obe,jm as hc,ss as ps,hd as uy,st as Fbe,su as Wbe,iG as Pk,sv as Sa,sw as Bp,sx as nA,sy as ase,sz as Bbe,sA as Vbe,sB as K_,fD as Xz,sC as Hbe,sD as Ube,sE as $be,sF as Gbe,sG as CS,sH as ES,sI as o8,sJ as zbe,hx as qbe,sK as Kbe,h_ as cse,sL as dse,sM as r8,h$ as a8,eW as qF,f0 as jbe,k4 as Ybe,ky as Qbe,fg as Cw,i9 as sA,eY as lse,eU as Xbe,eT as hse,eB as Zbe,ew as use,fO as gse,iJ as Jbe,j8 as gm,j5 as j_,sN as BD,sO as Zz,sP as eye,sQ as tye,iu as iye,sR as c8,hv as nye,sS as sye,sT as oye,jq as gy,sU as rye,sV as aye,sW as pse,sX as cye,sY as d8,hb as _C,sZ as dye,s_ as rN,s$ as lye,t0 as KF,t1 as l8,t2 as h8,t3 as hye,jl as jF,t4 as uye,t5 as u8,hE as gye,fW as pye,t6 as fye,t7 as mye,t8 as oA,dz as rc,dA as ac,t9 as vye,ta as _ye,tb as cr,tc as bye,td as yye,te as wye,tf as Sye,tg as Cye,th as Eye,f as xye,jB as fse,ti as hI,bd as Iye,aw as VD,aA as Dye,i as kye,ax as Tye,tj as HD,tk as Aye,tl as Rye,tm as Pye,tn as Lye,to as Mye,tp as Cn,tq as mse,tr as vse,eX as Lb,cE as Bv,ts as Nye,tt as _se,tu as bse,tv as YF,tw as Oye,tx as Fye,ty as yse,gK as Jm,tz as g8,tA as Wye,tB as Bye,tC as Vye,tD as Hye,tE as wse,tF as Sse,tG as Uye,tH as p8,tI as Cse,tJ as $ye,eD as Ese,tK as Gye,tL as zye,tM as qye,tN as xse,tO as Ise,tP as Dse,tQ as Kye,tR as uI,tS as jye,tT as Jz,tU as Yye,tV as Qye,tW as Xye,ep as Zye,tX as f8,f5 as Jye,eh as kse,tY as ewe,f6 as twe,tZ as eq,t_ as Tse,t$ as aN,u0 as iwe,u1 as rA,u2 as gp,u3 as nwe,u4 as QF,u5 as swe,gL as m8,u6 as Ase,fb as v8,u7 as s1,u8 as Rse,u9 as Qu,ua as pm,ub as Pse,uc as _8,c7 as cN,fe as Vv,ud as owe,ue as rwe,uf as aA,ug as tq,uh as zg,ui as Lse,uj as Mse,uk as awe,ul as cwe,um as dwe,un as b8,uo as y8,up as lwe,uq as dN,ur as hwe,us as uwe,ut as gwe,uu as pwe,uv as w8,uw as fwe,ux as mwe,uy as vwe,uz as _we,uA as bwe,uB as XF,uC as ywe,uD as ev,uE as wwe,uF as Swe,uG as Cwe,uH as Ewe,k$ as xwe,uI as Nse,eb as Iwe,uJ as Dwe,cF as kwe,uK as Twe,ir as Awe,uL as S8,uM as C8,uN as E8,uO as Zf,uP as o1,bY as Ose,uQ as Rwe,uR as Pwe,uS as Lwe,uT as bC,uU as Mwe,cd as Nwe,uV as Owe,ca as Fwe,c3 as Mb,uW as Wwe,bZ as Bwe,uX as Rg,uY as Vwe,fI as Hwe,ck as Uwe,uZ as $we,u_ as Gwe,u$ as zwe,v0 as qwe,v1 as Kwe,v2 as jwe,v3 as Ywe,v4 as Qwe,cn as Xwe,v5 as Zwe,eu as x8,c2 as Jwe,v6 as eSe,v7 as tSe,v8 as r1,v9 as iSe,e8 as nSe,va as sSe,vb as I8,vc as oSe,vd as rSe,ve as aSe}from"./monaco-vscode-base-service-override-BYqBQsid.js";import{I as Sd,C as gI,o as Rs,E as tv,a as fs,D as Fse,S as py,L as cSe,b as dSe,c as lSe,d as hSe,e as iq,f as uSe,g as lN,W as nq,P as Wse,h as Ws,A as Vp,i as hN,j as Bse,k as Xu,M as Y_,H as Lk,l as gSe,m as Vse,w as Mk,n as pSe,R as fSe,T as mSe,p as Hse,q as ME,r as fy,s as Use,t as $se,u as Nb,v as fu,x as vSe,y as _Se,z as bSe,B as ySe,F as sq,G as wSe,J as SSe,K as CSe,N as uN,O as gN,Q as pN,U as Nk,V as ESe,X as D8,Y as Ok,Z as ZF,_ as xSe,$ as k8,a0 as fN,a1 as xu,a2 as JF,a3 as ISe,a4 as T8,a5 as Gse,a6 as DSe,a7 as kSe,a8 as a1,a9 as pI,aa as TSe,ab as ASe,ac as A8,ad as zse,ae as NE,af as RSe,ag as PSe,ah as UD,ai as LSe,aj as MSe,ak as NSe,al as my,am as yC,an as qse,ao as Kse,ap as oq,aq as $D,ar as c1,as as OSe,at as FSe,au as jse,av as WSe,aw as Yse,ax as Qse,ay as Xse,az as Nn,aA as fI,aB as BSe,aC as mN,aD as VSe,aE as HSe,aF as Zse}from"./monaco-vscode-editor-api-CVotD80_.js";import{I as cn,a as rq,b as Jse,i as mo,c as Zu,d as cA,g as mI,C as Fi,M as xi,e as da,f as xe,h as Hn,j as eoe,k as Mh,l as Hv,m as Uv,N as USe,n as toe,o as uc,p as aq,q as cq,r as ioe,s as Nh,t as noe,u as soe,v as $Se,w as b,G as cc,x as GSe,S as gi,D as id,y as vN,E as Ew,z as zSe,A as ooe,B as dA,F as qSe,H as KSe,J as dl,K as Je,V as Ot,L as Ql,W as OE,P as jSe,Q as bc,T as oi,U as dq,X as lA,Y as Hp,Z as _N,_ as Ii,$ as YSe,R as hi,a0 as $v,a1 as roe,a2 as eW,a3 as Ob,a4 as aoe,a5 as Jo,a6 as Di,a7 as qt,a8 as Q_,a9 as d1,aa as FS,ab as wC,ac as SC,ad as QSe,ae as iv,af as XSe,ag as R8,ah as X_,ai as jd,aj as xS,ak as Gv,al as ZSe,am as lq,an as JSe,ao as coe,ap as zv,aq as tW,ar as Fb,as as doe,at as P8,au as iW,av as Za,aw as Jt,ax as hq,ay as bN,az as uq,aA as eCe,aB as hA,aC as uA,aD as CC,aE as mu,aF as tCe,aG as ld,aH as Iu,aI as vI,aJ as yN,aK as loe,aL as iCe,aM as Fk,aN as nCe,aO as hoe,aP as gA,aQ as Yn,aR as xw,aS as ml,aT as vl,aU as wN,aV as pA,aW as SN,aX as WS,aY as uoe,aZ as Tm,a_ as pp,a$ as yi,b0 as ot,b1 as _I,b2 as _l,b3 as FE,b4 as sCe,b5 as ct,b6 as EC,b7 as goe,b8 as poe,b9 as foe,ba as moe,bb as gq,bc as pq,bd as oCe,be as rCe,bf as voe,bg as _oe,bh as boe,bi as aCe,bj as yoe,bk as cCe,bl as woe,bm as WE,bn as dCe,bo as Ra,bp as yo,bq as bI,br as fq,bs as mq,bt as Cd,bu as Oh,bv as yI,bw as Soe,bx as vq,by as Coe,bz as Eoe,bA as lCe,bB as wI,bC as CN,bD as xoe,bE as Ioe,bF as hCe,bG as uCe,bH as gCe,bI as pCe,bJ as fCe,bK as mCe,bL as vCe,bM as ll,O as SI,bN as Doe,bO as _Ce,bP as bCe,bQ as L8,bR as M8,bS as nl,bT as _o,bU as yCe,bV as N8,bW as wCe,bX as er,bY as EN,bZ as oh,b_ as SCe,b$ as rp,c0 as Z_,c1 as nv,c2 as fA,c3 as koe,c4 as CCe,c5 as hd,c6 as vy,c7 as Wk,c8 as nW,c9 as ECe,ca as GD,cb as l1,cc as xCe,cd as ICe,ce as DCe,cf as kCe,cg as TCe}from"./monaco-vscode-configuration-service-override-C_9dpF2l.js";var _y;(function(s){s[s.WebSocket=0]="WebSocket",s[s.Managed=1]="Managed"})(_y||(_y={}));class ACe{constructor(e){this.id=e,this.type=_y.Managed}toString(){return`Managed(${this.id})`}}class RCe{constructor(e,t){this.host=e,this.port=t,this.type=_y.WebSocket}toString(){return`WebSocket(${this.host}:${this.port})`}}var mr;(function(s){s.Unknown="Unknown",s.NotAvailable="NotAvailable",s.TemporarilyNotAvailable="TemporarilyNotAvailable",s.NoResolverFound="NoResolverFound",s.InvalidAuthority="InvalidAuthority"})(mr||(mr={}));let fp=class Hf extends fr{static isNotAvailable(e){return e instanceof Hf&&e._code===mr.NotAvailable}static isTemporarilyNotAvailable(e){return e instanceof Hf&&e._code===mr.TemporarilyNotAvailable}static isNoResolverFound(e){return e instanceof Hf&&e._code===mr.NoResolverFound}static isInvalidAuthority(e){return e instanceof Hf&&e._code===mr.InvalidAuthority}static isHandled(e){return e instanceof Hf&&e.isHandled}constructor(e,t=mr.Unknown,i){super(e),this._message=e,this._code=t,this._detail=i,this.isHandled=t===mr.NotAvailable&&i===!0,Object.setPrototypeOf(this,Hf.prototype)}};function Toe(s){const e=s.indexOf("+");return e===-1?s:s.substring(0,e)}const sW=["W","X","Y","Z","a","b","c","d","e","f"],PCe=new RegExp(`^[${sW.join("")}]+`),Aoe=7;function Roe(s){if(s.scheme!==ae.vscodeNotebookCell)return;const e=s.fragment.indexOf("s");if(e<0)return;const t=parseInt(s.fragment.substring(0,e).replace(PCe,""),Aoe),i=vz(s.fragment.substring(e+1)).toString();if(!isNaN(t))return{handle:t,notebook:s.with({scheme:i,fragment:null})}}function LCe(s,e){const t=e.toString(Aoe),n=`${t.length<sW.length?sW[t.length-1]:"z"}${t}s${Zx(Le.fromString(s.scheme),!0,!0)}`;return s.with({scheme:ae.vscodeNotebookCell,fragment:n})}function MCe(s){if(s.scheme!==ae.vscodeNotebookMetadata)return;const e=vz(s.fragment).toString();return s.with({scheme:e,fragment:null})}function NCe(s){const e=`${Zx(Le.fromString(s.scheme),!0,!0)}`;return s.with({scheme:ae.vscodeNotebookMetadata,fragment:e})}function Poe(s){if(s.scheme!==ae.vscodeNotebookCellOutput)return;const e=new URLSearchParams(s.query),t=e.get("openIn");if(!t)return;const i=e.get("outputId")??void 0,n=Roe(s.with({scheme:ae.vscodeNotebookCell,query:null})),o=e.get("outputIndex")?parseInt(e.get("outputIndex")||"",10):void 0,r=n?n.notebook:s.with({scheme:e.get("notebookScheme")||ae.file,fragment:null,query:null}),a=e.get("cellIndex")?parseInt(e.get("cellIndex")||"",10):void 0;return{notebook:r,openIn:t,outputId:i,outputIndex:o,cellHandle:n?.handle,cellFragment:s.fragment,cellIndex:a}}const Loe="workbench.editor.notebook",OCe="workbench.editor.notebookTextDiffEditor",FCe="workbench.editor.interactive",WCe="workbench.editor.repl";var ap;(function(s){s[s.Markup=1]="Markup",s[s.Code=2]="Code"})(ap||(ap={}));Si.latex,Si.markdown,Si.text;Si.latex,Si.markdown,Si.text;var O8;(function(s){s[s.Running=1]="Running",s[s.Idle=2]="Idle"})(O8||(O8={}));var xC;(function(s){s[s.Unconfirmed=1]="Unconfirmed",s[s.Pending=2]="Pending",s[s.Executing=3]="Executing"})(xC||(xC={}));var F8;(function(s){s[s.Unconfirmed=1]="Unconfirmed",s[s.Pending=2]="Pending",s[s.Executing=3]="Executing"})(F8||(F8={}));var W8;(function(s){s[s.WithHardKernelDependency=0]="WithHardKernelDependency",s[s.WithOptionalKernelDependency=1]="WithOptionalKernelDependency",s[s.Pure=2]="Pure",s[s.Never=3]="Never"})(W8||(W8={}));var B8;(function(s){s.Always="always",s.Never="never",s.Optional="optional"})(B8||(B8={}));var Nc;(function(s){s[s.ModelChange=1]="ModelChange",s[s.Move=2]="Move",s[s.ChangeCellLanguage=5]="ChangeCellLanguage",s[s.Initialize=6]="Initialize",s[s.ChangeCellMetadata=7]="ChangeCellMetadata",s[s.Output=8]="Output",s[s.OutputItem=9]="OutputItem",s[s.ChangeCellContent=10]="ChangeCellContent",s[s.ChangeDocumentMetadata=11]="ChangeDocumentMetadata",s[s.ChangeCellInternalMetadata=12]="ChangeCellInternalMetadata",s[s.ChangeCellMime=13]="ChangeCellMime",s[s.Unknown=100]="Unknown"})(Nc||(Nc={}));var oW;(function(s){s[s.Handle=0]="Handle",s[s.Index=1]="Index"})(oW||(oW={}));var sl;(function(s){s[s.Replace=1]="Replace",s[s.Output=2]="Output",s[s.Metadata=3]="Metadata",s[s.CellLanguage=4]="CellLanguage",s[s.DocumentMetadata=5]="DocumentMetadata",s[s.Move=6]="Move",s[s.OutputItems=7]="OutputItems",s[s.PartialMetadata=8]="PartialMetadata",s[s.PartialInternalMetadata=9]="PartialInternalMetadata"})(sl||(sl={}));var V8;(function(s){s.scheme=ae.vscodeNotebookMetadata;function e(i){return NCe(i)}s.generate=e;function t(i){return MCe(i)}s.parse=t})(V8||(V8={}));var ud;(function(s){s.scheme=ae.vscodeNotebookCell;function e(d,l){return LCe(d,l)}s.generate=e;function t(d){return Roe(d)}s.parse=t;function i(d,l){return d.with({scheme:ae.vscodeNotebookCellOutput,query:new URLSearchParams({openIn:"editor",outputId:l??"",notebookScheme:d.scheme!==ae.file?d.scheme:""}).toString()})}s.generateCellOutputUriWithId=i;function n(d,l,u){return d.with({scheme:ae.vscodeNotebookCellOutput,fragment:l.fragment,query:new URLSearchParams({openIn:"notebook",outputIndex:String(u)}).toString()})}s.generateCellOutputUriWithIndex=n;function o(d,l,u,g,m){return d.with({scheme:ae.vscodeNotebookCellOutput,query:new URLSearchParams({openIn:"notebookOutputEditor",notebook:d.toString(),cellIndex:String(u),outputId:g,outputIndex:String(m)}).toString()})}s.generateOutputEditorUri=o;function r(d){return Poe(d)}s.parseCellOutputUri=r;function a(d,l,u){return s.generate(d,l).with({scheme:u})}s.generateCellPropertyUri=a;function c(d,l){if(d.scheme===l)return s.parse(d.with({scheme:s.scheme}))}s.parseCellPropertyUri=c})(ud||(ud={}));new O("notebookEditorCursorAtBoundary","none");new O("notebookEditorCursorAtLineBoundary","none");var H8;(function(s){s.default="default",s.option="option"})(H8||(H8={}));var U8;(function(s){s.Cells="cells",s.Text="text",s.None="none"})(U8||(U8={}));const Moe={remoteSaving:"notebook.experimental.remoteSave",InteractiveWindowPromptToSave:"interactiveWindow.promptToSaveOnClose"};var mA;(function(s){s[s.Left=1]="Left",s[s.Right=2]="Right"})(mA||(mA={}));function _q(s){return["application/vnd.code.notebook.stdout","application/vnd.code.notebook.stderr"].includes(s)}const BCe=new TextDecoder;function eKe(s){const e=[];let t=!1;for(const r of s)(e.length===0||t)&&(e.push(r),t=!0);let i=HCe(e);const n=Le.concat(e.map(r=>Le.wrap(r))),o=qCe(n);return i=i||o.byteLength!==n.byteLength,{data:o,didCompression:i}}const Bk="\x1B[A",h1=Bk.split("").map(s=>s.charCodeAt(0)),VCe=10;function HCe(s){let e=!1;return s.forEach((t,i)=>{if(i===0||t.length<Bk.length)return;const n=s[i-1],o=t.subarray(0,Bk.length);if(o[0]===h1[0]&&o[1]===h1[1]&&o[2]===h1[2]){const r=n.lastIndexOf(VCe);if(r===-1)return;e=!0,s[i-1]=n.subarray(0,r),s[i]=t.subarray(Bk.length)}}),e}function UCe(s){let e=s;do s=e,e=s.replace(/[^\n]\x08/gm,"");while(e.length<s.length);return s}function $Ce(s){for(s=s.replace(/\r+\n/gm,`
`);s.search(/\r[^$]/g)>-1;){const e=s.match(/^(.*)\r+/m)[1];let t=s.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),s=s.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return s}const GCe=8,zCe=13;function qCe(s){return!s.buffer.includes(GCe)&&!s.buffer.includes(zCe)?s:Le.fromString($Ce(UCe(BCe.decode(s.buffer))))}var rW,Uf,Jh,aW,$f,Ng,Gf,cW,dW,Vk,BS,lW,Ml,Nl,hW,zr,uW;function nt(s){return Object.assign(s,{apply:function(...t){if(t.length===0)return Reflect.construct(s,[]);{const i=t.length===1?[]:t[1];return Reflect.construct(s,i,t[0].constructor)}},call:function(...t){if(t.length===0)return Reflect.construct(s,[]);{const[i,...n]=t;return Reflect.construct(s,n,i.constructor)}}})}var $8;(function(s){s[s.Top=0]="Top",s[s.Bottom=1]="Bottom"})($8||($8={}));var G8;(function(s){s[s.TerminalCommand=0]="TerminalCommand",s[s.Opener=1]="Opener",s[s.Command=3]="Command"})(G8||(G8={}));let gW=rW=class{static from(...e){let t=e;return new rW(function(){if(t){for(const i of t)i&&typeof i.dispose=="function"&&i.dispose();t=void 0}})}#e;constructor(e){this.#e=e}dispose(){typeof this.#e=="function"&&(this.#e(),this.#e=void 0)}};gW=rW=f([nt],gW);let rn=Uf=class{static Min(...e){if(e.length===0)throw new TypeError;let t=e[0];for(let i=1;i<e.length;i++){const n=e[i];n.isBefore(t)&&(t=n)}return t}static Max(...e){if(e.length===0)throw new TypeError;let t=e[0];for(let i=1;i<e.length;i++){const n=e[i];n.isAfter(t)&&(t=n)}return t}static isPosition(e){if(!e)return!1;if(e instanceof Uf)return!0;const{line:t,character:i}=e;return typeof t=="number"&&typeof i=="number"}static of(e){if(e instanceof Uf)return e;if(this.isPosition(e))return new Uf(e.line,e.character);throw new Error("Invalid argument, is NOT a position-like object")}get line(){return this._line}get character(){return this._character}constructor(e,t){if(e<0)throw Nt("line must be non-negative");if(t<0)throw Nt("character must be non-negative");this._line=e,this._character=t}isBefore(e){return this._line<e._line?!0:e._line<this._line?!1:this._character<e._character}isBeforeOrEqual(e){return this._line<e._line?!0:e._line<this._line?!1:this._character<=e._character}isAfter(e){return!this.isBeforeOrEqual(e)}isAfterOrEqual(e){return!this.isBefore(e)}isEqual(e){return this._line===e._line&&this._character===e._character}compareTo(e){return this._line<e._line?-1:this._line>e.line?1:this._character<e._character?-1:this._character>e._character?1:0}translate(e,t=0){if(e===null||t===null)throw Nt();let i;return typeof e>"u"?i=0:typeof e=="number"?i=e:(i=typeof e.lineDelta=="number"?e.lineDelta:0,t=typeof e.characterDelta=="number"?e.characterDelta:0),i===0&&t===0?this:new Uf(this.line+i,this.character+t)}with(e,t=this.character){if(e===null||t===null)throw Nt();let i;return typeof e>"u"?i=this.line:typeof e=="number"?i=e:(i=typeof e.line=="number"?e.line:this.line,t=typeof e.character=="number"?e.character:this.character),i===this.line&&t===this.character?this:new Uf(i,t)}toJSON(){return{line:this.line,character:this.character}}[Symbol.for("debug.description")](){return`(${this.line}:${this.character})`}};rn=Uf=f([nt],rn);let ms=Jh=class{static isRange(e){return e instanceof Jh?!0:e?rn.isPosition(e.start)&&rn.isPosition(e.end):!1}static of(e){if(e instanceof Jh)return e;if(this.isRange(e))return new Jh(e.start,e.end);throw new Error("Invalid argument, is NOT a range-like object")}get start(){return this._start}get end(){return this._end}constructor(e,t,i,n){let o,r;if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"?(o=new rn(e,t),r=new rn(i,n)):rn.isPosition(e)&&rn.isPosition(t)&&(o=rn.of(e),r=rn.of(t)),!o||!r)throw new Error("Invalid arguments");o.isBefore(r)?(this._start=o,this._end=r):(this._start=r,this._end=o)}contains(e){return Jh.isRange(e)?this.contains(e.start)&&this.contains(e.end):rn.isPosition(e)?!(rn.of(e).isBefore(this._start)||this._end.isBefore(e)):!1}isEqual(e){return this._start.isEqual(e._start)&&this._end.isEqual(e._end)}intersection(e){const t=rn.Max(e.start,this._start),i=rn.Min(e.end,this._end);if(!t.isAfter(i))return new Jh(t,i)}union(e){if(this.contains(e))return this;if(e.contains(this))return e;const t=rn.Min(e.start,this._start),i=rn.Max(e.end,this.end);return new Jh(t,i)}get isEmpty(){return this._start.isEqual(this._end)}get isSingleLine(){return this._start.line===this._end.line}with(e,t=this.end){if(e===null||t===null)throw Nt();let i;return e?rn.isPosition(e)?i=e:(i=e.start||this.start,t=e.end||this.end):i=this.start,i.isEqual(this._start)&&t.isEqual(this.end)?this:new Jh(i,t)}toJSON(){return[this.start,this.end]}[Symbol.for("debug.description")](){return Noe(this)}};ms=Jh=f([nt],ms);let pW=aW=class extends ms{static isSelection(e){return e instanceof aW?!0:e?ms.isRange(e)&&rn.isPosition(e.anchor)&&rn.isPosition(e.active)&&typeof e.isReversed=="boolean":!1}get anchor(){return this._anchor}get active(){return this._active}constructor(e,t,i,n){let o,r;if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"?(o=new rn(e,t),r=new rn(i,n)):rn.isPosition(e)&&rn.isPosition(t)&&(o=rn.of(e),r=rn.of(t)),!o||!r)throw new Error("Invalid arguments");super(o,r),this._anchor=o,this._active=r}get isReversed(){return this._anchor===this._end}toJSON(){return{start:this.start,end:this.end,active:this.active,anchor:this.anchor}}[Symbol.for("debug.description")](){return KCe(this)}};pW=aW=f([nt],pW);function Noe(s){return s.isEmpty?`[${s.start.line}:${s.start.character})`:`[${s.start.line}:${s.start.character} -> ${s.end.line}:${s.end.character})`}function KCe(s){let e=Noe(s);return s.isEmpty||(s.active.isEqual(s.start)?e=`|${e}`:e=`${e}|`),e}const Ooe=s=>{if(typeof s!="string"||s.length===0||!/^[0-9A-Za-z_\-]+$/.test(s))throw Nt("connectionToken")};class oKe{static isResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.host=="string"&&typeof e.port=="number"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t,i){if(typeof e!="string"||e.length===0)throw Nt("host");if(typeof t!="number"||t===0||Math.round(t)!==t)throw Nt("port");typeof i<"u"&&Ooe(i),this.host=e,this.port=Math.round(t),this.connectionToken=i}}class rKe{static isManagedResolvedAuthority(e){return e&&typeof e=="object"&&typeof e.makeConnection=="function"&&(e.connectionToken===void 0||typeof e.connectionToken=="string")}constructor(e,t){this.makeConnection=e,this.connectionToken=t,typeof t<"u"&&Ooe(t)}}class Hk extends Error{static NotAvailable(e,t){return new Hk(e,mr.NotAvailable,t)}static TemporarilyNotAvailable(e){return new Hk(e,mr.TemporarilyNotAvailable)}constructor(e,t=mr.Unknown,i){super(e),this._message=e,this._code=t,this._detail=i,Object.setPrototypeOf(this,Hk.prototype)}}var J_;(function(s){s[s.LF=1]="LF",s[s.CRLF=2]="CRLF"})(J_||(J_={}));var z8;(function(s){s[s.Replace=1]="Replace",s[s.Append=2]="Append",s[s.Prepend=3]="Prepend"})(z8||(z8={}));let by=$f=class{static isTextEdit(e){return e instanceof $f?!0:e?ms.isRange(e)&&typeof e.newText=="string":!1}static replace(e,t){return new $f(e,t)}static insert(e,t){return $f.replace(new ms(e,e),t)}static delete(e){return $f.replace(e,"")}static setEndOfLine(e){const t=new $f(new ms(new rn(0,0),new rn(0,0)),"");return t.newEol=e,t}get range(){return this._range}set range(e){if(e&&!ms.isRange(e))throw Nt("range");this._range=e}get newText(){return this._newText||""}set newText(e){if(e&&typeof e!="string")throw Nt("newText");this._newText=e}get newEol(){return this._newEol}set newEol(e){if(e&&typeof e!="number")throw Nt("newEol");this._newEol=e}constructor(e,t){this._range=e,this._newText=t}toJSON(){return{range:this.range,newText:this.newText,newEol:this._newEol}}};by=$f=f([nt],by);let fW=Ng=class{static isNotebookCellEdit(e){return e instanceof Ng?!0:e?VS.isNotebookRange(e)&&Array.isArray(e.newCells):!1}static replaceCells(e,t){return new Ng(e,t)}static insertCells(e,t){return new Ng(new VS(e,e),t)}static deleteCells(e){return new Ng(e,[])}static updateCellMetadata(e,t){const i=new Ng(new VS(e,e),[]);return i.newCellMetadata=t,i}static updateNotebookMetadata(e){const t=new Ng(new VS(0,0),[]);return t.newNotebookMetadata=e,t}constructor(e,t){this.range=e,this.newCells=t}};fW=Ng=f([nt],fW);class Wb{static isSnippetTextEdit(e){return e instanceof Wb?!0:e?ms.isRange(e.range)&&BE.isSnippetString(e.snippet):!1}static replace(e,t){return new Wb(e,t)}static insert(e,t){return Wb.replace(new ms(e,e),t)}constructor(e,t){this.range=e,this.snippet=t}}var ts;(function(s){s[s.File=1]="File",s[s.Text=2]="Text",s[s.Cell=3]="Cell",s[s.CellReplace=5]="CellReplace",s[s.Snippet=6]="Snippet"})(ts||(ts={}));let vA=class{constructor(){this._edits=[]}_allEntries(){return this._edits}renameFile(e,t,i,n){this._edits.push({_type:ts.File,from:e,to:t,options:i,metadata:n})}createFile(e,t,i){this._edits.push({_type:ts.File,from:void 0,to:e,options:t,metadata:i})}deleteFile(e,t,i){this._edits.push({_type:ts.File,from:e,to:void 0,options:t,metadata:i})}replaceNotebookMetadata(e,t,i){this._edits.push({_type:ts.Cell,metadata:i,uri:e,edit:{editType:sl.DocumentMetadata,metadata:t}})}replaceNotebookCells(e,t,i,n){const o=t.start,r=t.end;(o!==r||i.length>0)&&this._edits.push({_type:ts.CellReplace,uri:e,index:o,count:r-o,cells:i,metadata:n})}replaceNotebookCellMetadata(e,t,i,n){this._edits.push({_type:ts.Cell,metadata:n,uri:e,edit:{editType:sl.Metadata,index:t,metadata:i}})}replace(e,t,i,n){this._edits.push({_type:ts.Text,uri:e,edit:new by(t,i),metadata:n})}insert(e,t,i,n){this.replace(e,new ms(t,t),i,n)}delete(e,t,i){this.replace(e,t,"",i)}has(e){return this._edits.some(t=>t._type===ts.Text&&t.uri.toString()===e.toString())}set(e,t){if(t)for(const i of t){if(!i)continue;let n,o;Array.isArray(i)?(n=i[0],o=i[1]):n=i,fW.isNotebookCellEdit(n)?n.newCellMetadata?this.replaceNotebookCellMetadata(e,n.range.start,n.newCellMetadata,o):n.newNotebookMetadata?this.replaceNotebookMetadata(e,n.newNotebookMetadata,o):this.replaceNotebookCells(e,n.range,n.newCells,o):Wb.isSnippetTextEdit(n)?this._edits.push({_type:ts.Snippet,uri:e,range:n.range,edit:n.snippet,metadata:o,keepWhitespace:n.keepWhitespace}):this._edits.push({_type:ts.Text,uri:e,edit:n,metadata:o})}else{for(let i=0;i<this._edits.length;i++){const n=this._edits[i];switch(n._type){case ts.Text:case ts.Snippet:case ts.Cell:case ts.CellReplace:n.uri.toString()===e.toString()&&(this._edits[i]=void 0);break}}Nie(this._edits)}}get(e){const t=[];for(const i of this._edits)i._type===ts.Text&&i.uri.toString()===e.toString()&&t.push(i.edit);return t}entries(){const e=new In;for(const t of this._edits)if(t._type===ts.Text){let i=e.get(t.uri);i||(i=[t.uri,[]],e.set(t.uri,i)),i[1].push(t.edit)}return[...e.values()]}get size(){return this.entries().length}toJSON(){return this.entries()}};vA=f([nt],vA);let BE=Gf=class{static isSnippetString(e){return e instanceof Gf?!0:e?typeof e.value=="string":!1}static _escape(e){return e.replace(/\$|}|\\/g,"\\$&")}constructor(e){this._tabstop=1,this.value=e||""}appendText(e){return this.value+=Gf._escape(e),this}appendTabstop(e=this._tabstop++){return this.value+="$",this.value+=e,this}appendPlaceholder(e,t=this._tabstop++){if(typeof e=="function"){const i=new Gf;i._tabstop=this._tabstop,e(i),this._tabstop=i._tabstop,e=i.value}else e=Gf._escape(e);return this.value+="${",this.value+=t,this.value+=":",this.value+=e,this.value+="}",this}appendChoice(e,t=this._tabstop++){const i=e.map(n=>n.replaceAll(/[|\\,]/g,"\\$&")).join(",");return this.value+="${",this.value+=t,this.value+="|",this.value+=i,this.value+="|}",this}appendVariable(e,t){if(typeof t=="function"){const i=new Gf;i._tabstop=this._tabstop,t(i),this._tabstop=i._tabstop,t=i.value}else typeof t=="string"&&(t=t.replace(/\$|}/g,"\\$&"));return this.value+="${",this.value+=e,t&&(this.value+=":",this.value+=t),this.value+="}",this}};BE=Gf=f([nt],BE);var eb;(function(s){s[s.Unnecessary=1]="Unnecessary",s[s.Deprecated=2]="Deprecated"})(eb||(eb={}));var Ga;(function(s){s[s.Hint=3]="Hint",s[s.Information=2]="Information",s[s.Warning=1]="Warning",s[s.Error=0]="Error"})(Ga||(Ga={}));let sv=cW=class{static isLocation(e){return e instanceof cW?!0:e?ms.isRange(e.range)&&R.isUri(e.uri):!1}constructor(e,t){if(this.uri=e,t)if(ms.isRange(t))this.range=ms.of(t);else if(rn.isPosition(t))this.range=new ms(t,t);else throw new Error("Illegal argument")}toJSON(){return{uri:this.uri,range:this.range}}};sv=cW=f([nt],sv);let _A=class{static is(e){return e?typeof e.message=="string"&&e.location&&ms.isRange(e.location.range)&&R.isUri(e.location.uri):!1}constructor(e,t){this.location=e,this.message=t}static isEqual(e,t){return e===t?!0:!e||!t?!1:e.message===t.message&&e.location.range.isEqual(t.location.range)&&e.location.uri.toString()===t.location.uri.toString()}};_A=f([nt],_A);let mW=class{constructor(e,t,i=Ga.Error){if(!ms.isRange(e))throw new TypeError("range must be set");if(!t)throw new TypeError("message must be set");this.range=e,this.message=t,this.severity=i}toJSON(){return{severity:Ga[this.severity],message:this.message,range:this.range,source:this.source,code:this.code}}static isEqual(e,t){return e===t?!0:!e||!t?!1:e.message===t.message&&e.severity===t.severity&&e.code===t.code&&e.severity===t.severity&&e.source===t.source&&e.range.isEqual(t.range)&&rs(e.tags,t.tags)&&rs(e.relatedInformation,t.relatedInformation,_A.isEqual)}};mW=f([nt],mW);let vW=class{constructor(e,t){if(!e)throw new Error("Illegal argument, contents must be defined");Array.isArray(e)?this.contents=e:this.contents=[e],this.range=t}};vW=f([nt],vW);let _W=class extends vW{constructor(e,t,i,n){super(e,t),this.canIncreaseVerbosity=i,this.canDecreaseVerbosity=n}};_W=f([nt],_W);var q8;(function(s){s[s.Increase=0]="Increase",s[s.Decrease=1]="Decrease"})(q8||(q8={}));var bA;(function(s){s[s.Text=0]="Text",s[s.Read=1]="Read",s[s.Write=2]="Write"})(bA||(bA={}));let bW=class{constructor(e,t=bA.Text){this.range=e,this.kind=t}toJSON(){return{range:this.range,kind:bA[this.kind]}}};bW=f([nt],bW);let yW=class{constructor(e,t){this.uri=e,this.highlights=t}toJSON(){return{uri:this.uri,highlights:this.highlights.map(e=>e.toJSON())}}};yW=f([nt],yW);var hn;(function(s){s[s.File=0]="File",s[s.Module=1]="Module",s[s.Namespace=2]="Namespace",s[s.Package=3]="Package",s[s.Class=4]="Class",s[s.Method=5]="Method",s[s.Property=6]="Property",s[s.Field=7]="Field",s[s.Constructor=8]="Constructor",s[s.Enum=9]="Enum",s[s.Interface=10]="Interface",s[s.Function=11]="Function",s[s.Variable=12]="Variable",s[s.Constant=13]="Constant",s[s.String=14]="String",s[s.Number=15]="Number",s[s.Boolean=16]="Boolean",s[s.Array=17]="Array",s[s.Object=18]="Object",s[s.Key=19]="Key",s[s.Null=20]="Null",s[s.EnumMember=21]="EnumMember",s[s.Struct=22]="Struct",s[s.Event=23]="Event",s[s.Operator=24]="Operator",s[s.TypeParameter=25]="TypeParameter"})(hn||(hn={}));var yA;(function(s){s[s.Deprecated=1]="Deprecated"})(yA||(yA={}));let wW=dW=class{static validate(e){if(!e.name)throw new Error("name must not be falsy")}constructor(e,t,i,n,o){this.name=e,this.kind=t,this.containerName=o,typeof i=="string"&&(this.containerName=i),n instanceof sv?this.location=n:i instanceof ms&&(this.location=new sv(n,i)),dW.validate(this)}toJSON(){return{name:this.name,kind:hn[this.kind],location:this.location,containerName:this.containerName}}};wW=dW=f([nt],wW);let SW=Vk=class{static validate(e){if(!e.name)throw new Error("name must not be falsy");if(!e.range.contains(e.selectionRange))throw new Error("selectionRange must be contained in fullRange");e.children?.forEach(Vk.validate)}constructor(e,t,i,n,o){this.name=e,this.detail=t,this.kind=i,this.range=n,this.selectionRange=o,this.children=[],Vk.validate(this)}};SW=Vk=f([nt],SW);var wA;(function(s){s[s.Invoke=1]="Invoke",s[s.Automatic=2]="Automatic"})(wA||(wA={}));let K8=class{constructor(e,t){this.title=e,this.kind=t}};K8=f([nt],K8);let as=class{static{BS=this}static{this.sep="."}constructor(e){this.value=e}append(e){return new BS(this.value?this.value+BS.sep+e:e)}intersects(e){return this.contains(e)||e.contains(this)}contains(e){return this.value===e.value||e.value.startsWith(this.value+BS.sep)}};as=BS=f([nt],as);as.Empty=new as("");as.QuickFix=as.Empty.append("quickfix");as.Refactor=as.Empty.append("refactor");as.RefactorExtract=as.Refactor.append("extract");as.RefactorInline=as.Refactor.append("inline");as.RefactorMove=as.Refactor.append("move");as.RefactorRewrite=as.Refactor.append("rewrite");as.Source=as.Empty.append("source");as.SourceOrganizeImports=as.Source.append("organizeImports");as.SourceFixAll=as.Source.append("fixAll");as.Notebook=as.Empty.append("notebook");let CW=class{constructor(e,t){if(this.range=e,this.parent=t,t&&!t.range.contains(this.range))throw new Error("Invalid argument: parent must contain this range")}};CW=f([nt],CW);let jCe=class{constructor(e,t,i,n,o,r){this.kind=e,this.name=t,this.detail=i,this.uri=n,this.range=o,this.selectionRange=r}},YCe=class{constructor(e,t){this.fromRanges=t,this.from=e}},QCe=class{constructor(e,t){this.fromRanges=t,this.to=e}};var j8;(function(s){s[s.Information=0]="Information",s[s.Warning=1]="Warning",s[s.Error=2]="Error"})(j8||(j8={}));let Y8=class{constructor(e,t){this.range=e,this.command=t}get isResolved(){return!!this.command}};Y8=f([nt],Y8);let Up=lW=class{#e;static isMarkdownString(e){return e instanceof lW?!0:e&&e.appendCodeblock&&e.appendMarkdown&&e.appendText&&e.value!==void 0}constructor(e,t=!1){this.#e=new Gi(e,{supportThemeIcons:t})}get value(){return this.#e.value}set value(e){this.#e.value=e}get isTrusted(){return this.#e.isTrusted}set isTrusted(e){this.#e.isTrusted=e}get supportThemeIcons(){return this.#e.supportThemeIcons}set supportThemeIcons(e){this.#e.supportThemeIcons=e}get supportHtml(){return this.#e.supportHtml}set supportHtml(e){this.#e.supportHtml=e}get baseUri(){return this.#e.baseUri}set baseUri(e){this.#e.baseUri=e}appendText(e){return this.#e.appendText(e),this}appendMarkdown(e){return this.#e.appendMarkdown(e),this}appendCodeblock(e,t){return this.#e.appendCodeblock(t??"",e),this}};Up=lW=f([nt],Up);let Q8=class{constructor(e,t){this.label=e,this.documentation=t}};Q8=f([nt],Q8);let X8=class{constructor(e,t){this.label=e,this.documentation=t,this.parameters=[]}};X8=f([nt],X8);let Z8=class{constructor(){this.activeSignature=0,this.activeParameter=0,this.signatures=[]}};Z8=f([nt],Z8);var J8;(function(s){s[s.Invoke=1]="Invoke",s[s.TriggerCharacter=2]="TriggerCharacter",s[s.ContentChange=3]="ContentChange"})(J8||(J8={}));var e7;(function(s){s[s.Type=1]="Type",s[s.Parameter=2]="Parameter"})(e7||(e7={}));let EW=class{constructor(e){this.value=e}};EW=f([nt],EW);let xW=class{constructor(e,t,i){this.position=e,this.label=t,this.kind=i}};xW=f([nt],xW);var IC;(function(s){s[s.Invoke=0]="Invoke",s[s.TriggerCharacter=1]="TriggerCharacter",s[s.TriggerForIncompleteCompletions=2]="TriggerForIncompleteCompletions"})(IC||(IC={}));var bt;(function(s){s[s.Text=0]="Text",s[s.Method=1]="Method",s[s.Function=2]="Function",s[s.Constructor=3]="Constructor",s[s.Field=4]="Field",s[s.Variable=5]="Variable",s[s.Class=6]="Class",s[s.Interface=7]="Interface",s[s.Module=8]="Module",s[s.Property=9]="Property",s[s.Unit=10]="Unit",s[s.Value=11]="Value",s[s.Enum=12]="Enum",s[s.Keyword=13]="Keyword",s[s.Snippet=14]="Snippet",s[s.Color=15]="Color",s[s.File=16]="File",s[s.Reference=17]="Reference",s[s.Folder=18]="Folder",s[s.EnumMember=19]="EnumMember",s[s.Constant=20]="Constant",s[s.Struct=21]="Struct",s[s.Event=22]="Event",s[s.Operator=23]="Operator",s[s.TypeParameter=24]="TypeParameter",s[s.User=25]="User",s[s.Issue=26]="Issue"})(bt||(bt={}));var SA;(function(s){s[s.Deprecated=1]="Deprecated"})(SA||(SA={}));let IW=class{constructor(e,t){this.label=e,this.kind=t}toJSON(){return{label:this.label,kind:this.kind&&bt[this.kind],detail:this.detail,documentation:this.documentation,sortText:this.sortText,filterText:this.filterText,preselect:this.preselect,insertText:this.insertText,textEdit:this.textEdit}}};IW=f([nt],IW);let t7=class{constructor(e=[],t=!1){this.items=e,this.isIncomplete=t}};t7=f([nt],t7);let i7=class{constructor(e,t,i){this.insertText=e,this.range=t,this.command=i}};i7=f([nt],i7);let n7=class{constructor(e){this.commands=void 0,this.suppressSuggestions=void 0,this.items=e}};n7=f([nt],n7);var tb;(function(s){s[s.Unknown=0]="Unknown",s[s.Word=1]="Word",s[s.Line=2]="Line",s[s.Suggest=3]="Suggest"})(tb||(tb={}));var DC;(function(s){s[s.Accepted=0]="Accepted",s[s.Rejected=1]="Rejected",s[s.Ignored=2]="Ignored"})(DC||(DC={}));var CA;(function(s){s[s.Active=-1]="Active",s[s.Beside=-2]="Beside",s[s.One=1]="One",s[s.Two=2]="Two",s[s.Three=3]="Three",s[s.Four=4]="Four",s[s.Five=5]="Five",s[s.Six=6]="Six",s[s.Seven=7]="Seven",s[s.Eight=8]="Eight",s[s.Nine=9]="Nine"})(CA||(CA={}));var s7;(function(s){s[s.Left=1]="Left",s[s.Right=2]="Right"})(s7||(s7={}));function FKe(s,e){return`${vs.toKey(s)}.${e}`}var Wl;(function(s){s[s.Off=0]="Off",s[s.On=1]="On",s[s.Relative=2]="Relative",s[s.Interval=3]="Interval"})(Wl||(Wl={}));var kC;(function(s){s[s.Manual=1]="Manual",s[s.AfterDelay=2]="AfterDelay",s[s.FocusOut=3]="FocusOut"})(kC||(kC={}));var o7;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(o7||(o7={}));var EA;(function(s){s[s.Keyboard=1]="Keyboard",s[s.Mouse=2]="Mouse",s[s.Command=3]="Command"})(EA||(EA={}));var r7;(function(s){s[s.Addition=1]="Addition",s[s.Deletion=2]="Deletion",s[s.Modification=3]="Modification"})(r7||(r7={}));var a7;(function(s){s[s.Undo=1]="Undo",s[s.Redo=2]="Redo"})(a7||(a7={}));var ib;(function(s){s[s.OpenOpen=0]="OpenOpen",s[s.ClosedClosed=1]="ClosedClosed",s[s.OpenClosed=2]="OpenClosed",s[s.ClosedOpen=3]="ClosedOpen"})(ib||(ib={}));(function(s){function e(t){switch(t){case"keyboard":return s.Keyboard;case"mouse":return s.Mouse;case td.PROGRAMMATIC:case td.JUMP:case td.NAVIGATION:return s.Command}}s.fromValue=e})(EA||(EA={}));var xA;(function(s){s[s.Other=0]="Other",s[s.Comment=1]="Comment",s[s.String=2]="String",s[s.RegEx=3]="RegEx"})(xA||(xA={}));(function(s){function e(t){switch(t){case s.Other:return"other";case s.Comment:return"comment";case s.String:return"string";case s.RegEx:return"regex"}return"other"}s.toString=e})(xA||(xA={}));let DW=class{constructor(e,t){if(t&&!R.isUri(t))throw Nt("target");if(!ms.isRange(e)||e.isEmpty)throw Nt("range");this.range=e,this.target=t}};DW=f([nt],DW);let IA=class{constructor(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n}};IA=f([nt],IA);let c7=class{constructor(e,t){if(t&&!(t instanceof IA))throw Nt("color");if(!ms.isRange(e)||e.isEmpty)throw Nt("range");this.range=e,this.color=t}};c7=f([nt],c7);let kW=class{constructor(e){if(!e||typeof e!="string")throw Nt("label");this.label=e}};kW=f([nt],kW);var d7;(function(s){s[s.RGB=0]="RGB",s[s.HEX=1]="HEX",s[s.HSL=2]="HSL"})(d7||(d7={}));var l7;(function(s){s[s.Error=0]="Error",s[s.Warning=1]="Warning",s[s.Information=2]="Information"})(l7||(l7={}));var h7;(function(s){s[s.Unknown=0]="Unknown",s[s.Shutdown=1]="Shutdown",s[s.Process=2]="Process",s[s.User=3]="User",s[s.Extension=4]="Extension"})(h7||(h7={}));var TC;(function(s){s[s.Low=0]="Low",s[s.Medium=1]="Medium",s[s.High=2]="High"})(TC||(TC={}));var u7;(function(s){s[s.Sh=1]="Sh",s[s.Bash=2]="Bash",s[s.Fish=3]="Fish",s[s.Csh=4]="Csh",s[s.Ksh=5]="Ksh",s[s.Zsh=6]="Zsh",s[s.CommandPrompt=7]="CommandPrompt",s[s.GitBash=8]="GitBash",s[s.PowerShell=9]="PowerShell",s[s.Python=10]="Python",s[s.Julia=11]="Julia",s[s.NuShell=12]="NuShell",s[s.Node=13]="Node"})(u7||(u7={}));class UKe{constructor(e,t,i){if(this.startIndex=e,this.length=t,this.tooltip=i,typeof e!="number"||e<0)throw Nt("startIndex");if(typeof t!="number"||t<1)throw Nt("length");if(i!==void 0&&typeof i!="string")throw Nt("tooltip")}}class $Ke{constructor(e){this.uri=e}}class GKe{constructor(e){this.terminalCommand=e}}var g7;(function(s){s[s.Panel=1]="Panel",s[s.Editor=2]="Editor"})(g7||(g7={}));class zKe{constructor(e){if(this.options=e,typeof e!="object")throw Nt("options")}}var p7;(function(s){s[s.File=0]="File",s[s.Folder=1]="Folder",s[s.Method=2]="Method",s[s.Alias=3]="Alias",s[s.Argument=4]="Argument",s[s.Option=5]="Option",s[s.OptionValue=6]="OptionValue",s[s.Flag=7]="Flag"})(p7||(p7={}));class qKe{constructor(e,t,i,n,o,r,a,c,d){this.label=e,this.icon=t,this.detail=i,this.documentation=n,this.isFile=o,this.isDirectory=r,this.isKeyword=a,this.replacementIndex=c??0,this.replacementLength=d??0}}let KKe=class{constructor(e,t){this.items=e??[],this.resourceRequestConfig=t}};var f7;(function(s){s[s.Always=1]="Always",s[s.Silent=2]="Silent",s[s.Never=3]="Never"})(f7||(f7={}));var m7;(function(s){s.Changed="changed",s.ProcessStarted="processStarted",s.ProcessEnded="processEnded",s.Terminated="terminated",s.Start="start",s.AcquiredInput="acquiredInput",s.DependsOnStarted="dependsOnStarted",s.Active="active",s.Inactive="inactive",s.End="end",s.ProblemMatcherStarted="problemMatcherStarted",s.ProblemMatcherEnded="problemMatcherEnded",s.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(m7||(m7={}));var v7;(function(s){s[s.Shared=1]="Shared",s[s.Dedicated=2]="Dedicated",s[s.New=3]="New"})(v7||(v7={}));let _7=class{static{Ml=this}static{this.Clean=new Ml("clean","Clean")}static{this.Build=new Ml("build","Build")}static{this.Rebuild=new Ml("rebuild","Rebuild")}static{this.Test=new Ml("test","Test")}static from(e){switch(e){case"clean":return Ml.Clean;case"build":return Ml.Build;case"rebuild":return Ml.Rebuild;case"test":return Ml.Test;default:return}}constructor(e,t){if(this.label=t,typeof e!="string")throw Nt("name");if(typeof t!="string")throw Nt("name");this._id=e}get id(){return this._id}};_7=Ml=f([nt],_7);function Foe(s){let e="";for(let t=0;t<s.length;t++)e+=s[t].replace(/,/g,",,")+",";return e}let TW=class{constructor(e,t,i){if(typeof e!="string")throw Nt("process");this._args=[],this._process=e,t!==void 0&&(Array.isArray(t)?(this._args=t,this._options=i):this._options=t)}get process(){return this._process}set process(e){if(typeof e!="string")throw Nt("process");this._process=e}get args(){return this._args}set args(e){Array.isArray(e)||(e=[]),this._args=e}get options(){return this._options}set options(e){this._options=e}computeId(){const e=[];if(e.push("process"),this._process!==void 0&&e.push(this._process),this._args&&this._args.length>0)for(const t of this._args)e.push(t);return Foe(e)}};TW=f([nt],TW);let AW=class{constructor(e,t,i){if(this._args=[],Array.isArray(t)){if(!e)throw Nt("command can't be undefined or null");if(typeof e!="string"&&typeof e.value!="string")throw Nt("command");this._command=e,t&&(this._args=t),this._options=i}else{if(typeof e!="string")throw Nt("commandLine");this._commandLine=e,this._options=t}}get commandLine(){return this._commandLine}set commandLine(e){if(typeof e!="string")throw Nt("commandLine");this._commandLine=e}get command(){return this._command?this._command:""}set command(e){if(typeof e!="string"&&typeof e.value!="string")throw Nt("command");this._command=e}get args(){return this._args}set args(e){this._args=e||[]}get options(){return this._options}set options(e){this._options=e}computeId(){const e=[];if(e.push("shell"),this._commandLine!==void 0&&e.push(this._commandLine),this._command!==void 0&&e.push(typeof this._command=="string"?this._command:this._command.value),this._args&&this._args.length>0)for(const t of this._args)e.push(typeof t=="string"?t:t.value);return Foe(e)}};AW=f([nt],AW);var b7;(function(s){s[s.Escape=1]="Escape",s[s.Strong=2]="Strong",s[s.Weak=3]="Weak"})(b7||(b7={}));var DA;(function(s){s[s.Global=1]="Global",s[s.Workspace=2]="Workspace"})(DA||(DA={}));class XCe{constructor(e){this._callback=e}computeId(){return"customExecution"+Pn()}set callback(e){this._callback=e}get callback(){return this._callback}}let y7=class{static{Nl=this}static{this.ExtensionCallbackType="customExecution"}static{this.ProcessType="process"}static{this.ShellType="shell"}static{this.EmptyType="$empty"}constructor(e,t,i,n,o,r){this.__deprecated=!1,this._definition=this.definition=e;let a;typeof t=="string"?(this._name=this.name=t,this._source=this.source=i,this.execution=n,a=o,this.__deprecated=!0):t===DA.Global||t===DA.Workspace?(this.target=t,this._name=this.name=i,this._source=this.source=n,this.execution=o,a=r):(this.target=t,this._name=this.name=i,this._source=this.source=n,this.execution=o,a=r),typeof a=="string"?(this._problemMatchers=[a],this._hasDefinedMatchers=!0):Array.isArray(a)?(this._problemMatchers=a,this._hasDefinedMatchers=!0):(this._problemMatchers=[],this._hasDefinedMatchers=!1),this._isBackground=!1,this._presentationOptions=Object.create(null),this._runOptions=Object.create(null)}get _id(){return this.__id}set _id(e){this.__id=e}get _deprecated(){return this.__deprecated}clear(){this.__id!==void 0&&(this.__id=void 0,this._scope=void 0,this.computeDefinitionBasedOnExecution())}computeDefinitionBasedOnExecution(){this._execution instanceof TW?this._definition={type:Nl.ProcessType,id:this._execution.computeId()}:this._execution instanceof AW?this._definition={type:Nl.ShellType,id:this._execution.computeId()}:this._execution instanceof XCe?this._definition={type:Nl.ExtensionCallbackType,id:this._execution.computeId()}:this._definition={type:Nl.EmptyType,id:Pn()}}get definition(){return this._definition}set definition(e){if(e==null)throw Nt("Kind can't be undefined or null");this.clear(),this._definition=e}get scope(){return this._scope}set target(e){this.clear(),this._scope=e}get name(){return this._name}set name(e){if(typeof e!="string")throw Nt("name");this.clear(),this._name=e}get execution(){return this._execution}set execution(e){e===null&&(e=void 0),this.clear(),this._execution=e;const t=this._definition.type;(Nl.EmptyType===t||Nl.ProcessType===t||Nl.ShellType===t||Nl.ExtensionCallbackType===t)&&this.computeDefinitionBasedOnExecution()}get problemMatchers(){return this._problemMatchers}set problemMatchers(e){if(Array.isArray(e))this.clear(),this._problemMatchers=e,this._hasDefinedMatchers=!0;else{this.clear(),this._problemMatchers=[],this._hasDefinedMatchers=!1;return}}get hasDefinedMatchers(){return this._hasDefinedMatchers}get isBackground(){return this._isBackground}set isBackground(e){e!==!0&&e!==!1&&(e=!1),this.clear(),this._isBackground=e}get source(){return this._source}set source(e){if(typeof e!="string"||e.length===0)throw Nt("source must be a string of length > 0");this.clear(),this._source=e}get group(){return this._group}set group(e){e===null&&(e=void 0),this.clear(),this._group=e}get detail(){return this._detail}set detail(e){e===null&&(e=void 0),this._detail=e}get presentationOptions(){return this._presentationOptions}set presentationOptions(e){e==null&&(e=Object.create(null)),this.clear(),this._presentationOptions=e}get runOptions(){return this._runOptions}set runOptions(e){e==null&&(e=Object.create(null)),this.clear(),this._runOptions=e}};y7=Nl=f([nt],y7);var AC;(function(s){s[s.SourceControl=1]="SourceControl",s[s.Window=10]="Window",s[s.Notification=15]="Notification"})(AC||(AC={}));var w7;(function(s){function e(t){const i=t;return ec(i.value)?i.tooltip&&!Tt(i.tooltip)?(console.log("INVALID view badge, invalid tooltip",i.tooltip),!1):!0:(console.log("INVALID view badge, invalid value",i.value),!1)}s.isViewBadge=e})(w7||(w7={}));let S7=hW=class{static isTreeItem(e,t){const i=e;if(i.checkboxState!==void 0){const n=ec(i.checkboxState)?i.checkboxState:ra(i.checkboxState)&&ec(i.checkboxState.state)?i.checkboxState.state:void 0,o=!ec(i.checkboxState)&&ra(i.checkboxState)?i.checkboxState.tooltip:void 0;if(n===void 0||n!==kA.Checked&&n!==kA.Unchecked||o!==void 0&&!Tt(o))return console.log("INVALID tree item, invalid checkboxState",i.checkboxState),!1}if(e instanceof hW)return!0;if(i.label!==void 0&&!Tt(i.label)&&!i.label?.label)return console.log("INVALID tree item, invalid label",i.label),!1;if(i.id!==void 0&&!Tt(i.id))return console.log("INVALID tree item, invalid id",i.id),!1;if(i.iconPath!==void 0&&!Tt(i.iconPath)&&!R.isUri(i.iconPath)&&(!i.iconPath||!Tt(i.iconPath.id))){const n=i.iconPath;if(!n||!Tt(n.light)&&!R.isUri(n.light)&&!Tt(n.dark)&&!R.isUri(n.dark))return console.log("INVALID tree item, invalid iconPath",i.iconPath),!1}return i.description!==void 0&&!Tt(i.description)&&typeof i.description!="boolean"?(console.log("INVALID tree item, invalid description",i.description),!1):i.resourceUri!==void 0&&!R.isUri(i.resourceUri)?(console.log("INVALID tree item, invalid resourceUri",i.resourceUri),!1):i.tooltip!==void 0&&!Tt(i.tooltip)&&!(i.tooltip instanceof Up)?(console.log("INVALID tree item, invalid tooltip",i.tooltip),!1):i.command!==void 0&&!i.command.command?(console.log("INVALID tree item, invalid command",i.command),!1):i.collapsibleState!==void 0&&i.collapsibleState<RC.None&&i.collapsibleState>RC.Expanded?(console.log("INVALID tree item, invalid collapsibleState",i.collapsibleState),!1):i.contextValue!==void 0&&!Tt(i.contextValue)?(console.log("INVALID tree item, invalid contextValue",i.contextValue),!1):i.accessibilityInformation!==void 0&&!i.accessibilityInformation?.label?(console.log("INVALID tree item, invalid accessibilityInformation",i.accessibilityInformation),!1):!0}constructor(e,t=RC.None){this.collapsibleState=t,R.isUri(e)?this.resourceUri=e:this.label=e}};S7=hW=f([nt],S7);var RC;(function(s){s[s.None=0]="None",s[s.Collapsed=1]="Collapsed",s[s.Expanded=2]="Expanded"})(RC||(RC={}));var kA;(function(s){s[s.Unchecked=0]="Unchecked",s[s.Checked=1]="Checked"})(kA||(kA={}));let RW=class{async asString(){return typeof this.value=="string"?this.value:JSON.stringify(this.value)}asFile(){}constructor(e){this.value=e}};RW=f([nt],RW);class PW extends RW{}class ZCe extends PW{#e;constructor(e){super(""),this.#e=e}asFile(){return this.#e}}class JCe{constructor(e,t,i,n){this.name=e,this.uri=t,this._itemId=i,this._getData=n}data(){return this._getData()}}let LW=class{#e=new Map;constructor(e){for(const[t,i]of e??[]){const n=this.#e.get(this.#t(t));n?n.push(i):this.#e.set(this.#t(t),[i])}}get(e){return this.#e.get(this.#t(e))?.[0]}set(e,t){this.#e.set(this.#t(e),[t])}forEach(e,t){for(const[i,n]of this.#e)for(const o of n)e.call(t,o,i,this)}*[Symbol.iterator](){for(const[e,t]of this.#e)for(const i of t)yield[e,i]}#t(e){return e.toLowerCase()}};LW=f([nt],LW);let C7=class{constructor(e,t,i){this.insertText=e,this.title=t,this.kind=i}};C7=f([nt],C7);var E7;(function(s){s[s.Automatic=0]="Automatic",s[s.PasteAs=1]="PasteAs"})(E7||(E7={}));class mh{static{this.sep="."}constructor(e){this.value=e}append(...e){return new mh((this.value?[this.value,...e]:e).join(mh.sep))}intersects(e){return this.contains(e)||e.contains(this)}contains(e){return this.value===e.value||e.value.startsWith(this.value+mh.sep)}}mh.Empty=new mh("");mh.Text=new mh("text");mh.TextUpdateImports=mh.Text.append("updateImports");class n4e{constructor(e,t,i){this.title=t,this.insertText=e,this.kind=i}}let $p=class{constructor(e,t){this.id=e,this.color=t}static isThemeIcon(e){return typeof e.id!="string"?(console.log("INVALID ThemeIcon, invalid id",e.id),!1):!0}};$p=f([nt],$p);$p.File=new $p("file");$p.Folder=new $p("folder");let x7=class{constructor(e){this.id=e}};x7=f([nt],x7);var I7;(function(s){s[s.Global=1]="Global",s[s.Workspace=2]="Workspace",s[s.WorkspaceFolder=3]="WorkspaceFolder"})(I7||(I7={}));let PC=class{get base(){return this._base}set base(e){this._base=e,this._baseUri=R.file(e)}get baseUri(){return this._baseUri}set baseUri(e){this._baseUri=e,this._base=e.fsPath}constructor(e,t){if(typeof e!="string"&&(!e||!R.isUri(e)&&!R.isUri(e.uri)))throw Nt("base");if(typeof t!="string")throw Nt("pattern");typeof e=="string"?this.baseUri=R.file(e):R.isUri(e)?this.baseUri=e:this.baseUri=e.uri,this.pattern=t}toJSON(){return{pattern:this.pattern,base:this.base,baseUri:this.baseUri.toJSON()}}};PC=f([nt],PC);const Woe=new WeakMap;function a4e(s,e){Woe.set(s,e)}let VE=class{constructor(e,t,i,n,o){this.enabled=typeof e=="boolean"?e:!0,typeof t=="string"&&(this.condition=t),typeof i=="string"&&(this.hitCondition=i),typeof n=="string"&&(this.logMessage=n),typeof o=="string"&&(this.mode=o)}get id(){return this._id||(this._id=Woe.get(this)??Pn()),this._id}};VE=f([nt],VE);let D7=class extends VE{constructor(e,t,i,n,o,r){if(super(t,i,n,o,r),e===null)throw Nt("location");this.location=e}};D7=f([nt],D7);let k7=class extends VE{constructor(e,t,i,n,o,r){super(t,i,n,o,r),this.functionName=e}};k7=f([nt],k7);let T7=class extends VE{constructor(e,t,i,n,o,r,a,c){if(super(n,o,r,a,c),!t)throw Nt("dataId");this.label=e,this.dataId=t,this.canPersist=i}};T7=f([nt],T7);let A7=class{constructor(e,t,i){this.command=e,this.args=t||[],this.options=i}};A7=f([nt],A7);let R7=class{constructor(e,t){this.port=e,this.host=t}};R7=f([nt],R7);let P7=class{constructor(e){this.path=e}};P7=f([nt],P7);let L7=class{constructor(e){this.implementation=e}};L7=f([nt],L7);class m4e{constructor(e,t,i){this.session=e,this.threadId=t,this.frameId=i}}class v4e{constructor(e,t){this.session=e,this.threadId=t}}let MW=class{constructor(e,t){this.range=e,this.expression=t}};MW=f([nt],MW);var M7;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(M7||(M7={}));let NW=class{constructor(e,t){this.range=e,this.text=t}};NW=f([nt],NW);let OW=class{constructor(e,t,i=!0){this.range=e,this.variableName=t,this.caseSensitiveLookup=i}};OW=f([nt],OW);let FW=class{constructor(e,t){this.range=e,this.expression=t}};FW=f([nt],FW);let WW=class{constructor(e,t){this.frameId=e,this.stoppedLocation=t}};WW=f([nt],WW);var N7;(function(s){s[s.AIGenerated=1]="AIGenerated"})(N7||(N7={}));var O7;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(O7||(O7={}));class C4e{constructor(e,t){this.newSymbolName=e,this.tags=t}}var F7;(function(s){s[s.Changed=1]="Changed",s[s.Created=2]="Created",s[s.Deleted=3]="Deleted"})(F7||(F7={}));let W7=zr=class extends Error{static FileExists(e){return new zr(e,ur.FileExists,zr.FileExists)}static FileNotFound(e){return new zr(e,ur.FileNotFound,zr.FileNotFound)}static FileNotADirectory(e){return new zr(e,ur.FileNotADirectory,zr.FileNotADirectory)}static FileIsADirectory(e){return new zr(e,ur.FileIsADirectory,zr.FileIsADirectory)}static NoPermissions(e){return new zr(e,ur.NoPermissions,zr.NoPermissions)}static Unavailable(e){return new zr(e,ur.Unavailable,zr.Unavailable)}constructor(e,t=ur.Unknown,i){super(R.isUri(e)?e.toString(!0):e),this.code=i?.name??"Unknown",Gfe(this,t),Object.setPrototypeOf(this,zr.prototype),typeof Error.captureStackTrace=="function"&&typeof i=="function"&&Error.captureStackTrace(this,i)}};W7=zr=f([nt],W7);let B7=class{constructor(e,t,i){this.start=e,this.end=t,this.kind=i}};B7=f([nt],B7);var qg;(function(s){s[s.Comment=1]="Comment",s[s.Imports=2]="Imports",s[s.Region=3]="Region"})(qg||(qg={}));var V7;(function(s){s[s.Collapsed=0]="Collapsed",s[s.Expanded=1]="Expanded"})(V7||(V7={}));var H7;(function(s){s[s.Editing=0]="Editing",s[s.Preview=1]="Preview"})(H7||(H7={}));var U7;(function(s){s[s.Published=0]="Published",s[s.Draft=1]="Draft"})(U7||(U7={}));var $7;(function(s){s[s.Unresolved=0]="Unresolved",s[s.Resolved=1]="Resolved"})($7||($7={}));var G7;(function(s){s[s.Current=0]="Current",s[s.Outdated=1]="Outdated"})(G7||(G7={}));var z7;(function(s){s[s.Reply=1]="Reply",s[s.Comment=2]="Comment"})(z7||(z7={}));class I4e{constructor(e,t=[]){this.tokenTypes=e,this.tokenModifiers=t}}function eEe(s){return typeof s>"u"||Oie(s)}class Boe{constructor(e){if(this._prevLine=0,this._prevChar=0,this._dataIsSortedAndDeltaEncoded=!0,this._data=[],this._dataLen=0,this._tokenTypeStrToInt=new Map,this._tokenModifierStrToInt=new Map,this._hasLegend=!1,e){this._hasLegend=!0;for(let t=0,i=e.tokenTypes.length;t<i;t++)this._tokenTypeStrToInt.set(e.tokenTypes[t],t);for(let t=0,i=e.tokenModifiers.length;t<i;t++)this._tokenModifierStrToInt.set(e.tokenModifiers[t],t)}}push(e,t,i,n,o){if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"&&(typeof o=="number"||typeof o>"u"))return typeof o>"u"&&(o=0),this._pushEncoded(e,t,i,n,o);if(ms.isRange(e)&&typeof t=="string"&&eEe(i))return this._push(e,t,i);throw Nt()}_push(e,t,i){if(!this._hasLegend)throw new Error("Legend must be provided in constructor");if(e.start.line!==e.end.line)throw new Error("`range` cannot span multiple lines");if(!this._tokenTypeStrToInt.has(t))throw new Error("`tokenType` is not in the provided legend");const n=e.start.line,o=e.start.character,r=e.end.character-e.start.character,a=this._tokenTypeStrToInt.get(t);let c=0;if(i)for(const d of i){if(!this._tokenModifierStrToInt.has(d))throw new Error("`tokenModifier` is not in the provided legend");const l=this._tokenModifierStrToInt.get(d);c|=1<<l>>>0}this._pushEncoded(n,o,r,a,c)}_pushEncoded(e,t,i,n,o){if(this._dataIsSortedAndDeltaEncoded&&(e<this._prevLine||e===this._prevLine&&t<this._prevChar)){this._dataIsSortedAndDeltaEncoded=!1;const c=this._data.length/5|0;let d=0,l=0;for(let u=0;u<c;u++){let g=this._data[5*u],m=this._data[5*u+1];g===0?(g=d,m+=l):g+=d,this._data[5*u]=g,this._data[5*u+1]=m,d=g,l=m}}let r=e,a=t;this._dataIsSortedAndDeltaEncoded&&this._dataLen>0&&(r-=this._prevLine,r===0&&(a-=this._prevChar)),this._data[this._dataLen++]=r,this._data[this._dataLen++]=a,this._data[this._dataLen++]=i,this._data[this._dataLen++]=n,this._data[this._dataLen++]=o,this._prevLine=e,this._prevChar=t}static _sortAndDeltaEncode(e){const t=[],i=e.length/5|0;for(let a=0;a<i;a++)t[a]=a;t.sort((a,c)=>{const d=e[5*a],l=e[5*c];if(d===l){const u=e[5*a+1],g=e[5*c+1];return u-g}return d-l});const n=new Uint32Array(e.length);let o=0,r=0;for(let a=0;a<i;a++){const c=5*t[a],d=e[c+0],l=e[c+1],u=e[c+2],g=e[c+3],m=e[c+4],v=d-o,_=v===0?l-r:l,w=5*a;n[w+0]=v,n[w+1]=_,n[w+2]=u,n[w+3]=g,n[w+4]=m,o=d,r=l}return n}build(e){return this._dataIsSortedAndDeltaEncoded?new q7(new Uint32Array(this._data),e):new q7(Boe._sortAndDeltaEncode(this._data),e)}}class q7{constructor(e,t){this.resultId=t,this.data=e}}class D4e{constructor(e,t,i){this.start=e,this.deleteCount=t,this.data=i}}class k4e{constructor(e,t){this.resultId=t,this.edits=e}}var K7;(function(s){s[s.Separate=0]="Separate",s[s.MergeWithParent=1]="MergeWithParent"})(K7||(K7={}));class T4e{constructor(e){this.name=e}}var j7;(function(s){s[s.Title=1]="Title",s[s.Inline=2]="Inline"})(j7||(j7={}));let Y7=class{static{this.Back={iconPath:new $p("arrow-left")}}constructor(){}};Y7=f([nt],Y7);var Q7;(function(s){s[s.Separator=-1]="Separator",s[s.Default=0]="Default"})(Q7||(Q7={}));var X7;(function(s){s[s.Info=1]="Info",s[s.Warning=2]="Warning",s[s.Error=3]="Error"})(X7||(X7={}));var Z7;(function(s){s[s.UI=1]="UI",s[s.Workspace=2]="Workspace"})(Z7||(Z7={}));class R4e{static validate(e){if(typeof e.badge=="string"){let t=R6(e.badge,0);if(t<e.badge.length&&(t+=R6(e.badge,t)),e.badge.length>t)throw new Error("The 'badge'-property must be undefined or a short character")}else if(e.badge&&!$p.isThemeIcon(e.badge))throw new Error("The 'badge'-property is not a valid ThemeIcon");if(!e.color&&!e.badge&&!e.tooltip)throw new Error("The decoration is empty");return!0}constructor(e,t,i){this.badge=e,this.tooltip=t,this.color=i}}let J7=class{constructor(e){this.kind=e}};J7=f([nt],J7);var e9;(function(s){s[s.Light=1]="Light",s[s.Dark=2]="Dark",s[s.HighContrast=3]="HighContrast",s[s.HighContrastLight=4]="HighContrastLight"})(e9||(e9={}));let VS=class BW{static isNotebookRange(e){return e instanceof BW?!0:e?typeof e.start=="number"&&typeof e.end=="number":!1}get start(){return this._start}get end(){return this._end}get isEmpty(){return this._start===this._end}constructor(e,t){if(e<0)throw Nt("start must be positive");if(t<0)throw Nt("end must be positive");e<=t?(this._start=e,this._end=t):(this._start=t,this._end=e)}with(e){let t=this._start,i=this._end;return e.start!==void 0&&(t=e.start),e.end!==void 0&&(i=e.end),t===this._start&&i===this._end?this:new BW(t,i)}},Voe=class VW{static validate(e){if(typeof e.kind!="number")throw new Error("NotebookCellData MUST have 'kind' property");if(typeof e.value!="string")throw new Error("NotebookCellData MUST have 'value' property");if(typeof e.languageId!="string")throw new Error("NotebookCellData MUST have 'languageId' property")}static isNotebookCellDataArray(e){return Array.isArray(e)&&e.every(t=>VW.isNotebookCellData(t))}static isNotebookCellData(e){return!0}constructor(e,t,i,n,o,r,a){this.kind=e,this.value=t,this.languageId=i,this.mime=n,this.outputs=o??[],this.metadata=r,this.executionSummary=a,VW.validate(this)}},tEe=class{constructor(e){this.cells=e}},iEe=class eu{static isNotebookCellOutputItem(e){return e instanceof eu?!0:e?typeof e.mime=="string"&&e.data instanceof Uint8Array:!1}static error(e){const t={name:e.name,message:e.message,stack:e.stack};return eu.json(t,"application/vnd.code.notebook.error")}static stdout(e){return eu.text(e,"application/vnd.code.notebook.stdout")}static stderr(e){return eu.text(e,"application/vnd.code.notebook.stderr")}static bytes(e,t="application/octet-stream"){return new eu(e,t)}static#e=new TextEncoder;static text(e,t=Si.text){const i=eu.#e.encode(String(e));return new eu(i,t)}static json(e,t="text/x-json"){const i=JSON.stringify(e,void 0,"	");return eu.text(i,t)}constructor(e,t){this.data=e,this.mime=t;const i=Mie(t,!0);if(!i)throw new Error(`INVALID mime type: ${t}. Must be in the format "type/subtype[;optionalparameter]"`);this.mime=i}},nEe=class HW{static isNotebookCellOutput(e){return e instanceof HW?!0:!e||typeof e!="object"?!1:typeof e.id=="string"&&Array.isArray(e.items)}static ensureUniqueMimeTypes(e,t=!1){const i=new Set,n=new Set;for(let o=0;o<e.length;o++){const r=e[o],a=Mie(r.mime);if(!i.has(a)||_q(a)){i.add(a);continue}n.add(o),t&&console.warn(`DUPLICATED mime type '${r.mime}' will be dropped`)}return n.size===0?e:e.filter((o,r)=>!n.has(r))}constructor(e,t,i){this.items=HW.ensureUniqueMimeTypes(e,!0),typeof t=="string"?(this.id=t,this.metadata=i):(this.id=Pn(),this.metadata=t??i)}};class M4e{constructor(e,t,i){this.label=e,this.uri=t,this.position=i}}var nb;(function(s){s[s.Markup=1]="Markup",s[s.Code=2]="Code"})(nb||(nb={}));var TA;(function(s){s[s.Idle=1]="Idle",s[s.Pending=2]="Pending",s[s.Executing=3]="Executing"})(TA||(TA={}));var UW;(function(s){s[s.Left=1]="Left",s[s.Right=2]="Right"})(UW||(UW={}));var t9;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(t9||(t9={}));class N4e{constructor(e,t){this.text=e,this.alignment=t}}var i9;(function(s){s[s.Default=1]="Default",s[s.Preferred=2]="Preferred"})(i9||(i9={}));var n9;(function(s){s[s.Default=1]="Default",s[s.Preferred=2]="Preferred",s[s.Hidden=-1]="Hidden"})(n9||(n9={}));let sEe=class{constructor(e,t=[]){this.uri=e,this.provides=fw(t)}},F4e=class{constructor(e){this.label=e}};var s9;(function(s){s[s.Named=1]="Named",s[s.Indexed=2]="Indexed"})(s9||(s9={}));let o9=class{constructor(e,t){this.label=e,this.timestamp=t}};o9=f([nt],o9);var r9;(function(s){s[s.Production=1]="Production",s[s.Development=2]="Development",s[s.Test=3]="Test"})(r9||(r9={}));var a9;(function(s){s[s.Node=1]="Node",s[s.Webworker=2]="Webworker"})(a9||(a9={}));var sb;(function(s){s[s.Other=0]="Other",s[s.Comment=1]="Comment",s[s.String=2]="String",s[s.RegEx=3]="RegEx"})(sb||(sb={}));class V4e{constructor(e,t){this.ranges=e,this.wordPattern=t}}class H4e{constructor(e){this._autoForwardAction=e}get autoForwardAction(){return this._autoForwardAction}}var c9;(function(s){s[s.Queued=1]="Queued",s[s.Running=2]="Running",s[s.Passed=3]="Passed",s[s.Failed=4]="Failed",s[s.Skipped=5]="Skipped",s[s.Errored=6]="Errored"})(c9||(c9={}));var LC;(function(s){s[s.Run=1]="Run",s[s.Debug=2]="Debug",s[s.Coverage=3]="Coverage"})(LC||(LC={}));class U4e{constructor(e,t,i){this.controllerId=e,this.profileId=t,this.kind=i}}let d9=class{constructor(e=void 0,t=void 0,i=void 0,n=!1,o=!0){this.include=e,this.exclude=t,this.profile=i,this.continuous=n,this.preserveFocus=o}};d9=f([nt],d9);let $W=uW=class{static diff(e,t,i){const n=new uW(e);return n.expectedOutput=t,n.actualOutput=i,n}constructor(e){this.message=e}};$W=uW=f([nt],$W);let AA=class{constructor(e){this.id=e}};AA=f([nt],AA);class q4e{constructor(e,t,i){this.label=e,this.uri=t,this.position=i}}class u1{constructor(e,t){this.covered=e,this.total=t,Uk(this)}}function Uk(s){if(s){if(s.covered>s.total)throw new Error(`The total number of covered items (${s.covered}) cannot be greater than the total (${s.total})`);if(s.total<0)throw new Error(`The number of covered items (${s.total}) cannot be negative`)}}let oEe=class Hoe{static fromDetails(e,t){const i=new u1(0,0),n=new u1(0,0),o=new u1(0,0);for(const a of t)if("branches"in a){i.total+=1,i.covered+=a.executed?1:0;for(const c of a.branches)n.total+=1,n.covered+=c.executed?1:0}else o.total+=1,o.covered+=a.executed?1:0;const r=new Hoe(e,i,n.total>0?n:void 0,o.total>0?o:void 0);return r.detailedCoverage=t,r}constructor(e,t,i,n,o=[]){this.uri=e,this.statementCoverage=t,this.branchCoverage=i,this.declarationCoverage=n,this.includesTests=o}};class rEe{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i=[]){this.executed=e,this.location=t,this.branches=i}}class aEe{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i){this.executed=e,this.location=t,this.label=i}}class cEe{get executionCount(){return+this.executed}set executionCount(e){this.executed=e}constructor(e,t,i){this.name=e,this.executed=t,this.location=i}}var l9;(function(s){s[s.None=0]="None",s[s.Option=1]="Option",s[s.Default=2]="Default",s[s.Preferred=3]="Preferred"})(l9||(l9={}));var h9;(function(s){s[s.Untrusted=0]="Untrusted",s[s.Trusted=1]="Trusted",s[s.Unspecified=2]="Unspecified"})(h9||(h9={}));var u9;(function(s){s[s.Notify=1]="Notify",s[s.OpenBrowser=2]="OpenBrowser",s[s.OpenPreview=3]="OpenPreview",s[s.Silent=4]="Silent",s[s.Ignore=5]="Ignore",s[s.OpenBrowserOnce=6]="OpenBrowserOnce"})(u9||(u9={}));let dEe=class{constructor(e,t,i,n,o,r){this.kind=e,this.name=t,this.detail=i,this.uri=n,this.range=o,this.selectionRange=r}};class j4e{constructor(e){this.uri=e}}class Y4e{constructor(e,t){this.original=e,this.modified=t}}class Q4e{constructor(e,t,i,n){this.base=e,this.input1=t,this.input2=i,this.result=n}}class X4e{constructor(e,t){this.uri=e,this.viewType=t}}class Z4e{constructor(e){this.viewType=e}}class J4e{constructor(e,t){this.uri=e,this.notebookType=t}}class e5e{constructor(e,t,i){this.original=e,this.modified=t,this.notebookType=i}}class t5e{constructor(){}}class i5e{constructor(e,t){this.uri=e,this.inputBoxUri=t}}class n5e{constructor(){}}class s5e{constructor(e){this.textDiffs=e}}var g9;(function(s){s[s.Down=0]="Down",s[s.Up=1]="Up"})(g9||(g9={}));var p9;(function(s){s[s.Action=1]="Action",s[s.Toolbar=2]="Toolbar"})(p9||(p9={}));var f9;(function(s){s[s.Short=1]="Short",s[s.Medium=2]="Medium",s[s.Full=3]="Full"})(f9||(f9={}));class o5e{constructor(e,t,i){this.id=e,this.label=t,this.values=i}}var ob;(function(s){s[s.Accepted=1]="Accepted",s[s.Rejected=2]="Rejected",s[s.Saved=3]="Saved"})(ob||(ob={}));var m9;(function(s){s[s.Keep=1]="Keep",s[s.Undo=2]="Undo",s[s.UserModification=3]="UserModification"})(m9||(m9={}));var v9;(function(s){s[s.Unhelpful=0]="Unhelpful",s[s.Helpful=1]="Helpful",s[s.Undone=2]="Undone",s[s.Accepted=3]="Accepted",s[s.Bug=4]="Bug"})(v9||(v9={}));var _9;(function(s){s[s.Unhelpful=0]="Unhelpful",s[s.Helpful=1]="Helpful"})(_9||(_9={}));let Uoe=class{constructor(e){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new Up(e):e}},$oe=class{constructor(e,t){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new Up(e):e,this.vulnerabilities=t}},lEe=class{constructor(e,t,i,n){this.title=e,this.message=t,this.data=i,this.buttons=n}};class Goe{constructor(e,t){this.value=e,this.baseUri=t}}let zoe=class{constructor(e,t){this.value=e,this.value2=e,this.title=t}},qoe=class{constructor(e){this.value=e}};class h5e{constructor(e,t){this.value=e,this.task=t}}let Koe=class{constructor(e){if(typeof e!="string"&&e.isTrusted===!0)throw new Error("The boolean form of MarkdownString.isTrusted is NOT supported for chat participants.");this.value=typeof e=="string"?new Up(e):e}},joe=class{constructor(e){this.value=e}},Yoe=class{constructor(e,t,i){this.value=e,this.iconPath=t,this.options=i}},Qoe=class{constructor(e,t){this.value=e,this.isEdit=t}},hEe=class{constructor(e,t,i){this.value=e,this.license=t,this.snippet=i}},Xoe=class{constructor(e,t){this.uri=e,this.range=t}},uEe=class{constructor(e){this.extensions=e}},Zoe=class{constructor(e,t){this.uri=e,t===!0?(this.isDone=!0,this.edits=[]):this.edits=Array.isArray(t)?t:[t]}},gEe=class{constructor(e,t){this.uri=e,t===!0?(this.isDone=!0,this.edits=[]):this.edits=Array.isArray(t)?t:[t]}};class w5e{constructor(e,t,i,n,o,r){this.prompt=e,this.command=t,this.references=i,this.participant=n,this.toolReferences=o,this.editedFileEvents=r}}class S5e{constructor(e,t,i,n){this.response=e,this.result=t,this.participant=i,this.command=n}}var Bl;(function(s){s[s.Panel=1]="Panel",s[s.Terminal=2]="Terminal",s[s.Notebook=3]="Notebook",s[s.Editor=4]="Editor"})(Bl||(Bl={}));var b9;(function(s){s[s.Complete=1]="Complete",s[s.Partial=2]="Partial",s[s.Omitted=3]="Omitted"})(b9||(b9={}));class C5e{constructor(e,t,i){this.document=e,this.selection=t,this.wholeRange=i}}class E5e{constructor(e){this.cell=e}}class pEe{constructor(e,t,i){this.mimeType=e,this.data=t,this.reference=i}}class fEe{constructor(e){this.diagnostics=e}}var Uc;(function(s){s[s.User=1]="User",s[s.Assistant=2]="Assistant",s[s.System=3]="System"})(Uc||(Uc={}));class GW{constructor(e,t,i){this.callId=e,this.content=t,this.isError=i??!1}}class y9{constructor(e,t,i){this.callId=e,this.content=t,this.isError=i??!1}}class x5e{constructor(e,t,i){this.command=e,this.language=t,this.confirmationMessages=i}}var w9;(function(s){s[s.Info=0]="Info",s[s.Warning=1]="Warning",s[s.Error=2]="Error"})(w9||(w9={}));let mEe=class zW{static User(e,t){return new zW(Uc.User,e,t)}static Assistant(e,t){return new zW(Uc.Assistant,e,t)}set content(e){typeof e=="string"?this._content=[new uo(e)]:this._content=e}get content(){return this._content}constructor(e,t,i){this._content=[],this.role=e,this.content=t,this.name=i}},vEe=class qW{static User(e,t){return new qW(Uc.User,e,t)}static Assistant(e,t){return new qW(Uc.Assistant,e,t)}set content(e){typeof e=="string"?this._content=[new uo(e)]:this._content=e}get content(){return this._content}set content2(e){e&&(this.content=e.map(t=>typeof t=="string"?new uo(t):t))}get content2(){return this.content.map(e=>e instanceof uo?e.value:e)}constructor(e,t,i){this._content=[],this.role=e,this.content=t,this.name=i}};class RA{constructor(e,t,i){this.callId=e,this.name=t,this.input=i}}class uo{constructor(e){this.value=e}toJSON(){return{$mid:Dn.LanguageModelTextPart,value:this.value}}}class rh{constructor(e,t){this.mimeType=t,this.data=e}static image(e,t){return new rh(e,t)}static json(e){const t=JSON.stringify(e,void 0,"	");return new rh(Le.fromString(t).buffer,"json")}static text(e){return new rh(Le.fromString(e).buffer,"text/plain")}toJSON(){return{$mid:Dn.LanguageModelDataPart,mimeType:this.mimeType,data:this.data}}}var KW;(function(s){s.PNG="image/png",s.JPEG="image/jpeg",s.GIF="image/gif",s.WEBP="image/webp",s.BMP="image/bmp"})(KW||(KW={}));class S9{constructor(e,t){this.kind=e,this.data=t}toJSON(){return{$mid:Dn.LanguageModelExtraDataPart,kind:this.kind,data:this.data}}}class Ju{constructor(e){this.value=e}toJSON(){return{$mid:Dn.LanguageModelPromptTsxPart,value:this.value}}}class Md extends Error{static#e="LanguageModelError";static NotFound(e){return new Md(e,Md.NotFound.name)}static NoPermissions(e){return new Md(e,Md.NoPermissions.name)}static Blocked(e){return new Md(e,Md.Blocked.name)}static tryDeserialize(e){if(e.name===Md.#e)return new Md(e.message,e.code,e.cause)}constructor(e,t,i){super(e,{cause:i}),this.name=Md.#e,this.code=t??""}}let bq=class{constructor(e){this.content=e}toJSON(){return{$mid:Dn.LanguageModelToolResult,content:this.content}}},_Ee=class{constructor(e){this.content=e}toJSON(){return{$mid:Dn.LanguageModelToolResult,content:this.content}}};class k5e extends bq{}var C9;(function(s){s[s.Auto=1]="Auto",s[s.Required=2]="Required"})(C9||(C9={}));var E9;(function(s){s[s.SymbolInformation=1]="SymbolInformation",s[s.CommandInformation=2]="CommandInformation",s[s.SearchInformation=3]="SearchInformation",s[s.SettingInformation=4]="SettingInformation"})(E9||(E9={}));var x9;(function(s){s[s.EMBEDDED=1]="EMBEDDED",s[s.LLM_RANKED=2]="LLM_RANKED",s[s.CANCELED=3]="CANCELED"})(x9||(x9={}));var I9;(function(s){s[s.Started=1]="Started",s[s.Recognizing=2]="Recognizing",s[s.Recognized=3]="Recognized",s[s.Stopped=4]="Stopped",s[s.Error=5]="Error"})(I9||(I9={}));var D9;(function(s){s[s.Started=1]="Started",s[s.Stopped=2]="Stopped",s[s.Error=3]="Error"})(D9||(D9={}));var k9;(function(s){s[s.Recognized=1]="Recognized",s[s.Stopped=2]="Stopped"})(k9||(k9={}));let T5e=class{constructor(e,t){this.text=e,this.range=t}};var T9;(function(s){s[s.Invoke=0]="Invoke",s[s.Automatic=1]="Automatic"})(T9||(T9={}));class R5e{constructor(e,t,i,n={},o){this.label=e,this.command=t,this.args=i,this.env=n,this.version=o}}class P5e{constructor(e,t,i={},n){this.label=e,this.uri=t,this.headers=i,this.version=n}}class xN{static{this.count=0}constructor(e){this._proxyIdentifierBrand=void 0,this.sid=e,this.nid=++xN.count}}const Joe=[];function le(s){const e=new xN(s);return Joe[e.nid]=e,e}function zD(s){return Joe[s].sid}class ta{constructor(e){this.value=e}}var rb;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(rb||(rb={}));var $o;(function(s){s[s.UnknownInput=0]="UnknownInput",s[s.TextInput=1]="TextInput",s[s.TextDiffInput=2]="TextDiffInput",s[s.TextMergeInput=3]="TextMergeInput",s[s.NotebookInput=4]="NotebookInput",s[s.NotebookDiffInput=5]="NotebookDiffInput",s[s.CustomEditorInput=6]="CustomEditorInput",s[s.WebviewEditorInput=7]="WebviewEditorInput",s[s.TerminalEditorInput=8]="TerminalEditorInput",s[s.InteractiveEditorInput=9]="InteractiveEditorInput",s[s.ChatEditorInput=10]="ChatEditorInput",s[s.MultiDiffEditorInput=11]="MultiDiffEditorInput"})($o||($o={}));var Nd;(function(s){s[s.TAB_OPEN=0]="TAB_OPEN",s[s.TAB_CLOSE=1]="TAB_CLOSE",s[s.TAB_UPDATE=2]="TAB_UPDATE",s[s.TAB_MOVE=3]="TAB_MOVE"})(Nd||(Nd={}));var A9;(function(s){s[s.Editable=0]="Editable",s[s.SupportsHotExit=1]="SupportsHotExit"})(A9||(A9={}));var is;(function(s){s[s.Int8Array=1]="Int8Array",s[s.Uint8Array=2]="Uint8Array",s[s.Uint8ClampedArray=3]="Uint8ClampedArray",s[s.Int16Array=4]="Int16Array",s[s.Uint16Array=5]="Uint16Array",s[s.Int32Array=6]="Int32Array",s[s.Uint32Array=7]="Uint32Array",s[s.Float32Array=8]="Float32Array",s[s.Float64Array=9]="Float64Array",s[s.BigInt64Array=10]="BigInt64Array",s[s.BigUint64Array=11]="BigUint64Array"})(is||(is={}));var R9;(function(s){s[s.Text=1]="Text",s[s.Error=2]="Error",s[s.Rich=3]="Rich"})(R9||(R9={}));var ab;(function(s){s[s.Default=0]="Default",s[s.InCenter=1]="InCenter",s[s.InCenterIfOutsideViewport=2]="InCenterIfOutsideViewport",s[s.AtTop=3]="AtTop"})(ab||(ab={}));var MC;(function(s){s[s.None=0]="None",s[s.Process=1]="Process",s[s.Output=2]="Output",s[s.Hybrid=3]="Hybrid"})(MC||(MC={}));var xo;(function(s){s.label="a",s.kind="b",s.detail="c",s.documentation="d",s.sortText="e",s.filterText="f",s.preselect="g",s.insertText="h",s.insertTextRules="i",s.range="j",s.commitCharacters="k",s.additionalTextEdits="l",s.kindModifier="m",s.commandIdent="n",s.commandId="o",s.commandArguments="p"})(xo||(xo={}));var cb;(function(s){s.defaultRanges="a",s.completions="b",s.isIncomplete="c",s.duration="d"})(cb||(cb={}));var P9;(function(s){s[s.Workspace=0]="Workspace",s[s.TextDocument=1]="TextDocument"})(P9||(P9={}));const qe={MainThreadAuthentication:le("MainThreadAuthentication"),MainThreadBulkEdits:le("MainThreadBulkEdits"),MainThreadLanguageModels:le("MainThreadLanguageModels"),MainThreadEmbeddings:le("MainThreadEmbeddings"),MainThreadChatAgents2:le("MainThreadChatAgents2"),MainThreadCodeMapper:le("MainThreadCodeMapper"),MainThreadLanguageModelTools:le("MainThreadChatSkills"),MainThreadClipboard:le("MainThreadClipboard"),MainThreadCommands:le("MainThreadCommands"),MainThreadComments:le("MainThreadComments"),MainThreadConfiguration:le("MainThreadConfiguration"),MainThreadConsole:le("MainThreadConsole"),MainThreadDebugService:le("MainThreadDebugService"),MainThreadDecorations:le("MainThreadDecorations"),MainThreadDiagnostics:le("MainThreadDiagnostics"),MainThreadDialogs:le("MainThreadDiaglogs"),MainThreadDocuments:le("MainThreadDocuments"),MainThreadDocumentContentProviders:le("MainThreadDocumentContentProviders"),MainThreadTextEditors:le("MainThreadTextEditors"),MainThreadEditorInsets:le("MainThreadEditorInsets"),MainThreadEditorTabs:le("MainThreadEditorTabs"),MainThreadErrors:le("MainThreadErrors"),MainThreadTreeViews:le("MainThreadTreeViews"),MainThreadDownloadService:le("MainThreadDownloadService"),MainThreadLanguageFeatures:le("MainThreadLanguageFeatures"),MainThreadLanguages:le("MainThreadLanguages"),MainThreadLogger:le("MainThreadLogger"),MainThreadMessageService:le("MainThreadMessageService"),MainThreadOutputService:le("MainThreadOutputService"),MainThreadProgress:le("MainThreadProgress"),MainThreadQuickDiff:le("MainThreadQuickDiff"),MainThreadQuickOpen:le("MainThreadQuickOpen"),MainThreadStatusBar:le("MainThreadStatusBar"),MainThreadSecretState:le("MainThreadSecretState"),MainThreadStorage:le("MainThreadStorage"),MainThreadSpeech:le("MainThreadSpeechProvider"),MainThreadTelemetry:le("MainThreadTelemetry"),MainThreadTerminalService:le("MainThreadTerminalService"),MainThreadTerminalShellIntegration:le("MainThreadTerminalShellIntegration"),MainThreadWebviews:le("MainThreadWebviews"),MainThreadWebviewPanels:le("MainThreadWebviewPanels"),MainThreadWebviewViews:le("MainThreadWebviewViews"),MainThreadCustomEditors:le("MainThreadCustomEditors"),MainThreadUrls:le("MainThreadUrls"),MainThreadUriOpeners:le("MainThreadUriOpeners"),MainThreadProfileContentHandlers:le("MainThreadProfileContentHandlers"),MainThreadWorkspace:le("MainThreadWorkspace"),MainThreadFileSystem:le("MainThreadFileSystem"),MainThreadFileSystemEventService:le("MainThreadFileSystemEventService"),MainThreadExtensionService:le("MainThreadExtensionService"),MainThreadSCM:le("MainThreadSCM"),MainThreadSearch:le("MainThreadSearch"),MainThreadShare:le("MainThreadShare"),MainThreadTask:le("MainThreadTask"),MainThreadWindow:le("MainThreadWindow"),MainThreadLabelService:le("MainThreadLabelService"),MainThreadNotebook:le("MainThreadNotebook"),MainThreadNotebookDocuments:le("MainThreadNotebookDocumentsShape"),MainThreadNotebookEditors:le("MainThreadNotebookEditorsShape"),MainThreadNotebookKernels:le("MainThreadNotebookKernels"),MainThreadNotebookRenderers:le("MainThreadNotebookRenderers"),MainThreadInteractive:le("MainThreadInteractive"),MainThreadTheming:le("MainThreadTheming"),MainThreadTunnelService:le("MainThreadTunnelService"),MainThreadManagedSockets:le("MainThreadManagedSockets"),MainThreadTimeline:le("MainThreadTimeline"),MainThreadTesting:le("MainThreadTesting"),MainThreadLocalization:le("MainThreadLocalizationShape"),MainThreadMcp:le("MainThreadMcpShape"),MainThreadAiRelatedInformation:le("MainThreadAiRelatedInformation"),MainThreadAiEmbeddingVector:le("MainThreadAiEmbeddingVector"),MainThreadChatStatus:le("MainThreadChatStatus"),MainThreadAiSettingsSearch:le("MainThreadAiSettingsSearch")},Ze={ExtHostCodeMapper:le("ExtHostCodeMapper"),ExtHostCommands:le("ExtHostCommands"),ExtHostConfiguration:le("ExtHostConfiguration"),ExtHostDiagnostics:le("ExtHostDiagnostics"),ExtHostDebugService:le("ExtHostDebugService"),ExtHostDecorations:le("ExtHostDecorations"),ExtHostDocumentsAndEditors:le("ExtHostDocumentsAndEditors"),ExtHostDocuments:le("ExtHostDocuments"),ExtHostDocumentContentProviders:le("ExtHostDocumentContentProviders"),ExtHostDocumentSaveParticipant:le("ExtHostDocumentSaveParticipant"),ExtHostEditors:le("ExtHostEditors"),ExtHostTreeViews:le("ExtHostTreeViews"),ExtHostFileSystem:le("ExtHostFileSystem"),ExtHostFileSystemInfo:le("ExtHostFileSystemInfo"),ExtHostFileSystemEventService:le("ExtHostFileSystemEventService"),ExtHostLanguages:le("ExtHostLanguages"),ExtHostLanguageFeatures:le("ExtHostLanguageFeatures"),ExtHostQuickOpen:le("ExtHostQuickOpen"),ExtHostQuickDiff:le("ExtHostQuickDiff"),ExtHostStatusBar:le("ExtHostStatusBar"),ExtHostShare:le("ExtHostShare"),ExtHostExtensionService:le("ExtHostExtensionService"),ExtHostLogLevelServiceShape:le("ExtHostLogLevelServiceShape"),ExtHostTerminalService:le("ExtHostTerminalService"),ExtHostTerminalShellIntegration:le("ExtHostTerminalShellIntegration"),ExtHostSCM:le("ExtHostSCM"),ExtHostSearch:le("ExtHostSearch"),ExtHostTask:le("ExtHostTask"),ExtHostWorkspace:le("ExtHostWorkspace"),ExtHostWindow:le("ExtHostWindow"),ExtHostWebviews:le("ExtHostWebviews"),ExtHostWebviewPanels:le("ExtHostWebviewPanels"),ExtHostCustomEditors:le("ExtHostCustomEditors"),ExtHostWebviewViews:le("ExtHostWebviewViews"),ExtHostEditorInsets:le("ExtHostEditorInsets"),ExtHostEditorTabs:le("ExtHostEditorTabs"),ExtHostProgress:le("ExtHostProgress"),ExtHostComments:le("ExtHostComments"),ExtHostSecretState:le("ExtHostSecretState"),ExtHostStorage:le("ExtHostStorage"),ExtHostUrls:le("ExtHostUrls"),ExtHostUriOpeners:le("ExtHostUriOpeners"),ExtHostProfileContentHandlers:le("ExtHostProfileContentHandlers"),ExtHostOutputService:le("ExtHostOutputService"),ExtHostLabelService:le("ExtHostLabelService"),ExtHostNotebook:le("ExtHostNotebook"),ExtHostNotebookDocuments:le("ExtHostNotebookDocuments"),ExtHostNotebookEditors:le("ExtHostNotebookEditors"),ExtHostNotebookKernels:le("ExtHostNotebookKernels"),ExtHostNotebookRenderers:le("ExtHostNotebookRenderers"),ExtHostNotebookDocumentSaveParticipant:le("ExtHostNotebookDocumentSaveParticipant"),ExtHostInteractive:le("ExtHostInteractive"),ExtHostChatAgents2:le("ExtHostChatAgents"),ExtHostLanguageModelTools:le("ExtHostChatSkills"),ExtHostChatProvider:le("ExtHostChatProvider"),ExtHostSpeech:le("ExtHostSpeech"),ExtHostEmbeddings:le("ExtHostEmbeddings"),ExtHostAiRelatedInformation:le("ExtHostAiRelatedInformation"),ExtHostAiEmbeddingVector:le("ExtHostAiEmbeddingVector"),ExtHostAiSettingsSearch:le("ExtHostAiSettingsSearch"),ExtHostTheming:le("ExtHostTheming"),ExtHostTunnelService:le("ExtHostTunnelService"),ExtHostManagedSockets:le("ExtHostManagedSockets"),ExtHostAuthentication:le("ExtHostAuthentication"),ExtHostTimeline:le("ExtHostTimeline"),ExtHostTesting:le("ExtHostTesting"),ExtHostTelemetry:le("ExtHostTelemetry"),ExtHostLocalization:le("ExtHostLocalization"),ExtHostMcp:le("ExtHostMcp")},L5e="workbench.view.debug",L9="workbench.panel.repl.view";new O("debugType",void 0,{type:"string",description:h(5988,"Debug type of the active debug session. For example 'python'.")});new O("debugConfigurationType",void 0,{type:"string",description:h(5989,"Debug type of the selected launch configuration. For example 'python'.")});new O("debugState","inactive",{type:"string",description:h(5990,"State that the focused debug session is in. One of the following: 'inactive', 'initializing', 'stopped' or 'running'.")});const bEe="debugUx";new O(bEe,"default",{type:"string",description:h(5991,"Debug UX state. When there are no debug configurations it is 'simple', otherwise 'default'. Used to decide when to show welcome views in the debug viewlet.")});new O("hasDebugged",!1,{type:"boolean",description:h(5992,"True when a debug session has been started at least once, false otherwise.")});new O("inDebugMode",!1,{type:"boolean",description:h(5993,"True when debugging, false otherwise.")});new O("inDebugRepl",!1,{type:"boolean",description:h(5994,"True when focus is in the debug console, false otherwise.")});new O("breakpointWidgetVisible",!1,{type:"boolean",description:h(5995,"True when breakpoint editor zone widget is visible, false otherwise.")});new O("inBreakpointWidget",!1,{type:"boolean",description:h(5996,"True when focus is in the breakpoint editor zone widget, false otherwise.")});new O("breakpointsFocused",!0,{type:"boolean",description:h(5997,"True when the BREAKPOINTS view is focused, false otherwise.")});new O("watchExpressionsFocused",!0,{type:"boolean",description:h(5998,"True when the WATCH view is focused, false otherwise.")});new O("watchExpressionsExist",!1,{type:"boolean",description:h(5999,"True when at least one watch expression exists, false otherwise.")});new O("variablesFocused",!0,{type:"boolean",description:h(6e3,"True when the VARIABLES views is focused, false otherwise")});new O("expressionSelected",!1,{type:"boolean",description:h(6001,"True when an expression input box is open in either the WATCH or the VARIABLES view, false otherwise.")});new O("breakpointInputFocused",!1,{type:"boolean",description:h(6002,"True when the input box has focus in the BREAKPOINTS view.")});new O("callStackItemType",void 0,{type:"string",description:h(6003,"Represents the item type of the focused element in the CALL STACK view. For example: 'session', 'thread', 'stackFrame'")});new O("callStackSessionIsAttach",!1,{type:"boolean",description:h(6004,"True when the session in the CALL STACK view is attach, false otherwise. Used internally for inline menus in the CALL STACK view.")});new O("callStackItemStopped",!1,{type:"boolean",description:h(6005,"True when the focused item in the CALL STACK is stopped. Used internaly for inline menus in the CALL STACK view.")});new O("callStackSessionHasOneThread",!1,{type:"boolean",description:h(6006,"True when the focused session in the CALL STACK view has exactly one thread. Used internally for inline menus in the CALL STACK view.")});new O("callStackFocused",!0,{type:"boolean",description:h(6007,"True when the CALLSTACK view is focused, false otherwise.")});new O("watchItemType",void 0,{type:"string",description:h(6008,"Represents the item type of the focused element in the WATCH view. For example: 'expression', 'variable'")});new O("canViewMemory",void 0,{type:"boolean",description:h(6009,"Indicates whether the item in the view has an associated memory refrence.")});new O("breakpointItemType",void 0,{type:"string",description:h(6010,"Represents the item type of the focused element in the BREAKPOINTS view. For example: 'breakpoint', 'exceptionBreakppint', 'functionBreakpoint', 'dataBreakpoint'")});new O("breakpointItemBytes",void 0,{type:"boolean",description:h(6011,"Whether the breakpoint item is a data breakpoint on a byte range.")});new O("breakpointHasModes",!1,{type:"boolean",description:h(6012,"Whether the breakpoint has multiple modes it can switch to.")});new O("breakpointSupportsCondition",!1,{type:"boolean",description:h(6013,"True when the focused breakpoint supports conditions.")});new O("loadedScriptsSupported",!1,{type:"boolean",description:h(6014,"True when the focused sessions supports the LOADED SCRIPTS view")});new O("loadedScriptsItemType",void 0,{type:"string",description:h(6015,"Represents the item type of the focused element in the LOADED SCRIPTS view.")});new O("focusedSessionIsAttach",!1,{type:"boolean",description:h(6016,"True when the focused session is 'attach'.")});new O("focusedSessionIsNoDebug",!1,{type:"boolean",description:h(6017,"True when the focused session is run without debugging.")});new O("stepBackSupported",!1,{type:"boolean",description:h(6018,"True when the focused session supports 'stepBack' requests.")});new O("restartFrameSupported",!1,{type:"boolean",description:h(6019,"True when the focused session supports 'restartFrame' requests.")});new O("stackFrameSupportsRestart",!1,{type:"boolean",description:h(6020,"True when the focused stack frame supports 'restartFrame'.")});new O("jumpToCursorSupported",!1,{type:"boolean",description:h(6021,"True when the focused session supports 'jumpToCursor' request.")});new O("stepIntoTargetsSupported",!1,{type:"boolean",description:h(6022,"True when the focused session supports 'stepIntoTargets' request.")});new O("breakpointsExist",!1,{type:"boolean",description:h(6023,"True when at least one breakpoint exists.")});new O("debuggersAvailable",!1,{type:"boolean",description:h(6024,"True when there is at least one debug extensions active.")});new O("debugExtensionAvailable",!0,{type:"boolean",description:h(6025,"True when there is at least one debug extension installed and enabled.")});new O("debugProtocolVariableMenuContext",void 0,{type:"string",description:h(6026,"Represents the context the debug adapter sets on the focused variable in the VARIABLES view.")});new O("debugSetVariableSupported",!1,{type:"boolean",description:h(6027,"True when the focused session supports 'setVariable' request.")});new O("debugSetDataBreakpointAddressSupported",!1,{type:"boolean",description:h(6028,"True when the focused session supports 'getBreakpointInfo' request on an address.")});new O("debugSetExpressionSupported",!1,{type:"boolean",description:h(6029,"True when the focused session supports 'setExpression' request.")});new O("breakWhenValueChangesSupported",!1,{type:"boolean",description:h(6030,"True when the focused session supports to break when value changes.")});new O("breakWhenValueIsAccessedSupported",!1,{type:"boolean",description:h(6031,"True when the focused breakpoint supports to break when value is accessed.")});new O("breakWhenValueIsReadSupported",!1,{type:"boolean",description:h(6032,"True when the focused breakpoint supports to break when value is read.")});new O("terminateDebuggeeSupported",!1,{type:"boolean",description:h(6033,"True when the focused session supports the terminate debuggee capability.")});new O("suspendDebuggeeSupported",!1,{type:"boolean",description:h(6034,"True when the focused session supports the suspend debuggee capability.")});new O("variableEvaluateNamePresent",!1,{type:"boolean",description:h(6035,"True when the focused variable has an 'evalauteName' field set.")});new O("variableIsReadonly",!1,{type:"boolean",description:h(6036,"True when the focused variable is read-only.")});new O("variableValue",!1,{type:"string",description:h(6037,"Value of the variable, present for debug visualization clauses.")});new O("variableType",!1,{type:"string",description:h(6038,"Type of the variable, present for debug visualization clauses.")});new O("variableInterfaces",!1,{type:"array",description:h(6039,"Any interfaces or contracts that the variable satisfies, present for debug visualization clauses.")});new O("variableName",!1,{type:"string",description:h(6040,"Name of the variable, present for debug visualization clauses.")});new O("variableLanguage",!1,{type:"string",description:h(6041,"Language of the variable source, present for debug visualization clauses.")});new O("variableExtensionId",!1,{type:"string",description:h(6042,"Extension ID of the variable source, present for debug visualization clauses.")});new O("exceptionWidgetVisible",!1,{type:"boolean",description:h(6043,"True when the exception widget is visible.")});new O("multiSessionRepl",!1,{type:"boolean",description:h(6044,"True when there is more than 1 debug console.")});new O("multiSessionDebug",!1,{type:"boolean",description:h(6045,"True when there is more than 1 active debug session.")});new O("disassembleRequestSupported",!1,{type:"boolean",description:h(6046,"True when the focused sessions supports disassemble request.")});new O("disassemblyViewFocus",!1,{type:"boolean",description:h(6047,"True when the Disassembly View is focused.")});new O("languageSupportsDisassembleRequest",!1,{type:"boolean",description:h(6048,"True when the language in the current editor supports disassemble request.")});new O("focusedStackFrameHasInstructionReference",!1,{type:"boolean",description:h(6049,"True when the focused stack frame has instruction pointer reference.")});h(6051,"Controls when the internal Debug Console should open.");var M9;(function(s){s[s.Inactive=0]="Inactive",s[s.Initializing=1]="Initializing",s[s.Stopped=2]="Stopped",s[s.Running=3]="Running"})(M9||(M9={}));var N9;(function(s){s[s.Valid=0]="Valid",s[s.Unreadable=1]="Unreadable",s[s.Error=2]="Error"})(N9||(N9={}));var PA;(function(s){s[s.Variable=0]="Variable",s[s.Address=1]="Address"})(PA||(PA={}));var O9;(function(s){s[s.Initial=1]="Initial",s[s.Dynamic=2]="Dynamic"})(O9||(O9={}));var F9;(function(s){s.UnverifiedBreakpoints="unverifiedBreakpoints"})(F9||(F9={}));var W9;(function(s){s[s.CONDITION=0]="CONDITION",s[s.HIT_COUNT=1]="HIT_COUNT",s[s.LOG_MESSAGE=2]="LOG_MESSAGE",s[s.TRIGGER_POINT=3]="TRIGGER_POINT"})(W9||(W9={}));var B9;(function(s){s[s.Command=0]="Command",s[s.Tree=1]="Tree"})(B9||(B9={}));var jW;(function(s){s[s.None=0]="None",s[s.Collapsed=1]="Collapsed",s[s.Expanded=2]="Expanded"})(jW||(jW={}));var V9;(function(s){s.deserialize=e=>e,s.serialize=e=>e})(V9||(V9={}));var YW;(function(s){s.deserialize=e=>({id:e.id,name:e.name,iconPath:e.iconPath&&{light:R.revive(e.iconPath.light),dark:R.revive(e.iconPath.dark)},iconClass:e.iconClass,visualization:e.visualization}),s.serialize=e=>e})(YW||(YW={}));var yy;(function(s){s[s.Desktop=1]="Desktop",s[s.Web=2]="Web"})(yy||(yy={}));var NC;(function(s){s[s.VersionMismatch=55]="VersionMismatch",s[s.UnexpectedError=81]="UnexpectedError"})(NC||(NC={}));var Ca;(function(s){s[s.Initialized=0]="Initialized",s[s.Ready=1]="Ready",s[s.Terminate=2]="Terminate"})(Ca||(Ca={}));function ere(s){const e=Le.alloc(1);switch(s){case Ca.Initialized:e.writeUInt8(1,0);break;case Ca.Ready:e.writeUInt8(2,0);break;case Ca.Terminate:e.writeUInt8(3,0);break}return e}function LA(s,e){if(s.byteLength!==1)return!1;switch(s.readUInt8(0)){case 1:return e===Ca.Initialized;case 2:return e===Ca.Ready;case 3:return e===Ca.Terminate;default:return!1}}var H9;(function(s){s.Start="START_NATIVE_LOG",s.End="END_NATIVE_LOG"})(H9||(H9={}));class M5e{constructor(e,t,i){this.uri=e,this.ranges=t,this.previewText=i}}class N5e{constructor(e,t,i){this.uri=e,this.text=t,this.lineNumber=i}}class O5e{constructor(e){this.keyword=e}}var U9;(function(s){s[s.None=1]="None",s[s.FilesExclude=2]="FilesExclude",s[s.SearchAndFilesExclude=3]="SearchAndFilesExclude"})(U9||(U9={}));var $9;(function(s){s[s.Information=1]="Information",s[s.Warning=2]="Warning"})($9||($9={}));const Fh=J("accessibleViewService"),tre=J("extensionHostDebugService"),yEe="diagnosticsService";class wEe{async getPerformanceInfo(e,t){return{}}async getSystemInfo(e,t){return{processArgs:"nullProcessArgs",gpuStatus:"nullGpuStatus",screenReader:"nullScreenReader",remoteData:[],os:"nullOs",memory:"nullMemory",vmHint:"nullVmHint"}}async getDiagnostics(e,t){return""}async getWorkspaceFileExtensions(e){return{extensions:[]}}async reportWorkspaceStats(e){}}const SEe=J(yEe),CEe=J("encryptionService"),yq=J("extensionGalleryService"),CI=J("extensionManagementService"),ire=J("IGlobalExtensionEnablementService"),EEe=J("IExtensionTipsService"),xEe=J("IAllowedExtensionsService"),wq=J("IExtensionStorageService"),IN=J("IExtensionsProfileScannerService"),IEe=J("IExtensionsScannerService"),DEe=J("IExtensionRecommendationNotificationService"),Sq=J("extensionResourceLoaderService"),kEe=J("IBuiltinExtensionsScannerService"),TEe=J("keyboardLayoutService"),nre=J("languagePackService"),Wh=J("remoteAuthorityResolverService"),DN=J("IRemoteExtensionsScannerService"),Cq=J("remoteSocketFactoryService"),kN=J("secretStorageService"),AEe="signService",sre=J(AEe);var G9;(function(s){s.AutomationProfile="terminal.integrated.automationProfile.",s.DefaultProfile="terminal.integrated.defaultProfile.",s.Profiles="terminal.integrated.profiles."})(G9||(G9={}));var $c;(function(s){s.SendKeybindingsToShell="terminal.integrated.sendKeybindingsToShell",s.AutomationProfileLinux="terminal.integrated.automationProfile.linux",s.AutomationProfileMacOs="terminal.integrated.automationProfile.osx",s.AutomationProfileWindows="terminal.integrated.automationProfile.windows",s.ProfilesWindows="terminal.integrated.profiles.windows",s.ProfilesMacOs="terminal.integrated.profiles.osx",s.ProfilesLinux="terminal.integrated.profiles.linux",s.DefaultProfileLinux="terminal.integrated.defaultProfile.linux",s.DefaultProfileMacOs="terminal.integrated.defaultProfile.osx",s.DefaultProfileWindows="terminal.integrated.defaultProfile.windows",s.UseWslProfiles="terminal.integrated.useWslProfiles",s.TabsDefaultColor="terminal.integrated.tabs.defaultColor",s.TabsDefaultIcon="terminal.integrated.tabs.defaultIcon",s.TabsEnabled="terminal.integrated.tabs.enabled",s.TabsEnableAnimation="terminal.integrated.tabs.enableAnimation",s.TabsHideCondition="terminal.integrated.tabs.hideCondition",s.TabsShowActiveTerminal="terminal.integrated.tabs.showActiveTerminal",s.TabsShowActions="terminal.integrated.tabs.showActions",s.TabsLocation="terminal.integrated.tabs.location",s.TabsFocusMode="terminal.integrated.tabs.focusMode",s.MacOptionIsMeta="terminal.integrated.macOptionIsMeta",s.MacOptionClickForcesSelection="terminal.integrated.macOptionClickForcesSelection",s.AltClickMovesCursor="terminal.integrated.altClickMovesCursor",s.CopyOnSelection="terminal.integrated.copyOnSelection",s.EnableMultiLinePasteWarning="terminal.integrated.enableMultiLinePasteWarning",s.DrawBoldTextInBrightColors="terminal.integrated.drawBoldTextInBrightColors",s.FontFamily="terminal.integrated.fontFamily",s.FontSize="terminal.integrated.fontSize",s.LetterSpacing="terminal.integrated.letterSpacing",s.LineHeight="terminal.integrated.lineHeight",s.MinimumContrastRatio="terminal.integrated.minimumContrastRatio",s.TabStopWidth="terminal.integrated.tabStopWidth",s.FastScrollSensitivity="terminal.integrated.fastScrollSensitivity",s.MouseWheelScrollSensitivity="terminal.integrated.mouseWheelScrollSensitivity",s.BellDuration="terminal.integrated.bellDuration",s.FontWeight="terminal.integrated.fontWeight",s.FontWeightBold="terminal.integrated.fontWeightBold",s.CursorBlinking="terminal.integrated.cursorBlinking",s.CursorStyle="terminal.integrated.cursorStyle",s.CursorStyleInactive="terminal.integrated.cursorStyleInactive",s.CursorWidth="terminal.integrated.cursorWidth",s.Scrollback="terminal.integrated.scrollback",s.DetectLocale="terminal.integrated.detectLocale",s.DefaultLocation="terminal.integrated.defaultLocation",s.GpuAcceleration="terminal.integrated.gpuAcceleration",s.TerminalTitleSeparator="terminal.integrated.tabs.separator",s.TerminalTitle="terminal.integrated.tabs.title",s.TerminalDescription="terminal.integrated.tabs.description",s.RightClickBehavior="terminal.integrated.rightClickBehavior",s.MiddleClickBehavior="terminal.integrated.middleClickBehavior",s.Cwd="terminal.integrated.cwd",s.ConfirmOnExit="terminal.integrated.confirmOnExit",s.ConfirmOnKill="terminal.integrated.confirmOnKill",s.EnableBell="terminal.integrated.enableBell",s.EnableVisualBell="terminal.integrated.enableVisualBell",s.CommandsToSkipShell="terminal.integrated.commandsToSkipShell",s.AllowChords="terminal.integrated.allowChords",s.AllowMnemonics="terminal.integrated.allowMnemonics",s.TabFocusMode="terminal.integrated.tabFocusMode",s.EnvMacOs="terminal.integrated.env.osx",s.EnvLinux="terminal.integrated.env.linux",s.EnvWindows="terminal.integrated.env.windows",s.EnvironmentChangesIndicator="terminal.integrated.environmentChangesIndicator",s.EnvironmentChangesRelaunch="terminal.integrated.environmentChangesRelaunch",s.ShowExitAlert="terminal.integrated.showExitAlert",s.SplitCwd="terminal.integrated.splitCwd",s.WindowsEnableConpty="terminal.integrated.windowsEnableConpty",s.WindowsUseConptyDll="terminal.integrated.windowsUseConptyDll",s.WordSeparators="terminal.integrated.wordSeparators",s.EnableFileLinks="terminal.integrated.enableFileLinks",s.AllowedLinkSchemes="terminal.integrated.allowedLinkSchemes",s.UnicodeVersion="terminal.integrated.unicodeVersion",s.EnablePersistentSessions="terminal.integrated.enablePersistentSessions",s.PersistentSessionReviveProcess="terminal.integrated.persistentSessionReviveProcess",s.HideOnStartup="terminal.integrated.hideOnStartup",s.HideOnLastClosed="terminal.integrated.hideOnLastClosed",s.CustomGlyphs="terminal.integrated.customGlyphs",s.RescaleOverlappingGlyphs="terminal.integrated.rescaleOverlappingGlyphs",s.PersistentSessionScrollback="terminal.integrated.persistentSessionScrollback",s.InheritEnv="terminal.integrated.inheritEnv",s.ShowLinkHover="terminal.integrated.showLinkHover",s.IgnoreProcessNames="terminal.integrated.ignoreProcessNames",s.ShellIntegrationEnabled="terminal.integrated.shellIntegration.enabled",s.ShellIntegrationShowWelcome="terminal.integrated.shellIntegration.showWelcome",s.ShellIntegrationDecorationsEnabled="terminal.integrated.shellIntegration.decorationsEnabled",s.ShellIntegrationEnvironmentReporting="terminal.integrated.shellIntegration.environmentReporting",s.EnableImages="terminal.integrated.enableImages",s.SmoothScrolling="terminal.integrated.smoothScrolling",s.IgnoreBracketedPasteMode="terminal.integrated.ignoreBracketedPasteMode",s.FocusAfterRun="terminal.integrated.focusAfterRun",s.FontLigaturesEnabled="terminal.integrated.fontLigatures.enabled",s.FontLigaturesFeatureSettings="terminal.integrated.fontLigatures.featureSettings",s.FontLigaturesFallbackLigatures="terminal.integrated.fontLigatures.fallbackLigatures",s.DeveloperPtyHostLatency="terminal.integrated.developer.ptyHost.latency",s.DeveloperPtyHostStartupDelay="terminal.integrated.developer.ptyHost.startupDelay",s.DevMode="terminal.integrated.developer.devMode"})($c||($c={}));var z9;(function(s){s.Bash="bash",s.Fish="fish",s.Sh="sh",s.Csh="csh",s.Ksh="ksh",s.Zsh="zsh"})(z9||(z9={}));var q9;(function(s){s.CommandPrompt="cmd",s.Wsl="wsl",s.GitBash="gitbash"})(q9||(q9={}));var K9;(function(s){s.PowerShell="pwsh",s.Python="python",s.Julia="julia",s.NuShell="nu",s.Node="node"})(K9||(K9={}));var j9;(function(s){s[s.Api=0]="Api",s[s.Process=1]="Process",s[s.Sequence=2]="Sequence",s[s.Config=3]="Config"})(j9||(j9={}));var Y9;(function(s){s.LocalPty="localPty",s.PtyHost="ptyHost",s.PtyHostWindow="ptyHostWindow",s.Logger="logger",s.Heartbeat="heartbeat"})(Y9||(Y9={}));var Vd;(function(s){s.Cwd="cwd",s.InitialCwd="initialCwd",s.FixedDimensions="fixedDimensions",s.Title="title",s.ShellType="shellType",s.HasChildProcesses="hasChildProcesses",s.ResolvedShellLaunchConfig="resolvedShellLaunchConfig",s.OverrideDimensions="overrideDimensions",s.FailedShellIntegrationActivation="failedShellIntegrationActivation",s.UsedShellIntegrationInjection="usedShellIntegrationInjection",s.ShellIntegrationInjectionFailureReason="shellIntegrationInjectionFailureReason"})(Vd||(Vd={}));var Q9;(function(s){s[s.BeatInterval=5e3]="BeatInterval",s[s.ConnectingBeatInterval=2e4]="ConnectingBeatInterval",s[s.FirstWaitMultiplier=1.2]="FirstWaitMultiplier",s[s.SecondWaitMultiplier=1]="SecondWaitMultiplier",s[s.CreateProcessTimeout=5e3]="CreateProcessTimeout"})(Q9||(Q9={}));var wy;(function(s){s[s.Panel=1]="Panel",s[s.Editor=2]="Editor"})(wy||(wy={}));var X9;(function(s){s.TerminalView="view",s.Editor="editor"})(X9||(X9={}));var Z9;(function(s){s[s.GraceTime=6e4]="GraceTime",s[s.ShortGraceTime=6e3]="ShortGraceTime"})(Z9||(Z9={}));var J9;(function(s){s[s.HighWatermarkChars=1e5]="HighWatermarkChars",s[s.LowWatermarkChars=5e3]="LowWatermarkChars",s[s.CharCountAckSize=5e3]="CharCountAckSize"})(J9||(J9={}));var ej;(function(s){s.GitBash="Git Bash",s.Pwsh="PowerShell"})(ej||(ej={}));var tj;(function(s){s[s.Off=0]="Off",s[s.FinalTerm=1]="FinalTerm",s[s.VSCode=2]="VSCode"})(tj||(tj={}));var ij;(function(s){s.InjectionSettingDisabled="injectionSettingDisabled",s.NoExecutable="noExecutable",s.FeatureTerminal="featureTerminal",s.IgnoreShellIntegrationFlag="ignoreShellIntegrationFlag",s.Winpty="winpty",s.UnsupportedArgs="unsupportedArgs",s.UnsupportedShell="unsupportedShell",s.FailedToSetStickyBit="failedToSetStickyBit",s.FailedToCreateTmpDir="failedToCreateTmpDir"})(ij||(ij={}));var Am;(function(s){s[s.Unknown=0]="Unknown",s[s.Shutdown=1]="Shutdown",s[s.Process=2]="Process",s[s.User=3]="User",s[s.Extension=4]="Extension"})(Am||(Am={}));const REe={Backend:"workbench.contributions.terminal.processBackend"};function QW(s){return s?.toLowerCase()??""}class PEe{constructor(e){this.remoteAuthority=e}affects(e){return QW(e)===this.remoteAuthority}}class LEe{constructor(){this._backends=new Map,this._onDidChangeBackends=new M,this.onDidChangeBackends=this._onDidChangeBackends.event}get backends(){return this._backends}registerTerminalBackend(e){const t=QW(e.remoteAuthority);if(this._backends.has(t))throw new Error(`A terminal backend with remote authority '${t}' was already registered.`);this._backends.set(t,e),this._onDidChangeBackends.fire(new PEe(t))}getTerminalBackend(e){return this._backends.get(QW(e))}}Ke.add(REe.Backend,new LEe);const MEe=J("terminalLogService"),TN=J("tunnelService");var Gd;(function(s){s.Uninitialized="uninitialized",s.Idle="idle",s.Disabled="disabled",s.CheckingForUpdates="checking for updates",s.AvailableForDownload="available for download",s.Downloading="downloading",s.Downloaded="downloaded",s.Updating="updating",s.Ready="ready"})(Gd||(Gd={}));var nj;(function(s){s[s.Setup=0]="Setup",s[s.Archive=1]="Archive",s[s.Snap=2]="Snap"})(nj||(nj={}));var sj;(function(s){s[s.NotBuilt=0]="NotBuilt",s[s.DisabledByEnvironment=1]="DisabledByEnvironment",s[s.ManuallyDisabled=2]="ManuallyDisabled",s[s.MissingConfiguration=3]="MissingConfiguration",s[s.InvalidConfiguration=4]="InvalidConfiguration",s[s.RunningAsAdmin=5]="RunningAsAdmin"})(sj||(sj={}));const NEe={Uninitialized:yF({type:Gd.Uninitialized}),Downloading:yF({type:Gd.Downloading})},ore=J("updateService");var oj;let g1=class{constructor(e,t,i){this.level=e,this.key=t,this.value=i,this.forward=[]}};const IS=void 0;class Jf{constructor(e,t=2**16){this.comparator=e,this[oj]="SkipList",this._level=0,this._size=0,this._maxLevel=Math.max(1,Math.log2(t)|0),this._header=new g1(this._maxLevel,IS,IS)}get size(){return this._size}clear(){this._header=new g1(this._maxLevel,IS,IS),this._size=0}has(e){return!!Jf._search(this,e,this.comparator)}get(e){return Jf._search(this,e,this.comparator)?.value}set(e,t){return Jf._insert(this,e,t,this.comparator)&&(this._size+=1),this}delete(e){const t=Jf._delete(this,e,this.comparator);return t&&(this._size-=1),t}forEach(e,t){let i=this._header.forward[0];for(;i;)e.call(t,i.value,i.key,this),i=i.forward[0]}[(oj=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}*entries(){let e=this._header.forward[0];for(;e;)yield[e.key,e.value],e=e.forward[0]}*keys(){let e=this._header.forward[0];for(;e;)yield e.key,e=e.forward[0]}*values(){let e=this._header.forward[0];for(;e;)yield e.value,e=e.forward[0]}toString(){let e="[SkipList]:",t=this._header.forward[0];for(;t;)e+=`node(${t.key}, ${t.value}, lvl:${t.level})`,t=t.forward[0];return e}static _search(e,t,i){let n=e._header;for(let o=e._level-1;o>=0;o--)for(;n.forward[o]&&i(n.forward[o].key,t)<0;)n=n.forward[o];if(n=n.forward[0],n&&i(n.key,t)===0)return n}static _insert(e,t,i,n){const o=[];let r=e._header;for(let a=e._level-1;a>=0;a--){for(;r.forward[a]&&n(r.forward[a].key,t)<0;)r=r.forward[a];o[a]=r}if(r=r.forward[0],r&&n(r.key,t)===0)return r.value=i,!1;{const a=Jf._randomLevel(e);if(a>e._level){for(let c=e._level;c<a;c++)o[c]=e._header;e._level=a}r=new g1(a,t,i);for(let c=0;c<a;c++)r.forward[c]=o[c].forward[c],o[c].forward[c]=r;return!0}}static _randomLevel(e,t=.5){let i=1;for(;Math.random()<t&&i<e._maxLevel;)i+=1;return i}static _delete(e,t,i){const n=[];let o=e._header;for(let r=e._level-1;r>=0;r--){for(;o.forward[r]&&i(o.forward[r].key,t)<0;)o=o.forward[r];n[r]=o}if(o=o.forward[0],!o||i(o.key,t)!==0)return!1;for(let r=0;r<e._level&&n[r].forward[r]===o;r++)n[r].forward[r]=o.forward[r];for(;e._level>0&&e._header.forward[e._level-1]===IS;)e._level-=1;return!0}}class HE{static{this._clock=0}constructor(e){this.uri=e,this.time=HE._clock++}touch(){return this.time=HE._clock++,this}}let XW=class{constructor(e){this._fileService=e,this._dispooables=new U,this._limit=2**16;const t=new Map,i=n=>{let o=t.get(n.scheme);return o===void 0&&(o=e.hasProvider(n)&&!this._fileService.hasCapability(n,hh.PathCaseSensitive),t.set(n.scheme,o)),o};this._dispooables.add(T.any(e.onDidChangeFileSystemProviderRegistrations,e.onDidChangeFileSystemProviderCapabilities)(n=>{t.delete(n.scheme)})),this.extUri=new zfe(i),this._canonicalUris=new Jf((n,o)=>this.extUri.compare(n,o,!0),this._limit)}dispose(){this._dispooables.dispose(),this._canonicalUris.clear()}asCanonicalUri(e){this._fileService.hasProvider(e)&&(e=qfe(e));const t=this._canonicalUris.get(e);return t?t.touch().uri.with({fragment:e.fragment}):(this._canonicalUris.set(e,new HE(e)),this._checkTrim(),e)}_checkTrim(){if(this._canonicalUris.size<this._limit)return;const e=[...this._canonicalUris.entries()].sort((i,n)=>i[1].time<n[1].time?1:i[1].time>n[1].time?-1:0);HE._clock=0,this._canonicalUris.clear();const t=this._limit*.5;for(let i=0;i<t;i++)this._canonicalUris.set(e[i][0],e[i][1].touch())}};XW=f([p(0,je)],XW);const OEe=J("IUserDataProfileStorageService"),FEe=J("IIgnoredExtensionsManagementService");var Vl;(function(s){s.Settings="settings",s.Keybindings="keybindings",s.Snippets="snippets",s.Prompts="prompts",s.Tasks="tasks",s.Extensions="extensions",s.GlobalState="globalState",s.Profiles="profiles",s.WorkspaceState="workspaceState"})(Vl||(Vl={}));Vl.Settings,Vl.Keybindings,Vl.Snippets,Vl.Prompts,Vl.Tasks,Vl.Extensions,Vl.GlobalState,Vl.Profiles;var ZW;(function(s){s.Unauthorized="Unauthorized",s.Forbidden="Forbidden",s.NotFound="NotFound",s.MethodNotFound="MethodNotFound",s.Conflict="Conflict",s.Gone="Gone",s.PreconditionFailed="PreconditionFailed",s.TooLarge="TooLarge",s.UpgradeRequired="UpgradeRequired",s.PreconditionRequired="PreconditionRequired",s.TooManyRequests="RemoteTooManyRequests",s.TooManyRequestsAndRetryAfter="TooManyRequestsAndRetryAfter",s.RequestFailed="RequestFailed",s.RequestCanceled="RequestCanceled",s.RequestTimeout="RequestTimeout",s.RequestProtocolNotSupported="RequestProtocolNotSupported",s.RequestPathNotEscaped="RequestPathNotEscaped",s.RequestHeadersNotObject="RequestHeadersNotObject",s.NoCollection="NoCollection",s.NoRef="NoRef",s.EmptyResponse="EmptyResponse",s.TurnedOff="TurnedOff",s.SessionExpired="SessionExpired",s.ServiceChanged="ServiceChanged",s.DefaultServiceChanged="DefaultServiceChanged",s.LocalTooManyProfiles="LocalTooManyProfiles",s.LocalTooManyRequests="LocalTooManyRequests",s.LocalPreconditionFailed="LocalPreconditionFailed",s.LocalInvalidContent="LocalInvalidContent",s.LocalError="LocalError",s.IncompatibleLocalContent="IncompatibleLocalContent",s.IncompatibleRemoteContent="IncompatibleRemoteContent",s.Unknown="Unknown"})(ZW||(ZW={}));class rj extends Error{constructor(e,t,i,n){super(e),this.code=t,this.resource=i,this.operationId=n,this.name=`${this.code} (UserDataSyncError) syncResource:${this.resource||"unknown"} operationId:${this.operationId||"unknown"}`}}(function(s){function e(t){if(t instanceof s)return t;const i=/^(.+) \(UserDataSyncError\) syncResource:(.+) operationId:(.+)$/.exec(t.name);if(i&&i[1]){const n=i[2]==="unknown"?void 0:i[2],o=i[3]==="unknown"?void 0:i[3];return new s(t.message,i[1],n,o)}return new s(t.message,ZW.Unknown)}s.toUserDataSyncError=e})(rj||(rj={}));var UE;(function(s){s.Uninitialized="uninitialized",s.Idle="idle",s.Syncing="syncing",s.HasConflicts="hasConflicts"})(UE||(UE={}));var aj;(function(s){s[s.None=0]="None",s[s.Added=1]="Added",s[s.Modified=2]="Modified",s[s.Deleted=3]="Deleted"})(aj||(aj={}));var cj;(function(s){s.Preview="preview",s.Conflict="conflict",s.Accepted="accepted"})(cj||(cj={}));const WEe=J("IUserDataSyncStoreManagementService"),BEe=J("IUserDataSyncStoreService"),VEe=J("IUserDataSyncLocalStoreService"),HEe=J("IUserDataSyncEnablementService"),UEe=J("IUserDataSyncService"),$Ee=J("IUserDataSyncResourceProviderService"),GEe=J("IUserDataAutoSyncService"),zEe=J("IUserDataSyncUtilService"),qEe=J("IUserDataSyncLogService"),KEe=J("IUserDataSyncAccountService"),jEe=J("IUserDataSyncMachinesService"),Eq=J("editSessionIdentityService");var dj;(function(s){s[s.Local=0]="Local",s[s.Remote=1]="Remote"})(dj||(dj={}));var Hd;(function(s){s[s.Open=1]="Open",s[s.OpenInNewWindow=2]="OpenInNewWindow",s[s.Cancel=3]="Cancel"})(Hd||(Hd={}));var ov;(function(s){s[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT"})(ov||(ov={}));function YEe(s){const e=s;return typeof e?.location?.id=="string"&&typeof e.alignment=="number"}function B5e(s){const e=s;return(typeof e?.primary=="number"||YEe(e?.primary))&&typeof e?.secondary=="number"}const V5e={id:"statusBar.entry.showTooltip",title:""},H5e=["standard","warning","error","prominent","remote","offline"];function U5e(s){const e=s;return!!e?.content&&Array.isArray(e?.commands)}const AN=J("statusbarService");function QEe(s){switch(s.type){case Ck.LIGHT:return ye.fromHex("#F3F3F3");case Ck.HIGH_CONTRAST_LIGHT:return ye.fromHex("#FFFFFF");case Ck.HIGH_CONTRAST_DARK:return ye.fromHex("#000000");default:return ye.fromHex("#252526")}}const xq=H("tab.activeBackground",ss,h(3860,"Active tab background color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),XEe=H("tab.unfocusedActiveBackground",xq,h(3861,"Active tab background color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),rre=H("tab.inactiveBackground",{dark:"#2D2D2D",light:"#ECECEC",hcDark:null,hcLight:null},h(3862,"Inactive tab background color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),ZEe=H("tab.unfocusedInactiveBackground",rre,h(3863,"Inactive tab background color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),Gp=H("tab.activeForeground",{dark:ye.white,light:"#333333",hcDark:ye.white,hcLight:"#292929"},h(3864,"Active tab foreground color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),lj=H("tab.inactiveForeground",{dark:et(Gp,.5),light:et(Gp,.7),hcDark:ye.white,hcLight:"#292929"},h(3865,"Inactive tab foreground color in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),JEe=H("tab.unfocusedActiveForeground",{dark:et(Gp,.5),light:et(Gp,.7),hcDark:ye.white,hcLight:"#292929"},h(3866,"Active tab foreground color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.unfocusedInactiveForeground",{dark:et(lj,.5),light:et(lj,.5),hcDark:ye.white,hcLight:"#292929"},h(3867,"Inactive tab foreground color in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));const JW=H("tab.hoverBackground",null,h(3868,"Tab background color when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),exe=H("tab.unfocusedHoverBackground",{dark:et(JW,.5),light:et(JW,.7),hcDark:null,hcLight:null},h(3869,"Tab background color in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),eB=H("tab.hoverForeground",null,h(3870,"Tab foreground color when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),txe=H("tab.unfocusedHoverForeground",{dark:et(eB,.5),light:et(eB,.5),hcDark:null,hcLight:null},h(3871,"Tab foreground color in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),tB=H("tab.border",{dark:"#252526",light:"#F3F3F3",hcDark:tt,hcLight:tt},h(3872,"Border to separate tabs from each other. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),ixe=H("tab.lastPinnedBorder",{dark:P6,light:P6,hcDark:tt,hcLight:tt},h(3873,"Border to separate pinned tabs from other tabs. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),MA=H("tab.activeBorder",null,h(3874,"Border on the bottom of an active tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),nxe=H("tab.unfocusedActiveBorder",{dark:et(MA,.5),light:et(MA,.7),hcDark:null,hcLight:null},h(3875,"Border on the bottom of an active tab in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),NA=H("tab.activeBorderTop",{dark:null,light:null,hcDark:null,hcLight:"#B5200D"},h(3876,"Border to the top of an active tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),sxe=H("tab.unfocusedActiveBorderTop",{dark:et(NA,.5),light:et(NA,.7),hcDark:null,hcLight:"#B5200D"},h(3877,"Border to the top of an active tab in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),oxe=H("tab.selectedBorderTop",NA,h(3878,"Border to the top of a selected tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.selectedBackground",xq,h(3879,"Background of a selected tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.selectedForeground",Gp,h(3880,"Foreground of a selected tab. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));const iB=H("tab.hoverBorder",null,h(3881,"Border to highlight tabs when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),rxe=H("tab.unfocusedHoverBorder",{dark:et(iB,.5),light:et(iB,.7),hcDark:null,hcLight:tt},h(3882,"Border to highlight tabs in an unfocused group when hovering. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));H("tab.dragAndDropBorder",{dark:Gp,light:Gp,hcDark:kr,hcLight:kr},h(3883,"Border between tabs to indicate that a tab can be inserted between two tabs. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups."));const $E=H("tab.activeModifiedBorder",{dark:"#3399CC",light:"#33AAEE",hcDark:null,hcLight:tt},h(3884,"Border on the top of modified active tabs in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),nB=H("tab.inactiveModifiedBorder",{dark:et($E,.5),light:et($E,.5),hcDark:ye.white,hcLight:tt},h(3885,"Border on the top of modified inactive tabs in an active group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),axe=H("tab.unfocusedActiveModifiedBorder",{dark:et($E,.5),light:et($E,.7),hcDark:ye.white,hcLight:tt},h(3886,"Border on the top of modified active tabs in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),cxe=H("tab.unfocusedInactiveModifiedBorder",{dark:et(nB,.5),light:et(nB,.5),hcDark:ye.white,hcLight:tt},h(3887,"Border on the top of modified inactive tabs in an unfocused group. Tabs are the containers for editors in the editor area. Multiple tabs can be opened in one editor group. There can be multiple editor groups.")),$5e=H("editorPane.background",ss,h(3888,"Background color of the editor pane visible on the left and right side of the centered editor layout.")),dxe=H("editorGroup.emptyBackground",null,h(3889,"Background color of an empty editor group. Editor groups are the containers of editors."));H("editorGroup.focusedEmptyBorder",{dark:null,light:null,hcDark:PT,hcLight:PT},h(3890,"Border color of an empty editor group that is focused. Editor groups are the containers of editors."));const are=H("editorGroupHeader.tabsBackground",{dark:"#252526",light:"#F3F3F3",hcDark:null,hcLight:null},h(3891,"Background color of the editor group title header when tabs are enabled. Editor groups are the containers of editors.")),lxe=H("editorGroupHeader.tabsBorder",null,h(3892,"Border color of the editor group title header when tabs are enabled. Editor groups are the containers of editors.")),hxe=H("editorGroupHeader.noTabsBackground",ss,h(3893,'Background color of the editor group title header when (`"workbench.editor.showTabs": "single"`). Editor groups are the containers of editors.')),uxe=H("editorGroupHeader.border",{dark:null,light:null,hcDark:tt,hcLight:tt},h(3894,"Border color of the editor group title header. Editor groups are the containers of editors.")),cre=H("editorGroup.border",{dark:"#444444",light:"#E7E7E7",hcDark:tt,hcLight:tt},h(3895,"Color to separate multiple editor groups from each other. Editor groups are the containers of editors.")),RN=H("editorGroup.dropBackground",{dark:ye.fromHex("#53595D").transparent(.5),light:ye.fromHex("#2677CB").transparent(.18),hcDark:null,hcLight:ye.fromHex("#0F4A85").transparent(.5)},h(3896,"Background color when dragging editors around. The color should have transparency so that the editor contents can still shine through.")),G5e=H("editorGroup.dropIntoPromptForeground",Fie,h(3897,"Foreground color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),z5e=H("editorGroup.dropIntoPromptBackground",LM,h(3898,"Background color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),q5e=H("editorGroup.dropIntoPromptBorder",{dark:null,light:null,hcDark:tt,hcLight:tt},h(3899,"Border color of text shown over editors when dragging files. This text informs the user that they can hold shift to drop into the editor.")),gxe=H("sideBySideEditor.horizontalBorder",cre,h(3900,"Color to separate two editors from each other when shown side by side in an editor group from top to bottom.")),pxe=H("sideBySideEditor.verticalBorder",cre,h(3901,"Color to separate two editors from each other when shown side by side in an editor group from left to right.")),fxe=H("outputView.background",null,h(3902,"Output view background color."));H("outputViewStickyScroll.background",fxe,h(3903,"Output view sticky scroll background color."));H("banner.background",{dark:MD,light:yr(MD,.3),hcDark:MD,hcLight:MD},h(3904,"Banner background color. The banner is shown under the title bar of the window."));H("banner.foreground",Kfe,h(3905,"Banner foreground color. The banner is shown under the title bar of the window."));H("banner.iconForeground",wE,h(3906,"Banner icon color. The banner is shown under the title bar of the window."));const mp=H("statusBar.foreground",{dark:"#FFFFFF",light:"#FFFFFF",hcDark:"#FFFFFF",hcLight:po},h(3907,"Status bar foreground color when a workspace or folder is opened. The status bar is shown in the bottom of the window.")),K5e=H("statusBar.noFolderForeground",mp,h(3908,"Status bar foreground color when no folder is opened. The status bar is shown in the bottom of the window.")),j5e=H("statusBar.background",{dark:"#007ACC",light:"#007ACC",hcDark:null,hcLight:null},h(3909,"Status bar background color when a workspace or folder is opened. The status bar is shown in the bottom of the window.")),Y5e=H("statusBar.noFolderBackground",{dark:"#68217A",light:"#68217A",hcDark:null,hcLight:null},h(3910,"Status bar background color when no folder is opened. The status bar is shown in the bottom of the window.")),mxe=H("statusBar.border",{dark:null,light:null,hcDark:tt,hcLight:tt},h(3911,"Status bar border color separating to the sidebar and editor. The status bar is shown in the bottom of the window.")),Q5e=H("statusBar.focusBorder",{dark:mp,light:mp,hcDark:null,hcLight:mp},h(3912,"Status bar border color when focused on keyboard navigation. The status bar is shown in the bottom of the window.")),X5e=H("statusBar.noFolderBorder",mxe,h(3913,"Status bar border color separating to the sidebar and editor when no folder is opened. The status bar is shown in the bottom of the window."));H("statusBarItem.activeBackground",{dark:ye.white.transparent(.18),light:ye.white.transparent(.18),hcDark:ye.white.transparent(.18),hcLight:ye.black.transparent(.18)},h(3914,"Status bar item background color when clicking. The status bar is shown in the bottom of the window."));const Z5e=H("statusBarItem.focusBorder",{dark:mp,light:mp,hcDark:null,hcLight:kr},h(3915,"Status bar item border color when focused on keyboard navigation. The status bar is shown in the bottom of the window.")),Du=H("statusBarItem.hoverBackground",{dark:ye.white.transparent(.12),light:ye.white.transparent(.12),hcDark:ye.white.transparent(.12),hcLight:ye.black.transparent(.12)},h(3916,"Status bar item background color when hovering. The status bar is shown in the bottom of the window.")),EI=H("statusBarItem.hoverForeground",mp,h(3917,"Status bar item foreground color when hovering. The status bar is shown in the bottom of the window.")),J5e=H("statusBarItem.compactHoverBackground",{dark:ye.white.transparent(.2),light:ye.white.transparent(.2),hcDark:ye.white.transparent(.2),hcLight:ye.black.transparent(.2)},h(3918,"Status bar item background color when hovering an item that contains two hovers. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentForeground",mp,h(3919,"Status bar prominent items foreground color. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentBackground",ye.black.transparent(.5),h(3920,"Status bar prominent items background color. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentHoverForeground",EI,h(3921,"Status bar prominent items foreground color when hovering. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));H("statusBarItem.prominentHoverBackground",Du,h(3922,"Status bar prominent items background color when hovering. Prominent items stand out from other status bar entries to indicate importance. The status bar is shown in the bottom of the window."));const hj=H("statusBarItem.errorBackground",{dark:yr(L6,.4),light:yr(L6,.4),hcDark:null,hcLight:"#B5200D"},h(3923,"Status bar error items background color. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.errorForeground",ye.white,h(3924,"Status bar error items foreground color. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.errorHoverForeground",EI,h(3925,"Status bar error items foreground color when hovering. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.errorHoverBackground",Du,h(3926,"Status bar error items background color when hovering. Error items stand out from other status bar entries to indicate error conditions. The status bar is shown in the bottom of the window."));const vxe=H("statusBarItem.warningBackground",{dark:yr(LT,.4),light:yr(LT,.4),hcDark:null,hcLight:"#895503"},h(3927,"Status bar warning items background color. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.warningForeground",ye.white,h(3928,"Status bar warning items foreground color. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.warningHoverForeground",EI,h(3929,"Status bar warning items foreground color when hovering. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));H("statusBarItem.warningHoverBackground",Du,h(3930,"Status bar warning items background color when hovering. Warning items stand out from other status bar entries to indicate warning conditions. The status bar is shown in the bottom of the window."));const _xe=H("activityBar.background",{dark:"#333333",light:"#2C2C2C",hcDark:"#000000",hcLight:"#FFFFFF"},h(3931,"Activity bar background color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),rv=H("activityBar.foreground",{dark:ye.white,light:ye.white,hcDark:ye.white,hcLight:po},h(3932,"Activity bar item foreground color when it is active. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),bxe=H("activityBar.inactiveForeground",{dark:et(rv,.4),light:et(rv,.4),hcDark:ye.white,hcLight:po},h(3933,"Activity bar item foreground color when it is inactive. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),yxe=H("activityBar.border",{dark:null,light:null,hcDark:tt,hcLight:tt},h(3934,"Activity bar border color separating to the side bar. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),dre=H("activityBar.activeBorder",{dark:rv,light:rv,hcDark:tt,hcLight:tt},h(3935,"Activity bar border color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),wxe=H("activityBar.activeFocusBorder",{dark:null,light:null,hcDark:null,hcLight:"#B5200D"},h(3936,"Activity bar focus border color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),lre=H("activityBar.activeBackground",null,h(3937,"Activity bar background color for the active item. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Sxe=H("activityBar.dropBorder",{dark:rv,light:rv,hcDark:null,hcLight:null},h(3938,"Drag and drop feedback color for the activity bar items. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Iw=H("activityBarBadge.background",{dark:"#007ACC",light:"#007ACC",hcDark:"#000000",hcLight:"#0F4A85"},h(3939,"Activity notification badge background color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),Dw=H("activityBarBadge.foreground",ye.white,h(3940,"Activity notification badge foreground color. The activity bar is showing on the far left or right and allows to switch between views of the side bar.")),GE=H("activityBarTop.foreground",{dark:"#E7E7E7",light:"#424242",hcDark:ye.white,hcLight:po},h(3941,"Active foreground color of the item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar.")),e6e=H("activityBarTop.activeBorder",{dark:GE,light:GE,hcDark:tt,hcLight:"#B5200D"},h(3942,"Focus border color for the active item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar."));H("activityBarTop.activeBackground",null,h(3943,"Background color for the active item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar."));const t6e=H("activityBarTop.inactiveForeground",{dark:et(GE,.6),light:et(GE,.75),hcDark:ye.white,hcLight:po},h(3944,"Inactive foreground color of the item in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar.")),i6e=H("activityBarTop.dropBorder",GE,h(3945,"Drag and drop feedback color for the items in the Activity bar when it is on top / bottom. The activity allows to switch between views of the side bar."));H("activityBarTop.background",null,h(3946,"Background color of the activity bar when set to top / bottom."));const hre=H("panel.background",ss,h(3947,"Panel background color. Panels are shown below the editor area and contain views like output and integrated terminal.")),zE=H("panel.border",{dark:ye.fromHex("#808080").transparent(.35),light:ye.fromHex("#808080").transparent(.35),hcDark:tt,hcLight:tt},h(3948,"Panel border color to separate the panel from the editor. Panels are shown below the editor area and contain views like output and integrated terminal.")),n6e=H("panelTitle.border",{dark:null,light:null,hcDark:zE,hcLight:zE},h(3949,"Panel title border color on the bottom, separating the title from the views. Panels are shown below the editor area and contain views like output and integrated terminal.")),qE=H("panelTitle.activeForeground",{dark:"#E7E7E7",light:"#424242",hcDark:ye.white,hcLight:po},h(3950,"Title color for the active panel. Panels are shown below the editor area and contain views like output and integrated terminal.")),s6e=H("panelTitle.inactiveForeground",{dark:et(qE,.6),light:et(qE,.75),hcDark:ye.white,hcLight:po},h(3951,"Title color for the inactive panel. Panels are shown below the editor area and contain views like output and integrated terminal.")),o6e=H("panelTitle.activeBorder",{dark:qE,light:qE,hcDark:tt,hcLight:"#B5200D"},h(3952,"Border color for the active panel title. Panels are shown below the editor area and contain views like output and integrated terminal.")),r6e=H("panelTitleBadge.background",Iw,h(3953,"Panel title badge background color. Panels are shown below the editor area and contain views like output and integrated terminal.")),a6e=H("panelTitleBadge.foreground",Dw,h(3954,"Panel title badge foreground color. Panels are shown below the editor area and contain views like output and integrated terminal."));H("panelInput.border",{dark:Sk,light:ye.fromHex("#ddd"),hcDark:Sk,hcLight:Sk},h(3955,"Input box border for inputs in the panel."));const c6e=H("panel.dropBorder",qE,h(3956,"Drag and drop feedback color for the panel titles. Panels are shown below the editor area and contain views like output and integrated terminal.")),Iq=H("panelSection.dropBackground",RN,h(3957,"Drag and drop feedback color for the panel sections. The color should have transparency so that the panel sections can still shine through. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Cxe=H("panelSectionHeader.background",{dark:ye.fromHex("#808080").transparent(.2),light:ye.fromHex("#808080").transparent(.2),hcDark:null,hcLight:null},h(3958,"Panel section header background color. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Exe=H("panelSectionHeader.foreground",null,h(3959,"Panel section header foreground color. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),xxe=H("panelSectionHeader.border",tt,h(3960,"Panel section header border color used when multiple views are stacked vertically in the panel. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Ixe=H("panelSection.border",zE,h(3961,"Panel section border color used when multiple views are stacked horizontally in the panel. Panels are shown below the editor area and contain views like output and integrated terminal. Panel sections are views nested within the panels.")),Dxe=H("panelStickyScroll.background",hre,h(3962,"Background color of sticky scroll in the panel.")),kxe=H("panelStickyScroll.border",null,h(3963,"Border color of sticky scroll in the panel.")),Txe=H("panelStickyScroll.shadow",_z,h(3964,"Shadow color of sticky scroll in the panel."));H("profileBadge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:ye.white,hcLight:ye.black},h(3965,"Profile badge background color. The profile badge shows on top of the settings gear icon in the activity bar."));H("profileBadge.foreground",{dark:ye.white,light:"#333333",hcDark:ye.black,hcLight:ye.white},h(3966,"Profile badge foreground color. The profile badge shows on top of the settings gear icon in the activity bar."));const d6e=H("statusBarItem.remoteBackground",Iw,h(3967,"Background color for the remote indicator on the status bar.")),Axe=H("statusBarItem.remoteForeground",Dw,h(3968,"Foreground color for the remote indicator on the status bar."));H("statusBarItem.remoteHoverForeground",EI,h(3969,"Foreground color for the remote indicator on the status bar when hovering."));H("statusBarItem.remoteHoverBackground",{dark:Du,light:Du,hcDark:Du,hcLight:null},h(3970,"Background color for the remote indicator on the status bar when hovering."));H("statusBarItem.offlineBackground","#6c1717",h(3971,"Status bar item background color when the workbench is offline."));H("statusBarItem.offlineForeground",Axe,h(3972,"Status bar item foreground color when the workbench is offline."));H("statusBarItem.offlineHoverForeground",EI,h(3973,"Status bar item foreground hover color when the workbench is offline."));H("statusBarItem.offlineHoverBackground",{dark:Du,light:Du,hcDark:Du,hcLight:null},h(3974,"Status bar item background hover color when the workbench is offline."));H("extensionBadge.remoteBackground",Iw,h(3975,"Background color for the remote badge in the extensions view."));H("extensionBadge.remoteForeground",Dw,h(3976,"Foreground color for the remote badge in the extensions view."));const Dq=H("sideBar.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#000000",hcLight:"#FFFFFF"},h(3977,"Side bar background color. The side bar is the container for views like explorer and search.")),ure=H("sideBar.foreground",null,h(3978,"Side bar foreground color. The side bar is the container for views like explorer and search.")),uj=H("sideBar.border",{dark:null,light:null,hcDark:tt,hcLight:tt},h(3979,"Side bar border color on the side separating to the editor. The side bar is the container for views like explorer and search."));H("sideBarTitle.background",Dq,h(3980,"Side bar title background color. The side bar is the container for views like explorer and search."));const l6e=H("sideBarTitle.foreground",ure,h(3981,"Side bar title foreground color. The side bar is the container for views like explorer and search.")),h6e=H("sideBarTitle.border",{dark:null,light:null,hcDark:uj,hcLight:uj},h(3982,"Side bar title border color on the bottom, separating the title from the views. The side bar is the container for views like explorer and search.")),kq=H("sideBar.dropBackground",RN,h(3983,"Drag and drop feedback color for the side bar sections. The color should have transparency so that the side bar sections can still shine through. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),Rxe=H("sideBarSectionHeader.background",{dark:ye.fromHex("#808080").transparent(.2),light:ye.fromHex("#808080").transparent(.2),hcDark:null,hcLight:null},h(3984,"Side bar section header background color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),Pxe=H("sideBarSectionHeader.foreground",ure,h(3985,"Side bar section header foreground color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar.")),gre=H("sideBarSectionHeader.border",tt,h(3986,"Side bar section header border color. The side bar is the container for views like explorer and search. Side bar sections are views nested within the side bar."));H("sideBarActivityBarTop.border",gre,h(3987,"Border color between the activity bar at the top/bottom and the views."));const Lxe=H("sideBarStickyScroll.background",Dq,h(3988,"Background color of sticky scroll in the side bar.")),Mxe=H("sideBarStickyScroll.border",null,h(3989,"Border color of sticky scroll in the side bar.")),Nxe=H("sideBarStickyScroll.shadow",_z,h(3990,"Shadow color of sticky scroll in the side bar.")),ah=H("titleBar.activeForeground",{dark:"#CCCCCC",light:"#333333",hcDark:"#FFFFFF",hcLight:"#292929"},h(3991,"Title bar foreground when the window is active.")),pre=H("titleBar.inactiveForeground",{dark:et(ah,.6),light:et(ah,.6),hcDark:null,hcLight:"#292929"},h(3992,"Title bar foreground when the window is inactive.")),gj=H("titleBar.activeBackground",{dark:"#3C3C3C",light:"#DDDDDD",hcDark:"#000000",hcLight:"#FFFFFF"},h(3993,"Title bar background when the window is active.")),u6e=H("titleBar.inactiveBackground",{dark:et(gj,.6),light:et(gj,.6),hcDark:null,hcLight:null},h(3994,"Title bar background when the window is inactive.")),g6e=H("titleBar.border",{dark:null,light:null,hcDark:tt,hcLight:tt},h(3995,"Title bar border color.")),Oxe=H("menubar.selectionForeground",ah,h(3996,"Foreground color of the selected menu item in the menubar.")),pj=H("menubar.selectionBackground",{dark:M6,light:M6,hcDark:null,hcLight:null},h(3997,"Background color of the selected menu item in the menubar."));H("menubar.selectionBorder",{dark:null,light:null,hcDark:kr,hcLight:kr},h(3998,"Border color of the selected menu item in the menubar."));H("commandCenter.foreground",ah,h(3999,"Foreground color of the command center"),!1);H("commandCenter.activeForeground",Oxe,h(4e3,"Active foreground color of the command center"),!1);H("commandCenter.inactiveForeground",pre,h(4001,"Foreground color of the command center when the window is inactive"),!1);H("commandCenter.background",{dark:ye.white.transparent(.05),hcDark:null,light:ye.black.transparent(.05),hcLight:null},h(4002,"Background color of the command center"),!1);H("commandCenter.activeBackground",{dark:ye.white.transparent(.08),hcDark:pj,light:ye.black.transparent(.08),hcLight:pj},h(4003,"Active background color of the command center"),!1);H("commandCenter.border",{dark:et(ah,.2),hcDark:tt,light:et(ah,.2),hcLight:tt},h(4004,"Border color of the command center"),!1);H("commandCenter.activeBorder",{dark:et(ah,.3),hcDark:ah,light:et(ah,.3),hcLight:ah},h(4005,"Active border color of the command center"),!1);H("commandCenter.inactiveBorder",et(pre,.25),h(4006,"Border color of the command center when the window is inactive"),!1);const p6e=H("notificationCenter.border",{dark:oy,light:oy,hcDark:tt,hcLight:tt},h(4007,"Notifications center border color. Notifications slide in from the bottom right of the window.")),f6e=H("notificationToast.border",{dark:oy,light:oy,hcDark:tt,hcLight:tt},h(4008,"Notification toast border color. Notifications slide in from the bottom right of the window."));H("notifications.foreground",Fie,h(4009,"Notifications foreground color. Notifications slide in from the bottom right of the window."));const qD=H("notifications.background",LM,h(4010,"Notifications background color. Notifications slide in from the bottom right of the window."));H("notificationLink.foreground",Wie,h(4011,"Notification links foreground color. Notifications slide in from the bottom right of the window."));const m6e=H("notificationCenterHeader.foreground",null,h(4012,"Notifications center header foreground color. Notifications slide in from the bottom right of the window.")),Fxe=H("notificationCenterHeader.background",{dark:jfe(qD,.3),light:yr(qD,.05),hcDark:qD,hcLight:qD},h(4013,"Notifications center header background color. Notifications slide in from the bottom right of the window."));H("notifications.border",Fxe,h(4014,"Notifications border color separating from other notifications in the notifications center. Notifications slide in from the bottom right of the window."));H("notificationsErrorIcon.foreground",Bie,h(4015,"The color used for the icon of error notifications. Notifications slide in from the bottom right of the window."));H("notificationsWarningIcon.foreground",LT,h(4016,"The color used for the icon of warning notifications. Notifications slide in from the bottom right of the window."));H("notificationsInfoIcon.foreground",wE,h(4017,"The color used for the icon of info notifications. Notifications slide in from the bottom right of the window."));const v6e=H("window.activeBorder",{dark:null,light:null,hcDark:tt,hcLight:tt},h(4018,"The color used for the border of the window when it is active on macOS or Linux. Requires custom title bar style and custom or hidden window controls on Linux.")),_6e=H("window.inactiveBorder",{dark:null,light:null,hcDark:tt,hcLight:tt},h(4019,"The color used for the border of the window when it is inactive on macOS or Linux. Requires custom title bar style and custom or hidden window controls on Linux.")),Tq=J("IExtensionStatusBarItemService");var Sy;(function(s){s[s.DidDefine=0]="DidDefine",s[s.DidUpdate=1]="DidUpdate"})(Sy||(Sy={}));let sB=class{constructor(e){this._statusbarService=e,this._entries=new Map,this._onDidChange=new M,this.onDidChange=this._onDidChange.event}dispose(){this._entries.forEach(e=>e.accessor.dispose()),this._entries.clear(),this._onDidChange.dispose()}setOrUpdateEntry(e,t,i,n,o,r,a,c,d,l,u,g){let m,v;if(g)m=g.label,v=g.role;else if(m=Yfe(o),typeof r=="string"||tc(r)){const D=typeof r=="string"?r:r.value;m+=`, ${D}`}let _;switch(d?.id){case hj:case vxe:_=d.id===hj?"error":"warning",c=void 0,d=void 0}const w={name:n,text:o,tooltip:r,command:a,color:c,backgroundColor:d,ariaLabel:m,role:v,kind:_,extensionId:i};typeof u>"u"&&(u=0);let C=l?ov.LEFT:ov.RIGHT;const k=this._entries.get(e);if(k&&(C=k.alignment,u=k.priority),k)return k.accessor.update(w),k.entry=w,Sy.DidUpdate;{let D;typeof i=="string"?D={primary:u,secondary:lc(i)}:D=u;const A=this._statusbarService.addEntry(w,t,C,D);return this._entries.set(e,{accessor:A,entry:w,alignment:C,priority:u,disposable:Ie(()=>{A.dispose(),this._entries.delete(e),this._onDidChange.fire({removed:e})})}),this._onDidChange.fire({added:[e,{entry:w,alignment:C,priority:u}]}),Sy.DidDefine}}unsetEntry(e){this._entries.get(e)?.disposable.dispose(),this._entries.delete(e)}getEntries(){return this._entries.entries()}};sB=f([p(0,AN)],sB);G(Tq,sB,z.Delayed);const Bh=J("IEditorBreadcrumbsService");class xI{constructor(e){this.defaultValue=e}verify(e){return this.isType(e)?e:this.defaultValue}}class $n extends xI{isType(e){return typeof e=="boolean"}}class p1 extends xI{isType(e){return typeof e=="number"}}class Wxe extends xI{isType(e){return e instanceof Set}}class ha extends xI{constructor(e,t){super(e),this.allowedValues=t}isType(e){return this.allowedValues.includes(e)}}class fj extends xI{constructor(e,t){super(e),this.verifier=t}verify(e){return this.isType(e)?fre(this.verifier,e):this.defaultValue}isType(e){return ra(e)}}function fre(s,e){const t=Object.create(null);for(const i in s)if(Object.hasOwnProperty.call(s,i)){const n=s[i];t[i]=n.verify(e[i])}return t}const cp=new Ye(220,70),OA=new Ye(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Vt={showTabs:"multiple",highlightModifiedTabs:!1,tabActionLocation:"right",tabActionCloseVisibility:!0,tabActionUnpinVisibility:!0,alwaysShowEditorActions:!1,tabSizing:"fit",tabSizingFixedMinWidth:50,tabSizingFixedMaxWidth:160,pinnedTabSizing:"normal",pinnedTabsOnSeparateRow:!1,tabHeight:"default",preventPinnedEditorClose:"keyboardAndMouse",titleScrollbarSizing:"default",focusRecentEditorAfterClose:!0,showIcons:!0,hasIcons:!0,enablePreview:!0,openPositioning:"right",openSideBySideDirection:"right",closeEmptyGroups:!0,labelFormat:"default",splitSizing:"auto",splitOnDragAndDrop:!0,dragToOpenWindow:!0,centeredLayoutFixedWidth:!1,doubleClickTabToToggleEditorGroupSizes:"expand",editorActionsLocation:"default",wrapTabs:!1,enablePreviewFromQuickOpen:!1,scrollToSwitchTabs:!1,enablePreviewFromCodeNavigation:!1,closeOnFileDelete:!1,mouseBackForwardToNavigate:!0,restoreViewState:!0,splitInGroupLayout:"horizontal",revealIfOpen:!1,get limit(){return{enabled:!1,value:10,perEditorGroup:!1,excludeDirty:!1}},get decorations(){return{badges:!0,colors:!0}},get autoLockGroups(){return new Set}};function y6e(s){return s.affectsConfiguration("workbench.editor")||s.affectsConfiguration("workbench.iconTheme")||s.affectsConfiguration("window.density")}function w6e(s,e){const t={...Vt,hasIcons:e.getFileIconTheme().hasFileIcons},i=s.getValue();if(i?.workbench?.editor)if(Object.assign(t,i.workbench.editor),ra(i.workbench.editor.autoLockGroups)){t.autoLockGroups=Vt.autoLockGroups;for(const[o,r]of Object.entries(i.workbench.editor.autoLockGroups))r===!0&&t.autoLockGroups.add(o)}else t.autoLockGroups=Vt.autoLockGroups;const n=s.getValue();return n?.window?.density?.editorTabHeight&&(t.tabHeight=n.window.density.editorTabHeight),Bxe(t)}function Bxe(s){return typeof s.showTabs=="boolean"&&(s.showTabs=s.showTabs?"multiple":"single"),fre({wrapTabs:new $n(Vt.wrapTabs),scrollToSwitchTabs:new $n(Vt.scrollToSwitchTabs),highlightModifiedTabs:new $n(Vt.highlightModifiedTabs),tabActionCloseVisibility:new $n(Vt.tabActionCloseVisibility),tabActionUnpinVisibility:new $n(Vt.tabActionUnpinVisibility),alwaysShowEditorActions:new $n(Vt.alwaysShowEditorActions),pinnedTabsOnSeparateRow:new $n(Vt.pinnedTabsOnSeparateRow),focusRecentEditorAfterClose:new $n(Vt.focusRecentEditorAfterClose),showIcons:new $n(Vt.showIcons),enablePreview:new $n(Vt.enablePreview),enablePreviewFromQuickOpen:new $n(Vt.enablePreviewFromQuickOpen),enablePreviewFromCodeNavigation:new $n(Vt.enablePreviewFromCodeNavigation),closeOnFileDelete:new $n(Vt.closeOnFileDelete),closeEmptyGroups:new $n(Vt.closeEmptyGroups),revealIfOpen:new $n(Vt.revealIfOpen),mouseBackForwardToNavigate:new $n(Vt.mouseBackForwardToNavigate),restoreViewState:new $n(Vt.restoreViewState),splitOnDragAndDrop:new $n(Vt.splitOnDragAndDrop),dragToOpenWindow:new $n(Vt.dragToOpenWindow),centeredLayoutFixedWidth:new $n(Vt.centeredLayoutFixedWidth),hasIcons:new $n(Vt.hasIcons),tabSizingFixedMinWidth:new p1(Vt.tabSizingFixedMinWidth),tabSizingFixedMaxWidth:new p1(Vt.tabSizingFixedMaxWidth),showTabs:new ha(Vt.showTabs,["multiple","single","none"]),tabActionLocation:new ha(Vt.tabActionLocation,["left","right"]),tabSizing:new ha(Vt.tabSizing,["fit","shrink","fixed"]),pinnedTabSizing:new ha(Vt.pinnedTabSizing,["normal","compact","shrink"]),tabHeight:new ha(Vt.tabHeight,["default","compact"]),preventPinnedEditorClose:new ha(Vt.preventPinnedEditorClose,["keyboardAndMouse","keyboard","mouse","never"]),titleScrollbarSizing:new ha(Vt.titleScrollbarSizing,["default","large"]),openPositioning:new ha(Vt.openPositioning,["left","right","first","last"]),openSideBySideDirection:new ha(Vt.openSideBySideDirection,["right","down"]),labelFormat:new ha(Vt.labelFormat,["default","short","medium","long"]),splitInGroupLayout:new ha(Vt.splitInGroupLayout,["vertical","horizontal"]),splitSizing:new ha(Vt.splitSizing,["distribute","split","auto"]),doubleClickTabToToggleEditorGroupSizes:new ha(Vt.doubleClickTabToToggleEditorGroupSizes,["maximize","expand","off"]),editorActionsLocation:new ha(Vt.editorActionsLocation,["default","titleBar","hidden"]),autoLockGroups:new Wxe(Vt.autoLockGroups),limit:new fj(Vt.limit,{enabled:new $n(Vt.limit.enabled),value:new p1(Vt.limit.value),perEditorGroup:new $n(Vt.limit.perEditorGroup),excludeDirty:new $n(Vt.limit.excludeDirty)}),decorations:new fj(Vt.decorations,{badges:new $n(Vt.decorations.badges),colors:new $n(Vt.decorations.colors)})},s)}function mj(s,e,t){return!e||!s.activeEditor||e.matches(s.activeEditor)?{...t,viewState:s.activeEditorPane?.getViewState()}:t||Object.create(null)}function Aq(s,e,t){if(e.length===0)return[];const i=[];let n;const o=[];for(const a of e)!n&&s.isActive(a)?n=a:o.push(a);n||(n=o.shift()),o.sort((a,c)=>s.getIndexOfEditor(c)-s.getIndexOfEditor(a));const r=$t([n,...o]);for(let a=0;a<r.length;a++){const c=r[a];i.push({editor:c,options:{pinned:!0,sticky:s.isSticky(c),inactive:a>0,preserveFocus:t}})}return i}const $s=J("viewDescriptorService"),Ho=J("chatWidgetService"),Vxe=J("quickChatService"),Hxe=J("chatAccessibilityService"),Uxe=J("chatCodeBlockContextProviderService"),pf=J("chatAgentService"),mre=J("chatAgentNameService"),vre=J("codeMapperService"),ug=J("chatEditingService"),ff=J("IChatService"),_re=J("chatSlashCommandService"),Rq=J("IChatVariablesService"),bre=J("IChatWidgetHistoryService"),Pq=J("languageModelIgnoredFilesService"),yre=J("ILanguageModelStatsService"),kw=J("ILanguageModelToolsService"),Tw=J("ILanguageModelsService"),gg=J("commentService"),Lq=J("customEditorService"),Mq=J("debugService"),wre=J("debugVisualizerService"),$xe=J("IEditSessionsStorageService"),Gxe=J("IEditSessionsLogService"),Aw=J("extensionsWorkbenchService"),Sre=J("externalUriOpenerService"),Zi=J("explorerService"),Nq=J("IInlineChatSessionService"),Oq=J("IInteractiveDocumentService"),Cre=J("IInteractiveHistoryService"),zxe=J("ITroubleshootIssueService"),qxe=J("issueFormService"),Kxe=J("workbenchIssueService"),jxe=J("IDefaultLogLevelsService"),Ere=J("multiDiffSourceResolverService"),Yxe=J("INotebookOriginalCellModelFactory"),Qxe=J("INotebookOriginalModelReferenceFactory"),PN=J("INotebookEditorWidgetService"),xre=J("notebookCellStatusBarService"),II=J("INotebookModelResolverService"),Xxe=J("INotebookExecutionService"),Ire=J("INotebookExecutionStateService"),Dre=J("INotebookKernelService"),Zxe=J("INotebookKernelHistoryService"),Jxe=J("notebookKeymapService"),kre=J("INotebookLoggingService"),Tre=J("INotebookRendererMessagingService"),bl=J("notebookService"),eIe="notebookEditorWorkerService",tIe=J(eIe),iIe=J("preferencesSearchService"),Fq=J("IQuickDiffModelService"),LN=J("quickDiff"),Are=J("scm"),Rre=J("scmView"),nIe=J("replaceService"),sIe=J("searchViewModelWorkbenchService"),oIe=J("notebookSearchService"),rIe=J("searchHistoryService"),Pre=J("shareService"),MN=J("snippetService"),NN=J("speechService");class aIe{getTags(){return Promise.resolve({})}async getTelemetryWorkspaceId(e,t){}getHashedRemotesFromUri(e,t){return Promise.resolve([])}}const cIe=J("workspaceTagsService"),Lre=J("taskService");var vj;(function(s){s[s.Left=0]="Left",s[s.Right=1]="Right",s[s.Up=2]="Up",s[s.Down=3]="Down"})(vj||(vj={}));var oB;(function(s){s[s.Connecting=0]="Connecting",s[s.Connected=1]="Connected"})(oB||(oB={}));const _j="terminalEditor";var bj;(function(s){s[s.SearchHighlightLimit=2e4]="SearchHighlightLimit"})(bj||(bj={}));var yj;(function(s){s[s.Unknown=1]="Unknown",s[s.Fedora=2]="Fedora",s[s.Ubuntu=3]="Ubuntu"})(yj||(yj={}));var wj;(function(s){s.Terminals="Terminals"})(wj||(wj={}));const Rw=J("terminalService"),dIe=J("terminalConfigurationService"),Mre=J("terminalEditorService"),Wq=J("terminalGroupService"),Nre=J("terminalInstanceService"),Ore=J("environmentVariableService"),Fre=J("terminalProfileResolverService"),Wre=J("terminalProfileService"),lIe=J("terminalContributionsService"),Bre=J("terminalLinkProviderService"),Vre=J("terminalQuickFixService"),Hre=J("terminalCompletionService"),hIe=J("testCoverageService"),uIe=J("testingFilterState"),Ure=J("testProfileService"),$re=J("testResultService"),gIe=J("ITestResultStorage"),Gre=J("testService"),pIe=J("testingContinuousRunService"),fIe=J("testingDecorationService"),mIe=J("testingPeekOpener"),vIe="timeline",zre=J(vIe),ON=J("webviewService"),DI=J("webviewEditorService"),qre=J("webviewViewService"),_Ie=J("walkthroughsService"),bIe=J("accessibleViewInformationService"),qv=J("activityService"),Kre=J("IAiEmbeddingVectorService"),Bq=J("IAiRelatedInformationService"),FN=J("IAuthenticationAccessService"),jre=J("IAuthenticationUsageService"),Pw=J("IAuthenticationService"),Vq=J("IAuthenticationExtensionsService"),Yre=J("auxiliaryWindowService"),yIe=J("bannerService"),pg=J("ICustomEditorLabelService"),mf=J("editorResolverService"),Lw=J("IExtensionBisectService"),Qre=J("IExtensionFeaturesManagementService");var Sj;(function(s){s[s.Local=1]="Local",s[s.Remote=2]="Remote",s[s.Web=3]="Web"})(Sj||(Sj={}));var gu;(function(s){s[s.DisabledByTrustRequirement=0]="DisabledByTrustRequirement",s[s.DisabledByExtensionKind=1]="DisabledByExtensionKind",s[s.DisabledByEnvironment=2]="DisabledByEnvironment",s[s.EnabledByEnvironment=3]="EnabledByEnvironment",s[s.DisabledByMalicious=4]="DisabledByMalicious",s[s.DisabledByVirtualWorkspace=5]="DisabledByVirtualWorkspace",s[s.DisabledByInvalidExtension=6]="DisabledByInvalidExtension",s[s.DisabledByAllowlist=7]="DisabledByAllowlist",s[s.DisabledByExtensionDependency=8]="DisabledByExtensionDependency",s[s.DisabledGlobally=9]="DisabledGlobally",s[s.DisabledWorkspace=10]="DisabledWorkspace",s[s.EnabledGlobally=11]="EnabledGlobally",s[s.EnabledWorkspace=12]="EnabledWorkspace"})(gu||(gu={}));const wIe=Vie(CI),Xre=J("extensionManagementServerService"),WN=Vie(wIe),gd=J("extensionEnablementService"),Hq=J("IWebExtensionsScannerService"),SIe=J("extensionRecommendationsService"),CIe=J("IExtensionIgnoredRecommendationsService"),EIe=J("IWorkspaceExtensionsConfigService"),Zre=J("extensionUrlHandler"),Kv=J("extensionManifestPropertiesService"),So=J("historyService"),xIe=J("integrityService");class IIe{constructor(e,t){this._mapAltGrToCtrlAlt=e,this._OS=t}dumpDebugInfo(){return"FallbackKeyboardMapper dispatching on keyCode"}resolveKeyboardEvent(e){const t=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,i=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,n=new wF(t,e.shiftKey,i,e.metaKey,e.keyCode);return this.resolveKeybinding(new Qfe([n]))[0]}resolveKeybinding(e){return Xfe.resolveKeybinding(e,this._OS)}}const DIe=J("keybindingEditingService"),Uq=J("ILanguageStatusService");var HS;let rB=class extends F{static{HS=this}static{this.LAST_SHUTDOWN_REASON_KEY="lifecyle.lastShutdownReason"}get startupKind(){return this._startupKind}get phase(){return this._phase}get willShutdown(){return this._willShutdown}constructor(e,t){super(),this.logService=e,this.storageService=t,this._onBeforeShutdown=this._register(new M),this.onBeforeShutdown=this._onBeforeShutdown.event,this._onWillShutdown=this._register(new M),this.onWillShutdown=this._onWillShutdown.event,this._onDidShutdown=this._register(new M),this.onDidShutdown=this._onDidShutdown.event,this._onBeforeShutdownError=this._register(new M),this.onBeforeShutdownError=this._onBeforeShutdownError.event,this._onShutdownVeto=this._register(new M),this.onShutdownVeto=this._onShutdownVeto.event,this._phase=mc.Starting,this._willShutdown=!1,this.phaseWhen=new Map,this._startupKind=this.resolveStartupKind(),this._register(this.storageService.onWillSaveState(i=>{i.reason===Jx.SHUTDOWN&&this.storageService.store(HS.LAST_SHUTDOWN_REASON_KEY,this.shutdownReason,he.WORKSPACE,gt.MACHINE)}))}resolveStartupKind(){const e=this.doResolveStartupKind()??Q0.NewWindow;return this.logService.trace(`[lifecycle] starting up (startup kind: ${e})`),e}doResolveStartupKind(){const e=this.storageService.getNumber(HS.LAST_SHUTDOWN_REASON_KEY,he.WORKSPACE);this.storageService.remove(HS.LAST_SHUTDOWN_REASON_KEY,he.WORKSPACE);let t;switch(e){case Ib.RELOAD:t=Q0.ReloadedWindow;break;case Ib.LOAD:t=Q0.ReopenedWindow;break}return t}set phase(e){if(e<this.phase)throw new Error("Lifecycle cannot go backwards");if(this._phase===e)return;this.logService.trace(`lifecycle: phase changed (value: ${e})`),this._phase=e,dr(`code/LifecyclePhase/${Zfe(e)}`);const t=this.phaseWhen.get(this._phase);t&&(t.open(),this.phaseWhen.delete(this._phase))}async when(e){if(e<=this._phase)return;let t=this.phaseWhen.get(e);t||(t=new Rp,this.phaseWhen.set(e,t)),await t.wait()}};rB=HS=f([p(0,Re),p(1,it)],rB);const kIe=J("localizationService"),TIe=J("activeLanguageService"),Jre=J("notebookDocumentService"),$q=J("IOutlineService"),BN=J("outputService");var Ha;(function(s){s.Http="http",s.Https="https"})(Ha||(Ha={}));var vu;(function(s){s.ConstantPrivate="constantPrivate",s.Private="private",s.Public="public"})(vu||(vu={}));var Kg;(function(s){s[s.Notify=1]="Notify",s[s.OpenBrowser=2]="OpenBrowser",s[s.OpenPreview=3]="OpenPreview",s[s.Silent=4]="Silent",s[s.Ignore=5]="Ignore",s[s.OpenBrowserOnce=6]="OpenBrowserOnce"})(Kg||(Kg={}));function AIe(s){if(s.scheme!=="http"&&s.scheme!=="https")return;const e=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(s.authority);if(e)return{address:e[1],port:+e[2]}}const KE=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function jE(s){return KE.indexOf(s)>=0}const FA=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function YE(s){return FA.indexOf(s)>=0}class RIe{constructor(e,t,i){this.remoteAddress=e,this.localAddress=t,this._dispose=i,this._onDispose=new M,this.onDidDispose=this._onDispose.event}dispose(){return this._onDispose.fire(),this._dispose()}}let Cj=class extends F{constructor(e,t){super(),this.logService=e,this.configurationService=t,this._onTunnelOpened=new M,this.onTunnelOpened=this._onTunnelOpened.event,this._onTunnelClosed=new M,this.onTunnelClosed=this._onTunnelClosed.event,this._onAddedTunnelProvider=new M,this.onAddedTunnelProvider=this._onAddedTunnelProvider.event,this._tunnels=new Map,this._canElevate=!1,this._canChangeProtocol=!0,this._privacyOptions=[],this._factoryInProgress=new Set}get hasTunnelProvider(){return!!this._tunnelProvider}get defaultTunnelHost(){const e=this.configurationService.getValue("remote.localPortHost");return!e||e==="localhost"?"127.0.0.1":"0.0.0.0"}setTunnelProvider(e){return this._tunnelProvider=e,e?(this._onAddedTunnelProvider.fire(),{dispose:()=>{this._tunnelProvider=void 0,this._canElevate=!1,this._privacyOptions=[]}}):(this._canElevate=!1,this._privacyOptions=[],this._onAddedTunnelProvider.fire(),{dispose:()=>{}})}setTunnelFeatures(e){this._canElevate=e.elevation,this._privacyOptions=e.privacyOptions,this._canChangeProtocol=e.protocol}get canChangeProtocol(){return this._canChangeProtocol}get canElevate(){return this._canElevate}get canChangePrivacy(){return this._privacyOptions.length>0}get privacyOptions(){return this._privacyOptions}get tunnels(){return this.getTunnels()}async getTunnels(){const e=[],t=Array.from(this._tunnels.values());for(const i of t){const n=Array.from(i.values());for(const o of n){const r=await o.value;r&&typeof r!="string"&&e.push(r)}}return e}async dispose(){super.dispose();for(const e of this._tunnels.values()){for(const{value:t}of e.values())await t.then(i=>typeof i!="string"?i?.dispose():void 0);e.clear()}this._tunnels.clear()}setEnvironmentTunnel(e,t,i,n,o){this.addTunnelToMap(e,t,Promise.resolve({tunnelRemoteHost:e,tunnelRemotePort:t,localAddress:i,privacy:n,protocol:o,dispose:()=>Promise.resolve()}))}async getExistingTunnel(e,t){(YE(e)||jE(e))&&(e=KE[0]);const i=this.getTunnelFromMap(e,t);if(i)return++i.refcount,i.value}openTunnel(e,t,i,n,o,r=!1,a,c){this.logService.trace(`ForwardedPorts: (TunnelService) openTunnel request for ${t}:${i} on local port ${o}.`);const d=this._tunnelProvider??e;if(!d)return;if(t||(t="localhost"),n||(n=this.defaultTunnelHost),this._tunnelProvider&&this._factoryInProgress.has(i)){this.logService.debug("ForwardedPorts: (TunnelService) Another call to create a tunnel with the same address has occurred before the last one completed. This call will be ignored.");return}const l=this.retainOrCreateTunnel(d,t,i,n,o,r,a,c);return l?l.then(u=>{if(u){if(typeof u=="string")return this.logService.trace("ForwardedPorts: (TunnelService) The tunnel provider returned an error when creating the tunnel."),this.removeEmptyOrErrorTunnelFromMap(t,i),u}else{this.logService.trace("ForwardedPorts: (TunnelService) New tunnel is undefined."),this.removeEmptyOrErrorTunnelFromMap(t,i);return}this.logService.trace("ForwardedPorts: (TunnelService) New tunnel established.");const g=this.makeTunnel(u);return(u.tunnelRemoteHost!==t||u.tunnelRemotePort!==i)&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Host or port mismatch."),a&&u.privacy!==a&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Privacy mismatch."),this._onTunnelOpened.fire(g),g}):(this.logService.trace("ForwardedPorts: (TunnelService) Tunnel was not created."),l)}makeTunnel(e){return{tunnelRemotePort:e.tunnelRemotePort,tunnelRemoteHost:e.tunnelRemoteHost,tunnelLocalPort:e.tunnelLocalPort,localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol,dispose:async()=>{this.logService.trace(`ForwardedPorts: (TunnelService) dispose request for ${e.tunnelRemoteHost}:${e.tunnelRemotePort} `);const t=this._tunnels.get(e.tunnelRemoteHost);if(t){const i=t.get(e.tunnelRemotePort);i&&(i.refcount--,await this.tryDisposeTunnel(e.tunnelRemoteHost,e.tunnelRemotePort,i))}}}}async tryDisposeTunnel(e,t,i){if(i.refcount<=0){this.logService.trace(`ForwardedPorts: (TunnelService) Tunnel is being disposed ${e}:${t}.`);const n=i.value.then(async o=>{o&&typeof o!="string"&&(await o.dispose(!0),this._onTunnelClosed.fire({host:o.tunnelRemoteHost,port:o.tunnelRemotePort}))});return this._tunnels.has(e)&&this._tunnels.get(e).delete(t),n}}async closeTunnel(e,t){this.logService.trace(`ForwardedPorts: (TunnelService) close request for ${e}:${t} `);const i=this._tunnels.get(e);if(i&&i.has(t)){const n=i.get(t);n.refcount=0,await this.tryDisposeTunnel(e,t,n)}}addTunnelToMap(e,t,i){this._tunnels.has(e)||this._tunnels.set(e,new Map),this._tunnels.get(e).set(t,{refcount:1,value:i})}async removeEmptyOrErrorTunnelFromMap(e,t){const i=this._tunnels.get(e);if(i){const n=i.get(t),o=n?await n.value:void 0;(!o||typeof o=="string")&&i.delete(t),i.size===0&&this._tunnels.delete(e)}}getTunnelFromMap(e,t){const i=[e];jE(e)?(i.push(...KE),i.push(...FA)):YE(e)&&i.push(...FA);const n=i.map(o=>this._tunnels.get(o));for(const o of n){const r=o?.get(t);if(r)return r}}canTunnel(e){return!!AIe(e)}createWithProvider(e,t,i,n,o,r,a){this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel with provider ${t}:${i} on local port ${n}.`);const c=i;this._factoryInProgress.add(c);const d=n===void 0?i:n,l={elevationRequired:o?this.isPortPrivileged(d):!1},u={remoteAddress:{host:t,port:i},localAddressPort:n,privacy:r,public:r?r!==vu.Private:void 0,protocol:a},g=e.forwardPort(u,l);return g?(this.addTunnelToMap(t,i,g),g.finally(()=>{this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created by provider."),this._factoryInProgress.delete(c)})):this._factoryInProgress.delete(c),g}};Cj=f([p(0,Re),p(1,ne)],Cj);const PIe=10*1e3,KD="remote.tunnels.toRestore",f1="remote.tunnels.toRestoreExpiration",LIe=1e3*60*60*24*14,Ej="onTunnel",MIe=new O("forwardedPortsViewEnabled",!1,h(12547,"Whether the Ports view is enabled.")),NIe=new O("forwardedPortsViewOnlyEnabled",!1,h(12547,"Whether the Ports view is enabled."));function OIe(s){const e=s.match(/^([a-zA-Z0-9_-]+(?:\.[a-zA-Z0-9_-]+)*:)?([0-9]+)$/);if(e)return{host:e[1]?.substring(0,e[1].length-1)||"localhost",port:Number(e[2])}}var Rm;(function(s){s.Other="Other",s.User="User",s.AutoForwardEnd="AutoForwardEnd"})(Rm||(Rm={}));var Yd;(function(s){s[s.User=0]="User",s[s.Auto=1]="Auto",s[s.Extension=2]="Extension"})(Yd||(Yd={}));const m1={source:Yd.User,description:h(12548,"User Forwarded")},E6e={source:Yd.Auto,description:h(12549,"Auto Forwarded")};function xj(s,e,t){const i=s.get(Kr(e,t));if(i)return i;if(jE(e))for(const n of KE){const o=Kr(n,t);if(s.has(o))return s.get(o)}else if(YE(e))for(const n of FA){const o=Kr(n,t);if(s.has(o))return s.get(o)}}function $r(s,e,t){const i=xj(s,e,t);if(i)return i;const n=YE(e)?"localhost":jE(e)?"0.0.0.0":void 0;if(n)return xj(s,n,t)}function Kr(s,e){return s+":"+e}var jg;(function(s){s.Notify="notify",s.OpenBrowser="openBrowser",s.OpenBrowserOnce="openBrowserOnce",s.OpenPreview="openPreview",s.Silent="silent",s.Ignore="ignore"})(jg||(jg={}));function FIe(s){return s&&"host"in s&&typeof s.host=="string"&&"port"in s&&typeof s.port=="number"&&(!("detail"in s)||typeof s.detail=="string")&&(!("pid"in s)||typeof s.pid=="string")}class Ua extends F{static{this.SETTING="remote.portsAttributes"}static{this.DEFAULTS="remote.otherPortsAttributes"}static{this.RANGE=/^(\d+)\-(\d+)$/}static{this.HOST_AND_PORT=/^([a-z0-9\-]+):(\d{1,5})$/}constructor(e){super(),this.configurationService=e,this.portsAttributes=[],this._onDidChangeAttributes=new M,this.onDidChangeAttributes=this._onDidChangeAttributes.event,this._register(e.onDidChangeConfiguration(t=>{(t.affectsConfiguration(Ua.SETTING)||t.affectsConfiguration(Ua.DEFAULTS))&&this.updateAttributes()})),this.updateAttributes()}updateAttributes(){this.portsAttributes=this.readSetting(),this._onDidChangeAttributes.fire()}getAttributes(e,t,i){let n=this.findNextIndex(e,t,i,this.portsAttributes,0);const o={label:void 0,onAutoForward:void 0,elevateIfNeeded:void 0,requireLocalPort:void 0,protocol:void 0};for(;n>=0;){const r=this.portsAttributes[n];r.key===e?(o.onAutoForward=r.onAutoForward??o.onAutoForward,o.elevateIfNeeded=r.elevateIfNeeded!==void 0?r.elevateIfNeeded:o.elevateIfNeeded,o.label=r.label??o.label,o.requireLocalPort=r.requireLocalPort,o.protocol=r.protocol):(o.onAutoForward=o.onAutoForward??r.onAutoForward,o.elevateIfNeeded=o.elevateIfNeeded!==void 0?o.elevateIfNeeded:r.elevateIfNeeded,o.label=o.label??r.label,o.requireLocalPort=o.requireLocalPort!==void 0?o.requireLocalPort:void 0,o.protocol=o.protocol??r.protocol),n=this.findNextIndex(e,t,i,this.portsAttributes,n+1)}return o.onAutoForward!==void 0||o.elevateIfNeeded!==void 0||o.label!==void 0||o.requireLocalPort!==void 0||o.protocol!==void 0?o:this.getOtherAttributes()}hasStartEnd(e){return e.start!==void 0&&e.end!==void 0}hasHostAndPort(e){return e.host!==void 0&&e.port!==void 0&&Tt(e.host)&&ec(e.port)}findNextIndex(e,t,i,n,o){if(o>=n.length)return-1;const r=!jE(t)&&!YE(t),c=n.slice(o).findIndex(d=>ec(d.key)?r?!1:d.key===e:this.hasStartEnd(d.key)?r?!1:e>=d.key.start&&e<=d.key.end:this.hasHostAndPort(d.key)?e===d.key.port&&t===d.key.host:i?d.key.test(i):!1);return c>=0?c+o:-1}readSetting(){const e=this.configurationService.getValue(Ua.SETTING);if(!e||!ra(e))return[];const t=[];for(const n in e){if(n===void 0)continue;const o=e[n];let r;if(Number(n))r=Number(n);else if(Tt(n))if(Ua.RANGE.test(n)){const a=n.match(Ua.RANGE);r={start:Number(a[1]),end:Number(a[2])}}else if(Ua.HOST_AND_PORT.test(n)){const a=n.match(Ua.HOST_AND_PORT);r={host:a[1],port:Number(a[2])}}else{let a;try{a=RegExp(n)}catch{}a&&(r=a)}r&&t.push({key:r,elevateIfNeeded:o.elevateIfNeeded,onAutoForward:o.onAutoForward,label:o.label,requireLocalPort:o.requireLocalPort,protocol:o.protocol})}const i=this.configurationService.getValue(Ua.DEFAULTS);return i&&(this.defaultPortAttributes={elevateIfNeeded:i.elevateIfNeeded,label:i.label,onAutoForward:i.onAutoForward,requireLocalPort:i.requireLocalPort,protocol:i.protocol}),this.sortAttributes(t)}sortAttributes(e){function t(i,n){return ec(i.key)?i.key:n.hasStartEnd(i.key)?i.key.start:n.hasHostAndPort(i.key)?i.key.port:Number.MAX_VALUE}return e.sort((i,n)=>t(i,this)-t(n,this))}getOtherAttributes(){return this.defaultPortAttributes}static providedActionToAction(e){switch(e){case Kg.Notify:return jg.Notify;case Kg.OpenBrowser:return jg.OpenBrowser;case Kg.OpenBrowserOnce:return jg.OpenBrowserOnce;case Kg.OpenPreview:return jg.OpenPreview;case Kg.Silent:return jg.Silent;case Kg.Ignore:return jg.Ignore;default:return}}async addAttributes(e,t,i){const o=this.configurationService.inspect(Ua.SETTING).userRemoteValue;let r;!o||!ra(o)?r={}:r=Tr(o),r[`${e}`]||(r[`${e}`]={});for(const a in t)r[`${e}`][a]=t[a];return this.configurationService.updateValue(Ua.SETTING,r,i)}}let QE=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this.tunnelService=e,this.storageService=t,this.configurationService=i,this.environmentService=n,this.remoteAuthorityResolverService=o,this.workspaceContextService=r,this.logService=a,this.dialogService=c,this.extensionService=d,this.contextKeyService=l,this.inProgress=new Map,this._onForwardPort=new M,this.onForwardPort=this._onForwardPort.event,this._onClosePort=new M,this.onClosePort=this._onClosePort.event,this._onPortName=new M,this.onPortName=this._onPortName.event,this._onCandidatesChanged=new M,this.onCandidatesChanged=this._onCandidatesChanged.event,this._onEnvironmentTunnelsSet=new M,this.onEnvironmentTunnelsSet=this._onEnvironmentTunnelsSet.event,this._environmentTunnelsSet=!1,this.restoreListener=void 0,this.restoreComplete=!1,this.onRestoreComplete=new M,this.unrestoredExtensionTunnels=new Map,this.sessionCachedProperties=new Map,this.portAttributesProviders=[],this.hasCheckedExtensionsOnTunnelOpened=!1,this.mismatchCooldown=new Date,this.configPortsAttributes=new Ua(i),this.tunnelRestoreValue=this.getTunnelRestoreValue(),this._register(this.configPortsAttributes.onDidChangeAttributes(this.updateAttributes,this)),this.forwarded=new Map,this.remoteTunnels=new Map,this.tunnelService.tunnels.then(async u=>{const g=await this.getAttributes(u.map(m=>({port:m.tunnelRemotePort,host:m.tunnelRemoteHost})));for(const m of u)if(m.localAddress){const v=Kr(m.tunnelRemoteHost,m.tunnelRemotePort),_=$r(this._candidates??new Map,m.tunnelRemoteHost,m.tunnelRemotePort);this.forwarded.set(v,{remotePort:m.tunnelRemotePort,remoteHost:m.tunnelRemoteHost,localAddress:m.localAddress,protocol:g?.get(m.tunnelRemotePort)?.protocol??Ha.Http,localUri:await this.makeLocalUri(m.localAddress,g?.get(m.tunnelRemotePort)),localPort:m.tunnelLocalPort,name:g?.get(m.tunnelRemotePort)?.label,runningProcess:_?.detail,hasRunningProcess:!!_,pid:_?.pid,privacy:m.privacy,source:m1}),this.remoteTunnels.set(v,m)}}),this.detected=new Map,this._register(this.tunnelService.onTunnelOpened(async u=>{const g=Kr(u.tunnelRemoteHost,u.tunnelRemotePort);if(!$r(this.forwarded,u.tunnelRemoteHost,u.tunnelRemotePort)&&!$r(this.detected,u.tunnelRemoteHost,u.tunnelRemotePort)&&!$r(this.inProgress,u.tunnelRemoteHost,u.tunnelRemotePort)&&u.localAddress){const m=$r(this._candidates??new Map,u.tunnelRemoteHost,u.tunnelRemotePort),v=(await this.getAttributes([{port:u.tunnelRemotePort,host:u.tunnelRemoteHost}]))?.get(u.tunnelRemotePort);this.forwarded.set(g,{remoteHost:u.tunnelRemoteHost,remotePort:u.tunnelRemotePort,localAddress:u.localAddress,protocol:v?.protocol??Ha.Http,localUri:await this.makeLocalUri(u.localAddress,v),localPort:u.tunnelLocalPort,name:v?.label,closeable:!0,runningProcess:m?.detail,hasRunningProcess:!!m,pid:m?.pid,privacy:u.privacy,source:m1})}await this.storeForwarded(),this.checkExtensionActivationEvents(!0),this.remoteTunnels.set(g,u),this._onForwardPort.fire(this.forwarded.get(g))})),this._register(this.tunnelService.onTunnelClosed(u=>this.onTunnelClosed(u,Rm.Other))),this.checkExtensionActivationEvents(!1)}extensionHasActivationEvent(){return this.extensionService.extensions.find(e=>e.activationEvents?.includes(Ej))?(this.contextKeyService.createKey(NIe.key,!0),!0):!1}checkExtensionActivationEvents(e){if(this.hasCheckedExtensionsOnTunnelOpened||(e&&(this.hasCheckedExtensionsOnTunnelOpened=!0),this.environmentService.remoteAuthority!==void 0&&!e)||this.extensionHasActivationEvent())return;const i=this._register(this.extensionService.onDidRegisterExtensions(()=>{this.extensionHasActivationEvent()&&i.dispose()}))}async onTunnelClosed(e,t){const i=Kr(e.host,e.port);this.forwarded.has(i)&&(this.forwarded.delete(i),await this.storeForwarded(),this._onClosePort.fire(e))}makeLocalUri(e,t){if(e.startsWith("http"))return R.parse(e);const i=t?.protocol??"http";return R.parse(`${i}://${e}`)}async addStorageKeyPostfix(e){const t=this.workspaceContextService.getWorkspace(),i=t.configuration?lc(t.configuration.path):t.folders.length>0?lc(t.folders[0].uri.path):void 0;if(i===void 0){this.logService.debug("Could not get workspace hash for forwarded ports storage key.");return}return`${e}.${this.environmentService.remoteAuthority}.${i}`}async getTunnelRestoreStorageKey(){return this.addStorageKeyPostfix(KD)}async getRestoreExpirationStorageKey(){return this.addStorageKeyPostfix(f1)}async getTunnelRestoreValue(){const e=this.storageService.get(KD,he.WORKSPACE);if(e)return this.storageService.remove(KD,he.WORKSPACE),await this.storeForwarded(),e;const t=await this.getTunnelRestoreStorageKey();if(t)return this.storageService.get(t,he.PROFILE)}async restoreForwarded(){if(this.cleanupExpiredTunnelsForRestore(),this.configurationService.getValue("remote.restoreForwardedPorts")){const e=await this.tunnelRestoreValue;if(e&&e!==this.knownPortsRestoreValue){const t=JSON.parse(e)??[];this.logService.trace(`ForwardedPorts: (TunnelModel) restoring ports ${t.map(i=>i.remotePort).join(", ")}`);for(const i of t){const n=$r(this.detected,i.remoteHost,i.remotePort);i.source.source!==Yd.Extension&&!n||i.source.source===Yd.Extension&&n?await this.doForward({remote:{host:i.remoteHost,port:i.remotePort},local:i.localPort,name:i.name,elevateIfNeeded:!0,source:i.source}):i.source.source===Yd.Extension&&!n&&this.unrestoredExtensionTunnels.set(Kr(i.remoteHost,i.remotePort),i)}}}if(this.restoreComplete=!0,this.onRestoreComplete.fire(),!this.restoreListener){const e=await this.getTunnelRestoreStorageKey();this.restoreListener=this._register(new U),this.restoreListener.add(this.storageService.onDidChangeValue(he.PROFILE,void 0,this.restoreListener)(async t=>{t.key===e&&(this.tunnelRestoreValue=Promise.resolve(this.storageService.get(e,he.PROFILE)),await this.restoreForwarded())}))}}cleanupExpiredTunnelsForRestore(){const e=this.storageService.keys(he.PROFILE,gt.USER).filter(t=>t.startsWith(f1));for(const t of e){const i=this.storageService.getNumber(t,he.PROFILE);if(i&&i<Date.now()){this.tunnelRestoreValue=Promise.resolve(void 0);const n=t.replace(f1,KD);this.storageService.remove(t,he.PROFILE),this.storageService.remove(n,he.PROFILE)}}}async storeForwarded(){if(this.configurationService.getValue("remote.restoreForwardedPorts")){const e=Array.from(this.forwarded.values()),t=e.map(r=>({remoteHost:r.remoteHost,remotePort:r.remotePort,localPort:r.localPort,name:r.name,localAddress:r.localAddress,localUri:r.localUri,protocol:r.protocol,source:r.source}));let i;e.length>0&&(i=JSON.stringify(t));const n=await this.getTunnelRestoreStorageKey(),o=await this.getRestoreExpirationStorageKey();!i&&n&&o?(this.storageService.remove(n,he.PROFILE),this.storageService.remove(o,he.PROFILE)):i!==this.knownPortsRestoreValue&&n&&o&&(this.storageService.store(n,i,he.PROFILE,gt.USER),this.storageService.store(o,Date.now()+LIe,he.PROFILE,gt.USER)),this.knownPortsRestoreValue=i}}async showPortMismatchModalIfNeeded(e,t,i){if(!e.tunnelLocalPort||!i?.requireLocalPort||e.tunnelLocalPort===t)return;const n=new Date;if(this.mismatchCooldown.getTime()+PIe>n.getTime())return;this.mismatchCooldown=n;const o=h(12550,`Local port {0} could not be used for forwarding to remote port {1}.

This usually happens when there is already another process using local port {0}.

Port number {2} has been used instead.`,t,e.tunnelRemotePort,e.tunnelLocalPort);return this.dialogService.info(o)}async forward(e,t){return!this.restoreComplete&&this.environmentService.remoteAuthority&&await T.toPromise(this.onRestoreComplete.event),this.doForward(e,t)}async doForward(e,t){await this.extensionService.activateByEvent(Ej);const i=$r(this.forwarded,e.remote.host,e.remote.port);t=t??(t!==null?(await this.getAttributes([e.remote]))?.get(e.remote.port):void 0);const n=e.local!==void 0?e.local:e.remote.port;let o;if(i)return this.mergeAttributesIntoExistingTunnel(i,e,t);{const r=this.environmentService.remoteAuthority,a=r?{getAddress:async()=>(await this.remoteAuthorityResolverService.resolveAuthority(r)).authority}:void 0,c=Kr(e.remote.host,e.remote.port);this.inProgress.set(c,!0),e=this.mergeCachedAndUnrestoredProperties(c,e);const d=await this.tunnelService.openTunnel(a,e.remote.host,e.remote.port,void 0,n,e.elevateIfNeeded?e.elevateIfNeeded:t?.elevateIfNeeded,e.privacy,t?.protocol);if(typeof d=="string")o=d;else if(d&&d.localAddress){const l=$r(this._candidates??new Map,e.remote.host,e.remote.port),u=d.protocol?d.protocol===Ha.Https?Ha.Https:Ha.Http:t?.protocol??Ha.Http,g={remoteHost:d.tunnelRemoteHost,remotePort:d.tunnelRemotePort,localPort:d.tunnelLocalPort,name:t?.label??e.name,closeable:!0,localAddress:d.localAddress,protocol:u,localUri:await this.makeLocalUri(d.localAddress,t),runningProcess:l?.detail,hasRunningProcess:!!l,pid:l?.pid,source:e.source??m1,privacy:d.privacy};return this.forwarded.set(c,g),this.remoteTunnels.set(c,d),this.inProgress.delete(c),await this.storeForwarded(),await this.showPortMismatchModalIfNeeded(d,n,t),this._onForwardPort.fire(g),d}this.inProgress.delete(c)}return o}mergeCachedAndUnrestoredProperties(e,t){const i=this.unrestoredExtensionTunnels.has(e)?this.unrestoredExtensionTunnels:this.sessionCachedProperties.has(e)?this.sessionCachedProperties:void 0;if(i){const n=i.get(e);i.delete(e),n&&(t.name=n.name??t.name,t.local=("local"in n?n.local:"localPort"in n?n.localPort:void 0)??t.local,t.privacy=t.privacy)}return t}async mergeAttributesIntoExistingTunnel(e,t,i){const n=i?.label??t.name;let o;(function(a){a[a.None=0]="None",a[a.Fire=1]="Fire",a[a.Reopen=2]="Reopen"})(o||(o={}));let r=o.None;switch(n!==e.name&&(e.name=n,r=o.Fire),(i?.protocol||e.protocol!==Ha.Http)&&i?.protocol!==e.protocol&&(t.source=e.source,r=o.Reopen),t.privacy&&e.privacy!==t.privacy&&(r=o.Reopen),r){case o.Fire:{this._onForwardPort.fire();break}case o.Reopen:await this.close(e.remoteHost,e.remotePort,Rm.User),await this.doForward(t,i)}return $r(this.remoteTunnels,t.remote.host,t.remote.port)}async name(e,t,i){const n=$r(this.forwarded,e,t),o=Kr(e,t);if(n){n.name=i,await this.storeForwarded(),this._onPortName.fire({host:e,port:t});return}else this.detected.has(o)&&(this.detected.get(o).name=i,this._onPortName.fire({host:e,port:t}))}async close(e,t,i){const n=Kr(e,t),o=this.forwarded.get(n);return i===Rm.AutoForwardEnd&&o&&o.source.source===Yd.Auto&&this.sessionCachedProperties.set(n,{local:o.localPort,name:o.name,privacy:o.privacy}),await this.tunnelService.closeTunnel(e,t),this.onTunnelClosed({host:e,port:t},i)}address(e,t){const i=Kr(e,t);return(this.forwarded.get(i)||this.detected.get(i))?.localAddress}get environmentTunnelsSet(){return this._environmentTunnelsSet}addEnvironmentTunnels(e){if(e)for(const t of e){const i=$r(this._candidates??new Map,t.remoteAddress.host,t.remoteAddress.port),n=typeof t.localAddress=="string"?t.localAddress:Kr(t.localAddress.host,t.localAddress.port);this.detected.set(Kr(t.remoteAddress.host,t.remoteAddress.port),{remoteHost:t.remoteAddress.host,remotePort:t.remoteAddress.port,localAddress:n,protocol:Ha.Http,localUri:this.makeLocalUri(n),closeable:!1,runningProcess:i?.detail,hasRunningProcess:!!i,pid:i?.pid,privacy:vu.ConstantPrivate,source:{source:Yd.Extension,description:h(12551,"Statically Forwarded")}}),this.tunnelService.setEnvironmentTunnel(t.remoteAddress.host,t.remoteAddress.port,n,vu.ConstantPrivate,Ha.Http)}this._environmentTunnelsSet=!0,this._onEnvironmentTunnelsSet.fire(),this._onForwardPort.fire()}setCandidateFilter(e){this._candidateFilter=e}async setCandidates(e){let t=e;this._candidateFilter&&(t=await this._candidateFilter(e));const i=this.updateInResponseToCandidates(t);this.logService.trace(`ForwardedPorts: (TunnelModel) removed candidates ${Array.from(i.values()).map(n=>n.port).join(", ")}`),this._onCandidatesChanged.fire(i)}updateInResponseToCandidates(e){const t=this._candidates??new Map,i=new Map;return this._candidates=i,e.forEach(n=>{const o=Kr(n.host,n.port);i.set(o,{host:n.host,port:n.port,detail:n.detail,pid:n.pid}),t.has(o)&&t.delete(o);const r=$r(this.forwarded,n.host,n.port);r&&(r.runningProcess=n.detail,r.hasRunningProcess=!0,r.pid=n.pid)}),t.forEach((n,o)=>{const r=OIe(o);if(!r)return;const a=$r(this.forwarded,r.host,r.port);a&&(a.runningProcess=void 0,a.hasRunningProcess=!1,a.pid=void 0);const c=$r(this.detected,r.host,r.port);c&&(c.runningProcess=void 0,c.hasRunningProcess=!1,c.pid=void 0)}),t}get candidates(){return this._candidates?Array.from(this._candidates.values()):[]}get candidatesOrUndefined(){return this._candidates?this.candidates:void 0}async updateAttributes(){const e=Array.from(this.forwarded.values()),t=await this.getAttributes(e.map(i=>({port:i.remotePort,host:i.remoteHost})),!1);if(t)for(const i of e){const n=t.get(i.remotePort);(n?.protocol||i.protocol!==Ha.Http)&&n?.protocol!==i.protocol&&await this.doForward({remote:{host:i.remoteHost,port:i.remotePort},local:i.localPort,name:i.name,source:i.source},n),n&&n.label&&n.label!==i.name&&await this.name(i.remoteHost,i.remotePort,n.label)}}async getAttributes(e,t=!0){const i=new Map,n=new Map;e.forEach(d=>{const l=$r(this._candidates??new Map,KE[0],d.port)??d;if(l){i.set(d.port,l);const u=FIe(l)?l.pid:void 0;n.has(u)||n.set(u,[]),n.get(u)?.push(d.port)}});const o=new Map;if(e.forEach(d=>{const l=this.configPortsAttributes.getAttributes(d.port,d.host,i.get(d.port)?.detail);l&&o.set(d.port,l)}),this.portAttributesProviders.length===0||!t)return o.size>0?o:void 0;const r=await Promise.all(this.portAttributesProviders.flatMap(d=>Array.from(n.entries()).map(l=>{const u=l[1],g=i.get(u[0]);return d.providePortAttributes(u,g?.pid,g?.detail,Ce.None)}))),a=new Map;if(r.forEach(d=>d.forEach(l=>{l&&a.set(l.port,l)})),!o&&!a)return;const c=new Map;return e.forEach(d=>{const l=o.get(d.port),u=a.get(d.port);c.set(d.port,{elevateIfNeeded:l?.elevateIfNeeded,label:l?.label,onAutoForward:l?.onAutoForward??Ua.providedActionToAction(u?.autoForwardAction),requireLocalPort:l?.requireLocalPort,protocol:l?.protocol})}),c}addAttributesProvider(e){this.portAttributesProviders.push(e)}};QE.__decorator=f([Jfe(1e3)],QE.prototype,"storeForwarded",null);QE=f([p(0,TN),p(1,it),p(2,ne),p(3,wn),p(4,Wh),p(5,It),p(6,Re),p(7,ei),p(8,cn),p(9,fe)],QE);const Ij="remote.explorerType",I6e="~remote.forwardedPorts",D6e="~remote.forwardedPortsContainer",Dj="remote.autoForwardPorts",kj="remote.autoForwardPortsSource",k6e="remote.autoForwardPortsFallback",T6e="process",Tj="output",WIe="hybrid";var Aj;(function(s){s.Candidate="Candidate",s.Detected="Detected",s.Forwarded="Forwarded",s.Add="Add"})(Aj||(Aj={}));var Rj;(function(s){s[s.None=0]="None",s[s.New=1]="New",s[s.Label=2]="Label",s[s.LocalPort=3]="LocalPort"})(Rj||(Rj={}));const BIe={type:"object",required:["id"],properties:{id:{description:h(12539,"The ID of a Get Started walkthrough to open."),type:"string"}}},VIe=gl.registerExtensionPoint({extensionPoint:"remoteHelp",jsonSchema:{description:h(12540,"Contributes help information for Remote"),type:"object",properties:{getStarted:{description:h(12541,"The url, or a command that returns the url, to your project's Getting Started page, or a walkthrough ID contributed by your project's extension"),oneOf:[{type:"string"},BIe]},documentation:{description:h(12542,"The url, or a command that returns the url, to your project's documentation page"),type:"string"},feedback:{description:h(12543,"The url, or a command that returns the url, to your project's feedback reporter"),type:"string",markdownDeprecationMessage:h(12544,"Use {0} instead","`reportIssue`")},reportIssue:{description:h(12545,"The url, or a command that returns the url, to your project's issue reporter"),type:"string"},issues:{description:h(12546,"The url, or a command that returns the url, to your project's issues list"),type:"string"}}}});var ku;(function(s){s[s.Disabled=0]="Disabled",s[s.ViewOnly=1]="ViewOnly",s[s.AdditionalFeatures=2]="AdditionalFeatures"})(ku||(ku={}));let Pj=class{constructor(e,t,i){this.storageService=e,this.tunnelService=t,this._targetType=[],this._onDidChangeTargetType=new M,this.onDidChangeTargetType=this._onDidChangeTargetType.event,this._onDidChangeHelpInformation=new M,this.onDidChangeHelpInformation=this._onDidChangeHelpInformation.event,this._helpInformation=[],this._onDidChangeEditable=new M,this.onDidChangeEditable=this._onDidChangeEditable.event,this._onEnabledPortsFeatures=new M,this.onEnabledPortsFeatures=this._onEnabledPortsFeatures.event,this._portsFeaturesEnabled=ku.Disabled,this.namedProcesses=new Map,this._tunnelModel=i.createInstance(QE),VIe.setHandler(n=>{this._helpInformation.push(...n),this._onDidChangeHelpInformation.fire(n)})}get helpInformation(){return this._helpInformation}set targetType(e){const t=this._targetType.length>0?this._targetType[0]:"",i=e.length>0?e[0]:"";t!==i&&(this._targetType=e,this.storageService.store(Ij,this._targetType.toString(),he.WORKSPACE,gt.MACHINE),this.storageService.store(Ij,this._targetType.toString(),he.PROFILE,gt.USER),this._onDidChangeTargetType.fire(this._targetType))}get targetType(){return this._targetType}get tunnelModel(){return this._tunnelModel}forward(e,t){return this.tunnelModel.forward(e,t)}close(e,t){return this.tunnelModel.close(e.host,e.port,t)}setTunnelInformation(e){e?.features&&this.tunnelService.setTunnelFeatures(e.features),this.tunnelModel.addEnvironmentTunnels(e?.environmentTunnels)}setEditable(e,t,i){i?this._editable={tunnelItem:e,data:i,editId:t}:this._editable=void 0,this._onDidChangeEditable.fire(e?{tunnel:e,editId:t}:void 0)}getEditableData(e,t){return this._editable&&(!e&&e===this._editable.tunnelItem||e&&this._editable.tunnelItem?.remotePort===e.remotePort&&this._editable.tunnelItem.remoteHost===e.remoteHost&&this._editable.editId===t)?this._editable.data:void 0}setCandidateFilter(e){return e?(this.tunnelModel.setCandidateFilter(e),{dispose:()=>{this.tunnelModel.setCandidateFilter(void 0)}}):{dispose:()=>{}}}onFoundNewCandidates(e){this.tunnelModel.setCandidates(e)}restore(){return this.tunnelModel.restoreForwarded()}enablePortsFeatures(e){this._portsFeaturesEnabled=e?ku.ViewOnly:ku.AdditionalFeatures,this._onEnabledPortsFeatures.fire()}get portsFeaturesEnabled(){return this._portsFeaturesEnabled}};Pj=f([p(0,it),p(1,TN),p(2,Z)],Pj);const VN=J("remoteExplorerService"),kI=J("searchService"),HIe=J("embedderTerminalService"),UIe=J("textMateTokenizationFeature"),$Ie=J("textEditorService"),eae=J("hostColorSchemeService"),tae=J("timerService"),GIe=J("titleService"),zIe=J("treeSitterTokenizationFeature"),HN=J("IUserDataInitializationService"),qIe=J("IRemoteUserDataProfilesService");class KIe extends F{get currentProfile(){return this._currentProfile}constructor(e){super(),this._onDidChangeCurrentProfile=this._register(new M),this.onDidChangeCurrentProfile=this._onDidChangeCurrentProfile.event,this._currentProfile=e}async updateCurrentProfile(e){if(ic(this._currentProfile,e))return;const t=this._currentProfile;this._currentProfile=e;const i=[];this._onDidChangeCurrentProfile.fire({previous:t,profile:e,join(n){i.push(n)}}),await Pp.settled(i)}}const te=Object.freeze({View:I(1680,"View"),Help:I(1681,"Help"),Test:I(1682,"Test"),File:I(1683,"File"),Preferences:I(1684,"Preferences"),Developer:I(1685,"Developer")});var XE;(function(s){s.Uninitialized="uninitialized",s.Unavailable="unavailable",s.Available="available"})(XE||(XE={}));I(12894,"Settings Sync");Pe("settings-sync-view-icon",K.sync,h(12895,"View icon of the Settings Sync view."));const jIe=new O("syncStatus",UE.Uninitialized);new O("syncEnabled",!1);const YIe=new O("userDataSyncAccountStatus",XE.Uninitialized);new O("enableSyncActivityViews",!1);new O("enableSyncConflictsView",!1);new O("hasConflicts",!1);I(12896,"Download Settings Sync Activity"),te.Developer,x.and(YIe.isEqualTo(XE.Available),jIe.notEqualsTo(UE.Uninitialized));const QIe=J("IUserDataSyncWorkbenchService"),io=J("viewsService"),iae=J("workingCopyEditorService"),XIe=J("workingCopyHistoryService"),ZIe=J("IWorkspaceIdentityService"),JIe=J("chatMarkdownAnchorService"),eDe={};let tDe;function nae(s){return eDe[s]}function iDe(){return tDe}const Gq=J("chatEntitlementService"),zq=J("IPromptsService"),UN=J("ISuggestMemories"),$N=J("semanticTokensStylingService"),TI=J("IOutlineModelService"),sae=J("IMarkerNavigationService"),oae=J("ICodeLensCache"),rae=J("IInlayHintsCache"),GN=J("ISymbolNavigationService"),aae=J("IPeekViewService"),ol=-1,Rr=-2,R6e=-3;function P6e(s){return typeof s=="number"||rq(s)}function aB(s,e,t){let i=!1;const n=nDe(s);if(Jse(n)&&(e.restoreViewState(n),i=!0),s.selection){const o={startLineNumber:s.selection.startLineNumber,startColumn:s.selection.startColumn,endLineNumber:s.selection.endLineNumber??s.selection.startLineNumber,endColumn:s.selection.endColumn??s.selection.startColumn};e.setSelection(o,s.selectionSource??td.NAVIGATION),s.selectionRevealType===Dm.NearTop?e.revealRangeNearTop(o,t):s.selectionRevealType===Dm.NearTopIfOutsideViewport?e.revealRangeNearTopIfOutsideViewport(o,t):s.selectionRevealType===Dm.CenterIfOutsideViewport?e.revealRangeInCenterIfOutsideViewport(o,t):e.revealRangeInCenter(o,t),i=!0}return i}function nDe(s){if(!s.selection||!s.viewState)return s.viewState;const e=s.viewState;if(e.modified)return e.modified.cursorState=[],e;const t=s.viewState;return t.cursorState&&(t.cursorState=[]),t}let cB=class extends eme{constructor(e,t,i){super(t),this.editorService=e,this.configurationService=i,this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditor.bind(this))),this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditorFromDiff.bind(this)))}getActiveCodeEditor(){const e=this.editorService.activeTextEditorControl;if(mo(e))return e;if(Zu(e))return e.getModifiedEditor();const t=this.editorService.activeEditorPane?.getControl();return cA(t)&&mo(t.activeCodeEditor)?t.activeCodeEditor:null}async doOpenCodeEditorFromDiff(e,t,i){const n=this.editorService.activeTextEditorControl;if(!i&&Zu(n)&&e.options&&e.resource&&t===n.getModifiedEditor()&&n.getModel()&&At(e.resource,n.getModel()?.modified.uri)){const o=n.getModifiedEditor();return aB(e.options,o,Qi.Smooth),o}return null}async doOpenCodeEditor(e,t,i){if(!this.configurationService.getValue().workbench?.editor?.enablePreviewFromCodeNavigation&&t&&!e.options?.pinned&&!i&&!At(t.getModel()?.uri,e.resource)){for(const r of this.editorService.visibleEditorPanes)if(mI(r.getControl())===t){r.group.pinEditor();break}}const o=await this.editorService.openEditor(e,i?Rr:ol);if(o){const r=o.getControl();if(mo(r))return r;if(cA(r)&&mo(r.activeCodeEditor))return r.activeCodeEditor}return null}};cB=f([p(0,de),p(1,pt),p(2,ne)],cB);function zN(s,e,t,i,n,o){if(Array.isArray(s)){let r=0;for(const a of s){const c=zN(a,e,t,i,n,o);if(c===10)return c;c>r&&(r=c)}return r}else{if(typeof s=="string")return i?s==="*"?5:s===t?10:0:0;if(s){const{language:r,pattern:a,scheme:c,hasAccessToAllModels:d,notebookType:l}=s;if(!i&&!d)return 0;l&&n&&(e=n);let u=0;if(c)if(c===e.scheme)u=10;else if(c==="*")u=5;else return 0;if(r)if(r===t)u=10;else if(r==="*")u=Math.max(u,5);else return 0;if(l)if(l===o)u=10;else if(l==="*"&&o!==void 0)u=Math.max(u,5);else return 0;if(a){let g;if(typeof a=="string"?g=a:g={...a,base:bz(a.base)},g===e.fsPath||Db(g,e.fsPath))u=10;else return 0}return u}else return 0}}function sDe(s){return typeof s=="string"?!1:Array.isArray(s)?s.some(sDe):!!s.notebookType}function cae(s){return typeof s=="string"?!1:Array.isArray(s)?s.every(cae):!!s.exclusive}class Lj{constructor(e,t,i,n,o){this.uri=e,this.languageId=t,this.notebookUri=i,this.notebookType=n,this.recursive=o}equals(e){return this.notebookType===e.notebookType&&this.languageId===e.languageId&&this.uri.toString()===e.uri.toString()&&this.notebookUri?.toString()===e.notebookUri?.toString()&&this.recursive===e.recursive}}class Ni{constructor(e){this._notebookInfoResolver=e,this._clock=0,this._entries=[],this._onDidChange=new M,this.onDidChange=this._onDidChange.event}register(e,t){let i={selector:e,provider:t,_score:-1,_time:this._clock++};return this._entries.push(i),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),Ie(()=>{if(i){const n=this._entries.indexOf(i);n>=0&&(this._entries.splice(n,1),this._lastCandidate=void 0,this._onDidChange.fire(this._entries.length),i=void 0)}})}has(e){return this.all(e).length>0}all(e){if(!e)return[];this._updateScores(e,!1);const t=[];for(const i of this._entries)i._score>0&&t.push(i.provider);return t}allNoModel(){return this._entries.map(e=>e.provider)}ordered(e,t=!1){const i=[];return this._orderedForEach(e,t,n=>i.push(n.provider)),i}orderedGroups(e){const t=[];let i,n;return this._orderedForEach(e,!1,o=>{i&&n===o._score?i.push(o.provider):(n=o._score,i=[o.provider],t.push(i))}),t}_orderedForEach(e,t,i){this._updateScores(e,t);for(const n of this._entries)n._score>0&&i(n)}_updateScores(e,t){const i=this._notebookInfoResolver?.(e.uri),n=i?new Lj(e.uri,e.getLanguageId(),i.uri,i.type,t):new Lj(e.uri,e.getLanguageId(),void 0,void 0,t);if(!this._lastCandidate?.equals(n)){this._lastCandidate=n;for(const o of this._entries)if(o._score=zN(o.selector,n.uri,n.languageId,Cu(e),n.notebookUri,n.notebookType),cae(o.selector)&&o._score>0)if(t)o._score=0;else{for(const r of this._entries)r._score=0;o._score=1e3;break}this._entries.sort(Ni._compareByScoreAndTime)}}static _compareByScoreAndTime(e,t){return e._score<t._score?1:e._score>t._score?-1:US(e.selector)&&!US(t.selector)?1:!US(e.selector)&&US(t.selector)?-1:e._time<t._time?1:e._time>t._time?-1:0}}function US(s){return typeof s=="string"?!1:Array.isArray(s)?s.some(US):!!s.isBuiltin}class oDe{constructor(){this.referenceProvider=new Ni(this._score.bind(this)),this.renameProvider=new Ni(this._score.bind(this)),this.newSymbolNamesProvider=new Ni(this._score.bind(this)),this.codeActionProvider=new Ni(this._score.bind(this)),this.definitionProvider=new Ni(this._score.bind(this)),this.typeDefinitionProvider=new Ni(this._score.bind(this)),this.declarationProvider=new Ni(this._score.bind(this)),this.implementationProvider=new Ni(this._score.bind(this)),this.documentSymbolProvider=new Ni(this._score.bind(this)),this.inlayHintsProvider=new Ni(this._score.bind(this)),this.colorProvider=new Ni(this._score.bind(this)),this.codeLensProvider=new Ni(this._score.bind(this)),this.documentFormattingEditProvider=new Ni(this._score.bind(this)),this.documentRangeFormattingEditProvider=new Ni(this._score.bind(this)),this.onTypeFormattingEditProvider=new Ni(this._score.bind(this)),this.signatureHelpProvider=new Ni(this._score.bind(this)),this.hoverProvider=new Ni(this._score.bind(this)),this.documentHighlightProvider=new Ni(this._score.bind(this)),this.multiDocumentHighlightProvider=new Ni(this._score.bind(this)),this.selectionRangeProvider=new Ni(this._score.bind(this)),this.foldingRangeProvider=new Ni(this._score.bind(this)),this.linkProvider=new Ni(this._score.bind(this)),this.inlineCompletionsProvider=new Ni(this._score.bind(this)),this.inlineEditProvider=new Ni(this._score.bind(this)),this.completionProvider=new Ni(this._score.bind(this)),this.linkedEditingRangeProvider=new Ni(this._score.bind(this)),this.inlineValuesProvider=new Ni(this._score.bind(this)),this.evaluatableExpressionProvider=new Ni(this._score.bind(this)),this.documentRangeSemanticTokensProvider=new Ni(this._score.bind(this)),this.documentSemanticTokensProvider=new Ni(this._score.bind(this)),this.documentDropEditProvider=new Ni(this._score.bind(this)),this.documentPasteEditProvider=new Ni(this._score.bind(this))}setNotebookTypeResolver(e){this._notebookTypeResolver=e}_score(e){return this._notebookTypeResolver?.(e)}}var zf;let dB=class{constructor(e){this.instantiationService=e}createDiffProvider(e){return this.instantiationService.createInstance(lB,e)}};dB=f([p(0,Z)],dB);let lB=class{static{zf=this}static{this.diffCache=new Map}constructor(e,t,i){this.editorWorkerService=t,this.telemetryService=i,this.onDidChangeEventEmitter=new M,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="advanced",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(e)}dispose(){this.diffAlgorithmOnDidChangeSubscription?.dispose()}async computeDiff(e,t,i,n){if(typeof this.diffAlgorithm!="string")return this.diffAlgorithm.computeDiff(e,t,i,n);if(e.isDisposed()||t.isDisposed())return{changes:[],identical:!0,quitEarly:!1,moves:[]};if(e.getLineCount()===1&&e.getLineMaxColumn(1)===1)return t.getLineCount()===1&&t.getLineMaxColumn(1)===1?{changes:[],identical:!0,quitEarly:!1,moves:[]}:{changes:[new tme(new xr(1,2),new xr(1,t.getLineCount()+1),[new yz(e.getFullModelRange(),t.getFullModelRange())])],identical:!1,quitEarly:!1,moves:[]};const o=JSON.stringify([e.uri.toString(),t.uri.toString()]),r=JSON.stringify([e.id,t.id,e.getAlternativeVersionId(),t.getAlternativeVersionId(),JSON.stringify(i)]),a=zf.diffCache.get(o);if(a&&a.context===r)return a.result;const c=Xn.create(),d=await this.editorWorkerService.computeDiff(e.uri,t.uri,i,this.diffAlgorithm),l=c.elapsed();if(this.telemetryService.publicLog2("diffEditor.computeDiff",{timeMs:l,timedOut:d?.quitEarly??!0,detectedMoves:i.computeMoves?d?.moves.length??0:-1}),n.isCancellationRequested)return{changes:[],identical:!1,quitEarly:!0,moves:[]};if(!d)throw new Error("no diff result available");return zf.diffCache.size>10&&zf.diffCache.delete(zf.diffCache.keys().next().value),zf.diffCache.set(o,{result:d,context:r}),d}setOptions(e){let t=!1;e.diffAlgorithm&&this.diffAlgorithm!==e.diffAlgorithm&&(this.diffAlgorithmOnDidChangeSubscription?.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=e.diffAlgorithm,typeof e.diffAlgorithm!="string"&&(this.diffAlgorithmOnDidChangeSubscription=e.diffAlgorithm.onDidChange(()=>this.onDidChangeEventEmitter.fire())),t=!0),t&&this.onDidChangeEventEmitter.fire()}};lB=zf=f([p(1,vc),p(2,ai)],lB);class Jl{remove(){this.parent?.children.delete(this.id)}static findId(e,t){let i;typeof e=="string"?i=`${t.id}/${e}`:(i=`${t.id}/${e.name}`,t.children.get(i)!==void 0&&(i=`${t.id}/${e.name}_${e.range.startLineNumber}_${e.range.startColumn}`));let n=i;for(let o=0;t.children.get(n)!==void 0;o++)n=`${i}_${o}`;return n}static getElementById(e,t){if(!e)return;const i=sf(e,t.id);if(i===e.length)return t;if(!(i<t.id.length))for(const[,n]of t.children){const o=Jl.getElementById(e,n);if(o)return o}}static size(e){let t=1;for(const[,i]of e.children)t+=Jl.size(i);return t}static empty(e){return e.children.size===0}}class WA extends Jl{constructor(e,t,i){super(),this.id=e,this.parent=t,this.symbol=i,this.children=new Map}}class hB extends Jl{constructor(e,t,i,n){super(),this.id=e,this.parent=t,this.label=i,this.order=n,this.children=new Map}getItemEnclosingPosition(e){return e?this._getItemEnclosingPosition(e,this.children):void 0}_getItemEnclosingPosition(e,t){for(const[,i]of t)if(!(!i.symbol.range||!P.containsPosition(i.symbol.range,e)))return this._getItemEnclosingPosition(e,i.children)||i}updateMarker(e){for(const[,t]of this.children)this._updateMarker(e,t)}_updateMarker(e,t){t.marker=void 0;const i=MT(e,t.symbol.range,P.compareRangesUsingStarts);let n;i<0?(n=~i,n>0&&P.areIntersecting(e[n-1],t.symbol.range)&&(n-=1)):n=i;const o=[];let r;for(;n<e.length&&P.areIntersecting(t.symbol.range,e[n]);n++){const a=e[n];o.push(a),e[n]=void 0,(!r||a.severity>r)&&(r=a.severity)}for(const[,a]of t.children)this._updateMarker(o,a);r&&(t.marker={count:o.length,topSev:r}),Nie(e)}}class zl extends Jl{static create(e,t,i){const n=new li(i),o=new zl(t.uri),r=e.ordered(t),a=r.map((d,l)=>{const u=Jl.findId(`provider_${l}`,o),g=new hB(u,o,d.displayName??"Unknown Outline Provider",l);return Promise.resolve(d.provideDocumentSymbols(t,n.token)).then(m=>{for(const v of m||[])zl._makeOutlineElement(v,g);return g},m=>(Ln(m),g)).then(m=>{Jl.empty(m)?m.remove():o._groups.set(u,m)})}),c=e.onDidChange(()=>{const d=e.ordered(t);rs(d,r)||n.cancel()});return Promise.all(a).then(()=>n.token.isCancellationRequested&&!i.isCancellationRequested?zl.create(e,t,i):o._compact()).finally(()=>{n.dispose(),c.dispose(),n.dispose()})}static _makeOutlineElement(e,t){const i=Jl.findId(e,t),n=new WA(i,t,e);if(e.children)for(const o of e.children)zl._makeOutlineElement(o,n);t.children.set(n.id,n)}static get(e){for(;e;){if(e instanceof zl)return e;e=e.parent}}constructor(e){super(),this.uri=e,this.id="root",this.parent=void 0,this._groups=new Map,this.children=new Map,this.id="root",this.parent=void 0}_compact(){let e=0;for(const[t,i]of this._groups)i.children.size===0?this._groups.delete(t):e+=1;if(e!==1)this.children=this._groups;else{const t=As.first(this._groups.values());for(const[,i]of t.children)i.parent=this,this.children.set(i.id,i)}return this}merge(e){return this.uri.toString()!==e.uri.toString()||this._groups.size!==e._groups.size?!1:(this._groups=e._groups,this.children=e.children,!0)}getItemEnclosingPosition(e,t){let i;if(t){let o=t.parent;for(;o&&!i;)o instanceof hB&&(i=o),o=o.parent}let n;for(const[,o]of this._groups)if(n=o.getItemEnclosingPosition(e),n&&(!i||i===o))break;return n}getItemById(e){return Jl.getElementById(e,this)}updateMarker(e){e.sort(P.compareRangesUsingStarts);for(const[,t]of this._groups)t.updateMarker(e.slice(0))}getTopLevelSymbols(){const e=[];for(const t of this.children.values())t instanceof WA?e.push(t.symbol):e.push(...As.map(t.children.values(),i=>i.symbol));return e.sort((t,i)=>P.compareRangesUsingStarts(t.range,i.range))}asListOfDocumentSymbols(){const e=this.getTopLevelSymbols(),t=[];return zl._flattenDocumentSymbols(t,e,""),t.sort((i,n)=>we.compare(P.getStartPosition(i.range),P.getStartPosition(n.range))||we.compare(P.getEndPosition(n.range),P.getEndPosition(i.range)))}static _flattenDocumentSymbols(e,t,i){for(const n of t)e.push({kind:n.kind,tags:n.tags,name:n.name,detail:n.detail,containerName:n.containerName||i,range:n.range,selectionRange:n.selectionRange,children:void 0}),n.children&&zl._flattenDocumentSymbols(e,n.children,n.name)}}let uB=class{constructor(e,t,i){this._languageFeaturesService=e,this._disposables=new U,this._cache=new zm(15,.7),this._debounceInformation=t.for(e.documentSymbolProvider,"DocumentSymbols",{min:350}),this._disposables.add(i.onModelRemoved(n=>{this._cache.delete(n.id)}))}dispose(){this._disposables.dispose()}async getOrCreate(e,t){const i=this._languageFeaturesService.documentSymbolProvider,n=i.ordered(e);let o=this._cache.get(e.id);if(!o||o.versionId!==e.getVersionId()||!rs(o.provider,n)){const a=new li;o={versionId:e.getVersionId(),provider:n,promiseCnt:0,source:a,promise:zl.create(i,e,a.token),model:void 0},this._cache.set(e.id,o);const c=Date.now();o.promise.then(d=>{o.model=d,this._debounceInformation.update(e,Date.now()-c)}).catch(d=>{this._cache.delete(e.id)})}if(o.model)return o.model;o.promiseCnt+=1;const r=t.onCancellationRequested(()=>{--o.promiseCnt===0&&(o.source.cancel(),this._cache.delete(e.id))});try{return await o.promise}finally{r.dispose()}}getDebounceValue(e){return this._debounceInformation.get(e)}getCachedModels(){return As.filter(As.map(this._cache.values(),e=>e.model),e=>e!==void 0)}};uB=f([p(0,Ne),p(1,Sd),p(2,ci)],uB);var $S;class qq{constructor(e){this.name=e}select(e,t,i){if(i.length===0)return 0;const n=i[0].score[0];for(let o=0;o<i.length;o++){const{score:r,completion:a}=i[o];if(r[0]!==n)break;if(a.preselect)return o}return 0}}class Mj extends qq{constructor(){super("first")}memorize(e,t,i){}toJSON(){}fromJSON(){}}class rDe extends qq{constructor(){super("recentlyUsed"),this._cache=new zm(300,.66),this._seq=0}memorize(e,t,i){const n=`${e.getLanguageId()}/${i.textLabel}`;this._cache.set(n,{touch:this._seq++,type:i.completion.kind,insertText:i.completion.insertText})}select(e,t,i){if(i.length===0)return 0;const n=e.getLineContent(t.lineNumber).substr(t.column-10,t.column-1);if(/\s$/.test(n))return super.select(e,t,i);const o=i[0].score[0];let r=-1,a=-1,c=-1;for(let d=0;d<i.length&&i[d].score[0]===o;d++){const l=`${e.getLanguageId()}/${i[d].textLabel}`,u=this._cache.peek(l);if(u&&u.touch>c&&u.type===i[d].completion.kind&&u.insertText===i[d].completion.insertText&&(c=u.touch,a=d),i[d].completion.preselect&&r===-1)return r=d}return a!==-1?a:r!==-1?r:0}toJSON(){return this._cache.toJSON()}fromJSON(e){this._cache.clear();const t=0;for(const[i,n]of e)n.touch=t,n.type=typeof n.type=="number"?n.type:MM.fromString(n.type),this._cache.set(i,n);this._seq=this._cache.size}}class aDe extends qq{constructor(){super("recentlyUsedByPrefix"),this._trie=Hie.forStrings(),this._seq=0}memorize(e,t,i){const{word:n}=e.getWordUntilPosition(t),o=`${e.getLanguageId()}/${n}`;this._trie.set(o,{type:i.completion.kind,insertText:i.completion.insertText,touch:this._seq++})}select(e,t,i){const{word:n}=e.getWordUntilPosition(t);if(!n)return super.select(e,t,i);const o=`${e.getLanguageId()}/${n}`;let r=this._trie.get(o);if(r||(r=this._trie.findSubstr(o)),r)for(let a=0;a<i.length;a++){const{kind:c,insertText:d}=i[a].completion;if(c===r.type&&d===r.insertText)return a}return super.select(e,t,i)}toJSON(){const e=[];return this._trie.forEach((t,i)=>e.push([i,t])),e.sort((t,i)=>-(t[1].touch-i[1].touch)).forEach((t,i)=>t[1].touch=i),e.slice(0,200)}fromJSON(e){if(this._trie.clear(),e.length>0){this._seq=e[0][1].touch+1;for(const[t,i]of e)i.type=typeof i.type=="number"?i.type:MM.fromString(i.type),this._trie.set(t,i)}}}let gB=class{static{$S=this}static{this._strategyCtors=new Map([["recentlyUsedByPrefix",aDe],["recentlyUsed",rDe],["first",Mj]])}static{this._storagePrefix="suggest/memories"}constructor(e,t){this._storageService=e,this._configService=t,this._disposables=new U,this._persistSoon=new yn(()=>this._saveState(),500),this._disposables.add(e.onWillSaveState(i=>{i.reason===Jx.SHUTDOWN&&this._saveState()}))}dispose(){this._disposables.dispose(),this._persistSoon.dispose()}memorize(e,t,i){this._withStrategy(e,t).memorize(e,t,i),this._persistSoon.schedule()}select(e,t,i){return this._withStrategy(e,t).select(e,t,i)}_withStrategy(e,t){const i=this._configService.getValue("editor.suggestSelection",{overrideIdentifier:e.getLanguageIdAtPosition(t.lineNumber,t.column),resource:e.uri});if(this._strategy?.name!==i){this._saveState();const n=$S._strategyCtors.get(i)||Mj;this._strategy=new n;try{const r=this._configService.getValue("editor.suggest.shareSuggestSelections")?he.PROFILE:he.WORKSPACE,a=this._storageService.get(`${$S._storagePrefix}/${i}`,r);a&&this._strategy.fromJSON(JSON.parse(a))}catch{}}return this._strategy}_saveState(){if(this._strategy){const t=this._configService.getValue("editor.suggest.shareSuggestSelections")?he.PROFILE:he.WORKSPACE,i=JSON.stringify(this._strategy);this._storageService.store(`${$S._storagePrefix}/${this._strategy.name}`,i,t,gt.MACHINE)}}};gB=$S=f([p(0,it),p(1,ne)],gB);class Cy{constructor(){this.lenses=[]}static{this.Empty=new Cy}dispose(){this._store?.dispose()}get isDisposed(){return this._store?.isDisposed??!1}add(e,t){NM(e)&&(this._store??=new U,this._store.add(e));for(const i of e.lenses)this.lenses.push({symbol:i,provider:t})}}async function dae(s,e,t){const i=s.ordered(e),n=new Map,o=new Cy,r=i.map(async(a,c)=>{n.set(a,c);try{const d=await Promise.resolve(a.provideCodeLenses(e,t));d&&o.add(d,a)}catch(d){Ln(d)}});return await Promise.all(r),t.isCancellationRequested?(o.dispose(),Cy.Empty):(o.lenses=o.lenses.sort((a,c)=>a.symbol.range.startLineNumber<c.symbol.range.startLineNumber?-1:a.symbol.range.startLineNumber>c.symbol.range.startLineNumber?1:n.get(a.provider)<n.get(c.provider)?-1:n.get(a.provider)>n.get(c.provider)?1:a.symbol.range.startColumn<c.symbol.range.startColumn?-1:a.symbol.range.startColumn>c.symbol.range.startColumn?1:0),o)}Ee.registerCommand("_executeCodeLensProvider",function(s,...e){let[t,i]=e;yt(R.isUri(t)),yt(typeof i=="number"||!i);const{codeLensProvider:n}=s.get(Ne),o=s.get(ci).getModel(t);if(!o)throw Nt();const r=[],a=new U;return dae(n,o,Ce.None).then(c=>{a.add(c);const d=[];for(const l of c.lenses)i==null||l.symbol.command?r.push(l.symbol):i-- >0&&l.provider.resolveCodeLens&&d.push(Promise.resolve(l.provider.resolveCodeLens(o,l.symbol,Ce.None)).then(u=>r.push(u||l.symbol)));return Promise.all(d)}).then(()=>r).finally(()=>{setTimeout(()=>a.dispose(),100)})});class Nj{constructor(e,t){this.lineCount=e,this.data=t}}let pB=class{constructor(e){this._fakeProvider=new class{provideCodeLenses(){throw new Error("not supported")}},this._cache=new zm(20,.75);const t="codelens/cache";Uie(zi,()=>e.remove(t,he.WORKSPACE));const i="codelens/cache2",n=e.get(i,he.WORKSPACE,"{}");this._deserialize(n);const o=T.filter(e.onWillSaveState,r=>r.reason===Jx.SHUTDOWN);T.once(o)(r=>{e.store(i,this._serialize(),he.WORKSPACE,gt.MACHINE)})}put(e,t){const i=t.lenses.map(r=>({range:r.symbol.range,command:r.symbol.command&&{id:"",title:r.symbol.command?.title}})),n=new Cy;n.add({lenses:i},this._fakeProvider);const o=new Nj(e.getLineCount(),n);this._cache.set(e.uri.toString(),o)}get(e){const t=this._cache.get(e.uri.toString());return t&&t.lineCount===e.getLineCount()?t.data:void 0}delete(e){this._cache.delete(e.uri.toString())}_serialize(){const e=Object.create(null);for(const[t,i]of this._cache){const n=new Set;for(const o of i.data.lenses)n.add(o.symbol.range.startLineNumber);e[t]={lineCount:i.lineCount,lines:[...n.values()]}}return JSON.stringify(e)}_deserialize(e){try{const t=JSON.parse(e);for(const i in t){const n=t[i],o=[];for(const a of n.lines)o.push({range:new P(a,1,a,11)});const r=new Cy;r.add({lenses:o},this._fakeProvider),this._cache.set(i,new Nj(n.lineCount,r))}}catch{}}};pB=f([p(0,it)],pB);const cDe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let pd=class extends gI{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(e,{...n.getRawOptions(),overflowWidgetsDomNode:n.getOverflowWidgetsDomNode()},i,o,r,a,c,d,l,u,g,m),this._parentEditor=n,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(n.onDidChangeConfiguration(v=>this._onParentConfigurationChanged(v)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){Vu(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};pd=f([p(4,Z),p(5,Bt),p(6,Ge),p(7,fe),p(8,pt),p(9,Dt),p(10,Nr),p(11,ds),p(12,Ne)],pd);function lae(s){const e=s.get(Bt).getFocusedCodeEditor();return e instanceof pd?e.getParentEditor():e}const dDe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(dDe);const Oj=new ye(new qm(0,122,204)),lDe={showArrow:!0,showFrame:!0,className:"",frameColor:Oj,arrowColor:Oj,keepEditorSelection:!1},hDe="vs.editor.contrib.zoneWidget";class uDe{constructor(e,t,i,n,o,r,a,c){this.id="",this.domNode=e,this.afterLineNumber=t,this.afterColumn=i,this.heightInLines=n,this.showInHiddenAreas=a,this.ordinal=c,this._onDomNodeTop=o,this._onComputedHeight=r}onDomNodeTop(e){this._onDomNodeTop(e)}onComputedHeight(e){this._onComputedHeight(e)}}class gDe{constructor(e,t){this._id=e,this._domNode=t}getId(){return this._id}getDomNode(){return this._domNode}getPosition(){return null}}class Kq{static{this._IdGenerator=new ime(".arrow-decoration-")}constructor(e){this._editor=e,this._ruleName=Kq._IdGenerator.nextId(),this._color=null,this._height=-1,this._decorations=this._editor.createDecorationsCollection()}dispose(){this.hide(),N6(this._ruleName)}set color(e){this._color!==e&&(this._color=e,this._updateStyle())}set height(e){this._height!==e&&(this._height=e,this._updateStyle())}_updateStyle(){N6(this._ruleName),OM(`.monaco-editor ${this._ruleName}`,`border-style: solid; border-color: transparent; border-bottom-color: ${this._color}; border-width: ${this._height}px; bottom: -${this._height}px !important; margin-left: -${this._height}px; `)}show(e){e.column===1&&(e={lineNumber:e.lineNumber,column:2}),this._decorations.set([{range:P.fromPositions(e),options:{description:"zone-widget-arrow",className:this._ruleName,stickiness:ki.NeverGrowsWhenTypingAtEdges}}])}hide(){this._decorations.clear()}}class hae{constructor(e,t={}){this._arrow=null,this._overlayWidget=null,this._resizeSash=null,this._isSashResizeHeight=!1,this._viewZone=null,this._disposables=new U,this.container=null,this._isShowing=!1,this.editor=e,this._positionMarkerId=this.editor.createDecorationsCollection(),this.options=Tr(t),Vu(this.options,lDe,!1),this.domNode=document.createElement("div"),this.options.isAccessible||(this.domNode.setAttribute("aria-hidden","true"),this.domNode.setAttribute("role","presentation")),this._disposables.add(this.editor.onDidLayoutChange(i=>{const n=this._getWidth(i);this.domNode.style.width=n+"px",this.domNode.style.left=this._getLeft(i)+"px",this._onWidth(n)}))}dispose(){this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._viewZone&&this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id),this._viewZone=null}),this._positionMarkerId.clear(),this._disposables.dispose()}create(){this.domNode.classList.add("zone-widget"),this.options.className&&this.domNode.classList.add(this.options.className),this.container=document.createElement("div"),this.container.classList.add("zone-widget-container"),this.domNode.appendChild(this.container),this.options.showArrow&&(this._arrow=new Kq(this.editor),this._disposables.add(this._arrow)),this._fillContainer(this.container),this._initSash(),this._applyStyles()}style(e){e.frameColor&&(this.options.frameColor=e.frameColor),e.arrowColor&&(this.options.arrowColor=e.arrowColor),this._applyStyles()}_applyStyles(){if(this.container&&this.options.frameColor){const e=this.options.frameColor.toString();this.container.style.borderTopColor=e,this.container.style.borderBottomColor=e}if(this._arrow&&this.options.arrowColor){const e=this.options.arrowColor.toString();this._arrow.color=e}}_getWidth(e){return e.width-e.minimap.minimapWidth-e.verticalScrollbarWidth}_getLeft(e){return e.minimap.minimapWidth>0&&e.minimap.minimapLeft===0?e.minimap.minimapWidth:0}_onViewZoneTop(e){this.domNode.style.top=e+"px"}_onViewZoneHeight(e){if(this.domNode.style.height=`${e}px`,this.container){const t=e-this._decoratingElementsHeight();this.container.style.height=`${t}px`;const i=this.editor.getLayoutInfo();this._doLayout(t,this._getWidth(i))}this._resizeSash?.layout()}get position(){const e=this._positionMarkerId.getRange(0);if(e)return e.getStartPosition()}hasFocus(){return this.domNode.contains(wh())}show(e,t){const i=P.isIRange(e)?P.lift(e):P.fromPositions(e);this._isShowing=!0,this._showImpl(i,t),this._isShowing=!1,this._positionMarkerId.set([{range:i,options:Zt.EMPTY}])}updatePositionAndHeight(e,t){this._viewZone&&(e=P.isIRange(e)?P.getStartPosition(e):e,this._viewZone.afterLineNumber=e.lineNumber,this._viewZone.afterColumn=e.column,this._viewZone.heightInLines=t??this._viewZone.heightInLines,this.editor.changeViewZones(i=>{i.layoutZone(this._viewZone.id)}),this._positionMarkerId.set([{range:P.isIRange(e)?e:P.fromPositions(e),options:Zt.EMPTY}]),this._updateSashEnablement())}hide(){this._viewZone&&(this.editor.changeViewZones(e=>{this._viewZone&&e.removeZone(this._viewZone.id)}),this._viewZone=null),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this._arrow?.hide(),this._positionMarkerId.clear(),this._isSashResizeHeight=!1}_decoratingElementsHeight(){const e=this.editor.getOption(L.lineHeight);let t=0;if(this.options.showArrow){const i=Math.round(e/3);t+=2*i}if(this.options.showFrame){const i=this.options.frameWidth??Math.round(e/9);t+=2*i}return t}_getMaximumHeightInLines(){return Math.max(12,this.editor.getLayoutInfo().height/this.editor.getOption(L.lineHeight)*.8)}_showImpl(e,t){const i=e.getStartPosition(),n=this.editor.getLayoutInfo(),o=this._getWidth(n);this.domNode.style.width=`${o}px`,this.domNode.style.left=this._getLeft(n)+"px";const r=document.createElement("div");r.style.overflow="hidden";const a=this.editor.getOption(L.lineHeight),c=this._getMaximumHeightInLines();c!==void 0&&(t=Math.min(t,c));let d=0,l=0;if(this._arrow&&this.options.showArrow&&(d=Math.round(a/3),this._arrow.height=d,this._arrow.show(i)),this.options.showFrame&&(l=Math.round(a/9)),this.editor.changeViewZones(m=>{this._viewZone&&m.removeZone(this._viewZone.id),this._overlayWidget&&(this.editor.removeOverlayWidget(this._overlayWidget),this._overlayWidget=null),this.domNode.style.top="-1000px",this._viewZone=new uDe(r,i.lineNumber,i.column,t,v=>this._onViewZoneTop(v),v=>this._onViewZoneHeight(v),this.options.showInHiddenAreas,this.options.ordinal),this._viewZone.id=m.addZone(this._viewZone),this._overlayWidget=new gDe(hDe+this._viewZone.id,this.domNode),this.editor.addOverlayWidget(this._overlayWidget)}),this._updateSashEnablement(),this.container&&this.options.showFrame){const m=this.options.frameWidth?this.options.frameWidth:l;this.container.style.borderTopWidth=m+"px",this.container.style.borderBottomWidth=m+"px"}const u=t*a-this._decoratingElementsHeight();this.container&&(this.container.style.top=d+"px",this.container.style.height=u+"px",this.container.style.overflow="hidden"),this._doLayout(u,o),this.options.keepEditorSelection||this.editor.setSelection(e);const g=this.editor.getModel();if(g){const m=g.validateRange(new P(e.startLineNumber,1,e.endLineNumber+1,1));this.revealRange(m,m.startLineNumber===g.getLineCount())}}revealRange(e,t){t?this.editor.revealLineNearTop(e.endLineNumber,Qi.Smooth):this.editor.revealRange(e,Qi.Smooth)}setCssClass(e,t){this.container&&(t&&this.container.classList.remove(t),this.container.classList.add(e))}_onWidth(e){}_doLayout(e,t){}_relayout(e,t){const i=this._getMaximumHeightInLines(),n=t&&i!==void 0?Math.min(i,e):e;this._viewZone&&this._viewZone.heightInLines!==n&&(this.editor.changeViewZones(o=>{this._viewZone&&(this._viewZone.heightInLines=n,o.layoutZone(this._viewZone.id))}),this._updateSashEnablement())}_initSash(){if(this._resizeSash)return;this._resizeSash=this._disposables.add(new $_(this.domNode,this,{orientation:St.HORIZONTAL})),this.options.isResizeable||(this._resizeSash.state=Bd.Disabled);let e;this._disposables.add(this._resizeSash.onDidStart(t=>{this._viewZone&&(e={startY:t.startY,heightInLines:this._viewZone.heightInLines,...this._getResizeBounds()})})),this._disposables.add(this._resizeSash.onDidEnd(()=>{e=void 0})),this._disposables.add(this._resizeSash.onDidChange(t=>{if(e){const i=(t.currentY-e.startY)/this.editor.getOption(L.lineHeight),n=i<0?Math.ceil(i):Math.floor(i),o=e.heightInLines+n;o>e.minLines&&o<e.maxLines&&(this._isSashResizeHeight=!0,this._relayout(o))}}))}_updateSashEnablement(){if(this._resizeSash){const{minLines:e,maxLines:t}=this._getResizeBounds();this._resizeSash.state=e===t?Bd.Disabled:Bd.Enabled}}get _usesResizeHeight(){return this._isSashResizeHeight}_getResizeBounds(){return{minLines:5,maxLines:35}}getHorizontalSashLeft(){return 0}getHorizontalSashTop(){return(this.domNode.style.height===null?0:parseInt(this.domNode.style.height))-this._decoratingElementsHeight()/2}getHorizontalSashWidth(){const e=this.editor.getLayoutInfo();return e.width-e.minimap.minimapWidth}}Ve(cDe);class pDe{constructor(){this._widgets=new Map}addExclusiveWidget(e,t){const i=this._widgets.get(e);i&&(i.listener.dispose(),i.widget.dispose());const n=()=>{const o=this._widgets.get(e);o&&o.widget===t&&(o.listener.dispose(),this._widgets.delete(e))};this._widgets.set(e,{widget:t,listener:t.onDidClose(n)})}}var Pr;(function(s){s.inPeekEditor=new O("inReferenceSearchEditor",!0,h(1371,"Whether the current code editor is embedded inside peek")),s.notInPeekEditor=s.inPeekEditor.toNegated()})(Pr||(Pr={}));let BA=class{static{this.ID="editor.contrib.referenceController"}constructor(e,t){e instanceof pd&&Pr.inPeekEditor.bindTo(t)}dispose(){}};BA=f([p(1,fe)],BA);Lt(BA.ID,BA,_t.Eager);const fDe={headerBackgroundColor:ye.white,primaryHeadingColor:ye.fromHex("#333333"),secondaryHeadingColor:ye.fromHex("#6c6c6cb3")};let VA=class extends hae{constructor(e,t,i){super(e,t),this.instantiationService=i,this._onDidClose=new M,this.onDidClose=this._onDidClose.event,Vu(this.options,fDe,!1);const n=Rs(this.editor);n.openedPeekWidgets.set(n.openedPeekWidgets.get()+1,void 0)}dispose(){if(!this.disposed){this.disposed=!0,super.dispose(),this._onDidClose.fire(this);const e=Rs(this.editor);e.openedPeekWidgets.set(e.openedPeekWidgets.get()-1,void 0)}}style(e){const t=this.options;e.headerBackgroundColor&&(t.headerBackgroundColor=e.headerBackgroundColor),e.primaryHeadingColor&&(t.primaryHeadingColor=e.primaryHeadingColor),e.secondaryHeadingColor&&(t.secondaryHeadingColor=e.secondaryHeadingColor),super.style(e)}_applyStyles(){super._applyStyles();const e=this.options;this._headElement&&e.headerBackgroundColor&&(this._headElement.style.backgroundColor=e.headerBackgroundColor.toString()),this._primaryHeading&&e.primaryHeadingColor&&(this._primaryHeading.style.color=e.primaryHeadingColor.toString()),this._secondaryHeading&&e.secondaryHeadingColor&&(this._secondaryHeading.style.color=e.secondaryHeadingColor.toString()),this._bodyElement&&e.frameColor&&(this._bodyElement.style.borderColor=e.frameColor.toString())}_fillContainer(e){this.setCssClass("peekview-widget"),this._headElement=j(".head"),this._bodyElement=j(".body"),this._fillHead(this._headElement),this._fillBody(this._bodyElement),e.appendChild(this._headElement),e.appendChild(this._bodyElement)}_fillHead(e,t){this._titleElement=j(".peekview-title"),this.options.supportOnTitleClick&&(this._titleElement.classList.add("clickable"),No(this._titleElement,"click",o=>this._onTitleClick(o))),ee(this._headElement,this._titleElement),this._fillTitleIcon(this._titleElement),this._primaryHeading=j("span.filename"),this._secondaryHeading=j("span.dirname"),this._metaHeading=j("span.meta"),ee(this._titleElement,this._primaryHeading,this._secondaryHeading,this._metaHeading);const i=j(".peekview-actions");ee(this._headElement,i);const n=this._getActionBarOptions();this._actionbarWidget=new Ar(i,n),this._disposables.add(this._actionbarWidget),t||this._actionbarWidget.push(this._disposables.add(new Xt("peekview.close",h(1372,"Close"),ke.asClassName(K.close),!0,()=>(this.dispose(),Promise.resolve()))),{label:!1,icon:!0})}_fillTitleIcon(e){}_getActionBarOptions(){return{actionViewItemProvider:mw.bind(void 0,this.instantiationService),orientation:xa.HORIZONTAL}}_onTitleClick(e){}setTitle(e,t){this._primaryHeading&&this._secondaryHeading&&(this._primaryHeading.innerText=e,this._primaryHeading.setAttribute("title",e),t?this._secondaryHeading.innerText=t:Xi(this._secondaryHeading))}setMetaTitle(e){this._metaHeading&&(e?(this._metaHeading.innerText=e,Qo(this._metaHeading)):Qs(this._metaHeading))}_doLayout(e,t){if(!this._isShowing&&e<0){this.dispose();return}const i=Math.ceil(this.editor.getOption(L.lineHeight)*1.2),n=Math.round(e-(i+2));this._doLayoutHead(i,t),this._doLayoutBody(n,t)}_doLayoutHead(e,t){this._headElement&&(this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height)}_doLayoutBody(e,t){this._bodyElement&&(this._bodyElement.style.height=`${e}px`)}};VA=f([p(2,Z)],VA);const uae=H("peekViewTitle.background",{dark:"#252526",light:"#F3F3F3",hcDark:ye.black,hcLight:ye.white},h(1373,"Background color of the peek view title area.")),gae=H("peekViewTitleLabel.foreground",{dark:ye.white,light:ye.black,hcDark:ye.white,hcLight:po},h(1374,"Color of the peek view title.")),pae=H("peekViewTitleDescription.foreground",{dark:"#ccccccb3",light:"#616161",hcDark:"#FFFFFF99",hcLight:"#292929"},h(1375,"Color of the peek view title info.")),fae=H("peekView.border",{dark:wE,light:wE,hcDark:tt,hcLight:tt},h(1376,"Color of the peek view borders and arrow.")),mDe=H("peekViewResult.background",{dark:"#252526",light:"#F3F3F3",hcDark:ye.black,hcLight:ye.white},h(1377,"Background color of the peek view result list."));H("peekViewResult.lineForeground",{dark:"#bbbbbb",light:"#646465",hcDark:ye.white,hcLight:po},h(1378,"Foreground color for line nodes in the peek view result list."));H("peekViewResult.fileForeground",{dark:ye.white,light:"#1E1E1E",hcDark:ye.white,hcLight:po},h(1379,"Foreground color for file nodes in the peek view result list."));H("peekViewResult.selectionBackground",{dark:"#3399ff33",light:"#3399ff33",hcDark:null,hcLight:null},h(1380,"Background color of the selected entry in the peek view result list."));H("peekViewResult.selectionForeground",{dark:ye.white,light:"#6C6C6C",hcDark:ye.white,hcLight:po},h(1381,"Foreground color of the selected entry in the peek view result list."));const mae=H("peekViewEditor.background",{dark:"#001F33",light:"#F2F8FC",hcDark:ye.black,hcLight:ye.white},h(1382,"Background color of the peek view editor."));H("peekViewEditorGutter.background",mae,h(1383,"Background color of the gutter in the peek view editor."));H("peekViewEditorStickyScroll.background",mae,h(1384,"Background color of sticky scroll in the peek view editor."));H("peekViewResult.matchHighlightBackground",{dark:"#ea5c004d",light:"#ea5c004d",hcDark:null,hcLight:null},h(1385,"Match highlight color in the peek view result list."));const U6e=H("peekViewEditor.matchHighlightBackground",{dark:"#ff8f0099",light:"#f5d802de",hcDark:null,hcLight:null},h(1386,"Match highlight color in the peek view editor."));H("peekViewEditor.matchHighlightBorder",{dark:null,light:null,hcDark:kr,hcLight:kr},h(1387,"Match highlight border in the peek view editor."));class Fj{constructor(e,t,i){this.marker=e,this.index=t,this.total=i}}let fB=class{constructor(e,t,i){this._markerService=t,this._configService=i,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._dispoables=new U,this._markers=[],this._nextIdx=-1,R.isUri(e)?this._resourceFilter=a=>a.toString()===e.toString():e&&(this._resourceFilter=e);const n=this._configService.getValue("problems.sortOrder"),o=(a,c)=>{let d=NT(a.resource.toString(),c.resource.toString());return d===0&&(n==="position"?d=P.compareRangesUsingStarts(a,c)||Bn.compare(a.severity,c.severity):d=Bn.compare(a.severity,c.severity)||P.compareRangesUsingStarts(a,c)),d},r=()=>{let a=this._markerService.read({resource:R.isUri(e)?e:void 0,severities:Bn.Error|Bn.Warning|Bn.Info});return typeof e=="function"&&(a=a.filter(c=>this._resourceFilter(c.resource))),a.sort(o),rs(a,this._markers,(c,d)=>c.resource.toString()===d.resource.toString()&&c.startLineNumber===d.startLineNumber&&c.startColumn===d.startColumn&&c.endLineNumber===d.endLineNumber&&c.endColumn===d.endColumn&&c.severity===d.severity&&c.message===d.message)?!1:(this._markers=a,!0)};r(),this._dispoables.add(t.onMarkerChanged(a=>{(!this._resourceFilter||a.some(c=>this._resourceFilter(c)))&&r()&&(this._nextIdx=-1,this._onDidChange.fire())}))}dispose(){this._dispoables.dispose(),this._onDidChange.dispose()}matches(e){return!this._resourceFilter&&!e?!0:!this._resourceFilter||!e?!1:this._resourceFilter(e)}get selected(){const e=this._markers[this._nextIdx];return e&&new Fj(e,this._nextIdx+1,this._markers.length)}_initIdx(e,t,i){let n=this._markers.findIndex(o=>At(o.resource,e.uri));if(n<0)n=nme(this._markers.length,o=>NT(this._markers[o].resource.toString(),e.uri.toString())),n<0&&(n=~n),i?this._nextIdx=n:this._nextIdx=(this._markers.length+n-1)%this._markers.length;else{let o=!1,r=!1;for(let a=n;a<this._markers.length;a++){let c=P.lift(this._markers[a]);if(c.isEmpty()){const d=e.getWordAtPosition(c.getStartPosition());d&&(c=new P(c.startLineNumber,d.startColumn,c.startLineNumber,d.endColumn))}if(t&&(c.containsPosition(t)||t.isBeforeOrEqual(c.getStartPosition()))){this._nextIdx=a,o=!0,r=!c.containsPosition(t);break}if(this._markers[a].resource.toString()!==e.uri.toString())break}o?r&&!i&&(this._nextIdx-=1):this._nextIdx=i?0:this._markers.length-1}this._nextIdx<0&&(this._nextIdx=this._markers.length-1)}resetIndex(){this._nextIdx=-1}move(e,t,i){if(this._markers.length===0)return!1;const n=this._nextIdx;return this._nextIdx===-1?this._initIdx(t,i,e):e?this._nextIdx=(this._nextIdx+1)%this._markers.length:e||(this._nextIdx=(this._nextIdx-1+this._markers.length)%this._markers.length),n!==this._nextIdx}find(e,t){let i=this._markers.findIndex(n=>n.resource.toString()===e.toString());if(!(i<0)){for(;i<this._markers.length;i++)if(P.containsPosition(this._markers[i],t))return new Fj(this._markers[i],i+1,this._markers.length)}}};fB=f([p(1,FM),p(2,ne)],fB);let mB=class{constructor(e,t){this._markerService=e,this._configService=t,this._provider=new wz}registerProvider(e){const t=this._provider.unshift(e);return Ie(()=>t())}getMarkerList(e){for(const t of this._provider){const i=t.getMarkerList(e);if(i)return i}return new fB(e,this._markerService,this._configService)}};mB=f([p(0,FM),p(1,ne)],mB);function vB(s,e){return!!s[e]}class v1{constructor(e,t){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.hasTriggerModifier=vB(e.event,t.triggerModifier),this.hasSideBySideModifier=vB(e.event,t.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}}class Wj{constructor(e,t){this.keyCodeIsTriggerKey=e.keyCode===t.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===t.triggerSideBySideKey,this.hasTriggerModifier=vB(e,t.triggerModifier)}}class jD{constructor(e,t,i,n){this.triggerKey=e,this.triggerModifier=t,this.triggerSideBySideKey=i,this.triggerSideBySideModifier=n}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}}function Bj(s){return s==="altKey"?Yt?new jD(S.Meta,"metaKey",S.Alt,"altKey"):new jD(S.Ctrl,"ctrlKey",S.Alt,"altKey"):Yt?new jD(S.Alt,"altKey",S.Meta,"metaKey"):new jD(S.Alt,"altKey",S.Ctrl,"ctrlKey")}class qN extends F{constructor(e,t){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new M),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new M),this.onExecute=this._onExecute.event,this._onCancel=this._register(new M),this.onCancel=this._onCancel.event,this._editor=e,this._extractLineNumberFromMouseEvent=t?.extractLineNumberFromMouseEvent??(i=>i.target.position?i.target.position.lineNumber:0),this._opts=Bj(this._editor.getOption(L.multiCursorModifier)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration(i=>{if(i.hasChanged(L.multiCursorModifier)){const n=Bj(this._editor.getOption(L.multiCursorModifier));if(this._opts.equals(n))return;this._opts=n,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}})),this._register(this._editor.onMouseMove(i=>this._onEditorMouseMove(new v1(i,this._opts)))),this._register(this._editor.onMouseDown(i=>this._onEditorMouseDown(new v1(i,this._opts)))),this._register(this._editor.onMouseUp(i=>this._onEditorMouseUp(new v1(i,this._opts)))),this._register(this._editor.onKeyDown(i=>this._onEditorKeyDown(new Wj(i,this._opts)))),this._register(this._editor.onKeyUp(i=>this._onEditorKeyUp(new Wj(i,this._opts)))),this._register(this._editor.onMouseDrag(()=>this._resetHandler())),this._register(this._editor.onDidChangeCursorSelection(i=>this._onDidChangeCursorSelection(i))),this._register(this._editor.onDidChangeModel(i=>this._resetHandler())),this._register(this._editor.onDidChangeModelContent(()=>this._resetHandler())),this._register(this._editor.onDidScrollChange(i=>{(i.scrollTopChanged||i.scrollLeftChanged)&&this._resetHandler()}))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=this._extractLineNumberFromMouseEvent(e)}_onEditorMouseUp(e){const t=this._extractLineNumberFromMouseEvent(e);this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===t&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}class vae{constructor(e,t){this.range=e,this.direction=t}}class jq{constructor(e,t,i){this.hint=e,this.anchor=t,this.provider=i,this._isResolved=!1}with(e){const t=new jq(this.hint,e.anchor,this.provider);return t._isResolved=this._isResolved,t._currentResolve=this._currentResolve,t}async resolve(e){if(typeof this.provider.resolveInlayHint=="function"){if(this._currentResolve)return await this._currentResolve,e.isCancellationRequested?void 0:this.resolve(e);this._isResolved||(this._currentResolve=this._doResolve(e).finally(()=>this._currentResolve=void 0)),await this._currentResolve}}async _doResolve(e){try{const t=await Promise.resolve(this.provider.resolveInlayHint(this.hint,e));this.hint.tooltip=t?.tooltip??this.hint.tooltip,this.hint.label=t?.label??this.hint.label,this.hint.textEdits=t?.textEdits??this.hint.textEdits,this._isResolved=!0}catch(t){Ln(t),this._isResolved=!1}}}class Bb{static{this._emptyInlayHintList=Object.freeze({dispose(){},hints:[]})}static async create(e,t,i,n){const o=[],r=e.ordered(t).reverse().map(a=>i.map(async c=>{try{const d=await a.provideInlayHints(t,c,n);(d?.hints.length||a.onDidChangeInlayHints)&&o.push([d??Bb._emptyInlayHintList,a])}catch(d){Ln(d)}}));if(await Promise.all(r.flat()),n.isCancellationRequested||t.isDisposed())throw new fo;return new Bb(i,o,t)}constructor(e,t,i){this._disposables=new U,this.ranges=e,this.provider=new Set;const n=[];for(const[o,r]of t){this._disposables.add(o),this.provider.add(r);for(const a of o.hints){const c=i.validatePosition(a.position);let d="before";const l=Bb._getRangeAtPosition(i,c);let u;l.getStartPosition().isBefore(c)?(u=P.fromPositions(l.getStartPosition(),c),d="after"):(u=P.fromPositions(c,l.getEndPosition()),d="before"),n.push(new jq(a,new vae(u,d),r))}}this.items=n.sort((o,r)=>we.compare(o.hint.position,r.hint.position))}dispose(){this._disposables.dispose()}static _getRangeAtPosition(e,t){const i=t.lineNumber,n=e.getWordAtPosition(t);if(n)return new P(i,n.startColumn,i,n.endColumn);e.tokenization.tokenizeIfCheap(i);const o=e.tokenization.getLineTokens(i),r=t.column-1,a=o.findTokenIndexAtOffset(r);let c=o.getStartOffset(a),d=o.getEndOffset(a);return d-c===1&&(c===r&&a>1?(c=o.getStartOffset(a-1),d=o.getEndOffset(a-1)):d===r&&a<o.getCount()-1&&(c=o.getStartOffset(a+1),d=o.getEndOffset(a+1))),new P(i,c+1,i,d+1)}}function _ae(s){return R.from({scheme:ae.command,path:s.id,query:s.arguments&&encodeURIComponent(JSON.stringify(s.arguments))}).toString()}class eg{constructor(e,t,i,n){this.isProviderFirst=e,this.parent=t,this.link=i,this._rangeCallback=n,this.id=sme.nextId()}get uri(){return this.link.uri}get range(){return this._range??this.link.targetSelectionRange??this.link.range}set range(e){this._range=e,this._rangeCallback(this)}get ariaMessage(){const e=this.parent.getPreview(this)?.preview(this.range);return e?h(1146,"{0} in {1} on line {2} at column {3}",e.value,Qe(this.uri),this.range.startLineNumber,this.range.startColumn):h(1145,"in {0} on line {1} at column {2}",Qe(this.uri),this.range.startLineNumber,this.range.startColumn)}}class vDe{constructor(e){this._modelReference=e}dispose(){this._modelReference.dispose()}preview(e,t=8){const i=this._modelReference.object.textEditorModel;if(!i)return;const{startLineNumber:n,startColumn:o,endLineNumber:r,endColumn:a}=e,c=i.getWordUntilPosition({lineNumber:n,column:o-t}),d=new P(n,c.startColumn,n,o),l=new P(r,a,r,Ia.MAX_SAFE_SMALL_INTEGER),u=i.getValueInRange(d).replace(/^\s+/,""),g=i.getValueInRange(e),m=i.getValueInRange(l).replace(/\s+$/,"");return{value:u+g+m,highlight:{start:u.length,end:u.length+g.length}}}}class Ey{constructor(e,t){this.parent=e,this.uri=t,this.children=[],this._previews=new In}dispose(){Xe(this._previews.values()),this._previews.clear()}getPreview(e){return this._previews.get(e.uri)}get ariaMessage(){const e=this.children.length;return e===1?h(1147,"1 symbol in {0}, full path {1}",Qe(this.uri),this.uri.fsPath):h(1148,"{0} symbols in {1}, full path {2}",e,Qe(this.uri),this.uri.fsPath)}async resolve(e){if(this._previews.size!==0)return this;for(const t of this.children)if(!this._previews.has(t.uri))try{const i=await e.createModelReference(t.uri);this._previews.set(t.uri,new vDe(i))}catch(i){mt(i)}return this}}class sa{constructor(e,t){this.groups=[],this.references=[],this._onDidChangeReferenceRange=new M,this.onDidChangeReferenceRange=this._onDidChangeReferenceRange.event,this._links=e,this._title=t;const[i]=e;e.sort(sa._compareReferences);let n;for(const o of e)if((!n||!SE.isEqual(n.uri,o.uri,!0))&&(n=new Ey(this,o.uri),this.groups.push(n)),n.children.length===0||sa._compareReferences(o,n.children[n.children.length-1])!==0){const r=new eg(i===o,n,o,a=>this._onDidChangeReferenceRange.fire(a));this.references.push(r),n.children.push(r)}}dispose(){Xe(this.groups),this._onDidChangeReferenceRange.dispose(),this.groups.length=0}clone(){return new sa(this._links,this._title)}get title(){return this._title}get isEmpty(){return this.groups.length===0}get ariaMessage(){return this.isEmpty?h(1149,"No results found"):this.references.length===1?h(1150,"Found 1 symbol in {0}",this.references[0].uri.fsPath):this.groups.length===1?h(1151,"Found {0} symbols in {1}",this.references.length,this.groups[0].uri.fsPath):h(1152,"Found {0} symbols in {1} files",this.references.length,this.groups.length)}nextOrPreviousReference(e,t){const{parent:i}=e;let n=i.children.indexOf(e);const o=i.children.length,r=i.parent.groups.length;return r===1||t&&n+1<o||!t&&n>0?(t?n=(n+1)%o:n=(n+o-1)%o,i.children[n]):(n=i.parent.groups.indexOf(i),t?(n=(n+1)%r,i.parent.groups[n].children[0]):(n=(n+r-1)%r,i.parent.groups[n].children[i.parent.groups[n].children.length-1]))}nearestReference(e,t){const i=this.references.map((n,o)=>({idx:o,prefixLen:sf(n.uri.toString(),e.toString()),offsetDist:Math.abs(n.range.startLineNumber-t.lineNumber)*100+Math.abs(n.range.startColumn-t.column)})).sort((n,o)=>n.prefixLen>o.prefixLen?-1:n.prefixLen<o.prefixLen?1:n.offsetDist<o.offsetDist?-1:n.offsetDist>o.offsetDist?1:0)[0];if(i)return this.references[i.idx]}referenceAt(e,t){for(const i of this.references)if(i.uri.toString()===e.toString()&&P.containsPosition(i.range,t))return i}firstReference(){for(const e of this.references)if(e.isProviderFirst)return e;return this.references[0]}static _compareReferences(e,t){return SE.compare(e.uri,t.uri)||P.compareRangesUsingStarts(e.range,t.range)}}const _De=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var _B;let bB=class{constructor(e){this._resolverService=e}hasChildren(e){return e instanceof sa||e instanceof Ey}getChildren(e){if(e instanceof sa)return e.groups;if(e instanceof Ey)return e.resolve(this._resolverService).then(t=>t.children);throw new Error("bad tree")}};bB=f([p(0,Ci)],bB);class bDe{getHeight(){return 23}getTemplateId(e){return e instanceof Ey?HA.id:KN.id}}let yB=class{constructor(e){this._keybindingService=e}getKeyboardNavigationLabel(e){if(e instanceof eg){const t=e.parent.getPreview(e)?.preview(e.range);if(t)return t.value}return Qe(e.uri)}mightProducePrintableCharacter(e){return this._keybindingService.mightProducePrintableCharacter(e)}};yB=f([p(0,He)],yB);class yDe{getId(e){return e instanceof eg?e.id:e.uri}}let wB=class extends F{constructor(e,t){super(),this._labelService=t;const i=document.createElement("div");i.classList.add("reference-file"),this.file=this._register(new Sz(i,{supportHighlights:!0})),this.badge=this._register(new $ie(ee(i,j(".count")),{},Gie)),e.appendChild(i)}set(e,t){const i=_s(e.uri);this.file.setLabel(this._labelService.getUriBasenameLabel(e.uri),this._labelService.getUriLabel(i,{relative:!0}),{title:this._labelService.getUriLabel(e.uri),matches:t});const n=e.children.length;this.badge.setCount(n),n>1?this.badge.setTitleFormat(h(1139,"{0} references",n)):this.badge.setTitleFormat(h(1140,"{0} reference",n))}};wB=f([p(1,ui)],wB);let HA=class{static{_B=this}static{this.id="FileReferencesRenderer"}constructor(e){this._instantiationService=e,this.templateId=_B.id}renderTemplate(e){return this._instantiationService.createInstance(wB,e)}renderElement(e,t,i){i.set(e.element,vw(e.filterData))}disposeTemplate(e){e.dispose()}};HA=_B=f([p(0,Z)],HA);class wDe extends F{constructor(e){super(),this.label=this._register(new ome(e))}set(e,t){const i=e.parent.getPreview(e)?.preview(e.range);if(!i||!i.value)this.label.set(`${Qe(e.uri)}:${e.range.startLineNumber+1}:${e.range.startColumn+1}`);else{const{value:n,highlight:o}=i;t&&!CE.isDefault(t)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(n,vw(t))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(n,[o]))}}}class KN{constructor(){this.templateId=KN.id}static{this.id="OneReferenceRenderer"}renderTemplate(e){return new wDe(e)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}}class SDe{getWidgetAriaLabel(){return h(1141,"References")}getAriaLabel(e){return e.ariaMessage}}Ve(_De);class Yq{static{this.DecorationOptions=Zt.register({description:"reference-decoration",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"reference-decoration"})}constructor(e,t){this._editor=e,this._model=t,this._decorations=new Map,this._decorationIgnoreSet=new Set,this._callOnDispose=new U,this._callOnModelChange=new U,this._callOnDispose.add(this._editor.onDidChangeModel(()=>this._onModelChanged())),this._onModelChanged()}dispose(){this._callOnModelChange.dispose(),this._callOnDispose.dispose(),this.removeDecorations()}_onModelChanged(){this._callOnModelChange.clear();const e=this._editor.getModel();if(e){for(const t of this._model.references)if(t.uri.toString()===e.uri.toString()){this._addDecorations(t.parent);return}}}_addDecorations(e){if(!this._editor.hasModel())return;this._callOnModelChange.add(this._editor.getModel().onDidChangeDecorations(()=>this._onDecorationChanged()));const t=[],i=[];for(let n=0,o=e.children.length;n<o;n++){const r=e.children[n];this._decorationIgnoreSet.has(r.id)||r.uri.toString()===this._editor.getModel().uri.toString()&&(t.push({range:r.range,options:Yq.DecorationOptions}),i.push(n))}this._editor.changeDecorations(n=>{const o=n.deltaDecorations([],t);for(let r=0;r<o.length;r++)this._decorations.set(o[r],e.children[i[r]])})}_onDecorationChanged(){const e=[],t=this._editor.getModel();if(t){for(const[i,n]of this._decorations){const o=t.getDecorationRange(i);if(!o)continue;let r=!1;if(!P.equalsRange(o,n.range)){if(P.spansMultipleLines(o))r=!0;else{const a=n.range.endColumn-n.range.startColumn,c=o.endColumn-o.startColumn;a!==c&&(r=!0)}r?(this._decorationIgnoreSet.add(n.id),e.push(i)):n.range=o}}for(let i=0,n=e.length;i<n;i++)this._decorations.delete(e[i]);this._editor.removeDecorations(e)}}removeDecorations(){this._editor.removeDecorations([...this._decorations.keys()]),this._decorations.clear()}}class CDe{constructor(){this.ratio=.7,this.heightInLines=18}static fromJSON(e){let t,i;try{const n=JSON.parse(e);t=n.ratio,i=n.heightInLines}catch{}return{ratio:t||.7,heightInLines:i||18}}}class EDe extends Cz{}let SB=class{constructor(e){this.labelService=e,this.disposables=new U}getDragURI(e){return e instanceof Ey?e.uri.toString():e instanceof eg?SF(e.uri,e.range).toString():null}getDragLabel(e){return e.length===0?void 0:e.map(i=>this.labelService.getUriBasenameLabel(i.uri)).join(", ")}onDragStart(e,t){if(!t.dataTransfer)return;const n=e.elements.map(o=>this.getDragURI(o)).filter(Boolean);n.length&&(t.dataTransfer.setData(Ds.RESOURCES,JSON.stringify(n)),t.dataTransfer.setData(Ds.TEXT,n.join(`
`)))}onDragOver(){return!1}drop(){}dispose(){this.disposables.dispose()}};SB=f([p(0,ui)],SB);let CB=class extends VA{constructor(e,t,i,n,o,r,a,c,d){super(e,{showFrame:!1,showArrow:!0,isResizeable:!0,isAccessible:!0,supportOnTitleClick:!0},r),this._defaultTreeKeyboardSupport=t,this.layoutData=i,this._textModelResolverService=o,this._instantiationService=r,this._peekViewService=a,this._uriLabel=c,this._keybindingService=d,this._disposeOnNewModel=new U,this._callOnDispose=new U,this._onDidSelectReference=new M,this.onDidSelectReference=this._onDidSelectReference.event,this._dim=new Ye(0,0),this._isClosing=!1,this._applyTheme(n.getColorTheme()),this._callOnDispose.add(n.onDidColorThemeChange(this._applyTheme.bind(this))),this._peekViewService.addExclusiveWidget(e,this),this.create()}get isClosing(){return this._isClosing}dispose(){this._isClosing=!0,this.setModel(void 0),this._callOnDispose.dispose(),this._disposeOnNewModel.dispose(),Xe(this._preview),Xe(this._previewNotAvailableMessage),Xe(this._tree),Xe(this._previewModelReference),this._splitView.dispose(),super.dispose()}_applyTheme(e){const t=e.getColor(fae)||ye.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(uae)||ye.transparent,primaryHeadingColor:e.getColor(gae),secondaryHeadingColor:e.getColor(pae)})}show(e){super.show(e,this.layoutData.heightInLines||18)}focusOnReferenceTree(){this._tree.domFocus()}focusOnPreviewEditor(){this._preview.focus()}isPreviewEditorFocused(){return this._preview.hasTextFocus()}_onTitleClick(e){this._preview&&this._preview.getModel()&&this._onDidSelectReference.fire({element:this._getFocusedReference(),kind:e.ctrlKey||e.metaKey||e.altKey?"side":"open",source:"title"})}_fillBody(e){this.setCssClass("reference-zone-widget"),this._messageContainer=ee(e,j("div.messages")),Qs(this._messageContainer),this._splitView=new OT(e,{orientation:St.HORIZONTAL}),this._previewContainer=ee(e,j("div.preview.inline"));const t={scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!0},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}};this._preview=this._instantiationService.createInstance(pd,this._previewContainer,t,{},this.editor),Qs(this._previewContainer),this._previewNotAvailableMessage=this._instantiationService.createInstance(ry,h(1142,"no preview available"),WM,ry.DEFAULT_CREATION_OPTIONS,null),this._treeContainer=ee(e,j("div.ref-tree.inline"));const i={keyboardSupport:this._defaultTreeKeyboardSupport,accessibilityProvider:new SDe,keyboardNavigationLabelProvider:this._instantiationService.createInstance(yB),identityProvider:new yDe,openOnSingleClick:!0,selectionNavigation:!0,overrideStyles:{listBackground:mDe},dnd:this._instantiationService.createInstance(SB)};this._defaultTreeKeyboardSupport&&this._callOnDispose.add(No(this._treeContainer,"keydown",o=>{o.equals(S.Escape)&&(this._keybindingService.dispatchEvent(o,o.target),o.stopPropagation())},!0)),this._tree=this._instantiationService.createInstance(EDe,"ReferencesWidget",this._treeContainer,new bDe,[this._instantiationService.createInstance(HA),this._instantiationService.createInstance(KN)],this._instantiationService.createInstance(bB),i),this._splitView.addView({onDidChange:T.None,element:this._previewContainer,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:o=>{this._preview.layout({height:this._dim.height,width:o})}},EE.Distribute),this._splitView.addView({onDidChange:T.None,element:this._treeContainer,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:o=>{this._treeContainer.style.height=`${this._dim.height}px`,this._treeContainer.style.width=`${o}px`,this._tree.layout(this._dim.height,o)}},EE.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this.layoutData.ratio=this._splitView.getViewSize(0)/this._dim.width)},void 0));const n=(o,r)=>{o instanceof eg&&(r==="show"&&this._revealReference(o,!1),this._onDidSelectReference.fire({element:o,kind:r,source:"tree"}))};this._disposables.add(this._tree.onDidOpen(o=>{o.sideBySide?n(o.element,"side"):o.editorOptions.pinned?n(o.element,"goto"):n(o.element,"show")})),Qs(this._treeContainer)}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._dim=new Ye(t,e),this.layoutData.heightInLines=this._viewZone?this._viewZone.heightInLines:this.layoutData.heightInLines,this._splitView.layout(t),this._splitView.resizeView(0,t*this.layoutData.ratio)}setSelection(e){return this._revealReference(e,!0).then(()=>{this._model&&(this._tree.setSelection([e]),this._tree.setFocus([e]))})}setModel(e){return this._disposeOnNewModel.clear(),this._model=e,this._model?this._onNewModel():Promise.resolve()}_onNewModel(){return this._model?this._model.isEmpty?(this.setTitle(""),this._messageContainer.innerText=h(1143,"No results"),Qo(this._messageContainer),Promise.resolve(void 0)):(Qs(this._messageContainer),this._decorationsManager=new Yq(this._preview,this._model),this._disposeOnNewModel.add(this._decorationsManager),this._disposeOnNewModel.add(this._model.onDidChangeReferenceRange(e=>this._tree.rerender(e))),this._disposeOnNewModel.add(this._preview.onMouseDown(e=>{const{event:t,target:i}=e;if(t.detail!==2)return;const n=this._getFocusedReference();n&&this._onDidSelectReference.fire({element:{uri:n.uri,range:i.range},kind:t.ctrlKey||t.metaKey||t.altKey?"side":"open",source:"editor"})})),this.container.classList.add("results-loaded"),Qo(this._treeContainer),Qo(this._previewContainer),this._splitView.layout(this._dim.width),this.focusOnReferenceTree(),this._tree.setInput(this._model.groups.length===1?this._model.groups[0]:this._model)):Promise.resolve(void 0)}_getFocusedReference(){const[e]=this._tree.getFocus();if(e instanceof eg)return e;if(e instanceof Ey&&e.children.length>0)return e.children[0]}async revealReference(e){await this._revealReference(e,!1),this._onDidSelectReference.fire({element:e,kind:"goto",source:"tree"})}async _revealReference(e,t){if(this._revealedReference===e)return;this._revealedReference=e,e.uri.scheme!==ae.inMemory?this.setTitle(Zd(e.uri),this._uriLabel.getUriLabel(_s(e.uri))):this.setTitle(h(1144,"References"));const i=this._textModelResolverService.createModelReference(e.uri);this._tree.getInput()===e.parent?this._tree.reveal(e):(t&&this._tree.reveal(e.parent),await this._tree.expand(e.parent),this._tree.reveal(e));const n=await i;if(!this._model){n.dispose();return}Xe(this._previewModelReference);const o=n.object;if(o){const r=this._preview.getModel()===o.textEditorModel?Qi.Smooth:Qi.Immediate,a=P.lift(e.range).collapseToStart();this._previewModelReference=n,this._preview.setModel(o.textEditorModel),this._preview.setSelection(a),this._preview.revealRangeInCenter(a,r)}else this._preview.setModel(this._previewNotAvailableMessage),n.dispose()}};CB=f([p(3,pt),p(4,Ci),p(5,Z),p(6,aae),p(7,ui),p(8,He)],CB);var $k;const jv=new O("referenceSearchVisible",!1,h(1136,"Whether reference peek is visible, like 'Peek References' or 'Peek Definition'"));let av=class{static{$k=this}static{this.ID="editor.contrib.referencesController"}static get(e){return e.getContribution($k.ID)}constructor(e,t,i,n,o,r,a,c){this._defaultTreeKeyboardSupport=e,this._editor=t,this._editorService=n,this._notificationService=o,this._instantiationService=r,this._storageService=a,this._configurationService=c,this._disposables=new U,this._requestIdPool=0,this._ignoreModelChangeEvent=!1,this._referenceSearchVisible=jv.bindTo(i)}dispose(){this._referenceSearchVisible.reset(),this._disposables.dispose(),this._widget?.dispose(),this._model?.dispose(),this._widget=void 0,this._model=void 0}toggleWidget(e,t,i){let n;if(this._widget&&(n=this._widget.position),this.closeWidget(),n&&e.containsPosition(n))return;this._peekMode=i,this._referenceSearchVisible.set(!0),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>{this.closeWidget()})),this._disposables.add(this._editor.onDidChangeModel(()=>{this._ignoreModelChangeEvent||this.closeWidget()}));const o="peekViewLayout",r=CDe.fromJSON(this._storageService.get(o,he.PROFILE,"{}"));this._widget=this._instantiationService.createInstance(CB,this._editor,this._defaultTreeKeyboardSupport,r),this._widget.setTitle(h(1137,"Loading...")),this._widget.show(e),this._disposables.add(this._widget.onDidClose(()=>{t.cancel(),this._widget?(this._storageService.store(o,JSON.stringify(this._widget.layoutData),he.PROFILE,gt.MACHINE),this._widget.isClosing||this.closeWidget(),this._widget=void 0):this.closeWidget()})),this._disposables.add(this._widget.onDidSelectReference(c=>{const{element:d,kind:l}=c;if(d)switch(l){case"open":(c.source!=="editor"||!this._configurationService.getValue("editor.stablePeek"))&&this.openReference(d,!1,!1);break;case"side":this.openReference(d,!0,!1);break;case"goto":i?this._gotoReference(d,!0):this.openReference(d,!1,!0);break}}));const a=++this._requestIdPool;t.then(c=>{if(a!==this._requestIdPool||!this._widget){c.dispose();return}return this._model?.dispose(),this._model=c,this._widget.setModel(this._model).then(()=>{if(this._widget&&this._model&&this._editor.hasModel()){this._model.isEmpty?this._widget.setMetaTitle(""):this._widget.setMetaTitle(h(1138,"{0} ({1})",this._model.title,this._model.references.length));const d=this._editor.getModel().uri,l=new we(e.startLineNumber,e.startColumn),u=this._model.nearestReference(d,l);if(u)return this._widget.setSelection(u).then(()=>{this._widget&&this._editor.getOption(L.peekWidgetDefaultFocus)==="editor"&&this._widget.focusOnPreviewEditor()})}})},c=>{this._notificationService.error(c)})}changeFocusBetweenPreviewAndReferences(){this._widget&&(this._widget.isPreviewEditorFocused()?this._widget.focusOnReferenceTree():this._widget.focusOnPreviewEditor())}async goToNextOrPreviousReference(e){if(!this._editor.hasModel()||!this._model||!this._widget)return;const t=this._widget.position;if(!t)return;const i=this._model.nearestReference(this._editor.getModel().uri,t);if(!i)return;const n=this._model.nextOrPreviousReference(i,e),o=this._editor.hasTextFocus(),r=this._widget.isPreviewEditorFocused();await this._widget.setSelection(n),await this._gotoReference(n,!1),o?this._editor.focus():this._widget&&r&&this._widget.focusOnPreviewEditor()}async revealReference(e){!this._editor.hasModel()||!this._model||!this._widget||await this._widget.revealReference(e)}closeWidget(e=!0){this._widget?.dispose(),this._model?.dispose(),this._referenceSearchVisible.reset(),this._disposables.clear(),this._widget=void 0,this._model=void 0,e&&this._editor.focus(),this._requestIdPool+=1}_gotoReference(e,t){this._widget?.hide(),this._ignoreModelChangeEvent=!0;const i=P.lift(e.range).collapseToStart();return this._editorService.openCodeEditor({resource:e.uri,options:{selection:i,selectionSource:td.JUMP,pinned:t}},this._editor).then(n=>{if(this._ignoreModelChangeEvent=!1,!n||!this._widget){this.closeWidget();return}if(this._editor===n)this._widget.show(i),this._widget.focusOnReferenceTree();else{const o=$k.get(n),r=this._model.clone();this.closeWidget(),n.focus(),o?.toggleWidget(i,Tn(a=>Promise.resolve(r)),this._peekMode??!1)}},n=>{this._ignoreModelChangeEvent=!1,mt(n)})}openReference(e,t,i){t||this.closeWidget();const{uri:n,range:o}=e;this._editorService.openCodeEditor({resource:n,options:{selection:o,selectionSource:td.JUMP,pinned:i}},this._editor,t)}};av=$k=f([p(2,fe),p(3,Bt),p(4,Dt),p(5,Z),p(6,it),p(7,ne)],av);function Yv(s,e){const t=lae(s);if(!t)return;const i=av.get(t);i&&e(i)}Me.registerCommandAndKeybindingRule({id:"togglePeekWidgetFocus",weight:W.EditorContrib,primary:lt(E.CtrlCmd|S.KeyK,S.F2),when:x.or(jv,Pr.inPeekEditor),handler(s){Yv(s,e=>{e.changeFocusBetweenPreviewAndReferences()})}});Me.registerCommandAndKeybindingRule({id:"goToNextReference",weight:W.EditorContrib-10,primary:S.F4,secondary:[S.F12],when:x.or(jv,Pr.inPeekEditor),handler(s){Yv(s,e=>{e.goToNextOrPreviousReference(!0)})}});Me.registerCommandAndKeybindingRule({id:"goToPreviousReference",weight:W.EditorContrib-10,primary:E.Shift|S.F4,secondary:[E.Shift|S.F12],when:x.or(jv,Pr.inPeekEditor),handler(s){Yv(s,e=>{e.goToNextOrPreviousReference(!1)})}});Ee.registerCommandAlias("goToNextReferenceFromEmbeddedEditor","goToNextReference");Ee.registerCommandAlias("goToPreviousReferenceFromEmbeddedEditor","goToPreviousReference");Ee.registerCommandAlias("closeReferenceSearchEditor","closeReferenceSearch");Ee.registerCommand("closeReferenceSearch",s=>Yv(s,e=>e.closeWidget()));Me.registerKeybindingRule({id:"closeReferenceSearch",weight:W.EditorContrib-101,primary:S.Escape,secondary:[E.Shift|S.Escape],when:x.and(Pr.inPeekEditor,x.not("config.editor.stablePeek"))});Me.registerKeybindingRule({id:"closeReferenceSearch",weight:W.WorkbenchContrib+50,primary:S.Escape,secondary:[E.Shift|S.Escape],when:x.and(jv,x.not("config.editor.stablePeek"),x.or(V.editorTextFocus,rme.negate()))});Me.registerCommandAndKeybindingRule({id:"revealReference",weight:W.WorkbenchContrib,primary:S.Enter,mac:{primary:S.Enter,secondary:[E.CtrlCmd|S.DownArrow]},when:x.and(jv,of,zie.negate(),qie.negate()),handler(s){const t=s.get(Ei).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof eg&&Yv(s,i=>i.revealReference(t[0]))}});Me.registerCommandAndKeybindingRule({id:"openReferenceToSide",weight:W.EditorContrib,primary:E.CtrlCmd|S.Enter,mac:{primary:E.WinCtrl|S.Enter},when:x.and(jv,of,zie.negate(),qie.negate()),handler(s){const t=s.get(Ei).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof eg&&Yv(s,i=>i.openReference(t[0],!0,!0))}});Ee.registerCommand("openReference",s=>{const t=s.get(Ei).lastFocusedList?.getFocus();Array.isArray(t)&&t[0]instanceof eg&&Yv(s,i=>i.openReference(t[0],!1,!0))});const xDe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Gk;Ve(xDe);let Dr=class{static{Gk=this}static{this.ID="editor.contrib.messageController"}static{this.MESSAGE_VISIBLE=new O("messageVisible",!1,h(1342,"Whether the editor is currently showing an inline message"))}static get(e){return e.getContribution(Gk.ID)}constructor(e,t,i){this._openerService=i,this._messageWidget=new Pt,this._messageListeners=new U,this._mouseOverMessage=!1,this._editor=e,this._visible=Gk.MESSAGE_VISIBLE.bindTo(t)}dispose(){this._message?.dispose(),this._messageListeners.dispose(),this._messageWidget.dispose(),this._visible.reset()}isVisible(){return this._visible.get()}showMessage(e,t){na(tc(e)?e.value:e),this._visible.set(!0),this._messageWidget.clear(),this._messageListeners.clear(),this._message=tc(e)?Ez(e,{actionHandler:{callback:n=>{this.closeMessage(),Kie(this._openerService,n,tc(e)?e.isTrusted:void 0)},disposables:this._messageListeners}}):void 0,this._messageWidget.value=new Vj(this._editor,t,typeof e=="string"?e:this._message.element),this._messageListeners.add(T.debounce(this._editor.onDidBlurEditorText,(n,o)=>o,0)(()=>{this._mouseOverMessage||this._messageWidget.value&&Hu(wh(),this._messageWidget.value.getDomNode())||this.closeMessage()})),this._messageListeners.add(this._editor.onDidChangeCursorPosition(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidDispose(()=>this.closeMessage())),this._messageListeners.add(this._editor.onDidChangeModel(()=>this.closeMessage())),this._messageListeners.add(re(this._messageWidget.value.getDomNode(),pe.MOUSE_ENTER,()=>this._mouseOverMessage=!0,!0)),this._messageListeners.add(re(this._messageWidget.value.getDomNode(),pe.MOUSE_LEAVE,()=>this._mouseOverMessage=!1,!0));let i;this._messageListeners.add(this._editor.onMouseMove(n=>{n.target.position&&(i?i.containsPosition(n.target.position)||this.closeMessage():i=new P(t.lineNumber-3,1,n.target.position.lineNumber+3,1))}))}closeMessage(){this._visible.reset(),this._messageListeners.clear(),this._messageWidget.value&&this._messageListeners.add(Vj.fadeOut(this._messageWidget.value))}};Dr=Gk=f([p(1,fe),p(2,mi)],Dr);const IDe=Vo.bindToContribution(Dr.get);ze(new IDe({id:"leaveEditorMessage",precondition:Dr.MESSAGE_VISIBLE,handler:s=>s.closeMessage(),kbOpts:{weight:W.EditorContrib+30,primary:S.Escape}}));let Vj=class{static fadeOut(e){const t=()=>{e.dispose(),clearTimeout(i),e.getDomNode().removeEventListener("animationend",t)},i=setTimeout(t,110);return e.getDomNode().addEventListener("animationend",t),e.getDomNode().classList.add("fadeOut"),{dispose:t}}constructor(e,{lineNumber:t,column:i},n){this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._editor=e,this._editor.revealLinesInCenterIfOutsideViewport(t,t,Qi.Smooth),this._position={lineNumber:t,column:i},this._domNode=document.createElement("div"),this._domNode.classList.add("monaco-editor-overlaymessage"),this._domNode.style.marginLeft="-6px";const o=document.createElement("div");o.classList.add("anchor","top"),this._domNode.appendChild(o);const r=document.createElement("div");typeof n=="string"?(r.classList.add("message"),r.textContent=n):(n.classList.add("message"),r.appendChild(n)),this._domNode.appendChild(r);const a=document.createElement("div");a.classList.add("anchor","below"),this._domNode.appendChild(a),this._editor.addContentWidget(this),this._domNode.classList.add("fadeIn")}dispose(){this._editor.removeContentWidget(this)}getId(){return"messageoverlay"}getDomNode(){return this._domNode}getPosition(){return{position:this._position,preference:[Fi.ABOVE,Fi.BELOW],positionAffinity:eI.Right}}afterRender(e){this._domNode.classList.toggle("below",e===Fi.BELOW)}};Lt(Dr.ID,Dr,_t.Lazy);function EB(s,e){return e.uri.scheme===s.uri.scheme?!0:!xz(e.uri,ae.walkThroughSnippet,ae.vscodeChatCodeBlock,ae.vscodeChatCodeCompareBlock)}async function AI(s,e,t,i,n){const r=t.ordered(s,i).map(c=>Promise.resolve(n(c,s,e)).then(void 0,d=>{Ln(d)})),a=await Promise.all(r);return $t(a.flat()).filter(c=>EB(s,c))}function RI(s,e,t,i,n){return AI(e,t,s,i,(o,r,a)=>o.provideDefinition(r,a,n))}function Qq(s,e,t,i,n){return AI(e,t,s,i,(o,r,a)=>o.provideDeclaration(r,a,n))}function Xq(s,e,t,i,n){return AI(e,t,s,i,(o,r,a)=>o.provideImplementation(r,a,n))}function Zq(s,e,t,i,n){return AI(e,t,s,i,(o,r,a)=>o.provideTypeDefinition(r,a,n))}function PI(s,e,t,i,n,o){return AI(e,t,s,n,async(r,a,c)=>{const d=(await r.provideReferences(a,c,{includeDeclaration:!0},o))?.filter(u=>EB(a,u));if(!i||!d||d.length!==2)return d;const l=(await r.provideReferences(a,c,{includeDeclaration:!1},o))?.filter(u=>EB(a,u));return l&&l.length===1?l:d})}async function Vh(s){const e=await s(),t=new sa(e,""),i=t.references.map(n=>n.link);return t.dispose(),i}Or("_executeDefinitionProvider",(s,e,t)=>{const i=s.get(Ne),n=RI(i.definitionProvider,e,t,!1,Ce.None);return Vh(()=>n)});Or("_executeDefinitionProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=RI(i.definitionProvider,e,t,!0,Ce.None);return Vh(()=>n)});Or("_executeTypeDefinitionProvider",(s,e,t)=>{const i=s.get(Ne),n=Zq(i.typeDefinitionProvider,e,t,!1,Ce.None);return Vh(()=>n)});Or("_executeTypeDefinitionProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=Zq(i.typeDefinitionProvider,e,t,!0,Ce.None);return Vh(()=>n)});Or("_executeDeclarationProvider",(s,e,t)=>{const i=s.get(Ne),n=Qq(i.declarationProvider,e,t,!1,Ce.None);return Vh(()=>n)});Or("_executeDeclarationProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=Qq(i.declarationProvider,e,t,!0,Ce.None);return Vh(()=>n)});Or("_executeReferenceProvider",(s,e,t)=>{const i=s.get(Ne),n=PI(i.referenceProvider,e,t,!1,!1,Ce.None);return Vh(()=>n)});Or("_executeReferenceProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=PI(i.referenceProvider,e,t,!1,!0,Ce.None);return Vh(()=>n)});Or("_executeImplementationProvider",(s,e,t)=>{const i=s.get(Ne),n=Xq(i.implementationProvider,e,t,!1,Ce.None);return Vh(()=>n)});Or("_executeImplementationProvider_recursive",(s,e,t)=>{const i=s.get(Ne),n=Xq(i.implementationProvider,e,t,!0,Ce.None);return Vh(()=>n)});ge.appendMenuItem(N.EditorContext,{submenu:N.EditorContextPeek,title:h(1100,"Peek"),group:"navigation",order:100});class xy{static is(e){return!e||typeof e!="object"?!1:!!(e instanceof xy||we.isIPosition(e.position)&&e.model)}constructor(e,t){this.model=e,this.position=t}}class hr extends Fr{static{this._allSymbolNavigationCommands=new Map}static{this._activeAlternativeCommands=new Set}static all(){return hr._allSymbolNavigationCommands.values()}static _patchConfig(e){const t={...e,f1:!0};if(t.menu)for(const i of As.wrap(t.menu))(i.id===N.EditorContext||i.id===N.EditorContextPeek)&&(i.when=x.and(e.precondition,i.when));return t}constructor(e,t){super(hr._patchConfig(t)),this.configuration=e,hr._allSymbolNavigationCommands.set(t.id,this)}runEditorCommand(e,t,i,n){if(!t.hasModel())return Promise.resolve(void 0);const o=e.get(Dt),r=e.get(Bt),a=e.get(Uu),c=e.get(GN),d=e.get(Ne),l=e.get(Z),u=t.getModel(),g=t.getPosition(),m=xy.is(i)?i:new xy(u,g),v=new tv(t,fs.Value|fs.Position),_=Sh(this._getLocationModel(d,m.model,m.position,v.token),v.token).then(async w=>{if(!w||v.token.isCancellationRequested)return;na(w.ariaMessage);let C;if(w.referenceAt(u.uri,g)){const D=this._getAlternativeCommand(t);D!==void 0&&!hr._activeAlternativeCommands.has(D)&&hr._allSymbolNavigationCommands.has(D)&&(C=hr._allSymbolNavigationCommands.get(D))}const k=w.references.length;if(k===0){if(!this.configuration.muteMessage){const D=u.getWordAtPosition(g);Dr.get(t)?.showMessage(this._getNoResultFoundMessage(D),g)}}else if(k===1&&C)hr._activeAlternativeCommands.add(this.desc.id),l.invokeFunction(D=>C.runEditorCommand(D,t,i,n).finally(()=>{hr._activeAlternativeCommands.delete(this.desc.id)}));else return this._onResult(r,c,t,w,n)},w=>{o.error(w)}).finally(()=>{v.dispose()});return a.showWhile(_,250),_}async _onResult(e,t,i,n,o){const r=this._getGoToPreference(i);if(!(i instanceof pd)&&(this.configuration.openInPeek||r==="peek"&&n.references.length>1))this._openInPeek(i,n,o);else{const a=n.firstReference(),c=n.references.length>1&&r==="gotoAndPeek",d=await this._openReference(i,e,a,this.configuration.openToSide,!c);c&&d?this._openInPeek(d,n,o):n.dispose(),r==="goto"&&t.put(a)}}async _openReference(e,t,i,n,o){let r;if(ame(i)&&(r=i.targetSelectionRange),r||(r=i.range),!r)return;const a=await t.openCodeEditor({resource:i.uri,options:{selection:P.collapseToStart(r),selectionRevealType:Dm.NearTopIfOutsideViewport,selectionSource:td.JUMP}},e,n);if(a){if(o){const c=a.getModel(),d=a.createDecorationsCollection([{range:r,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout(()=>{a.getModel()===c&&d.clear()},350)}return a}}_openInPeek(e,t,i){const n=av.get(e);n&&e.hasModel()?n.toggleWidget(i??e.getSelection(),Tn(o=>Promise.resolve(t)),this.configuration.openInPeek):t.dispose()}}class LI extends hr{async _getLocationModel(e,t,i,n){return new sa(await RI(e.definitionProvider,t,i,!1,n),h(1101,"Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?h(1102,"No definition found for '{0}'",e.word):h(1103,"No definition found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeDefinitionCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleDefinitions}}Y(class xB extends LI{static{this.id="editor.action.revealDefinition"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:xB.id,title:{...I(1104,"Go to Definition"),mnemonicTitle:h(1105,"Go to &&Definition")},precondition:V.hasDefinitionProvider,keybinding:[{when:V.editorTextFocus,primary:S.F12,weight:W.EditorContrib},{when:x.and(V.editorTextFocus,Eu),primary:E.CtrlCmd|S.F12,weight:W.EditorContrib}],menu:[{id:N.EditorContext,group:"navigation",order:1.1},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:2}]}),Ee.registerCommandAlias("editor.action.goToDeclaration",xB.id)}});Y(class IB extends LI{static{this.id="editor.action.revealDefinitionAside"}constructor(){super({openToSide:!0,openInPeek:!1,muteMessage:!1},{id:IB.id,title:I(1106,"Open Definition to the Side"),precondition:x.and(V.hasDefinitionProvider,V.isInEmbeddedEditor.toNegated()),keybinding:[{when:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,S.F12),weight:W.EditorContrib},{when:x.and(V.editorTextFocus,Eu),primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.F12),weight:W.EditorContrib}]}),Ee.registerCommandAlias("editor.action.openDeclarationToTheSide",IB.id)}});Y(class DB extends LI{static{this.id="editor.action.peekDefinition"}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:DB.id,title:I(1107,"Peek Definition"),precondition:x.and(V.hasDefinitionProvider,Pr.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),keybinding:{when:V.editorTextFocus,primary:E.Alt|S.F12,linux:{primary:E.CtrlCmd|E.Shift|S.F10},weight:W.EditorContrib},menu:{id:N.EditorContextPeek,group:"peek",order:2}}),Ee.registerCommandAlias("editor.action.previewDeclaration",DB.id)}});class bae extends hr{async _getLocationModel(e,t,i,n){return new sa(await Qq(e.declarationProvider,t,i,!1,n),h(1108,"Declarations"))}_getNoResultFoundMessage(e){return e&&e.word?h(1109,"No declaration found for '{0}'",e.word):h(1110,"No declaration found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeDeclarationCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleDeclarations}}Y(class yae extends bae{static{this.id="editor.action.revealDeclaration"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:yae.id,title:{...I(1111,"Go to Declaration"),mnemonicTitle:h(1112,"Go to &&Declaration")},precondition:x.and(V.hasDeclarationProvider,V.isInEmbeddedEditor.toNegated()),menu:[{id:N.EditorContext,group:"navigation",order:1.3},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}_getNoResultFoundMessage(e){return e&&e.word?h(1109,"No declaration found for '{0}'",e.word):h(1110,"No declaration found")}});Y(class extends bae{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.peekDeclaration",title:I(1113,"Peek Declaration"),precondition:x.and(V.hasDeclarationProvider,Pr.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),menu:{id:N.EditorContextPeek,group:"peek",order:3}})}});class wae extends hr{async _getLocationModel(e,t,i,n){return new sa(await Zq(e.typeDefinitionProvider,t,i,!1,n),h(1114,"Type Definitions"))}_getNoResultFoundMessage(e){return e&&e.word?h(1115,"No type definition found for '{0}'",e.word):h(1116,"No type definition found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeTypeDefinitionCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleTypeDefinitions}}Y(class Sae extends wae{static{this.ID="editor.action.goToTypeDefinition"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:Sae.ID,title:{...I(1117,"Go to Type Definition"),mnemonicTitle:h(1118,"Go to &&Type Definition")},precondition:V.hasTypeDefinitionProvider,keybinding:{when:V.editorTextFocus,primary:0,weight:W.EditorContrib},menu:[{id:N.EditorContext,group:"navigation",order:1.4},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:3}]})}});Y(class Cae extends wae{static{this.ID="editor.action.peekTypeDefinition"}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:Cae.ID,title:I(1119,"Peek Type Definition"),precondition:x.and(V.hasTypeDefinitionProvider,Pr.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),menu:{id:N.EditorContextPeek,group:"peek",order:4}})}});class Eae extends hr{async _getLocationModel(e,t,i,n){return new sa(await Xq(e.implementationProvider,t,i,!1,n),h(1120,"Implementations"))}_getNoResultFoundMessage(e){return e&&e.word?h(1121,"No implementation found for '{0}'",e.word):h(1122,"No implementation found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeImplementationCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleImplementations}}Y(class xae extends Eae{static{this.ID="editor.action.goToImplementation"}constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:xae.ID,title:{...I(1123,"Go to Implementations"),mnemonicTitle:h(1124,"Go to &&Implementations")},precondition:V.hasImplementationProvider,keybinding:{when:V.editorTextFocus,primary:E.CtrlCmd|S.F12,weight:W.EditorContrib},menu:[{id:N.EditorContext,group:"navigation",order:1.45},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:4}]})}});Y(class Iae extends Eae{static{this.ID="editor.action.peekImplementation"}constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:Iae.ID,title:I(1125,"Peek Implementations"),precondition:x.and(V.hasImplementationProvider,Pr.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),keybinding:{when:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.F12,weight:W.EditorContrib},menu:{id:N.EditorContextPeek,group:"peek",order:5}})}});class Dae extends hr{_getNoResultFoundMessage(e){return e?h(1126,"No references found for '{0}'",e.word):h(1127,"No references found")}_getAlternativeCommand(e){return e.getOption(L.gotoLocation).alternativeReferenceCommand}_getGoToPreference(e){return e.getOption(L.gotoLocation).multipleReferences}}Y(class extends Dae{constructor(){super({openToSide:!1,openInPeek:!1,muteMessage:!1},{id:"editor.action.goToReferences",title:{...I(1128,"Go to References"),mnemonicTitle:h(1129,"Go to &&References")},precondition:x.and(V.hasReferenceProvider,Pr.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),keybinding:{when:V.editorTextFocus,primary:E.Shift|S.F12,weight:W.EditorContrib},menu:[{id:N.EditorContext,group:"navigation",order:1.45},{id:N.MenubarGoMenu,precondition:null,group:"4_symbol_nav",order:5}]})}async _getLocationModel(e,t,i,n){return new sa(await PI(e.referenceProvider,t,i,!0,!1,n),h(1130,"References"))}});Y(class extends Dae{constructor(){super({openToSide:!1,openInPeek:!0,muteMessage:!1},{id:"editor.action.referenceSearch.trigger",title:I(1131,"Peek References"),precondition:x.and(V.hasReferenceProvider,Pr.notInPeekEditor,V.isInEmbeddedEditor.toNegated()),menu:{id:N.EditorContextPeek,group:"peek",order:6}})}async _getLocationModel(e,t,i,n){return new sa(await PI(e.referenceProvider,t,i,!1,!1,n),h(1130,"References"))}});class DDe extends hr{constructor(e,t,i){super(e,{id:"editor.action.goToLocation",title:I(1132,"Go to Any Symbol"),precondition:x.and(Pr.notInPeekEditor,V.isInEmbeddedEditor.toNegated())}),this._references=t,this._gotoMultipleBehaviour=i}async _getLocationModel(e,t,i,n){return new sa(this._references,h(1133,"Locations"))}_getNoResultFoundMessage(e){return e&&h(1134,"No results for '{0}'",e.word)||""}_getGoToPreference(e){return this._gotoMultipleBehaviour??e.getOption(L.gotoLocation).multipleReferences}_getAlternativeCommand(){}}Ee.registerCommand({id:"editor.action.goToLocations",metadata:{description:"Go to locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:R},{name:"position",description:"The position at which to start",constraint:we.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"},{name:"noResultsMessage",description:"Human readable message that shows when locations is empty."}]},handler:async(s,e,t,i,n,o,r)=>{yt(R.isUri(e)),yt(we.isIPosition(t)),yt(Array.isArray(i)),yt(typeof n>"u"||typeof n=="string"),yt(typeof r>"u"||typeof r=="boolean");const a=s.get(Bt),c=await a.openCodeEditor({resource:e},a.getFocusedCodeEditor());if(mo(c))return c.setPosition(t),c.revealPositionInCenterIfOutsideViewport(t,Qi.Smooth),c.invokeWithinContext(d=>{const l=new class extends DDe{_getNoResultFoundMessage(u){return o||super._getNoResultFoundMessage(u)}}({muteMessage:!o,openInPeek:!!r,openToSide:!1},i,n);d.get(Z).invokeFunction(l.run.bind(l),c)})}});Ee.registerCommand({id:"editor.action.peekLocations",metadata:{description:"Peek locations from a position in a file",args:[{name:"uri",description:"The text document in which to start",constraint:R},{name:"position",description:"The position at which to start",constraint:we.isIPosition},{name:"locations",description:"An array of locations.",constraint:Array},{name:"multiple",description:"Define what to do when having multiple results, either `peek`, `gotoAndPeek`, or `goto`"}]},handler:async(s,e,t,i,n)=>{s.get(Ge).executeCommand("editor.action.goToLocations",e,t,i,n,void 0,!0)}});Ee.registerCommand({id:"editor.action.findReferences",handler:(s,e,t)=>{yt(R.isUri(e)),yt(we.isIPosition(t));const i=s.get(Ne),n=s.get(Bt);return n.openCodeEditor({resource:e},n.getFocusedCodeEditor()).then(o=>{if(!mo(o)||!o.hasModel())return;const r=av.get(o);if(!r)return;const a=Tn(d=>PI(i.referenceProvider,o.getModel(),we.lift(t),!1,!1,d).then(l=>new sa(l,h(1130,"References")))),c=new P(t.lineNumber,t.column,t.lineNumber,t.column);return Promise.resolve(r.toggleWidget(c,a,!1))})}});Ee.registerCommandAlias("editor.action.showReferences","editor.action.peekLocations");async function kDe(s,e,t,i){const n=s.get(Ci),o=s.get(bi),r=s.get(Ge),a=s.get(Z),c=s.get(Dt);if(await i.item.resolve(Ce.None),!i.part.location)return;const d=i.part.location,l=[],u=new Set(ge.getMenuItems(N.EditorContext).map(m=>jie(m)?m.command.id:Pn()));for(const m of hr.all())u.has(m.desc.id)&&l.push(new Xt(m.desc.id,wr.label(m.desc,{renderShortTitle:!0}),void 0,!0,async()=>{const v=await n.createModelReference(d.uri);try{const _=new xy(v.object.textEditorModel,P.getStartPosition(d.range)),w=i.item.anchor.range;await a.invokeFunction(m.runEditorCommand.bind(m),e,_,w)}finally{v.dispose()}}));if(i.part.command){const{command:m}=i.part;l.push(new os),l.push(new Xt(m.id,m.title,void 0,!0,async()=>{try{await r.executeCommand(m.id,...m.arguments??[])}catch(v){c.notify({severity:Fe.Error,source:i.item.provider.displayName,message:v})}}))}const g=e.getOption(L.useShadowDOM);o.showContextMenu({domForShadowRoot:g?e.getDomNode()??void 0:void 0,getAnchor:()=>{const m=Bs(t);return{x:m.left,y:m.top+m.height+8}},getActions:()=>l,onHide:()=>{e.focus()},autoSelectFirstItem:!0})}async function kae(s,e,t,i){const o=await s.get(Ci).createModelReference(i.uri);await t.invokeWithinContext(async r=>{const a=e.hasSideBySideModifier,c=r.get(fe),d=Pr.inPeekEditor.getValue(c),l=!a&&t.getOption(L.definitionLinkOpensInPeek)&&!d;return new LI({openToSide:a,openInPeek:l,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(r,new xy(o.object.textEditorModel,P.getStartPosition(i.range)),P.lift(i.range))}),o.dispose()}var T_;class UA{constructor(){this._entries=new zm(50)}get(e){const t=UA._key(e);return this._entries.get(t)}set(e,t){const i=UA._key(e);this._entries.set(i,t)}static _key(e){return`${e.uri.toString()}/${e.getVersionId()}`}}class kB{constructor(e,t){this.item=e,this.index=t}get part(){const e=this.item.hint.label;return typeof e=="string"?{label:e}:e[this.index]}}class TDe{constructor(e,t){this.part=e,this.hasTriggerModifier=t}}var su;(function(s){s[s.Normal=0]="Normal",s[s.Invisible=1]="Invisible"})(su||(su={}));let Iy=class{static{T_=this}static{this.ID="editor.contrib.InlayHints"}static{this._MAX_DECORATORS=1500}static{this._whitespaceData={}}static get(e){return e.getContribution(T_.ID)??void 0}constructor(e,t,i,n,o,r,a){this._editor=e,this._languageFeaturesService=t,this._inlayHintsCache=n,this._commandService=o,this._notificationService=r,this._instaService=a,this._disposables=new U,this._sessionDisposables=new U,this._decorationsMetadata=new Map,this._ruleFactory=new Fse(this._editor),this._activeRenderMode=su.Normal,this._debounceInfo=i.for(t.inlayHintsProvider,"InlayHint",{min:25}),this._disposables.add(t.inlayHintsProvider.onDidChange(()=>this._update())),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(c=>{c.hasChanged(L.inlayHints)&&this._update()})),this._update()}dispose(){this._sessionDisposables.dispose(),this._removeAllDecorations(),this._disposables.dispose()}_update(){this._sessionDisposables.clear(),this._removeAllDecorations();const e=this._editor.getOption(L.inlayHints);if(e.enabled==="off")return;const t=this._editor.getModel();if(!t||!this._languageFeaturesService.inlayHintsProvider.has(t))return;if(e.enabled==="on")this._activeRenderMode=su.Normal;else{let c,d;e.enabled==="onUnlessPressed"?(c=su.Normal,d=su.Invisible):(c=su.Invisible,d=su.Normal),this._activeRenderMode=c,this._sessionDisposables.add(FT.getInstance().event(l=>{if(!this._editor.hasModel())return;const u=l.altKey&&l.ctrlKey&&!(l.shiftKey||l.metaKey)?d:c;if(u!==this._activeRenderMode){this._activeRenderMode=u;const g=this._editor.getModel(),m=this._copyInlayHintsWithCurrentAnchor(g);this._updateHintsDecorators([g.getFullModelRange()],m),r.schedule(0)}}))}const i=this._inlayHintsCache.get(t);i&&this._updateHintsDecorators([t.getFullModelRange()],i),this._sessionDisposables.add(Ie(()=>{t.isDisposed()||this._cacheHintsForFastRestore(t)}));let n;const o=new Set,r=new yn(async()=>{const c=Date.now();n?.dispose(!0),n=new li;const d=t.onWillDispose(()=>n?.cancel());try{const l=n.token,u=await Bb.create(this._languageFeaturesService.inlayHintsProvider,t,this._getHintsRanges(),l);if(r.delay=this._debounceInfo.update(t,Date.now()-c),l.isCancellationRequested){u.dispose();return}for(const g of u.provider)typeof g.onDidChangeInlayHints=="function"&&!o.has(g)&&(o.add(g),this._sessionDisposables.add(g.onDidChangeInlayHints(()=>{r.isScheduled()||r.schedule()})));this._sessionDisposables.add(u),this._updateHintsDecorators(u.ranges,u.items),this._cacheHintsForFastRestore(t)}catch(l){mt(l)}finally{n.dispose(),d.dispose()}},this._debounceInfo.get(t));this._sessionDisposables.add(r),this._sessionDisposables.add(Ie(()=>n?.dispose(!0))),r.schedule(0),this._sessionDisposables.add(this._editor.onDidScrollChange(c=>{(c.scrollTopChanged||!r.isScheduled())&&r.schedule()}));const a=this._sessionDisposables.add(new Pt);this._sessionDisposables.add(this._editor.onDidChangeModelContent(c=>{n?.cancel();const d=Math.max(r.delay,800);this._cursorInfo={position:this._editor.getPosition(),notEarlierThan:Date.now()+d},a.value=Lp(()=>r.schedule(0),d),r.schedule()})),this._sessionDisposables.add(this._editor.onDidChangeConfiguration(c=>{c.hasChanged(L.inlayHints)&&r.schedule()})),this._sessionDisposables.add(this._installDblClickGesture(()=>r.schedule(0))),this._sessionDisposables.add(this._installLinkGesture()),this._sessionDisposables.add(this._installContextMenu())}_installLinkGesture(){const e=new U,t=e.add(new qN(this._editor)),i=new U;return e.add(i),e.add(t.onMouseMoveOrRelevantKeyDown(n=>{const[o]=n,r=this._getInlayHintLabelPart(o),a=this._editor.getModel();if(!r||!a){i.clear();return}const c=new li;i.add(Ie(()=>c.dispose(!0))),r.item.resolve(c.token),this._activeInlayHintPart=r.part.command||r.part.location?new TDe(r,o.hasTriggerModifier):void 0;const d=a.validatePosition(r.item.hint.position).lineNumber,l=new P(d,1,d,a.getLineMaxColumn(d)),u=this._getInlineHintsForRange(l);this._updateHintsDecorators([l],u),i.add(Ie(()=>{this._activeInlayHintPart=void 0,this._updateHintsDecorators([l],u)}))})),e.add(t.onCancel(()=>i.clear())),e.add(t.onExecute(async n=>{const o=this._getInlayHintLabelPart(n);if(o){const r=o.part;r.location?this._instaService.invokeFunction(kae,n,this._editor,r.location):Yie.is(r.command)&&await this._invokeCommand(r.command,o.item)}})),e}_getInlineHintsForRange(e){const t=new Set;for(const i of this._decorationsMetadata.values())e.containsRange(i.item.anchor.range)&&t.add(i.item);return Array.from(t)}_installDblClickGesture(e){return this._editor.onMouseUp(async t=>{if(t.event.detail!==2)return;const i=this._getInlayHintLabelPart(t);if(i&&(t.event.preventDefault(),await i.item.resolve(Ce.None),An(i.item.hint.textEdits))){const n=i.item.hint.textEdits.map(o=>qi.replace(P.lift(o.range),o.text));this._editor.executeEdits("inlayHint.default",n),e()}})}_installContextMenu(){return this._editor.onContextMenu(async e=>{if(!Ph(e.event.target))return;const t=this._getInlayHintLabelPart(e);t&&await this._instaService.invokeFunction(kDe,this._editor,e.event.target,t)})}_getInlayHintLabelPart(e){if(e.target.type!==xi.CONTENT_TEXT)return;const t=e.target.detail.injectedText?.options;if(t instanceof Iz&&t?.attachedData instanceof kB)return t.attachedData}async _invokeCommand(e,t){try{await this._commandService.executeCommand(e.id,...e.arguments??[])}catch(i){this._notificationService.notify({severity:Fe.Error,source:t.provider.displayName,message:i})}}_cacheHintsForFastRestore(e){const t=this._copyInlayHintsWithCurrentAnchor(e);this._inlayHintsCache.set(e,t)}_copyInlayHintsWithCurrentAnchor(e){const t=new Map;for(const[i,n]of this._decorationsMetadata){if(t.has(n.item))continue;const o=e.getDecorationRange(i);if(o){const r=new vae(o,n.item.anchor.direction),a=n.item.with({anchor:r});t.set(n.item,a)}}return Array.from(t.values())}_getHintsRanges(){const t=this._editor.getModel(),i=this._editor.getVisibleRangesPlusViewportAboveBelow(),n=[];for(const o of i.sort(P.compareRangesUsingStarts)){const r=t.validateRange(new P(o.startLineNumber-30,o.startColumn,o.endLineNumber+30,o.endColumn));n.length===0||!P.areIntersectingOrTouching(n[n.length-1],r)?n.push(r):n[n.length-1]=P.plusRange(n[n.length-1],r)}return n}_updateHintsDecorators(e,t){const i=new Map;if(this._cursorInfo&&this._cursorInfo.notEarlierThan>Date.now()&&e.some(w=>w.containsPosition(this._cursorInfo.position))){const{position:w}=this._cursorInfo;this._cursorInfo=void 0;const C=new Map;for(const B of this._editor.getLineDecorations(w.lineNumber)??[]){const q=this._decorationsMetadata.get(B.id);if(B.range.startColumn>w.column)continue;const Q=q?.decoration.options[q.item.anchor.direction];if(Q&&Q.attachedData!==T_._whitespaceData){const ie=C.get(q.item)??0;C.set(q.item,ie+Q.content.length)}}const k=t.filter(B=>B.anchor.range.startLineNumber===w.lineNumber&&B.anchor.range.endColumn<=w.column),D=Array.from(C.values());let A;for(;;){const B=k.shift(),q=D.shift();if(!q&&!B)break;if(B)i.set(B,q??0),A=B;else if(A&&q){let Q=i.get(A);Q+=q,Q+=D.reduce((ie,oe)=>ie+oe,0),D.length=0;break}}}const n=[],o=(w,C,k,D,A)=>{const B={content:k,inlineClassNameAffectsLetterSpacing:!0,inlineClassName:C.className,cursorStops:D,attachedData:A};n.push({item:w,classNameRef:C,decoration:{range:w.anchor.range,options:{description:"InlayHint",showIfCollapsed:w.anchor.range.isEmpty(),collapseOnReplaceEdit:!w.anchor.range.isEmpty(),stickiness:ki.AlwaysGrowsWhenTypingAtEdges,[w.anchor.direction]:this._activeRenderMode===su.Normal?B:void 0}}})},r=(w,C)=>{const k=this._ruleFactory.createClassNameRef({width:`${a/3|0}px`,display:"inline-block"});o(w,k,"",C?Qf.Right:Qf.None,T_._whitespaceData)},{fontSize:a,fontFamily:c,padding:d,isUniform:l}=this._getLayoutInfo(),u=this._editor.getOption(L.inlayHints).maximumLength,g="--code-editorInlayHintsFontFamily";this._editor.getContainerDomNode().style.setProperty(g,c);let m={line:0,totalLen:0};for(let w=0;w<t.length;w++){const C=t[w];if(m.line!==C.anchor.range.startLineNumber&&(m={line:C.anchor.range.startLineNumber,totalLen:0}),u&&m.totalLen>u)continue;C.hint.paddingLeft&&r(C,!1);const k=typeof C.hint.label=="string"?[{label:C.hint.label}]:C.hint.label,D=i.get(C);let A=0;for(let B=0;B<k.length;B++){const q=k[B],Q=B===0,ie=B===k.length-1,oe={fontSize:`${a}px`,fontFamily:`var(${g}), ${BM.fontFamily}`,verticalAlign:l?"baseline":"middle",unicodeBidi:"isolate"};An(C.hint.textEdits)&&(oe.cursor="default"),this._fillInColors(oe,C.hint),(q.command||q.location)&&this._activeInlayHintPart?.part.item===C&&this._activeInlayHintPart.part.index===B&&(oe.textDecoration="underline",this._activeInlayHintPart.hasTriggerModifier&&(oe.color=ns(cme),oe.cursor="pointer"));let be=q.label;m.totalLen+=be.length;let me=!1;const zt=u!==0?m.totalLen-u:0;if(zt>0&&(be=be.slice(0,-zt)+"",me=!0),A+=be.length,D!==void 0){const ft=A-D;ft>=0&&(A-=ft,be=be.slice(0,-(1+ft))+"",me=!0)}if(d&&(Q&&(ie||me)?(oe.padding=`1px ${Math.max(1,a/4)|0}px`,oe.borderRadius=`${a/4|0}px`):Q?(oe.padding=`1px 0 1px ${Math.max(1,a/4)|0}px`,oe.borderRadius=`${a/4|0}px 0 0 ${a/4|0}px`):ie||me?(oe.padding=`1px ${Math.max(1,a/4)|0}px 1px 0`,oe.borderRadius=`0 ${a/4|0}px ${a/4|0}px 0`):oe.padding="1px 0 1px 0"),o(C,this._ruleFactory.createClassNameRef(oe),ADe(be),ie&&!C.hint.paddingRight?Qf.Right:Qf.None,new kB(C,B)),me)break}if(D!==void 0&&A<D){const B=D-A;o(C,this._ruleFactory.createClassNameRef({}),"".repeat(B),Qf.None)}if(C.hint.paddingRight&&r(C,!0),n.length>T_._MAX_DECORATORS)break}const v=[];for(const[w,C]of this._decorationsMetadata){const k=this._editor.getModel()?.getDecorationRange(w);k&&e.some(D=>D.containsRange(k))&&(v.push(w),C.classNameRef.dispose(),this._decorationsMetadata.delete(w))}const _=py.capture(this._editor);this._editor.changeDecorations(w=>{const C=w.deltaDecorations(v,n.map(k=>k.decoration));for(let k=0;k<C.length;k++){const D=n[k];this._decorationsMetadata.set(C[k],D)}}),_.restore(this._editor)}_fillInColors(e,t){t.kind===O6.Parameter?(e.backgroundColor=ns(dme),e.color=ns(lme)):t.kind===O6.Type?(e.backgroundColor=ns(hme),e.color=ns(ume)):(e.backgroundColor=ns(gme),e.color=ns(pme))}_getLayoutInfo(){const e=this._editor.getOption(L.inlayHints),t=e.padding,i=this._editor.getOption(L.fontSize),n=this._editor.getOption(L.fontFamily);let o=e.fontSize;(!o||o<5||o>i)&&(o=i);const r=e.fontFamily||n;return{fontSize:o,fontFamily:r,padding:t,isUniform:!t&&r===n&&o===i}}_removeAllDecorations(){this._editor.removeDecorations(Array.from(this._decorationsMetadata.keys()));for(const e of this._decorationsMetadata.values())e.classNameRef.dispose();this._decorationsMetadata.clear()}getInlayHintsForLine(e){if(!this._editor.hasModel())return[];const t=new Set,i=[];for(const n of this._editor.getLineDecorations(e)){const o=this._decorationsMetadata.get(n.id);o&&!t.has(o.item.hint)&&(t.add(o.item.hint),i.push(o.item))}return i}};Iy=T_=f([p(1,Ne),p(2,Sd),p(3,rae),p(4,Ge),p(5,Dt),p(6,Z)],Iy);function ADe(s){return s.replace(/[ \t]/g,"")}Ee.registerCommand("_executeInlayHintProvider",async(s,...e)=>{const[t,i]=e;yt(R.isUri(t)),yt(P.isIRange(i));const{inlayHintsProvider:n}=s.get(Ne),o=await s.get(Ci).createModelReference(t);try{const r=await Bb.create(n,o.object.textEditorModel,[P.lift(i)],Ce.None),a=r.items.map(c=>c.hint);return setTimeout(()=>r.dispose(),0),a}finally{o.dispose()}});const Tae=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(Tae);const Aae="acceptSelectedCodeAction",Rae="previewSelectedCodeAction";var Jr;(function(s){s.Action="action",s.Header="header"})(Jr||(Jr={}));class RDe{get templateId(){return Jr.Header}renderTemplate(e){e.classList.add("group-header");const t=document.createElement("span");return e.append(t),{container:e,text:t}}renderElement(e,t,i){i.text.textContent=e.group?.title??e.label??""}disposeTemplate(e){}}let TB=class{get templateId(){return Jr.Action}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);const t=document.createElement("div");t.className="icon",e.append(t);const i=document.createElement("span");i.className="title",e.append(i);const n=document.createElement("span");n.className="description",e.append(n);const o=new VM(e,$u);return{container:e,icon:t,text:i,description:n,keybinding:o}}renderElement(e,t,i){if(e.group?.icon?(i.icon.className=ke.asClassName(e.group.icon),e.group.icon.color&&(i.icon.style.color=vt(e.group.icon.color.id))):(i.icon.className=ke.asClassName(K.lightBulb),i.icon.style.color="var(--vscode-editorLightBulb-foreground)"),!e.item||!e.label)return;G_(!e.hideIcon,i.icon),i.text.textContent=RB(e.label),e.description?(i.description.textContent=RB(e.description),i.description.style.display="inline"):(i.description.textContent="",i.description.style.display="none"),i.keybinding.set(e.keybinding),G_(!!e.keybinding,i.keybinding.element);const n=this._keybindingService.lookupKeybinding(Aae)?.getLabel(),o=this._keybindingService.lookupKeybinding(Rae)?.getLabel();i.container.classList.toggle("option-disabled",e.disabled),e.tooltip?i.container.title=e.tooltip:e.disabled?i.container.title=e.label:n&&o?this._supportsPreview&&e.canPreview?i.container.title=h(1686,"{0} to Apply, {1} to Preview",n,o):i.container.title=h(1687,"{0} to Apply",n):i.container.title=""}disposeTemplate(e){e.keybinding.dispose()}};TB=f([p(1,He)],TB);class PDe extends UIEvent{constructor(){super("acceptSelectedAction")}}class Hj extends UIEvent{constructor(){super("previewSelectedAction")}}function LDe(s){if(s.kind==="action")return s.label}let AB=class extends F{constructor(e,t,i,n,o,r,a){super(),this._delegate=n,this._contextViewService=o,this._keybindingService=r,this._layoutService=a,this._actionLineHeight=24,this._headerLineHeight=26,this.cts=this._register(new li),this.domNode=document.createElement("div"),this.domNode.classList.add("actionList");const c={getHeight:d=>d.kind===Jr.Header?this._headerLineHeight:this._actionLineHeight,getTemplateId:d=>d.kind};this._list=this._register(new Rv(e,this.domNode,c,[new TB(t,this._keybindingService),new RDe],{keyboardSupport:!1,typeNavigationEnabled:!0,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:LDe},accessibilityProvider:{getAriaLabel:d=>{if(d.kind===Jr.Action){let l=d.label?RB(d?.label):"";return d.disabled&&(l=h(1688,"{0}, Disabled Reason: {1}",l,d.disabled)),l}return null},getWidgetAriaLabel:()=>h(1689,"Action Widget"),getRole:d=>d.kind===Jr.Action?"option":"separator",getWidgetRole:()=>"listbox"}})),this._list.style(fme),this._register(this._list.onMouseClick(d=>this.onListClick(d))),this._register(this._list.onMouseOver(d=>this.onListHover(d))),this._register(this._list.onDidChangeFocus(()=>this.onFocus())),this._register(this._list.onDidChangeSelection(d=>this.onListSelection(d))),this._allMenuItems=i,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&e.kind===Jr.Action}hide(e){this._delegate.onHide(e),this.cts.cancel(),this._contextViewService.hideContextView()}layout(e){const t=this._allMenuItems.filter(c=>c.kind==="header").length,n=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight;this._list.layout(n);let o=e;if(this._allMenuItems.length>=50)o=380;else{const c=this._allMenuItems.map((d,l)=>{const u=this.domNode.ownerDocument.getElementById(this._list.getElementID(l));if(u){u.style.width="auto";const g=u.getBoundingClientRect().width;return u.style.width="",g}return 0});o=Math.max(...c,e)}const a=Math.min(n,this._layoutService.getContainer(Et(this.domNode)).clientHeight*.7);return this._list.layout(a,o),this.domNode.style.height=`${a}px`,this._list.domFocus(),o}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){const t=this._list.getFocus();if(t.length===0)return;const i=t[0],n=this._list.element(i);if(!this.focusCondition(n))return;const o=e?new Hj:new PDe;this._list.setSelection([i],o)}onListSelection(e){if(!e.elements.length)return;const t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof Hj):this._list.setSelection([])}onFocus(){const e=this._list.getFocus();if(e.length===0)return;const t=e[0],i=this._list.element(t);this._delegate.onFocus?.(i.item)}async onListHover(e){const t=e.element;if(t&&t.item&&this.focusCondition(t)){if(this._delegate.onHover&&!t.disabled&&t.kind===Jr.Action){const i=await this._delegate.onHover(t.item,this.cts.token);t.canPreview=i?i.canPreview:void 0}e.index&&this._list.splice(e.index,1,[t])}this._list.setFocus(typeof e.index=="number"?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};AB=f([p(4,rf),p(5,He),p(6,af)],AB);function RB(s){return s.replace(/\r\n|\r|\n/g," ")}const Ed=J("actionWidgetService");Ve(Tae);H("actionBar.toggledBackground",Dz,h(1690,"Background color for toggled action items in action bar."));const cv={Visible:new O("codeActionMenuVisible",!1,h(1691,"Whether the action widget list is visible"))};let dv=class extends F{get isVisible(){return cv.Visible.getValue(this._contextKeyService)||!1}constructor(e,t,i){super(),this._contextViewService=e,this._contextKeyService=t,this._instantiationService=i,this._list=this._register(new Pt)}show(e,t,i,n,o,r,a){const c=cv.Visible.bindTo(this._contextKeyService),d=this._instantiationService.createInstance(AB,e,t,i,n);this._contextViewService.showContextView({getAnchor:()=>o,render:l=>(c.set(!0),this._renderWidget(l,d,a??[])),onHide:l=>{c.reset(),this._onWidgetClosed(l)}},r,!1)}acceptSelected(e){this._list.value?.acceptSelected(e)}focusPrevious(){this._list?.value?.focusPrevious()}focusNext(){this._list?.value?.focusNext()}hide(e){this._list.value?.hide(e),this._list.clear()}clear(){this._list.clear()}_renderWidget(e,t,i){const n=document.createElement("div");if(n.classList.add("action-widget"),e.appendChild(n),this._list.value=t,this._list.value)n.appendChild(this._list.value.domNode);else throw new Error("List has no value");const o=new U,r=document.createElement("div"),a=e.appendChild(r);a.classList.add("context-view-block"),o.add(re(a,pe.MOUSE_DOWN,m=>m.stopPropagation()));const c=document.createElement("div"),d=e.appendChild(c);d.classList.add("context-view-pointerBlock"),o.add(re(d,pe.POINTER_MOVE,()=>d.remove())),o.add(re(d,pe.MOUSE_DOWN,()=>d.remove()));let l=0;if(i.length){const m=this._createActionBar(".action-widget-action-bar",i);m&&(n.appendChild(m.getContainer().parentElement),o.add(m),l=m.getContainer().offsetWidth)}const u=this._list.value?.layout(l);n.style.width=`${u}px`;const g=o.add(Fo(e));return o.add(g.onDidBlur(()=>this.hide(!0))),o}_createActionBar(e,t){if(!t.length)return;const i=j(e),n=new Ar(i);return n.push(t,{icon:!1,label:!0}),n}_onWidgetClosed(e){this._list.value?.hide(e)}};dv=f([p(0,rf),p(1,fe),p(2,Z)],dv);const MI=W.EditorContrib+1e3;Y(class extends X{constructor(){super({id:"hideCodeActionWidget",title:I(1692,"Hide action widget"),precondition:cv.Visible,keybinding:{weight:MI,primary:S.Escape,secondary:[E.Shift|S.Escape]}})}run(s){s.get(Ed).hide(!0)}});Y(class extends X{constructor(){super({id:"selectPrevCodeAction",title:I(1693,"Select previous action"),precondition:cv.Visible,keybinding:{weight:MI,primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow],mac:{primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow,E.WinCtrl|S.KeyP]}}})}run(s){const e=s.get(Ed);e instanceof dv&&e.focusPrevious()}});Y(class extends X{constructor(){super({id:"selectNextCodeAction",title:I(1694,"Select next action"),precondition:cv.Visible,keybinding:{weight:MI,primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow],mac:{primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow,E.WinCtrl|S.KeyN]}}})}run(s){const e=s.get(Ed);e instanceof dv&&e.focusNext()}});Y(class extends X{constructor(){super({id:Aae,title:I(1695,"Accept selected action"),precondition:cv.Visible,keybinding:{weight:MI,primary:S.Enter,secondary:[E.CtrlCmd|S.Period]}})}run(s){const e=s.get(Ed);e instanceof dv&&e.acceptSelected()}});Y(class extends X{constructor(){super({id:Rae,title:I(1696,"Preview selected action"),precondition:cv.Visible,keybinding:{weight:MI,primary:E.CtrlCmd|S.Enter}})}run(s){const e=s.get(Ed);e instanceof dv&&e.acceptSelected(!0)}});const Jq=new O("hasSymbols",!1,h(1153,"Whether there are symbol locations that can be navigated via keyboard-only."));let PB=class{constructor(e,t,i,n){this._editorService=t,this._notificationService=i,this._keybindingService=n,this._currentModel=void 0,this._currentIdx=-1,this._ignoreEditorChange=!1,this._ctxHasSymbols=Jq.bindTo(e)}reset(){this._ctxHasSymbols.reset(),this._currentState?.dispose(),this._currentMessage?.close(),this._currentModel=void 0,this._currentIdx=-1}put(e){const t=e.parent.parent;if(t.references.length<=1){this.reset();return}this._currentModel=t,this._currentIdx=t.references.indexOf(e),this._ctxHasSymbols.set(!0),this._showMessage();const i=new LB(this._editorService),n=i.onDidChange(o=>{if(this._ignoreEditorChange)return;const r=this._editorService.getActiveCodeEditor();if(!r)return;const a=r.getModel(),c=r.getPosition();if(!a||!c)return;let d=!1,l=!1;for(const u of t.references)if(At(u.uri,a.uri))d=!0,l=l||P.containsPosition(u.range,c);else if(d)break;(!d||!l)&&this.reset()});this._currentState=Wo(i,n)}revealNext(e){if(!this._currentModel)return Promise.resolve();this._currentIdx+=1,this._currentIdx%=this._currentModel.references.length;const t=this._currentModel.references[this._currentIdx];return this._showMessage(),this._ignoreEditorChange=!0,this._editorService.openCodeEditor({resource:t.uri,options:{selection:P.collapseToStart(t.range),selectionRevealType:Dm.NearTopIfOutsideViewport}},e).finally(()=>{this._ignoreEditorChange=!1})}_showMessage(){this._currentMessage?.close();const e=this._keybindingService.lookupKeybinding("editor.gotoNextSymbolFromResult"),t=e?h(1154,"Symbol {0} of {1}, {2} for next",this._currentIdx+1,this._currentModel.references.length,e.getLabel()):h(1155,"Symbol {0} of {1}",this._currentIdx+1,this._currentModel.references.length);this._currentMessage=this._notificationService.status(t)}};PB=f([p(0,fe),p(1,Bt),p(2,Dt),p(3,He)],PB);ze(new class extends Vo{constructor(){super({id:"editor.gotoNextSymbolFromResult",precondition:Jq,kbOpts:{weight:W.EditorContrib,primary:S.F12}})}runEditorCommand(s,e){return s.get(GN).revealNext(e)}});Me.registerCommandAndKeybindingRule({id:"editor.gotoNextSymbolFromResult.cancel",weight:W.EditorContrib,when:Jq,primary:S.Escape,handler(s){s.get(GN).reset()}});let LB=class{constructor(e){this._listener=new Map,this._disposables=new U,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._disposables.add(e.onCodeEditorRemove(this._onDidRemoveEditor,this)),this._disposables.add(e.onCodeEditorAdd(this._onDidAddEditor,this)),e.listCodeEditors().forEach(this._onDidAddEditor,this)}dispose(){this._disposables.dispose(),this._onDidChange.dispose(),Xe(this._listener.values())}_onDidAddEditor(e){this._listener.set(e,Wo(e.onDidChangeCursorPosition(t=>this._onDidChange.fire({editor:e})),e.onDidChangeModelContent(t=>this._onDidChange.fire({editor:e}))))}_onDidRemoveEditor(e){this._listener.get(e)?.dispose(),this._listener.delete(e)}};LB=f([p(0,Bt)],LB);const NI=J("IMcpService"),MDe=J("IMcpConfigPathsService"),jN=J("mcpRegistry"),Pae=J("IExtensionGalleryManifestService"),NDe=J("IWebContentExtractorService"),YN=J("ISharedWebContentExtractorService"),ODe=J("defaultAccountService");class FDe{extract(e){throw new Error("Not implemented")}}class WDe{readImage(e,t){throw new Error("Not implemented")}}var Vb;(function(s){s.Uninitialized="uninitialized",s.Unavailable="unavailable",s.Available="available"})(Vb||(Vb={}));const Uj=new O("defaultAccountStatus",Vb.Uninitialized);class BDe extends F{constructor(){super(...arguments),this.onDidChangeDefaultAccount=T.None}async getDefaultAccount(){return null}setDefaultAccount(e){}}(class extends F{static{this.ID="workbench.contributions.defaultAccountManagement"}constructor(e,t,i,n,o,r,a,c){super(),this.defaultAccountService=e,this.configurationService=t,this.authenticationService=i,this.extensionService=n,this.productService=o,this.requestService=r,this.logService=a,this.defaultAccount=null,this.accountStatusContext=Uj.bindTo(c),this.initialize()}async initialize(){if(!this.productService.defaultAccount)return;const{authenticationProvider:e,tokenEntitlementUrl:t,chatEntitlementUrl:i}=this.productService.defaultAccount;await this.extensionService.whenInstalledExtensionsRegistered();const n=this.authenticationService.declaredProviders.find(o=>o.id===e.id);if(!n){this.logService.info(`Default account authentication provider ${e} is not declared.`);return}this.registerSignInAction(e.id,n.label,e.enterpriseProviderId,e.enterpriseProviderConfig,e.scopes),this.setDefaultAccount(await this.getDefaultAccountFromAuthenticatedSessions(e.id,e.enterpriseProviderId,e.enterpriseProviderConfig,e.scopes,t,i)),this._register(this.authenticationService.onDidChangeSessions(async o=>{if(!(o.providerId!==e.id&&o.providerId!==e.enterpriseProviderId)){if(this.defaultAccount&&o.event.removed?.some(r=>r.id===this.defaultAccount?.sessionId)){this.setDefaultAccount(null);return}this.setDefaultAccount(await this.getDefaultAccountFromAuthenticatedSessions(e.id,e.enterpriseProviderId,e.enterpriseProviderConfig,e.scopes,t,i))}}))}setDefaultAccount(e){this.defaultAccount=e,this.defaultAccountService.setDefaultAccount(this.defaultAccount),this.defaultAccount?this.accountStatusContext.set(Vb.Available):this.accountStatusContext.set(Vb.Unavailable)}extractFromToken(e,t){const i=new Map,o=e?.split(":")[0]?.split(";");for(const r of o){const[a,c]=r.split("=");i.set(a,c)}return i.get(t)}async getDefaultAccountFromAuthenticatedSessions(e,t,i,n,o,r){const a=this.configurationService.getValue(i)?t:e,d=(await this.authenticationService.getSessions(a,void 0,void 0,!0)).find(g=>this.scopesMatch(g.scopes,n));if(!d)return null;const[l,u]=await Promise.all([this.getChatEntitlements(d.accessToken,r),this.getTokenEntitlements(d.accessToken,o)]);return{sessionId:d.id,enterprise:a===t||d.account.label.includes("_"),...l,...u}}scopesMatch(e,t){return e.length===t.length&&t.every(i=>e.includes(i))}async getTokenEntitlements(e,t){if(!t)return{};try{const i=await this.requestService.request({type:"GET",url:t,disableCache:!0,headers:{Authorization:`Bearer ${e}`}},Ce.None),n=await CF(i);if(n)return{chat_preview_features_enabled:this.extractFromToken(n.token,"editor_preview_features")!=="0"};this.logService.error("Failed to fetch token entitlements","No data returned")}catch(i){this.logService.error("Failed to fetch token entitlements",ya(i))}return{}}async getChatEntitlements(e,t){if(!t)return{};try{const i=await this.requestService.request({type:"GET",url:t,disableCache:!0,headers:{Authorization:`Bearer ${e}`}},Ce.None),n=await CF(i);if(n)return n;this.logService.error("Failed to fetch entitlements","No data returned")}catch(i){this.logService.error("Failed to fetch entitlements",ya(i))}return{}}registerSignInAction(e,t,i,n,o){const r=this;this._register(Y(class extends X{constructor(){super({id:"workbench.accounts.actions.signin",title:h(11913,"Sign in to {0}",t),menu:{id:N.AccountsContext,when:x.and(Uj.isEqualTo(Vb.Unavailable),x.has("config.extensions.gallery.serviceUrl")),group:"0_signin"}})}run(){const a=r.configurationService.getValue(n)?i:e;return r.authenticationService.createSession(a,o)}}))}});const VDe=J("chatTransferService"),Lae=J("IChatStatusItemService"),Mae=J("IAiSettingsSearchService");function y(s,e,t){function i(){throw new Error(`Unsupported: ${s.constructor.name}.${e} is not supported. You are using a feature without registering the corresponding service override.`)}t.value!=null?t.value=i:t.get!=null&&(t.get=i)}G(ds,cSe,z.Delayed);G($N,mme,z.Delayed);G(Sd,vme,z.Delayed);G(Ne,oDe,z.Delayed);G(Bt,cB,z.Delayed);G(dSe,dB,z.Delayed);G(GN,PB,z.Delayed);G(hSe,lSe,z.Delayed);G(aae,pDe,z.Delayed);G(TI,uB,z.Delayed);G(sae,mB,z.Delayed);G(UN,gB,z.Delayed);G(oae,pB,z.Delayed);G(Ti,_me,z.Delayed);G(rae,UA,z.Delayed);G(Ed,dv,z.Delayed);G(HM,bme,z.Delayed);G(tI,class extends yme{constructor(){super(kb.Info,R.file("logs.log"))}doCreateLogger(){return new wme}},z.Eager);class eK{constructor(){this._serviceBrand=void 0,this.getVisibleTextEditorControls=()=>[],this.onWillOpenEditor=T.None,this.onDidActiveEditorChange=T.None,this.onDidVisibleEditorsChange=T.None,this.onDidEditorsChange=T.None,this.onDidCloseEditor=T.None,this.activeEditorPane=void 0,this.activeEditor=void 0,this.activeTextEditorLanguageId=void 0,this.visibleEditorPanes=[],this.visibleEditors=[],this.visibleTextEditorControls=[],this.editors=[],this.count=0,this.getEditors=()=>[],this.replaceEditors=async()=>{},this.isOpened=()=>!1,this.isVisible=()=>!1,this.closeEditor=async()=>{},this.closeEditors=async()=>{},this.findEditors=()=>[],this.save=async()=>({success:!1,editors:[]}),this.saveAll=async()=>({success:!1,editors:[]}),this.revert=async()=>!1,this.revertAll=async()=>!1}get activeTextEditorControl(){return Qa.get(Bt).getFocusedCodeEditor()??void 0}openEditor(){b()}openEditors(){b()}createScoped(){return this}}f([y],eK.prototype,"openEditor",null);f([y],eK.prototype,"openEditors",null);G(de,eK,z.Eager);class Nae{constructor(){this._serviceBrand=void 0,this.getPaneCompositeIds=()=>[],this.onDidPaneCompositeOpen=T.None,this.onDidPaneCompositeClose=T.None,this.openPaneComposite=async()=>{},this.getActivePaneComposite=()=>{},this.getPaneComposite=()=>{},this.getPaneComposites=()=>[],this.getPinnedPaneCompositeIds=()=>[],this.getVisiblePaneCompositeIds=()=>[],this.getProgressIndicator=()=>{},this.hideActivePaneComposite=()=>{},this.showActivity=()=>F.None}getLastActivePaneCompositeId(){b()}}f([y],Nae.prototype,"getLastActivePaneCompositeId",null);G(da,Nae,z.Eager);G(nn,XW,z.Delayed);class Co{resolveDecoding(){b()}resolveEncoding(){b()}validateDetectedEncoding(){b()}getEncoding(){b()}get files(){return b()}get untitled(){return b()}get encoding(){return b()}isDirty(){b()}save(){b()}saveAs(){b()}revert(){b()}read(){b()}readStream(){b()}write(){b()}create(){b()}getEncodedReadable(){b()}getDecodedStream(){b()}dispose(){b()}}f([y],Co.prototype,"resolveDecoding",null);f([y],Co.prototype,"resolveEncoding",null);f([y],Co.prototype,"validateDetectedEncoding",null);f([y],Co.prototype,"getEncoding",null);f([y],Co.prototype,"files",null);f([y],Co.prototype,"untitled",null);f([y],Co.prototype,"encoding",null);f([y],Co.prototype,"isDirty",null);f([y],Co.prototype,"save",null);f([y],Co.prototype,"saveAs",null);f([y],Co.prototype,"revert",null);f([y],Co.prototype,"read",null);f([y],Co.prototype,"readStream",null);f([y],Co.prototype,"write",null);f([y],Co.prototype,"create",null);f([y],Co.prototype,"getEncodedReadable",null);f([y],Co.prototype,"getDecodedStream",null);f([y],Co.prototype,"dispose",null);G(Ps,Co,z.Eager);class no{constructor(){this._serviceBrand=void 0,this.onDidChangeFileSystemProviderRegistrations=T.None,this.onDidChangeFileSystemProviderCapabilities=T.None,this.onWillActivateFileSystemProvider=T.None,this.getProvider=function(){},this.activateProvider=async()=>{},this.canHandleResource=async()=>!1,this.hasProvider=()=>!1,this.hasCapability=()=>!1,this.listCapabilities=()=>[],this.onDidFilesChange=T.None,this.onDidRunOperation=T.None,this.exists=async()=>!1,this.onDidWatchError=T.None}registerProvider(){b()}resolve(){b()}resolveAll(){b()}stat(){b()}readFile(){b()}readFileStream(){b()}writeFile(){b()}move(){b()}canMove(){b()}copy(){b()}canCopy(){b()}cloneFile(){b()}createFile(){b()}canCreateFile(){b()}createFolder(){b()}del(){b()}canDelete(){b()}watch(){b()}createWatcher(){b()}dispose(){}}f([y],no.prototype,"registerProvider",null);f([y],no.prototype,"resolve",null);f([y],no.prototype,"resolveAll",null);f([y],no.prototype,"stat",null);f([y],no.prototype,"readFile",null);f([y],no.prototype,"readFileStream",null);f([y],no.prototype,"writeFile",null);f([y],no.prototype,"move",null);f([y],no.prototype,"canMove",null);f([y],no.prototype,"copy",null);f([y],no.prototype,"canCopy",null);f([y],no.prototype,"cloneFile",null);f([y],no.prototype,"createFile",null);f([y],no.prototype,"canCreateFile",null);f([y],no.prototype,"createFolder",null);f([y],no.prototype,"del",null);f([y],no.prototype,"canDelete",null);f([y],no.prototype,"watch",null);f([y],no.prototype,"createWatcher",null);G(je,no,z.Eager);class Jn{constructor(){this.selectedEditors=[],this.isSelected=()=>!1,this.isTransient=()=>!1,this.windowId=zi.vscodeWindowId,this.onDidFocus=T.None,this.onDidOpenEditorFail=T.None,this.whenRestored=Promise.resolve(),this.disposed=!1,this.minimumWidth=0,this.maximumWidth=Number.POSITIVE_INFINITY,this.minimumHeight=0,this.maximumHeight=Number.POSITIVE_INFINITY,this.onDidChange=T.None,this.onDidModelChange=T.None,this.onWillDispose=T.None,this.onDidActiveEditorChange=T.None,this.onWillCloseEditor=T.None,this.onDidCloseEditor=T.None,this.onWillMoveEditor=T.None,this.onWillOpenEditor=T.None,this.id=0,this.index=0,this.label="main",this.ariaLabel="main",this.activeEditorPane=void 0,this.activeEditor=null,this.previewEditor=null,this.count=0,this.isEmpty=!1,this.isLocked=!1,this.stickyCount=0,this.editors=[],this.getEditors=()=>[],this.findEditors=()=>[],this.getEditorByIndex=()=>{},this.isPinned=()=>!1,this.isSticky=()=>!1,this.isActive=()=>!1,this.contains=()=>!1,this.pinEditor=()=>{},this.stickEditor=()=>{},this.unstickEditor=()=>{},this.lock=()=>{}}setSelection(){b()}get groupsView(){return b()}notifyLabelChanged(){}createEditorActions(){b()}get titleHeight(){return b()}setActive(){b()}notifyIndexChanged(){b()}relayout(){b()}dispose(){b()}toJSON(){b()}get element(){return b()}layout(){b()}get scopedContextKeyService(){return Qa.get(fe)}getIndexOfEditor(){b()}openEditor(){b()}openEditors(){b()}moveEditor(){b()}moveEditors(){b()}copyEditor(){b()}copyEditors(){b()}closeEditor(){b()}closeEditors(){b()}closeAllEditors(){b()}replaceEditors(){b()}focus(){}isFirst(){b()}isLast(){b()}}f([y],Jn.prototype,"setSelection",null);f([y],Jn.prototype,"groupsView",null);f([y],Jn.prototype,"createEditorActions",null);f([y],Jn.prototype,"titleHeight",null);f([y],Jn.prototype,"setActive",null);f([y],Jn.prototype,"notifyIndexChanged",null);f([y],Jn.prototype,"relayout",null);f([y],Jn.prototype,"dispose",null);f([y],Jn.prototype,"toJSON",null);f([y],Jn.prototype,"element",null);f([y],Jn.prototype,"layout",null);f([y],Jn.prototype,"getIndexOfEditor",null);f([y],Jn.prototype,"openEditor",null);f([y],Jn.prototype,"openEditors",null);f([y],Jn.prototype,"moveEditor",null);f([y],Jn.prototype,"moveEditors",null);f([y],Jn.prototype,"copyEditor",null);f([y],Jn.prototype,"copyEditors",null);f([y],Jn.prototype,"closeEditor",null);f([y],Jn.prototype,"closeEditors",null);f([y],Jn.prototype,"closeAllEditors",null);f([y],Jn.prototype,"replaceEditors",null);f([y],Jn.prototype,"isFirst",null);f([y],Jn.prototype,"isLast",null);const $A=new Jn;class Ls{constructor(){this.onWillDispose=T.None,this.windowId=zi.vscodeWindowId,this.hasMaximizedGroup=()=>!1,this.onDidLayout=T.None,this.onDidScroll=T.None,this.isReady=!0,this.whenReady=Promise.resolve(),this.whenRestored=Promise.resolve(),this.hasRestorableState=!1,this.onDidChangeActiveGroup=T.None,this.onDidAddGroup=T.None,this.onDidRemoveGroup=T.None,this.onDidMoveGroup=T.None,this.onDidActivateGroup=T.None,this.onDidChangeGroupIndex=T.None,this.onDidChangeGroupLocked=T.None,this.onDidChangeGroupMaximized=T.None,this.activeGroup=$A,this.groups=[$A],this.count=0,this.orientation=cc.HORIZONTAL,this.getGroups=()=>[],this.getGroup=()=>{},this.findGroup=()=>{},this.partOptions=Vt,this.onDidChangeEditorPartOptions=T.None}get contentDimension(){return b()}centerLayout(){b()}isLayoutCentered(){b()}enforcePartOptions(){b()}get sideGroup(){return b()}activateGroup(){b()}getSize(){b()}setSize(){b()}arrangeGroups(){b()}toggleMaximizeGroup(){b()}toggleExpandGroup(){b()}applyLayout(){b()}getLayout(){b()}setGroupOrientation(){b()}addGroup(){b()}removeGroup(){b()}moveGroup(){b()}mergeGroup(){b()}mergeAllGroups(){b()}copyGroup(){b()}createEditorDropTarget(){b()}}f([y],Ls.prototype,"contentDimension",null);f([y],Ls.prototype,"centerLayout",null);f([y],Ls.prototype,"isLayoutCentered",null);f([y],Ls.prototype,"enforcePartOptions",null);f([y],Ls.prototype,"sideGroup",null);f([y],Ls.prototype,"activateGroup",null);f([y],Ls.prototype,"getSize",null);f([y],Ls.prototype,"setSize",null);f([y],Ls.prototype,"arrangeGroups",null);f([y],Ls.prototype,"toggleMaximizeGroup",null);f([y],Ls.prototype,"toggleExpandGroup",null);f([y],Ls.prototype,"applyLayout",null);f([y],Ls.prototype,"getLayout",null);f([y],Ls.prototype,"setGroupOrientation",null);f([y],Ls.prototype,"addGroup",null);f([y],Ls.prototype,"removeGroup",null);f([y],Ls.prototype,"moveGroup",null);f([y],Ls.prototype,"mergeGroup",null);f([y],Ls.prototype,"mergeAllGroups",null);f([y],Ls.prototype,"copyGroup",null);f([y],Ls.prototype,"createEditorDropTarget",null);class Sn{constructor(){this.onDidCreateAuxiliaryEditorPart=T.None,this.mainPart=new Ls,this.activePart=this.mainPart,this.parts=[this.mainPart],this.onDidChangeGroupMaximized=T.None,this.partOptions=Vt,this._serviceBrand=void 0,this.onDidChangeActiveGroup=T.None,this.onDidAddGroup=T.None,this.onDidRemoveGroup=T.None,this.onDidMoveGroup=T.None,this.onDidActivateGroup=T.None,this.onDidLayout=T.None,this.onDidScroll=T.None,this.onDidChangeGroupIndex=T.None,this.onDidChangeGroupLocked=T.None,this.activeGroup=$A,this.groups=[$A],this.count=0,this.orientation=cc.HORIZONTAL,this.isReady=!1,this.whenReady=Promise.resolve(),this.whenRestored=Promise.resolve(),this.hasRestorableState=!1,this.getGroups=()=>[],this.getGroup=()=>{},this.isLayoutCentered=()=>!1,this.findGroup=()=>{},this.onDidChangeEditorPartOptions=T.None}getScopedInstantiationService(){b()}registerContextKeyProvider(){b()}saveWorkingSet(){b()}getWorkingSets(){b()}applyWorkingSet(){b()}deleteWorkingSet(){b()}getPart(){b()}createAuxiliaryEditorPart(){b()}toggleMaximizeGroup(){b()}toggleExpandGroup(){b()}createEditorDropTarget(){b()}getLayout(){b()}get contentDimension(){return b()}get sideGroup(){return b()}activateGroup(){b()}getSize(){b()}setSize(){b()}arrangeGroups(){b()}applyLayout(){b()}centerLayout(){b()}setGroupOrientation(){b()}addGroup(){b()}removeGroup(){b()}moveGroup(){b()}mergeGroup(){b()}mergeAllGroups(){b()}copyGroup(){b()}enforcePartOptions(){b()}}f([y],Sn.prototype,"getScopedInstantiationService",null);f([y],Sn.prototype,"registerContextKeyProvider",null);f([y],Sn.prototype,"saveWorkingSet",null);f([y],Sn.prototype,"getWorkingSets",null);f([y],Sn.prototype,"applyWorkingSet",null);f([y],Sn.prototype,"deleteWorkingSet",null);f([y],Sn.prototype,"getPart",null);f([y],Sn.prototype,"createAuxiliaryEditorPart",null);f([y],Sn.prototype,"toggleMaximizeGroup",null);f([y],Sn.prototype,"toggleExpandGroup",null);f([y],Sn.prototype,"createEditorDropTarget",null);f([y],Sn.prototype,"getLayout",null);f([y],Sn.prototype,"contentDimension",null);f([y],Sn.prototype,"sideGroup",null);f([y],Sn.prototype,"activateGroup",null);f([y],Sn.prototype,"getSize",null);f([y],Sn.prototype,"setSize",null);f([y],Sn.prototype,"arrangeGroups",null);f([y],Sn.prototype,"applyLayout",null);f([y],Sn.prototype,"centerLayout",null);f([y],Sn.prototype,"setGroupOrientation",null);f([y],Sn.prototype,"addGroup",null);f([y],Sn.prototype,"removeGroup",null);f([y],Sn.prototype,"moveGroup",null);f([y],Sn.prototype,"mergeGroup",null);f([y],Sn.prototype,"mergeAllGroups",null);f([y],Sn.prototype,"copyGroup",null);f([y],Sn.prototype,"enforcePartOptions",null);G(xe,Sn,z.Eager);class HDe{focus(){}focusNextAction(){}focusPreviousAction(){}hide(){}show(){}}G(yIe,HDe,z.Eager);class QN{constructor(){this.onMenubarVisibilityChange=T.None,this.isCommandCenterVisible=!1,this.onDidChangeCommandCenterVisibility=T.None,this.registerVariables=()=>{}}getPart(){b()}createAuxiliaryTitlebarPart(){b()}dispose(){b()}updateProperties(){}}f([y],QN.prototype,"getPart",null);f([y],QN.prototype,"createAuxiliaryTitlebarPart",null);f([y],QN.prototype,"dispose",null);G(GIe,QN,z.Eager);class Hh{constructor(){this.onWillRunWorkingCopyFileOperation=T.None,this.onDidFailWorkingCopyFileOperation=T.None,this.onDidRunWorkingCopyFileOperation=T.None,this.hasSaveParticipants=!1,this.getDirty=()=>[]}addFileOperationParticipant(){b()}addSaveParticipant(){b()}runSaveParticipants(){b()}create(){b()}createFolder(){b()}move(){b()}copy(){b()}delete(){b()}registerWorkingCopyProvider(){b()}}f([y],Hh.prototype,"addFileOperationParticipant",null);f([y],Hh.prototype,"addSaveParticipant",null);f([y],Hh.prototype,"runSaveParticipants",null);f([y],Hh.prototype,"create",null);f([y],Hh.prototype,"createFolder",null);f([y],Hh.prototype,"move",null);f([y],Hh.prototype,"copy",null);f([y],Hh.prototype,"delete",null);f([y],Hh.prototype,"registerWorkingCopyProvider",null);G(dg,Hh,z.Eager);class OI{constructor(){this.defaultUriScheme="file",this.resolvedUserHome=void 0}get path(){return b()}fileURI(){b()}userHome(){b()}hasValidBasename(){b()}}f([y],OI.prototype,"path",null);f([y],OI.prototype,"fileURI",null);f([y],OI.prototype,"userHome",null);f([y],OI.prototype,"hasValidBasename",null);G(_c,OI,z.Delayed);class UDe{constructor(){this._serviceBrand=void 0,this.version="unknown",this.commit="unknown",this.quality="oss",this.nameShort="Code - OSS Dev",this.nameLong="Code - OSS Dev",this.applicationName="code-oss",this.dataFolderName=".vscode-oss",this.urlProtocol="code-oss",this.reportIssueUrl="https://github.com/microsoft/vscode/issues/new",this.licenseName="MIT",this.licenseUrl="https://github.com/microsoft/vscode/blob/main/LICENSE.txt",this.serverApplicationName="code-server-oss",this.extensionProperties={}}}G(Vn,UDe,z.Eager);class $De{constructor(){this._serviceBrand=void 0,this.getConfigBasedTips=async()=>[],this.getImportantExecutableBasedTips=async()=>[],this.getOtherExecutableBasedTips=async()=>[]}}G(EEe,$De,z.Eager);class tK{constructor(){this.onDidChange=T.None}addStatus(){b()}getLanguageStatus(){b()}}f([y],tK.prototype,"addStatus",null);f([y],tK.prototype,"getLanguageStatus",null);G(Uq,tK,z.Delayed);class Uh{constructor(){this.getElementData=async()=>{},this.getNativeWindowHandle=async()=>{},this.getScreenshot=async()=>{},this.getPathForFile=()=>{},this.onDidChangeFullScreen=T.None,this.onDidChangeFocus=T.None,this.hasFocus=!1,this.hadLastFocus=async()=>!1,this.onDidChangeActiveWindow=T.None}focus(){b()}openWindow(){b()}toggleFullScreen(){b()}moveTop(){b()}getCursorScreenPoint(){b()}restart(){b()}reload(){b()}close(){b()}withExpectedShutdown(){b()}}f([y],Uh.prototype,"focus",null);f([y],Uh.prototype,"openWindow",null);f([y],Uh.prototype,"toggleFullScreen",null);f([y],Uh.prototype,"moveTop",null);f([y],Uh.prototype,"getCursorScreenPoint",null);f([y],Uh.prototype,"restart",null);f([y],Uh.prototype,"reload",null);f([y],Uh.prototype,"close",null);f([y],Uh.prototype,"withExpectedShutdown",null);G(Hn,Uh,z.Eager);class Oae extends rB{shutdown(){b()}}f([y],Oae.prototype,"shutdown",null);G(wd,Oae,z.Eager);class GDe{isEnabledForLanguage(){return!1}async detectLanguage(){}}G(eoe,GDe,z.Eager);G(cn,Sme,z.Eager);class zDe{constructor(){this.onDidChangeKeyboardLayout=T.None,this.getRawKeyboardMapping=()=>null,this.getCurrentKeyboardLayout=()=>null,this.getAllKeyboardLayouts=()=>[],this.getKeyboardMapper=()=>new IIe(!1,$u),this.validateCurrentKeyboardMapping=()=>{}}}G(TEe,zDe,z.Delayed);class qDe{async requiresInitialization(){return!1}async whenInitializationFinished(){}async initializeRequiredResources(){}async initializeInstalledExtensions(){}async initializeOtherResources(){}}G(HN,qDe,z.Eager);class KDe{constructor(){this.dark=!1,this.highContrast=!1,this.onDidChangeColorScheme=T.None}}G(eae,KDe,z.Eager);let wo=class{constructor(e){this.profileService=e,this.onDidDefaultSettingsContentChanged=T.None,this.getDefaultSettingsContent=()=>{},this.hasDefaultSettingsContent=()=>!1,this.getSetting=()=>{},this.userSettingsResource=this.profileService.currentProfile.settingsResource,this.workspaceSettingsResource=null}getFolderSettingsResource(){b()}createPreferencesEditorModel(){b()}resolveModel(){b()}createSettings2EditorModel(){b()}openRawDefaultSettings(){b()}openSettings(){b()}openUserSettings(){b()}openRemoteSettings(){b()}openWorkspaceSettings(){b()}openFolderSettings(){b()}openGlobalKeybindingSettings(){b()}openDefaultKeybindingsFile(){b()}getEditableSettingsURI(){b()}createSplitJsonEditorInput(){b()}openApplicationSettings(){b()}openLanguageSpecificSettings(){b()}};f([y],wo.prototype,"getFolderSettingsResource",null);f([y],wo.prototype,"createPreferencesEditorModel",null);f([y],wo.prototype,"resolveModel",null);f([y],wo.prototype,"createSettings2EditorModel",null);f([y],wo.prototype,"openRawDefaultSettings",null);f([y],wo.prototype,"openSettings",null);f([y],wo.prototype,"openUserSettings",null);f([y],wo.prototype,"openRemoteSettings",null);f([y],wo.prototype,"openWorkspaceSettings",null);f([y],wo.prototype,"openFolderSettings",null);f([y],wo.prototype,"openGlobalKeybindingSettings",null);f([y],wo.prototype,"openDefaultKeybindingsFile",null);f([y],wo.prototype,"getEditableSettingsURI",null);f([y],wo.prototype,"createSplitJsonEditorInput",null);f([y],wo.prototype,"openApplicationSettings",null);f([y],wo.prototype,"openLanguageSpecificSettings",null);wo=f([p(0,Mh)],wo);G(Hv,wo,z.Eager);class XN{constructor(){this.onDidEncounterLanguage=T.None}createGrammar(){b()}startDebugMode(){b()}createTokenizer(){b()}}f([y],XN.prototype,"createGrammar",null);f([y],XN.prototype,"startDebugMode",null);f([y],XN.prototype,"createTokenizer",null);G(UIe,XN,z.Eager);let gc=class{constructor(e){this.profileService=e,this.onDidResetWorkspaces=T.None,this.isEnabled=()=>!1,this.defaultProfile=this.profileService.currentProfile,this.onDidChangeProfiles=T.None,this.profiles=[this.profileService.currentProfile],this.getProfile=()=>this.profileService.currentProfile}createNamedProfile(){b()}createTransientProfile(){b()}resetWorkspaces(){b()}cleanUp(){b()}cleanUpTransientProfiles(){b()}get profilesHome(){return b()}createProfile(){b()}updateProfile(){b()}setProfileForWorkspace(){b()}removeProfile(){b()}};f([y],gc.prototype,"createNamedProfile",null);f([y],gc.prototype,"createTransientProfile",null);f([y],gc.prototype,"resetWorkspaces",null);f([y],gc.prototype,"cleanUp",null);f([y],gc.prototype,"cleanUpTransientProfiles",null);f([y],gc.prototype,"profilesHome",null);f([y],gc.prototype,"createProfile",null);f([y],gc.prototype,"updateProfile",null);f([y],gc.prototype,"setProfileForWorkspace",null);f([y],gc.prototype,"removeProfile",null);gc=f([p(0,Mh)],gc);G(Uv,gc,z.Eager);class ZN{constructor(){this.onDidChange=T.None}readStorageData(){b()}updateStorageData(){b()}withProfileScopedStorageService(){b()}}f([y],ZN.prototype,"readStorageData",null);f([y],ZN.prototype,"updateStorageData",null);f([y],ZN.prototype,"withProfileScopedStorageService",null);G(OEe,ZN,z.Eager);let MB=class extends KIe{constructor(e){super({...Tme("__default__profile__","Default",e.userRoamingDataHome,Ct(e.cacheHome,"CachedProfilesData")),isDefault:!0})}};MB=f([p(0,Hs)],MB);G(Mh,MB,z.Eager);G(Cme,USe,z.Eager);let Mw=class{constructor(){this.getSnippets=async()=>[]}getSnippetFiles(){b()}isEnabled(){b()}updateEnablement(){b()}updateUsageTimestamp(){b()}getSnippetsSync(){b()}};f([y],Mw.prototype,"getSnippetFiles",null);f([y],Mw.prototype,"isEnabled",null);f([y],Mw.prototype,"updateEnablement",null);f([y],Mw.prototype,"updateUsageTimestamp",null);f([y],Mw.prototype,"getSnippetsSync",null);G(MN,Mw,z.Eager);const jDe={getSession:()=>{},getSessions:()=>[],getBreakpoints:()=>[],areBreakpointsActivated:()=>!1,getFunctionBreakpoints:()=>[],getDataBreakpoints:()=>[],getExceptionBreakpoints:()=>[],getExceptionBreakpointsForSession:()=>[],getInstructionBreakpoints:()=>[],getWatchExpressions:()=>[],onDidChangeBreakpoints:T.None,onDidChangeCallStack:T.None,onDidChangeWatchExpressions:T.None,fetchCallstack:b,getId:b,registerBreakpointModes:b,getBreakpointModes:()=>[],onDidChangeWatchExpressionValue:T.None};class vf{constructor(){this.getVisualizedExpression=()=>{},this.onDidChangeVisualization=T.None,this.focusedSession=void 0,this.focusedThread=void 0,this.focusedStackFrame=void 0,this.onDidFocusSession=T.None,this.onDidFocusStackFrame=T.None,this.onDidSelectExpression=T.None,this.onDidEvaluateLazyExpression=T.None,this.onWillUpdateViews=T.None,this.onDidFocusThread=T.None}setVisualizedExpression(){b()}getId(){b()}getSelectedExpression(){b()}setSelectedExpression(){b()}updateViews(){b()}isMultiSessionView(){b()}evaluateLazyExpression(){b()}}f([y],vf.prototype,"setVisualizedExpression",null);f([y],vf.prototype,"getId",null);f([y],vf.prototype,"getSelectedExpression",null);f([y],vf.prototype,"setSelectedExpression",null);f([y],vf.prototype,"updateViews",null);f([y],vf.prototype,"isMultiSessionView",null);f([y],vf.prototype,"evaluateLazyExpression",null);class yl{constructor(){this.onDidRegisterDebugger=T.None,this.hasEnabledDebuggers=()=>!1,this.someDebuggerInterestedInLanguage=()=>!1,this.getDebugger=()=>{},this.registerDebugAdapterFactory=()=>F.None,this.onDidDebuggersExtPointRead=T.None}getDebugAdapterDescriptor(){b()}getDebuggerLabel(){b()}activateDebuggers(){b()}createDebugAdapter(){b()}registerDebugAdapterDescriptorFactory(){b()}unregisterDebugAdapterDescriptorFactory(){b()}substituteVariables(){b()}runInTerminal(){b()}getEnabledDebugger(){b()}guessDebugger(){b()}}f([y],yl.prototype,"getDebugAdapterDescriptor",null);f([y],yl.prototype,"getDebuggerLabel",null);f([y],yl.prototype,"activateDebuggers",null);f([y],yl.prototype,"createDebugAdapter",null);f([y],yl.prototype,"registerDebugAdapterDescriptorFactory",null);f([y],yl.prototype,"unregisterDebugAdapterDescriptorFactory",null);f([y],yl.prototype,"substituteVariables",null);f([y],yl.prototype,"runInTerminal",null);f([y],yl.prototype,"getEnabledDebugger",null);f([y],yl.prototype,"guessDebugger",null);class dn{constructor(){this.initializingOptions=void 0,this.onDidChangeState=T.None,this.onDidNewSession=T.None,this.onWillNewSession=T.None,this.onDidEndSession=T.None,this.getAdapterManager=()=>new yl,this.getModel=()=>jDe,this.getViewModel=()=>new vf}sendBreakpoints(){b()}updateDataBreakpoint(){b()}get state(){return b()}getConfigurationManager(){b()}focusStackFrame(){b()}canSetBreakpointsIn(){b()}addBreakpoints(){b()}updateBreakpoints(){b()}enableOrDisableBreakpoints(){b()}setBreakpointsActivated(){b()}removeBreakpoints(){b()}addFunctionBreakpoint(){b()}updateFunctionBreakpoint(){b()}removeFunctionBreakpoints(){b()}addDataBreakpoint(){b()}removeDataBreakpoints(){b()}addInstructionBreakpoint(){b()}removeInstructionBreakpoints(){b()}setExceptionBreakpointCondition(){b()}setExceptionBreakpointsForSession(){b()}sendAllBreakpoints(){b()}addWatchExpression(){b()}renameWatchExpression(){b()}moveWatchExpression(){b()}removeWatchExpressions(){b()}startDebugging(){b()}restartSession(){b()}stopSession(){b()}sourceIsNotAvailable(){b()}runTo(){b()}}f([y],dn.prototype,"sendBreakpoints",null);f([y],dn.prototype,"updateDataBreakpoint",null);f([y],dn.prototype,"state",null);f([y],dn.prototype,"getConfigurationManager",null);f([y],dn.prototype,"focusStackFrame",null);f([y],dn.prototype,"canSetBreakpointsIn",null);f([y],dn.prototype,"addBreakpoints",null);f([y],dn.prototype,"updateBreakpoints",null);f([y],dn.prototype,"enableOrDisableBreakpoints",null);f([y],dn.prototype,"setBreakpointsActivated",null);f([y],dn.prototype,"removeBreakpoints",null);f([y],dn.prototype,"addFunctionBreakpoint",null);f([y],dn.prototype,"updateFunctionBreakpoint",null);f([y],dn.prototype,"removeFunctionBreakpoints",null);f([y],dn.prototype,"addDataBreakpoint",null);f([y],dn.prototype,"removeDataBreakpoints",null);f([y],dn.prototype,"addInstructionBreakpoint",null);f([y],dn.prototype,"removeInstructionBreakpoints",null);f([y],dn.prototype,"setExceptionBreakpointCondition",null);f([y],dn.prototype,"setExceptionBreakpointsForSession",null);f([y],dn.prototype,"sendAllBreakpoints",null);f([y],dn.prototype,"addWatchExpression",null);f([y],dn.prototype,"renameWatchExpression",null);f([y],dn.prototype,"moveWatchExpression",null);f([y],dn.prototype,"removeWatchExpressions",null);f([y],dn.prototype,"startDebugging",null);f([y],dn.prototype,"restartSession",null);f([y],dn.prototype,"stopSession",null);f([y],dn.prototype,"sourceIsNotAvailable",null);f([y],dn.prototype,"runTo",null);G(Mq,dn,z.Eager);class Nw{lookupAuthorization(){b()}lookupKerberosAuthorization(){b()}request(){b()}resolveProxy(){b()}loadCertificates(){b()}}f([y],Nw.prototype,"lookupAuthorization",null);f([y],Nw.prototype,"lookupKerberosAuthorization",null);f([y],Nw.prototype,"request",null);f([y],Nw.prototype,"resolveProxy",null);f([y],Nw.prototype,"loadCertificates",null);G(UM,Nw,z.Eager);let JN=class{constructor(){this.onDidInitiateOpenFilesTrustRequest=T.None,this.onDidInitiateWorkspaceTrustRequest=T.None,this.onDidInitiateWorkspaceTrustRequestOnStartup=T.None,this.requestOpenFilesTrust=async()=>Hd.Open,this.requestWorkspaceTrust=async()=>!0,this.requestWorkspaceTrustOnStartup=()=>null}completeOpenFilesTrustRequest(){b()}cancelWorkspaceTrustRequest(){b()}completeWorkspaceTrustRequest(){b()}};f([y],JN.prototype,"completeOpenFilesTrustRequest",null);f([y],JN.prototype,"cancelWorkspaceTrustRequest",null);f([y],JN.prototype,"completeWorkspaceTrustRequest",null);G(Qie,JN,z.Eager);class iK{constructor(){this.onDidChangeActivity=T.None,this.showViewContainerActivity=()=>F.None,this.showViewActivity=()=>F.None,this.showAccountsActivity=()=>F.None,this.showGlobalActivity=()=>F.None}getViewContainerActivities(){b()}getActivity(){b()}}f([y],iK.prototype,"getViewContainerActivities",null);f([y],iK.prototype,"getActivity",null);G(qv,iK,z.Eager);class Ow{constructor(){this.onReload=T.None,this.onClose=T.None,this.onAttachSession=T.None,this.onTerminateSession=T.None}reload(){b()}close(){b()}attachSession(){b()}terminateSession(){b()}openExtensionDevelopmentHostWindow(){b()}}f([y],Ow.prototype,"reload",null);f([y],Ow.prototype,"close",null);f([y],Ow.prototype,"attachSession",null);f([y],Ow.prototype,"terminateSession",null);f([y],Ow.prototype,"openExtensionDevelopmentHostWindow",null);G(tre,Ow,z.Eager);class Fw{constructor(){this.getFocusedView=()=>null,this.isViewContainerActive=()=>!1,this.onDidChangeFocusedView=T.None,this.onDidChangeViewContainerVisibility=T.None,this.isViewContainerVisible=()=>!1,this.getActiveViewPaneContainerWithId=()=>null,this.onDidChangeViewVisibility=T.None,this.isViewVisible=()=>!1,this.openView=async()=>null,this.getActiveViewWithId=()=>null,this.getViewWithId=()=>null,this.getViewProgressIndicator=()=>{}}getFocusedViewName(){b()}openViewContainer(){b()}closeViewContainer(){b()}getVisibleViewContainer(){b()}closeView(){b()}}f([y],Fw.prototype,"getFocusedViewName",null);f([y],Fw.prototype,"openViewContainer",null);f([y],Fw.prototype,"closeViewContainer",null);f([y],Fw.prototype,"getVisibleViewContainer",null);f([y],Fw.prototype,"closeView",null);G(io,Fw,z.Eager);class Qv{constructor(){this.viewContainers=[],this.onDidChangeViewContainers=T.None,this.getDefaultViewContainer=()=>{},this.getViewContainerById=()=>null,this.getDefaultViewContainerLocation=()=>null,this.getViewContainerLocation=()=>null,this.getViewContainerModel=()=>({onDidChangeAllViewDescriptors:T.None,visibleViewDescriptors:[]}),this.onDidChangeContainerLocation=T.None,this.getViewDescriptorById=()=>null,this.getViewContainerByViewId=()=>null,this.getDefaultContainerById=()=>null,this.getViewLocationById=()=>null,this.onDidChangeContainer=T.None,this.onDidChangeLocation=T.None,this.moveViewToLocation=()=>null,this.reset=()=>null}isViewContainerRemovedPermanently(){b()}getViewContainersByLocation(){b()}moveViewContainerToLocation(){b()}getViewContainerBadgeEnablementState(){b()}setViewContainerBadgeEnablementState(){b()}moveViewsToContainer(){b()}}f([y],Qv.prototype,"isViewContainerRemovedPermanently",null);f([y],Qv.prototype,"getViewContainersByLocation",null);f([y],Qv.prototype,"moveViewContainerToLocation",null);f([y],Qv.prototype,"getViewContainerBadgeEnablementState",null);f([y],Qv.prototype,"setViewContainerBadgeEnablementState",null);f([y],Qv.prototype,"moveViewsToContainer",null);G($s,Qv,z.Eager);class wl{constructor(){this.suspendTracking=()=>({dispose(){}}),this.getHistory=()=>[],this.getLastActiveWorkspaceRoot=()=>{},this.getLastActiveFile=()=>{}}goForward(){b()}goBack(){b()}goPrevious(){b()}goLast(){b()}reopenLastClosedEditor(){b()}removeFromHistory(){b()}openNextRecentlyUsedEditor(){b()}openPreviouslyUsedEditor(){b()}clear(){b()}clearRecentlyOpened(){b()}}f([y],wl.prototype,"goForward",null);f([y],wl.prototype,"goBack",null);f([y],wl.prototype,"goPrevious",null);f([y],wl.prototype,"goLast",null);f([y],wl.prototype,"reopenLastClosedEditor",null);f([y],wl.prototype,"removeFromHistory",null);f([y],wl.prototype,"openNextRecentlyUsedEditor",null);f([y],wl.prototype,"openPreviouslyUsedEditor",null);f([y],wl.prototype,"clear",null);f([y],wl.prototype,"clearRecentlyOpened",null);G(So,wl,z.Eager);class Eo{constructor(){this.onDidChangeTaskProviders=T.None,this.getKnownTasks=async()=>[],this.onDidChangeTaskConfig=T.None,this.onDidStateChange=T.None,this.supportsMultipleTaskExecutions=!1,this.inTerminal=()=>!1,this.getActiveTasks=async()=>[],this.registerTaskSystem=()=>{},this.onDidChangeTaskSystemInfo=T.None,this.hasTaskSystemInfo=!1,this.registerSupportedExecutions=()=>{},this.isReconnected=!1,this.onDidReconnectToTasks=T.None}configureAction(){b()}rerun(){b()}run(){b()}getBusyTasks(){b()}terminate(){b()}tasks(){b()}taskTypes(){b()}getWorkspaceTasks(){b()}getSavedTasks(){b()}removeRecentlyUsedTask(){b()}getTask(){b()}tryResolveTask(){b()}createSorter(){b()}getTaskDescription(){b()}customize(){b()}openConfig(){b()}registerTaskProvider(){b()}extensionCallbackTaskComplete(){b()}}f([y],Eo.prototype,"configureAction",null);f([y],Eo.prototype,"rerun",null);f([y],Eo.prototype,"run",null);f([y],Eo.prototype,"getBusyTasks",null);f([y],Eo.prototype,"terminate",null);f([y],Eo.prototype,"tasks",null);f([y],Eo.prototype,"taskTypes",null);f([y],Eo.prototype,"getWorkspaceTasks",null);f([y],Eo.prototype,"getSavedTasks",null);f([y],Eo.prototype,"removeRecentlyUsedTask",null);f([y],Eo.prototype,"getTask",null);f([y],Eo.prototype,"tryResolveTask",null);f([y],Eo.prototype,"createSorter",null);f([y],Eo.prototype,"getTaskDescription",null);f([y],Eo.prototype,"customize",null);f([y],Eo.prototype,"openConfig",null);f([y],Eo.prototype,"registerTaskProvider",null);f([y],Eo.prototype,"extensionCallbackTaskComplete",null);G(Lre,Eo,z.Eager);class _f{constructor(){this.resolvableVariables=new Set}resolveWithEnvironment(){b()}resolveAsync(){b()}resolveAnyAsync(){b()}resolveAnyMap(){b()}resolveWithInteractionReplace(){b()}resolveWithInteraction(){b()}contributeVariable(){b()}}f([y],_f.prototype,"resolveWithEnvironment",null);f([y],_f.prototype,"resolveAsync",null);f([y],_f.prototype,"resolveAnyAsync",null);f([y],_f.prototype,"resolveAnyMap",null);f([y],_f.prototype,"resolveWithInteractionReplace",null);f([y],_f.prototype,"resolveWithInteraction",null);f([y],_f.prototype,"contributeVariable",null);G(toe,_f,z.Eager);class Fae{constructor(){this.getConnection=()=>null,this.getEnvironment=async()=>null,this.getRawEnvironment=async()=>null,this.getExtensionHostExitInfo=async()=>null,this.getRoundTripTime=async()=>{},this.whenExtensionsReady=async()=>{},this.scanExtensions=async()=>[],this.scanSingleExtension=async()=>null,this.getDiagnosticInfo=async()=>{},this.updateTelemetryLevel=async()=>{},this.logTelemetry=async()=>{},this.flushTelemetry=async()=>{}}endConnection(){b()}}f([y],Fae.prototype,"endConnection",null);G(Lh,Fae,z.Eager);G(xme,Eme,z.Eager);let Dy=class{constructor(e){this.modelService=e,this.schemeHasFileSearchProvider=()=>!1,this.getAIName=async()=>{}}aiTextSearch(){b()}textSearchSplitSyncAsync(){b()}async textSearch(){return{results:[],messages:[]}}async fileSearch(){return{results:this.modelService.getModels().map(e=>({resource:e.uri})),messages:[]}}async clearCache(){}registerSearchResultProvider(){b()}};f([y],Dy.prototype,"aiTextSearch",null);f([y],Dy.prototype,"textSearchSplitSyncAsync",null);f([y],Dy.prototype,"registerSearchResultProvider",null);Dy=f([p(0,ci)],Dy);G(kI,Dy,z.Eager);class YDe{constructor(){this.registerEditSessionIdentityProvider=()=>F.None,this.getEditSessionIdentifier=async()=>{},this.provideEditSessionIdentityMatch=async()=>{},this.addEditSessionIdentityCreateParticipant=()=>F.None,this.onWillCreateEditSessionIdentity=async()=>{}}}G(Eq,YDe,z.Eager);class fg{addFolders(){b()}removeFolders(){b()}updateFolders(){b()}enterWorkspace(){b()}createAndEnterWorkspace(){b()}saveAndEnterWorkspace(){b()}copyWorkspaceSettings(){b()}pickNewWorkspacePath(){b()}}f([y],fg.prototype,"addFolders",null);f([y],fg.prototype,"removeFolders",null);f([y],fg.prototype,"updateFolders",null);f([y],fg.prototype,"enterWorkspace",null);f([y],fg.prototype,"createAndEnterWorkspace",null);f([y],fg.prototype,"saveAndEnterWorkspace",null);f([y],fg.prototype,"copyWorkspaceSettings",null);f([y],fg.prototype,"pickNewWorkspacePath",null);G(uc,fg,z.Eager);class Xv{constructor(){this.setPerformanceMarks=()=>{}}getStartTime(){b()}whenReady(){b()}get perfBaseline(){return b()}get startupMetrics(){return b()}getPerformanceMarks(){b()}getDuration(){b()}}f([y],Xv.prototype,"getStartTime",null);f([y],Xv.prototype,"whenReady",null);f([y],Xv.prototype,"perfBaseline",null);f([y],Xv.prototype,"startupMetrics",null);f([y],Xv.prototype,"getPerformanceMarks",null);f([y],Xv.prototype,"getDuration",null);G(tae,Xv,z.Eager);class sn{constructor(){this.getExtensionRuntimeStatus=()=>{},this.onDidChangeExtensionsNotification=T.None,this.getExtensionsNotification=()=>{},this.shouldRequireConsentToUpdate=async()=>{},this.whenInitialized=Promise.resolve(),this.onChange=T.None,this.onReset=T.None,this.preferPreReleases=!1,this.local=[],this.installed=[],this.outdated=[]}downloadVSIX(){b()}updateAutoUpdateForAllExtensions(){b()}openSearch(){b()}updateAutoUpdateValue(){b()}getResourceExtensions(){b()}updateRunningExtensions(){b()}togglePreRelease(){b()}isAutoUpdateEnabledFor(){b()}updateAutoUpdateEnablementFor(){b()}isAutoUpdateEnabled(){b()}getAutoUpdateValue(){b()}updateAll(){b()}toggleApplyExtensionToAllProfiles(){b()}queryLocal(){b()}queryGallery(){b()}getExtensions(){b()}canInstall(){b()}install(){b()}installInServer(){b()}uninstall(){b()}installVersion(){b()}reinstall(){b()}canSetLanguage(){b()}setLanguage(){b()}setEnablement(){b()}pinExtension(){b()}open(){b()}checkForUpdates(){b()}getExtensionStatus(){b()}isExtensionIgnoredToSync(){b()}toggleExtensionIgnoredToSync(){b()}}f([y],sn.prototype,"downloadVSIX",null);f([y],sn.prototype,"updateAutoUpdateForAllExtensions",null);f([y],sn.prototype,"openSearch",null);f([y],sn.prototype,"updateAutoUpdateValue",null);f([y],sn.prototype,"getResourceExtensions",null);f([y],sn.prototype,"updateRunningExtensions",null);f([y],sn.prototype,"togglePreRelease",null);f([y],sn.prototype,"isAutoUpdateEnabledFor",null);f([y],sn.prototype,"updateAutoUpdateEnablementFor",null);f([y],sn.prototype,"isAutoUpdateEnabled",null);f([y],sn.prototype,"getAutoUpdateValue",null);f([y],sn.prototype,"updateAll",null);f([y],sn.prototype,"toggleApplyExtensionToAllProfiles",null);f([y],sn.prototype,"queryLocal",null);f([y],sn.prototype,"queryGallery",null);f([y],sn.prototype,"getExtensions",null);f([y],sn.prototype,"canInstall",null);f([y],sn.prototype,"install",null);f([y],sn.prototype,"installInServer",null);f([y],sn.prototype,"uninstall",null);f([y],sn.prototype,"installVersion",null);f([y],sn.prototype,"reinstall",null);f([y],sn.prototype,"canSetLanguage",null);f([y],sn.prototype,"setLanguage",null);f([y],sn.prototype,"setEnablement",null);f([y],sn.prototype,"pinExtension",null);f([y],sn.prototype,"open",null);f([y],sn.prototype,"checkForUpdates",null);f([y],sn.prototype,"getExtensionStatus",null);f([y],sn.prototype,"isExtensionIgnoredToSync",null);f([y],sn.prototype,"toggleExtensionIgnoredToSync",null);G(Aw,sn,z.Eager);class nK{constructor(){this._serviceBrand=void 0,this.localExtensionManagementServer=null,this.remoteExtensionManagementServer=null,this.webExtensionManagementServer=null}getExtensionManagementServer(){b()}getExtensionInstallLocation(){b()}}f([y],nK.prototype,"getExtensionManagementServer",null);f([y],nK.prototype,"getExtensionInstallLocation",null);G(Xre,nK,z.Eager);class QDe{constructor(){this.onDidChangeRecommendations=T.None,this.getAllRecommendationsWithReason=()=>({}),this.getImportantRecommendations=async()=>[],this.getOtherRecommendations=async()=>[],this.getFileBasedRecommendations=()=>[],this.getExeBasedRecommendations=async()=>({important:[],others:[]}),this.getConfigBasedRecommendations=async()=>({important:[],others:[]}),this.getWorkspaceRecommendations=async()=>[],this.getKeymapRecommendations=()=>[],this.getLanguageRecommendations=()=>[],this.getRemoteRecommendations=()=>[]}}G(SIe,QDe,z.Eager);class eO{constructor(){this.onError=T.None}turnOn(){b()}turnOff(){b()}triggerSync(){b()}}f([y],eO.prototype,"turnOn",null);f([y],eO.prototype,"turnOff",null);f([y],eO.prototype,"triggerSync",null);G(GEe,eO,z.Eager);class sK{constructor(){this.getIgnoredExtensions=()=>[],this.hasToNeverSyncExtension=()=>!1,this.hasToAlwaysSyncExtension=()=>!1}updateIgnoredExtensions(){b()}updateSynchronizedExtensions(){b()}}f([y],sK.prototype,"updateIgnoredExtensions",null);f([y],sK.prototype,"updateSynchronizedExtensions",null);G(FEe,sK,z.Eager);class oK{constructor(){this.ignoredRecommendations=[],this.hasToIgnoreRecommendationNotifications=()=>!1}promptImportantExtensionsInstallNotification(){b()}promptWorkspaceRecommendations(){b()}}f([y],oK.prototype,"promptImportantExtensionsInstallNotification",null);f([y],oK.prototype,"promptWorkspaceRecommendations",null);G(DEe,oK,z.Eager);class tO{constructor(){this.scanSystemExtensions=async()=>[],this.scanUserExtensions=async()=>[],this.scanExtensionsUnderDevelopment=async()=>[],this.scanExistingExtension=async()=>null,this.removeExtension=async()=>{},this.copyExtensions=async()=>{},this.scanExtensionManifest=async()=>null}addExtension(){b()}addExtensionFromGallery(){b()}updateMetadata(){b()}}f([y],tO.prototype,"addExtension",null);f([y],tO.prototype,"addExtensionFromGallery",null);f([y],tO.prototype,"updateMetadata",null);G(Hq,tO,z.Eager);class Wr{constructor(){this.onDidChangeCache=T.None}get systemExtensionsLocation(){return b()}get userExtensionsLocation(){return b()}getTargetPlatform(){b()}scanAllExtensions(){b()}scanSystemExtensions(){b()}scanUserExtensions(){b()}scanExtensionsUnderDevelopment(){b()}scanExistingExtension(){b()}scanOneOrMultipleExtensions(){b()}scanMultipleExtensions(){b()}scanAllUserExtensions(){b()}scanMetadata(){b()}updateMetadata(){b()}initializeDefaultProfileExtensions(){b()}updateManifestMetadata(){b()}}f([y],Wr.prototype,"systemExtensionsLocation",null);f([y],Wr.prototype,"userExtensionsLocation",null);f([y],Wr.prototype,"getTargetPlatform",null);f([y],Wr.prototype,"scanAllExtensions",null);f([y],Wr.prototype,"scanSystemExtensions",null);f([y],Wr.prototype,"scanUserExtensions",null);f([y],Wr.prototype,"scanExtensionsUnderDevelopment",null);f([y],Wr.prototype,"scanExistingExtension",null);f([y],Wr.prototype,"scanOneOrMultipleExtensions",null);f([y],Wr.prototype,"scanMultipleExtensions",null);f([y],Wr.prototype,"scanAllUserExtensions",null);f([y],Wr.prototype,"scanMetadata",null);f([y],Wr.prototype,"updateMetadata",null);f([y],Wr.prototype,"initializeDefaultProfileExtensions",null);f([y],Wr.prototype,"updateManifestMetadata",null);G(IEe,Wr,z.Eager);class Ww{constructor(){this.onAddExtensions=T.None,this.onDidAddExtensions=T.None,this.onRemoveExtensions=T.None,this.onDidRemoveExtensions=T.None}scanProfileExtensions(){b()}addExtensionsToProfile(){b()}updateMetadata(){b()}removeExtensionFromProfile(){b()}removeExtensionsFromProfile(){b()}}f([y],Ww.prototype,"scanProfileExtensions",null);f([y],Ww.prototype,"addExtensionsToProfile",null);f([y],Ww.prototype,"updateMetadata",null);f([y],Ww.prototype,"removeExtensionFromProfile",null);f([y],Ww.prototype,"removeExtensionsFromProfile",null);G(IN,Ww,z.Eager);class Wae{constructor(){this.onDidChangeIgnoredRecommendations=T.None,this.ignoredRecommendations=[],this.onDidChangeGlobalIgnoredRecommendation=T.None,this.globalIgnoredRecommendations=[]}toggleGlobalIgnoredRecommendation(){b()}}f([y],Wae.prototype,"toggleGlobalIgnoredRecommendation",null);G(CIe,Wae,z.Eager);class Bw{constructor(){this.onDidChangeExtensionsConfigs=T.None}getExtensionsConfigs(){b()}getRecommendations(){b()}getUnwantedRecommendations(){b()}toggleRecommendation(){b()}toggleUnwantedRecommendation(){b()}}f([y],Bw.prototype,"getExtensionsConfigs",null);f([y],Bw.prototype,"getRecommendations",null);f([y],Bw.prototype,"getUnwantedRecommendations",null);f([y],Bw.prototype,"toggleRecommendation",null);f([y],Bw.prototype,"toggleUnwantedRecommendation",null);G(EIe,Bw,z.Eager);class rK{constructor(){this.getEnablementStates=e=>e.map(()=>gu.EnabledGlobally),this.onEnablementChanged=T.None,this.getEnablementState=()=>gu.EnabledGlobally,this.getDependenciesEnablementStates=()=>[],this.canChangeEnablement=()=>!1,this.canChangeWorkspaceEnablement=()=>!1,this.isEnabled=()=>!0,this.isEnabledEnablementState=()=>!0,this.isDisabledGlobally=()=>!1}setEnablement(){b()}updateExtensionsEnablementsWhenWorkspaceTrustChanges(){b()}}f([y],rK.prototype,"setEnablement",null);f([y],rK.prototype,"updateExtensionsEnablementsWhenWorkspaceTrustChanges",null);G(gd,rK,z.Eager);class Vw{constructor(){this.canChangeProtocol=!1,this.tunnels=Promise.resolve([]),this.canChangePrivacy=!1,this.privacyOptions=[],this.onTunnelOpened=T.None,this.onTunnelClosed=T.None,this.canElevate=!1,this.hasTunnelProvider=!1,this.onAddedTunnelProvider=T.None,this.canTunnel=()=>!1,this.getExistingTunnel=async()=>{},this.isPortPrivileged=()=>!1}openTunnel(){b()}setEnvironmentTunnel(){b()}closeTunnel(){b()}setTunnelProvider(){b()}setTunnelFeatures(){b()}}f([y],Vw.prototype,"openTunnel",null);f([y],Vw.prototype,"setEnvironmentTunnel",null);f([y],Vw.prototype,"closeTunnel",null);f([y],Vw.prototype,"setTunnelProvider",null);f([y],Vw.prototype,"setTunnelFeatures",null);G(TN,Vw,z.Eager);class mg{constructor(){this.onDidChangeAutoSaveConfiguration=T.None,this.onDidChangeAutoSaveDisabled=T.None,this.hasShortAutoSaveDelay=()=>!1,this.onDidChangeReadonly=T.None,this.onDidChangeFilesAssociation=T.None,this.onAutoSaveConfigurationChange=T.None,this.onReadonlyChange=T.None,this.onFilesAssociationChange=T.None,this.isHotExitEnabled=!0,this.hotExitConfiguration=void 0}disableAutoSave(){b()}enableAutoSaveAfterShortDelay(){b()}getAutoSaveConfiguration(){b()}getAutoSaveMode(){b()}toggleAutoSave(){b()}isReadonly(){b()}updateReadonly(){b()}preventSaveConflicts(){b()}}f([y],mg.prototype,"disableAutoSave",null);f([y],mg.prototype,"enableAutoSaveAfterShortDelay",null);f([y],mg.prototype,"getAutoSaveConfiguration",null);f([y],mg.prototype,"getAutoSaveMode",null);f([y],mg.prototype,"toggleAutoSave",null);f([y],mg.prototype,"isReadonly",null);f([y],mg.prototype,"updateReadonly",null);f([y],mg.prototype,"preventSaveConflicts",null);G(Us,mg,z.Eager);class aK{constructor(){this.onDidSave=T.None,this.onDidCreate=T.None,this.canDispose=()=>!0,this.isUntitledWithAssociatedResource=()=>!1,this.onDidChangeDirty=T.None,this.onDidChangeEncoding=T.None,this.onDidChangeLabel=T.None,this.onWillDispose=T.None,this.get=()=>{},this.getValue=()=>{}}create(){b()}resolve(){b()}}f([y],aK.prototype,"create",null);f([y],aK.prototype,"resolve",null);G(aq,aK,z.Eager);class XDe{async hasBackups(){return!1}hasBackupSync(){return!1}async getBackups(){return[]}async resolve(){}async backup(){}async discardBackup(){}async discardBackups(){}}G(cq,XDe,z.Eager);class ZDe{constructor(){this.onDidRegister=T.None,this.onDidUnregister=T.None,this.onDidChangeDirty=T.None,this.onDidChangeContent=T.None,this.onDidSave=T.None,this.dirtyCount=0,this.dirtyWorkingCopies=[],this.modifiedCount=0,this.modifiedWorkingCopies=[],this.hasDirty=!1,this.isDirty=()=>!1,this.workingCopies=[],this.has=()=>!1,this.get=()=>{},this.getAll=()=>{}}registerWorkingCopy(){return F.None}}G(lg,ZDe,z.Eager);class Bae{constructor(){this.onDidChangeDecorations=T.None,this.getDecoration=()=>{}}registerDecorationsProvider(){b()}}f([y],Bae.prototype,"registerDecorationsProvider",null);G(Pv,Bae,z.Eager);class Vae{constructor(){this.isSupported=()=>!1}writeFileElevated(){b()}}f([y],Vae.prototype,"writeFileElevated",null);G(ioe,Vae,z.Eager);class yc{preferredHome(){b()}defaultFilePath(){b()}defaultFolderPath(){b()}defaultWorkspacePath(){b()}pickFileFolderAndOpen(){b()}pickFileAndOpen(){b()}pickFolderAndOpen(){b()}pickWorkspaceAndOpen(){b()}pickFileToSave(){b()}showSaveDialog(){b()}showSaveConfirm(){b()}showOpenDialog(){b()}}f([y],yc.prototype,"preferredHome",null);f([y],yc.prototype,"defaultFilePath",null);f([y],yc.prototype,"defaultFolderPath",null);f([y],yc.prototype,"defaultWorkspacePath",null);f([y],yc.prototype,"pickFileFolderAndOpen",null);f([y],yc.prototype,"pickFileAndOpen",null);f([y],yc.prototype,"pickFolderAndOpen",null);f([y],yc.prototype,"pickWorkspaceAndOpen",null);f([y],yc.prototype,"pickFileToSave",null);f([y],yc.prototype,"showSaveDialog",null);f([y],yc.prototype,"showSaveConfirm",null);f([y],yc.prototype,"showOpenDialog",null);G(to,yc,z.Eager);class Hae{write(){b()}}f([y],Hae.prototype,"write",null);G(Xie,Hae,z.Delayed);class $h{constructor(){this.onDidChangeRecentlyOpened=T.None}enterWorkspace(){b()}createUntitledWorkspace(){b()}deleteUntitledWorkspace(){b()}getWorkspaceIdentifier(){b()}addRecentlyOpened(){b()}removeRecentlyOpened(){b()}clearRecentlyOpened(){b()}getRecentlyOpened(){b()}getDirtyWorkspaces(){b()}}f([y],$h.prototype,"enterWorkspace",null);f([y],$h.prototype,"createUntitledWorkspace",null);f([y],$h.prototype,"deleteUntitledWorkspace",null);f([y],$h.prototype,"getWorkspaceIdentifier",null);f([y],$h.prototype,"addRecentlyOpened",null);f([y],$h.prototype,"removeRecentlyOpened",null);f([y],$h.prototype,"clearRecentlyOpened",null);f([y],$h.prototype,"getRecentlyOpened",null);f([y],$h.prototype,"getDirtyWorkspaces",null);G(Nh,$h,z.Delayed);class cK{createTextEditor(){b()}resolveTextEditor(){b()}}f([y],cK.prototype,"createTextEditor",null);f([y],cK.prototype,"resolveTextEditor",null);G($Ie,cK,z.Eager);class Hw{constructor(){this.onDidChangeEditorRegistrations=T.None,this.getEditors=()=>[]}getAllUserAssociations(){b()}getAssociationsForResource(){b()}updateUserAssociations(){b()}bufferChangeEvents(){b()}registerEditor(){return{dispose:()=>{}}}resolveEditor(){b()}}f([y],Hw.prototype,"getAllUserAssociations",null);f([y],Hw.prototype,"getAssociationsForResource",null);f([y],Hw.prototype,"updateUserAssociations",null);f([y],Hw.prototype,"bufferChangeEvents",null);f([y],Hw.prototype,"resolveEditor",null);G(mf,Hw,z.Eager);class iO{constructor(){this.canSetLogLevel=()=>!1,this.getLogLevel=()=>{},this.setLogLevel=()=>{},this.onActiveOutputChannel=T.None}get filters(){return b()}getChannel(){}registerCompoundLogChannel(){b()}saveOutputAs(){b()}getChannelDescriptor(){}getChannelDescriptors(){return[]}getActiveChannel(){}async showChannel(){}}f([y],iO.prototype,"filters",null);f([y],iO.prototype,"registerCompoundLogChannel",null);f([y],iO.prototype,"saveOutputAs",null);G(BN,iO,z.Delayed);let dK=class{constructor(){this.supportsExtensionGalleryResources=async()=>!1,this.isExtensionGalleryResource=async()=>!1}readExtensionResource(){b()}getExtensionGalleryResourceURL(){b()}};f([y],dK.prototype,"readExtensionResource",null);f([y],dK.prototype,"getExtensionGalleryResourceURL",null);G(Sq,dK,z.Eager);class JDe{scanBuiltinExtensions(){return Promise.resolve([])}}G(kEe,JDe,z.Eager);class Br{constructor(){this.roots=[]}get sortOrderConfiguration(){return b()}getContext(){b()}hasViewFocus(){b()}setEditable(){b()}getEditable(){b()}getEditableData(){b()}isEditable(){b()}findClosest(){b()}findClosestRoot(){b()}refresh(){b()}setToCopy(){b()}isCut(){b()}applyBulkEdit(){b()}select(){b()}registerView(){b()}}f([y],Br.prototype,"sortOrderConfiguration",null);f([y],Br.prototype,"getContext",null);f([y],Br.prototype,"hasViewFocus",null);f([y],Br.prototype,"setEditable",null);f([y],Br.prototype,"getEditable",null);f([y],Br.prototype,"getEditableData",null);f([y],Br.prototype,"isEditable",null);f([y],Br.prototype,"findClosest",null);f([y],Br.prototype,"findClosestRoot",null);f([y],Br.prototype,"refresh",null);f([y],Br.prototype,"setToCopy",null);f([y],Br.prototype,"isCut",null);f([y],Br.prototype,"applyBulkEdit",null);f([y],Br.prototype,"select",null);f([y],Br.prototype,"registerView",null);G(Zi,Br,z.Delayed);class nO{constructor(){this.getExtensionState=()=>{},this.getExtensionStateRaw=()=>{},this.onDidChangeExtensionStorageToSync=T.None,this.getKeysForSync=()=>{},this.getSourceExtensionToMigrate=()=>{}}setExtensionState(){b()}setKeysForSync(){b()}addToMigrationList(){b()}}f([y],nO.prototype,"setExtensionState",null);f([y],nO.prototype,"setKeysForSync",null);f([y],nO.prototype,"addToMigrationList",null);G(wq,nO,z.Delayed);class eke{constructor(){this.onDidChangeEnablement=T.None}getDisabledExtensions(){return[]}enableExtension(){return Promise.resolve(!0)}disableExtension(){return Promise.resolve(!0)}}G(ire,eke,z.Delayed);class tke{async getAvailableLanguages(){return[]}async getInstalledLanguages(){return[]}async getBuiltInExtensionTranslationsUri(e,t){const i=nae(t)?.[e];return i!=null?R.parse(i):void 0}}G(nre,tke,z.Delayed);class lK{removeDragOperationTransfer(){b()}addDragOperationTransfer(){b()}}f([y],lK.prototype,"removeDragOperationTransfer",null);f([y],lK.prototype,"addDragOperationTransfer",null);G(kz,lK,z.Delayed);let Uae=class{constructor(){this.getWidget=()=>{}}register(){b()}};f([y],Uae.prototype,"register",null);G(Bh,Uae,z.Eager);class $ae{constructor(){this.onDidChange=T.None,this.canCreateOutline=()=>!1,this.createOutline=async()=>{}}registerOutlineCreator(){b()}}f([y],$ae.prototype,"registerOutlineCreator",null);G($q,$ae,z.Eager);class Uw{constructor(){this.onStateChange=T.None,this.state=NEe.Uninitialized,this.isLatestVersion=async()=>!0}checkForUpdates(){b()}downloadUpdate(){b()}applyUpdate(){b()}quitAndInstall(){b()}_applySpecificUpdate(){b()}}f([y],Uw.prototype,"checkForUpdates",null);f([y],Uw.prototype,"downloadUpdate",null);f([y],Uw.prototype,"applyUpdate",null);f([y],Uw.prototype,"quitAndInstall",null);f([y],Uw.prototype,"_applySpecificUpdate",null);G(ore,Uw,z.Eager);class $w{constructor(){this.onDidChangeEntryVisibility=T.None,this.addEntry=()=>({dispose:()=>{},update:()=>{}}),this.isEntryVisible=()=>!1,this.updateEntryVisibility=()=>{},this.focus=()=>{},this.focusNextEntry=()=>{},this.focusPreviousEntry=()=>{},this.isEntryFocused=()=>!1,this.overrideStyle=()=>F.None}overrideEntry(){b()}getPart(){b()}createAuxiliaryStatusbarPart(){b()}createScoped(){b()}dispose(){b()}}f([y],$w.prototype,"overrideEntry",null);f([y],$w.prototype,"getPart",null);f([y],$w.prototype,"createAuxiliaryStatusbarPart",null);f([y],$w.prototype,"createScoped",null);f([y],$w.prototype,"dispose",null);G(AN,$w,z.Eager);class Pa{constructor(){this.isEnabled=()=>!1}query(){b()}getExtensions(){b()}isExtensionCompatible(){b()}getCompatibleExtension(){b()}getAllCompatibleVersions(){b()}download(){b()}downloadSignatureArchive(){b()}reportStatistic(){b()}getReadme(){b()}getManifest(){b()}getChangelog(){b()}getCoreTranslation(){b()}getExtensionsControlManifest(){b()}}f([y],Pa.prototype,"query",null);f([y],Pa.prototype,"getExtensions",null);f([y],Pa.prototype,"isExtensionCompatible",null);f([y],Pa.prototype,"getCompatibleExtension",null);f([y],Pa.prototype,"getAllCompatibleVersions",null);f([y],Pa.prototype,"download",null);f([y],Pa.prototype,"downloadSignatureArchive",null);f([y],Pa.prototype,"reportStatistic",null);f([y],Pa.prototype,"getReadme",null);f([y],Pa.prototype,"getManifest",null);f([y],Pa.prototype,"getChangelog",null);f([y],Pa.prototype,"getCoreTranslation",null);f([y],Pa.prototype,"getExtensionsControlManifest",null);G(yq,Pa,z.Eager);class Ki{constructor(){this.onAnyInstanceAddedCapabilityType=T.None,this.onAnyInstanceShellTypeChanged=T.None,this.onAnyInstanceData=T.None,this.detachedInstances=[],this.onAnyInstanceDataInput=T.None,this.onAnyInstanceIconChange=T.None,this.onAnyInstanceMaximumDimensionsChange=T.None,this.onAnyInstancePrimaryStatusChange=T.None,this.onAnyInstanceProcessIdReady=T.None,this.onAnyInstanceSelectionChange=T.None,this.onAnyInstanceTitleChange=T.None,this.onDidChangeSelection=T.None,this.detachedXterms=[],this.whenConnected=Promise.resolve(),this.restoredGroupCount=0,this.instances=[],this.isProcessSupportRegistered=!1,this.connectionState=oB.Connected,this.defaultLocation=wy.Panel,this.onDidChangeActiveGroup=T.None,this.onDidDisposeGroup=T.None,this.onDidCreateInstance=T.None,this.onDidReceiveProcessId=T.None,this.onDidChangeInstanceDimensions=T.None,this.onDidMaximumDimensionsChange=T.None,this.onDidRequestStartExtensionTerminal=T.None,this.onDidChangeInstanceTitle=T.None,this.onDidChangeInstanceIcon=T.None,this.onDidChangeInstanceColor=T.None,this.onDidChangeInstancePrimaryStatus=T.None,this.onDidInputInstanceData=T.None,this.onDidRegisterProcessSupport=T.None,this.onDidChangeConnectionState=T.None,this.getReconnectedTerminals=()=>{},this.registerProcessSupport=()=>{},this.activeInstance=void 0,this.onDidDisposeInstance=T.None,this.onDidFocusInstance=T.None,this.onDidChangeActiveInstance=T.None,this.onDidChangeInstances=T.None,this.onDidChangeInstanceCapability=T.None}revealTerminal(){b()}focusInstance(){b()}createOnInstanceCapabilityEvent(){return{event:T.None,dispose(){}}}moveIntoNewEditor(){b()}createOnInstanceEvent(e){return new Ame(this.instances,this.onDidCreateInstance,this.onDidDisposeInstance,e)}createDetachedTerminal(){b()}createDetachedXterm(){b()}get configHelper(){return b()}revealActiveTerminal(){b()}createTerminal(){b()}getInstanceFromId(){b()}getInstanceFromIndex(){b()}getActiveOrCreateInstance(){b()}moveToEditor(){b()}moveToTerminalView(){b()}getPrimaryBackend(){b()}refreshActiveGroup(){b()}showProfileQuickPick(){b()}setContainers(){b()}requestStartExtensionTerminal(){b()}isAttachedToTerminal(){b()}getEditableData(){b()}setEditable(){b()}isEditable(){b()}safeDisposeTerminal(){b()}getDefaultInstanceHost(){b()}getInstanceHost(){b()}resolveLocation(){b()}setNativeDelegate(){b()}toggleEscapeSequenceLogging(){b()}getEditingTerminal(){b()}setEditingTerminal(){b()}setActiveInstance(){b()}focusActiveInstance(){b()}getInstanceFromResource(){b()}}f([y],Ki.prototype,"revealTerminal",null);f([y],Ki.prototype,"focusInstance",null);f([y],Ki.prototype,"moveIntoNewEditor",null);f([y],Ki.prototype,"createDetachedTerminal",null);f([y],Ki.prototype,"createDetachedXterm",null);f([y],Ki.prototype,"configHelper",null);f([y],Ki.prototype,"revealActiveTerminal",null);f([y],Ki.prototype,"createTerminal",null);f([y],Ki.prototype,"getInstanceFromId",null);f([y],Ki.prototype,"getInstanceFromIndex",null);f([y],Ki.prototype,"getActiveOrCreateInstance",null);f([y],Ki.prototype,"moveToEditor",null);f([y],Ki.prototype,"moveToTerminalView",null);f([y],Ki.prototype,"getPrimaryBackend",null);f([y],Ki.prototype,"refreshActiveGroup",null);f([y],Ki.prototype,"showProfileQuickPick",null);f([y],Ki.prototype,"setContainers",null);f([y],Ki.prototype,"requestStartExtensionTerminal",null);f([y],Ki.prototype,"isAttachedToTerminal",null);f([y],Ki.prototype,"getEditableData",null);f([y],Ki.prototype,"setEditable",null);f([y],Ki.prototype,"isEditable",null);f([y],Ki.prototype,"safeDisposeTerminal",null);f([y],Ki.prototype,"getDefaultInstanceHost",null);f([y],Ki.prototype,"getInstanceHost",null);f([y],Ki.prototype,"resolveLocation",null);f([y],Ki.prototype,"setNativeDelegate",null);f([y],Ki.prototype,"toggleEscapeSequenceLogging",null);f([y],Ki.prototype,"getEditingTerminal",null);f([y],Ki.prototype,"setEditingTerminal",null);f([y],Ki.prototype,"setActiveInstance",null);f([y],Ki.prototype,"focusActiveInstance",null);f([y],Ki.prototype,"getInstanceFromResource",null);G(Rw,Ki,z.Delayed);class FI{constructor(){this.onConfigChanged=T.None}get config(){return b()}setPanelContainer(){b()}configFontIsMonospace(){b()}getFont(){b()}}f([y],FI.prototype,"config",null);f([y],FI.prototype,"setPanelContainer",null);f([y],FI.prototype,"configFontIsMonospace",null);f([y],FI.prototype,"getFont",null);G(dIe,FI,z.Delayed);class wc{constructor(){this.instances=[],this.activeInstance=void 0,this.onDidDisposeInstance=T.None,this.onDidFocusInstance=T.None,this.onDidChangeActiveInstance=T.None,this.onDidChangeInstances=T.None,this.onDidChangeInstanceCapability=T.None}focusInstance(){b()}openEditor(){b()}detachActiveEditorInstance(){b()}detachInstance(){b()}splitInstance(){b()}revealActiveEditor(){b()}resolveResource(){b()}reviveInput(){b()}getInputFromResource(){b()}setActiveInstance(){b()}focusActiveInstance(){b()}getInstanceFromResource(){b()}}f([y],wc.prototype,"focusInstance",null);f([y],wc.prototype,"openEditor",null);f([y],wc.prototype,"detachActiveEditorInstance",null);f([y],wc.prototype,"detachInstance",null);f([y],wc.prototype,"splitInstance",null);f([y],wc.prototype,"revealActiveEditor",null);f([y],wc.prototype,"resolveResource",null);f([y],wc.prototype,"reviveInput",null);f([y],wc.prototype,"getInputFromResource",null);f([y],wc.prototype,"setActiveInstance",null);f([y],wc.prototype,"focusActiveInstance",null);f([y],wc.prototype,"getInstanceFromResource",null);G(Mre,wc,z.Delayed);class es{constructor(){this.lastAccessedMenu="inline-tab",this.instances=[],this.groups=[],this.activeGroup=void 0,this.activeGroupIndex=0,this.onDidChangeActiveGroup=T.None,this.onDidDisposeGroup=T.None,this.onDidChangeGroups=T.None,this.onDidShow=T.None,this.onDidChangePanelOrientation=T.None,this.onDidDisposeInstance=T.None,this.onDidFocusInstance=T.None,this.onDidChangeActiveInstance=T.None,this.onDidChangeInstances=T.None,this.onDidChangeInstanceCapability=T.None}focusInstance(){b()}createGroup(){b()}getGroupForInstance(){b()}moveGroup(){b()}moveGroupToEnd(){b()}moveInstance(){b()}unsplitInstance(){b()}joinInstances(){b()}instanceIsSplit(){b()}getGroupLabels(){b()}setActiveGroupByIndex(){b()}setActiveGroupToNext(){b()}setActiveGroupToPrevious(){b()}setActiveInstanceByIndex(){b()}setContainer(){b()}showPanel(){b()}hidePanel(){b()}focusTabs(){b()}focusHover(){b()}showTabs(){b()}updateVisibility(){b()}setActiveInstance(){b()}focusActiveInstance(){b()}getInstanceFromResource(){b()}}f([y],es.prototype,"focusInstance",null);f([y],es.prototype,"createGroup",null);f([y],es.prototype,"getGroupForInstance",null);f([y],es.prototype,"moveGroup",null);f([y],es.prototype,"moveGroupToEnd",null);f([y],es.prototype,"moveInstance",null);f([y],es.prototype,"unsplitInstance",null);f([y],es.prototype,"joinInstances",null);f([y],es.prototype,"instanceIsSplit",null);f([y],es.prototype,"getGroupLabels",null);f([y],es.prototype,"setActiveGroupByIndex",null);f([y],es.prototype,"setActiveGroupToNext",null);f([y],es.prototype,"setActiveGroupToPrevious",null);f([y],es.prototype,"setActiveInstanceByIndex",null);f([y],es.prototype,"setContainer",null);f([y],es.prototype,"showPanel",null);f([y],es.prototype,"hidePanel",null);f([y],es.prototype,"focusTabs",null);f([y],es.prototype,"focusHover",null);f([y],es.prototype,"showTabs",null);f([y],es.prototype,"updateVisibility",null);f([y],es.prototype,"setActiveInstance",null);f([y],es.prototype,"focusActiveInstance",null);f([y],es.prototype,"getInstanceFromResource",null);G(Wq,es,z.Delayed);class WI{constructor(){this.onDidRegisterBackend=T.None,this.getRegisteredBackends=()=>[].values(),this.onDidCreateInstance=T.None}convertProfileToShellLaunchConfig(){b()}createInstance(){b()}getBackend(){b()}didRegisterBackend(){b()}}f([y],WI.prototype,"convertProfileToShellLaunchConfig",null);f([y],WI.prototype,"createInstance",null);f([y],WI.prototype,"getBackend",null);f([y],WI.prototype,"didRegisterBackend",null);G(Nre,WI,z.Delayed);class Zv{constructor(){this.availableProfiles=[],this.contributedProfiles=[],this.profilesReady=Promise.resolve(),this.getDefaultProfileName=()=>{},this.getDefaultProfile=()=>{},this.onDidChangeAvailableProfiles=T.None}getPlatformKey(){b()}refreshAvailableProfiles(){b()}getContributedDefaultProfile(){b()}registerContributedProfile(){b()}getContributedProfileProvider(){b()}registerTerminalProfileProvider(){b()}}f([y],Zv.prototype,"getPlatformKey",null);f([y],Zv.prototype,"refreshAvailableProfiles",null);f([y],Zv.prototype,"getContributedDefaultProfile",null);f([y],Zv.prototype,"registerContributedProfile",null);f([y],Zv.prototype,"getContributedProfileProvider",null);f([y],Zv.prototype,"registerTerminalProfileProvider",null);G(Wre,Zv,z.Delayed);class Gh{constructor(){this.onDidChangeLogLevel=T.None}getLevel(){b()}setLevel(){b()}trace(){b()}debug(){b()}info(){b()}warn(){b()}error(){b()}flush(){b()}dispose(){b()}}f([y],Gh.prototype,"getLevel",null);f([y],Gh.prototype,"setLevel",null);f([y],Gh.prototype,"trace",null);f([y],Gh.prototype,"debug",null);f([y],Gh.prototype,"info",null);f([y],Gh.prototype,"warn",null);f([y],Gh.prototype,"error",null);f([y],Gh.prototype,"flush",null);f([y],Gh.prototype,"dispose",null);G(MEe,Gh,z.Delayed);class Gae{constructor(){this.linkProviders=new Set([]),this.onDidAddLinkProvider=T.None,this.onDidRemoveLinkProvider=T.None}registerLinkProvider(){b()}}f([y],Gae.prototype,"registerLinkProvider",null);G(Bre,Gae,z.Delayed);class ike{constructor(){this.terminalProfiles=[]}}G(lIe,ike,z.Delayed);class bf{constructor(){this.getDefaultProfile=async()=>({profileName:"bash",path:"/bin/bash",isDefault:!0})}resolveIcon(){b()}resolveShellLaunchConfig(){b()}getDefaultShell(){b()}getDefaultShellArgs(){b()}getDefaultIcon(){b()}getEnvironment(){b()}createProfileFromShellAndShellArgs(){b()}}f([y],bf.prototype,"resolveIcon",null);f([y],bf.prototype,"resolveShellLaunchConfig",null);f([y],bf.prototype,"getDefaultShell",null);f([y],bf.prototype,"getDefaultShellArgs",null);f([y],bf.prototype,"getDefaultIcon",null);f([y],bf.prototype,"getEnvironment",null);f([y],bf.prototype,"createProfileFromShellAndShellArgs",null);G(Fre,bf,z.Delayed);class zae{constructor(){this.collections=new Map,this.onDidChangeCollections=T.None,this.set=()=>{},this.delete=()=>{}}get mergedCollection(){return b()}}f([y],zae.prototype,"mergedCollection",null);G(Ore,zae,z.Delayed);class hK{constructor(){this.onDidRegisterProvider=T.None,this.onDidRegisterCommandSelector=T.None,this.onDidUnregisterProvider=T.None,this.extensionQuickFixes=Promise.resolve([]),this.providers=new Map}registerQuickFixProvider(){b()}registerCommandSelector(){b()}}f([y],hK.prototype,"registerQuickFixProvider",null);f([y],hK.prototype,"registerCommandSelector",null);G(Vre,hK,z.Delayed);class xd{constructor(){this.onDidTurnOnSync=T.None,this.enabled=!1,this.authenticationProviders=[],this.all=[],this.current=void 0,this.accountStatus=XE.Unavailable,this.onDidChangeAccountStatus=T.None}turnOn(){b()}turnoff(){b()}signIn(){b()}resetSyncedData(){b()}showSyncActivity(){b()}syncNow(){b()}synchroniseUserDataSyncStoreType(){b()}showConflicts(){b()}accept(){b()}getAllLogResources(){b()}downloadSyncActivity(){b()}}f([y],xd.prototype,"turnOn",null);f([y],xd.prototype,"turnoff",null);f([y],xd.prototype,"signIn",null);f([y],xd.prototype,"resetSyncedData",null);f([y],xd.prototype,"showSyncActivity",null);f([y],xd.prototype,"syncNow",null);f([y],xd.prototype,"synchroniseUserDataSyncStoreType",null);f([y],xd.prototype,"showConflicts",null);f([y],xd.prototype,"accept",null);f([y],xd.prototype,"getAllLogResources",null);f([y],xd.prototype,"downloadSyncActivity",null);G(QIe,xd,z.Delayed);class uK{constructor(){this.onDidChangeEnablement=T.None,this.isEnabled=()=>!1,this.canToggleEnablement=()=>!1,this.isResourceEnablementConfigured=()=>!1,this.onDidChangeResourceEnablement=T.None,this.isResourceEnabled=()=>!1,this.getResourceSyncStateVersion=()=>{}}setEnablement(){b()}setResourceEnablement(){b()}}f([y],uK.prototype,"setEnablement",null);f([y],uK.prototype,"setResourceEnablement",null);G(HEe,uK,z.Delayed);class BI{addKeybinding(){b()}editKeybinding(){b()}removeKeybinding(){b()}resetKeybinding(){b()}}f([y],BI.prototype,"addKeybinding",null);f([y],BI.prototype,"editKeybinding",null);f([y],BI.prototype,"removeKeybinding",null);f([y],BI.prototype,"resetKeybinding",null);G(DIe,BI,z.Delayed);class gK{getLocalSearchProvider(){b()}getRemoteSearchProvider(){b()}}f([y],gK.prototype,"getLocalSearchProvider",null);f([y],gK.prototype,"getRemoteSearchProvider",null);G(iIe,gK,z.Delayed);class Vr{constructor(){this.tryGetDataProviderSync=()=>{},this.canResolve=async()=>!1,this.onAddViewType=T.None,this.onWillRemoveViewType=T.None,this.onDidChangeOutputRenderers=T.None,this.onWillAddNotebookDocument=T.None,this.onDidAddNotebookDocument=T.None,this.onWillRemoveNotebookDocument=T.None,this.onDidRemoveNotebookDocument=T.None,this.getViewTypeProvider=()=>{},this.getRendererInfo=()=>{},this.getRenderers=()=>[],this.getNotebookTextModel=()=>{},this.listNotebookDocuments=()=>[],this.getContributedNotebookType=()=>{},this.getContributedNotebookTypes=()=>[],this.getNotebookProviderResourceRoots=()=>[]}createNotebookTextDocumentSnapshot(){b()}restoreNotebookTextModelFromSnapshot(){b()}hasSupportedNotebooks(){b()}registerNotebookSerializer(){b()}withNotebookDataProvider(){b()}getOutputMimeTypeInfo(){b()}getStaticPreloads(){b()}updateMimePreferredRenderer(){b()}saveMimeDisplayOrder(){b()}createNotebookTextModel(){b()}getNotebookTextModels(){b()}registerContributedNotebookType(){b()}setToCopy(){b()}getToCopy(){b()}clearEditorCache(){b()}}f([y],Vr.prototype,"createNotebookTextDocumentSnapshot",null);f([y],Vr.prototype,"restoreNotebookTextModelFromSnapshot",null);f([y],Vr.prototype,"hasSupportedNotebooks",null);f([y],Vr.prototype,"registerNotebookSerializer",null);f([y],Vr.prototype,"withNotebookDataProvider",null);f([y],Vr.prototype,"getOutputMimeTypeInfo",null);f([y],Vr.prototype,"getStaticPreloads",null);f([y],Vr.prototype,"updateMimePreferredRenderer",null);f([y],Vr.prototype,"saveMimeDisplayOrder",null);f([y],Vr.prototype,"createNotebookTextModel",null);f([y],Vr.prototype,"getNotebookTextModels",null);f([y],Vr.prototype,"registerContributedNotebookType",null);f([y],Vr.prototype,"setToCopy",null);f([y],Vr.prototype,"getToCopy",null);f([y],Vr.prototype,"clearEditorCache",null);G(bl,Vr,z.Delayed);class sO{replace(){b()}openReplacePreview(){b()}updateReplacePreview(){b()}}f([y],sO.prototype,"replace",null);f([y],sO.prototype,"openReplacePreview",null);f([y],sO.prototype,"updateReplacePreview",null);G(nIe,sO,z.Delayed);class oO{constructor(){this.onDidClearHistory=T.None}clearHistory(){b()}load(){b()}save(){b()}}f([y],oO.prototype,"clearHistory",null);f([y],oO.prototype,"load",null);f([y],oO.prototype,"save",null);G(rIe,oO,z.Delayed);class VI{constructor(){this.retrieveExistingWidgetFromURI=()=>{},this.retrieveAllExistingWidgets=()=>[],this.onDidAddNotebookEditor=T.None,this.onDidRemoveNotebookEditor=T.None,this.getNotebookEditor=()=>{},this.listNotebookEditors=()=>[]}updateReplContextKey(){b()}retrieveWidget(){b()}addNotebookEditor(){b()}removeNotebookEditor(){b()}}f([y],VI.prototype,"updateReplContextKey",null);f([y],VI.prototype,"retrieveWidget",null);f([y],VI.prototype,"addNotebookEditor",null);f([y],VI.prototype,"removeNotebookEditor",null);G(PN,VI,z.Delayed);class qae{get searchModel(){return b()}}f([y],qae.prototype,"searchModel",null);G(sIe,qae,z.Delayed);class rO{constructor(){this.onDidSaveNotebook=T.None,this.onDidChangeDirty=T.None,this.onWillFailWithConflict=T.None}createUntitledNotebookTextModel(){b()}isDirty(){b()}resolve(){b()}}f([y],rO.prototype,"createUntitledNotebookTextModel",null);f([y],rO.prototype,"isDirty",null);f([y],rO.prototype,"resolve",null);G(II,rO,z.Delayed);class nke{constructor(){this.onDidRegisterHandler=T.None,this.registerHandler=()=>F.None,this.findEditor=()=>{}}}G(iae,nke,z.Delayed);class Kae{constructor(){this.isActive=!1,this.onDidChangeIsActive=T.None}markActive(){b()}}f([y],Kae.prototype,"markActive",null);G(Zie,Kae,z.Delayed);class jae{registerCanonicalUriProvider(){b()}}f([y],jae.prototype,"registerCanonicalUriProvider",null);G(Jie,jae,z.Delayed);class ske{constructor(){this.onDidChange=T.None}setOrUpdateEntry(){return Sy.DidUpdate}unsetEntry(){}getEntries(){return[]}}G(Tq,ske,z.Delayed);class oke{constructor(){this.getCurrentExperiments=async()=>[],this.getTreatment=async()=>{}}}G(noe,oke,z.Delayed);class Gs{constructor(){this.edits2Enabled=!1,this.isPersistedSessionEmpty=()=>!0,this.unifiedViewEnabled=!1,this.isEditingLocation=()=>!1,this.isEnabled=()=>!1,this.onDidSubmitAgent=T.None,this.hasSessions=()=>!1,this.onDidDisposeSession=T.None,this.transferredSessionData=void 0,this.onDidSubmitSlashCommand=T.None,this.getSessionId=()=>{},this.transferredSessionId=void 0,this.getProviderInfos=()=>[],this.getSession=()=>{},this.getOrRestoreSession=async()=>{},this.loadSessionFromContent=()=>{},this.getHistory=async()=>[],this.onDidPerformUserAction=T.None,this.onDidSubmitRequest=T.None}activateDefaultAgent(){b()}getChatStorageFolder(){b()}logChatIndex(){b()}setChatSessionTitle(){b()}adoptRequest(){b()}resendRequest(){b()}clearAllHistoryEntries(){b()}transferChatSession(){b()}registerSlashCommandProvider(){b()}startSession(){b()}sendRequest(){b()}removeRequest(){b()}cancelCurrentRequestForSession(){b()}getSlashCommands(){b()}clearSession(){b()}addRequest(){b()}addCompleteRequest(){b()}sendRequestToProvider(){b()}removeHistoryEntry(){b()}notifyUserAction(){b()}}f([y],Gs.prototype,"activateDefaultAgent",null);f([y],Gs.prototype,"getChatStorageFolder",null);f([y],Gs.prototype,"logChatIndex",null);f([y],Gs.prototype,"setChatSessionTitle",null);f([y],Gs.prototype,"adoptRequest",null);f([y],Gs.prototype,"resendRequest",null);f([y],Gs.prototype,"clearAllHistoryEntries",null);f([y],Gs.prototype,"transferChatSession",null);f([y],Gs.prototype,"registerSlashCommandProvider",null);f([y],Gs.prototype,"startSession",null);f([y],Gs.prototype,"sendRequest",null);f([y],Gs.prototype,"removeRequest",null);f([y],Gs.prototype,"cancelCurrentRequestForSession",null);f([y],Gs.prototype,"getSlashCommands",null);f([y],Gs.prototype,"clearSession",null);f([y],Gs.prototype,"addRequest",null);f([y],Gs.prototype,"addCompleteRequest",null);f([y],Gs.prototype,"sendRequestToProvider",null);f([y],Gs.prototype,"removeHistoryEntry",null);f([y],Gs.prototype,"notifyUserAction",null);G(ff,Gs,z.Delayed);class Yae{constructor(){this.lastFocusedAnchor=void 0}register(){b()}}f([y],Yae.prototype,"register",null);G(JIe,Yae,z.Delayed);let Qae=class{update(){b()}};f([y],Qae.prototype,"update",null);G(yre,Qae,z.Delayed);class Gw{constructor(){this.focused=!1,this.onDidClose=T.None,this.enabled=!1}toggle(){b()}focus(){b()}open(){b()}close(){b()}openInChatView(){b()}}f([y],Gw.prototype,"toggle",null);f([y],Gw.prototype,"focus",null);f([y],Gw.prototype,"open",null);f([y],Gw.prototype,"close",null);f([y],Gw.prototype,"openInChatView",null);G(Vxe,Gw,z.Delayed);class zs{constructor(){this._serviceBrand=void 0,this.hasToolsAgent=!1,this.onDidChangeToolsAgentModeEnabled=T.None,this.toolsAgentModeEnabled=!1,this.hasChatParticipantDetectionProviders=()=>!1,this.agentHasDupeName=()=>!1,this.getContributedDefaultAgent=()=>{},this.getActivatedAgents=()=>[],this.getAgentsByName=()=>[],this.getDefaultAgent=()=>{},this.onDidChangeAgents=T.None}toggleToolsAgentMode(){b()}setRequestPaused(){b()}registerChatParticipantDetectionProvider(){b()}detectAgentOrCommand(){b()}getChatTitle(){b()}registerAgentCompletionProvider(){b()}getAgentCompletionItems(){b()}getAgentByFullyQualifiedId(){b()}registerAgentImplementation(){b()}registerDynamicAgent(){b()}getFollowups(){b()}getSecondaryAgent(){b()}updateAgent(){b()}registerAgentData(){b()}registerAgentCallback(){b()}registerAgent(){b()}invokeAgent(){b()}getAgents(){b()}getAgent(){b()}hasAgent(){b()}}f([y],zs.prototype,"toggleToolsAgentMode",null);f([y],zs.prototype,"setRequestPaused",null);f([y],zs.prototype,"registerChatParticipantDetectionProvider",null);f([y],zs.prototype,"detectAgentOrCommand",null);f([y],zs.prototype,"getChatTitle",null);f([y],zs.prototype,"registerAgentCompletionProvider",null);f([y],zs.prototype,"getAgentCompletionItems",null);f([y],zs.prototype,"getAgentByFullyQualifiedId",null);f([y],zs.prototype,"registerAgentImplementation",null);f([y],zs.prototype,"registerDynamicAgent",null);f([y],zs.prototype,"getFollowups",null);f([y],zs.prototype,"getSecondaryAgent",null);f([y],zs.prototype,"updateAgent",null);f([y],zs.prototype,"registerAgentData",null);f([y],zs.prototype,"registerAgentCallback",null);f([y],zs.prototype,"registerAgent",null);f([y],zs.prototype,"invokeAgent",null);f([y],zs.prototype,"getAgents",null);f([y],zs.prototype,"getAgent",null);f([y],zs.prototype,"hasAgent",null);G(pf,zs,z.Delayed);let rke=class{getAgentNameRestriction(){return!0}};G(mre,rke,z.Delayed);class Xae{constructor(){this.onDidCreateTerminal=T.None}createTerminal(){b()}}f([y],Xae.prototype,"createTerminal",null);G(HIe,Xae,z.Delayed);class zw{constructor(){this.registerCustomEditorCapabilities=()=>F.None,this.getCustomEditorCapabilities=()=>{}}get models(){return b()}getCustomEditor(){b()}getAllCustomEditors(){b()}getContributedCustomEditors(){b()}getUserConfiguredCustomEditors(){b()}}f([y],zw.prototype,"models",null);f([y],zw.prototype,"getCustomEditor",null);f([y],zw.prototype,"getAllCustomEditors",null);f([y],zw.prototype,"getContributedCustomEditors",null);f([y],zw.prototype,"getUserConfiguredCustomEditors",null);G(Lq,zw,z.Delayed);class pK{constructor(){this.webviews=[],this.onDidChangeActiveWebview=T.None}createWebviewElement(){b()}createWebviewOverlay(){b()}}f([y],pK.prototype,"createWebviewElement",null);f([y],pK.prototype,"createWebviewOverlay",null);G(ON,pK,z.Delayed);class fK{constructor(){this.onNewResolverRegistered=T.None}register(){b()}resolve(){b()}}f([y],fK.prototype,"register",null);f([y],fK.prototype,"resolve",null);G(qre,fK,z.Delayed);class Zae{setLocale(){b()}clearLocalePreference(){return Promise.resolve()}}f([y],Zae.prototype,"setLocale",null);G(kIe,Zae,z.Delayed);class Jv{constructor(){this.onDidChangeActiveWebviewEditor=T.None,this.registerResolver=()=>F.None}get iconManager(){return b()}openWebview(){b()}openRevivedWebview(){b()}revealWebview(){b()}shouldPersist(){b()}resolveWebview(){b()}}f([y],Jv.prototype,"iconManager",null);f([y],Jv.prototype,"openWebview",null);f([y],Jv.prototype,"openRevivedWebview",null);f([y],Jv.prototype,"revealWebview",null);f([y],Jv.prototype,"shouldPersist",null);f([y],Jv.prototype,"resolveWebview",null);G(DI,Jv,z.Delayed);class vg{constructor(){this.onDidChangeConnectionData=T.None}resolveAuthority(){b()}getConnectionData(){b()}getCanonicalURI(){b()}_clearResolvedAuthority(){b()}_setResolvedAuthority(){b()}_setResolvedAuthorityError(){b()}_setAuthorityConnectionToken(){b()}_setCanonicalURIProvider(){b()}}f([y],vg.prototype,"resolveAuthority",null);f([y],vg.prototype,"getConnectionData",null);f([y],vg.prototype,"getCanonicalURI",null);f([y],vg.prototype,"_clearResolvedAuthority",null);f([y],vg.prototype,"_setResolvedAuthority",null);f([y],vg.prototype,"_setResolvedAuthorityError",null);f([y],vg.prototype,"_setAuthorityConnectionToken",null);f([y],vg.prototype,"_setCanonicalURIProvider",null);G(Wh,vg,z.Delayed);class ake{constructor(){this.registerExternalOpenerProvider=()=>F.None,this.getOpener=async()=>{}}}G(Sre,ake,z.Delayed);class Hr{constructor(){this.getCodeBlockContext=()=>{}}configureKeybindings(){b()}openHelpLink(){b()}navigateToCodeBlock(){b()}showLastProvider(){b()}showAccessibleViewHelp(){b()}goToSymbol(){b()}disableHint(){b()}next(){b()}previous(){b()}getOpenAriaHint(){b()}show(){b()}registerProvider(){b()}getPosition(){b()}setPosition(){b()}getLastPosition(){b()}}f([y],Hr.prototype,"configureKeybindings",null);f([y],Hr.prototype,"openHelpLink",null);f([y],Hr.prototype,"navigateToCodeBlock",null);f([y],Hr.prototype,"showLastProvider",null);f([y],Hr.prototype,"showAccessibleViewHelp",null);f([y],Hr.prototype,"goToSymbol",null);f([y],Hr.prototype,"disableHint",null);f([y],Hr.prototype,"next",null);f([y],Hr.prototype,"previous",null);f([y],Hr.prototype,"getOpenAriaHint",null);f([y],Hr.prototype,"show",null);f([y],Hr.prototype,"registerProvider",null);f([y],Hr.prototype,"getPosition",null);f([y],Hr.prototype,"setPosition",null);f([y],Hr.prototype,"getLastPosition",null);G(Fh,Hr,z.Delayed);class cke{constructor(){this.hasShownAccessibleView=()=>!1}}G(bIe,cke,z.Delayed);class On{constructor(){this.preferPreReleases=!1,this.onProfileAwareDidInstallExtensions=T.None,this.onProfileAwareDidUninstallExtension=T.None,this.onProfileAwareDidUpdateExtensionMetadata=T.None,this.getInstalledWorkspaceExtensionLocations=()=>[],this.onDidEnableExtensions=T.None,this.isWorkspaceExtensionsSupported=()=>!1,this.getExtensions=async()=>[],this.getInstalledWorkspaceExtensions=async()=>[],this.toggleAppliationScope=async e=>e,this.onInstallExtension=T.None,this.onDidInstallExtensions=T.None,this.onUninstallExtension=T.None,this.onDidUninstallExtension=T.None,this.onDidChangeProfile=T.None,this.onDidUpdateExtensionMetadata=T.None,this.getInstalled=async()=>[],this.getInstallableServers=async()=>[],this.isPublisherTrusted=()=>!1,this.getTrustedPublishers=()=>[]}toggleApplicationScope(){b()}uninstallExtensions(){b()}resetPinnedStateForAllUserExtensions(){b()}installResourceExtension(){b()}installVSIX(){b()}installFromLocation(){b()}updateFromGallery(){b()}zip(){b()}unzip(){b()}getManifest(){b()}install(){b()}canInstall(){b()}installFromGallery(){b()}installGalleryExtensions(){b()}installExtensionsFromProfile(){b()}uninstall(){b()}reinstallFromGallery(){b()}getExtensionsControlManifest(){b()}copyExtensions(){b()}updateMetadata(){b()}download(){b()}registerParticipant(){b()}getTargetPlatform(){b()}cleanUp(){b()}requestPublisherTrust(){b()}trustPublishers(){b()}untrustPublishers(){b()}}f([y],On.prototype,"toggleApplicationScope",null);f([y],On.prototype,"uninstallExtensions",null);f([y],On.prototype,"resetPinnedStateForAllUserExtensions",null);f([y],On.prototype,"installResourceExtension",null);f([y],On.prototype,"installVSIX",null);f([y],On.prototype,"installFromLocation",null);f([y],On.prototype,"updateFromGallery",null);f([y],On.prototype,"zip",null);f([y],On.prototype,"unzip",null);f([y],On.prototype,"getManifest",null);f([y],On.prototype,"install",null);f([y],On.prototype,"canInstall",null);f([y],On.prototype,"installFromGallery",null);f([y],On.prototype,"installGalleryExtensions",null);f([y],On.prototype,"installExtensionsFromProfile",null);f([y],On.prototype,"uninstall",null);f([y],On.prototype,"reinstallFromGallery",null);f([y],On.prototype,"getExtensionsControlManifest",null);f([y],On.prototype,"copyExtensions",null);f([y],On.prototype,"updateMetadata",null);f([y],On.prototype,"download",null);f([y],On.prototype,"registerParticipant",null);f([y],On.prototype,"getTargetPlatform",null);f([y],On.prototype,"cleanUp",null);f([y],On.prototype,"requestPublisherTrust",null);f([y],On.prototype,"trustPublishers",null);f([y],On.prototype,"untrustPublishers",null);G(WN,On,z.Delayed);let Sl=class{prefersExecuteOnUI(){b()}prefersExecuteOnWorkspace(){b()}prefersExecuteOnWeb(){b()}canExecuteOnUI(){b()}canExecuteOnWorkspace(){b()}canExecuteOnWeb(){b()}getExtensionKind(){b()}getUserConfiguredExtensionKind(){b()}getExtensionUntrustedWorkspaceSupportType(){b()}getExtensionVirtualWorkspaceSupportType(){b()}};f([y],Sl.prototype,"prefersExecuteOnUI",null);f([y],Sl.prototype,"prefersExecuteOnWorkspace",null);f([y],Sl.prototype,"prefersExecuteOnWeb",null);f([y],Sl.prototype,"canExecuteOnUI",null);f([y],Sl.prototype,"canExecuteOnWorkspace",null);f([y],Sl.prototype,"canExecuteOnWeb",null);f([y],Sl.prototype,"getExtensionKind",null);f([y],Sl.prototype,"getUserConfiguredExtensionKind",null);f([y],Sl.prototype,"getExtensionUntrustedWorkspaceSupportType",null);f([y],Sl.prototype,"getExtensionVirtualWorkspaceSupportType",null);G(Kv,Sl,z.Delayed);let dke=class{isWorkspaceTrustEnabled(){return!1}};G(Tz,dke,z.Delayed);class Jae{whenExtensionsReady(){b()}async scanExtensions(){return[]}async scanSingleExtension(){return null}}f([y],Jae.prototype,"whenExtensionsReady",null);G(DN,Jae,z.Delayed);class mK{constructor(){this.open=async()=>!1}create(){b()}registerHandler(){b()}}f([y],mK.prototype,"create",null);f([y],mK.prototype,"registerHandler",null);G($M,mK,z.Delayed);class vK{register(){b()}connect(){b()}}f([y],vK.prototype,"register",null);f([y],vK.prototype,"connect",null);G(Cq,vK,z.Delayed);let aO=class{constructor(){this.onDidChangeQuickDiffProviders=T.None,this.providers=[],this.isQuickDiffProviderVisible=()=>!1}addQuickDiffProvider(){b()}toggleQuickDiffProviderVisibility(){b()}getQuickDiffs(){b()}};f([y],aO.prototype,"addQuickDiffProvider",null);f([y],aO.prototype,"toggleQuickDiffProviderVisibility",null);f([y],aO.prototype,"getQuickDiffs",null);G(LN,aO,z.Delayed);class HI{constructor(){this.onDidChangeInputValueProviders=T.None,this.onDidAddRepository=T.None,this.onDidRemoveRepository=T.None,this.repositories=[],this.repositoryCount=0}getDefaultInputValueProvider(){b()}registerSCMInputValueProvider(){b()}registerSCMProvider(){b()}getRepository(){b()}}f([y],HI.prototype,"getDefaultInputValueProvider",null);f([y],HI.prototype,"registerSCMInputValueProvider",null);f([y],HI.prototype,"registerSCMProvider",null);f([y],HI.prototype,"getRepository",null);G(Are,HI,z.Delayed);class ece{download(){b()}}f([y],ece.prototype,"download",null);G(ene,ece,z.Delayed);let _K=class{registerExtensionHandler(){b()}unregisterExtensionHandler(){b()}};f([y],_K.prototype,"registerExtensionHandler",null);f([y],_K.prototype,"unregisterExtensionHandler",null);G(Zre,_K,z.Delayed);class Ss{constructor(){this.lastActiveCommentcontroller=void 0,this.onResourceHasCommentingRanges=T.None,this.resourceHasCommentingRanges=()=>!1,this.onDidChangeActiveEditingCommentThread=T.None,this.onDidSetResourceCommentInfos=T.None,this.onDidSetAllCommentThreads=T.None,this.onDidUpdateCommentThreads=T.None,this.onDidUpdateNotebookCommentThreads=T.None,this.onDidChangeActiveCommentThread=T.None,this.onDidChangeCurrentCommentThread=T.None,this.onDidUpdateCommentingRanges=T.None,this.onDidChangeActiveCommentingRange=T.None,this.onDidSetDataProvider=T.None,this.onDidDeleteDataProvider=T.None,this.onDidChangeCommentingEnabled=T.None,this.isCommentingEnabled=!1,this.unregisterCommentController=()=>{},this.getDocumentComments=async()=>[],this.getNotebookComments=async()=>[]}get commentsModel(){return b()}setActiveEditingCommentThread(){b()}setActiveCommentAndThread(){b()}setDocumentComments(){b()}setWorkspaceComments(){b()}removeWorkspaceComments(){b()}registerCommentController(){b()}getCommentController(){b()}createCommentThreadTemplate(){b()}updateCommentThreadTemplate(){b()}getCommentMenus(){b()}updateComments(){b()}updateNotebookComments(){b()}disposeCommentThread(){b()}updateCommentingRanges(){b()}hasReactionHandler(){b()}toggleReaction(){b()}setActiveCommentThread(){b()}setCurrentCommentThread(){b()}enableCommenting(){b()}registerContinueOnCommentProvider(){b()}removeContinueOnComment(){b()}}f([y],Ss.prototype,"commentsModel",null);f([y],Ss.prototype,"setActiveEditingCommentThread",null);f([y],Ss.prototype,"setActiveCommentAndThread",null);f([y],Ss.prototype,"setDocumentComments",null);f([y],Ss.prototype,"setWorkspaceComments",null);f([y],Ss.prototype,"removeWorkspaceComments",null);f([y],Ss.prototype,"registerCommentController",null);f([y],Ss.prototype,"getCommentController",null);f([y],Ss.prototype,"createCommentThreadTemplate",null);f([y],Ss.prototype,"updateCommentThreadTemplate",null);f([y],Ss.prototype,"getCommentMenus",null);f([y],Ss.prototype,"updateComments",null);f([y],Ss.prototype,"updateNotebookComments",null);f([y],Ss.prototype,"disposeCommentThread",null);f([y],Ss.prototype,"updateCommentingRanges",null);f([y],Ss.prototype,"hasReactionHandler",null);f([y],Ss.prototype,"toggleReaction",null);f([y],Ss.prototype,"setActiveCommentThread",null);f([y],Ss.prototype,"setCurrentCommentThread",null);f([y],Ss.prototype,"enableCommenting",null);f([y],Ss.prototype,"registerContinueOnCommentProvider",null);f([y],Ss.prototype,"removeContinueOnComment",null);G(gg,Ss,z.Delayed);class bK{constructor(){this.onDidChangeProviders=T.None,this.onDidChangeItems=T.None}registerCellStatusBarItemProvider(){b()}getStatusBarItemsForCell(){b()}}f([y],bK.prototype,"registerCellStatusBarItemProvider",null);f([y],bK.prototype,"getStatusBarItemsForCell",null);G(xre,bK,z.Delayed);class La{constructor(){this.onDidNotebookVariablesUpdate=T.None,this.onDidAddKernel=T.None,this.onDidRemoveKernel=T.None,this.onDidChangeSelectedNotebooks=T.None,this.onDidChangeNotebookAffinity=T.None,this.onDidChangeKernelDetectionTasks=T.None,this.onDidChangeSourceActions=T.None}notifyVariablesChange(){b()}registerKernel(){b()}getMatchingKernel(){b()}getSelectedOrSuggestedKernel(){b()}selectKernelForNotebook(){b()}preselectKernelForNotebook(){b()}updateKernelNotebookAffinity(){b()}registerNotebookKernelDetectionTask(){b()}getKernelDetectionTasks(){b()}getSourceActions(){b()}getRunningSourceActions(){b()}registerKernelSourceActionProvider(){b()}getKernelSourceActions2(){b()}}f([y],La.prototype,"notifyVariablesChange",null);f([y],La.prototype,"registerKernel",null);f([y],La.prototype,"getMatchingKernel",null);f([y],La.prototype,"getSelectedOrSuggestedKernel",null);f([y],La.prototype,"selectKernelForNotebook",null);f([y],La.prototype,"preselectKernelForNotebook",null);f([y],La.prototype,"updateKernelNotebookAffinity",null);f([y],La.prototype,"registerNotebookKernelDetectionTask",null);f([y],La.prototype,"getKernelDetectionTasks",null);f([y],La.prototype,"getSourceActions",null);f([y],La.prototype,"getRunningSourceActions",null);f([y],La.prototype,"registerKernelSourceActionProvider",null);f([y],La.prototype,"getKernelSourceActions2",null);G(Dre,La,z.Delayed);class cO{constructor(){this.onShouldPostMessage=T.None}prepare(){b()}getScoped(){b()}receiveMessage(){b()}}f([y],cO.prototype,"prepare",null);f([y],cO.prototype,"getScoped",null);f([y],cO.prototype,"receiveMessage",null);G(Tre,cO,z.Delayed);class e_{constructor(){this.matchesCurrent=()=>!1}addToHistory(){b()}getPreviousValue(){b()}getNextValue(){b()}replaceLast(){b()}clearHistory(){b()}has(){b()}}f([y],e_.prototype,"addToHistory",null);f([y],e_.prototype,"getPreviousValue",null);f([y],e_.prototype,"getNextValue",null);f([y],e_.prototype,"replaceLast",null);f([y],e_.prototype,"clearHistory",null);f([y],e_.prototype,"has",null);G(Cre,e_,z.Delayed);class yK{constructor(){this.onWillAddInteractiveDocument=T.None,this.onWillRemoveInteractiveDocument=T.None}willCreateInteractiveDocument(){b()}willRemoveInteractiveDocument(){b()}}f([y],yK.prototype,"willCreateInteractiveDocument",null);f([y],yK.prototype,"willRemoveInteractiveDocument",null);G(Oq,yK,z.Delayed);class lke{async getExtensionIdProvidingCurrentLocale(){return iDe()}}G(TIe,lke,z.Eager);class tce{constructor(){this.getRemoteProfiles=async()=>[]}getRemoteProfile(){b()}}f([y],tce.prototype,"getRemoteProfile",null);G(qIe,tce,z.Eager);let dO=class{constructor(){this.isDisabledByBisect=()=>!1,this.isActive=!1,this.disabledCount=0}start(){b()}next(){b()}reset(){b()}};f([y],dO.prototype,"start",null);f([y],dO.prototype,"next",null);f([y],dO.prototype,"reset",null);G(Lw,dO,z.Eager);class hke{constructor(){this.onTokenFailed=T.None,this.account=void 0,this.onDidChangeAccount=T.None}updateAccount(){return Promise.resolve()}}G(KEe,hke,z.Eager);class wK{constructor(){this.getWidgetsByLocations=()=>[],this.onDidAddWidget=T.None,this.getAllWidgets=()=>[],this.getWidgetByLocation=()=>[],this.getWidgetBySessionId=()=>{},this.lastFocusedWidget=void 0}revealViewForProvider(){b()}getWidgetByInputUri(){b()}}f([y],wK.prototype,"revealViewForProvider",null);f([y],wK.prototype,"getWidgetByInputUri",null);G(Ho,wK,z.Delayed);class Id{constructor(){this.onDidChangeHelpInformation=T.None,this.onDidChangeTargetType=T.None,this.targetType=[],this.onDidChangeEditable=T.None,this.onEnabledPortsFeatures=T.None,this.portsFeaturesEnabled=ku.Disabled,this.namedProcesses=new Map}get helpInformation(){return b()}get tunnelModel(){return b()}setEditable(){b()}getEditableData(){b()}forward(){b()}close(){b()}setTunnelInformation(){b()}setCandidateFilter(){b()}onFoundNewCandidates(){b()}restore(){b()}enablePortsFeatures(){b()}}f([y],Id.prototype,"helpInformation",null);f([y],Id.prototype,"tunnelModel",null);f([y],Id.prototype,"setEditable",null);f([y],Id.prototype,"getEditableData",null);f([y],Id.prototype,"forward",null);f([y],Id.prototype,"close",null);f([y],Id.prototype,"setTunnelInformation",null);f([y],Id.prototype,"setCandidateFilter",null);f([y],Id.prototype,"onFoundNewCandidates",null);f([y],Id.prototype,"restore",null);f([y],Id.prototype,"enablePortsFeatures",null);G(VN,Id,z.Delayed);let _g=class{constructor(){this.getAccounts=async()=>[],this.onDidRegisterAuthenticationProvider=T.None,this.onDidUnregisterAuthenticationProvider=T.None,this.onDidChangeSessions=T.None,this.onDidChangeDeclaredProviders=T.None,this.declaredProviders=[],this.isAuthenticationProviderRegistered=()=>!1,this.getProviderIds=()=>[]}registerDeclaredAuthenticationProvider(){b()}unregisterDeclaredAuthenticationProvider(){b()}registerAuthenticationProvider(){b()}unregisterAuthenticationProvider(){b()}getProvider(){b()}getSessions(){b()}createSession(){b()}removeSession(){b()}};f([y],_g.prototype,"registerDeclaredAuthenticationProvider",null);f([y],_g.prototype,"unregisterDeclaredAuthenticationProvider",null);f([y],_g.prototype,"registerAuthenticationProvider",null);f([y],_g.prototype,"unregisterAuthenticationProvider",null);f([y],_g.prototype,"getProvider",null);f([y],_g.prototype,"getSessions",null);f([y],_g.prototype,"createSession",null);f([y],_g.prototype,"removeSession",null);G(Pw,_g,z.Delayed);class SK{constructor(){this.onDidChangeExtensionSessionAccess=T.None,this.isAccessAllowed=()=>!1,this.readAllowedExtensions=()=>[]}updateAllowedExtensions(){b()}removeAllowedExtensions(){b()}}f([y],SK.prototype,"updateAllowedExtensions",null);f([y],SK.prototype,"removeAllowedExtensions",null);G(FN,SK,z.Delayed);class yf{constructor(){this.onDidChangeAccountPreference=T.None,this.getAccountPreference=()=>{},this.getSessionPreference=()=>{}}updateAccountPreference(){b()}removeAccountPreference(){b()}updateSessionPreference(){b()}removeSessionPreference(){b()}selectSession(){b()}requestSessionAccess(){b()}requestNewSession(){b()}}f([y],yf.prototype,"updateAccountPreference",null);f([y],yf.prototype,"removeAccountPreference",null);f([y],yf.prototype,"updateSessionPreference",null);f([y],yf.prototype,"removeSessionPreference",null);f([y],yf.prototype,"selectSession",null);f([y],yf.prototype,"requestSessionAccess",null);f([y],yf.prototype,"requestNewSession",null);G(Vq,yf,z.Delayed);class UI{constructor(){this.extensionUsesAuth=async()=>!1}initializeExtensionUsageCache(){b()}readAccountUsages(){b()}removeAccountUsage(){b()}addAccountUsage(){b()}}f([y],UI.prototype,"initializeExtensionUsageCache",null);f([y],UI.prototype,"readAccountUsages",null);f([y],UI.prototype,"removeAccountUsage",null);f([y],UI.prototype,"addAccountUsage",null);G(jre,UI,z.Delayed);class $I{constructor(){this.onDidChangeProviders=T.None,this.onDidChangeTimeline=T.None,this.onDidChangeUri=T.None,this.getSources=()=>[]}registerTimelineProvider(){b()}unregisterTimelineProvider(){b()}getTimeline(){b()}setUri(){b()}}f([y],$I.prototype,"registerTimelineProvider",null);f([y],$I.prototype,"unregisterTimelineProvider",null);f([y],$I.prototype,"getTimeline",null);f([y],$I.prototype,"setUri",null);G(zre,$I,z.Delayed);class Ma{constructor(){this.getTestsRelatedToCode=async()=>[],this.getCodeRelatedToTest=async()=>[],this.registerExtHost=()=>F.None,this.onDidCancelTestRun=T.None,this.onWillProcessDiff=T.None,this.onDidProcessDiff=T.None,this.getTestController=()=>{}}provideTestFollowups(){b()}get excluded(){return b()}get collection(){return b()}get showInlineOutput(){return b()}registerTestController(){b()}refreshTests(){b()}cancelRefreshTests(){b()}startContinuousRun(){b()}runTests(){b()}runResolvedTests(){b()}syncTests(){b()}cancelTestRun(){b()}publishDiff(){b()}}f([y],Ma.prototype,"provideTestFollowups",null);f([y],Ma.prototype,"excluded",null);f([y],Ma.prototype,"collection",null);f([y],Ma.prototype,"showInlineOutput",null);f([y],Ma.prototype,"registerTestController",null);f([y],Ma.prototype,"refreshTests",null);f([y],Ma.prototype,"cancelRefreshTests",null);f([y],Ma.prototype,"startContinuousRun",null);f([y],Ma.prototype,"runTests",null);f([y],Ma.prototype,"runResolvedTests",null);f([y],Ma.prototype,"syncTests",null);f([y],Ma.prototype,"cancelTestRun",null);f([y],Ma.prototype,"publishDiff",null);G(Gre,Ma,z.Delayed);class CK{constructor(){this.onDidChangeSecret=T.None,this.type="in-memory",this.get=async()=>{}}set(){b()}delete(){b()}}f([y],CK.prototype,"set",null);f([y],CK.prototype,"delete",null);G(kN,CK,z.Delayed);class ice{constructor(){this.getShareActions=()=>[],this.provideShare=async()=>{}}registerShareProvider(){b()}}f([y],ice.prototype,"registerShareProvider",null);G(Pre,ice,z.Delayed);class Cl{constructor(){this.createProfileFromTemplate=async()=>{},this.resolveProfileTemplate=async()=>null,this.registerProfileContentHandler=()=>F.None,this.unregisterProfileContentHandler=()=>{}}exportProfile2(){b()}createFromProfile(){b()}createProfile(){b()}editProfile(){b()}exportProfile(){b()}importProfile(){b()}showProfileContents(){b()}createFromCurrentProfile(){b()}createTroubleshootProfile(){b()}setProfile(){b()}}f([y],Cl.prototype,"exportProfile2",null);f([y],Cl.prototype,"createFromProfile",null);f([y],Cl.prototype,"createProfile",null);f([y],Cl.prototype,"editProfile",null);f([y],Cl.prototype,"exportProfile",null);f([y],Cl.prototype,"importProfile",null);f([y],Cl.prototype,"showProfileContents",null);f([y],Cl.prototype,"createFromCurrentProfile",null);f([y],Cl.prototype,"createTroubleshootProfile",null);f([y],Cl.prototype,"setProfile",null);G(soe,Cl,z.Delayed);class GI{registerIssueDataProvider(){b()}openReporter(){b()}openProcessExplorer(){b()}registerIssueUriRequestHandler(){b()}}f([y],GI.prototype,"registerIssueDataProvider",null);f([y],GI.prototype,"openReporter",null);f([y],GI.prototype,"openProcessExplorer",null);f([y],GI.prototype,"registerIssueUriRequestHandler",null);G(Kxe,GI,z.Delayed);class t_{constructor(){this.repositories=[],this.onDidChangeRepositories=T.None,this.visibleRepositories=[],this.onDidChangeVisibleRepositories=T.None,this.isVisible=()=>!1,this.focusedRepository=void 0,this.onDidFocusRepository=T.None}get activeRepository(){return b()}get menus(){return b()}toggleVisibility(){b()}toggleSortKey(){b()}focus(){b()}pinActiveRepository(){b()}}f([y],t_.prototype,"activeRepository",null);f([y],t_.prototype,"menus",null);f([y],t_.prototype,"toggleVisibility",null);f([y],t_.prototype,"toggleSortKey",null);f([y],t_.prototype,"focus",null);f([y],t_.prototype,"pinActiveRepository",null);G(Rre,t_,z.Delayed);class bg{constructor(){this.getLastCompletedCellForNotebook=()=>{},this.onDidChangeExecution=T.None,this.onDidChangeLastRunFailState=T.None}forceCancelNotebookExecutions(){b()}getCellExecutionsForNotebook(){b()}getCellExecutionsByHandleForNotebook(){b()}getCellExecution(){b()}createCellExecution(){b()}getExecution(){b()}createExecution(){b()}getLastFailedCellForNotebook(){b()}}f([y],bg.prototype,"forceCancelNotebookExecutions",null);f([y],bg.prototype,"getCellExecutionsForNotebook",null);f([y],bg.prototype,"getCellExecutionsByHandleForNotebook",null);f([y],bg.prototype,"getCellExecution",null);f([y],bg.prototype,"createCellExecution",null);f([y],bg.prototype,"getExecution",null);f([y],bg.prototype,"createExecution",null);f([y],bg.prototype,"getLastFailedCellForNotebook",null);G(Ire,bg,z.Delayed);class i_{constructor(){this.getDefaultProfileForTest=()=>{},this.onDidChange=T.None,this.all=()=>[],this.getGroupDefaultProfiles=()=>[],this.getControllerProfiles=()=>[]}addProfile(){b()}updateProfile(){b()}removeProfile(){b()}capabilitiesForTest(){b()}configure(){b()}setGroupDefaultProfiles(){b()}}f([y],i_.prototype,"addProfile",null);f([y],i_.prototype,"updateProfile",null);f([y],i_.prototype,"removeProfile",null);f([y],i_.prototype,"capabilitiesForTest",null);f([y],i_.prototype,"configure",null);f([y],i_.prototype,"setGroupDefaultProfiles",null);G(Ure,i_,z.Delayed);class qw{setUsePlainTextEncryption(){b()}getKeyStorageProvider(){b()}encrypt(){b()}decrypt(){b()}isEncryptionAvailable(){b()}}f([y],qw.prototype,"setUsePlainTextEncryption",null);f([y],qw.prototype,"getKeyStorageProvider",null);f([y],qw.prototype,"encrypt",null);f([y],qw.prototype,"decrypt",null);f([y],qw.prototype,"isEncryptionAvailable",null);G(CEe,qw,z.Delayed);class lO{constructor(){this.onResultsChanged=T.None,this.onTestChanged=T.None,this.results=[],this.getResult=()=>{},this.getStateById=()=>{}}clear(){b()}createLiveResult(){b()}push(){b()}}f([y],lO.prototype,"clear",null);f([y],lO.prototype,"createLiveResult",null);f([y],lO.prototype,"push",null);G($re,lO,z.Delayed);class EK{read(){b()}persist(){b()}}f([y],EK.prototype,"read",null);f([y],EK.prototype,"persist",null);G(gIe,EK,z.Delayed);class zI{constructor(){this.onDidChange=T.None}updateDecorationsAlternateAction(){b()}invalidateResultMessage(){b()}syncDecorations(){b()}getDecoratedTestPosition(){b()}}f([y],zI.prototype,"updateDecorationsAlternateAction",null);f([y],zI.prototype,"invalidateResultMessage",null);f([y],zI.prototype,"syncDecorations",null);f([y],zI.prototype,"getDecoratedTestPosition",null);G(fIe,zI,z.Delayed);class uke{constructor(){this.requiresInitialization=async()=>!1,this.whenInitializationFinished=async()=>{},this.initializeRequiredResources=async()=>{},this.initializeInstalledExtensions=async()=>{},this.initializeOtherResources=async()=>{}}}G(HN,uke,z.Delayed);G(SEe,wEe,z.Delayed);class gke{notebookSearch(){return{openFilesToScan:new Mp,completeData:Promise.resolve({results:[],messages:[]}),allScannedFiles:Promise.resolve(new Mp)}}}G(oIe,gke,z.Delayed);let Kw=class{constructor(){this.onDidChangeLanguageModels=T.None,this.getLanguageModelIds=()=>[],this.lookupLanguageModel=()=>{}}sendChatRequest(){b()}selectLanguageModels(){b()}computeTokenLength(){b()}registerLanguageModelChat(){b()}makeLanguageModelChatRequest(){b()}};f([y],Kw.prototype,"sendChatRequest",null);f([y],Kw.prototype,"selectLanguageModels",null);f([y],Kw.prototype,"computeTokenLength",null);f([y],Kw.prototype,"registerLanguageModelChat",null);f([y],Kw.prototype,"makeLanguageModelChatRequest",null);G(Tw,Kw,z.Delayed);class wf{onDidChangeCommands(){b()}registerSlashData(){b()}registerSlashCallback(){b()}registerSlashCommand(){b()}executeCommand(){b()}getCommands(){b()}hasCommand(){b()}}f([y],wf.prototype,"onDidChangeCommands",null);f([y],wf.prototype,"registerSlashData",null);f([y],wf.prototype,"registerSlashCallback",null);f([y],wf.prototype,"registerSlashCommand",null);f([y],wf.prototype,"executeCommand",null);f([y],wf.prototype,"getCommands",null);f([y],wf.prototype,"hasCommand",null);G(_re,wf,z.Delayed);class yg{constructor(){this.getVariable=()=>{},this.resolveVariable=async()=>[]}attachContext(){b()}getDynamicVariables(){b()}getDynamicReferences(){b()}registerVariable(){b()}getVariables(){b()}resolveVariables(){b()}hasVariable(){b()}getSelectedTools(){b()}}f([y],yg.prototype,"attachContext",null);f([y],yg.prototype,"getDynamicVariables",null);f([y],yg.prototype,"getDynamicReferences",null);f([y],yg.prototype,"registerVariable",null);f([y],yg.prototype,"getVariables",null);f([y],yg.prototype,"resolveVariables",null);f([y],yg.prototype,"hasVariable",null);f([y],yg.prototype,"getSelectedTools",null);G(Rq,yg,z.Delayed);class xK{constructor(){this.isEnabled=()=>!1}getRelatedInformation(){b()}registerAiRelatedInformationProvider(){b()}}f([y],xK.prototype,"getRelatedInformation",null);f([y],xK.prototype,"registerAiRelatedInformationProvider",null);G(Bq,xK,z.Delayed);class IK{constructor(){this.isEnabled=()=>!1}getEmbeddingVector(){b()}registerAiEmbeddingVectorProvider(){b()}}f([y],IK.prototype,"getEmbeddingVector",null);f([y],IK.prototype,"registerAiEmbeddingVectorProvider",null);G(Kre,IK,z.Delayed);class hO{constructor(){this.isEnabled=()=>!1,this.getEmbeddingsResults=async()=>[],this.getLLMRankedResults=async()=>[]}startSearch(){b()}registerSettingsSearchProvider(){b()}handleSearchResult(){b()}}f([y],hO.prototype,"startSearch",null);f([y],hO.prototype,"registerSettingsSearchProvider",null);f([y],hO.prototype,"handleSearchResult",null);G(Mae,hO,z.Delayed);class uO{async createNewMessage(e){return{id:String(uO._nextId++),data:e}}async validate(){return!0}async sign(e){return e}}uO._nextId=1;G(sre,uO,z.Delayed);class qI{constructor(){this.lastRunProfileIds=new Set,this.onDidChange=T.None,this.isSpecificallyEnabledFor=()=>!1,this.isEnabledForAParentOf=()=>!1,this.isEnabledForAChildOf=()=>!1,this.isEnabled=()=>!1}isEnabledForProfile(){b()}stopProfile(){b()}start(){b()}stop(){b()}}f([y],qI.prototype,"isEnabledForProfile",null);f([y],qI.prototype,"stopProfile",null);f([y],qI.prototype,"start",null);f([y],qI.prototype,"stop",null);G(pIe,qI,z.Delayed);class El{constructor(){this.onDidSelectTestInExplorer=T.None,this.onDidRequestInputFocus=T.None,this.isFilteringFor=()=>!1}didSelectTestInExplorer(){b()}get text(){return b()}get reveal(){return b()}get globList(){return b()}get includeTags(){return b()}get excludeTags(){return b()}get fuzzy(){return b()}focusInput(){b()}setText(){b()}toggleFilteringFor(){b()}}f([y],El.prototype,"didSelectTestInExplorer",null);f([y],El.prototype,"text",null);f([y],El.prototype,"reveal",null);f([y],El.prototype,"globList",null);f([y],El.prototype,"includeTags",null);f([y],El.prototype,"excludeTags",null);f([y],El.prototype,"fuzzy",null);f([y],El.prototype,"focusInput",null);f([y],El.prototype,"setText",null);f([y],El.prototype,"toggleFilteringFor",null);G(uIe,El,z.Delayed);class n_{get historyVisible(){return b()}tryPeekFirstError(){b()}peekUri(){b()}openCurrentInEditor(){b()}open(){b()}closeAllPeeks(){b()}}f([y],n_.prototype,"historyVisible",null);f([y],n_.prototype,"tryPeekFirstError",null);f([y],n_.prototype,"peekUri",null);f([y],n_.prototype,"openCurrentInEditor",null);f([y],n_.prototype,"open",null);f([y],n_.prototype,"closeAllPeeks",null);G(mIe,n_,z.Delayed);class nce{constructor(){this.getWindow=()=>{},this.onDidOpenAuxiliaryWindow=T.None,this.hasWindow=()=>!1}open(){b()}}f([y],nce.prototype,"open",null);G(Yre,nce,z.Delayed);class KI{constructor(){this.onDidStartTextToSpeechSession=T.None,this.onDidEndTextToSpeechSession=T.None,this.hasActiveTextToSpeechSession=!1,this.onDidChangeHasSpeechProvider=T.None,this.onDidStartSpeechToTextSession=T.None,this.onDidEndSpeechToTextSession=T.None,this.hasActiveSpeechToTextSession=!1,this.onDidStartKeywordRecognition=T.None,this.onDidEndKeywordRecognition=T.None,this.hasActiveKeywordRecognition=!1,this.onDidRegisterSpeechProvider=T.None,this.onDidUnregisterSpeechProvider=T.None,this.hasSpeechProvider=!1}createTextToSpeechSession(){b()}recognizeKeyword(){b()}registerSpeechProvider(){b()}createSpeechToTextSession(){b()}}f([y],KI.prototype,"createTextToSpeechSession",null);f([y],KI.prototype,"recognizeKeyword",null);f([y],KI.prototype,"registerSpeechProvider",null);f([y],KI.prototype,"createSpeechToTextSession",null);G(NN,KI,z.Delayed);class jw{get showInline(){return b()}get filterToTest(){return b()}get selected(){return b()}openCoverage(){b()}closeCoverage(){b()}}f([y],jw.prototype,"showInline",null);f([y],jw.prototype,"filterToTest",null);f([y],jw.prototype,"selected",null);f([y],jw.prototype,"openCoverage",null);f([y],jw.prototype,"closeCoverage",null);G(hIe,jw,z.Delayed);class DK{acceptRequest(){b()}acceptResponse(){b()}}f([y],DK.prototype,"acceptRequest",null);f([y],DK.prototype,"acceptResponse",null);G(Hxe,DK,z.Delayed);let kK=class{constructor(){this.onDidClearHistory=T.None,this.getHistory=()=>[]}clearHistory(){b()}saveHistory(){b()}};f([y],kK.prototype,"clearHistory",null);f([y],kK.prototype,"saveHistory",null);G(bre,kK,z.Delayed);class pke{constructor(){this.providers=[],this.registerProvider=()=>F.None}}G(Uxe,pke,z.Delayed);class xl{constructor(){this.onDidMoveSession=T.None,this.onDidMoveSessio=T.None,this.onDidStashSession=T.None,this.onWillStartSession=T.None,this.onDidEndSession=T.None,this.getSession=()=>{},this.getSession2=()=>{},this.onDidChangeSessions=T.None}get hideOnRequest(){return b()}moveSession(){b()}getCodeEditor(){b()}stashSession(){b()}createSession(){b()}releaseSession(){b()}registerSessionKeyComputer(){b()}recordings(){b()}dispose(){b()}createSession2(){b()}}f([y],xl.prototype,"hideOnRequest",null);f([y],xl.prototype,"moveSession",null);f([y],xl.prototype,"getCodeEditor",null);f([y],xl.prototype,"stashSession",null);f([y],xl.prototype,"createSession",null);f([y],xl.prototype,"releaseSession",null);f([y],xl.prototype,"registerSessionKeyComputer",null);f([y],xl.prototype,"recordings",null);f([y],xl.prototype,"dispose",null);f([y],xl.prototype,"createSession2",null);G(Nq,xl,z.Delayed);class sce{constructor(){this.canComputeDiff=()=>!1,this.canPromptRecommendation=async()=>!1}computeDiff(){b()}}f([y],sce.prototype,"computeDiff",null);G(tIe,sce,z.Delayed);class TK{getKernels(){b()}addMostRecentKernel(){b()}}f([y],TK.prototype,"getKernels",null);f([y],TK.prototype,"addMostRecentKernel",null);G(Zxe,TK,z.Delayed);class jI{executeNotebookCells(){b()}cancelNotebookCells(){b()}cancelNotebookCellHandles(){b()}registerExecutionParticipant(){b()}}f([y],jI.prototype,"executeNotebookCells",null);f([y],jI.prototype,"cancelNotebookCells",null);f([y],jI.prototype,"cancelNotebookCellHandles",null);f([y],jI.prototype,"registerExecutionParticipant",null);G(Xxe,jI,z.Delayed);class fke{}G(Jxe,fke,z.Delayed);class YI{info(){b()}debug(){b()}warn(){b()}error(){b()}}f([y],YI.prototype,"info",null);f([y],YI.prototype,"debug",null);f([y],YI.prototype,"warn",null);f([y],YI.prototype,"error",null);G(kre,YI,z.Delayed);class Sf{constructor(){this.onDidAddWalkthrough=T.None,this.onDidRemoveWalkthrough=T.None,this.onDidChangeWalkthrough=T.None,this.onDidProgressStep=T.None}getWalkthroughs(){b()}getWalkthrough(){b()}registerWalkthrough(){b()}progressByEvent(){b()}progressStep(){b()}deprogressStep(){b()}markWalkthroughOpened(){b()}}f([y],Sf.prototype,"getWalkthroughs",null);f([y],Sf.prototype,"getWalkthrough",null);f([y],Sf.prototype,"registerWalkthrough",null);f([y],Sf.prototype,"progressByEvent",null);f([y],Sf.prototype,"progressStep",null);f([y],Sf.prototype,"deprogressStep",null);f([y],Sf.prototype,"markWalkthroughOpened",null);G(_Ie,Sf,z.Delayed);class AK{constructor(){this.onDidChangeUserDataSyncStore=T.None,this.userDataSyncStore=void 0}switch(){b()}getPreviousUserDataSyncStore(){b()}}f([y],AK.prototype,"switch",null);f([y],AK.prototype,"getPreviousUserDataSyncStore",null);G(WEe,AK,z.Delayed);class Sc{constructor(){this.onDidChangeDonotMakeRequestsUntil=T.None,this.donotMakeRequestsUntil=void 0,this.onTokenFailed=T.None,this.onTokenSucceed=T.None}setAuthToken(){b()}manifest(){b()}readResource(){b()}writeResource(){b()}deleteResource(){b()}getAllResourceRefs(){b()}resolveResourceContent(){b()}getAllCollections(){b()}createCollection(){b()}deleteCollection(){b()}getActivityData(){b()}clear(){b()}}f([y],Sc.prototype,"setAuthToken",null);f([y],Sc.prototype,"manifest",null);f([y],Sc.prototype,"readResource",null);f([y],Sc.prototype,"writeResource",null);f([y],Sc.prototype,"deleteResource",null);f([y],Sc.prototype,"getAllResourceRefs",null);f([y],Sc.prototype,"resolveResourceContent",null);f([y],Sc.prototype,"getAllCollections",null);f([y],Sc.prototype,"createCollection",null);f([y],Sc.prototype,"deleteCollection",null);f([y],Sc.prototype,"getActivityData",null);f([y],Sc.prototype,"clear",null);G(BEe,Sc,z.Delayed);class zh{constructor(){this.onDidChangeLogLevel=T.None}getLevel(){b()}setLevel(){b()}trace(){b()}debug(){b()}info(){b()}warn(){b()}error(){b()}flush(){b()}dispose(){b()}}f([y],zh.prototype,"getLevel",null);f([y],zh.prototype,"setLevel",null);f([y],zh.prototype,"trace",null);f([y],zh.prototype,"debug",null);f([y],zh.prototype,"info",null);f([y],zh.prototype,"warn",null);f([y],zh.prototype,"error",null);f([y],zh.prototype,"flush",null);f([y],zh.prototype,"dispose",null);G(qEe,zh,z.Delayed);class Na{constructor(){this.status=UE.Uninitialized,this.onDidChangeStatus=T.None,this.conflicts=[],this.onDidChangeConflicts=T.None,this.onDidChangeLocal=T.None,this.onSyncErrors=T.None,this.onDidChangeLastSyncTime=T.None,this.onDidResetRemote=T.None,this.onDidResetLocal=T.None}createSyncTask(){b()}createManualSyncTask(){b()}resolveContent(){b()}accept(){b()}reset(){b()}resetRemote(){b()}cleanUpRemoteData(){b()}resetLocal(){b()}hasLocalData(){b()}hasPreviouslySynced(){b()}replace(){b()}saveRemoteActivityData(){b()}extractActivityData(){b()}}f([y],Na.prototype,"createSyncTask",null);f([y],Na.prototype,"createManualSyncTask",null);f([y],Na.prototype,"resolveContent",null);f([y],Na.prototype,"accept",null);f([y],Na.prototype,"reset",null);f([y],Na.prototype,"resetRemote",null);f([y],Na.prototype,"cleanUpRemoteData",null);f([y],Na.prototype,"resetLocal",null);f([y],Na.prototype,"hasLocalData",null);f([y],Na.prototype,"hasPreviouslySynced",null);f([y],Na.prototype,"replace",null);f([y],Na.prototype,"saveRemoteActivityData",null);f([y],Na.prototype,"extractActivityData",null);G(UEe,Na,z.Delayed);class Yw{constructor(){this.onDidChange=T.None}getMachines(){b()}addCurrentMachine(){b()}removeCurrentMachine(){b()}renameMachine(){b()}setEnablements(){b()}}f([y],Yw.prototype,"getMachines",null);f([y],Yw.prototype,"addCurrentMachine",null);f([y],Yw.prototype,"removeCurrentMachine",null);f([y],Yw.prototype,"renameMachine",null);f([y],Yw.prototype,"setEnablements",null);G(jEe,Yw,z.Delayed);class qh{getRemoteSyncedProfiles(){b()}getLocalSyncedProfiles(){b()}getRemoteSyncResourceHandles(){b()}getLocalSyncResourceHandles(){b()}getAssociatedResources(){b()}getMachineId(){b()}getLocalSyncedMachines(){b()}resolveContent(){b()}resolveUserDataSyncResource(){b()}}f([y],qh.prototype,"getRemoteSyncedProfiles",null);f([y],qh.prototype,"getLocalSyncedProfiles",null);f([y],qh.prototype,"getRemoteSyncResourceHandles",null);f([y],qh.prototype,"getLocalSyncResourceHandles",null);f([y],qh.prototype,"getAssociatedResources",null);f([y],qh.prototype,"getMachineId",null);f([y],qh.prototype,"getLocalSyncedMachines",null);f([y],qh.prototype,"resolveContent",null);f([y],qh.prototype,"resolveUserDataSyncResource",null);G($Ee,qh,z.Delayed);class gO{writeResource(){b()}getAllResourceRefs(){b()}resolveResourceContent(){b()}}f([y],gO.prototype,"writeResource",null);f([y],gO.prototype,"getAllResourceRefs",null);f([y],gO.prototype,"resolveResourceContent",null);G(VEe,gO,z.Delayed);class pO{constructor(){this.resolveDefaultCoreIgnoredSettings=async()=>[]}resolveUserBindings(){b()}resolveFormattingOptions(){b()}resolveDefaultIgnoredSettings(){b()}}f([y],pO.prototype,"resolveUserBindings",null);f([y],pO.prototype,"resolveFormattingOptions",null);f([y],pO.prototype,"resolveDefaultIgnoredSettings",null);G(zEe,pO,z.Delayed);class wg{getDefaultProfileToUse(){b()}createProfile(){b()}createAndEnterProfile(){b()}createAndEnterTransientProfile(){b()}removeProfile(){b()}updateProfile(){b()}switchProfile(){b()}getBuiltinProfileTemplates(){b()}}f([y],wg.prototype,"getDefaultProfileToUse",null);f([y],wg.prototype,"createProfile",null);f([y],wg.prototype,"createAndEnterProfile",null);f([y],wg.prototype,"createAndEnterTransientProfile",null);f([y],wg.prototype,"removeProfile",null);f([y],wg.prototype,"updateProfile",null);f([y],wg.prototype,"switchProfile",null);f([y],wg.prototype,"getBuiltinProfileTemplates",null);G($Se,wg,z.Delayed);class Qw{constructor(){this.onDidAddEntry=T.None,this.onDidChangeEntry=T.None,this.onDidReplaceEntry=T.None,this.onDidRemoveEntry=T.None,this.onDidMoveEntries=T.None,this.onDidRemoveEntries=T.None,this.getEntries=async()=>[],this.getAll=async()=>[]}addEntry(){b()}updateEntry(){b()}removeEntry(){b()}moveEntries(){b()}removeAll(){b()}}f([y],Qw.prototype,"addEntry",null);f([y],Qw.prototype,"updateEntry",null);f([y],Qw.prototype,"removeEntry",null);f([y],Qw.prototype,"moveEntries",null);f([y],Qw.prototype,"removeAll",null);G(XIe,Qw,z.Delayed);class RK{constructor(){this.getNotebook=()=>{}}addNotebookDocument(){b()}removeNotebookDocument(){b()}}f([y],RK.prototype,"addNotebookDocument",null);f([y],RK.prototype,"removeNotebookDocument",null);G(Jre,RK,z.Delayed);class s_{registerTree(){b()}getVisualizedNodeFor(){b()}getVisualizedChildren(){b()}editTreeItem(){b()}getApplicableFor(){b()}register(){b()}}f([y],s_.prototype,"registerTree",null);f([y],s_.prototype,"getVisualizedNodeFor",null);f([y],s_.prototype,"getVisualizedChildren",null);f([y],s_.prototype,"editTreeItem",null);f([y],s_.prototype,"getApplicableFor",null);f([y],s_.prototype,"register",null);G(wre,s_,z.Delayed);class Kh{constructor(){this.onDidChangeLogLevel=T.None}getLevel(){b()}setLevel(){b()}trace(){b()}debug(){b()}info(){b()}warn(){b()}error(){b()}flush(){b()}dispose(){b()}}f([y],Kh.prototype,"getLevel",null);f([y],Kh.prototype,"setLevel",null);f([y],Kh.prototype,"trace",null);f([y],Kh.prototype,"debug",null);f([y],Kh.prototype,"info",null);f([y],Kh.prototype,"warn",null);f([y],Kh.prototype,"error",null);f([y],Kh.prototype,"flush",null);f([y],Kh.prototype,"dispose",null);G(Gxe,Kh,z.Delayed);class o_{constructor(){this.SIZE_LIMIT=0,this.isSignedIn=!1,this.onDidSignIn=T.None,this.onDidSignOut=T.None,this.storeClient=void 0,this.lastReadResources=new Map,this.lastWrittenResources=new Map}initialize(){b()}read(){b()}write(){b()}delete(){b()}list(){b()}getMachineById(){b()}}f([y],o_.prototype,"initialize",null);f([y],o_.prototype,"read",null);f([y],o_.prototype,"write",null);f([y],o_.prototype,"delete",null);f([y],o_.prototype,"list",null);f([y],o_.prototype,"getMachineById",null);G($xe,o_,z.Delayed);class mke{constructor(){this.registerResolver=()=>F.None,this.resolve=async()=>{}}}G(Ere,mke,z.Delayed);G(cIe,aIe,z.Delayed);class QI{constructor(){this.getAllAccessDataForExtension=()=>new Map,this.onDidChangeEnablement=T.None,this.isEnabled=()=>!0,this.onDidChangeAccessData=T.None,this.getAccessData=()=>{}}setEnablement(){b()}getEnablementData(){b()}getAccess(){b()}setStatus(){b()}}f([y],QI.prototype,"setEnablement",null);f([y],QI.prototype,"getEnablementData",null);f([y],QI.prototype,"getAccess",null);f([y],QI.prototype,"setStatus",null);G(Qre,QI,z.Delayed);class vke{constructor(){this.onWillInstantiateEditorPane=T.None,this.didInstantiateEditorPane=()=>!1}}G(Ime,vke,z.Delayed);class PK{matches(){b()}getWorkspaceStateFolders(){b()}}f([y],PK.prototype,"matches",null);f([y],PK.prototype,"getWorkspaceStateFolders",null);G(ZIe,PK,z.Delayed);class fO{constructor(){this.onDidChangeDefaultLogLevels=T.None,this.getDefaultLogLevel=async()=>kb.Off}getDefaultLogLevels(){b()}setDefaultLogLevel(){b()}migrateLogLevels(){b()}}f([y],fO.prototype,"getDefaultLogLevels",null);f([y],fO.prototype,"setDefaultLogLevel",null);f([y],fO.prototype,"migrateLogLevels",null);G(jxe,fO,z.Delayed);let _ke=class{constructor(){this.onDidChange=T.None,this.getName=()=>{}}};G(pg,_ke,z.Delayed);class mO{constructor(){this.isActive=()=>!1}start(){b()}resume(){b()}stop(){b()}}f([y],mO.prototype,"start",null);f([y],mO.prototype,"resume",null);f([y],mO.prototype,"stop",null);G(zxe,mO,z.Delayed);class bke{async isPure(){return{isPure:!1,proof:[]}}}G(xIe,bke,z.Delayed);class yke{constructor(){this.onDidChangeTrustedDomains=T.None}isValid(){return!1}}G(Az,yke,z.Delayed);class r_{constructor(){this.getTool=()=>{},this.getToolByName=()=>{},this.onDidChangeTools=T.None,this.getTools=()=>[]}registerToolData(){b()}registerToolImplementation(){b()}invokeTool(){b()}cancelToolCallsForRequest(){b()}setToolAutoConfirmation(){b()}resetToolAutoConfirmation(){b()}}f([y],r_.prototype,"registerToolData",null);f([y],r_.prototype,"registerToolImplementation",null);f([y],r_.prototype,"invokeTool",null);f([y],r_.prototype,"cancelToolCallsForRequest",null);f([y],r_.prototype,"setToolAutoConfirmation",null);f([y],r_.prototype,"resetToolAutoConfirmation",null);G(kw,r_,z.Delayed);class a_{openReporter(){b()}reloadWithExtensionsDisabled(){b()}showConfirmCloseDialog(){b()}showClipboardDialog(){b()}sendReporterMenu(){b()}closeReporter(){b()}}f([y],a_.prototype,"openReporter",null);f([y],a_.prototype,"reloadWithExtensionsDisabled",null);f([y],a_.prototype,"showConfirmCloseDialog",null);f([y],a_.prototype,"showClipboardDialog",null);f([y],a_.prototype,"sendReporterMenu",null);f([y],a_.prototype,"closeReporter",null);G(qxe,a_,z.Delayed);class oce{constructor(){this.providers=[],this.mapCodeFromResponse=async()=>{},this.mapCode=async()=>{}}registerCodeMapperProvider(){b()}}f([y],oce.prototype,"registerCodeMapperProvider",null);G(vre,oce,z.Delayed);class Dd{constructor(){this.getOrRestoreEditingSession=async()=>null,this.hasRelatedFilesProviders=()=>!1,this.getRelatedFiles=async()=>{},this.onDidChangeEditingSession=T.None,this.currentAutoApplyOperation=null,this.editingSessionFileLimit=0,this.getEditingSession=()=>{},this.onDidCreateEditingSession=T.None,this.currentEditingSession=null}get editingSessionsObs(){return b()}get createAdhocEditingSession(){return b()}registerRelatedFilesProvider(){return b()}get currentEditingSessionObs(){return b()}triggerEditComputation(){b()}createSnapshot(){b()}getSnapshotUri(){b()}restoreSnapshot(){b()}startOrContinueEditingSession(){b()}startOrContinueGlobalEditingSession(){b()}createEditingSession(){b()}}f([y],Dd.prototype,"editingSessionsObs",null);f([y],Dd.prototype,"createAdhocEditingSession",null);f([y],Dd.prototype,"registerRelatedFilesProvider",null);f([y],Dd.prototype,"currentEditingSessionObs",null);f([y],Dd.prototype,"triggerEditComputation",null);f([y],Dd.prototype,"createSnapshot",null);f([y],Dd.prototype,"getSnapshotUri",null);f([y],Dd.prototype,"restoreSnapshot",null);f([y],Dd.prototype,"startOrContinueEditingSession",null);f([y],Dd.prototype,"startOrContinueGlobalEditingSession",null);f([y],Dd.prototype,"createEditingSession",null);G(ug,Dd,z.Delayed);class rce{constructor(){this.onDidChange=T.None,this.lookUp=()=>{}}register(){b()}}f([y],rce.prototype,"register",null);G(iq,rce,z.Delayed);class wke{}G(zIe,wke,z.Delayed);class Cf{constructor(){this.hasTokens=()=>!1,this.getTokens=()=>{}}setTokens(){b()}updateTokens(){b()}markForRefresh(){b()}getNeedsRefresh(){b()}rangeHasTokens(){b()}handleContentChanged(){b()}delete(){b()}}f([y],Cf.prototype,"setTokens",null);f([y],Cf.prototype,"updateTokens",null);f([y],Cf.prototype,"markForRefresh",null);f([y],Cf.prototype,"getNeedsRefresh",null);f([y],Cf.prototype,"rangeHasTokens",null);f([y],Cf.prototype,"handleContentChanged",null);f([y],Cf.prototype,"delete",null);G(Dme,Cf,z.Delayed);class ace{constructor(){this.fileIsIgnored=async()=>!1}registerIgnoredFileProvider(){b()}}f([y],ace.prototype,"registerIgnoredFileProvider",null);G(Pq,ace,z.Delayed);class Ske{constructor(){this.onDidChangeAllowedExtensionsConfigValue=T.None,this.onDidChangeAllowedExtensions=T.None,this.isAllowed=()=>!0}}G(xEe,Ske,z.Delayed);class vO{checkAndSetTransferredWorkspaceTrust(){b()}addWorkspaceToTransferred(){b()}checkAndSetWorkspaceTrust(){b()}}f([y],vO.prototype,"checkAndSetTransferredWorkspaceTrust",null);f([y],vO.prototype,"addWorkspaceToTransferred",null);f([y],vO.prototype,"checkAndSetWorkspaceTrust",null);G(VDe,vO,z.Delayed);class _O{constructor(){this.onDidChange=T.None}setOrUpdateEntry(){b()}deleteEntry(){b()}getEntries(){b()}}f([y],_O.prototype,"setOrUpdateEntry",null);f([y],_O.prototype,"deleteEntry",null);f([y],_O.prototype,"getEntries",null);G(Lae,_O,z.Delayed);class cce{getOrCreate(){b()}}f([y],cce.prototype,"getOrCreate",null);G(Yxe,cce,z.Delayed);class dce{getOrCreate(){b()}}f([y],dce.prototype,"getOrCreate",null);G(Qxe,dce,z.Delayed);class Cke{constructor(){this.createQuickDiffModelReference=()=>{},this.getDirtyDiffModel=()=>{},this.getDiffModel=()=>{}}}G(Fq,Cke,z.Delayed);class bO{get providers(){return b()}registerTerminalCompletionProvider(){b()}provideCompletions(){b()}}f([y],bO.prototype,"providers",null);f([y],bO.prototype,"registerTerminalCompletionProvider",null);f([y],bO.prototype,"provideCompletions",null);G(Hre,bO,z.Delayed);class yO{constructor(){this.parserClass=void 0}getParserClass(){b()}getLanguageClass(){b()}getQueryClass(){b()}}f([y],yO.prototype,"getParserClass",null);f([y],yO.prototype,"getLanguageClass",null);f([y],yO.prototype,"getQueryClass",null);G(kme,yO,z.Eager);class XI{constructor(){this.onDidChangeEntitlement=T.None,this.onDidChangeQuotaExceeded=T.None,this.onDidChangeQuotaRemaining=T.None,this.onDidChangeSentiment=T.None,this.resolve=async()=>{}}get entitlement(){return b()}get quotas(){return b()}get sentiment(){return b()}update(){b()}}f([y],XI.prototype,"entitlement",null);f([y],XI.prototype,"quotas",null);f([y],XI.prototype,"sentiment",null);f([y],XI.prototype,"update",null);G(Gq,XI,z.Eager);class lce{constructor(){this.listPromptFiles=async()=>[],this.getSourceFolders=()=>[],this.asPromptSlashCommand=()=>{},this.resolvePromptSlashCommand=async()=>{},this.findPromptSlashCommands=async()=>[],this.findInstructionFilesFor=async()=>[],this.getAllMetadata=async()=>[],this.getCombinedToolsMetadata=async()=>null}getSyntaxParserFor(){b()}dispose(){}}f([y],lce.prototype,"getSyntaxParserFor",null);G(zq,lce,z.Eager);class kd{constructor(){this.onDidChangeInputs=T.None,this.delegates=[],this.discoverCollections=async()=>[]}get collections(){return b()}get lazyCollectionState(){return b()}collectionToolPrefix(){b()}registerCollection(){b()}resetTrust(){b()}getTrust(){b()}clearSavedInputs(){b()}editSavedInput(){b()}getSavedInputs(){b()}resolveConnection(){b()}registerDelegate(){return F.None}setSavedInput(){b()}}f([y],kd.prototype,"collections",null);f([y],kd.prototype,"lazyCollectionState",null);f([y],kd.prototype,"collectionToolPrefix",null);f([y],kd.prototype,"registerCollection",null);f([y],kd.prototype,"resetTrust",null);f([y],kd.prototype,"getTrust",null);f([y],kd.prototype,"clearSavedInputs",null);f([y],kd.prototype,"editSavedInput",null);f([y],kd.prototype,"getSavedInputs",null);f([y],kd.prototype,"resolveConnection",null);f([y],kd.prototype,"setSavedInput",null);G(jN,kd,z.Eager);class ZI{get servers(){return b()}get lazyCollectionState(){return b()}resetCaches(){b()}activateCollections(){b()}}f([y],ZI.prototype,"servers",null);f([y],ZI.prototype,"lazyCollectionState",null);f([y],ZI.prototype,"resetCaches",null);f([y],ZI.prototype,"activateCollections",null);G(NI,ZI,z.Eager);class hce{get paths(){return b()}}f([y],hce.prototype,"paths",null);G(MDe,hce,z.Eager);class Eke{constructor(){this.onDidChangeExtensionGalleryManifest=T.None,this.isEnabled=()=>!1,this.getExtensionGalleryManifest=async()=>null}}G(Pae,Eke,z.Eager);G(NDe,FDe,z.Delayed);G(YN,WDe,z.Delayed);G(ODe,BDe,z.Delayed);const xke=J("IExtHostRpcService");class A8e{constructor(e){this.getProxy=e.getProxy.bind(e),this.set=e.set.bind(e),this.dispose=e.dispose.bind(e),this.assertRegistered=e.assertRegistered.bind(e),this.drain=e.drain.bind(e)}}const y_="workbench.panel.output";new O("inOutput",!1);new O("activeLogOutput",!1);new O("activeLogOutput.isLog",!1);new O("activeLogOutput.levelSettable",!1);new O("activeLogOutput.level","");new O("activeLogOutput.levelIsDefault",!1);new O("outputView.scrollLock",!1);new O("activeOutputChannel","");new O("output.filter.trace",!0);new O("output.filter.debug",!0);new O("output.filter.info",!0);new O("output.filter.warning",!0);new O("output.filter.error",!0);new O("outputFilterFocus",!1);new O("output.filter.categories","");var NB;(function(s){s[s.Append=1]="Append",s[s.Replace=2]="Replace",s[s.Clear=3]="Clear"})(NB||(NB={}));const uce={OutputChannels:"workbench.contributions.outputChannels"};function R8e(s){return!!s.source&&!Array.isArray(s.source)}function Ike(s){return Array.isArray(s.source)}class Dke extends F{constructor(){super(...arguments),this.channels=new Map,this._onDidRegisterChannel=this._register(new M),this.onDidRegisterChannel=this._onDidRegisterChannel.event,this._onDidRemoveChannel=this._register(new M),this.onDidRemoveChannel=this._onDidRemoveChannel.event,this._onDidUpdateChannelFiles=this._register(new M),this.onDidUpdateChannelSources=this._onDidUpdateChannelFiles.event}registerChannel(e){this.channels.has(e.id)||(this.channels.set(e.id,e),this._onDidRegisterChannel.fire(e.id))}getChannels(){const e=[];return this.channels.forEach(t=>e.push(t)),e}getChannel(e){return this.channels.get(e)}updateChannelSources(e,t){const i=this.channels.get(e);i&&Ike(i)&&(i.source=t,this._onDidUpdateChannelFiles.fire(i))}removeChannel(e){const t=this.channels.get(e);t&&(this.channels.delete(e),this._onDidRemoveChannel.fire(t))}}Ke.add(uce.OutputChannels,new Dke);const kke=J("IExtHostInitDataService");function Xw(s,e){return{id:e,asString:async()=>s,asFile:()=>{},value:typeof s=="string"?s:void 0}}function Tke(s,e,t,i){const n={id:Pn(),name:s,uri:e,data:t};return{id:i,asString:async()=>"",asFile:()=>n,value:void 0}}class JI{constructor(){this._entries=new Map}get size(){let e=0;for(const t of this._entries)e++;return e}has(e){return this._entries.has(this.toKey(e))}matches(e){const t=[...this._entries.keys()];return As.some(this,([i,n])=>n.asFile())&&t.push("files"),gce(GA(e),t)}get(e){return this._entries.get(this.toKey(e))?.[0]}append(e,t){const i=this._entries.get(e);i?i.push(t):this._entries.set(this.toKey(e),[t])}replace(e,t){this._entries.set(this.toKey(e),[t])}delete(e){this._entries.delete(this.toKey(e))}*[Symbol.iterator](){for(const[e,t]of this._entries)for(const i of t)yield[e,i]}toKey(e){return GA(e)}}function GA(s){return s.toLowerCase()}function $j(s,e){return gce(GA(s),e.map(GA))}function gce(s,e){if(s==="*/*")return e.length>0;if(e.includes(s))return!0;const t=s.match(/^([a-z]+)\/([a-z]+|\*)$/i);if(!t)return!1;const[i,n,o]=t;return o==="*"?e.some(r=>r.startsWith(n+"/")):!1}const hl=Object.freeze({create:s=>iI(s.map(e=>e.toString())).join(`\r
`),split:s=>s.split(`\r
`),parse:s=>hl.split(s).filter(e=>!e.startsWith("#"))}),rr=Symbol("unset");class zA{constructor(){this.root=new _1,this._size=0}get size(){return this._size}get nodes(){return this.root.children?.values()||As.empty()}get entries(){return this.root.children?.entries()||As.empty()}insert(e,t,i){this.opNode(e,n=>n._value=t,i)}mutate(e,t){this.opNode(e,i=>i._value=t(i._value===rr?void 0:i._value))}mutatePath(e,t){this.opNode(e,()=>{},i=>t(i))}delete(e){const t=this.getPathToKey(e);if(!t)return;let i=t.length-1;const n=t[i].node._value;if(n!==rr){for(this._size--,t[i].node._value=rr;i>0;i--){const{node:o,part:r}=t[i];if(o.children?.size||o._value!==rr)break;t[i-1].node.children.delete(r)}return n}}*deleteRecursive(e){const t=this.getPathToKey(e);if(!t)return;const i=t[t.length-1].node;for(let n=t.length-1;n>0;n--){const o=t[n-1];if(o.node.children.delete(t[n].part),o.node.children.size>0||o.node._value!==rr)break}for(const n of Gj(i))n._value!==rr&&(this._size--,yield n._value);i===this.root&&(this.root._value=rr,this.root.children=void 0)}find(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return;t=n}return t._value===rr?void 0:t._value}hasKeyOrParent(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return!1;if(n._value!==rr)return!0;t=n}return!1}hasKeyOrChildren(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return!1;t=n}return!0}hasKey(e){let t=this.root;for(const i of e){const n=t.children?.get(i);if(!n)return!1;t=n}return t._value!==rr}getPathToKey(e){const t=[{part:"",node:this.root}];let i=0;for(const n of e){const o=t[i].node.children?.get(n);if(!o)return;t.push({part:n,node:o}),i++}return t}opNode(e,t,i){let n=this.root;for(const a of e){if(n.children)if(n.children.has(a))n=n.children.get(a);else{const c=new _1;n.children.set(a,c),n=c}else{const c=new _1;n.children=new Map([[a,c]]),n=c}i?.(n)}const o=n._value===rr?0:1;t(n);const r=n._value===rr?0:1;this._size+=r-o}*values(){for(const{_value:e}of Gj(this.root))e!==rr&&(yield e)}}function*Gj(s){const e=[s];for(;e.length>0;){const t=e.pop();if(yield t,t.children)for(const i of t.children.values())e.push(i)}}let _1=class{constructor(){this._value=rr}get value(){return this._value===rr?void 0:this._value}set value(e){this._value=e===void 0?rr:e}};var ky;(function(s){s.UseFileStorage="chat.useFileStorage",s.AgentEnabled="chat.agent.enabled",s.Edits2Enabled="chat.edits2.enabled",s.ExtensionToolsEnabled="chat.extensionTools.enabled"})(ky||(ky={}));var Rt;(function(s){s.Ask="ask",s.Edit="edit",s.Agent="agent"})(Rt||(Rt={}));function OB(s){switch(s){case Rt.Agent:return"Agent";case Rt.Edit:return"Edit";case Rt.Ask:default:return"Ask"}}function FB(s){switch(s){case Rt.Ask:case Rt.Edit:case Rt.Agent:return s;default:return}}var $i;(function(s){s.Panel="panel",s.Terminal="terminal",s.Notebook="notebook",s.Editor="editor"})($i||($i={}));(function(s){function e(t){switch(t){case"panel":return s.Panel;case"terminal":return s.Terminal;case"notebook":return s.Notebook;case"editor":return s.Editor}return s.Panel}s.fromRaw=e})($i||($i={}));var _e;(function(s){s.responseVote=new O("chatSessionResponseVote","",{type:"string",description:h(5005,"When the response has been voted up, is set to 'up'. When voted down, is set to 'down'. Otherwise an empty string.")}),s.responseDetectedAgentCommand=new O("chatSessionResponseDetectedAgentOrCommand",!1,{type:"boolean",description:h(5006,"When the agent or command was automatically detected")}),s.responseSupportsIssueReporting=new O("chatResponseSupportsIssueReporting",!1,{type:"boolean",description:h(5007,"True when the current chat response supports issue reporting.")}),s.responseIsFiltered=new O("chatSessionResponseFiltered",!1,{type:"boolean",description:h(5008,"True when the chat response was filtered out by the server.")}),s.responseHasError=new O("chatSessionResponseError",!1,{type:"boolean",description:h(5009,"True when the chat response resulted in an error.")}),s.requestInProgress=new O("chatSessionRequestInProgress",!1,{type:"boolean",description:h(5010,"True when the current request is still in progress.")}),s.isRequestPaused=new O("chatRequestIsPaused",!1,{type:"boolean",description:h(5011,"True when the current request is paused.")}),s.canRequestBePaused=new O("chatCanRequestBePaused",!1,{type:"boolean",description:h(5012,"True when the current request can be paused.")}),s.isResponse=new O("chatResponse",!1,{type:"boolean",description:h(5013,"The chat item is a response.")}),s.isRequest=new O("chatRequest",!1,{type:"boolean",description:h(5014,"The chat item is a request")}),s.itemId=new O("chatItemId","",{type:"string",description:h(5015,"The id of the chat item.")}),s.lastItemId=new O("chatLastItemId",[],{type:"string",description:h(5016,"The id of the last chat item.")}),s.editApplied=new O("chatEditApplied",!1,{type:"boolean",description:h(5017,"True when the chat text edits have been applied.")}),s.inputHasText=new O("chatInputHasText",!1,{type:"boolean",description:h(5018,"True when the chat input has text.")}),s.inputHasFocus=new O("chatInputHasFocus",!1,{type:"boolean",description:h(5019,"True when the chat input has focus.")}),s.inChatInput=new O("inChatInput",!1,{type:"boolean",description:h(5020,"True when focus is in the chat input, false otherwise.")}),s.inChatSession=new O("inChat",!1,{type:"boolean",description:h(5021,"True when focus is in the chat widget, false otherwise.")}),s.hasPromptFile=new O("chatPromptFileAttached",!1,{type:"boolean",description:h(5022,"True when the chat has a prompt file attached.")}),s.chatMode=new O("chatMode",Rt.Ask,{type:"string",description:h(5023,"The current chat mode.")}),s.supported=x.or(Eu.negate(),GSe.notEqualsTo("")),s.enabled=new O("chatIsEnabled",!1,{type:"boolean",description:h(5024,"True when chat is enabled because a default chat participant is activated with an implementation.")}),s.extensionParticipantRegistered=new O("chatPanelExtensionParticipantRegistered",!1,{type:"boolean",description:h(5025,"True when a default chat participant is registered for the panel from an extension.")}),s.panelParticipantRegistered=new O("chatPanelParticipantRegistered",!1,{type:"boolean",description:h(5026,"True when a default chat participant is registered for the panel.")}),s.editingParticipantRegistered=new O("chatEditingParticipantRegistered",!1,{type:"boolean",description:h(5027,"True when a default chat participant is registered for editing.")}),s.chatEditingCanUndo=new O("chatEditingCanUndo",!1,{type:"boolean",description:h(5028,"True when it is possible to undo an interaction in the editing panel.")}),s.chatEditingCanRedo=new O("chatEditingCanRedo",!1,{type:"boolean",description:h(5029,"True when it is possible to redo an interaction in the editing panel.")}),s.extensionInvalid=new O("chatExtensionInvalid",!1,{type:"boolean",description:h(5030,"True when the installed chat extension is invalid and needs to be updated.")}),s.inputCursorAtTop=new O("chatCursorAtTop",!1),s.inputHasAgent=new O("chatInputHasAgent",!1),s.location=new O("chatLocation",void 0),s.inQuickChat=new O("quickChatHasFocus",!1,{type:"boolean",description:h(5031,"True when the quick chat UI has focus, false otherwise.")}),s.hasFileAttachments=new O("chatHasFileAttachments",!1,{type:"boolean",description:h(5032,"True when the chat has file attachments.")}),s.languageModelsAreUserSelectable=new O("chatModelsAreUserSelectable",!1,{type:"boolean",description:h(5033,"True when the chat model can be selected manually by the user.")}),s.Setup={hidden:new O("chatSetupHidden",!1,!0),installed:new O("chatSetupInstalled",!1,!0),disabled:new O("chatSetupDisabled",!1,!0)},s.Entitlement={signedOut:new O("chatSetupSignedOut",!1,!0),canSignUp:new O("chatPlanCanSignUp",!1,!0),limited:new O("chatPlanLimited",!1,!0),pro:new O("chatPlanPro",!1,!0),proPlus:new O("chatPlanProPlus",!1,!0),business:new O("chatPlanBusiness",!1,!0),enterprise:new O("chatPlanEnterprise",!1,!0)},s.chatQuotaExceeded=new O("chatQuotaExceeded",!1,!0),s.completionsQuotaExceeded=new O("completionsQuotaExceeded",!1,!0),s.Editing={agentModeDisallowed:new O("chatAgentModeDisallowed",void 0,{type:"boolean",description:h(5034,"True when agent mode is not allowed.")}),hasToolConfirmation:new O("chatHasToolConfirmation",!1,{type:"boolean",description:h(5035,"True when a tool confirmation is present.")})},s.Tools={toolsCount:new O("toolsCount",0,{type:"number",description:h(5036,"The count of tools available in the chat.")})}})(_e||(_e={}));var zj;(function(s){s.inEditingMode=x.or(_e.chatMode.isEqualTo(Rt.Edit),_e.chatMode.isEqualTo(Rt.Agent))})(zj||(zj={}));var GS;let qj=class extends F{static{this.AGENT_LEADER="@"}constructor(e){super(),this.contextKeyService=e,this._agents=new Map,this._onDidChangeAgents=new M,this.onDidChangeAgents=this._onDidChangeAgents.event,this._agentsContextKeys=new Set,this._hasToolsAgent=!1,this._chatParticipantDetectionProviders=new Map,this._agentCompletionProviders=new Map,this._hasDefaultAgent=_e.enabled.bindTo(this.contextKeyService),this._extensionAgentRegistered=_e.extensionParticipantRegistered.bindTo(this.contextKeyService),this._defaultAgentRegistered=_e.panelParticipantRegistered.bindTo(this.contextKeyService),this._editingAgentRegistered=_e.editingParticipantRegistered.bindTo(this.contextKeyService),this._register(e.onDidChangeContext(t=>{t.affectsSome(this._agentsContextKeys)&&this._updateContextKeys()}))}registerAgent(e,t){if(this.getAgent(e))throw new Error(`Agent already registered: ${JSON.stringify(e)}`);const n=this,o=t.slashCommands;t={...t,get slashCommands(){return o.filter(a=>!a.when||n.contextKeyService.contextMatchesRules(x.deserialize(a.when)))}};const r={data:t};return this._agents.set(e,r),this._updateAgentsContextKeys(),this._updateContextKeys(),this._onDidChangeAgents.fire(void 0),Ie(()=>{this._agents.delete(e),this._updateAgentsContextKeys(),this._updateContextKeys(),this._onDidChangeAgents.fire(void 0)})}_updateAgentsContextKeys(){this._agentsContextKeys.clear();for(const e of this._agents.values())if(e.data.when){const t=x.deserialize(e.data.when);for(const i of t?.keys()||[])this._agentsContextKeys.add(i)}}_updateContextKeys(){let e=!1,t=!1,i=!1,n=!1;for(const o of this.getAgents())o.isDefault&&(o.isCore||(t=!0),o.modes.includes(Rt.Agent)?n=!0:o.modes.includes(Rt.Edit)?e=!0:i=!0);this._editingAgentRegistered.set(e),this._defaultAgentRegistered.set(i),this._extensionAgentRegistered.set(t),n!==this._hasToolsAgent&&(this._hasToolsAgent=n,this._onDidChangeAgents.fire(this.getDefaultAgent($i.Panel,Rt.Agent)))}registerAgentImplementation(e,t){const i=this._agents.get(e);if(!i)throw new Error(`Unknown agent: ${JSON.stringify(e)}`);if(i.impl)throw new Error(`Agent already has implementation: ${JSON.stringify(e)}`);return i.data.isDefault&&this._hasDefaultAgent.set(!0),i.impl=t,this._onDidChangeAgents.fire(new YD(i.data,t)),Ie(()=>{i.impl=void 0,this._onDidChangeAgents.fire(void 0),i.data.isDefault&&this._hasDefaultAgent.set(!1)})}registerDynamicAgent(e,t){e.isDynamic=!0;const i={data:e,impl:t};return this._agents.set(e.id,i),this._onDidChangeAgents.fire(new YD(e,t)),Ie(()=>{this._agents.delete(e.id),this._onDidChangeAgents.fire(void 0)})}registerAgentCompletionProvider(e,t){return this._agentCompletionProviders.set(e,t),{dispose:()=>{this._agentCompletionProviders.delete(e)}}}async getAgentCompletionItems(e,t,i){return await this._agentCompletionProviders.get(e)?.(t,i)??[]}updateAgent(e,t){const i=this._agents.get(e);if(!i?.impl)throw new Error(`No activated agent with id ${JSON.stringify(e)} registered`);i.data.metadata={...i.data.metadata,...t},this._onDidChangeAgents.fire(new YD(i.data,i.impl))}getDefaultAgent(e,t=Rt.Ask){return this._preferExtensionAgent(this.getActivatedAgents().filter(i=>t&&!i.modes.includes(t)?!1:!!i.isDefault&&i.locations.includes(e)))}get hasToolsAgent(){return!!this._hasToolsAgent}getContributedDefaultAgent(e){return this._preferExtensionAgent(this.getAgents().filter(t=>!!t.isDefault&&t.locations.includes(e)))}_preferExtensionAgent(e){return GM(e,t=>!t.isCore)??e.at(-1)}getAgent(e,t=!1){if(!(!this._agentIsEnabled(e)&&!t))return this._agents.get(e)?.data}_agentIsEnabled(e){const t=typeof e=="string"?this._agents.get(e):e;return!t?.data.when||this.contextKeyService.contextMatchesRules(x.deserialize(t.data.when))}getAgentByFullyQualifiedId(e){const t=As.find(this._agents.values(),i=>pce(i.data)===e)?.data;if(!(t&&!this._agentIsEnabled(t.id)))return t}getAgents(){return Array.from(this._agents.values()).map(e=>e.data).filter(e=>this._agentIsEnabled(e.id))}getActivatedAgents(){return Array.from(this._agents.values()).filter(e=>!!e.impl).filter(e=>this._agentIsEnabled(e.data.id)).map(e=>new YD(e.data,e.impl))}getAgentsByName(e){return this._preferExtensionAgents(this.getAgents().filter(t=>t.name===e))}_preferExtensionAgents(e){const t=e.filter(i=>!i.isCore);return t.length>0?t:e}agentHasDupeName(e){const t=this.getAgent(e);return t?this.getAgentsByName(t.name).filter(i=>i.extensionId.value!==t.extensionId.value).length>0:!1}async invokeAgent(e,t,i,n,o){const r=this._agents.get(e);if(!r?.impl)throw new Error(`No activated agent with id "${e}"`);return await r.impl.invoke(t,i,n,o)}setRequestPaused(e,t,i){const n=this._agents.get(e);if(!n?.impl)throw new Error(`No activated agent with id "${e}"`);n.impl.setRequestPaused?.(t,i)}async getFollowups(e,t,i,n,o){const r=this._agents.get(e);return r?.impl?.provideFollowups?r.impl.provideFollowups(t,i,n,o):[]}async getChatTitle(e,t,i){const n=this._agents.get(e);if(!n?.impl)throw new Error(`No activated agent with id "${e}"`);if(n.impl?.provideChatTitle)return n.impl.provideChatTitle(t,i)}registerChatParticipantDetectionProvider(e,t){return this._chatParticipantDetectionProviders.set(e,t),Ie(()=>{this._chatParticipantDetectionProviders.delete(e)})}hasChatParticipantDetectionProviders(){return this._chatParticipantDetectionProviders.size>0}async detectAgentOrCommand(e,t,i,n){const o=As.first(this._chatParticipantDetectionProviders.values());if(!o)return;const r=this.getAgents().reduce((l,u)=>{if(u.locations.includes(i.location)){l.push({participant:u.id,disambiguation:u.disambiguation??[]});for(const g of u.slashCommands)l.push({participant:u.id,command:g.name,disambiguation:g.disambiguation??[]})}return l},[]),a=await o.provideParticipantDetection(e,t,{...i,participants:r},n);if(!a)return;const c=this.getAgent(a.participant);if(!c)return;if(!a.command)return{agent:c};const d=c?.slashCommands.find(l=>l.name===a.command);if(d)return{agent:c,command:d}}};qj=f([p(0,fe)],qj);class YD{constructor(e,t){this.data=e,this.impl=t}get id(){return this.data.id}get name(){return this.data.name??""}get fullName(){return this.data.fullName??""}get description(){return this.data.description??""}get extensionId(){return this.data.extensionId}get extensionPublisherId(){return this.data.extensionPublisherId}get extensionPublisherDisplayName(){return this.data.publisherDisplayName}get extensionDisplayName(){return this.data.extensionDisplayName}get isDefault(){return this.data.isDefault}get isCore(){return this.data.isCore}get metadata(){return this.data.metadata}get slashCommands(){return this.data.slashCommands}get locations(){return this.data.locations}get modes(){return this.data.modes}get disambiguation(){return this.data.disambiguation}async invoke(e,t,i,n){return this.impl.invoke(e,t,i,n)}setRequestPaused(e,t){this.impl.setRequestPaused&&this.impl.setRequestPaused(e,t)}async provideFollowups(e,t,i,n){return this.impl.provideFollowups?this.impl.provideFollowups(e,t,i,n):[]}provideSampleQuestions(e,t){if(this.impl.provideSampleQuestions)return this.impl.provideSampleQuestions(e,t)}toJSON(){return this.data}}let Kj=class{static{GS=this}static{this.StorageKey="chat.participantNameRegistry"}constructor(e,t,i,n){if(this.requestService=t,this.logService=i,this.storageService=n,this.registry=si(this,Object.create(null)),this.disposed=!1,!e.chatParticipantRegistry)return;this.url=e.chatParticipantRegistry;const o=n.get(GS.StorageKey,he.APPLICATION);try{this.registry.set(JSON.parse(o??"{}"),void 0)}catch{n.remove(GS.StorageKey,he.APPLICATION)}this.refresh()}refresh(){this.disposed||this.update().catch(e=>this.logService.warn("Failed to fetch chat participant registry",e)).then(()=>Da(5*60*1e3)).then(()=>this.refresh())}async update(){const e=await this.requestService.request({type:"GET",url:this.url},Ce.None);if(e.res.statusCode!==200)throw new Error("Could not get extensions report.");const t=await CF(e);if(!t||t.version!==1)throw new Error("Unexpected chat participant registry response.");const i=t.restrictedChatParticipants;this.registry.set(i,void 0),this.storageService.store(GS.StorageKey,JSON.stringify(i),he.APPLICATION,gt.MACHINE)}getAgentNameRestriction(e){if(e.isCore)return!0;const t=this.checkAgentNameRestriction(e.name,e).get(),i=!e.fullName||this.checkAgentNameRestriction(e.fullName.replace(/\s/g,""),e).get();return t&&i}checkAgentNameRestriction(e,t){return this.registry.map(n=>n[e.toLowerCase()]).map(n=>n?n.some(o=>oo(o,o.includes(".")?t.extensionId.value:t.extensionPublisherId)):!0)}dispose(){this.disposed=!0}};Kj=GS=f([p(0,Vn),p(1,UM),p(2,Re),p(3,it)],Kj);function pce(s){return`${s.extensionId.value}.${s.id}`}function fce(s){const e="name"in s?s:{...s,name:s.id};return"extensionPublisherId"in e||(e.extensionPublisherId=e.extensionPublisher??""),"extensionDisplayName"in e||(e.extensionDisplayName=""),"extensionId"in e||(e.extensionId=new vs("")),gn(e)}class _u{static{this.Kind="text"}constructor(e,t,i){this.range=e,this.editorRange=t,this.text=i,this.kind=_u.Kind}get promptText(){return this.text}}const eD="#",LK="@",lv="/";class qA{static{this.Kind="var"}constructor(e,t,i,n,o){this.range=e,this.editorRange=t,this.variableName=i,this.variableArg=n,this.variableId=o,this.kind=qA.Kind}get text(){const e=this.variableArg?`:${this.variableArg}`:"";return`${eD}${this.variableName}${e}`}get promptText(){return this.text}}class ZE{static{this.Kind="tool"}constructor(e,t,i,n,o,r){this.range=e,this.editorRange=t,this.toolName=i,this.toolId=n,this.displayName=o,this.icon=r,this.kind=ZE.Kind}get text(){return`${eD}${this.toolName}`}get promptText(){return this.text}toVariableEntry(){return{kind:"tool",id:this.toolId,name:this.toolName,range:this.range,value:void 0,icon:ke.isThemeIcon(this.icon)?this.icon:void 0,fullName:this.displayName}}}class eh{static{this.Kind="agent"}constructor(e,t,i){this.range=e,this.editorRange=t,this.agent=i,this.kind=eh.Kind}get text(){return`${LK}${this.agent.name}`}get promptText(){return""}}class Ty{static{this.Kind="subcommand"}constructor(e,t,i){this.range=e,this.editorRange=t,this.command=i,this.kind=Ty.Kind}get text(){return`${lv}${this.command.name}`}get promptText(){return""}}class JE{static{this.Kind="slash"}constructor(e,t,i){this.range=e,this.editorRange=t,this.slashCommand=i,this.kind=JE.Kind}get text(){return`${lv}${this.slashCommand.command}`}get promptText(){return`${lv}${this.slashCommand.command}`}}class ex{static{this.Kind="prompt"}constructor(e,t,i){this.range=e,this.editorRange=t,this.slashPromptCommand=i,this.kind=ex.Kind}get text(){return`${lv}${this.slashPromptCommand.command}`}get promptText(){return`${lv}${this.slashPromptCommand.command}`}}class tx{static{this.Kind="dynamic"}constructor(e,t,i,n,o,r,a,c,d,l){this.range=e,this.editorRange=t,this.text=i,this.id=n,this.modelDescription=o,this.data=r,this.fullName=a,this.icon=c,this.isFile=d,this.isDirectory=l,this.kind=tx.Kind}get referenceText(){return this.text.replace(eD,"")}get promptText(){return this.text}toVariableEntry(){return this.id==="vscode.problems"?ix.toEntry(this.data.filter):{kind:this.isDirectory?"directory":this.isFile?"file":"generic",id:this.id,name:this.referenceText,range:this.range,value:this.data,fullName:this.fullName,icon:this.icon}}}function Ake(s){return{text:s.text,parts:s.parts.map(e=>{if(e.kind===_u.Kind)return new _u(new Hi(e.range.start,e.range.endExclusive),e.editorRange,e.text);if(e.kind===qA.Kind)return new qA(new Hi(e.range.start,e.range.endExclusive),e.editorRange,e.variableName,e.variableArg,e.variableId||"");if(e.kind===ZE.Kind)return new ZE(new Hi(e.range.start,e.range.endExclusive),e.editorRange,e.toolName,e.toolId,e.displayName,e.icon);if(e.kind===eh.Kind){let t=e.agent;return t=fce(t),new eh(new Hi(e.range.start,e.range.endExclusive),e.editorRange,t)}else{if(e.kind===Ty.Kind)return new Ty(new Hi(e.range.start,e.range.endExclusive),e.editorRange,e.command);if(e.kind===JE.Kind)return new JE(new Hi(e.range.start,e.range.endExclusive),e.editorRange,e.slashCommand);if(e.kind===ex.Kind)return new ex(new Hi(e.range.start,e.range.endExclusive),e.editorRange,e.slashPromptCommand);if(e.kind===tx.Kind)return new tx(new Hi(e.range.start,e.range.endExclusive),e.editorRange,e.text,e.id,e.modelDescription,gn(e.data),e.fullName,e.icon,e.isFile,e.isDirectory);throw new Error(`Unknown chat request part: ${e.kind}`)}})}}function Rke(s,e,t,i=null,n=null){let o="";if(i&&i!==s.getDefaultAgent(e)?.id){const r=s.getAgent(i);if(!r)return;o+=`${LK}${r.name} `,n&&(o+=`${lv}${n} `)}return o+t}var jj;(function(s){s[s.Info=0]="Info",s[s.Warning=1]="Warning",s[s.Error=2]="Error"})(jj||(jj={}));function Pke(s){return!!s&&typeof s=="object"&&"uri"in s&&s.uri instanceof R&&"version"in s&&typeof s.version=="number"&&"ranges"in s&&Array.isArray(s.ranges)&&s.ranges.every(P.isIRange)}function Lke(s){return!!s&&typeof s=="object"&&"documents"in s&&Array.isArray(s.documents)&&s.documents.every(Pke)}var Ay;(function(s){s[s.Complete=1]="Complete",s[s.Partial=2]="Partial",s[s.Omitted=3]="Omitted"})(Ay||(Ay={}));var Yj;(function(s){s[s.Down=0]="Down",s[s.Up=1]="Up"})(Yj||(Yj={}));var Qj;(function(s){s.IncorrectCode="incorrectCode",s.DidNotFollowInstructions="didNotFollowInstructions",s.IncompleteCode="incompleteCode",s.MissingContext="missingContext",s.PoorlyWrittenOrFormatted="poorlyWrittenOrFormatted",s.RefusedAValidRequest="refusedAValidRequest",s.OffensiveOrUnsafe="offensiveOrUnsafe",s.Other="other",s.WillReportIssue="willReportIssue"})(Qj||(Qj={}));var Xj;(function(s){s[s.Action=1]="Action",s[s.Toolbar=2]="Toolbar"})(Xj||(Xj={}));class Mke{get cachedValue(){return this._value}constructor(e){this._computeValue=e,this._value=si(this,void 0)}getValue(){let e=this._value.get();return e||(e=this._computeValue(),this._value.set(e,void 0)),e}}class wO{static fromFn(e){return new wO(e())}constructor(e){this._value=si(this,void 0),this.promiseResult=this._value,this.promise=e.then(t=>(gs(i=>{this._value.set(new Zj(t,void 0),i)}),t),t=>{throw gs(i=>{this._value.set(new Zj(void 0,t),i)}),t})}}class Zj{constructor(e,t){this.data=e,this.error=t}getDataOrThrow(){if(this.error)throw this.error;return this.data}}class Nke{constructor(e){this._computePromise=e,this._lazyValue=new Mke(()=>new wO(this._computePromise())),this.cachedPromiseResult=ve(this,t=>this._lazyValue.cachedValue.read(t)?.promiseResult.read(t))}getPromise(){return this._lazyValue.getValue().promise}}var WB,qn;(function(s){s[s.NotOmitted=0]="NotOmitted",s[s.Partial=1]="Partial",s[s.Full=2]="Full"})(qn||(qn={}));var ix;(function(s){s.icon=K.error;function e(o){return{filterUri:o.resource,owner:o.owner,problemMessage:o.message,filterRange:{startLineNumber:o.startLineNumber,endLineNumber:o.endLineNumber,startColumn:o.startColumn,endColumn:o.endColumn}}}s.fromMarker=e;function t(o){return{id:i(o),name:n(o),icon:s.icon,value:o,kind:"diagnostic",...o}}s.toEntry=t;function i(o){return[o.filterUri,o.owner,o.filterSeverity,o.filterRange?.startLineNumber].join(":")}s.id=i;function n(o){let r;if(function(c){c[c.MaxChars=30]="MaxChars",c[c.MaxSpaceLookback=10]="MaxSpaceLookback"}(r||(r={})),o.problemMessage){if(o.problemMessage.length<r.MaxChars)return o.problemMessage;const c=o.problemMessage.lastIndexOf(" ",r.MaxChars);return c===-1||c+r.MaxSpaceLookback<r.MaxChars?o.problemMessage.substring(0,r.MaxChars)+"":o.problemMessage.substring(0,c)+""}let a=h(5048,"All Problems");return o.filterUri&&(a=h(5049,"Problems in {0}",Qe(o.filterUri))),a}s.label=n})(ix||(ix={}));function mce(s){return s.kind==="paste"}function fm(s){return s.kind==="image"}function vce(s){return s.kind==="notebookOutput"}function _ce(s){return s.kind==="element"}const ua={reason:"other"};class Jj{get session(){return this._session}get username(){return this.session.requesterUsername}get avatarIconUri(){return this.session.requesterAvatarIconUri}get attempt(){return this._attempt}get variableData(){return this._variableData}set variableData(e){this._variableData=e}get confirmation(){return this._confirmation}get locationData(){return this._locationData}get attachedContext(){return this._attachedContext}get editedFileEvents(){return this._editedFileEvents}constructor(e){this._session=e.session,this.message=e.message,this._variableData=e.variableData,this.timestamp=e.timestamp,this._attempt=e.attempt??0,this._confirmation=e.confirmation,this._locationData=e.locationData,this._attachedContext=e.attachedContext,this.isCompleteAddedRequest=e.isCompleteAddedRequest??!1,this.modelId=e.modelId,this.id=e.restoredId??"request_"+Pn(),this._editedFileEvents=e.editedFileEvents}adoptTo(e){this._session=e}}class bce{get value(){return this._responseParts}constructor(e){this._responseRepr="",this._markdownContent="",this._responseParts=e,this._updateRepr()}toString(){return this._responseRepr}getMarkdown(){return this._markdownContent}_updateRepr(){this._responseRepr=this.partsToRepr(this._responseParts),this._markdownContent=this._responseParts.map(e=>e.kind==="inlineReference"?this.inlineRefToRepr(e):e.kind==="markdownContent"||e.kind==="markdownVuln"?e.content.value:"").filter(e=>e.length>0).join("")}partsToRepr(e){const t=[];let i=[];for(const n of e){let o;switch(n.kind){case"treeData":case"progressMessage":case"codeblockUri":case"toolInvocation":case"toolInvocationSerialized":case"extensions":case"undoStop":continue;case"inlineReference":o={text:this.inlineRefToRepr(n)};break;case"command":o={text:n.command.title,isBlock:!0};break;case"textEditGroup":case"notebookEditGroup":o={text:h(5050,"Made changes."),isBlock:!0};break;case"confirmation":o={text:`${n.title}
${n.message}`,isBlock:!0};break;default:o={text:n.content.value};break}o.isBlock?(i.length&&(t.push(i.join("")),i=[]),t.push(o.text)):i.push(o.text)}return i.length&&t.push(i.join("")),t.join(`

`)}inlineRefToRepr(e){return"uri"in e.inlineReference?this.uriToRepr(e.inlineReference.uri):"name"in e.inlineReference?"`"+e.inlineReference.name+"`":this.uriToRepr(e.inlineReference)}uriToRepr(e){return e.scheme===ae.http||e.scheme===ae.https?e.toString(!1):Qe(e)}}class Oke extends bce{constructor(e,t){const i=e.value.findIndex(n=>n.kind==="undoStop"&&n.id===t);super(i===-1?e.value.slice():e.value.slice(0,i)),this.undoStop=t}}class Fke extends bce{get onDidChangeValue(){return this._onDidChangeValue.event}constructor(e){super(fw(e).map(t=>tc(t)?{content:t,kind:"markdownContent"}:"kind"in t?t:{kind:"treeData",treeData:t})),this._onDidChangeValue=new M,this._citations=[]}dispose(){this._onDidChangeValue.dispose()}clear(){this._responseParts=[],this._updateRepr(!0)}updateContent(e,t){if(e.kind==="markdownContent"){const i=this._responseParts.filter(n=>n.kind!=="textEditGroup").at(-1);if(!i||i.kind!=="markdownContent"||!Vke(i.content,e.content))this._responseParts.push(e);else{const n=this._responseParts.indexOf(i);this._responseParts[n]={...i,content:Hke(i.content,e.content)}}this._updateRepr(t)}else if(e.kind==="textEdit"||e.kind==="notebookEdit"){const n=e.uri.scheme===ae.vscodeNotebookCell&&!this._responseParts.find(d=>d.kind==="notebookEditGroup")?void 0:ud.parse(e.uri)?.notebook,o=n??e.uri;let r=!1;const a=e.kind==="textEdit"&&!n?"textEditGroup":"notebookEditGroup",c=a==="textEditGroup"?e.edits:e.edits.map(d=>tne.isTextEdit(d)?{uri:e.uri,edit:d}:d);for(let d=0;!r&&d<this._responseParts.length;d++){const l=this._responseParts[d];l.kind===a&&!l.done&&At(l.uri,o)&&(l.edits.push(c),l.done=e.done,r=!0)}r||this._responseParts.push({kind:a,uri:o,edits:a==="textEditGroup"?[c]:c,done:e.done}),this._updateRepr(t)}else if(e.kind==="progressTask"){const i=this._responseParts.push(e)-1;this._updateRepr(t);const n=e.onDidAddProgress(()=>{this._updateRepr(!1)});e.task?.().then(o=>{n.dispose(),typeof o=="string"&&(this._responseParts[i].content=new Gi(o)),this._updateRepr(!1)})}else e.kind==="toolInvocation"?(e.confirmationMessages&&e.confirmed.p.then(()=>{this._updateRepr(!1)}),e.isCompletePromise.then(()=>{this._updateRepr(!1)}),this._responseParts.push(e),this._updateRepr(t)):(this._responseParts.push(e),this._updateRepr(t))}addCitation(e){this._citations.push(e),this._updateRepr()}_updateRepr(e){super._updateRepr(),this._onDidChangeValue&&(this._responseRepr+=this._citations.length?`

`+Uke(this._citations):"",e||this._onDidChangeValue.fire())}}class QD extends F{get session(){return this._session}get shouldBeRemovedOnSend(){return this._shouldBeRemovedOnSend}get isComplete(){return this._isComplete}set shouldBeRemovedOnSend(e){this._shouldBeRemovedOnSend=e,this._onDidChange.fire(ua)}get isCanceled(){return this._isCanceled}get vote(){return this._vote}get voteDownReason(){return this._voteDownReason}get followups(){return this._followups}get entireResponse(){return this._finalizedResponse||this._response}get result(){return this._result}get username(){return this.session.responderUsername}get avatarIcon(){return this.session.responderAvatarIcon}get agent(){return this._agent}get slashCommand(){return this._slashCommand}get agentOrSlashCommandDetected(){return this._agentOrSlashCommandDetected??!1}get usedContext(){return this._usedContext}get contentReferences(){return Array.from(this._contentReferences)}get codeCitations(){return this._codeCitations}get progressMessages(){return this._progressMessages}get isStale(){return this._isStale}get isPaused(){return this._isPaused}get isPendingConfirmation(){return this._response.value.some(e=>e.kind==="toolInvocation"&&e.isConfirmed===void 0||e.kind==="confirmation"&&e.isUsed===!1)}get response(){const e=this._shouldBeRemovedOnSend?.afterUndoStop;return e?(this._responseView?.undoStop!==e&&(this._responseView=new Oke(this._response,e)),this._responseView):this._finalizedResponse||this._response}constructor(e){super(),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._contentReferences=[],this._codeCitations=[],this._progressMessages=[],this._isStale=!1,this._isPaused=si("isPaused",!1),this._session=e.session,this._agent=e.agent,this._slashCommand=e.slashCommand,this.requestId=e.requestId,this._isComplete=e.isComplete??!1,this._isCanceled=e.isCanceled??!1,this._vote=e.vote,this._voteDownReason=e.voteDownReason,this._result=e.result,this._followups=e.followups?[...e.followups]:void 0,this.isCompleteAddedRequest=e.isCompleteAddedRequest??!1,this._shouldBeRemovedOnSend=e.shouldBeRemovedOnSend,this._isStale=Array.isArray(e.responseContent)&&(e.responseContent.length!==0||tc(e.responseContent)&&e.responseContent.value.length!==0),this._response=this._register(new Fke(e.responseContent)),this._register(this._response.onDidChangeValue(()=>this._onDidChange.fire(ua))),this.id=e.restoredId??"response_"+Pn()}updateContent(e,t){this.bufferWhenPaused(()=>this._response.updateContent(e,t))}addUndoStop(e){this.bufferWhenPaused(()=>{this._onDidChange.fire({reason:"undoStop",id:e.id}),this._response.updateContent(e,!0)})}applyReference(e){e.kind==="usedContext"?this._usedContext=e:e.kind==="reference"&&(this._contentReferences.push(e),this._onDidChange.fire(ua))}applyCodeCitation(e){this._codeCitations.push(e),this._response.addCitation(e),this._onDidChange.fire(ua)}setAgent(e,t){this._agent=e,this._slashCommand=t,this._agentOrSlashCommandDetected=!e.isDefault||!!t,this._onDidChange.fire(ua)}setResult(e){this._result=e,this._onDidChange.fire(ua)}complete(){this._result?.errorDetails?.responseIsRedacted&&this._response.clear(),this._isComplete=!0,this._onDidChange.fire(ua)}cancel(){this._isComplete=!0,this._isCanceled=!0,this._onDidChange.fire(ua)}setFollowups(e){this._followups=e,this._onDidChange.fire(ua)}setVote(e){this._vote=e,this._onDidChange.fire(ua)}setVoteDownReason(e){this._voteDownReason=e,this._onDidChange.fire(ua)}setEditApplied(e,t){return!this.response.value.includes(e)||!e.state?!1:(e.state.applied=t,this._onDidChange.fire(ua),!0)}adoptTo(e){this._session=e,this._onDidChange.fire(ua)}setPaused(e,t){this._isPaused.set(e,t),this._onDidChange.fire(ua),this.bufferedPauseContent?.forEach(i=>i()),this.bufferedPauseContent=void 0}finalizeUndoState(){this._finalizedResponse=this.response,this._responseView=void 0,this._shouldBeRemovedOnSend=void 0}bufferWhenPaused(e){this._isPaused.get()?(this.bufferedPauseContent??=[],this.bufferedPauseContent.push(e)):e()}}var db;(function(s){s[s.NotPausable=0]="NotPausable",s[s.Paused=1]="Paused",s[s.Unpaused=2]="Unpaused"})(db||(db={}));function Wke(s){const e=s;return typeof e=="object"&&typeof e.requesterUsername=="string"}function Bke(s){const e=s;return Wke(s)&&typeof e.creationDate=="number"&&typeof e.sessionId=="string"&&s.requests.every(t=>!t.usedContext||Lke(t.usedContext))}var KA;(function(s){s[s.Removal=0]="Removal",s[s.Resend=1]="Resend",s[s.Adoption=2]="Adoption"})(KA||(KA={}));var ma;(function(s){s[s.Created=0]="Created",s[s.Initializing=1]="Initializing",s[s.Initialized=2]="Initialized"})(ma||(ma={}));let eY=WB=class extends F{static getDefaultTitle(e){const t=e.at(0)?.message??"";return(typeof t=="string"?t:t.text).split(`
`)[0].substring(0,50)}get sampleQuestions(){return this._sampleQuestions}get sessionId(){return this._sessionId}get requestInProgress(){const e=this.lastRequest;return!e?.response||e.response.isPendingConfirmation?!1:!e.response.isComplete}get requestPausibility(){const e=this.lastRequest;return!e?.response?.agent||e.response.isComplete||e.response.isPendingConfirmation?db.NotPausable:e.response.isPaused.get()?db.Paused:db.Unpaused}get hasRequests(){return this._requests.length>0}get lastRequest(){return this._requests.at(-1)}get creationDate(){return this._creationDate}get lastMessageDate(){return this._lastMessageDate}get _defaultAgent(){return this.chatAgentService.getDefaultAgent($i.Panel,Rt.Ask)}get requesterUsername(){return this._defaultAgent?.metadata.requester?.name??this.initialData?.requesterUsername??""}get responderUsername(){return this._defaultAgent?.fullName??this.initialData?.responderUsername??""}get requesterAvatarIconUri(){return this._defaultAgent?.metadata.requester?.icon??this._initialRequesterAvatarIconUri}get responderAvatarIcon(){return this._defaultAgent?.metadata.themeIcon??this._initialResponderAvatarIconUri}get initState(){return this._initState}get isImported(){return this._isImported}get customTitle(){return this._customTitle}get title(){return this._customTitle||WB.getDefaultTitle(this._requests)}get initialLocation(){return this._initialLocation}get editingSessionObs(){return this._editingSession}get editingSession(){return this._editingSession?.promiseResult.get()?.data}constructor(e,t,i,n,o){super(),this.initialData=e,this._initialLocation=t,this.logService=i,this.chatAgentService=n,this.chatEditingService=o,this._onDidDispose=this._register(new M),this.onDidDispose=this._onDidDispose.event,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._initState=ma.Created,this._isInitializedDeferred=new aa,this._isImported=!1,this.currentEditedFileEvents=new In,this._checkpoint=void 0;const r=Bke(e);e&&!r&&this.logService.warn(`ChatModel#constructor: Loaded malformed session data: ${JSON.stringify(e)}`),this._isImported=!!e&&!r||(e?.isImported??!1),this._sessionId=r&&e.sessionId||Pn(),this._requests=e?this._deserialize(e):[],this._creationDate=r&&e.creationDate||Date.now(),this._lastMessageDate=r&&e.lastMessageDate||this._creationDate,this._customTitle=r?e.customTitle:void 0,this._initialRequesterAvatarIconUri=e?.requesterAvatarIconUri&&R.revive(e.requesterAvatarIconUri),this._initialResponderAvatarIconUri=WT(e?.responderAvatarIconUri)?R.revive(e.responderAvatarIconUri):e?.responderAvatarIconUri}startEditingSession(e){const t=e?this.chatEditingService.startOrContinueGlobalEditingSession(this):this.chatEditingService.createEditingSession(this);this._editingSession=new wO(t),this._editingSession.promise.then(i=>{this._store.isDisposed?i.dispose():this._register(i)})}notifyEditingAction(e){const t=e.outcome==="accepted"?lb.Keep:e.outcome==="rejected"?lb.Undo:e.outcome==="userModified"?lb.UserModification:null;t!==null&&(!this.currentEditedFileEvents.has(e.uri)||this.currentEditedFileEvents.get(e.uri)?.eventKind===lb.Keep)&&this.currentEditedFileEvents.set(e.uri,{eventKind:t,uri:e.uri})}_deserialize(e){const t=e.requests;if(!Array.isArray(t))return this.logService.error(`Ignoring malformed session data: ${JSON.stringify(e)}`),[];try{return t.map(i=>{const n=typeof i.message=="string"?this.getParsedRequestFromString(i.message):Ake(i.message),o=this.reviveVariableData(i.variableData),r=new Jj({session:this,message:n,variableData:o,timestamp:i.timestamp??-1,restoredId:i.requestId,confirmation:i.confirmation,editedFileEvents:i.editedFileEvents});if(r.shouldBeRemovedOnSend=i.isHidden?{requestId:i.requestId}:i.shouldBeRemovedOnSend,i.response||i.result||i.responseErrorDetails){const a=i.agent&&"metadata"in i.agent?fce(i.agent):void 0,c="responseErrorDetails"in i?{errorDetails:i.responseErrorDetails}:i.result;r.response=new QD({responseContent:i.response??[new Gi(i.response)],session:this,agent:a,slashCommand:i.slashCommand,requestId:r.id,isComplete:!0,isCanceled:i.isCanceled,vote:i.vote,voteDownReason:i.voteDownReason,result:c,followups:i.followups,restoredId:i.responseId}),r.response.shouldBeRemovedOnSend=i.isHidden?{requestId:i.requestId}:i.shouldBeRemovedOnSend,i.usedContext&&r.response.applyReference(gn(i.usedContext)),i.contentReferences?.forEach(d=>r.response.applyReference(gn(d))),i.codeCitations?.forEach(d=>r.response.applyCodeCitation(gn(d)))}return r})}catch(i){return this.logService.error("Failed to parse chat data",i),[]}}reviveVariableData(e){const t=e&&Array.isArray(e.variables)?e:{variables:[]};return t.variables=t.variables.map(i=>i&&"values"in i&&Array.isArray(i.values)?{kind:"generic",id:i.id??"",name:i.name,value:i.values[0]?.value,range:i.range,modelDescription:i.modelDescription,references:i.references}:i),t}getParsedRequestFromString(e){const t=[new _u(new Hi(0,e.length),{startColumn:1,startLineNumber:1,endColumn:1,endLineNumber:1},e)];return{text:e,parts:t}}toggleLastRequestPaused(e){if(this.requestPausibility!==db.NotPausable&&this.lastRequest?.response?.agent){const t=e??!this.lastRequest.response.isPaused.get();this.lastRequest.response.setPaused(t),this.chatAgentService.setRequestPaused(this.lastRequest.response.agent.id,this.lastRequest.id,t),this._onDidChange.fire({kind:"changedRequest",request:this.lastRequest})}}startInitialize(){if(this.initState!==ma.Created)throw new Error(`ChatModel is in the wrong state for startInitialize: ${ma[this.initState]}`);this._initState=ma.Initializing}deinitialize(){this._initState=ma.Created,this._isInitializedDeferred=new aa}initialize(e){if(this.initState!==ma.Initializing)throw new Error(`ChatModel is in the wrong state for initialize: ${ma[this.initState]}`);this._initState=ma.Initialized,this._sampleQuestions=e,this._isInitializedDeferred.complete(),this._onDidChange.fire({kind:"initialize"})}setInitializationError(e){if(this.initState!==ma.Initializing)throw new Error(`ChatModel is in the wrong state for setInitializationError: ${ma[this.initState]}`);this._isInitializedDeferred.isSettled||this._isInitializedDeferred.error(e)}waitForInitialization(){return this._isInitializedDeferred.p}getRequests(){return this._requests}get checkpoint(){return this._checkpoint}setDisabledRequests(e){this._requests.forEach(t=>{const i=e.find(n=>n.requestId===t.id);t.shouldBeRemovedOnSend=i,t.response&&(t.response.shouldBeRemovedOnSend=i)}),this._onDidChange.fire({kind:"setHidden",hiddenRequestIds:e})}addRequest(e,t,i,n,o,r,a,c,d,l){const u=[...this.currentEditedFileEvents.values()];this.currentEditedFileEvents.clear();const g=new Jj({session:this,message:e,variableData:t,timestamp:Date.now(),attempt:i,confirmation:r,locationData:a,attachedContext:c,isCompleteAddedRequest:d,modelId:l,editedFileEvents:u.length?u:void 0});return g.response=new QD({responseContent:[],session:this,agent:n,slashCommand:o,requestId:g.id,isCompleteAddedRequest:d}),this._requests.push(g),this._lastMessageDate=Date.now(),this._onDidChange.fire({kind:"addRequest",request:g}),g}setCustomTitle(e){this._customTitle=e}updateRequest(e,t){e.variableData=t,this._onDidChange.fire({kind:"changedRequest",request:e})}adoptRequest(e){const t=e.session,i=t._requests.findIndex(n=>n.id===e.id);i!==-1&&(t._requests.splice(i,1),e.adoptTo(this),e.response?.adoptTo(this),this._requests.push(e),t._onDidChange.fire({kind:"removeRequest",requestId:e.id,responseId:e.response?.id,reason:KA.Adoption}),this._onDidChange.fire({kind:"addRequest",request:e}))}acceptResponseProgress(e,t,i){if(e.response||(e.response=new QD({responseContent:[],session:this,requestId:e.id})),e.response.isComplete)throw new Error("acceptResponseProgress: Adding progress to a completed response");t.kind==="markdownContent"||t.kind==="treeData"||t.kind==="inlineReference"||t.kind==="codeblockUri"||t.kind==="markdownVuln"||t.kind==="progressMessage"||t.kind==="command"||t.kind==="textEdit"||t.kind==="notebookEdit"||t.kind==="warning"||t.kind==="progressTask"||t.kind==="confirmation"||t.kind==="extensions"||t.kind==="toolInvocation"?e.response.updateContent(t,i):t.kind==="usedContext"||t.kind==="reference"?e.response.applyReference(t):t.kind==="codeCitation"?e.response.applyCodeCitation(t):t.kind==="move"?this._onDidChange.fire({kind:"move",target:t.uri,range:t.range}):t.kind==="undoStop"?e.response.addUndoStop(t):this.logService.error(`Couldn't handle progress: ${JSON.stringify(t)}`)}removeRequest(e,t=KA.Removal){const i=this._requests.findIndex(o=>o.id===e),n=this._requests[i];i!==-1&&(this._onDidChange.fire({kind:"removeRequest",requestId:n.id,responseId:n.response?.id,reason:t}),this._requests.splice(i,1),n.response?.dispose())}cancelRequest(e){e.response&&e.response.cancel()}setResponse(e,t){e.response||(e.response=new QD({responseContent:[],session:this,requestId:e.id})),e.response.setResult(t)}completeResponse(e){if(!e.response)throw new Error("Call setResponse before completeResponse");e.response.complete(),this._onDidChange.fire({kind:"completedRequest",request:e})}setFollowups(e,t){e.response&&e.response.setFollowups(t)}setResponseModel(e,t){e.response=t,this._onDidChange.fire({kind:"addResponse",response:t})}toExport(){return{requesterUsername:this.requesterUsername,requesterAvatarIconUri:this.requesterAvatarIconUri,responderUsername:this.responderUsername,responderAvatarIconUri:this.responderAvatarIcon,initialLocation:this.initialLocation,requests:this._requests.map(e=>{const t={...e.message,parts:e.message.parts.map(o=>o&&"toJSON"in o?o.toJSON():o)},i=e.response?.agent,n=i&&"toJSON"in i?i.toJSON():i?{...i}:void 0;return{requestId:e.id,message:t,variableData:e.variableData,response:e.response?e.response.entireResponse.value.map(o=>o.kind==="treeData"?o.treeData:o.kind==="markdownContent"?o.content:o):void 0,responseId:e.response?.id,shouldBeRemovedOnSend:e.shouldBeRemovedOnSend,result:e.response?.result,followups:e.response?.followups,isCanceled:e.response?.isCanceled,vote:e.response?.vote,voteDownReason:e.response?.voteDownReason,agent:n,slashCommand:e.response?.slashCommand,usedContext:e.response?.usedContext,contentReferences:e.response?.contentReferences,codeCitations:e.response?.codeCitations,timestamp:e.timestamp,confirmation:e.confirmation,editedFileEvents:e.editedFileEvents}})}}toJSON(){return{version:3,...this.toExport(),sessionId:this.sessionId,creationDate:this._creationDate,isImported:this._isImported,lastMessageDate:this._lastMessageDate,customTitle:this._customTitle}}dispose(){this._requests.forEach(e=>e.response?.dispose()),this._onDidDispose.fire(),super.dispose()}};eY=WB=f([p(2,Re),p(3,pf),p(4,ug)],eY);function Vke(s,e){if(s.baseUri&&e.baseUri){if(!(s.baseUri.scheme===e.baseUri.scheme&&s.baseUri.authority===e.baseUri.authority&&s.baseUri.path===e.baseUri.path&&s.baseUri.query===e.baseUri.query&&s.baseUri.fragment===e.baseUri.fragment))return!1}else if(s.baseUri||e.baseUri)return!1;return ic(s.isTrusted,e.isTrusted)&&s.supportHtml===e.supportHtml&&s.supportThemeIcons===e.supportThemeIcons}function Hke(s,e){const t=typeof e=="string"?e:e.value;return{value:s.value+t,isTrusted:s.isTrusted,supportThemeIcons:s.supportThemeIcons,supportHtml:s.supportHtml,baseUri:s.baseUri}}function Uke(s){if(s.length===0)return"";const e=s.reduce((i,n)=>i.add(n.license),new Set);return e.size===1?h(5051,"Similar code found with 1 license type",e.size):h(5052,"Similar code found with {0} license types",e.size)}var lb;(function(s){s[s.Keep=1]="Keep",s[s.Undo=2]="Undo",s[s.UserModification=3]="UserModification"})(lb||(lb={}));var ou;(function(s){s[s.System=0]="System",s[s.User=1]="User",s[s.Assistant=2]="Assistant"})(ou||(ou={}));var tY;(function(s){s.PNG="image/png",s.JPEG="image/jpeg",s.GIF="image/gif",s.WEBP="image/webp",s.BMP="image/bmp"})(tY||(tY={}));var iY;(function(s){s.Low="low",s.High="high"})(iY||(iY={}));const nY={type:"object",properties:{vendor:{type:"string",description:h(5061,"A globally unique vendor of language models.")}}},$ke=gl.registerExtensionPoint({extensionPoint:"languageModels",jsonSchema:{description:h(5062,"Contribute language models of a specific vendor."),oneOf:[nY,{type:"array",items:nY}]},activationEventsGenerator:(s,e)=>{for(const t of s)e.push(`onLanguageModelChat:${t.vendor}`)}});let sY=class{constructor(e,t,i){this._extensionService=e,this._logService=t,this._contextKeyService=i,this._store=new U,this._providers=new Map,this._vendors=new Set,this._onDidChangeProviders=this._store.add(new M),this.onDidChangeLanguageModels=this._onDidChangeProviders.event,this._hasUserSelectableModels=_e.languageModelsAreUserSelectable.bindTo(this._contextKeyService),this._store.add($ke.setHandler(n=>{this._vendors.clear();for(const r of n){if(!ay(r.description,"chatProvider")){r.collector.error(h(5063,"This contribution point requires the 'chatProvider' proposal."));continue}for(const a of As.wrap(r.value)){if(this._vendors.has(a.vendor)){r.collector.error(h(5064,"The vendor '{0}' is already registered and cannot be registered twice",a.vendor));continue}if(pu(a.vendor)){r.collector.error(h(5065,"The vendor field cannot be empty."));continue}if(a.vendor.trim()!==a.vendor){r.collector.error(h(5066,"The vendor field cannot start or end with whitespace."));continue}this._vendors.add(a.vendor)}}const o=[];for(const[r,a]of this._providers)this._vendors.has(a.metadata.vendor)||(this._providers.delete(r),o.push(r));o.length>0&&this._onDidChangeProviders.fire({removed:o})}))}dispose(){this._store.dispose(),this._providers.clear()}getLanguageModelIds(){return Array.from(this._providers.keys())}lookupLanguageModel(e){return this._providers.get(e)?.metadata}async selectLanguageModels(e){if(e.vendor)await this._extensionService.activateByEvent(`onLanguageModelChat:${e.vendor}}`);else{const i=Array.from(this._vendors).map(n=>this._extensionService.activateByEvent(`onLanguageModelChat:${n}`));await Promise.all(i)}const t=[];for(const[i,n]of this._providers)(e.vendor===void 0||n.metadata.vendor===e.vendor)&&(e.family===void 0||n.metadata.family===e.family)&&(e.version===void 0||n.metadata.version===e.version)&&(e.id===void 0||n.metadata.id===e.id)&&(!n.metadata.targetExtensions||n.metadata.targetExtensions.some(o=>vs.equals(o,e.extension)))&&t.push(i);return this._logService.trace("[LM] selected language models",e,t),t}registerLanguageModelChat(e,t){if(this._logService.trace("[LM] registering language model chat",e,t.metadata),!this._vendors.has(t.metadata.vendor))throw new Error(`Chat response provider uses UNKNOWN vendor ${t.metadata.vendor}.`);if(this._providers.has(e))throw new Error(`Chat response provider with identifier ${e} is already registered.`);return this._providers.set(e,t),this._onDidChangeProviders.fire({added:[{identifier:e,metadata:t.metadata}]}),this.updateUserSelectableModelsContext(),Ie(()=>{this.updateUserSelectableModelsContext(),this._providers.delete(e)&&(this._onDidChangeProviders.fire({removed:[e]}),this._logService.trace("[LM] UNregistered language model chat",e,t.metadata))})}updateUserSelectableModelsContext(){const e=Array.from(this._providers.values()).some(i=>i.metadata.isUserSelectable&&!i.metadata.isDefault),t=Array.from(this._providers.values()).some(i=>i.metadata.isDefault);this._hasUserSelectableModels.set(e&&t)}async sendChatRequest(e,t,i,n,o){const r=this._providers.get(e);if(!r)throw new Error(`Chat response provider with identifier ${e} is not registered.`);return r.sendChatRequest(i,t,n,o)}computeTokenLength(e,t,i){const n=this._providers.get(e);if(!n)throw new Error(`Chat response provider with identifier ${e} is not registered.`);return n.provideTokenCount(t,i)}};sY=f([p(0,cn),p(1,Re),p(2,fe)],sY);var Tc;(function(s){s.Delimiter="\0"})(Tc||(Tc={}));var Hl;(function(s){s[s.IsSame=0]="IsSame",s[s.Disconnected=1]="Disconnected",s[s.IsChild=2]="IsChild",s[s.IsParent=3]="IsParent"})(Hl||(Hl={}));class Wn{static fromExtHostTestItem(e,t,i=e.parent){if(e._isRoot)return new Wn([t]);const n=[e.id];for(let o=i;o&&o.id!==t;o=o.parent)n.push(o.id);return n.push(t),new Wn(n.reverse())}static isRoot(e){return!e.includes(Tc.Delimiter)}static root(e){const t=e.indexOf(Tc.Delimiter);return t===-1?e:e.slice(0,t)}static fromString(e){return new Wn(e.split(Tc.Delimiter))}static join(e,t){return new Wn([...e.path,t])}static split(e){return e.split(Tc.Delimiter)}static joinToString(e,t){return e.toString()+Tc.Delimiter+t}static parentId(e){const t=e.lastIndexOf(Tc.Delimiter);return t===-1?void 0:e.slice(0,t)}static localId(e){const t=e.lastIndexOf(Tc.Delimiter);return t===-1?e:e.slice(t+Tc.Delimiter.length)}static isChild(e,t){return t[e.length]===Tc.Delimiter&&t.startsWith(e)}static compare(e,t){return e===t?Hl.IsSame:Wn.isChild(e,t)?Hl.IsChild:Wn.isChild(t,e)?Hl.IsParent:Hl.Disconnected}static getLengthOfCommonPrefix(e,t){if(e===0)return 0;let i=0;for(;i<e-1;){for(let n=1;n<e;n++){const o=t(n-1),r=t(n);if(o.path[i]!==r.path[i])return i}i++}return i}constructor(e,t=e.length){if(this.path=e,this.viewEnd=t,e.length===0||t<1)throw new Error("cannot create test with empty path")}get rootId(){return new Wn(this.path,1)}get parentId(){return this.viewEnd>1?new Wn(this.path,this.viewEnd-1):void 0}get localId(){return this.path[this.viewEnd-1]}get controllerId(){return this.path[0]}get isRoot(){return this.viewEnd===1}*idsFromRoot(){for(let e=1;e<=this.viewEnd;e++)yield new Wn(this.path,e)}*idsToRoot(){for(let e=this.viewEnd;e>0;e--)yield new Wn(this.path,e)}compare(e){if(typeof e=="string")return Wn.compare(this.toString(),e);for(let t=0;t<e.viewEnd&&t<this.viewEnd;t++)if(e.path[t]!==this.path[t])return Hl.Disconnected;return e.viewEnd>this.viewEnd?Hl.IsChild:e.viewEnd<this.viewEnd?Hl.IsParent:Hl.IsSame}toJSON(){return this.toString()}toString(){if(!this.stringifed){this.stringifed=this.path[0];for(let e=1;e<this.viewEnd;e++)this.stringifed+=Tc.Delimiter,this.stringifed+=this.path[e]}return this.stringifed}}var Oi;(function(s){s[s.Unset=0]="Unset",s[s.Queued=1]="Queued",s[s.Running=2]="Running",s[s.Passed=3]="Passed",s[s.Failed=4]="Failed",s[s.Skipped=5]="Skipped",s[s.Errored=6]="Errored"})(Oi||(Oi={}));Oi.Unset+"",Oi.Queued+"",Oi.Running+"",Oi.Passed+"",Oi.Failed+"",Oi.Skipped+"",Oi.Errored+"";var oY;(function(s){s[s.Run=1]="Run",s[s.Debug=2]="Debug",s[s.Coverage=3]="Coverage"})(oY||(oY={}));var rY;(function(s){s[s.Refresh=2]="Refresh",s[s.CodeRelatedToTest=4]="CodeRelatedToTest",s[s.TestRelatedToCode=8]="TestRelatedToCode"})(rY||(rY={}));var Lo;(function(s){s[s.Run=2]="Run",s[s.Debug=4]="Debug",s[s.Coverage=8]="Coverage",s[s.HasNonDefaultProfile=16]="HasNonDefaultProfile",s[s.HasConfigurable=32]="HasConfigurable",s[s.SupportsContinuousRun=64]="SupportsContinuousRun"})(Lo||(Lo={}));Lo.Run+"",h(11059,"Run"),Lo.Debug+"",h(11060,"Debug"),Lo.Coverage+"",h(11061,"Coverage");Lo.Run,Lo.Debug,Lo.Coverage,Lo.HasNonDefaultProfile,Lo.HasConfigurable,Lo.SupportsContinuousRun;const F8e=s=>"runId"in s;var Ry;(function(s){s.serialize=e=>({range:e.range.toJSON(),uri:e.uri.toJSON()}),s.deserialize=(e,t)=>({range:P.lift(t.range),uri:e.asCanonicalUri(R.revive(t.uri))})})(Ry||(Ry={}));var nd;(function(s){s[s.Error=0]="Error",s[s.Output=1]="Output"})(nd||(nd={}));var jA;(function(s){s.serialize=e=>({label:e.label,uri:e.uri?.toJSON(),position:e.position?.toJSON()}),s.deserialize=(e,t)=>({label:t.label,uri:t.uri?e.asCanonicalUri(R.revive(t.uri)):void 0,position:t.position?we.lift(t.position):void 0})})(jA||(jA={}));var YA;(function(s){s.serialize=e=>({message:e.message,type:nd.Error,expected:e.expected,actual:e.actual,contextValue:e.contextValue,location:e.location&&Ry.serialize(e.location),stackTrace:e.stackTrace?.map(jA.serialize)}),s.deserialize=(e,t)=>({message:t.message,type:nd.Error,expected:t.expected,actual:t.actual,contextValue:t.contextValue,location:t.location&&Ry.deserialize(e,t.location),stackTrace:t.stackTrace&&t.stackTrace.map(i=>jA.deserialize(e,i))})})(YA||(YA={}));const Gke=(s,e)=>`${e?"s":"e"}${s}`;var QA;(function(s){s.serialize=e=>({message:e.message,type:nd.Output,offset:e.offset,length:e.length,location:e.location&&Ry.serialize(e.location)}),s.deserialize=(e,t)=>({message:t.message,type:nd.Output,offset:t.offset,length:t.length,location:t.location&&Ry.deserialize(e,t.location)})})(QA||(QA={}));var nx;(function(s){s.serialize=e=>e.type===nd.Error?YA.serialize(e):QA.serialize(e),s.deserialize=(e,t)=>t.type===nd.Error?YA.deserialize(e,t):QA.deserialize(e,t),s.isDiffable=e=>e.type===nd.Error&&e.actual!==void 0&&e.expected!==void 0})(nx||(nx={}));var OC;(function(s){s.serializeWithoutMessages=e=>({state:e.state,duration:e.duration,messages:[]}),s.serialize=e=>({state:e.state,duration:e.duration,messages:e.messages.map(nx.serialize)}),s.deserialize=(e,t)=>({state:t.state,duration:t.duration,messages:t.messages.map(i=>nx.deserialize(e,i))})})(OC||(OC={}));const yce="\0",zk=(s,e)=>s+yce+e,zke=s=>{const e=s.indexOf(yce);return{ctrlId:s.slice(0,e),tagId:s.slice(e+1)}};var sx;(function(s){s.serialize=e=>({extId:e.extId,label:e.label,tags:e.tags,busy:e.busy,children:void 0,uri:e.uri?.toJSON(),range:e.range?.toJSON()||null,description:e.description,error:e.error,sortText:e.sortText}),s.deserialize=(e,t)=>({extId:t.extId,label:t.label,tags:t.tags,busy:t.busy,children:void 0,uri:t.uri?e.asCanonicalUri(R.revive(t.uri)):void 0,range:t.range?P.lift(t.range):null,description:t.description,error:t.error,sortText:t.sortText})})(sx||(sx={}));var ao;(function(s){s[s.NotExpandable=0]="NotExpandable",s[s.Expandable=1]="Expandable",s[s.BusyExpanding=2]="BusyExpanding",s[s.Expanded=3]="Expanded"})(ao||(ao={}));var vp;(function(s){s.serialize=e=>({expand:e.expand,item:sx.serialize(e.item)}),s.deserialize=(e,t)=>({controllerId:Wn.root(t.item.extId),expand:t.expand,item:sx.deserialize(e,t.item)})})(vp||(vp={}));var ox;(function(s){s.serialize=e=>{let t;return e.item&&(t={},e.item.label!==void 0&&(t.label=e.item.label),e.item.tags!==void 0&&(t.tags=e.item.tags),e.item.busy!==void 0&&(t.busy=e.item.busy),e.item.uri!==void 0&&(t.uri=e.item.uri?.toJSON()),e.item.range!==void 0&&(t.range=e.item.range?.toJSON()),e.item.description!==void 0&&(t.description=e.item.description),e.item.error!==void 0&&(t.error=e.item.error),e.item.sortText!==void 0&&(t.sortText=e.item.sortText)),{extId:e.extId,expand:e.expand,item:t}},s.deserialize=e=>{let t;return e.item&&(t={},e.item.label!==void 0&&(t.label=e.item.label),e.item.tags!==void 0&&(t.tags=e.item.tags),e.item.busy!==void 0&&(t.busy=e.item.busy),e.item.range!==void 0&&(t.range=e.item.range?P.lift(e.item.range):null),e.item.description!==void 0&&(t.description=e.item.description),e.item.error!==void 0&&(t.error=e.item.error),e.item.sortText!==void 0&&(t.sortText=e.item.sortText)),{extId:e.extId,expand:e.expand,item:t}}})(ox||(ox={}));const BB=(s,e)=>{e.expand!==void 0&&(s.expand=e.expand),e.item!==void 0&&(s.item=s.item?Object.assign(s.item,e.item):e.item)};var XA;(function(s){s.serializeWithoutMessages=e=>({...vp.serialize(e),ownComputedState:e.ownComputedState,computedState:e.computedState,tasks:e.tasks.map(OC.serializeWithoutMessages)}),s.serialize=e=>({...vp.serialize(e),ownComputedState:e.ownComputedState,computedState:e.computedState,tasks:e.tasks.map(OC.serialize)}),s.deserialize=(e,t)=>({...vp.deserialize(e,t),ownComputedState:t.ownComputedState,computedState:t.computedState,tasks:t.tasks.map(i=>OC.deserialize(e,i)),retired:!0})})(XA||(XA={}));var VB;(function(s){s.empty=()=>({covered:0,total:0}),s.sum=(e,t)=>{e.covered+=t.covered,e.total+=t.total}})(VB||(VB={}));var HB;(function(s){s.serialize=e=>({id:e.id,statement:e.statement,branch:e.branch,declaration:e.declaration,testIds:e.testIds,uri:e.uri.toJSON()}),s.deserialize=(e,t)=>({id:t.id,statement:t.statement,branch:t.branch,declaration:t.declaration,testIds:t.testIds,uri:e.asCanonicalUri(R.revive(t.uri))}),s.empty=(e,t)=>({id:e,uri:t,statement:VB.empty()})})(HB||(HB={}));function MK(s){return{...s,location:s.location?.toJSON()}}function NK(s){return s.location=s.location?we.isIPosition(s.location)?we.lift(s.location):P.lift(s.location):void 0,s}var Pm;(function(s){s[s.Declaration=0]="Declaration",s[s.Statement=1]="Statement",s[s.Branch=2]="Branch"})(Pm||(Pm={}));var UB;(function(s){s.serialize=e=>e.type===Pm.Declaration?JA.serialize(e):eR.serialize(e),s.deserialize=e=>e.type===Pm.Declaration?JA.deserialize(e):eR.deserialize(e)})(UB||(UB={}));var ZA;(function(s){s.serialize=MK,s.deserialize=NK})(ZA||(ZA={}));var JA;(function(s){s.serialize=MK,s.deserialize=NK})(JA||(JA={}));var eR;(function(s){s.serialize=e=>({...MK(e),branches:e.branches?.map(ZA.serialize)}),s.deserialize=e=>({...NK(e),branches:e.branches?.map(ZA.deserialize)})})(eR||(eR={}));var En;(function(s){s[s.Add=0]="Add",s[s.Update=1]="Update",s[s.DocumentSynced=2]="DocumentSynced",s[s.Remove=3]="Remove",s[s.IncrementPendingExtHosts=4]="IncrementPendingExtHosts",s[s.Retire=5]="Retire",s[s.AddTag=6]="AddTag",s[s.RemoveTag=7]="RemoveTag"})(En||(En={}));var tR;(function(s){s.deserialize=(e,t)=>t.op===En.Add?{op:t.op,item:vp.deserialize(e,t.item)}:t.op===En.Update?{op:t.op,item:ox.deserialize(t.item)}:t.op===En.DocumentSynced?{op:t.op,uri:e.asCanonicalUri(R.revive(t.uri)),docv:t.docv}:t,s.serialize=e=>e.op===En.Add?{op:e.op,item:vp.serialize(e.item)}:e.op===En.Update?{op:e.op,item:ox.serialize(e.item)}:e})(tR||(tR={}));class W8e{constructor(e){this.uriIdentity=e,this._tags=new Map,this.items=new Map,this.roots=new Set,this.busyControllerCount=0,this.pendingRootCount=0,this.tags=this._tags}apply(e){const t=this.createChangeCollector();for(const i of e)switch(i.op){case En.Add:this.add(vp.deserialize(this.uriIdentity,i.item),t);break;case En.Update:this.update(ox.deserialize(i.item),t);break;case En.Remove:this.remove(i.itemId,t);break;case En.Retire:this.retireTest(i.itemId);break;case En.IncrementPendingExtHosts:this.updatePendingRoots(i.amount);break;case En.AddTag:this._tags.set(i.tag.id,i.tag);break;case En.RemoveTag:this._tags.delete(i.id);break}t.complete?.()}add(e,t){const i=Wn.parentId(e.item.extId)?.toString();let n;if(!i)n=this.createItem(e),this.roots.add(n),this.items.set(e.item.extId,n);else if(this.items.has(i)){const o=this.items.get(i);o.children.add(e.item.extId),n=this.createItem(e,o),this.items.set(e.item.extId,n)}else{console.error(`Test with unknown parent ID: ${JSON.stringify(e)}`);return}return t.add?.(n),e.expand===ao.BusyExpanding&&this.busyControllerCount++,n}update(e,t){const i=this.items.get(e.extId);if(i)return e.expand!==void 0&&(i.expand===ao.BusyExpanding&&this.busyControllerCount--,e.expand===ao.BusyExpanding&&this.busyControllerCount++),BB(i,e),t.update?.(i),i}remove(e,t){const i=this.items.get(e);if(!i)return;const n=Wn.parentId(i.item.extId)?.toString();n?this.items.get(n).children.delete(i.item.extId):this.roots.delete(i);const o=[[e]];for(;o.length;)for(const r of o.pop()){const a=this.items.get(r);a&&(o.push(a.children),this.items.delete(r),t.remove?.(a,a!==i),a.expand===ao.BusyExpanding&&this.busyControllerCount--)}}retireTest(e){}updatePendingRoots(e){this.pendingRootCount+=e}createChangeCollector(){return{}}}var Xr;(function(s){s[s.Upsert=0]="Upsert",s[s.SetTags=1]="SetTags",s[s.UpdateCanResolveChildren=2]="UpdateCanResolveChildren",s[s.RemoveChild=3]="RemoveChild",s[s.SetProp=4]="SetProp",s[s.Bulk=5]="Bulk",s[s.DocumentSynced=6]="DocumentSynced"})(Xr||(Xr={}));const DS=(s,e)=>s===e,qke={range:(s,e)=>s===e?!0:!s||!e?!1:s.equalsRange(e),busy:DS,label:DS,description:DS,error:DS,sortText:DS,tags:(s,e)=>!(s.length!==e.length||s.some(t=>!e.includes(t)))},Kke=Object.entries(qke),jke=(s,e)=>{let t;for(const[i,n]of Kke)n(s[i],e[i])||(t?t[i]=e[i]:t={[i]:e[i]});return t};class B8e extends F{get root(){return this.options.root}constructor(e){super(),this.options=e,this.debounceSendDiff=this._register(new yn(()=>this.flushDiff(),200)),this.diffOpEmitter=this._register(new M),this.tree=new Map,this.tags=new Map,this.diff=[],this.onDidGenerateDiff=this.diffOpEmitter.event,this.root.canResolveChildren=!0,this.upsertItem(this.root,void 0)}set resolveHandler(e){this._resolveHandler=e;for(const t of this.tree.values())this.updateExpandability(t)}get resolveHandler(){return this._resolveHandler}collectDiff(){const e=this.diff;return this.diff=[],e}pushDiff(e){switch(e.op){case En.DocumentSynced:{for(const t of this.diff)if(t.op===En.DocumentSynced&&t.uri===e.uri){t.docv=e.docv;return}break}case En.Update:{const t=this.diff[this.diff.length-1];if(t){if(t.op===En.Update&&t.item.extId===e.item.extId){BB(t.item,e.item);return}if(t.op===En.Add&&t.item.item.extId===e.item.extId){BB(t.item,e.item);return}}break}}this.diff.push(e),this.debounceSendDiff.isScheduled()||this.debounceSendDiff.schedule()}expand(e,t){const i=this.tree.get(e);if(i){if((i.expandLevels===void 0||t>i.expandLevels)&&(i.expandLevels=t),i.expand===ao.Expandable){const n=this.resolveChildren(i);return n.isOpen()?this.expandChildren(i,t-1):n.wait().then(()=>this.expandChildren(i,t-1))}else if(i.expand===ao.Expanded)return i.resolveBarrier?.isOpen()===!1?i.resolveBarrier.wait().then(()=>this.expandChildren(i,t-1)):this.expandChildren(i,t-1)}}dispose(){for(const e of this.tree.values())this.options.getApiFor(e.actual).listener=void 0;this.tree.clear(),this.diff=[],super.dispose()}onTestItemEvent(e,t){switch(t.op){case Xr.RemoveChild:this.removeItem(Wn.joinToString(e.fullId,t.id));break;case Xr.Upsert:this.upsertItem(t.item,e);break;case Xr.Bulk:for(const i of t.ops)this.onTestItemEvent(e,i);break;case Xr.SetTags:this.diffTagRefs(t.new,t.old,e.fullId.toString());break;case Xr.UpdateCanResolveChildren:this.updateExpandability(e);break;case Xr.SetProp:this.pushDiff({op:En.Update,item:{extId:e.fullId.toString(),item:t.update}});break;case Xr.DocumentSynced:this.documentSynced(e.actual.uri);break;default:sd()}}documentSynced(e){e&&this.pushDiff({op:En.DocumentSynced,uri:e,docv:this.options.getDocumentVersion(e)})}upsertItem(e,t){const i=Wn.fromExtHostTestItem(e,this.root.id,t?.actual),n=this.options.getApiFor(e);n.parent&&n.parent!==t?.actual&&this.options.getChildren(n.parent).delete(e.id);let o=this.tree.get(i.toString());if(!o){o={fullId:i,actual:e,expandLevels:t?.expandLevels?t.expandLevels-1:void 0,expand:ao.NotExpandable},e.tags.forEach(this.incrementTagRefs,this),this.tree.set(o.fullId.toString(),o),this.setItemParent(e,t),this.pushDiff({op:En.Add,item:{controllerId:this.options.controllerId,expand:o.expand,item:this.options.toITestItem(e)}}),this.connectItemAndChildren(e,o,t);return}if(o.actual===e){this.connectItem(e,o,t);return}if(o.actual.uri?.toString()!==e.uri?.toString())return this.removeItem(i.toString()),this.upsertItem(e,t);const r=this.options.getChildren(o.actual),a=o.actual,c=jke(this.options.toITestItem(a),this.options.toITestItem(e));this.options.getApiFor(a).listener=void 0,o.actual=e,o.resolveBarrier=void 0,o.expand=ao.NotExpandable,c&&(c.hasOwnProperty("tags")&&(this.diffTagRefs(e.tags,a.tags,i.toString()),delete c.tags),this.onTestItemEvent(o,{op:Xr.SetProp,update:c})),this.connectItemAndChildren(e,o,t);for(const[l,u]of r)this.options.getChildren(e).get(u.id)||this.removeItem(Wn.joinToString(i,u.id));const d=o.expandLevels;d!==void 0&&queueMicrotask(()=>{o.expand===ao.Expandable&&(o.expandLevels=void 0,this.expand(i.toString(),d))}),this.documentSynced(o.actual.uri)}diffTagRefs(e,t,i){const n=new Set(t.map(o=>o.id));for(const o of e)n.delete(o.id)||this.incrementTagRefs(o);this.pushDiff({op:En.Update,item:{extId:i,item:{tags:e.map(o=>zk(this.options.controllerId,o.id))}}}),n.forEach(this.decrementTagRefs,this)}incrementTagRefs(e){const t=this.tags.get(e.id);t?t.refCount++:(this.tags.set(e.id,{refCount:1}),this.pushDiff({op:En.AddTag,tag:{id:zk(this.options.controllerId,e.id)}}))}decrementTagRefs(e){const t=this.tags.get(e);t&&!--t.refCount&&(this.tags.delete(e),this.pushDiff({op:En.RemoveTag,id:zk(this.options.controllerId,e)}))}setItemParent(e,t){this.options.getApiFor(e).parent=t&&t.actual!==this.root?t.actual:void 0}connectItem(e,t,i){this.setItemParent(e,i);const n=this.options.getApiFor(e);n.parent=i?.actual,n.listener=o=>this.onTestItemEvent(t,o),this.updateExpandability(t)}connectItemAndChildren(e,t,i){this.connectItem(e,t,i);for(const[n,o]of this.options.getChildren(e))this.upsertItem(o,t)}updateExpandability(e){let t;this._resolveHandler?e.resolveBarrier?t=e.resolveBarrier.isOpen()?ao.Expanded:ao.BusyExpanding:t=e.actual.canResolveChildren?ao.Expandable:ao.NotExpandable:t=ao.NotExpandable,t!==e.expand&&(e.expand=t,this.pushDiff({op:En.Update,item:{extId:e.fullId.toString(),expand:t}}),t===ao.Expandable&&e.expandLevels!==void 0&&this.resolveChildren(e))}expandChildren(e,t){if(t<0)return;const i=[];for(const[n,o]of this.options.getChildren(e.actual)){const r=this.expand(Wn.joinToString(e.fullId,o.id),t);BT(r)&&i.push(r)}if(i.length)return Promise.all(i).then(()=>{})}resolveChildren(e){if(e.resolveBarrier)return e.resolveBarrier;if(!this._resolveHandler){const o=new Rp;return o.open(),o}e.expand=ao.BusyExpanding,this.pushExpandStateUpdate(e);const t=e.resolveBarrier=new Rp,i=o=>{console.error(`Unhandled error in resolveHandler of test controller "${this.options.controllerId}"`,o)};let n;try{n=this._resolveHandler(e.actual===this.root?void 0:e.actual)}catch(o){i(o)}return BT(n)?n.catch(i).then(()=>{t.open(),this.updateExpandability(e)}):(t.open(),this.updateExpandability(e)),e.resolveBarrier}pushExpandStateUpdate(e){this.pushDiff({op:En.Update,item:{extId:e.fullId.toString(),expand:e.expand}})}removeItem(e){const t=this.tree.get(e);if(!t)throw new Error("attempting to remove non-existent child");this.pushDiff({op:En.Remove,itemId:e});const i=[t];for(;i.length;){const n=i.pop();if(n){this.options.getApiFor(n.actual).listener=void 0;for(const o of n.actual.tags)this.decrementTagRefs(o.id);this.tree.delete(n.fullId.toString());for(const[o,r]of this.options.getChildren(n.actual))i.push(this.tree.get(Wn.joinToString(n.fullId,r.id)))}}}flushDiff(){const e=this.collectDiff();e.length&&this.diffOpEmitter.fire(e)}}class Yke extends Error{constructor(e){super(`Attempted to insert a duplicate test item ID ${e}`)}}class $B extends Error{constructor(e){super(`TestItem with ID "${e}" is invalid. Make sure to create it from the createTestItem method.`)}}class Qke extends Error{constructor(e,t,i){super(`TestItem with ID "${e}" is from controller "${t}" and cannot be added as a child of an item from controller "${i}".`)}}const V8e=(s,e,t)=>{let i=new Map;return{get size(){return i.size},forEach(n,o){for(const r of i.values())n.call(o,r,this)},[Symbol.iterator](){return i.entries()},replace(n){const o=new Map,r=new Set(i.keys()),a={op:Xr.Bulk,ops:[]};for(const c of n){if(!(c instanceof t))throw new $B(c.id);const d=e(c).controllerId;if(d!==s.controllerId)throw new Qke(c.id,d,s.controllerId);if(o.has(c.id))throw new Yke(c.id);o.set(c.id,c),r.delete(c.id),a.ops.push({op:Xr.Upsert,item:c})}for(const c of r.keys())a.ops.push({op:Xr.RemoveChild,id:c});s.listener?.(a),i=o},add(n){if(!(n instanceof t))throw new $B(n.id);i.set(n.id,n),s.listener?.({op:Xr.Upsert,item:n})},delete(n){i.delete(n)&&s.listener?.({op:Xr.RemoveChild,id:n})},get(n){return i.get(n)},toJSON(){return Array.from(i.values())}}},wce=new WeakMap,H8e=(s,e)=>{const t={controllerId:e};return wce.set(s,t),t},Xke=s=>{const e=wce.get(s);if(!e)throw new $B(s?.id||"<unknown>");return e};var Yg;(function(s){s[s.EMBEDDED=1]="EMBEDDED",s[s.LLM_RANKED=2]="LLM_RANKED",s[s.CANCELED=3]="CANCELED"})(Yg||(Yg={}));function U8e(s,e){return vs.toKey(s)+"/"+e}var aY;(function(s){s[s.WorkspaceFolder=0]="WorkspaceFolder",s[s.Workspace=100]="Workspace",s[s.User=200]="User",s[s.Extension=300]="Extension",s[s.Filesystem=400]="Filesystem",s[s.RemoteBoost=-50]="RemoteBoost"})(aY||(aY={}));var cY;(function(s){function e(t,i){return t.id===i.id&&t.remoteAuthority===i.remoteAuthority&&t.label===i.label&&t.isTrustedByDefault===i.isTrustedByDefault}s.equals=e})(cY||(cY={}));var GB;(function(s){function e(n){return n}s.toSerialized=e;function t(n){return{id:n.id,label:n.label,cacheNonce:n.cacheNonce,launch:ax.fromSerialized(n.launch),variableReplacement:n.variableReplacement?zB.fromSerialized(n.variableReplacement):void 0}}s.fromSerialized=t;function i(n,o){return n.id===o.id&&n.label===o.label&&rs(n.roots,o.roots,(r,a)=>r.toString()===a.toString())&&ic(n.launch,o.launch)&&ic(n.presentation,o.presentation)&&ic(n.variableReplacement,o.variableReplacement)}s.equals=i})(GB||(GB={}));var zB;(function(s){function e(i){return i}s.toSerialized=e;function t(i){return{section:i.section,folder:i.folder?{...i.folder,uri:R.revive(i.folder.uri)}:void 0,target:i.target}}s.fromSerialized=t})(zB||(zB={}));var rx;(function(s){s[s.HasUnknown=0]="HasUnknown",s[s.LoadingUnknown=1]="LoadingUnknown",s[s.AllKnown=2]="AllKnown"})(rx||(rx={}));var _p;(function(s){s[s.Unknown=0]="Unknown",s[s.Cached=1]="Cached",s[s.Outdated=2]="Outdated",s[s.RefreshingFromUnknown=3]="RefreshingFromUnknown",s[s.RefreshingFromCached=4]="RefreshingFromCached",s[s.Live=5]="Live"})(_p||(_p={}));var hv;(function(s){s[s.Stdio=1]="Stdio",s[s.HTTP=2]="HTTP"})(hv||(hv={}));var ax;(function(s){function e(i){return i}s.toSerialized=e;function t(i){switch(i.type){case hv.HTTP:return{type:i.type,uri:R.revive(i.uri),headers:i.headers};case hv.Stdio:return{type:i.type,cwd:i.cwd?R.revive(i.cwd):void 0,command:i.command,args:i.args,env:i.env,envFile:i.envFile}}}s.fromSerialized=t})(ax||(ax={}));var Xc;(function(s){let e;(function(t){t[t.Stopped=0]="Stopped",t[t.Starting=1]="Starting",t[t.Running=2]="Running",t[t.Error=3]="Error"})(e=s.Kind||(s.Kind={})),s.toString=t=>{switch(t.state){case e.Stopped:return h(7759,"Stopped");case e.Starting:return h(7760,"Starting");case e.Running:return h(7761,"Running");case e.Error:return h(7762,"Error {0}",t.message);default:sd()}},s.toKindString=t=>{switch(t){case e.Stopped:return"stopped";case e.Starting:return"starting";case e.Running:return"running";case e.Error:return"error";default:sd()}},s.canBeStarted=t=>t===e.Error||t===e.Stopped,s.isRunning=t=>!s.canBeStarted(t.state)})(Xc||(Xc={}));var dY;(function(s){function e(i){const{selectionStartLineNumber:n,selectionStartColumn:o,positionLineNumber:r,positionColumn:a}=i,c=new rn(n-1,o-1),d=new rn(r-1,a-1);return new pW(c,d)}s.to=e;function t(i){const{anchor:n,active:o}=i;return{selectionStartLineNumber:n.line+1,selectionStartColumn:n.character+1,positionLineNumber:o.line+1,positionColumn:o.character+1}}s.from=t})(dY||(dY={}));var rt;(function(s){function e(i){if(!i)return;const{start:n,end:o}=i;return{startLineNumber:n.line+1,startColumn:n.character+1,endLineNumber:o.line+1,endColumn:o.character+1}}s.from=e;function t(i){if(!i)return;const{startLineNumber:n,startColumn:o,endLineNumber:r,endColumn:a}=i;return new ms(n-1,o-1,r-1,a-1)}s.to=t})(rt||(rt={}));var vh;(function(s){function e(i){return{uri:i.uri,range:rt.from(i.range)}}s.from=e;function t(i){return new sv(R.revive(i.uri),rt.to(i.range))}s.to=t})(vh||(vh={}));var lY;(function(s){function e(t){switch(t){case jc.Comment:return sb.Comment;case jc.Other:return sb.Other;case jc.RegEx:return sb.RegEx;case jc.String:return sb.String}}s.to=e})(lY||(lY={}));var Py;(function(s){function e(i){return new rn(i.lineNumber-1,i.column-1)}s.to=e;function t(i){return{lineNumber:i.line+1,column:i.character+1}}s.from=t})(Py||(Py={}));var hY;(function(s){function e(n,o,r){return $t(fw(n).map(a=>t(a,o,r)))}s.from=e;function t(n,o,r){if(typeof n=="string")return{$serialized:!0,language:n,isBuiltin:r?.isBuiltin};if(n)return{$serialized:!0,language:n.language,scheme:i(n.scheme,o),pattern:Xl.from(n.pattern)??void 0,exclusive:n.exclusive,notebookType:n.notebookType,isBuiltin:r?.isBuiltin}}function i(n,o){return o&&typeof n=="string"?o.transformOutgoingScheme(n):n}})(hY||(hY={}));var iR;(function(s){function e(i){switch(i){case eb.Unnecessary:return ND.Unnecessary;case eb.Deprecated:return ND.Deprecated}}s.from=e;function t(i){switch(i){case ND.Unnecessary:return eb.Unnecessary;case ND.Deprecated:return eb.Deprecated;default:return}}s.to=t})(iR||(iR={}));var uY;(function(s){function e(i){let n;return i.code&&(Tt(i.code)||ec(i.code)?n=String(i.code):n={value:String(i.code.value),target:i.code.target}),{...rt.from(i.range),message:i.message,source:i.source,code:n,severity:cx.from(i.severity),relatedInformation:i.relatedInformation&&i.relatedInformation.map(nR.from),tags:Array.isArray(i.tags)?$t(i.tags.map(iR.from)):void 0}}s.from=e;function t(i){const n=new mW(rt.to(i),i.message,cx.to(i.severity));return n.source=i.source,n.code=Tt(i.code)?i.code:i.code?.value,n.relatedInformation=i.relatedInformation&&i.relatedInformation.map(nR.to),n.tags=i.tags&&$t(i.tags.map(iR.to)),n}s.to=t})(uY||(uY={}));var nR;(function(s){function e(i){return{...rt.from(i.location.range),message:i.message,resource:i.location.uri}}s.from=e;function t(i){return new _A(new sv(i.resource,rt.to(i)),i.message)}s.to=t})(nR||(nR={}));var cx;(function(s){function e(i){switch(i){case Ga.Error:return Bn.Error;case Ga.Warning:return Bn.Warning;case Ga.Information:return Bn.Info;case Ga.Hint:return Bn.Hint}return Bn.Error}s.from=e;function t(i){switch(i){case Bn.Info:return Ga.Information;case Bn.Warning:return Ga.Warning;case Bn.Error:return Ga.Error;case Bn.Hint:return Ga.Hint;default:return Ga.Error}}s.to=t})(cx||(cx={}));var gY;(function(s){function e(i){return typeof i=="number"&&i>=CA.One?i-1:i===CA.Beside?Rr:ol}s.from=e;function t(i){if(typeof i=="number"&&i>=0)return i+1;throw new Error("invalid 'EditorGroupColumn'")}s.to=t})(gY||(gY={}));function Zke(s){return typeof s.range<"u"}function Jke(s){return s.length===0?!0:!!Zke(s[0])}var Mn;(function(s){function e(a){return a.map(s.from)}s.fromMany=e;function t(a){return a&&typeof a=="object"&&typeof a.language=="string"&&typeof a.value=="string"}function i(a){let c;if(t(a)){const{language:u,value:g}=a;c={value:"```"+u+`
`+g+"\n```\n"}}else Up.isMarkdownString(a)?c={value:a.value,isTrusted:a.isTrusted,supportThemeIcons:a.supportThemeIcons,supportHtml:a.supportHtml,baseUri:a.baseUri}:typeof a=="string"?c={value:a}:c={value:""};const d=Object.create(null);c.uris=d;const l=({href:u})=>{try{let g=R.parse(u,!0);g=g.with({query:n(g.query,d)}),d[u]=g}catch{}return""};return F6.walkTokens(F6.lexer(c.value),u=>{u.type==="link"?l({href:u.href}):u.type==="image"&&typeof u.href=="string"&&l(Rme(u.href))}),c}s.from=i;function n(a,c){if(!a)return a;let d;try{d=nne(a)}catch{}if(!d)return a;let l=!1;return d=xF(d,u=>{if(R.isUri(u)){const g=`__uri_${Math.random().toString(16).slice(2,8)}`;return c[g]=u,l=!0,g}else return}),l?JSON.stringify(d):a}function o(a){const c=new Up(a.value,a.supportThemeIcons);return c.isTrusted=a.isTrusted,c.supportHtml=a.supportHtml,c.baseUri=a.baseUri?R.from(a.baseUri):void 0,c}s.to=o;function r(a){if(a)return typeof a=="string"?a:s.from(a)}s.fromStrict=r})(Mn||(Mn={}));function $8e(s){return Jke(s)?s.map(e=>({range:rt.from(e.range),hoverMessage:Array.isArray(e.hoverMessage)?Mn.fromMany(e.hoverMessage):e.hoverMessage?Mn.from(e.hoverMessage):void 0,renderOptions:e.renderOptions})):s.map(e=>({range:rt.from(e)}))}function OK(s){return typeof s>"u"?s:typeof s=="string"?R.file(s):s}var Ly;(function(s){function e(t){return typeof t>"u"?t:{contentText:t.contentText,contentIconPath:t.contentIconPath?OK(t.contentIconPath):void 0,border:t.border,borderColor:t.borderColor,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,color:t.color,backgroundColor:t.backgroundColor,margin:t.margin,width:t.width,height:t.height}}s.from=e})(Ly||(Ly={}));var sR;(function(s){function e(t){return typeof t>"u"?t:{backgroundColor:t.backgroundColor,outline:t.outline,outlineColor:t.outlineColor,outlineStyle:t.outlineStyle,outlineWidth:t.outlineWidth,border:t.border,borderColor:t.borderColor,borderRadius:t.borderRadius,borderSpacing:t.borderSpacing,borderStyle:t.borderStyle,borderWidth:t.borderWidth,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,cursor:t.cursor,color:t.color,opacity:t.opacity,letterSpacing:t.letterSpacing,gutterIconPath:t.gutterIconPath?OK(t.gutterIconPath):void 0,gutterIconSize:t.gutterIconSize,overviewRulerColor:t.overviewRulerColor,before:t.before?Ly.from(t.before):void 0,after:t.after?Ly.from(t.after):void 0}}s.from=e})(sR||(sR={}));var qB;(function(s){function e(t){if(typeof t>"u")return t;switch(t){case ib.OpenOpen:return ki.AlwaysGrowsWhenTypingAtEdges;case ib.ClosedClosed:return ki.NeverGrowsWhenTypingAtEdges;case ib.OpenClosed:return ki.GrowsOnlyWhenTypingBefore;case ib.ClosedOpen:return ki.GrowsOnlyWhenTypingAfter}}s.from=e})(qB||(qB={}));var pY;(function(s){function e(t){return{isWholeLine:t.isWholeLine,rangeBehavior:t.rangeBehavior?qB.from(t.rangeBehavior):void 0,overviewRulerLane:t.overviewRulerLane,light:t.light?sR.from(t.light):void 0,dark:t.dark?sR.from(t.dark):void 0,backgroundColor:t.backgroundColor,outline:t.outline,outlineColor:t.outlineColor,outlineStyle:t.outlineStyle,outlineWidth:t.outlineWidth,border:t.border,borderColor:t.borderColor,borderRadius:t.borderRadius,borderSpacing:t.borderSpacing,borderStyle:t.borderStyle,borderWidth:t.borderWidth,fontStyle:t.fontStyle,fontWeight:t.fontWeight,textDecoration:t.textDecoration,cursor:t.cursor,color:t.color,opacity:t.opacity,letterSpacing:t.letterSpacing,gutterIconPath:t.gutterIconPath?OK(t.gutterIconPath):void 0,gutterIconSize:t.gutterIconSize,overviewRulerColor:t.overviewRulerColor,before:t.before?Ly.from(t.before):void 0,after:t.after?Ly.from(t.after):void 0}}s.from=e})(pY||(pY={}));var Jd;(function(s){function e(i){return{text:i.newText,eol:i.newEol&&lR.from(i.newEol),range:rt.from(i.range)}}s.from=e;function t(i){const n=new by(rt.to(i.range),i.text);return n.newEol=typeof i.eol>"u"?void 0:lR.to(i.eol),n}s.to=t})(Jd||(Jd={}));var fY;(function(s){function e(i,n){const o={edits:[]};if(i instanceof vA){const r=new Mp;for(const a of i._allEntries())a._type===ts.File&&R.isUri(a.to)&&a.from===void 0&&r.add(a.to);for(const a of i._allEntries())if(a._type===ts.File){let c;a.options?.contents&&(ArrayBuffer.isView(a.options.contents)?c={type:"base64",value:Zx(Le.wrap(a.options.contents))}:c={type:"dataTransferItem",id:a.options.contents._itemId}),o.edits.push({oldResource:a.from,newResource:a.to,options:{...a.options,contents:c},metadata:a.metadata})}else a._type===ts.Text?o.edits.push({resource:a.uri,textEdit:Jd.from(a.edit),versionId:r.has(a.uri)?void 0:n?.getTextDocumentVersion(a.uri),metadata:a.metadata}):a._type===ts.Snippet?o.edits.push({resource:a.uri,textEdit:{range:rt.from(a.range),text:a.edit.value,insertAsSnippet:!0,keepWhitespace:a.keepWhitespace},versionId:r.has(a.uri)?void 0:n?.getTextDocumentVersion(a.uri),metadata:a.metadata}):a._type===ts.Cell?o.edits.push({metadata:a.metadata,resource:a.uri,cellEdit:a.edit,notebookVersionId:n?.getNotebookDocumentVersion(a.uri)}):a._type===ts.CellReplace&&o.edits.push({metadata:a.metadata,resource:a.uri,notebookVersionId:n?.getNotebookDocumentVersion(a.uri),cellEdit:{editType:sl.Replace,index:a.index,count:a.count,cells:a.cells.map(Ny.from)}})}return o}s.from=e;function t(i){const n=new vA,o=new In;for(const r of i.edits)if(r.textEdit){const a=r,c=R.revive(a.resource),d=rt.to(a.textEdit.range),l=a.textEdit.text,u=a.textEdit.insertAsSnippet;let g;u?g=Wb.replace(d,new BE(l)):g=by.replace(d,l);const m=o.get(c);m?m.push(g):o.set(c,[g])}else n.renameFile(R.revive(r.oldResource),R.revive(r.newResource),r.options);for(const[r,a]of o)n.set(r,a);return n}s.to=t})(fY||(fY={}));var Th;(function(s){const e=Object.create(null);e[hn.File]=kt.File,e[hn.Module]=kt.Module,e[hn.Namespace]=kt.Namespace,e[hn.Package]=kt.Package,e[hn.Class]=kt.Class,e[hn.Method]=kt.Method,e[hn.Property]=kt.Property,e[hn.Field]=kt.Field,e[hn.Constructor]=kt.Constructor,e[hn.Enum]=kt.Enum,e[hn.Interface]=kt.Interface,e[hn.Function]=kt.Function,e[hn.Variable]=kt.Variable,e[hn.Constant]=kt.Constant,e[hn.String]=kt.String,e[hn.Number]=kt.Number,e[hn.Boolean]=kt.Boolean,e[hn.Array]=kt.Array,e[hn.Object]=kt.Object,e[hn.Key]=kt.Key,e[hn.Null]=kt.Null,e[hn.EnumMember]=kt.EnumMember,e[hn.Struct]=kt.Struct,e[hn.Event]=kt.Event,e[hn.Operator]=kt.Operator,e[hn.TypeParameter]=kt.TypeParameter;function t(n){return typeof e[n]=="number"?e[n]:kt.Property}s.from=t;function i(n){for(const o in e)if(e[o]===n)return Number(o);return hn.Property}s.to=i})(Th||(Th={}));var zp;(function(s){function e(i){switch(i){case yA.Deprecated:return EF.Deprecated}}s.from=e;function t(i){switch(i){case EF.Deprecated:return yA.Deprecated}}s.to=t})(zp||(zp={}));var oR;(function(s){function e(i){return{name:i.name,kind:Th.from(i.kind),tags:i.tags&&i.tags.map(zp.from),containerName:i.containerName,location:My.from(i.location)}}s.from=e;function t(i){const n=new wW(i.name,Th.to(i.kind),i.containerName,My.to(i.location));return n.tags=i.tags&&i.tags.map(zp.to),n}s.to=t})(oR||(oR={}));var mY;(function(s){function e(i){const n={name:i.name||"!!MISSING: name!!",detail:i.detail,range:rt.from(i.range),selectionRange:rt.from(i.selectionRange),kind:Th.from(i.kind),tags:i.tags?.map(zp.from)??[]};return i.children&&(n.children=i.children.map(e)),n}s.from=e;function t(i){const n=new SW(i.name,i.detail,Th.to(i.kind),rt.to(i.range),rt.to(i.selectionRange));return An(i.tags)&&(n.tags=i.tags.map(zp.to)),i.children&&(n.children=i.children.map(t)),n}s.to=t})(mY||(mY={}));var rR;(function(s){function e(i){const n=new jCe(Th.to(i.kind),i.name,i.detail||"",R.revive(i.uri),rt.to(i.range),rt.to(i.selectionRange));return n._sessionId=i._sessionId,n._itemId=i._itemId,n}s.to=e;function t(i,n,o){if(n=n??i._sessionId,o=o??i._itemId,n===void 0||o===void 0)throw new Error("invalid item");return{_sessionId:n,_itemId:o,name:i.name,detail:i.detail,kind:Th.from(i.kind),uri:i.uri,range:rt.from(i.range),selectionRange:rt.from(i.selectionRange),tags:i.tags?.map(zp.from)}}s.from=t})(rR||(rR={}));var vY;(function(s){function e(t){return new YCe(rR.to(t.from),t.fromRanges.map(i=>rt.to(i)))}s.to=e})(vY||(vY={}));var _Y;(function(s){function e(t){return new QCe(rR.to(t.to),t.fromRanges.map(i=>rt.to(i)))}s.to=e})(_Y||(_Y={}));var My;(function(s){function e(i){return{range:i.range&&rt.from(i.range),uri:i.uri}}s.from=e;function t(i){return new sv(R.revive(i.uri),rt.to(i.range))}s.to=t})(My||(My={}));var bY;(function(s){function e(i){const n=i,o=i;return{originSelectionRange:n.originSelectionRange?rt.from(n.originSelectionRange):void 0,uri:n.targetUri?n.targetUri:o.uri,range:rt.from(n.targetRange?n.targetRange:o.range),targetSelectionRange:n.targetSelectionRange?rt.from(n.targetSelectionRange):void 0}}s.from=e;function t(i){return{targetUri:R.revive(i.uri),targetRange:rt.to(i.range),targetSelectionRange:i.targetSelectionRange?rt.to(i.targetSelectionRange):void 0,originSelectionRange:i.originSelectionRange?rt.to(i.originSelectionRange):void 0}}s.to=t})(bY||(bY={}));var yY;(function(s){function e(i){return{range:rt.from(i.range),contents:Mn.fromMany(i.contents),canIncreaseVerbosity:i.canIncreaseVerbosity,canDecreaseVerbosity:i.canDecreaseVerbosity}}s.from=e;function t(i){const n=i.contents.map(Mn.to),o=rt.to(i.range),r=i.canIncreaseVerbosity,a=i.canDecreaseVerbosity;return new _W(n,o,r,a)}s.to=t})(yY||(yY={}));var wY;(function(s){function e(i){return{range:rt.from(i.range),expression:i.expression}}s.from=e;function t(i){return new MW(rt.to(i.range),i.expression)}s.to=t})(wY||(wY={}));var SY;(function(s){function e(i){if(i instanceof NW)return{type:"text",range:rt.from(i.range),text:i.text};if(i instanceof OW)return{type:"variable",range:rt.from(i.range),variableName:i.variableName,caseSensitiveLookup:i.caseSensitiveLookup};if(i instanceof FW)return{type:"expression",range:rt.from(i.range),expression:i.expression};throw new Error("Unknown 'InlineValue' type")}s.from=e;function t(i){switch(i.type){case"text":return{range:rt.to(i.range),text:i.text};case"variable":return{range:rt.to(i.range),variableName:i.variableName,caseSensitiveLookup:i.caseSensitiveLookup};case"expression":return{range:rt.to(i.range),expression:i.expression}}}s.to=t})(SY||(SY={}));var CY;(function(s){function e(i){return{frameId:i.frameId,stoppedLocation:rt.from(i.stoppedLocation)}}s.from=e;function t(i){return new WW(i.frameId,rt.to(i.stoppedLocation))}s.to=t})(CY||(CY={}));var aR;(function(s){function e(i){return{range:rt.from(i.range),kind:i.kind}}s.from=e;function t(i){return new bW(rt.to(i.range),i.kind)}s.to=t})(aR||(aR={}));var EY;(function(s){function e(i){return{uri:i.uri,highlights:i.highlights.map(aR.from)}}s.from=e;function t(i){return new yW(R.revive(i.uri),i.highlights.map(aR.to))}s.to=t})(EY||(EY={}));var KB;(function(s){function e(t){switch(t){case ba.TriggerCharacter:return IC.TriggerCharacter;case ba.TriggerForIncompleteCompletions:return IC.TriggerForIncompleteCompletions;case ba.Invoke:default:return IC.Invoke}}s.to=e})(KB||(KB={}));var xY;(function(s){function e(t){return{triggerKind:KB.to(t.triggerKind),triggerCharacter:t.triggerCharacter}}s.to=e})(xY||(xY={}));var jB;(function(s){function e(i){switch(i){case SA.Deprecated:return VT.Deprecated}}s.from=e;function t(i){switch(i){case VT.Deprecated:return SA.Deprecated}}s.to=t})(jB||(jB={}));var YB;(function(s){const e=new Map([[bt.Method,De.Method],[bt.Function,De.Function],[bt.Constructor,De.Constructor],[bt.Field,De.Field],[bt.Variable,De.Variable],[bt.Class,De.Class],[bt.Interface,De.Interface],[bt.Struct,De.Struct],[bt.Module,De.Module],[bt.Property,De.Property],[bt.Unit,De.Unit],[bt.Value,De.Value],[bt.Constant,De.Constant],[bt.Enum,De.Enum],[bt.EnumMember,De.EnumMember],[bt.Keyword,De.Keyword],[bt.Snippet,De.Snippet],[bt.Text,De.Text],[bt.Color,De.Color],[bt.File,De.File],[bt.Reference,De.Reference],[bt.Folder,De.Folder],[bt.Event,De.Event],[bt.Operator,De.Operator],[bt.TypeParameter,De.TypeParameter],[bt.Issue,De.Issue],[bt.User,De.User]]);function t(o){return e.get(o)??De.Property}s.from=t;const i=new Map([[De.Method,bt.Method],[De.Function,bt.Function],[De.Constructor,bt.Constructor],[De.Field,bt.Field],[De.Variable,bt.Variable],[De.Class,bt.Class],[De.Interface,bt.Interface],[De.Struct,bt.Struct],[De.Module,bt.Module],[De.Property,bt.Property],[De.Unit,bt.Unit],[De.Value,bt.Value],[De.Constant,bt.Constant],[De.Enum,bt.Enum],[De.EnumMember,bt.EnumMember],[De.Keyword,bt.Keyword],[De.Snippet,bt.Snippet],[De.Text,bt.Text],[De.Color,bt.Color],[De.File,bt.File],[De.Reference,bt.Reference],[De.Folder,bt.Folder],[De.Event,bt.Event],[De.Operator,bt.Operator],[De.TypeParameter,bt.TypeParameter],[De.User,bt.User],[De.Issue,bt.Issue]]);function n(o){return i.get(o)??bt.Property}s.to=n})(YB||(YB={}));var IY;(function(s){function e(t,i){const n=new IW(t.label);return n.insertText=t.insertText,n.kind=YB.to(t.kind),n.tags=t.tags?.map(jB.to),n.detail=t.detail,n.documentation=tc(t.documentation)?Mn.to(t.documentation):t.documentation,n.sortText=t.sortText,n.filterText=t.filterText,n.preselect=t.preselect,n.commitCharacters=t.commitCharacters,P.isIRange(t.range)?n.range=rt.to(t.range):typeof t.range=="object"&&(n.range={inserting:rt.to(t.range.insert),replacing:rt.to(t.range.replace)}),n.keepWhitespace=typeof t.insertTextRules>"u"?!1:!!(t.insertTextRules&sh.KeepWhitespace),typeof t.insertTextRules<"u"&&t.insertTextRules&sh.InsertAsSnippet?n.insertText=new BE(t.insertText):(n.insertText=t.insertText,n.textEdit=n.range instanceof ms?new by(n.range,n.insertText):void 0),t.additionalTextEdits&&t.additionalTextEdits.length>0&&(n.additionalTextEdits=t.additionalTextEdits.map(o=>Jd.to(o))),n.command=i&&t.command?i.fromInternal(t.command):void 0,n}s.to=e})(IY||(IY={}));var cR;(function(s){function e(i){if(typeof i.label!="string"&&!Array.isArray(i.label))throw new TypeError("Invalid label");return{label:i.label,documentation:Mn.fromStrict(i.documentation)}}s.from=e;function t(i){return{label:i.label,documentation:tc(i.documentation)?Mn.to(i.documentation):i.documentation}}s.to=t})(cR||(cR={}));var dR;(function(s){function e(i){return{label:i.label,documentation:Mn.fromStrict(i.documentation),parameters:Array.isArray(i.parameters)?i.parameters.map(cR.from):[],activeParameter:i.activeParameter}}s.from=e;function t(i){return{label:i.label,documentation:tc(i.documentation)?Mn.to(i.documentation):i.documentation,parameters:Array.isArray(i.parameters)?i.parameters.map(cR.to):[],activeParameter:i.activeParameter}}s.to=t})(dR||(dR={}));var DY;(function(s){function e(i){return{activeSignature:i.activeSignature,activeParameter:i.activeParameter,signatures:Array.isArray(i.signatures)?i.signatures.map(dR.from):[]}}s.from=e;function t(i){return{activeSignature:i.activeSignature,activeParameter:i.activeParameter,signatures:Array.isArray(i.signatures)?i.signatures.map(dR.to):[]}}s.to=t})(DY||(DY={}));var kY;(function(s){function e(t,i){const n=new xW(Py.to(i.position),typeof i.label=="string"?i.label:i.label.map(QB.to.bind(void 0,t)),i.kind&&XB.to(i.kind));return n.textEdits=i.textEdits&&i.textEdits.map(Jd.to),n.tooltip=tc(i.tooltip)?Mn.to(i.tooltip):i.tooltip,n.paddingLeft=i.paddingLeft,n.paddingRight=i.paddingRight,n}s.to=e})(kY||(kY={}));var QB;(function(s){function e(t,i){const n=new EW(i.label);return n.tooltip=tc(i.tooltip)?Mn.to(i.tooltip):i.tooltip,Yie.is(i.command)&&(n.command=t.fromInternal(i.command)),i.location&&(n.location=My.to(i.location)),n}s.to=e})(QB||(QB={}));var XB;(function(s){function e(i){return i}s.from=e;function t(i){return i}s.to=t})(XB||(XB={}));var TY;(function(s){function e(i){return{range:rt.from(i.range),url:i.target,tooltip:i.tooltip}}s.from=e;function t(i){let n;if(i.url)try{n=typeof i.url=="string"?R.parse(i.url,!0):R.revive(i.url)}catch{}const o=new DW(rt.to(i.range),n);return o.tooltip=i.tooltip,o}s.to=t})(TY||(TY={}));var AY;(function(s){function e(i){const n=new kW(i.label);return i.textEdit&&(n.textEdit=Jd.to(i.textEdit)),i.additionalTextEdits&&(n.additionalTextEdits=i.additionalTextEdits.map(o=>Jd.to(o))),n}s.to=e;function t(i){return{label:i.label,textEdit:i.textEdit?Jd.from(i.textEdit):void 0,additionalTextEdits:i.additionalTextEdits?i.additionalTextEdits.map(n=>Jd.from(n)):void 0}}s.from=t})(AY||(AY={}));var RY;(function(s){function e(i){return new IA(i[0],i[1],i[2],i[3])}s.to=e;function t(i){return[i.red,i.green,i.blue,i.alpha]}s.from=t})(RY||(RY={}));var PY;(function(s){function e(i){return{range:rt.from(i.range)}}s.from=e;function t(i){return new CW(rt.to(i.range))}s.to=t})(PY||(PY={}));var LY;(function(s){function e(t){switch(t){case gi.AUTO:return kC.AfterDelay;case gi.EXPLICIT:return kC.Manual;case gi.FOCUS_CHANGE:case gi.WINDOW_CHANGE:return kC.FocusOut}}s.to=e})(LY||(LY={}));var MY;(function(s){function e(i){switch(i){case Wl.Off:return hs.Off;case Wl.Relative:return hs.Relative;case Wl.Interval:return hs.Interval;case Wl.On:default:return hs.On}}s.from=e;function t(i){switch(i){case hs.Off:return Wl.Off;case hs.Relative:return Wl.Relative;case hs.Interval:return Wl.Interval;case hs.On:default:return Wl.On}}s.to=t})(MY||(MY={}));var lR;(function(s){function e(i){if(i===J_.CRLF)return OD.CRLF;if(i===J_.LF)return OD.LF}s.from=e;function t(i){if(i===OD.CRLF)return J_.CRLF;if(i===OD.LF)return J_.LF}s.to=t})(lR||(lR={}));var NY;(function(s){function e(t){if(typeof t=="object")return t.viewId;switch(t){case AC.SourceControl:return Xo.Scm;case AC.Window:return Xo.Window;case AC.Notification:return Xo.Notification}throw new Error("Unknown 'ProgressLocation'")}s.from=e})(NY||(NY={}));var OY;(function(s){function e(i){const n={start:i.start+1,end:i.end+1};return i.kind&&(n.kind=hR.from(i.kind)),n}s.from=e;function t(i){const n={start:i.start-1,end:i.end-1};return i.kind&&(n.kind=hR.to(i.kind)),n}s.to=t})(OY||(OY={}));var hR;(function(s){function e(i){if(i)switch(i){case qg.Comment:return b_.Comment;case qg.Imports:return b_.Imports;case qg.Region:return b_.Region}}s.from=e;function t(i){if(i)switch(i.value){case b_.Comment.value:return qg.Comment;case b_.Imports.value:return qg.Imports;case b_.Region.value:return qg.Region}}s.to=t})(hR||(hR={}));var FY;(function(s){function e(t){if(t)return{pinned:typeof t.preview=="boolean"?!t.preview:void 0,inactive:t.background,preserveFocus:t.preserveFocus,selection:typeof t.selection=="object"?rt.from(t.selection):void 0,override:typeof t.override=="boolean"?id.id:void 0}}s.from=e})(FY||(FY={}));var Xl;(function(s){function e(o){return o instanceof PC?o.toJSON():typeof o=="string"?o:t(o)||i(o)?new PC(o.baseUri??o.base,o.pattern).toJSON():o}s.from=e;function t(o){const r=o;return r?R.isUri(r.baseUri)&&typeof r.pattern=="string":!1}function i(o){const r=o;return r?typeof r.base=="string"&&typeof r.pattern=="string":!1}function n(o){return typeof o=="string"?o:new PC(R.revive(o.baseUri),o.pattern)}s.to=n})(Xl||(Xl={}));var WY;(function(s){function e(t){if(t){if(Array.isArray(t))return t.map(e);if(typeof t=="string")return t;{const i=t;return{language:i.language,scheme:i.scheme,pattern:Xl.from(i.pattern)??void 0,exclusive:i.exclusive,notebookType:i.notebookType}}}else return}s.from=e})(WY||(WY={}));var BY;(function(s){function e(i){return{start:i.start,end:i.end}}s.from=e;function t(i){return new VS(i.start,i.end)}s.to=t})(BY||(BY={}));var uR;(function(s){function e(i){return{timing:typeof i.runStartTime=="number"&&typeof i.runEndTime=="number"?{startTime:i.runStartTime,endTime:i.runEndTime}:void 0,executionOrder:i.executionOrder,success:i.lastRunSuccess}}s.to=e;function t(i){return{lastRunSuccess:i.success,runStartTime:i.timing?.startTime,runEndTime:i.timing?.endTime,executionOrder:i.executionOrder}}s.from=t})(uR||(uR={}));var VY;(function(s){function e(t){if(t===xC.Unconfirmed)return TA.Pending;if(t===xC.Pending)return;if(t===xC.Executing)return TA.Executing;throw new Error(`Unknown state: ${t}`)}s.to=e})(VY||(VY={}));var gR;(function(s){function e(i){switch(i){case nb.Markup:return ap.Markup;case nb.Code:default:return ap.Code}}s.from=e;function t(i){switch(i){case ap.Markup:return nb.Markup;case ap.Code:default:return nb.Code}}s.to=t})(gR||(gR={}));var HY;(function(s){function e(i){const n={metadata:i.metadata??Object.create(null),cells:[]};for(const o of i.cells)Voe.validate(o),n.cells.push(Ny.from(o));return n}s.from=e;function t(i){const n=new tEe(i.cells.map(Ny.to));return HT(i.metadata)||(n.metadata=i.metadata),n}s.to=t})(HY||(HY={}));var Ny;(function(s){function e(i){return{cellKind:gR.from(i.kind),language:i.languageId,mime:i.mime,source:i.value,metadata:i.metadata,internalMetadata:uR.from(i.executionSummary??{}),outputs:i.outputs?i.outputs.map(fR.from):[]}}s.from=e;function t(i){return new Voe(gR.to(i.cellKind),i.source,i.language,i.mime,i.outputs?i.outputs.map(fR.to):void 0,i.metadata,i.internalMetadata?uR.to(i.internalMetadata):void 0)}s.to=t})(Ny||(Ny={}));var pR;(function(s){function e(i){return{mime:i.mime,valueBytes:Le.wrap(i.data)}}s.from=e;function t(i){return new iEe(i.valueBytes.buffer,i.mime)}s.to=t})(pR||(pR={}));var fR;(function(s){function e(i){return{outputId:i.id,items:i.items.map(pR.from),metadata:i.metadata}}s.from=e;function t(i){const n=i.items.map(pR.to);return new nEe(n,i.outputId,i.metadata)}s.to=t})(fR||(fR={}));var UY;(function(s){function e(n){return i(n)?{include:Xl.from(n.include)??void 0,exclude:Xl.from(n.exclude)??void 0}:Xl.from(n)??void 0}s.from=e;function t(n){return i(n)?{include:Xl.to(n.include),exclude:Xl.to(n.exclude)}:Xl.to(n)}s.to=t;function i(n){const o=n;return o?!up(o.include)&&!up(o.exclude):!1}})(UY||(UY={}));var $Y;(function(s){function e(t,i,n){const o=typeof t.command=="string"?{title:"",command:t.command}:t.command;return{alignment:t.alignment===UW.Left?mA.Left:mA.Right,command:i.toInternal(o,n),text:t.text,tooltip:t.tooltip,accessibilityInformation:t.accessibilityInformation,priority:t.priority}}s.from=e})($Y||($Y={}));var GY;(function(s){function e(t,i,n){const o=typeof t.command=="string"?{title:"",command:t.command}:t.command;return{command:i.toInternal(o,n),label:t.label,description:t.description,detail:t.detail,documentation:t.documentation}}s.from=e})(GY||(GY={}));var zY;(function(s){function e(t){return{transientOutputs:t?.transientOutputs??!1,transientCellMetadata:t?.transientCellMetadata??{},transientDocumentMetadata:t?.transientDocumentMetadata??{},cellContentMetadata:t?.cellContentMetadata??{}}}s.from=e})(zY||(zY={}));var qY;(function(s){function e(i){return{uri:i.uri,provides:i.provides}}s.from=e;function t(i){return new sEe(R.revive(i.uri),i.provides)}s.to=t})(qY||(qY={}));var ZB;(function(s){function e(i){return{message:Mn.fromStrict(i.message)||"",type:nd.Error,expected:i.expectedOutput,actual:i.actualOutput,contextValue:i.contextValue,location:i.location&&{range:rt.from(i.location.range),uri:i.location.uri},stackTrace:i.stackTrace?.map(n=>({label:n.label,position:n.position&&Py.from(n.position),uri:n.uri&&R.revive(n.uri).toJSON()}))}}s.from=e;function t(i){const n=new $W(typeof i.message=="string"?i.message:Mn.to(i.message));return n.actualOutput=i.actual,n.expectedOutput=i.expected,n.contextValue=i.contextValue,n.location=i.location?My.to(i.location):void 0,n}s.to=t})(ZB||(ZB={}));var Oy;(function(s){s.namespace=zk,s.denamespace=zke})(Oy||(Oy={}));var KY;(function(s){function e(t){return{controllerId:t.controllerId,profileId:t.profileId,group:JB.from(t.kind)}}s.from=e})(KY||(KY={}));var JB;(function(s){const e={[LC.Coverage]:Lo.Coverage,[LC.Debug]:Lo.Debug,[LC.Run]:Lo.Run};function t(i){return e.hasOwnProperty(i)?e[i]:Lo.Run}s.from=t})(JB||(JB={}));var eV;(function(s){function e(i){const n=Xke(i).controllerId;return{extId:Wn.fromExtHostTestItem(i,n).toString(),label:i.label,uri:R.revive(i.uri),busy:i.busy,tags:i.tags.map(o=>Oy.namespace(n,o.id)),range:P.lift(rt.from(i.range)),description:i.description||null,sortText:i.sortText||null,error:i.error&&Mn.fromStrict(i.error)||null}}s.from=e;function t(i){return{parent:void 0,error:void 0,id:Wn.fromString(i.extId).localId,label:i.label,uri:R.revive(i.uri),tags:(i.tags||[]).map(n=>{const{tagId:o}=Oy.denamespace(n);return new AA(o)}),children:{add:()=>{},delete:()=>{},forEach:()=>{},*[Symbol.iterator](){},get:()=>{},replace:()=>{},size:0},range:rt.to(i.range||void 0),canResolveChildren:!1,busy:i.busy,description:i.description||void 0,sortText:i.sortText||void 0}}s.toPlain=t})(eV||(eV={}));(function(s){function e(i){return{id:i.id}}s.from=e;function t(i){return new AA(i.id)}s.to=t})(Oy||(Oy={}));var jY;(function(s){const e=(i,n)=>{const o=i.value;if(!o)return;const r={...eV.toPlain(o.item),parent:n,taskStates:o.tasks.map(a=>({state:a.state,duration:a.duration,messages:a.messages.filter(c=>c.type===nd.Error).map(ZB.to)})),children:[]};if(i.children)for(const a of i.children.values()){const c=e(a,r);c&&r.children.push(c)}return r};function t(i){const n=new zA;for(const a of i.items)n.insert(Wn.fromString(a.item.extId).path,a);const o=[n.nodes],r=[];for(;o.length;)for(const a of o.pop())a.value?r.push(a):a.children&&o.push(a.children.values());return{completedAt:i.completedAt,results:r.map(a=>e(a)).filter(wa)}}s.to=t})(jY||(jY={}));var YY;(function(s){function e(a){return{covered:a.covered,total:a.total}}function t(a){return"line"in a?Py.from(a):rt.from(a)}function i(a){if(a)return"endLineNumber"in a?rt.to(a):Py.to(a)}function n(a){if(a.type===Pm.Statement){const c=[];if(a.branches)for(const d of a.branches)c.push({executed:d.count,location:i(d.location),label:d.label});return new rEe(a.count,i(a.location),a.branches?.map(d=>new aEe(d.count,i(d.location),d.label)))}else return new cEe(a.name,a.count,i(a.location))}s.to=n;function o(a){if(typeof a.executed=="number"&&a.executed<0)throw new Error(`Invalid coverage count ${a.executed}`);return"branches"in a?{count:a.executed,location:t(a.location),type:Pm.Statement,branches:a.branches.length?a.branches.map(c=>({count:c.executed,location:c.location&&t(c.location),label:c.label})):void 0}:{type:Pm.Declaration,name:a.name,count:a.executed,location:t(a.location)}}s.fromDetails=o;function r(a,c,d){return Uk(d.statementCoverage),Uk(d.branchCoverage),Uk(d.declarationCoverage),{id:c,uri:d.uri,statement:e(d.statementCoverage),branch:d.branchCoverage&&e(d.branchCoverage),declaration:d.declarationCoverage&&e(d.declarationCoverage),testIds:d instanceof oEe&&d.includesTests.length?d.includesTests.map(l=>Wn.fromExtHostTestItem(l,a).toString()):void 0}}s.fromFile=r})(YY||(YY={}));var QY;(function(s){function e(t){switch(t){case jo.Invoke:return wA.Invoke;case jo.Auto:return wA.Automatic}}s.to=e})(QY||(QY={}));var XY;(function(s){function e(i){const n=new dEe(Th.to(i.kind),i.name,i.detail||"",R.revive(i.uri),rt.to(i.range),rt.to(i.selectionRange));return n._sessionId=i._sessionId,n._itemId=i._itemId,n}s.to=e;function t(i,n,o){if(n=n??i._sessionId,o=o??i._itemId,n===void 0||o===void 0)throw new Error("invalid item");return{_sessionId:n,_itemId:o,kind:Th.from(i.kind),name:i.name,detail:i.detail??"",uri:i.uri,range:rt.from(i.range),selectionRange:rt.from(i.selectionRange),tags:i.tags?.map(zp.from)}}s.from=t})(XY||(XY={}));var ZY;(function(s){function e(t){if(t)return{value:t.value,tooltip:t.tooltip}}s.from=e})(ZY||(ZY={}));var FC;(function(s){function e(o,r,a){const c=r.fileData;return c?new ZCe(new JCe(c.name,R.revive(c.uri),c.id,_w(()=>a(c.id)))):o===Si.uriList&&r.uriListData?new PW(n(r.uriListData)):new PW(r.asString)}s.to=e;async function t(o,r,a=Pn()){const c=await r.asString();if(o===Si.uriList)return{id:a,asString:c,fileData:void 0,uriListData:i(c)};const d=r.asFile();return{id:a,asString:c,fileData:d?{name:d.name,uri:d.uri,id:d._itemId??d.id}:void 0}}s.from=t;function i(o){return hl.split(o).map(r=>{if(r.startsWith("#"))return r;try{return R.parse(r)}catch{}return r})}function n(o){return hl.create(o.map(r=>typeof r=="string"?r:R.revive(r)))}})(FC||(FC={}));var Fy;(function(s){function e(n,o){const r=n.items.map(([a,c])=>[a,FC.to(a,c,o)]);return new LW(r)}s.toDataTransfer=e;async function t(n){return{items:await Promise.all(Array.from(n,async([r,a])=>[r,await FC.from(r,a)]))}}s.from=t;async function i(n){return{items:await Promise.all(Array.from(n,async([r,a])=>[r,await FC.from(r,a,a.id)]))}}s.fromList=i})(Fy||(Fy={}));var tV;(function(s){function e(i,n){return{kind:"reply",agentId:i.participant??n?.agentId??"",subCommand:i.command??n?.command,message:i.prompt,title:i.label}}s.from=e;function t(i){return{prompt:i.message,label:i.title,participant:i.agentId,command:i.subCommand}}s.to=t})(tV||(tV={}));var Wy;(function(s){function e(i){switch(i){case ou.System:return Uc.System;case ou.User:return Uc.User;case ou.Assistant:return Uc.Assistant}}s.to=e;function t(i){switch(i){case Uc.System:return ou.System;case Uc.User:return ou.User;case Uc.Assistant:return ou.Assistant}return ou.User}s.from=t})(Wy||(Wy={}));var JY;(function(s){function e(i){const n=i.content.map(a=>{if(a.type==="text")return new uo(a.value);if(a.type==="tool_result"){const c=a.value.map(d=>d.type==="text"?new uo(d.value):new Ju(d.value));return new GW(a.toolCallId,c,a.isError)}else return a.type==="image_url"||a.type==="extra_data"?void 0:new RA(a.toolCallId,a.name,a.parameters)}).filter(a=>a!==void 0),o=Wy.to(i.role);return new mEe(o,n,i.name)}s.to=e;function t(i){const n=Wy.from(i.role),o=i.name;let r=i.content;typeof r=="string"&&(r=[new uo(r)]);const a=r.map(c=>{if(c instanceof GW)return{type:"tool_result",toolCallId:c.callId,value:$t(c.content.map(d=>d instanceof uo?{type:"text",value:d.value}:d instanceof Ju?{type:"prompt_tsx",value:d.value}:void 0)),isError:c.isError};if(c instanceof RA)return{type:"tool_use",toolCallId:c.callId,name:c.name,parameters:c.input};if(c instanceof uo)return{type:"text",value:c.value};if(typeof c!="string")throw new Error("Unexpected chat message content type");return{type:"text",value:c}});return{role:n,name:o,content:a}}s.from=t})(JY||(JY={}));var eQ;(function(s){function e(i){const n=i.content.map(a=>{if(a.type==="text")return new uo(a.value);if(a.type==="tool_result"){const c=a.value.map(d=>d.type==="text"?new uo(d.value):d.type==="data"?new rh(d.value.data.buffer,d.value.mimeType):new Ju(d.value));return new y9(a.toolCallId,c,a.isError)}else return a.type==="image_url"?new rh(a.value.data.buffer,a.value.mimeType):a.type==="extra_data"?new S9(a.kind,a.data):new RA(a.toolCallId,a.name,a.parameters)}),o=Wy.to(i.role);return new vEe(o,n,i.name)}s.to=e;function t(i){const n=Wy.from(i.role),o=i.name;let r=i.content;typeof r=="string"&&(r=[new uo(r)]);const a=r.map(c=>{if(c instanceof y9||c instanceof GW)return{type:"tool_result",toolCallId:c.callId,value:$t(c.content.map(d=>d instanceof uo?{type:"text",value:d.value}:d instanceof Ju?{type:"prompt_tsx",value:d.value}:d instanceof rh?{type:"data",value:{mimeType:d.mimeType,data:Le.wrap(d.data)}}:void 0)),isError:c.isError};if(c instanceof rh)return{type:"image_url",value:{mimeType:c.mimeType,data:Le.wrap(c.data)}};if(c instanceof RA)return{type:"tool_use",toolCallId:c.callId,name:c.name,parameters:c.input};if(c instanceof uo)return{type:"text",value:c.value};if(c instanceof S9)return{type:"extra_data",kind:c.kind,data:c.data};if(typeof c!="string")throw new Error("Unexpected chat message content type llm 2");return{type:"text",value:c}});return{role:n,name:o,content:a}}s.from=t})(eQ||(eQ={}));var mR;(function(s){function e(i){return{kind:"markdownContent",content:Mn.from(i.value)}}s.from=e;function t(i){return new Uoe(Mn.to(i.content))}s.to=t})(mR||(mR={}));var iV;(function(s){function e(i){return{kind:"codeblockUri",uri:i.value,isEdit:i.isEdit}}s.from=e;function t(i){return new Qoe(R.revive(i.uri),i.isEdit)}s.to=t})(iV||(iV={}));var nV;(function(s){function e(i){return{kind:"markdownVuln",content:Mn.from(i.value),vulnerabilities:i.vulnerabilities}}s.from=e;function t(i){return new $oe(Mn.to(i.content),i.vulnerabilities)}s.to=t})(nV||(nV={}));var sV;(function(s){function e(t){return{kind:"confirmation",title:t.title,message:t.message,data:t.data,buttons:t.buttons}}s.from=e})(sV||(sV={}));var vR;(function(s){function e(i){const{value:n,baseUri:o}=i;function r(a,c){return a.map(d=>{const l=R.joinPath(c,d.name);return{label:d.name,uri:l,children:d.children&&r(d.children,l)}})}return{kind:"treeData",treeData:{label:Qe(o),uri:o,children:r(n,o)}}}s.from=e;function t(i){const n=gn(i.treeData);function o(c){return c.map(d=>({name:d.label,children:d.children&&o(d.children)}))}const r=n.uri,a=n.children?o(n.children):[];return new Goe(a,r)}s.to=t})(vR||(vR={}));var _R;(function(s){function e(i){const n=r=>R.isUri(r),o=r=>"name"in r;return{kind:"inlineReference",name:i.title,inlineReference:n(i.value)?i.value:o(i.value)?oR.from(i.value):vh.from(i.value)}}s.from=e;function t(i){const n=gn(i);return new zoe(R.isUri(n.inlineReference)?n.inlineReference:"location"in n.inlineReference?oR.to(n.inlineReference):vh.to(n.inlineReference),i.name)}s.to=t})(_R||(_R={}));var oV;(function(s){function e(i){return{kind:"progressMessage",content:Mn.from(i.value)}}s.from=e;function t(i){return new qoe(i.content.value)}s.to=t})(oV||(oV={}));var rV;(function(s){function e(i){return{kind:"warning",content:Mn.from(i.value)}}s.from=e;function t(i){return new Koe(i.content.value)}s.to=t})(rV||(rV={}));var aV;(function(s){function e(t){return{kind:"extensions",extensions:t.extensions}}s.from=e})(aV||(aV={}));var cV;(function(s){function e(i){return{kind:"move",uri:i.uri,range:rt.from(i.range)}}s.from=e;function t(i){return new Xoe(R.revive(i.uri),rt.to(i.range))}s.to=t})(cV||(cV={}));var tQ;(function(s){function e(t){return{kind:"progressTask",content:Mn.from(t.value)}}s.from=e})(tQ||(tQ={}));var iQ;(function(s){function e(t){return{kind:"progressTaskResult",content:typeof t=="string"?Mn.from(t):void 0}}s.from=e})(iQ||(iQ={}));var bR;(function(s){function e(i,n,o){return{kind:"command",command:n.toInternal(i.value,o)??{command:i.value.command,title:i.value.title}}}s.from=e;function t(i,n){return new joe(n.fromInternal(i.command)??{command:i.command.id,title:i.command.title})}s.to=t})(bR||(bR={}));var dV;(function(s){function e(i){return{kind:"textEdit",uri:i.uri,edits:i.edits.map(n=>Jd.from(n)),done:i.isDone}}s.from=e;function t(i){const n=new Zoe(R.revive(i.uri),i.edits.map(o=>Jd.to(o)));return n.isDone=i.done,n}s.to=t})(dV||(dV={}));var lV;(function(s){function e(t){return t.newCellMetadata?{editType:sl.Metadata,index:t.range.start,metadata:t.newCellMetadata}:t.newNotebookMetadata?{editType:sl.DocumentMetadata,metadata:t.newNotebookMetadata}:{editType:sl.Replace,index:t.range.start,count:t.range.end-t.range.start,cells:t.newCells.map(Ny.from)}}s.from=e})(lV||(lV={}));var hV;(function(s){function e(t){return{kind:"notebookEdit",uri:t.uri,edits:t.edits.map(lV.from),done:t.isDone}}s.from=e})(hV||(hV={}));var yR;(function(s){function e(i){const n=ke.isThemeIcon(i.iconPath)?i.iconPath:R.isUri(i.iconPath)?{light:R.revive(i.iconPath)}:i.iconPath&&"light"in i.iconPath&&"dark"in i.iconPath&&R.isUri(i.iconPath.light)&&R.isUri(i.iconPath.dark)?{light:R.revive(i.iconPath.light),dark:R.revive(i.iconPath.dark)}:void 0;return typeof i.value=="object"&&"variableName"in i.value?{kind:"reference",reference:{variableName:i.value.variableName,value:R.isUri(i.value.value)||!i.value.value?i.value.value:vh.from(i.value.value)},iconPath:n,options:i.options}:{kind:"reference",reference:R.isUri(i.value)||typeof i.value=="string"?i.value:vh.from(i.value),iconPath:n,options:i.options}}s.from=e;function t(i){const n=gn(i),o=r=>R.isUri(r)?r:vh.to(r);return new Yoe(typeof n.reference=="string"?n.reference:"variableName"in n.reference?{variableName:n.reference.variableName,value:n.reference.value&&o(n.reference.value)}:o(n.reference))}s.to=t})(yR||(yR={}));var uV;(function(s){function e(t){return{kind:"codeCitation",value:t.value,license:t.license,snippet:t.snippet}}s.from=e})(uV||(uV={}));var nQ;(function(s){function e(n,o,r){return n instanceof Uoe?mR.from(n):n instanceof zoe?_R.from(n):n instanceof Yoe?yR.from(n):n instanceof qoe?oV.from(n):n instanceof Goe?vR.from(n):n instanceof joe?bR.from(n,o,r):n instanceof Zoe?dV.from(n):n instanceof gEe?hV.from(n):n instanceof $oe?nV.from(n):n instanceof Qoe?iV.from(n):n instanceof Koe?rV.from(n):n instanceof lEe?sV.from(n):n instanceof hEe?uV.from(n):n instanceof Xoe?cV.from(n):n instanceof uEe?aV.from(n):{kind:"markdownContent",content:Mn.from("")}}s.from=e;function t(n,o){switch(n.kind){case"reference":return yR.to(n);case"markdownContent":case"inlineReference":case"progressMessage":case"treeData":case"command":return i(n,o)}}s.to=t;function i(n,o){switch(n.kind){case"markdownContent":return mR.to(n);case"inlineReference":return _R.to(n);case"progressMessage":return;case"treeData":return vR.to(n);case"command":return bR.to(n,o)}}s.toContent=i})(nQ||(nQ={}));var sQ;(function(s){function e(t,i,n,o,r,a,c,d){const l=t.variables.variables.filter(m=>m.kind==="tool"),u=t.variables.variables.filter(m=>m.kind!=="tool"),g={id:t.requestId,prompt:t.message,command:t.command,attempt:t.attempt??0,enableCommandDetection:t.enableCommandDetection??!0,isParticipantDetected:t.isParticipantDetected??!1,references:u.map(m=>pV.to(m,o,d)).filter(wa),toolReferences:l.map(fV.to),location:gV.to(t.location),acceptedConfirmationData:t.acceptedConfirmationData,rejectedConfirmationData:t.rejectedConfirmationData,location2:i,toolInvocationToken:Object.freeze({sessionId:t.sessionId}),toolSelection:r,tools:a,model:n,editedFileEvents:t.editedFileEvents};return ay(c,"chatParticipantPrivate")||(delete g.id,delete g.attempt,delete g.enableCommandDetection,delete g.isParticipantDetected,delete g.location,delete g.location2,delete g.editedFileEvents),ay(c,"chatParticipantAdditions")||(delete g.acceptedConfirmationData,delete g.rejectedConfirmationData,delete g.tools),g}s.to=e})(sQ||(sQ={}));var oQ;(function(s){function e(t){return{prompt:t.prompt,files:t.files.map(i=>R.revive(i))}}s.to=e})(oQ||(oQ={}));var gV;(function(s){function e(i){switch(i){case $i.Notebook:return Bl.Notebook;case $i.Terminal:return Bl.Terminal;case $i.Panel:return Bl.Panel;case $i.Editor:return Bl.Editor}}s.to=e;function t(i){switch(i){case Bl.Notebook:return $i.Notebook;case Bl.Terminal:return $i.Terminal;case Bl.Panel:return $i.Panel;case Bl.Editor:return $i.Editor}}s.from=t})(gV||(gV={}));var pV;(function(s){function e(t,i,n){let o=t.value;if(!o){let r;try{r=JSON.stringify(t)}catch{r=`kind=${t.kind}, id=${t.id}, name=${t.name}`}n.error(`[ChatPromptReference] Ignoring invalid reference in variable: ${r}`);return}if(WT(o))o=R.revive(o);else if(o&&typeof o=="object"&&"uri"in o&&"range"in o&&WT(o.uri))o=vh.to(gn(o));else if(fm(t)){const r=t.references?.[0]?.reference;o=new pEe(t.mimeType??"image/png",()=>Promise.resolve(new Uint8Array(Object.values(t.value))),r&&R.isUri(r)?r:void 0)}else if(t.kind==="diagnostic"){const r=t.filterSeverity&&cx.to(t.filterSeverity),a=t.filterUri&&R.revive(t.filterUri).toString();o=new fEe(i.map(([c,d])=>t.filterUri&&c.toString()!==a?[c,[]]:[c,d.filter(l=>!(r&&l.severity>r||t.filterRange&&!P.areIntersectingOrTouching(t.filterRange,rt.from(l.range))))]).filter(([,c])=>c.length>0))}return{id:t.id,name:t.name,range:t.range&&[t.range.start,t.range.endExclusive],value:o,modelDescription:t.modelDescription}}s.to=e})(pV||(pV={}));var fV;(function(s){function e(t){if(t.value)throw new Error("Invalid tool reference");return{name:t.id,range:t.range&&[t.range.start,t.range.endExclusive]}}s.to=e})(fV||(fV={}));var rQ;(function(s){function e(t,i,n){return{id:t.id,label:t.label,fullName:t.fullName,icon:t.icon?.id,value:t.values[0].value,insertText:t.insertText,detail:t.detail,documentation:t.documentation,command:i.toInternal(t.command,n)}}s.from=e})(rQ||(rQ={}));var mV;(function(s){function e(n){return{errorDetails:n.errorDetails,metadata:i(n.metadata),nextQuestion:n.nextQuestion}}s.to=e;function t(n){return{errorDetails:n.errorDetails,metadata:n.metadata,nextQuestion:n.nextQuestion}}s.from=t;function i(n){return xF(n,o=>{if(o.$mid===Dn.LanguageModelToolResult)return new bq(xF(o.content,i));if(o.$mid===Dn.LanguageModelTextPart)return new uo(o.value);if(o.$mid===Dn.LanguageModelPromptTsxPart)return new Ju(o.value)})}})(mV||(mV={}));var aQ;(function(s){function e(t,i,n){if(i.action.kind==="vote")return;const o=mV.to(t);if(i.action.kind==="command"){const r=i.action.commandButton.command;return{action:{kind:"command",commandButton:{command:n.fromInternal(r)??{command:r.id,title:r.title}}},result:o}}else return i.action.kind==="followUp"?{action:{kind:"followUp",followup:tV.to(i.action.followup)},result:o}:i.action.kind==="inlineChat"?{action:{kind:"editor",accepted:i.action.action==="accepted"},result:o}:i.action.kind==="chatEditingSessionAction"?{action:{kind:"chatEditingSessionAction",outcome:new Map([["accepted",ob.Accepted],["rejected",ob.Rejected],["saved",ob.Saved]]).get(i.action.outcome)??ob.Rejected,uri:R.revive(i.action.uri),hasRemainingEdits:i.action.hasRemainingEdits},result:o}:{action:i.action,result:o}}s.to=e})(aQ||(aQ={}));var cQ;(function(s){function e(t,i,n){return"terminalCommand"in t?{terminalCommand:t.terminalCommand,shouldExecute:t.shouldExecute}:"uri"in t?{uri:t.uri}:i.toInternal(t,n)}s.from=e})(cQ||(cQ={}));var wR;(function(s){function e(t){return{...t,documentation:Mn.fromStrict(t.documentation)}}s.from=e})(wR||(wR={}));var dQ;(function(s){function e(t){return Array.isArray(t)?{items:t.map(i=>wR.from(i))}:{items:t.items.map(i=>wR.from(i)),resourceRequestConfig:t.resourceRequestConfig?vV.from(t.resourceRequestConfig):void 0}}s.from=e})(dQ||(dQ={}));var vV;(function(s){function e(t){return{...t,pathSeparator:bn?"\\":"/",cwd:t.cwd?R.revive(t.cwd):void 0}}s.from=e})(vV||(vV={}));var lQ;(function(s){function e(t){return{kind:_V.to(t.kind),acceptedLength:t.acceptedLength}}s.to=e})(lQ||(lQ={}));var _V;(function(s){function e(t){switch(t){case Tb.Word:return tb.Word;case Tb.Line:return tb.Line;case Tb.Suggest:return tb.Suggest;default:return tb.Unknown}}s.to=e})(_V||(_V={}));var hQ;(function(s){function e(t,i){if(t.kind===Np.Ignored){const n=t.supersededBy?i(t.supersededBy):void 0;return{kind:DC.Ignored,supersededBy:n,userTypingDisagreed:t.userTypingDisagreed}}else if(t.kind===Np.Accepted)return{kind:DC.Accepted};return{kind:DC.Rejected}}s.to=e})(hQ||(hQ={}));var uQ;(function(s){function e(t,i){return{id:i,label:t.label,description:t.description,canEdit:t.canEdit,collapsibleState:t.collapsibleState||jW.None,contextValue:t.contextValue}}s.from=e})(uQ||(uQ={}));var gQ;(function(s){function e(t){return{name:t.id,description:t.modelDescription,inputSchema:t.inputSchema,tags:t.tags??[]}}s.to=e})(gQ||(gQ={}));var pQ;(function(s){function e(i){return new bq(i.content.map(n=>n.kind==="text"?new uo(n.value):new Ju(n.value)))}s.to=e;function t(i,n){return i.toolResultMessage&&ine(n,"chatParticipantPrivate"),{content:i.content.map(o=>{if(o instanceof uo)return{kind:"text",value:o.value};if(o instanceof Ju)return{kind:"promptTsx",value:o.value};throw new Error("Unknown LanguageModelToolResult part type")}),toolResultMessage:Mn.fromStrict(i.toolResultMessage),toolResultDetails:i.toolResultDetails?.map(o=>R.isUri(o)?o:vh.from(o))}}s.from=t})(pQ||(pQ={}));var fQ;(function(s){function e(i){return new _Ee(i.content.map(n=>{if(n.kind==="text")return new uo(n.value);if(n.kind==="data"){const o=Object.values(KW).includes(n.value.mimeType)?n.value.mimeType:void 0;if(!o)throw new Error("Invalid MIME type");return new rh(n.value.data.buffer,o)}else return new Ju(n.value)}))}s.to=e;function t(i,n){i.toolResultMessage&&ine(n,"chatParticipantPrivate");let o=!1;const r={content:i.content.map(a=>{if(a instanceof uo)return{kind:"text",value:a.value};if(a instanceof Ju)return{kind:"promptTsx",value:a.value};if(a instanceof rh)return o=!0,{kind:"data",value:{mimeType:a.mimeType,data:Le.wrap(a.data)}};throw new Error("Unknown LanguageModelToolResult part type")}),toolResultMessage:Mn.fromStrict(i.toolResultMessage),toolResultDetails:i.toolResultDetails?.map(a=>R.isUri(a)?a:vh.from(a))};return o?new ta(r):r}s.from=t})(fQ||(fQ={}));var mQ;(function(s){function e(t){return t}s.fromThemeIcon=e})(mQ||(mQ={}));var vQ;(function(s){function e(i){return{query:i.query,kind:t(i.kind),settings:i.settings}}s.fromSettingsSearchResult=e;function t(i){switch(i){case Yg.EMBEDDED:return Yg.EMBEDDED;case Yg.LLM_RANKED:return Yg.LLM_RANKED;case Yg.CANCELED:return Yg.CANCELED;default:throw new Error("Unknown AiSettingsSearchResultKind")}}})(vQ||(vQ={}));var _Q;(function(s){function e(i){return!!i.uri}function t(i){return ax.toSerialized(e(i)?{type:hv.HTTP,uri:i.uri,headers:Object.entries(i.headers)}:{type:hv.Stdio,cwd:i.cwd,args:i.args,command:i.command,env:i.env,envFile:void 0})}s.from=t})(_Q||(_Q={}));const G8e="search.exclude",z8e=2e4,Sce=" ",Cce=" characters skipped ",eTe=(Sce.length+Cce.length+5)*2;var WC;(function(s){s[s.file=0]="file",s[s.text=1]="text",s[s.aiText=2]="aiText"})(WC||(WC={}));var bp;(function(s){s[s.File=1]="File",s[s.Text=2]="Text",s[s.aiText=3]="aiText"})(bp||(bp={}));function q8e(s){return!!s.rangeLocations&&!!s.previewText}var bQ;(function(s){s[s.Normal=0]="Normal",s[s.NewSearchStarted=1]="NewSearchStarted"})(bQ||(bQ={}));class K8e{constructor(e,t,i,n){this.rangeLocations=[],this.webviewIndex=n;const o=Array.isArray(t)?t:[t];if(i&&i.matchLines===1&&tTe(o)){e=Lme(e,i.matchLines);let r="",a=0,c=0;const d=Math.floor(i.charsPerLine/5);for(const l of o){const u=Math.max(l.startColumn-d,0),g=l.startColumn+i.charsPerLine;if(u>c+d+eTe){const m=Sce+(u-c)+Cce;r+=m+e.slice(u,g),a+=u-(c+m.length)}else r+=e.slice(c,g);c=g,this.rangeLocations.push({source:l,preview:new iTe(0,l.startColumn-a,l.endColumn-a)})}this.previewText=r}else{const r=Array.isArray(t)?t[0].startLineNumber:t.startLineNumber,a=Mme(t,c=>({preview:new Ece(c.startLineNumber-r,c.startColumn,c.endLineNumber-r,c.endColumn),source:c}));this.rangeLocations=Array.isArray(a)?a:[a],this.previewText=e}}}function tTe(s){const e=s[0].startLineNumber;for(const t of s)if(t.startLineNumber!==e||t.endLineNumber!==e)return!1;return!0}class Ece{constructor(e,t,i,n){this.startLineNumber=e,this.startColumn=t,this.endLineNumber=i,this.endColumn=n}}class iTe extends Ece{constructor(e,t,i){super(e,t,e,i)}}var yQ;(function(s){s.List="list",s.Tree="tree"})(yQ||(yQ={}));var wQ;(function(s){s.Default="default",s.FileNames="fileNames",s.Type="type",s.Modified="modified",s.CountDescending="countDescending",s.CountAscending="countAscending"})(wQ||(wQ={}));function xce(s,e=!0){const t=s&&s.files&&s.files.exclude,i=e&&s&&s.search&&s.search.exclude;if(!t&&!i)return;if(!t||!i)return t||i||void 0;let n=Object.create(null);return n=Vu(n,Tr(t)),n=Vu(n,Tr(i),!0),n}function SQ(s,e){return s.excludePattern&&Db(s.excludePattern,e)?!1:s.includePattern||s.usingSearchPaths?s.includePattern&&Db(s.includePattern,e)?!0:s.usingSearchPaths?!!s.folderQueries&&s.folderQueries.some(t=>{const i=t.folder.fsPath;if(Pme(e,i)){const n=zM(i,e);return!t.includePattern||!!Db(t.includePattern,n)}else return!1}):!1:!0}var CQ;(function(s){s[s.unknownEncoding=1]="unknownEncoding",s[s.regexParseError=2]="regexParseError",s[s.globParseError=3]="globParseError",s[s.invalidLiteral=4]="invalidLiteral",s[s.rgProcessError=5]="rgProcessError",s[s.other=6]="other",s[s.canceled=7]="canceled"})(CQ||(CQ={}));function j8e(s,e){const t={...s||{},...e||{}};return Object.keys(t).filter(i=>{const n=t[i];return typeof n=="boolean"&&n})}class Y8e{constructor(e,t){this._parsedIncludeExpression=null,this._excludeExpression=t.excludePattern?.map(n=>({...e.excludePattern||{},...n.pattern||{}}))??[],this._excludeExpression.length===0&&(this._excludeExpression=[e.excludePattern||{}]),this._parsedExcludeExpression=this._excludeExpression.map(n=>Km(n));let i=e.includePattern;t.includePattern&&(i?i={...i,...t.includePattern}:i=t.includePattern),i&&(this._parsedIncludeExpression=Km(i))}_evalParsedExcludeExpression(e,t,i){let n=null;for(const o of this._parsedExcludeExpression){const r=o(e,t,i);if(typeof r=="string"){n=r;break}}return n}matchesExcludesSync(e,t,i){return!!(this._parsedExcludeExpression&&this._evalParsedExcludeExpression(e,t,i))}includedInQuerySync(e,t,i){return!(this._parsedExcludeExpression&&this._evalParsedExcludeExpression(e,t,i)||this._parsedIncludeExpression&&!this._parsedIncludeExpression(e,t,i))}includedInQuery(e,t,i){const n=()=>this._parsedIncludeExpression?!!this._parsedIncludeExpression(e,t,i):!0;return Promise.all(this._parsedExcludeExpression.map(o=>{const r=o(e,t,i);return BT(r)?r.then(a=>a?!1:n()):n()})).then(o=>o.some(r=>!!r))}hasSiblingExcludeClauses(){return this._excludeExpression.reduce((e,t)=>nTe(t)||e,!1)}}function nTe(s){for(const e in s)if(typeof s[e]!="boolean")return!0;return!1}function Q8e(s){if(!s)return;let e;return t=>(e||(e=(s()||Promise.resolve([])).then(i=>i?Ice(i):{})),e.then(i=>!!i[t]))}function X8e(s){if(!s)return;let e;return t=>{if(!e){const i=s();e=i?Ice(i):{}}return!!e[t]}}function Ice(s){const e={};for(const t of s)e[t]=!0;return e}function Z8e(s){return s.flatMap(e=>e.patterns.map(t=>e.baseUri?{baseUri:e.baseUri,pattern:t}:t))}const J8e={matchLines:100,charsPerLine:1e4};function sTe(s){return[...s.entries()]}function e7e(s){return s?[...s.entries()]:[]}function oTe(s){return new Map(s)}function rTe(s){return new Map(s??[])}class aTe{constructor(e){this._callback=e,this._terminalBufferMap=new Map}dispose(){for(const e of this._terminalBufferMap.values())e.dispose()}startBuffering(e,t,i=5){const n=t(o=>{const r=typeof o=="string"?o:o.data;let a=this._terminalBufferMap.get(e);if(a){a.data.push(r);return}const c=setTimeout(()=>this.flushBuffer(e),i);a={data:[r],timeoutId:c,dispose:()=>{clearTimeout(c),this.flushBuffer(e),n.dispose()}},this._terminalBufferMap.set(e,a)});return n}stopBuffering(e){this._terminalBufferMap.get(e)?.dispose()}flushBuffer(e){const t=this._terminalBufferMap.get(e);t&&(this._terminalBufferMap.delete(e),this._callback(e,t.data.join("")))}}const cTe={type:"object",additionalProperties:!1,properties:{type:{type:"string",description:h(10055,"The actual task type. Please note that types starting with a '$' are reserved for internal usage.")},required:{type:"array",items:{type:"string"}},properties:{type:"object",description:h(10056,"Additional properties of the task type"),additionalProperties:{$ref:"http://json-schema.org/draft-07/schema#"}},when:{type:"string",markdownDescription:h(10057,"Condition which must be true to enable this type of task. Consider using `shellExecutionSupported`, `processExecutionSupported`, and `customExecutionSupported` as appropriate for this task definition. See the [API documentation](https://code.visualstudio.com/api/extension-guides/task-provider#when-clause) for more information."),default:""}}};var bV;(function(s){function e(t,i,n){if(!t)return;const o=Tt(t.type)?t.type:void 0;if(!o||o.length===0){n.error(h(10058,"The task type configuration is missing the required 'taskType' property"));return}const r=[];if(Array.isArray(t.required))for(const a of t.required)Tt(a)&&r.push(a);return{extensionId:i.value,taskType:o,required:r,properties:t.properties?Tr(t.properties):{},when:t.when?x.deserialize(t.when):void 0}}s.from=e})(bV||(bV={}));const dTe=gl.registerExtensionPoint({extensionPoint:"taskDefinitions",activationEventsGenerator:(s,e)=>{for(const t of s)t.type&&e.push(`onTaskType:${t.type}`)},jsonSchema:{description:h(10059,"Contributes task kinds"),type:"array",items:cTe}});class lTe{constructor(){this._onDefinitionsChanged=new M,this.onDefinitionsChanged=this._onDefinitionsChanged.event,this.taskTypes=Object.create(null),this.readyPromise=new Promise((e,t)=>{dTe.setHandler((i,n)=>{this._schema=void 0;try{for(const o of n.removed){const r=o.value;for(const a of r)this.taskTypes&&a.type&&this.taskTypes[a.type]&&delete this.taskTypes[a.type]}for(const o of n.added){const r=o.value;for(const a of r){const c=bV.from(a,o.description.identifier,o.collector);c&&(this.taskTypes[c.taskType]=c)}}(n.removed.length>0||n.added.length>0)&&this._onDefinitionsChanged.fire()}catch{}e(void 0)})})}onReady(){return this.readyPromise}get(e){return this.taskTypes[e]}all(){return Object.keys(this.taskTypes).map(e=>this.taskTypes[e])}getJsonSchema(){if(this._schema===void 0){const e=[];for(const t of this.all()){const i={type:"object",additionalProperties:!1};t.required.length>0&&(i.required=t.required.slice(0)),t.properties!==void 0?i.properties=Tr(t.properties):i.properties=Object.create(null),i.properties.type={type:"string",enum:[t.taskType]},e.push(i)}this._schema={oneOf:e}}return this._schema}}const hTe=new lTe,Dce="settings";new O("taskRunning",!1,h(10069,"Whether a task is currently running."));new O("taskTerminalActive",!1,h(10070,"Whether the active terminal is a task terminal."));I(10071,"Tasks");var SR;(function(s){s[s.Escape=1]="Escape",s[s.Strong=2]="Strong",s[s.Weak=3]="Weak"})(SR||(SR={}));const kce="$customized";(function(s){function e(t){if(!t)return s.Strong;switch(t.toLowerCase()){case"escape":return s.Escape;case"strong":return s.Strong;case"weak":return s.Weak;default:return s.Strong}}s.from=e})(SR||(SR={}));var dx;(function(s){s.defaults={cwd:"${workspaceFolder}"}})(dx||(dx={}));var lx;(function(s){s[s.Always=1]="Always",s[s.Silent=2]="Silent",s[s.Never=3]="Never"})(lx||(lx={}));(function(s){function e(t){switch(t.toLowerCase()){case"always":return s.Always;case"silent":return s.Silent;case"never":return s.Never;default:return s.Always}}s.fromString=e})(lx||(lx={}));var hx;(function(s){s[s.Never=1]="Never",s[s.OnProblem=2]="OnProblem",s[s.Always=3]="Always"})(hx||(hx={}));(function(s){function e(t){switch(t.toLowerCase()){case"always":return s.Always;case"never":return s.Never;case"onproblem":return s.OnProblem;default:return s.OnProblem}}s.fromString=e})(hx||(hx={}));var ux;(function(s){s[s.Shared=1]="Shared",s[s.Dedicated=2]="Dedicated",s[s.New=3]="New"})(ux||(ux={}));(function(s){function e(t){switch(t.toLowerCase()){case"shared":return s.Shared;case"dedicated":return s.Dedicated;case"new":return s.New;default:return s.Shared}}s.fromString=e})(ux||(ux={}));var CR;(function(s){s.defaults={echo:!0,reveal:lx.Always,revealProblems:hx.Never,focus:!1,panel:ux.Shared,showReuseMessage:!0,clear:!1}})(CR||(CR={}));var dc;(function(s){s[s.Shell=1]="Shell",s[s.Process=2]="Process",s[s.CustomExecution=3]="CustomExecution"})(dc||(dc={}));(function(s){function e(i){switch(i.toLowerCase()){case"shell":return s.Shell;case"process":return s.Process;case"customExecution":return s.CustomExecution;default:return s.Process}}s.fromString=e;function t(i){switch(i){case s.Shell:return"shell";case s.Process:return"process";case s.CustomExecution:return"customExecution";default:return"process"}}s.toString=t})(dc||(dc={}));var EQ;(function(s){function e(t){return Tt(t)?t:t.value}s.value=e})(EQ||(EQ={}));var xQ;(function(s){s.Clean={_id:"clean",isDefault:!1},s.Build={_id:"build",isDefault:!1},s.Rebuild={_id:"rebuild",isDefault:!1},s.Test={_id:"test",isDefault:!1};function e(i){return i===s.Clean._id||i===s.Build._id||i===s.Rebuild._id||i===s.Test._id}s.is=e;function t(i){if(i!==void 0)return Tt(i)?e(i)?{_id:i,isDefault:!1}:void 0:i}s.from=t})(xQ||(xQ={}));var ep;(function(s){s[s.Global=1]="Global",s[s.Workspace=2]="Workspace",s[s.Folder=3]="Folder"})(ep||(ep={}));var Tu;(function(s){s.Workspace="workspace",s.Extension="extension",s.InMemory="inMemory",s.WorkspaceFile="workspaceFile",s.User="user";function e(t){switch(t){case s.User:return us.USER;case s.WorkspaceFile:return us.WORKSPACE;default:return us.WORKSPACE_FOLDER}}s.toConfigurationTarget=e})(Tu||(Tu={}));var IQ;(function(s){s.parallel="parallel",s.sequence="sequence"})(IQ||(IQ={}));var yV;(function(s){s[s.default=1]="default",s[s.folderOpen=2]="folderOpen"})(yV||(yV={}));var ER;(function(s){s.defaults={reevaluateOnRerun:!0,runOn:yV.default,instanceLimit:1}})(ER||(ER={}));class FK{constructor(e,t,i,n,o,r){this._label="",this._id=e,t&&(this._label=t),i&&(this.type=i),this.runOptions=n,this.configurationProperties=o,this._source=r}getDefinition(e){}getMapKey(){return this._id}getKey(){}getCommonTaskId(){const e={folder:this.getFolderId(),id:this._id};return JSON.stringify(e)}clone(){return this.fromObject(Object.assign({},this))}getWorkspaceFolder(){}getWorkspaceFileName(){}getTelemetryKind(){return"unknown"}matches(e,t=!1){if(e===void 0)return!1;if(Tt(e))return e===this._label||e===this.configurationProperties.identifier||t&&e===this._id;const i=this.getDefinition(!0);return i!==void 0&&i._key===e._key}getQualifiedLabel(){const e=this.getWorkspaceFolder();return e?`${this._label} (${e.name})`:this._label}getTaskExecution(){return{id:this._id,task:this}}addTaskLoadMessages(e){this._taskLoadMessages===void 0&&(this._taskLoadMessages=[]),e&&(this._taskLoadMessages=this._taskLoadMessages.concat(e))}get taskLoadMessages(){return this._taskLoadMessages}}class BC extends FK{constructor(e,t,i,n,o,r,a,c){super(e,i,void 0,a,c,t),this.command={},this._source=t,this.hasDefinedMatchers=r,o&&(this.command=o)}clone(){return new BC(this._id,this._source,this._label,this.type,this.command,this.hasDefinedMatchers,this.runOptions,this.configurationProperties)}customizes(){if(this._source&&this._source.customizes)return this._source.customizes}getDefinition(e=!1){if(e&&this._source.customizes!==void 0)return this._source.customizes;{let t;switch(this.command?this.command.runtime:void 0){case dc.Shell:t="shell";break;case dc.Process:t="process";break;case dc.CustomExecution:t="customExecution";break;case void 0:t="$composite";break;default:throw new Error("Unexpected task runtime")}return{type:t,_key:this._id,id:this._id}}}static is(e){return e instanceof BC}getMapKey(){const e=this._source.config.workspaceFolder;return e?`${e.uri.toString()}|${this._id}|${this.instance}`:`${this._id}|${this.instance}`}getFolderId(){return this._source.kind===Tu.User?Dce:this._source.config.workspaceFolder?.uri.toString()}getCommonTaskId(){return this._source.customizes?super.getCommonTaskId():this.getKey()??super.getCommonTaskId()}getKey(){const e=this.getFolderId();if(!e)return;let t=this.configurationProperties.identifier;return this._source.kind!==Tu.Workspace&&(t+=this._source.kind),JSON.stringify({type:kce,folder:e,id:t})}getWorkspaceFolder(){return this._source.config.workspaceFolder}getWorkspaceFileName(){return this._source.config.workspace&&this._source.config.workspace.configuration?Qe(this._source.config.workspace.configuration):void 0}getTelemetryKind(){return this._source.customizes?"workspace>extension":"workspace"}fromObject(e){return new BC(e._id,e._source,e._label,e.type,e.command,e.hasDefinedMatchers,e.runOptions,e.configurationProperties)}}class VC extends FK{constructor(e,t,i,n,o,r,a){super(e,i,n,r,a,t),this._source=t,this.configures=o}static is(e){return e instanceof VC}fromObject(e){return e}getDefinition(){return this.configures}getWorkspaceFileName(){return this._source.config.workspace&&this._source.config.workspace.configuration?Qe(this._source.config.workspace.configuration):void 0}getWorkspaceFolder(){return this._source.config.workspaceFolder}getFolderId(){return this._source.kind===Tu.User?Dce:this._source.config.workspaceFolder?.uri.toString()}getKey(){const e=this.getFolderId();if(!e)return;let t=this.configurationProperties.identifier;return this._source.kind!==Tu.Workspace&&(t+=this._source.kind),JSON.stringify({type:kce,folder:e,id:t})}}class Lm extends FK{constructor(e,t,i,n,o,r,a,c,d){super(e,i,n,c,d,t),this.defines=o,this.hasDefinedMatchers=a,this.command=r,this.icon=d.icon,this.hide=d.hide}clone(){return new Lm(this._id,this._source,this._label,this.type,this.defines,this.command,this.hasDefinedMatchers,this.runOptions,this.configurationProperties)}getDefinition(){return this.defines}static is(e){return e instanceof Lm}getMapKey(){const e=this._source.workspaceFolder;return e?`${this._source.scope.toString()}|${e.uri.toString()}|${this._id}|${this.instance}`:`${this._source.scope.toString()}|${this._id}|${this.instance}`}getFolderId(){if(this._source.scope===ep.Folder&&this._source.workspaceFolder)return this._source.workspaceFolder.uri.toString()}getKey(){const e={type:"contributed",scope:this._source.scope,id:this._id};return e.folder=this.getFolderId(),JSON.stringify(e)}getWorkspaceFolder(){return this._source.workspaceFolder}getTelemetryKind(){return"extension"}fromObject(e){return new Lm(e._id,e._source,e._label,e.type,e.defines,e.command,e.hasDefinedMatchers,e.runOptions,e.configurationProperties)}}var xR;(function(s){s[s.Process=1]="Process",s[s.Terminal=2]="Terminal"})(xR||(xR={}));(function(s){s._default=s.Terminal})(xR||(xR={}));var DQ;(function(s){s[s.V0_1_0=1]="V0_1_0",s[s.V2_0_0=2]="V2_0_0"})(DQ||(DQ={}));var IR;(function(s){s.SingleRun="singleRun",s.Background="background"})(IR||(IR={}));var em;(function(s){s.Changed="changed",s.ProcessStarted="processStarted",s.ProcessEnded="processEnded",s.Terminated="terminated",s.Start="start",s.AcquiredInput="acquiredInput",s.DependsOnStarted="dependsOnStarted",s.Active="active",s.Inactive="inactive",s.End="end",s.ProblemMatcherStarted="problemMatcherStarted",s.ProblemMatcherEnded="problemMatcherEnded",s.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(em||(em={}));var kQ;(function(s){s[s.System=0]="System",s[s.User=1]="User",s[s.FolderOpen=2]="FolderOpen",s[s.ConfigurationChange=3]="ConfigurationChange",s[s.Reconnect=4]="Reconnect"})(kQ||(kQ={}));var TQ;(function(s){function e(c){return{taskId:c._id,taskName:c.configurationProperties.name,runType:c.configurationProperties.isBackground?IR.Background:IR.SingleRun,group:c.configurationProperties.group,__task:c}}function t(c,d,l){return{...e(c),kind:em.Start,terminalId:d,resolvedVariables:l}}s.start=t;function i(c,d,l){return{...e(c),kind:em.ProcessStarted,terminalId:d,processId:l}}s.processStarted=i;function n(c,d,l){return{...e(c),kind:em.ProcessEnded,terminalId:d,exitCode:l}}s.processEnded=n;function o(c,d,l){return{...e(c),kind:em.Terminated,exitReason:l,terminalId:d}}s.terminated=o;function r(c,d,l){return{...e(d),kind:c,terminalId:l}}s.general=r;function a(){return{kind:em.Changed}}s.changed=a})(TQ||(TQ={}));var DR;(function(s){function e(i){const n=Object.keys(i).sort();let o="";for(const r of n){let a=i[r];a instanceof Object?a=e(a):typeof a=="string"&&(a=a.replace(/,/g,",,")),o+=r+","+a+","}return o}function t(i){const o={_key:e(i),type:i.taskType};return Object.assign(o,i),o}s.create=t})(DR||(DR={}));var AQ;(function(s){s.AutoDetect="task.autoDetect",s.SaveBeforeRun="task.saveBeforeRun",s.ShowDecorations="task.showDecorations",s.ProblemMatchersNeverPrompt="task.problemMatchers.neverPrompt",s.SlowProviderWarning="task.slowProviderWarning",s.QuickOpenHistory="task.quickOpen.history",s.QuickOpenDetail="task.quickOpen.detail",s.QuickOpenSkip="task.quickOpen.skip",s.QuickOpenShowAll="task.quickOpen.showAll",s.AllowAutomaticTasks="task.allowAutomaticTasks",s.Reconnection="task.reconnection",s.VerboseLogging="task.verboseLogging"})(AQ||(AQ={}));var RQ;(function(s){s.Tasks="tasks",s.SuppressTaskName="tasks.suppressTaskName",s.Windows="tasks.windows",s.Osx="tasks.osx",s.Linux="tasks.linux",s.ShowOutput="tasks.showOutput",s.IsShellCommand="tasks.isShellCommand",s.ServiceTestSetting="tasks.service.testSetting"})(RQ||(RQ={}));var wV;(function(s){function e(t,i){const n=hTe.get(t.type);if(n===void 0){const c=Tr(t);return delete c._key,DR.create(c)}const o=Object.create(null);o.type=n.taskType;const r=new Set;n.required.forEach(c=>r.add(c));const a=n.properties;for(const c of Object.keys(a)){const d=t[c];if(d!=null)o[c]=d;else if(r.has(c)){const l=a[c];if(l.default!==void 0)o[c]=Tr(l.default);else switch(l.type){case"boolean":o[c]=!1;break;case"number":case"integer":o[c]=0;break;case"string":o[c]="";break;default:i.error(h(10072,"Error: the task identifier '{0}' is missing the required property '{1}'. The task identifier will be ignored.",JSON.stringify(t,void 0,0),c));return}}}return DR.create(o)}s.createTaskIdentifier=e})(wV||(wV={}));class uTe{constructor(){this.pendingRequests=new Map,this.queue=[],this._onError=new M,this._onExit=new M,this.sequence=1}get onError(){return this._onError.event}get onExit(){return this._onExit.event}onMessage(e){this.messageCallback&&this._onError.fire(new Error("attempt to set more than one 'Message' callback")),this.messageCallback=e}onEvent(e){this.eventCallback&&this._onError.fire(new Error("attempt to set more than one 'Event' callback")),this.eventCallback=e}onRequest(e){this.requestCallback&&this._onError.fire(new Error("attempt to set more than one 'Request' callback")),this.requestCallback=e}sendResponse(e){e.seq>0?this._onError.fire(new Error(`attempt to send more than one response for command ${e.command}`)):this.internalSend("response",e)}sendRequest(e,t,i,n){const o={command:e};if(t&&Object.keys(t).length>0&&(o.arguments=t),this.internalSend("request",o),typeof n=="number"){const r=setTimeout(()=>{clearTimeout(r);const a=this.pendingRequests.get(o.seq);if(a){this.pendingRequests.delete(o.seq);const c={type:"response",seq:0,request_seq:o.seq,success:!1,command:e,message:h(5987,"Timeout after {0} ms for '{1}'",n,e)};a(c)}},n)}return i&&this.pendingRequests.set(o.seq,i),o.seq}acceptMessage(e){this.messageCallback?this.messageCallback(e):(this.queue.push(e),this.queue.length===1&&this.processQueue())}needsTaskBoundaryBetween(e,t){return e.type!=="event"||t.type!=="event"}async processQueue(){let e;for(;this.queue.length;){if((!e||this.needsTaskBoundaryBetween(this.queue[0],e))&&await Da(0),e=this.queue.shift(),!e)return;switch(e.type){case"event":this.eventCallback?.(e);break;case"request":this.requestCallback?.(e);break;case"response":{const t=e,i=this.pendingRequests.get(t.request_seq);i&&(this.pendingRequests.delete(t.request_seq),i(t));break}}}}internalSend(e,t){t.type=e,t.seq=this.sequence++,this.sendMessage(t)}async cancelPendingRequests(){if(this.pendingRequests.size===0)return Promise.resolve();const e=new Map;this.pendingRequests.forEach((t,i)=>e.set(i,t)),await Da(500),e.forEach((t,i)=>{t({type:"response",seq:0,request_seq:i,success:!1,command:"canceled",message:"canceled"}),this.pendingRequests.delete(i)})}getPendingRequestIds(){return Array.from(this.pendingRequests.keys())}dispose(){this.queue=[]}}function Tce(s){return s.configuration.request==="attach"&&!Ace(s)&&(!s.parentSession||Tce(s.parentSession))}function Ace(s){let e=s.configuration.type;if(e)return e==="vslsShare"&&(e=s.configuration.adapterProxy.configuration.type),oo(e,"extensionhost")||oo(e,"pwa-extensionhost")?s:s.parentSession?Ace(s.parentSession):void 0}function t7e(s){return s.type&&(s.label||s.program||s.runtime)}const gTe=/^[a-zA-Z][a-zA-Z0-9\+\-\.]+:/;function pTe(s){return!!(s&&s.match(gTe))}function Rce(s){if(typeof s.path=="string"&&!(typeof s.sourceReference=="number"&&s.sourceReference>0)){if(pTe(s.path))return R.parse(s.path);if(cy(s.path))return R.file(s.path)}return s.path}function Pce(s){if(typeof s.path=="object"){const e=R.revive(s.path);if(e)return e.scheme===ae.file?e.fsPath:e.toString()}return s.path}function fTe(s,e){const t=e?Rce:Pce,i=Tr(s);return Lce(i,(n,o)=>{n&&o&&(o.path=t(o))}),i}function mTe(s,e){const t=e?Rce:Pce,i=Tr(s);return Lce(i,(n,o)=>{!n&&o&&(o.path=t(o))}),i}function Lce(s,e){switch(s.type){case"event":{const t=s;switch(t.event){case"output":e(!1,t.body.source);break;case"loadedSource":e(!1,t.body.source);break;case"breakpoint":e(!1,t.body.breakpoint.source);break}break}case"request":{const t=s;switch(t.command){case"setBreakpoints":e(!0,t.arguments.source);break;case"breakpointLocations":e(!0,t.arguments.source);break;case"source":e(!0,t.arguments.source);break;case"gotoTargets":e(!0,t.arguments.source);break;case"launchVSCode":t.arguments.args.forEach(i=>e(!1,i));break}break}case"response":{const t=s;if(t.success&&t.body)switch(t.command){case"stackTrace":t.body.stackFrames.forEach(i=>e(!1,i.source));break;case"loadedSources":t.body.sources.forEach(i=>e(!1,i));break;case"scopes":t.body.scopes.forEach(i=>e(!1,i.source));break;case"setFunctionBreakpoints":t.body.breakpoints.forEach(i=>e(!1,i.source));break;case"setBreakpoints":t.body.breakpoints.forEach(i=>e(!1,i.source));break;case"disassemble":t.body?.instructions.forEach(n=>e(!1,n.location));break;case"locations":e(!1,t.body?.source);break}break}}}class vTe{constructor(e,t){this.versionId=e,this.removedDueToLooping=t}}class WK extends F{static isHostExtension(e,t,i){if(t.getExtensionDescription(e))return!1;const n=i.getExtensionDescription(e);return n?!!((n.main||n.browser)&&n.api==="none"):!1}constructor(e,t){super(),this._activationEventsReader=e,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._versionId=0,this._extensionDescriptions=t,this._initialize()}_initialize(){this._extensionDescriptions.sort(CTe),this._extensionsMap=new Po,this._extensionsArr=[],this._activationMap=new Map;for(const e of this._extensionDescriptions){if(this._extensionsMap.has(e.identifier)){console.error("Extension `"+e.identifier.value+"` is already registered");continue}this._extensionsMap.set(e.identifier,e),this._extensionsArr.push(e);const t=this._activationEventsReader.readActivationEvents(e);for(const i of t)this._activationMap.has(i)||this._activationMap.set(i,[]),this._activationMap.get(i).push(e)}}set(e){return this._extensionDescriptions=e,this._initialize(),this._versionId++,this._onDidChange.fire(void 0),{versionId:this._versionId}}deltaExtensions(e,t){this._extensionDescriptions=PQ(this._extensionDescriptions,t),this._extensionDescriptions=this._extensionDescriptions.concat(e);const i=WK._findLoopingExtensions(this._extensionDescriptions);return this._extensionDescriptions=PQ(this._extensionDescriptions,i.map(n=>n.identifier)),this._initialize(),this._versionId++,this._onDidChange.fire(void 0),new vTe(this._versionId,i)}static _findLoopingExtensions(e){const t=new class{constructor(){this._arcs=new Map,this._nodesSet=new Set,this._nodesArr=[]}addNode(a){this._nodesSet.has(a)||(this._nodesSet.add(a),this._nodesArr.push(a))}addArc(a,c){this.addNode(a),this.addNode(c),this._arcs.has(a)?this._arcs.get(a).push(c):this._arcs.set(a,[c])}getArcs(a){return this._arcs.has(a)?this._arcs.get(a):[]}hasOnlyGoodArcs(a,c){const d=t.getArcs(a);for(let l=0;l<d.length;l++)if(!c.has(d[l]))return!1;return!0}getNodes(){return this._nodesArr}},i=new Po;for(const a of e)if(i.set(a.identifier,a),a.extensionDependencies)for(const c of a.extensionDependencies)t.addArc(vs.toKey(a.identifier),vs.toKey(c));const n=new Set;t.getNodes().filter(a=>t.getArcs(a).length===0).forEach(a=>n.add(a));const o=t.getNodes().filter(a=>!n.has(a));let r;do{r=!1;for(let a=0;a<o.length;a++){const c=o[a];t.hasOnlyGoodArcs(c,n)&&(o.splice(a,1),a--,n.add(c),r=!0)}}while(r);return o.map(a=>i.get(a))}containsActivationEvent(e){return this._activationMap.has(e)}containsExtension(e){return this._extensionsMap.has(e)}getExtensionDescriptionsForActivationEvent(e){const t=this._activationMap.get(e);return t?t.slice(0):[]}getAllExtensionDescriptions(){return this._extensionsArr.slice(0)}getSnapshot(){return new _Te(this._versionId,this.getAllExtensionDescriptions())}getExtensionDescription(e){const t=this._extensionsMap.get(e);return t||void 0}getExtensionDescriptionByUUID(e){for(const t of this._extensionsArr)if(t.uuid===e)return t}getExtensionDescriptionByIdOrUUID(e,t){return this.getExtensionDescription(e)??(t?this.getExtensionDescriptionByUUID(t):void 0)}}class _Te{constructor(e,t){this.versionId=e,this.extensions=t}}class bTe{constructor(e){this._lock=new STe,this._actual=new WK(e,[])}async acquireLock(e){const t=await this._lock.acquire(e);return new yTe(this,t)}deltaExtensions(e,t,i){if(!e.isAcquiredFor(this))throw new Error("Lock is not held");return this._actual.deltaExtensions(t,i)}containsActivationEvent(e){return this._actual.containsActivationEvent(e)}containsExtension(e){return this._actual.containsExtension(e)}getExtensionDescriptionsForActivationEvent(e){return this._actual.getExtensionDescriptionsForActivationEvent(e)}getAllExtensionDescriptions(){return this._actual.getAllExtensionDescriptions()}getSnapshot(){return this._actual.getSnapshot()}getExtensionDescription(e){return this._actual.getExtensionDescription(e)}getExtensionDescriptionByUUID(e){return this._actual.getExtensionDescriptionByUUID(e)}getExtensionDescriptionByIdOrUUID(e,t){return this._actual.getExtensionDescriptionByIdOrUUID(e,t)}}class yTe extends F{constructor(e,t){super(),this._registry=e,this._isDisposed=!1,this._register(t)}isAcquiredFor(e){return!this._isDisposed&&this._registry===e}}class wTe{constructor(e){this.name=e;const t=xE();this.promise=t.promise,this._resolve=t.resolve}resolve(e){this._resolve(e)}}class STe{constructor(){this._pendingCustomers=[],this._isLocked=!1}async acquire(e){const t=new wTe(e);return this._pendingCustomers.push(t),this._advance(),t.promise}_advance(){if(this._isLocked||this._pendingCustomers.length===0)return;const e=this._pendingCustomers.shift();this._isLocked=!0;let t=!0;const i=setTimeout(()=>{t&&console.warn(`The customer named ${e.name} has been holding on to the lock for 30s. This might be a problem.`)},30*1e3),n=()=>{t&&(clearTimeout(i),t=!1,this._isLocked=!1,this._advance())};e.resolve(Ie(n))}}var Qg;(function(s){s[s.Builtin=0]="Builtin",s[s.User=1]="User",s[s.Dev=2]="Dev"})(Qg||(Qg={}));function CTe(s,e){const t=s.isBuiltin?Qg.Builtin:s.isUnderDevelopment?Qg.Dev:Qg.User,i=e.isBuiltin?Qg.Builtin:e.isUnderDevelopment?Qg.Dev:Qg.User;if(t!==i)return t-i;const n=Yc.basename(s.extensionLocation.path),o=Yc.basename(e.extensionLocation.path);return n<o?-1:n>o?1:0}function PQ(s,e){const t=new Nme(e);return s.filter(i=>!t.has(i.identifier))}class ETe extends RIe{}var kR;(function(s){function e(i){return{remoteAddress:i.remoteAddress,localAddress:i.localAddress,public:!!i.public,privacy:i.privacy??(i.public?vu.Public:vu.Private),protocol:i.protocol}}s.fromApiTunnel=e;function t(i){return{remoteAddress:{host:i.tunnelRemoteHost,port:i.tunnelRemotePort},localAddress:i.localAddress,public:i.privacy!==vu.ConstantPrivate&&i.privacy!==vu.ConstantPrivate,privacy:i.privacy,protocol:i.protocol}}s.fromServiceTunnel=t})(kR||(kR={}));const i7e=J("IExtHostTunnelService");let LQ=class extends F{constructor(e,t,i){super(),this.logService=i,this._showCandidatePort=()=>Promise.resolve(!0),this._extensionTunnels=new Map,this._onDidChangeTunnels=new M,this.onDidChangeTunnels=this._onDidChangeTunnels.event,this._providerHandleCounter=0,this._portAttributesProviders=new Map,this._proxy=e.getProxy(qe.MainThreadTunnelService)}async openTunnel(e,t){this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) ${e.identifier.value} called openTunnel API for ${t.remoteAddress.host}:${t.remoteAddress.port}.`);const i=await this._proxy.$openTunnel(t,e.displayName);if(i){const n=new ETe(i.remoteAddress,i.localAddress,()=>this._proxy.$closeTunnel(i.remoteAddress));return this._register(n),n}}async getTunnels(){return this._proxy.$getTunnels()}nextPortAttributesProviderHandle(){return this._providerHandleCounter++}registerPortsAttributesProvider(e,t){e.portRange===void 0&&e.commandPattern===void 0&&this.logService.error("PortAttributesProvider must specify either a portRange or a commandPattern");const i=this.nextPortAttributesProviderHandle();return this._portAttributesProviders.set(i,{selector:e,provider:t}),this._proxy.$registerPortsAttributesProvider(e,i),new gW(()=>{this._portAttributesProviders.delete(i),this._proxy.$unregisterPortsAttributesProvider(i)})}async $providePortAttributes(e,t,i,n,o){const r=[];for(const c of e){const d=this._portAttributesProviders.get(c);if(!d)return[];r.push(...await Promise.all(t.map(async l=>{let u;try{u=await d.provider.providePortAttributes({port:l,pid:i,commandLine:n},o)}catch{u=await d.provider.providePortAttributes(l,i,n,o)}return{providedAttributes:u,port:l}})))}const a=r.filter(c=>!!c.providedAttributes);return a.length>0?a.map(c=>({autoForwardAction:c.providedAttributes.autoForwardAction,port:c.port})):[]}async $registerCandidateFinder(e){}registerTunnelProvider(e,t){if(this._forwardPortProvider)throw new Error("A tunnel provider has already been registered. Only the first tunnel provider to be registered will be used.");this._forwardPortProvider=async(n,o)=>await e.provideTunnel(n,o,Ce.None)??void 0;const i=t.tunnelFeatures?{elevation:!!t.tunnelFeatures?.elevation,privacyOptions:t.tunnelFeatures?.privacyOptions,protocol:t.tunnelFeatures.protocol===void 0?!0:t.tunnelFeatures.protocol}:void 0;return this._proxy.$setTunnelProvider(i,!0),Promise.resolve(Ie(()=>{this._forwardPortProvider=void 0,this._proxy.$setTunnelProvider(void 0,!1)}))}async setTunnelFactory(e,t){if(e){e.candidatePortSource!==void 0&&this._proxy.$setCandidatePortSource(e.candidatePortSource),e.showCandidatePort&&(this._showCandidatePort=e.showCandidatePort,this._proxy.$setCandidateFilter());const i=e.tunnelFactory??(t?this.makeManagedTunnelFactory(t):void 0);if(i){this._forwardPortProvider=i;let n=e.tunnelFeatures?.privacyOptions??[];e.tunnelFeatures?.public&&n.length===0&&(n=[{id:"private",label:h(2571,"Private"),themeIcon:"lock"},{id:"public",label:h(2572,"Public"),themeIcon:"eye"}]);const o=e.tunnelFeatures?{elevation:!!e.tunnelFeatures?.elevation,public:!!e.tunnelFeatures?.public,privacyOptions:n,protocol:!0}:void 0;this._proxy.$setTunnelProvider(o,!!e.tunnelFactory)}}else this._forwardPortProvider=void 0;return Ie(()=>{this._forwardPortProvider=void 0})}makeManagedTunnelFactory(e){}async $closeTunnel(e,t){if(this._extensionTunnels.has(e.host)){const i=this._extensionTunnels.get(e.host);i.has(e.port)&&(t&&i.get(e.port).disposeListener.dispose(),await i.get(e.port).tunnel.dispose(),i.delete(e.port))}}async $onDidTunnelsChange(){this._onDidChangeTunnels.fire()}async $forwardPort(e,t){if(this._forwardPortProvider)try{this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Getting tunnel from provider.");const i=this._forwardPortProvider(e,t);if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Got tunnel promise from provider."),i!==void 0){const n=await i;if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Successfully awaited tunnel from provider."),n===void 0){this.logService.error("ForwardedPorts: (ExtHostTunnelService) Resolved tunnel is undefined");return}this._extensionTunnels.has(e.remoteAddress.host)||this._extensionTunnels.set(e.remoteAddress.host,new Map);const o=this._register(n.onDidDispose(()=>(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Extension fired tunnel's onDidDispose."),this._proxy.$closeTunnel(n.remoteAddress))));return this._extensionTunnels.get(e.remoteAddress.host).set(e.remoteAddress.port,{tunnel:n,disposeListener:o}),kR.fromApiTunnel(n)}else this.logService.trace("ForwardedPorts: (ExtHostTunnelService) Tunnel is undefined")}catch(i){if(this.logService.trace("ForwardedPorts: (ExtHostTunnelService) tunnel provider error"),i instanceof Error)return i.message}}async $applyCandidateFilter(e){const t=await Promise.all(e.map(n=>this._showCandidatePort(n.host,n.port,n.detail??""))),i=e.filter((n,o)=>t[o]);return this.logService.trace(`ForwardedPorts: (ExtHostTunnelService) filtered from ${e.map(n=>n.port).join(", ")} to ${i.map(n=>n.port).join(", ")}`),i}};LQ=f([p(0,xke),p(1,kke),p(2,Re)],LQ);const Mce="__";function xTe(s){return typeof s=="object"&&"uri"in s&&"pattern"in s}let TR=class{constructor(e,t,i,n,o,r){this.configurationService=e,this.workspaceContextService=t,this.editorGroupsService=i,this.logService=n,this.pathService=o,this.uriIdentityService=r}aiText(e,t,i={}){return{...this.commonQuery(t?.map(Ek),i),type:bp.aiText,contentPattern:e}}text(e,t,i={}){e=this.getContentPattern(e,i);const n=this.configurationService.getValue(),o=t&&t.some(a=>!this.configurationService.getValue({resource:a}).search.useRipgrep);return{...this.commonQuery(t?.map(Ek),i),type:bp.Text,contentPattern:e,previewOptions:i.previewOptions,maxFileSize:i.maxFileSize,usePCRE2:n.search.usePCRE2||o||!1,surroundingContext:i.surroundingContext,userDisabledExcludesAndIgnoreFiles:i.disregardExcludeSettings&&i.disregardIgnoreFiles}}getContentPattern(e,t){const i=this.configurationService.getValue();e.isRegExp&&(e.pattern=e.pattern.replace(/\r?\n/g,"\\n"));const n={...e,wordSeparators:i.editor.wordSeparators};return this.isCaseSensitive(e,t)&&(n.isCaseSensitive=!0),this.isMultiline(e)&&(n.isMultiline=!0),t.notebookSearchConfig?.includeMarkupInput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookMarkdownInput=t.notebookSearchConfig.includeMarkupInput),t.notebookSearchConfig?.includeMarkupPreview&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookMarkdownPreview=t.notebookSearchConfig.includeMarkupPreview),t.notebookSearchConfig?.includeCodeInput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookCellInput=t.notebookSearchConfig.includeCodeInput),t.notebookSearchConfig?.includeOutput&&(n.notebookInfo||(n.notebookInfo={}),n.notebookInfo.isInNotebookCellOutput=t.notebookSearchConfig.includeOutput),n}file(e,t={}){return{...this.commonQuery(e,t),type:bp.File,filePattern:t.filePattern?t.filePattern.trim():t.filePattern,exists:t.exists,sortByScore:t.sortByScore,cacheKey:t.cacheKey,shouldGlobMatchFilePattern:t.shouldGlobSearch}}handleIncludeExclude(e,t){if(!e)return{};if(Array.isArray(e)){if(e=e.filter(i=>i.length>0).map(qk),!e.length)return{}}else e=qk(e);return t?this.parseSearchPaths(e):{pattern:b1(...Array.isArray(e)?e:[e])}}commonQuery(e=[],t={}){let i=Array.isArray(t.excludePattern)?t.excludePattern.map(l=>l.pattern).flat():t.excludePattern;i=i?.length===1?i[0]:i;const n=this.handleIncludeExclude(t.includePattern,t.expandPatterns),o=this.handleIncludeExclude(i,t.expandPatterns),r=e.length>1,a=(n.searchPaths&&n.searchPaths.length?n.searchPaths.map(l=>this.getFolderQueryForSearchPath(l,t,o)):e.map(l=>this.getFolderQueryForRoot(l,t,o,r))).filter(l=>!!l),c={_reason:t._reason,folderQueries:a,usingSearchPaths:!!(n.searchPaths&&n.searchPaths.length),extraFileResources:t.extraFileResources,excludePattern:o.pattern,includePattern:n.pattern,onlyOpenEditors:t.onlyOpenEditors,maxResults:t.maxResults,onlyFileScheme:t.onlyFileScheme};if(t.onlyOpenEditors){const l=$t(this.editorGroupsService.groups.flatMap(m=>m.editors.map(v=>v.resource)));this.logService.trace("QueryBuilder#commonQuery - openEditor URIs",JSON.stringify(l));const u=l.filter(m=>SQ(c,m.fsPath)),g=this.commonQueryFromFileList(u);return this.logService.trace("QueryBuilder#commonQuery - openEditor Query",JSON.stringify(g)),{...c,...g}}const d=t.extraFileResources&&t.extraFileResources.filter(l=>SQ(c,l.fsPath));return c.extraFileResources=d&&d.length?d:void 0,c}commonQueryFromFileList(e){const t=[],i=new In,n={};let o=!1;return e.forEach(r=>{if(r.scheme===ae.walkThrough)return;if(Ome(r)){const c=this.workspaceContextService.getWorkspaceFolder(r)?.uri??this.uriIdentityService.extUri.dirname(r);let d=i.get(c);d||(o=!0,d={folder:c,includePattern:{}},t.push(d),i.set(c,d));const l=zM(c.fsPath,r.fsPath);jt(d.includePattern)[l.replace(/\\/g,"/")]=!0}else r.fsPath&&(o=!0,n[r.fsPath]=!0)}),{folderQueries:t,includePattern:n,usingSearchPaths:!0,excludePattern:o?void 0:{"**/*":!0}}}isCaseSensitive(e,t){if(t.isSmartCase){if(e.isRegExp){if(IF(e.pattern,!0))return!0}else if(IF(e.pattern))return!0}return!!e.isCaseSensitive}isMultiline(e){return e.isMultiline||e.isRegExp&&Fme(e.pattern)||e.pattern.indexOf(`
`)>=0?!0:!!e.isMultiline}parseSearchPaths(e){const t=u=>cy(u)||/^\.\.?([\/\\]|$)/.test(u),n=(Array.isArray(e)?e:DTe(e)).map(u=>{const g=this.pathService.resolvedUserHome;return g?Wme(u,g.scheme===ae.file?g.fsPath:g.path):u}),o=Bme(n,u=>t(u)?"searchPaths":"exprSegments"),r=(o.exprSegments||[]).map(u=>jm(u,"/")).map(u=>jm(u,"\\")).map(u=>(u[0]==="."&&(u="*"+u),kTe(u))),a={},c=this.expandSearchPathPatterns(o.searchPaths||[]);c&&c.length&&(a.searchPaths=c);const d=r.flat(),l=b1(...d);return l&&(a.pattern=l),a}getExcludesForFolder(e,t){return t.disregardExcludeSettings?void 0:xce(e,!t.disregardSearchExcludeSettings)}expandSearchPathPatterns(e){if(!e||!e.length)return[];const t=e.flatMap(n=>{let{pathPortion:o,globPortion:r}=ITe(n);return r&&(r=y1(r)),this.expandOneSearchPath(o).flatMap(c=>this.resolveOneSearchPathPattern(c,r))}),i=new Map;return t.forEach(n=>{const o=n.searchPath.toString(),r=i.get(o);r?n.pattern&&(r.pattern=r.pattern||{},r.pattern[n.pattern]=!0):i.set(o,{searchPath:n.searchPath,pattern:n.pattern?b1(n.pattern):void 0})}),Array.from(i.values())}expandOneSearchPath(e){if(cy(e)){const t=this.workspaceContextService.getWorkspace().folders;return t[0]&&t[0].uri.scheme!==ae.file?[{searchPath:t[0].uri.with({path:e})}]:[{searchPath:R.file(bz(e))}]}if(this.workspaceContextService.getWorkbenchState()===Zo.FOLDER){const t=this.workspaceContextService.getWorkspace().folders[0].uri;if(e=qk(e),e.startsWith("../")||e===".."){const n=Yc.resolve(t.path,e);return[{searchPath:t.with({path:n})}]}const i=y1(e);return[{searchPath:t,pattern:i}]}else{if(e==="./"||e===".\\")return[];{const t=e.replace(/^\.[\/\\]/,""),n=this.workspaceContextService.getWorkspace().folders.map(o=>{const r=t.match(new RegExp(`^${dy(o.name)}(?:/(.*)|$)`));return r?{match:r,folder:o}:null}).filter(wa);if(n.length)return n.map(o=>{const r=o.match[1];return{searchPath:o.folder.uri,pattern:r&&y1(r)}});{const o=e.match(/\.[\/\\](.+)[\/\\]?/),r=o?o[1]:e,a=h(12555,"Workspace folder does not exist: {0}",r);throw new Error(a)}}}}resolveOneSearchPathPattern(e,t){const i=e.pattern&&t?`${e.pattern}/${t}`:e.pattern||t,n=[{searchPath:e.searchPath,pattern:i}];return i&&!i.endsWith("**")&&n.push({searchPath:e.searchPath,pattern:i+"/**"}),n}getFolderQueryForSearchPath(e,t,i){const n=this.getFolderQueryForRoot(Ek(e.searchPath),t,i,!1);return n?{...n,includePattern:e.pattern}:null}getFolderQueryForRoot(e,t,i,n){let o;const r=R.isUri(e)?e:e.uri;let a=t.excludePattern?.map(m=>{const v=t.excludePattern&&xTe(m)?m.uri:void 0;return!v||!(R.isUri(e)&&this.uriIdentityService.extUri.isEqual(e,v))?v:void 0});if(a?.length||(a=[void 0]),i.searchPaths){const m=i.searchPaths.filter(v=>At(v.searchPath,r))[0];if(m&&!m.pattern)return null;m&&(o=m.pattern)}const c=this.configurationService.getValue({resource:r}),l={...this.getExcludesForFolder(c,t)||{},...o||{}},u=R.isUri(e)?Qe(e):e.name,g=a.map(m=>Object.keys(l).length>0?{folder:m,pattern:l}:void 0).filter(m=>m);return{folder:r,folderName:n?u:void 0,excludePattern:g,fileEncoding:c.files&&c.files.encoding,disregardIgnoreFiles:typeof t.disregardIgnoreFiles=="boolean"?t.disregardIgnoreFiles:!c.search?.useIgnoreFiles,disregardGlobalIgnoreFiles:typeof t.disregardGlobalIgnoreFiles=="boolean"?t.disregardGlobalIgnoreFiles:!c.search?.useGlobalIgnoreFiles,disregardParentIgnoreFiles:typeof t.disregardParentIgnoreFiles=="boolean"?t.disregardParentIgnoreFiles:!c.search?.useParentIgnoreFiles,ignoreSymlinks:typeof t.ignoreSymlinks=="boolean"?t.ignoreSymlinks:!c.search?.followSymlinks}}};TR=f([p(0,ne),p(1,It),p(2,xe),p(3,Re),p(4,_c),p(5,nn)],TR);function ITe(s){const e=s.match(/[\*\{\}\(\)\[\]\?]/);if(e){const t=e.index,i=s.substr(0,t).match(/[/|\\][^/\\]*$/);if(i){let n=s.substr(0,i.index);return n.match(/[/\\]/)||(n+="/"),{pathPortion:n,globPortion:s.substr((i.index||0)+1)}}}return{pathPortion:s}}function b1(...s){return s.length?s.reduce((e,t)=>(e[t]=!0,e),Object.create(null)):void 0}function DTe(s){return Vme(s,",").map(e=>e.trim()).filter(e=>!!e.length)}function kTe(s){return[`**/${s}/**`,`**/${s}`].map(t=>t.replace(/\*\*\/\*\*/g,"**"))}function qk(s){return s.replace(/\\/g,"/")}function y1(s){return qk(s).replace(/^\.\//,"").replace(/\/+$/g,"")}const TTe=7e3;function ATe(s,e){const t=e.activationEvents;if(!t)return Promise.resolve(void 0);const i=[],n=[];for(const l of t)if(/^workspaceContains:/.test(l)){const u=l.substr(18);u.indexOf("*")>=0||u.indexOf("?")>=0||s.forceUsingSearch?n.push(u):i.push(u)}if(i.length===0&&n.length===0)return Promise.resolve(void 0);const{promise:o,resolve:r}=xE(),a=l=>r({activationEvent:l}),c=Promise.all(i.map(l=>RTe(s,l,a))).then(()=>{}),d=PTe(s,e.identifier,n,a);return Promise.all([c,d]).then(()=>{r(void 0)}),o}async function RTe(s,e,t){for(const i of s.folders)if(await s.exists(Ct(R.revive(i),e))){t(`workspaceContains:${e}`);return}}async function PTe(s,e,t,i){if(t.length===0)return Promise.resolve(void 0);const n=new li,o=s.checkExists(s.folders,t,n.token),r=setTimeout(async()=>{n.cancel(),s.logService.info(`Not activating extension '${e.value}': Timed out while searching for 'workspaceContains' pattern ${t.join(",")}`)},TTe);let a=!1;try{a=await o}catch(c){ys(c)||mt(c)}n.dispose(),clearTimeout(r),a&&i(`workspaceContains:${t.join(",")}`)}function Nce(s,e,t,i){const n=s.get(Z),o=s.get(kI),a=n.createInstance(TR).file(e.map(c=>Ek(R.revive(c))),{_reason:"checkExists",includePattern:t,exists:!0});return o.fileSearch(a,i).then(c=>!!c.limitHit,c=>ys(c)?!1:Promise.reject(c))}function Oce(s,e,t,i){if(!s||i>200)return null;if(typeof s=="object"){if(s.$mid===Dn.Uri)return t?R.revive(e.transformIncoming(s)):e.transformIncoming(s);if(s instanceof Le)return null;for(const n in s)if(Object.hasOwnProperty.call(s,n)){const o=Oce(s[n],e,t,i+1);o!==null&&(s[n]=o)}}return null}function kS(s,e){const t=Oce(s,e,!1,0);return t===null?s:t}class Fce{constructor(){this._actual=null,this._actualOk=null,this._actualErr=null,this._hasValue=!1,this._value=null,this._hasErr=!1,this._err=null}get[Symbol.toStringTag](){return this.toString()}_ensureActual(){return this._actual||(this._actual=new Promise((e,t)=>{this._actualOk=e,this._actualErr=t,this._hasValue&&this._actualOk(this._value),this._hasErr&&this._actualErr(this._err)})),this._actual}resolveOk(e){this._hasValue||this._hasErr||(this._hasValue=!0,this._value=e,this._actual&&this._actualOk(e))}resolveErr(e){this._hasValue||this._hasErr||(this._hasErr=!0,this._err=e,this._actual?this._actualErr(e):mt(e))}then(e,t){return this._ensureActual().then(e,t)}catch(e){return this._ensureActual().then(void 0,e)}finally(e){return this._ensureActual().finally(e)}}class LTe extends Fce{constructor(){super(),this._hasErr=!0,this._err=new fo}}var MQ;function SV(s,e){try{return JSON.stringify(s,e)}catch{return"null"}}const BK="$$ref$$",MTe={[BK]:-1};function NQ(s,e=null,t=!1){const i=[];return{jsonString:(t?SV:JSON.stringify)(s,(o,r)=>{if(typeof r>"u")return MTe;if(typeof r=="object"){if(r instanceof Le){const a=i.push(r)-1;return{[BK]:a}}if(e)return e(o,r)}return r}),referencedBuffers:i}}function Wce(s,e,t){return JSON.parse(s,(i,n)=>{if(n){const o=n[BK];if(typeof o=="number")return e[o];if(t&&n.$mid===Dn.Uri)return t.transformIncoming(n)}return n})}function OQ(s,e){return JSON.stringify(s,e)}function NTe(s){return s?(e,t)=>t&&t.$mid===Dn.Uri?s.transformOutgoing(t):t:null}var jr;(function(s){s[s.LocalSide=0]="LocalSide",s[s.OtherSide=1]="OtherSide"})(jr||(jr={}));var Mm;(function(s){s[s.Responsive=0]="Responsive",s[s.Unresponsive=1]="Unresponsive"})(Mm||(Mm={}));const OTe=()=>{},FTe=Symbol.for("rpcProtocol"),WTe=Symbol.for("rpcProxy");class AR extends F{static{MQ=FTe}static{this.UNRESPONSIVE_TIME=3*1e3}constructor(e,t=null,i=null){super(),this[MQ]=!0,this._onDidChangeResponsiveState=this._register(new M),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._protocol=e,this._logger=t,this._uriTransformer=i,this._uriReplacer=NTe(this._uriTransformer),this._isDisposed=!1,this._locals=[],this._proxies=[];for(let n=0,o=xN.count;n<o;n++)this._locals[n]=null,this._proxies[n]=null;this._lastMessageId=0,this._cancelInvokedHandlers=Object.create(null),this._pendingRPCReplies={},this._responsiveState=Mm.Responsive,this._unacknowledgedCount=0,this._unresponsiveTime=0,this._asyncCheckUresponsive=this._register(new yn(()=>this._checkUnresponsive(),1e3)),this._register(this._protocol.onMessage(n=>this._receiveOneMessage(n)))}dispose(){this._isDisposed=!0,Object.keys(this._pendingRPCReplies).forEach(e=>{const t=this._pendingRPCReplies[e];delete this._pendingRPCReplies[e],t.resolveErr(Ab())}),super.dispose()}drain(){return typeof this._protocol.drain=="function"?this._protocol.drain():Promise.resolve()}_onWillSendRequest(e){this._unacknowledgedCount===0&&(this._unresponsiveTime=Date.now()+AR.UNRESPONSIVE_TIME),this._unacknowledgedCount++,this._asyncCheckUresponsive.isScheduled()||this._asyncCheckUresponsive.schedule()}_onDidReceiveAcknowledge(e){this._unresponsiveTime=Date.now()+AR.UNRESPONSIVE_TIME,this._unacknowledgedCount--,this._unacknowledgedCount===0&&this._asyncCheckUresponsive.cancel(),this._setResponsiveState(Mm.Responsive)}_checkUnresponsive(){this._unacknowledgedCount!==0&&(Date.now()>this._unresponsiveTime?this._setResponsiveState(Mm.Unresponsive):this._asyncCheckUresponsive.schedule())}_setResponsiveState(e){this._responsiveState!==e&&(this._responsiveState=e,this._onDidChangeResponsiveState.fire(this._responsiveState))}get responsiveState(){return this._responsiveState}transformIncomingURIs(e){return this._uriTransformer?kS(e,this._uriTransformer):e}getProxy(e){const{nid:t,sid:i}=e;return this._proxies[t]||(this._proxies[t]=this._createProxy(t,i)),this._proxies[t]}_createProxy(e,t){const i={get:(n,o)=>(typeof o=="string"&&!n[o]&&o.charCodeAt(0)===st.DollarSign&&(n[o]=(...r)=>this._remoteCall(e,o,r)),o===WTe?t:n[o])};return new Proxy(Object.create(null),i)}set(e,t){return this._locals[e.nid]=t,t}assertRegistered(e){for(let t=0,i=e.length;t<i;t++){const n=e[t];if(!this._locals[n.nid])throw new Error(`Missing proxy instance ${n.sid}`)}}_receiveOneMessage(e){if(this._isDisposed)return;const t=e.byteLength,i=Gn.read(e,0),n=i.readUInt8(),o=i.readUInt32();switch(n){case xn.RequestJSONArgs:case xn.RequestJSONArgsWithCancellation:{let{rpcId:r,method:a,args:c}=Ec.deserializeRequestJSONArgs(i);this._uriTransformer&&(c=kS(c,this._uriTransformer)),this._receiveRequest(t,o,r,a,c,n===xn.RequestJSONArgsWithCancellation);break}case xn.RequestMixedArgs:case xn.RequestMixedArgsWithCancellation:{let{rpcId:r,method:a,args:c}=Ec.deserializeRequestMixedArgs(i);this._uriTransformer&&(c=kS(c,this._uriTransformer)),this._receiveRequest(t,o,r,a,c,n===xn.RequestMixedArgsWithCancellation);break}case xn.Acknowledged:{this._logger?.logIncoming(t,o,jr.LocalSide,"ack"),this._onDidReceiveAcknowledge(o);break}case xn.Cancel:{this._receiveCancel(t,o);break}case xn.ReplyOKEmpty:{this._receiveReply(t,o,void 0);break}case xn.ReplyOKJSON:{let r=Ec.deserializeReplyOKJSON(i);this._uriTransformer&&(r=kS(r,this._uriTransformer)),this._receiveReply(t,o,r);break}case xn.ReplyOKJSONWithBuffers:{const r=Ec.deserializeReplyOKJSONWithBuffers(i,this._uriTransformer);this._receiveReply(t,o,r);break}case xn.ReplyOKVSBuffer:{const r=Ec.deserializeReplyOKVSBuffer(i);this._receiveReply(t,o,r);break}case xn.ReplyErrError:{let r=Ec.deserializeReplyErrError(i);this._uriTransformer&&(r=kS(r,this._uriTransformer)),this._receiveReplyErr(t,o,r);break}case xn.ReplyErrEmpty:{this._receiveReplyErr(t,o,void 0);break}default:console.error("received unexpected message"),console.error(e)}}_receiveRequest(e,t,i,n,o,r){this._logger?.logIncoming(e,t,jr.OtherSide,`receiveRequest ${zD(i)}.${n}(`,o);const a=String(t);let c,d;if(r){const u=new li;o.push(u.token),c=this._invokeHandler(i,n,o),d=()=>u.cancel()}else c=this._invokeHandler(i,n,o),d=OTe;this._cancelInvokedHandlers[a]=d;const l=Ec.serializeAcknowledged(t);this._logger?.logOutgoing(l.byteLength,t,jr.OtherSide,"ack"),this._protocol.send(l),c.then(u=>{delete this._cancelInvokedHandlers[a];const g=Ec.serializeReplyOK(t,u,this._uriReplacer);this._logger?.logOutgoing(g.byteLength,t,jr.OtherSide,"reply:",u),this._protocol.send(g)},u=>{delete this._cancelInvokedHandlers[a];const g=Ec.serializeReplyErr(t,u);this._logger?.logOutgoing(g.byteLength,t,jr.OtherSide,"replyErr:",u),this._protocol.send(g)})}_receiveCancel(e,t){this._logger?.logIncoming(e,t,jr.OtherSide,"receiveCancel");const i=String(t);this._cancelInvokedHandlers[i]?.()}_receiveReply(e,t,i){this._logger?.logIncoming(e,t,jr.LocalSide,"receiveReply:",i);const n=String(t);if(!this._pendingRPCReplies.hasOwnProperty(n))return;const o=this._pendingRPCReplies[n];delete this._pendingRPCReplies[n],o.resolveOk(i)}_receiveReplyErr(e,t,i){this._logger?.logIncoming(e,t,jr.LocalSide,"receiveReplyErr:",i);const n=String(t);if(!this._pendingRPCReplies.hasOwnProperty(n))return;const o=this._pendingRPCReplies[n];delete this._pendingRPCReplies[n];let r;i&&(i.$isError?(r=new Error,r.name=i.name,r.message=i.message,r.stack=i.stack):r=i),o.resolveErr(r)}_invokeHandler(e,t,i){try{return Promise.resolve(this._doInvokeHandler(e,t,i))}catch(n){return Promise.reject(n)}}_doInvokeHandler(e,t,i){const n=this._locals[e];if(!n)throw new Error("Unknown actor "+zD(e));const o=n[t];if(typeof o!="function")throw new Error("Unknown method "+t+" on actor "+zD(e));return o.apply(n,i)}_remoteCall(e,t,i){if(this._isDisposed)return new LTe;let n=null;if(i.length>0&&Ce.isCancellationToken(i[i.length-1])&&(n=i.pop()),n&&n.isCancellationRequested)return Promise.reject(Ab());const o=Ec.serializeRequestArguments(i,this._uriReplacer),r=++this._lastMessageId,a=String(r),c=new Fce,d=new U;n&&d.add(n.onCancellationRequested(()=>{const u=Ec.serializeCancel(r);this._logger?.logOutgoing(u.byteLength,r,jr.LocalSide,"cancel"),this._protocol.send(u)})),this._pendingRPCReplies[a]=new BTe(c,d),this._onWillSendRequest(r);const l=Ec.serializeRequest(r,e,t,o,!!n);return this._logger?.logOutgoing(l.byteLength,r,jr.LocalSide,`request: ${zD(e)}.${t}(`,i),this._protocol.send(l),c}}class BTe{constructor(e,t){this._promise=e,this._disposable=t}resolveOk(e){this._promise.resolveOk(e),this._disposable.dispose()}resolveErr(e){this._promise.resolveErr(e),this._disposable.dispose()}}class Gn{static alloc(e,t,i){const n=new Gn(Le.alloc(i+1+4),0);return n.writeUInt8(e),n.writeUInt32(t),n}static read(e,t){return new Gn(e,t)}get buffer(){return this._buff}constructor(e,t){this._buff=e,this._offset=t}static sizeUInt8(){return 1}static{this.sizeUInt32=4}writeUInt8(e){this._buff.writeUInt8(e,this._offset),this._offset+=1}readUInt8(){const e=this._buff.readUInt8(this._offset);return this._offset+=1,e}writeUInt32(e){this._buff.writeUInt32BE(e,this._offset),this._offset+=4}readUInt32(){const e=this._buff.readUInt32BE(this._offset);return this._offset+=4,e}static sizeShortString(e){return 1+e.byteLength}writeShortString(e){this._buff.writeUInt8(e.byteLength,this._offset),this._offset+=1,this._buff.set(e,this._offset),this._offset+=e.byteLength}readShortString(){const e=this._buff.readUInt8(this._offset);this._offset+=1;const i=this._buff.slice(this._offset,this._offset+e).toString();return this._offset+=e,i}static sizeLongString(e){return 4+e.byteLength}writeLongString(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}readLongString(){const e=this._buff.readUInt32BE(this._offset);this._offset+=4;const i=this._buff.slice(this._offset,this._offset+e).toString();return this._offset+=e,i}writeBuffer(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}static sizeVSBuffer(e){return 4+e.byteLength}writeVSBuffer(e){this._buff.writeUInt32BE(e.byteLength,this._offset),this._offset+=4,this._buff.set(e,this._offset),this._offset+=e.byteLength}readVSBuffer(){const e=this._buff.readUInt32BE(this._offset);this._offset+=4;const t=this._buff.slice(this._offset,this._offset+e);return this._offset+=e,t}static sizeMixedArray(e){let t=0;t+=1;for(let i=0,n=e.length;i<n;i++){const o=e[i];switch(t+=1,o.type){case Ms.String:t+=this.sizeLongString(o.value);break;case Ms.VSBuffer:t+=this.sizeVSBuffer(o.value);break;case Ms.SerializedObjectWithBuffers:t+=this.sizeUInt32,t+=this.sizeLongString(o.value);for(let r=0;r<o.buffers.length;++r)t+=this.sizeVSBuffer(o.buffers[r]);break}}return t}writeMixedArray(e){this._buff.writeUInt8(e.length,this._offset),this._offset+=1;for(let t=0,i=e.length;t<i;t++){const n=e[t];switch(n.type){case Ms.String:this.writeUInt8(Ms.String),this.writeLongString(n.value);break;case Ms.VSBuffer:this.writeUInt8(Ms.VSBuffer),this.writeVSBuffer(n.value);break;case Ms.SerializedObjectWithBuffers:this.writeUInt8(Ms.SerializedObjectWithBuffers),this.writeUInt32(n.buffers.length),this.writeLongString(n.value);for(let o=0;o<n.buffers.length;++o)this.writeBuffer(n.buffers[o]);break;case Ms.Undefined:this.writeUInt8(Ms.Undefined);break}}}readMixedArray(){const e=this._buff.readUInt8(this._offset);this._offset+=1;const t=new Array(e);for(let i=0;i<e;i++)switch(this.readUInt8()){case Ms.String:t[i]=this.readLongString();break;case Ms.VSBuffer:t[i]=this.readVSBuffer();break;case Ms.SerializedObjectWithBuffers:{const o=this.readUInt32(),r=this.readLongString(),a=[];for(let c=0;c<o;++c)a.push(this.readVSBuffer());t[i]=new ta(Wce(r,a,null));break}case Ms.Undefined:t[i]=void 0;break}return t}}var hb;(function(s){s[s.Simple=0]="Simple",s[s.Mixed=1]="Mixed"})(hb||(hb={}));class Ec{static _useMixedArgSerialization(e){for(let t=0,i=e.length;t<i;t++)if(e[t]instanceof Le||e[t]instanceof ta||typeof e[t]>"u")return!0;return!1}static serializeRequestArguments(e,t){if(this._useMixedArgSerialization(e)){const i=[];for(let n=0,o=e.length;n<o;n++){const r=e[n];if(r instanceof Le)i[n]={type:Ms.VSBuffer,value:r};else if(typeof r>"u")i[n]={type:Ms.Undefined};else if(r instanceof ta){const{jsonString:a,referencedBuffers:c}=NQ(r.value,t);i[n]={type:Ms.SerializedObjectWithBuffers,value:Le.fromString(a),buffers:c}}else i[n]={type:Ms.String,value:Le.fromString(OQ(r,t))}}return{type:hb.Mixed,args:i}}return{type:hb.Simple,args:OQ(e,t)}}static serializeRequest(e,t,i,n,o){switch(n.type){case hb.Simple:return this._requestJSONArgs(e,t,i,n.args,o);case hb.Mixed:return this._requestMixedArgs(e,t,i,n.args,o)}}static _requestJSONArgs(e,t,i,n,o){const r=Le.fromString(i),a=Le.fromString(n);let c=0;c+=Gn.sizeUInt8(),c+=Gn.sizeShortString(r),c+=Gn.sizeLongString(a);const d=Gn.alloc(o?xn.RequestJSONArgsWithCancellation:xn.RequestJSONArgs,e,c);return d.writeUInt8(t),d.writeShortString(r),d.writeLongString(a),d.buffer}static deserializeRequestJSONArgs(e){const t=e.readUInt8(),i=e.readShortString(),n=e.readLongString();return{rpcId:t,method:i,args:JSON.parse(n)}}static _requestMixedArgs(e,t,i,n,o){const r=Le.fromString(i);let a=0;a+=Gn.sizeUInt8(),a+=Gn.sizeShortString(r),a+=Gn.sizeMixedArray(n);const c=Gn.alloc(o?xn.RequestMixedArgsWithCancellation:xn.RequestMixedArgs,e,a);return c.writeUInt8(t),c.writeShortString(r),c.writeMixedArray(n),c.buffer}static deserializeRequestMixedArgs(e){const t=e.readUInt8(),i=e.readShortString(),n=e.readMixedArray(),o=new Array(n.length);for(let r=0,a=n.length;r<a;r++){const c=n[r];typeof c=="string"?o[r]=JSON.parse(c):o[r]=c}return{rpcId:t,method:i,args:o}}static serializeAcknowledged(e){return Gn.alloc(xn.Acknowledged,e,0).buffer}static serializeCancel(e){return Gn.alloc(xn.Cancel,e,0).buffer}static serializeReplyOK(e,t,i){if(typeof t>"u")return this._serializeReplyOKEmpty(e);if(t instanceof Le)return this._serializeReplyOKVSBuffer(e,t);if(t instanceof ta){const{jsonString:n,referencedBuffers:o}=NQ(t.value,i,!0);return this._serializeReplyOKJSONWithBuffers(e,n,o)}else return this._serializeReplyOKJSON(e,SV(t,i))}static _serializeReplyOKEmpty(e){return Gn.alloc(xn.ReplyOKEmpty,e,0).buffer}static _serializeReplyOKVSBuffer(e,t){let i=0;i+=Gn.sizeVSBuffer(t);const n=Gn.alloc(xn.ReplyOKVSBuffer,e,i);return n.writeVSBuffer(t),n.buffer}static deserializeReplyOKVSBuffer(e){return e.readVSBuffer()}static _serializeReplyOKJSON(e,t){const i=Le.fromString(t);let n=0;n+=Gn.sizeLongString(i);const o=Gn.alloc(xn.ReplyOKJSON,e,n);return o.writeLongString(i),o.buffer}static _serializeReplyOKJSONWithBuffers(e,t,i){const n=Le.fromString(t);let o=0;o+=Gn.sizeUInt32,o+=Gn.sizeLongString(n);for(const a of i)o+=Gn.sizeVSBuffer(a);const r=Gn.alloc(xn.ReplyOKJSONWithBuffers,e,o);r.writeUInt32(i.length),r.writeLongString(n);for(const a of i)r.writeBuffer(a);return r.buffer}static deserializeReplyOKJSON(e){const t=e.readLongString();return JSON.parse(t)}static deserializeReplyOKJSONWithBuffers(e,t){const i=e.readUInt32(),n=e.readLongString(),o=[];for(let r=0;r<i;++r)o.push(e.readVSBuffer());return new ta(Wce(n,o,t))}static serializeReplyErr(e,t){const i=t?SV(DF(t),null):void 0;if(typeof i!="string")return this._serializeReplyErrEmpty(e);const n=Le.fromString(i);let o=0;o+=Gn.sizeLongString(n);const r=Gn.alloc(xn.ReplyErrError,e,o);return r.writeLongString(n),r.buffer}static deserializeReplyErrError(e){const t=e.readLongString();return JSON.parse(t)}static _serializeReplyErrEmpty(e){return Gn.alloc(xn.ReplyErrEmpty,e,0).buffer}}var xn;(function(s){s[s.RequestJSONArgs=1]="RequestJSONArgs",s[s.RequestJSONArgsWithCancellation=2]="RequestJSONArgsWithCancellation",s[s.RequestMixedArgs=3]="RequestMixedArgs",s[s.RequestMixedArgsWithCancellation=4]="RequestMixedArgsWithCancellation",s[s.Acknowledged=5]="Acknowledged",s[s.Cancel=6]="Cancel",s[s.ReplyOKEmpty=7]="ReplyOKEmpty",s[s.ReplyOKVSBuffer=8]="ReplyOKVSBuffer",s[s.ReplyOKJSON=9]="ReplyOKJSON",s[s.ReplyOKJSONWithBuffers=10]="ReplyOKJSONWithBuffers",s[s.ReplyErrError=11]="ReplyErrError",s[s.ReplyErrEmpty=12]="ReplyErrEmpty"})(xn||(xn={}));var Ms;(function(s){s[s.String=1]="String",s[s.VSBuffer=2]="VSBuffer",s[s.SerializedObjectWithBuffers=3]="SerializedObjectWithBuffers",s[s.Undefined=4]="Undefined"})(Ms||(Ms={}));var _a;(function(s){s[s.Promise=100]="Promise",s[s.PromiseCancel=101]="PromiseCancel",s[s.EventListen=102]="EventListen",s[s.EventDispose=103]="EventDispose"})(_a||(_a={}));function FQ(s){switch(s){case _a.Promise:return"req";case _a.PromiseCancel:return"cancel";case _a.EventListen:return"subscribe";case _a.EventDispose:return"unsubscribe"}}var lr;(function(s){s[s.Initialize=200]="Initialize",s[s.PromiseSuccess=201]="PromiseSuccess",s[s.PromiseError=202]="PromiseError",s[s.PromiseErrorObj=203]="PromiseErrorObj",s[s.EventFire=204]="EventFire"})(lr||(lr={}));function WQ(s){switch(s){case lr.Initialize:return"init";case lr.PromiseSuccess:return"reply:";case lr.PromiseError:case lr.PromiseErrorObj:return"replyErr:";case lr.EventFire:return"event:"}}var tm;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Idle=1]="Idle"})(tm||(tm={}));function w_(s){let e=0;for(let t=0;;t+=7){const i=s.read(1);if(e|=(i.buffer[0]&127)<<t,!(i.buffer[0]&128))return e}}const VTe=Og(0);function S_(s,e){if(e===0){s.write(VTe);return}let t=0;for(let n=e;n!==0;n=n>>>7)t++;const i=Le.alloc(t);for(let n=0;e!==0;n++)i.buffer[n]=e&127,e=e>>>7,e>0&&(i.buffer[n]|=128);s.write(i)}class HTe{constructor(e){this.buffer=e,this.pos=0}read(e){const t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=t.byteLength,t}}class UTe{constructor(){this.buffers=[]}get buffer(){return Le.concat(this.buffers)}write(e){this.buffers.push(e)}}var gr;(function(s){s[s.Undefined=0]="Undefined",s[s.String=1]="String",s[s.Buffer=2]="Buffer",s[s.VSBuffer=3]="VSBuffer",s[s.Array=4]="Array",s[s.Object=5]="Object",s[s.Int=6]="Int"})(gr||(gr={}));function Og(s){const e=Le.alloc(1);return e.writeUInt8(s,0),e}const Wf={Undefined:Og(gr.Undefined),String:Og(gr.String),Buffer:Og(gr.Buffer),VSBuffer:Og(gr.VSBuffer),Array:Og(gr.Array),Object:Og(gr.Object),Uint:Og(gr.Int)},$Te=typeof Buffer<"u";function CV(s,e){if(typeof e>"u")s.write(Wf.Undefined);else if(typeof e=="string"){const t=Le.fromString(e);s.write(Wf.String),S_(s,t.byteLength),s.write(t)}else if($Te&&Buffer.isBuffer(e)){const t=Le.wrap(e);s.write(Wf.Buffer),S_(s,t.byteLength),s.write(t)}else if(e instanceof Le)s.write(Wf.VSBuffer),S_(s,e.byteLength),s.write(e);else if(Array.isArray(e)){s.write(Wf.Array),S_(s,e.length);for(const t of e)CV(s,t)}else if(typeof e=="number"&&(e|0)===e)s.write(Wf.Uint),S_(s,e);else{const t=Le.fromString(JSON.stringify(e));s.write(Wf.Object),S_(s,t.byteLength),s.write(t)}}function EV(s){switch(s.read(1).readUInt8(0)){case gr.Undefined:return;case gr.String:return s.read(w_(s)).toString();case gr.Buffer:return s.read(w_(s)).buffer;case gr.VSBuffer:return s.read(w_(s));case gr.Array:{const t=w_(s),i=[];for(let n=0;n<t;n++)i.push(EV(s));return i}case gr.Object:return JSON.parse(s.read(w_(s)).toString());case gr.Int:return w_(s)}}var ub;(function(s){s[s.LocalSide=0]="LocalSide",s[s.OtherSide=1]="OtherSide"})(ub||(ub={}));class BQ{constructor(e,t=null){this.protocol=e,this.isDisposed=!1,this.state=tm.Uninitialized,this.activeRequests=new Set,this.handlers=new Map,this.lastRequestId=0,this._onDidInitialize=new M,this.onDidInitialize=this._onDidInitialize.event,this.protocolListener=this.protocol.onMessage(i=>this.onBuffer(i)),this.logger=t}getChannel(e){const t=this;return{call(i,n,o){return t.isDisposed?Promise.reject(new fo):t.requestPromise(e,i,n,o)},listen(i,n){return t.isDisposed?T.None:t.requestEvent(e,i,n)}}}requestPromise(e,t,i,n=Ce.None){const o=this.lastRequestId++,r=_a.Promise,a={id:o,type:r,channelName:e,name:t,arg:i};if(n.isCancellationRequested)return Promise.reject(new fo);let c,d;return new Promise((u,g)=>{if(n.isCancellationRequested)return g(new fo);const m=()=>{const w=C=>{switch(C.type){case lr.PromiseSuccess:this.handlers.delete(o),u(C.data);break;case lr.PromiseError:{this.handlers.delete(o);const k=new Error(C.data.message);k.stack=Array.isArray(C.data.stack)?C.data.stack.join(`
`):C.data.stack,k.name=C.data.name,g(k);break}case lr.PromiseErrorObj:this.handlers.delete(o),g(C.data);break}};this.handlers.set(o,w),this.sendRequest(a)};let v=null;this.state===tm.Idle?m():(v=Tn(w=>this.whenInitialized()),v.then(()=>{v=null,m()}));const _=()=>{v?(v.cancel(),v=null):this.sendRequest({id:o,type:_a.PromiseCancel}),g(new fo)};c=n.onCancellationRequested(_),d={dispose:_w(()=>{_(),c.dispose()})},this.activeRequests.add(d)}).finally(()=>{c?.dispose(),this.activeRequests.delete(d)})}requestEvent(e,t,i){const n=this.lastRequestId++,o=_a.EventListen,r={id:n,type:o,channelName:e,name:t,arg:i};let a=null;const c=new M({onWillAddFirstListener:()=>{const l=()=>{this.activeRequests.add(c),this.sendRequest(r)};this.state===tm.Idle?l():(a=Tn(u=>this.whenInitialized()),a.then(()=>{a=null,l()}))},onDidRemoveLastListener:()=>{a?(a.cancel(),a=null):(this.activeRequests.delete(c),this.sendRequest({id:n,type:_a.EventDispose}))}}),d=l=>c.fire(l.data);return this.handlers.set(n,d),c.event}sendRequest(e){switch(e.type){case _a.Promise:case _a.EventListen:{const t=this.send([e.type,e.id,e.channelName,e.name],e.arg);this.logger?.logOutgoing(t,e.id,ub.LocalSide,`${FQ(e.type)}: ${e.channelName}.${e.name}`,e.arg);return}case _a.PromiseCancel:case _a.EventDispose:{const t=this.send([e.type,e.id]);this.logger?.logOutgoing(t,e.id,ub.LocalSide,FQ(e.type));return}}}send(e,t=void 0){const i=new UTe;return CV(i,e),CV(i,t),this.sendBuffer(i.buffer)}sendBuffer(e){try{return this.protocol.send(e),e.byteLength}catch{return 0}}onBuffer(e){const t=new HTe(e),i=EV(t),n=EV(t),o=i[0];switch(o){case lr.Initialize:return this.logger?.logIncoming(e.byteLength,0,ub.LocalSide,WQ(o)),this.onResponse({type:i[0]});case lr.PromiseSuccess:case lr.PromiseError:case lr.EventFire:case lr.PromiseErrorObj:return this.logger?.logIncoming(e.byteLength,i[1],ub.LocalSide,WQ(o),n),this.onResponse({type:i[0],id:i[1],data:n})}}onResponse(e){if(e.type===lr.Initialize){this.state=tm.Idle,this._onDidInitialize.fire();return}this.handlers.get(e.id)?.(e)}get onDidInitializePromise(){return T.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===tm.Idle?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),Xe(this.activeRequests.values()),this.activeRequests.clear()}}BQ.__decorator=f([Gt],BQ.prototype,"onDidInitializePromise",null);var VQ;(function(s){function e(o,r,a){const c=o,d=a&&a.disableMarshalling,l=new Map;for(const u in c)i(u)&&l.set(u,T.buffer(c[u],!0,void 0,r));return new class{listen(u,g,m){const v=l.get(g);if(v)return v;const _=c[g];if(typeof _=="function"){if(n(g))return _.call(c,m);if(i(g))return l.set(g,T.buffer(c[g],!0,void 0,r)),l.get(g)}throw new fr(`Event not found: ${g}`)}call(u,g,m){const v=c[g];if(typeof v=="function"){if(!d&&Array.isArray(m))for(let w=0;w<m.length;w++)m[w]=gn(m[w]);let _=v.apply(c,m);return _ instanceof Promise||(_=Promise.resolve(_)),_}throw new fr(`Method not found: ${g}`)}}}s.fromService=e;function t(o,r){const a=r&&r.disableMarshalling;return new Proxy({},{get(c,d){if(typeof d=="string")return r?.properties?.has(d)?r.properties.get(d):n(d)?function(l){return o.listen(d,l)}:i(d)?o.listen(d):async function(...l){let u;r&&!up(r.context)?u=[r.context,...l]:u=l;const g=await o.call(d,u);return a?g:gn(g)};throw new fr(`Property not found: ${String(d)}`)}})}s.toService=t;function i(o){return o[0]==="o"&&o[1]==="n"&&UT(o.charCodeAt(2))}function n(o){return/^onDynamic/.test(o)&&UT(o.charCodeAt(9))}})(VQ||(VQ={}));var Nm;(function(s){s.Created="created",s.Read="read",s.Write="write",s.Open="open",s.Error="error",s.Close="close",s.BrowserWebSocketBlobReceived="browserWebSocketBlobReceived",s.NodeEndReceived="nodeEndReceived",s.NodeEndSent="nodeEndSent",s.NodeDrainBegin="nodeDrainBegin",s.NodeDrainEnd="nodeDrainEnd",s.zlibInflateError="zlibInflateError",s.zlibInflateData="zlibInflateData",s.zlibInflateInitialWrite="zlibInflateInitialWrite",s.zlibInflateInitialFlushFired="zlibInflateInitialFlushFired",s.zlibInflateWrite="zlibInflateWrite",s.zlibInflateFlushFired="zlibInflateFlushFired",s.zlibDeflateError="zlibDeflateError",s.zlibDeflateData="zlibDeflateData",s.zlibDeflateWrite="zlibDeflateWrite",s.zlibDeflateFlushFired="zlibDeflateFlushFired",s.WebSocketNodeSocketWrite="webSocketNodeSocketWrite",s.WebSocketNodeSocketPeekedHeader="webSocketNodeSocketPeekedHeader",s.WebSocketNodeSocketReadHeader="webSocketNodeSocketReadHeader",s.WebSocketNodeSocketReadData="webSocketNodeSocketReadData",s.WebSocketNodeSocketUnmaskedData="webSocketNodeSocketUnmaskedData",s.WebSocketNodeSocketDrainBegin="webSocketNodeSocketDrainBegin",s.WebSocketNodeSocketDrainEnd="webSocketNodeSocketDrainEnd",s.ProtocolHeaderRead="protocolHeaderRead",s.ProtocolMessageRead="protocolMessageRead",s.ProtocolHeaderWrite="protocolHeaderWrite",s.ProtocolMessageWrite="protocolMessageWrite",s.ProtocolWrite="protocolWrite"})(Nm||(Nm={}));var xV;(function(s){s.enableDiagnostics=!1,s.records=[];const e=new WeakMap;let t=0;function i(o,r){if(!e.has(o)){const a=String(++t);e.set(o,a)}return e.get(o)}function n(o,r,a,c){if(!s.enableDiagnostics)return;const d=i(o);if(c instanceof Le||c instanceof Uint8Array||c instanceof ArrayBuffer||ArrayBuffer.isView(c)){const l=Le.alloc(c.byteLength);l.set(c),s.records.push({timestamp:Date.now(),id:d,label:r,type:a,buff:l})}else s.records.push({timestamp:Date.now(),id:d,label:r,type:a,data:c})}s.traceSocketEvent=n})(xV||(xV={}));var RR;(function(s){s[s.NodeSocketCloseEvent=0]="NodeSocketCloseEvent",s[s.WebSocketCloseEvent=1]="WebSocketCloseEvent"})(RR||(RR={}));let w1=null;function Fg(){return w1||(w1=Le.alloc(0)),w1}class GTe{get byteLength(){return this._totalLength}constructor(){this._chunks=[],this._totalLength=0}acceptChunk(e){this._chunks.push(e),this._totalLength+=e.byteLength}read(e){return this._read(e,!0)}peek(e){return this._read(e,!1)}_read(e,t){if(e===0)return Fg();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){const r=this._chunks[0];return t&&(this._chunks.shift(),this._totalLength-=e),r}if(this._chunks[0].byteLength>e){const r=this._chunks[0].slice(0,e);return t&&(this._chunks[0]=this._chunks[0].slice(e),this._totalLength-=e),r}const i=Le.alloc(e);let n=0,o=0;for(;e>0;){const r=this._chunks[o];if(r.byteLength>e){const a=r.slice(0,e);i.set(a,n),n+=e,t&&(this._chunks[o]=r.slice(e),this._totalLength-=e),e-=e}else i.set(r,n),n+=r.byteLength,t?(this._chunks.shift(),this._totalLength-=r.byteLength):o++,e-=r.byteLength}return i}}var un;(function(s){s[s.None=0]="None",s[s.Regular=1]="Regular",s[s.Control=2]="Control",s[s.Ack=3]="Ack",s[s.Disconnect=5]="Disconnect",s[s.ReplayRequest=6]="ReplayRequest",s[s.Pause=7]="Pause",s[s.Resume=8]="Resume",s[s.KeepAlive=9]="KeepAlive"})(un||(un={}));function Bce(s){switch(s){case un.None:return"None";case un.Regular:return"Regular";case un.Control:return"Control";case un.Ack:return"Ack";case un.Disconnect:return"Disconnect";case un.ReplayRequest:return"ReplayRequest";case un.Pause:return"PauseWriting";case un.Resume:return"ResumeWriting";case un.KeepAlive:return"KeepAlive"}}var va;(function(s){s[s.HeaderLength=13]="HeaderLength",s[s.AcknowledgeTime=2e3]="AcknowledgeTime",s[s.TimeoutTime=2e4]="TimeoutTime",s[s.ReconnectionGraceTime=108e5]="ReconnectionGraceTime",s[s.ReconnectionShortGraceTime=3e5]="ReconnectionShortGraceTime",s[s.KeepAliveSendTime=5e3]="KeepAliveSendTime"})(va||(va={}));class Ol{constructor(e,t,i,n){this.type=e,this.id=t,this.ack=i,this.data=n,this.writtenTime=0}get size(){return this.data.byteLength}}class HQ extends F{constructor(e){super(),this._onMessage=this._register(new M),this.onMessage=this._onMessage.event,this._state={readHead:!0,readLen:va.HeaderLength,messageType:un.None,id:0,ack:0},this._socket=e,this._isDisposed=!1,this._incomingData=new GTe,this._register(this._socket.onData(t=>this.acceptChunk(t))),this.lastReadTime=Date.now()}acceptChunk(e){if(!(!e||e.byteLength===0))for(this.lastReadTime=Date.now(),this._incomingData.acceptChunk(e);this._incomingData.byteLength>=this._state.readLen;){const t=this._incomingData.read(this._state.readLen);if(this._state.readHead)this._state.readHead=!1,this._state.readLen=t.readUInt32BE(9),this._state.messageType=t.readUInt8(0),this._state.id=t.readUInt32BE(1),this._state.ack=t.readUInt32BE(5),this._socket.traceSocketEvent(Nm.ProtocolHeaderRead,{messageType:Bce(this._state.messageType),id:this._state.id,ack:this._state.ack,messageSize:this._state.readLen});else{const i=this._state.messageType,n=this._state.id,o=this._state.ack;if(this._state.readHead=!0,this._state.readLen=va.HeaderLength,this._state.messageType=un.None,this._state.id=0,this._state.ack=0,this._socket.traceSocketEvent(Nm.ProtocolMessageRead,t),this._onMessage.fire(new Ol(i,n,o,t)),this._isDisposed)break}}}readEntireBuffer(){return this._incomingData.read(this._incomingData.byteLength)}dispose(){this._isDisposed=!0,super.dispose()}}class UQ{constructor(e){this._writeNowTimeout=null,this._isDisposed=!1,this._isPaused=!1,this._socket=e,this._data=[],this._totalLength=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this._isDisposed=!0}drain(){return this.flush(),this._socket.drain()}flush(){this._writeNow()}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this._scheduleWriting()}write(e){if(this._isDisposed)return;e.writtenTime=Date.now(),this.lastWriteTime=Date.now();const t=Le.alloc(va.HeaderLength);t.writeUInt8(e.type,0),t.writeUInt32BE(e.id,1),t.writeUInt32BE(e.ack,5),t.writeUInt32BE(e.data.byteLength,9),this._socket.traceSocketEvent(Nm.ProtocolHeaderWrite,{messageType:Bce(e.type),id:e.id,ack:e.ack,messageSize:e.data.byteLength}),this._socket.traceSocketEvent(Nm.ProtocolMessageWrite,e.data),this._writeSoon(t,e.data)}_bufferAdd(e,t){const i=this._totalLength===0;return this._data.push(e,t),this._totalLength+=e.byteLength+t.byteLength,i}_bufferTake(){const e=Le.concat(this._data,this._totalLength);return this._data.length=0,this._totalLength=0,e}_writeSoon(e,t){this._bufferAdd(e,t)&&this._scheduleWriting()}_scheduleWriting(){this._writeNowTimeout||(this._writeNowTimeout=setTimeout(()=>{this._writeNowTimeout=null,this._writeNow()}))}_writeNow(){if(this._totalLength===0||this._isPaused)return;const e=this._bufferTake();this._socket.traceSocketEvent(Nm.ProtocolWrite,{byteLength:e.byteLength}),this._socket.write(e)}}class TS{constructor(){this._hasListeners=!1,this._isDeliveringMessages=!1,this._bufferedMessages=[],this._emitter=new M({onWillAddFirstListener:()=>{this._hasListeners=!0,queueMicrotask(()=>this._deliverMessages())},onDidRemoveLastListener:()=>{this._hasListeners=!1}}),this.event=this._emitter.event}_deliverMessages(){if(!this._isDeliveringMessages){for(this._isDeliveringMessages=!0;this._hasListeners&&this._bufferedMessages.length>0;)this._emitter.fire(this._bufferedMessages.shift());this._isDeliveringMessages=!1}}fire(e){this._hasListeners?this._bufferedMessages.length>0?this._bufferedMessages.push(e):this._emitter.fire(e):this._bufferedMessages.push(e)}flushBuffer(){this._bufferedMessages=[]}}class zTe{constructor(e){this.data=e,this.next=null}}class qTe{constructor(){this._first=null,this._last=null}length(){let e=0,t=this._first;for(;t;)t=t.next,e++;return e}peek(){return this._first?this._first.data:null}toArray(){const e=[];let t=0,i=this._first;for(;i;)e[t++]=i.data,i=i.next;return e}pop(){if(this._first){if(this._first===this._last){this._first=null,this._last=null;return}this._first=this._first.next}}push(e){const t=new zTe(e);if(!this._first){this._first=t,this._last=t;return}this._last.next=t,this._last=t}}class Od{static{this._HISTORY_LENGTH=10}static{this._INSTANCE=null}static getInstance(){return Od._INSTANCE||(Od._INSTANCE=new Od),Od._INSTANCE}constructor(){this.lastRuns=[];const e=Date.now();for(let t=0;t<Od._HISTORY_LENGTH;t++)this.lastRuns[t]=e-1e3*t;setInterval(()=>{for(let t=Od._HISTORY_LENGTH;t>=1;t--)this.lastRuns[t]=this.lastRuns[t-1];this.lastRuns[0]=Date.now()},1e3)}load(){const e=Date.now(),t=(1+Od._HISTORY_LENGTH)*1e3;let i=0;for(let n=0;n<Od._HISTORY_LENGTH;n++)e-this.lastRuns[n]<=t&&i++;return 1-i/Od._HISTORY_LENGTH}hasHighLoad(){return this.load()>=.5}}class KTe{get unacknowledgedCount(){return this._outgoingMsgId-this._outgoingAckId}constructor(e){this._onControlMessage=new TS,this.onControlMessage=this._onControlMessage.event,this._onMessage=new TS,this.onMessage=this._onMessage.event,this._onDidDispose=new TS,this.onDidDispose=this._onDidDispose.event,this._onSocketClose=new TS,this.onSocketClose=this._onSocketClose.event,this._onSocketTimeout=new TS,this.onSocketTimeout=this._onSocketTimeout.event,this._loadEstimator=e.loadEstimator??Od.getInstance(),this._shouldSendKeepAlive=e.sendKeepAlive??!0,this._isReconnecting=!1,this._outgoingUnackMsg=new qTe,this._outgoingMsgId=0,this._outgoingAckId=0,this._outgoingAckTimeout=null,this._incomingMsgId=0,this._incomingAckId=0,this._incomingMsgLastTime=0,this._incomingAckTimeout=null,this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socketDisposables=new U,this._socket=e.socket,this._socketWriter=this._socketDisposables.add(new UQ(this._socket)),this._socketReader=this._socketDisposables.add(new HQ(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(t=>this._receiveMessage(t))),this._socketDisposables.add(this._socket.onClose(t=>this._onSocketClose.fire(t))),e.initialChunk&&this._socketReader.acceptChunk(e.initialChunk),this._shouldSendKeepAlive?this._keepAliveInterval=setInterval(()=>{this._sendKeepAlive()},va.KeepAliveSendTime):this._keepAliveInterval=null}dispose(){this._outgoingAckTimeout&&(clearTimeout(this._outgoingAckTimeout),this._outgoingAckTimeout=null),this._incomingAckTimeout&&(clearTimeout(this._incomingAckTimeout),this._incomingAckTimeout=null),this._keepAliveInterval&&(clearInterval(this._keepAliveInterval),this._keepAliveInterval=null),this._socketDisposables.dispose()}drain(){return this._socketWriter.drain()}sendDisconnect(){if(!this._didSendDisconnect){this._didSendDisconnect=!0;const e=new Ol(un.Disconnect,0,0,Fg());this._socketWriter.write(e),this._socketWriter.flush()}}sendPause(){const e=new Ol(un.Pause,0,0,Fg());this._socketWriter.write(e)}sendResume(){const e=new Ol(un.Resume,0,0,Fg());this._socketWriter.write(e)}pauseSocketWriting(){this._socketWriter.pause()}getSocket(){return this._socket}getMillisSinceLastIncomingData(){return Date.now()-this._socketReader.lastReadTime}beginAcceptReconnection(e,t){this._isReconnecting=!0,this._socketDisposables.dispose(),this._socketDisposables=new U,this._onControlMessage.flushBuffer(),this._onSocketClose.flushBuffer(),this._onSocketTimeout.flushBuffer(),this._socket.dispose(),this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socket=e,this._socketWriter=this._socketDisposables.add(new UQ(this._socket)),this._socketReader=this._socketDisposables.add(new HQ(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(i=>this._receiveMessage(i))),this._socketDisposables.add(this._socket.onClose(i=>this._onSocketClose.fire(i))),this._socketReader.acceptChunk(t)}endAcceptReconnection(){this._isReconnecting=!1,this._incomingAckId=this._incomingMsgId;const e=new Ol(un.Ack,0,this._incomingAckId,Fg());this._socketWriter.write(e);const t=this._outgoingUnackMsg.toArray();for(let i=0,n=t.length;i<n;i++)this._socketWriter.write(t[i]);this._recvAckCheck()}acceptDisconnect(){this._onDidDispose.fire()}_receiveMessage(e){if(e.ack>this._outgoingAckId){this._outgoingAckId=e.ack;do{const t=this._outgoingUnackMsg.peek();if(t&&t.id<=e.ack)this._outgoingUnackMsg.pop();else break}while(!0)}switch(e.type){case un.None:break;case un.Regular:{if(e.id>this._incomingMsgId)if(e.id!==this._incomingMsgId+1){const t=Date.now();t-this._lastReplayRequestTime>1e4&&(this._lastReplayRequestTime=t,this._socketWriter.write(new Ol(un.ReplayRequest,0,0,Fg())))}else this._incomingMsgId=e.id,this._incomingMsgLastTime=Date.now(),this._sendAckCheck(),this._onMessage.fire(e.data);break}case un.Control:{this._onControlMessage.fire(e.data);break}case un.Ack:break;case un.Disconnect:{this._onDidDispose.fire();break}case un.ReplayRequest:{const t=this._outgoingUnackMsg.toArray();for(let i=0,n=t.length;i<n;i++)this._socketWriter.write(t[i]);this._recvAckCheck();break}case un.Pause:{this._socketWriter.pause();break}case un.Resume:{this._socketWriter.resume();break}}}readEntireBuffer(){return this._socketReader.readEntireBuffer()}flush(){this._socketWriter.flush()}send(e){const t=++this._outgoingMsgId;this._incomingAckId=this._incomingMsgId;const i=new Ol(un.Regular,t,this._incomingAckId,e);this._outgoingUnackMsg.push(i),this._isReconnecting||(this._socketWriter.write(i),this._recvAckCheck())}sendControl(e){const t=new Ol(un.Control,0,0,e);this._socketWriter.write(t)}_sendAckCheck(){if(this._incomingMsgId<=this._incomingAckId||this._incomingAckTimeout)return;const e=Date.now()-this._incomingMsgLastTime;if(e>=va.AcknowledgeTime){this._sendAck();return}this._incomingAckTimeout=setTimeout(()=>{this._incomingAckTimeout=null,this._sendAckCheck()},va.AcknowledgeTime-e+5)}_recvAckCheck(){if(this._outgoingMsgId<=this._outgoingAckId||this._outgoingAckTimeout||this._isReconnecting)return;const e=this._outgoingUnackMsg.peek(),t=Date.now()-e.writtenTime,i=Date.now()-this._socketReader.lastReadTime,n=Date.now()-this._lastSocketTimeoutTime;if(t>=va.TimeoutTime&&i>=va.TimeoutTime&&n>=va.TimeoutTime&&!this._loadEstimator.hasHighLoad()){this._lastSocketTimeoutTime=Date.now(),this._onSocketTimeout.fire({unacknowledgedMsgCount:this._outgoingUnackMsg.length(),timeSinceOldestUnacknowledgedMsg:t,timeSinceLastReceivedSomeData:i});return}const o=Math.max(va.TimeoutTime-t,va.TimeoutTime-i,va.TimeoutTime-n,500);this._outgoingAckTimeout=setTimeout(()=>{this._outgoingAckTimeout=null,this._recvAckCheck()},o)}_sendAck(){if(this._incomingMsgId<=this._incomingAckId)return;this._incomingAckId=this._incomingMsgId;const e=new Ol(un.Ack,0,this._incomingAckId,Fg());this._socketWriter.write(e)}_sendKeepAlive(){this._incomingAckId=this._incomingMsgId;const e=new Ol(un.KeepAlive,0,this._incomingAckId,Fg());this._socketWriter.write(e)}}var Ft;(function(s){s[s.LocalProcess=1]="LocalProcess",s[s.LocalWebWorker=2]="LocalWebWorker",s[s.Remote=3]="Remote"})(Ft||(Ft={}));function th(s){if(s===null)return"None";switch(s){case Ft.LocalProcess:return"LocalProcess";case Ft.LocalWebWorker:return"LocalWebWorker";case Ft.Remote:return"Remote"}}var ea;(function(s){s[s.None=0]="None",s[s.Local=1]="Local",s[s.Remote=2]="Remote"})(ea||(ea={}));function jTe(s){switch(s){case ea.None:return"None";case ea.Local:return"Local";case ea.Remote:return"Remote"}}function YTe(s,e,t,i){const n=$Q(s,t),o=$Q(e,t),r=new Map,a=d=>{if(r.has(d.key))return;const l=n.get(d.key)||null,u=o.get(d.key)||null,g=new XTe(l,u);r.set(g.key,g)};n.forEach(d=>a(d)),o.forEach(d=>a(d));const c=new Map;return r.forEach(d=>{const l=!!d.local,u=!!d.remote,g=!!(d.local&&d.local.isUnderDevelopment),m=!!(d.remote&&d.remote.isUnderDevelopment);let v=ea.None;g&&!m?v=ea.Local:m&&!g&&(v=ea.Remote),c.set(d.key,i(d.identifier,d.kind,l,u,v))}),c}function $Q(s,e){const t=new Map;return s.forEach(i=>{const n=new QTe(i,e(i));t.set(n.key,n)}),t}class QTe{constructor(e,t){this.desc=e,this.kind=t}get key(){return vs.toKey(this.desc.identifier)}get isUnderDevelopment(){return this.desc.isUnderDevelopment}}class XTe{constructor(e,t){this.local=e,this.remote=t}get key(){return this.local?this.local.key:this.remote.key}get identifier(){return this.local?this.local.desc.identifier:this.remote.desc.identifier}get kind(){return this.local?this.local.kind:this.remote.kind}}var gx;(function(s){s[s.Full=1]="Full",s[s.Delta=2]="Delta"})(gx||(gx={}));function Vce(s){for(let e=0,t=s.length;e<t;e+=4){const i=s[e+0],n=s[e+1],o=s[e+2],r=s[e+3];s[e+0]=r,s[e+1]=o,s[e+2]=n,s[e+3]=i}}function ZTe(s){const e=new Uint8Array(s.buffer,s.byteOffset,s.length*4);return sne()||Vce(e),Le.wrap(e)}function JTe(s){const e=s.buffer;if(sne()||Vce(e),e.byteOffset%4===0)return new Uint32Array(e.buffer,e.byteOffset,e.length/4);{const t=new Uint8Array(e.byteLength);return t.set(e),new Uint32Array(t.buffer,t.byteOffset,t.length/4)}}function Hce(s){const e=new Uint32Array(eAe(s));let t=0;if(e[t++]=s.id,s.type==="full")e[t++]=gx.Full,e[t++]=s.data.length,e.set(s.data,t),t+=s.data.length;else{e[t++]=gx.Delta,e[t++]=s.deltas.length;for(const i of s.deltas)e[t++]=i.start,e[t++]=i.deleteCount,i.data?(e[t++]=i.data.length,e.set(i.data,t),t+=i.data.length):e[t++]=0}return ZTe(e)}function eAe(s){let e=0;if(e+=2,s.type==="full")e+=1+s.data.length;else{e+=1,e+=3*s.deltas.length;for(const t of s.deltas)t.data&&(e+=t.data.length)}return e}function Uce(s){const e=JTe(s);let t=0;const i=e[t++];if(e[t++]===gx.Full){const a=e[t++],c=e.subarray(t,t+a);return t+=a,{id:i,type:"full",data:c}}const o=e[t++],r=[];for(let a=0;a<o;a++){const c=e[t++],d=e[t++],l=e[t++];let u;l>0&&(u=e.subarray(t,t+l),t+=l),r[a]={start:c,deleteCount:d,data:u}}return{id:i,type:"delta",deltas:r}}function tAe(s){return!!s&&typeof s.sessionId=="string"&&s.$mid===Dn.ChatViewContext}var XD={exports:{}},S1={},GQ;function iAe(){return GQ||(GQ=1,function(s,e){e=s.exports=Ji;var t;typeof process=="object"&&S1&&S1.NODE_DEBUG&&/\bsemver\b/i.test(S1.NODE_DEBUG)?t=function(){var $=Array.prototype.slice.call(arguments,0);$.unshift("SEMVER"),console.log.apply(console,$)}:t=function(){},e.SEMVER_SPEC_VERSION="2.0.0";var i=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,o=16,r=e.re=[],a=e.src=[],c=0,d=c++;a[d]="0|[1-9]\\d*";var l=c++;a[l]="[0-9]+";var u=c++;a[u]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var g=c++;a[g]="("+a[d]+")\\.("+a[d]+")\\.("+a[d]+")";var m=c++;a[m]="("+a[l]+")\\.("+a[l]+")\\.("+a[l]+")";var v=c++;a[v]="(?:"+a[d]+"|"+a[u]+")";var _=c++;a[_]="(?:"+a[l]+"|"+a[u]+")";var w=c++;a[w]="(?:-("+a[v]+"(?:\\."+a[v]+")*))";var C=c++;a[C]="(?:-?("+a[_]+"(?:\\."+a[_]+")*))";var k=c++;a[k]="[0-9A-Za-z-]+";var D=c++;a[D]="(?:\\+("+a[k]+"(?:\\."+a[k]+")*))";var A=c++,B="v?"+a[g]+a[w]+"?"+a[D]+"?";a[A]="^"+B+"$";var q="[v=\\s]*"+a[m]+a[C]+"?"+a[D]+"?",Q=c++;a[Q]="^"+q+"$";var ie=c++;a[ie]="((?:<|>)?=?)";var oe=c++;a[oe]=a[l]+"|x|X|\\*";var be=c++;a[be]=a[d]+"|x|X|\\*";var me=c++;a[me]="[v=\\s]*("+a[be]+")(?:\\.("+a[be]+")(?:\\.("+a[be]+")(?:"+a[w]+")?"+a[D]+"?)?)?";var zt=c++;a[zt]="[v=\\s]*("+a[oe]+")(?:\\.("+a[oe]+")(?:\\.("+a[oe]+")(?:"+a[C]+")?"+a[D]+"?)?)?";var ft=c++;a[ft]="^"+a[ie]+"\\s*"+a[me]+"$";var Qt=c++;a[Qt]="^"+a[ie]+"\\s*"+a[zt]+"$";var Ae=c++;a[Ae]="(?:^|[^\\d])(\\d{1,"+o+"})(?:\\.(\\d{1,"+o+"}))?(?:\\.(\\d{1,"+o+"}))?(?:$|[^\\d])";var di=c++;a[di]="(?:~>?)";var jn=c++;a[jn]="(\\s*)"+a[di]+"\\s+",r[jn]=new RegExp(a[jn],"g");var _i="$1~",vn=c++;a[vn]="^"+a[di]+a[me]+"$";var Cs=c++;a[Cs]="^"+a[di]+a[zt]+"$";var on=c++;a[on]="(?:\\^)";var Ks=c++;a[Ks]="(\\s*)"+a[on]+"\\s+",r[Ks]=new RegExp(a[Ks],"g");var Tg="$1^",Mf=c++;a[Mf]="^"+a[on]+a[me]+"$";var Nf=c++;a[Nf]="^"+a[on]+a[zt]+"$";var Yh=c++;a[Yh]="^"+a[ie]+"\\s*("+q+")$|^$";var z0=c++;a[z0]="^"+a[ie]+"\\s*("+B+")$|^$";var yS=c++;a[yS]="(\\s*)"+a[ie]+"\\s*("+q+"|"+a[me]+")",r[yS]=new RegExp(a[yS],"g");var ufe="$1$2$3",I6=c++;a[I6]="^\\s*("+a[me]+")\\s+-\\s+("+a[me]+")\\s*$";var D6=c++;a[D6]="^\\s*("+a[zt]+")\\s+-\\s+("+a[zt]+")\\s*$";var k6=c++;a[k6]="(<|>)?=?\\s*\\*";for(var Of=0;Of<c;Of++)t(Of,a[Of]),r[Of]||(r[Of]=new RegExp(a[Of]));e.parse=Ff;function Ff($,se){if($ instanceof Ji)return $;if(typeof $!="string"||$.length>i)return null;var ce=se?r[Q]:r[A];if(!ce.test($))return null;try{return new Ji($,se)}catch{return null}}e.valid=gfe;function gfe($,se){var ce=Ff($,se);return ce?ce.version:null}e.clean=pfe;function pfe($,se){var ce=Ff($.trim().replace(/^[=v]+/,""),se);return ce?ce.version:null}e.SemVer=Ji;function Ji($,se){if($ instanceof Ji){if($.loose===se)return $;$=$.version}else if(typeof $!="string")throw new TypeError("Invalid Version: "+$);if($.length>i)throw new TypeError("version is longer than "+i+" characters");if(!(this instanceof Ji))return new Ji($,se);t("SemVer",$,se),this.loose=se;var ce=$.trim().match(se?r[Q]:r[A]);if(!ce)throw new TypeError("Invalid Version: "+$);if(this.raw=$,this.major=+ce[1],this.minor=+ce[2],this.patch=+ce[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");ce[4]?this.prerelease=ce[4].split(".").map(function(Ue){if(/^[0-9]+$/.test(Ue)){var Te=+Ue;if(Te>=0&&Te<n)return Te}return Ue}):this.prerelease=[],this.build=ce[5]?ce[5].split("."):[],this.format()}Ji.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Ji.prototype.toString=function(){return this.version},Ji.prototype.compare=function($){return t("SemVer.compare",this.version,this.loose,$),$ instanceof Ji||($=new Ji($,this.loose)),this.compareMain($)||this.comparePre($)},Ji.prototype.compareMain=function($){return $ instanceof Ji||($=new Ji($,this.loose)),__(this.major,$.major)||__(this.minor,$.minor)||__(this.patch,$.patch)},Ji.prototype.comparePre=function($){if($ instanceof Ji||($=new Ji($,this.loose)),this.prerelease.length&&!$.prerelease.length)return-1;if(!this.prerelease.length&&$.prerelease.length)return 1;if(!this.prerelease.length&&!$.prerelease.length)return 0;var se=0;do{var ce=this.prerelease[se],Ue=$.prerelease[se];if(t("prerelease compare",se,ce,Ue),ce===void 0&&Ue===void 0)return 0;if(Ue===void 0)return 1;if(ce===void 0)return-1;if(ce===Ue)continue;return __(ce,Ue)}while(++se)},Ji.prototype.inc=function($,se){switch($){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",se);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",se);break;case"prepatch":this.prerelease.length=0,this.inc("patch",se),this.inc("pre",se);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",se),this.inc("pre",se);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var ce=this.prerelease.length;--ce>=0;)typeof this.prerelease[ce]=="number"&&(this.prerelease[ce]++,ce=-2);ce===-1&&this.prerelease.push(0)}se&&(this.prerelease[0]===se?isNaN(this.prerelease[1])&&(this.prerelease=[se,0]):this.prerelease=[se,0]);break;default:throw new Error("invalid increment argument: "+$)}return this.format(),this.raw=this.version,this},e.inc=ffe;function ffe($,se,ce,Ue){typeof ce=="string"&&(Ue=ce,ce=void 0);try{return new Ji($,ce).inc(se,Ue).version}catch{return null}}e.diff=mfe;function mfe($,se){if(q0($,se))return null;var ce=Ff($),Ue=Ff(se);if(ce.prerelease.length||Ue.prerelease.length){for(var Te in ce)if((Te==="major"||Te==="minor"||Te==="patch")&&ce[Te]!==Ue[Te])return"pre"+Te;return"prerelease"}for(var Te in ce)if((Te==="major"||Te==="minor"||Te==="patch")&&ce[Te]!==Ue[Te])return Te}e.compareIdentifiers=__;var T6=/^[0-9]+$/;function __($,se){var ce=T6.test($),Ue=T6.test(se);return ce&&Ue&&($=+$,se=+se),ce&&!Ue?-1:Ue&&!ce?1:$<se?-1:$>se?1:0}e.rcompareIdentifiers=vfe;function vfe($,se){return __(se,$)}e.major=_fe;function _fe($,se){return new Ji($,se).major}e.minor=bfe;function bfe($,se){return new Ji($,se).minor}e.patch=yfe;function yfe($,se){return new Ji($,se).patch}e.compare=Qh;function Qh($,se,ce){return new Ji($,ce).compare(new Ji(se,ce))}e.compareLoose=wfe;function wfe($,se){return Qh($,se,!0)}e.rcompare=Sfe;function Sfe($,se,ce){return Qh(se,$,ce)}e.sort=Cfe;function Cfe($,se){return $.sort(function(ce,Ue){return e.compare(ce,Ue,se)})}e.rsort=Efe;function Efe($,se){return $.sort(function(ce,Ue){return e.rcompare(ce,Ue,se)})}e.gt=AD;function AD($,se,ce){return Qh($,se,ce)>0}e.lt=RD;function RD($,se,ce){return Qh($,se,ce)<0}e.eq=q0;function q0($,se,ce){return Qh($,se,ce)===0}e.neq=A6;function A6($,se,ce){return Qh($,se,ce)!==0}e.gte=K0;function K0($,se,ce){return Qh($,se,ce)>=0}e.lte=j0;function j0($,se,ce){return Qh($,se,ce)<=0}e.cmp=PD;function PD($,se,ce,Ue){var Te;switch(se){case"===":typeof $=="object"&&($=$.version),typeof ce=="object"&&(ce=ce.version),Te=$===ce;break;case"!==":typeof $=="object"&&($=$.version),typeof ce=="object"&&(ce=ce.version),Te=$!==ce;break;case"":case"=":case"==":Te=q0($,ce,Ue);break;case"!=":Te=A6($,ce,Ue);break;case">":Te=AD($,ce,Ue);break;case">=":Te=K0($,ce,Ue);break;case"<":Te=RD($,ce,Ue);break;case"<=":Te=j0($,ce,Ue);break;default:throw new TypeError("Invalid operator: "+se)}return Te}e.Comparator=Cc;function Cc($,se){if($ instanceof Cc){if($.loose===se)return $;$=$.value}if(!(this instanceof Cc))return new Cc($,se);t("comparator",$,se),this.loose=se,this.parse($),this.semver===wS?this.value="":this.value=this.operator+this.semver.version,t("comp",this)}var wS={};Cc.prototype.parse=function($){var se=this.loose?r[Yh]:r[z0],ce=$.match(se);if(!ce)throw new TypeError("Invalid comparator: "+$);this.operator=ce[1],this.operator==="="&&(this.operator=""),ce[2]?this.semver=new Ji(ce[2],this.loose):this.semver=wS},Cc.prototype.toString=function(){return this.value},Cc.prototype.test=function($){return t("Comparator.test",$,this.loose),this.semver===wS?!0:(typeof $=="string"&&($=new Ji($,this.loose)),PD($,this.operator,this.semver,this.loose))},Cc.prototype.intersects=function($,se){if(!($ instanceof Cc))throw new TypeError("a Comparator is required");var ce;if(this.operator==="")return ce=new Es($.value,se),LD(this.value,ce,se);if($.operator==="")return ce=new Es(this.value,se),LD($.semver,ce,se);var Ue=(this.operator===">="||this.operator===">")&&($.operator===">="||$.operator===">"),Te=(this.operator==="<="||this.operator==="<")&&($.operator==="<="||$.operator==="<"),wt=this.semver.version===$.semver.version,ni=(this.operator===">="||this.operator==="<=")&&($.operator===">="||$.operator==="<="),wi=PD(this.semver,"<",$.semver,se)&&(this.operator===">="||this.operator===">")&&($.operator==="<="||$.operator==="<"),Ui=PD(this.semver,">",$.semver,se)&&(this.operator==="<="||this.operator==="<")&&($.operator===">="||$.operator===">");return Ue||Te||wt&&ni||wi||Ui},e.Range=Es;function Es($,se){if($ instanceof Es)return $.loose===se?$:new Es($.raw,se);if($ instanceof Cc)return new Es($.value,se);if(!(this instanceof Es))return new Es($,se);if(this.loose=se,this.raw=$,this.set=$.split(/\s*\|\|\s*/).map(function(ce){return this.parseRange(ce.trim())},this).filter(function(ce){return ce.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+$);this.format()}Es.prototype.format=function(){return this.range=this.set.map(function($){return $.join(" ").trim()}).join("||").trim(),this.range},Es.prototype.toString=function(){return this.range},Es.prototype.parseRange=function($){var se=this.loose;$=$.trim(),t("range",$,se);var ce=se?r[D6]:r[I6];$=$.replace(ce,Mfe),t("hyphen replace",$),$=$.replace(r[yS],ufe),t("comparator trim",$,r[yS]),$=$.replace(r[jn],_i),$=$.replace(r[Ks],Tg),$=$.split(/\s+/).join(" ");var Ue=se?r[Yh]:r[z0],Te=$.split(" ").map(function(wt){return Ife(wt,se)}).join(" ").split(/\s+/);return this.loose&&(Te=Te.filter(function(wt){return!!wt.match(Ue)})),Te=Te.map(function(wt){return new Cc(wt,se)}),Te},Es.prototype.intersects=function($,se){if(!($ instanceof Es))throw new TypeError("a Range is required");return this.set.some(function(ce){return ce.every(function(Ue){return $.set.some(function(Te){return Te.every(function(wt){return Ue.intersects(wt,se)})})})})},e.toComparators=xfe;function xfe($,se){return new Es($,se).set.map(function(ce){return ce.map(function(Ue){return Ue.value}).join(" ").trim().split(" ")})}function Ife($,se){return t("comp",$),$=Tfe($,se),t("caret",$),$=Dfe($,se),t("tildes",$),$=Rfe($,se),t("xrange",$),$=Lfe($,se),t("stars",$),$}function Ur($){return!$||$.toLowerCase()==="x"||$==="*"}function Dfe($,se){return $.trim().split(/\s+/).map(function(ce){return kfe(ce,se)}).join(" ")}function kfe($,se){var ce=se?r[Cs]:r[vn];return $.replace(ce,function(Ue,Te,wt,ni,wi){t("tilde",$,Ue,Te,wt,ni,wi);var Ui;return Ur(Te)?Ui="":Ur(wt)?Ui=">="+Te+".0.0 <"+(+Te+1)+".0.0":Ur(ni)?Ui=">="+Te+"."+wt+".0 <"+Te+"."+(+wt+1)+".0":wi?(t("replaceTilde pr",wi),wi.charAt(0)!=="-"&&(wi="-"+wi),Ui=">="+Te+"."+wt+"."+ni+wi+" <"+Te+"."+(+wt+1)+".0"):Ui=">="+Te+"."+wt+"."+ni+" <"+Te+"."+(+wt+1)+".0",t("tilde return",Ui),Ui})}function Tfe($,se){return $.trim().split(/\s+/).map(function(ce){return Afe(ce,se)}).join(" ")}function Afe($,se){t("caret",$,se);var ce=se?r[Nf]:r[Mf];return $.replace(ce,function(Ue,Te,wt,ni,wi){t("caret",$,Ue,Te,wt,ni,wi);var Ui;return Ur(Te)?Ui="":Ur(wt)?Ui=">="+Te+".0.0 <"+(+Te+1)+".0.0":Ur(ni)?Te==="0"?Ui=">="+Te+"."+wt+".0 <"+Te+"."+(+wt+1)+".0":Ui=">="+Te+"."+wt+".0 <"+(+Te+1)+".0.0":wi?(t("replaceCaret pr",wi),wi.charAt(0)!=="-"&&(wi="-"+wi),Te==="0"?wt==="0"?Ui=">="+Te+"."+wt+"."+ni+wi+" <"+Te+"."+wt+"."+(+ni+1):Ui=">="+Te+"."+wt+"."+ni+wi+" <"+Te+"."+(+wt+1)+".0":Ui=">="+Te+"."+wt+"."+ni+wi+" <"+(+Te+1)+".0.0"):(t("no pr"),Te==="0"?wt==="0"?Ui=">="+Te+"."+wt+"."+ni+" <"+Te+"."+wt+"."+(+ni+1):Ui=">="+Te+"."+wt+"."+ni+" <"+Te+"."+(+wt+1)+".0":Ui=">="+Te+"."+wt+"."+ni+" <"+(+Te+1)+".0.0"),t("caret return",Ui),Ui})}function Rfe($,se){return t("replaceXRanges",$,se),$.split(/\s+/).map(function(ce){return Pfe(ce,se)}).join(" ")}function Pfe($,se){$=$.trim();var ce=se?r[Qt]:r[ft];return $.replace(ce,function(Ue,Te,wt,ni,wi,Ui){t("xRange",$,Ue,Te,wt,ni,wi,Ui);var Tl=Ur(wt),Al=Tl||Ur(ni),la=Al||Ur(wi),Fa=la;return Te==="="&&Fa&&(Te=""),Tl?Te===">"||Te==="<"?Ue="<0.0.0":Ue="*":Te&&Fa?(Al&&(ni=0),la&&(wi=0),Te===">"?(Te=">=",Al?(wt=+wt+1,ni=0,wi=0):la&&(ni=+ni+1,wi=0)):Te==="<="&&(Te="<",Al?wt=+wt+1:ni=+ni+1),Ue=Te+wt+"."+ni+"."+wi):Al?Ue=">="+wt+".0.0 <"+(+wt+1)+".0.0":la&&(Ue=">="+wt+"."+ni+".0 <"+wt+"."+(+ni+1)+".0"),t("xRange return",Ue),Ue})}function Lfe($,se){return t("replaceStars",$,se),$.trim().replace(r[k6],"")}function Mfe($,se,ce,Ue,Te,wt,ni,wi,Ui,Tl,Al,la,Fa){return Ur(ce)?se="":Ur(Ue)?se=">="+ce+".0.0":Ur(Te)?se=">="+ce+"."+Ue+".0":se=">="+se,Ur(Ui)?wi="":Ur(Tl)?wi="<"+(+Ui+1)+".0.0":Ur(Al)?wi="<"+Ui+"."+(+Tl+1)+".0":la?wi="<="+Ui+"."+Tl+"."+Al+"-"+la:wi="<="+wi,(se+" "+wi).trim()}Es.prototype.test=function($){if(!$)return!1;typeof $=="string"&&($=new Ji($,this.loose));for(var se=0;se<this.set.length;se++)if(Nfe(this.set[se],$))return!0;return!1};function Nfe($,se){for(var ce=0;ce<$.length;ce++)if(!$[ce].test(se))return!1;if(se.prerelease.length){for(var ce=0;ce<$.length;ce++)if(t($[ce].semver),$[ce].semver!==wS&&$[ce].semver.prerelease.length>0){var Ue=$[ce].semver;if(Ue.major===se.major&&Ue.minor===se.minor&&Ue.patch===se.patch)return!0}return!1}return!0}e.satisfies=LD;function LD($,se,ce){try{se=new Es(se,ce)}catch{return!1}return se.test($)}e.maxSatisfying=Ofe;function Ofe($,se,ce){var Ue=null,Te=null;try{var wt=new Es(se,ce)}catch{return null}return $.forEach(function(ni){wt.test(ni)&&(!Ue||Te.compare(ni)===-1)&&(Ue=ni,Te=new Ji(Ue,ce))}),Ue}e.minSatisfying=Ffe;function Ffe($,se,ce){var Ue=null,Te=null;try{var wt=new Es(se,ce)}catch{return null}return $.forEach(function(ni){wt.test(ni)&&(!Ue||Te.compare(ni)===1)&&(Ue=ni,Te=new Ji(Ue,ce))}),Ue}e.validRange=Wfe;function Wfe($,se){try{return new Es($,se).range||"*"}catch{return null}}e.ltr=Bfe;function Bfe($,se,ce){return Y0($,se,"<",ce)}e.gtr=Vfe;function Vfe($,se,ce){return Y0($,se,">",ce)}e.outside=Y0;function Y0($,se,ce,Ue){$=new Ji($,Ue),se=new Es(se,Ue);var Te,wt,ni,wi,Ui;switch(ce){case">":Te=AD,wt=j0,ni=RD,wi=">",Ui=">=";break;case"<":Te=RD,wt=K0,ni=AD,wi="<",Ui="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(LD($,se,Ue))return!1;for(var Tl=0;Tl<se.set.length;++Tl){var Al=se.set[Tl],la=null,Fa=null;if(Al.forEach(function(Ag){Ag.semver===wS&&(Ag=new Cc(">=0.0.0")),la=la||Ag,Fa=Fa||Ag,Te(Ag.semver,la.semver,Ue)?la=Ag:ni(Ag.semver,Fa.semver,Ue)&&(Fa=Ag)}),la.operator===wi||la.operator===Ui||(!Fa.operator||Fa.operator===wi)&&wt($,Fa.semver))return!1;if(Fa.operator===Ui&&ni($,Fa.semver))return!1}return!0}e.prerelease=Hfe;function Hfe($,se){var ce=Ff($,se);return ce&&ce.prerelease.length?ce.prerelease:null}e.intersects=Ufe;function Ufe($,se,ce){return $=new Es($,ce),se=new Es(se,ce),$.intersects(se)}e.coerce=$fe;function $fe($){if($ instanceof Ji)return $;if(typeof $!="string")return null;var se=$.match(r[Ae]);return se==null?null:Ff((se[1]||"0")+"."+(se[2]||"0")+"."+(se[3]||"0"))}}(XD,XD.exports)),XD.exports}var By=iAe();const $ce=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,nAe=/^-(\d{4})(\d{2})(\d{2})$/;function sAe(s){return s=s.trim(),s==="*"||$ce.test(s)}function IV(s){if(!sAe(s))return null;if(s=s.trim(),s==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};const e=s.match($ce);return e?{hasCaret:e[1]==="^",hasGreaterEquals:e[1]===">=",majorBase:e[2]==="x"?0:parseInt(e[2],10),majorMustEqual:e[2]!=="x",minorBase:e[4]==="x"?0:parseInt(e[4],10),minorMustEqual:e[4]!=="x",patchBase:e[6]==="x"?0:parseInt(e[6],10),patchMustEqual:e[6]!=="x",preRelease:e[8]||null}:null}function DV(s){if(!s)return null;const e=s.majorBase,t=s.majorMustEqual,i=s.minorBase;let n=s.minorMustEqual;const o=s.patchBase;let r=s.patchMustEqual;s.hasCaret&&(e===0||(n=!1),r=!1);let a=0;if(s.preRelease){const c=nAe.exec(s.preRelease);if(c){const[,d,l,u]=c;a=Date.UTC(Number(d),Number(l)-1,Number(u))}}return{majorBase:e,majorMustEqual:t,minorBase:i,minorMustEqual:n,patchBase:o,patchMustEqual:r,isMinimum:s.hasGreaterEquals,notBefore:a}}function oAe(s,e,t){let i;typeof s=="string"?i=DV(IV(s)):i=s;let n;e instanceof Date?n=e.getTime():typeof e=="string"&&(n=new Date(e).getTime());let o;if(typeof t=="string"?o=DV(IV(t)):o=t,!i||!o)return!1;const r=i.majorBase,a=i.minorBase,c=i.patchBase;let d=o.majorBase,l=o.minorBase,u=o.patchBase;const g=o.notBefore;let m=o.majorMustEqual,v=o.minorMustEqual,_=o.patchMustEqual;return o.isMinimum?r>d?!0:r<d?!1:a>l?!0:a<l||n&&n<g?!1:c>=u:(r===1&&d===0&&(!m||!v||!_)&&(d=1,l=0,u=0,m=!0,v=!1,_=!1),r<d?!1:r>d?!m:a<l?!1:a>l?!v:c<u?!1:c>u?!_:!(n&&n<g))}function rAe(s,e,t,i,n,o){const r=[];if(typeof i.publisher<"u"&&typeof i.publisher!="string")return r.push([Fe.Error,h(1824,"property publisher must be of type `string`.")]),r;if(typeof i.name!="string")return r.push([Fe.Error,h(1825,"property `{0}` is mandatory and must be of type `string`","name")]),r;if(typeof i.version!="string")return r.push([Fe.Error,h(1826,"property `{0}` is mandatory and must be of type `string`","version")]),r;if(!i.engines)return r.push([Fe.Error,h(1827,"property `{0}` is mandatory and must be of type `object`","engines")]),r;if(typeof i.engines.vscode!="string")return r.push([Fe.Error,h(1828,"property `{0}` is mandatory and must be of type `string`","engines.vscode")]),r;if(typeof i.extensionDependencies<"u"&&!zQ(i.extensionDependencies))return r.push([Fe.Error,h(1829,"property `{0}` can be omitted or must be of type `string[]`","extensionDependencies")]),r;if(typeof i.activationEvents<"u"){if(!zQ(i.activationEvents))return r.push([Fe.Error,h(1830,"property `{0}` can be omitted or must be of type `string[]`","activationEvents")]),r;if(typeof i.main>"u"&&typeof i.browser>"u")return r.push([Fe.Error,h(1831,"property `{0}` should be omitted if the extension doesn't have a `{1}` or `{2}` property.","activationEvents","main","browser")]),r}if(typeof i.extensionKind<"u"&&typeof i.main>"u"&&r.push([Fe.Warning,h(1832,"property `{0}` can be defined only if property `main` is also defined.","extensionKind")]),typeof i.main<"u"){if(typeof i.main!="string")return r.push([Fe.Error,h(1833,"property `{0}` can be omitted or must be of type `string`","main")]),r;{const d=Ct(t,i.main);od(d,t)||r.push([Fe.Warning,h(1834,"Expected `main` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",d.path,t.path)])}}if(typeof i.browser<"u"){if(typeof i.browser!="string")return r.push([Fe.Error,h(1835,"property `{0}` can be omitted or must be of type `string`","browser")]),r;{const d=Ct(t,i.browser);od(d,t)||r.push([Fe.Warning,h(1836,"Expected `browser` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",d.path,t.path)])}}if(!By.valid(i.version))return r.push([Fe.Error,h(1837,"Extension version is not semver compatible.")]),r;const a=[];if(!aAe(s,e,i,n,a))for(const d of a)r.push([Fe.Error,d]);if(o&&i.enabledApiProposals?.length){const d=[];if(!cAe([...i.enabledApiProposals],d))for(const l of d)r.push([Fe.Error,l])}return r}function aAe(s,e,t,i,n){return i||typeof t.main>"u"&&typeof t.browser>"u"?!0:dAe(s,e,t.engines.vscode,n)}function cAe(s,e){if(s.length===0)return!0;const t=Array.isArray(e)?e:void 0,i=(t?void 0:e)??kF,n=[],o=Hme(s);for(const{proposalName:r,version:a}of o){if(!a)continue;i[r]?.version!==a&&n.push(r)}return n.length?(t&&(n.length===1?t.push(h(1838,"This extension is using the API proposal '{0}' that is not compatible with the current version of VS Code.",n[0])):t.push(h(1839,"This extension is using the API proposals {0} and '{1}' that are not compatible with the current version of VS Code.",n.slice(0,n.length-1).map(r=>`'${r}'`).join(", "),n[n.length-1]))),!1):!0}function dAe(s,e,t,i=[]){const n=DV(IV(t));if(!n)return i.push(h(1840,"Could not parse `engines.vscode` value {0}. Please use, for example: ^1.22.0, ^1.22.x, etc.",t)),!1;if(n.majorBase===0){if(!n.majorMustEqual||!n.minorMustEqual)return i.push(h(1841,"Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions before 1.0.0, please define at a minimum the major and minor desired version. E.g. ^0.10.0, 0.10.x, 0.11.0, etc.",t)),!1}else if(!n.majorMustEqual)return i.push(h(1842,"Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions after 1.0.0, please define at a minimum the major desired version. E.g. ^1.10.0, 1.10.x, 1.x.x, 2.x.x, etc.",t)),!1;return oAe(s,e,n)?!0:(i.push(h(1843,"Extension is not compatible with Code {0}. Extension requires: {1}.",s,t)),!1)}function zQ(s){if(!Array.isArray(s))return!1;for(let e=0,t=s.length;e<t;e++)if(typeof s[e]!="string")return!1;return!0}class lAe{constructor(){this.buffers=[]}add(e){let t=this.buffers.indexOf(e);return t<0&&(t=this.buffers.length,this.buffers.push(e)),t}}function hAe(s,e){if(e.serializeBuffersForPostMessage){const t=new lAe,n=JSON.stringify(s,(r,a)=>{if(a instanceof ArrayBuffer)return{$$vscode_array_buffer_reference$$:!0,index:t.add(a)};if(ArrayBuffer.isView(a)){const c=uAe(a);if(c)return{$$vscode_array_buffer_reference$$:!0,index:t.add(a.buffer),view:{type:c,byteLength:a.byteLength,byteOffset:a.byteOffset}}}return a}),o=t.buffers.map(r=>{const a=new Uint8Array(r);return Le.wrap(a)});return{message:n,buffers:o}}else return{message:JSON.stringify(s),buffers:[]}}function uAe(s){switch(s.constructor.name){case"Int8Array":return is.Int8Array;case"Uint8Array":return is.Uint8Array;case"Uint8ClampedArray":return is.Uint8ClampedArray;case"Int16Array":return is.Int16Array;case"Uint16Array":return is.Uint16Array;case"Int32Array":return is.Int32Array;case"Uint32Array":return is.Uint32Array;case"Float32Array":return is.Float32Array;case"Float64Array":return is.Float64Array;case"BigInt64Array":return is.BigInt64Array;case"BigUint64Array":return is.BigUint64Array}}function gAe(s,e){const t=e.map(o=>{const r=new ArrayBuffer(o.byteLength);return new Uint8Array(r).set(o.buffer),r}),i=e.length?(o,r)=>{if(r&&typeof r=="object"&&r.$$vscode_array_buffer_reference$$){const a=r,{index:c}=a,d=t[c];if(a.view)switch(a.view.type){case is.Int8Array:return new Int8Array(d,a.view.byteOffset,a.view.byteLength/Int8Array.BYTES_PER_ELEMENT);case is.Uint8Array:return new Uint8Array(d,a.view.byteOffset,a.view.byteLength/Uint8Array.BYTES_PER_ELEMENT);case is.Uint8ClampedArray:return new Uint8ClampedArray(d,a.view.byteOffset,a.view.byteLength/Uint8ClampedArray.BYTES_PER_ELEMENT);case is.Int16Array:return new Int16Array(d,a.view.byteOffset,a.view.byteLength/Int16Array.BYTES_PER_ELEMENT);case is.Uint16Array:return new Uint16Array(d,a.view.byteOffset,a.view.byteLength/Uint16Array.BYTES_PER_ELEMENT);case is.Int32Array:return new Int32Array(d,a.view.byteOffset,a.view.byteLength/Int32Array.BYTES_PER_ELEMENT);case is.Uint32Array:return new Uint32Array(d,a.view.byteOffset,a.view.byteLength/Uint32Array.BYTES_PER_ELEMENT);case is.Float32Array:return new Float32Array(d,a.view.byteOffset,a.view.byteLength/Float32Array.BYTES_PER_ELEMENT);case is.Float64Array:return new Float64Array(d,a.view.byteOffset,a.view.byteLength/Float64Array.BYTES_PER_ELEMENT);case is.BigInt64Array:return new BigInt64Array(d,a.view.byteOffset,a.view.byteLength/BigInt64Array.BYTES_PER_ELEMENT);case is.BigUint64Array:return new BigUint64Array(d,a.view.byteOffset,a.view.byteLength/BigUint64Array.BYTES_PER_ELEMENT);default:throw new Error("Unknown array buffer view type")}return d}return r}:void 0;return{message:JSON.parse(s,i),arrayBuffers:t}}var PR;(function(s){function e(t){switch(t.type){case"extension":return`extension:${t.extensionId.value}`;case"mcp":return`mcp:${t.collectionId}:${t.definitionId}`;case"internal":return"internal"}}s.toKey=e})(PR||(PR={}));function o7e(s){return typeof s=="object"&&typeof s.sessionId=="string"}function pAe(s){return s.content.some(e=>e.kind==="data")}I(6786,"Extensions");var qQ;(function(s){s[s.Installing=0]="Installing",s[s.Installed=1]="Installed",s[s.Uninstalling=2]="Uninstalling",s[s.Uninstalled=3]="Uninstalled"})(qQ||(qQ={}));var KQ;(function(s){s.ReloadWindow="reloadWindow",s.RestartExtensions="restartExtensions",s.DownloadUpdate="downloadUpdate",s.ApplyUpdate="applyUpdate",s.QuitAndInstall="quitAndInstall"})(KQ||(KQ={}));var jQ;(function(s){s.Readme="readme",s.Features="features",s.Changelog="changelog",s.Dependencies="dependencies",s.ExtensionPack="extensionPack"})(jQ||(jQ={}));let YQ=class extends F{constructor(e,t){super(),this.containers=e,this._register(t.onChange(this.update,this))}set extension(e){this.containers.forEach(t=>t.extension=e)}update(e){for(const t of this.containers)e&&t.extension?ja(t.extension.identifier,e.identifier)&&(t.extension.server&&e.server&&t.extension.server!==e.server?t.updateWhenCounterExtensionChanges&&t.update():t.extension=e):t.update()}};YQ=f([p(1,Aw)],YQ);new O("hasOutdatedExtensions",!1);new O("hasGallery",!1);new O("extensionResultListFocused ",!0);new N("extensionsSearchActionsMenu");const a7e="workbench.editorAssociations",fAe=Ke.as(Js.Configuration),mAe={...vN,properties:{"workbench.editorAssociations":{type:"object",markdownDescription:h(12191,'Configure [glob patterns](https://aka.ms/vscode-glob-patterns) to editors (for example `"*.hex": "hexEditor.hexedit"`). These have precedence over the default behavior.'),additionalProperties:{type:"string"}}}};fAe.registerConfiguration(mAe);var mm;(function(s){s.builtin="builtin",s.option="option",s.exclusive="exclusive",s.default="default"})(mm||(mm={}));var QQ;(function(s){s[s.ABORT=1]="ABORT",s[s.NONE=2]="NONE"})(QQ||(QQ={}));function c7e(s){switch(s){case mm.exclusive:return 5;case mm.default:return 4;case mm.builtin:return 3;case mm.option:default:return 1}}function d7e(s,e){if(new Set([ae.extension,ae.webviewPanel,ae.vscodeWorkspaceTrust,ae.vscodeSettings]).has(e.scheme))return!1;const n=typeof s=="string"&&s.indexOf(Yc.sep)>=0?`${e.scheme}:${e.path}`:Qe(e);return Db(typeof s=="string"?s.toLowerCase():s,n.toLowerCase())}var LR;(function(s){s[s.Output=1]="Output",s[s.OutputItems=2]="OutputItems",s[s.ExecutionState=3]="ExecutionState"})(LR||(LR={}));const l7e="views",h7e=h(4020,"Views"),vAe=Pe("default-view-icon",K.window,h(4021,"Default view icon."));var qp;(function(s){s.ViewContainersRegistry="workbench.registry.view.containers",s.ViewsRegistry="workbench.registry.view"})(qp||(qp={}));var We;(function(s){s[s.Sidebar=0]="Sidebar",s[s.Panel=1]="Panel",s[s.AuxiliaryBar=2]="AuxiliaryBar"})(We||(We={}));const u7e=[We.Sidebar,We.Panel,We.AuxiliaryBar];function Zc(s){switch(s){case We.Sidebar:return"sidebar";case We.Panel:return"panel";case We.AuxiliaryBar:return"auxiliarybar"}}class _Ae extends F{constructor(){super(...arguments),this._onDidRegister=this._register(new M),this.onDidRegister=this._onDidRegister.event,this._onDidDeregister=this._register(new M),this.onDidDeregister=this._onDidDeregister.event,this.viewContainers=new Map,this.defaultViewContainers=[]}get all(){return[...this.viewContainers.values()].flat()}registerViewContainer(e,t,i){const n=this.get(e.id);if(n)return n;const o=e;return o.openCommandActionDescriptor=i?.doNotRegisterOpenCommand?void 0:o.openCommandActionDescriptor??{id:o.id},xk(this.viewContainers,t,[]).push(o),i?.isDefault&&this.defaultViewContainers.push(o),this._onDidRegister.fire({viewContainer:o,viewContainerLocation:t}),o}deregisterViewContainer(e){for(const t of this.viewContainers.keys()){const i=this.viewContainers.get(t),n=i?.indexOf(e);if(n!==-1){i?.splice(n,1),i.length===0&&this.viewContainers.delete(t),this._onDidDeregister.fire({viewContainer:e,viewContainerLocation:t});return}}}get(e){return this.all.filter(t=>t.id===e)[0]}getViewContainers(e){return[...this.viewContainers.get(e)||[]]}getViewContainerLocation(e){return[...this.viewContainers.keys()].filter(t=>this.getViewContainers(t).filter(i=>i?.id===e.id).length>0)[0]}getDefaultViewContainer(e){return this.defaultViewContainers.find(t=>this.getViewContainerLocation(t)===e)}}Ke.add(qp.ViewContainersRegistry,new _Ae);var MR;(function(s){s.Open="2_open",s.Debug="4_debug",s.SCM="5_scm",s.More="9_more"})(MR||(MR={}));function bAe(s,e){const t=s.group??MR.More,i=e.group??MR.More;return t!==i?t.localeCompare(i):(s.order??5)-(e.order??5)}class yAe extends F{constructor(){super(...arguments),this._onViewsRegistered=this._register(new M),this.onViewsRegistered=this._onViewsRegistered.event,this._onViewsDeregistered=this._register(new M),this.onViewsDeregistered=this._onViewsDeregistered.event,this._onDidChangeContainer=this._register(new M),this.onDidChangeContainer=this._onDidChangeContainer.event,this._onDidChangeViewWelcomeContent=this._register(new M),this.onDidChangeViewWelcomeContent=this._onDidChangeViewWelcomeContent.event,this._viewContainers=[],this._views=new Map,this._viewWelcomeContents=new one}registerViews(e,t){this.registerViews2([{views:e,viewContainer:t}])}registerViews2(e){e.forEach(({views:t,viewContainer:i})=>this.addViews(t,i)),this._onViewsRegistered.fire(e)}deregisterViews(e,t){const i=this.removeViews(e,t);i.length&&this._onViewsDeregistered.fire({views:i,viewContainer:t})}moveViews(e,t){for(const i of this._views.keys())if(i!==t){const n=this.removeViews(e,i);n.length&&(this.addViews(n,t),this._onDidChangeContainer.fire({views:n,from:i,to:t}))}}getViews(e){return this._views.get(e)||[]}getView(e){for(const t of this._viewContainers){const i=(this._views.get(t)||[]).filter(n=>n.id===e)[0];if(i)return i}return null}getViewContainer(e){for(const t of this._viewContainers)if((this._views.get(t)||[]).filter(n=>n.id===e)[0])return t;return null}registerViewWelcomeContent(e,t){return this._viewWelcomeContents.add(e,t),this._onDidChangeViewWelcomeContent.fire(e),Ie(()=>{this._viewWelcomeContents.delete(e,t),this._onDidChangeViewWelcomeContent.fire(e)})}registerViewWelcomeContent2(e,t){const i=new Map;for(const[n,o]of t)this._viewWelcomeContents.add(e,o),i.set(n,Ie(()=>{this._viewWelcomeContents.delete(e,o),this._onDidChangeViewWelcomeContent.fire(e)}));return this._onDidChangeViewWelcomeContent.fire(e),i}getViewWelcomeContent(e){const t=[];return this._viewWelcomeContents.forEach(e,i=>t.push(i)),t.sort(bAe)}addViews(e,t){let i=this._views.get(t);i||(i=[],this._views.set(t,i),this._viewContainers.push(t));for(const n of e){if(this.getView(n.id)!==null)throw new Error(h(4022,"A view with id '{0}' is already registered",n.id));i.push(n)}}removeViews(e,t){const i=this._views.get(t);if(!i)return[];const n=[],o=[];for(const r of i)e.includes(r)?n.push(r):o.push(r);return n.length&&(o.length?this._views.set(t,o):(this._views.delete(t),this._viewContainers.splice(this._viewContainers.indexOf(t),1))),n}}Ke.add(qp.ViewsRegistry,new yAe);var kV;(function(s){s[s.Default=0]="Default",s[s.Expand=1]="Expand"})(kV||(kV={}));var XQ;(function(s){s[s.None=0]="None",s[s.Collapsed=1]="Collapsed",s[s.Expanded=2]="Expanded"})(XQ||(XQ={}));class C1{constructor(e,t){this.resolved=!1,this._hasResolve=!1,Vu(this,e),this._hasResolve=!!t,this.resolve=async i=>{if(t&&!this.resolved){const n=await t(i);n&&(this.tooltip=this.tooltip??n.tooltip,this.command=this.command??n.command)}i.isCancellationRequested||(this.resolved=!0)}}get hasResolve(){return this._hasResolve}resetResolve(){this.resolved=!1}asTreeItem(){return{handle:this.handle,parentHandle:this.parentHandle,collapsibleState:this.collapsibleState,label:this.label,description:this.description,icon:this.icon,iconDark:this.iconDark,themeIcon:this.themeIcon,resourceUri:this.resourceUri,tooltip:this.tooltip,contextValue:this.contextValue,command:this.command,children:this.children,accessibilityInformation:this.accessibilityInformation}}}class wAe extends Error{constructor(e){super(h(4023,"No tree view with id '{0}' registered.",e)),this.name="NoTreeViewError"}static is(e){return!!e&&e.name==="NoTreeViewError"}}function SAe(s,e){if(s.length===0)return Promise.resolve(!1);const t=[];let i=!1;for(const n of s){if(n===!0)return Promise.resolve(!0);BT(n)&&t.push(n.then(o=>{o&&(i=!0)},o=>{e(o),i=!0}))}return Pp.settled(t).then(()=>i)}function VK(s){const e=s.isExtensionDevelopment;let t=!0;const i=s.extensionDevelopmentLocationURI;if(i)for(const a of i)a.scheme!==ae.file&&(t=!1);const n=t&&typeof s.debugExtensionHost.port=="number",o=t&&!!s.debugExtensionHost.break,r=e&&!!s.extensionTestsLocationURI&&!s.debugExtensionHost.debugId;return{isExtensionDevHost:e,isExtensionDevDebug:n,isExtensionDevDebugBrk:o,isExtensionDevTestFromCli:r}}function ht(s){return function(e){Vy.INSTANCE.registerNamedCustomer(s,e)}}function c_(s){Vy.INSTANCE.registerCustomer(s)}var NR;(function(s){function e(){return Vy.INSTANCE.getNamedCustomers()}s.getNamedCustomers=e;function t(){return Vy.INSTANCE.getCustomers()}s.getCustomers=t})(NR||(NR={}));class Vy{static{this.INSTANCE=new Vy}constructor(){this._namedCustomers=[],this._customers=[]}registerNamedCustomer(e,t){const i=[e,t];this._namedCustomers.push(i)}getNamedCustomers(){return this._namedCustomers}registerCustomer(e){this._customers.push(e)}getCustomers(){return this._customers}}var Kk;let OR=Kk=class extends F{get pid(){return this._extensionHost.pid}get kind(){return this._extensionHost.runningLocation.kind}get startup(){return this._extensionHost.startup}get friendyName(){return Gce(this.kind,this.pid)}constructor(e,t,i,n,o,r,a){super(),this._internalExtensionService=i,this._instantiationService=n,this._environmentService=o,this._telemetryService=r,this._logService=a,this._onDidChangeResponsiveState=this._register(new M),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._hasStarted=!1,this._cachedActivationEvents=new Map,this._resolvedActivationEvents=new Set,this._rpcProtocol=null,this._customers=[],this._extensionHost=e,this.onDidExit=this._extensionHost.onExit;const c={time:Date.now(),action:"starting",kind:th(this.kind)};this._telemetryService.publicLog2("extensionHostStartup",c),this._proxy=this._extensionHost.start().then(d=>{this._hasStarted=!0;const l={time:Date.now(),action:"success",kind:th(this.kind)};return this._telemetryService.publicLog2("extensionHostStartup",l),this._createExtensionHostCustomers(this.kind,d)},d=>{this._logService.error(`Error received from starting extension host (kind: ${th(this.kind)})`),this._logService.error(d);const l={time:Date.now(),action:"error",kind:th(this.kind)};return d&&d.name&&(l.errorName=d.name),d&&d.message&&(l.errorMessage=d.message),d&&d.stack&&(l.errorStack=d.stack),this._telemetryService.publicLog2("extensionHostStartup",l),null}),this._proxy.then(()=>{t.forEach(d=>this.activateByEvent(d,Op.Normal)),this._register(IAe({measure:()=>this.measure()}))})}async disconnect(){await this._extensionHost?.disconnect?.()}dispose(){this._extensionHost?.dispose(),this._rpcProtocol?.dispose();for(let e=0,t=this._customers.length;e<t;e++){const i=this._customers[e];try{i.dispose()}catch(n){mt(n)}}this._proxy=null,super.dispose()}async measure(){const e=await this._proxy;if(!e)return null;const t=await this._measureLatency(e),i=await this._measureDown(e),n=await this._measureUp(e);return{remoteAuthority:this._extensionHost.remoteAuthority,latency:t,down:i,up:n}}async ready(){await this._proxy}async _measureLatency(e){let i=0;for(let n=0;n<10;n++){const o=Xn.create();await e.test_latency(n),o.stop(),i+=o.elapsed()}return i/10}static _convert(e,t){return e*1e3*8/t}async _measureUp(e){const i=Le.alloc(10485760),n=Math.ceil(Math.random()*256);for(let r=0;r<i.byteLength;r++)i.writeUInt8(r,n);const o=Xn.create();return await e.test_up(i),o.stop(),Kk._convert(10485760,o.elapsed())}async _measureDown(e){const i=Xn.create();return await e.test_down(10485760),i.stop(),Kk._convert(10485760,i.elapsed())}_createExtensionHostCustomers(e,t){let i=null;this._environmentService.logExtensionHostCommunication?i=new xAe(e):FR.isEnabled()&&(i=new FR(this._telemetryService)),this._rpcProtocol=new AR(t,i),this._register(this._rpcProtocol.onDidChangeResponsiveState(d=>this._onDidChangeResponsiveState.fire(d)));let n=null,o=[];const r={remoteAuthority:this._extensionHost.remoteAuthority,extensionHostKind:this.kind,getProxy:d=>this._rpcProtocol.getProxy(d),set:(d,l)=>this._rpcProtocol.set(d,l),dispose:()=>this._rpcProtocol.dispose(),assertRegistered:d=>this._rpcProtocol.assertRegistered(d),drain:()=>this._rpcProtocol.drain(),internalExtensionService:this._internalExtensionService,_setExtensionHostProxy:d=>{n=d},_setAllMainProxyIdentifiers:d=>{o=d}},a=NR.getNamedCustomers();for(let d=0,l=a.length;d<l;d++){const[u,g]=a[d];try{const m=this._instantiationService.createInstance(g,r);this._customers.push(m),this._rpcProtocol.set(u,m)}catch(m){this._logService.error(`Cannot instantiate named customer: '${u.sid}'`),this._logService.error(m),mt(m)}}const c=NR.getCustomers();for(const d of c)try{const l=this._instantiationService.createInstance(d,r);this._customers.push(l)}catch(l){this._logService.error(l),mt(l)}if(!n)throw new Error("Missing IExtensionHostProxy!");return this._rpcProtocol.assertRegistered(o),n}async activate(e,t){const i=await this._proxy;return i?i.activate(e,t):!1}activateByEvent(e,t){return t===Op.Immediate&&!this._hasStarted?Promise.resolve():(this._cachedActivationEvents.has(e)||this._cachedActivationEvents.set(e,this._activateByEvent(e,t)),this._cachedActivationEvents.get(e))}activationEventIsDone(e){return this._resolvedActivationEvents.has(e)}async _activateByEvent(e,t){if(!this._proxy)return;const i=await this._proxy;if(i){if(!this._extensionHost.extensions.containsActivationEvent(e)){this._resolvedActivationEvents.add(e);return}await i.activateByEvent(e,t),this._resolvedActivationEvents.add(e)}}async getInspectPort(e){if(this._extensionHost){e&&await this._extensionHost.enableInspectPort();const t=this._extensionHost.getInspectPort();if(t)return t}}async resolveAuthority(e,t){const i=Xn.create(!1),n=()=>`[${th(this._extensionHost.runningLocation.kind)}${this._extensionHost.runningLocation.affinity}][resolveAuthority(${Toe(e)},${t})][${i.elapsed()}ms] `,o=d=>this._logService.info(`${n()}${d}`),r=(d,l=void 0)=>this._logService.error(`${n()}${d}`,l);o("obtaining proxy...");const a=await this._proxy;if(!a)return r("no proxy"),{type:"error",error:{message:"Cannot resolve authority",code:mr.Unknown,detail:void 0}};o("invoking...");const c=new Ume;try{c.cancelAndSet(()=>o("waiting..."),1e3);const d=await a.resolveAuthority(e,t);return c.dispose(),d.type==="ok"?o(`returned ${d.value.authority.connectTo}`):r("returned an error",d.error),d}catch(d){return c.dispose(),r("returned an error",d),{type:"error",error:{message:d.message,code:mr.Unknown,detail:d}}}}async getCanonicalURI(e,t){const i=await this._proxy;if(!i)throw new Error("Cannot resolve canonical URI");return i.getCanonicalURI(e,t)}async start(e,t,i){const n=await this._proxy;if(!n)return;const o=this._extensionHost.extensions.set(e,t,i);return n.startExtensionHost(o)}async extensionTestsExecute(){const e=await this._proxy;if(!e)throw new Error("Could not obtain Extension Host Proxy");return e.extensionTestsExecute()}representsRunningLocation(e){return this._extensionHost.runningLocation.equals(e)}async deltaExtensions(e){const t=await this._proxy;if(!t)return;const i=this._extensionHost.extensions.delta(e);if(i)return t.deltaExtensions(i)}containsExtension(e){return this._extensionHost.extensions?.containsExtension(e)??!1}async setRemoteEnvironment(e){const t=await this._proxy;if(t)return t.setRemoteEnvironment(e)}};OR=Kk=f([p(3,Z),p(4,wn),p(5,ai),p(6,Re)],OR);function Gce(s,e){return e?`${th(s)} pid: ${e}`:`${th(s)}`}const CAe=[["#2977B1","#FC802D","#34A13A","#D3282F","#9366BA"],["#8B564C","#E177C0","#7F7F7F","#BBBE3D","#2EBECD"]];function ZQ(s){if(Array.isArray(s))return s;if(s&&typeof s=="object"&&typeof s.toString=="function"){const e=s.toString();if(e!=="[object Object]")return e}return s}function EAe(s){return Array.isArray(s)?s.map(ZQ):ZQ(s)}class xAe{constructor(e){this._kind=e,this._totalIncoming=0,this._totalOutgoing=0}_log(e,t,i,n,o,r,a){a=EAe(a);const c=CAe[o],d=c[n%c.length];let l=[`%c[${th(this._kind)}][${e}]%c[${String(t).padStart(7)}]%c[len: ${String(i).padStart(5)}]%c${String(n).padStart(5)} - ${r}`,"color: darkgreen","color: grey","color: grey",`color: ${d}`];/\($/.test(r)?(l=l.concat(a),l.push(")")):l.push(a),console.log.apply(console,l)}logIncoming(e,t,i,n,o){this._totalIncoming+=e,this._log("Ext  Win",this._totalIncoming,e,t,i,n,o)}logOutgoing(e,t,i,n,o){this._totalOutgoing+=e,this._log("Win  Ext",this._totalOutgoing,e,t,i,n,o)}}let FR=class{static isEnabled(){return Math.random()<1e-4}constructor(e){this._telemetryService=e,this._pendingRequests=new Map}logIncoming(e,t,i,n){if(i===jr.LocalSide&&/^receiveReply(Err)?:/.test(n)){const o=this._pendingRequests.get(t)??"unknown_reply";this._pendingRequests.delete(t),this._telemetryService.publicLog2("extensionhost.incoming",{type:`${n} ${o}`,length:e})}i===jr.OtherSide&&/^receiveRequest /.test(n)&&this._telemetryService.publicLog2("extensionhost.incoming",{type:`${n}`,length:e})}logOutgoing(e,t,i,n){i===jr.LocalSide&&n.startsWith("request: ")&&(this._pendingRequests.set(t,n),this._telemetryService.publicLog2("extensionhost.outgoing",{type:n,length:e}))}};FR=f([p(0,ai)],FR);const zS=[];function IAe(s){return zS.push(s),{dispose:()=>{for(let e=0;e<zS.length;e++)if(zS[e]===s){zS.splice(e,1);return}}}}function DAe(){return zS.slice(0)}Y(class jk extends X{constructor(){super({id:"editor.action.measureExtHostLatency",title:I(12305,"Measure Extension Host Latency"),category:te.Developer,f1:!0})}async run(e){const t=e.get(de),i=await Promise.all(DAe().map(n=>n.measure()));t.openEditor({resource:void 0,contents:i.map(jk._print).join(`

`),options:{pinned:!0}})}static _print(e){return e?`${e.remoteAuthority?`Authority: ${e.remoteAuthority}
`:""}Roundtrip latency: ${e.latency.toFixed(3)}ms
Up: ${jk._printSpeed(e.up)}
Down: ${jk._printSpeed(e.down)}
`:""}static _printSpeed(e){return e<=1024?`${e} bps`:e<1024*1024?`${(e/1024).toFixed(1)} kbps`:`${(e/1024/1024).toFixed(1)} Mbps`}});class WR{constructor(e){this.affinity=e,this.kind=Ft.LocalProcess}equals(e){return this.kind===e.kind&&this.affinity===e.affinity}asString(){return this.affinity===0?"LocalProcess":`LocalProcess${this.affinity}`}}class TV{constructor(e){this.affinity=e,this.kind=Ft.LocalWebWorker}equals(e){return this.kind===e.kind&&this.affinity===e.affinity}asString(){return this.affinity===0?"LocalWebWorker":`LocalWebWorker${this.affinity}`}}class BR{constructor(){this.kind=Ft.Remote,this.affinity=0}equals(e){return this.kind===e.kind}asString(){return"Remote"}}let AV=class{get maxLocalProcessAffinity(){return this._maxLocalProcessAffinity}get maxLocalWebWorkerAffinity(){return this._maxLocalWebWorkerAffinity}constructor(e,t,i,n,o,r){this._registry=e,this._extensionHostKindPicker=t,this._environmentService=i,this._configurationService=n,this._logService=o,this._extensionManifestPropertiesService=r,this._runningLocation=new Po,this._maxLocalProcessAffinity=0,this._maxLocalWebWorkerAffinity=0}set(e,t){this._runningLocation.set(e,t)}readExtensionKinds(e){return e.isUnderDevelopment&&this._environmentService.extensionDevelopmentKind?this._environmentService.extensionDevelopmentKind:this._extensionManifestPropertiesService.getExtensionKind(e)}getRunningLocation(e){return this._runningLocation.get(e)||null}filterByRunningLocation(e,t){return Yk(e,this._runningLocation,i=>t.equals(i))}filterByExtensionHostKind(e,t){return Yk(e,this._runningLocation,i=>i.kind===t)}filterByExtensionHostManager(e,t){return Yk(e,this._runningLocation,i=>t.representsRunningLocation(i))}_computeAffinity(e,t,i){const n=new Po;for(const u of e)(u.main||u.browser)&&n.set(u.identifier,u);for(const u of this._registry.getAllExtensionDescriptions())if(u.main||u.browser){const g=this._runningLocation.get(u.identifier);g&&g.kind===t&&n.set(u.identifier,u)}const o=new Po;let r=0;for(const[u,g]of n)o.set(g.identifier,++r);const a=(u,g)=>{for(const[m,v]of o)v===u&&o.set(m,g)};for(const[u,g]of n){if(!g.extensionDependencies)continue;const m=o.get(g.identifier);for(const v of g.extensionDependencies){const _=o.get(v);_&&_!==m&&a(_,m)}}const c=new Map;let d=0;for(const[u,g]of n){const m=this._runningLocation.get(g.identifier);if(m){const v=o.get(g.identifier);c.set(v,m.affinity),d=Math.max(d,m.affinity)}}if(!this._environmentService.isExtensionDevelopment){const u=this._configurationService.getValue("extensions.experimental.affinity")||{},g=Object.keys(u),m=new Map;for(const v of g){const _=u[v];if(typeof _!="number"||_<=0||Math.floor(_)!==_){this._logService.info(`Ignoring configured affinity for '${v}' because the value is not a positive integer.`);continue}const w=o.get(v);if(!w)continue;const C=c.get(w);if(C){m.set(_,C);continue}const k=m.get(_);if(k){c.set(w,k);continue}if(!i){this._logService.info(`Ignoring configured affinity for '${v}' because extension host(s) are already running. Reload window.`);continue}const D=++d;m.set(_,D),c.set(w,D)}}const l=new Po;for(const u of e){const g=o.get(u.identifier)||0,m=c.get(g)||0;l.set(u.identifier,m)}if(d>0&&i)for(let u=1;u<=d;u++){const g=[];for(const m of e)l.get(m.identifier)===u&&g.push(m.identifier);this._logService.info(`Placing extension(s) ${g.map(m=>m.value).join(", ")} on a separate extension host.`)}return{affinities:l,maxAffinity:d}}computeRunningLocation(e,t,i){return this._doComputeRunningLocation(this._runningLocation,e,t,i).runningLocation}_doComputeRunningLocation(e,t,i,n){t=t.filter(v=>!e.has(v.identifier)),i=i.filter(v=>!e.has(v.identifier));const o=YTe(t,i,v=>this.readExtensionKinds(v),(v,_,w,C,k)=>this._extensionHostKindPicker.pickExtensionHostKind(v,_,w,C,k)),r=new Po;for(const v of t)r.set(v.identifier,v);for(const v of i)r.set(v.identifier,v);const a=new Po,c=[],d=[];for(const[v,_]of o){let w=null;if(_===Ft.LocalProcess){const C=r.get(v);C&&c.push(C)}else if(_===Ft.LocalWebWorker){const C=r.get(v);C&&d.push(C)}else _===Ft.Remote&&(w=new BR);a.set(v,w)}const{affinities:l,maxAffinity:u}=this._computeAffinity(c,Ft.LocalProcess,n);for(const v of c){const _=l.get(v.identifier)||0;a.set(v.identifier,new WR(_))}const{affinities:g,maxAffinity:m}=this._computeAffinity(d,Ft.LocalWebWorker,n);for(const v of d){const _=g.get(v.identifier)||0;a.set(v.identifier,new TV(_))}for(const[v,_]of e)_&&a.set(v,_);return{runningLocation:a,maxLocalProcessAffinity:u,maxLocalWebWorkerAffinity:m}}initializeRunningLocation(e,t){const{runningLocation:i,maxLocalProcessAffinity:n,maxLocalWebWorkerAffinity:o}=this._doComputeRunningLocation(this._runningLocation,e,t,!0);this._runningLocation=i,this._maxLocalProcessAffinity=n,this._maxLocalWebWorkerAffinity=o}deltaExtensions(e,t){const i=new Po;for(const n of t){const o=n;i.set(o,this._runningLocation.get(o)||null),this._runningLocation.delete(o)}return this._updateRunningLocationForAddedExtensions(e),i}_updateRunningLocationForAddedExtensions(e){const t=[],i=[];for(const r of e){const a=this.readExtensionKinds(r),c=r.extensionLocation.scheme===ae.vscodeRemote,d=this._extensionHostKindPicker.pickExtensionHostKind(r.identifier,a,!c,c,ea.None);let l=null;d===Ft.LocalProcess?t.push(r):d===Ft.LocalWebWorker?i.push(r):d===Ft.Remote&&(l=new BR),this._runningLocation.set(r.identifier,l)}const{affinities:n}=this._computeAffinity(t,Ft.LocalProcess,!1);for(const r of t){const a=n.get(r.identifier)||0;this._runningLocation.set(r.identifier,new WR(a))}const{affinities:o}=this._computeAffinity(i,Ft.LocalWebWorker,!1);for(const r of i){const a=o.get(r.identifier)||0;this._runningLocation.set(r.identifier,new TV(a))}}};AV=f([p(2,wn),p(3,ne),p(4,Re),p(5,Kv)],AV);function Yk(s,e,t){return s.filter(i=>{const n=e.get(i.identifier);return n&&t(n)})}function kAe(s,e,t){return s.filter(i=>{const n=e.get(i);return n&&t(n)})}let RV=class extends F{get pid(){return this._actual?this._actual.pid:null}get kind(){return this._extensionHost.runningLocation.kind}get startup(){return this._extensionHost.startup}get friendyName(){return Gce(this.kind,this.pid)}constructor(e,t,i,n){super(),this._internalExtensionService=t,this._instantiationService=i,this._logService=n,this._onDidChangeResponsiveState=this._register(new M),this.onDidChangeResponsiveState=this._onDidChangeResponsiveState.event,this._extensionHost=e,this.onDidExit=e.onExit,this._startCalled=new Rp,this._actual=null,this._lazyStartExtensions=null}_createActual(e){return this._logService.info(`Creating lazy extension host (${this.friendyName}). Reason: ${e}`),this._actual=this._register(this._instantiationService.createInstance(OR,this._extensionHost,[],this._internalExtensionService)),this._register(this._actual.onDidChangeResponsiveState(t=>this._onDidChangeResponsiveState.fire(t))),this._actual}async _getOrCreateActualAndStart(e){if(this._actual)return this._actual;const t=this._createActual(e);return await t.start(this._lazyStartExtensions.versionId,this._lazyStartExtensions.allExtensions,this._lazyStartExtensions.myExtensions),t}async ready(){await this._startCalled.wait(),this._actual&&await this._actual.ready()}async disconnect(){await this._actual?.disconnect()}representsRunningLocation(e){return this._extensionHost.runningLocation.equals(e)}async deltaExtensions(e){if(await this._startCalled.wait(),this._actual)return this._actual.deltaExtensions(e);if(this._lazyStartExtensions.delta(e),e.myToAdd.length>0){await this._createActual(`contains ${e.myToAdd.length} new extension(s) (installed or enabled): ${e.myToAdd.map(i=>i.value)}`).start(this._lazyStartExtensions.versionId,this._lazyStartExtensions.allExtensions,this._lazyStartExtensions.myExtensions);return}}containsExtension(e){return this._extensionHost.extensions?.containsExtension(e)??!1}async activate(e,t){return await this._startCalled.wait(),this._actual?this._actual.activate(e,t):!1}async activateByEvent(e,t){if(t===Op.Immediate)return this._actual?this._actual.activateByEvent(e,t):void 0;if(await this._startCalled.wait(),this._actual)return this._actual.activateByEvent(e,t)}activationEventIsDone(e){return this._startCalled.isOpen()?this._actual?this._actual.activationEventIsDone(e):!0:!1}async getInspectPort(e){return await this._startCalled.wait(),this._actual?.getInspectPort(e)}async resolveAuthority(e,t){return await this._startCalled.wait(),this._actual?this._actual.resolveAuthority(e,t):{type:"error",error:{message:"Cannot resolve authority",code:mr.Unknown,detail:void 0}}}async getCanonicalURI(e,t){if(await this._startCalled.wait(),this._actual)return this._actual.getCanonicalURI(e,t);throw new Error("Cannot resolve canonical URI")}async start(e,t,i){if(i.length>0){const o=this._createActual(`contains ${i.length} extension(s): ${i.map(r=>r.value)}.`).start(e,t,i);return this._startCalled.open(),o}this._lazyStartExtensions=new Ik(e,t,i),this._startCalled.open()}async extensionTestsExecute(){return await this._startCalled.wait(),(await this._getOrCreateActualAndStart("execute tests.")).extensionTestsExecute()}async setRemoteEnvironment(e){if(await this._startCalled.wait(),this._actual)return this._actual.setRemoteEnvironment(e)}};RV=f([p(2,Z),p(3,Re)],RV);var PV;const E1=Object.hasOwnProperty,TAe=Promise.resolve(void 0);let LV=PV=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A,B){super(),this._extensionsProposedApi=t,this._extensionHostFactory=i,this._extensionHostKindPicker=n,this._instantiationService=o,this._notificationService=r,this._environmentService=a,this._telemetryService=c,this._extensionEnablementService=d,this._fileService=l,this._productService=u,this._extensionManagementService=g,this._contextService=m,this._configurationService=v,this._extensionManifestPropertiesService=_,this._logService=w,this._remoteAgentService=C,this._remoteExtensionsScannerService=k,this._lifecycleService=D,this._remoteAuthorityResolverService=A,this._dialogService=B,this._onDidRegisterExtensions=this._register(new M),this.onDidRegisterExtensions=this._onDidRegisterExtensions.event,this._onDidChangeExtensionsStatus=this._register(new M),this.onDidChangeExtensionsStatus=this._onDidChangeExtensionsStatus.event,this._onDidChangeExtensions=this._register(new M({leakWarningThreshold:400})),this.onDidChangeExtensions=this._onDidChangeExtensions.event,this._onWillActivateByEvent=this._register(new M),this.onWillActivateByEvent=this._onWillActivateByEvent.event,this._onDidChangeResponsiveChange=this._register(new M),this.onDidChangeResponsiveChange=this._onDidChangeResponsiveChange.event,this._onWillStop=this._register(new M),this.onWillStop=this._onWillStop.event,this._activationEventReader=new OAe,this._registry=new bTe(this._activationEventReader),this._installedExtensionsReady=new Rp,this._extensionStatus=new Po,this._allRequestedActivateEvents=new Set,this._remoteCrashTracker=new VR,this._deltaExtensionsQueue=[],this._inHandleDeltaExtensions=!1,this._extensionHostManagers=this._register(new AAe),this._resolveAuthorityAttempt=0,this._hasLocalProcess=e.hasLocalProcess,this._allowRemoteExtensionsInLocalWebWorker=e.allowRemoteExtensionsInLocalWebWorker,this._register(this._fileService.onWillActivateFileSystemProvider(q=>{q.scheme!==ae.vscodeRemote&&q.join(this.activateByEvent(`onFileSystem:${q.scheme}`))})),this._runningLocations=new AV(this._registry,this._extensionHostKindPicker,this._environmentService,this._configurationService,this._logService,this._extensionManifestPropertiesService),this._register(this._extensionEnablementService.onEnablementChanged(q=>{const Q=[],ie=[];for(const oe of q)this._safeInvokeIsEnabled(oe)?Q.push(oe):ie.push(oe);Ll&&this._logService.info(`AbstractExtensionService.onEnablementChanged fired for ${q.map(oe=>oe.identifier.id).join(", ")}`),this._handleDeltaExtensions(new qf(Q,ie))})),this._register(this._extensionManagementService.onDidChangeProfile(({added:q,removed:Q})=>{(q.length||Q.length)&&(Ll&&this._logService.info("AbstractExtensionService.onDidChangeProfile fired"),this._handleDeltaExtensions(new qf(q,Q)))})),this._register(this._extensionManagementService.onDidEnableExtensions(q=>{q.length&&(Ll&&this._logService.info("AbstractExtensionService.onDidEnableExtensions fired"),this._handleDeltaExtensions(new qf(q,[])))})),this._register(this._extensionManagementService.onDidInstallExtensions(q=>{const Q=[];for(const{local:ie,operation:oe}of q)ie&&ie.isValid&&oe!==rne.Migrate&&this._safeInvokeIsEnabled(ie)&&Q.push(ie);Q.length&&(Ll&&this._logService.info(`AbstractExtensionService.onDidInstallExtensions fired for ${Q.map(ie=>ie.identifier.id).join(", ")}`),this._handleDeltaExtensions(new qf(Q,[])))})),this._register(this._extensionManagementService.onDidUninstallExtension(q=>{q.error||(Ll&&this._logService.info(`AbstractExtensionService.onDidUninstallExtension fired for ${q.identifier.id}`),this._handleDeltaExtensions(new qf([],[q.identifier.id])))})),this._register(this._lifecycleService.onWillShutdown(q=>{this._remoteAgentService.getConnection()?q.join(async()=>{try{await this._remoteAgentService.endConnection(),await this._doStopExtensionHosts(),this._remoteAgentService.getConnection()?.dispose()}catch{this._logService.warn("Error while disconnecting remote agent")}},{id:"join.disconnectRemote",label:h(12294,"Disconnect Remote Agent"),order:$me.Last}):q.join(this._doStopExtensionHosts(),{id:"join.stopExtensionHosts",label:h(12295,"Stopping Extension Hosts")})}))}_getExtensionHostManagers(e){return this._extensionHostManagers.getByKind(e)}async _handleDeltaExtensions(e){if(this._deltaExtensionsQueue.push(e),this._inHandleDeltaExtensions)return;let t=null;try{for(this._inHandleDeltaExtensions=!0,await this._installedExtensionsReady.wait(),t=await this._registry.acquireLock("handleDeltaExtensions");this._deltaExtensionsQueue.length>0;){const i=this._deltaExtensionsQueue.shift();await this._deltaExtensions(t,i.toAdd,i.toRemove)}}finally{this._inHandleDeltaExtensions=!1,t?.dispose()}}async _deltaExtensions(e,t,i){Ll&&this._logService.info(`AbstractExtensionService._deltaExtensions: toAdd: [${t.map(a=>a.identifier.id).join(",")}] toRemove: [${i.map(a=>typeof a=="string"?a:a.identifier.id).join(",")}]`);let n=[];for(let a=0,c=i.length;a<c;a++){const d=i[a],l=typeof d=="string"?d:d.identifier.id,u=typeof d=="string"?null:d,g=this._registry.getExtensionDescription(l);g&&(u&&g.extensionLocation.scheme!==u.location.scheme||this.canRemoveExtension(g)&&n.push(g))}const o=[];for(let a=0,c=t.length;a<c;a++){const d=t[a],l=Dk(d,!1);l&&this._canAddExtension(l,n)&&o.push(l)}if(o.length===0&&n.length===0)return;const r=this._registry.deltaExtensions(e,o,n.map(a=>a.identifier));this._onDidChangeExtensions.fire({added:o,removed:n}),n=n.concat(r.removedDueToLooping),r.removedDueToLooping.length>0&&this._notificationService.notify({severity:Fe.Error,message:h(12296,"The following extensions contain dependency loops and have been disabled: {0}",r.removedDueToLooping.map(a=>`'${a.identifier.value}'`).join(", "))}),this._extensionsProposedApi.updateEnabledApiProposals(o),this._doHandleExtensionPoints([].concat(o).concat(n),!1),await this._updateExtensionsOnExtHosts(r.versionId,o,n.map(a=>a.identifier));for(let a=0;a<o.length;a++)this._activateAddedExtensionIfNeeded(o[a])}async _updateExtensionsOnExtHosts(e,t,i){const n=this._runningLocations.deltaExtensions(t,i),o=this._extensionHostManagers.map(r=>this._updateExtensionsOnExtHost(r,e,t,i,n));await Promise.all(o)}async _updateExtensionsOnExtHost(e,t,i,n,o){const r=this._runningLocations.filterByExtensionHostManager(i,e),a=kAe(n,o,d=>e.representsRunningLocation(d)),c=ane.createActivationEventsMap(i);if(Ll){const d=u=>u.map(g=>g.identifier.value).join(","),l=u=>u.map(g=>g.value).join(",");this._logService.info(`AbstractExtensionService: Calling deltaExtensions: toRemove: [${l(n)}], toAdd: [${d(i)}], myToRemove: [${l(a)}], myToAdd: [${d(r)}],`)}await e.deltaExtensions({versionId:t,toRemove:n,toAdd:i,addActivationEvents:c,myToRemove:a,myToAdd:r.map(d=>d.identifier)})}canAddExtension(e){return this._canAddExtension(e,[])}_canAddExtension(e,t){if(this._registry.getExtensionDescriptionByIdOrUUID(e.identifier,e.id)&&!t.some(c=>vs.equals(e.identifier,c.identifier)))return!1;const n=this._runningLocations.readExtensionKinds(e),o=e.extensionLocation.scheme===ae.vscodeRemote;return this._extensionHostKindPicker.pickExtensionHostKind(e.identifier,n,!o,o,ea.None)!==null}canRemoveExtension(e){const t=this._registry.getExtensionDescription(e.identifier);return!(!t||this._extensionStatus.get(t.identifier)?.activationStarted)}async _activateAddedExtensionIfNeeded(e){let t=!1,i=null,n=!1;const o=this._activationEventReader.readActivationEvents(e);for(const r of o){if(this._allRequestedActivateEvents.has(r)){t=!0,i=r;break}if(r==="*"){t=!0,i=r;break}if(/^workspaceContains/.test(r)&&(n=!0),r==="onStartupFinished"){t=!0,i=r;break}}if(t)await Promise.all(this._extensionHostManagers.map(r=>r.activate(e.identifier,{startup:!1,extensionId:e.identifier,activationEvent:i}))).then(()=>{});else if(n){const r=await this._contextService.getCompleteWorkspace(),a=!!this._environmentService.remoteAuthority,c={logService:this._logService,folders:r.folders.map(l=>l.uri),forceUsingSearch:a,exists:l=>this._fileService.exists(l),checkExists:(l,u,g)=>this._instantiationService.invokeFunction(m=>Nce(m,l,u,g))},d=await ATe(c,e);if(!d)return;await Promise.all(this._extensionHostManagers.map(l=>l.activate(e.identifier,{startup:!1,extensionId:e.identifier,activationEvent:d.activationEvent}))).then(()=>{})}}async _initialize(){dr("code/willLoadExtensions"),this._startExtensionHostsIfNecessary(!0,[]);const e=await this._registry.acquireLock("_initialize");try{await this._resolveAndProcessExtensions(e);const t=this._registry.getSnapshot();for(const i of this._extensionHostManagers)if(i.startup!==uh.EagerAutoStart){const n=this._runningLocations.filterByExtensionHostManager(t.extensions,i);i.start(t.versionId,t.extensions,n.map(o=>o.identifier))}}finally{e.dispose()}this._releaseBarrier(),dr("code/didLoadExtensions"),await this._handleExtensionTests()}async _resolveAndProcessExtensions(e){let t=[],i=[],n=[];for await(const u of this._resolveExtensions())u instanceof zce&&(t=Qk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,u.extensions,!1),this._registry.deltaExtensions(e,t,[]),this._doHandleExtensionPoints(t,!0)),u instanceof qce&&(i=Qk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,u.extensions,!1)),u instanceof Kce&&(n=Qk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,u.extensions,!1));this._runningLocations.initializeRunningLocation(i,n),this._startExtensionHostsIfNecessary(!0,[]);const o=this._allowRemoteExtensionsInLocalWebWorker?this._runningLocations.filterByExtensionHostKind(n,Ft.LocalWebWorker):[],r=this._hasLocalProcess?this._runningLocations.filterByExtensionHostKind(i,Ft.LocalProcess):[],a=this._runningLocations.filterByExtensionHostKind(i,Ft.LocalWebWorker);n=this._runningLocations.filterByExtensionHostKind(n,Ft.Remote);for(const u of o)MAe(a,u.identifier)||a.push(u);const c=n.concat(r).concat(a);let d=c;if(t.length&&(d=c.filter(u=>!t.some(g=>vs.equals(g.identifier,u.identifier)&&g.extensionLocation.toString()===u.extensionLocation.toString())),c.length<d.length+t.length)){const u=t.filter(g=>!c.some(m=>vs.equals(m.identifier,g.identifier)&&m.extensionLocation.toString()===g.extensionLocation.toString()));u.length&&(this._registry.deltaExtensions(e,[],u.map(g=>g.identifier)),this._doHandleExtensionPoints(u,!0))}const l=this._registry.deltaExtensions(e,d,[]);l.removedDueToLooping.length>0&&this._notificationService.notify({severity:Fe.Error,message:h(12296,"The following extensions contain dependency loops and have been disabled: {0}",l.removedDueToLooping.map(u=>`'${u.identifier.value}'`).join(", "))}),this._doHandleExtensionPoints(this._registry.getAllExtensionDescriptions(),!1)}async _handleExtensionTests(){if(!this._environmentService.isExtensionDevelopment||!this._environmentService.extensionTestsLocationURI)return;const e=this.findTestExtensionHost(this._environmentService.extensionTestsLocationURI);if(!e){const i=h(12297,"No extension host found that can launch the test runner at {0}.",this._environmentService.extensionTestsLocationURI.toString());console.error(i),this._notificationService.error(i);return}let t;try{t=await e.extensionTestsExecute(),Ll&&this._logService.info(`Extension host test runner exit code: ${t}`)}catch(i){Ll&&this._logService.error("Extension host test runner error",i),console.error(i),t=1}this._onExtensionHostExit(t)}findTestExtensionHost(e){let t=null;for(const i of this._registry.getAllExtensionDescriptions())if(od(e,i.extensionLocation)){t=this._runningLocations.getRunningLocation(i.identifier);break}return t===null&&(e.scheme===ae.vscodeRemote?t=new BR:t=new WR(0)),t!==null?this._extensionHostManagers.getByRunningLocation(t):null}_releaseBarrier(){this._installedExtensionsReady.open(),this._onDidRegisterExtensions.fire(void 0),this._onDidChangeExtensionsStatus.fire(this._registry.getAllExtensionDescriptions().map(e=>e.identifier))}async _resolveAuthorityInitial(e){for(let i=1;;i++)try{return this._resolveAuthorityWithLogging(e)}catch(n){if(fp.isNoResolverFound(n)||fp.isNotAvailable(n)||i>=5)throw n}}async _resolveAuthorityAgain(){const e=this._environmentService.remoteAuthority;if(e){this._remoteAuthorityResolverService._clearResolvedAuthority(e);try{const t=await this._resolveAuthorityWithLogging(e);this._remoteAuthorityResolverService._setResolvedAuthority(t.authority,t.options)}catch(t){this._remoteAuthorityResolverService._setResolvedAuthorityError(e,t)}}}async _resolveAuthorityWithLogging(e){const t=Toe(e),i=Xn.create(!1);this._logService.info(`Invoking resolveAuthority(${t})...`);try{dr(`code/willResolveAuthority/${t}`);const n=await this._resolveAuthority(e);return dr(`code/didResolveAuthorityOK/${t}`),this._logService.info(`resolveAuthority(${t}) returned '${n.authority.connectTo}' after ${i.elapsed()} ms`),n}catch(n){throw dr(`code/didResolveAuthorityError/${t}`),this._logService.error(`resolveAuthority(${t}) returned an error after ${i.elapsed()} ms`,n),n}}async _resolveAuthorityOnExtensionHosts(e,t){const i=this._getExtensionHostManagers(e);if(i.length===0)throw new Error("Cannot resolve authority");this._resolveAuthorityAttempt++;const n=await Promise.all(i.map(r=>r.resolveAuthority(t,this._resolveAuthorityAttempt)));let o=null;for(const r of n){if(r.type==="ok")return r.value;if(!o){o=r;continue}const a=o.error.code===mr.Unknown,c=r.error.code===mr.Unknown;a&&!c&&(o=r)}throw new fp(o.error.message,o.error.code,o.error.detail)}stopExtensionHosts(e,t){return this._doStopExtensionHostsWithVeto(e,t)}async _doStopExtensionHosts(){const e=[];for(const t of this._extensionStatus.values())t.activationStarted&&e.push(t.id);await this._extensionHostManagers.stopAllInReverse();for(const t of this._extensionStatus.values())t.clearRuntimeStatus();e.length>0&&this._onDidChangeExtensionsStatus.fire(e)}async _doStopExtensionHostsWithVeto(e,t=!1){if(t&&this._environmentService.isExtensionDevelopment)return!1;const i=[],n=new Set;this._onWillStop.fire({reason:e,auto:t,veto(r,a){i.push(r),typeof r=="boolean"?r===!0&&n.add(a):r.then(c=>{c&&n.add(a)}).catch(c=>{n.add(h(12298,"{0} (Error: {1})",a,bo(c)))})}});const o=await SAe(i,r=>this._logService.error(r));if(!o)await this._doStopExtensionHosts();else if(!t){const r=Array.from(n);this._logService.warn(`Extension host was not stopped because of veto (stop reason: ${e}, veto reason: ${r.join(", ")})`);const{confirmed:a}=await this._dialogService.confirm({type:Fe.Warning,message:h(12299,"Please confirm restart of extensions."),detail:r.length===1?r[0]:r.join(`
 -`),primaryButton:h(12300,"Restart Anyway")});if(a)return!0}return!o}_startExtensionHostsIfNecessary(e,t){const i=[];for(let n=0;n<=this._runningLocations.maxLocalProcessAffinity;n++)i.push(new WR(n));for(let n=0;n<=this._runningLocations.maxLocalWebWorkerAffinity;n++)i.push(new TV(n));i.push(new BR);for(const n of i){if(this._extensionHostManagers.getByRunningLocation(n))continue;const o=this._createExtensionHostManager(n,e,t);if(o){const[r,a]=o;this._extensionHostManagers.add(r,a)}}}_createExtensionHostManager(e,t,i){const n=this._extensionHostFactory.createExtensionHost(this._runningLocations,e,t);if(!n)return null;const o=this._doCreateExtensionHostManager(n,i),r=new U;return r.add(o.onDidExit(([a,c])=>this._onExtensionHostCrashOrExit(o,a,c))),r.add(o.onDidChangeResponsiveState(a=>{this._logService.info(`Extension host (${o.friendyName}) is ${a===Mm.Responsive?"responsive":"unresponsive"}.`),this._onDidChangeResponsiveChange.fire({extensionHostKind:o.kind,isResponsive:a===Mm.Responsive,getInspectListener:c=>o.getInspectPort(c)})})),[o,r]}_doCreateExtensionHostManager(e,t){const i=this._acquireInternalAPI(e);return e.startup===uh.Lazy&&t.length===0?this._instantiationService.createInstance(RV,e,i):this._instantiationService.createInstance(OR,e,t,i)}_onExtensionHostCrashOrExit(e,t,i){if(!VK(this._environmentService).isExtensionDevHost){this._onExtensionHostCrashed(e,t,i);return}this._onExtensionHostExit(t)}_onExtensionHostCrashed(e,t,i){console.error(`Extension host (${e.friendyName}) terminated unexpectedly. Code: ${t}, Signal: ${i}`),e.kind===Ft.LocalProcess?this._doStopExtensionHosts():e.kind===Ft.Remote&&(i&&this._onRemoteExtensionHostCrashed(e,i),this._extensionHostManagers.stopOne(e))}_getExtensionHostExitInfoWithTimeout(e){return new Promise((t,i)=>{const n=setTimeout(()=>{i(new Error("getExtensionHostExitInfo timed out"))},2e3);this._remoteAgentService.getExtensionHostExitInfo(e).then(o=>{clearTimeout(n),t(o)},i)})}async _onRemoteExtensionHostCrashed(e,t){try{const i=await this._getExtensionHostExitInfoWithTimeout(t);i&&this._logService.error(`Extension host (${e.friendyName}) terminated unexpectedly with code ${i.code}.`),this._logExtensionHostCrash(e),this._remoteCrashTracker.registerCrash(),this._remoteCrashTracker.shouldAutomaticallyRestart()?(this._logService.info("Automatically restarting the remote extension host."),this._notificationService.status(h(12301,"The remote extension host terminated unexpectedly. Restarting..."),{hideAfter:5e3}),this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()))):this._notificationService.prompt(Fe.Error,h(12302,"Remote Extension host terminated unexpectedly 3 times within the last 5 minutes."),[{label:h(12303,"Restart Remote Extension Host"),run:()=>{this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()))}}])}catch{}}_logExtensionHostCrash(e){const t=[];for(const i of this._extensionStatus.values())i.activationStarted&&e.containsExtension(i.id)&&t.push(i.id);t.length>0?this._logService.error(`Extension host (${e.friendyName}) terminated unexpectedly. The following extensions were running: ${t.map(i=>i.value).join(", ")}`):this._logService.error(`Extension host (${e.friendyName}) terminated unexpectedly. No extensions were activated.`)}async startExtensionHosts(e){await this._doStopExtensionHosts(),e&&await this._handleDeltaExtensions(new qf(e.toAdd,e.toRemove));const t=await this._registry.acquireLock("startExtensionHosts");try{this._startExtensionHostsIfNecessary(!1,Array.from(this._allRequestedActivateEvents.keys()));const i=this._getExtensionHostManagers(Ft.LocalProcess);await Promise.all(i.map(n=>n.ready()))}finally{t.dispose()}}activateByEvent(e,t=Op.Normal){return this._installedExtensionsReady.isOpen()?(this._allRequestedActivateEvents.add(e),this._registry.containsActivationEvent(e)?this._activateByEvent(e,t):TAe):(this._allRequestedActivateEvents.add(e),t===Op.Immediate?this._activateByEvent(e,t):this._installedExtensionsReady.wait().then(()=>this._activateByEvent(e,t)))}_activateByEvent(e,t){const i=Promise.all(this._extensionHostManagers.map(n=>n.activateByEvent(e,t))).then(()=>{});return this._onWillActivateByEvent.fire({event:e,activation:i}),i}activateById(e,t){return this._activateById(e,t)}activationEventIsDone(e){return this._installedExtensionsReady.isOpen()?this._registry.containsActivationEvent(e)?this._extensionHostManagers.every(t=>t.activationEventIsDone(e)):!0:!1}whenInstalledExtensionsRegistered(){return this._installedExtensionsReady.wait()}get extensions(){return this._registry.getAllExtensionDescriptions()}_getExtensionRegistrySnapshotWhenReady(){return this._installedExtensionsReady.wait().then(()=>this._registry.getSnapshot())}getExtension(e){return this._installedExtensionsReady.wait().then(()=>this._registry.getExtensionDescription(e))}readExtensionPointContributions(e){return this._installedExtensionsReady.wait().then(()=>{const t=this._registry.getAllExtensionDescriptions(),i=[];for(const n of t)n.contributes&&E1.call(n.contributes,e.name)&&i.push(new Gme(n,n.contributes[e.name]));return i})}getExtensionsStatus(){const e=Object.create(null);if(this._registry){const t=this._registry.getAllExtensionDescriptions();for(const i of t){const n=this._extensionStatus.get(i.identifier);e[i.identifier.value]={id:i.identifier,messages:n?.messages??[],activationStarted:n?.activationStarted??!1,activationTimes:n?.activationTimes??void 0,runtimeErrors:n?.runtimeErrors??[],runningLocation:this._runningLocations.getRunningLocation(i.identifier)}}}return e}async getInspectPorts(e,t){return(await Promise.all(this._getExtensionHostManagers(e).map(n=>n.getInspectPort(t)))).filter(wa)}async setRemoteEnvironment(e){await this._extensionHostManagers.map(t=>t.setRemoteEnvironment(e))}_safeInvokeIsEnabled(e){try{return this._extensionEnablementService.isEnabled(e)}catch{return!1}}_doHandleExtensionPoints(e,t){const i=Object.create(null);for(const a of e)if(a.contributes)for(const c in a.contributes)E1.call(a.contributes,c)&&(i[c]=!0);const n=a=>this._handleExtensionPointMessage(a),o=this._registry.getAllExtensionDescriptions(),r=gl.getExtensionPoints();dr(t?"code/willHandleResolverExtensionPoints":"code/willHandleExtensionPoints");for(const a of r)i[a.name]&&(!t||a.canHandleResolver)&&(dr(`code/willHandleExtensionPoint/${a.name}`),PV._handleExtensionPoint(a,o,n),dr(`code/didHandleExtensionPoint/${a.name}`));dr(t?"code/didHandleResolverExtensionPoints":"code/didHandleExtensionPoints")}_getOrCreateExtensionStatus(e){return this._extensionStatus.has(e)||this._extensionStatus.set(e,new NAe(e)),this._extensionStatus.get(e)}_handleExtensionPointMessage(e){this._getOrCreateExtensionStatus(e.extensionId).addMessage(e);const i=this._registry.getExtensionDescription(e.extensionId),n=`[${e.extensionId.value}]: ${e.message}`;if(e.type===Fe.Error?(i&&i.isUnderDevelopment&&this._notificationService.notify({severity:Fe.Error,message:n}),this._logService.error(n)):e.type===Fe.Warning?(i&&i.isUnderDevelopment&&this._notificationService.notify({severity:Fe.Warning,message:n}),this._logService.warn(n)):this._logService.info(n),e.extensionId&&this._environmentService.isBuilt&&!this._environmentService.isExtensionDevelopment){const{type:o,extensionId:r,extensionPointId:a,message:c}=e;this._telemetryService.publicLog2("extensionsMessage",{type:o,extensionId:r.value,extensionPointId:a,message:c})}}static _handleExtensionPoint(e,t,i){const n=[];for(const o of t)o.contributes&&E1.call(o.contributes,e.name)&&n.push({description:o,value:o.contributes[e.name],collector:new zme(i,o,e.name)});e.acceptUsers(n)}_acquireInternalAPI(e){return{_activateById:(t,i)=>this._activateById(t,i),_onWillActivateExtension:t=>this._onWillActivateExtension(t,e.runningLocation),_onDidActivateExtension:(t,i,n,o,r)=>this._onDidActivateExtension(t,i,n,o,r),_onDidActivateExtensionError:(t,i)=>this._onDidActivateExtensionError(t,i),_onExtensionRuntimeError:(t,i)=>this._onExtensionRuntimeError(t,i)}}async _activateById(e,t){if(!(await Promise.all(this._extensionHostManagers.map(o=>o.activate(e,t)))).some(o=>o))throw new Error(`Unknown extension ${e.value}`)}_onWillActivateExtension(e,t){this._runningLocations.set(e,t),this._getOrCreateExtensionStatus(e).onWillActivate()}_onDidActivateExtension(e,t,i,n,o){this._getOrCreateExtensionStatus(e).setActivationTimes(new qme(t,i,n,o)),this._onDidChangeExtensionsStatus.fire([e])}_onDidActivateExtensionError(e,t){this._telemetryService.publicLog2("extensionActivationError",{extensionId:e.value,error:t.message})}_onExtensionRuntimeError(e,t){this._getOrCreateExtensionStatus(e).addRuntimeError(t),this._onDidChangeExtensionsStatus.fire([e])}};LV=PV=f([p(4,Z),p(5,Dt),p(6,wn),p(7,ai),p(8,gd),p(9,je),p(10,Vn),p(11,WN),p(12,It),p(13,ne),p(14,Kv),p(15,Re),p(16,Lh),p(17,DN),p(18,wd),p(19,Wh),p(20,ei)],LV);class AAe extends F{constructor(){super(...arguments),this._extensionHostManagers=[]}dispose(){for(let e=this._extensionHostManagers.length-1;e>=0;e--){const t=this._extensionHostManagers[e];t.extensionHost.disconnect(),t.dispose()}this._extensionHostManagers=[],super.dispose()}add(e,t){this._extensionHostManagers.push(new RAe(e,t))}async stopAllInReverse(){for(let e=this._extensionHostManagers.length-1;e>=0;e--){const t=this._extensionHostManagers[e];await t.extensionHost.disconnect(),t.dispose()}this._extensionHostManagers=[]}async stopOne(e){const t=this._extensionHostManagers.findIndex(i=>i.extensionHost===e);t>=0&&(this._extensionHostManagers.splice(t,1),await e.disconnect(),e.dispose())}getByKind(e){return this.filter(t=>t.kind===e)}getByRunningLocation(e){for(const t of this._extensionHostManagers)if(t.extensionHost.representsRunningLocation(e))return t.extensionHost;return null}*[Symbol.iterator](){for(const e of this._extensionHostManagers)yield e.extensionHost}map(e){return this._extensionHostManagers.map(t=>e(t.extensionHost))}every(e){return this._extensionHostManagers.every(t=>e(t.extensionHost))}filter(e){return this._extensionHostManagers.filter(t=>e(t.extensionHost)).map(t=>t.extensionHost)}}class RAe{constructor(e,t){this.extensionHost=e,this.disposableStore=t}dispose(){this.disposableStore.dispose(),this.extensionHost.dispose()}}class zce{constructor(e){this.extensions=e}}class qce{constructor(e){this.extensions=e}}class Kce{constructor(e){this.extensions=e}}class qf{constructor(e,t){this.toAdd=e,this.toRemove=t}}function PAe(s){return!!s.activationEvents?.some(e=>e.startsWith("onResolveRemoteAuthority:"))}function Qk(s,e,t,i,n){return t.updateEnabledApiProposals(i),LAe(s,e,i,n)}function LAe(s,e,t,i){const n=[],o=[],r=[];for(const c of t)c.isUnderDevelopment?n.push(c):(o.push(c),r.push(cne(c)));const a=e.getEnablementStates(r,i?{trusted:!0}:void 0);for(let c=0;c<a.length;c++)e.isEnabledEnablementState(a[c])?n.push(o[c]):Ll&&s.info(`filterEnabledExtensions: extension '${o[c].identifier.value}' is disabled`);return n}function MAe(s,e){for(const t of s)if(vs.equals(t.identifier,e))return!0;return!1}class NAe{get messages(){return this._messages}get activationTimes(){return this._activationTimes}get runtimeErrors(){return this._runtimeErrors}get activationStarted(){return this._activationStarted}constructor(e){this.id=e,this._messages=[],this._activationTimes=null,this._runtimeErrors=[],this._activationStarted=!1}clearRuntimeStatus(){this._activationStarted=!1,this._activationTimes=null,this._runtimeErrors=[]}addMessage(e){this._messages.push(e)}setActivationTimes(e){this._activationTimes=e}addRuntimeError(e){this._runtimeErrors.push(e)}onWillActivate(){this._activationStarted=!0}}class VR{constructor(){this._recentCrashes=[]}static{this._TIME_LIMIT=5*60*1e3}static{this._CRASH_LIMIT=3}_removeOldCrashes(){const e=Date.now()-VR._TIME_LIMIT;for(;this._recentCrashes.length>0&&this._recentCrashes[0].timestamp<e;)this._recentCrashes.shift()}registerCrash(){this._removeOldCrashes(),this._recentCrashes.push({timestamp:Date.now()})}shouldAutomaticallyRestart(){return this._removeOldCrashes(),this._recentCrashes.length<VR._CRASH_LIMIT}}class OAe{readActivationEvents(e){return ane.readActivationEvents(e)}}class FAe extends F{constructor(){super(...arguments),this.type="markdown"}shouldRender(e){return!!e.activationEvents}render(e){const t=e.activationEvents||[],i=new Gi;if(t.length)for(const n of t)i.appendMarkdown(`- \`${n}\`
`);return{data:i,dispose:()=>{}}}}Ke.as(Ew.ExtensionFeaturesRegistry).registerExtensionFeature({id:"activationEvents",label:h(12304,"Activation Events"),access:{canToggle:!1},renderer:new Sr(FAe)});const WAe="security.workspace.trust.enabled",JQ="security.workspace.trust.untrustedFiles",BAe="security.workspace.trust.emptyWindow",VAe="extensions.supportUntrustedWorkspaces",HAe="content.trust.model.key";class UAe{constructor(e,t,i){this.originalWorkspace=e,this.canonicalFolderUris=t,this.canonicalConfiguration=i}get folders(){return this.originalWorkspace.folders.map((e,t)=>({index:e.index,name:e.name,toResource:e.toResource,uri:this.canonicalFolderUris[t]}))}get transient(){return this.originalWorkspace.transient}get configuration(){return this.canonicalConfiguration??this.originalWorkspace.configuration}get id(){return this.originalWorkspace.id}}let eX=class extends F{constructor(e,t){super(),this.configurationService=e,this.environmentService=t}isWorkspaceTrustEnabled(){return this.environmentService.disableWorkspaceTrust?!1:!!this.configurationService.getValue(WAe)}};eX=f([p(0,ne),p(1,wn)],eX);let tX=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this.configurationService=e,this.remoteAuthorityResolverService=t,this.storageService=i,this.uriIdentityService=n,this.environmentService=o,this.workspaceService=r,this.workspaceTrustEnablementService=a,this.fileService=c,this.storageKey=HAe,this._onDidChangeTrust=this._register(new M),this.onDidChangeTrust=this._onDidChangeTrust.event,this._onDidChangeTrustedFolders=this._register(new M),this.onDidChangeTrustedFolders=this._onDidChangeTrustedFolders.event,this._canonicalStartupFiles=[],this._canonicalUrisResolved=!1,this._canonicalWorkspace=this.workspaceService.getWorkspace(),{promise:this._workspaceResolvedPromise,resolve:this._workspaceResolvedPromiseResolve}=xE(),{promise:this._workspaceTrustInitializedPromise,resolve:this._workspaceTrustInitializedPromiseResolve}=xE(),this._storedTrustState=new GAe(Kt&&this.isEmptyWorkspace()?void 0:this.storageService),this._trustTransitionManager=this._register(new $Ae),this._trustStateInfo=this.loadTrustInfo(),this._isTrusted=this.calculateWorkspaceTrust(),this.initializeWorkspaceTrust(),this.registerListeners()}initializeWorkspaceTrust(){this.resolveCanonicalUris().then(async()=>{this._canonicalUrisResolved=!0,await this.updateWorkspaceTrust()}).finally(()=>{this._workspaceResolvedPromiseResolve(),this.environmentService.remoteAuthority||this._workspaceTrustInitializedPromiseResolve()}),this.environmentService.remoteAuthority&&this.remoteAuthorityResolverService.resolveAuthority(this.environmentService.remoteAuthority).then(async e=>{this._remoteAuthority=e,await this.fileService.activateProvider(ae.vscodeRemote),await this.updateWorkspaceTrust()}).finally(()=>{this._workspaceTrustInitializedPromiseResolve()}),this.isEmptyWorkspace()&&this._workspaceTrustInitializedPromise.then(()=>{this._storedTrustState.isEmptyWorkspaceTrusted===void 0&&(this._storedTrustState.isEmptyWorkspaceTrusted=this.isWorkspaceTrusted())})}registerListeners(){this._register(this.workspaceService.onDidChangeWorkspaceFolders(async()=>await this.updateWorkspaceTrust())),this._register(this.storageService.onDidChangeValue(he.APPLICATION,this.storageKey,this._store)(async()=>{JSON.stringify(this._trustStateInfo)!==JSON.stringify(this.loadTrustInfo())&&(this._trustStateInfo=this.loadTrustInfo(),this._onDidChangeTrustedFolders.fire(),await this.updateWorkspaceTrust())}))}async getCanonicalUri(e){let t=e;if(this.environmentService.remoteAuthority&&e.scheme===ae.vscodeRemote)t=await this.remoteAuthorityResolverService.getCanonicalURI(e);else if(e.scheme==="vscode-vfs"){const i=e.authority.indexOf("+");i!==-1&&(t=e.with({authority:e.authority.substr(0,i)}))}return t.with({query:null,fragment:null})}async resolveCanonicalUris(){const e=[];if(this.environmentService.filesToOpenOrCreate&&e.push(...this.environmentService.filesToOpenOrCreate),this.environmentService.filesToDiff&&e.push(...this.environmentService.filesToDiff),this.environmentService.filesToMerge&&e.push(...this.environmentService.filesToMerge),e.length){const o=e.filter(a=>!!a.fileUri).map(a=>a.fileUri),r=await Promise.all(o.map(a=>this.getCanonicalUri(a)));this._canonicalStartupFiles.push(...r.filter(a=>this._canonicalStartupFiles.every(c=>!this.uriIdentityService.extUri.isEqual(a,c))))}const t=this.workspaceService.getWorkspace().folders.map(o=>o.uri),i=await Promise.all(t.map(o=>this.getCanonicalUri(o)));let n=this.workspaceService.getWorkspace().configuration;n&&W6(n,this.environmentService)&&(n=await this.getCanonicalUri(n)),this._canonicalWorkspace=new UAe(this.workspaceService.getWorkspace(),i,n)}loadTrustInfo(){const e=this.storageService.get(this.storageKey,he.APPLICATION);let t;try{e&&(t=JSON.parse(e))}catch{}return t||(t={uriTrustInfo:[]}),t.uriTrustInfo||(t.uriTrustInfo=[]),t.uriTrustInfo=t.uriTrustInfo.map(i=>({uri:R.revive(i.uri),trusted:i.trusted})),t.uriTrustInfo=t.uriTrustInfo.filter(i=>i.trusted),t}async saveTrustInfo(){this.storageService.store(this.storageKey,JSON.stringify(this._trustStateInfo),he.APPLICATION,gt.MACHINE),this._onDidChangeTrustedFolders.fire(),await this.updateWorkspaceTrust()}getWorkspaceUris(){const e=this._canonicalWorkspace.folders.map(i=>i.uri),t=this._canonicalWorkspace.configuration;return t&&W6(t,this.environmentService)&&e.push(t),e}calculateWorkspaceTrust(){return this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()?this._canonicalUrisResolved?this.environmentService.remoteAuthority&&this._remoteAuthority?.options?.isTrusted?this._remoteAuthority.options.isTrusted:this.isEmptyWorkspace()?this._storedTrustState.isEmptyWorkspaceTrusted!==void 0?this._storedTrustState.isEmptyWorkspaceTrusted:this._canonicalStartupFiles.length?this.getUrisTrust(this._canonicalStartupFiles):!!this.configurationService.getValue(BAe):this.getUrisTrust(this.getWorkspaceUris()):!1:!0}async updateWorkspaceTrust(e){this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()&&(e===void 0&&(await this.resolveCanonicalUris(),e=this.calculateWorkspaceTrust()),this.isWorkspaceTrusted()!==e&&(this.isTrusted=e,await this._trustTransitionManager.participate(e),this._onDidChangeTrust.fire(e)))}getUrisTrust(e){let t=!0;for(const i of e){const{trusted:n}=this.doGetUriTrustInfo(i);if(!n)return t=n,t}return t}doGetUriTrustInfo(e){if(!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled())return{trusted:!0,uri:e};if(this.isTrustedVirtualResource(e))return{trusted:!0,uri:e};if(this.isTrustedByRemote(e))return{trusted:!0,uri:e};let t=!1,i=-1,n=e;for(const o of this._trustStateInfo.uriTrustInfo)if(this.uriIdentityService.extUri.isEqualOrParent(e,o.uri)){const r=o.uri.fsPath;r.length>i&&(i=r.length,t=o.trusted,n=o.uri)}return{trusted:t,uri:n}}async doSetUrisTrust(e,t){let i=!1;for(const n of e)if(t){if(this.isTrustedVirtualResource(n)||this.isTrustedByRemote(n))continue;this._trustStateInfo.uriTrustInfo.find(r=>this.uriIdentityService.extUri.isEqual(r.uri,n))||(this._trustStateInfo.uriTrustInfo.push({uri:n,trusted:!0}),i=!0)}else{const o=this._trustStateInfo.uriTrustInfo.length;this._trustStateInfo.uriTrustInfo=this._trustStateInfo.uriTrustInfo.filter(r=>!this.uriIdentityService.extUri.isEqual(r.uri,n)),o!==this._trustStateInfo.uriTrustInfo.length&&(i=!0)}i&&await this.saveTrustInfo()}isEmptyWorkspace(){if(this.workspaceService.getWorkbenchState()===Zo.EMPTY)return!0;const e=this.workspaceService.getWorkspace();return e?qM(this.workspaceService.getWorkspace())&&e.folders.length===0:!1}isTrustedVirtualResource(e){return Kme(e)&&e.scheme!=="vscode-vfs"}isTrustedByRemote(e){return!this.environmentService.remoteAuthority||!this._remoteAuthority?!1:TF(jme(e),this._remoteAuthority.authority.authority)&&!!this._remoteAuthority.options?.isTrusted}set isTrusted(e){this._isTrusted=e,e||(this._storedTrustState.acceptsOutOfWorkspaceFiles=!1),this.isEmptyWorkspace()&&(this._storedTrustState.isEmptyWorkspaceTrusted=e)}get workspaceResolved(){return this._workspaceResolvedPromise}get workspaceTrustInitialized(){return this._workspaceTrustInitializedPromise}get acceptsOutOfWorkspaceFiles(){return this._storedTrustState.acceptsOutOfWorkspaceFiles}set acceptsOutOfWorkspaceFiles(e){this._storedTrustState.acceptsOutOfWorkspaceFiles=e}isWorkspaceTrusted(){return this._isTrusted}isWorkspaceTrustForced(){return!!(this.environmentService.remoteAuthority&&this._remoteAuthority&&this._remoteAuthority.options?.isTrusted!==void 0||this.getWorkspaceUris().filter(t=>!this.isTrustedVirtualResource(t)).length===0)}canSetParentFolderTrust(){const e=hC(this._canonicalWorkspace);if(!IE(e)||e.uri.scheme!==ae.file&&e.uri.scheme!==ae.vscodeRemote)return!1;const t=this.uriIdentityService.extUri.dirname(e.uri);return!this.uriIdentityService.extUri.isEqual(e.uri,t)}async setParentFolderTrust(e){if(this.canSetParentFolderTrust()){const t=hC(this._canonicalWorkspace).uri,i=this.uriIdentityService.extUri.dirname(t);await this.setUrisTrust([i],e)}}canSetWorkspaceTrust(){if(this.environmentService.remoteAuthority&&(!this._remoteAuthority||this._remoteAuthority.options?.isTrusted!==void 0))return!1;if(this.isEmptyWorkspace())return!0;if(this.getWorkspaceUris().filter(n=>!this.isTrustedVirtualResource(n)).length===0)return!1;if(!this.isWorkspaceTrusted())return!0;const t=hC(this._canonicalWorkspace);if(!IE(t)||t.uri.scheme!==ae.file&&t.uri.scheme!=="vscode-vfs")return!1;const i=this.doGetUriTrustInfo(t.uri);if(!i.trusted||!this.uriIdentityService.extUri.isEqual(t.uri,i.uri))return!1;if(this.canSetParentFolderTrust()){const n=this.uriIdentityService.extUri.dirname(t.uri);if(this.doGetUriTrustInfo(n).trusted)return!1}return!0}async setWorkspaceTrust(e){if(this.isEmptyWorkspace()){await this.updateWorkspaceTrust(e);return}const t=this.getWorkspaceUris();await this.setUrisTrust(t,e)}async getUriTrustInfo(e){return this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()?this.isTrustedByRemote(e)?{trusted:!0,uri:e}:this.doGetUriTrustInfo(await this.getCanonicalUri(e)):{trusted:!0,uri:e}}async setUrisTrust(e,t){this.doSetUrisTrust(await Promise.all(e.map(i=>this.getCanonicalUri(i))),t)}getTrustedUris(){return this._trustStateInfo.uriTrustInfo.map(e=>e.uri)}async setTrustedUris(e){this._trustStateInfo.uriTrustInfo=[];for(const t of e){const i=await this.getCanonicalUri(t),n=this.uriIdentityService.extUri.removeTrailingPathSeparator(i);let o=!1;for(const r of this._trustStateInfo.uriTrustInfo)if(this.uriIdentityService.extUri.isEqual(r.uri,n)){o=!0;break}o||this._trustStateInfo.uriTrustInfo.push({trusted:!0,uri:n})}await this.saveTrustInfo()}addWorkspaceTrustTransitionParticipant(e){return this._trustTransitionManager.addWorkspaceTrustTransitionParticipant(e)}};tX=f([p(0,ne),p(1,Wh),p(2,it),p(3,nn),p(4,wn),p(5,It),p(6,Tz),p(7,je)],tX);let iX=class extends F{constructor(e,t){super(),this.configurationService=e,this.workspaceTrustManagementService=t,this._onDidInitiateOpenFilesTrustRequest=this._register(new M),this.onDidInitiateOpenFilesTrustRequest=this._onDidInitiateOpenFilesTrustRequest.event,this._onDidInitiateWorkspaceTrustRequest=this._register(new M),this.onDidInitiateWorkspaceTrustRequest=this._onDidInitiateWorkspaceTrustRequest.event,this._onDidInitiateWorkspaceTrustRequestOnStartup=this._register(new M),this.onDidInitiateWorkspaceTrustRequestOnStartup=this._onDidInitiateWorkspaceTrustRequestOnStartup.event}get untrustedFilesSetting(){return this.configurationService.getValue(JQ)}set untrustedFilesSetting(e){this.configurationService.updateValue(JQ,e)}async completeOpenFilesTrustRequest(e,t){this._openFilesTrustRequestResolver&&(e===Hd.Open&&(this.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles=!0),t&&(e===Hd.Open&&(this.untrustedFilesSetting="open"),e===Hd.OpenInNewWindow&&(this.untrustedFilesSetting="newWindow")),this._openFilesTrustRequestResolver(e),this._openFilesTrustRequestResolver=void 0,this._openFilesTrustRequestPromise=void 0)}async requestOpenFilesTrust(e){if(!this.workspaceTrustManagementService.isWorkspaceTrusted()||(await Promise.all(e.map(i=>this.workspaceTrustManagementService.getUriTrustInfo(i)))).map(i=>i.trusted).every(i=>i))return Hd.Open;if(this.untrustedFilesSetting!=="prompt"){if(this.untrustedFilesSetting==="newWindow")return Hd.OpenInNewWindow;if(this.untrustedFilesSetting==="open")return Hd.Open}if(this.workspaceTrustManagementService.acceptsOutOfWorkspaceFiles)return Hd.Open;if(!this._openFilesTrustRequestPromise)this._openFilesTrustRequestPromise=new Promise(i=>{this._openFilesTrustRequestResolver=i});else return this._openFilesTrustRequestPromise;return this._onDidInitiateOpenFilesTrustRequest.fire(),this._openFilesTrustRequestPromise}resolveWorkspaceTrustRequest(e){this._workspaceTrustRequestResolver&&(this._workspaceTrustRequestResolver(e??this.workspaceTrustManagementService.isWorkspaceTrusted()),this._workspaceTrustRequestResolver=void 0,this._workspaceTrustRequestPromise=void 0)}cancelWorkspaceTrustRequest(){this._workspaceTrustRequestResolver&&(this._workspaceTrustRequestResolver(void 0),this._workspaceTrustRequestResolver=void 0,this._workspaceTrustRequestPromise=void 0)}async completeWorkspaceTrustRequest(e){if(e===void 0||e===this.workspaceTrustManagementService.isWorkspaceTrusted()){this.resolveWorkspaceTrustRequest(e);return}T.once(this.workspaceTrustManagementService.onDidChangeTrust)(t=>this.resolveWorkspaceTrustRequest(t)),await this.workspaceTrustManagementService.setWorkspaceTrust(e)}async requestWorkspaceTrust(e){if(this.workspaceTrustManagementService.isWorkspaceTrusted())return this.workspaceTrustManagementService.isWorkspaceTrusted();if(!this._workspaceTrustRequestPromise)this._workspaceTrustRequestPromise=new Promise(t=>{this._workspaceTrustRequestResolver=t});else return this._workspaceTrustRequestPromise;return this._onDidInitiateWorkspaceTrustRequest.fire(e),this._workspaceTrustRequestPromise}requestWorkspaceTrustOnStartup(){this._workspaceTrustRequestPromise||(this._workspaceTrustRequestPromise=new Promise(e=>{this._workspaceTrustRequestResolver=e})),this._onDidInitiateWorkspaceTrustRequestOnStartup.fire()}};iX=f([p(0,ne),p(1,Lv)],iX);class $Ae extends F{constructor(){super(...arguments),this.participants=new wz}addWorkspaceTrustTransitionParticipant(e){const t=this.participants.push(e);return Ie(()=>t())}async participate(e){for(const t of this.participants)await t.participate(e)}dispose(){this.participants.clear(),super.dispose()}}class GAe{constructor(e){this._acceptsOutOfWorkspaceFilesKey="acceptsOutOfWorkspaceFiles",this._isEmptyWorkspaceTrustedKey="isEmptyWorkspaceTrusted",e?(this._memento=new bw("workspaceTrust",e),this._mementoObject=this._memento.getMemento(he.WORKSPACE,gt.MACHINE)):this._mementoObject={}}get acceptsOutOfWorkspaceFiles(){return this._mementoObject[this._acceptsOutOfWorkspaceFilesKey]??!1}set acceptsOutOfWorkspaceFiles(e){this._mementoObject[this._acceptsOutOfWorkspaceFilesKey]=e,this._memento?.saveMemento()}get isEmptyWorkspaceTrusted(){return this._mementoObject[this._isEmptyWorkspaceTrustedKey]}set isEmptyWorkspaceTrusted(e){this._mementoObject[this._isEmptyWorkspaceTrustedKey]=e,this._memento?.saveMemento()}}let MV=class extends F{constructor(e,t,i,n){super(),this.productService=e,this.configurationService=t,this.workspaceTrustEnablementService=i,this.logService=n,this._extensionPointExtensionKindsMap=null,this._productExtensionKindsMap=null,this._configuredExtensionKindsMap=null,this._productVirtualWorkspaceSupportMap=null,this._configuredVirtualWorkspaceSupportMap=null,this._configuredExtensionWorkspaceTrustRequestMap=new Po;const o=t.inspect(VAe).userValue||{};for(const r of Object.keys(o))this._configuredExtensionWorkspaceTrustRequestMap.set(r,o[r]);if(this._productExtensionWorkspaceTrustRequestMap=new Map,e.extensionUntrustedWorkspaceSupport)for(const r of Object.keys(e.extensionUntrustedWorkspaceSupport))this._productExtensionWorkspaceTrustRequestMap.set(r,e.extensionUntrustedWorkspaceSupport[r])}prefersExecuteOnUI(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="ui"}prefersExecuteOnWorkspace(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="workspace"}prefersExecuteOnWeb(e){const t=this.getExtensionKind(e);return t.length>0&&t[0]==="web"}canExecuteOnUI(e){return this.getExtensionKind(e).some(i=>i==="ui")}canExecuteOnWorkspace(e){return this.getExtensionKind(e).some(i=>i==="workspace")}canExecuteOnWeb(e){return this.getExtensionKind(e).some(i=>i==="web")}getExtensionKind(e){const t=this.deduceExtensionKind(e),i=this.getConfiguredExtensionKind(e);if(i&&i.length>0){const n=[];for(const o of i)o!=="-web"&&n.push(o);return i.includes("-web")&&!n.length&&(n.push("ui"),n.push("workspace")),Kt&&!i.includes("-web")&&!i.includes("web")&&t.includes("web")&&n.push("web"),n}return t}getUserConfiguredExtensionKind(e){if(this._configuredExtensionKindsMap===null){const i=new Po,n=this.configurationService.getValue("remote.extensionKind")||{};for(const o of Object.keys(n))i.set(o,n[o]);this._configuredExtensionKindsMap=i}const t=this._configuredExtensionKindsMap.get(e.id);return t?this.toArray(t):void 0}getExtensionUntrustedWorkspaceSupportType(e){if(!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()||!e.main)return!0;const t=this.getConfiguredExtensionWorkspaceTrustRequest(e),i=this.getProductExtensionWorkspaceTrustRequest(e);return t!==void 0?t:i?.override!==void 0?i.override:e.capabilities?.untrustedWorkspaces?.supported!==void 0?e.capabilities.untrustedWorkspaces.supported:i?.default!==void 0?i.default:!1}getExtensionVirtualWorkspaceSupportType(e){const t=this.getConfiguredVirtualWorkspaceSupport(e);if(t!==void 0)return t;const i=this.getProductVirtualWorkspaceSupport(e);if(i?.override!==void 0)return i.override;const n=e.capabilities?.virtualWorkspaces;if(B6(n))return n;if(n){const o=n.supported;if(B6(o)||o==="limited")return o}return i?.default!==void 0?i.default:!0}deduceExtensionKind(e){if(e.main)return e.browser?Kt?["workspace","web"]:["workspace"]:["workspace"];if(e.browser)return["web"];let t=[...Yme];if((An(e.extensionPack)||An(e.extensionDependencies))&&(t=Kt?["workspace","web"]:["workspace"]),e.contributes)for(const i of Object.keys(e.contributes)){const n=this.getSupportedExtensionKindsForExtensionPoint(i);n.length&&(t=t.filter(o=>n.includes(o)))}return t.length||this.logService.warn("Cannot deduce extensionKind for extension",nu(e.publisher,e.name)),t}getSupportedExtensionKindsForExtensionPoint(e){if(this._extensionPointExtensionKindsMap===null){const i=new Map;gl.getExtensionPoints().forEach(n=>i.set(n.name,n.defaultExtensionKind||[])),this._extensionPointExtensionKindsMap=i}let t=this._extensionPointExtensionKindsMap.get(e);return t||(t=this.productService.extensionPointExtensionKind?this.productService.extensionPointExtensionKind[e]:void 0,t)?t:Kt?["workspace","web"]:["workspace"]}getConfiguredExtensionKind(e){const t={id:nu(e.publisher,e.name)};let i=this.getUserConfiguredExtensionKind(t);return typeof i<"u"?this.toArray(i):(i=this.getProductExtensionKind(e),typeof i<"u"?i:(i=e.extensionKind,typeof i<"u"?(i=this.toArray(i),i.filter(n=>["ui","workspace"].includes(n))):null))}getProductExtensionKind(e){if(this._productExtensionKindsMap===null){const i=new Po;if(this.productService.extensionKind)for(const n of Object.keys(this.productService.extensionKind))i.set(n,this.productService.extensionKind[n]);this._productExtensionKindsMap=i}const t=nu(e.publisher,e.name);return this._productExtensionKindsMap.get(t)}getProductVirtualWorkspaceSupport(e){if(this._productVirtualWorkspaceSupportMap===null){const i=new Po;if(this.productService.extensionVirtualWorkspacesSupport)for(const n of Object.keys(this.productService.extensionVirtualWorkspacesSupport))i.set(n,this.productService.extensionVirtualWorkspacesSupport[n]);this._productVirtualWorkspaceSupportMap=i}const t=nu(e.publisher,e.name);return this._productVirtualWorkspaceSupportMap.get(t)}getConfiguredVirtualWorkspaceSupport(e){if(this._configuredVirtualWorkspaceSupportMap===null){const i=new Po,n=this.configurationService.getValue("extensions.supportVirtualWorkspaces")||{};for(const o of Object.keys(n))n[o]!==void 0&&i.set(o,n[o]);this._configuredVirtualWorkspaceSupportMap=i}const t=nu(e.publisher,e.name);return this._configuredVirtualWorkspaceSupportMap.get(t)}getConfiguredExtensionWorkspaceTrustRequest(e){const t=nu(e.publisher,e.name),i=this._configuredExtensionWorkspaceTrustRequestMap.get(t);if(i&&(i.version===void 0||i.version===e.version))return i.supported}getProductExtensionWorkspaceTrustRequest(e){const t=nu(e.publisher,e.name);return this._productExtensionWorkspaceTrustRequestMap.get(t)}toArray(e){return Array.isArray(e)?e:e==="ui"?["ui","workspace"]:[e]}};MV=f([p(0,Vn),p(1,ne),p(2,Tz),p(3,Re)],MV);let NV=class{constructor(e,t,i){if(this._logService=e,this._environmentService=t,this._envEnabledExtensions=new Set((t.extensionEnabledProposedApi??[]).map(n=>vs.toKey(n))),this._envEnablesProposedApiForAll=!t.isBuilt||t.isExtensionDevelopment&&i.quality!=="stable"||this._envEnabledExtensions.size===0&&Array.isArray(t.extensionEnabledProposedApi),this._productEnabledExtensions=new Map,i.extensionEnabledApiProposals)for(const[n,o]of Object.entries(i.extensionEnabledApiProposals)){const r=vs.toKey(n),a=o.filter(c=>kF[c]?!0:(e.warn(`Via 'product.json#extensionEnabledApiProposals' extension '${r}' wants API proposal '${c}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`),!1));this._productEnabledExtensions.set(r,a)}}updateEnabledApiProposals(e){for(const t of e)this.doUpdateEnabledApiProposals(t)}doUpdateEnabledApiProposals(e){const t=vs.toKey(e.identifier);if(An(e.enabledApiProposals)&&(e.enabledApiProposals=e.enabledApiProposals.filter(i=>{const n=!!kF[i];return n||this._logService.error(`Extension '${t}' wants API proposal '${i}' but that proposal DOES NOT EXIST. Likely, the proposal has been finalized (check 'vscode.d.ts') or was abandoned.`),n})),this._productEnabledExtensions.has(t)){const i=this._productEnabledExtensions.get(t),n=new Set(i),o=new Set(e.enabledApiProposals),r=new Set([...o].filter(a=>!n.has(a)));r.size>0&&(this._logService.error(`Extension '${t}' appears in product.json but enables LESS API proposals than the extension wants.
package.json (LOSES): ${[...o].join(", ")}
product.json (WINS): ${[...n].join(", ")}`),this._environmentService.isExtensionDevelopment&&(this._logService.error(`Proceeding with EXTRA proposals (${[...r].join(", ")}) because extension is in development mode. Still, this EXTENSION WILL BE BROKEN unless product.json is updated.`),i.push(...r))),e.enabledApiProposals=i;return}this._envEnablesProposedApiForAll||this._envEnabledExtensions.has(t)||!e.isBuiltin&&An(e.enabledApiProposals)&&(this._logService.error(`Extension '${e.identifier.value} CANNOT USE these API proposals '${e.enabledApiProposals?.join(", ")||"*"}'. You MUST start in extension development mode or use the --enable-proposed-api command line flag`),e.enabledApiProposals=[])}};NV=f([p(0,Re),p(1,wn),p(2,Vn)],NV);class zAe extends F{constructor(){super(...arguments),this.type="markdown"}shouldRender(e){return!!e.originalEnabledApiProposals?.length||!!e.enabledApiProposals?.length}render(e){const t=e.originalEnabledApiProposals??e.enabledApiProposals??[],i=new Gi;if(t.length)for(const n of t)i.appendMarkdown(`- \`${n}\`
`);return{data:i,dispose:()=>{}}}}Ke.as(Ew.ExtensionFeaturesRegistry).registerExtensionFeature({id:"enabledApiProposals",label:h(12306,"API Proposals"),access:{canToggle:!1},renderer:new Sr(zAe)});async function qAe(s,e){const t=[];return await jce(s,t,e.logsHome,e.logsHome),t}async function jce(s,e,t,i){const n=await s.resolve(t);for(const{resource:o,isDirectory:r}of n.children||[])if(r)await jce(s,e,o,i);else{const a=(await s.readFile(o)).value.toString();if(a){const c=Gu(i,o);c&&e.push({relativePath:c,contents:a})}}}const KAe=30*1e3;var Om;(function(s){s[s.Management=1]="Management",s[s.ExtensionHost=2]="ExtensionHost",s[s.Tunnel=3]="Tunnel"})(Om||(Om={}));function OV(s){switch(s){case Om.Management:return"Management";case Om.ExtensionHost:return"ExtensionHost";case Om.Tunnel:return"Tunnel"}}function Yce(s){const e=new li;return setTimeout(()=>e.cancel(),s),e.token}function jAe(s,e){if(s.isCancellationRequested||e.isCancellationRequested)return Ce.Cancelled;const t=new li;return s.onCancellationRequested(()=>t.cancel()),e.onCancellationRequested(()=>t.cancel()),t.token}class SO{get didTimeout(){return this._state==="timedout"}constructor(e){this._state="pending",this._disposables=new U,{promise:this.promise,resolve:this._resolvePromise,reject:this._rejectPromise}=xE(),e.isCancellationRequested?this._timeout():this._disposables.add(e.onCancellationRequested(()=>this._timeout()))}registerDisposable(e){this._state==="pending"?this._disposables.add(e):e.dispose()}_timeout(){this._state==="pending"&&(this._disposables.dispose(),this._state="timedout",this._rejectPromise(this._createTimeoutError()))}_createTimeoutError(){const e=new Error("Time limit reached");return e.code="ETIMEDOUT",e.syscall="connect",e}resolve(e){this._state==="pending"&&(this._disposables.dispose(),this._state="resolved",this._resolvePromise(e))}reject(e){this._state==="pending"&&(this._disposables.dispose(),this._state="rejected",this._rejectPromise(e))}}function YAe(s,e){const t=new SO(e);return t.registerDisposable(s.onControlMessage(i=>{const n=JSON.parse(i.toString()),o=Zce(n);o?t.reject(o):t.resolve(n)})),t.promise}function QAe(s,e,t,i,n,o,r,a){const c=new SO(a),d=Xn.create(!1);return s.info(`Creating a socket (${r})...`),dr(`code/willCreateSocket/${o}`),e.connect(t,i,n,r).then(l=>{c.didTimeout?(dr(`code/didCreateSocketError/${o}`),s.info(`Creating a socket (${r}) finished after ${d.elapsed()} ms, but this is too late and has timed out already.`),l?.dispose()):(dr(`code/didCreateSocketOK/${o}`),s.info(`Creating a socket (${r}) was successful after ${d.elapsed()} ms.`),c.resolve(l))},l=>{dr(`code/didCreateSocketError/${o}`),s.info(`Creating a socket (${r}) returned an error after ${d.elapsed()} ms.`),s.error(l),c.reject(l)}),c.promise}function x1(s,e){const t=new SO(e);return s.then(i=>{t.didTimeout||t.resolve(i)},i=>{t.didTimeout||t.reject(i)}),t.promise}async function XAe(s,e,t,i){const n=Jce(s,e);s.logService.trace(`${n} 1/6. invoking socketFactory.connect().`);let o;try{o=await QAe(s.logService,s.remoteSocketFactoryService,s.connectTo,AF.getServerRootPath(),`reconnectionToken=${s.reconnectionToken}&reconnection=${s.reconnectionProtocol?"true":"false"}`,OV(e),`renderer-${OV(e)}-${s.reconnectionToken}`,i)}catch(l){throw s.logService.error(`${n} socketFactory.connect() failed or timed out. Error:`),s.logService.error(l),l}s.logService.trace(`${n} 2/6. socketFactory.connect() was successful.`);let r,a;s.reconnectionProtocol?(s.reconnectionProtocol.beginAcceptReconnection(o,null),r=s.reconnectionProtocol,a=!1):(r=new KTe({socket:o}),a=!0),s.logService.trace(`${n} 3/6. sending AuthRequest control message.`);const c=await x1(s.signService.createNewMessage(Pn()),i),d={type:"auth",auth:s.connectionToken||"00000000000000000000",data:c.data};r.sendControl(Le.fromString(JSON.stringify(d)));try{const l=await YAe(r,jAe(i,Yce(1e4)));if(l.type!=="sign"||typeof l.data!="string"){const v=new Error("Unexpected handshake message");throw v.code="VSCODE_CONNECTION_ERROR",v}if(s.logService.trace(`${n} 4/6. received SignRequest control message.`),!await x1(s.signService.validate(c,l.signedData),i)){const v=new Error("Refused to connect to unsupported server");throw v.code="VSCODE_CONNECTION_ERROR",v}const g=await x1(s.signService.sign(l.data),i),m={type:"connectionType",commit:s.commit,signedData:g,desiredConnectionType:e};return t&&(m.args=t),s.logService.trace(`${n} 5/6. sending ConnectionTypeRequest control message.`),r.sendControl(Le.fromString(JSON.stringify(m))),{protocol:r,ownsProtocol:a}}catch(l){throw l&&l.code==="ETIMEDOUT"&&(s.logService.error(`${n} the handshake timed out. Error:`),s.logService.error(l)),l&&l.code==="VSCODE_CONNECTION_ERROR"&&(s.logService.error(`${n} received error control message when negotiating connection. Error:`),s.logService.error(l)),a&&HK(r),l}}async function ZAe(s,e,t,i){const n=Date.now(),o=Jce(s,e),{protocol:r,ownsProtocol:a}=await XAe(s,e,t,i),c=new SO(i);return c.registerDisposable(r.onControlMessage(d=>{const l=JSON.parse(d.toString()),u=Zce(l);u?(s.logService.error(`${o} received error control message when negotiating connection. Error:`),s.logService.error(u),a&&HK(r),c.reject(u)):(s.reconnectionProtocol?.endAcceptReconnection(),s.logService.trace(`${o} 6/6. handshake finished, connection is up and running after ${dRe(n)}!`),c.resolve({protocol:r,firstMessage:l}))})),c.promise}async function Qce(s,e,t){const{protocol:i,firstMessage:n}=await ZAe(s,Om.ExtensionHost,e,t),o=n&&n.debugPort;return{protocol:i,debugPort:o}}async function Xce(s,e,t){const{connectTo:i,connectionToken:n}=await s.addressProvider.getAddress();return{commit:s.commit,quality:s.quality,connectTo:i,connectionToken:n,reconnectionToken:e,reconnectionProtocol:t,remoteSocketFactoryService:s.remoteSocketFactoryService,signService:s.signService,logService:s.logService}}async function JAe(s,e){return eRe(s,async t=>{const{protocol:i,debugPort:n}=await Qce(t,e,Ce.None);return new rRe(s,e,t.reconnectionToken,i,n)})}async function eRe(s,e){for(let i=1;;i++)try{const n=Pn(),o=await Xce(s,n,null);return await e(o)}catch(n){if(i<5)s.logService.error(`[remote-connection][attempt ${i}] An error occurred in initial connection! Will retry... Error:`),s.logService.error(n);else throw s.logService.error(`[remote-connection][attempt ${i}]  An error occurred in initial connection! It will be treated as a permanent error. Error:`),s.logService.error(n),Ud.triggerPermanentFailure(0,0,fp.isHandled(n)),n}}function tRe(s){return Tn(e=>new Promise((t,i)=>{const n=setTimeout(t,s*1e3);e.onCancellationRequested(()=>{clearTimeout(n),t()})}))}var Kp;(function(s){s[s.ConnectionLost=0]="ConnectionLost",s[s.ReconnectionWait=1]="ReconnectionWait",s[s.ReconnectionRunning=2]="ReconnectionRunning",s[s.ReconnectionPermanentFailure=3]="ReconnectionPermanentFailure",s[s.ConnectionGain=4]="ConnectionGain"})(Kp||(Kp={}));class iRe{constructor(e,t){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.type=Kp.ConnectionLost}}class nRe{constructor(e,t,i,n){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.durationSeconds=i,this.cancellableTimer=n,this.type=Kp.ReconnectionWait}skipWait(){this.cancellableTimer.cancel()}}class sRe{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=Kp.ReconnectionRunning}}class nX{constructor(e,t,i){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.type=Kp.ConnectionGain}}class oRe{constructor(e,t,i,n){this.reconnectionToken=e,this.millisSinceLastIncomingData=t,this.attempt=i,this.handled=n,this.type=Kp.ReconnectionPermanentFailure}}class Ud extends F{static triggerPermanentFailure(e,t,i){this._permanentFailure=!0,this._permanentFailureMillisSinceLastIncomingData=e,this._permanentFailureAttempt=t,this._permanentFailureHandled=i,this._instances.forEach(n=>n._gotoPermanentFailure(this._permanentFailureMillisSinceLastIncomingData,this._permanentFailureAttempt,this._permanentFailureHandled))}static debugTriggerReconnection(){this._instances.forEach(e=>e._beginReconnecting())}static debugPauseSocketWriting(){this._instances.forEach(e=>e._pauseSocketWriting())}static{this._permanentFailure=!1}static{this._permanentFailureMillisSinceLastIncomingData=0}static{this._permanentFailureAttempt=0}static{this._permanentFailureHandled=!1}static{this._instances=[]}get _isPermanentFailure(){return this._permanentFailure||Ud._permanentFailure}constructor(e,t,i,n,o){super(),this._connectionType=e,this._options=t,this.reconnectionToken=i,this.protocol=n,this._reconnectionFailureIsFatal=o,this._onDidStateChange=this._register(new M),this.onDidStateChange=this._onDidStateChange.event,this._permanentFailure=!1,this._isReconnecting=!1,this._isDisposed=!1,this._onDidStateChange.fire(new nX(this.reconnectionToken,0,0)),this._register(n.onSocketClose(r=>{const a=Xk(this._connectionType,this.reconnectionToken,!0);r?r.type===RR.NodeSocketCloseEvent?(this._options.logService.info(`${a} received socket close event (hadError: ${r.hadError}).`),r.error&&this._options.logService.error(r.error)):(this._options.logService.info(`${a} received socket close event (wasClean: ${r.wasClean}, code: ${r.code}, reason: ${r.reason}).`),r.event&&this._options.logService.error(r.event)):this._options.logService.info(`${a} received socket close event.`),this._beginReconnecting()})),this._register(n.onSocketTimeout(r=>{const a=Xk(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${a} received socket timeout event (unacknowledgedMsgCount: ${r.unacknowledgedMsgCount}, timeSinceOldestUnacknowledgedMsg: ${r.timeSinceOldestUnacknowledgedMsg}, timeSinceLastReceivedSomeData: ${r.timeSinceLastReceivedSomeData}).`),this._beginReconnecting()})),Ud._instances.push(this),this._register(Ie(()=>{const r=Ud._instances.indexOf(this);r>=0&&Ud._instances.splice(r,1)})),this._isPermanentFailure&&this._gotoPermanentFailure(Ud._permanentFailureMillisSinceLastIncomingData,Ud._permanentFailureAttempt,Ud._permanentFailureHandled)}dispose(){super.dispose(),this._isDisposed=!0}async _beginReconnecting(){if(!this._isReconnecting)try{this._isReconnecting=!0,await this._runReconnectingLoop()}finally{this._isReconnecting=!1}}async _runReconnectingLoop(){if(this._isPermanentFailure||this._isDisposed)return;const e=Xk(this._connectionType,this.reconnectionToken,!0);this._options.logService.info(`${e} starting reconnecting loop. You can get more information with the trace log level.`),this._onDidStateChange.fire(new iRe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData()));const t=[0,5,5,10,10,10,10,10,30];let i=-1;do{i++;const n=i<t.length?t[i]:t[t.length-1];try{if(n>0){const r=tRe(n);this._onDidStateChange.fire(new nRe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),n,r)),this._options.logService.info(`${e} waiting for ${n} seconds before reconnecting...`);try{await r}catch{}}if(this._isPermanentFailure){this._options.logService.error(`${e} permanent failure occurred while running the reconnecting loop.`);break}this._onDidStateChange.fire(new sRe(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1)),this._options.logService.info(`${e} resolving connection...`);const o=await Xce(this._options,this.reconnectionToken,this.protocol);this._options.logService.info(`${e} connecting to ${o.connectTo}...`),await this._reconnect(o,Yce(KAe)),this._options.logService.info(`${e} reconnected!`),this._onDidStateChange.fire(new nX(this.reconnectionToken,this.protocol.getMillisSinceLastIncomingData(),i+1));break}catch(o){if(o.code==="VSCODE_CONNECTION_ERROR"){this._options.logService.error(`${e} A permanent error occurred in the reconnecting loop! Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(i>360){this._options.logService.error(`${e} An error occurred while reconnecting, but it will be treated as a permanent error because the reconnection grace time has expired! Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}if(fp.isTemporarilyNotAvailable(o)){this._options.logService.info(`${e} A temporarily not available error occurred while trying to reconnect, will try again...`),this._options.logService.trace(o);continue}if((o.code==="ETIMEDOUT"||o.code==="ENETUNREACH"||o.code==="ECONNREFUSED"||o.code==="ECONNRESET")&&o.syscall==="connect"){this._options.logService.info(`${e} A network error occurred while trying to reconnect, will try again...`),this._options.logService.trace(o);continue}if(ys(o)){this._options.logService.info(`${e} A promise cancelation error occurred while trying to reconnect, will try again...`),this._options.logService.trace(o);continue}if(o instanceof fp){this._options.logService.error(`${e} A RemoteAuthorityResolverError occurred while trying to reconnect. Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,fp.isHandled(o));break}this._options.logService.error(`${e} An unknown error occurred while trying to reconnect, since this is an unknown case, it will be treated as a permanent error! Will give up now! Error:`),this._options.logService.error(o),this._onReconnectionPermanentFailure(this.protocol.getMillisSinceLastIncomingData(),i+1,!1);break}}while(!this._isPermanentFailure&&!this._isDisposed)}_onReconnectionPermanentFailure(e,t,i){this._reconnectionFailureIsFatal?Ud.triggerPermanentFailure(e,t,i):this._gotoPermanentFailure(e,t,i)}_gotoPermanentFailure(e,t,i){this._onDidStateChange.fire(new oRe(this.reconnectionToken,e,t,i)),HK(this.protocol)}_pauseSocketWriting(){this.protocol.pauseSocketWriting()}}class rRe extends Ud{constructor(e,t,i,n,o){super(Om.ExtensionHost,e,i,n,!1),this._startArguments=t,this.debugPort=o}async _reconnect(e,t){await Qce(e,this._startArguments,t)}}function HK(s){try{s.acceptDisconnect();const e=s.getSocket();s.dispose(),e.dispose()}catch(e){mt(e)}}function Zce(s){if(s&&s.type==="error"){const e=new Error(`Connection error: ${s.reason}`);return e.code="VSCODE_CONNECTION_ERROR",e}return null}function aRe(s,e){for(;s.length<e;)s+=" ";return s}function cRe(s,e){return`[remote-connection][${aRe(OV(s),13)}][${e.substr(0,5)}]`}function Xk(s,e,t){return`${cRe(s,e)}[${t?"reconnect":"initial"}]`}function Jce(s,e){return`${Xk(e,s.reconnectionToken,!!s.reconnectionProtocol)}[${s.connectTo}]`}function dRe(s){return`${Date.now()-s} ms`}let HR=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_){super(),this.runningLocation=e,this.startup=t,this._initDataProvider=i,this.workerUrl=n,this.workerOptions=o,this._telemetryService=r,this._contextService=a,this._labelService=c,this._logService=d,this._loggerService=l,this._environmentService=u,this._userDataProfilesService=g,this._productService=m,this._layoutService=v,this._storageService=_,this.pid=null,this.remoteAuthority=null,this.extensions=null,this._onDidExit=this._register(new M),this.onExit=this._onDidExit.event,this._isTerminating=!1,this._protocolPromise=null,this._protocol=null,this._extensionHostLogsLocation=Ct(this._environmentService.extHostLogsPath,"webWorker")}async _getWebWorkerExtensionHostIframeSrc(){const e=new URLSearchParams;this._environmentService.debugExtensionHost&&this._environmentService.debugRenderer&&e.set("debugged","1"),Qme.addSearchParam(e,!0,!0),e.set("parentOrigin",zi.origin);const t=`?${e.toString()}`,i="vs/workbench/services/extensions/worker/webWorkerExtensionHostIframe.html";if(Kt){const o=this._productService.webEndpointUrlTemplate,r=this._productService.commit,a=this._productService.quality;if(o&&r&&a){const c="webWorkerExtensionHostIframeStableOriginUUID";let d=this._storageService.get(c,he.WORKSPACE);typeof d>"u"&&(d=Pn(),this._storageService.store(c,d,he.WORKSPACE,gt.MACHINE));const l=await Xme(zi.origin,d),u=o.replace("{{uuid}}",`v--${l}`).replace("{{commit}}",r).replace("{{quality}}",a),g=new URL(`${u}/out/${i}${t}`);return g.searchParams.set("salt",d),g.toString()}}return`${nc.asBrowserUri(i).toString(!0)}${t}`}async start(){return this._protocolPromise||(this._protocolPromise=this._startInsideIframe(),this._protocolPromise.then(e=>this._protocol=e)),this._protocolPromise}async _startInsideIframe(){const e=await this._getWebWorkerExtensionHostIframeSrc(),t=this._register(new M),i=document.createElement("iframe");i.setAttribute("class","web-worker-ext-host-iframe"),i.setAttribute("sandbox","allow-scripts allow-same-origin"),i.setAttribute("allow","usb; serial; hid; cross-origin-isolated;"),i.setAttribute("aria-hidden","true"),i.style.display="none";const n=Pn();i.setAttribute("src",`${e}&vscodeWebWorkerExtHostId=${n}`);const o=new Rp;let r,a=null,c=!1,d=null;const l=(v,_)=>{a=_,c=!0,mt(a),clearTimeout(d),this._onDidExit.fire([NC.UnexpectedError,a.message]),o.open()},u=v=>{r=v,clearTimeout(d),o.open()};if(d=setTimeout(()=>{console.warn("The Web Worker Extension Host did not start in 60s, that might be a problem.")},6e4),this._register(re(zi,"message",v=>{if(v.source!==i.contentWindow||v.data.vscodeWebWorkerExtHostId!==n)return;if(v.data.error){const{name:w,message:C,stack:k}=v.data.error,D=new Error;return D.message=C,D.name=w,D.stack=k,l(NC.UnexpectedError,D)}if(v.data.type==="vscode.bootstrap.nls"){i.contentWindow.postMessage({type:v.data.type,data:{workerUrl:this.workerUrl,workerOptions:this.workerOptions,fileRoot:globalThis._VSCODE_FILE_ROOT,nls:{messages:Jme(),language:Zme()}}},"*");return}const{data:_}=v.data;if(o.isOpen()||!(_ instanceof MessagePort)){console.warn("UNEXPECTED message",v);const w=new Error("UNEXPECTED message");return l(NC.UnexpectedError,w)}u(_)})),this._layoutService.mainContainer.appendChild(i),this._register(Ie(()=>i.remove())),await o.wait(),c)throw a;const g=this._environmentService.options?.messagePorts??new Map;i.contentWindow.postMessage({type:"vscode.init",data:g},"*",[...g.values()]),r.onmessage=v=>{const{data:_}=v;if(!(_ instanceof ArrayBuffer)){console.warn("UNKNOWN data received",_),this._onDidExit.fire([77,"UNKNOWN data received"]);return}t.fire(Le.wrap(new Uint8Array(_,0,_.byteLength)))};const m={onMessage:t.event,send:v=>{const _=v.buffer.buffer.slice(v.buffer.byteOffset,v.buffer.byteOffset+v.buffer.byteLength);r.postMessage(_,[_])}};return this._performHandshake(m)}async _performHandshake(e){if(await T.toPromise(T.filter(e.onMessage,t=>LA(t,Ca.Ready))),this._isTerminating)throw Ab();if(e.send(Le.fromString(JSON.stringify(await this._createExtHostInitData()))),this._isTerminating)throw Ab();if(await T.toPromise(T.filter(e.onMessage,t=>LA(t,Ca.Initialized))),this._isTerminating)throw Ab();return e}dispose(){this._isTerminating||(this._isTerminating=!0,this._protocol?.send(ere(Ca.Terminate)),super.dispose())}getInspectPort(){}enableInspectPort(){return Promise.resolve(!1)}async _createExtHostInitData(){const e=await this._initDataProvider.getInitData();this.extensions=e.extensions;const t=this._contextService.getWorkspace(),i=this._productService.extensionsGallery?.nlsBaseUrl;let n;return i&&this._productService.commit&&!$T.isDefaultVariant()&&(n=R.joinPath(R.parse(i),this._productService.commit,this._productService.version,$T.value())),{commit:this._productService.commit,version:this._productService.version,quality:this._productService.quality,parentPid:0,environment:{isExtensionDevelopmentDebug:this._environmentService.debugRenderer,appName:this._productService.nameLong,appHost:this._productService.embedderIdentifier??(Kt?"web":"desktop"),appUriScheme:this._productService.urlProtocol,appLanguage:gh,isExtensionTelemetryLoggingOnly:dne(this._productService,this._environmentService),extensionDevelopmentLocationURI:this._environmentService.extensionDevelopmentLocationURI,extensionTestsLocationURI:this._environmentService.extensionTestsLocationURI,globalStorageHome:this._userDataProfilesService.defaultProfile.globalStorageHome,workspaceStorageHome:this._environmentService.workspaceStorageHome,extensionLogLevel:this._environmentService.extensionLogLevel},workspace:this._contextService.getWorkbenchState()===Zo.EMPTY?void 0:{configuration:t.configuration||void 0,id:t.id,name:this._labelService.getWorkspaceLabel(t),transient:t.transient},consoleForward:{includeStack:!1,logNative:this._environmentService.debugRenderer},extensions:this.extensions.toSnapshot(),nlsBaseUrl:n,telemetryInfo:{sessionId:this._telemetryService.sessionId,machineId:this._telemetryService.machineId,sqmId:this._telemetryService.sqmId,devDeviceId:this._telemetryService.devDeviceId,firstSessionDate:this._telemetryService.firstSessionDate,msftInternal:this._telemetryService.msftInternal},logLevel:this._logService.getLevel(),loggers:[...this._loggerService.getRegisteredLoggers()],logsLocation:this._extensionHostLogsLocation,autoStart:this.startup===uh.EagerAutoStart,remote:{authority:this._environmentService.remoteAuthority,connectionData:null,isRemote:!1},uiKind:Kt?yy.Web:yy.Desktop}}};HR=f([p(5,ai),p(6,It),p(7,ui),p(8,Re),p(9,tI),p(10,cf),p(11,Uv),p(12,Vn),p(13,af),p(14,it)],HR);class lRe{constructor(){this.capabilities=hh.Readonly+hh.FileReadWrite+hh.PathCaseSensitive,this.onDidChangeCapabilities=T.None,this.onDidChangeFile=T.None}async readFile(e){try{const t=await fetch(e.toString(!0));if(t.status===200)return new Uint8Array(await t.arrayBuffer());throw V6(t.statusText,ur.Unknown)}catch(t){throw V6(t,ur.Unknown)}}async stat(e){return{type:uC.File,size:0,mtime:0,ctime:0}}watch(){return F.None}writeFile(e,t,i){throw new SS}readdir(e){throw new SS}mkdir(e){throw new SS}delete(e,t){throw new SS}rename(e,t,i){throw new SS}}function hRe(s,e,t,i,n){const o=new Po;return s.forEach(r=>{const a=o.get(r.identifier);a&&n.warn(h(12391,"Overwriting extension {0} with {1}.",a.extensionLocation.fsPath,r.extensionLocation.fsPath)),o.set(r.identifier,r)}),e.forEach(r=>{const a=o.get(r.identifier);if(a)if(a.isBuiltin){if(By.gte(a.version,r.version)){n.warn(`Skipping extension ${r.extensionLocation.path} in favour of the builtin extension ${a.extensionLocation.path}.`);return}r.isBuiltin=!0}else n.warn(h(12391,"Overwriting extension {0} with {1}.",a.extensionLocation.fsPath,r.extensionLocation.fsPath));else if(r.isBuiltin){n.warn(`Skipping obsolete builtin extension ${r.extensionLocation.path}`);return}o.set(r.identifier,r)}),t.forEach(r=>{const a=o.get(r.identifier);a&&n.warn(h(12392,"Overwriting {0} with Workspace Extension {1}.",a.extensionLocation.fsPath,r.extensionLocation.fsPath)),o.set(r.identifier,r)}),i.forEach(r=>{n.info(h(12393,"Loading development extension at {0}",r.extensionLocation.fsPath));const a=o.get(r.identifier);a&&a.isBuiltin&&(r.isBuiltin=!0),o.set(r.identifier,r)}),Array.from(o.values())}let FV=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.runningLocation=e,this._initDataProvider=t,this.remoteSocketFactoryService=i,this._contextService=n,this._environmentService=o,this._telemetryService=r,this._logService=a,this._loggerService=c,this._labelService=d,this.remoteAuthorityResolverService=l,this._extensionHostDebugService=u,this._productService=g,this._signService=m,this.pid=null,this.startup=uh.EagerAutoStart,this.extensions=null,this._onExit=this._register(new M),this.onExit=this._onExit.event,this._hasDisconnected=!1,this.remoteAuthority=this._initDataProvider.remoteAuthority,this._protocol=null,this._hasLostConnection=!1,this._terminating=!1;const v=VK(this._environmentService);this._isExtensionDevHost=v.isExtensionDevHost}start(){const e={commit:this._productService.commit,quality:this._productService.quality,addressProvider:{getAddress:async()=>{const{authority:t}=await this.remoteAuthorityResolverService.resolveAuthority(this._initDataProvider.remoteAuthority);return{connectTo:t.connectTo,connectionToken:t.connectionToken}}},remoteSocketFactoryService:this.remoteSocketFactoryService,signService:this._signService,logService:this._logService,ipcLogger:null};return this.remoteAuthorityResolverService.resolveAuthority(this._initDataProvider.remoteAuthority).then(t=>{const i={language:gh,debugId:this._environmentService.debugExtensionHost.debugId,break:this._environmentService.debugExtensionHost.break,port:this._environmentService.debugExtensionHost.port,env:{...this._environmentService.debugExtensionHost.env,...t.options?.extensionHostEnv}},n=this._environmentService.extensionDevelopmentLocationURI;let o=!0;return n&&n.length>0&&n[0].scheme===ae.file&&(o=!1),o||(i.break=!1),JAe(e,i).then(r=>{this._register(r);const{protocol:a,debugPort:c,reconnectionToken:d}=r,l=typeof c=="number";return o&&this._environmentService.isExtensionDevelopment&&this._environmentService.debugExtensionHost.debugId&&c&&this._extensionHostDebugService.attachSession(this._environmentService.debugExtensionHost.debugId,c,this._initDataProvider.remoteAuthority),a.onDidDispose(()=>{this._onExtHostConnectionLost(d)}),a.onSocketClose(()=>{this._isExtensionDevHost&&this._onExtHostConnectionLost(d)}),new Promise((u,g)=>{const m=setTimeout(()=>{g("The remote extension host took longer than 60s to send its ready message.")},6e4),v=a.onMessage(_=>{if(LA(_,Ca.Ready)){this._createExtHostInitData(l).then(w=>{a.send(Le.fromString(JSON.stringify(w)))});return}if(LA(_,Ca.Initialized)){clearTimeout(m),v.dispose(),this._protocol=a,u(a);return}console.error("received unexpected message during handshake phase from the extension host: ",_)})})})})}_onExtHostConnectionLost(e){this._hasLostConnection||(this._hasLostConnection=!0,this._isExtensionDevHost&&this._environmentService.debugExtensionHost.debugId&&this._extensionHostDebugService.close(this._environmentService.debugExtensionHost.debugId),!this._terminating&&this._onExit.fire([0,e]))}async _createExtHostInitData(e){const t=await this._initDataProvider.getInitData();this.extensions=t.extensions;const i=this._contextService.getWorkspace();return{commit:this._productService.commit,version:this._productService.version,quality:this._productService.quality,parentPid:t.pid,environment:{isExtensionDevelopmentDebug:e,appRoot:t.appRoot,appName:this._productService.nameLong,appHost:this._productService.embedderIdentifier||"desktop",appUriScheme:this._productService.urlProtocol,isExtensionTelemetryLoggingOnly:dne(this._productService,this._environmentService),appLanguage:gh,extensionDevelopmentLocationURI:this._environmentService.extensionDevelopmentLocationURI,extensionTestsLocationURI:this._environmentService.extensionTestsLocationURI,globalStorageHome:t.globalStorageHome,workspaceStorageHome:t.workspaceStorageHome,extensionLogLevel:this._environmentService.extensionLogLevel},workspace:this._contextService.getWorkbenchState()===Zo.EMPTY?null:{configuration:i.configuration,id:i.id,name:this._labelService.getWorkspaceLabel(i),transient:i.transient},remote:{isRemote:!0,authority:this._initDataProvider.remoteAuthority,connectionData:t.connectionData},consoleForward:{includeStack:!1,logNative:!!this._environmentService.debugExtensionHost.debugId},extensions:this.extensions.toSnapshot(),telemetryInfo:{sessionId:this._telemetryService.sessionId,machineId:this._telemetryService.machineId,sqmId:this._telemetryService.sqmId,devDeviceId:this._telemetryService.devDeviceId,firstSessionDate:this._telemetryService.firstSessionDate,msftInternal:this._telemetryService.msftInternal},logLevel:this._logService.getLevel(),loggers:[...this._loggerService.getRegisteredLoggers()],logsLocation:t.extensionHostLogsPath,autoStart:this.startup===uh.EagerAutoStart,uiKind:Kt?yy.Web:yy.Desktop}}getInspectPort(){}enableInspectPort(){return Promise.resolve(!1)}async disconnect(){this._protocol&&!this._hasDisconnected&&(this._protocol.send(ere(Ca.Terminate)),this._protocol.sendDisconnect(),this._hasDisconnected=!0,await this._protocol.drain())}dispose(){super.dispose(),this._terminating=!0,this.disconnect(),this._protocol&&(this._protocol.getSocket().end(),this._protocol=null)}};FV=f([p(2,Cq),p(3,It),p(4,wn),p(5,ai),p(6,Re),p(7,tI),p(8,ui),p(9,Wh),p(10,tre),p(11,Vn),p(12,sre)],FV);var WV;let BV=class extends LV{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A,B,q,Q,ie,oe){super({hasLocalProcess:!1,allowRemoteExtensionsInLocalWebWorker:!0},e,t,i,n,o,r,a,c,d,l,u,g,m,v,w,C,k,D,A,oe),this._browserEnvironmentService=r,this._webExtensionsScannerService=_,this._userDataInitializationService=B,this._userDataProfileService=q,this._workspaceTrustManagementService=Q,this._remoteExplorerService=ie,D.when(mc.Ready).then(async()=>{await this._userDataInitializationService.initializeInstalledExtensions(this._instantiationService),this._initialize()}),this._initFetchFileSystem()}_initFetchFileSystem(){const e=new lRe;this._register(this._fileService.registerProvider(ae.http,e)),this._register(this._fileService.registerProvider(ae.https,e))}async _scanWebExtensions(){return this._scanWebExtensionsPromise||(this._scanWebExtensionsPromise=(async()=>{const e=[],t=[],i=[];try{await Promise.all([this._webExtensionsScannerService.scanSystemExtensions().then(n=>e.push(...n.map(o=>Dk(o)))),this._webExtensionsScannerService.scanUserExtensions(this._userDataProfileService.currentProfile.extensionsResource,{skipInvalidExtensions:!0}).then(n=>t.push(...n.map(o=>Dk(o)))),this._webExtensionsScannerService.scanExtensionsUnderDevelopment().then(n=>i.push(...n.map(o=>Dk(o,!0))))])}catch(n){this._logService.error(n)}return hRe(e,t,[],i,this._logService)})()),this._scanWebExtensionsPromise}async _resolveExtensionsDefault(e){const[t,i]=await Promise.all([this._scanWebExtensions(),this._remoteExtensionsScannerService.scanExtensions()]);i.length&&e.emitOne(new Kce(i)),e.emitOne(new qce(t))}_resolveExtensions(){return new Xa(e=>this._doResolveExtensions(e))}async _doResolveExtensions(e){if(!this._browserEnvironmentService.expectsResolverExtension)return this._resolveExtensionsDefault(e);const t=this._environmentService.remoteAuthority;await this._workspaceTrustManagementService.workspaceResolved;const n=(await this._scanWebExtensions()).filter(a=>PAe(a));n.length&&e.emitOne(new zce(n));let o;try{o=await this._resolveAuthorityInitial(t)}catch(a){return fp.isHandled(a)&&console.log("Error handled: Not showing a notification for the error"),this._remoteAuthorityResolverService._setResolvedAuthorityError(t,a),this._resolveExtensionsDefault(e)}this._remoteAuthorityResolverService._setResolvedAuthority(o.authority,o.options),this._remoteExplorerService.setTunnelInformation(o.tunnelInformation);const r=this._remoteAgentService.getConnection();return r&&(r.onDidStateChange(async a=>{a.type===Kp.ConnectionLost&&this._remoteAuthorityResolverService._clearResolvedAuthority(t)}),r.onReconnecting(()=>this._resolveAuthorityAgain())),this._resolveExtensionsDefault(e)}async _onExtensionHostExit(e){await this._doStopExtensionHosts();const t=zi;typeof t.codeAutomationExit=="function"&&t.codeAutomationExit(e,await qAe(this._fileService,this._environmentService))}async _resolveAuthority(e){return this._resolveAuthorityOnExtensionHosts(Ft.LocalWebWorker,e)}};BV=f([p(3,Z),p(4,Dt),p(5,cf),p(6,ai),p(7,gd),p(8,je),p(9,Vn),p(10,WN),p(11,It),p(12,ne),p(13,Kv),p(14,Hq),p(15,Re),p(16,Lh),p(17,DN),p(18,wd),p(19,Wh),p(20,HN),p(21,Mh),p(22,Lv),p(23,VN),p(24,ei)],BV);let VV=class{constructor(e,t,i,n,o,r,a,c){this._extensionsProposedApi=e,this._scanWebExtensions=t,this._getExtensionRegistrySnapshotWhenReady=i,this._instantiationService=n,this._remoteAgentService=o,this._remoteAuthorityResolverService=r,this._extensionEnablementService=a,this._logService=c}createExtensionHost(e,t,i){switch(t.kind){case Ft.LocalProcess:return null;case Ft.LocalWebWorker:{const n=i?uh.EagerManualStart:uh.EagerAutoStart;return this._instantiationService.createInstance(HR,t,n,this._createLocalExtensionHostDataProvider(e,t,i),nc.asBrowserUri("vs/workbench/api/worker/extensionHostWorkerMain.js").toString(!0),{type:"module"})}case Ft.Remote:{const n=this._remoteAgentService.getConnection();return n?this._instantiationService.createInstance(FV,t,this._createRemoteExtensionHostDataProvider(e,n.remoteAuthority)):null}}}_createLocalExtensionHostDataProvider(e,t,i){return{getInitData:async()=>{if(i){const n=Qk(this._logService,this._extensionEnablementService,this._extensionsProposedApi,await this._scanWebExtensions(),!0),o=e.computeRunningLocation(n,[],!1),r=Yk(n,o,c=>t.equals(c));return{extensions:new Ik(0,n,r.map(c=>c.identifier))}}else{const n=await this._getExtensionRegistrySnapshotWhenReady(),o=e.filterByRunningLocation(n.extensions,t);return{extensions:new Ik(n.versionId,n.extensions,o.map(a=>a.identifier))}}}}}_createRemoteExtensionHostDataProvider(e,t){return{remoteAuthority:t,getInitData:async()=>{const i=await this._getExtensionRegistrySnapshotWhenReady(),n=await this._remoteAgentService.getEnvironment();if(!n)throw new Error("Cannot provide init data for remote extension host!");const o=e.filterByExtensionHostKind(i.extensions,Ft.Remote),r=new Ik(i.versionId,i.extensions,o.map(a=>a.identifier));return{connectionData:this._remoteAuthorityResolverService.getConnectionData(t),pid:n.pid,appRoot:n.appRoot,extensionHostLogsPath:n.extensionHostLogsPath,globalStorageHome:n.globalStorageHome,workspaceStorageHome:n.workspaceStorageHome,extensions:r}}}}};VV=f([p(3,Z),p(4,Lh),p(5,Wh),p(6,gd),p(7,Re)],VV);let HV=WV=class{constructor(e){this._logService=e}pickExtensionHostKind(e,t,i,n,o){const r=WV.pickRunningLocation(t,i,n,o);return this._logService.trace(`pickRunningLocation for ${e.value}, extension kinds: [${t.join(", ")}], isInstalledLocally: ${i}, isInstalledRemotely: ${n}, preference: ${jTe(o)} => ${th(r)}`),r}static pickRunningLocation(e,t,i,n){const o=[];let r=!1;for(const a of e){if(a==="ui"&&i){if(n===ea.Remote)return Ft.Remote;r=!0}if(a==="workspace"&&i){if(n===ea.None||n===ea.Remote)return Ft.Remote;o.push(Ft.Remote)}if(a==="web"&&(t||i)){if(n===ea.None||n===ea.Local)return Ft.LocalWebWorker;o.push(Ft.LocalWebWorker)}}return r&&o.push(Ft.Remote),o.length>0?o[0]:null}};HV=WV=f([p(0,Re)],HV);async function uRe(s,e,t){let i=t&&t.get("storage.serviceMachineId",he.APPLICATION)||null;if(i)return i;try{const o=(await e.readFile(s.serviceMachineIdResource)).value.toString();i=eve(o)?o:null}catch{i=null}if(!i){i=Pn();try{await e.writeFile(s.serviceMachineIdResource,Le.fromString(i))}catch{}}return t?.store("storage.serviceMachineId",i,he.APPLICATION,gt.MACHINE),i}var UV;(function(s){s.ExtensionQueryService="ExtensionQueryService",s.ExtensionLatestVersionUri="ExtensionLatestVersionUriTemplate",s.ExtensionStatisticsUri="ExtensionStatisticsUriTemplate",s.WebExtensionStatisticsUri="WebExtensionStatisticsUriTemplate",s.PublisherViewUri="PublisherViewUriTemplate",s.ExtensionDetailsViewUri="ExtensionDetailsViewUriTemplate",s.ExtensionRatingViewUri="ExtensionRatingViewUriTemplate",s.ExtensionResourceUri="ExtensionResourceUriTemplate",s.ContactSupportUri="ContactSupportUri"})(UV||(UV={}));var sX;(function(s){s.None="None",s.IncludeVersions="IncludeVersions",s.IncludeFiles="IncludeFiles",s.IncludeCategoryAndTags="IncludeCategoryAndTags",s.IncludeSharedAccounts="IncludeSharedAccounts",s.IncludeVersionProperties="IncludeVersionProperties",s.ExcludeNonValidated="ExcludeNonValidated",s.IncludeInstallationTargets="IncludeInstallationTargets",s.IncludeAssetUri="IncludeAssetUri",s.IncludeStatistics="IncludeStatistics",s.IncludeLatestVersionOnly="IncludeLatestVersionOnly",s.Unpublished="Unpublished",s.IncludeNameConflictInfo="IncludeNameConflictInfo",s.IncludeLatestPrereleaseAndStableVersionOnly="IncludeLatestPrereleaseAndStableVersionOnly"})(sX||(sX={}));function gRe(s,e){const[t,i]=e.split("/");for(const n of s.resources){const[o,r]=n.type.split("/");if(o===t){if(!i||r===i)return n.id;break}}}const pRe="/web-extension-resource/";class fRe extends F{constructor(e,t,i,n,o,r,a){super(),this._fileService=e,this._storageService=t,this._productService=i,this._environmentService=n,this._configurationService=o,this._extensionGalleryManifestService=r,this._logService=a,this._initPromise=this._init()}async _init(){try{const e=await this._extensionGalleryManifestService.getExtensionGalleryManifest();this.resolve(e),this._register(this._extensionGalleryManifestService.onDidChangeExtensionGalleryManifest(()=>this.resolve(e)))}catch(e){this._logService.error(e)}}resolve(e){this._extensionGalleryResourceUrlTemplate=e?gRe(e,UV.ExtensionResourceUri):void 0,this._extensionGalleryAuthority=this._extensionGalleryResourceUrlTemplate?this._getExtensionGalleryAuthority(R.parse(this._extensionGalleryResourceUrlTemplate)):void 0}async supportsExtensionGalleryResources(){return await this._initPromise,this._extensionGalleryResourceUrlTemplate!==void 0}async getExtensionGalleryResourceURL({publisher:e,name:t,version:i,targetPlatform:n},o){if(await this._initPromise,this._extensionGalleryResourceUrlTemplate){const r=R.parse(tve(this._extensionGalleryResourceUrlTemplate,{publisher:e,name:t,version:n!==void 0&&n!==gC.UNDEFINED&&n!==gC.UNKNOWN&&n!==gC.UNIVERSAL?`${i}+${n}`:i,path:"extension"}));return this._isWebExtensionResourceEndPoint(r)?r.with({scheme:AF.getPreferredWebSchema()}):r}}async isExtensionGalleryResource(e){return await this._initPromise,!!this._extensionGalleryAuthority&&this._extensionGalleryAuthority===this._getExtensionGalleryAuthority(e)}async getExtensionGalleryRequestHeaders(){const e={"X-Client-Name":`${this._productService.applicationName}${Kt?"-web":""}`,"X-Client-Version":this._productService.version};return kk(this._productService,this._environmentService)&&ive(this._configurationService)===Rz.USAGE&&(e["X-Machine-Id"]=await this._getServiceMachineId()),this._productService.commit&&(e["X-Client-Commit"]=this._productService.commit),e}_getServiceMachineId(){return this._serviceMachineIdPromise||(this._serviceMachineIdPromise=uRe(this._environmentService,this._fileService,this._storageService)),this._serviceMachineIdPromise}_getExtensionGalleryAuthority(e){if(this._isWebExtensionResourceEndPoint(e))return e.authority;const t=e.authority.indexOf(".");return t!==-1?e.authority.substring(t+1):void 0}_isWebExtensionResourceEndPoint(e){const t=e.path,i=AF.getServerRootPath();return t.startsWith(i)&&t.startsWith(pRe,i.length)}}let $V=class extends fRe{constructor(e,t,i,n,o,r,a){super(e,t,i,n,o,r,a)}async readExtensionResource(e){if(e=nc.uriToBrowserUri(e),e.scheme!==ae.http&&e.scheme!==ae.https&&e.scheme!==ae.data)return(await this._fileService.readFile(e)).value.toString();const t={};await this.isExtensionGalleryResource(e)&&(t.headers=await this.getExtensionGalleryRequestHeaders(),t.mode="cors");const i=await fetch(e.toString(!0),t);if(i.status!==200)throw this._logService.info(`Request to '${e.toString(!0)}' failed with status code ${i.status}`),new Error(i.statusText);return i.text()}};$V=f([p(0,je),p(1,it),p(2,Vn),p(3,Hs),p(4,ne),p(5,Pae),p(6,Re)],$V);var A_,GV;class HC{static fromJSON(e){if(e)try{const t=JSON.parse(e);return new HC(t.extensions,t.low,t.high,t.mid)}catch{return}}constructor(e,t,i,n=(t+i)/2|0){this.extensions=e,this.low=t,this.high=i,this.mid=n}}let zV=class{static{A_=this}static{this._storageKey="extensionBisectState"}constructor(e,t,i){this._storageService=t,this._envService=i,this._disabled=new Map;const n=t.get(A_._storageKey,he.APPLICATION);if(this._state=HC.fromJSON(n),this._state){const{mid:o,high:r}=this._state;for(let a=0;a<this._state.extensions.length;a++){const c=a>=o&&a<r;this._disabled.set(this._state.extensions[a],c)}e.warn("extension BISECT active",[...this._disabled])}}get isActive(){return!!this._state}get disabledCount(){return this._state?this._state.high-this._state.mid:-1}isDisabledByBisect(e){return!this._state||nve(e.manifest,this._envService.remoteAuthority)||this._isEnabledInEnv(e)?!1:this._disabled.get(e.identifier.id)??!1}_isEnabledInEnv(e){return Array.isArray(this._envService.enableExtensions)&&this._envService.enableExtensions.some(t=>ja({id:t},e.identifier))}async start(e){if(this._state)throw new Error("invalid state");const t=e.map(n=>n.identifier.id),i=new HC(t,0,t.length,0);this._storageService.store(A_._storageKey,JSON.stringify(i),he.APPLICATION,gt.MACHINE),await this._storageService.flush()}async next(e){if(!this._state)throw new Error("invalid state");if(e&&this._state.mid===0&&this._state.high===this._state.extensions.length)return{bad:!0,id:""};if(this._state.low===this._state.high-1)return await this.reset(),{id:this._state.extensions[this._state.low],bad:e};const t=new HC(this._state.extensions,e?this._state.low:this._state.mid,e?this._state.mid:this._state.high);this._storageService.store(A_._storageKey,JSON.stringify(t),he.APPLICATION,gt.MACHINE),await this._storageService.flush()}async reset(){this._storageService.remove(A_._storageKey,he.APPLICATION),await this._storageService.flush()}};zV=A_=f([p(0,Re),p(1,it),p(2,wn)],zV);let Hy=class{static{GV=this}static{this.ctxIsBisectActive=new O("isExtensionBisectActive",!1)}constructor(e,t,i,n){this._extensionBisectService=t,this._notificationService=i,this._commandService=n,t.isActive&&(GV.ctxIsBisectActive.bindTo(e).set(!0),this._showBisectPrompt())}_showBisectPrompt(){const e={label:h(12192,"I can't reproduce"),run:()=>this._commandService.executeCommand("extension.bisect.next",!1)},t={label:h(12193,"I can reproduce"),run:()=>this._commandService.executeCommand("extension.bisect.next",!0)},i={label:"Stop Bisect",run:()=>this._commandService.executeCommand("extension.bisect.stop")},n=this._extensionBisectService.disabledCount===1?h(12194,"Extension Bisect is active and has disabled 1 extension. Check if you can still reproduce the problem and proceed by selecting from these options."):h(12195,"Extension Bisect is active and has disabled {0} extensions. Check if you can still reproduce the problem and proceed by selecting from these options.",this._extensionBisectService.disabledCount);this._notificationService.prompt(Fe.Info,n,[e,t,i],{sticky:!0,priority:lne.URGENT})}};Hy=GV=f([p(0,fe),p(1,Lw),p(2,Dt),p(3,Ge)],Hy);Ke.as(df.Workbench).registerWorkbenchContribution(Hy,mc.Restored);Y(class extends X{constructor(){super({id:"extension.bisect.start",title:I(12196,"Start Extension Bisect"),category:te.Help,f1:!0,precondition:Hy.ctxIsBisectActive.negate(),menu:{id:N.ViewContainerTitle,when:x.equals("viewContainer","workbench.view.extensions"),group:"2_enablement",order:4}})}async run(s){const e=s.get(ei),t=s.get(Hn),i=s.get(CI),n=s.get(gd),o=s.get(Lw),r=(await i.getInstalled(Fn.User)).filter(c=>n.isEnabled(c));(await e.confirm({message:h(12197,"Extension Bisect"),detail:h(12198,"Extension Bisect will use binary search to find an extension that causes a problem. During the process the window reloads repeatedly (~{0} times). Each time you must confirm if you are still seeing problems.",2+Math.log2(r.length)|0),primaryButton:h(12199,"&&Start Extension Bisect")})).confirmed&&(await o.start(r),t.reload())}});Y(class extends X{constructor(){super({id:"extension.bisect.next",title:I(12200,"Continue Extension Bisect"),category:te.Help,f1:!0,precondition:Hy.ctxIsBisectActive})}async run(s,e){const t=s.get(ei),i=s.get(Hn),n=s.get(Lw),o=s.get(Vn),r=s.get(ire),a=s.get(Ge);if(!n.isActive)return;if(e===void 0){const d=await this._checkForBad(t,n);if(d===null)return;e=d}if(e===void 0){await n.reset(),i.reload();return}const c=await n.next(e);if(!c){i.reload();return}if(c.bad)await t.info(h(12201,"Extension Bisect"),h(12202,"Extension Bisect is done but no extension has been identified. This might be a problem with {0}.",o.nameShort));else{const d=await t.confirm({type:Fe.Info,message:h(12201,"Extension Bisect"),primaryButton:h(12203,"&&Report Issue & Continue"),cancelButton:h(12204,"Continue"),detail:h(12205,"Extension Bisect is done and has identified {0} as the extension causing the problem.",c.id),checkbox:{label:h(12206,"Keep this extension disabled"),checked:!0}});d.checkboxChecked&&await r.disableExtension({id:c.id},void 0),d.confirmed&&await a.executeCommand("workbench.action.openIssueReporter",c.id)}await n.reset(),i.reload()}async _checkForBad(s,e){const{result:t}=await s.prompt({type:Fe.Info,message:h(12207,"Extension Bisect"),detail:h(12208,"Extension Bisect is active and has disabled {0} extensions. Check if you can still reproduce the problem and proceed by selecting from these options.",e.disabledCount),buttons:[{label:h(12209,"I ca&&n't reproduce"),run:()=>!1},{label:h(12210,"I can &&reproduce"),run:()=>!0},{label:h(12211,"&&Stop Bisect"),run:()=>{}}],cancelButton:{label:h(12212,"&&Cancel Bisect"),run:()=>null}});return t}});Y(class extends X{constructor(){super({id:"extension.bisect.stop",title:I(12213,"Stop Extension Bisect"),category:te.Help,f1:!0,precondition:Hy.ctxIsBisectActive})}async run(s){const e=s.get(Lw),t=s.get(Hn);await e.reset(),t.reload()}});function ede(s,e){if(e==null)return s.toString();const t=new URL(s,e);return t.host=new URL(e).hostname,t.toString()}function mRe(s){for(const[e,t]of Object.entries(s))nc.registerAppResourcePathUrl(e,t)}function qV(s){switch(s){case Xh.InvalidSymbol:return h(109,"Invalid symbol");case Xh.InvalidNumberFormat:return h(110,"Invalid number format");case Xh.PropertyNameExpected:return h(111,"Property name expected");case Xh.ValueExpected:return h(112,"Value expected");case Xh.ColonExpected:return h(113,"Colon expected");case Xh.CommaExpected:return h(114,"Comma expected");case Xh.CloseBraceExpected:return h(115,"Closing brace expected");case Xh.CloseBracketExpected:return h(116,"Closing bracket expected");case Xh.EndOfFileExpected:return h(117,"End of file expected");default:return""}}var Uy;(function(s){s.ERROR_PROFILE_NOT_FOUND="ERROR_PROFILE_NOT_FOUND",s.ERROR_INVALID_CONTENT="ERROR_INVALID_CONTENT"})(Uy||(Uy={}));class UR extends Error{constructor(e,t){super(e),this.code=t}}let oX=class extends F{constructor(e,t,i,n,o){super(),this.extensionsLocation=e,this.fileService=t,this.userDataProfilesService=i,this.uriIdentityService=n,this.logService=o,this._onAddExtensions=this._register(new M),this.onAddExtensions=this._onAddExtensions.event,this._onDidAddExtensions=this._register(new M),this.onDidAddExtensions=this._onDidAddExtensions.event,this._onRemoveExtensions=this._register(new M),this.onRemoveExtensions=this._onRemoveExtensions.event,this._onDidRemoveExtensions=this._register(new M),this.onDidRemoveExtensions=this._onDidRemoveExtensions.event,this.resourcesAccessQueueMap=new In}scanProfileExtensions(e,t){return this.withProfileExtensions(e,void 0,t)}async addExtensionsToProfile(e,t,i){const n=[],o=[];try{return await this.withProfileExtensions(t,r=>{const a=[];if(i)a.push(...r);else for(const c of r)e.some(([d])=>ja(d.identifier,c.identifier)&&d.manifest.version!==c.version)?n.push(c):a.push(c);for(const[c,d]of e){const l=a.findIndex(g=>ja(g.identifier,c.identifier)&&g.version===c.manifest.version),u={identifier:c.identifier,version:c.manifest.version,location:c.location,metadata:d};l===-1?(o.push(u),a.push(u)):a.splice(l,1,u)}return o.length&&this._onAddExtensions.fire({extensions:o,profileLocation:t}),n.length&&this._onRemoveExtensions.fire({extensions:n,profileLocation:t}),a}),o.length&&this._onDidAddExtensions.fire({extensions:o,profileLocation:t}),n.length&&this._onDidRemoveExtensions.fire({extensions:n,profileLocation:t}),o}catch(r){throw o.length&&this._onDidAddExtensions.fire({extensions:o,error:r,profileLocation:t}),n.length&&this._onDidRemoveExtensions.fire({extensions:n,error:r,profileLocation:t}),r}}async updateMetadata(e,t){const i=[];return await this.withProfileExtensions(t,n=>{const o=[];for(const r of n){const a=e.find(([c])=>ja({id:c.identifier.id},{id:r.identifier.id})&&c.manifest.version===r.version);a&&(r.metadata={...r.metadata,...a[1]},i.push(r)),o.push(r)}return o}),i}async removeExtensionsFromProfile(e,t){const i=[];try{await this.withProfileExtensions(t,n=>{const o=[];for(const r of n)e.some(a=>ja(r.identifier,a))?i.push(r):o.push(r);return i.length&&this._onRemoveExtensions.fire({extensions:i,profileLocation:t}),o}),i.length&&this._onDidRemoveExtensions.fire({extensions:i,profileLocation:t})}catch(n){throw i.length&&this._onDidRemoveExtensions.fire({extensions:i,error:n,profileLocation:t}),n}}async withProfileExtensions(e,t,i){return this.getResourceAccessQueue(e).queue(async()=>{let n=[],o;try{const r=await this.fileService.readFile(e);o=JSON.parse(r.value.toString().trim()||"[]")}catch(r){if(Xf(r)!==Kn.FILE_NOT_FOUND)throw r;if(this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)&&(o=await this.migrateFromOldDefaultProfileExtensionsLocation()),!o&&i?.bailOutWhenFileNotFound)throw new UR(ya(r),Uy.ERROR_PROFILE_NOT_FOUND)}if(o){Array.isArray(o)||this.throwInvalidConentError(e);let r=!1;for(const a of o){rX(a)||this.throwInvalidConentError(e);let c;if(Tt(a.relativeLocation)&&a.relativeLocation)c=this.resolveExtensionLocation(a.relativeLocation);else if(Tt(a.location)){this.logService.warn(`Extensions profile: Ignoring extension with invalid location: ${a.location}`);continue}else{c=R.revive(a.location);const l=this.toRelativePath(c);l&&(r=!0,a.relativeLocation=l)}Ym(a.metadata?.hasPreReleaseVersion)&&a.metadata?.preRelease&&(r=!0,a.metadata.hasPreReleaseVersion=!0);const d=a.metadata?.id??a.identifier.uuid;n.push({identifier:d?{id:a.identifier.id,uuid:d}:{id:a.identifier.id},location:c,version:a.version,metadata:a.metadata})}r&&await this.fileService.writeFile(e,Le.fromString(JSON.stringify(o)))}if(t){n=t(n);const r=n.map(a=>({identifier:a.identifier,version:a.version,location:a.location.toJSON(),relativeLocation:this.toRelativePath(a.location),metadata:a.metadata}));await this.fileService.writeFile(e,Le.fromString(JSON.stringify(r)))}return n})}throwInvalidConentError(e){throw new UR(`Invalid extensions content in ${e.toString()}`,Uy.ERROR_INVALID_CONTENT)}toRelativePath(e){return this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(e),this.extensionsLocation)?this.uriIdentityService.extUri.basename(e):void 0}resolveExtensionLocation(e){return this.uriIdentityService.extUri.joinPath(this.extensionsLocation,e)}async migrateFromOldDefaultProfileExtensionsLocation(){return this._migrationPromise||(this._migrationPromise=(async()=>{const e=this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location,"extensions.json"),t=this.uriIdentityService.extUri.joinPath(this.extensionsLocation,".init-default-profile-extensions");let i;try{i=(await this.fileService.readFile(e)).value.toString()}catch(o){if(Xf(o)===Kn.FILE_NOT_FOUND)return;throw o}this.logService.info("Migrating extensions from old default profile location",e.toString());let n;try{const o=JSON.parse(i);Array.isArray(o)&&o.every(r=>rX(r))?n=o:this.logService.warn("Skipping migrating from old default profile locaiton: Found invalid data",o)}catch(o){this.logService.error(o)}if(n)try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,Le.fromString(JSON.stringify(n)),{overwrite:!1}),this.logService.info("Migrated extensions from old default profile location to new location",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString())}catch(o){if(Xf(o)===Kn.FILE_MODIFIED_SINCE)this.logService.info("Migration from old default profile location to new location is done by another window",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString());else throw o}try{await this.fileService.del(e)}catch(o){Xf(o)!==Kn.FILE_NOT_FOUND&&this.logService.error(o)}try{await this.fileService.del(t)}catch(o){Xf(o)!==Kn.FILE_NOT_FOUND&&this.logService.error(o)}return n})()),this._migrationPromise}getResourceAccessQueue(e){let t=this.resourcesAccessQueueMap.get(e);return t||(t=new sve,this.resourcesAccessQueueMap.set(e,t)),t}};oX=f([p(1,je),p(2,Uv),p(3,nn),p(4,Re)],oX);function rX(s){return ra(s)&&ove(s.identifier)&&(vRe(s.location)||Tt(s.location)&&s.location)&&(Ym(s.relativeLocation)||Tt(s.relativeLocation))&&s.version&&Tt(s.version)}function vRe(s){return s?Tt(s.path)&&Tt(s.scheme):!1}function _Re(s,e,t,i){try{bRe(s,e,t,i)}catch(n){s.error(n?.message??n)}return e}function bRe(s,e,t,i){const n=(o,r,a)=>{const c=o[r];if(Tt(c)){const d=c,l=d.length;if(l>1&&d[0]==="%"&&d[l-1]==="%"){const u=d.substr(1,l-2);let g=t[u];g===void 0&&i&&(g=i[u]);const m=typeof g=="string"?g:g?.message,v=i?.[u],_=typeof v=="string"?v:v?.message;if(!m){_||s.warn(`[${e.name}]: ${h(1818,"Couldn't find message for key {0}.",u)}`);return}if(a&&(r==="title"||r==="category")&&_&&_!==m){const w={value:m,original:_};o[r]=w}else o[r]=m}}else if(ra(c))for(const d in c)c.hasOwnProperty(d)&&(d==="commands"?n(c,d,!0):n(c,d,a));else if(Array.isArray(c))for(let d=0;d<c.length;d++)n(c,d,a)};for(const o in e)e.hasOwnProperty(o)&&n(e,o)}var KV;(function(s){function e(t,i){if(t===i)return!0;const n=Object.keys(t),o=new Set;for(const r of Object.keys(i))o.add(r);if(n.length!==o.size)return!1;for(const r of n){if(t[r]!==i[r])return!1;o.delete(r)}return o.size===0}s.equals=e})(KV||(KV={}));let aX=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(),this.systemExtensionsLocation=e,this.userExtensionsLocation=t,this.extensionsControlLocation=i,this.userDataProfilesService=o,this.extensionsProfileScannerService=r,this.fileService=a,this.logService=c,this.environmentService=d,this.productService=l,this.uriIdentityService=u,this.instantiationService=g,this._onDidChangeCache=this._register(new M),this.onDidChangeCache=this._onDidChangeCache.event,this.initializeDefaultProfileExtensionsPromise=void 0,this.systemExtensionsCachedScanner=this._register(this.instantiationService.createInstance(zR,n)),this.userExtensionsCachedScanner=this._register(this.instantiationService.createInstance(zR,n)),this.extensionsScanner=this._register(this.instantiationService.createInstance(GR)),this._register(this.systemExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(Fn.System))),this._register(this.userExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(Fn.User)))}getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=rve(this.fileService,this.logService)),this._targetPlatformPromise}async scanAllExtensions(e,t){const[i,n]=await Promise.all([this.scanSystemExtensions(e),this.scanUserExtensions(t)]);return this.dedupExtensions(i,n,[],await this.getTargetPlatform(),!0)}async scanSystemExtensions(e){const t=[];t.push(this.scanDefaultSystemExtensions(e.language)),t.push(this.scanDevSystemExtensions(e.language,!!e.checkControlFile));const[i,n]=await Promise.all(t);return this.applyScanOptions([...i,...n],Fn.System,{pickLatest:!1})}async scanUserExtensions(e){this.logService.trace("Started scanning user extensions",e.profileLocation);const t=this.uriIdentityService.extUri.isEqual(e.profileLocation,this.userDataProfilesService.defaultProfile.extensionsResource)?{bailOutWhenFileNotFound:!0}:void 0,i=await this.createExtensionScannerInput(e.profileLocation,!0,Fn.User,e.language,!0,t,e.productVersion??this.getProductVersion()),n=e.useCache&&!i.devMode?this.userExtensionsCachedScanner:this.extensionsScanner;let o;try{o=await n.scanExtensions(i)}catch(r){if(r instanceof UR&&r.code===Uy.ERROR_PROFILE_NOT_FOUND)await this.doInitializeDefaultProfileExtensions(),o=await n.scanExtensions(i);else throw r}return o=await this.applyScanOptions(o,Fn.User,{includeInvalid:e.includeInvalid,pickLatest:!0}),this.logService.trace("Scanned user extensions:",o.length),o}async scanAllUserExtensions(e={includeInvalid:!0,includeAllVersions:!0}){const t=await this.createExtensionScannerInput(this.userExtensionsLocation,!1,Fn.User,void 0,!0,void 0,this.getProductVersion()),i=await this.extensionsScanner.scanExtensions(t);return this.applyScanOptions(i,Fn.User,{includeAllVersions:e.includeAllVersions,includeInvalid:e.includeInvalid})}async scanExtensionsUnderDevelopment(e,t){if(this.environmentService.isExtensionDevelopment&&this.environmentService.extensionDevelopmentLocationURI){const i=(await Promise.all(this.environmentService.extensionDevelopmentLocationURI.filter(n=>n.scheme===ae.file).map(async n=>{const o=await this.createExtensionScannerInput(n,!1,Fn.User,t.language,!1,void 0,this.getProductVersion());return(await this.extensionsScanner.scanOneOrMultipleExtensions(o)).map(a=>(a.type=e.find(c=>ja(c.identifier,a.identifier))?.type??a.type,this.extensionsScanner.validate(a,o)))}))).flat();return this.applyScanOptions(i,"development",{includeInvalid:t.includeInvalid,pickLatest:!0})}return[]}async scanExistingExtension(e,t,i){const n=await this.createExtensionScannerInput(e,!1,t,i.language,!0,void 0,this.getProductVersion()),o=await this.extensionsScanner.scanExtension(n);return!o||!i.includeInvalid&&!o.isValid?null:o}async scanOneOrMultipleExtensions(e,t,i){const n=await this.createExtensionScannerInput(e,!1,t,i.language,!0,void 0,this.getProductVersion()),o=await this.extensionsScanner.scanOneOrMultipleExtensions(n);return this.applyScanOptions(o,t,{includeInvalid:i.includeInvalid,pickLatest:!0})}async scanMultipleExtensions(e,t,i){const n=[];return await Promise.all(e.map(async o=>{const r=await this.scanOneOrMultipleExtensions(o,t,i);n.push(...r)})),this.applyScanOptions(n,t,{includeInvalid:i.includeInvalid,pickLatest:!0})}async updateManifestMetadata(e,t){const i=Ct(e,"package.json"),n=(await this.fileService.readFile(i)).value.toString(),o=JSON.parse(n);o.__metadata={...o.__metadata,...t},await this.fileService.writeFile(Ct(e,"package.json"),Le.fromString(JSON.stringify(o,null,"	")))}async initializeDefaultProfileExtensions(){try{await this.extensionsProfileScannerService.scanProfileExtensions(this.userDataProfilesService.defaultProfile.extensionsResource,{bailOutWhenFileNotFound:!0})}catch(e){if(e instanceof UR&&e.code===Uy.ERROR_PROFILE_NOT_FOUND)await this.doInitializeDefaultProfileExtensions();else throw e}}async doInitializeDefaultProfileExtensions(){return this.initializeDefaultProfileExtensionsPromise||(this.initializeDefaultProfileExtensionsPromise=(async()=>{try{this.logService.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());const e=await this.scanAllUserExtensions({includeInvalid:!0});if(e.length)await this.extensionsProfileScannerService.addExtensionsToProfile(e.map(t=>[t,t.metadata]),this.userDataProfilesService.defaultProfile.extensionsResource);else try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,Le.fromString(JSON.stringify([])))}catch(t){Xf(t)!==Kn.FILE_NOT_FOUND&&this.logService.warn("Failed to create default profile extensions manifest in extensions installation folder.",this.userExtensionsLocation.toString(),ya(t))}this.logService.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}catch(e){this.logService.error(e)}finally{this.initializeDefaultProfileExtensionsPromise=void 0}})()),this.initializeDefaultProfileExtensionsPromise}async applyScanOptions(e,t,i={}){return i.includeAllVersions||(e=this.dedupExtensions(t===Fn.System?e:void 0,t===Fn.User?e:void 0,t==="development"?e:void 0,await this.getTargetPlatform(),!!i.pickLatest)),i.includeInvalid||(e=e.filter(n=>n.isValid)),e.sort((n,o)=>{const r=an(n.location.fsPath),a=an(o.location.fsPath);return r<a?-1:r>a?1:0})}dedupExtensions(e,t,i,n,o){const r=(c,d,l)=>{if(c.isValid&&!d.isValid)return!1;if(c.isValid===d.isValid){if(o&&By.gt(c.manifest.version,d.manifest.version))return this.logService.debug(`Skipping extension ${d.location.path} with lower version ${d.manifest.version} in favour of ${c.location.path} with version ${c.manifest.version}`),!1;if(By.eq(c.manifest.version,d.manifest.version)){if(c.type===Fn.System)return this.logService.debug(`Skipping extension ${d.location.path} in favour of system extension ${c.location.path} with same version`),!1;if(c.targetPlatform===n)return this.logService.debug(`Skipping extension ${d.location.path} from different target platform ${d.targetPlatform}`),!1}}return l?this.logService.warn(`Overwriting user extension ${c.location.path} with ${d.location.path}.`):this.logService.debug(`Overwriting user extension ${c.location.path} with ${d.location.path}.`),!0},a=new Po;return e?.forEach(c=>{const d=a.get(c.identifier.id);(!d||r(d,c,!1))&&a.set(c.identifier.id,c)}),t?.forEach(c=>{const d=a.get(c.identifier.id);if(!d&&e&&c.type===Fn.System){this.logService.debug(`Skipping obsolete system extension ${c.location.path}.`);return}(!d||r(d,c,!1))&&a.set(c.identifier.id,c)}),i?.forEach(c=>{const d=a.get(c.identifier.id);(!d||r(d,c,!0))&&a.set(c.identifier.id,c),a.set(c.identifier.id,c)}),[...a.values()]}async scanDefaultSystemExtensions(e){this.logService.trace("Started scanning system extensions");const t=await this.createExtensionScannerInput(this.systemExtensionsLocation,!1,Fn.System,e,!0,void 0,this.getProductVersion()),n=await(t.devMode?this.extensionsScanner:this.systemExtensionsCachedScanner).scanExtensions(t);return this.logService.trace("Scanned system extensions:",n.length),n}async scanDevSystemExtensions(e,t){const i=this.environmentService.isBuilt?[]:this.productService.builtInExtensions;if(!i?.length)return[];this.logService.trace("Started scanning dev system extensions");const n=t?await this.getBuiltInExtensionControl():{},o=[],r=R.file(bz(ave(nc.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(const c of i){const d=n[c.name]||"marketplace";switch(d){case"disabled":break;case"marketplace":o.push(Ct(r,c.name));break;default:o.push(R.file(d));break}}const a=await Promise.all(o.map(async c=>this.extensionsScanner.scanExtension(await this.createExtensionScannerInput(c,!1,Fn.System,e,!0,void 0,this.getProductVersion()))));return this.logService.trace("Scanned dev system extensions:",a.length),$t(a)}async getBuiltInExtensionControl(){try{const e=await this.fileService.readFile(this.extensionsControlLocation);return JSON.parse(e.value.toString())}catch{return{}}}async createExtensionScannerInput(e,t,i,n,o,r,a){const c=await this.getTranslations(n??gh),d=await this.getMtime(e),l=t&&!this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)?this.userDataProfilesService.defaultProfile.extensionsResource:void 0,u=l?await this.getMtime(l):void 0;return new UC(e,d,l,u,t,r,i,o,a.version,a.date,this.productService.commit,!this.environmentService.isBuilt,n,c)}async getMtime(e){try{const t=await this.fileService.stat(e);if(typeof t.mtime=="number")return t.mtime}catch{}}getProductVersion(){return{version:this.productService.version,date:this.productService.date}}};aX=f([p(4,Uv),p(5,IN),p(6,je),p(7,Re),p(8,Hs),p(9,Vn),p(10,nn),p(11,Z)],aX);class UC{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){this.location=e,this.mtime=t,this.applicationExtensionslocation=i,this.applicationExtensionslocationMtime=n,this.profile=o,this.profileScanOptions=r,this.type=a,this.validate=c,this.productVersion=d,this.productDate=l,this.productCommit=u,this.devMode=g,this.language=m,this.translations=v}static createNlsConfiguration(e){return{language:e.language,pseudo:e.language==="pseudo",devMode:e.devMode,translations:e.translations}}static equals(e,t){return At(e.location,t.location)&&e.mtime===t.mtime&&At(e.applicationExtensionslocation,t.applicationExtensionslocation)&&e.applicationExtensionslocationMtime===t.applicationExtensionslocationMtime&&e.profile===t.profile&&ic(e.profileScanOptions,t.profileScanOptions)&&e.type===t.type&&e.validate===t.validate&&e.productVersion===t.productVersion&&e.productDate===t.productDate&&e.productCommit===t.productCommit&&e.devMode===t.devMode&&e.language===t.language&&KV.equals(e.translations,t.translations)}}let $R=class extends F{constructor(e,t){super(),this.fileService=e,this.logService=t}async getLocalizedMessages(e,t,i){const n=Ct(e,"package.nls.json"),o=(d,l)=>{l.forEach(u=>{this.logService.error(this.formatMessage(e,h(1819,"Failed to parse {0}: {1}.",d?.path,qV(u.error))))})},r=d=>{this.logService.error(this.formatMessage(e,h(1820,"Invalid format {0}: JSON object expected.",d?.path)))},a=`${t.publisher}.${t.name}`,c=i.translations[a];if(c)try{const d=R.parse(c),l=(await this.fileService.readFile(d)).value.toString(),u=[],g=Rb(l,u);return u.length>0?(o(d,u),{values:void 0,default:n}):pC(g)!=="object"?(r(d),{values:void 0,default:n}):{values:g.contents?g.contents.package:void 0,default:n}}catch{return{values:void 0,default:n}}else{if(!await this.fileService.exists(n))return;let l;try{l=await this.findMessageBundles(e,i)}catch{return}if(!l.localized)return{values:void 0,default:l.original};try{const u=(await this.fileService.readFile(l.localized)).value.toString(),g=[],m=Rb(u,g);return g.length>0?(o(l.localized,g),{values:void 0,default:l.original}):pC(m)!=="object"?(r(l.localized),{values:void 0,default:l.original}):{values:m,default:l.original}}catch{return{values:void 0,default:l.original}}}}async translateManifest(e,t,i){const n=await this.getLocalizedMessages(e,t,i);if(n)try{const o=[],r=await this.resolveOriginalMessageBundle(n.default,o);if(o.length>0)return o.forEach(c=>{this.logService.error(this.formatMessage(e,h(1819,"Failed to parse {0}: {1}.",n.default?.path,qV(c.error))))}),t;if(pC(n)!=="object")return this.logService.error(this.formatMessage(e,h(1820,"Invalid format {0}: JSON object expected.",n.default?.path))),t;const a=n.values||Object.create(null);return _Re(this.logService,t,a,r)}catch{}return t}async resolveOriginalMessageBundle(e,t){if(e)try{const i=(await this.fileService.readFile(e)).value.toString();return Rb(i,t)}catch{}}findMessageBundles(e,t){return new Promise((i,n)=>{const o=r=>{const a=Ct(e,`package.nls.${r}.json`);this.fileService.exists(a).then(c=>{c&&i({localized:a,original:Ct(e,"package.nls.json")});const d=r.lastIndexOf("-");d===-1?i({localized:Ct(e,"package.nls.json"),original:null}):(r=r.substring(0,d),o(r))})};if(t.devMode||t.pseudo||!t.language)return i({localized:Ct(e,"package.nls.json"),original:null});o(t.language)})}formatMessage(e,t){return`[${e.path}]: ${t}`}};$R=f([p(0,je),p(1,Re)],$R);let GR=class extends $R{constructor(e,t,i,n,o,r){super(i,r),this.extensionsProfileScannerService=e,this.uriIdentityService=t,this.environmentService=o,this.extensionsEnabledWithApiProposalVersion=n.extensionsEnabledWithApiProposalVersion?.map(a=>a.toLowerCase())??[]}async scanExtensions(e){return e.profile?this.scanExtensionsFromProfile(e):this.scanExtensionsFromLocation(e)}async scanExtensionsFromLocation(e){const t=await this.fileService.resolve(e.location);if(!t.children?.length)return[];const i=await Promise.all(t.children.map(async n=>{if(!n.isDirectory||e.type===Fn.User&&Qe(n.resource).indexOf(".")===0)return null;const o=new UC(n.resource,e.mtime,e.applicationExtensionslocation,e.applicationExtensionslocationMtime,e.profile,e.profileScanOptions,e.type,e.validate,e.productVersion,e.productDate,e.productCommit,e.devMode,e.language,e.translations);return this.scanExtension(o)}));return $t(i).sort((n,o)=>n.location.path<o.location.path?-1:1)}async scanExtensionsFromProfile(e){let t=await this.scanExtensionsFromProfileResource(e.location,()=>!0,e);if(e.applicationExtensionslocation&&!this.uriIdentityService.extUri.isEqual(e.location,e.applicationExtensionslocation)){t=t.filter(n=>!n.metadata?.isApplicationScoped);const i=await this.scanExtensionsFromProfileResource(e.applicationExtensionslocation,n=>!!n.metadata?.isBuiltin||!!n.metadata?.isApplicationScoped,e);t.push(...i)}return t}async scanExtensionsFromProfileResource(e,t,i){const n=await this.extensionsProfileScannerService.scanProfileExtensions(e,i.profileScanOptions);if(!n.length)return[];const o=await Promise.all(n.map(async r=>{if(t(r)){const a=new UC(r.location,i.mtime,i.applicationExtensionslocation,i.applicationExtensionslocationMtime,i.profile,i.profileScanOptions,i.type,i.validate,i.productVersion,i.productDate,i.productCommit,i.devMode,i.language,i.translations);return this.scanExtension(a,r)}return null}));return $t(o)}async scanOneOrMultipleExtensions(e){try{if(await this.fileService.exists(Ct(e.location,"package.json"))){const t=await this.scanExtension(e);return t?[t]:[]}else return await this.scanExtensions(e)}catch(t){return this.logService.error(`Error scanning extensions at ${e.location.path}:`,ya(t)),[]}}async scanExtension(e,t){const i=[];let n=!0,o;try{o=await this.scanExtensionManifest(e.location)}catch(g){if(t){i.push([Fe.Error,ya(g)]),n=!1;const[m,v]=t.identifier.id.split(".");o={name:v,publisher:m,version:t.version,engines:{vscode:""}}}else return e.type!==Fn.System&&this.logService.error(g),null}o.publisher||(o.publisher=cve);let r;t?r={...t.metadata,size:o.__metadata?.size}:o.__metadata&&(r={installedTimestamp:o.__metadata.installedTimestamp,size:o.__metadata.size,targetPlatform:o.__metadata.targetPlatform}),delete o.__metadata;const a=nu(o.publisher,o.name),c=r?.id?{id:a,uuid:r.id}:{id:a},d=r?.isSystem?Fn.System:e.type,l=d===Fn.System||!!r?.isBuiltin;try{o=await this.translateManifest(e.location,o,UC.createNlsConfiguration(e))}catch(g){this.logService.warn("Failed to translate manifest",ya(g))}let u={type:d,identifier:c,manifest:o,location:e.location,isBuiltin:l,targetPlatform:r?.targetPlatform??gC.UNDEFINED,publisherDisplayName:r?.publisherDisplayName,metadata:r,isValid:n,validations:i,preRelease:!!r?.preRelease};return e.validate&&(u=this.validate(u,e)),o.enabledApiProposals&&(!this.environmentService.isBuilt||this.extensionsEnabledWithApiProposalVersion.includes(a.toLowerCase()))&&(o.originalEnabledApiProposals=o.enabledApiProposals,o.enabledApiProposals=dve([...o.enabledApiProposals])),u}validate(e,t){let i=e.isValid;const n=this.environmentService.isBuilt&&this.extensionsEnabledWithApiProposalVersion.includes(e.identifier.id.toLowerCase()),o=rAe(t.productVersion,t.productDate,t.location,e.manifest,e.isBuiltin,n);for(const[r,a]of o)r===Fe.Error&&(i=!1,this.logService.error(this.formatMessage(t.location,a)));return e.isValid=i,e.validations=[...e.validations,...o],e}async scanExtensionManifest(e){const t=Ct(e,"package.json");let i;try{i=(await this.fileService.readFile(t)).value.toString()}catch(o){throw Xf(o)!==Kn.FILE_NOT_FOUND&&this.logService.error(this.formatMessage(e,h(1821,"Cannot read file {0}: {1}.",t.path,o.message))),o}let n;try{n=JSON.parse(i)}catch(o){const r=[];Rb(i,r);for(const a of r)this.logService.error(this.formatMessage(e,h(1822,"Failed to parse {0}: [{1}, {2}] {3}.",t.path,a.offset,a.length,qV(a.error))));throw o}if(pC(n)!=="object"){const o=this.formatMessage(e,h(1823,"Invalid manifest file {0}: Not a JSON object.",t.path));throw this.logService.error(o),new Error(o)}return n}};GR=f([p(0,IN),p(1,nn),p(2,je),p(3,Vn),p(4,Hs),p(5,Re)],GR);let zR=class extends GR{constructor(e,t,i,n,o,r,a,c){super(i,n,o,r,a,c),this.currentProfile=e,this.userDataProfilesService=t,this.cacheValidatorThrottler=this._register(new lve(3e3)),this._onDidChangeCache=this._register(new M),this.onDidChangeCache=this._onDidChangeCache.event}async scanExtensions(e){const t=this.getCacheFile(e),i=await this.readExtensionCache(t);if(this.input=e,i&&i.input&&UC.equals(i.input,this.input))return this.logService.debug("Using cached extensions scan result",e.type===Fn.System?"system":"user",e.location.toString()),this.cacheValidatorThrottler.trigger(()=>this.validateCache()),i.result.map(o=>(o.location=R.revive(o.location),o));const n=await super.scanExtensions(e);return await this.writeExtensionCache(t,{input:e,result:n}),n}async readExtensionCache(e){try{const t=await this.fileService.readFile(e),i=JSON.parse(t.value.toString());return{result:i.result,input:gn(i.input)}}catch(t){this.logService.debug("Error while reading the extension cache file:",e.path,ya(t))}return null}async writeExtensionCache(e,t){try{await this.fileService.writeFile(e,Le.fromString(JSON.stringify(t)))}catch(i){this.logService.debug("Error while writing the extension cache file:",e.path,ya(i))}}async validateCache(){if(!this.input)return;const e=this.getCacheFile(this.input),t=await this.readExtensionCache(e);if(!t)return;const i=t.result,n=JSON.parse(JSON.stringify(await super.scanExtensions(this.input)));if(!ic(n,i))try{this.logService.info("Invalidating Cache",i,n),await this.fileService.del(e),this._onDidChangeCache.fire()}catch(o){this.logService.error(o)}}getCacheFile(e){const t=this.getProfile(e);return this.uriIdentityService.extUri.joinPath(t.cacheHome,e.type===Fn.System?hve:uve)}getProfile(e){return e.type===Fn.System?this.userDataProfilesService.defaultProfile:e.profile?this.uriIdentityService.extUri.isEqual(e.location,this.currentProfile.extensionsResource)?this.currentProfile:this.userDataProfilesService.profiles.find(t=>this.uriIdentityService.extUri.isEqual(e.location,t.extensionsResource))??this.currentProfile:this.userDataProfilesService.defaultProfile}};zR=f([p(1,Uv),p(2,IN),p(3,nn),p(4,je),p(5,Vn),p(6,Hs),p(7,Re)],zR);let jV;function O7e(s){jV=s}let tde;function F7e(s){tde=s}function yRe(s,e,t,i){const n=new U;n.add(nc.registerStaticBrowserUri(Ct(s,e),R.parse(t)));const o=typeof i=="string"?{mimeType:i}:i;return n.add(qSe(new KSe(Ct(s,e),t,o))),n}const cX=zSe(async({toAdd:s,toRemove:e})=>{await dA(),await Qa.get(cn).deltaExtensions(s,e)},(s,e)=>({toAdd:[...s.toAdd,...e.toAdd],toRemove:[...s.toRemove,...e.toRemove]}),0),YV=new Map,qS=[];function W7e(){return qS}function wRe(s){return YV.get(s)}function B7e(s,e,{path:t="/extension",system:i=!1,readmePath:n,changelogPath:o}={}){const r=Pz(s.publisher,s.name),a=R.from({scheme:ooe.extensionFile,authority:r,path:t}),c=(async()=>{await dA();const l=Qa.get(wn).remoteAuthority;let u=a;e===Ft.Remote&&(u=R.from({scheme:ae.vscodeRemote,authority:l,path:t}));const m=Qa.get(Z).createInstance($R),v={devMode:!1,language:gh,pseudo:gh==="pseudo",translations:nae(gh)??{}},w={manifest:await m.translateManifest(u,s,v),type:i?Fn.System:Fn.User,isBuiltin:!0,identifier:{id:r},location:u,targetPlatform:gC.WEB,isValid:!0,validations:[],extHostKind:e,readmeUrl:n!=null?R.joinPath(u,n):void 0,changelogUrl:o!=null?R.joinPath(u,o):void 0,preRelease:!1};return e!=null&&YV.set(r,e),e!==Ft.Remote&&qS.push(w),Qa.get(gd).isEnabled(w)&&await cX({toAdd:[w],toRemove:[]}),w})();let d={id:r,async whenReady(){await c},async isEnabled(){await dA();const l=Qa.get(gd),u=await c;return l.isEnabled(u)},async dispose(){const l=await c;qS.indexOf(l)>=0&&qS.splice(qS.indexOf(l),1),YV.delete(r),await cX({toAdd:[],toRemove:[l]})}};if(e!==Ft.Remote&&(d={...d,registerFileUrl:function(u,g,m){return yRe(a,u,g,m)}}),e===Ft.LocalProcess){async function l(){if(await c,jV==null)throw new Error("The local api can't be used without registering the local extension host by importing `vscode/localExtensionHost`");return await jV(r)}d={...d,getApi:l,async setAsDefaultApi(){tde?.(await l())}}}return d}let dX=class extends F{constructor(e,t,i){super(),this.fileService=t,this.languagePackService=i}async $fetchBuiltInBundleUri(e,t){try{return await this.languagePackService.getBuiltInExtensionTranslationsUri(e,t)}catch{return}}async $fetchBundleContents(e){return(await this.fileService.readFile(R.revive(e))).value.toString()}};dX=f([ht(qe.MainThreadLocalization),p(1,je),p(2,nre)],dX);class CO{constructor(e,t,i){this.viewType=e,this.serializer=t,this.extensionData=i}}let qR=class extends dl{get capabilities(){let e=Je.CanSplitInGroup;return this.fileService.hasProvider(this.resource)?this.filesConfigurationService.isReadonly(this.resource)&&(e|=Je.Readonly):e|=Je.Untitled,e&Je.Readonly||(e|=Je.CanDropIntoEditor),e}get preferredResource(){return this._preferredResource}constructor(e,t,i,n,o,r,a){super(),this.resource=e,this.labelService=i,this.fileService=n,this.filesConfigurationService=o,this.textResourceConfigurationService=r,this.customEditorLabelService=a,this._name=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._preferredResource=t||e,this.registerListeners()}registerListeners(){this._register(this.labelService.onDidChangeFormatters(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onLabelEvent(e.scheme))),this._register(this.customEditorLabelService.onDidChange(()=>this.updateLabel())),this._register(this.filesConfigurationService.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire()))}onLabelEvent(e){e===this._preferredResource.scheme&&this.updateLabel()}updateLabel(){this._name=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._onDidChangeLabel.fire()}setPreferredResource(e){At(e,this._preferredResource)||(this._preferredResource=e,this.updateLabel())}getName(){return typeof this._name!="string"&&(this._name=this.customEditorLabelService.getName(this._preferredResource)??this.labelService.getUriBasenameLabel(this._preferredResource)),this._name}getDescription(e=Ot.MEDIUM){switch(e){case Ot.SHORT:return this.shortDescription;case Ot.LONG:return this.longDescription;case Ot.MEDIUM:default:return this.mediumDescription}}get shortDescription(){return typeof this._shortDescription!="string"&&(this._shortDescription=this.labelService.getUriBasenameLabel(_s(this._preferredResource))),this._shortDescription}get mediumDescription(){return typeof this._mediumDescription!="string"&&(this._mediumDescription=this.labelService.getUriLabel(_s(this._preferredResource),{relative:!0})),this._mediumDescription}get longDescription(){return typeof this._longDescription!="string"&&(this._longDescription=this.labelService.getUriLabel(_s(this._preferredResource))),this._longDescription}get shortTitle(){return typeof this._shortTitle!="string"&&(this._shortTitle=this.getName()),this._shortTitle}get mediumTitle(){return typeof this._mediumTitle!="string"&&(this._mediumTitle=this.labelService.getUriLabel(this._preferredResource,{relative:!0})),this._mediumTitle}get longTitle(){return typeof this._longTitle!="string"&&(this._longTitle=this.labelService.getUriLabel(this._preferredResource)),this._longTitle}getTitle(e){switch(e){case Ot.SHORT:return this.shortTitle;case Ot.LONG:return this.longTitle;default:case Ot.MEDIUM:return this.mediumTitle}}isReadonly(){return this.filesConfigurationService.isReadonly(this.resource)}ensureLimits(e){if(e?.limits)return e.limits;const t=gve(this.resource);let i;const n=this.textResourceConfigurationService.inspect(this.resource,null,"workbench.editorLargeFileConfirmation");return pve(n)&&(i=n.value*qo.MB),{size:i??t}}};qR=f([p(2,ui),p(3,je),p(4,Us),p(5,ir),p(6,pg)],qR);var KS;let Fm=class extends qR{static{KS=this}static getOrCreate(e,t,i,n,o={}){const r=e.createInstance(KS,t,i,n,o);return i&&r.setPreferredResource(i),r}static{this.ID="workbench.input.notebook"}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(e,t,c,d,l,m,v),this.viewType=i,this.options=n,this._notebookService=o,this._notebookModelResolverService=r,this._fileDialogService=a,this.editorModelReference=null,this._defaultDirtyState=!1,this._defaultDirtyState=!!n.startDirty,this._sideLoadedListener=o.onDidAddNotebookDocument(_=>{_.viewType===this.viewType&&_.uri.toString()===this.resource.toString()&&this.resolve().catch(mt)}),this._register(u.onWillStop(_=>{if(!_.auto&&!this.isDirty())return;const w=_.auto?h(8444,"An extension provided notebook for '{0}' is still open that would close otherwise.",this.getName()):h(8445,"An extension provided notebook for '{0}' could not be saved.",this.getName());_.veto((async()=>{const C=g.findEditors(this);return _.auto?!0:!(C.length>0&&(await g.save(C[0])).success)})(),w)}))}dispose(){this._sideLoadedListener.dispose(),this.editorModelReference?.dispose(),this.editorModelReference=null,super.dispose()}get typeId(){return KS.ID}get editorId(){return this.viewType}get capabilities(){let e=Je.None;return this.resource.scheme===ae.untitled&&(e|=Je.Untitled),this.editorModelReference?this.editorModelReference.object.isReadonly()&&(e|=Je.Readonly):this.filesConfigurationService.isReadonly(this.resource)&&(e|=Je.Readonly),e&Je.Readonly||(e|=Je.CanDropIntoEditor),e}getDescription(e=Ot.MEDIUM){if(!this.hasCapability(Je.Untitled)||this.editorModelReference?.object.hasAssociatedFilePath())return super.getDescription(e)}isReadonly(){return this.editorModelReference?this.editorModelReference.object.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}isDirty(){return this.editorModelReference?this.editorModelReference.object.isDirty():this._defaultDirtyState}isSaving(){const e=this.editorModelReference?.object;return!e||!e.isDirty()||e.hasErrorState||this.hasCapability(Je.Untitled)?!1:this.filesConfigurationService.hasShortAutoSaveDelay(this)}async save(e,t){if(this.editorModelReference)return this.hasCapability(Je.Untitled)?this.saveAs(e,t):(await this.editorModelReference.object.save(t),this)}async saveAs(e,t){if(!this.editorModelReference)return;const i=this._notebookService.getContributedNotebookType(this.viewType);if(!i)return;const n=this.hasCapability(Je.Untitled)?await this._suggestName(i,this.labelService.getUriBasenameLabel(this.resource)):this.editorModelReference.object.resource;let o;if(this.editorModelReference.object.hasAssociatedFilePath())o=n;else if(o=await this._fileDialogService.pickFileToSave(n,t?.availableFileSystems),!o)return;if(!i.matches(o)){const r=i.selectors.map(a=>typeof a=="string"?a:fve(a)?`${a} (base ${a.base})`:a.exclude?`${a.include} (exclude: ${a.exclude})`:`${a.include}`).join(", ");throw new Error(`File name ${o} is not supported by ${i.providerDisplayName}.

Please make sure the file name matches following patterns:
${r}`)}return await this.editorModelReference.object.saveAs(o)}async _suggestName(e,t){const i=e.selectors[0];let n=i&&typeof i=="string"?i:void 0;if(!n&&i){const o=i.include;typeof o=="string"&&(n=o)}if(n){const o=/^\*\.([A-Za-z_-]*)$/.exec(n);if(o&&o.length>1){const r=o[1];if(!t.endsWith(r))return Ct(await this._fileDialogService.defaultFilePath(),t+"."+r)}}return Ct(await this._fileDialogService.defaultFilePath(),t)}async rename(e,t){if(this.editorModelReference)return{editor:{resource:t},options:{override:this.viewType}}}async revert(e,t){this.editorModelReference&&this.editorModelReference.object.isDirty()&&await this.editorModelReference.object.revert(t)}async resolve(e,t){if(!await this._notebookService.canResolve(this.viewType))return null;if(t?.mark("extensionActivated"),this._sideLoadedListener.dispose(),this.editorModelReference)this.editorModelReference.object.load({limits:this.ensureLimits(e)});else{const i=!!(this.capabilities&Je.Scratchpad),n=await this._notebookModelResolverService.resolve(this.resource,this.viewType,{limits:this.ensureLimits(e),scratchpad:i,viewType:this.editorId});if(this.editorModelReference)return n.dispose(),this.editorModelReference.object;if(this.editorModelReference=n,this.isDisposed())return this.editorModelReference.dispose(),this.editorModelReference=null,null;this._register(this.editorModelReference.object.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.editorModelReference.object.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire())),this._register(this.editorModelReference.object.onDidRevertUntitled(()=>this.dispose())),this.editorModelReference.object.isDirty()&&this._onDidChangeDirty.fire()}if(this.options._backupId){const i=await this._notebookService.withNotebookDataProvider(this.editorModelReference.object.notebook.viewType);if(!(i instanceof CO))throw new Error("CANNOT open file notebook with this provider");const n=await i.serializer.dataToNotebook(Le.fromString(JSON.stringify({__webview_backup:this.options._backupId})));this.editorModelReference.object.notebook.applyEdits([{editType:sl.Replace,index:0,count:this.editorModelReference.object.notebook.length,cells:n.cells}],!0,void 0,()=>{},void 0,!1),this.options._workingCopy&&(this.options._backupId=void 0,this.options._workingCopy=void 0,this.options.startDirty=void 0)}return this.editorModelReference.object}toUntyped(){return{resource:this.resource,options:{override:this.viewType}}}matches(e){return super.matches(e)?!0:e instanceof KS?this.viewType===e.viewType&&At(this.resource,e.resource):Ql(e)&&e.resource.scheme===ud.scheme?At(this.resource,ud.parse(e.resource)?.notebook):!1}};Fm=KS=f([p(4,bl),p(5,II),p(6,to),p(7,ui),p(8,je),p(9,Us),p(10,cn),p(11,de),p(12,ir),p(13,pg)],Fm);function SRe(s){return!!s&&typeof s=="object"&&Array.isArray(s.editorInputs)&&s.editorInputs.every(e=>e instanceof Fm)}const ide="jupyter-notebook",CRe="ms-toolsai.jupyter",nde=new Map;nde.set(ide,new Map);nde.get(ide)?.set("python",{extensionIds:["ms-python.python",CRe],displayName:"Python + Jupyter"});var lX;(function(s){s[s.Html=0]="Html",s[s.Extension=1]="Extension"})(lX||(lX={}));var hX;(function(s){s[s.fullCell=0]="fullCell",s[s.firstLine=1]="firstLine"})(hX||(hX={}));var uX;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Estimated=1]="Estimated",s[s.FromCache=2]="FromCache",s[s.Measured=3]="Measured"})(uX||(uX={}));var gX;(function(s){s[s.Fold=0]="Fold"})(gX||(gX={}));var pX;(function(s){s[s.Left=1]="Left",s[s.Center=2]="Center",s[s.Right=4]="Right",s[s.Full=7]="Full"})(pX||(pX={}));var fX;(function(s){s[s.Default=1]="Default",s[s.Top=2]="Top",s[s.Center=3]="Center",s[s.CenterIfOutsideViewport=4]="CenterIfOutsideViewport",s[s.NearTopIfOutsideViewport=5]="NearTopIfOutsideViewport",s[s.FirstLineIfOutsideViewport=6]="FirstLineIfOutsideViewport"})(fX||(fX={}));var mX;(function(s){s[s.Default=1]="Default",s[s.Center=2]="Center",s[s.CenterIfOutsideViewport=3]="CenterIfOutsideViewport"})(mX||(mX={}));var vX;(function(s){s[s.Preview=0]="Preview",s[s.Editing=1]="Editing"})(vX||(vX={}));var _X;(function(s){s[s.Container=0]="Container",s[s.Editor=1]="Editor",s[s.Output=2]="Output",s[s.ChatInput=3]="ChatInput"})(_X||(_X={}));var bX;(function(s){s[s.None=0]="None",s[s.Top=1]="Top",s[s.Bottom=2]="Bottom",s[s.Both=3]="Both"})(bX||(bX={}));var yX;(function(s){s[s.None=0]="None",s[s.Start=1]="Start",s[s.End=2]="End",s[s.Both=3]="Both"})(yX||(yX={}));function rl(s){if(!s)return;if(s.getId()===Loe)return s.getControl();if(s.getId()===OCe)return s.getControl().inlineNotebookEditor;const e=s.input;if(e&&SRe(e))return s.getControl()?.notebookEditor}var wX;(function(s){s[s.None=0]="None",s[s.Expanded=1]="Expanded",s[s.Collapsed=2]="Collapsed"})(wX||(wX={}));class Hb extends mve{static is(e){return e instanceof Hb?!0:R.isUri(e.resource)&&ra(e.cellEdit)}static lift(e){return e instanceof Hb?e:new Hb(e.resource,e.cellEdit,e.notebookVersionId,e.metadata)}constructor(e,t,i=void 0,n){super(n),this.resource=e,this.cellEdit=t,this.notebookVersionId=i}}let SX=class{constructor(e,t,i,n,o,r,a){this._undoRedoGroup=e,this._progress=i,this._token=n,this._edits=o,this._editorService=r,this._notebookModelService=a,this._edits=this._edits.map(c=>{if(c.resource.scheme===ud.scheme){const d=ud.parse(c.resource)?.notebook;if(!d)throw new Error(`Invalid notebook URI: ${c.resource}`);return new Hb(d,c.cellEdit,c.notebookVersionId,c.metadata)}else return c})}async apply(){const e=[],t=GT(this._edits,(i,n)=>NT(i.resource.toString(),n.resource.toString()));for(const i of t){if(this._token.isCancellationRequested)break;const[n]=i,o=await this._notebookModelService.resolve(n.resource);if(typeof n.notebookVersionId=="number"&&o.object.notebook.versionId!==n.notebookVersionId)throw o.dispose(),new Error(`Notebook '${n.resource}' has changed in the meantime`);const r=i.map(l=>l.cellEdit),a=!o.object.isReadonly(),c=rl(this._editorService.activeEditorPane),d=c?.textModel?.uri.toString()===o.object.notebook.uri.toString()?{kind:oW.Index,focus:c.getFocus(),selections:c.getSelections()}:void 0;o.object.notebook.applyEdits(r,!0,d,()=>{},this._undoRedoGroup,a),o.dispose(),this._progress.report(void 0),e.push(n.resource)}return e}};SX=f([p(5,de),p(6,II)],SX);let CX=class{constructor(e,t,i,n){this._bulkEditService=t,this._logService=i,this._uriIdentService=n}dispose(){}$tryApplyWorkspaceEdit(e,t,i){const n=Au(e.value,this._uriIdentService);return this._bulkEditService.apply(n,{undoRedoGroupId:t,respectAutoSaveConfig:i}).then(o=>o.isApplied,o=>(this._logService.warn(`IGNORING workspace edit: ${o}`),!1))}};CX=f([ht(qe.MainThreadBulkEdits),p(1,yw),p(2,Re),p(3,nn)],CX);function Au(s,e,t){if(!s||!s.edits)return s;const i=gn(s);for(const n of i.edits){if(hne.is(n)&&(n.resource=e.asCanonicalUri(n.resource)),sc.is(n)){if(n.options){const o=n.options?.contents;if(o)if(o.type==="base64")n.options.contents=Promise.resolve(vz(o.value));else if(t)n.options.contents=t(o.id);else throw new Error("Could not revive data transfer file")}n.newResource=n.newResource&&e.asCanonicalUri(n.newResource),n.oldResource=n.oldResource&&e.asCanonicalUri(n.oldResource)}if(Hb.is(n)){n.resource=e.asCanonicalUri(n.resource);const o=n.cellEdit;o.editType===sl.Replace&&(n.cellEdit={...o,cells:o.cells.map(r=>({...r,outputs:r.outputs.map(a=>({...a,outputs:a.items.map(c=>({mime:c.mime,data:c.valueBytes}))}))}))})}}return s}async function EO(s,e){const t=e==="image/gif";return typeof s=="string"&&(s=sde(s)),new Promise((i,n)=>{const o=new Blob([s],{type:e}),r=new Image,a=URL.createObjectURL(o);r.src=a,r.onload=()=>{URL.revokeObjectURL(a);let{width:c,height:d}=r;if((c<=768||d<=768)&&!t){i(s);return}if(c>2048||d>2048){const m=2048/Math.max(c,d);c=Math.round(c*m),d=Math.round(d*m)}const l=768/Math.min(c,d);c=Math.round(c*l),d=Math.round(d*l);const u=document.createElement("canvas");u.width=c,u.height=d;const g=u.getContext("2d");g?(g.drawImage(r,0,0,c,d),u.toBlob(m=>{if(m){const v=new FileReader;v.onload=()=>{i(new Uint8Array(v.result))},v.onerror=_=>n(_),v.readAsArrayBuffer(m)}else n(new Error("Failed to create blob from canvas"))},"image/png")):n(new Error("Failed to get canvas context"))},r.onerror=c=>{URL.revokeObjectURL(a),n(c)}})}function sde(s){const e=s.includes(",")?s.split(",")[1]:s;return xRe(e)?Uint8Array.from(atob(e),t=>t.charCodeAt(0)):new TextEncoder().encode(s)}function ERe(s){try{return new TextDecoder().decode(s)}catch{return""}}function xRe(s){return/^[A-Za-z0-9+/]*={0,2}$/.test(s)&&(()=>{try{return atob(s),!0}catch{return!1}})()}async function IRe(s,e,t,i){await s.exists(e)||await s.createFolder(e);const o=i.split("/")[1]||"png",r=`image-${Date.now()}.${o}`,a=Ct(e,r),c=Le.wrap(t);return await s.writeFile(a,c),a}async function DRe(s,e,t){if(!await s.exists(t))return;const n=7*24*60*60*1e3,o=await s.resolve(t);o.children&&await Promise.all(o.children.map(async r=>{try{const a=kRe(r.name);a&&Date.now()-a>n&&await s.del(r.resource)}catch(a){e.error("Failed to clean up old images",a)}}))}function kRe(s){const e=s.match(/image-(\d+)\./);if(e)return parseInt(e[1],10)}let EX=class{constructor(e,t,i,n,o,r,a,c){this._chatProviderService=t,this._languageModelStatsService=i,this._logService=n,this._authenticationService=o,this._authenticationAccessService=r,this._extensionService=a,this._ignoredFilesService=c,this._store=new U,this._providerRegistrations=new ti,this._pendingProgress=new Map,this._ignoredFileProviderRegistrations=new ti,this._proxy=e.getProxy(Ze.ExtHostChatProvider),this._proxy.$acceptChatModelMetadata({added:t.getLanguageModelIds().map(d=>({identifier:d,metadata:t.lookupLanguageModel(d)}))}),this._store.add(t.onDidChangeLanguageModels(this._proxy.$acceptChatModelMetadata,this._proxy))}dispose(){this._providerRegistrations.dispose(),this._ignoredFileProviderRegistrations.dispose(),this._store.dispose()}$registerLanguageModelProvider(e,t,i){const n=new U;n.add(this._chatProviderService.registerLanguageModelChat(t,{metadata:i,sendChatRequest:async(o,r,a,c)=>{const d=Math.random()*1e6|0,l=new aa,u=new une;try{this._pendingProgress.set(d,{defer:l,stream:u}),await Promise.all(o.flatMap(g=>g.content).filter(g=>g.type==="image_url").map(async g=>{g.value.data=Le.wrap(await EO(g.value.data.buffer))})),await this._proxy.$startChatRequest(e,d,r,new ta(o),a,c)}catch(g){throw this._pendingProgress.delete(d),g}return{result:l.p,stream:u.asyncIterable}},provideTokenCount:(o,r)=>this._proxy.$provideTokenLength(e,o,r)})),i.auth&&n.add(this._registerAuthenticationProvider(i.extension,i.auth)),this._providerRegistrations.set(e,n)}async $reportResponsePart(e,t){const i=this._pendingProgress.get(e);this._logService.trace("[LM] report response PART",!!i,e,t),i&&i.stream.emitOne(t)}async $reportResponseDone(e,t){const i=this._pendingProgress.get(e);if(this._logService.trace("[LM] report response DONE",!!i,e,t),i)if(this._pendingProgress.delete(e),t){const n=Md.tryDeserialize(t)??zT(t);i.stream.reject(n),i.defer.error(n)}else i.stream.resolve(),i.defer.complete(void 0)}$unregisterProvider(e){this._providerRegistrations.deleteAndDispose(e)}$selectChatModels(e){return this._chatProviderService.selectLanguageModels(e)}$whenLanguageModelChatRequestMade(e,t,i,n){this._languageModelStatsService.update(e,t,i,n)}async $tryStartChatRequest(e,t,i,n,o,r){this._logService.trace("[CHAT] request STARTED",e.value,i);let a;try{a=await this._chatProviderService.sendChatRequest(t,e,n.value,o,r)}catch(d){throw this._logService.error("[CHAT] request FAILED",e.value,i,d),d}const c=(async()=>{try{for await(const d of a.stream)this._logService.trace("[CHAT] request PART",e.value,i,d),await this._proxy.$acceptResponsePart(i,d);this._logService.trace("[CHAT] request DONE",e.value,i)}catch(d){this._logService.error("[CHAT] extension request ERRORED in STREAM",bo(d,!0),e.value,i),this._proxy.$acceptResponseDone(i,DF(d))}})();Promise.allSettled([a.result,c]).then(()=>{this._logService.debug("[CHAT] extension request DONE",e.value,i),this._proxy.$acceptResponseDone(i,void 0)},d=>{this._logService.error("[CHAT] extension request ERRORED",bo(d,!0),e.value,i),this._proxy.$acceptResponseDone(i,DF(d))})}$countTokens(e,t,i){return this._chatProviderService.computeTokenLength(e,t,i)}_registerAuthenticationProvider(e,t){const i=Mce+e.value;if(this._authenticationService.getProviderIds().includes(i))return F.None;const n=t.accountLabel??h(2425,"Language Models"),o=new U;return this._authenticationService.registerAuthenticationProvider(i,new TRe(i,t.providerLabel,n)),o.add(Ie(()=>{this._authenticationService.unregisterAuthenticationProvider(i)})),o.add(this._authenticationAccessService.onDidChangeExtensionSessionAccess(async r=>{const a=this._authenticationAccessService.readAllowedExtensions(i,n),c=[];for(const d of a){const l=await this._extensionService.getExtension(d.id);l&&c.push({from:l.identifier,to:e,enabled:d.allowed??!0})}this._proxy.$updateModelAccesslist(c)})),o}$fileIsIgnored(e,t){return this._ignoredFilesService.fileIsIgnored(R.revive(e),t)}$registerFileIgnoreProvider(e){this._ignoredFileProviderRegistrations.set(e,this._ignoredFilesService.registerIgnoredFileProvider({isFileIgnored:async(t,i)=>this._proxy.$isFileIgnored(e,t,i)}))}$unregisterFileIgnoreProvider(e){this._ignoredFileProviderRegistrations.deleteAndDispose(e)}};EX=f([ht(qe.MainThreadLanguageModels),p(1,Tw),p(2,yre),p(3,Re),p(4,Pw),p(5,FN),p(6,cn),p(7,Pq)],EX);class TRe{constructor(e,t,i){this.id=e,this.label=t,this._accountLabel=i,this.supportsMultipleAccounts=!1,this._onDidChangeSessions=new M,this.onDidChangeSessions=this._onDidChangeSessions.event}async getSessions(e){return e===void 0&&!this._session?[]:this._session?[this._session]:[await this.createSession(e||[])]}async createSession(e){return this._session=this._createFakeSession(e),this._onDidChangeSessions.fire({added:[this._session],changed:[],removed:[]}),this._session}removeSession(e){return this._session&&(this._onDidChangeSessions.fire({added:[],changed:[],removed:[this._session]}),this._session=void 0),Promise.resolve()}_createFakeSession(e){return{id:"fake-session",account:{id:this.id,label:this._accountLabel},accessToken:"fake-access-token",scopes:e}}}class Ut{static{this.sep="."}static{this.None=new Ut("@@none@@")}static{this.Empty=new Ut("")}constructor(e){this.value=e}equals(e){return this.value===e.value}contains(e){return this.equals(e)||this.value===""||e.value.startsWith(this.value+Ut.sep)}intersects(e){return this.contains(e)||e.contains(this)}append(...e){return new Ut((this.value?[this.value,...e]:e).join(Ut.sep))}}const ho={EDITORS:"CodeEditors",FILES:"CodeFiles",SYMBOLS:"application/vnd.code.symbols",MARKERS:"application/vnd.code.diagnostics",NOTEBOOK_CELL_OUTPUT:"notebook-cell-output"};function ode(s){const e=[];if(s.dataTransfer&&s.dataTransfer.types.length>0){const n=s.dataTransfer.getData(ho.EDITORS);if(n)try{e.push(...nne(n))}catch{}else try{const a=s.dataTransfer.getData(Ds.RESOURCES);e.push(...ade(a))}catch{}if(s.dataTransfer?.files)for(let a=0;a<s.dataTransfer.files.length;a++){const c=s.dataTransfer.files[a];if(c&&uv(c))try{e.push({resource:R.file(uv(c)),isExternal:!0,allowWorkspaceOpen:!0})}catch{}}const o=s.dataTransfer.getData(ho.FILES);if(o)try{const a=JSON.parse(o);for(const c of a)e.push({resource:R.file(c),isExternal:!0,allowWorkspaceOpen:!0})}catch{}const r=Ke.as(UK.DragAndDropContribution).getAll();for(const a of r){const c=s.dataTransfer.getData(a.dataFormatKey);if(c)try{e.push(...a.getEditorInputs(c))}catch{}}}const t=[],i=new In;for(const n of e)n.resource?i.has(n.resource)||(t.push(n),i.set(n.resource,!0)):t.push(n);return t}async function rde(s,e){const t=ode(e);if(e.dataTransfer&&Kt&&To(e,Ds.FILES)&&e.dataTransfer.items){const o=await s.get(Z).invokeFunction(r=>ARe(r,e));for(const r of o)t.push({resource:r.resource,contents:r.contents?.toString(),isExternal:!0,allowWorkspaceOpen:r.isDirectory})}return t}function ade(s){const e=[];if(s){const t=JSON.parse(s);for(const i of t)if(i.indexOf(":")>0){const{selection:n,uri:o}=gne(R.parse(i));e.push({resource:o,options:{selection:n}})}}return e}async function ARe(s,e){if(OE.supported(zi)){const i=e.dataTransfer?.items;if(i)return RRe(s,i)}const t=e.dataTransfer?.files;return t?PRe(s,t):[]}async function RRe(s,e){const t=s.get(je).getProvider(ae.file);if(!(t instanceof jSe))return[];const i=[];for(let n=0;n<e.length;n++){const o=e[n];if(o){const r=new aa;i.push(r),(async()=>{try{const a=await o.getAsFileSystemHandle();if(!a){r.complete(void 0);return}OE.isFileSystemFileHandle(a)?r.complete({resource:await t.registerFileHandle(a),isDirectory:!1}):OE.isFileSystemDirectoryHandle(a)?r.complete({resource:await t.registerDirectoryHandle(a),isDirectory:!0}):r.complete(void 0)}catch{r.complete(void 0)}})()}}return $t(await Promise.all(i.map(n=>n.p)))}async function PRe(s,e){const t=s.get(ei),i=[];for(let n=0;n<e.length;n++){const o=e.item(n);if(o){if(o.size>100*qo.MB){t.warn(h(1747,"File is too large to open as untitled editor. Please upload it first into the file explorer and then try again."));continue}const r=new aa;i.push(r);const a=new FileReader;a.onerror=()=>r.complete(void 0),a.onabort=()=>r.complete(void 0),a.onload=async c=>{const d=o.name,l=c.target?.result??void 0;if(typeof d!="string"||typeof l>"u"){r.complete(void 0);return}r.complete({resource:R.from({scheme:ae.untitled,path:d}),contents:typeof l=="string"?Le.fromString(l):Le.wrap(new Uint8Array(l))})},a.readAsArrayBuffer(o)}}return $t(await Promise.all(i.map(n=>n.p)))}function To(s,...e){if(!s.dataTransfer)return!1;const t=s.dataTransfer.types,i=[];for(let n=0;n<t.length;n++)i.push(t[n].toLowerCase());for(const n of e)if(i.indexOf(n.toLowerCase())>=0)return!0;return!1}class LRe{constructor(){this._contributions=new Map}register(e){if(this._contributions.has(e.dataFormatKey))throw new Error(`A drag and drop contributiont with key '${e.dataFormatKey}' was already registered.`);this._contributions.set(e.dataFormatKey,e)}getAll(){return this._contributions.values()}}const UK={DragAndDropContribution:"workbench.contributions.dragAndDrop"};Ke.add(UK.DragAndDropContribution,new LRe);class Ru{static{this.INSTANCE=new Ru}constructor(){}static getInstance(){return Ru.INSTANCE}hasData(e){return e&&e===this.proto}clearData(e){this.hasData(e)&&(this.proto=void 0,this.data=void 0)}getData(e){if(this.hasData(e))return this.data}setData(e,t){t&&(this.data=e,this.proto=t)}}function MRe(s,e,t){s.dataTransfer?.setData(e,JSON.stringify(t))}function $K(s,e,t){const i=s.dataTransfer?.getData(e);if(i)try{return JSON.parse(i)}catch{}return t}function NRe(s){return $K(s,ho.SYMBOLS,[])}function cde(s,e){MRe(e,ho.SYMBOLS,s)}function ORe(s){return $K(s,ho.MARKERS,void 0)}function FRe(s){return $K(s,ho.NOTEBOOK_CELL_OUTPUT,void 0)}function uv(s){if(ca&&typeof globalThis.vscode?.webUtils?.getPathForFile=="function")return globalThis.vscode.webUtils.getPathForFile(s)}function dde(s){const e=new JI;for(const t of s.items){const i=t.type;if(t.kind==="string"){const n=new Promise(o=>t.getAsString(o));e.append(i,Xw(n))}else if(t.kind==="file"){const n=t.getAsFile();n&&e.append(i,WRe(n))}}return e}function WRe(s){const e=uv(s),t=e?R.parse(e):void 0;return Tke(s.name,t,async()=>new Uint8Array(await s.arrayBuffer()))}const BRe=Object.freeze([ho.EDITORS,ho.FILES,Ds.RESOURCES,Ds.INTERNAL_URI_LIST]);function lde(s,e=!1){const t=dde(s),i=t.get(Ds.INTERNAL_URI_LIST);if(i)t.replace(Si.uriList,i);else if(e||!t.has(Si.uriList)){const n=[];for(const o of s.items){const r=o.getAsFile();if(r){const a=uv(r);try{a?n.push(R.file(a).toString()):n.push(R.parse(r.name,!0).toString())}catch{}}}n.length&&t.replace(Si.uriList,Xw(hl.create(n)))}for(const n of BRe)t.delete(n);return t}const VRe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(VRe);const HRe=Zt.register({description:"inline-progress-widget",stickiness:ki.NeverGrowsWhenTypingAtEdges,showIfCollapsed:!0,after:{content:pne,inlineClassName:"inline-editor-progress-decoration",inlineClassNameAffectsLetterSpacing:!0}});class GK extends F{static{this.baseId="editor.widget.inlineProgressWidget"}constructor(e,t,i,n,o){super(),this.typeId=e,this.editor=t,this.range=i,this.delegate=o,this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this.create(n),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this)}create(e){this.domNode=j(".inline-progress-widget"),this.domNode.role="button",this.domNode.title=e;const t=j("span.icon");this.domNode.append(t),t.classList.add(...ke.asClassNameArray(K.loading),"codicon-modifier-spin");const i=()=>{const n=this.editor.getOption(L.lineHeight);this.domNode.style.height=`${n}px`,this.domNode.style.width=`${Math.ceil(.8*n)}px`};i(),this._register(this.editor.onDidChangeConfiguration(n=>{(n.hasChanged(L.fontSize)||n.hasChanged(L.lineHeight))&&i()})),this._register(re(this.domNode,pe.CLICK,n=>{this.delegate.cancel()}))}getId(){return GK.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:{lineNumber:this.range.startLineNumber,column:this.range.startColumn},preference:[Fi.EXACT]}}dispose(){super.dispose(),this.editor.removeContentWidget(this)}}let KR=class extends F{constructor(e,t,i){super(),this.id=e,this._editor=t,this._instantiationService=i,this._showDelay=500,this._showPromise=this._register(new Pt),this._currentWidget=this._register(new Pt),this._operationIdPool=0,this._currentDecorations=t.createDecorationsCollection()}dispose(){super.dispose(),this._currentDecorations.clear()}async showWhile(e,t,i,n,o){const r=this._operationIdPool++;this._currentOperation=r,this.clear(),this._showPromise.value=Lp(()=>{const a=P.fromPositions(e);this._currentDecorations.set([{range:a,options:HRe}]).length>0&&(this._currentWidget.value=this._instantiationService.createInstance(GK,this.id,this._editor,a,t,n))},o??this._showDelay);try{return await i}finally{this._currentOperation===r&&(this.clear(),this._currentOperation=void 0)}}clear(){this._showPromise.clear(),this._currentDecorations.clear(),this._currentWidget.clear()}};KR=f([p(2,Z)],KR);class zK{constructor(e){this.copyMimeTypes=[],this.kind=e,this.providedDropEditKinds=[this.kind],this.providedPasteEditKinds=[this.kind]}async provideDocumentPasteEdits(e,t,i,n,o){const r=await this.getEdit(i,o);if(r)return{edits:[{insertText:r.insertText,title:r.title,kind:r.kind,handledMimeType:r.handledMimeType,yieldTo:r.yieldTo}],dispose(){}}}async provideDocumentDropEdits(e,t,i,n){const o=await this.getEdit(i,n);if(o)return{edits:[{insertText:o.insertText,title:o.title,kind:o.kind,handledMimeType:o.handledMimeType,yieldTo:o.yieldTo}],dispose(){}}}}class gv extends zK{static{this.id="text"}constructor(){super(Ut.Empty.append("text","plain")),this.id=gv.id,this.dropMimeTypes=[Si.text],this.pasteMimeTypes=[Si.text]}async getEdit(e,t){const i=e.get(Si.text);if(!i||e.has(Si.uriList))return;const n=await i.asString();return{handledMimeType:Si.text,title:h(989,"Insert Plain Text"),insertText:n,kind:this.kind}}}class hde extends zK{constructor(){super(Ut.Empty.append("uri","path","absolute")),this.dropMimeTypes=[Si.uriList],this.pasteMimeTypes=[Si.uriList]}async getEdit(e,t){const i=await ude(e);if(!i.length||t.isCancellationRequested)return;let n=0;const o=i.map(({uri:a,originalText:c})=>a.scheme===ae.file?a.fsPath:(n++,c)).join(" ");let r;return n>0?r=i.length>1?h(990,"Insert Uris"):h(991,"Insert Uri"):r=i.length>1?h(992,"Insert Paths"):h(993,"Insert Path"),{handledMimeType:Si.uriList,insertText:o,title:r,kind:this.kind}}}let jR=class extends zK{constructor(e){super(Ut.Empty.append("uri","path","relative")),this._workspaceContextService=e,this.dropMimeTypes=[Si.uriList],this.pasteMimeTypes=[Si.uriList]}async getEdit(e,t){const i=await ude(e);if(!i.length||t.isCancellationRequested)return;const n=$t(i.map(({uri:o})=>{const r=this._workspaceContextService.getWorkspaceFolder(o);return r?Gu(r.uri,o):void 0}));if(n.length)return{handledMimeType:Si.uriList,insertText:n.join(" "),title:i.length>1?h(994,"Insert Relative Paths"):h(995,"Insert Relative Path"),kind:this.kind}}};jR=f([p(0,It)],jR);class URe{constructor(){this.kind=new Ut("html"),this.providedPasteEditKinds=[this.kind],this.copyMimeTypes=[],this.pasteMimeTypes=["text/html"],this._yieldTo=[{mimeType:Si.text}]}async provideDocumentPasteEdits(e,t,i,n,o){if(n.triggerKind!==RF.PasteAs&&!n.only?.contains(this.kind))return;const a=await i.get("text/html")?.asString();if(!(!a||o.isCancellationRequested))return{dispose(){},edits:[{insertText:a,yieldTo:this._yieldTo,title:h(996,"Insert HTML"),kind:this.kind}]}}}async function ude(s){const e=s.get(Si.uriList);if(!e)return[];const t=await e.asString(),i=[];for(const n of hl.parse(t))try{i.push({uri:R.parse(n),originalText:n})}catch{}return i}const vm={scheme:"*",hasAccessToAllModels:!0};let QV=class extends F{constructor(e,t){super(),this._register(e.documentDropEditProvider.register(vm,new gv)),this._register(e.documentDropEditProvider.register(vm,new hde)),this._register(e.documentDropEditProvider.register(vm,new jR(t)))}};QV=f([p(0,Ne),p(1,It)],QV);let XV=class extends F{constructor(e,t){super(),this._register(e.documentPasteEditProvider.register(vm,new gv)),this._register(e.documentPasteEditProvider.register(vm,new hde)),this._register(e.documentPasteEditProvider.register(vm,new jR(t))),this._register(e.documentPasteEditProvider.register(vm,new URe))}};XV=f([p(0,Ne),p(1,It)],XV);var Be;(function(s){s[s.Dollar=0]="Dollar",s[s.Colon=1]="Colon",s[s.Comma=2]="Comma",s[s.CurlyOpen=3]="CurlyOpen",s[s.CurlyClose=4]="CurlyClose",s[s.Backslash=5]="Backslash",s[s.Forwardslash=6]="Forwardslash",s[s.Pipe=7]="Pipe",s[s.Int=8]="Int",s[s.VariableName=9]="VariableName",s[s.Format=10]="Format",s[s.Plus=11]="Plus",s[s.Dash=12]="Dash",s[s.QuestionMark=13]="QuestionMark",s[s.EOF=14]="EOF"})(Be||(Be={}));class Fd{constructor(){this.value="",this.pos=0}static{this._table={[st.DollarSign]:Be.Dollar,[st.Colon]:Be.Colon,[st.Comma]:Be.Comma,[st.OpenCurlyBrace]:Be.CurlyOpen,[st.CloseCurlyBrace]:Be.CurlyClose,[st.Backslash]:Be.Backslash,[st.Slash]:Be.Forwardslash,[st.Pipe]:Be.Pipe,[st.Plus]:Be.Plus,[st.Dash]:Be.Dash,[st.QuestionMark]:Be.QuestionMark}}static isDigitCharacter(e){return e>=st.Digit0&&e<=st.Digit9}static isVariableCharacter(e){return e===st.Underline||e>=st.a&&e<=st.z||e>=st.A&&e<=st.Z}text(e){this.value=e,this.pos=0}tokenText(e){return this.value.substr(e.pos,e.len)}next(){if(this.pos>=this.value.length)return{type:Be.EOF,pos:this.pos,len:0};const e=this.pos;let t=0,i=this.value.charCodeAt(e),n;if(n=Fd._table[i],typeof n=="number")return this.pos+=1,{type:n,pos:e,len:1};if(Fd.isDigitCharacter(i)){n=Be.Int;do t+=1,i=this.value.charCodeAt(e+t);while(Fd.isDigitCharacter(i));return this.pos+=t,{type:n,pos:e,len:t}}if(Fd.isVariableCharacter(i)){n=Be.VariableName;do i=this.value.charCodeAt(e+ ++t);while(Fd.isVariableCharacter(i)||Fd.isDigitCharacter(i));return this.pos+=t,{type:n,pos:e,len:t}}n=Be.Format;do t+=1,i=this.value.charCodeAt(e+t);while(!isNaN(i)&&typeof Fd._table[i]>"u"&&!Fd.isDigitCharacter(i)&&!Fd.isVariableCharacter(i));return this.pos+=t,{type:n,pos:e,len:t}}}class Zw{constructor(){this._children=[]}appendChild(e){return e instanceof vr&&this._children[this._children.length-1]instanceof vr?this._children[this._children.length-1].value+=e.value:(e.parent=this,this._children.push(e)),this}replace(e,t){const{parent:i}=e,n=i.children.indexOf(e),o=i.children.slice(0);o.splice(n,1,...t),i._children=o,function r(a,c){for(const d of a)d.parent=c,r(d.children,d)}(t,i)}get children(){return this._children}get rightMostDescendant(){return this._children.length>0?this._children[this._children.length-1].rightMostDescendant:this}get snippet(){let e=this;for(;;){if(!e)return;if(e instanceof tD)return e;e=e.parent}}toString(){return this.children.reduce((e,t)=>e+t.toString(),"")}len(){return 0}}let vr=class ZV extends Zw{static escape(e){return e.replace(/\$|}|\\/g,"\\$&")}constructor(e){super(),this.value=e}toString(){return this.value}toTextmateString(){return ZV.escape(this.value)}len(){return this.value.length}clone(){return new ZV(this.value)}};class gde extends Zw{}class Zr extends gde{static compareByIndex(e,t){return e.index===t.index?0:e.isFinalTabstop?1:t.isFinalTabstop||e.index<t.index?-1:e.index>t.index?1:0}constructor(e){super(),this.index=e}get isFinalTabstop(){return this.index===0}get choice(){return this._children.length===1&&this._children[0]instanceof Jw?this._children[0]:void 0}toTextmateString(){let e="";return this.transform&&(e=this.transform.toTextmateString()),this.children.length===0&&!this.transform?`$${this.index}`:this.children.length===0?`\${${this.index}${e}}`:this.choice?`\${${this.index}|${this.choice.toTextmateString()}|${e}}`:`\${${this.index}:${this.children.map(t=>t.toTextmateString()).join("")}${e}}`}clone(){const e=new Zr(this.index);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}class Jw extends Zw{constructor(){super(...arguments),this.options=[]}appendChild(e){return e instanceof vr&&(e.parent=this,this.options.push(e)),this}toString(){return this.options[0].value}toTextmateString(){return this.options.map(e=>e.value.replace(/\||,|\\/g,"\\$&")).join(",")}len(){return this.options[0].len()}clone(){const e=new Jw;return this.options.forEach(e.appendChild,e),e}}class qK extends Zw{constructor(){super(...arguments),this.regexp=new RegExp("")}resolve(e){const t=this;let i=!1,n=e.replace(this.regexp,function(){return i=!0,t._replace(Array.prototype.slice.call(arguments,0,-2))});return!i&&this._children.some(o=>o instanceof zd&&!!o.elseValue)&&(n=this._replace([])),n}_replace(e){let t="";for(const i of this._children)if(i instanceof zd){let n=e[i.index]||"";n=i.resolve(n),t+=n}else t+=i.toString();return t}toString(){return""}toTextmateString(){return`/${this.regexp.source}/${this.children.map(e=>e.toTextmateString())}/${(this.regexp.ignoreCase?"i":"")+(this.regexp.global?"g":"")}`}clone(){const e=new qK;return e.regexp=new RegExp(this.regexp.source,(this.regexp.ignoreCase?"i":"")+(this.regexp.global?"g":"")),e._children=this.children.map(t=>t.clone()),e}}class zd extends Zw{constructor(e,t,i,n){super(),this.index=e,this.shorthandName=t,this.ifValue=i,this.elseValue=n}resolve(e){return this.shorthandName==="upcase"?e?e.toLocaleUpperCase():"":this.shorthandName==="downcase"?e?e.toLocaleLowerCase():"":this.shorthandName==="capitalize"?e?e[0].toLocaleUpperCase()+e.substr(1):"":this.shorthandName==="pascalcase"?e?this._toPascalCase(e):"":this.shorthandName==="camelcase"?e?this._toCamelCase(e):"":e&&typeof this.ifValue=="string"?this.ifValue:!e&&typeof this.elseValue=="string"?this.elseValue:e||""}_toPascalCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map(i=>i.charAt(0).toUpperCase()+i.substr(1)).join(""):e}_toCamelCase(e){const t=e.match(/[a-z0-9]+/gi);return t?t.map((i,n)=>n===0?i.charAt(0).toLowerCase()+i.substr(1):i.charAt(0).toUpperCase()+i.substr(1)).join(""):e}toTextmateString(){let e="${";return e+=this.index,this.shorthandName?e+=`:/${this.shorthandName}`:this.ifValue&&this.elseValue?e+=`:?${this.ifValue}:${this.elseValue}`:this.ifValue?e+=`:+${this.ifValue}`:this.elseValue&&(e+=`:-${this.elseValue}`),e+="}",e}clone(){return new zd(this.index,this.shorthandName,this.ifValue,this.elseValue)}}class $y extends gde{constructor(e){super(),this.name=e}resolve(e){let t=e.resolve(this);return this.transform&&(t=this.transform.resolve(t||"")),t!==void 0?(this._children=[new vr(t)],!0):!1}toTextmateString(){let e="";return this.transform&&(e=this.transform.toTextmateString()),this.children.length===0?`\${${this.name}${e}}`:`\${${this.name}:${this.children.map(t=>t.toTextmateString()).join("")}${e}}`}clone(){const e=new $y(this.name);return this.transform&&(e.transform=this.transform.clone()),e._children=this.children.map(t=>t.clone()),e}}function xX(s,e){const t=[...s];for(;t.length>0;){const i=t.shift();if(!e(i))break;t.unshift(...i.children)}}class tD extends Zw{get placeholderInfo(){if(!this._placeholders){const e=[];let t;this.walk(function(i){return i instanceof Zr&&(e.push(i),t=!t||t.index<i.index?i:t),!0}),this._placeholders={all:e,last:t}}return this._placeholders}get placeholders(){const{all:e}=this.placeholderInfo;return e}offset(e){let t=0,i=!1;return this.walk(n=>n===e?(i=!0,!1):(t+=n.len(),!0)),i?t:-1}fullLen(e){let t=0;return xX([e],i=>(t+=i.len(),!0)),t}enclosingPlaceholders(e){const t=[];let{parent:i}=e;for(;i;)i instanceof Zr&&t.push(i),i=i.parent;return t}resolveVariables(e){return this.walk(t=>(t instanceof $y&&t.resolve(e)&&(this._placeholders=void 0),!0)),this}appendChild(e){return this._placeholders=void 0,super.appendChild(e)}replace(e,t){return this._placeholders=void 0,super.replace(e,t)}toTextmateString(){return this.children.reduce((e,t)=>e+t.toTextmateString(),"")}clone(){const e=new tD;return this._children=this.children.map(t=>t.clone()),e}walk(e){xX(this.children,e)}}class fd{constructor(){this._scanner=new Fd,this._token={type:Be.EOF,pos:0,len:0}}static escape(e){return e.replace(/\$|}|\\/g,"\\$&")}static asInsertText(e){return new fd().parse(e).toString()}static guessNeedsClipboard(e){return/\${?CLIPBOARD/.test(e)}parse(e,t,i){const n=new tD;return this.parseFragment(e,n),this.ensureFinalTabstop(n,i??!1,t??!1),n}parseFragment(e,t){const i=t.children.length;for(this._scanner.text(e),this._token=this._scanner.next();this._parse(t););const n=new Map,o=[];t.walk(c=>(c instanceof Zr&&(c.isFinalTabstop?n.set(0,void 0):!n.has(c.index)&&c.children.length>0?n.set(c.index,c.children):o.push(c)),!0));const r=(c,d)=>{const l=n.get(c.index);if(!l)return;const u=new Zr(c.index);u.transform=c.transform;for(const g of l){const m=g.clone();u.appendChild(m),m instanceof Zr&&n.has(m.index)&&!d.has(m.index)&&(d.add(m.index),r(m,d),d.delete(m.index))}t.replace(c,[u])},a=new Set;for(const c of o)r(c,a);return t.children.slice(i)}ensureFinalTabstop(e,t,i){(t||i&&e.placeholders.length>0)&&(e.placeholders.find(o=>o.index===0)||e.appendChild(new Zr(0)))}_accept(e,t){if(e===void 0||this._token.type===e){const i=t?this._scanner.tokenText(this._token):!0;return this._token=this._scanner.next(),i}return!1}_backTo(e){return this._scanner.pos=e.pos+e.len,this._token=e,!1}_until(e){const t=this._token;for(;this._token.type!==e;){if(this._token.type===Be.EOF)return!1;if(this._token.type===Be.Backslash){const n=this._scanner.next();if(n.type!==Be.Dollar&&n.type!==Be.CurlyClose&&n.type!==Be.Backslash)return!1}this._token=this._scanner.next()}const i=this._scanner.value.substring(t.pos,this._token.pos).replace(/\\(\$|}|\\)/g,"$1");return this._token=this._scanner.next(),i}_parse(e){return this._parseEscaped(e)||this._parseTabstopOrVariableName(e)||this._parseComplexPlaceholder(e)||this._parseComplexVariable(e)||this._parseAnything(e)}_parseEscaped(e){let t;return(t=this._accept(Be.Backslash,!0))?(t=this._accept(Be.Dollar,!0)||this._accept(Be.CurlyClose,!0)||this._accept(Be.Backslash,!0)||t,e.appendChild(new vr(t)),!0):!1}_parseTabstopOrVariableName(e){let t;const i=this._token;return this._accept(Be.Dollar)&&(t=this._accept(Be.VariableName,!0)||this._accept(Be.Int,!0))?(e.appendChild(/^\d+$/.test(t)?new Zr(Number(t)):new $y(t)),!0):this._backTo(i)}_parseComplexPlaceholder(e){let t;const i=this._token;if(!(this._accept(Be.Dollar)&&this._accept(Be.CurlyOpen)&&(t=this._accept(Be.Int,!0))))return this._backTo(i);const o=new Zr(Number(t));if(this._accept(Be.Colon))for(;;){if(this._accept(Be.CurlyClose))return e.appendChild(o),!0;if(!this._parse(o))return e.appendChild(new vr("${"+t+":")),o.children.forEach(e.appendChild,e),!0}else if(o.index>0&&this._accept(Be.Pipe)){const r=new Jw;for(;;){if(this._parseChoiceElement(r)){if(this._accept(Be.Comma))continue;if(this._accept(Be.Pipe)&&(o.appendChild(r),this._accept(Be.CurlyClose)))return e.appendChild(o),!0}return this._backTo(i),!1}}else return this._accept(Be.Forwardslash)?this._parseTransform(o)?(e.appendChild(o),!0):(this._backTo(i),!1):this._accept(Be.CurlyClose)?(e.appendChild(o),!0):this._backTo(i)}_parseChoiceElement(e){const t=this._token,i=[];for(;!(this._token.type===Be.Comma||this._token.type===Be.Pipe);){let n;if((n=this._accept(Be.Backslash,!0))?n=this._accept(Be.Comma,!0)||this._accept(Be.Pipe,!0)||this._accept(Be.Backslash,!0)||n:n=this._accept(void 0,!0),!n)return this._backTo(t),!1;i.push(n)}return i.length===0?(this._backTo(t),!1):(e.appendChild(new vr(i.join(""))),!0)}_parseComplexVariable(e){let t;const i=this._token;if(!(this._accept(Be.Dollar)&&this._accept(Be.CurlyOpen)&&(t=this._accept(Be.VariableName,!0))))return this._backTo(i);const o=new $y(t);if(this._accept(Be.Colon))for(;;){if(this._accept(Be.CurlyClose))return e.appendChild(o),!0;if(!this._parse(o))return e.appendChild(new vr("${"+t+":")),o.children.forEach(e.appendChild,e),!0}else return this._accept(Be.Forwardslash)?this._parseTransform(o)?(e.appendChild(o),!0):(this._backTo(i),!1):this._accept(Be.CurlyClose)?(e.appendChild(o),!0):this._backTo(i)}_parseTransform(e){const t=new qK;let i="",n="";for(;!this._accept(Be.Forwardslash);){let o;if(o=this._accept(Be.Backslash,!0)){o=this._accept(Be.Forwardslash,!0)||o,i+=o;continue}if(this._token.type!==Be.EOF){i+=this._accept(void 0,!0);continue}return!1}for(;!this._accept(Be.Forwardslash);){let o;if(o=this._accept(Be.Backslash,!0)){o=this._accept(Be.Backslash,!0)||this._accept(Be.Forwardslash,!0)||o,t.appendChild(new vr(o));continue}if(!(this._parseFormatString(t)||this._parseAnything(t)))return!1}for(;!this._accept(Be.CurlyClose);){if(this._token.type!==Be.EOF){n+=this._accept(void 0,!0);continue}return!1}try{t.regexp=new RegExp(i,n)}catch{return!1}return e.transform=t,!0}_parseFormatString(e){const t=this._token;if(!this._accept(Be.Dollar))return!1;let i=!1;this._accept(Be.CurlyOpen)&&(i=!0);const n=this._accept(Be.Int,!0);if(n)if(i){if(this._accept(Be.CurlyClose))return e.appendChild(new zd(Number(n))),!0;if(!this._accept(Be.Colon))return this._backTo(t),!1}else return e.appendChild(new zd(Number(n))),!0;else return this._backTo(t),!1;if(this._accept(Be.Forwardslash)){const o=this._accept(Be.VariableName,!0);return!o||!this._accept(Be.CurlyClose)?(this._backTo(t),!1):(e.appendChild(new zd(Number(n),o)),!0)}else if(this._accept(Be.Plus)){const o=this._until(Be.CurlyClose);if(o)return e.appendChild(new zd(Number(n),void 0,o,void 0)),!0}else if(this._accept(Be.Dash)){const o=this._until(Be.CurlyClose);if(o)return e.appendChild(new zd(Number(n),void 0,void 0,o)),!0}else if(this._accept(Be.QuestionMark)){const o=this._until(Be.Colon);if(o){const r=this._until(Be.CurlyClose);if(r)return e.appendChild(new zd(Number(n),void 0,o,r)),!0}}else{const o=this._until(Be.CurlyClose);if(o)return e.appendChild(new zd(Number(n),void 0,void 0,o)),!0}return this._backTo(t),!1}_parseAnything(e){return this._token.type!==Be.EOF?(e.appendChild(new vr(this._scanner.tokenText(this._token))),this._accept(void 0),!0):!1}}function pde(s,e,t){return(typeof t.insertText=="string"?t.insertText==="":t.insertText.snippet==="")?{edits:t.additionalEdit?.edits??[]}:{edits:[...e.map(i=>new hne(s,{range:i,text:typeof t.insertText=="string"?fd.escape(t.insertText)+"$0":t.insertText.snippet,insertAsSnippet:!0})),...t.additionalEdit?.edits??[]]}}function fde(s){function e(r,a){return"mimeType"in r?r.mimeType===a.handledMimeType:!!a.kind&&r.kind.contains(a.kind)}const t=new Map;for(const r of s)for(const a of r.yieldTo??[])for(const c of s)if(c!==r&&e(a,c)){let d=t.get(r);d||(d=[],t.set(r,d)),d.push(c)}if(!t.size)return Array.from(s);const i=new Set,n=[];function o(r){if(!r.length)return[];const a=r[0];if(n.includes(a))return console.warn("Yield to cycle detected",a),r;if(i.has(a))return o(r.slice(1));let c=[];const d=t.get(a);return d&&(n.push(a),c=o(d),n.pop()),i.add(a),[...c,a,...o(r.slice(1))]}return o(Array.from(s))}const $Re=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var JV;Ve($Re);let eH=class extends F{static{JV=this}static{this.baseId="editor.widget.postEditWidget"}constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.typeId=e,this.editor=t,this.showCommand=n,this.range=o,this.edits=r,this.onSelectNewEdit=a,this.additionalActions=c,this._keybindingService=l,this._actionWidgetService=u,this.allowEditorOverflow=!0,this.suppressMouseDown=!0,this.create(),this.visibleContext=i.bindTo(d),this.visibleContext.set(!0),this._register(Ie(()=>this.visibleContext.reset())),this.editor.addContentWidget(this),this.editor.layoutContentWidget(this),this._register(Ie(()=>this.editor.removeContentWidget(this))),this._register(this.editor.onDidChangeCursorPosition(g=>{this.dispose()})),this._register(T.runAndSubscribe(l.onDidUpdateKeybindings,()=>{this._updateButtonTitle()}))}_updateButtonTitle(){const e=this._keybindingService.lookupKeybinding(this.showCommand.id)?.getLabel();this.button.element.title=this.showCommand.label+(e?` (${e})`:"")}create(){this.domNode=j(".post-edit-widget"),this.button=this._register(new zu(this.domNode,{supportIcons:!0})),this.button.label="$(insert)",this._register(re(this.domNode,pe.CLICK,()=>this.showSelector()))}getId(){return JV.baseId+"."+this.typeId}getDomNode(){return this.domNode}getPosition(){return{position:this.range.getEndPosition(),preference:[Fi.BELOW]}}showSelector(){const e=Bs(this.button.element),t={x:e.left+e.width,y:e.top+e.height};this._actionWidgetService.show("postEditWidget",!1,this.edits.allEdits.map((i,n)=>({kind:Jr.Action,item:i,label:i.title,disabled:!1,canPreview:!1,group:{title:"",icon:ke.fromId(n===this.edits.activeEditIndex?K.check.id:K.blank.id)}})),{onHide:()=>{this.editor.focus()},onSelect:i=>{this._actionWidgetService.hide(!1);const n=this.edits.allEdits.findIndex(o=>o===i);if(n!==this.edits.activeEditIndex)return this.onSelectNewEdit(n)}},t,this.editor.getDomNode()??void 0,this.additionalActions)}};eH=JV=f([p(8,fe),p(9,He),p(10,Ed)],eH);let YR=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this._id=e,this._editor=t,this._visibleContext=i,this._showCommand=n,this._getAdditionalActions=o,this._instantiationService=r,this._bulkEditService=a,this._notificationService=c,this._currentWidget=this._register(new Pt),this._register(T.any(t.onDidChangeModel,t.onDidChangeModelContent)(()=>this.clear()))}async applyEditAndShowIfNeeded(e,t,i,n,o){if(!e.length||!this._editor.hasModel())return;const r=this._editor.getModel(),a=t.allEdits.at(t.activeEditIndex);if(!a)return;const c=async C=>{const k=this._editor.getModel();k&&(await k.undo(),this.applyEditAndShowIfNeeded(e,{activeEditIndex:C,allEdits:t.allEdits},i,n,o))},d=(C,k)=>{ys(C)||(this._notificationService.error(k),i&&this.show(e[0],t,c))},l=new tv(this._editor,fs.Value|fs.Selection,void 0,o);let u;try{u=await KM(n(a,l.token),l.token)}catch(C){return d(C,h(1e3,`Error resolving edit '{0}':
{1}`,a.title,bo(C)))}finally{l.dispose()}if(o.isCancellationRequested)return;const g=pde(r.uri,e,u),m=e[0],v=r.deltaDecorations([],[{range:m,options:{description:"paste-line-suffix",stickiness:ki.AlwaysGrowsWhenTypingAtEdges}}]);this._editor.focus();let _,w;try{_=await this._bulkEditService.apply(g,{editor:this._editor,token:o}),w=r.getDecorationRange(v[0])}catch(C){return d(C,h(1001,`Error applying edit '{0}':
{1}`,a.title,bo(C)))}finally{r.deltaDecorations(v,[])}o.isCancellationRequested||i&&_.isApplied&&t.allEdits.length>1&&this.show(w??m,t,c)}show(e,t,i){this.clear(),this._editor.hasModel()&&(this._currentWidget.value=this._instantiationService.createInstance(eH,this._id,this._editor,this._visibleContext,this._showCommand,e,t,i,this._getAdditionalActions()))}clear(){this._currentWidget.clear()}tryShowSelector(){this._currentWidget.value?.showSelector()}};YR=f([p(5,Z),p(6,yw),p(7,Dt)],YR);var Wa;const mde="editor.changePasteType",GRe="editor.pasteAs.preferences",KK=new O("pasteWidgetVisible",!1,h(980,"Whether the paste widget is showing")),I1="application/vnd.code.copymetadata";let md=class extends F{static{Wa=this}static{this.ID="editor.contrib.copyPasteActionController"}static get(e){return e.getContribution(Wa.ID)}static setConfigureDefaultAction(e){Wa._configureDefaultAction=e}constructor(e,t,i,n,o,r,a,c,d){super(),this._bulkEditService=i,this._clipboardService=n,this._commandService=o,this._configService=r,this._languageFeaturesService=a,this._quickInputService=c,this._progressService=d,this._editor=e;const l=e.getContainerDomNode();this._register(re(l,"copy",u=>this.handleCopy(u))),this._register(re(l,"cut",u=>this.handleCopy(u))),this._register(re(l,"paste",u=>this.handlePaste(u),!0)),this._pasteProgressManager=this._register(new KR("pasteIntoEditor",e,t)),this._postPasteWidgetManager=this._register(t.createInstance(YR,"pasteIntoEditor",e,KK,{id:mde,label:h(981,"Show paste options...")},()=>Wa._configureDefaultAction?[Wa._configureDefaultAction]:[]))}changePasteType(){this._postPasteWidgetManager.tryShowSelector()}pasteAs(e){this._editor.focus();try{this._pasteAsActionContext={preferred:e},this._commandService.executeCommand("editor.action.clipboardPasteAction")}finally{this._pasteAsActionContext=void 0}}clearWidgets(){this._postPasteWidgetManager.clear()}isPasteAsEnabled(){return this._editor.getOption(L.pasteAs).enabled}async finishedPaste(){await this._currentPasteOperation}handleCopy(e){if(!this._editor.hasTextFocus()||(this._clipboardService.clearInternalState?.(),!e.clipboardData||!this.isPasteAsEnabled()))return;const t=this._editor.getModel(),i=this._editor.getSelections();if(!t||!i?.length)return;const n=this._editor.getOption(L.emptySelectionClipboard);let o=i;const r=i.length===1&&i[0].isEmpty();if(r){if(!n)return;o=[new P(o[0].startLineNumber,1,o[0].startLineNumber,1+t.getLineLength(o[0].startLineNumber))]}const a=this._editor._getViewModel()?.getPlainTextToCopy(i,n,bn),d={multicursorText:Array.isArray(a)?a:null,pasteOnNewLine:r,mode:null},l=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(_=>!!_.prepareDocumentPaste);if(!l.length){this.setCopyMetadata(e.clipboardData,{defaultPastePayload:d});return}const u=dde(e.clipboardData),g=l.flatMap(_=>_.copyMimeTypes??[]),m=Pn();this.setCopyMetadata(e.clipboardData,{id:m,providerCopyMimeTypes:g,defaultPastePayload:d});const v=l.map(_=>({providerMimeTypes:_.copyMimeTypes,operation:Tn(w=>_.prepareDocumentPaste(t,o,u,w).catch(C=>{console.error(C)}))}));Wa._currentCopyOperation?.operations.forEach(_=>_.operation.cancel()),Wa._currentCopyOperation={handle:m,operations:v}}async handlePaste(e){if(!e.clipboardData||!this._editor.hasTextFocus())return;Dr.get(this._editor)?.closeMessage(),this._currentPasteOperation?.cancel(),this._currentPasteOperation=void 0;const t=this._editor.getModel(),i=this._editor.getSelections();if(!i?.length||!t||this._editor.getOption(L.readOnly)||!this.isPasteAsEnabled()&&!this._pasteAsActionContext)return;const n=this.fetchCopyMetadata(e),o=lde(e.clipboardData);o.delete(I1);const r=Array.from(e.clipboardData.files).map(d=>d.type),a=[...e.clipboardData.types,...r,...n?.providerCopyMimeTypes??[],Si.uriList],c=this._languageFeaturesService.documentPasteEditProvider.ordered(t).filter(d=>{const l=this._pasteAsActionContext?.preferred;return l&&!this.providerMatchesPreference(d,l)?!1:d.pasteMimeTypes?.some(u=>$j(u,a))});if(!c.length){this._pasteAsActionContext?.preferred&&(this.showPasteAsNoEditMessage(i,this._pasteAsActionContext.preferred),e.preventDefault(),e.stopImmediatePropagation());return}e.preventDefault(),e.stopImmediatePropagation(),this._pasteAsActionContext?this.showPasteAsPick(this._pasteAsActionContext.preferred,c,i,o,n):this.doPasteInline(c,i,o,n,e)}showPasteAsNoEditMessage(e,t){const i="only"in t?t.only.value:"preferences"in t?t.preferences.length?t.preferences.map(n=>n.value).join(", "):h(982,"empty"):t.providerId;Dr.get(this._editor)?.showMessage(h(983,"No paste edits for '{0}' found",i),e[0].getStartPosition())}doPasteInline(e,t,i,n,o){const r=this._editor;if(!r.hasModel())return;const a=new tv(r,fs.Value|fs.Selection,void 0),c=Tn(async d=>{const l=this._editor;if(!l.hasModel())return;const u=l.getModel(),g=new U,m=g.add(new li(d));g.add(a.token.onCancellationRequested(()=>m.cancel()));const v=m.token;try{if(await this.mergeInDataFromCopy(e,i,n,v),v.isCancellationRequested)return;const _=e.filter(k=>this.isSupportedPasteProvider(k,i));if(!_.length||_.length===1&&_[0]instanceof gv)return this.applyDefaultPasteHandler(i,n,v,o);const w={triggerKind:RF.Automatic},C=await this.getPasteEdits(_,i,u,t,w,v);if(g.add(C),v.isCancellationRequested)return;if(C.edits.length===1&&C.edits[0].provider instanceof gv)return this.applyDefaultPasteHandler(i,n,v,o);if(C.edits.length){const k=l.getOption(L.pasteAs).showPasteSelector==="afterPaste";return this._postPasteWidgetManager.applyEditAndShowIfNeeded(t,{activeEditIndex:this.getInitialActiveEditIndex(u,C.edits),allEdits:C.edits},k,async(D,A)=>{if(!D.provider.resolveDocumentPasteEdit)return D;const B=D.provider.resolveDocumentPasteEdit(D,A),q=new aa,Q=await this._pasteProgressManager.showWhile(t[0].getEndPosition(),h(984,"Resolving paste edit for '{0}'. Click to cancel",D.title),Sh(Promise.race([q.p,B]),A),{cancel:()=>q.cancel()},0);return Q&&(D.insertText=Q.insertText,D.additionalEdit=Q.additionalEdit),D},v)}await this.applyDefaultPasteHandler(i,n,v,o)}finally{g.dispose(),this._currentPasteOperation===c&&(this._currentPasteOperation=void 0)}});this._pasteProgressManager.showWhile(t[0].getEndPosition(),h(985,"Running paste handlers. Click to cancel and do basic paste"),c,{cancel:async()=>{try{if(c.cancel(),a.token.isCancellationRequested)return;await this.applyDefaultPasteHandler(i,n,a.token,o)}finally{a.dispose()}}}).then(()=>{a.dispose()}),this._currentPasteOperation=c}showPasteAsPick(e,t,i,n,o){const r=Tn(async a=>{const c=this._editor;if(!c.hasModel())return;const d=c.getModel(),l=new U,u=l.add(new tv(c,fs.Value|fs.Selection,void 0,a));try{if(await this.mergeInDataFromCopy(t,n,o,u.token),u.token.isCancellationRequested)return;let g=t.filter(C=>this.isSupportedPasteProvider(C,n,e));e&&(g=g.filter(C=>this.providerMatchesPreference(C,e)));const m={triggerKind:RF.PasteAs,only:e&&"only"in e?e.only:void 0};let v=l.add(await this.getPasteEdits(g,n,d,i,m,u.token));if(u.token.isCancellationRequested)return;if(e&&(v={edits:v.edits.filter(C=>"only"in e?e.only.contains(C.kind):"preferences"in e?e.preferences.some(k=>k.contains(C.kind)):e.providerId===C.provider.id),dispose:v.dispose}),!v.edits.length){e&&this.showPasteAsNoEditMessage(i,e);return}let _;if(e)_=v.edits.at(0);else{const C={id:"editor.pasteAs.default",label:h(986,"Configure default paste action"),edit:void 0},k=await this._quickInputService.pick([...v.edits.map(D=>({label:D.title,description:D.kind?.value,edit:D})),...Wa._configureDefaultAction?[yF({type:"separator"}),{label:Wa._configureDefaultAction.label,edit:void 0}]:[]],{placeHolder:h(987,"Select Paste Action")});if(k===C){Wa._configureDefaultAction?.run();return}_=k?.edit}if(!_)return;const w=pde(d.uri,i,_);await this._bulkEditService.apply(w,{editor:this._editor})}finally{l.dispose(),this._currentPasteOperation===r&&(this._currentPasteOperation=void 0)}});this._progressService.withProgress({location:Xo.Window,title:h(988,"Running paste handlers")},()=>r)}setCopyMetadata(e,t){e.setData(I1,JSON.stringify(t))}fetchCopyMetadata(e){if(!e.clipboardData)return;const t=e.clipboardData.getData(I1);if(t)try{return JSON.parse(t)}catch{return}const[i,n]=uSe.getTextData(e.clipboardData);if(n)return{defaultPastePayload:{mode:n.mode,multicursorText:n.multicursorText??null,pasteOnNewLine:!!n.isFromEmptySelection}}}async mergeInDataFromCopy(e,t,i,n){if(i?.id&&Wa._currentCopyOperation?.handle===i.id){const o=Wa._currentCopyOperation.operations.filter(a=>e.some(c=>c.pasteMimeTypes.some(d=>$j(d,a.providerMimeTypes)))).map(a=>a.operation),r=await Promise.all(o);if(n.isCancellationRequested)return;for(const a of r.reverse())if(a)for(const[c,d]of a)t.replace(c,d)}if(!t.has(Si.uriList)){const o=await this._clipboardService.readResources();if(n.isCancellationRequested)return;o.length&&t.append(Si.uriList,Xw(hl.create(o)))}}async getPasteEdits(e,t,i,n,o,r){const a=new U,c=await Sh(Promise.all(e.map(async l=>{try{const u=await l.provideDocumentPasteEdits?.(i,n,t,o,r);return u&&a.add(u),u?.edits?.map(g=>({...g,provider:l}))}catch(u){ys(u)||console.error(u);return}})),r),d=$t(c??[]).flat().filter(l=>!o.only||o.only.contains(l.kind));return{edits:fde(d),dispose:()=>a.dispose()}}async applyDefaultPasteHandler(e,t,i,n){const r=await(e.get(Si.text)??e.get("text"))?.asString()??"";if(i.isCancellationRequested)return;const a={clipboardEvent:n,text:r,pasteOnNewLine:t?.defaultPastePayload.pasteOnNewLine??!1,multicursorText:t?.defaultPastePayload.multicursorText??null,mode:null};this._editor.trigger("keyboard",Lz.Paste,a)}isSupportedPasteProvider(e,t,i){return e.pasteMimeTypes?.some(n=>t.matches(n))?!i||this.providerMatchesPreference(e,i):!1}providerMatchesPreference(e,t){return"only"in t?e.providedPasteEditKinds.some(i=>t.only.contains(i)):"preferences"in t?t.preferences.some(i=>t.preferences.some(n=>n.contains(i))):e.id===t.providerId}getInitialActiveEditIndex(e,t){const i=this._configService.getValue(GRe,{resource:e.uri});for(const n of Array.isArray(i)?i:[]){const o=new Ut(n),r=t.findIndex(a=>o.contains(a.kind));if(r>=0)return r}return 0}};md=Wa=f([p(1,Z),p(2,yw),p(3,Vs),p(4,Ge),p(5,ne),p(6,Ne),p(7,Wt),p(8,pl)],md);var tu;const zRe="editor.dropIntoEditor.preferences",vde="editor.changeDropType",jK=new O("dropWidgetVisible",!1,h(997,"Whether the drop widget is showing"));let tg=class extends F{static{tu=this}static{this.ID="editor.contrib.dropIntoEditorController"}static get(e){return e.getContribution(tu.ID)}static setConfigureDefaultAction(e){this._configureDefaultAction=e}constructor(e,t,i,n,o){super(),this._configService=i,this._languageFeaturesService=n,this._treeViewsDragAndDropService=o,this.treeItemsTransfer=Ru.getInstance(),this._dropProgressManager=this._register(t.createInstance(KR,"dropIntoEditor",e)),this._postDropWidgetManager=this._register(t.createInstance(YR,"dropIntoEditor",e,jK,{id:vde,label:h(998,"Show drop options...")},()=>tu._configureDefaultAction?[tu._configureDefaultAction]:[])),this._register(e.onDropIntoEditor(r=>this.onDropIntoEditor(e,r.position,r.event)))}clearWidgets(){this._postDropWidgetManager.clear()}changeDropType(){this._postDropWidgetManager.tryShowSelector()}async onDropIntoEditor(e,t,i){if(!i.dataTransfer||!e.hasModel())return;tu._currentDropOperation?.cancel(),e.focus(),e.setPosition(t);const n=Tn(async o=>{const r=new U,a=r.add(new tv(e,fs.Value,void 0,o));try{const c=await this.extractDataTransferData(i);if(c.size===0||a.token.isCancellationRequested)return;const d=e.getModel();if(!d)return;const l=this._languageFeaturesService.documentDropEditProvider.ordered(d).filter(g=>g.dropMimeTypes?g.dropMimeTypes.some(m=>c.matches(m)):!0),u=r.add(await this.getDropEdits(l,d,t,c,a.token));if(a.token.isCancellationRequested)return;if(u.edits.length){const g=this.getInitialActiveEditIndex(d,u.edits),m=e.getOption(L.dropIntoEditor).showDropSelector==="afterDrop";await this._postDropWidgetManager.applyEditAndShowIfNeeded([P.fromPositions(t)],{activeEditIndex:g,allEdits:u.edits},m,async v=>v,o)}}finally{r.dispose(),tu._currentDropOperation===n&&(tu._currentDropOperation=void 0)}});this._dropProgressManager.showWhile(t,h(999,"Running drop handlers. Click to cancel"),n,{cancel:()=>n.cancel()}),tu._currentDropOperation=n}async getDropEdits(e,t,i,n,o){const r=new U,a=await Sh(Promise.all(e.map(async d=>{try{const l=await d.provideDocumentDropEdits(t,i,n,o);return l&&r.add(l),l?.edits.map(u=>({...u,providerId:d.id}))}catch(l){ys(l)||console.error(l),console.error(l)}})),o),c=$t(a??[]).flat();return{edits:fde(c),dispose:()=>r.dispose()}}getInitialActiveEditIndex(e,t){const i=this._configService.getValue(zRe,{resource:e.uri});for(const n of Array.isArray(i)?i:[]){const o=new Ut(n),r=t.findIndex(a=>a.kind&&o.contains(a.kind));if(r>=0)return r}return 0}async extractDataTransferData(e){if(!e.dataTransfer)return new JI;const t=lde(e.dataTransfer);if(this.treeItemsTransfer.hasData(fC.prototype)){const i=this.treeItemsTransfer.getData(fC.prototype);if(Array.isArray(i))for(const n of i){const o=await this._treeViewsDragAndDropService.removeDragOperationTransfer(n.identifier);if(o)for(const[r,a]of o)t.replace(r,a)}}return t}};tg=tu=f([p(1,Z),p(2,ne),p(3,Ne),p(4,kz)],tg);const _de="editor.action.showHover",qRe="editor.action.showDefinitionPreviewHover",KRe="editor.action.hideHover",jRe="editor.action.scrollUpHover",YRe="editor.action.scrollDownHover",QRe="editor.action.scrollLeftHover",XRe="editor.action.scrollRightHover",ZRe="editor.action.pageUpHover",JRe="editor.action.pageDownHover",ePe="editor.action.goToTopHover",tPe="editor.action.goToBottomHover",eS="editor.action.increaseHoverVerbosityLevel",iPe="editor.action.increaseHoverVerbosityLevelFromAccessibleView",nPe=h(1165,"Increase Hover Verbosity Level"),tS="editor.action.decreaseHoverVerbosityLevel",sPe="editor.action.decreaseHoverVerbosityLevelFromAccessibleView",oPe=h(1166,"Decrease Hover Verbosity Level"),px="editor.action.inlineSuggest.commit",bde="editor.action.inlineSuggest.showPrevious",yde="editor.action.inlineSuggest.showNext",wde="editor.action.inlineSuggest.jump",Sde="editor.action.inlineSuggest.hide",tH="editor.action.inlineSuggest.toggleShowCollapsed",rPe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var jS;Ve(rPe);let iH=class extends F{constructor(e,t,i){super(),this.editor=e,this.model=t,this.instantiationService=i,this.alwaysShowToolbar=kn(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(L.inlineSuggest).showToolbar==="always"),this.sessionPosition=void 0,this.position=ve(this,n=>{const o=this.model.read(n)?.primaryGhostText.read(n);if(!this.alwaysShowToolbar.read(n)||!o||o.parts.length===0)return this.sessionPosition=void 0,null;const r=o.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==o.lineNumber&&(this.sessionPosition=void 0);const a=new we(o.lineNumber,Math.min(r,this.sessionPosition?.column??Number.MAX_SAFE_INTEGER));return this.sessionPosition=a,a}),this._register(ka((n,o)=>{const r=this.model.read(n);if(!r||!this.alwaysShowToolbar.read(n))return;const a=Mv((d,l)=>{const u=l.add(this.instantiationService.createInstance(Gy.hot.read(d),this.editor,!0,this.position,r.selectedInlineCompletionIndex,r.inlineCompletionsCount,r.activeCommands,r.warning,()=>{}));return e.addContentWidget(u),l.add(Ie(()=>e.removeContentWidget(u))),l.add(fi(g=>{this.position.read(g)&&r.lastTriggerKind.read(g)!==Gc.Explicit&&r.triggerExplicitly()})),u}),c=Nv(this,(d,l)=>!!this.position.read(d)||!!l);o.add(fi(d=>{c.read(d)&&a.read(d)}))}))}};iH=f([p(2,Z)],iH);const aPe=Pe("inline-suggestion-hints-next",K.chevronRight,h(1266,"Icon for show next parameter hint.")),cPe=Pe("inline-suggestion-hints-previous",K.chevronLeft,h(1267,"Icon for show previous parameter hint."));let Gy=class extends F{static{jS=this}static{this.hot=lN(jS)}static{this._dropDownVisible=!1}static get dropDownVisible(){return this._dropDownVisible}static{this.id=0}createCommandAction(e,t,i){const n=new Xt(e,t,i,!0,()=>this._commandService.executeCommand(e)),o=this.keybindingService.lookupKeybinding(e,this._contextKeyService);let r=t;return o&&(r=h(1268,"{0} ({1})",t,o.getLabel())),n.tooltip=r,n}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.editor=e,this.withBorder=t,this._position=i,this._currentSuggestionIdx=n,this._suggestionCount=o,this._extraCommands=r,this._warning=a,this._relayout=c,this._commandService=d,this.keybindingService=u,this._contextKeyService=g,this._menuService=m,this.id=`InlineSuggestionHintsContentWidget${jS.id++}`,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._warningMessageContentNode=Mv((v,_)=>{const w=this._warning.read(v);return w?typeof w.message=="string"?w.message:_.add(Ez(w.message)).element:void 0}),this._warningMessageNode=dt.div({class:"warningMessage",style:{maxWidth:400,margin:4,marginBottom:4,display:ve(v=>this._warning.read(v)?"block":"none")}},[this._warningMessageContentNode]).keepUpdated(this._store),this.nodes=en("div.inlineSuggestionsHints",{className:this.withBorder?"monaco-hover monaco-hover-content":""},[this._warningMessageNode.element,en("div@toolBar")]),this.previousAction=this._register(this.createCommandAction(bde,h(1269,"Previous"),ke.asClassName(cPe))),this.availableSuggestionCountAction=this._register(new Xt("inlineSuggestionHints.availableSuggestionCount","",void 0,!1)),this.nextAction=this._register(this.createCommandAction(yde,h(1270,"Next"),ke.asClassName(aPe))),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(N.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new yn(()=>{this.availableSuggestionCountAction.label=""},100)),this.disableButtonsDebounced=this._register(new yn(()=>{this.previousAction.enabled=this.nextAction.enabled=!1},100)),this._register(fi(v=>{this._warningMessageContentNode.read(v),this._warningMessageNode.readEffect(v),this._relayout()})),this.toolBar=this._register(l.createInstance(nH,this.nodes.toolBar,N.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:v=>v.startsWith("primary")},actionViewItemProvider:(v,_)=>{if(v instanceof wr)return l.createInstance(lPe,v,void 0);if(v===this.availableSuggestionCountAction){const w=new dPe(void 0,v,{label:!0,icon:!1});return w.setClass("availableSuggestionCount"),w}},telemetrySource:"InlineSuggestionToolbar"})),this.toolBar.setPrependedPrimaryActions([this.previousAction,this.availableSuggestionCountAction,this.nextAction]),this._register(this.toolBar.onDidChangeDropdownVisibility(v=>{jS._dropDownVisible=v})),this._register(fi(v=>{this._position.read(v),this.editor.layoutContentWidget(this)})),this._register(fi(v=>{const _=this._suggestionCount.read(v),w=this._currentSuggestionIdx.read(v);_!==void 0?(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${w+1}/${_}`):this.clearAvailableSuggestionCountLabelDebounced.schedule(),_!==void 0&&_>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule()})),this._register(fi(v=>{const w=this._extraCommands.read(v).map(C=>({class:void 0,id:C.id,enabled:!0,tooltip:C.tooltip||"",label:C.title,run:k=>this._commandService.executeCommand(C.id)}));for(const[C,k]of this.inlineCompletionsActionsMenus.getActions())for(const D of k)D instanceof wr&&w.push(D);w.length>0&&w.unshift(new os),this.toolBar.setAdditionalSecondaryActions(w)}))}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[Fi.ABOVE,Fi.BELOW],positionAffinity:eI.LeftOfInjectedText}}};Gy=jS=f([p(8,Ge),p(9,Z),p(10,He),p(11,fe),p(12,fn)],Gy);class dPe extends Qm{constructor(){super(...arguments),this._className=void 0}setClass(e){this._className=e}render(e){super.render(e),this._className&&e.classList.add(this._className)}updateTooltip(){}}class lPe extends nI{updateLabel(){const e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService,!0);if(!e)return super.updateLabel();if(this.label){const t=en("div.keybinding").root;this._register(new VM(t,$u,{disableTitle:!0,...vve})).set(e),this.label.textContent=this._action.label,this.label.appendChild(t),this.label.classList.add("inlineSuggestionStatusBarItemLabel")}}updateTooltip(){}}let nH=class extends nq{constructor(e,t,i,n,o,r,a,c,d){super(e,{resetMenu:t,...i},n,o,r,a,c,d),this.menuId=t,this.options2=i,this.menuService=n,this.contextKeyService=o,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this.prependedPrimaryActions=[],this.additionalPrimaryActions=[],this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this.updateToolbar()}updateToolbar(){const{primary:e,secondary:t}=Xm(this.menu.getActions(this.options2?.menuOptions),this.options2?.toolbarOptions?.primaryGroup,this.options2?.toolbarOptions?.shouldInlineSubmenu,this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions);t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),e.push(...this.additionalPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){rs(this.prependedPrimaryActions,e,(t,i)=>t===i)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalPrimaryActions(e){rs(this.additionalPrimaryActions,e,(t,i)=>t===i)||(this.additionalPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){rs(this.additionalActions,e,(t,i)=>t===i)||(this.additionalActions=e,this.updateToolbar())}};nH=f([p(3,fn),p(4,fe),p(5,bi),p(6,He),p(7,Ge),p(8,ai)],nH);function xO(s,e,t){const i=Bs(s);return!(e<i.left||e>i.left+i.width||t<i.top||t>i.top+i.height)}var js;(function(s){s[s.Idle=0]="Idle",s[s.FirstWait=1]="FirstWait",s[s.SecondWait=2]="SecondWait",s[s.WaitingForAsync=3]="WaitingForAsync",s[s.WaitingForAsyncShowingLoading=4]="WaitingForAsyncShowingLoading"})(js||(js={}));var Ah;(function(s){s[s.Delayed=0]="Delayed",s[s.Immediate=1]="Immediate"})(Ah||(Ah={}));var al;(function(s){s[s.Mouse=0]="Mouse",s[s.Click=1]="Click",s[s.Keyboard=2]="Keyboard"})(al||(al={}));class hPe{constructor(e,t,i,n){this.value=e,this.isComplete=t,this.hasLoadingMessage=i,this.options=n}}class Cde extends F{constructor(e,t){super(),this._editor=e,this._computer=t,this._onResult=this._register(new M),this.onResult=this._onResult.event,this._asyncComputationScheduler=this._register(new D1(i=>this._triggerAsyncComputation(i),0)),this._syncComputationScheduler=this._register(new D1(i=>this._triggerSyncComputation(i),0)),this._loadingMessageScheduler=this._register(new D1(i=>this._triggerLoadingMessage(i),0)),this._state=js.Idle,this._asyncIterable=null,this._asyncIterableDone=!1,this._result=[]}dispose(){this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._options=void 0,super.dispose()}get _hoverTime(){return this._editor.getOption(L.hover).delay}get _firstWaitTime(){return this._hoverTime/2}get _secondWaitTime(){return this._hoverTime-this._firstWaitTime}get _loadingMessageTime(){return 3*this._hoverTime}_setState(e,t){this._options=t,this._state=e,this._fireResult(t)}_triggerAsyncComputation(e){this._setState(js.SecondWait,e),this._syncComputationScheduler.schedule(e,this._secondWaitTime),this._computer.computeAsync?(this._asyncIterableDone=!1,this._asyncIterable=_ve(t=>this._computer.computeAsync(e,t)),(async()=>{try{for await(const t of this._asyncIterable)t&&(this._result.push(t),this._fireResult(e));this._asyncIterableDone=!0,(this._state===js.WaitingForAsync||this._state===js.WaitingForAsyncShowingLoading)&&this._setState(js.Idle,e)}catch(t){mt(t)}})()):this._asyncIterableDone=!0}_triggerSyncComputation(e){this._computer.computeSync&&(this._result=this._result.concat(this._computer.computeSync(e))),this._setState(this._asyncIterableDone?js.Idle:js.WaitingForAsync,e)}_triggerLoadingMessage(e){this._state===js.WaitingForAsync&&this._setState(js.WaitingForAsyncShowingLoading,e)}_fireResult(e){if(this._state===js.FirstWait||this._state===js.SecondWait)return;const t=this._state===js.Idle,i=this._state===js.WaitingForAsyncShowingLoading;this._onResult.fire(new hPe(this._result.slice(0),t,i,e))}start(e,t){if(e===Ah.Delayed)this._state===js.Idle&&(this._setState(js.FirstWait,t),this._asyncComputationScheduler.schedule(t,this._firstWaitTime),this._loadingMessageScheduler.schedule(t,this._loadingMessageTime));else switch(this._state){case js.Idle:this._triggerAsyncComputation(t),this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break;case js.SecondWait:this._syncComputationScheduler.cancel(),this._triggerSyncComputation(t);break}}cancel(){this._asyncComputationScheduler.cancel(),this._syncComputationScheduler.cancel(),this._loadingMessageScheduler.cancel(),this._asyncIterable&&(this._asyncIterable.cancel(),this._asyncIterable=null),this._result=[],this._options=void 0,this._state=js.Idle}get options(){return this._options}}class D1 extends F{constructor(e,t){super(),this._scheduler=this._register(new yn(()=>e(this._options),t))}schedule(e,t){this._options=e,this._scheduler.schedule(t)}cancel(){this._scheduler.cancel()}}var tr;(function(s){s[s.Range=1]="Range",s[s.ForeignElement=2]="ForeignElement"})(tr||(tr={}));class k1{constructor(e,t,i,n){this.priority=e,this.range=t,this.initialMousePosX=i,this.initialMousePosY=n,this.type=tr.Range}equals(e){return e.type===tr.Range&&this.range.equalsRange(e.range)}canAdoptVisibleHover(e,t){return e.type===tr.Range&&t.lineNumber===this.range.startLineNumber}}class YS{constructor(e,t,i,n,o,r){this.priority=e,this.owner=t,this.range=i,this.initialMousePosX=n,this.initialMousePosY=o,this.supportsMarkerHover=r,this.type=tr.ForeignElement}equals(e){return e.type===tr.ForeignElement&&this.owner===e.owner}canAdoptVisibleHover(e,t){return e.type===tr.ForeignElement&&this.owner===e.owner}}class pv{constructor(e,t){this.renderedHoverParts=e,this.disposables=t}dispose(){for(const e of this.renderedHoverParts)e.dispose();this.disposables?.dispose()}}const d_=new class{constructor(){this._participants=[]}register(e){this._participants.push(e)}getAll(){return this._participants}};class YK{constructor(){this._onDidWillResize=new M,this.onDidWillResize=this._onDidWillResize.event,this._onDidResize=new M,this.onDidResize=this._onDidResize.event,this._sashListener=new U,this._size=new Ye(0,0),this._minSize=new Ye(0,0),this._maxSize=new Ye(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),this.domNode=document.createElement("div"),this._eastSash=new $_(this.domNode,{getVerticalSashLeft:()=>this._size.width},{orientation:St.VERTICAL}),this._westSash=new $_(this.domNode,{getVerticalSashLeft:()=>0},{orientation:St.VERTICAL}),this._northSash=new $_(this.domNode,{getHorizontalSashTop:()=>0},{orientation:St.HORIZONTAL,orthogonalEdge:H6.North}),this._southSash=new $_(this.domNode,{getHorizontalSashTop:()=>this._size.height},{orientation:St.HORIZONTAL,orthogonalEdge:H6.South}),this._northSash.orthogonalStartSash=this._westSash,this._northSash.orthogonalEndSash=this._eastSash,this._southSash.orthogonalStartSash=this._westSash,this._southSash.orthogonalEndSash=this._eastSash;let e,t=0,i=0;this._sashListener.add(T.any(this._northSash.onDidStart,this._eastSash.onDidStart,this._southSash.onDidStart,this._westSash.onDidStart)(()=>{e===void 0&&(this._onDidWillResize.fire(),e=this._size,t=0,i=0)})),this._sashListener.add(T.any(this._northSash.onDidEnd,this._eastSash.onDidEnd,this._southSash.onDidEnd,this._westSash.onDidEnd)(()=>{e!==void 0&&(e=void 0,t=0,i=0,this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(this._eastSash.onDidChange(n=>{e&&(i=n.currentX-n.startX,this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,east:!0}))})),this._sashListener.add(this._westSash.onDidChange(n=>{e&&(i=-(n.currentX-n.startX),this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,west:!0}))})),this._sashListener.add(this._northSash.onDidChange(n=>{e&&(t=-(n.currentY-n.startY),this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,north:!0}))})),this._sashListener.add(this._southSash.onDidChange(n=>{e&&(t=n.currentY-n.startY,this.layout(e.height+t,e.width+i),this._onDidResize.fire({dimension:this._size,done:!1,south:!0}))})),this._sashListener.add(T.any(this._eastSash.onDidReset,this._westSash.onDidReset)(n=>{this._preferredSize&&(this.layout(this._size.height,this._preferredSize.width),this._onDidResize.fire({dimension:this._size,done:!0}))})),this._sashListener.add(T.any(this._northSash.onDidReset,this._southSash.onDidReset)(n=>{this._preferredSize&&(this.layout(this._preferredSize.height,this._size.width),this._onDidResize.fire({dimension:this._size,done:!0}))}))}dispose(){this._northSash.dispose(),this._southSash.dispose(),this._eastSash.dispose(),this._westSash.dispose(),this._sashListener.dispose(),this._onDidResize.dispose(),this._onDidWillResize.dispose(),this.domNode.remove()}enableSashes(e,t,i,n){this._northSash.state=e?Bd.Enabled:Bd.Disabled,this._eastSash.state=t?Bd.Enabled:Bd.Disabled,this._southSash.state=i?Bd.Enabled:Bd.Disabled,this._westSash.state=n?Bd.Enabled:Bd.Disabled}layout(e=this.size.height,t=this.size.width){const{height:i,width:n}=this._minSize,{height:o,width:r}=this._maxSize;e=Math.max(i,Math.min(o,e)),t=Math.max(n,Math.min(r,t));const a=new Ye(t,e);Ye.equals(a,this._size)||(this.domNode.style.height=e+"px",this.domNode.style.width=t+"px",this._size=a,this._northSash.layout(),this._eastSash.layout(),this._southSash.layout(),this._westSash.layout())}clearSashHoverState(){this._eastSash.clearSashHoverState(),this._westSash.clearSashHoverState(),this._northSash.clearSashHoverState(),this._southSash.clearSashHoverState()}get size(){return this._size}set maxSize(e){this._maxSize=e}get maxSize(){return this._maxSize}set minSize(e){this._minSize=e}get minSize(){return this._minSize}set preferredSize(e){this._preferredSize=e}get preferredSize(){return this._preferredSize}}const uPe=30,gPe=24;class pPe extends F{constructor(e,t=new Ye(10,10)){super(),this._editor=e,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._resizableNode=this._register(new YK),this._contentPosition=null,this._isResizing=!1,this._resizableNode.domNode.style.position="absolute",this._resizableNode.minSize=Ye.lift(t),this._resizableNode.layout(t.height,t.width),this._resizableNode.enableSashes(!0,!0,!0,!0),this._register(this._resizableNode.onDidResize(i=>{this._resize(new Ye(i.dimension.width,i.dimension.height)),i.done&&(this._isResizing=!1)})),this._register(this._resizableNode.onDidWillResize(()=>{this._isResizing=!0}))}get isResizing(){return this._isResizing}getDomNode(){return this._resizableNode.domNode}getPosition(){return this._contentPosition}get position(){return this._contentPosition?.position?we.lift(this._contentPosition.position):void 0}_availableVerticalSpaceAbove(e){const t=this._editor.getDomNode(),i=this._editor.getScrolledVisiblePosition(e);return!t||!i?void 0:Bs(t).top+i.top-uPe}_availableVerticalSpaceBelow(e){const t=this._editor.getDomNode(),i=this._editor.getScrolledVisiblePosition(e);if(!t||!i)return;const n=Bs(t),o=qu(t.ownerDocument.body),r=n.top+i.top+i.height;return o.height-r-gPe}_findPositionPreference(e,t){const i=Math.min(this._availableVerticalSpaceBelow(t)??1/0,e),n=Math.min(this._availableVerticalSpaceAbove(t)??1/0,e),o=Math.min(Math.max(n,i),e),r=Math.min(e,o);let a;return this._editor.getOption(L.hover).above?a=r<=n?Fi.ABOVE:Fi.BELOW:a=r<=i?Fi.BELOW:Fi.ABOVE,a===Fi.ABOVE?this._resizableNode.enableSashes(!0,!0,!1,!1):this._resizableNode.enableSashes(!1,!0,!0,!1),a}_resize(e){this._resizableNode.layout(e.height,e.width)}}var Ic;const IX=30;let sH=class extends pPe{static{Ic=this}static{this.ID="editor.contrib.resizableContentHoverWidget"}static{this._lastDimensions=new Ye(0,0)}get isVisibleFromKeyboard(){return this._renderedHover?.source===al.Keyboard}get isVisible(){return this._hoverVisibleKey.get()??!1}get isFocused(){return this._hoverFocusedKey.get()??!1}constructor(e,t,i,n,o){const r=e.getOption(L.lineHeight)+8,a=150,c=new Ye(a,r);super(e,c),this._configurationService=i,this._accessibilityService=n,this._keybindingService=o,this._hover=this._register(new fne(!0)),this._onDidResize=this._register(new M),this.onDidResize=this._onDidResize.event,this._onDidScroll=this._register(new M),this.onDidScroll=this._onDidScroll.event,this._minimumSize=c,this._hoverVisibleKey=V.hoverVisible.bindTo(t),this._hoverFocusedKey=V.hoverFocused.bindTo(t),ee(this._resizableNode.domNode,this._hover.containerDomNode),this._resizableNode.domNode.style.zIndex="50",this._resizableNode.domNode.className="monaco-resizable-hover",this._register(this._editor.onDidLayoutChange(()=>{this.isVisible&&this._updateMaxDimensions()})),this._register(this._editor.onDidChangeConfiguration(l=>{l.hasChanged(L.fontInfo)&&this._updateFont()}));const d=this._register(Fo(this._resizableNode.domNode));this._register(d.onDidFocus(()=>{this._hoverFocusedKey.set(!0)})),this._register(d.onDidBlur(()=>{this._hoverFocusedKey.set(!1)})),this._register(this._hover.scrollbar.onScroll(l=>{this._onDidScroll.fire(l)})),this._setRenderedHover(void 0),this._editor.addContentWidget(this)}dispose(){super.dispose(),this._renderedHover?.dispose(),this._editor.removeContentWidget(this)}getId(){return Ic.ID}static _applyDimensions(e,t,i){const n=typeof t=="number"?`${t}px`:t,o=typeof i=="number"?`${i}px`:i;e.style.width=n,e.style.height=o}_setContentsDomNodeDimensions(e,t){const i=this._hover.contentsDomNode;return Ic._applyDimensions(i,e,t)}_setContainerDomNodeDimensions(e,t){const i=this._hover.containerDomNode;return Ic._applyDimensions(i,e,t)}_setScrollableElementDimensions(e,t){const i=this._hover.scrollbar.getDomNode();return Ic._applyDimensions(i,e,t)}_setHoverWidgetDimensions(e,t){this._setContainerDomNodeDimensions(e,t),this._setScrollableElementDimensions(e,t),this._setContentsDomNodeDimensions(e,t),this._layoutContentWidget()}static _applyMaxDimensions(e,t,i){const n=typeof t=="number"?`${t}px`:t,o=typeof i=="number"?`${i}px`:i;e.style.maxWidth=n,e.style.maxHeight=o}_setHoverWidgetMaxDimensions(e,t){Ic._applyMaxDimensions(this._hover.contentsDomNode,e,t),Ic._applyMaxDimensions(this._hover.scrollbar.getDomNode(),e,t),Ic._applyMaxDimensions(this._hover.containerDomNode,e,t),this._hover.containerDomNode.style.setProperty("--vscode-hover-maxWidth",typeof e=="number"?`${e}px`:e),this._layoutContentWidget()}_setAdjustedHoverWidgetDimensions(e){this._setHoverWidgetMaxDimensions("none","none"),this._setHoverWidgetDimensions(e.width,e.height)}_updateResizableNodeMaxDimensions(){const e=this._findMaximumRenderingWidth()??1/0,t=this._findMaximumRenderingHeight()??1/0;this._resizableNode.maxSize=new Ye(e,t),this._setHoverWidgetMaxDimensions(e,t)}_resize(e){Ic._lastDimensions=new Ye(e.width,e.height),this._setAdjustedHoverWidgetDimensions(e),this._resizableNode.layout(e.height,e.width),this._updateResizableNodeMaxDimensions(),this._hover.scrollbar.scanDomNode(),this._editor.layoutContentWidget(this),this._onDidResize.fire()}_findAvailableSpaceVertically(){const e=this._renderedHover?.showAtPosition;if(e)return this._positionPreference===Fi.ABOVE?this._availableVerticalSpaceAbove(e):this._availableVerticalSpaceBelow(e)}_findMaximumRenderingHeight(){const e=this._findAvailableSpaceVertically();if(!e)return;let i=this._hover.contentsDomNode.children.length-1;return Array.from(this._hover.contentsDomNode.children).forEach(n=>{i+=n.clientHeight}),Math.min(e,i)}_isHoverTextOverflowing(){this._hover.containerDomNode.style.setProperty("--vscode-hover-whiteSpace","nowrap"),this._hover.containerDomNode.style.setProperty("--vscode-hover-sourceWhiteSpace","nowrap");const e=Array.from(this._hover.contentsDomNode.children).some(t=>t.scrollWidth>t.clientWidth);return this._hover.containerDomNode.style.removeProperty("--vscode-hover-whiteSpace"),this._hover.containerDomNode.style.removeProperty("--vscode-hover-sourceWhiteSpace"),e}_findMaximumRenderingWidth(){if(!this._editor||!this._editor.hasModel())return;const e=this._isHoverTextOverflowing(),t=typeof this._contentWidth>"u"?0:this._contentWidth;return e||this._hover.containerDomNode.clientWidth<t?qu(this._hover.containerDomNode.ownerDocument.body).width-14:this._hover.containerDomNode.clientWidth}isMouseGettingCloser(e,t){if(!this._renderedHover)return!1;if(this._renderedHover.initialMousePosX===void 0||this._renderedHover.initialMousePosY===void 0)return this._renderedHover.initialMousePosX=e,this._renderedHover.initialMousePosY=t,!1;const i=Bs(this.getDomNode());this._renderedHover.closestMouseDistance===void 0&&(this._renderedHover.closestMouseDistance=DX(this._renderedHover.initialMousePosX,this._renderedHover.initialMousePosY,i.left,i.top,i.width,i.height));const n=DX(e,t,i.left,i.top,i.width,i.height);return n>this._renderedHover.closestMouseDistance+4?!1:(this._renderedHover.closestMouseDistance=Math.min(this._renderedHover.closestMouseDistance,n),!0)}_setRenderedHover(e){this._renderedHover?.dispose(),this._renderedHover=e,this._hoverVisibleKey.set(!!e),this._hover.containerDomNode.classList.toggle("hidden",!e)}_updateFont(){const{fontSize:e,lineHeight:t}=this._editor.getOption(L.fontInfo),i=this._hover.contentsDomNode;i.style.fontSize=`${e}px`,i.style.lineHeight=`${t/e}`,Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(o=>this._editor.applyFontInfo(o))}_updateContent(e){const t=this._hover.contentsDomNode;t.style.paddingBottom="",t.textContent="",t.appendChild(e)}_layoutContentWidget(){this._editor.layoutContentWidget(this),this._hover.onContentsChanged()}_updateMaxDimensions(){const e=Math.max(this._editor.getLayoutInfo().height/4,250,Ic._lastDimensions.height),t=Math.max(this._editor.getLayoutInfo().width*.66,750,Ic._lastDimensions.width);this._resizableNode.maxSize=new Ye(t,e),this._setHoverWidgetMaxDimensions(t,e)}_render(e){this._setRenderedHover(e),this._updateFont(),this._updateContent(e.domNode),this.onContentsChanged(),this._editor.render()}getPosition(){return this._renderedHover?{position:this._renderedHover.showAtPosition,secondaryPosition:this._renderedHover.showAtSecondaryPosition,positionAffinity:this._renderedHover.shouldAppearBeforeContent?eI.LeftOfInjectedText:void 0,preference:[this._positionPreference??Fi.ABOVE]}:null}show(e){if(!this._editor||!this._editor.hasModel())return;this._render(e);const t=z_(this._hover.containerDomNode),i=e.showAtPosition;this._positionPreference=this._findPositionPreference(t,i)??Fi.ABOVE,this.onContentsChanged(),e.shouldFocus&&this._hover.containerDomNode.focus(),this._onDidResize.fire();const o=this._hover.containerDomNode.ownerDocument.activeElement===this._hover.containerDomNode&&bve(this._configurationService.getValue("accessibility.verbosity.hover")===!0&&this._accessibilityService.isScreenReaderOptimized(),this._keybindingService.lookupKeybinding("editor.action.accessibleView")?.getAriaLabel()??"");o&&(this._hover.contentsDomNode.ariaLabel=this._hover.contentsDomNode.textContent+", "+o)}hide(){if(!this._renderedHover)return;const e=this._renderedHover.shouldFocus||this._hoverFocusedKey.get();this._setRenderedHover(void 0),this._resizableNode.maxSize=new Ye(1/0,1/0),this._resizableNode.clearSashHoverState(),this._hoverFocusedKey.set(!1),this._editor.layoutContentWidget(this),e&&this._editor.focus()}_removeConstraintsRenderNormally(){const e=this._editor.getLayoutInfo();this._resizableNode.layout(e.height,e.width),this._setHoverWidgetDimensions("auto","auto"),this._updateMaxDimensions()}setMinimumDimensions(e){this._minimumSize=new Ye(Math.max(this._minimumSize.width,e.width),Math.max(this._minimumSize.height,e.height)),this._updateMinimumWidth()}_updateMinimumWidth(){const e=typeof this._contentWidth>"u"?this._minimumSize.width:Math.min(this._contentWidth,this._minimumSize.width);this._resizableNode.minSize=new Ye(e,this._minimumSize.height)}onContentsChanged(){this._removeConstraintsRenderNormally();const e=this._hover.contentsDomNode;let t=z_(e),i=$a(e)+2;if(this._resizableNode.layout(t,i),this._setHoverWidgetDimensions(i,t),t=z_(e),i=$a(e),this._contentWidth=i,this._updateMinimumWidth(),this._resizableNode.layout(t,i),this._renderedHover?.showAtPosition){const n=z_(this._hover.containerDomNode);this._positionPreference=this._findPositionPreference(n,this._renderedHover.showAtPosition)}this._layoutContentWidget()}focus(){this._hover.containerDomNode.focus()}scrollUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(L.fontInfo);this._hover.scrollbar.setScrollPosition({scrollTop:e-t.lineHeight})}scrollDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._editor.getOption(L.fontInfo);this._hover.scrollbar.setScrollPosition({scrollTop:e+t.lineHeight})}scrollLeft(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e-IX})}scrollRight(){const e=this._hover.scrollbar.getScrollPosition().scrollLeft;this._hover.scrollbar.setScrollPosition({scrollLeft:e+IX})}pageUp(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e-t})}pageDown(){const e=this._hover.scrollbar.getScrollPosition().scrollTop,t=this._hover.scrollbar.getScrollDimensions().height;this._hover.scrollbar.setScrollPosition({scrollTop:e+t})}goToTop(){this._hover.scrollbar.setScrollPosition({scrollTop:0})}goToBottom(){this._hover.scrollbar.setScrollPosition({scrollTop:this._hover.scrollbar.getScrollDimensions().scrollHeight})}};sH=Ic=f([p(1,fe),p(2,ne),p(3,Nr),p(4,He)],sH);function DX(s,e,t,i,n,o){const r=t+n/2,a=i+o/2,c=Math.max(Math.abs(s-r)-n/2,0),d=Math.max(Math.abs(e-a)-o/2,0);return Math.sqrt(c*c+d*d)}class QR{constructor(e,t){this._editor=e,this._participants=t}static _getLineDecorations(e,t){if(t.type!==tr.Range&&!t.supportsMarkerHover)return[];const i=e.getModel(),n=t.range.startLineNumber;if(n>i.getLineCount())return[];const o=i.getLineMaxColumn(n);return e.getLineDecorations(n).filter(r=>{if(r.options.isWholeLine)return!0;const a=r.range.startLineNumber===n?r.range.startColumn:1,c=r.range.endLineNumber===n?r.range.endColumn:o;if(r.options.showIfCollapsed){if(a>t.range.startColumn+1||t.range.endColumn-1>c)return!1}else if(a>t.range.startColumn||t.range.endColumn>c)return!1;return!0})}computeAsync(e,t){const i=e.anchor;if(!this._editor.hasModel()||!i)return Xa.EMPTY;const n=QR._getLineDecorations(this._editor,i);return Xa.merge(this._participants.map(o=>o.computeAsync?o.computeAsync(i,n,e.source,t):Xa.EMPTY))}computeSync(e){if(!this._editor.hasModel())return[];const t=e.anchor,i=QR._getLineDecorations(this._editor,t);let n=[];for(const o of this._participants)n=n.concat(o.computeSync(t,i,e.source));return $t(n)}}class Ede{constructor(e,t,i){this.hoverParts=e,this.isComplete=t,this.options=i}filter(e){const t=this.hoverParts.filter(i=>i.isValidForHoverAnchor(e));return t.length===this.hoverParts.length?this:new fPe(this,t,this.isComplete,this.options)}}class fPe extends Ede{constructor(e,t,i,n){super(t,i,n),this.original=e}filter(e){return this.original.filter(e)}}const kX=j;let XR=class extends F{get hasContent(){return this._hasContent}constructor(e,t){super(),this._keybindingService=e,this._hoverService=t,this.actions=[],this._hasContent=!1,this.hoverElement=kX("div.hover-row.status-bar"),this.hoverElement.tabIndex=0,this.actionsElement=ee(this.hoverElement,kX("div.actions"))}addAction(e){const t=this._keybindingService.lookupKeybinding(e.commandId),i=t?t.getLabel():null;this._hasContent=!0;const n=this._register(yve.render(this.actionsElement,e,i));return this._register(this._hoverService.setupManagedHover(Ir("element"),n.actionContainer,n.actionRenderedLabel)),this.actions.push(n),n}append(e){const t=ee(this.actionsElement,e);return this._hasContent=!0,t}};XR=f([p(0,He),p(1,Ti)],XR);class mPe{constructor(e,t,i){this.provider=e,this.hover=t,this.ordinal=i}}async function vPe(s,e,t,i,n){const o=await Promise.resolve(s.provideHover(t,i,n)).catch(Ln);if(!(!o||!_Pe(o)))return new mPe(s,o,e)}function QK(s,e,t,i,n=!1){const r=s.ordered(e,n).map((a,c)=>vPe(a,c,e,t,i));return Xa.fromPromisesResolveOrder(r).coalesce()}function xde(s,e,t,i,n=!1){return QK(s,e,t,i,n).map(o=>o.hover).toPromise()}Or("_executeHoverProvider",(s,e,t)=>{const i=s.get(Ne);return xde(i.hoverProvider,e,t,Ce.None)});Or("_executeHoverProvider_recursive",(s,e,t)=>{const i=s.get(Ne);return xde(i.hoverProvider,e,t,Ce.None,!0)});function _Pe(s){const e=typeof s.range<"u",t=typeof s.contents<"u"&&s.contents&&s.contents.length>0;return e&&t}const _m=j,bPe=Pe("hover-increase-verbosity",K.add,h(1191,"Icon for increaseing hover verbosity.")),yPe=Pe("hover-decrease-verbosity",K.remove,h(1192,"Icon for decreasing hover verbosity."));class Kc{constructor(e,t,i,n,o,r=void 0){this.owner=e,this.range=t,this.contents=i,this.isBeforeContent=n,this.ordinal=o,this.source=r}isValidForHoverAnchor(e){return e.type===tr.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}class Ide{constructor(e,t,i){this.hover=e,this.hoverProvider=t,this.hoverPosition=i}supportsVerbosityAction(e){switch(e){case Os.Increase:return this.hover.canIncreaseVerbosity??!1;case Os.Decrease:return this.hover.canDecreaseVerbosity??!1}}}let fx=class{constructor(e,t,i,n,o,r,a,c){this._editor=e,this._languageService=t,this._openerService=i,this._configurationService=n,this._languageFeaturesService=o,this._keybindingService=r,this._hoverService=a,this._commandService=c,this.hoverOrdinal=3}createLoadingMessage(e){return new Kc(this,e.range,[new Gi().appendText(h(1193,"Loading..."))],!1,2e3)}computeSync(e,t){if(!this._editor.hasModel()||e.type!==tr.Range)return[];const i=this._editor.getModel(),n=e.range.startLineNumber,o=i.getLineMaxColumn(n),r=[];let a=1e3;const c=i.getLineLength(n),d=i.getLanguageIdAtPosition(e.range.startLineNumber,e.range.startColumn),l=this._editor.getOption(L.stopRenderingLineAfter),u=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:d});let g=!1;l>=0&&c>l&&e.range.startColumn>=l&&(g=!0,r.push(new Kc(this,e.range,[{value:h(1194,"Rendering paused for long line for performance reasons. This can be configured via `editor.stopRenderingLineAfter`.")}],!1,a++))),!g&&typeof u=="number"&&c>=u&&r.push(new Kc(this,e.range,[{value:h(1195,"Tokenization is skipped for long lines for performance reasons. This can be configured via `editor.maxTokenizationLineLength`.")}],!1,a++));let m=!1;for(const v of t){const _=v.range.startLineNumber===n?v.range.startColumn:1,w=v.range.endLineNumber===n?v.range.endColumn:o,C=v.options.hoverMessage;if(!C||DE(C))continue;v.options.beforeContentClassName&&(m=!0);const k=new P(e.range.startLineNumber,_,e.range.startLineNumber,w);r.push(new Kc(this,k,fw(C),m,a++))}return r}computeAsync(e,t,i,n){if(!this._editor.hasModel()||e.type!==tr.Range)return Xa.EMPTY;const o=this._editor.getModel(),r=this._languageFeaturesService.hoverProvider;return r.has(o)?this._getMarkdownHovers(r,o,e,n):Xa.EMPTY}_getMarkdownHovers(e,t,i,n){const o=i.range.getStartPosition();return QK(e,t,o,n).filter(c=>!DE(c.hover.contents)).map(c=>{const d=c.hover.range?P.lift(c.hover.range):i.range,l=new Ide(c.hover,c.provider,o);return new Kc(this,d,c.hover.contents,!1,c.ordinal,l)})}renderHoverParts(e,t){return this._renderedHoverParts=new wPe(t,e.fragment,this,this._editor,this._languageService,this._openerService,this._commandService,this._keybindingService,this._hoverService,this._configurationService,e.onContentsChanged),this._renderedHoverParts}handleScroll(e){this._renderedHoverParts?.handleScroll(e)}getAccessibleContent(e){return this._renderedHoverParts?.getAccessibleContent(e)??""}doesMarkdownHoverAtIndexSupportVerbosityAction(e,t){return this._renderedHoverParts?.doesMarkdownHoverAtIndexSupportVerbosityAction(e,t)??!1}updateMarkdownHoverVerbosityLevel(e,t){return Promise.resolve(this._renderedHoverParts?.updateMarkdownHoverPartVerbosityLevel(e,t))}};fx=f([p(1,vi),p(2,mi),p(3,ne),p(4,Ne),p(5,He),p(6,Ti),p(7,Ge)],fx);class ZD{constructor(e,t,i,n){this.hoverPart=e,this.hoverElement=t,this.disposables=i,this.actionsContainer=n}get hoverAccessibleContent(){return this.hoverElement.innerText.trim()}dispose(){this.disposables.dispose()}}class wPe{constructor(e,t,i,n,o,r,a,c,d,l,u){this._hoverParticipant=i,this._editor=n,this._languageService=o,this._openerService=r,this._commandService=a,this._keybindingService=c,this._hoverService=d,this._configurationService=l,this._onFinishedRendering=u,this._ongoingHoverOperations=new Map,this._disposables=new U,this.renderedHoverParts=this._renderHoverParts(e,t,this._onFinishedRendering),this._disposables.add(Ie(()=>{this.renderedHoverParts.forEach(g=>{g.dispose()}),this._ongoingHoverOperations.forEach(g=>{g.tokenSource.dispose(!0)})}))}_renderHoverParts(e,t,i){return e.sort(rd(n=>n.ordinal,fl)),e.map(n=>{const o=this._renderHoverPart(n,i);return t.appendChild(o.hoverElement),o})}_renderHoverPart(e,t){const i=this._renderMarkdownHover(e,t),n=i.hoverElement,o=e.source,r=new U;if(r.add(i),!o)return new ZD(e,n,r);const a=o.supportsVerbosityAction(Os.Increase),c=o.supportsVerbosityAction(Os.Decrease);if(!a&&!c)return new ZD(e,n,r);const d=_m("div.verbosity-actions");n.prepend(d);const l=_m("div.verbosity-actions-inner");return d.append(l),r.add(this._renderHoverExpansionAction(l,Os.Increase,a)),r.add(this._renderHoverExpansionAction(l,Os.Decrease,c)),new ZD(e,n,r,l)}_renderMarkdownHover(e,t){return Dde(this._editor,e,this._languageService,this._openerService,t)}_renderHoverExpansionAction(e,t,i){const n=new U,o=t===Os.Increase,r=ee(e,_m(ke.asCSSSelector(o?bPe:yPe)));r.tabIndex=0;const a=new wve("mouse",void 0,{target:e,position:{hoverPosition:PF.LEFT}},this._configurationService,this._hoverService);if(n.add(this._hoverService.setupManagedHover(a,r,kde(this._keybindingService,t))),!i)return r.classList.add("disabled"),n;r.classList.add("enabled");const c=()=>this._commandService.executeCommand(t===Os.Increase?eS:tS,{focus:!0});return n.add(new Sve(r,c)),n.add(new Cve(r,c,[S.Enter,S.Space])),n}handleScroll(e){this.renderedHoverParts.forEach(t=>{const i=t.actionsContainer;if(!i)return;const n=t.hoverElement,r=e.scrollTop+e.height,a=n.offsetTop,c=n.clientHeight,d=a+c,l=22;let u;d<=r||a>=r?u=c-l:u=r-a-l,i.style.top=`${u}px`})}async updateMarkdownHoverPartVerbosityLevel(e,t){const i=this._editor.getModel();if(!i)return;const n=this._getRenderedHoverPartAtIndex(t),o=n?.hoverPart.source;if(!n||!o?.supportsVerbosityAction(e))return;const r=await this._fetchHover(o,i,e);if(!r)return;const a=new Ide(r,o.hoverProvider,o.hoverPosition),c=n.hoverPart,d=new Kc(this._hoverParticipant,c.range,r.contents,c.isBeforeContent,c.ordinal,a),l=this._updateRenderedHoverPart(t,d);if(l)return{hoverPart:d,hoverElement:l.hoverElement}}getAccessibleContent(e){const t=this.renderedHoverParts.findIndex(r=>r.hoverPart===e);if(t===-1)return;const i=this._getRenderedHoverPartAtIndex(t);return i?i.hoverElement.innerText.replace(/[^\S\n\r]+/gu," "):void 0}doesMarkdownHoverAtIndexSupportVerbosityAction(e,t){const i=this._getRenderedHoverPartAtIndex(e),n=i?.hoverPart.source;return!(!i||!n?.supportsVerbosityAction(t))}async _fetchHover(e,t,i){let n=i===Os.Increase?1:-1;const o=e.hoverProvider,r=this._ongoingHoverOperations.get(o);r&&(r.tokenSource.cancel(),n+=r.verbosityDelta);const a=new li;this._ongoingHoverOperations.set(o,{verbosityDelta:n,tokenSource:a});const c={verbosityRequest:{verbosityDelta:n,previousHover:e.hover}};let d;try{d=await Promise.resolve(o.provideHover(t,e.hoverPosition,a.token,c))}catch(l){Ln(l)}return a.dispose(),this._ongoingHoverOperations.delete(o),d}_updateRenderedHoverPart(e,t){if(e>=this.renderedHoverParts.length||e<0)return;const i=this._renderHoverPart(t,this._onFinishedRendering),n=this.renderedHoverParts[e],o=n.hoverElement,r=i.hoverElement,a=Array.from(r.children);o.replaceChildren(...a);const c=new ZD(t,o,i.disposables,i.actionsContainer);return n.dispose(),this.renderedHoverParts[e]=c,c}_getRenderedHoverPartAtIndex(e){return this.renderedHoverParts[e]}dispose(){this._disposables.dispose()}}function SPe(s,e,t,i,n){e.sort(rd(r=>r.ordinal,fl));const o=[];for(const r of e){const a=Dde(t,r,i,n,s.onContentsChanged);s.fragment.appendChild(a.hoverElement),o.push(a)}return new pv(o)}function Dde(s,e,t,i,n){const o=new U,r=_m("div.hover-row"),a=_m("div.hover-row-contents");r.appendChild(a);const c=e.contents;for(const l of c){if(DE(l))continue;const u=_m("div.markdown-hover"),g=ee(u,_m("div.hover-contents")),m=new Ov({editor:s},t,i),v=o.add(m.render(l,{asyncRenderCallback:()=>{g.className="hover-contents code-hover-contents",n()}}));g.appendChild(v.element),a.appendChild(u)}return{hoverPart:e,hoverElement:r,dispose(){o.dispose()}}}function kde(s,e){switch(e){case Os.Increase:{const t=s.lookupKeybinding(eS);return t?h(1196,"Increase Hover Verbosity ({0})",t.getLabel()):h(1197,"Increase Hover Verbosity")}case Os.Decrease:{const t=s.lookupKeybinding(tS);return t?h(1198,"Decrease Hover Verbosity ({0})",t.getLabel()):h(1199,"Decrease Hover Verbosity")}}}let mx=class{constructor(e){this._editorWorkerService=e}async provideDocumentColors(e,t){return this._editorWorkerService.computeDefaultDocumentColors(e.uri)}provideColorPresentations(e,t,i){const n=t.range,o=t.color,r=o.alpha,a=new ye(new qm(Math.round(255*o.red),Math.round(255*o.green),Math.round(255*o.blue),r)),c=r?ye.Format.CSS.formatRGB(a):ye.Format.CSS.formatRGBA(a),d=r?ye.Format.CSS.formatHSL(a):ye.Format.CSS.formatHSLA(a),l=r?ye.Format.CSS.formatHex(a):ye.Format.CSS.formatHexA(a),u=[];return u.push({label:c,textEdit:{range:n,text:c}}),u.push({label:d,textEdit:{range:n,text:d}}),u.push({label:l,textEdit:{range:n,text:l}}),u}};mx=f([p(0,vc)],mx);let oH=class extends F{constructor(e,t){super(),this._register(e.colorProvider.register("*",new mx(t)))}};oH=f([p(0,Ne),p(1,vc)],oH);async function Tde(s,e,t,i="auto"){return XK(new CPe,s,e,t,i)}function Ade(s,e,t,i){return Promise.resolve(t.provideColorPresentations(s,e,i))}class CPe{constructor(){}async compute(e,t,i,n){const o=await e.provideDocumentColors(t,i);if(Array.isArray(o))for(const r of o)n.push({colorInfo:r,provider:e});return Array.isArray(o)}}class EPe{constructor(){}async compute(e,t,i,n){const o=await e.provideDocumentColors(t,i);if(Array.isArray(o))for(const r of o)n.push({range:r.range,color:[r.color.red,r.color.green,r.color.blue,r.color.alpha]});return Array.isArray(o)}}class xPe{constructor(e){this.colorInfo=e}async compute(e,t,i,n){const o=await e.provideColorPresentations(t,this.colorInfo,Ce.None);return Array.isArray(o)&&n.push(...o),Array.isArray(o)}}async function XK(s,e,t,i,n){let o=!1,r;const a=[],c=e.ordered(t);for(let d=c.length-1;d>=0;d--){const l=c[d];if(n!=="always"&&l instanceof mx)r=l;else try{await s.compute(l,t,i,a)&&(o=!0)}catch(u){Ln(u)}}return o?a:r&&n!=="never"?(await s.compute(r,t,i,a),a):[]}function Rde(s,e){const{colorProvider:t}=s.get(Ne),i=s.get(ci).getModel(e);if(!i)throw Nt();const n=s.get(ne).getValue("editor.defaultColorDecorators",{resource:e});return{model:i,colorProviderRegistry:t,defaultColorDecoratorsEnablement:n}}var rH;const Pde=Object.create({});let zy=class extends F{static{rH=this}static{this.ID="editor.contrib.colorDetector"}static{this.RECOMPUTE_TIME=1e3}constructor(e,t,i,n){super(),this._editor=e,this._configurationService=t,this._languageFeaturesService=i,this._localToDispose=this._register(new U),this._decorationsIds=[],this._colorDatas=new Map,this._decoratorLimitReporter=this._register(new IPe),this._colorDecorationClassRefs=this._register(new U),this._colorDecoratorIds=this._editor.createDecorationsCollection(),this._ruleFactory=new Fse(this._editor),this._debounceInformation=n.for(i.colorProvider,"Document Colors",{min:rH.RECOMPUTE_TIME}),this._register(e.onDidChangeModel(()=>{this._isColorDecoratorsEnabled=this.isEnabled(),this.updateColors()})),this._register(e.onDidChangeModelLanguage(()=>this.updateColors())),this._register(i.colorProvider.onDidChange(()=>this.updateColors())),this._register(e.onDidChangeConfiguration(o=>{const r=this._isColorDecoratorsEnabled;this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(L.defaultColorDecorators);const a=r!==this._isColorDecoratorsEnabled||o.hasChanged(L.colorDecoratorsLimit),c=o.hasChanged(L.defaultColorDecorators);(a||c)&&(this._isColorDecoratorsEnabled?this.updateColors():this.removeAllDecorations())})),this._timeoutTimer=null,this._computePromise=null,this._isColorDecoratorsEnabled=this.isEnabled(),this._defaultColorDecoratorsEnablement=this._editor.getOption(L.defaultColorDecorators),this.updateColors()}isEnabled(){const e=this._editor.getModel();if(!e)return!1;const t=e.getLanguageId(),i=this._configurationService.getValue(t);if(i&&typeof i=="object"){const n=i.colorDecorators;if(n&&n.enable!==void 0&&!n.enable)return n.enable}return this._editor.getOption(L.colorDecorators)}get limitReporter(){return this._decoratorLimitReporter}static get(e){return e.getContribution(this.ID)}dispose(){this.stop(),this.removeAllDecorations(),super.dispose()}updateColors(){if(this.stop(),!this._isColorDecoratorsEnabled)return;const e=this._editor.getModel();!e||!this._languageFeaturesService.colorProvider.has(e)||(this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._timeoutTimer||(this._timeoutTimer=new sI,this._timeoutTimer.cancelAndSet(()=>{this._timeoutTimer=null,this.beginCompute()},this._debounceInformation.get(e)))})),this.beginCompute())}async beginCompute(){this._computePromise=Tn(async e=>{const t=this._editor.getModel();if(!t)return[];const i=new Xn(!1),n=await Tde(this._languageFeaturesService.colorProvider,t,e,this._defaultColorDecoratorsEnablement);return this._debounceInformation.update(t,i.elapsed()),n});try{const e=await this._computePromise;this.updateDecorations(e),this.updateColorDecorators(e),this._computePromise=null}catch(e){mt(e)}}stop(){this._timeoutTimer&&(this._timeoutTimer.cancel(),this._timeoutTimer=null),this._computePromise&&(this._computePromise.cancel(),this._computePromise=null),this._localToDispose.clear()}updateDecorations(e){const t=e.map(i=>({range:{startLineNumber:i.colorInfo.range.startLineNumber,startColumn:i.colorInfo.range.startColumn,endLineNumber:i.colorInfo.range.endLineNumber,endColumn:i.colorInfo.range.endColumn},options:Zt.EMPTY}));this._editor.changeDecorations(i=>{this._decorationsIds=i.deltaDecorations(this._decorationsIds,t),this._colorDatas=new Map,this._decorationsIds.forEach((n,o)=>this._colorDatas.set(n,e[o]))})}updateColorDecorators(e){this._colorDecorationClassRefs.clear();const t=[],i=this._editor.getOption(L.colorDecoratorsLimit);for(let o=0;o<e.length&&t.length<i;o++){const{red:r,green:a,blue:c,alpha:d}=e[o].colorInfo.color,l=new qm(Math.round(r*255),Math.round(a*255),Math.round(c*255),d),u=`rgba(${l.r}, ${l.g}, ${l.b}, ${l.a})`,g=this._colorDecorationClassRefs.add(this._ruleFactory.createClassNameRef({backgroundColor:u}));t.push({range:{startLineNumber:e[o].colorInfo.range.startLineNumber,startColumn:e[o].colorInfo.range.startColumn,endLineNumber:e[o].colorInfo.range.endLineNumber,endColumn:e[o].colorInfo.range.endColumn},options:{description:"colorDetector",before:{content:pne,inlineClassName:`${g.className} colorpicker-color-decoration`,inlineClassNameAffectsLetterSpacing:!0,attachedData:Pde}}})}const n=i<e.length?i:!1;this._decoratorLimitReporter.update(e.length,n),this._colorDecoratorIds.set(t)}removeAllDecorations(){this._editor.removeDecorations(this._decorationsIds),this._decorationsIds=[],this._colorDecoratorIds.clear(),this._colorDecorationClassRefs.clear()}getColorData(e){const t=this._editor.getModel();if(!t)return null;const i=t.getDecorationsInRange(P.fromPositions(e,e)).filter(n=>this._colorDatas.has(n.id));return i.length===0?null:this._colorDatas.get(i[0].id)}isColorDecoration(e){return this._colorDecoratorIds.has(e)}};zy=rH=f([p(1,ne),p(2,Ne),p(3,Sd)],zy);class IPe extends F{constructor(){super(...arguments),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._computed=0,this._limited=!1}get computed(){return this._computed}get limited(){return this._limited}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}}const Ef=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(Ef);const TX=j;class DPe extends F{constructor(e,t,i){super(),this.model=t,this.pixelRatio=i,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new M,this.onColorFlushed=this._onColorFlushed.event,this._domNode=TX(".saturation-wrap"),ee(e,this._domNode),this._canvas=document.createElement("canvas"),this._canvas.className="saturation-box",ee(this._domNode,this._canvas),this.selection=TX(".saturation-selection"),ee(this._domNode,this.selection),this.layout(),this._register(re(this._domNode,pe.POINTER_DOWN,n=>this.onPointerDown(n))),this._register(this.model.onDidChangeColor(this.onDidChangeColor,this)),this.monitor=null}get domNode(){return this._domNode}get canvas(){return this._canvas}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;this.monitor=this._register(new mne);const t=Bs(this._domNode);e.target!==this.selection&&this.onDidChangePosition(e.offsetX,e.offsetY),this.monitor.startMonitoring(e.target,e.pointerId,e.buttons,n=>this.onDidChangePosition(n.pageX-t.left,n.pageY-t.top),()=>null);const i=re(e.target.ownerDocument,pe.POINTER_UP,()=>{this._onColorFlushed.fire(),i.dispose(),this.monitor&&(this.monitor.stopMonitoring(!0),this.monitor=null)},!0)}onDidChangePosition(e,t){const i=Math.max(0,Math.min(1,e/this.width)),n=Math.max(0,Math.min(1,1-t/this.height));this.paintSelection(i,n),this._onDidChange.fire({s:i,v:n})}layout(){this.width=this._domNode.offsetWidth,this.height=this._domNode.offsetHeight,this._canvas.width=this.width*this.pixelRatio,this._canvas.height=this.height*this.pixelRatio,this.paint();const e=this.model.color.hsva;this.paintSelection(e.s,e.v)}paint(){const e=this.model.color.hsva,t=new ye(new Tk(e.h,1,1,1)),i=this._canvas.getContext("2d"),n=i.createLinearGradient(0,0,this._canvas.width,0);n.addColorStop(0,"rgba(255, 255, 255, 1)"),n.addColorStop(.5,"rgba(255, 255, 255, 0.5)"),n.addColorStop(1,"rgba(255, 255, 255, 0)");const o=i.createLinearGradient(0,0,0,this._canvas.height);o.addColorStop(0,"rgba(0, 0, 0, 0)"),o.addColorStop(1,"rgba(0, 0, 0, 1)"),i.rect(0,0,this._canvas.width,this._canvas.height),i.fillStyle=ye.Format.CSS.format(t),i.fill(),i.fillStyle=n,i.fill(),i.fillStyle=o,i.fill()}paintSelection(e,t){this.selection.style.left=`${e*this.width}px`,this.selection.style.top=`${this.height-t*this.height}px`}onDidChangeColor(e){if(this.monitor&&this.monitor.isMonitoring())return;this.paint();const t=e.hsva;this.paintSelection(t.s,t.v)}}Ve(Ef);class kPe extends F{constructor(e){super(),this._onClicked=this._register(new M),this.onClicked=this._onClicked.event,this._button=ee(e,document.createElement("button")),this._button.classList.add("insert-button"),this._button.textContent="Insert",this._register(re(this._button,pe.CLICK,()=>{this._onClicked.fire()}))}get button(){return this._button}}class TPe{get color(){return this._color}set color(e){this._color.equals(e)||(this._color=e,this._onDidChangeColor.fire(e))}get presentation(){return this.colorPresentations[this.presentationIndex]}get colorPresentations(){return this._colorPresentations}set colorPresentations(e){this._colorPresentations=e,this.presentationIndex>e.length-1&&(this.presentationIndex=0),this._onDidChangePresentation.fire(this.presentation)}constructor(e,t,i){this.presentationIndex=i,this._onColorFlushed=new M,this.onColorFlushed=this._onColorFlushed.event,this._onDidChangeColor=new M,this.onDidChangeColor=this._onDidChangeColor.event,this._onDidChangePresentation=new M,this.onDidChangePresentation=this._onDidChangePresentation.event,this.originalColor=e,this._color=e,this._colorPresentations=t}selectNextColorPresentation(){this.presentationIndex=(this.presentationIndex+1)%this.colorPresentations.length,this.flushColor(),this._onDidChangePresentation.fire(this.presentation)}guessColorPresentation(e,t){let i=-1;for(let n=0;n<this.colorPresentations.length;n++)if(t.toLowerCase()===this.colorPresentations[n].label){i=n;break}if(i===-1){const n=t.split("(")[0].toLowerCase();for(let o=0;o<this.colorPresentations.length;o++)if(this.colorPresentations[o].label.toLowerCase().startsWith(n)){i=o;break}}i!==-1&&i!==this.presentationIndex&&(this.presentationIndex=i,this._onDidChangePresentation.fire(this.presentation))}flushColor(){this._onColorFlushed.fire(this._color)}}var fv;(function(s){s.Hover="hover",s.Standalone="standalone"})(fv||(fv={}));async function Lde(s,e,t){const i=s.getValueInRange(e.range),{red:n,green:o,blue:r,alpha:a}=e.color,c=new qm(Math.round(n*255),Math.round(o*255),Math.round(r*255),a),d=new ye(c),l=await Ade(s,e,t,Ce.None),u=new TPe(d,[],0);return u.colorPresentations=l||[],u.guessColorPresentation(d,i),{range:P.lift(e.range),model:u,provider:t}}function Mde(s,e,t){const i=[],n=t.presentation.textEdit??{range:e,text:t.presentation.label,forceMoveMarkers:!1};i.push(n),t.presentation.additionalTextEdits&&i.push(...t.presentation.additionalTextEdits);const o=P.lift(n.range),r=s.getModel()._setTrackedRange(null,o,ki.GrowsOnlyWhenTypingAfter);return s.executeEdits("colorpicker",i),s.pushUndoStop(),s.getModel()._getTrackedRange(r)??o}async function vx(s,e,t,i,n){const o=await Ade(s,{range:i,color:{red:t.rgba.r/255,green:t.rgba.g/255,blue:t.rgba.b/255,alpha:t.rgba.a}},n.provider,Ce.None);e.colorPresentations=o||[]}Ve(Ef);const AS=j;class Nde extends F{constructor(e,t,i){super(),this.model=t,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._onColorFlushed=new M,this.onColorFlushed=this._onColorFlushed.event,i===fv.Standalone?(this.domNode=ee(e,AS(".standalone-strip")),this.overlay=ee(this.domNode,AS(".standalone-overlay"))):(this.domNode=ee(e,AS(".strip")),this.overlay=ee(this.domNode,AS(".overlay"))),this.slider=ee(this.domNode,AS(".slider")),this.slider.style.top="0px",this._register(re(this.domNode,pe.POINTER_DOWN,n=>this.onPointerDown(n))),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this.layout()}layout(){this.height=this.domNode.offsetHeight-this.slider.offsetHeight;const e=this.getValue(this.model.color);this.updateSliderPosition(e)}onDidChangeColor(e){const t=this.getValue(e);this.updateSliderPosition(t)}onPointerDown(e){if(!e.target||!(e.target instanceof Element))return;const t=this._register(new mne),i=Bs(this.domNode);this.domNode.classList.add("grabbing"),e.target!==this.slider&&this.onDidChangeTop(e.offsetY),t.startMonitoring(e.target,e.pointerId,e.buttons,o=>this.onDidChangeTop(o.pageY-i.top),()=>null);const n=re(e.target.ownerDocument,pe.POINTER_UP,()=>{this._onColorFlushed.fire(),n.dispose(),t.stopMonitoring(!0),this.domNode.classList.remove("grabbing")},!0)}onDidChangeTop(e){const t=Math.max(0,Math.min(1,1-e/this.height));this.updateSliderPosition(t),this._onDidChange.fire(t)}updateSliderPosition(e){this.slider.style.top=`${(1-e)*this.height}px`}}class APe extends Nde{constructor(e,t,i){super(e,t,i),this.domNode.classList.add("opacity-strip"),this.onDidChangeColor(this.model.color)}onDidChangeColor(e){super.onDidChangeColor(e);const{r:t,g:i,b:n}=e.rgba,o=new ye(new qm(t,i,n,1)),r=new ye(new qm(t,i,n,0));this.overlay.style.background=`linear-gradient(to bottom, ${o} 0%, ${r} 100%)`}getValue(e){return e.hsva.a}}class RPe extends Nde{constructor(e,t,i){super(e,t,i),this.domNode.classList.add("hue-strip")}getValue(e){return 1-e.hsva.h/360}}Ve(Ef);const PPe=j;class LPe extends F{constructor(e,t,i,n){super(),this.model=t,this.pixelRatio=i,this._insertButton=null,this._domNode=PPe(".colorpicker-body"),ee(e,this._domNode),this._saturationBox=new DPe(this._domNode,this.model,this.pixelRatio),this._register(this._saturationBox),this._register(this._saturationBox.onDidChange(this.onDidSaturationValueChange,this)),this._register(this._saturationBox.onColorFlushed(this.flushColor,this)),this._opacityStrip=new APe(this._domNode,this.model,n),this._register(this._opacityStrip),this._register(this._opacityStrip.onDidChange(this.onDidOpacityChange,this)),this._register(this._opacityStrip.onColorFlushed(this.flushColor,this)),this._hueStrip=new RPe(this._domNode,this.model,n),this._register(this._hueStrip),this._register(this._hueStrip.onDidChange(this.onDidHueChange,this)),this._register(this._hueStrip.onColorFlushed(this.flushColor,this)),n===fv.Standalone&&(this._insertButton=this._register(new kPe(this._domNode)),this._domNode.classList.add("standalone-colorpicker"))}flushColor(){this.model.flushColor()}onDidSaturationValueChange({s:e,v:t}){const i=this.model.color.hsva;this.model.color=new ye(new Tk(i.h,e,t,i.a))}onDidOpacityChange(e){const t=this.model.color.hsva;this.model.color=new ye(new Tk(t.h,t.s,t.v,e))}onDidHueChange(e){const t=this.model.color.hsva,i=(1-e)*360;this.model.color=new ye(new Tk(i===360?0:i,t.s,t.v,t.a))}get domNode(){return this._domNode}get saturationBox(){return this._saturationBox}get opacityStrip(){return this._opacityStrip}get hueStrip(){return this._hueStrip}get enterButton(){return this._insertButton}layout(){this._saturationBox.layout(),this._opacityStrip.layout(),this._hueStrip.layout()}}Ve(Ef);const MPe=j;class NPe extends F{constructor(e){super(),this._onClicked=this._register(new M),this.onClicked=this._onClicked.event,this._button=document.createElement("div"),this._button.classList.add("close-button"),ee(e,this._button);const t=document.createElement("div");t.classList.add("close-button-inner-div"),ee(this._button,t),ee(t,MPe(".button"+ke.asCSSSelector(Pe("color-picker-close",K.close,h(948,"Icon to close the color picker"))))).classList.add("close-icon"),this._register(re(this._button,pe.CLICK,()=>{this._onClicked.fire()}))}}Ve(Ef);const JD=j;class OPe extends F{constructor(e,t,i,n){super(),this.model=t,this.type=n,this._closeButton=null,this._domNode=JD(".colorpicker-header"),ee(e,this._domNode),this._pickedColorNode=ee(this._domNode,JD(".picked-color")),ee(this._pickedColorNode,JD("span.codicon.codicon-color-mode")),this._pickedColorPresentation=ee(this._pickedColorNode,document.createElement("span")),this._pickedColorPresentation.classList.add("picked-color-presentation");const o=h(949,"Click to toggle color options (rgb/hsl/hex)");this._pickedColorNode.setAttribute("title",o),this._originalColorNode=ee(this._domNode,JD(".original-color")),this._originalColorNode.style.backgroundColor=ye.Format.CSS.format(this.model.originalColor)||"",this.backgroundColor=i.getColorTheme().getColor(U6)||ye.white,this._register(i.onDidColorThemeChange(r=>{this.backgroundColor=r.getColor(U6)||ye.white})),this._register(re(this._pickedColorNode,pe.CLICK,()=>this.model.selectNextColorPresentation())),this._register(re(this._originalColorNode,pe.CLICK,()=>{this.model.color=this.model.originalColor,this.model.flushColor()})),this._register(t.onDidChangeColor(this.onDidChangeColor,this)),this._register(t.onDidChangePresentation(this.onDidChangePresentation,this)),this._pickedColorNode.style.backgroundColor=ye.Format.CSS.format(t.color)||"",this._pickedColorNode.classList.toggle("light",t.color.rgba.a<.5?this.backgroundColor.isLighter():t.color.isLighter()),this.onDidChangeColor(this.model.color),this.type===fv.Standalone&&(this._domNode.classList.add("standalone-colorpicker"),this._closeButton=this._register(new NPe(this._domNode)))}get domNode(){return this._domNode}get closeButton(){return this._closeButton}get pickedColorNode(){return this._pickedColorNode}get originalColorNode(){return this._originalColorNode}onDidChangeColor(e){this._pickedColorNode.style.backgroundColor=ye.Format.CSS.format(e)||"",this._pickedColorNode.classList.toggle("light",e.rgba.a<.5?this.backgroundColor.isLighter():e.isLighter()),this.onDidChangePresentation()}onDidChangePresentation(){this._pickedColorPresentation.textContent=this.model.presentation?this.model.presentation.label:""}}Ve(Ef);const FPe=j;class IO extends lf{static{this.ID="editor.contrib.colorPickerWidget"}constructor(e,t,i,n,o){super(),this.model=t,this.pixelRatio=i,this._register(Wse.getInstance(Et(e)).onDidChange(()=>this.layout())),this._domNode=FPe(".colorpicker-widget"),e.appendChild(this._domNode),this.header=this._register(new OPe(this._domNode,this.model,n,o)),this.body=this._register(new LPe(this._domNode,this.model,this.pixelRatio,o))}getId(){return IO.ID}layout(){this.body.layout()}get domNode(){return this._domNode}}class ZR{constructor(e,t,i,n){this.owner=e,this.range=t,this.model=i,this.provider=n,this.forceShowAtRange=!0}isValidForHoverAnchor(e){return e.type===tr.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}static fromBaseColor(e,t){return new ZR(e,t.range,t.model,t.provider)}}let JR=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}computeSync(e,t,i){return[]}computeAsync(e,t,i,n){return Xa.fromPromise(this._computeAsync(e,t,i))}async _computeAsync(e,t,i){if(!this._editor.hasModel())return[];if(!this._isValidRequest(i))return[];const n=zy.get(this._editor);if(!n)return[];for(const o of t){if(!n.isColorDecoration(o))continue;const r=n.getColorData(o.range.getStartPosition());if(r)return[ZR.fromBaseColor(this,await Lde(this._editor.getModel(),r.colorInfo,r.provider))]}return[]}_isValidRequest(e){const t=this._editor.getOption(L.colorDecoratorsActivatedOn);switch(e){case al.Mouse:return t==="hover"||t==="clickAndHover";case al.Click:return t==="click"||t==="clickAndHover";case al.Keyboard:return!0}}renderHoverParts(e,t){const i=this._editor;if(t.length===0||!i.hasModel())return new pv([]);const n=i.getOption(L.lineHeight)+8;e.setMinimumDimensions(new Ye(302,n));const o=new U,r=t[0],a=i.getModel(),c=r.model;this._colorPicker=o.add(new IO(e.fragment,c,i.getOption(L.pixelRatio),this._themeService,fv.Hover));let d=!1,l=new P(r.range.startLineNumber,r.range.startColumn,r.range.endLineNumber,r.range.endColumn);o.add(c.onColorFlushed(async g=>{await vx(a,c,g,l,r),d=!0,l=Mde(i,l,c)})),o.add(c.onDidChangeColor(g=>{vx(a,c,g,l,r)})),o.add(i.onDidChangeModelContent(g=>{d?d=!1:(e.hide(),i.focus())}));const u={hoverPart:ZR.fromBaseColor(this,r),hoverElement:this._colorPicker.domNode,dispose(){o.dispose()}};return new pv([u])}getAccessibleContent(e){return h(950,"There is a color picker here.")}handleResize(){this._colorPicker?.layout()}handleHide(){this._colorPicker?.dispose(),this._colorPicker=void 0}isColorPickerVisible(){return!!this._colorPicker}};JR=f([p(1,pt)],JR);class AX extends YS{constructor(e,t,i,n){super(10,t,e.item.anchor.range,i,n,!0),this.part=e}}let eP=class extends fx{constructor(e,t,i,n,o,r,a,c,d){super(e,t,i,r,c,n,o,d),this._resolverService=a,this.hoverOrdinal=6}suggestHoverAnchor(e){if(!Iy.get(this._editor)||e.target.type!==xi.CONTENT_TEXT)return null;const i=e.target.detail.injectedText?.options;return i instanceof Iz&&i.attachedData instanceof kB?new AX(i.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,i,n){return e instanceof AX?new Xa(async o=>{const{part:r}=e;if(await r.item.resolve(n),n.isCancellationRequested)return;let a;typeof r.item.hint.tooltip=="string"?a=new Gi().appendText(r.item.hint.tooltip):r.item.hint.tooltip&&(a=r.item.hint.tooltip),a&&o.emitOne(new Kc(this,e.range,[a],!1,0)),An(r.item.hint.textEdits)&&o.emitOne(new Kc(this,e.range,[new Gi().appendText(h(1226,"Double-click to insert"))],!1,10001));let c;if(typeof r.part.tooltip=="string"?c=new Gi().appendText(r.part.tooltip):r.part.tooltip&&(c=r.part.tooltip),c&&o.emitOne(new Kc(this,e.range,[c],!1,1)),r.part.location||r.part.command){let l;const g=this._editor.getOption(L.multiCursorModifier)==="altKey"?Yt?h(1227,"cmd + click"):h(1228,"ctrl + click"):Yt?h(1229,"option + click"):h(1230,"alt + click");r.part.location&&r.part.command?l=new Gi().appendText(h(1231,"Go to Definition ({0}), right click for more",g)):r.part.location?l=new Gi().appendText(h(1232,"Go to Definition ({0})",g)):r.part.command&&(l=new Gi(`[${h(1233,"Execute Command")}](${_ae(r.part.command)} "${r.part.command.title}") (${g})`,{isTrusted:!0})),l&&o.emitOne(new Kc(this,e.range,[l],!1,1e4))}const d=await this._resolveInlayHintLabelPartHover(r,n);for await(const l of d)o.emitOne(l)}):Xa.EMPTY}async _resolveInlayHintLabelPartHover(e,t){if(!e.part.location)return Xa.EMPTY;const{uri:i,range:n}=e.part.location,o=await this._resolverService.createModelReference(i);try{const r=o.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(r)?QK(this._languageFeaturesService.hoverProvider,r,new we(n.startLineNumber,n.startColumn),t).filter(a=>!DE(a.hover.contents)).map(a=>new Kc(this,e.item.anchor.range,a.hover.contents,!1,2+a.ordinal)):Xa.EMPTY}finally{o.dispose()}}};eP=f([p(1,vi),p(2,mi),p(3,He),p(4,Ti),p(5,ne),p(6,Ci),p(7,Ne),p(8,Ge)],eP);var aH,cH;let dH=aH=class extends F{constructor(e,t,i,n,o,r){super();const a=t.hoverParts;this._renderedHoverParts=this._register(new lH(e,i,a,n,o,r));const c=t.options,d=c.anchor,{showAtPosition:l,showAtSecondaryPosition:u}=aH.computeHoverPositions(e,d.range,a);this.shouldAppearBeforeContent=a.some(g=>g.isBeforeContent),this.showAtPosition=l,this.showAtSecondaryPosition=u,this.initialMousePosX=d.initialMousePosX,this.initialMousePosY=d.initialMousePosY,this.shouldFocus=c.shouldFocus,this.source=c.source}get domNode(){return this._renderedHoverParts.domNode}get domNodeHasChildren(){return this._renderedHoverParts.domNodeHasChildren}get focusedHoverPartIndex(){return this._renderedHoverParts.focusedHoverPartIndex}get hoverPartsCount(){return this._renderedHoverParts.hoverPartsCount}focusHoverPartWithIndex(e){this._renderedHoverParts.focusHoverPartWithIndex(e)}getAccessibleWidgetContent(){return this._renderedHoverParts.getAccessibleContent()}getAccessibleWidgetContentAtIndex(e){return this._renderedHoverParts.getAccessibleHoverContentAtIndex(e)}async updateHoverVerbosityLevel(e,t,i){this._renderedHoverParts.updateHoverVerbosityLevel(e,t,i)}doesHoverAtIndexSupportVerbosityAction(e,t){return this._renderedHoverParts.doesHoverAtIndexSupportVerbosityAction(e,t)}isColorPickerVisible(){return this._renderedHoverParts.isColorPickerVisible()}static computeHoverPositions(e,t,i){let n=1;if(e.hasModel()){const l=e._getViewModel(),u=l.coordinatesConverter,g=u.convertModelRangeToViewRange(t),m=l.getLineMinColumn(g.startLineNumber),v=new we(g.startLineNumber,m);n=u.convertViewPositionToModelPosition(v).column}const o=t.startLineNumber;let r=t.startColumn,a;for(const l of i){const u=l.range,g=u.startLineNumber===o,m=u.endLineNumber===o;if(g&&m){const _=u.startColumn,w=Math.min(r,_);r=Math.max(w,n)}l.forceShowAtRange&&(a=u)}let c,d;if(a){const l=a.getStartPosition();c=l,d=l}else c=t.getStartPosition(),d=new we(o,r);return{showAtPosition:c,showAtSecondaryPosition:d}}};dH=aH=f([p(4,He),p(5,Ti)],dH);class WPe{constructor(e,t){this._statusBar=t,e.appendChild(this._statusBar.hoverElement)}get hoverElement(){return this._statusBar.hoverElement}get actions(){return this._statusBar.actions}dispose(){this._statusBar.dispose()}}let lH=class extends F{static{cH=this}static{this._DECORATION_OPTIONS=Zt.register({description:"content-hover-highlight",className:"hoverHighlight"})}constructor(e,t,i,n,o,r){super(),this._renderedParts=[],this._focusedHoverPartIndex=-1,this._context=n,this._fragment=document.createDocumentFragment(),this._register(this._renderParts(t,i,n,o,r)),this._register(this._registerListenersOnRenderedParts()),this._register(this._createEditorDecorations(e,i)),this._updateMarkdownAndColorParticipantInfo(t)}_createEditorDecorations(e,t){if(t.length===0)return F.None;let i=t[0].range;for(const o of t){const r=o.range;i=P.plusRange(i,r)}const n=e.createDecorationsCollection();return n.set([{range:i,options:cH._DECORATION_OPTIONS}]),Ie(()=>{n.clear()})}_renderParts(e,t,i,n,o){const r=new XR(n,o),a={fragment:this._fragment,statusBar:r,...i},c=new U;c.add(r);for(const l of e){const u=this._renderHoverPartsForParticipant(t,l,a);c.add(u);for(const g of u.renderedHoverParts)this._renderedParts.push({type:"hoverPart",participant:l,hoverPart:g.hoverPart,hoverElement:g.hoverElement})}const d=this._renderStatusBar(this._fragment,r);return d&&(c.add(d),this._renderedParts.push({type:"statusBar",hoverElement:d.hoverElement,actions:d.actions})),c}_renderHoverPartsForParticipant(e,t,i){const n=e.filter(r=>r.owner===t);return n.length>0?t.renderHoverParts(i,n):new pv([])}_renderStatusBar(e,t){if(t.hasContent)return new WPe(e,t)}_registerListenersOnRenderedParts(){const e=new U;return this._renderedParts.forEach((t,i)=>{const n=t.hoverElement;n.tabIndex=0,e.add(re(n,pe.FOCUS_IN,o=>{o.stopPropagation(),this._focusedHoverPartIndex=i})),e.add(re(n,pe.FOCUS_OUT,o=>{o.stopPropagation(),this._focusedHoverPartIndex=-1}))}),e}_updateMarkdownAndColorParticipantInfo(e){const t=e.find(i=>i instanceof fx&&!(i instanceof eP));t&&(this._markdownHoverParticipant=t),this._colorHoverParticipant=e.find(i=>i instanceof JR)}focusHoverPartWithIndex(e){e<0||e>=this._renderedParts.length||this._renderedParts[e].hoverElement.focus()}getAccessibleContent(){const e=[];for(let t=0;t<this._renderedParts.length;t++)e.push(this.getAccessibleHoverContentAtIndex(t));return e.join(`

`)}getAccessibleHoverContentAtIndex(e){const t=this._renderedParts[e];if(!t)return"";if(t.type==="statusBar"){const i=[h(1160,"This is a hover status bar.")];for(const n of t.actions){const o=n.actionKeybindingLabel;o?i.push(h(1161,"It has an action with label {0} and keybinding {1}.",n.actionLabel,o)):i.push(h(1162,"It has an action with label {0}.",n.actionLabel))}return i.join(`
`)}return t.participant.getAccessibleContent(t.hoverPart)}async updateHoverVerbosityLevel(e,t,i){if(!this._markdownHoverParticipant)return;let n;t>=0?n={start:t,endExclusive:t+1}:n=this._findRangeOfMarkdownHoverParts(this._markdownHoverParticipant);for(let o=n.start;o<n.endExclusive;o++){const r=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,o);if(r===void 0)continue;const a=await this._markdownHoverParticipant.updateMarkdownHoverVerbosityLevel(e,r);a&&(this._renderedParts[o]={type:"hoverPart",participant:this._markdownHoverParticipant,hoverPart:a.hoverPart,hoverElement:a.hoverElement})}i&&(t>=0?this.focusHoverPartWithIndex(t):this._context.focus()),this._context.onContentsChanged()}doesHoverAtIndexSupportVerbosityAction(e,t){if(!this._markdownHoverParticipant)return!1;const i=this._normalizedIndexToMarkdownHoverIndexRange(this._markdownHoverParticipant,e);return i===void 0?!1:this._markdownHoverParticipant.doesMarkdownHoverAtIndexSupportVerbosityAction(i,t)}isColorPickerVisible(){return this._colorHoverParticipant?.isColorPickerVisible()??!1}_normalizedIndexToMarkdownHoverIndexRange(e,t){const i=this._renderedParts[t];if(!i||i.type!=="hoverPart"||!(i.participant===e))return;const o=this._renderedParts.findIndex(r=>r.type==="hoverPart"&&r.participant===e);if(o===-1)throw new tn;return t-o}_findRangeOfMarkdownHoverParts(e){const t=this._renderedParts.slice(),i=t.findIndex(r=>r.type==="hoverPart"&&r.participant===e),n=t.reverse().findIndex(r=>r.type==="hoverPart"&&r.participant===e),o=n>=0?t.length-n:n;return{start:i,endExclusive:o+1}}get domNode(){return this._fragment}get domNodeHasChildren(){return this._fragment.hasChildNodes()}get focusedHoverPartIndex(){return this._focusedHoverPartIndex}get hoverPartsCount(){return this._renderedParts.length}};lH=cH=f([p(4,He),p(5,Ti)],lH);let hH=class extends F{constructor(e,t,i,n){super(),this._editor=e,this._instantiationService=t,this._keybindingService=i,this._hoverService=n,this._currentResult=null,this._renderedContentHover=this._register(new Pt),this._onContentsChanged=this._register(new M),this.onContentsChanged=this._onContentsChanged.event,this._contentHoverWidget=this._register(this._instantiationService.createInstance(sH,this._editor)),this._participants=this._initializeHoverParticipants(),this._hoverOperation=this._register(new Cde(this._editor,new QR(this._editor,this._participants))),this._registerListeners()}_initializeHoverParticipants(){const e=[];for(const t of d_.getAll()){const i=this._instantiationService.createInstance(t,this._editor);e.push(i)}return e.sort((t,i)=>t.hoverOrdinal-i.hoverOrdinal),this._register(this._contentHoverWidget.onDidResize(()=>{this._participants.forEach(t=>t.handleResize?.())})),this._register(this._contentHoverWidget.onDidScroll(t=>{this._participants.forEach(i=>i.handleScroll?.(t))})),e}_registerListeners(){this._register(this._hoverOperation.onResult(t=>{const i=t.hasLoadingMessage?this._addLoadingMessage(t):t.value;this._withResult(new Ede(i,t.isComplete,t.options))}));const e=this._contentHoverWidget.getDomNode();this._register(No(e,"keydown",t=>{t.equals(S.Escape)&&this.hide()})),this._register(No(e,"mouseleave",t=>{this._onMouseLeave(t)})),this._register(Eve.onDidChange(()=>{this._contentHoverWidget.position&&this._currentResult&&this._setCurrentResult(this._currentResult)}))}_startShowingOrUpdateHover(e,t,i,n,o){if(!(this._contentHoverWidget.position&&this._currentResult))return e?(this._startHoverOperationIfNecessary(e,t,i,n,!1),!0):!1;const a=this._editor.getOption(L.hover).sticky,c=o&&this._contentHoverWidget.isMouseGettingCloser(o.event.posx,o.event.posy);return a&&c?(e&&this._startHoverOperationIfNecessary(e,t,i,n,!0),!0):e?this._currentResult&&this._currentResult.options.anchor.equals(e)?!0:this._currentResult&&e.canAdoptVisibleHover(this._currentResult.options.anchor,this._contentHoverWidget.position)?(this._currentResult&&this._setCurrentResult(this._currentResult.filter(e)),this._startHoverOperationIfNecessary(e,t,i,n,!1),!0):(this._setCurrentResult(null),this._startHoverOperationIfNecessary(e,t,i,n,!1),!0):(this._setCurrentResult(null),!1)}_startHoverOperationIfNecessary(e,t,i,n,o){if(this._hoverOperation.options&&this._hoverOperation.options.anchor.equals(e))return;this._hoverOperation.cancel();const a={anchor:e,source:i,shouldFocus:n,insistOnKeepingHoverVisible:o};this._hoverOperation.start(t,a)}_setCurrentResult(e){let t=e;if(this._currentResult===t)return;t&&t.hoverParts.length===0&&(t=null),this._currentResult=t,this._currentResult?this._showHover(this._currentResult):this._hideHover()}_addLoadingMessage(e){for(const t of this._participants){if(!t.createLoadingMessage)continue;const i=t.createLoadingMessage(e.options.anchor);if(i)return e.value.slice(0).concat([i])}return e.value}_withResult(e){if(this._contentHoverWidget.position&&this._currentResult&&this._currentResult.isComplete||this._setCurrentResult(e),!e.isComplete)return;const n=e.hoverParts.length===0,o=e.options.insistOnKeepingHoverVisible;n&&o||this._setCurrentResult(e)}_showHover(e){const t=this._getHoverContext();this._renderedContentHover.value=new dH(this._editor,e,this._participants,t,this._keybindingService,this._hoverService),this._renderedContentHover.value.domNodeHasChildren?this._contentHoverWidget.show(this._renderedContentHover.value):this._renderedContentHover.clear()}_hideHover(){this._contentHoverWidget.hide(),this._participants.forEach(e=>e.handleHide?.())}_getHoverContext(){return{hide:()=>{this.hide()},onContentsChanged:()=>{this._onContentsChanged.fire(),this._contentHoverWidget.onContentsChanged()},setMinimumDimensions:o=>{this._contentHoverWidget.setMinimumDimensions(o)},focus:()=>this.focus()}}showsOrWillShow(e){if(this._contentHoverWidget.isResizing)return!0;const i=this._findHoverAnchorCandidates(e);if(!(i.length>0))return this._startShowingOrUpdateHover(null,Ah.Delayed,al.Mouse,!1,e);const o=i[0];return this._startShowingOrUpdateHover(o,Ah.Delayed,al.Mouse,!1,e)}_findHoverAnchorCandidates(e){const t=[];for(const n of this._participants){if(!n.suggestHoverAnchor)continue;const o=n.suggestHoverAnchor(e);o&&t.push(o)}const i=e.target;switch(i.type){case xi.CONTENT_TEXT:{t.push(new k1(0,i.range,e.event.posx,e.event.posy));break}case xi.CONTENT_EMPTY:{const n=this._editor.getOption(L.fontInfo).typicalHalfwidthCharacterWidth/2;if(!(!i.detail.isAfterLines&&typeof i.detail.horizontalDistanceToText=="number"&&i.detail.horizontalDistanceToText<n))break;t.push(new k1(0,i.range,e.event.posx,e.event.posy));break}}return t.sort((n,o)=>o.priority-n.priority),t}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!xO(t,e.x,e.y))&&this.hide()}startShowingAtRange(e,t,i,n){this._startShowingOrUpdateHover(new k1(0,e,void 0,void 0),t,i,n,null)}getWidgetContent(){const e=this._contentHoverWidget.getDomNode();if(e.textContent)return e.textContent}async updateHoverVerbosityLevel(e,t,i){this._renderedContentHover.value?.updateHoverVerbosityLevel(e,t,i)}doesHoverAtIndexSupportVerbosityAction(e,t){return this._renderedContentHover.value?.doesHoverAtIndexSupportVerbosityAction(e,t)??!1}getAccessibleWidgetContent(){return this._renderedContentHover.value?.getAccessibleWidgetContent()}getAccessibleWidgetContentAtIndex(e){return this._renderedContentHover.value?.getAccessibleWidgetContentAtIndex(e)}focusedHoverPartIndex(){return this._renderedContentHover.value?.focusedHoverPartIndex??-1}containsNode(e){return e?this._contentHoverWidget.getDomNode().contains(e):!1}focus(){if(this._renderedContentHover.value?.hoverPartsCount===1){this.focusHoverPartWithIndex(0);return}this._contentHoverWidget.focus()}focusHoverPartWithIndex(e){this._renderedContentHover.value?.focusHoverPartWithIndex(e)}scrollUp(){this._contentHoverWidget.scrollUp()}scrollDown(){this._contentHoverWidget.scrollDown()}scrollLeft(){this._contentHoverWidget.scrollLeft()}scrollRight(){this._contentHoverWidget.scrollRight()}pageUp(){this._contentHoverWidget.pageUp()}pageDown(){this._contentHoverWidget.pageDown()}goToTop(){this._contentHoverWidget.goToTop()}goToBottom(){this._contentHoverWidget.goToBottom()}hide(){this._hoverOperation.cancel(),this._setCurrentResult(null)}getDomNode(){return this._contentHoverWidget.getDomNode()}get isColorPickerVisible(){return this._renderedContentHover.value?.isColorPickerVisible()??!1}get isVisibleFromKeyboard(){return this._contentHoverWidget.isVisibleFromKeyboard}get isVisible(){return this._contentHoverWidget.isVisible}get isFocused(){return this._contentHoverWidget.isFocused}get isResizing(){return this._contentHoverWidget.isResizing}get widget(){return this._contentHoverWidget}};hH=f([p(1,Z),p(2,He),p(3,Ti)],hH);const DO=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function Ode(s){const e=s.target;return!!e&&e.type===xi.CONTENT_TEXT&&e.detail.injectedText?.options.attachedData===Pde}var uH;Ve(DO);let ws=class extends F{static{uH=this}static{this.ID="editor.contrib.contentHover"}constructor(e,t,i){super(),this._editor=e,this._instantiationService=t,this._keybindingService=i,this._onHoverContentsChanged=this._register(new M),this.onHoverContentsChanged=this._onHoverContentsChanged.event,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new U,this._isMouseDown=!1,this._reactToEditorMouseMoveRunner=this._register(new yn(()=>{this._mouseMoveEvent&&this._reactToEditorMouseMove(this._mouseMoveEvent)},0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.hover)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(uH.ID)}_hookListeners(){const e=this._editor.getOption(L.hover);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled||this._cancelSchedulerAndHide(),this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>this._cancelSchedulerAndHide())),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelSchedulerAndHide(){this._cancelScheduler(),this.hideContentHover()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideContentHover()}_onEditorMouseDown(e){this._isMouseDown=!0,!this._shouldKeepHoverWidgetVisible(e)&&this.hideContentHover()}_shouldKeepHoverWidgetVisible(e){return this._isMouseOnContentHoverWidget(e)||this._isContentWidgetResizing()||Ode(e)}_isMouseOnContentHoverWidget(e){return this._contentWidget?xO(this._contentWidget.getDomNode(),e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._isMouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._shouldKeepHoverWidgetVisible(e))||this.hideContentHover()}_shouldKeepCurrentHover(e){const t=this._contentWidget;if(!t)return!1;const i=this._hoverSettings.sticky,n=(l,u)=>{const g=this._isMouseOnContentHoverWidget(l);return u&&g},o=l=>{const u=t.isColorPickerVisible,g=this._isMouseOnContentHoverWidget(l),m=u&&g,v=u&&this._isMouseDown;return m||v},r=(l,u)=>{const g=l.event.browserEvent.view;return g?u&&t.containsNode(g.document.activeElement)&&!g.getSelection()?.isCollapsed:!1},a=t.isFocused,c=t.isResizing,d=this._hoverSettings.sticky&&t.isVisibleFromKeyboard;return this.shouldKeepOpenOnEditorMouseMoveOrLeave||a||c||d||n(e,i)||o(e)||r(e,i)}_onEditorMouseMove(e){if(this._mouseMoveEvent=e,this._shouldKeepCurrentHover(e)){this._reactToEditorMouseMoveRunner.cancel();return}if(this._shouldRescheduleHoverComputation()){this._reactToEditorMouseMoveRunner.isScheduled()||this._reactToEditorMouseMoveRunner.schedule(this._hoverSettings.hidingDelay);return}this._reactToEditorMouseMove(e)}_shouldRescheduleHoverComputation(){const e=this._hoverSettings.hidingDelay;return(this._contentWidget?.isVisible??!1)&&this._hoverSettings.sticky&&e>0}_reactToEditorMouseMove(e){this._hoverSettings.enabled&&this._getOrCreateContentWidget().showsOrWillShow(e)||this.hideContentHover()}_onKeyDown(e){if(!this._contentWidget)return;const t=this._isPotentialKeyboardShortcut(e),i=this._isModifierKeyPressed(e);t||i||this._contentWidget.isFocused&&e.keyCode===S.Tab||this.hideContentHover()}_isPotentialKeyboardShortcut(e){if(!this._editor.hasModel()||!this._contentWidget)return!1;const t=this._keybindingService.softDispatch(e,this._editor.getDomNode()),i=t.kind===qT.MoreChordsNeeded,n=t.kind===qT.KbFound&&(t.commandId===_de||t.commandId===eS||t.commandId===tS)&&this._contentWidget.isVisible;return i||n}_isModifierKeyPressed(e){return e.keyCode===S.Ctrl||e.keyCode===S.Alt||e.keyCode===S.Meta||e.keyCode===S.Shift}hideContentHover(){Gy.dropDownVisible||this._contentWidget?.hide()}_getOrCreateContentWidget(){return this._contentWidget||(this._contentWidget=this._instantiationService.createInstance(hH,this._editor),this._listenersStore.add(this._contentWidget.onContentsChanged(()=>this._onHoverContentsChanged.fire()))),this._contentWidget}showContentHover(e,t,i,n){this._getOrCreateContentWidget().startShowingAtRange(e,t,i,n)}_isContentWidgetResizing(){return this._contentWidget?.widget.isResizing||!1}focusedHoverPartIndex(){return this._getOrCreateContentWidget().focusedHoverPartIndex()}doesHoverAtIndexSupportVerbosityAction(e,t){return this._getOrCreateContentWidget().doesHoverAtIndexSupportVerbosityAction(e,t)}updateHoverVerbosityLevel(e,t,i){this._getOrCreateContentWidget().updateHoverVerbosityLevel(e,t,i)}focus(){this._contentWidget?.focus()}focusHoverPartWithIndex(e){this._contentWidget?.focusHoverPartWithIndex(e)}scrollUp(){this._contentWidget?.scrollUp()}scrollDown(){this._contentWidget?.scrollDown()}scrollLeft(){this._contentWidget?.scrollLeft()}scrollRight(){this._contentWidget?.scrollRight()}pageUp(){this._contentWidget?.pageUp()}pageDown(){this._contentWidget?.pageDown()}goToTop(){this._contentWidget?.goToTop()}goToBottom(){this._contentWidget?.goToBottom()}getWidgetContent(){return this._contentWidget?.getWidgetContent()}getAccessibleWidgetContent(){return this._contentWidget?.getAccessibleWidgetContent()}getAccessibleWidgetContentAtIndex(e){return this._contentWidget?.getAccessibleWidgetContentAtIndex(e)}get isColorPickerVisible(){return this._contentWidget?.isColorPickerVisible}get isHoverVisible(){return this._contentWidget?.isVisible}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._contentWidget?.dispose()}};ws=uH=f([p(1,Z),p(2,He)],ws);class BPe{constructor(e){this._editor=e}computeSync(e){const t=r=>({value:r}),i=this._editor.getLineDecorations(e.lineNumber),n=[],o=e.laneOrLine==="lineNo";if(!i)return n;for(const r of i){const a=r.options.glyphMargin?.position??LF.Center;if(!o&&a!==e.laneOrLine)continue;const c=o?r.options.lineNumberHoverMessage:r.options.glyphMarginHoverMessage;!c||DE(c)||n.push(...fw(c).map(t))}return n}}var gH;const RX=j;let pH=class extends F{static{gH=this}static{this.ID="editor.contrib.modesGlyphHoverWidget"}constructor(e,t,i){super(),this._renderDisposeables=this._register(new U),this._editor=e,this._isVisible=!1,this._messages=[],this._hover=this._register(new fne(!0)),this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible),this._markdownRenderer=new Ov({editor:this._editor},t,i),this._hoverOperation=this._register(new Cde(this._editor,new BPe(this._editor))),this._register(this._hoverOperation.onResult(n=>this._withResult(n))),this._register(this._editor.onDidChangeModelDecorations(()=>this._onModelDecorationsChanged())),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.fontInfo)&&this._updateFont()})),this._register(No(this._hover.containerDomNode,"mouseleave",n=>{this._onMouseLeave(n)})),this._editor.addOverlayWidget(this)}dispose(){this._hoverComputerOptions=void 0,this._editor.removeOverlayWidget(this),super.dispose()}getId(){return gH.ID}getDomNode(){return this._hover.containerDomNode}getPosition(){return null}_updateFont(){Array.prototype.slice.call(this._hover.contentsDomNode.getElementsByClassName("code")).forEach(t=>this._editor.applyFontInfo(t))}_onModelDecorationsChanged(){this._isVisible&&this._hoverComputerOptions&&(this._hoverOperation.cancel(),this._hoverOperation.start(Ah.Delayed,this._hoverComputerOptions))}showsOrWillShow(e){const t=e.target;return t.type===xi.GUTTER_GLYPH_MARGIN&&t.detail.glyphMarginLane?(this._startShowingAt(t.position.lineNumber,t.detail.glyphMarginLane),!0):t.type===xi.GUTTER_LINE_NUMBERS?(this._startShowingAt(t.position.lineNumber,"lineNo"),!0):!1}_startShowingAt(e,t){this._hoverComputerOptions&&this._hoverComputerOptions.lineNumber===e&&this._hoverComputerOptions.laneOrLine===t||(this._hoverOperation.cancel(),this.hide(),this._hoverComputerOptions={lineNumber:e,laneOrLine:t},this._hoverOperation.start(Ah.Delayed,this._hoverComputerOptions))}hide(){this._hoverComputerOptions=void 0,this._hoverOperation.cancel(),this._isVisible&&(this._isVisible=!1,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible))}_withResult(e){this._messages=e.value,this._messages.length>0?this._renderMessages(e.options.lineNumber,e.options.laneOrLine,this._messages):this.hide()}_renderMessages(e,t,i){this._renderDisposeables.clear();const n=document.createDocumentFragment();for(const o of i){const r=RX("div.hover-row.markdown-hover"),a=ee(r,RX("div.hover-contents")),c=this._renderDisposeables.add(this._markdownRenderer.render(o.value));a.appendChild(c.element),n.appendChild(r)}this._updateContents(n),this._showAt(e,t)}_updateContents(e){this._hover.contentsDomNode.textContent="",this._hover.contentsDomNode.appendChild(e),this._updateFont()}_showAt(e,t){this._isVisible||(this._isVisible=!0,this._hover.containerDomNode.classList.toggle("hidden",!this._isVisible));const i=this._editor.getLayoutInfo(),n=this._editor.getTopForLineNumber(e),o=this._editor.getScrollTop(),r=this._editor.getOption(L.lineHeight),a=this._hover.containerDomNode.clientHeight,c=n-o-(a-r)/2,d=i.glyphMarginLeft+i.glyphMarginWidth+(t==="lineNo"?i.lineNumbersWidth:0);this._hover.containerDomNode.style.left=`${d}px`,this._hover.containerDomNode.style.top=`${Math.max(Math.round(c),0)}px`,this._hover.containerDomNode.style.zIndex="11"}_onMouseLeave(e){const t=this._editor.getDomNode();(!t||!xO(t,e.x,e.y))&&this.hide()}};pH=gH=f([p(1,vi),p(2,mi)],pH);var fH;Ve(DO);let qy=class extends F{static{fH=this}static{this.ID="editor.contrib.marginHover"}constructor(e,t){super(),this._editor=e,this._instantiationService=t,this.shouldKeepOpenOnEditorMouseMoveOrLeave=!1,this._listenersStore=new U,this._hoverState={mouseDown:!1},this._reactToEditorMouseMoveRunner=this._register(new yn(()=>this._reactToEditorMouseMove(this._mouseMoveEvent),0)),this._hookListeners(),this._register(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(L.hover)&&(this._unhookListeners(),this._hookListeners())}))}static get(e){return e.getContribution(fH.ID)}_hookListeners(){const e=this._editor.getOption(L.hover);this._hoverSettings={enabled:e.enabled,sticky:e.sticky,hidingDelay:e.hidingDelay},e.enabled?(this._listenersStore.add(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._listenersStore.add(this._editor.onMouseUp(()=>this._onEditorMouseUp())),this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))):(this._listenersStore.add(this._editor.onMouseMove(t=>this._onEditorMouseMove(t))),this._listenersStore.add(this._editor.onKeyDown(t=>this._onKeyDown(t)))),this._listenersStore.add(this._editor.onMouseLeave(t=>this._onEditorMouseLeave(t))),this._listenersStore.add(this._editor.onDidChangeModel(()=>{this._cancelScheduler(),this.hideGlyphHover()})),this._listenersStore.add(this._editor.onDidChangeModelContent(()=>this._cancelScheduler())),this._listenersStore.add(this._editor.onDidScrollChange(t=>this._onEditorScrollChanged(t)))}_unhookListeners(){this._listenersStore.clear()}_cancelScheduler(){this._mouseMoveEvent=void 0,this._reactToEditorMouseMoveRunner.cancel()}_onEditorScrollChanged(e){(e.scrollTopChanged||e.scrollLeftChanged)&&this.hideGlyphHover()}_onEditorMouseDown(e){this._hoverState.mouseDown=!0,!this._isMouseOnGlyphHoverWidget(e)&&this.hideGlyphHover()}_isMouseOnGlyphHoverWidget(e){const t=this._glyphWidget?.getDomNode();return t?xO(t,e.event.posx,e.event.posy):!1}_onEditorMouseUp(){this._hoverState.mouseDown=!1}_onEditorMouseLeave(e){this.shouldKeepOpenOnEditorMouseMoveOrLeave||(this._cancelScheduler(),this._isMouseOnGlyphHoverWidget(e))||this.hideGlyphHover()}_shouldNotRecomputeCurrentHoverWidget(e){const t=this._hoverSettings.sticky,i=this._isMouseOnGlyphHoverWidget(e);return t&&i}_onEditorMouseMove(e){if(this.shouldKeepOpenOnEditorMouseMoveOrLeave)return;if(this._mouseMoveEvent=e,this._shouldNotRecomputeCurrentHoverWidget(e)){this._reactToEditorMouseMoveRunner.cancel();return}this._reactToEditorMouseMove(e)}_reactToEditorMouseMove(e){!e||this._tryShowHoverWidget(e)||this.hideGlyphHover()}_tryShowHoverWidget(e){return this._getOrCreateGlyphWidget().showsOrWillShow(e)}_onKeyDown(e){this._editor.hasModel()&&(e.keyCode===S.Ctrl||e.keyCode===S.Alt||e.keyCode===S.Meta||e.keyCode===S.Shift||this.hideGlyphHover())}hideGlyphHover(){this._glyphWidget?.hide()}_getOrCreateGlyphWidget(){return this._glyphWidget||(this._glyphWidget=this._instantiationService.createInstance(pH,this._editor)),this._glyphWidget}dispose(){super.dispose(),this._unhookListeners(),this._listenersStore.dispose(),this._glyphWidget?.dispose()}};qy=fH=f([p(1,Z)],qy);const VPe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let HPe=class{constructor(e,t){this._link=e,this._provider=t}toJSON(){return{range:this.range,url:this.url,tooltip:this.tooltip}}get range(){return this._link.range}get url(){return this._link.url}get tooltip(){return this._link.tooltip}async resolve(e){return this._link.url?this._link.url:typeof this._provider.resolveLink=="function"?Promise.resolve(this._provider.resolveLink(this._link,e)).then(t=>(this._link=t||this._link,this._link.url?this.resolve(e):Promise.reject(new Error("missing")))):Promise.reject(new Error("missing"))}};class _x{static{this.Empty=new _x([])}constructor(e){this._disposables=new U;let t=[];for(const[i,n]of e){const o=i.links.map(r=>new HPe(r,n));t=_x._union(t,o),NM(i)&&(this._disposables??=new U,this._disposables.add(i))}this.links=t}dispose(){this._disposables?.dispose(),this.links.length=0}static _union(e,t){const i=[];let n,o,r,a;for(n=0,r=0,o=e.length,a=t.length;n<o&&r<a;){const c=e[n],d=t[r];if(P.areIntersectingOrTouching(c.range,d.range)){n++;continue}P.compareRangesUsingStarts(c.range,d.range)<0?(i.push(c),n++):(i.push(d),r++)}for(;n<o;n++)i.push(e[n]);for(;r<a;r++)i.push(t[r]);return i}}async function Fde(s,e,t){const i=[],n=s.ordered(e).reverse().map(async(r,a)=>{try{const c=await r.provideLinks(e,t);c&&(i[a]=[c,r])}catch(c){Ln(c)}});await Promise.all(n);let o=new _x($t(i));return t.isCancellationRequested&&(o.dispose(),o=_x.Empty),o}Ee.registerCommand("_executeLinkProvider",async(s,...e)=>{let[t,i]=e;yt(t instanceof R),typeof i!="number"&&(i=0);const{linkProvider:n}=s.get(Ne),o=s.get(ci).getModel(t);if(!o)return[];const r=await Fde(n,o,Ce.None);if(!r)return[];for(let c=0;c<Math.min(i,r.links.length);c++)await r.links[c].resolve(Ce.None);const a=r.links.slice(0);return r.dispose(),a});var mH;Ve(VPe);let mv=class extends F{static{mH=this}static{this.ID="editor.linkDetector"}static get(e){return e.getContribution(mH.ID)}constructor(e,t,i,n,o){super(),this.editor=e,this.openerService=t,this.notificationService=i,this.languageFeaturesService=n,this.providers=this.languageFeaturesService.linkProvider,this.debounceInformation=o.for(this.providers,"Links",{min:1e3,max:4e3}),this.computeLinks=this._register(new yn(()=>this.computeLinksNow(),1e3)),this.computePromise=null,this.activeLinksList=null,this.currentOccurrences={},this.activeLinkDecorationId=null;const r=this._register(new qN(e));this._register(r.onMouseMoveOrRelevantKeyDown(([a,c])=>{this._onEditorMouseMove(a,c)})),this._register(r.onExecute(a=>{this.onEditorMouseUp(a)})),this._register(r.onCancel(a=>{this.cleanUpActiveLinkDecoration()})),this._register(e.onDidChangeConfiguration(a=>{a.hasChanged(L.links)&&(this.updateDecorations([]),this.stop(),this.computeLinks.schedule(0))})),this._register(e.onDidChangeModelContent(a=>{this.editor.hasModel()&&this.computeLinks.schedule(this.debounceInformation.get(this.editor.getModel()))})),this._register(e.onDidChangeModel(a=>{this.currentOccurrences={},this.activeLinkDecorationId=null,this.stop(),this.computeLinks.schedule(0)})),this._register(e.onDidChangeModelLanguage(a=>{this.stop(),this.computeLinks.schedule(0)})),this._register(this.providers.onDidChange(a=>{this.stop(),this.computeLinks.schedule(0)})),this.computeLinks.schedule(0)}async computeLinksNow(){if(!this.editor.hasModel()||!this.editor.getOption(L.links))return;const e=this.editor.getModel();if(!e.isTooLargeForSyncing()&&this.providers.has(e)){this.activeLinksList&&(this.activeLinksList.dispose(),this.activeLinksList=null),this.computePromise=Tn(t=>Fde(this.providers,e,t));try{const t=new Xn(!1);if(this.activeLinksList=await this.computePromise,this.debounceInformation.update(e,t.elapsed()),e.isDisposed())return;this.updateDecorations(this.activeLinksList.links)}catch(t){mt(t)}finally{this.computePromise=null}}}updateDecorations(e){const t=this.editor.getOption(L.multiCursorModifier)==="altKey",i=[],n=Object.keys(this.currentOccurrences);for(const r of n){const a=this.currentOccurrences[r];i.push(a.decorationId)}const o=[];if(e)for(const r of e)o.push(Ub.decoration(r,t));this.editor.changeDecorations(r=>{const a=r.deltaDecorations(i,o);this.currentOccurrences={},this.activeLinkDecorationId=null;for(let c=0,d=a.length;c<d;c++){const l=new Ub(e[c],a[c]);this.currentOccurrences[l.decorationId]=l}})}_onEditorMouseMove(e,t){const i=this.editor.getOption(L.multiCursorModifier)==="altKey";if(this.isEnabled(e,t)){this.cleanUpActiveLinkDecoration();const n=this.getLinkOccurrence(e.target.position);n&&this.editor.changeDecorations(o=>{n.activate(o,i),this.activeLinkDecorationId=n.decorationId})}else this.cleanUpActiveLinkDecoration()}cleanUpActiveLinkDecoration(){const e=this.editor.getOption(L.multiCursorModifier)==="altKey";if(this.activeLinkDecorationId){const t=this.currentOccurrences[this.activeLinkDecorationId];t&&this.editor.changeDecorations(i=>{t.deactivate(i,e)}),this.activeLinkDecorationId=null}}onEditorMouseUp(e){if(!this.isEnabled(e))return;const t=this.getLinkOccurrence(e.target.position);t&&this.openLinkOccurrence(t,e.hasSideBySideModifier,!0)}openLinkOccurrence(e,t,i=!1){if(!this.openerService)return;const{link:n}=e;n.resolve(Ce.None).then(o=>{if(typeof o=="string"&&this.editor.hasModel()){const r=this.editor.getModel().uri;if(r.scheme===ae.file&&o.startsWith(`${ae.file}:`)){const a=R.parse(o);if(a.scheme===ae.file){const c=xve(a);let d=null;c.startsWith("/./")||c.startsWith("\\.\\")?d=`.${c.substr(1)}`:(c.startsWith("//./")||c.startsWith("\\\\.\\"))&&(d=`.${c.substr(2)}`),d&&(o=Ct(r,d))}}}return this.openerService.open(o,{openToSide:t,fromUserGesture:i,allowContributedOpeners:!0,allowCommands:!0,fromWorkspace:!0})},o=>{const r=o instanceof Error?o.message:o;r==="invalid"?this.notificationService.warn(h(1332,"Failed to open this link because it is not well-formed: {0}",n.url.toString())):r==="missing"?this.notificationService.warn(h(1333,"Failed to open this link because its target is missing.")):mt(o)})}getLinkOccurrence(e){if(!this.editor.hasModel()||!e)return null;const t=this.editor.getModel().getDecorationsInRange({startLineNumber:e.lineNumber,startColumn:e.column,endLineNumber:e.lineNumber,endColumn:e.column},0,!0);for(const i of t){const n=this.currentOccurrences[i.id];if(n)return n}return null}isEnabled(e,t){return!!(e.target.type===xi.CONTENT_TEXT&&(e.hasTriggerModifier||t&&t.keyCodeIsTriggerKey))}stop(){this.computeLinks.cancel(),this.activeLinksList&&(this.activeLinksList?.dispose(),this.activeLinksList=null),this.computePromise&&(this.computePromise.cancel(),this.computePromise=null)}dispose(){super.dispose(),this.stop()}};mv=mH=f([p(1,mi),p(2,Dt),p(3,Ne),p(4,Sd)],mv);const PX={general:Zt.register({description:"detected-link",stickiness:ki.NeverGrowsWhenTypingAtEdges,collapseOnReplaceEdit:!0,inlineClassName:"detected-link"}),active:Zt.register({description:"detected-link-active",stickiness:ki.NeverGrowsWhenTypingAtEdges,collapseOnReplaceEdit:!0,inlineClassName:"detected-link-active"})};class Ub{static decoration(e,t){return{range:e.range,options:Ub._getOptions(e,t,!1)}}static _getOptions(e,t,i){const n={...i?PX.active:PX.general};return n.hoverMessage=UPe(e,t),n}constructor(e,t){this.link=e,this.decorationId=t}activate(e,t){e.changeDecorationOptions(this.decorationId,Ub._getOptions(this.link,t,!0))}deactivate(e,t){e.changeDecorationOptions(this.decorationId,Ub._getOptions(this.link,t,!1))}}function UPe(s,e){const t=s.url&&/^command:/i.test(s.url.toString()),i=s.tooltip?s.tooltip:t?h(1334,"Execute command"):h(1335,"Follow link"),n=e?Yt?h(1336,"cmd + click"):h(1337,"ctrl + click"):Yt?h(1338,"option + click"):h(1339,"alt + click");if(s.url){let o="";if(/^command:/i.test(s.url.toString())){const a=s.url.toString().match(/^command:([^?#]+)/);if(a){const c=a[1];o=h(1340,"Execute command {0}",c)}}return new Gi("",!0).appendLink(s.url.toString(!0).replace(/ /g,"%20"),i,o).appendMarkdown(` (${n})`)}else return new Gi().appendText(`${i} (${n})`)}class $Pe extends Se{constructor(){super({id:"editor.action.openLink",label:I(1341,"Open Link"),precondition:void 0})}run(e,t){const i=mv.get(t);if(!i||!t.hasModel())return;const n=t.getSelections();for(const o of n){const r=i.getLinkOccurrence(o.getEndPosition());r&&i.openLinkOccurrence(r,!1)}}}Lt(mv.ID,mv,_t.AfterFirstRender);ue($Pe);Ve(Ive);const GPe=h(14,"input"),zPe=h(15,"Preserve Case");class qPe extends _ne{constructor(e){super({icon:K.preserveCase,title:zPe+e.appendTitle,isChecked:e.isChecked,hoverDelegate:e.hoverDelegate??Ir("element"),inputActiveOptionBorder:e.inputActiveOptionBorder,inputActiveOptionForeground:e.inputActiveOptionForeground,inputActiveOptionBackground:e.inputActiveOptionBackground})}}class KPe extends lf{static{this.OPTION_CHANGE="optionChange"}constructor(e,t,i,n){super(),this._showOptionButtons=i,this.fixFocusOnOptionClickEnabled=!0,this.cachedOptionsWidth=0,this._onDidOptionChange=this._register(new M),this.onDidOptionChange=this._onDidOptionChange.event,this._onKeyDown=this._register(new M),this.onKeyDown=this._onKeyDown.event,this._onMouseDown=this._register(new M),this.onMouseDown=this._onMouseDown.event,this._onInput=this._register(new M),this.onInput=this._onInput.event,this._onKeyUp=this._register(new M),this.onKeyUp=this._onKeyUp.event,this._onPreserveCaseKeyDown=this._register(new M),this.onPreserveCaseKeyDown=this._onPreserveCaseKeyDown.event,this._lastHighlightFindOptions=0,this.contextViewProvider=t,this.placeholder=n.placeholder||"",this.validation=n.validation,this.label=n.label||GPe;const o=n.appendPreserveCaseLabel||"",r=n.history||new Set([]),a=!!n.flexibleHeight,c=!!n.flexibleWidth,d=n.flexibleMaxHeight;this.domNode=document.createElement("div"),this.domNode.classList.add("monaco-findInput"),this.inputBox=this._register(new vne(this.domNode,this.contextViewProvider,{ariaLabel:this.label||"",placeholder:this.placeholder||"",validationOptions:{validation:this.validation},history:r,showHistoryHint:n.showHistoryHint,flexibleHeight:a,flexibleWidth:c,flexibleMaxHeight:d,inputBoxStyles:n.inputBoxStyles})),this.preserveCase=this._register(new qPe({appendTitle:o,isChecked:!1,...n.toggleStyles})),this._register(this.preserveCase.onChange(g=>{this._onDidOptionChange.fire(g),!g&&this.fixFocusOnOptionClickEnabled&&this.inputBox.focus(),this.validate()})),this._register(this.preserveCase.onKeyDown(g=>{this._onPreserveCaseKeyDown.fire(g)})),this._showOptionButtons?this.cachedOptionsWidth=this.preserveCase.width():this.cachedOptionsWidth=0;const l=[this.preserveCase.domNode];this.onkeydown(this.domNode,g=>{if(g.equals(S.LeftArrow)||g.equals(S.RightArrow)||g.equals(S.Escape)){const m=l.indexOf(this.domNode.ownerDocument.activeElement);if(m>=0){let v=-1;g.equals(S.RightArrow)?v=(m+1)%l.length:g.equals(S.LeftArrow)&&(m===0?v=l.length-1:v=m-1),g.equals(S.Escape)?(l[m].blur(),this.inputBox.focus()):v>=0&&l[v].focus(),Vi.stop(g,!0)}}});const u=document.createElement("div");u.className="controls",u.style.display=this._showOptionButtons?"block":"none",u.appendChild(this.preserveCase.domNode),this.domNode.appendChild(u),e?.appendChild(this.domNode),this.onkeydown(this.inputBox.inputElement,g=>this._onKeyDown.fire(g)),this.onkeyup(this.inputBox.inputElement,g=>this._onKeyUp.fire(g)),this.oninput(this.inputBox.inputElement,g=>this._onInput.fire()),this.onmousedown(this.inputBox.inputElement,g=>this._onMouseDown.fire(g))}enable(){this.domNode.classList.remove("disabled"),this.inputBox.enable(),this.preserveCase.enable()}disable(){this.domNode.classList.add("disabled"),this.inputBox.disable(),this.preserveCase.disable()}setFocusInputOnOptionClick(e){this.fixFocusOnOptionClickEnabled=e}setEnabled(e){e?this.enable():this.disable()}clear(){this.clearValidation(),this.setValue(""),this.focus()}getValue(){return this.inputBox.value}setValue(e){this.inputBox.value!==e&&(this.inputBox.value=e)}onSearchSubmit(){this.inputBox.addToHistory()}applyStyles(){}select(){this.inputBox.select()}focus(){this.inputBox.focus()}getPreserveCase(){return this.preserveCase.checked}setPreserveCase(e){this.preserveCase.checked=e}focusOnPreserve(){this.preserveCase.focus()}highlightFindOptions(){this.domNode.classList.remove("highlight-"+this._lastHighlightFindOptions),this._lastHighlightFindOptions=1-this._lastHighlightFindOptions,this.domNode.classList.add("highlight-"+this._lastHighlightFindOptions)}validate(){this.inputBox?.validate()}showMessage(e){this.inputBox?.showMessage(e)}clearMessage(){this.inputBox?.hideMessage()}clearValidation(){this.inputBox?.hideMessage()}set width(e){this.inputBox.paddingRight=this.cachedOptionsWidth,this.domNode.style.width=e+"px"}dispose(){super.dispose()}}const ZK=new O("suggestWidgetVisible",!1,h(1885,"Whether suggestion are visible")),JK="historyNavigationWidgetFocus",Wde="historyNavigationForwardsEnabled",Bde="historyNavigationBackwardsEnabled";let $C;const ek=[];function kO(s,e){if(ek.includes(e))throw new Error("Cannot register the same widget multiple times");ek.push(e);const t=new U,i=new O(JK,!1).bindTo(s),n=new O(Wde,!0).bindTo(s),o=new O(Bde,!0).bindTo(s),r=()=>{i.set(!0),$C=e},a=()=>{i.set(!1),$C===e&&($C=void 0)};return hf(e.element)&&r(),t.add(e.onDidFocus(()=>r())),t.add(e.onDidBlur(()=>a())),t.add(Ie(()=>{ek.splice(ek.indexOf(e),1),a()})),{historyNavigationForwardsEnablement:n,historyNavigationBackwardsEnablement:o,dispose(){t.dispose()}}}let vH=class extends vne{constructor(e,t,i,n){super(e,t,i);const o=this._register(n.createScoped(this.element));this._register(kO(o,this))}};vH=f([p(3,fe)],vH);let _H=class extends Dve{constructor(e,t,i,n){super(e,t,i);const o=this._register(n.createScoped(this.inputBox.element));this._register(kO(o,this.inputBox))}};_H=f([p(3,fe)],_H);let bH=class extends KPe{constructor(e,t,i,n,o=!1){super(e,t,o,i);const r=this._register(n.createScoped(this.inputBox.element));this._register(kO(r,this.inputBox))}};bH=f([p(3,fe)],bH);Me.registerCommandAndKeybindingRule({id:"history.showPrevious",weight:W.WorkbenchContrib,when:x.and(x.has(JK),x.equals(Bde,!0),x.not("isComposing"),ZK.isEqualTo(!1)),primary:S.UpArrow,secondary:[E.Alt|S.UpArrow],handler:s=>{$C?.showPreviousValue()}});Me.registerCommandAndKeybindingRule({id:"history.showNext",weight:W.WorkbenchContrib,when:x.and(x.has(JK),x.equals(Wde,!0),x.not("isComposing"),ZK.isEqualTo(!1)),primary:S.DownArrow,secondary:[E.Alt|S.DownArrow],handler:s=>{$C?.showNextValue()}});const ut={Visible:ZK,HasFocusedSuggestion:new O("suggestWidgetHasFocusedSuggestion",!1,h(1502,"Whether any suggestion is focused")),DetailsVisible:new O("suggestWidgetDetailsVisible",!1,h(1503,"Whether suggestion details are visible")),MultipleSuggestions:new O("suggestWidgetMultipleSuggestions",!1,h(1504,"Whether there are multiple suggestions to pick from")),MakesTextEdit:new O("suggestionMakesTextEdit",!0,h(1505,"Whether inserting the current suggestion yields in a change or has everything already been typed")),AcceptSuggestionsOnEnter:new O("acceptSuggestionOnEnter",!0,h(1506,"Whether suggestions are inserted when pressing Enter")),HasInsertAndReplaceRange:new O("suggestionHasInsertAndReplaceRange",!1,h(1507,"Whether the current suggestion has insert and replace behaviour")),InsertMode:new O("suggestionInsertMode",void 0,{type:"string",description:h(1508,"Whether the default behaviour is to insert or replace")}),CanResolve:new O("suggestionCanResolve",!1,h(1509,"Whether the current suggestion supports to resolve further details"))},yp=new N("suggestWidgetStatusBar");class jPe{constructor(e,t,i,n){this.position=e,this.completion=t,this.container=i,this.provider=n,this.isInvalid=!1,this.score=CE.Default,this.distance=0,this.textLabel=typeof t.label=="string"?t.label:t.label?.label,this.labelLow=this.textLabel.toLowerCase(),this.isInvalid=!this.textLabel,this.sortTextLow=t.sortText&&t.sortText.toLowerCase(),this.filterTextLow=t.filterText&&t.filterText.toLowerCase(),this.extensionId=t.extensionId,P.isIRange(t.range)?(this.editStart=new we(t.range.startLineNumber,t.range.startColumn),this.editInsertEnd=new we(t.range.endLineNumber,t.range.endColumn),this.editReplaceEnd=new we(t.range.endLineNumber,t.range.endColumn),this.isInvalid=this.isInvalid||P.spansMultipleLines(t.range)||t.range.startLineNumber!==e.lineNumber):(this.editStart=new we(t.range.insert.startLineNumber,t.range.insert.startColumn),this.editInsertEnd=new we(t.range.insert.endLineNumber,t.range.insert.endColumn),this.editReplaceEnd=new we(t.range.replace.endLineNumber,t.range.replace.endColumn),this.isInvalid=this.isInvalid||P.spansMultipleLines(t.range.insert)||P.spansMultipleLines(t.range.replace)||t.range.insert.startLineNumber!==e.lineNumber||t.range.replace.startLineNumber!==e.lineNumber||t.range.insert.startColumn!==t.range.replace.startColumn),typeof n.resolveCompletionItem!="function"&&(this._resolveCache=Promise.resolve(),this._resolveDuration=0)}get isResolved(){return this._resolveDuration!==void 0}get resolveDuration(){return this._resolveDuration!==void 0?this._resolveDuration:-1}async resolve(e){if(!this._resolveCache){const t=e.onCancellationRequested(()=>{this._resolveCache=void 0,this._resolveDuration=void 0}),i=new Xn(!0);this._resolveCache=Promise.resolve(this.provider.resolveCompletionItem(this.completion,e)).then(n=>{Object.assign(this.completion,n),this._resolveDuration=i.elapsed()},n=>{ys(n)&&(this._resolveCache=void 0,this._resolveDuration=void 0)}).finally(()=>{t.dispose()})}return this._resolveCache}}var Pu;(function(s){s[s.Top=0]="Top",s[s.Inline=1]="Inline",s[s.Bottom=2]="Bottom"})(Pu||(Pu={}));class iD{static{this.default=new iD}constructor(e=Pu.Bottom,t=new Set,i=new Set,n=new Map,o=!0){this.snippetSortOrder=e,this.kindFilter=t,this.providerFilter=i,this.providerItemsToReuse=n,this.showDeprecated=o}}let tp;function YPe(){return tp}function QPe(s){const e=tp;return tp=s,e}class XPe{constructor(e,t,i,n){this.items=e,this.needsClipboard=t,this.durations=i,this.disposable=n}}async function e4(s,e,t,i=iD.default,n={triggerKind:ba.Invoke},o=Ce.None){const r=new Xn;t=t.clone();const a=e.getWordAtPosition(t),c=a?new P(t.lineNumber,a.startColumn,t.lineNumber,a.endColumn):P.fromPositions(t),d={replace:c,insert:c.setEndPosition(t.lineNumber,t.column)},l=[],u=new U,g=[];let m=!1;const v=(w,C,k)=>{let D=!1;if(!C)return D;for(const A of C.suggestions)if(!i.kindFilter.has(A.kind)){if(!i.showDeprecated&&A?.tags?.includes(VT.Deprecated))continue;A.range||(A.range=d),A.sortText||(A.sortText=typeof A.label=="string"?A.label:A.label.label),!m&&A.insertTextRules&&A.insertTextRules&sh.InsertAsSnippet&&(m=fd.guessNeedsClipboard(A.insertText)),l.push(new jPe(t,A,C,w)),D=!0}return NM(C)&&u.add(C),g.push({providerName:w._debugDisplayName??"unknown_provider",elapsedProvider:C.duration??-1,elapsedOverall:k.elapsed()}),D},_=(async()=>{if(!tp||i.kindFilter.has(De.Snippet))return;const w=i.providerItemsToReuse.get(tp);if(w){w.forEach(D=>l.push(D));return}if(i.providerFilter.size>0&&!i.providerFilter.has(tp))return;const C=new Xn,k=await tp.provideCompletionItems(e,t,n,o);v(tp,k,C)})();for(const w of s.orderedGroups(e)){let C=!1;if(await Promise.all(w.map(async k=>{if(i.providerItemsToReuse.has(k)){const D=i.providerItemsToReuse.get(k);D.forEach(A=>l.push(A)),C=C||D.length>0;return}if(!(i.providerFilter.size>0&&!i.providerFilter.has(k)))try{const D=new Xn,A=await k.provideCompletionItems(e,t,n,o);C=v(k,A,D)||C}catch(D){Ln(D)}})),C||o.isCancellationRequested)break}return await _,o.isCancellationRequested?(u.dispose(),Promise.reject(new fo)):new XPe(l.sort(eLe(i.snippetSortOrder)),m,{entries:g,elapsed:r.elapsed()},u)}function t4(s,e){if(s.sortTextLow&&e.sortTextLow){if(s.sortTextLow<e.sortTextLow)return-1;if(s.sortTextLow>e.sortTextLow)return 1}return s.textLabel<e.textLabel?-1:s.textLabel>e.textLabel?1:s.completion.kind-e.completion.kind}function ZPe(s,e){if(s.completion.kind!==e.completion.kind){if(s.completion.kind===De.Snippet)return-1;if(e.completion.kind===De.Snippet)return 1}return t4(s,e)}function JPe(s,e){if(s.completion.kind!==e.completion.kind){if(s.completion.kind===De.Snippet)return 1;if(e.completion.kind===De.Snippet)return-1}return t4(s,e)}const TO=new Map;TO.set(Pu.Top,ZPe);TO.set(Pu.Bottom,JPe);TO.set(Pu.Inline,t4);function eLe(s){return TO.get(s)}Ee.registerCommand("_executeCompletionItemProvider",async(s,...e)=>{const[t,i,n,o]=e;yt(R.isUri(t)),yt(we.isIPosition(i)),yt(typeof n=="string"||!n),yt(typeof o=="number"||!o);const{completionProvider:r}=s.get(Ne),a=await s.get(Ci).createModelReference(t);try{const c={incomplete:!1,suggestions:[]},d=[],l=a.object.textEditorModel.validatePosition(i),u=await e4(r,a.object.textEditorModel,l,void 0,{triggerCharacter:n??void 0,triggerKind:n?ba.TriggerCharacter:ba.Invoke});for(const g of u.items)d.length<(o??0)&&d.push(g.resolve(Ce.None)),c.incomplete=c.incomplete||g.container.incomplete,c.suggestions.push(g.completion);try{return await Promise.all(d),c}finally{setTimeout(()=>u.disposable.dispose(),100)}}finally{a.dispose()}});function Vde(s,e){s.getContribution("editor.contrib.suggestController")?.triggerSuggest(new Set().add(e),void 0,!0)}class gb{static isAllOff(e){return e.other==="off"&&e.comments==="off"&&e.strings==="off"}static isAllOn(e){return e.other==="on"&&e.comments==="on"&&e.strings==="on"}static valueFor(e,t){switch(t){case jc.Comment:return e.comments;case jc.String:return e.strings;default:return e.other}}}const tLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),iLe=Object.freeze({CURRENT_YEAR:!0,CURRENT_YEAR_SHORT:!0,CURRENT_MONTH:!0,CURRENT_DATE:!0,CURRENT_HOUR:!0,CURRENT_MINUTE:!0,CURRENT_SECOND:!0,CURRENT_DAY_NAME:!0,CURRENT_DAY_NAME_SHORT:!0,CURRENT_MONTH_NAME:!0,CURRENT_MONTH_NAME_SHORT:!0,CURRENT_SECONDS_UNIX:!0,CURRENT_TIMEZONE_OFFSET:!0,SELECTION:!0,CLIPBOARD:!0,TM_SELECTED_TEXT:!0,TM_CURRENT_LINE:!0,TM_CURRENT_WORD:!0,TM_LINE_INDEX:!0,TM_LINE_NUMBER:!0,TM_FILENAME:!0,TM_FILENAME_BASE:!0,TM_DIRECTORY:!0,TM_FILEPATH:!0,CURSOR_INDEX:!0,CURSOR_NUMBER:!0,RELATIVE_FILEPATH:!0,BLOCK_COMMENT_START:!0,BLOCK_COMMENT_END:!0,LINE_COMMENT:!0,WORKSPACE_NAME:!0,WORKSPACE_FOLDER:!0,RANDOM:!0,RANDOM_HEX:!0,UUID:!0});class LX{constructor(e){this._delegates=e}resolve(e){for(const t of this._delegates){const i=t.resolve(e);if(i!==void 0)return i}}}class MX{constructor(e,t,i,n){this._model=e,this._selection=t,this._selectionIdx=i,this._overtypingCapturer=n}resolve(e){const{name:t}=e;if(t==="SELECTION"||t==="TM_SELECTED_TEXT"){let i=this._model.getValueInRange(this._selection)||void 0,n=this._selection.startLineNumber!==this._selection.endLineNumber;if(!i&&this._overtypingCapturer){const o=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);o&&(i=o.value,n=o.multiline)}if(i&&n&&e.snippet){const o=this._model.getLineContent(this._selection.startLineNumber),r=lo(o,0,this._selection.startColumn-1);let a=r;e.snippet.walk(d=>d===e?!1:(d instanceof vr&&(a=lo(Ch(d.value).pop())),!0));const c=sf(a,r);i=i.replace(/(\r\n|\r|\n)(.*)/g,(d,l,u)=>`${l}${a.substr(c)}${u}`)}return i}else{if(t==="TM_CURRENT_LINE")return this._model.getLineContent(this._selection.positionLineNumber);if(t==="TM_CURRENT_WORD"){const i=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return i&&i.word||void 0}else{if(t==="TM_LINE_INDEX")return String(this._selection.positionLineNumber-1);if(t==="TM_LINE_NUMBER")return String(this._selection.positionLineNumber);if(t==="CURSOR_INDEX")return String(this._selectionIdx);if(t==="CURSOR_NUMBER")return String(this._selectionIdx+1)}}}}class NX{constructor(e,t){this._labelService=e,this._model=t}resolve(e){const{name:t}=e;if(t==="TM_FILENAME")return an(this._model.uri.fsPath);if(t==="TM_FILENAME_BASE"){const i=an(this._model.uri.fsPath),n=i.lastIndexOf(".");return n<=0?i:i.slice(0,n)}else{if(t==="TM_DIRECTORY")return jM(this._model.uri.fsPath)==="."?"":this._labelService.getUriLabel(_s(this._model.uri));if(t==="TM_FILEPATH")return this._labelService.getUriLabel(this._model.uri);if(t==="RELATIVE_FILEPATH")return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}}}class OX{constructor(e,t,i,n){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=i,this._spread=n}resolve(e){if(e.name!=="CLIPBOARD")return;const t=this._readClipboardText();if(t){if(this._spread){const i=t.split(/\r\n|\n|\r/).filter(n=>!pu(n));if(i.length===this._selectionCount)return i[this._selectionIdx]}return t}}}let tP=class{constructor(e,t,i){this._model=e,this._selection=t,this._languageConfigurationService=i}resolve(e){const{name:t}=e,i=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),n=this._languageConfigurationService.getLanguageConfiguration(i).comments;if(n){if(t==="LINE_COMMENT")return n.lineCommentToken||void 0;if(t==="BLOCK_COMMENT_START")return n.blockCommentStartToken||void 0;if(t==="BLOCK_COMMENT_END")return n.blockCommentEndToken||void 0}}};tP=f([p(2,ds)],tP);class bm{constructor(){this._date=new Date}static{this.dayNames=[h(1453,"Sunday"),h(1454,"Monday"),h(1455,"Tuesday"),h(1456,"Wednesday"),h(1457,"Thursday"),h(1458,"Friday"),h(1459,"Saturday")]}static{this.dayNamesShort=[h(1460,"Sun"),h(1461,"Mon"),h(1462,"Tue"),h(1463,"Wed"),h(1464,"Thu"),h(1465,"Fri"),h(1466,"Sat")]}static{this.monthNames=[h(1467,"January"),h(1468,"February"),h(1469,"March"),h(1470,"April"),h(1471,"May"),h(1472,"June"),h(1473,"July"),h(1474,"August"),h(1475,"September"),h(1476,"October"),h(1477,"November"),h(1478,"December")]}static{this.monthNamesShort=[h(1479,"Jan"),h(1480,"Feb"),h(1481,"Mar"),h(1482,"Apr"),h(1483,"May"),h(1484,"Jun"),h(1485,"Jul"),h(1486,"Aug"),h(1487,"Sep"),h(1488,"Oct"),h(1489,"Nov"),h(1490,"Dec")]}resolve(e){const{name:t}=e;if(t==="CURRENT_YEAR")return String(this._date.getFullYear());if(t==="CURRENT_YEAR_SHORT")return String(this._date.getFullYear()).slice(-2);if(t==="CURRENT_MONTH")return String(this._date.getMonth().valueOf()+1).padStart(2,"0");if(t==="CURRENT_DATE")return String(this._date.getDate().valueOf()).padStart(2,"0");if(t==="CURRENT_HOUR")return String(this._date.getHours().valueOf()).padStart(2,"0");if(t==="CURRENT_MINUTE")return String(this._date.getMinutes().valueOf()).padStart(2,"0");if(t==="CURRENT_SECOND")return String(this._date.getSeconds().valueOf()).padStart(2,"0");if(t==="CURRENT_DAY_NAME")return bm.dayNames[this._date.getDay()];if(t==="CURRENT_DAY_NAME_SHORT")return bm.dayNamesShort[this._date.getDay()];if(t==="CURRENT_MONTH_NAME")return bm.monthNames[this._date.getMonth()];if(t==="CURRENT_MONTH_NAME_SHORT")return bm.monthNamesShort[this._date.getMonth()];if(t==="CURRENT_SECONDS_UNIX")return String(Math.floor(this._date.getTime()/1e3));if(t==="CURRENT_TIMEZONE_OFFSET"){const i=this._date.getTimezoneOffset(),n=i>0?"-":"+",o=Math.trunc(Math.abs(i/60)),r=o<10?"0"+o:o,a=Math.abs(i)-o*60,c=a<10?"0"+a:a;return n+r+":"+c}}}class FX{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;const t=hC(this._workspaceService.getWorkspace());if(!kve(t)){if(e.name==="WORKSPACE_NAME")return this._resolveWorkspaceName(t);if(e.name==="WORKSPACE_FOLDER")return this._resoveWorkspacePath(t)}}_resolveWorkspaceName(e){if(IE(e))return an(e.uri.path);let t=an(e.configPath.path);return t.endsWith($6)&&(t=t.substr(0,t.length-$6.length-1)),t}_resoveWorkspacePath(e){if(IE(e))return KT(e.uri.fsPath);const t=an(e.configPath.path);let i=e.configPath.fsPath;return i.endsWith(t)&&(i=i.substr(0,i.length-t.length-1)),i?KT(i):"/"}}class WX{resolve(e){const{name:t}=e;if(t==="RANDOM")return Math.random().toString().slice(-6);if(t==="RANDOM_HEX")return Math.random().toString(16).slice(-6);if(t==="UUID")return Pn()}}var Rd;Ve(tLe);class Oc{static{this._decor={active:Zt.register({description:"snippet-placeholder-1",stickiness:ki.AlwaysGrowsWhenTypingAtEdges,className:"snippet-placeholder"}),inactive:Zt.register({description:"snippet-placeholder-2",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"snippet-placeholder"}),activeFinal:Zt.register({description:"snippet-placeholder-3",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"finish-snippet-placeholder"}),inactiveFinal:Zt.register({description:"snippet-placeholder-4",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"finish-snippet-placeholder"})}}constructor(e,t,i){this._editor=e,this._snippet=t,this._snippetLineLeadingWhitespace=i,this._offset=-1,this._nestingLevel=1,this._placeholderGroups=GT(t.placeholders,Zr.compareByIndex),this._placeholderGroupsIdx=-1}initialize(e){this._offset=e.newPosition}dispose(){this._placeholderDecorations&&this._editor.removeDecorations([...this._placeholderDecorations.values()]),this._placeholderGroups.length=0}_initDecorations(){if(this._offset===-1)throw new Error("Snippet not initialized!");if(this._placeholderDecorations)return;this._placeholderDecorations=new Map;const e=this._editor.getModel();this._editor.changeDecorations(t=>{for(const i of this._snippet.placeholders){const n=this._snippet.offset(i),o=this._snippet.fullLen(i),r=P.fromPositions(e.getPositionAt(this._offset+n),e.getPositionAt(this._offset+n+o)),a=i.isFinalTabstop?Oc._decor.inactiveFinal:Oc._decor.inactive,c=t.addDecoration(r,a);this._placeholderDecorations.set(i,c)}})}move(e){if(!this._editor.hasModel())return[];if(this._initDecorations(),this._placeholderGroupsIdx>=0){const n=[];for(const o of this._placeholderGroups[this._placeholderGroupsIdx])if(o.transform){const r=this._placeholderDecorations.get(o),a=this._editor.getModel().getDecorationRange(r),c=this._editor.getModel().getValueInRange(a),d=o.transform.resolve(c).split(/\r\n|\r|\n/);for(let l=1;l<d.length;l++)d[l]=this._editor.getModel().normalizeIndentation(this._snippetLineLeadingWhitespace+d[l]);n.push(qi.replace(a,d.join(this._editor.getModel().getEOL())))}n.length>0&&this._editor.executeEdits("snippet.placeholderTransform",n)}let t=!1;e===!0&&this._placeholderGroupsIdx<this._placeholderGroups.length-1?(this._placeholderGroupsIdx+=1,t=!0):e===!1&&this._placeholderGroupsIdx>0&&(this._placeholderGroupsIdx-=1,t=!0);const i=this._editor.getModel().changeDecorations(n=>{const o=new Set,r=[];for(const a of this._placeholderGroups[this._placeholderGroupsIdx]){const c=this._placeholderDecorations.get(a),d=this._editor.getModel().getDecorationRange(c);r.push(new at(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn)),t=t&&this._hasPlaceholderBeenCollapsed(a),n.changeDecorationOptions(c,a.isFinalTabstop?Oc._decor.activeFinal:Oc._decor.active),o.add(a);for(const l of this._snippet.enclosingPlaceholders(a)){const u=this._placeholderDecorations.get(l);n.changeDecorationOptions(u,l.isFinalTabstop?Oc._decor.activeFinal:Oc._decor.active),o.add(l)}}for(const[a,c]of this._placeholderDecorations)o.has(a)||n.changeDecorationOptions(c,a.isFinalTabstop?Oc._decor.inactiveFinal:Oc._decor.inactive);return r});return t?this.move(e):i??[]}_hasPlaceholderBeenCollapsed(e){let t=e;for(;t;){if(t instanceof Zr){const i=this._placeholderDecorations.get(t);if(this._editor.getModel().getDecorationRange(i).isEmpty()&&t.toString().length>0)return!0}t=t.parent}return!1}get isAtFirstPlaceholder(){return this._placeholderGroupsIdx<=0||this._placeholderGroups.length===0}get isAtLastPlaceholder(){return this._placeholderGroupsIdx===this._placeholderGroups.length-1}get hasPlaceholder(){return this._snippet.placeholders.length>0}get isTrivialSnippet(){if(this._snippet.placeholders.length===0)return!0;if(this._snippet.placeholders.length===1){const[e]=this._snippet.placeholders;if(e.isFinalTabstop&&this._snippet.rightMostDescendant===e)return!0}return!1}computePossibleSelections(){const e=new Map;for(const t of this._placeholderGroups){let i;for(const n of t){if(n.isFinalTabstop)break;i||(i=[],e.set(n.index,i));const o=this._placeholderDecorations.get(n),r=this._editor.getModel().getDecorationRange(o);if(!r){e.delete(n.index);break}i.push(r)}}return e}get activeChoice(){if(!this._placeholderDecorations)return;const e=this._placeholderGroups[this._placeholderGroupsIdx][0];if(!e?.choice)return;const t=this._placeholderDecorations.get(e);if(!t)return;const i=this._editor.getModel().getDecorationRange(t);if(i)return{range:i,choice:e.choice}}get hasChoice(){let e=!1;return this._snippet.walk(t=>(e=t instanceof Jw,!e)),e}merge(e){const t=this._editor.getModel();this._nestingLevel*=10,this._editor.changeDecorations(i=>{for(const n of this._placeholderGroups[this._placeholderGroupsIdx]){const o=e.shift();console.assert(o._offset!==-1),console.assert(!o._placeholderDecorations);const r=o._snippet.placeholderInfo.last.index;for(const c of o._snippet.placeholderInfo.all)c.isFinalTabstop?c.index=n.index+(r+1)/this._nestingLevel:c.index=n.index+c.index/this._nestingLevel;this._snippet.replace(n,o._snippet.children);const a=this._placeholderDecorations.get(n);i.removeDecoration(a),this._placeholderDecorations.delete(n);for(const c of o._snippet.placeholders){const d=o._snippet.offset(c),l=o._snippet.fullLen(c),u=P.fromPositions(t.getPositionAt(o._offset+d),t.getPositionAt(o._offset+d+l)),g=i.addDecoration(u,Oc._decor.inactive);this._placeholderDecorations.set(c,g)}}this._placeholderGroups=GT(this._snippet.placeholders,Zr.compareByIndex)})}getEnclosingRange(){let e;const t=this._editor.getModel();for(const i of this._placeholderDecorations.values()){const n=t.getDecorationRange(i)??void 0;e?e=e.plusRange(n):e=n}return e}}const BX={overwriteBefore:0,overwriteAfter:0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let iP=Rd=class{static adjustWhitespace(e,t,i,n,o){const r=e.getLineContent(t.lineNumber),a=lo(r,0,t.column-1);let c;return n.walk(d=>{if(!(d instanceof vr)||d.parent instanceof Jw||o&&!o.has(d))return!0;const l=d.value.split(/\r\n|\r|\n/);if(i){const g=n.offset(d);if(g===0)l[0]=e.normalizeIndentation(l[0]);else{c=c??n.toString();const m=c.charCodeAt(g-1);(m===st.LineFeed||m===st.CarriageReturn)&&(l[0]=e.normalizeIndentation(a+l[0]))}for(let m=1;m<l.length;m++)l[m]=e.normalizeIndentation(a+l[m])}const u=l.join(e.getEOL());return u!==d.value&&(d.parent.replace(d,[new vr(u)]),c=void 0),!0}),a}static adjustSelection(e,t,i,n){if(i!==0||n!==0){const{positionLineNumber:o,positionColumn:r}=t,a=r-i,c=r+n,d=e.validateRange({startLineNumber:o,startColumn:a,endLineNumber:o,endColumn:c});t=at.createWithDirection(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn,t.getDirection())}return t}static createEditsAndSnippetsFromSelections(e,t,i,n,o,r,a,c,d){const l=[],u=[];if(!e.hasModel())return{edits:l,snippets:u};const g=e.getModel(),m=e.invokeWithinContext(A=>A.get(It)),v=e.invokeWithinContext(A=>new NX(A.get(ui),g)),_=()=>a,w=g.getValueInRange(Rd.adjustSelection(g,e.getSelection(),i,0)),C=g.getValueInRange(Rd.adjustSelection(g,e.getSelection(),0,n)),k=g.getLineFirstNonWhitespaceColumn(e.getSelection().positionLineNumber),D=e.getSelections().map((A,B)=>({selection:A,idx:B})).sort((A,B)=>P.compareRangesUsingStarts(A.selection,B.selection));for(const{selection:A,idx:B}of D){let q=Rd.adjustSelection(g,A,i,0),Q=Rd.adjustSelection(g,A,0,n);w!==g.getValueInRange(q)&&(q=A),C!==g.getValueInRange(Q)&&(Q=A);const ie=A.setStartPosition(q.startLineNumber,q.startColumn).setEndPosition(Q.endLineNumber,Q.endColumn),oe=new fd().parse(t,!0,o),be=ie.getStartPosition(),me=Rd.adjustWhitespace(g,be,r||B>0&&k!==g.getLineFirstNonWhitespaceColumn(A.positionLineNumber),oe);oe.resolveVariables(new LX([v,new OX(_,B,D.length,e.getOption(L.multiCursorPaste)==="spread"),new MX(g,A,B,c),new tP(g,A,d),new bm,new FX(m),new WX])),l[B]=qi.replace(ie,oe.toString()),l[B].identifier={major:B,minor:0},l[B]._isTracked=!0,u[B]=new Oc(e,oe,me)}return{edits:l,snippets:u}}static createEditsAndSnippetsFromEdits(e,t,i,n,o,r,a){if(!e.hasModel()||t.length===0)return{edits:[],snippets:[]};const c=[],d=e.getModel(),l=new fd,u=new tD,g=new LX([e.invokeWithinContext(v=>new NX(v.get(ui),d)),new OX(()=>o,0,e.getSelections().length,e.getOption(L.multiCursorPaste)==="spread"),new MX(d,e.getSelection(),0,r),new tP(d,e.getSelection(),a),new bm,new FX(e.invokeWithinContext(v=>v.get(It))),new WX]);t=t.sort((v,_)=>P.compareRangesUsingStarts(v.range,_.range));let m=0;for(let v=0;v<t.length;v++){const{range:_,template:w,keepWhitespace:C}=t[v];if(v>0){const q=t[v-1].range,Q=P.fromPositions(q.getEndPosition(),_.getStartPosition()),ie=new vr(d.getValueInRange(Q));u.appendChild(ie),m+=ie.value.length}const k=l.parseFragment(w,u);Rd.adjustWhitespace(d,_.getStartPosition(),C!==void 0?!C:n,u,new Set(k)),u.resolveVariables(g);const D=u.toString(),A=D.slice(m);m=D.length;const B=qi.replace(_,A);B.identifier={major:v,minor:0},B._isTracked=!0,c.push(B)}return l.ensureFinalTabstop(u,i,!0),{edits:c,snippets:[new Oc(e,u,"")]}}constructor(e,t,i=BX,n){this._editor=e,this._template=t,this._options=i,this._languageConfigurationService=n,this._templateMerges=[],this._snippets=[]}dispose(){Xe(this._snippets)}_logInfo(){return`template="${this._template}", merged_templates="${this._templateMerges.join(" -> ")}"`}insert(){if(!this._editor.hasModel())return;const{edits:e,snippets:t}=typeof this._template=="string"?Rd.createEditsAndSnippetsFromSelections(this._editor,this._template,this._options.overwriteBefore,this._options.overwriteAfter,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService):Rd.createEditsAndSnippetsFromEdits(this._editor,this._template,!1,this._options.adjustWhitespace,this._options.clipboardText,this._options.overtypingCapturer,this._languageConfigurationService);this._snippets=t,this._editor.executeEdits("snippet",e,i=>{const n=i.filter(o=>!!o.identifier);for(let o=0;o<t.length;o++)t[o].initialize(n[o].textChange);return this._snippets[0].hasPlaceholder?this._move(!0):n.map(o=>at.fromPositions(o.range.getEndPosition()))}),this._editor.revealRange(this._editor.getSelections()[0])}merge(e,t=BX){if(!this._editor.hasModel())return;this._templateMerges.push([this._snippets[0]._nestingLevel,this._snippets[0]._placeholderGroupsIdx,e]);const{edits:i,snippets:n}=Rd.createEditsAndSnippetsFromSelections(this._editor,e,t.overwriteBefore,t.overwriteAfter,!0,t.adjustWhitespace,t.clipboardText,t.overtypingCapturer,this._languageConfigurationService);this._editor.executeEdits("snippet",i,o=>{const r=o.filter(c=>!!c.identifier);for(let c=0;c<n.length;c++)n[c].initialize(r[c].textChange);const a=n[0].isTrivialSnippet;if(!a){for(const c of this._snippets)c.merge(n);console.assert(n.length===0)}return this._snippets[0].hasPlaceholder&&!a?this._move(void 0):r.map(c=>at.fromPositions(c.range.getEndPosition()))})}next(){const e=this._move(!0);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}prev(){const e=this._move(!1);this._editor.setSelections(e),this._editor.revealPositionInCenterIfOutsideViewport(e[0].getPosition())}_move(e){const t=[];for(const i of this._snippets){const n=i.move(e);t.push(...n)}return t}get isAtFirstPlaceholder(){return this._snippets[0].isAtFirstPlaceholder}get isAtLastPlaceholder(){return this._snippets[0].isAtLastPlaceholder}get hasPlaceholder(){return this._snippets[0].hasPlaceholder}get hasChoice(){return this._snippets[0].hasChoice}get activeChoice(){return this._snippets[0].activeChoice}isSelectionWithinPlaceholders(){if(!this.hasPlaceholder)return!1;const e=this._editor.getSelections();if(e.length<this._snippets.length)return!1;const t=new Map;for(const i of this._snippets){const n=i.computePossibleSelections();if(t.size===0)for(const[o,r]of n){r.sort(P.compareRangesUsingStarts);for(const a of e)if(r[0].containsRange(a)){t.set(o,[]);break}}if(t.size===0)return!1;t.forEach((o,r)=>{o.push(...n.get(r))})}e.sort(P.compareRangesUsingStarts);for(const[i,n]of t){if(n.length!==e.length){t.delete(i);continue}n.sort(P.compareRangesUsingStarts);for(let o=0;o<n.length;o++)if(!n[o].containsRange(e[o])){t.delete(i);continue}}return t.size>0}getEnclosingRange(){let e;for(const t of this._snippets){const i=t.getEnclosingRange();e?e=e.plusRange(i):e=i}return e}};iP=Rd=f([p(3,ds)],iP);var R_;const tk={overwriteBefore:0,overwriteAfter:0,undoStopBefore:!0,undoStopAfter:!0,adjustWhitespace:!0,clipboardText:void 0,overtypingCapturer:void 0};let cs=class{static{R_=this}static{this.ID="snippetController2"}static get(e){return e.getContribution(R_.ID)}static{this.InSnippetMode=new O("inSnippetMode",!1,h(1449,"Whether the editor in current in snippet mode"))}static{this.HasNextTabstop=new O("hasNextTabstop",!1,h(1450,"Whether there is a next tab stop when in snippet mode"))}static{this.HasPrevTabstop=new O("hasPrevTabstop",!1,h(1451,"Whether there is a previous tab stop when in snippet mode"))}constructor(e,t,i,n,o){this._editor=e,this._logService=t,this._languageFeaturesService=i,this._languageConfigurationService=o,this._snippetListener=new U,this._modelVersionId=-1,this._inSnippet=R_.InSnippetMode.bindTo(n),this._hasNextTabstop=R_.HasNextTabstop.bindTo(n),this._hasPrevTabstop=R_.HasPrevTabstop.bindTo(n)}dispose(){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._session?.dispose(),this._snippetListener.dispose()}apply(e,t){try{this._doInsert(e,typeof t>"u"?tk:{...tk,...t})}catch(i){this.cancel(),this._logService.error(i),this._logService.error("snippet_error"),this._logService.error("insert_edits=",e),this._logService.error("existing_template=",this._session?this._session._logInfo():"<no_session>")}}insert(e,t){try{this._doInsert(e,typeof t>"u"?tk:{...tk,...t})}catch(i){this.cancel(),this._logService.error(i),this._logService.error("snippet_error"),this._logService.error("insert_template=",e),this._logService.error("existing_template=",this._session?this._session._logInfo():"<no_session>")}}_doInsert(e,t){if(this._editor.hasModel()){if(this._snippetListener.clear(),t.undoStopBefore&&this._editor.getModel().pushStackElement(),this._session&&typeof e!="string"&&this.cancel(),this._session?(yt(typeof e=="string"),this._session.merge(e,t)):(this._modelVersionId=this._editor.getModel().getAlternativeVersionId(),this._session=new iP(this._editor,e,t,this._languageConfigurationService),this._session.insert()),t.undoStopAfter&&this._editor.getModel().pushStackElement(),this._session?.hasChoice){const i={_debugDisplayName:"snippetChoiceCompletions",provideCompletionItems:(d,l)=>{if(!this._session||d!==this._editor.getModel()||!we.equals(this._editor.getPosition(),l))return;const{activeChoice:u}=this._session;if(!u||u.choice.options.length===0)return;const g=d.getValueInRange(u.range),m=!!u.choice.options.find(_=>_.value===g),v=[];for(let _=0;_<u.choice.options.length;_++){const w=u.choice.options[_];v.push({kind:De.Value,label:w.value,insertText:w.value,sortText:"a".repeat(_+1),range:u.range,filterText:m?`${g}_${w.value}`:void 0,command:{id:"jumpToNextSnippetPlaceholder",title:h(1452,"Go to next placeholder...")}})}return{suggestions:v}}},n=this._editor.getModel();let o,r=!1;const a=()=>{o?.dispose(),r=!1},c=()=>{r||(o=this._languageFeaturesService.completionProvider.register({language:n.getLanguageId(),pattern:n.uri.fsPath,scheme:n.uri.scheme,exclusive:!0},i),this._snippetListener.add(o),r=!0)};this._choiceCompletions={provider:i,enable:c,disable:a}}this._updateState(),this._snippetListener.add(this._editor.onDidChangeModelContent(i=>i.isFlush&&this.cancel())),this._snippetListener.add(this._editor.onDidChangeModel(()=>this.cancel())),this._snippetListener.add(this._editor.onDidChangeCursorSelection(()=>this._updateState()))}}_updateState(){if(!(!this._session||!this._editor.hasModel())){if(this._modelVersionId===this._editor.getModel().getAlternativeVersionId())return this.cancel();if(!this._session.hasPlaceholder)return this.cancel();if(this._session.isAtLastPlaceholder||!this._session.isSelectionWithinPlaceholders())return this._editor.getModel().pushStackElement(),this.cancel();this._inSnippet.set(!0),this._hasPrevTabstop.set(!this._session.isAtFirstPlaceholder),this._hasNextTabstop.set(!this._session.isAtLastPlaceholder),this._handleChoice()}}_handleChoice(){if(!this._session||!this._editor.hasModel()){this._currentChoice=void 0;return}const{activeChoice:e}=this._session;if(!e||!this._choiceCompletions){this._choiceCompletions?.disable(),this._currentChoice=void 0;return}this._currentChoice!==e.choice&&(this._currentChoice=e.choice,this._choiceCompletions.enable(),queueMicrotask(()=>{Vde(this._editor,this._choiceCompletions.provider)}))}finish(){for(;this._inSnippet.get();)this.next()}cancel(e=!1){this._inSnippet.reset(),this._hasPrevTabstop.reset(),this._hasNextTabstop.reset(),this._snippetListener.clear(),this._currentChoice=void 0,this._session?.dispose(),this._session=void 0,this._modelVersionId=-1,e&&this._editor.setSelections([this._editor.getSelection()])}prev(){this._session?.prev(),this._updateState()}next(){this._session?.next(),this._updateState()}isInSnippet(){return!!this._inSnippet.get()}getSessionEnclosingRange(){if(this._session)return this._session.getEnclosingRange()}};cs=R_=f([p(1,Re),p(2,Ne),p(3,fe),p(4,ds)],cs);Lt(cs.ID,cs,_t.Lazy);const AO=Vo.bindToContribution(cs.get);ze(new AO({id:"jumpToNextSnippetPlaceholder",precondition:x.and(cs.InSnippetMode,cs.HasNextTabstop),handler:s=>s.next(),kbOpts:{weight:W.EditorContrib+30,kbExpr:V.textInputFocus,primary:S.Tab}}));ze(new AO({id:"jumpToPrevSnippetPlaceholder",precondition:x.and(cs.InSnippetMode,cs.HasPrevTabstop),handler:s=>s.prev(),kbOpts:{weight:W.EditorContrib+30,kbExpr:V.textInputFocus,primary:E.Shift|S.Tab}}));ze(new AO({id:"leaveSnippet",precondition:cs.InSnippetMode,handler:s=>s.cancel(!0),kbOpts:{weight:W.EditorContrib+30,kbExpr:V.textInputFocus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));ze(new AO({id:"acceptSnippet",precondition:cs.InSnippetMode,handler:s=>s.finish()}));var yH;let nP=class{static{yH=this}static{this.AtEnd=new O("atEndOfWord",!1,{type:"boolean",description:h(1538,"A context key that is true when at the end of a word. Note that this is only defined when tab-completions are enabled")})}constructor(e,t){this._editor=e,this._enabled=!1,this._ckAtEnd=yH.AtEnd.bindTo(t),this._configListener=this._editor.onDidChangeConfiguration(i=>i.hasChanged(L.tabCompletion)&&this._update()),this._update()}dispose(){this._configListener.dispose(),this._selectionListener?.dispose(),this._ckAtEnd.reset()}_update(){const e=this._editor.getOption(L.tabCompletion)==="on";if(this._enabled!==e)if(this._enabled=e,this._enabled){const t=()=>{if(!this._editor.hasModel()){this._ckAtEnd.set(!1);return}const i=this._editor.getModel(),n=this._editor.getSelection(),o=i.getWordAtPosition(n.getStartPosition());if(!o){this._ckAtEnd.set(!1);return}this._ckAtEnd.set(o.endColumn===n.getStartPosition().column&&n.getStartPosition().lineNumber===n.getEndPosition().lineNumber)};this._selectionListener=this._editor.onDidChangeCursorSelection(t),t()}else this._selectionListener&&(this._ckAtEnd.reset(),this._selectionListener.dispose(),this._selectionListener=void 0)}};nP=yH=f([p(1,fe)],nP);var QS;let Ky=class{static{QS=this}static{this.OtherSuggestions=new O("hasOtherSuggestions",!1)}constructor(e,t){this._editor=e,this._index=0,this._ckOtherSuggestions=QS.OtherSuggestions.bindTo(t)}dispose(){this.reset()}reset(){this._ckOtherSuggestions.reset(),this._listener?.dispose(),this._model=void 0,this._acceptNext=void 0,this._ignore=!1}set({model:e,index:t},i){if(e.items.length===0){this.reset();return}if(QS._moveIndex(!0,e,t)===t){this.reset();return}this._acceptNext=i,this._model=e,this._index=t,this._listener=this._editor.onDidChangeCursorPosition(()=>{this._ignore||this.reset()}),this._ckOtherSuggestions.set(!0)}static _moveIndex(e,t,i){let n=i;for(let o=t.items.length;o>0&&(n=(n+t.items.length+(e?1:-1))%t.items.length,!(n===i||!t.items[n].completion.additionalTextEdits));o--);return n}next(){this._move(!0)}prev(){this._move(!1)}_move(e){if(this._model)try{this._ignore=!0,this._index=QS._moveIndex(e,this._model,this._index),this._acceptNext({index:this._index,item:this._model.items[this._index],model:this._model})}finally{this._ignore=!1}}};Ky=QS=f([p(1,fe)],Ky);class Fc{async provideSelectionRanges(e,t){const i=[];for(const n of t){const o=[];i.push(o);const r=new Map;await new Promise(a=>Fc._bracketsRightYield(a,0,e,n,r)),await new Promise(a=>Fc._bracketsLeftYield(a,0,e,n,r,o))}return i}static{this._maxDuration=30}static{this._maxRounds=2}static _bracketsRightYield(e,t,i,n,o){const r=new Map,a=Date.now();for(;;){if(t>=Fc._maxRounds){e();break}if(!n){e();break}const c=i.bracketPairs.findNextBracket(n);if(!c){e();break}if(Date.now()-a>Fc._maxDuration){setTimeout(()=>Fc._bracketsRightYield(e,t+1,i,n,o));break}if(c.bracketInfo.isOpeningBracket){const l=c.bracketInfo.bracketText,u=r.has(l)?r.get(l):0;r.set(l,u+1)}else{const l=c.bracketInfo.getOpeningBrackets()[0].bracketText;let u=r.has(l)?r.get(l):0;if(u-=1,r.set(l,Math.max(0,u)),u<0){let g=o.get(l);g||(g=new wz,o.set(l,g)),g.push(c.range)}}n=c.range.getEndPosition()}}static _bracketsLeftYield(e,t,i,n,o,r){const a=new Map,c=Date.now();for(;;){if(t>=Fc._maxRounds&&o.size===0){e();break}if(!n){e();break}const d=i.bracketPairs.findPrevBracket(n);if(!d){e();break}if(Date.now()-c>Fc._maxDuration){setTimeout(()=>Fc._bracketsLeftYield(e,t+1,i,n,o,r));break}if(d.bracketInfo.isOpeningBracket){const u=d.bracketInfo.bracketText;let g=a.has(u)?a.get(u):0;if(g-=1,a.set(u,Math.max(0,g)),g<0){const m=o.get(u);if(m){const v=m.shift();m.size===0&&o.delete(u);const _=P.fromPositions(d.range.getEndPosition(),v.getStartPosition()),w=P.fromPositions(d.range.getStartPosition(),v.getEndPosition());r.push({range:_}),r.push({range:w}),Fc._addBracketLeading(i,w,r)}}}else{const u=d.bracketInfo.getOpeningBrackets()[0].bracketText,g=a.has(u)?a.get(u):0;a.set(u,g+1)}n=d.range.getStartPosition()}}static _addBracketLeading(e,t,i){if(t.startLineNumber===t.endLineNumber)return;const n=t.startLineNumber,o=e.getLineFirstNonWhitespaceColumn(n);o!==0&&o!==t.startColumn&&(i.push({range:P.fromPositions(new we(n,o),t.getEndPosition())}),i.push({range:P.fromPositions(new we(n,1),t.getEndPosition())}));const r=n-1;if(r>0){const a=e.getLineFirstNonWhitespaceColumn(r);a===t.startColumn&&a!==e.getLineLastNonWhitespaceColumn(r)&&(i.push({range:P.fromPositions(new we(r,a),t.getEndPosition())}),i.push({range:P.fromPositions(new we(r,1),t.getEndPosition())}))}}}class ql{static{this.None=new class extends ql{distance(){return 0}}}static async create(e,t){if(!t.getOption(L.suggest).localityBonus||!t.hasModel())return ql.None;const i=t.getModel(),n=t.getPosition();if(!e.canComputeWordRanges(i.uri))return ql.None;const[o]=await new Fc().provideSelectionRanges(i,[n]);if(o.length===0)return ql.None;const r=await e.computeWordRanges(i.uri,o[0].range);if(!r)return ql.None;const a=i.getWordUntilPosition(n);return delete r[a.word],new class extends ql{distance(c,d){if(!n.equals(t.getPosition()))return 0;if(d.kind===De.Keyword)return 2<<20;const l=typeof d.label=="string"?d.label:d.label.label,u=r[l];if(Tve(u))return 2<<20;const g=MT(u,P.fromPositions(c),P.compareRangesUsingStarts),m=g>=0?u[g]:u[Math.max(0,~g-1)];let v=o.length;for(const _ of o){if(!P.containsRange(_.range,m))break;v-=1}return v}}}}let VX=class{constructor(e,t){this.leadingLineContent=e,this.characterCountDelta=t}};var Xg;(function(s){s[s.Nothing=0]="Nothing",s[s.All=1]="All",s[s.Incr=2]="Incr"})(Xg||(Xg={}));class ip{constructor(e,t,i,n,o,r,a=bne.default,c=void 0){this.clipboardText=c,this._snippetCompareFn=ip._compareCompletionItems,this._items=e,this._column=t,this._wordDistance=n,this._options=o,this._refilterKind=Xg.All,this._lineContext=i,this._fuzzyScoreOptions=a,r==="top"?this._snippetCompareFn=ip._compareCompletionItemsSnippetsUp:r==="bottom"&&(this._snippetCompareFn=ip._compareCompletionItemsSnippetsDown)}get lineContext(){return this._lineContext}set lineContext(e){(this._lineContext.leadingLineContent!==e.leadingLineContent||this._lineContext.characterCountDelta!==e.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<e.characterCountDelta&&this._filteredItems?Xg.Incr:Xg.All,this._lineContext=e)}get items(){return this._ensureCachedState(),this._filteredItems}getItemsByProvider(){return this._ensureCachedState(),this._itemsByProvider}getIncompleteProvider(){this._ensureCachedState();const e=new Set;for(const[t,i]of this.getItemsByProvider())i.length>0&&i[0].container.incomplete&&e.add(t);return e}get stats(){return this._ensureCachedState(),this._stats}_ensureCachedState(){this._refilterKind!==Xg.Nothing&&this._createCachedState()}_createCachedState(){this._itemsByProvider=new Map;const e=[],{leadingLineContent:t,characterCountDelta:i}=this._lineContext;let n="",o="";const r=this._refilterKind===Xg.All?this._items:this._filteredItems,a=[],c=!this._options.filterGraceful||r.length>2e3?Mz:Ave;for(let d=0;d<r.length;d++){const l=r[d];if(l.isInvalid)continue;const u=this._itemsByProvider.get(l.provider);u?u.push(l):this._itemsByProvider.set(l.provider,[l]);const g=l.position.column-l.editStart.column,m=g+i-(l.position.column-this._column);if(n.length!==m&&(n=m===0?"":t.slice(-m),o=n.toLowerCase()),l.word=n,m===0)l.score=CE.Default;else{let v=0;for(;v<g;){const _=n.charCodeAt(v);if(_===st.Space||_===st.Tab)v+=1;else break}if(v>=m)l.score=CE.Default;else if(typeof l.completion.filterText=="string"){const _=c(n,o,v,l.completion.filterText,l.filterTextLow,0,this._fuzzyScoreOptions);if(!_)continue;OS(l.completion.filterText,l.textLabel)===0?l.score=_:(l.score=Rve(n,o,v,l.textLabel,l.labelLow,0),l.score[0]=_[0])}else{const _=c(n,o,v,l.textLabel,l.labelLow,0,this._fuzzyScoreOptions);if(!_)continue;l.score=_}}l.idx=d,l.distance=this._wordDistance.distance(l.position,l.completion),a.push(l),e.push(l.textLabel.length)}this._filteredItems=a.sort(this._snippetCompareFn),this._refilterKind=Xg.Nothing,this._stats={pLabelLen:e.length?Pve(e.length-.85,e,(d,l)=>d-l):0}}static _compareCompletionItems(e,t){return e.score[0]>t.score[0]?-1:e.score[0]<t.score[0]?1:e.distance<t.distance?-1:e.distance>t.distance?1:e.idx<t.idx?-1:e.idx>t.idx?1:0}static _compareCompletionItemsSnippetsDown(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===De.Snippet)return 1;if(t.completion.kind===De.Snippet)return-1}return ip._compareCompletionItems(e,t)}static _compareCompletionItemsSnippetsUp(e,t){if(e.completion.kind!==t.completion.kind){if(e.completion.kind===De.Snippet)return-1;if(t.completion.kind===De.Snippet)return 1}return ip._compareCompletionItems(e,t)}}class Ai{static{this.inlineSuggestionVisible=new O("inlineSuggestionVisible",!1,h(1252,"Whether an inline suggestion is visible"))}static{this.inlineSuggestionHasIndentation=new O("inlineSuggestionHasIndentation",!1,h(1253,"Whether the inline suggestion starts with whitespace"))}static{this.inlineSuggestionHasIndentationLessThanTabSize=new O("inlineSuggestionHasIndentationLessThanTabSize",!0,h(1254,"Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab"))}static{this.suppressSuggestions=new O("inlineSuggestionSuppressSuggestions",void 0,h(1255,"Whether suggestions should be suppressed for the current suggestion"))}static{this.cursorInIndentation=new O("cursorInIndentation",!1,h(1256,"Whether the cursor is in indentation"))}static{this.hasSelection=new O("editor.hasSelection",!1,h(1257,"Whether the editor has a selection"))}static{this.cursorAtInlineEdit=new O("cursorAtInlineEdit",!1,h(1258,"Whether the cursor is at an inline edit"))}static{this.inlineEditVisible=new O("inlineEditIsVisible",!1,h(1259,"Whether an inline edit is visible"))}static{this.tabShouldJumpToInlineEdit=new O("tabShouldJumpToInlineEdit",!1,h(1260,"Whether tab should jump to an inline edit."))}static{this.tabShouldAcceptInlineEdit=new O("tabShouldAcceptInlineEdit",!1,h(1261,"Whether tab should accept the inline edit."))}static{this.inInlineEditsPreviewEditor=new O("inInlineEditsPreviewEditor",!0,h(1262,"Whether the current code editor is showing an inline edits preview"))}}var wH;class Bf{static shouldAutoTrigger(e){if(!e.hasModel())return!1;const t=e.getModel(),i=e.getPosition();t.tokenization.tokenizeIfCheap(i.lineNumber);const n=t.getWordAtPosition(i);return!(!n||n.endColumn!==i.column&&n.startColumn+1!==i.column||!isNaN(Number(n.word)))}constructor(e,t,i){this.leadingLineContent=e.getLineContent(t.lineNumber).substr(0,t.column-1),this.leadingWord=e.getWordUntilPosition(t),this.lineNumber=t.lineNumber,this.column=t.column,this.triggerOptions=i}}var wp;(function(s){s[s.Idle=0]="Idle",s[s.Manual=1]="Manual",s[s.Auto=2]="Auto"})(wp||(wp={}));function nLe(s,e,t){if(!e.getContextKeyValue(Ai.inlineSuggestionVisible.key))return!0;const i=e.getContextKeyValue(Ai.suppressSuggestions.key);return i!==void 0?!i:!s.getOption(L.inlineSuggest).suppressSuggestions}function sLe(s,e,t){if(!e.getContextKeyValue("inlineSuggestionVisible"))return!0;const i=e.getContextKeyValue(Ai.suppressSuggestions.key);return i!==void 0?!i:!s.getOption(L.inlineSuggest).suppressSuggestions}let sP=wH=class{constructor(e,t,i,n,o,r,a,c,d){this._editor=e,this._editorWorkerService=t,this._clipboardService=i,this._telemetryService=n,this._logService=o,this._contextKeyService=r,this._configurationService=a,this._languageFeaturesService=c,this._envService=d,this._toDispose=new U,this._triggerCharacterListener=new U,this._triggerQuickSuggest=new sI,this._triggerState=void 0,this._completionDisposables=new U,this._onDidCancel=new M,this._onDidTrigger=new M,this._onDidSuggest=new M,this.onDidCancel=this._onDidCancel.event,this.onDidTrigger=this._onDidTrigger.event,this.onDidSuggest=this._onDidSuggest.event,this._currentSelection=this._editor.getSelection()||new at(1,1,1,1),this._toDispose.add(this._editor.onDidChangeModel(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeModelLanguage(()=>{this._updateTriggerCharacters(),this.cancel()})),this._toDispose.add(this._editor.onDidChangeConfiguration(()=>{this._updateTriggerCharacters()})),this._toDispose.add(this._languageFeaturesService.completionProvider.onDidChange(()=>{this._updateTriggerCharacters(),this._updateActiveSuggestSession()}));let l=!1;this._toDispose.add(this._editor.onDidCompositionStart(()=>{l=!0})),this._toDispose.add(this._editor.onDidCompositionEnd(()=>{l=!1,this._onCompositionEnd()})),this._toDispose.add(this._editor.onDidChangeCursorSelection(u=>{l||this._onCursorChange(u)})),this._toDispose.add(this._editor.onDidChangeModelContent(()=>{!l&&this._triggerState!==void 0&&this._refilterCompletionItems()})),this._updateTriggerCharacters()}dispose(){Xe(this._triggerCharacterListener),Xe([this._onDidCancel,this._onDidSuggest,this._onDidTrigger,this._triggerQuickSuggest]),this._toDispose.dispose(),this._completionDisposables.dispose(),this.cancel()}_updateTriggerCharacters(){if(this._triggerCharacterListener.clear(),this._editor.getOption(L.readOnly)||!this._editor.hasModel()||!this._editor.getOption(L.suggestOnTriggerCharacters))return;const e=new Map;for(const i of this._languageFeaturesService.completionProvider.all(this._editor.getModel()))for(const n of i.triggerCharacters||[]){let o=e.get(n);if(!o){o=new Set;const r=YPe();r&&o.add(r),e.set(n,o)}o.add(i)}const t=i=>{if(!sLe(this._editor,this._contextKeyService)||Bf.shouldAutoTrigger(this._editor))return;if(!i){const r=this._editor.getPosition();i=this._editor.getModel().getLineContent(r.lineNumber).substr(0,r.column-1)}let n="";Lve(i.charCodeAt(i.length-1))?Mve(i.charCodeAt(i.length-2))&&(n=i.substr(i.length-2)):n=i.charAt(i.length-1);const o=e.get(n);if(o){const r=new Map;if(this._completionModel)for(const[a,c]of this._completionModel.getItemsByProvider())o.has(a)||r.set(a,c);this.trigger({auto:!0,triggerKind:ba.TriggerCharacter,triggerCharacter:n,retrigger:!!this._completionModel,clipboardText:this._completionModel?.clipboardText,completionOptions:{providerFilter:o,providerItemsToReuse:r}})}};this._triggerCharacterListener.add(this._editor.onDidType(t)),this._triggerCharacterListener.add(this._editor.onDidCompositionEnd(()=>t()))}get state(){return this._triggerState?this._triggerState.auto?wp.Auto:wp.Manual:wp.Idle}cancel(e=!1){this._triggerState!==void 0&&(this._triggerQuickSuggest.cancel(),this._requestToken?.cancel(),this._requestToken=void 0,this._triggerState=void 0,this._completionModel=void 0,this._context=void 0,this._onDidCancel.fire({retrigger:e}))}clear(){this._completionDisposables.clear()}_updateActiveSuggestSession(){this._triggerState!==void 0&&(!this._editor.hasModel()||!this._languageFeaturesService.completionProvider.has(this._editor.getModel())?this.cancel():this.trigger({auto:this._triggerState.auto,retrigger:!0}))}_onCursorChange(e){if(!this._editor.hasModel())return;const t=this._currentSelection;if(this._currentSelection=this._editor.getSelection(),!e.selection.isEmpty()||e.reason!==Ws.NotSet&&e.reason!==Ws.Explicit||e.source!=="keyboard"&&e.source!=="deleteLeft"){this.cancel();return}this._triggerState===void 0&&e.reason===Ws.NotSet?(t.containsRange(this._currentSelection)||t.getEndPosition().isBeforeOrEqual(this._currentSelection.getPosition()))&&this._doTriggerQuickSuggest():this._triggerState!==void 0&&e.reason===Ws.Explicit&&this._refilterCompletionItems()}_onCompositionEnd(){this._triggerState===void 0?this._doTriggerQuickSuggest():this._refilterCompletionItems()}_doTriggerQuickSuggest(){gb.isAllOff(this._editor.getOption(L.quickSuggestions))||this._editor.getOption(L.suggest).snippetsPreventQuickSuggestions&&cs.get(this._editor)?.isInSnippet()||(this.cancel(),this._triggerQuickSuggest.cancelAndSet(()=>{if(this._triggerState!==void 0||!Bf.shouldAutoTrigger(this._editor)||!this._editor.hasModel()||!this._editor.hasWidgetFocus())return;const e=this._editor.getModel(),t=this._editor.getPosition(),i=this._editor.getOption(L.quickSuggestions);if(!gb.isAllOff(i)){if(!gb.isAllOn(i)){e.tokenization.tokenizeIfCheap(t.lineNumber);const n=e.tokenization.getLineTokens(t.lineNumber),o=n.getStandardTokenType(n.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(gb.valueFor(i,o)!=="on")return}nLe(this._editor,this._contextKeyService)&&this._languageFeaturesService.completionProvider.has(e)&&this.trigger({auto:!0})}},this._editor.getOption(L.quickSuggestionsDelay)))}_refilterCompletionItems(){yt(this._editor.hasModel()),yt(this._triggerState!==void 0);const e=this._editor.getModel(),t=this._editor.getPosition(),i=new Bf(e,t,{...this._triggerState,refilter:!0});this._onNewContext(i)}trigger(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),i=new Bf(t,this._editor.getPosition(),e);this.cancel(e.retrigger),this._triggerState=e,this._onDidTrigger.fire({auto:e.auto,shy:e.shy??!1,position:this._editor.getPosition()}),this._context=i;let n={triggerKind:e.triggerKind??ba.Invoke};e.triggerCharacter&&(n={triggerKind:ba.TriggerCharacter,triggerCharacter:e.triggerCharacter}),this._requestToken=new li;const o=this._editor.getOption(L.snippetSuggestions);let r=Pu.Inline;switch(o){case"top":r=Pu.Top;break;case"bottom":r=Pu.Bottom;break}const{itemKind:a,showDeprecated:c}=wH.createSuggestFilter(this._editor),d=new iD(r,e.completionOptions?.kindFilter??a,e.completionOptions?.providerFilter,e.completionOptions?.providerItemsToReuse,c),l=ql.create(this._editorWorkerService,this._editor),u=e4(this._languageFeaturesService.completionProvider,t,this._editor.getPosition(),d,n,this._requestToken.token);Promise.all([u,l]).then(async([g,m])=>{if(this._requestToken?.dispose(),!this._editor.hasModel()){g.disposable.dispose();return}let v=e?.clipboardText;if(!v&&g.needsClipboard&&(v=await this._clipboardService.readText()),this._triggerState===void 0){g.disposable.dispose();return}const _=this._editor.getModel(),w=new Bf(_,this._editor.getPosition(),e),C={...bne.default,firstMatchCanBeWeak:!this._editor.getOption(L.suggest).matchOnWordStartOnly};if(this._completionModel=new ip(g.items,this._context.column,{leadingLineContent:w.leadingLineContent,characterCountDelta:w.column-this._context.column},m,this._editor.getOption(L.suggest),this._editor.getOption(L.snippetSuggestions),C,v),this._completionDisposables.add(g.disposable),this._onNewContext(w),this._reportDurationsTelemetry(g.durations),!this._envService.isBuilt||this._envService.isExtensionDevelopment)for(const k of g.items)k.isInvalid&&this._logService.warn(`[suggest] did IGNORE invalid completion item from ${k.provider._debugDisplayName}`,k.completion)}).catch(mt)}_reportDurationsTelemetry(e){Math.random()>1e-4||setTimeout(()=>{this._telemetryService.publicLog2("suggest.durations.json",{data:JSON.stringify(e)}),this._logService.debug("suggest.durations.json",e)})}static createSuggestFilter(e){const t=new Set;e.getOption(L.snippetSuggestions)==="none"&&t.add(De.Snippet);const n=e.getOption(L.suggest);return n.showMethods||t.add(De.Method),n.showFunctions||t.add(De.Function),n.showConstructors||t.add(De.Constructor),n.showFields||t.add(De.Field),n.showVariables||t.add(De.Variable),n.showClasses||t.add(De.Class),n.showStructs||t.add(De.Struct),n.showInterfaces||t.add(De.Interface),n.showModules||t.add(De.Module),n.showProperties||t.add(De.Property),n.showEvents||t.add(De.Event),n.showOperators||t.add(De.Operator),n.showUnits||t.add(De.Unit),n.showValues||t.add(De.Value),n.showConstants||t.add(De.Constant),n.showEnums||t.add(De.Enum),n.showEnumMembers||t.add(De.EnumMember),n.showKeywords||t.add(De.Keyword),n.showWords||t.add(De.Text),n.showColors||t.add(De.Color),n.showFiles||t.add(De.File),n.showReferences||t.add(De.Reference),n.showColors||t.add(De.Customcolor),n.showFolders||t.add(De.Folder),n.showTypeParameters||t.add(De.TypeParameter),n.showSnippets||t.add(De.Snippet),n.showUsers||t.add(De.User),n.showIssues||t.add(De.Issue),{itemKind:t,showDeprecated:n.showDeprecated}}_onNewContext(e){if(this._context){if(e.lineNumber!==this._context.lineNumber){this.cancel();return}if(lo(e.leadingLineContent)!==lo(this._context.leadingLineContent)){this.cancel();return}if(e.column<this._context.column){e.leadingWord.word?this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0}):this.cancel();return}if(this._completionModel){if(e.leadingWord.word.length!==0&&e.leadingWord.startColumn>this._context.leadingWord.startColumn){if(Bf.shouldAutoTrigger(this._editor)&&this._context){const i=this._completionModel.getItemsByProvider();this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerItemsToReuse:i}})}return}if(e.column>this._context.column&&this._completionModel.getIncompleteProvider().size>0&&e.leadingWord.word.length!==0){const t=new Map,i=new Set;for(const[n,o]of this._completionModel.getItemsByProvider())o.length>0&&o[0].container.incomplete?i.add(n):t.set(n,o);this.trigger({auto:this._context.triggerOptions.auto,triggerKind:ba.TriggerForIncompleteCompletions,retrigger:!0,clipboardText:this._completionModel.clipboardText,completionOptions:{providerFilter:i,providerItemsToReuse:t}})}else{const t=this._completionModel.lineContext;let i=!1;if(this._completionModel.lineContext={leadingLineContent:e.leadingLineContent,characterCountDelta:e.column-this._context.column},this._completionModel.items.length===0){const n=Bf.shouldAutoTrigger(this._editor);if(!this._context){this.cancel();return}if(n&&this._context.leadingWord.endColumn<e.leadingWord.startColumn){this.trigger({auto:this._context.triggerOptions.auto,retrigger:!0});return}if(this._context.triggerOptions.auto){this.cancel();return}else if(this._completionModel.lineContext=t,i=this._completionModel.items.length>0,i&&e.leadingWord.word.length===0){this.cancel();return}}this._onDidSuggest.fire({completionModel:this._completionModel,triggerOptions:e.triggerOptions,isFrozen:i})}}}}};sP=wH=f([p(1,vc),p(2,Vs),p(3,ai),p(4,Re),p(5,fe),p(6,ne),p(7,Ne),p(8,Hs)],sP);class oLe{constructor(e,t,i,n){this._disposables=new U,this._disposables.add(i.onDidSuggest(o=>{o.completionModel.items.length===0&&this.reset()})),this._disposables.add(i.onDidCancel(o=>{this.reset()})),this._disposables.add(t.onDidShow(()=>this._onItem(t.getFocusedItem()))),this._disposables.add(t.onDidFocus(this._onItem,this)),this._disposables.add(t.onDidHide(this.reset,this)),this._disposables.add(e.onWillType(o=>{if(this._active&&!t.isFrozen()&&i.state!==wp.Idle){const r=o.charCodeAt(o.length-1);this._active.acceptCharacters.has(r)&&e.getOption(L.acceptSuggestionOnCommitCharacter)&&n(this._active.item)}}))}_onItem(e){if(!e||!An(e.item.completion.commitCharacters)){this.reset();return}if(this._active&&this._active.item.item===e.item)return;const t=new jT;for(const i of e.item.completion.commitCharacters)i.length>0&&t.add(i.charCodeAt(0));this._active={acceptCharacters:t,item:e}}reset(){this._active=void 0}dispose(){this._disposables.dispose()}}class i4{static{this._maxSelectionLength=51200}constructor(e,t){this._disposables=new U,this._lastOvertyped=[],this._locked=!1,this._disposables.add(e.onWillType(()=>{if(this._locked||!e.hasModel())return;const i=e.getSelections(),n=i.length;let o=!1;for(let a=0;a<n;a++)if(!i[a].isEmpty()){o=!0;break}if(!o){this._lastOvertyped.length!==0&&(this._lastOvertyped.length=0);return}this._lastOvertyped=[];const r=e.getModel();for(let a=0;a<n;a++){const c=i[a];if(r.getValueLengthInRange(c)>i4._maxSelectionLength)return;this._lastOvertyped[a]={value:r.getValueInRange(c),multiline:c.startLineNumber!==c.endLineNumber}}})),this._disposables.add(t.onDidTrigger(i=>{this._locked=!0})),this._disposables.add(t.onDidCancel(i=>{this._locked=!1}))}getLastOvertypedInfo(e){if(e>=0&&e<this._lastOvertyped.length)return this._lastOvertyped[e]}dispose(){this._disposables.dispose()}}const rLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),aLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(rLe);Ve(aLe);const cLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let SH=class{constructor(e,t,i,n,o){this._menuId=t,this._menuService=n,this._contextKeyService=o,this._menuDisposables=new U,this.element=ee(e,j(".suggest-status-bar"));const r=a=>a instanceof wr?i.createInstance(Nve,a,{useComma:!0}):void 0;this._leftActions=new Ar(this.element,{actionViewItemProvider:r}),this._rightActions=new Ar(this.element,{actionViewItemProvider:r}),this._leftActions.domNode.classList.add("left"),this._rightActions.domNode.classList.add("right")}dispose(){this._menuDisposables.dispose(),this._leftActions.dispose(),this._rightActions.dispose(),this.element.remove()}show(){const e=this._menuService.createMenu(this._menuId,this._contextKeyService),t=()=>{const i=[],n=[];for(const[o,r]of e.getActions())o==="left"?i.push(...r):n.push(...r);this._leftActions.clear(),this._leftActions.push(i),this._rightActions.clear(),this._rightActions.push(n)};this._menuDisposables.add(e.onDidChange(()=>t())),this._menuDisposables.add(e)}hide(){this._menuDisposables.clear()}};SH=f([p(2,Z),p(3,fn),p(4,fe)],SH);const dLe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(dLe);H("symbolIcon.arrayForeground",Zn,h(1539,"The foreground color for array symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.booleanForeground",Zn,h(1540,"The foreground color for boolean symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.classForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},h(1541,"The foreground color for class symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.colorForeground",Zn,h(1542,"The foreground color for color symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.constantForeground",Zn,h(1543,"The foreground color for constant symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.constructorForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},h(1544,"The foreground color for constructor symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.enumeratorForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},h(1545,"The foreground color for enumerator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.enumeratorMemberForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1546,"The foreground color for enumerator member symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.eventForeground",{dark:"#EE9D28",light:"#D67E00",hcDark:"#EE9D28",hcLight:"#D67E00"},h(1547,"The foreground color for event symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.fieldForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1548,"The foreground color for field symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.fileForeground",Zn,h(1549,"The foreground color for file symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.folderForeground",Zn,h(1550,"The foreground color for folder symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.functionForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},h(1551,"The foreground color for function symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.interfaceForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1552,"The foreground color for interface symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.keyForeground",Zn,h(1553,"The foreground color for key symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.keywordForeground",Zn,h(1554,"The foreground color for keyword symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.methodForeground",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},h(1555,"The foreground color for method symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.moduleForeground",Zn,h(1556,"The foreground color for module symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.namespaceForeground",Zn,h(1557,"The foreground color for namespace symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.nullForeground",Zn,h(1558,"The foreground color for null symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.numberForeground",Zn,h(1559,"The foreground color for number symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.objectForeground",Zn,h(1560,"The foreground color for object symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.operatorForeground",Zn,h(1561,"The foreground color for operator symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.packageForeground",Zn,h(1562,"The foreground color for package symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.propertyForeground",Zn,h(1563,"The foreground color for property symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.referenceForeground",Zn,h(1564,"The foreground color for reference symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.snippetForeground",Zn,h(1565,"The foreground color for snippet symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.stringForeground",Zn,h(1566,"The foreground color for string symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.structForeground",Zn,h(1567,"The foreground color for struct symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.textForeground",Zn,h(1568,"The foreground color for text symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.typeParameterForeground",Zn,h(1569,"The foreground color for type parameter symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.unitForeground",Zn,h(1570,"The foreground color for unit symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));H("symbolIcon.variableForeground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},h(1571,"The foreground color for variable symbols. These symbols appear in the outline, breadcrumb, and suggest widget."));function n4(s){return!!s&&!!(s.completion.documentation||s.completion.detail&&s.completion.detail!==s.completion.label)}let CH=class{constructor(e,t){this._editor=e,this._onDidClose=new M,this.onDidClose=this._onDidClose.event,this._onDidChangeContents=new M,this.onDidChangeContents=this._onDidChangeContents.event,this._disposables=new U,this._renderDisposeable=new U,this._borderWidth=1,this._size=new Ye(330,0),this.domNode=j(".suggest-details"),this.domNode.classList.add("no-docs"),this._markdownRenderer=t.createInstance(Ov,{editor:e}),this._body=j(".body"),this._scrollbar=new oI(this._body,{alwaysConsumeMouseWheel:!0}),ee(this.domNode,this._scrollbar.getDomNode()),this._disposables.add(this._scrollbar),this._header=ee(this._body,j(".header")),this._close=ee(this._header,j("span"+ke.asCSSSelector(K.close))),this._close.title=h(1534,"Close"),this._close.role="button",this._close.tabIndex=-1,this._type=ee(this._header,j("p.type")),this._docs=ee(this._body,j("p.docs")),this._configureFont(),this._disposables.add(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(L.fontInfo)&&this._configureFont()}))}dispose(){this._disposables.dispose(),this._renderDisposeable.dispose()}_configureFont(){const e=this._editor.getOptions(),t=e.get(L.fontInfo),i=t.getMassagedFontFamily(),n=e.get(L.suggestFontSize)||t.fontSize,o=e.get(L.suggestLineHeight)||t.lineHeight,r=t.fontWeight,a=`${n}px`,c=`${o}px`;this.domNode.style.fontSize=a,this.domNode.style.lineHeight=`${o/n}`,this.domNode.style.fontWeight=r,this.domNode.style.fontFeatureSettings=t.fontFeatureSettings,this._type.style.fontFamily=i,this._close.style.height=c,this._close.style.width=c}getLayoutInfo(){const e=this._editor.getOption(L.suggestLineHeight)||this._editor.getOption(L.fontInfo).lineHeight,t=this._borderWidth,i=t*2;return{lineHeight:e,borderWidth:t,borderHeight:i,verticalPadding:22,horizontalPadding:14}}renderLoading(){this._type.textContent=h(1535,"Loading..."),this._docs.textContent="",this.domNode.classList.remove("no-docs","no-type"),this.layout(this.size.width,this.getLayoutInfo().lineHeight*2),this._onDidChangeContents.fire(this)}renderItem(e,t){this._renderDisposeable.clear();let{detail:i,documentation:n}=e.completion;if(t){let o="";o+=`score: ${e.score[0]}
`,o+=`prefix: ${e.word??"(no prefix)"}
`,o+=`word: ${e.completion.filterText?e.completion.filterText+" (filterText)":e.textLabel}
`,o+=`distance: ${e.distance} (localityBonus-setting)
`,o+=`index: ${e.idx}, based on ${e.completion.sortText&&`sortText: "${e.completion.sortText}"`||"label"}
`,o+=`commit_chars: ${e.completion.commitCharacters?.join("")}
`,n=new Gi().appendCodeblock("empty",o),i=`Provider: ${e.provider._debugDisplayName}`}if(!t&&!n4(e)){this.clearContents();return}if(this.domNode.classList.remove("no-docs","no-type"),i){const o=i.length>1e5?`${i.substr(0,1e5)}`:i;this._type.textContent=o,this._type.title=o,Qo(this._type),this._type.classList.toggle("auto-wrap",!/\r?\n^\s+/gmi.test(o))}else Xi(this._type),this._type.title="",Qs(this._type),this.domNode.classList.add("no-type");if(Xi(this._docs),typeof n=="string")this._docs.classList.remove("markdown-docs"),this._docs.textContent=n;else if(n){this._docs.classList.add("markdown-docs"),Xi(this._docs);const o=this._markdownRenderer.render(n,{asyncRenderCallback:()=>{this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}});this._docs.appendChild(o.element),this._renderDisposeable.add(o)}this.domNode.classList.toggle("detail-and-doc",!!i&&!!n),this.domNode.style.userSelect="text",this.domNode.tabIndex=-1,this._close.onmousedown=o=>{o.preventDefault(),o.stopPropagation()},this._close.onclick=o=>{o.preventDefault(),o.stopPropagation(),this._onDidClose.fire()},this._body.scrollTop=0,this.layout(this._size.width,this._type.clientHeight+this._docs.clientHeight),this._onDidChangeContents.fire(this)}clearContents(){this.domNode.classList.add("no-docs"),this._type.textContent="",this._docs.textContent=""}get isEmpty(){return this.domNode.classList.contains("no-docs")}get size(){return this._size}layout(e,t){const i=new Ye(e,t);Ye.equals(i,this._size)||(this._size=i,Nz(this.domNode,e,t)),this._scrollbar.scanDomNode()}scrollDown(e=8){this._body.scrollTop+=e}scrollUp(e=8){this._body.scrollTop-=e}scrollTop(){this._body.scrollTop=0}scrollBottom(){this._body.scrollTop=this._body.scrollHeight}pageDown(){this.scrollDown(80)}pageUp(){this.scrollUp(80)}set borderWidth(e){this._borderWidth=e}get borderWidth(){return this._borderWidth}focus(){this.domNode.focus()}};CH=f([p(1,Z)],CH);class lLe{constructor(e,t){this.widget=e,this._editor=t,this.allowEditorOverflow=!0,this._disposables=new U,this._added=!1,this._preferAlignAtTop=!0,this._resizable=new YK,this._resizable.domNode.classList.add("suggest-details-container"),this._resizable.domNode.appendChild(e.domNode),this._resizable.enableSashes(!1,!0,!0,!1);let i,n,o=0,r=0;this._disposables.add(this._resizable.onDidWillResize(()=>{i=this._topLeft,n=this._resizable.size})),this._disposables.add(this._resizable.onDidResize(a=>{if(i&&n){this.widget.layout(a.dimension.width,a.dimension.height);let c=!1;a.west&&(r=n.width-a.dimension.width,c=!0),a.north&&(o=n.height-a.dimension.height,c=!0),c&&this._applyTopLeft({top:i.top+o,left:i.left+r})}a.done&&(i=void 0,n=void 0,o=0,r=0,this._userSize=a.dimension)})),this._disposables.add(this.widget.onDidChangeContents(()=>{this._anchorBox&&this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,this._preferAlignAtTop)}))}dispose(){this._resizable.dispose(),this._disposables.dispose(),this.hide()}getId(){return"suggest.details"}getDomNode(){return this._resizable.domNode}getPosition(){return this._topLeft?{preference:this._topLeft}:null}show(){this._added||(this._editor.addOverlayWidget(this),this._added=!0)}hide(e=!1){this._resizable.clearSashHoverState(),this._added&&(this._editor.removeOverlayWidget(this),this._added=!1,this._anchorBox=void 0,this._topLeft=void 0),e&&(this._userSize=void 0,this.widget.clearContents())}placeAtAnchor(e,t){const i=e.getBoundingClientRect();this._anchorBox=i,this._preferAlignAtTop=t,this._placeAtAnchor(this._anchorBox,this._userSize??this.widget.size,t)}_placeAtAnchor(e,t,i){const n=qu(this.getDomNode().ownerDocument.body),o=this.widget.getLayoutInfo(),r=new Ye(220,2*o.lineHeight),a=e.top,c=function(){const B=n.width-(e.left+e.width+o.borderWidth+o.horizontalPadding),q=-o.borderWidth+e.left+e.width,Q=new Ye(B,n.height-e.top-o.borderHeight-o.verticalPadding),ie=Q.with(void 0,e.top+e.height-o.borderHeight-o.verticalPadding);return{top:a,left:q,fit:B-t.width,maxSizeTop:Q,maxSizeBottom:ie,minSize:r.with(Math.min(B,r.width))}}(),d=function(){const B=e.left-o.borderWidth-o.horizontalPadding,q=Math.max(o.horizontalPadding,e.left-t.width-o.borderWidth),Q=new Ye(B,n.height-e.top-o.borderHeight-o.verticalPadding),ie=Q.with(void 0,e.top+e.height-o.borderHeight-o.verticalPadding);return{top:a,left:q,fit:B-t.width,maxSizeTop:Q,maxSizeBottom:ie,minSize:r.with(Math.min(B,r.width))}}(),l=function(){const B=e.left,q=-o.borderWidth+e.top+e.height,Q=new Ye(e.width-o.borderHeight,n.height-e.top-e.height-o.verticalPadding);return{top:q,left:B,fit:Q.height-t.height,maxSizeBottom:Q,maxSizeTop:Q,minSize:r.with(Q.width)}}(),u=[c,d,l],g=u.find(B=>B.fit>=0)??u.sort((B,q)=>q.fit-B.fit)[0],m=e.top+e.height-o.borderHeight;let v,_=t.height;const w=Math.max(g.maxSizeTop.height,g.maxSizeBottom.height);_>w&&(_=w);let C;i?_<=g.maxSizeTop.height?(v=!0,C=g.maxSizeTop):(v=!1,C=g.maxSizeBottom):_<=g.maxSizeBottom.height?(v=!1,C=g.maxSizeBottom):(v=!0,C=g.maxSizeTop);let{top:k,left:D}=g;!v&&_>e.height&&(k=m-_);const A=this._editor.getDomNode();if(A){const B=A.getBoundingClientRect();k-=B.top,D-=B.left}this._applyTopLeft({left:D,top:k}),this._resizable.enableSashes(!v,g===c,v,g!==c),this._resizable.minSize=g.minSize,this._resizable.maxSize=C,this._resizable.layout(_,Math.min(C.width,t.width)),this.widget.layout(this._resizable.size.width,this._resizable.size.height)}_applyTopLeft(e){this._topLeft=e,this._editor.layoutOverlayWidget(this)}}const hLe=/(?:\/|^)(?:([^\/]+)\/)?([^\/]+)$/;function ch(s,e,t,i,n){if(ke.isThemeIcon(n))return[`codicon-${n.id}`,"predefined-file-icon"];if(R.isUri(n))return[];const o=i===Pi.ROOT_FOLDER?["rootfolder-icon"]:i===Pi.FOLDER?["folder-icon"]:["file-icon"];if(t){let r;if(t.scheme===ae.data)r=YT.parseMetaData(t).get(YT.META_DATA_LABEL);else{const a=t.path.match(hLe);a?(r=XS(a[2].toLowerCase()),a[1]&&o.push(`${XS(a[1].toLowerCase())}-name-dir-icon`)):r=XS(t.authority.toLowerCase())}if(i===Pi.ROOT_FOLDER)o.push(`${r}-root-name-folder-icon`);else if(i===Pi.FOLDER)o.push(`${r}-name-folder-icon`);else{if(r){if(o.push(`${r}-name-file-icon`),o.push("name-file-icon"),r.length<=255){const c=r.split(".");for(let d=1;d<c.length;d++)o.push(`${c.slice(d).join(".")}-ext-file-icon`)}o.push("ext-file-icon")}const a=uLe(s,e,t);a&&o.push(`${XS(a)}-lang-file-icon`)}}return o}function P9e(s){return["file-icon",`${XS(s)}-lang-file-icon`]}function uLe(s,e,t){if(!t)return null;let i=null;if(t.scheme===ae.data){const o=YT.parseMetaData(t).get(YT.META_DATA_MIME);o&&(i=e.getLanguageIdByMimeType(o))}else{const n=s.getModel(t);n&&(i=n.getLanguageId())}return i&&i!==WM?i:e.guessLanguageIdByFilepathOrFirstLine(t)}function XS(s){return s.replace(/[\s]/g,"/")}const gLe=Pe("suggest-more-info",K.chevronRight,h(1536,"Icon for more information in the suggest widget.")),pLe=new class ZS{static{this._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/}static{this._regexStrict=new RegExp(`^${ZS._regexRelaxed.source}$`,"i")}extract(e,t){if(e.textLabel.match(ZS._regexStrict))return t[0]=e.textLabel,!0;if(e.completion.detail&&e.completion.detail.match(ZS._regexStrict))return t[0]=e.completion.detail,!0;if(e.completion.documentation){const i=typeof e.completion.documentation=="string"?e.completion.documentation:e.completion.documentation.value,n=ZS._regexRelaxed.exec(i);if(n&&(n.index===0||n.index+n[0].length===i.length))return t[0]=n[0],!0}return!1}};let EH=class{constructor(e,t,i,n){this._editor=e,this._modelService=t,this._languageService=i,this._themeService=n,this._onDidToggleDetails=new M,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){const t=new U,i=e;i.classList.add("show-file-icons");const n=ee(e,j(".icon")),o=ee(n,j("span.colorspan")),r=ee(e,j(".contents")),a=ee(r,j(".main")),c=ee(a,j(".icon-label.codicon")),d=ee(a,j("span.left")),l=ee(a,j("span.right")),u=new Sz(d,{supportHighlights:!0,supportIcons:!0});t.add(u);const g=ee(d,j("span.signature-label")),m=ee(d,j("span.qualifier-label")),v=ee(l,j("span.details-label")),_=ee(l,j("span.readMore"+ke.asCSSSelector(gLe)));return _.title=h(1537,"Read More"),{root:i,left:d,right:l,icon:n,colorspan:o,iconLabel:u,iconContainer:c,parametersLabel:g,qualifierLabel:m,detailsLabel:v,readMore:_,disposables:t,configureFont:()=>{const C=this._editor.getOptions(),k=C.get(L.fontInfo),D=k.getMassagedFontFamily(),A=k.fontFeatureSettings,B=C.get(L.suggestFontSize)||k.fontSize,q=C.get(L.suggestLineHeight)||k.lineHeight,Q=k.fontWeight,ie=k.letterSpacing,oe=`${B}px`,be=`${q}px`,me=`${ie}px`;i.style.fontSize=oe,i.style.fontWeight=Q,i.style.letterSpacing=me,a.style.fontFamily=D,a.style.fontFeatureSettings=A,a.style.lineHeight=be,n.style.height=be,n.style.width=be,_.style.height=be,_.style.width=be}}}renderElement(e,t,i){i.configureFont();const{completion:n}=e;i.colorspan.style.backgroundColor="";const o={labelEscapeNewLines:!0,matches:vw(e.score)},r=[];if(n.kind===De.Color&&pLe.extract(e,r))i.icon.className="icon customcolor",i.iconContainer.className="icon hide",i.colorspan.style.backgroundColor=r[0];else if(n.kind===De.File&&this._themeService.getFileIconTheme().hasFileIcons){i.icon.className="icon hide",i.iconContainer.className="icon hide";const a=ch(this._modelService,this._languageService,R.from({scheme:"fake",path:e.textLabel}),Pi.FILE),c=ch(this._modelService,this._languageService,R.from({scheme:"fake",path:n.detail}),Pi.FILE);o.extraClasses=a.length>c.length?a:c}else n.kind===De.Folder&&this._themeService.getFileIconTheme().hasFolderIcons?(i.icon.className="icon hide",i.iconContainer.className="icon hide",o.extraClasses=[ch(this._modelService,this._languageService,R.from({scheme:"fake",path:e.textLabel}),Pi.FOLDER),ch(this._modelService,this._languageService,R.from({scheme:"fake",path:n.detail}),Pi.FOLDER)].flat()):(i.icon.className="icon hide",i.iconContainer.className="",i.iconContainer.classList.add("suggest-icon",...ke.asClassNameArray(MM.toIcon(n.kind))));n.tags&&n.tags.indexOf(VT.Deprecated)>=0&&(o.extraClasses=(o.extraClasses||[]).concat(["deprecated"]),o.matches=[]),i.iconLabel.setLabel(e.textLabel,void 0,o),typeof n.label=="string"?(i.parametersLabel.textContent="",i.detailsLabel.textContent=T1(n.detail||""),i.root.classList.add("string-label")):(i.parametersLabel.textContent=T1(n.label.detail||""),i.detailsLabel.textContent=T1(n.label.description||""),i.root.classList.remove("string-label")),this._editor.getOption(L.suggest).showInlineDetails?Qo(i.detailsLabel):Qs(i.detailsLabel),n4(e)?(i.right.classList.add("can-expand-details"),Qo(i.readMore),i.readMore.onmousedown=a=>{a.stopPropagation(),a.preventDefault()},i.readMore.onclick=a=>{a.stopPropagation(),a.preventDefault(),this._onDidToggleDetails.fire()}):(i.right.classList.remove("can-expand-details"),Qs(i.readMore),i.readMore.onmousedown=null,i.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};EH=f([p(1,ci),p(2,vi),p(3,pt)],EH);function T1(s){return s.replace(/\r\n|\r|\n/g,"")}var P_;Ve(cLe);H("editorSuggestWidget.background",LM,h(1517,"Background color of the suggest widget."));H("editorSuggestWidget.border",Ove,h(1518,"Border color of the suggest widget."));const fLe=H("editorSuggestWidget.foreground",po,h(1519,"Foreground color of the suggest widget."));H("editorSuggestWidget.selectedForeground",yne,h(1520,"Foreground color of the selected entry in the suggest widget."));H("editorSuggestWidget.selectedIconForeground",Fve,h(1521,"Icon foreground color of the selected entry in the suggest widget."));const mLe=H("editorSuggestWidget.selectedBackground",wne,h(1522,"Background color of the selected entry in the suggest widget."));H("editorSuggestWidget.highlightForeground",Sne,h(1523,"Color of the match highlights in the suggest widget."));H("editorSuggestWidget.focusHighlightForeground",Wve,h(1524,"Color of the match highlights in the suggest widget when an item is focused."));H("editorSuggestWidgetStatus.foreground",et(fLe,.5),h(1525,"Foreground color of the suggest widget status."));var xt;(function(s){s[s.Hidden=0]="Hidden",s[s.Loading=1]="Loading",s[s.Empty=2]="Empty",s[s.Open=3]="Open",s[s.Frozen=4]="Frozen",s[s.Details=5]="Details",s[s.onDetailsKeyDown=6]="onDetailsKeyDown"})(xt||(xt={}));class vLe{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof pd}`}restore(){const e=this._service.get(this._key,he.PROFILE)??"";try{const t=JSON.parse(e);if(Ye.is(t))return Ye.lift(t)}catch{}}store(e){this._service.store(this._key,JSON.stringify(e),he.PROFILE,gt.MACHINE)}reset(){this._service.remove(this._key,he.PROFILE)}}let xH=class{static{P_=this}static{this.LOADING_MESSAGE=h(1526,"Loading...")}static{this.NO_SUGGESTIONS_MESSAGE=h(1527,"No suggestions.")}constructor(e,t,i,n,o){this.editor=e,this._storageService=t,this._state=xt.Hidden,this._isAuto=!1,this._pendingLayout=new Pt,this._pendingShowDetails=new Pt,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new sI,this._disposables=new U,this._onDidSelect=new MF,this._onDidFocus=new MF,this._onDidHide=new M,this._onDidShow=new M,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new M,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new YK,this.element.domNode.classList.add("editor-widget","suggest-widget"),this._contentWidget=new _Le(this,e),this._persistedSize=new vLe(t,e);class r{constructor(m,v,_=!1,w=!1){this.persistedSize=m,this.currentSize=v,this.persistHeight=_,this.persistWidth=w}}let a;this._disposables.add(this.element.onDidWillResize(()=>{this._contentWidget.lockPreference(),a=new r(this._persistedSize.restore(),this.element.size)})),this._disposables.add(this.element.onDidResize(g=>{if(this._resize(g.dimension.width,g.dimension.height),a&&(a.persistHeight=a.persistHeight||!!g.north||!!g.south,a.persistWidth=a.persistWidth||!!g.east||!!g.west),!!g.done){if(a){const{itemHeight:m,defaultSize:v}=this.getLayoutInfo(),_=Math.round(m/2);let{width:w,height:C}=this.element.size;(!a.persistHeight||Math.abs(a.currentSize.height-C)<=_)&&(C=a.persistedSize?.height??v.height),(!a.persistWidth||Math.abs(a.currentSize.width-w)<=_)&&(w=a.persistedSize?.width??v.width),this._persistedSize.store(new Ye(w,C))}this._contentWidget.unlockPreference(),a=void 0}})),this._messageElement=ee(this.element.domNode,j(".message")),this._listElement=ee(this.element.domNode,j(".tree"));const c=this._disposables.add(o.createInstance(CH,this.editor));c.onDidClose(()=>this.toggleDetails(),this,this._disposables),this._details=new lLe(c,this.editor);const d=()=>this.element.domNode.classList.toggle("no-icons",!this.editor.getOption(L.suggest).showIcons);d();const l=o.createInstance(EH,this.editor);this._disposables.add(l),this._disposables.add(l.onDidToggleDetails(()=>this.toggleDetails())),this._list=new Rv("SuggestWidget",this._listElement,{getHeight:g=>this.getLayoutInfo().itemHeight,getTemplateId:g=>"suggestion"},[l],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>bn?"listitem":"option",getWidgetAriaLabel:()=>h(1528,"Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:g=>{let m=g.textLabel;const v=MM.toLabel(g.completion.kind);if(typeof g.completion.label!="string"){const{detail:k,description:D}=g.completion.label;k&&D?m=h(1529,"{0} {1}, {2}, {3}",m,k,D,v):k?m=h(1530,"{0} {1}, {2}",m,k,v):D&&(m=h(1531,"{0}, {1}, {2}",m,D,v))}else m=h(1532,"{0}, {1}",m,v);if(!g.isResolved||!this._isDetailsVisible())return m;const{documentation:_,detail:w}=g.completion,C=Oz("{0}{1}",w||"",_?typeof _=="string"?_:_.value:"");return h(1533,"{0}, docs: {1}",m,C)}}}),this._list.style(Cne({listInactiveFocusBackground:mLe,listInactiveFocusOutline:kr})),this._status=o.createInstance(SH,this.element.domNode,yp);const u=()=>this.element.domNode.classList.toggle("with-status-bar",this.editor.getOption(L.suggest).showStatusBar);u(),this._disposables.add(n.onDidColorThemeChange(g=>this._onThemeChange(g))),this._onThemeChange(n.getColorTheme()),this._disposables.add(this._list.onMouseDown(g=>this._onListMouseDownOrTap(g))),this._disposables.add(this._list.onTap(g=>this._onListMouseDownOrTap(g))),this._disposables.add(this._list.onDidChangeSelection(g=>this._onListSelection(g))),this._disposables.add(this._list.onDidChangeFocus(g=>this._onListFocus(g))),this._disposables.add(this.editor.onDidChangeCursorSelection(()=>this._onCursorSelectionChanged())),this._disposables.add(this.editor.onDidChangeConfiguration(g=>{g.hasChanged(L.suggest)&&(u(),d()),this._completionModel&&(g.hasChanged(L.fontInfo)||g.hasChanged(L.suggestFontSize)||g.hasChanged(L.suggestLineHeight))&&this._list.splice(0,this._list.length,this._completionModel.items)})),this._ctxSuggestWidgetVisible=ut.Visible.bindTo(i),this._ctxSuggestWidgetDetailsVisible=ut.DetailsVisible.bindTo(i),this._ctxSuggestWidgetMultipleSuggestions=ut.MultipleSuggestions.bindTo(i),this._ctxSuggestWidgetHasFocusedSuggestion=ut.HasFocusedSuggestion.bindTo(i),this._disposables.add(No(this._details.widget.domNode,"keydown",g=>{this._onDetailsKeydown.fire(g)})),this._disposables.add(this.editor.onMouseDown(g=>this._onEditorMouseDown(g)))}dispose(){this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),this._loadingTimeout?.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){this._state!==xt.Hidden&&this._contentWidget.layout()}_onListMouseDownOrTap(e){typeof e.element>"u"||typeof e.index>"u"||(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){const i=this._completionModel;i&&(this._onDidSelect.fire({item:e,index:t,model:i}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=ly(e.type)?2:1}_onListFocus(e){if(this._ignoreFocusEvents)return;if(this._state===xt.Details&&this._setState(xt.Open),!e.elements.length){this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);return}if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);const t=e.elements[0],i=e.indexes[0];t!==this._focusedItem&&(this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=t,this._list.reveal(i),this._currentSuggestionDetails=Tn(async n=>{const o=Lp(()=>{this._isDetailsVisible()&&this._showDetails(!0,!1)},250),r=n.onCancellationRequested(()=>o.dispose());try{return await t.resolve(n)}finally{o.dispose(),r.dispose()}}),this._currentSuggestionDetails.then(()=>{i>=this._list.length||t!==this._list.element(i)||(this._ignoreFocusEvents=!0,this._list.splice(i,1,[t]),this._list.setFocus([i]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this._showDetails(!1,!1):this.element.domNode.classList.remove("docs-side"),this.editor.setAriaOptions({activeDescendant:this._list.getElementID(i)}))}).catch(mt)),this._onDidFocus.fire({item:t,index:i,model:this._completionModel})}_setState(e){if(this._state!==e)switch(this._state=e,this.element.domNode.classList.toggle("frozen",e===xt.Frozen),this.element.domNode.classList.remove("message"),e){case xt.Hidden:Qs(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case xt.Loading:this.element.domNode.classList.add("message"),this._messageElement.textContent=P_.LOADING_MESSAGE,Qs(this._listElement,this._status.element),Qo(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,zc(P_.LOADING_MESSAGE);break;case xt.Empty:this.element.domNode.classList.add("message"),this._messageElement.textContent=P_.NO_SUGGESTIONS_MESSAGE,Qs(this._listElement,this._status.element),Qo(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0,zc(P_.NO_SUGGESTIONS_MESSAGE);break;case xt.Open:Qs(this._messageElement),Qo(this._listElement,this._status.element),this._show();break;case xt.Frozen:Qs(this._messageElement),Qo(this._listElement,this._status.element),this._show();break;case xt.Details:Qs(this._messageElement),Qo(this._listElement,this._status.element),this._details.show(),this._show(),this._details.widget.focus();break}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet(()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)},100)}showTriggered(e,t){this._state===xt.Hidden&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=Lp(()=>this._setState(xt.Loading),t)))}showSuggestions(e,t,i,n,o){if(this._contentWidget.setPosition(this.editor.getPosition()),this._loadingTimeout?.dispose(),this._currentSuggestionDetails?.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),i&&this._state!==xt.Empty&&this._state!==xt.Hidden){this._setState(xt.Frozen);return}const r=this._completionModel.items.length,a=r===0;if(this._ctxSuggestWidgetMultipleSuggestions.set(r>1),a){this._setState(n?xt.Hidden:xt.Empty),this._completionModel=void 0;return}this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(i?xt.Frozen:xt.Open),this._list.reveal(t,0,t===0?0:this.getLayoutInfo().itemHeight*.33),this._list.setFocus(o?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=G6(Et(this.element.domNode),()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove("focused")})}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case xt.Hidden:return!1;case xt.Details:return this._details.widget.pageDown(),!0;case xt.Loading:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case xt.Hidden:return!1;case xt.Loading:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case xt.Hidden:return!1;case xt.Details:return this._details.widget.scrollBottom(),!0;case xt.Loading:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case xt.Hidden:return!1;case xt.Details:return this._details.widget.pageUp(),!0;case xt.Loading:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case xt.Hidden:return!1;case xt.Loading:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case xt.Hidden:return!1;case xt.Details:return this._details.widget.scrollTop(),!0;case xt.Loading:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(this._state!==xt.Hidden&&this._state!==xt.Empty&&this._state!==xt.Loading&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){this._state===xt.Details?(this._list.setFocus(this._list.getFocus()),this._setState(xt.Open)):this._state===xt.Open&&(this._setState(xt.Details),this._isDetailsVisible()?this._details.widget.focus():this.toggleDetails(!0))}toggleDetails(e=!1){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove("shows-details")):(n4(this._list.getFocusedElements()[0])||this._explainMode)&&(this._state===xt.Open||this._state===xt.Details||this._state===xt.Frozen)&&(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this._showDetails(!1,e))}_showDetails(e,t){this._pendingShowDetails.value=G6(Et(this.element.domNode),()=>{this._pendingShowDetails.clear(),this._details.show();let i=!1;e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._details.widget.isEmpty?this._details.hide():(this._positionDetails(),this.element.domNode.classList.add("shows-details"),t&&(this._details.widget.focus(),i=!0)),i||this.editor.focus()})}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this._showDetails(!1,!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){this._pendingLayout.clear(),this._pendingShowDetails.clear(),this._loadingTimeout?.dispose(),this._setState(xt.Hidden),this._onDidHide.fire(this),this.element.clearSashHoverState();const e=this._persistedSize.restore(),t=Math.ceil(this.getLayoutInfo().itemHeight*4.3);e&&e.height<t&&this._persistedSize.store(e.with(void 0,t))}isFrozen(){return this._state===xt.Frozen}_afterRender(e){if(e===null){this._isDetailsVisible()&&this._details.hide();return}this._state===xt.Empty||this._state===xt.Loading||(this._isDetailsVisible()&&!this._details.widget.isEmpty&&this._details.show(),this._positionDetails())}_layout(e){if(!this.editor.hasModel()||!this.editor.getDomNode())return;const t=qu(this.element.domNode.ownerDocument.body),i=this.getLayoutInfo();e||(e=i.defaultSize);let n=e.height,o=e.width;if(this._status.element.style.height=`${i.itemHeight}px`,this._state===xt.Empty||this._state===xt.Loading)n=i.itemHeight+i.borderHeight,o=i.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new Ye(o,n),this._contentWidget.setPreference(Fi.BELOW);else{const r=t.width-i.borderHeight-2*i.horizontalPadding;o>r&&(o=r);const a=this._completionModel?this._completionModel.stats.pLabelLen*i.typicalHalfwidthCharacterWidth:o,c=i.statusBarHeight+this._list.contentHeight+i.borderHeight,d=i.itemHeight+i.statusBarHeight,l=Bs(this.editor.getDomNode()),u=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),g=l.top+u.top+u.height,m=Math.min(t.height-g-i.verticalPadding,c),v=l.top+u.top-i.verticalPadding,_=Math.min(v,c);let w=Math.min(Math.max(_,m)+i.borderHeight,c);n===this._cappedHeight?.capped&&(n=this._cappedHeight.wanted),n<d&&(n=d),n>w&&(n=w),n>m||this._forceRenderingAbove&&v>150?(this._contentWidget.setPreference(Fi.ABOVE),this.element.enableSashes(!0,!0,!1,!1),w=_):(this._contentWidget.setPreference(Fi.BELOW),this.element.enableSashes(!1,!0,!0,!1),w=m),this.element.preferredSize=new Ye(a,i.defaultSize.height),this.element.maxSize=new Ye(r,w),this.element.minSize=new Ye(220,d),this._cappedHeight=n===c?{wanted:this._cappedHeight?.wanted??e.height,capped:n}:void 0}this._resize(o,n)}_resize(e,t){const{width:i,height:n}=this.element.maxSize;e=Math.min(i,e),t=Math.min(n,t);const{statusBarHeight:o}=this.getLayoutInfo();this._list.layout(t-o,e),this._listElement.style.height=`${t-o}px`,this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,this._contentWidget.getPosition()?.preference[0]===Fi.BELOW)}getLayoutInfo(){const e=this.editor.getOption(L.fontInfo),t=dm(this.editor.getOption(L.suggestLineHeight)||e.lineHeight,8,1e3),i=!this.editor.getOption(L.suggest).showStatusBar||this._state===xt.Empty||this._state===xt.Loading?0:t,n=this._details.widget.borderWidth,o=2*n;return{itemHeight:t,statusBarHeight:i,borderWidth:n,borderHeight:o,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new Ye(430,i+12*t)}}_isDetailsVisible(){return this._storageService.getBoolean("expandSuggestionDocs",he.PROFILE,!1)}_setDetailsVisible(e){this._storageService.store("expandSuggestionDocs",e,he.PROFILE,gt.USER)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};xH=P_=f([p(1,it),p(2,fe),p(3,pt),p(4,Z)],xH);class _Le{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return"editor.widget.suggestWidget"}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return this._hidden||!this._position||!this._preference?null:{position:this._position,preference:[this._preference]}}beforeRender(){const{height:e,width:t}=this._widget.element.size,{borderWidth:i,horizontalPadding:n}=this._widget.getLayoutInfo();return new Ye(t+2*i+n,e+2*i)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}}var IH;class bLe{constructor(e,t){if(this._model=e,this._position=t,this._decorationOptions=Zt.register({description:"suggest-line-suffix",stickiness:ki.NeverGrowsWhenTypingAtEdges}),e.getLineMaxColumn(t.lineNumber)!==t.column){const n=e.getOffsetAt(t),o=e.getPositionAt(n+1);e.changeDecorations(r=>{this._marker&&r.removeDecoration(this._marker),this._marker=r.addDecoration(P.fromPositions(t,o),this._decorationOptions)})}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.changeDecorations(e=>{e.removeDecoration(this._marker),this._marker=void 0})}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){const t=this._model.getDecorationRange(this._marker);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}else return this._model.getLineMaxColumn(e.lineNumber)-e.column}}var Ys;(function(s){s[s.None=0]="None",s[s.NoBeforeUndoStop=1]="NoBeforeUndoStop",s[s.NoAfterUndoStop=2]="NoAfterUndoStop",s[s.KeepAlternativeSuggestions=4]="KeepAlternativeSuggestions",s[s.AlternativeOverwriteConfig=8]="AlternativeOverwriteConfig"})(Ys||(Ys={}));let ia=class{static{IH=this}static{this.ID="editor.contrib.suggestController"}static get(e){return e.getContribution(IH.ID)}constructor(e,t,i,n,o,r,a){this._memoryService=t,this._commandService=i,this._contextKeyService=n,this._instantiationService=o,this._logService=r,this._telemetryService=a,this._lineSuffix=new Pt,this._toDispose=new U,this._selectors=new yLe(u=>u.priority),this._onWillInsertSuggestItem=new M,this.onWillInsertSuggestItem=this._onWillInsertSuggestItem.event,this.editor=e,this.model=o.createInstance(sP,this.editor),this._selectors.register({priority:0,select:(u,g,m)=>this._memoryService.select(u,g,m)});const c=ut.InsertMode.bindTo(n);c.set(e.getOption(L.suggest).insertMode),this._toDispose.add(this.model.onDidTrigger(()=>c.set(e.getOption(L.suggest).insertMode))),this.widget=this._toDispose.add(new Ak(Et(e.getDomNode()),()=>{const u=this._instantiationService.createInstance(xH,this.editor);this._toDispose.add(u),this._toDispose.add(u.onDidSelect(w=>this._insertSuggestion(w,Ys.None),this));const g=new oLe(this.editor,u,this.model,w=>this._insertSuggestion(w,Ys.NoAfterUndoStop));this._toDispose.add(g);const m=ut.MakesTextEdit.bindTo(this._contextKeyService),v=ut.HasInsertAndReplaceRange.bindTo(this._contextKeyService),_=ut.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(Ie(()=>{m.reset(),v.reset(),_.reset()})),this._toDispose.add(u.onDidFocus(({item:w})=>{const C=this.editor.getPosition(),k=w.editStart.column,D=C.column;let A=!0;this.editor.getOption(L.acceptSuggestionOnEnter)==="smart"&&this.model.state===wp.Auto&&!w.completion.additionalTextEdits&&!(w.completion.insertTextRules&sh.InsertAsSnippet)&&D-k===w.completion.insertText.length&&(A=this.editor.getModel().getValueInRange({startLineNumber:C.lineNumber,startColumn:k,endLineNumber:C.lineNumber,endColumn:D})!==w.completion.insertText),m.set(A),v.set(!we.equals(w.editInsertEnd,w.editReplaceEnd)),_.set(!!w.provider.resolveCompletionItem||!!w.completion.documentation||w.completion.detail!==w.completion.label)})),this._toDispose.add(u.onDetailsKeyDown(w=>{if(w.toKeyCodeChord().equals(new wF(!0,!1,!1,!1,S.KeyC))||Yt&&w.toKeyCodeChord().equals(new wF(!1,!1,!1,!0,S.KeyC))){w.stopPropagation();return}w.toKeyCodeChord().isModifierKey()||this.editor.focus()})),u})),this._overtypingCapturer=this._toDispose.add(new Ak(Et(e.getDomNode()),()=>this._toDispose.add(new i4(this.editor,this.model)))),this._alternatives=this._toDispose.add(new Ak(Et(e.getDomNode()),()=>this._toDispose.add(new Ky(this.editor,this._contextKeyService)))),this._toDispose.add(o.createInstance(nP,e)),this._toDispose.add(this.model.onDidTrigger(u=>{this.widget.value.showTriggered(u.auto,u.shy?250:50),this._lineSuffix.value=new bLe(this.editor.getModel(),u.position)})),this._toDispose.add(this.model.onDidSuggest(u=>{if(u.triggerOptions.shy)return;let g=-1;for(const v of this._selectors.itemsOrderedByPriorityDesc)if(g=v.select(this.editor.getModel(),this.editor.getPosition(),u.completionModel.items),g!==-1)break;if(g===-1&&(g=0),this.model.state===wp.Idle)return;let m=!1;if(u.triggerOptions.auto){const v=this.editor.getOption(L.suggest);v.selectionMode==="never"||v.selectionMode==="always"?m=v.selectionMode==="never":v.selectionMode==="whenTriggerCharacter"?m=u.triggerOptions.triggerKind!==ba.TriggerCharacter:v.selectionMode==="whenQuickSuggestion"&&(m=u.triggerOptions.triggerKind===ba.TriggerCharacter&&!u.triggerOptions.refilter)}this.widget.value.showSuggestions(u.completionModel,g,u.isFrozen,u.triggerOptions.auto,m)})),this._toDispose.add(this.model.onDidCancel(u=>{u.retrigger||this.widget.value.hideWidget()})),this._toDispose.add(this.editor.onDidBlurEditorWidget(()=>{this.model.cancel(),this.model.clear()}));const d=ut.AcceptSuggestionsOnEnter.bindTo(n),l=()=>{const u=this.editor.getOption(L.acceptSuggestionOnEnter);d.set(u==="on"||u==="smart")};this._toDispose.add(this.editor.onDidChangeConfiguration(()=>l())),l()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose(),this._onWillInsertSuggestItem.dispose()}_insertSuggestion(e,t){if(!e||!e.item){this._alternatives.value.reset(),this.model.cancel(),this.model.clear();return}if(!this.editor.hasModel())return;const i=cs.get(this.editor);if(!i)return;this._onWillInsertSuggestItem.fire({item:e.item});const n=this.editor.getModel(),o=n.getAlternativeVersionId(),{item:r}=e,a=[],c=new li;t&Ys.NoBeforeUndoStop||this.editor.pushUndoStop();const d=this.getOverwriteInfo(r,!!(t&Ys.AlternativeOverwriteConfig));this._memoryService.memorize(n,this.editor.getPosition(),r);const l=r.isResolved;let u=-1,g=-1;if(Array.isArray(r.completion.additionalTextEdits)){this.model.cancel();const v=py.capture(this.editor);this.editor.executeEdits("suggestController.additionalTextEdits.sync",r.completion.additionalTextEdits.map(_=>{let w=P.lift(_.range);if(w.startLineNumber===r.position.lineNumber&&w.startColumn>r.position.column){const C=this.editor.getPosition().column-r.position.column,k=C,D=P.spansMultipleLines(w)?0:C;w=new P(w.startLineNumber,w.startColumn+k,w.endLineNumber,w.endColumn+D)}return qi.replaceMove(w,_.text)})),v.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!l){const v=new Xn;let _;const w=n.onDidChangeContent(A=>{if(A.isFlush){c.cancel(),w.dispose();return}for(const B of A.changes){const q=P.getEndPosition(B.range);(!_||we.isBefore(q,_))&&(_=q)}}),C=t;t|=Ys.NoAfterUndoStop;let k=!1;const D=this.editor.onWillType(()=>{D.dispose(),k=!0,C&Ys.NoAfterUndoStop||this.editor.pushUndoStop()});a.push(r.resolve(c.token).then(()=>{if(!r.completion.additionalTextEdits||c.token.isCancellationRequested)return;if(_&&r.completion.additionalTextEdits.some(B=>we.isBefore(_,P.getStartPosition(B.range))))return!1;k&&this.editor.pushUndoStop();const A=py.capture(this.editor);return this.editor.executeEdits("suggestController.additionalTextEdits.async",r.completion.additionalTextEdits.map(B=>qi.replaceMove(P.lift(B.range),B.text))),A.restoreRelativeVerticalPositionOfCursor(this.editor),(k||!(C&Ys.NoAfterUndoStop))&&this.editor.pushUndoStop(),!0}).then(A=>{this._logService.trace("[suggest] async resolving of edits DONE (ms, applied?)",v.elapsed(),A),g=A===!0?1:A===!1?0:-2}).finally(()=>{w.dispose(),D.dispose()}))}let{insertText:m}=r.completion;if(r.completion.insertTextRules&sh.InsertAsSnippet||(m=fd.escape(m)),this.model.cancel(),i.insert(m,{overwriteBefore:d.overwriteBefore,overwriteAfter:d.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(r.completion.insertTextRules&sh.KeepWhitespace),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value}),t&Ys.NoAfterUndoStop||this.editor.pushUndoStop(),r.completion.command)if(r.completion.command.id===RO.id)this.model.trigger({auto:!0,retrigger:!0});else{const v=new Xn;a.push(this._commandService.executeCommand(r.completion.command.id,...r.completion.command.arguments?[...r.completion.command.arguments]:[]).catch(_=>{r.completion.extensionId?Ln(_):mt(_)}).finally(()=>{u=v.elapsed()}))}t&Ys.KeepAlternativeSuggestions&&this._alternatives.value.set(e,v=>{for(c.cancel();n.canUndo();){o!==n.getAlternativeVersionId()&&n.undo(),this._insertSuggestion(v,Ys.NoBeforeUndoStop|Ys.NoAfterUndoStop|(t&Ys.AlternativeOverwriteConfig?Ys.AlternativeOverwriteConfig:0));break}}),this._alertCompletionItem(r),Promise.all(a).finally(()=>{this._reportSuggestionAcceptedTelemetry(r,n,l,u,g,e.index,e.model.items),this.model.clear(),c.dispose()})}_reportSuggestionAcceptedTelemetry(e,t,i,n,o,r,a){if(Math.random()>1e-4)return;const c=new Map;for(let g=0;g<Math.min(30,a.length);g++){const m=a[g].textLabel;c.has(m)?c.get(m).push(g):c.set(m,[g])}const d=c.get(e.textLabel),u=d&&d.length>1?d[0]:-1;this._telemetryService.publicLog2("suggest.acceptedSuggestion",{extensionId:e.extensionId?.value??"unknown",providerId:e.provider._debugDisplayName??"unknown",kind:e.completion.kind,basenameHash:lc(Qe(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:YM(t.uri),resolveInfo:e.provider.resolveCompletionItem?i?1:0:-1,resolveDuration:e.resolveDuration,commandDuration:n,additionalEditsAsync:o,index:r,firstIndex:u})}getOverwriteInfo(e,t){yt(this.editor.hasModel());let i=this.editor.getOption(L.suggest).insertMode==="replace";t&&(i=!i);const n=e.position.column-e.editStart.column,o=(i?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column,r=this.editor.getPosition().column-e.position.column,a=this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0;return{overwriteBefore:n+r,overwriteAfter:o+a}}_alertCompletionItem(e){if(An(e.completion.additionalTextEdits)){const t=h(1510,"Accepting '{0}' made {1} additional edits",e.textLabel,e.completion.additionalTextEdits.length);na(t)}}triggerSuggest(e,t,i){this.editor.hasModel()&&(this.model.trigger({auto:t??!1,completionOptions:{providerFilter:e,kindFilter:i?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),Qi.Smooth),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;const t=this.editor.getPosition(),i=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},n=o=>{if(o.completion.insertTextRules&sh.InsertAsSnippet||o.completion.additionalTextEdits)return!0;const r=this.editor.getPosition(),a=o.editStart.column,c=r.column;return c-a!==o.completion.insertText.length?!0:this.editor.getModel().getValueInRange({startLineNumber:r.lineNumber,startColumn:a,endLineNumber:r.lineNumber,endColumn:c})!==o.completion.insertText};T.once(this.model.onDidTrigger)(o=>{const r=[];T.any(this.model.onDidTrigger,this.model.onDidCancel)(()=>{Xe(r),i()},void 0,r),this.model.onDidSuggest(({completionModel:a})=>{if(Xe(r),a.items.length===0){i();return}const c=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),a.items),d=a.items[c];if(!n(d)){i();return}this.editor.pushUndoStop(),this._insertSuggestion({index:c,item:d,model:a},Ys.KeepAlternativeSuggestions|Ys.NoBeforeUndoStop|Ys.NoAfterUndoStop)},void 0,r)}),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,Qi.Smooth),this.editor.focus()}acceptSelectedSuggestion(e,t){const i=this.widget.value.getFocusedItem();let n=0;e&&(n|=Ys.KeepAlternativeSuggestions),t&&(n|=Ys.AlternativeOverwriteConfig),this._insertSuggestion(i,n)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.value.forceRenderingAbove()}stopForceRenderingAbove(){this.widget.isInitialized&&this.widget.value.stopForceRenderingAbove()}registerSelector(e){return this._selectors.register(e)}};ia=IH=f([p(1,UN),p(2,Ge),p(3,fe),p(4,Z),p(5,Re),p(6,ai)],ia);class yLe{constructor(e){this.prioritySelector=e,this._items=new Array}register(e){if(this._items.indexOf(e)!==-1)throw new Error("Value is already registered");return this._items.push(e),this._items.sort((t,i)=>this.prioritySelector(i)-this.prioritySelector(t)),{dispose:()=>{const t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}}class RO extends Se{static{this.id="editor.action.triggerSuggest"}constructor(){super({id:RO.id,label:I(1511,"Trigger Suggest"),precondition:x.and(V.writable,V.hasCompletionItemProvider,ut.Visible.toNegated()),kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Space,secondary:[E.CtrlCmd|S.KeyI],mac:{primary:E.WinCtrl|S.Space,secondary:[E.Alt|S.Escape,E.CtrlCmd|S.KeyI]},weight:W.EditorContrib}})}run(e,t,i){const n=ia.get(t);if(!n)return;let o;i&&typeof i=="object"&&i.auto===!0&&(o=!0),n.triggerSuggest(void 0,o,void 0)}}Lt(ia.ID,ia,_t.BeforeFirstInteraction);ue(RO);const Ta=W.EditorContrib+90,nr=Vo.bindToContribution(ia.get);ze(new nr({id:"acceptSelectedSuggestion",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion),handler(s){s.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:S.Tab,kbExpr:x.and(ut.Visible,V.textInputFocus),weight:Ta},{primary:S.Enter,kbExpr:x.and(ut.Visible,V.textInputFocus,ut.AcceptSuggestionsOnEnter,ut.MakesTextEdit),weight:Ta}],menuOpts:[{menuId:yp,title:h(1512,"Insert"),group:"left",order:1,when:ut.HasInsertAndReplaceRange.toNegated()},{menuId:yp,title:h(1512,"Insert"),group:"left",order:1,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("insert"))},{menuId:yp,title:h(1513,"Replace"),group:"left",order:1,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("replace"))}]}));ze(new nr({id:"acceptAlternativeSelectedSuggestion",precondition:x.and(ut.Visible,V.textInputFocus,ut.HasFocusedSuggestion),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:E.Shift|S.Enter,secondary:[E.Shift|S.Tab]},handler(s){s.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:yp,group:"left",order:2,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("insert")),title:h(1513,"Replace")},{menuId:yp,group:"left",order:2,when:x.and(ut.HasInsertAndReplaceRange,ut.InsertMode.isEqualTo("replace")),title:h(1512,"Insert")}]}));Ee.registerCommandAlias("acceptSelectedSuggestionOnEnter","acceptSelectedSuggestion");ze(new nr({id:"hideSuggestWidget",precondition:ut.Visible,handler:s=>s.cancelSuggestWidget(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));ze(new nr({id:"selectNextSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectNextSuggestion(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow],mac:{primary:S.DownArrow,secondary:[E.CtrlCmd|S.DownArrow,E.WinCtrl|S.KeyN]}}}));ze(new nr({id:"selectNextPageSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectNextPageSuggestion(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:S.PageDown,secondary:[E.CtrlCmd|S.PageDown]}}));ze(new nr({id:"selectLastSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectLastSuggestion()}));ze(new nr({id:"selectPrevSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectPrevSuggestion(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow],mac:{primary:S.UpArrow,secondary:[E.CtrlCmd|S.UpArrow,E.WinCtrl|S.KeyP]}}}));ze(new nr({id:"selectPrevPageSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectPrevPageSuggestion(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:S.PageUp,secondary:[E.CtrlCmd|S.PageUp]}}));ze(new nr({id:"selectFirstSuggestion",precondition:x.and(ut.Visible,x.or(ut.MultipleSuggestions,ut.HasFocusedSuggestion.negate())),handler:s=>s.selectFirstSuggestion()}));ze(new nr({id:"focusSuggestion",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion.negate()),handler:s=>s.focusSuggestion(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Space,secondary:[E.CtrlCmd|S.KeyI],mac:{primary:E.WinCtrl|S.Space,secondary:[E.CtrlCmd|S.KeyI]}}}));ze(new nr({id:"focusAndAcceptSuggestion",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion.negate()),handler:s=>{s.focusSuggestion(),s.acceptSelectedSuggestion(!0,!1)}}));ze(new nr({id:"toggleSuggestionDetails",precondition:x.and(ut.Visible,ut.HasFocusedSuggestion),handler:s=>s.toggleSuggestionDetails(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Space,secondary:[E.CtrlCmd|S.KeyI],mac:{primary:E.WinCtrl|S.Space,secondary:[E.CtrlCmd|S.KeyI]}},menuOpts:[{menuId:yp,group:"right",order:1,when:x.and(ut.DetailsVisible,ut.CanResolve),title:h(1514,"Show Less")},{menuId:yp,group:"right",order:1,when:x.and(ut.DetailsVisible.toNegated(),ut.CanResolve),title:h(1515,"Show More")}]}));ze(new nr({id:"toggleExplainMode",precondition:ut.Visible,handler:s=>s.toggleExplainMode(),kbOpts:{weight:W.EditorContrib,primary:E.CtrlCmd|S.Slash}}));ze(new nr({id:"toggleSuggestionFocus",precondition:ut.Visible,handler:s=>s.toggleSuggestionFocus(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:E.CtrlCmd|E.Alt|S.Space,mac:{primary:E.WinCtrl|E.Alt|S.Space}}}));ze(new nr({id:"insertBestCompletion",precondition:x.and(V.textInputFocus,x.equals("config.editor.tabCompletion","on"),nP.AtEnd,ut.Visible.toNegated(),Ky.OtherSuggestions.toNegated(),cs.InSnippetMode.toNegated()),handler:(s,e)=>{s.triggerSuggestAndAcceptBest(ra(e)?{fallback:"tab",...e}:{fallback:"tab"})},kbOpts:{weight:Ta,primary:S.Tab}}));ze(new nr({id:"insertNextSuggestion",precondition:x.and(V.textInputFocus,x.equals("config.editor.tabCompletion","on"),Ky.OtherSuggestions,ut.Visible.toNegated(),cs.InSnippetMode.toNegated()),handler:s=>s.acceptNextSuggestion(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:S.Tab}}));ze(new nr({id:"insertPrevSuggestion",precondition:x.and(V.textInputFocus,x.equals("config.editor.tabCompletion","on"),Ky.OtherSuggestions,ut.Visible.toNegated(),cs.InSnippetMode.toNegated()),handler:s=>s.acceptPrevSuggestion(),kbOpts:{weight:Ta,kbExpr:V.textInputFocus,primary:E.Shift|S.Tab}}));ue(class extends Se{constructor(){super({id:"editor.action.resetSuggestSize",label:I(1516,"Reset Suggest Widget Size"),precondition:void 0})}run(s,e){ia.get(e)?.resetWidgetSize()}});let DH=class extends Ene{constructor(e,t,i,n,o,r){super(e),this._options=t,this._contextMenuService=i,this._keybindingService=n,this._hoverService=r,this._store=new U,this._updateStore=new U,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._actionRunner=this._store.add(new hg),t?.telemetrySource&&this._actionRunner.onDidRun(a=>{o.publicLog2("workbenchActionExecuted",{id:a.action.id,from:t.telemetrySource})},void 0,this._store)}dispose(){this._onDidChange.dispose(),this._updateStore.dispose(),this._store.dispose(),super.dispose()}update(e,t){const i=this._options?.buttonConfigProvider??(()=>({showLabel:!0}));this._updateStore.clear(),this.clear();const n=this._updateStore.add(Zm());for(let o=0;o<e.length;o++){const r=o>0,a=e[o];let c,d,l="";const u=a instanceof Eh?"":this._keybindingService.lookupKeybinding(a.id);if(u?l=h(1697,"{0} ({1})",a.tooltip||a.label,u.getLabel()):l=a.tooltip||a.label,a instanceof Eh&&a.actions.length>0){const[m,...v]=a.actions;c=m,d=this.addButtonWithDropdown({secondary:i(c,o)?.isSecondary??r,actionRunner:this._actionRunner,actions:v,contextMenuProvider:this._contextMenuService,ariaLabel:l,supportIcons:!0})}else c=a,d=this.addButton({secondary:i(c,o)?.isSecondary??r,ariaLabel:l,supportIcons:!0});d.enabled=c.enabled,d.checked=c.checked??!1,d.element.classList.add("default-colors");const g=i(c,o)?.showLabel??!0;g?d.label=c.label:d.element.classList.add("monaco-text-button"),i(c,o)?.showIcon&&(c instanceof wr&&ke.isThemeIcon(c.item.icon)?g?d.label=`$(${c.item.icon.id}) ${c.label}`:d.icon=c.item.icon:c.class&&d.element.classList.add(...c.class.split(" "))),this._updateStore.add(this._hoverService.setupManagedHover(n,d.element,l)),this._updateStore.add(d.onDidClick(async()=>{this._actionRunner.run(c)}))}if(t.length>0){const o=this.addButton({secondary:!0,ariaLabel:h(1698,"More Actions")});o.icon=K.dropDownButton,o.element.classList.add("default-colors","monaco-text-button"),o.enabled=!0,this._updateStore.add(this._hoverService.setupManagedHover(n,o.element,h(1698,"More Actions"))),this._updateStore.add(o.onDidClick(async()=>{this._contextMenuService.showContextMenu({getAnchor:()=>o.element,getActions:()=>t,actionRunner:this._actionRunner,onHide:()=>o.element.setAttribute("aria-expanded","false")}),o.element.setAttribute("aria-expanded","true")}))}this._onDidChange.fire(this)}};DH=f([p(2,bi),p(3,He),p(4,ai),p(5,Ti)],DH);let kH=class extends DH{constructor(e,t,i,n,o,r,a,c,d){super(e,i,r,a,c,d);const l=n.createMenu(t,o);this._store.add(l);const u=()=>{this.clear();const g=Xm(l.getActions(i?.menuOptions),i?.toolbarOptions?.primaryGroup);super.update(g.primary,g.secondary)};this._store.add(l.onDidChange(u)),u()}dispose(){super.dispose()}update(e){throw new Error("Use Menu or WorkbenchButtonBar")}};kH=f([p(3,fn),p(4,fe),p(5,bi),p(6,He),p(7,ai),p(8,Ti)],kH);let oP=class extends QM{get onDidChangeDropdownVisibility(){return this._dropdown.onDidChangeVisibility}constructor(e,t,i,n,o,r,a,c,d,l,u){super(null,e,{hoverDelegate:o?.hoverDelegate}),this._options=o,this._contextMenuProvider=r,this._container=null,this._dropdownContainer=null,this._primaryAction=new nI(e,{hoverDelegate:o?.hoverDelegate},a,c,d,l,r,u),o?.actionRunner&&(this._primaryAction.actionRunner=o.actionRunner),this._dropdown=new mC(t,i,this._contextMenuProvider,{menuAsChild:o?.menuAsChild??!0,classNames:n?["codicon","codicon-chevron-down",n]:["codicon","codicon-chevron-down"],actionRunner:this._options?.actionRunner,keybindingProvider:this._options?.getKeyBinding??(g=>a.lookupKeybinding(g.id)),hoverDelegate:o?.hoverDelegate,skipTelemetry:o?.skipTelemetry})}set actionRunner(e){super.actionRunner=e,this._primaryAction.actionRunner=e,this._dropdown.actionRunner=e}setActionContext(e){super.setActionContext(e),this._primaryAction.setActionContext(e),this._dropdown.setActionContext(e)}render(e){this._container=e,super.render(this._container),this._container.classList.add("monaco-dropdown-with-primary");const t=j(".action-container");t.role="button",t.ariaDisabled=String(!this.action.enabled),this._primaryAction.render(ee(this._container,t)),this._dropdownContainer=j(".dropdown-action-container"),this._dropdown.render(ee(this._container,this._dropdownContainer)),this._register(re(t,pe.KEY_DOWN,i=>{if(!this.action.enabled)return;const n=new vo(i);n.equals(S.RightArrow)&&(this._primaryAction.element.tabIndex=-1,this._dropdown.focus(),n.stopPropagation())})),this._register(re(this._dropdownContainer,pe.KEY_DOWN,i=>{if(!this.action.enabled)return;const n=new vo(i);n.equals(S.LeftArrow)&&(this._primaryAction.element.tabIndex=0,this._dropdown.setFocusable(!1),this._primaryAction.element?.focus(),n.stopPropagation())})),this.updateEnabled()}focus(e){e?this._dropdown.focus():(this._primaryAction.element.tabIndex=0,this._primaryAction.element.focus())}blur(){this._primaryAction.element.tabIndex=-1,this._dropdown.blur(),this._container.blur()}setFocusable(e){e?this._primaryAction.element.tabIndex=0:(this._primaryAction.element.tabIndex=-1,this._dropdown.setFocusable(!1))}updateEnabled(){const e=!this.action.enabled;this.element?.classList.toggle("disabled",e)}update(e,t,i){this._dropdown.dispose(),this._dropdown=new mC(e,t,this._contextMenuProvider,{menuAsChild:this._options?.menuAsChild??!0,classNames:["codicon",i||"codicon-chevron-down"],actionRunner:this._options?.actionRunner,hoverDelegate:this._options?.hoverDelegate,keybindingProvider:this._options?.getKeyBinding}),this._dropdownContainer&&this._dropdown.render(this._dropdownContainer)}showDropdown(){this._dropdown.show()}dispose(){this._primaryAction.dispose(),this._dropdown.dispose(),super.dispose()}};oP=f([p(5,bi),p(6,He),p(7,Dt),p(8,fe),p(9,pt),p(10,Nr)],oP);function Rl(s){if(!(!s||!s.resource))return R.isUri(s.resource)?s.resource:s.resource.primary}const PO={onDidChangeVisibility:T.None};let vd=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this.instantiationService=t,this.configurationService=i,this.modelService=n,this.workspaceService=o,this.languageService=r,this.decorationsService=a,this.themeService=c,this.labelService=d,this.textFileService=l,this._onDidChangeDecorations=this._register(new M),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this.widgets=[],this.labels=[],this.registerListeners(e)}registerListeners(e){this._register(e.onDidChangeVisibility(t=>{this.widgets.forEach(i=>i.notifyVisibilityChanged(t))})),this._register(this.languageService.onDidChange(()=>this.widgets.forEach(t=>t.notifyExtensionsRegistered()))),this._register(this.modelService.onModelLanguageChanged(t=>{t.model.uri&&this.widgets.forEach(i=>i.notifyModelLanguageChanged(t.model))})),this._register(this.modelService.onModelAdded(t=>{t.uri&&this.widgets.forEach(i=>i.notifyModelAdded(t))})),this._register(this.workspaceService.onDidChangeWorkspaceFolders(()=>{this.widgets.forEach(t=>t.notifyWorkspaceFoldersChange())})),this._register(this.decorationsService.onDidChangeDecorations(t=>{let i=!1;this.widgets.forEach(n=>{n.notifyFileDecorationsChanges(t)&&(i=!0)}),i&&this._onDidChangeDecorations.fire()})),this._register(this.themeService.onDidColorThemeChange(()=>this.widgets.forEach(t=>t.notifyThemeChange()))),this._register(this.configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(xne)&&this.widgets.forEach(i=>i.notifyFileAssociationsChange())})),this._register(this.labelService.onDidChangeFormatters(t=>{this.widgets.forEach(i=>i.notifyFormattersChange(t.scheme))})),this._register(this.textFileService.untitled.onDidChangeLabel(t=>{this.widgets.forEach(i=>i.notifyUntitledLabelChange(t.resource))}))}get(e){return this.labels[e]}create(e,t){const i=this.instantiationService.createInstance(AH,e,t),n={element:i.element,onDidRender:i.onDidRender,setLabel:(o,r,a)=>i.setLabel(o,r,a),setResource:(o,r)=>i.setResource(o,r),setFile:(o,r)=>i.setFile(o,r),clear:()=>i.clear(),dispose:()=>this.disposeWidget(i)};return this.labels.push(n),this.widgets.push(i),n}disposeWidget(e){const t=this.widgets.indexOf(e);t>-1&&(this.widgets.splice(t,1),this.labels.splice(t,1)),Xe(e)}clear(){this.widgets=Xe(this.widgets),this.labels=[]}dispose(){super.dispose(),this.clear()}};vd=f([p(1,Z),p(2,ne),p(3,ci),p(4,It),p(5,vi),p(6,Pv),p(7,pt),p(8,ui),p(9,Ps)],vd);let TH=class extends vd{get element(){return this.label}constructor(e,t,i,n,o,r,a,c,d,l,u){super(PO,i,n,o,r,a,c,d,l,u),this.label=this._register(this.create(e,t))}};TH=f([p(2,Z),p(3,ne),p(4,ci),p(5,It),p(6,vi),p(7,Pv),p(8,pt),p(9,ui),p(10,Ps)],TH);var im;(function(s){s[s.Basic=1]="Basic",s[s.Full=2]="Full"})(im||(im={}));let AH=class extends Sz{constructor(e,t,i,n,o,r,a,c,d){super(e,t),this.languageService=i,this.modelService=n,this.decorationsService=o,this.labelService=r,this.textFileService=a,this.contextService=c,this.notebookDocumentService=d,this._onDidRender=this._register(new M),this.onDidRender=this._onDidRender.event,this.label=void 0,this.decoration=this._register(new Pt),this.options=void 0,this.computedIconClasses=void 0,this.computedLanguageId=void 0,this.computedPathLabel=void 0,this.computedWorkspaceFolderLabel=void 0,this.needsRedraw=void 0,this.isHidden=!1}notifyVisibilityChanged(e){e===this.isHidden&&(this.isHidden=!e,e&&this.needsRedraw&&(this.render({updateIcon:this.needsRedraw===im.Full,updateDecoration:this.needsRedraw===im.Full}),this.needsRedraw=void 0))}notifyModelLanguageChanged(e){this.handleModelEvent(e)}notifyModelAdded(e){this.handleModelEvent(e)}handleModelEvent(e){const t=Rl(this.label);t&&At(e.uri,t)&&this.computedLanguageId!==e.getLanguageId()&&(this.computedLanguageId=e.getLanguageId(),this.render({updateIcon:!0,updateDecoration:!1}))}notifyFileDecorationsChanges(e){if(!this.options)return!1;const t=Rl(this.label);return t&&this.options.fileDecorations&&e.affectsResource(t)?this.render({updateIcon:!1,updateDecoration:!0}):!1}notifyExtensionsRegistered(){this.render({updateIcon:!0,updateDecoration:!1})}notifyThemeChange(){this.render({updateIcon:!1,updateDecoration:!1})}notifyFileAssociationsChange(){this.render({updateIcon:!0,updateDecoration:!1})}notifyFormattersChange(e){Rl(this.label)?.scheme===e&&this.render({updateIcon:!1,updateDecoration:!1})}notifyUntitledLabelChange(e){At(e,Rl(this.label))&&this.render({updateIcon:!1,updateDecoration:!1})}notifyWorkspaceFoldersChange(){if(typeof this.computedWorkspaceFolderLabel=="string"){const e=Rl(this.label);R.isUri(e)&&this.label?.name===this.computedWorkspaceFolderLabel&&this.setFile(e,this.options)}}setFile(e,t){const i=t?.hideLabel;let n;if(!i){if(t?.fileKind===Pi.ROOT_FOLDER){const r=this.contextService.getWorkspaceFolder(e);r&&(n=r.name,this.computedWorkspaceFolderLabel=n)}n||(n=KT(Zd(e)))}let o;if(!t?.hidePath){const r=this.labelService.getUriLabel(_s(e),{relative:!0});r&&r!=="."&&(o=r)}this.setResource({resource:e,name:n,description:o,range:t?.range},t)}setResource(e,t=Object.create(null)){const i=Rl(e),n=e?.resource&&!R.isUri(e.resource);if(!t.forceLabel&&!n&&i?.scheme===ae.untitled){const d=this.textFileService.untitled.get(i);if(d&&!d.hasAssociatedFilePath){if(typeof e.name=="string"&&(e.name=d.name),typeof e.description=="string"){const u=d.resource.path;e.name!==u?e.description=u:e.description=void 0}const l=d.resource.path;d.name!==l?t.title=`${d.name}  ${l}`:t.title=l}}if(!t.forceLabel&&!n&&i?.scheme===ae.vscodeNotebookCell){const d=this.notebookDocumentService.getNotebook(i),l=d?.getCellIndex(i);d&&l!==void 0&&typeof e.name=="string"&&(t.title=h(2822,"{0}  Cell {1}",e.name,`${l+1}`)),typeof e.name=="string"&&d&&l!==void 0&&typeof e.name=="string"&&(e.name=h(2822,"{0}  Cell {1}",e.name,`${l+1}`))}if(!t.forceLabel&&!n&&i?.scheme===ae.vscodeNotebookCellOutput){const d=this.notebookDocumentService.getNotebook(i),l=Poe(i);if(l?.cellFragment){if(!l.notebook)return;const u=l.notebook.with({scheme:ae.vscodeNotebookCell,fragment:l.cellFragment}),g=d?.getCellIndex(u),m=l.outputIndex;g!==void 0&&m!==void 0&&typeof e.name=="string"?e.name=h(2823,"{0}  Cell {1}  Output {2}",e.name,`${g+1}`,`${m+1}`):g!==void 0&&typeof e.name=="string"&&(e.name=h(2824,"{0}  Cell {1}  Output",e.name,`${g+1}`))}}const o=this.hasResourceChanged(e),r=o||this.hasPathLabelChanged(e),a=this.hasFileKindChanged(t),c=this.hasIconChanged(t);this.label=e,this.options=t,o&&(this.computedLanguageId=void 0),r&&(this.computedPathLabel=void 0),this.render({updateIcon:o||a||c,updateDecoration:o||a})}hasFileKindChanged(e){const t=e?.fileKind,i=this.options?.fileKind;return t!==i}hasResourceChanged(e){const t=Rl(e),i=Rl(this.label);return t&&i?t.toString()!==i.toString():!(!t&&!i)}hasPathLabelChanged(e){const t=Rl(e);return!!t&&this.computedPathLabel!==this.labelService.getUriLabel(t)}hasIconChanged(e){return this.options?.icon!==e?.icon}clear(){this.label=void 0,this.options=void 0,this.computedLanguageId=void 0,this.computedIconClasses=void 0,this.computedPathLabel=void 0,this.setLabel("")}render(e){if(this.isHidden)return this.needsRedraw!==im.Full&&(this.needsRedraw=e.updateIcon||e.updateDecoration?im.Full:im.Basic),!1;if(e.updateIcon&&(this.computedIconClasses=void 0),!this.label)return!1;const t={title:"",italic:this.options?.italic,strikethrough:this.options?.strikethrough,matches:this.options?.matches,descriptionMatches:this.options?.descriptionMatches,extraClasses:[],separator:this.options?.separator,domId:this.options?.domId,disabledCommand:this.options?.disabledCommand,labelEscapeNewLines:this.options?.labelEscapeNewLines,descriptionTitle:this.options?.descriptionTitle},i=Rl(this.label);if(this.options?.title!==void 0&&(t.title=this.options.title),i&&i.scheme!==ae.data&&(!this.options?.title||typeof this.options.title!="string"&&!this.options.title.markdownNotSupportedFallback)&&(this.computedPathLabel||(this.computedPathLabel=this.labelService.getUriLabel(i)),!t.title||typeof t.title=="string"?t.title=this.computedPathLabel:t.title.markdownNotSupportedFallback||(t.title.markdownNotSupportedFallback=this.computedPathLabel)),this.options&&!this.options.hideIcon&&(this.computedIconClasses||(this.computedIconClasses=ch(this.modelService,this.languageService,i,this.options.fileKind,this.options.icon)),R.isUri(this.options.icon)&&(t.iconPath=this.options.icon),t.extraClasses=this.computedIconClasses.slice(0)),this.options?.extraClasses&&t.extraClasses.push(...this.options.extraClasses),this.options?.fileDecorations&&i){e.updateDecoration&&(this.decoration.value=this.decorationsService.getDecoration(i,this.options.fileKind!==Pi.FILE));const n=this.decoration.value;if(n){if(n.tooltip){if(typeof t.title=="string")t.title=`${t.title}  ${n.tooltip}`;else if(typeof t.title?.markdown=="string"){const o=`${t.title.markdown}  ${n.tooltip}`;t.title={markdown:o,markdownNotSupportedFallback:o}}}n.strikethrough&&(t.strikethrough=!0),this.options.fileDecorations.colors&&t.extraClasses.push(n.labelClassName),this.options.fileDecorations.badges&&(t.extraClasses.push(n.badgeClassName),t.extraClasses.push(n.iconClassName))}}return this.label.range&&(t.suffix=this.label.range.startLineNumber!==this.label.range.endLineNumber?`:${this.label.range.startLineNumber}-${this.label.range.endLineNumber}`:`:${this.label.range.startLineNumber}`),this.setLabel(this.label.name??"",this.label.description,t),this._onDidRender.fire(),!0}dispose(){super.dispose(),this.label=void 0,this.options=void 0,this.computedLanguageId=void 0,this.computedIconClasses=void 0,this.computedPathLabel=void 0,this.computedWorkspaceFolderLabel=void 0}};AH=f([p(2,vi),p(3,ci),p(4,Pv),p(5,ui),p(6,Ps),p(7,It),p(8,Jre)],AH);const wLe=new O("hasSpeechProvider",!1,{type:"boolean",description:h(9629,"A speech provider is registered to the speech service.")}),SLe=new O("speechToTextInProgress",!1,{type:"boolean",description:h(9630,"A speech-to-text session is in progress.")});new O("textToSpeechInProgress",!1,{type:"boolean",description:h(9631,"A text-to-speech session is in progress.")});var pb;(function(s){s[s.Started=1]="Started",s[s.Recognizing=2]="Recognizing",s[s.Recognized=3]="Recognized",s[s.Stopped=4]="Stopped",s[s.Error=5]="Error"})(pb||(pb={}));var RH;(function(s){s[s.Started=1]="Started",s[s.Stopped=2]="Stopped",s[s.Error=3]="Error"})(RH||(RH={}));var HX;(function(s){s[s.Recognized=1]="Recognized",s[s.Stopped=2]="Stopped",s[s.Canceled=3]="Canceled"})(HX||(HX={}));var bu;(function(s){s.SpeechTimeout="accessibility.voice.speechTimeout",s.AutoSynthesize="accessibility.voice.autoSynthesize",s.SpeechLanguage="accessibility.voice.speechLanguage",s.IgnoreCodeBlocks="accessibility.voice.ignoreCodeBlocks"})(bu||(bu={}));bu.SpeechLanguage;const CLe={"da-DK":{name:h(9632,"Danish (Denmark)")},"de-DE":{name:h(9633,"German (Germany)")},"en-AU":{name:h(9634,"English (Australia)")},"en-CA":{name:h(9635,"English (Canada)")},"en-GB":{name:h(9636,"English (United Kingdom)")},"en-IE":{name:h(9637,"English (Ireland)")},"en-IN":{name:h(9638,"English (India)")},"en-NZ":{name:h(9639,"English (New Zealand)")},"en-US":{name:h(9640,"English (United States)")},"es-ES":{name:h(9641,"Spanish (Spain)")},"es-MX":{name:h(9642,"Spanish (Mexico)")},"fr-CA":{name:h(9643,"French (Canada)")},"fr-FR":{name:h(9644,"French (France)")},"hi-IN":{name:h(9645,"Hindi (India)")},"it-IT":{name:h(9646,"Italian (Italy)")},"ja-JP":{name:h(9647,"Japanese (Japan)")},"ko-KR":{name:h(9648,"Korean (South Korea)")},"nl-NL":{name:h(9649,"Dutch (Netherlands)")},"pt-PT":{name:h(9650,"Portuguese (Portugal)")},"pt-BR":{name:h(9651,"Portuguese (Brazil)")},"ru-RU":{name:h(9652,"Russian (Russia)")},"sv-SE":{name:h(9653,"Swedish (Sweden)")},"tr-TR":{name:h(9654,"Turkish (Trkiye)")},"zh-CN":{name:h(9655,"Chinese (Simplified, China)")},"zh-HK":{name:h(9656,"Chinese (Traditional, Hong Kong)")},"zh-TW":{name:h(9657,"Chinese (Traditional, Taiwan)")}},ig=new O("accessibilityHelpIsShown",!1,!0),Aa=new O("accessibleViewIsShown",!1,!0),rP=new O("accessibleViewSupportsNavigation",!1,!0),UX=new O("accessibleViewVerbosityEnabled",!1,!0),$X=new O("accessibleViewGoToSymbolSupported",!1,!0);new O("accessibleViewOnLastLine",!1,!0);const Sp=new O("accessibleViewCurrentProviderId",void 0,void 0);new O("accessibleViewInCodeBlock",void 0,void 0);const aP=new O("accessibleViewContainsCodeBlocks",void 0,void 0),GX=new O("accessibleViewHasUnassignedKeybindings",void 0,void 0),zX=new O("accessibleViewHasAssignedKeybindings",void 0,void 0);var PH;(function(s){s.DimUnfocusedEnabled="accessibility.dimUnfocused.enabled",s.DimUnfocusedOpacity="accessibility.dimUnfocused.opacity",s.HideAccessibleView="accessibility.hideAccessibleView",s.AccessibleViewCloseOnKeyPress="accessibility.accessibleView.closeOnKeyPress"})(PH||(PH={}));var qX;(function(s){s[s.Default=.75]="Default",s[s.Minimum=.2]="Minimum",s[s.Maximum=1]="Maximum"})(qX||(qX={}));var zn;(function(s){s.Terminal="accessibility.verbosity.terminal",s.DiffEditor="accessibility.verbosity.diffEditor",s.MergeEditor="accessibility.verbosity.mergeEditor",s.Chat="accessibility.verbosity.panelChat",s.InlineChat="accessibility.verbosity.inlineChat",s.TerminalChat="accessibility.verbosity.terminalChat",s.InlineCompletions="accessibility.verbosity.inlineCompletions",s.KeybindingsEditor="accessibility.verbosity.keybindingsEditor",s.Notebook="accessibility.verbosity.notebook",s.Editor="accessibility.verbosity.editor",s.Hover="accessibility.verbosity.hover",s.Notification="accessibility.verbosity.notification",s.EmptyEditorHint="accessibility.verbosity.emptyEditorHint",s.ReplEditor="accessibility.verbosity.replEditor",s.Comments="accessibility.verbosity.comments",s.DiffEditorActive="accessibility.verbosity.diffEditorActive",s.Debug="accessibility.verbosity.debug",s.Walkthrough="accessibility.verbosity.walkthrough",s.SourceControl="accessibility.verbosity.sourceControl"})(zn||(zn={}));const Hde=Object.freeze({id:"accessibility",title:h(4024,"Accessibility"),type:"object"});h(4025,"Enable sound when a screen reader is attached."),h(4026,"Enable sound."),h(4027,"Disable sound.");h(4028,"Enable announcement, will only play when in screen reader optimized mode."),h(4029,"Disable announcement.");({...Hde,scope:Ht.RESOURCE,properties:(zn.Terminal+"",h(4030,"Provide information about how to access the terminal accessibility help menu when the terminal is focused."),zn.DiffEditor+"",h(4031,"Provide information about how to navigate changes in the diff editor when it is focused."),zn.Chat+"",h(4032,"Provide information about how to access the chat help menu when the chat input is focused."),zn.InlineChat+"",h(4033,"Provide information about how to access the inline editor chat accessibility help menu and alert with hints that describe how to use the feature when the input is focused."),zn.InlineCompletions+"",h(4034,"Provide information about how to access the inline completions hover and Accessible View."),zn.KeybindingsEditor+"",h(4035,"Provide information about how to change a keybinding in the keybindings editor when a row is focused."),zn.Notebook+"",h(4036,"Provide information about how to focus the cell container or inner editor when a notebook cell is focused."),zn.Hover+"",h(4037,"Provide information about how to open the hover in an Accessible View."),zn.Notification+"",h(4038,"Provide information about how to open the notification in an Accessible View."),zn.EmptyEditorHint+"",h(4039,"Provide information about relevant actions in an empty text editor."),zn.ReplEditor+"",h(4040,"Provide information about how to access the REPL editor accessibility help menu when the REPL editor is focused."),zn.Comments+"",h(4041,"Provide information about actions that can be taken in the comment widget or in a file which contains comments."),zn.DiffEditorActive+"",h(4042,"Indicate when a diff editor becomes the active editor."),zn.Debug+"",h(4043,"Provide information about how to access the debug console accessibility help dialog when the debug console or run and debug viewlet is focused. Note that a reload of the window is required for this to take effect."),zn.Walkthrough+"",h(4044,"Provide information about how to open the walkthrough in an Accessible View."),PH.AccessibleViewCloseOnKeyPress+"",h(4045,"On keypress, close the Accessible View and focus the element from which it was invoked."),zn.SourceControl+"",h(4046,"Provide information about how to access the source control accessibility help menu when the input is focused."),h(4047,"The volume of the sounds in percent (0-100)."),h(4048,"Whether or not position changes should be debounced"),h(4049,"The delay in milliseconds before an announcement is made."),h(4050,"The delay in milliseconds before a sound is played."),h(4051,"The delay in milliseconds before an announcement is made when there's a warning at the position."),h(4052,"The delay in milliseconds before a sound is played when there's a warning at the position."),h(4053,"The delay in milliseconds before an announcement is made when there's an error at the position."),h(4054,"The delay in milliseconds before a sound is played when there's an error at the position."),h(4055,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a breakpoint."),h(4056,"Plays a sound when the active line has a breakpoint."),h(4057,"Announces when the active line has a breakpoint."),h(4058,"Plays a sound / audio cue when the active line has an inline suggestion."),h(4059,"Plays a sound when the active line has an inline suggestion."),h(4060,"Plays a signal - sound / audio cue and/or announcement (alert) when there is a next edit suggestion."),h(4061,"Plays a sound when there is a next edit suggestion."),h(4062,"Announces when there is a next edit suggestion."),h(4063,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has an error."),h(4064,"Plays a sound when the active line has an error."),h(4065,"Announces when the active line has an error."),h(4066,"Plays a signal - sound (audio cue) and/or announcement (alert) - the active line has a folded area that can be unfolded."),h(4067,"Plays a sound when the active line has a folded area that can be unfolded."),h(4068,"Announces when the active line has a folded area that can be unfolded."),h(4069,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a warning."),h(4070,"Plays a sound when the active line has a warning."),h(4071,"Announces when the active line has a warning."),h(4072,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a warning."),h(4073,"Plays a sound when the active line has a warning."),h(4074,"Announces when the active line has a warning."),h(4075,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the active line has a warning."),h(4076,"Plays a sound when the active line has a warning."),h(4077,"Announces when the active line has a warning."),h(4078,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the debugger stopped on a breakpoint."),h(4079,"Plays a sound when the debugger stopped on a breakpoint."),h(4080,"Announces when the debugger stopped on a breakpoint."),h(4081,"Plays a signal - sound (audio cue) and/or announcement (alert) - when trying to read a line with inlay hints that has no inlay hints."),h(4082,"Plays a sound when trying to read a line with inlay hints that has no inlay hints."),h(4083,"Announces when trying to read a line with inlay hints that has no inlay hints."),h(4084,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a task is completed."),h(4085,"Plays a sound when a task is completed."),h(4086,"Announces when a task is completed."),h(4087,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a task fails (non-zero exit code)."),h(4088,"Plays a sound when a task fails (non-zero exit code)."),h(4089,"Announces when a task fails (non-zero exit code)."),h(4090,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a terminal command fails (non-zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4091,"Plays a sound when a terminal command fails (non-zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4092,"Announces when a terminal command fails (non-zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4093,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a terminal command succeeds (zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4094,"Plays a sound when a terminal command succeeds (zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4095,"Announces when a terminal command succeeds (zero exit code) or when a command with such an exit code is navigated to in the accessible view."),h(4096,"Plays a signal - sound (audio cue) and/or announcement (alert) - when terminal Quick Fixes are available."),h(4097,"Plays a sound when terminal Quick Fixes are available."),h(4098,"Announces when terminal Quick Fixes are available."),h(4099,"Plays a signal - sound (audio cue) and/or announcement (alert) - when the terminal bell is ringing."),h(4100,"Plays a sound when the terminal bell is ringing."),h(4101,"Announces when the terminal bell is ringing."),h(4102,"Plays a sound / audio cue when the focus moves to an inserted line in Accessible Diff Viewer mode or to the next/previous change."),h(4103,"Plays a sound when the focus moves to an inserted line in Accessible Diff Viewer mode or to the next/previous change."),h(4104,"Plays a sound / audio cue when the focus moves to an modified line in Accessible Diff Viewer mode or to the next/previous change."),h(4105,"Plays a sound when the focus moves to a modified line in Accessible Diff Viewer mode or to the next/previous change."),h(4106,"Plays a sound / audio cue when the focus moves to an deleted line in Accessible Diff Viewer mode or to the next/previous change."),h(4107,"Plays a sound when the focus moves to an deleted line in Accessible Diff Viewer mode or to the next/previous change."),h(4108,"Plays a sound / audio cue when revealing a file with changes from chat edits"),h(4109,"Plays a sound when revealing a file with changes from chat edits"),h(4110,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a notebook cell execution is successfully completed."),h(4111,"Plays a sound when a notebook cell execution is successfully completed."),h(4112,"Announces when a notebook cell execution is successfully completed."),h(4113,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a notebook cell execution fails."),h(4114,"Plays a sound when a notebook cell execution fails."),h(4115,"Announces when a notebook cell execution fails."),h(4116,"Plays a signal - sound (audio cue) and/or announcement (alert) - on loop while progress is occurring."),h(4117,"Plays a sound on loop while progress is occurring."),h(4118,"Alerts on loop while progress is occurring."),h(4119,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a chat request is made."),h(4120,"Plays a sound when a chat request is made."),h(4121,"Announces when a chat request is made."),h(4122,"Plays a sound / audio cue when the response has been received."),h(4123,"Plays a sound on when the response has been received."),h(4124,"Plays a sound / audio cue - when a code action has been triggered."),h(4125,"Plays a sound when a code action has been triggered."),h(4126,"Plays a sound / audio cue when the code action has been applied."),h(4127,"Plays a sound when the code action has been applied."),h(4128,"Plays a sound / audio cue when the voice recording has started."),h(4129,"Plays a sound when the voice recording has started."),h(4130,"Plays a sound / audio cue when the voice recording has stopped."),h(4131,"Plays a sound when the voice recording has stopped."),h(4132,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a feature is cleared (for example, the terminal, Debug Console, or Output channel)."),h(4133,"Plays a sound when a feature is cleared."),h(4134,"Announces when a feature is cleared."),h(4135,"Plays a signal - sound (audio cue) and/or announcement (alert) - when edits have been undone."),h(4136,"Plays a sound when edits have been undone."),h(4137,"Announces when edits have been undone."),h(4138,"Plays a signal - sound (audio cue) and/or announcement (alert) - when edits are kept."),h(4139,"Plays a sound when edits are kept."),h(4140,"Announces when edits are kept."),h(4141,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a file is saved."),h(4142,"Plays a sound when a file is saved."),h(4143,"Plays the sound when a user explicitly saves a file."),h(4144,"Plays the sound whenever a file is saved, including auto save."),h(4145,"Never plays the sound."),h(4146,"Announces when a file is saved."),h(4147,"Announces when a user explicitly saves a file."),h(4148,"Announces whenever a file is saved, including auto save."),h(4149,"Never plays the announcement."),h(4150,"Plays a signal - sound (audio cue) and/or announcement (alert) - when a file or notebook is formatted."),h(4151,"Plays a sound when a file or notebook is formatted."),h(4152,"Plays the sound when a user explicitly formats a file."),h(4153,"Plays the sound whenever a file is formatted, including if it is set to format on save, type, or, paste, or run of a cell."),h(4154,"Never plays the sound."),h(4155,"Announces when a file or notebook is formatted."),h(4156,"Announces when a user explicitly formats a file."),h(4157,"Announces whenever a file is formatted, including if it is set to format on save, type, or, paste, or run of a cell."),h(4158,"Never announces."),h(4159,"Controls whether links should be underlined in the workbench."),h(4160,"Controls whether variable changes should be announced in the debug watch view."),h(4161,"Controls whether the output from an execution in the native REPL will be announced."),h(4162,"Control whether focus should automatically be sent to the REPL when code is executed."),h(4163,"Controls whether the {0} should be optimized for screen readers when in screen reader mode. When enabled, the window title will have {1} appended to the end.","`#window.title#`","`activeEditorState`"))});const ELe=1200;let KX=class extends F{static{this.ID="workbench.contrib.dynamicSpeechAccessibilityConfiguration"}constructor(e){super(),this.speechService=e,this._register(T.runAndSubscribe(e.onDidChangeHasSpeechProvider,()=>this.updateConfiguration()))}updateConfiguration(){if(!this.speechService.hasSpeechProvider)return;const e=this.getLanguages(),t=Object.keys(e).sort((n,o)=>e[n].name.localeCompare(e[o].name));Ke.as(Js.Configuration).registerConfiguration({...Hde,properties:{[bu.SpeechTimeout]:{markdownDescription:h(4167,"The duration in milliseconds that voice speech recognition remains active after you stop speaking. For example in a chat session, the transcribed text is submitted automatically after the timeout is met. Set to `0` to disable this feature."),type:"number",default:ELe,minimum:0,tags:["accessibility"]},[bu.IgnoreCodeBlocks]:{markdownDescription:h(4168,"Whether to ignore code snippets in text-to-speech synthesis."),type:"boolean",default:!1,tags:["accessibility"]},[bu.SpeechLanguage]:{markdownDescription:h(4169,"The language that text-to-speech and speech-to-text should use. Select `auto` to use the configured display language if possible. Note that not all display languages maybe supported by speech recognition and synthesizers."),type:"string",enum:t,default:"auto",tags:["accessibility"],enumDescriptions:t.map(n=>e[n].name),enumItemLabels:t.map(n=>e[n].name)},[bu.AutoSynthesize]:{type:"string",enum:["on","off"],enumDescriptions:[h(4170,"Enable the feature. When a screen reader is enabled, note that this will disable aria updates."),h(4171,"Disable the feature.")],markdownDescription:h(4172,"Whether a textual response should automatically be read out aloud when speech was used as input. For example in a chat session, a response is automatically synthesized when voice was used as chat request."),default:"off",tags:["accessibility"]}}})}getLanguages(){return{auto:{name:h(4173,"Auto (Use Display Language)")},...CLe}}};KX=f([p(0,NN)],KX);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"audioCues.volume",migrateFn:(s,e)=>[["accessibility.signalOptions.volume",{value:s}],["audioCues.volume",{value:void 0}]]}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"audioCues.debouncePositionChanges",migrateFn:s=>[["accessibility.signalOptions.debouncePositionChanges",{value:s}],["audioCues.debouncePositionChanges",{value:void 0}]]}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signalOptions",migrateFn:(s,e)=>{const t=A1(e,"general"),i=A1(e,"errorAtPosition"),n=A1(e,"warningAtPosition"),o=xLe(e),r=ILe(e),a=[];return o&&a.push(["accessibility.signalOptions.volume",{value:o}]),t&&a.push(["accessibility.signalOptions.experimental.delays.general",{value:t}]),i&&a.push(["accessibility.signalOptions.experimental.delays.errorAtPosition",{value:i}]),n&&a.push(["accessibility.signalOptions.experimental.delays.warningAtPosition",{value:n}]),r&&a.push(["accessibility.signalOptions.debouncePositionChanges",{value:r}]),a.push(["accessibility.signalOptions",{value:void 0}]),a}}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signals.sounds.volume",migrateFn:s=>[["accessibility.signalOptions.volume",{value:s}],["accessibility.signals.sounds.volume",{value:void 0}]]}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signals.debouncePositionChanges",migrateFn:s=>[["accessibility.signalOptions.debouncePositionChanges",{value:s}],["accessibility.signals.debouncePositionChanges",{value:void 0}]]}]);function A1(s,e){return s(`accessibility.signalOptions.experimental.delays.${e}`)||s("accessibility.signalOptions")?.["experimental.delays"]?.[`${e}`]||s("accessibility.signalOptions")?.delays?.[`${e}`]}function xLe(s){return s("accessibility.signalOptions.volume")||s("accessibility.signalOptions")?.volume||s("accessibility.signals.sounds.volume")||s("audioCues.volume")}function ILe(s){return s("accessibility.signalOptions.debouncePositionChanges")||s("accessibility.signalOptions")?.debouncePositionChanges||s("accessibility.signals.debouncePositionChanges")||s("audioCues.debouncePositionChanges")}Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:bu.AutoSynthesize,migrateFn:s=>{let e;if(s===!0)e="on";else if(s===!1)e="off";else return[];return[[bu.AutoSynthesize,{value:e}]]}}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"accessibility.signals.chatResponsePending",migrateFn:(s,e)=>[["accessibility.signals.progress",{value:s}],["accessibility.signals.chatResponsePending",{value:void 0}]]}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations(Vp.allAccessibilitySignals.map(s=>s.legacySoundSettingsKey?{key:s.legacySoundSettingsKey,migrateFn:(e,t)=>{const i=[],n=s.legacyAnnouncementSettingsKey;let o;return n&&(o=t(n)??void 0,o!==void 0&&typeof o!="string"&&(o=o?"auto":"off")),i.push([`${s.legacySoundSettingsKey}`,{value:void 0}]),i.push([`${s.settingsKey}`,{value:o!==void 0?{announcement:o,sound:e}:{sound:e}}]),i}}:void 0).filter(wa));Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations(Vp.allAccessibilitySignals.filter(s=>!!s.legacyAnnouncementSettingsKey&&!!s.legacySoundSettingsKey).map(s=>({key:s.legacyAnnouncementSettingsKey,migrateFn:(e,t)=>{const i=[],n=t(s.settingsKey)?.sound||t(s.legacySoundSettingsKey);return e!==void 0&&typeof e!="string"&&(e=e?"auto":"off"),i.push([`${s.settingsKey}`,{value:e!==void 0?{announcement:e,sound:n}:{sound:n}}]),i.push([`${s.legacyAnnouncementSettingsKey}`,{value:void 0}]),i.push([`${s.legacySoundSettingsKey}`,{value:void 0}]),i}})));var Bo;(function(s){s.OpenAccessibleView="editor.action.accessibleView",s.OpenAccessibilityHelp="editor.action.accessibilityHelp",s.DisableVerbosityHint="editor.action.accessibleViewDisableHint",s.GoToSymbol="editor.action.accessibleViewGoToSymbol",s.ShowNext="editor.action.accessibleViewNext",s.ShowPrevious="editor.action.accessibleViewPrevious",s.AccessibleViewAcceptInlineCompletion="editor.action.accessibleViewAcceptInlineCompletion",s.NextCodeBlock="editor.action.accessibleViewNextCodeBlock",s.PreviousCodeBlock="editor.action.accessibleViewPreviousCodeBlock",s.AccessibilityHelpConfigureKeybindings="editor.action.accessibilityHelpConfigureKeybindings",s.AccessibilityHelpConfigureAssignedKeybindings="editor.action.accessibilityHelpConfigureAssignedKeybindings",s.AccessibilityHelpOpenHelpLink="editor.action.accessibilityHelpOpenHelpLink"})(Bo||(Bo={}));var LH;let jp=class{static{LH=this}static{this.ID="editor.contrib.contextmenu"}static get(e){return e.getContribution(LH.ID)}constructor(e,t,i,n,o,r,a,c){this._contextMenuService=t,this._contextViewService=i,this._contextKeyService=n,this._keybindingService=o,this._menuService=r,this._configurationService=a,this._workspaceContextService=c,this._toDispose=new U,this._contextMenuIsBeingShownCount=0,this._editor=e,this._toDispose.add(this._editor.onContextMenu(d=>this._onContextMenu(d))),this._toDispose.add(this._editor.onMouseWheel(d=>{if(this._contextMenuIsBeingShownCount>0){const l=this._contextViewService.getContextViewElement(),u=d.srcElement;u.shadowRoot&&Bve(l)===u.shadowRoot||this._contextViewService.hideContextView()}})),this._toDispose.add(this._editor.onKeyDown(d=>{this._editor.getOption(L.contextmenu)&&d.keyCode===S.ContextMenu&&(d.preventDefault(),d.stopPropagation(),this.showContextMenu())}))}_onContextMenu(e){if(!this._editor.hasModel())return;if(!this._editor.getOption(L.contextmenu)){this._editor.focus(),e.target.position&&!this._editor.getSelection().containsPosition(e.target.position)&&this._editor.setPosition(e.target.position);return}if(e.target.type===xi.OVERLAY_WIDGET||e.target.type===xi.CONTENT_TEXT&&e.target.detail.injectedText)return;if(e.event.preventDefault(),e.event.stopPropagation(),e.target.type===xi.SCROLLBAR)return this._showScrollbarContextMenu(e.event);if(e.target.type!==xi.CONTENT_TEXT&&e.target.type!==xi.CONTENT_EMPTY&&e.target.type!==xi.TEXTAREA)return;if(this._editor.focus(),e.target.position){let i=!1;for(const n of this._editor.getSelections())if(n.containsPosition(e.target.position)){i=!0;break}i||this._editor.setPosition(e.target.position)}let t=null;e.target.type!==xi.TEXTAREA&&(t=e.event),this.showContextMenu(t)}showContextMenu(e){if(!this._editor.getOption(L.contextmenu)||!this._editor.hasModel())return;const t=this._getMenuActions(this._editor.getModel(),this._editor.contextMenuId);t.length>0&&this._doShowContextMenu(t,e)}_getMenuActions(e,t){const i=[],n=this._menuService.getMenuActions(t,this._contextKeyService,{arg:e.uri});for(const o of n){const[,r]=o;let a=0;for(const c of r)if(c instanceof xh){const d=this._getMenuActions(e,c.item.submenu);d.length>0&&(i.push(new Eh(c.id,c.label,d)),a++)}else i.push(c),a++;a&&i.push(new os)}return i.length&&i.pop(),i}_doShowContextMenu(e,t=null){if(!this._editor.hasModel())return;const i=this._editor.getOption(L.hover);this._editor.updateOptions({hover:{enabled:!1}});let n=t;if(!n){this._editor.revealPosition(this._editor.getPosition(),Qi.Immediate),this._editor.render();const r=this._editor.getScrolledVisiblePosition(this._editor.getPosition()),a=Bs(this._editor.getDomNode()),c=a.left+r.left,d=a.top+r.top+r.height;n={x:c,y:d}}const o=this._editor.getOption(L.useShadowDOM)&&!kE;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:o?this._editor.getOverflowWidgetsDomNode()??this._editor.getDomNode():void 0,getAnchor:()=>n,getActions:()=>e,getActionViewItem:r=>{const a=this._keybindingFor(r);if(a)return new Qm(r,r,{label:!0,keybinding:a.getLabel(),isMenu:!0});const c=r;return typeof c.getActionViewItem=="function"?c.getActionViewItem():new Qm(r,r,{icon:!0,label:!0,isMenu:!0})},getKeyBinding:r=>this._keybindingFor(r),onHide:r=>{this._contextMenuIsBeingShownCount--,this._editor.updateOptions({hover:i})}})}_showScrollbarContextMenu(e){if(!this._editor.hasModel()||Vve(this._workspaceContextService.getWorkspace()))return;const t=this._editor.getOption(L.minimap);let i=0;const n=d=>({id:`menu-action-${++i}`,label:d.label,tooltip:"",class:void 0,enabled:typeof d.enabled>"u"?!0:d.enabled,checked:d.checked,run:d.run}),o=(d,l)=>new Eh(`menu-action-${++i}`,d,l,void 0),r=(d,l,u,g,m)=>{if(!l)return n({label:d,enabled:l,run:()=>{}});const v=w=>()=>{this._configurationService.updateValue(u,w)},_=[];for(const w of m)_.push(n({label:w.label,checked:g===w.value,run:v(w.value)}));return o(d,_)},a=[];a.push(n({label:h(964,"Minimap"),checked:t.enabled,run:()=>{this._configurationService.updateValue("editor.minimap.enabled",!t.enabled)}})),a.push(new os),a.push(n({label:h(965,"Render Characters"),enabled:t.enabled,checked:t.renderCharacters,run:()=>{this._configurationService.updateValue("editor.minimap.renderCharacters",!t.renderCharacters)}})),a.push(r(h(966,"Vertical size"),t.enabled,"editor.minimap.size",t.size,[{label:h(967,"Proportional"),value:"proportional"},{label:h(968,"Fill"),value:"fill"},{label:h(969,"Fit"),value:"fit"}])),a.push(r(h(970,"Slider"),t.enabled,"editor.minimap.showSlider",t.showSlider,[{label:h(971,"Mouse Over"),value:"mouseover"},{label:h(972,"Always"),value:"always"}]));const c=this._editor.getOption(L.useShadowDOM)&&!kE;this._contextMenuIsBeingShownCount++,this._contextMenuService.showContextMenu({domForShadowRoot:c?this._editor.getDomNode():void 0,getAnchor:()=>e,getActions:()=>a,onHide:d=>{this._contextMenuIsBeingShownCount--,this._editor.focus()}})}_keybindingFor(e){return this._keybindingService.lookupKeybinding(e.id)}dispose(){this._contextMenuIsBeingShownCount>0&&this._contextViewService.hideContextView(),this._toDispose.dispose()}};jp=LH=f([p(1,bi),p(2,rf),p(3,fe),p(4,He),p(5,fn),p(6,ne),p(7,It)],jp);class DLe extends Se{constructor(){super({id:"editor.action.showContextMenu",label:I(973,"Show Editor Context Menu"),precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:E.Shift|S.F10,weight:W.EditorContrib}})}run(e,t){jp.get(t)?.showContextMenu()}}Lt(jp.ID,jp,_t.BeforeFirstInteraction);ue(DLe);class bx extends F{static{this.ID="editor.contrib.menuPreventer"}constructor(e){super(),this._editor=e,this._altListeningMouse=!1,this._altMouseTriggered=!1,this._register(this._editor.onMouseDown(t=>{this._altListeningMouse&&(this._altMouseTriggered=!0)})),this._register(this._editor.onKeyDown(t=>{t.equals(E.Alt)&&(this._altListeningMouse||(this._altMouseTriggered=!1),this._altListeningMouse=!0)})),this._register(this._editor.onKeyUp(t=>{t.equals(E.Alt)&&(this._altMouseTriggered&&t.preventDefault(),this._altListeningMouse=!1,this._altMouseTriggered=!1)}))}}Lt(bx.ID,bx,_t.BeforeFirstInteraction);const Ude="editor.contrib.selectionClipboard";class kLe{constructor(e){this.isBogous=!1,this.isTrivial=!1,this.usesClipboardVariable=!1,this.usesSelectionVariable=!1,this.codeSnippet=e;const t=new fd().parse(e,!1),i=new Map;let n=0;for(const r of t.placeholders)n=Math.max(n,r.index);if(t.placeholders.length===0)this.isTrivial=!0;else if(n===0){const r=t.children.at(-1);this.isTrivial=r instanceof Zr&&r.isFinalTabstop}const o=[...t.children];for(;o.length>0;){const r=o.shift();if(r instanceof $y){if(r.children.length===0&&!iLe[r.name]){const a=i.has(r.name)?i.get(r.name):++n;i.set(r.name,a);const c=new Zr(a).appendChild(new vr(r.name));t.replace(r,[c]),this.isBogous=!0}switch(r.name){case"CLIPBOARD":this.usesClipboardVariable=!0;break;case"SELECTION":case"TM_SELECTED_TEXT":this.usesSelectionVariable=!0;break}}else o.push(...r.children)}this.isBogous&&(this.codeSnippet=t.toTextmateString())}}class $de{constructor(e,t,i,n,o,r,a,c,d,l){this.isFileTemplate=e,this.scopes=t,this.name=i,this.prefix=n,this.description=o,this.body=r,this.source=a,this.snippetSource=c,this.snippetIdentifier=d,this.extensionId=l,this.prefixLow=n.toLowerCase(),this._bodyInsights=new Ak(Fp(),()=>new kLe(this.body))}get codeSnippet(){return this._bodyInsights.value.codeSnippet}get isBogous(){return this._bodyInsights.value.isBogous}get isTrivial(){return this._bodyInsights.value.isTrivial}get needsClipboard(){return this._bodyInsights.value.usesClipboardVariable}get usesSelection(){return this._bodyInsights.value.usesSelectionVariable}}function TLe(s){return ra(s)&&!!s.body}var Zl;(function(s){s[s.User=1]="User",s[s.Workspace=2]="Workspace",s[s.Extension=3]="Extension"})(Zl||(Zl={}));class R1{constructor(e,t,i,n,o,r){this.source=e,this.location=t,this.defaultScopes=i,this._extension=n,this._fileService=o,this._extensionResourceLoaderService=r,this.data=[],this.isGlobalSnippets=XM(t.path)===".code-snippets",this.isUserSnippets=!this._extension}select(e,t){this.isGlobalSnippets||!this.isUserSnippets?this._scopeSelect(e,t):this._filepathSelect(e,t)}_filepathSelect(e,t){e+".json"===an(this.location.path)&&t.push(...this.data)}_scopeSelect(e,t){for(const n of this.data){const o=n.scopes.length;if(o===0)t.push(n);else for(let r=0;r<o;r++)if(n.scopes[r]===e){t.push(n);break}}const i=e.lastIndexOf(".");i>=0&&this._scopeSelect(e.substring(0,i),t)}async _load(){return this._extension?this._extensionResourceLoaderService.readExtensionResource(this.location):(await this._fileService.readFile(this.location)).value.toString()}load(){return this._loadPromise||(this._loadPromise=Promise.resolve(this._load()).then(e=>{const t=Rb(e);if(pC(t)==="object")for(const[i,n]of Object.entries(t))if(TLe(n))this._parseSnippet(i,n,this.data);else for(const[o,r]of Object.entries(n))this._parseSnippet(o,r,this.data);return this})),this._loadPromise}reset(){this._loadPromise=void 0,this.data.length=0}_parseSnippet(e,t,i){let{isFileTemplate:n,prefix:o,body:r,description:a}=t;if(o||(o=""),Array.isArray(r)&&(r=r.join(`
`)),typeof r!="string")return;Array.isArray(a)&&(a=a.join(`
`));let c;this.defaultScopes?c=this.defaultScopes:typeof t.scope=="string"?c=t.scope.split(",").map(l=>l.trim()).filter(Boolean):c=[];let d;this._extension?d=this._extension.displayName||this._extension.name:this.source===Zl.Workspace?d=h(9614,"Workspace Snippet"):this.isGlobalSnippets?d=h(9615,"Global User Snippet"):d=h(9616,"User Snippet");for(const l of As.wrap(o))i.push(new $de(!!n,c,e,l,a,r,d,this.source,this._extension?`${Gu(this._extension.extensionLocation,this.location)}/${e}`:`${an(this.location.path)}/${e}`,this._extension?.identifier))}}const cP=gl.registerExtensionPoint({extensionPoint:"languages",jsonSchema:{description:h(12449,"Contributes language declarations."),type:"array",items:{type:"object",defaultSnippets:[{body:{id:"${1:languageId}",aliases:["${2:label}"],extensions:["${3:extension}"],configuration:"./language-configuration.json"}}],properties:{id:{description:h(12450,"ID of the language."),type:"string"},aliases:{description:h(12451,"Name aliases for the language."),type:"array",items:{type:"string"}},extensions:{description:h(12452,"File extensions associated to the language."),default:[".foo"],type:"array",items:{type:"string"}},filenames:{description:h(12453,"File names associated to the language."),type:"array",items:{type:"string"}},filenamePatterns:{description:h(12454,"File name glob patterns associated to the language."),type:"array",items:{type:"string"}},mimetypes:{description:h(12455,"Mime types associated to the language."),type:"array",items:{type:"string"}},firstLine:{description:h(12456,"A regular expression matching the first line of a file of the language."),type:"string"},configuration:{description:h(12457,"A relative path to a file containing configuration options for the language."),type:"string",default:"./language-configuration.json"},icon:{type:"object",description:h(12458,"A icon to use as file icon, if no icon theme provides one for the language."),properties:{light:{description:h(12459,"Icon path when a light theme is used"),type:"string"},dark:{description:h(12460,"Icon path when a dark theme is used"),type:"string"}}}}}},activationEventsGenerator:(s,e)=>{for(const t of s)t.id&&t.configuration&&e.push(`onLanguage:${t.id}`)}});class ALe extends F{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.languages}render(e){const t=e.contributes,i=t?.languages||[],n=[];for(const l of i)Gde(l)&&n.push({id:l.id,name:(l.aliases||[])[0]||l.id,extensions:l.extensions||[],hasGrammar:!1,hasSnippets:!1});const o=Hve(n,l=>l.id);if((t?.grammars||[]).forEach(l=>{if(!Tt(l.language))return;let u=o[l.language];u?u.hasGrammar=!0:(u={id:l.language,name:l.language,extensions:[],hasGrammar:!0,hasSnippets:!1},o[u.id]=u,n.push(u))}),(t?.snippets||[]).forEach(l=>{if(!Tt(l.language))return;let u=o[l.language];u?u.hasSnippets=!0:(u={id:l.language,name:l.language,extensions:[],hasGrammar:!1,hasSnippets:!0},o[u.id]=u,n.push(u))}),!n.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const c=[h(12461,"ID"),h(12462,"Name"),h(12463,"File Extensions"),h(12464,"Grammar"),h(12465,"Snippets")],d=n.sort((l,u)=>l.id.localeCompare(u.id)).map(l=>[l.id,l.name,new Gi().appendMarkdown(`${l.extensions.map(u=>`\`${u}\``).join("&nbsp;")}`),l.hasGrammar?"":"",l.hasSnippets?"":""]);return{data:{headers:c,rows:d},dispose:()=>{}}}}Ke.as(Ew.ExtensionFeaturesRegistry).registerExtensionFeature({id:"languages",label:h(12466,"Programming Languages"),access:{canToggle:!1},renderer:new Sr(ALe)});let jX=class extends Uve{constructor(e,t,i,n){super(i.verbose||i.isExtensionDevelopment||!i.isBuilt),this.logService=n,this._configurationService=t,this._extensionService=e,cP.setHandler(o=>{const r=[];for(let a=0,c=o.length;a<c;a++){const d=o[a];if(!Array.isArray(d.value)){d.collector.error(h(12467,"Invalid `contributes.{0}`. Expected an array.",cP.name));continue}for(let l=0,u=d.value.length;l<u;l++){const g=d.value[l];if(Gde(g,d.collector)){let m;g.configuration&&(m=Ct(d.description.extensionLocation,g.configuration)),r.push({id:g.id,extensions:g.extensions,filenames:g.filenames,filenamePatterns:g.filenamePatterns,firstLine:g.firstLine,aliases:g.aliases,mimetypes:g.mimetypes,configuration:m,icon:g.icon&&{light:Ct(d.description.extensionLocation,g.icon.light),dark:Ct(d.description.extensionLocation,g.icon.dark)}})}}}this._registry.setDynamicLanguages(r)}),this.updateMime(),this._register(this._configurationService.onDidChangeConfiguration(o=>{o.affectsConfiguration(xne)&&this.updateMime()})),this._extensionService.whenInstalledExtensionsRegistered().then(()=>{this.updateMime()}),this._register(this.onDidRequestRichLanguageFeatures(o=>{this._extensionService.activateByEvent(`onLanguage:${o}`),this._extensionService.activateByEvent("onLanguage")}))}updateMime(){const e=this._configurationService.getValue();$ve(),e.files?.associations&&Object.keys(e.files.associations).forEach(t=>{const i=e.files.associations[t];if(typeof i!="string"){this.logService.warn(`Ignoring configured 'files.associations' for '${t}' because its type is not a string but '${typeof i}'`);return}const n=this.getMimeType(i)||`text/x-${i}`;Gve({id:i,mime:n,filepattern:t})}),this._onDidChange.fire()}};jX=f([p(0,cn),p(1,ne),p(2,Hs),p(3,Re)],jX);function ik(s){return typeof s>"u"?!0:Array.isArray(s)?s.every(e=>typeof e=="string"):!1}function Gde(s,e){return s?typeof s.id!="string"?(e?.error(h(12469,"property `{0}` is mandatory and must be of type `string`","id")),!1):ik(s.extensions)?ik(s.filenames)?typeof s.firstLine<"u"&&typeof s.firstLine!="string"?(e?.error(h(12472,"property `{0}` can be omitted and must be of type `string`","firstLine")),!1):typeof s.configuration<"u"&&typeof s.configuration!="string"?(e?.error(h(12473,"property `{0}` can be omitted and must be of type `string`","configuration")),!1):ik(s.aliases)?ik(s.mimetypes)?typeof s.icon<"u"&&(typeof s.icon!="object"||typeof s.icon.light!="string"||typeof s.icon.dark!="string")?(e?.error(h(12476,"property `{0}` can be omitted and must be of type `object` with properties `{1}` and `{2}` of type `string`","icon","light","dark")),!1):!0:(e?.error(h(12475,"property `{0}` can be omitted and must be of type `string[]`","mimetypes")),!1):(e?.error(h(12474,"property `{0}` can be omitted and must be of type `string[]`","aliases")),!1):(e?.error(h(12471,"property `{0}` can be omitted and must be of type `string[]`","filenames")),!1):(e?.error(h(12470,"property `{0}` can be omitted and must be of type `string[]`","extensions")),!1):(e?.error(h(12468,"Empty value for `contributes.{0}`",cP.name)),!1)}const zde="_snippet.markAsUsed";Ee.registerCommand(zde,(s,...e)=>{const t=s.get(MN),[i]=e;i instanceof $de&&t.updateUsageTimestamp(i)});class JS{constructor(e,t){this.snippet=e,this.label={label:e.prefix,description:e.name},this.detail=h(9597,"{0} ({1})",e.description||e.name,e.source),this.insertText=e.codeSnippet,this.extensionId=e.extensionId,this.range=t,this.sortText=`${e.snippetSource===Zl.Extension?"z":"a"}-${e.prefix}`,this.kind=De.Snippet,this.insertTextRules=sh.InsertAsSnippet,this.command={id:zde,title:"",arguments:[e]}}resolve(){return this.documentation=new Gi().appendCodeblock("",fd.asInsertText(this.snippet.codeSnippet)),this}static compareByLabel(e,t){return NT(e.label.label,t.label.label)}}let MH=class{constructor(e,t,i){this._languageService=e,this._snippets=t,this._languageConfigurationService=i,this._debugDisplayName="snippetCompletions"}async provideCompletionItems(e,t,i){const n=new Xn,o=t.lineNumber,r=e.getWordAtPosition(t)??{startColumn:t.column,endColumn:t.column,word:""},a=e.getLineContent(t.lineNumber).toLowerCase(),c=a.substring(0,r.startColumn+r.word.length-1),d=this._computeSnippetPositions(e,o,r,c),l=t.column-1,u=i.triggerCharacter?.toLowerCase()??"",g=this._getLanguageIdAtPosition(e,t),m=this._languageConfigurationService.getLanguageConfiguration(g),v=new Set(await this._snippets.getSnippets(g)),_=[];for(const w of v){if(i.triggerKind===ba.TriggerCharacter&&!w.prefixLow.startsWith(u))continue;let C;for(const oe of d)if(!(oe.prefixLow.match(/^\s/)&&!w.prefixLow.match(/^\s/))&&zve(oe.prefixLow,0,oe.prefixLow.length,w.prefixLow,0,w.prefixLow.length)){C=oe;break}if(!C)continue;const k=C.startColumn-1,D=w.prefixLow.length-(l-k),A=qve(a,w.prefixLow,l,l+D,l-k),B=t.with(void 0,k+1);let q=A===0?t.column+D:t.column;l<a.length&&m.getAutoClosingPairs().autoClosingPairsCloseSingleChar.get(a[l])?.some(me=>me.open===a[B.column-1]&&w.prefix.startsWith(me.open)&&w.prefix[w.prefix.length-1]===me.close)&&q++;const Q=P.fromPositions({lineNumber:o,column:C.startColumn},{lineNumber:o,column:q}),ie=Q.setEndPosition(o,t.column);_.push(new JS(w,{replace:Q,insert:ie})),v.delete(w)}if(!u&&(/\s/.test(a[t.column-2])||!a))for(const w of v){const C=P.fromPositions(t),k=a.indexOf(w.prefixLow,l)===l?C.setEndPosition(t.lineNumber,t.column+w.prefixLow.length):C;_.push(new JS(w,{replace:k,insert:C}))}return this._disambiguateSnippets(_),{suggestions:_,duration:n.elapsed()}}_disambiguateSnippets(e){e.sort(JS.compareByLabel);for(let t=0;t<e.length;t++){const i=e[t];let n=t+1;for(;n<e.length&&i.label===e[n].label;n++)e[n].label.label=h(9598,"{0}, {1}",e[n].label.label,e[n].snippet.name);n>t+1&&(e[t].label.label=h(9598,"{0}, {1}",e[t].label.label,e[t].snippet.name),t=n)}}resolveCompletionItem(e){return e instanceof JS?e.resolve():e}_computeSnippetPositions(e,t,i,n){const o=[];for(let r=1;r<i.startColumn;r++){const a=e.getWordAtPosition(new we(t,r));o.push({startColumn:r,prefixLow:n.substring(r-1),isWord:!!a}),a&&(r=a.endColumn,o.push({startColumn:a.endColumn,prefixLow:n.substring(a.endColumn-1),isWord:!1}))}return(i.word.length>0||o.length===0)&&o.push({startColumn:i.startColumn,prefixLow:n.substring(i.startColumn-1),isWord:!0}),o}_getLanguageIdAtPosition(e,t){e.tokenization.tokenizeIfCheap(t.lineNumber);let i=e.getLanguageIdAtPosition(t.lineNumber,t.column);return this._languageService.getLanguageName(i)||(i=e.getLanguageId()),i}};MH=f([p(0,vi),p(1,MN),p(2,ds)],MH);var Zk,Jk,dP;(function(s){function e(t,i,n){if(pu(i.path))return t.collector.error(h(9617,"Expected string in `contributes.{0}.path`. Provided value: {1}",t.description.name,String(i.path))),null;if(pu(i.language)&&!i.path.endsWith(".code-snippets"))return t.collector.error(h(9618,"When omitting the language, the value of `contributes.{0}.path` must be a `.code-snippets`-file. Provided value: {1}",t.description.name,String(i.path))),null;if(!pu(i.language)&&!n.isRegisteredLanguageId(i.language))return t.collector.error(h(9619,"Unknown language in `contributes.{0}.language`. Provided value: {1}",t.description.name,String(i.language))),null;const o=t.description.extensionLocation,r=Ct(o,i.path);return od(r,o)?{language:i.language,location:r}:(t.collector.error(h(9620,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",t.description.name,r.path,o.path)),null)}s.toValidSnippet=e,s.snippetsContribution={description:h(9621,"Contributes snippets."),type:"array",defaultSnippets:[{body:[{language:"",path:""}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",path:"./snippets/${2:id}.json."}}],properties:{language:{description:h(9622,"Language identifier for which this snippet is contributed to."),type:"string"},path:{description:h(9623,"Path of the snippets file. The path is relative to the extension folder and typically starts with './snippets/'."),type:"string"}}}},s.point=gl.registerExtensionPoint({extensionPoint:"snippets",deps:[cP],jsonSchema:s.snippetsContribution})})(dP||(dP={}));function RLe(s,e,t){return Wo(s.watch(e),s.onDidFilesChange(i=>{i.affects(e)&&t()}))}let NH=class{static{Zk=this}static{this._key="snippets.ignoredSnippets"}constructor(e){this._storageService=e;const t=e.get(Zk._key,he.PROFILE,"");let i;try{i=JSON.parse(t)}catch{}this._ignored=Oie(i)?new Set(i):new Set}isIgnored(e){return this._ignored.has(e)}updateIgnored(e,t){let i=!1;this._ignored.has(e)&&!t?(this._ignored.delete(e),i=!0):!this._ignored.has(e)&&t&&(this._ignored.add(e),i=!0),i&&this._storageService.store(Zk._key,JSON.stringify(Array.from(this._ignored)),he.PROFILE,gt.USER)}};NH=Zk=f([p(0,it)],NH);let OH=class{static{Jk=this}static{this._key="snippets.usageTimestamps"}constructor(e){this._storageService=e;const t=e.get(Jk._key,he.PROFILE,"");let i;try{i=JSON.parse(t)}catch{i=[]}this._usages=Array.isArray(i)?new Map(i):new Map}getUsageTimestamp(e){return this._usages.get(e)}updateUsageTimestamp(e){this._usages.delete(e),this._usages.set(e,Date.now());const t=[...this._usages].slice(-100);this._storageService.store(Jk._key,JSON.stringify(t),he.PROFILE,gt.USER)}};OH=Jk=f([p(0,it)],OH);let YX=class{constructor(e,t,i,n,o,r,a,c,d,l,u){this._environmentService=e,this._userDataProfileService=t,this._contextService=i,this._languageService=n,this._logService=o,this._fileService=r,this._textfileService=a,this._extensionResourceLoaderService=c,this._disposables=new U,this._pendingWork=[],this._files=new In,this._pendingWork.push(Promise.resolve(d.when(mc.Restored).then(()=>{this._initExtensionSnippets(),this._initUserSnippets(),this._initWorkspaceSnippets()}))),QPe(new MH(this._languageService,this,u)),this._enablement=l.createInstance(NH),this._usageTimestamps=l.createInstance(OH)}dispose(){this._disposables.dispose()}isEnabled(e){return!this._enablement.isIgnored(e.snippetIdentifier)}updateEnablement(e,t){this._enablement.updateIgnored(e.snippetIdentifier,!t)}updateUsageTimestamp(e){this._usageTimestamps.updateUsageTimestamp(e.snippetIdentifier)}_joinSnippets(){const e=this._pendingWork.slice(0);return this._pendingWork.length=0,Promise.all(e)}async getSnippetFiles(){return await this._joinSnippets(),this._files.values()}async getSnippets(e,t){await this._joinSnippets();const i=[],n=[];if(e){if(this._languageService.isRegisteredLanguageId(e))for(const o of this._files.values())n.push(o.load().then(r=>r.select(e,i)).catch(r=>this._logService.error(r,o.location.toString())))}else for(const o of this._files.values())n.push(o.load().then(r=>Kve(i,i.length,r.data)).catch(r=>this._logService.error(r,o.location.toString())));return await Promise.all(n),this._filterAndSortSnippets(i,t)}getSnippetsSync(e,t){const i=[];if(this._languageService.isRegisteredLanguageId(e))for(const n of this._files.values())n.load().catch(o=>{}),n.select(e,i);return this._filterAndSortSnippets(i,t)}_filterAndSortSnippets(e,t){const i=[];for(const n of e)!n.prefix&&!t?.includeNoPrefixSnippets||!this.isEnabled(n)&&!t?.includeDisabledSnippets||typeof t?.fileTemplateSnippets=="boolean"&&t.fileTemplateSnippets!==n.isFileTemplate||i.push(n);return i.sort((n,o)=>{let r=0;if(!t?.noRecencySort){const a=this._usageTimestamps.getUsageTimestamp(n.snippetIdentifier)??-1;r=(this._usageTimestamps.getUsageTimestamp(o.snippetIdentifier)??-1)-a}return r===0&&(r=this._compareSnippet(n,o)),r})}_compareSnippet(e,t){return e.snippetSource<t.snippetSource?-1:e.snippetSource>t.snippetSource?1:e.source<t.source?-1:e.source>t.source||e.name>t.name?1:e.name<t.name?-1:0}_initExtensionSnippets(){dP.point.setHandler(e=>{for(const[t,i]of this._files)i.source===Zl.Extension&&this._files.delete(t);for(const t of e)for(const i of t.value){const n=dP.toValidSnippet(t,i,this._languageService);if(!n)continue;const o=this._files.get(n.location);if(o)o.defaultScopes?o.defaultScopes.push(n.language):o.defaultScopes=[];else{const r=new R1(Zl.Extension,n.location,n.language?[n.language]:void 0,t.description,this._fileService,this._extensionResourceLoaderService);this._files.set(r.location,r),this._environmentService.isExtensionDevelopment&&r.load().then(a=>{a.data.some(c=>c.isBogous)&&t.collector.warn(h(9624,"One or more snippets from the extension '{0}' very likely confuse snippet-variables and snippet-placeholders (see https://code.visualstudio.com/docs/editor/userdefinedsnippets#_snippet-syntax for more details)",t.description.name))},a=>{t.collector.warn(h(9625,'The snippet file "{0}" could not be read.',r.location.toString()))})}}})}_initWorkspaceSnippets(){const e=new U,t=()=>{e.clear(),this._pendingWork.push(this._initWorkspaceFolderSnippets(this._contextService.getWorkspace(),e))};this._disposables.add(e),this._disposables.add(this._contextService.onDidChangeWorkspaceFolders(t)),this._disposables.add(this._contextService.onDidChangeWorkbenchState(t)),t()}async _initWorkspaceFolderSnippets(e,t){const i=e.folders.map(async n=>{const o=n.toResource(".vscode");await this._fileService.exists(o)?this._initFolderSnippets(Zl.Workspace,o,t):t.add(this._fileService.onDidFilesChange(a=>{a.contains(o,ph.ADDED)&&this._initFolderSnippets(Zl.Workspace,o,t)}))});await Promise.all(i)}async _initUserSnippets(){const e=new U,t=async()=>{e.clear();const i=this._userDataProfileService.currentProfile.snippetsHome;await this._fileService.createFolder(i),await this._initFolderSnippets(Zl.User,i,e)};this._disposables.add(e),this._disposables.add(this._userDataProfileService.onDidChangeCurrentProfile(i=>i.join((async()=>{this._pendingWork.push(t())})()))),await t()}_initFolderSnippets(e,t,i){const n=new U,o=async()=>{if(n.clear(),!!await this._fileService.exists(t))try{const r=await this._fileService.resolve(t);for(const a of r.children||[])n.add(this._addSnippetFile(a.resource,e))}catch(r){this._logService.error(`Failed snippets from folder '${t.toString()}'`,r)}};return i.add(this._textfileService.files.onDidSave(r=>{od(r.model.resource,t)&&o()})),i.add(RLe(this._fileService,t,o)),i.add(n),o()}_addSnippetFile(e,t){const i=YM(e);if(t===Zl.User&&i===".json"){const n=Qe(e).replace(/\.json/,"");this._files.set(e,new R1(t,e,[n],void 0,this._fileService,this._extensionResourceLoaderService))}else i===".code-snippets"&&this._files.set(e,new R1(t,e,void 0,void 0,this._fileService,this._extensionResourceLoaderService));return{dispose:()=>this._files.delete(e)}}};YX=f([p(0,Hs),p(1,Mh),p(2,It),p(3,vi),p(4,Re),p(5,je),p(6,Ps),p(7,Sq),p(8,wd),p(9,Z),p(10,ds)],YX);function PLe(s,e){const i=s.getLineContent(e.lineNumber).substr(0,e.column-1),n=Math.max(0,i.length-100);for(let o=i.length-1;o>=n;o--){const r=i.charAt(o);if(/\s/.test(r))return i.substr(o+1)}return n===0?i:""}var eT;let ng=class{static{eT=this}static{this.ID="editor.tabCompletionController"}static{this.ContextKey=new O("hasSnippetCompletions",void 0)}static get(e){return e.getContribution(eT.ID)}constructor(e,t,i,n,o){this._editor=e,this._snippetService=t,this._clipboardService=i,this._languageFeaturesService=n,this._activeSnippets=[],this._hasSnippets=eT.ContextKey.bindTo(o),this._configListener=this._editor.onDidChangeConfiguration(r=>{r.hasChanged(L.tabCompletion)&&this._update()}),this._update()}dispose(){this._configListener.dispose(),this._selectionListener?.dispose()}_update(){const e=this._editor.getOption(L.tabCompletion)==="onlySnippets";this._enabled!==e&&(this._enabled=e,this._enabled?(this._selectionListener=this._editor.onDidChangeCursorSelection(t=>this._updateSnippets()),this._editor.getModel()&&this._updateSnippets()):this._selectionListener?.dispose())}_updateSnippets(){if(this._activeSnippets=[],this._completionProvider?.dispose(),!this._editor.hasModel())return;const e=this._editor.getSelection(),t=this._editor.getModel();t.tokenization.tokenizeIfCheap(e.positionLineNumber);const i=t.getLanguageIdAtPosition(e.positionLineNumber,e.positionColumn),n=this._snippetService.getSnippetsSync(i);if(!n){this._hasSnippets.set(!1);return}if(P.isEmpty(e)){const r=PLe(t,e.getPosition());if(r)for(const a of n)r.endsWith(a.prefix)&&this._activeSnippets.push(a)}else if(!P.spansMultipleLines(e)&&t.getValueLengthInRange(e)<=100){const r=t.getValueInRange(e);if(r)for(const a of n)r===a.prefix&&this._activeSnippets.push(a)}const o=this._activeSnippets.length;if(o===0)this._hasSnippets.set(!1);else if(o===1)this._hasSnippets.set(!0);else{this._hasSnippets.set(!0),this._completionProvider={_debugDisplayName:"tabCompletion",dispose:()=>{r.dispose()},provideCompletionItems:(a,c)=>a!==t||!e.containsPosition(c)?void 0:{suggestions:this._activeSnippets.map(l=>{const u=P.fromPositions(c.delta(0,-l.prefix.length),c);return new JS(l,u)})}};const r=this._languageFeaturesService.completionProvider.register({language:t.getLanguageId(),pattern:t.uri.fsPath,scheme:t.uri.scheme},this._completionProvider)}}async performSnippetCompletions(){if(this._editor.hasModel())if(this._activeSnippets.length===1){const[e]=this._activeSnippets;let t;if(e.needsClipboard){const i=new hN(this._editor,fs.Value|fs.Position);if(t=await this._clipboardService.readText(),!i.validate(this._editor))return}cs.get(this._editor)?.insert(e.codeSnippet,{overwriteBefore:e.prefix.length,overwriteAfter:0,clipboardText:t})}else this._activeSnippets.length>1&&this._completionProvider&&Vde(this._editor,this._completionProvider)}};ng=eT=f([p(1,MN),p(2,Vs),p(3,Ne),p(4,fe)],ng);Lt(ng.ID,ng,_t.Eager);const LLe=Vo.bindToContribution(ng.get);ze(new LLe({id:"insertSnippet",precondition:ng.ContextKey,handler:s=>s.performSnippetCompletions(),kbOpts:{weight:W.EditorContrib,kbExpr:x.and(V.editorTextFocus,V.tabDoesNotMoveFocus,cs.InSnippetMode.toNegated()),primary:S.Tab}}));function MLe(s){return{wordWrap:"on",overviewRulerLanes:0,glyphMargin:!1,lineNumbers:"off",folding:!1,selectOnLineNumbers:!1,hideCursorInOverviewRuler:!0,selectionHighlight:!1,scrollbar:{horizontal:"hidden",alwaysConsumeMouseWheel:!1},lineDecorationsWidth:0,overviewRulerBorder:!1,scrollBeyondLastLine:!1,renderLineHighlight:"none",fixedOverflowWidgets:!0,acceptSuggestionOnEnter:"smart",dragAndDrop:!1,revealHorizontalRightPadding:5,minimap:{enabled:!1},guides:{indentation:!1},accessibilitySupport:s.getValue("editor.accessibilitySupport"),cursorBlinking:s.getValue("editor.cursorBlinking"),experimentalEditContextEnabled:s.getValue("editor.experimentalEditContextEnabled"),defaultColorDecorators:"never"}}function NLe(){return{isSimpleWidget:!0,contributions:TE.getSomeEditorContributions([bx.ID,Ude,jp.ID,ia.ID,cs.ID,ng.ID])}}function OLe(s){return Fv((e,t)=>{const i=e.getColor(jve);if(i){const n=e.getColor(NF);n&&(t.addRule(`${s} .monaco-editor-background { background-color: ${n}; } `),t.addRule(`${s} .monaco-editor .selected-text { background-color: ${n.transparent(.4)}; }`));const o=e.getColor(Ine);o&&t.addRule(`${s} .monaco-editor .view-line span.inline-selected-text { color: ${o}; }`),t.addRule(`${s} .monaco-editor .focused .selected-text { background-color: ${i}; }`)}else t.addRule(`${s} .monaco-editor .focused .selected-text { background-color: ${e.getColor(Dne)}; }`)})}const qde="copilot",FLe=40;let QX=class{constructor(e){this._onDidClearHistory=new M,this.onDidClearHistory=this._onDidClearHistory.event,this.memento=new bw("interactive-session",e);const t=this.memento.getMemento(he.WORKSPACE,gt.MACHINE);for(const i in t.history)t.history[i]=t.history[i].map(n=>typeof n=="string"?{text:n}:n);this.viewState=t}getHistory(e){const t=this.getKey(e);return this.viewState.history?.[t]??[]}getKey(e){return e===$i.Panel?qde:e}saveHistory(e,t){this.viewState.history||(this.viewState.history={});const i=this.getKey(e);this.viewState.history[i]=t.slice(-40),this.memento.saveMemento()}clearHistory(){this.viewState.history={},this.memento.saveMemento(),this._onDidClearHistory.fire()}};QX=f([p(0,it)],QX);var _d;(function(s){s[s.Modified=0]="Modified",s[s.Accepted=1]="Accepted",s[s.Rejected=2]="Rejected"})(_d||(_d={}));var XX;(function(s){s[s.Initial=0]="Initial",s[s.StreamingEdits=1]="StreamingEdits",s[s.Idle=2]="Idle",s[s.Disposed=3]="Disposed"})(XX||(XX={}));const Kde="chat-editing-multi-diff-source",LO=new O("chatEditingWidgetFileState",void 0,h(5037,"The current state of the file in the chat editing widget"));new O("chatEditingAgentSupportsReadonlyReferences",void 0,h(5038,"Whether the chat editing agent supports readonly references (temporary)"));const jde=new O("decidedChatEditingResource",[]),Yde=new O("chatEditingResource",void 0);new O("inChatEditingSession",void 0);const _h=new O("hasUndecidedChatEditingResource",!1),s4=new O("hasAppliedChatEdits",!1),MO=new O("applyingChatEditsFailed",!1);var ZX;(function(s){s[s.Created=0]="Created",s[s.Modified=1]="Modified"})(ZX||(ZX={}));async function WLe(s){return(await s.openView(BLe))?.widget}const BLe=`workbench.panel.chat.view.${qde}`;function VLe(s){const e=[];for(const t of s){const i=e[e.length-1];if(t.kind==="markdownContent")i?.kind==="markdownContent"?e[e.length-1]={content:new Gi(i.content.value+t.content.value,{isTrusted:i.content.isTrusted}),kind:"markdownContent"}:e.push(t);else if(t.kind==="markdownVuln"){const o=`<vscode_annotation details='${encodeURIComponent(JSON.stringify(t.vulnerabilities))}'>${t.content.value}</vscode_annotation>`;i?.kind==="markdownContent"?e[e.length-1]={content:new Gi(i.content.value+o,{isTrusted:i.content.isTrusted}),kind:"markdownContent"}:e.push({content:new Gi(o),kind:"markdownContent"})}}return e}const sr=String.raw,HLe=sr`(?<!\\)`+sr`(!?\[`+sr`(?:`+sr`[^\[\]\\]|`+sr`\\.|`+sr`\[[^\[\]]*\]`+sr`)*`+sr`\])`+sr`(\(\s*)`+sr`(`+sr`[^\s\(\)<](?:[^\s\(\)]|\([^\s\(\)]*?\))*|`+sr`<(?:\\[<>]|[^<>])+>`+sr`)`+sr`\s*(?:"[^"]*"|'[^']*'|\([^\(\)]*\))?\s*`+sr`\)`;function ULe(s,e){const t=Array.from(s.matchAll(new RegExp(HLe+sr`|\p{sc=Han}|=+|\++|-+|[^\s\|\p{sc=Han}|=|\+|\-]+`,"gu"))),i=t.slice(0,e),n=e>=t.length?s.length:i.length?i.at(-1).index+i.at(-1)[0].length:0,o=s.substring(0,n);return{value:o,returnedWordCount:i.length===0?o.length?1:0:i.length,isFullString:n>=s.length,totalWordCount:t.length}}function $Le(s){return ULe(s,Number.MAX_SAFE_INTEGER).returnedWordCount}function lP(s){return!!s&&typeof s=="object"&&"message"in s}function FH(s){return!!s&&typeof s.setVote<"u"}let JX=class extends F{get inputPlaceholder(){return this._inputPlaceholder}get model(){return this._model}setInputPlaceholder(e){this._inputPlaceholder=e,this._onDidChange.fire({kind:"changePlaceholder"})}resetInputPlaceholder(){this._inputPlaceholder=void 0,this._onDidChange.fire({kind:"changePlaceholder"})}get sessionId(){return this._model.sessionId}get requestInProgress(){return this._model.requestInProgress}get requestPausibility(){return this._model.requestPausibility}get initState(){return this._model.initState}constructor(e,t,i){super(),this._model=e,this.codeBlockModelCollection=t,this.instantiationService=i,this._onDidDisposeModel=this._register(new M),this.onDidDisposeModel=this._onDidDisposeModel.event,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._items=[],this._inputPlaceholder=void 0,e.getRequests().forEach((n,o)=>{const r=this.instantiationService.createInstance(eZ,n);this._items.push(r),this.updateCodeBlockTextModels(r),n.response&&this.onAddResponse(n.response)}),this._register(e.onDidDispose(()=>this._onDidDisposeModel.fire())),this._register(e.onDidChange(n=>{if(n.kind==="addRequest"){const r=this.instantiationService.createInstance(eZ,n.request);this._items.push(r),this.updateCodeBlockTextModels(r),n.request.response&&this.onAddResponse(n.request.response)}else if(n.kind==="addResponse")this.onAddResponse(n.response);else if(n.kind==="removeRequest"){const r=this._items.findIndex(c=>lP(c)&&c.id===n.requestId);r>=0&&this._items.splice(r,1);const a=n.responseId&&this._items.findIndex(c=>FH(c)&&c.id===n.responseId);if(typeof a=="number"&&a>=0){const d=this._items.splice(a,1)[0];d instanceof GC&&d.dispose()}}const o=n.kind==="addRequest"?{kind:"addRequest"}:n.kind==="initialize"?{kind:"initialize"}:n.kind==="setHidden"?{kind:"setHidden"}:null;this._onDidChange.fire(o)}))}onAddResponse(e){const t=this.instantiationService.createInstance(GC,e,this);this._register(t.onDidChange(()=>(t.isComplete&&this.updateCodeBlockTextModels(t),this._onDidChange.fire(null)))),this._items.push(t),this.updateCodeBlockTextModels(t)}getItems(){return this._items.filter(e=>!e.shouldBeRemovedOnSend||e.shouldBeRemovedOnSend.afterUndoStop)}dispose(){super.dispose(),Xe(this._items.filter(e=>e instanceof GC))}updateCodeBlockTextModels(e){let t;lP(e)?t=e.messageText:t=VLe(e.response.value).map(n=>n.content.value).join("");let i=0;Yve(Qve(t),n=>{if(n.type==="code"){const o=n.lang||"",r=n.text;this.codeBlockModelCollection.update(this._model.sessionId,e,i++,{text:r,languageId:o,isComplete:!0})}})}};JX=f([p(2,Z)],JX);class eZ{get id(){return this._model.id}get dataId(){return this.id+`_${ma[this._model.session.initState]}_${lc(this.variables)}_${lc(this.isComplete)}`}get sessionId(){return this._model.session.sessionId}get username(){return this._model.username}get avatarIcon(){return this._model.avatarIconUri}get message(){return this._model.message}get messageText(){return this.message.text}get attempt(){return this._model.attempt}get variables(){return this._model.variableData.variables}get contentReferences(){return this._model.response?.contentReferences}get confirmation(){return this._model.confirmation}get isComplete(){return this._model.response?.isComplete??!1}get isCompleteAddedRequest(){return this._model.isCompleteAddedRequest}get shouldBeRemovedOnSend(){return this._model.shouldBeRemovedOnSend}get slashCommand(){return this._model.response?.slashCommand}get agentOrSlashCommandDetected(){return this._model.response?.agentOrSlashCommandDetected??!1}constructor(e){this._model=e}}let GC=class extends F{get model(){return this._model}get id(){return this._model.id}get dataId(){return this._model.id+`_${this._modelChangeCount}_${ma[this._model.session.initState]}`+(this.isLast?"_last":"")}get sessionId(){return this._model.session.sessionId}get username(){return this.agent?this.chatAgentNameService.getAgentNameRestriction(this.agent)?this.agent.fullName||this.agent.name:pce(this.agent):this._model.username}get avatarIcon(){return this._model.avatarIcon}get agent(){return this._model.agent}get slashCommand(){return this._model.slashCommand}get agentOrSlashCommandDetected(){return this._model.agentOrSlashCommandDetected}get response(){return this._model.response}get usedContext(){return this._model.usedContext}get contentReferences(){return this._model.contentReferences}get codeCitations(){return this._model.codeCitations}get progressMessages(){return this._model.progressMessages}get isComplete(){return this._model.isComplete}get isCanceled(){return this._model.isCanceled}get shouldBeRemovedOnSend(){return this._model.shouldBeRemovedOnSend}get isCompleteAddedRequest(){return this._model.isCompleteAddedRequest}get replyFollowups(){return this._model.followups?.filter(e=>e.kind==="reply")}get result(){return this._model.result}get errorDetails(){return this.result?.errorDetails}get vote(){return this._model.vote}get voteDownReason(){return this._model.voteDownReason}get requestId(){return this._model.requestId}get isStale(){return this._model.isStale}get isLast(){return this._chatViewModel.getItems().at(-1)===this}get usedReferencesExpanded(){if(typeof this._usedReferencesExpanded=="boolean")return this._usedReferencesExpanded}set usedReferencesExpanded(e){this._usedReferencesExpanded=e}get vulnerabilitiesListExpanded(){return this._vulnerabilitiesListExpanded}set vulnerabilitiesListExpanded(e){this._vulnerabilitiesListExpanded=e}get contentUpdateTimings(){return this._contentUpdateTimings}get isPaused(){return this._model.isPaused}constructor(e,t,i,n){super(),this._model=e,this._chatViewModel=t,this.logService=i,this.chatAgentNameService=n,this._modelChangeCount=0,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.renderData=void 0,this._vulnerabilitiesListExpanded=!1,this._contentUpdateTimings=void 0,e.isComplete||(this._contentUpdateTimings={totalTime:0,lastUpdateTime:Date.now(),impliedWordLoadRate:0,lastWordCount:0}),this._register(e.onDidChange(()=>{if(this._contentUpdateTimings){const o=Date.now(),r=$Le(e.entireResponse.getMarkdown());if(r===this._contentUpdateTimings.lastWordCount)this.trace("onDidChange","Update- no new words");else{this._contentUpdateTimings.lastWordCount===0&&(this._contentUpdateTimings.lastUpdateTime=o);const a=Math.min(o-this._contentUpdateTimings.lastUpdateTime,1e3),c=Math.max(this._contentUpdateTimings.totalTime+a,250),d=r/(c/1e3);this.trace("onDidChange",`Update- got ${r} words over last ${c}ms = ${d} words/s`),this._contentUpdateTimings={totalTime:this._contentUpdateTimings.totalTime!==0||this.response.value.some(l=>l.kind==="markdownContent")?c:this._contentUpdateTimings.totalTime,lastUpdateTime:o,impliedWordLoadRate:d,lastWordCount:r}}}this._modelChangeCount++,this._onDidChange.fire()}))}trace(e,t){this.logService.trace(`ChatResponseViewModel#${e}: ${t}`)}setVote(e){this._modelChangeCount++,this._model.setVote(e)}setVoteDownReason(e){this._modelChangeCount++,this._model.setVoteDownReason(e)}setEditApplied(e,t){this._modelChangeCount++,this._model.setEditApplied(e,t)}};GC=f([p(2,Re),p(3,mre)],GC);const hP="workbench.actions.manage",uP="workbench.actions.accounts";class NO extends X{constructor(e,t,i,n,o){super({id:`toggle.${e}`,title:t,metadata:i?{description:i}:void 0,toggled:x.equals(`config.${e}`,!0),menu:[{id:N.TitleBarContext,when:o,order:n,group:"2_config"},{id:N.TitleBarTitleContext,when:o,order:n,group:"2_config"}]}),this.section=e}run(e,...t){const i=e.get(ne),n=i.getValue(this.section);i.updateValue(this.section,!n)}}Y(class extends NO{constructor(){super(oi.COMMAND_CENTER,h(3485,"Command Center"),h(3486,"Toggle visibility of the Command Center in title bar"),1,dq.toNegated())}});Y(class extends NO{constructor(){super("workbench.navigationControl.enabled",h(3487,"Navigation Controls"),h(3488,"Toggle visibility of the Navigation Controls in title bar"),2,x.and(dq.toNegated(),x.has("config.window.commandCenter")))}});Y(class extends NO{constructor(){super(oi.LAYOUT_ACTIONS,h(3489,"Layout Controls"),h(3490,"Toggle visibility of the Layout Controls in title bar"),4)}});Y(class extends X{constructor(){super({id:`toggle.${Ya.CUSTOM_TITLE_BAR_VISIBILITY}`,title:h(3491,"Hide Custom Title Bar"),menu:[{id:N.TitleBarContext,order:0,when:x.equals(lA.key,QT.NATIVE),group:"3_toggle"},{id:N.TitleBarTitleContext,order:0,when:x.equals(lA.key,QT.NATIVE),group:"3_toggle"}]})}run(e,...t){e.get(ne).updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.NEVER)}});Y(class extends X{constructor(){super({id:`toggle.${Ya.CUSTOM_TITLE_BAR_VISIBILITY}.windowed`,title:h(3492,"Hide Custom Title Bar In Full Screen"),menu:[{id:N.TitleBarContext,order:1,when:Hp,group:"3_toggle"},{id:N.TitleBarTitleContext,order:1,when:Hp,group:"3_toggle"}]})}run(e,...t){e.get(ne).updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.WINDOWED)}});class GLe extends X{constructor(){super({id:"toggle.toggleCustomTitleBar",title:h(3493,"Custom Title Bar"),toggled:_N,menu:[{id:N.MenubarAppearanceMenu,order:6,when:x.or(x.and(x.equals(lA.key,QT.NATIVE),x.and(x.equals("config.workbench.layoutControl.enabled",!1),x.equals("config.window.commandCenter",!1),x.notEquals("config.workbench.editor.editorActionsLocation","titleBar"),x.notEquals("config.workbench.activityBar.location","top"),x.notEquals("config.workbench.activityBar.location","bottom"))?.negate()),Hp),group:"2_workbench_layout"}]})}run(e,...t){const i=e.get(ne),n=e.get(fe);switch(i.getValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY)){case Bc.NEVER:i.updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.AUTO);break;case Bc.WINDOWED:{Hp.evaluate(n.getContext(null))?i.updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.AUTO):i.updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.NEVER);break}case Bc.AUTO:default:i.updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.NEVER);break}}}Y(GLe);Y(class extends X{constructor(){super({id:"showCustomTitleBar",title:I(3494,"Show Custom Title Bar"),precondition:_N.negate(),f1:!0})}run(e,...t){e.get(ne).updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.AUTO)}});Y(class extends X{constructor(){super({id:"hideCustomTitleBar",title:I(3495,"Hide Custom Title Bar"),precondition:_N,f1:!0})}run(e,...t){e.get(ne).updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.NEVER)}});Y(class extends X{constructor(){super({id:"hideCustomTitleBarInFullScreen",title:I(3496,"Hide Custom Title Bar In Full Screen"),precondition:x.and(_N,Hp),f1:!0})}run(e,...t){e.get(ne).updateValue(Ya.CUSTOM_TITLE_BAR_VISIBILITY,Bc.WINDOWED)}});Y(class Pd extends X{static{this.settingsID="workbench.editor.editorActionsLocation"}constructor(){const e=x.and(x.equals("config.workbench.editor.showTabs","none").negate(),x.equals(`config.${Pd.settingsID}`,"default"))?.negate();super({id:`toggle.${Pd.settingsID}`,title:h(3497,"Editor Actions"),toggled:x.equals(`config.${Pd.settingsID}`,"hidden").negate(),menu:[{id:N.TitleBarContext,order:3,when:e,group:"2_config"},{id:N.TitleBarTitleContext,order:3,when:e,group:"2_config"}]})}run(e,...t){const i=e.get(ne),n=e.get(it),o=i.getValue(Pd.settingsID);if(o==="hidden"){if(i.getValue(oi.EDITOR_TABS_MODE)!=="none")i.updateValue(Pd.settingsID,"titleBar");else{const a=n.get(Pd.settingsID,he.PROFILE);i.updateValue(Pd.settingsID,a??"default")}n.remove(Pd.settingsID,he.PROFILE)}else i.updateValue(Pd.settingsID,"hidden"),n.store(Pd.settingsID,o,he.PROFILE,gt.USER)}});const aje={id:uP,label:h(3498,"Accounts"),tooltip:h(3498,"Accounts"),class:void 0,enabled:!0,run:function(){}},cje={id:hP,label:h(3499,"Manage"),tooltip:h(3499,"Manage"),class:void 0,enabled:!0,run:function(){}};var Wg,tT,ii;(function(s){s[s.Unknown=1]="Unknown",s[s.Unresolved=2]="Unresolved",s[s.Available=3]="Available",s[s.Unavailable=4]="Unavailable",s[s.Limited=5]="Limited",s[s.Pro=6]="Pro",s[s.ProPlus=7]="ProPlus",s[s.Business=8]="Business",s[s.Enterprise=9]="Enterprise"})(ii||(ii={}));var $b;(function(s){s[s.Standard=1]="Standard",s[s.Disabled=2]="Disabled",s[s.Installed=3]="Installed"})($b||($b={}));function zLe(s){return s===ii.Pro||s===ii.ProPlus||s===ii.Business||s===ii.Enterprise}const ko={extensionId:zo.defaultChatAgent?.extensionId??"",chatExtensionId:zo.defaultChatAgent?.chatExtensionId??"",upgradePlanUrl:zo.defaultChatAgent?.upgradePlanUrl??"",providerId:zo.defaultChatAgent?.providerId??"",enterpriseProviderId:zo.defaultChatAgent?.enterpriseProviderId??"",providerScopes:zo.defaultChatAgent?.providerScopes??[[]],entitlementUrl:zo.defaultChatAgent?.entitlementUrl??"",entitlementSignupLimitedUrl:zo.defaultChatAgent?.entitlementSignupLimitedUrl??"",completionsAdvancedSetting:zo.defaultChatAgent?.completionsAdvancedSetting??"",chatQuotaExceededContext:zo.defaultChatAgent?.chatQuotaExceededContext??"",completionsQuotaExceededContext:zo.defaultChatAgent?.completionsQuotaExceededContext??""};let tZ=class extends F{constructor(e,t,i,n){if(super(),this.contextKeyService=n,this._onDidChangeQuotaExceeded=this._register(new M),this.onDidChangeQuotaExceeded=this._onDidChangeQuotaExceeded.event,this._onDidChangeQuotaRemaining=this._register(new M),this.onDidChangeQuotaRemaining=this._onDidChangeQuotaRemaining.event,this._quotas={},this.ExtensionQuotaContextKeys={chatQuotaExceeded:ko.chatQuotaExceededContext,completionsQuotaExceeded:ko.completionsQuotaExceededContext},this.chatQuotaExceededContextKey=_e.chatQuotaExceeded.bindTo(this.contextKeyService),this.completionsQuotaExceededContextKey=_e.completionsQuotaExceeded.bindTo(this.contextKeyService),this.onDidChangeEntitlement=T.map(T.filter(this.contextKeyService.onDidChangeContext,r=>r.affectsSome(new Set([_e.Entitlement.pro.key,_e.Entitlement.business.key,_e.Entitlement.enterprise.key,_e.Entitlement.proPlus.key,_e.Entitlement.limited.key,_e.Entitlement.canSignUp.key,_e.Entitlement.signedOut.key])),this._store),()=>{},this._store),this.onDidChangeSentiment=T.map(T.filter(this.contextKeyService.onDidChangeContext,r=>r.affectsSome(new Set([_e.Setup.hidden.key,_e.Setup.installed.key])),this._store),()=>{},this._store),!t.defaultChatAgent||Kt&&!i.remoteAuthority){_e.Setup.hidden.bindTo(this.contextKeyService).set(!0);return}const o=this.context=new Ih(()=>this._register(e.createInstance(BH)));this.requests=new Ih(()=>this._register(e.createInstance(WH,o.value,{clearQuotas:()=>this.clearQuotas(),acceptQuotas:r=>this.acceptQuotas(r)}))),this.registerListeners()}get entitlement(){return this.contextKeyService.getContextKeyValue(_e.Entitlement.pro.key)===!0?ii.Pro:this.contextKeyService.getContextKeyValue(_e.Entitlement.business.key)===!0?ii.Business:this.contextKeyService.getContextKeyValue(_e.Entitlement.enterprise.key)===!0?ii.Enterprise:this.contextKeyService.getContextKeyValue(_e.Entitlement.proPlus.key)===!0?ii.ProPlus:this.contextKeyService.getContextKeyValue(_e.Entitlement.limited.key)===!0?ii.Limited:this.contextKeyService.getContextKeyValue(_e.Entitlement.canSignUp.key)===!0?ii.Available:this.contextKeyService.getContextKeyValue(_e.Entitlement.signedOut.key)===!0?ii.Unknown:ii.Unresolved}get quotas(){return this._quotas}registerListeners(){const e=new Set([this.ExtensionQuotaContextKeys.chatQuotaExceeded,this.ExtensionQuotaContextKeys.completionsQuotaExceeded]),t=this._register(new Pt);this._register(this.contextKeyService.onDidChangeContext(i=>{i.affectsSome(e)&&(t.value&&t.value.cancel(),t.value=new li,this.update(t.value.token))}))}acceptQuotas(e){const t=this._quotas;this._quotas=e,this.updateContextKeys();const{changed:i}=this.compareQuotas(t.chat,e.chat),{changed:n}=this.compareQuotas(t.completions,e.completions),{changed:o}=this.compareQuotas(t.premiumChat,e.premiumChat);(i.exceeded||n.exceeded||o.exceeded)&&this._onDidChangeQuotaExceeded.fire(),(i.remaining||n.remaining||o.remaining)&&this._onDidChangeQuotaRemaining.fire()}compareQuotas(e,t){return{changed:{exceeded:e?.percentRemaining===0!=(t?.percentRemaining===0),remaining:e?.percentRemaining!==t?.percentRemaining}}}clearQuotas(){this.acceptQuotas({})}updateContextKeys(){this.chatQuotaExceededContextKey.set(this._quotas.chat?.percentRemaining===0),this.completionsQuotaExceededContextKey.set(this._quotas.completions?.percentRemaining===0)}get sentiment(){return this.contextKeyService.getContextKeyValue(_e.Setup.installed.key)===!0?$b.Installed:this.contextKeyService.getContextKeyValue(_e.Setup.hidden.key)===!0?$b.Disabled:$b.Standard}async update(e){await this.requests?.value.forceResolveEntitlement(void 0,e)}};tZ=f([p(0,Z),p(1,Vn),p(2,wn),p(3,fe)],tZ);let WH=Wg=class extends F{static providerId(e){return e.getValue(`${ko.completionsAdvancedSetting}.authProvider`)===ko.enterpriseProviderId?ko.enterpriseProviderId:ko.providerId}constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.context=e,this.chatQuotasAccessor=t,this.telemetryService=i,this.authenticationService=n,this.logService=o,this.requestService=r,this.dialogService=a,this.openerService=c,this.configurationService=d,this.authenticationExtensionsService=l,this.lifecycleService=u,this.pendingResolveCts=new li,this.didResolveEntitlements=!1,this.state={entitlement:this.context.state.entitlement},this.registerListeners(),this.resolve()}registerListeners(){this._register(this.authenticationService.onDidChangeDeclaredProviders(()=>this.resolve())),this._register(this.authenticationService.onDidChangeSessions(e=>{e.providerId===Wg.providerId(this.configurationService)&&this.resolve()})),this._register(this.authenticationService.onDidRegisterAuthenticationProvider(e=>{e.id===Wg.providerId(this.configurationService)&&this.resolve()})),this._register(this.authenticationService.onDidUnregisterAuthenticationProvider(e=>{e.id===Wg.providerId(this.configurationService)&&this.resolve()})),this._register(this.context.onDidChange(()=>{(!this.context.state.installed||this.context.state.entitlement===ii.Unknown)&&(this.state={entitlement:this.state.entitlement,quotas:void 0},this.chatQuotasAccessor.clearQuotas())}))}async resolve(){this.pendingResolveCts.dispose(!0);const e=this.pendingResolveCts=new li,t=await this.findMatchingProviderSession(e.token);if(e.token.isCancellationRequested)return;let i;t?this.state.entitlement===ii.Unknown&&(i={entitlement:ii.Unresolved}):(this.didResolveEntitlements=!1,i={entitlement:ii.Unknown}),i&&this.update(i),t&&!this.didResolveEntitlements&&await this.resolveEntitlement(t,e.token)}async findMatchingProviderSession(e){const t=await this.doGetSessions(Wg.providerId(this.configurationService));if(!e.isCancellationRequested){for(const i of t)for(const n of ko.providerScopes)if(this.scopesMatch(i.scopes,n))return i}}async doGetSessions(e){const t=this.authenticationExtensionsService.getAccountPreference(ko.chatExtensionId,e)??this.authenticationExtensionsService.getAccountPreference(ko.extensionId,e);let i;for(const n of await this.authenticationService.getAccounts(e))if(n.label===t){i=n;break}try{return await this.authenticationService.getSessions(e,void 0,i)}catch{}return[]}scopesMatch(e,t){return e.length===t.length&&t.every(i=>e.includes(i))}async resolveEntitlement(e,t){const i=await this.doResolveEntitlement(e,t);return typeof i?.entitlement=="number"&&!t.isCancellationRequested&&(this.didResolveEntitlements=!0,this.update(i)),i}async doResolveEntitlement(e,t){if(Wg.providerId(this.configurationService)===ko.enterpriseProviderId)return this.logService.trace("[chat entitlement]: enterprise provider, assuming Pro"),{entitlement:ii.Pro};if(t.isCancellationRequested)return;const i=await this.request(ko.entitlementUrl,"GET",void 0,e,t);if(t.isCancellationRequested)return;if(!i)return this.logService.trace("[chat entitlement]: no response"),{entitlement:ii.Unresolved};if(i.res.statusCode&&i.res.statusCode!==200)return this.logService.trace(`[chat entitlement]: unexpected status code ${i.res.statusCode}`),i.res.statusCode===401||i.res.statusCode===404?{entitlement:ii.Unknown}:{entitlement:ii.Unresolved};let n=null;try{n=await X0(i)}catch{}if(t.isCancellationRequested)return;if(!n)return this.logService.trace("[chat entitlement]: response has no content"),{entitlement:ii.Unresolved};let o;try{o=JSON.parse(n),this.logService.trace(`[chat entitlement]: parsed result is ${JSON.stringify(o)}`)}catch(c){return this.logService.trace(`[chat entitlement]: error parsing response (${c})`),{entitlement:ii.Unresolved}}let r;o.access_type_sku==="free_limited_copilot"?r=ii.Limited:o.can_signup_for_limited?r=ii.Available:o.copilot_plan==="individual"?r=ii.Pro:o.copilot_plan==="individual_pro"?r=ii.ProPlus:o.copilot_plan==="business"?r=ii.Business:o.copilot_plan==="enterprise"?r=ii.Enterprise:o.chat_enabled?r=ii.Pro:r=ii.Unavailable;const a={entitlement:r,quotas:this.toQuotas(o)};return this.logService.trace(`[chat entitlement]: resolved to ${a.entitlement}, quotas: ${JSON.stringify(a.quotas)}`),this.telemetryService.publicLog2("chatInstallEntitlement",{entitlement:a.entitlement,tid:o.analytics_tracking_id,quotaChat:o?.quota_snapshots?.chat?.remaining,quotaPremiumChat:o?.quota_snapshots?.premium_interactions?.remaining,quotaCompletions:o?.quota_snapshots?.completions?.remaining,quotaResetDate:o.quota_reset_date??o.limited_user_reset_date}),a}toQuotas(e){const t={resetDate:e.quota_reset_date??e.limited_user_reset_date};if(e.monthly_quotas?.chat&&typeof e.limited_user_quotas?.chat=="number"&&(t.chat={total:e.monthly_quotas.chat,percentRemaining:Math.min(100,Math.max(0,e.limited_user_quotas.chat/e.monthly_quotas.chat*100)),overageEnabled:!1,overageCount:0,unlimited:!1}),e.monthly_quotas?.completions&&typeof e.limited_user_quotas?.completions=="number"&&(t.completions={total:e.monthly_quotas.completions,percentRemaining:Math.min(100,Math.max(0,e.limited_user_quotas.completions/e.monthly_quotas.completions*100)),overageEnabled:!1,overageCount:0,unlimited:!1}),e.quota_snapshots)for(const i of["chat","completions","premium_interactions"]){const n=e.quota_snapshots[i];if(!n)continue;const o={total:n.entitlement,percentRemaining:Math.min(100,Math.max(0,n.percent_remaining)),overageEnabled:n.overage_permitted,overageCount:n.overage_count,unlimited:n.unlimited};switch(i){case"chat":t.chat=o;break;case"completions":t.completions=o;break;case"premium_interactions":t.premiumChat=o;break}}return t}async request(e,t,i,n,o){try{return await this.requestService.request({type:t,url:e,data:t==="POST"?JSON.stringify(i):void 0,disableCache:!0,headers:{Authorization:`Bearer ${n.accessToken}`}},o)}catch(r){o.isCancellationRequested||this.logService.error(`[chat entitlement] request: error ${r}`);return}}update(e){this.state=e,this.context.update({entitlement:this.state.entitlement}),e.quotas&&this.chatQuotasAccessor.acceptQuotas(e.quotas)}async forceResolveEntitlement(e,t=Ce.None){if(e||(e=await this.findMatchingProviderSession(t)),!!e)return this.resolveEntitlement(e,t)}async signUpLimited(e){const t={restricted_telemetry:this.telemetryService.telemetryLevel===Rz.NONE?"disabled":"enabled",public_code_suggestions:"enabled"},i=await this.request(ko.entitlementSignupLimitedUrl,"POST",t,e,Ce.None);if(!i)return await this.onUnknownSignUpError(h(5039,"No response received."),"[chat entitlement] sign-up: no response")?this.signUpLimited(e):{errorCode:1};if(i.res.statusCode&&i.res.statusCode!==200){if(i.res.statusCode===422)try{const a=await X0(i);if(a){const c=JSON.parse(a);if(typeof c.message=="string"&&c.message)return this.onUnprocessableSignUpError(`[chat entitlement] sign-up: unprocessable entity (${c.message})`,c.message),{errorCode:i.res.statusCode}}}catch{}return await this.onUnknownSignUpError(h(5040,"Unexpected status code {0}.",i.res.statusCode),`[chat entitlement] sign-up: unexpected status code ${i.res.statusCode}`)?this.signUpLimited(e):{errorCode:i.res.statusCode}}let n=null;try{n=await X0(i)}catch{}if(!n)return await this.onUnknownSignUpError(h(5041,"Response has no contents."),"[chat entitlement] sign-up: response has no content")?this.signUpLimited(e):{errorCode:2};let o;try{o=JSON.parse(n),this.logService.trace(`[chat entitlement] sign-up: response is ${n}`)}catch(r){return await this.onUnknownSignUpError(h(5042,"Invalid response contents."),`[chat entitlement] sign-up: error parsing response (${r})`)?this.signUpLimited(e):{errorCode:3}}return this.update({entitlement:ii.Limited}),!!o?.subscribed}async onUnknownSignUpError(e,t){if(this.logService.error(t),!this.lifecycleService.willShutdown){const{confirmed:i}=await this.dialogService.confirm({type:Fe.Error,message:h(5043,"An error occurred while signing up for the Copilot Free plan. Would you like to try again?"),detail:e,primaryButton:h(5044,"Retry")});return i}return!1}onUnprocessableSignUpError(e,t){this.logService.error(e),this.lifecycleService.willShutdown||this.dialogService.prompt({type:Fe.Error,message:h(5045,"An error occurred while signing up for the Copilot Free plan."),detail:t,buttons:[{label:h(5046,"OK"),run:()=>{}},{label:h(5047,"Learn More"),run:()=>this.openerService.open(R.parse(ko.upgradePlanUrl))}]})}async signIn(){const e=Wg.providerId(this.configurationService),t=await this.authenticationService.createSession(e,ko.providerScopes[0]);this.authenticationExtensionsService.updateAccountPreference(ko.extensionId,e,t.account),this.authenticationExtensionsService.updateAccountPreference(ko.chatExtensionId,e,t.account);const i=await this.forceResolveEntitlement(t);return{session:t,entitlements:i}}dispose(){this.pendingResolveCts.dispose(!0),super.dispose()}};WH=Wg=f([p(2,ai),p(3,Pw),p(4,Re),p(5,UM),p(6,ei),p(7,mi),p(8,ne),p(9,Vq),p(10,wd)],WH);let BH=class extends F{static{tT=this}static{this.CHAT_ENTITLEMENT_CONTEXT_STORAGE_KEY="chat.setupContext"}get state(){return this.suspendedState??this._state}constructor(e,t,i,n,o){super(),this.storageService=t,this.extensionEnablementService=i,this.logService=n,this.extensionsWorkbenchService=o,this.suspendedState=void 0,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.updateBarrier=void 0,this.canSignUpContextKey=_e.Entitlement.canSignUp.bindTo(e),this.signedOutContextKey=_e.Entitlement.signedOut.bindTo(e),this.limitedContextKey=_e.Entitlement.limited.bindTo(e),this.proContextKey=_e.Entitlement.pro.bindTo(e),this.proPlusContextKey=_e.Entitlement.proPlus.bindTo(e),this.businessContextKey=_e.Entitlement.business.bindTo(e),this.enterpriseContextKey=_e.Entitlement.enterprise.bindTo(e),this.hiddenContext=_e.Setup.hidden.bindTo(e),this.installedContext=_e.Setup.installed.bindTo(e),this.disabledContext=_e.Setup.disabled.bindTo(e),this._state=this.storageService.getObject(tT.CHAT_ENTITLEMENT_CONTEXT_STORAGE_KEY,he.PROFILE)??{entitlement:ii.Unknown},this.checkExtensionInstallation(),this.updateContextSync()}async checkExtensionInstallation(){await this.extensionsWorkbenchService.queryLocal(),this._register(T.runAndSubscribe(this.extensionsWorkbenchService.onChange,e=>{if(e&&!vs.equals(e.identifier.id,ko.extensionId))return;const t=this.extensionsWorkbenchService.local.find(i=>vs.equals(i.identifier.id,ko.extensionId));this.update({installed:!!t?.local&&this.extensionEnablementService.isEnabled(t.local),disabled:!!t?.local&&!this.extensionEnablementService.isEnabled(t.local)})}))}update(e){return this.logService.trace(`[chat entitlement context] update(): ${JSON.stringify(e)}`),typeof e.installed=="boolean"&&typeof e.disabled=="boolean"&&(this._state.installed=e.installed,this._state.disabled=e.disabled,e.installed&&(e.hidden=!1)),typeof e.hidden=="boolean"&&(this._state.hidden=e.hidden),typeof e.entitlement=="number"&&(this._state.entitlement=e.entitlement,this._state.entitlement===ii.Limited||zLe(this._state.entitlement)?this._state.registered=!0:this._state.entitlement===ii.Available&&(this._state.registered=!1)),this.storageService.store(tT.CHAT_ENTITLEMENT_CONTEXT_STORAGE_KEY,this._state,he.PROFILE,gt.MACHINE),this.updateContext()}async updateContext(){await this.updateBarrier?.wait(),this.updateContextSync()}updateContextSync(){this.logService.trace(`[chat entitlement context] updateContext(): ${JSON.stringify(this._state)}`),this.signedOutContextKey.set(this._state.entitlement===ii.Unknown),this.canSignUpContextKey.set(this._state.entitlement===ii.Available),this.limitedContextKey.set(this._state.entitlement===ii.Limited),this.proContextKey.set(this._state.entitlement===ii.Pro),this.proPlusContextKey.set(this._state.entitlement===ii.ProPlus),this.businessContextKey.set(this._state.entitlement===ii.Business),this.enterpriseContextKey.set(this._state.entitlement===ii.Enterprise),this.hiddenContext.set(!!this._state.hidden),this.installedContext.set(!!this._state.installed),this.disabledContext.set(!!this._state.disabled),this._onDidChange.fire()}suspend(){this.suspendedState={...this._state},this.updateBarrier=new Rp}resume(){this.suspendedState=void 0,this.updateBarrier?.open(),this.updateBarrier=void 0}};BH=tT=f([p(0,fe),p(1,it),p(2,gd),p(3,Re),p(4,Aw)],BH);let iZ=class extends F{constructor(e,t){super(),this.extensionFeaturesManagementService=e;for(const i in t.keys(he.APPLICATION,gt.USER))(i.startsWith("languageModelStats.")||i.startsWith("languageModelAccess."))&&t.remove(i,he.APPLICATION)}async update(e,t,i,n){await this.extensionFeaturesManagementService.getAccess(t,Qde)}};iZ=f([p(0,Qre),p(1,it)],iZ);const Qde="copilot";Ke.as(Ew.ExtensionFeaturesRegistry).registerExtensionFeature({id:Qde,label:h(5058,"Copilot"),description:h(5059,"Language models usage statistics of this extension."),icon:K.copilot,access:{canToggle:!1},accessDataLabel:h(5060,"chat")});var nZ;(function(s){s[s.Confirmation=1]="Confirmation",s[s.Prompt=2]="Prompt",s[s.Input=3]="Input"})(nZ||(nZ={}));var Yi;(function(s){s[s.SAVE=0]="SAVE",s[s.DONT_SAVE=1]="DONT_SAVE",s[s.CANCEL=2]="CANCEL"})(Yi||(Yi={}));const nk=10;function Lu(s){const e=[];return e.push(...s.slice(0,nk).map(t=>typeof t=="string"?t:Qe(t))),s.length>nk&&(s.length-nk===1?e.push(h(1745,"...1 additional file not shown")):e.push(h(1746,"...{0} additional files not shown",s.length-nk))),e.push(""),e.join(`
`)}var iu;const qLe=Pe("chat-editor-label-icon",K.commentDiscussion,h(4773,"Icon of the chat editor label."));let VH=class extends dl{static{iu=this}static{this.countsInUse=new Set}static{this.TypeID="workbench.input.chatSession"}static{this.EditorID="workbench.editor.chatSession"}static getNewEditorUri(){const e=Math.floor(Math.random()*1e9);return gP.generate(e)}static getNextCount(){let e=0;for(;iu.countsInUse.has(e);)e++;return e}constructor(e,t,i,n){if(super(),this.resource=e,this.options=t,this.chatService=i,this.dialogService=n,this.closeHandler=this,typeof gP.parse(e)?.handle!="number")throw new Error("Invalid chat URI");this.sessionId=t.target&&"sessionId"in t.target?t.target.sessionId:void 0,this.inputCount=iu.getNextCount(),iu.countsInUse.add(this.inputCount),this._register(Ie(()=>iu.countsInUse.delete(this.inputCount)))}showConfirm(){return this.model?.editingSession?Zde(this.model.editingSession):!1}async confirm(e){if(!this.model?.editingSession)return Yi.SAVE;const t=h(4774,"Close Chat Editor"),i=h(4775,"Closing the chat editor will end your current edit session.");return await Xde(this.model.editingSession,this.dialogService,{titleOverride:t,messageOverride:i})?Yi.SAVE:Yi.CANCEL}get editorId(){return iu.EditorID}get capabilities(){return super.capabilities|Je.Singleton|Je.CanDropIntoEditor}matches(e){return e instanceof iu&&e.resource.toString()===this.resource.toString()}get typeId(){return iu.TypeID}getName(){return this.model?.title||h(4776,"Chat")+(this.inputCount>0?` ${this.inputCount+1}`:"")}getIcon(){return qLe}async resolve(){return typeof this.sessionId=="string"?this.model=await this.chatService.getOrRestoreSession(this.sessionId)??this.chatService.startSession($i.Panel,Ce.None):this.options.target?"data"in this.options.target&&(this.model=this.chatService.loadSessionFromContent(this.options.target.data)):this.model=this.chatService.startSession($i.Panel,Ce.None),this.model?(this.sessionId=this.model.sessionId,this._register(this.model.onDidChange(()=>this._onDidChangeLabel.fire())),this._register(new KLe(this.model))):null}dispose(){super.dispose(),this.sessionId&&this.chatService.clearSession(this.sessionId)}};VH=iu=f([p(2,ff),p(3,ei)],VH);class KLe extends F{constructor(e){super(),this.model=e,this._onWillDispose=this._register(new M),this.onWillDispose=this._onWillDispose.event,this._isDisposed=!1,this._isResolved=!1}async resolve(){this._isResolved=!0}isResolved(){return this._isResolved}isDisposed(){return this._isDisposed}dispose(){super.dispose(),this._isDisposed=!0}}var gP;(function(s){s.scheme=ae.vscodeChatSesssion;function e(i){return R.from({scheme:s.scheme,path:`chat-${i}`})}s.generate=e;function t(i){if(i.scheme!==s.scheme)return;const o=i.path.match(/chat-(\d+)/)?.[1];if(typeof o!="string")return;const r=parseInt(o);if(!isNaN(r))return{handle:r}}s.parse=t})(gP||(gP={}));const Oa=I(4341,"Chat"),jLe="workbench.action.chat.triggerSetup",YLe="workbench.action.chat.toggle",QLe="workbench.action.chat.openQuotaExceededDialog";function XLe(s){return`workbench.action.chat.open${OB(s)}`}zo.defaultChatAgent?.manageSettingsUrl,zo.defaultChatAgent?.enterpriseProviderId,zo.defaultChatAgent?.completionsAdvancedSetting,zo.defaultChatAgent?.completionsMenuCommand;ge.appendMenuItem(N.CommandCenter,{submenu:N.ChatTitleBarMenu,title:h(4372,"Copilot"),icon:K.copilot,when:x.and(_e.supported,x.and(_e.Setup.hidden.negate(),_e.Setup.disabled.negate()),x.has("config.chat.commandCenter.enabled")),order:10001});ge.appendMenuItem(N.TitleBar,{submenu:N.ChatTitleBarMenu,title:h(4372,"Copilot"),group:"navigation",icon:K.copilot,when:x.and(_e.supported,x.and(_e.Setup.hidden.negate(),_e.Setup.disabled.negate()),x.has("config.chat.commandCenter.enabled"),x.has("config.window.commandCenter").negate()),order:1});Y(class extends NO{constructor(){super("chat.commandCenter.enabled",h(4373,"Copilot Controls"),h(4374,"Toggle visibility of the Copilot Controls in title bar"),5,x.and(x.and(_e.Setup.hidden.negate(),_e.Setup.disabled.negate()),dq.negate(),_e.supported))}});Y(class extends X{constructor(){super({id:"workbench.action.chat.resetTrustedTools",title:I(4375,"Reset Tool Confirmations"),category:Oa,f1:!0})}run(e){e.get(kw).resetToolAutoConfirmation(),e.get(Dt).info(h(4376,"Tool confirmation preferences have been reset."))}});let sZ=class extends F{static{this.ID="workbench.contrib.copilotTitleBarMenuRendering"}constructor(e,t,i){super();const n=e.register(N.CommandCenter,N.ChatTitleBarMenu,(o,r)=>{if(!(o instanceof xh))return;const a=Ri({id:"copilot.titleBarMenuRendering.more",label:h(4377,"More..."),run(){}}),c=i.sentiment===$b.Installed,d=i.quotas.chat?.percentRemaining===0,l=i.entitlement===ii.Unknown,u=i.entitlement===ii.Limited;let g=YLe,m=h(4344,"Toggle Chat"),v=K.copilot;return c&&(l?(g=jLe,m=h(4378,"Sign in to use Copilot..."),v=K.copilotNotConnected):d&&u&&(g=QLe,m=h(4379,"Copilot Free plan chat messages quota reached. Click for details."),v=K.copilotWarning)),t.createInstance(oP,t.createInstance(wr,{id:g,title:m,icon:v},void 0,void 0,void 0,void 0),a,o.actions,"",{...r,skipTelemetry:!0})},T.any(i.onDidChangeSentiment,i.onDidChangeQuotaExceeded,i.onDidChangeEntitlement));kne(n)}};sZ=f([p(0,iq),p(1,Z),p(2,Gq)],sZ);async function ZLe(s,e,t){return Zde(s)?Xde(s,t,{messageOverride:e}):!0}async function Xde(s,e,t){const i=h(4380,"Starting a new chat will end your current edit session."),n=h(4381,"Start new chat?"),o=t?.messageOverride??i,r=t?.titleOverride??n,c=s.entries.get().filter(l=>l.state.get()===_d.Modified),{result:d}=await e.prompt({title:r,message:o+" "+h(4382,"Do you want to keep pending edits to {0} files?",c.length),type:"info",cancelButton:!0,buttons:[{label:h(4383,"Keep & Continue"),run:async()=>(await s.accept(),!0)},{label:h(4384,"Undo & Continue"),run:async()=>(await s.reject(),!0)}]});return!!d}function Zde(s){const e=s.entries.get();return e.length?!!e.filter(n=>n.state.get()===_d.Modified).length:!1}class l_ extends X{constructor(e){super({category:Oa,...e})}run(e,...t){const i=Jde(e,t);if(!(!i||!i.editingSession))return this.runEditingSessionAction(e,i.editingSession,i.chatWidget,...t)}}function Jde(s,e){const t=e.at(0),i=tAe(t)?t:void 0,n=s.get(Ho),o=s.get(ug);let r=i?n.getWidgetBySessionId(i.sessionId):void 0;if(r||(r=n.lastFocusedWidget??n.getWidgetsByLocations($i.Panel).find(d=>d.supportsChangingModes)),!r?.viewModel)return;const a=r.viewModel.model.sessionId,c=o.getEditingSession(a);if(c)return{editingSession:c,chatWidget:r}}class OO extends l_{runEditingSessionAction(e,t,i,...n){const o=[];if(R.isUri(n[0])?o.push(n[0]):i&&o.push(...i.input.selectedElements),!!o.length)return this.runWorkingSetAction(e,t,i,...o)}}Y(class extends OO{constructor(){super({id:"chatEditing.removeFileFromWorkingSet",title:I(4684,"Remove File"),icon:K.close,precondition:_e.requestInProgress.negate(),menu:[{id:N.ChatEditingWidgetModifiedFilesToolbar,order:5,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){const o=e.get(ei),r=t.entries.get().filter(a=>n.includes(a.modifiedURI)&&a.state.get()===_d.Modified);if(r.length>0){const a=r.length>1?h(4685,"{0} files",r.length):Qe(r[0].modifiedURI);if(!(await o.confirm({title:h(4686,"Remove {0} from working set?",a),message:h(4687,"This will remove {0} from your working set and undo the edits made to it. Do you want to proceed?",a),primaryButton:h(4688,"Yes"),type:"info"})).confirmed)return}await t.reject(...n),t.remove(...n);for(const a of n)i.attachmentModel.delete(a.toString());i.attachmentModel.fileAttachments.length===0&&i.input.relatedFiles?.clear()}});Y(class extends OO{constructor(){super({id:"chatEditing.openFileInDiff",title:I(4689,"Open Changes in Diff Editor"),icon:K.diffSingle,menu:[{id:N.ChatEditingWidgetModifiedFilesToolbar,when:x.equals(LO.key,_d.Modified),order:2,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){const o=e.get(de);for(const r of n){let a=o.activeEditorPane;if(a||(a=await o.openEditor({resource:r})),!a)return;t.getEntry(r)?.getEditorIntegration(a).toggleDiff(void 0,!0)}}});Y(class extends OO{constructor(){super({id:"chatEditing.acceptFile",title:I(4690,"Keep"),icon:K.check,precondition:_e.requestInProgress.negate(),menu:[{when:x.and(x.equals("resourceScheme",Kde),x.notIn(Yde.key,jde.key)),id:N.MultiDiffEditorFileToolbar,order:0,group:"navigation"},{id:N.ChatEditingWidgetModifiedFilesToolbar,when:x.equals(LO.key,_d.Modified),order:0,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){await t.accept(...n)}});Y(class extends OO{constructor(){super({id:"chatEditing.discardFile",title:I(4691,"Undo"),icon:K.discard,precondition:_e.requestInProgress.negate(),menu:[{when:x.and(x.equals("resourceScheme",Kde),x.notIn(Yde.key,jde.key)),id:N.MultiDiffEditorFileToolbar,order:2,group:"navigation"},{id:N.ChatEditingWidgetModifiedFilesToolbar,when:x.equals(LO.key,_d.Modified),order:1,group:"navigation"}]})}async runWorkingSetAction(e,t,i,...n){await t.reject(...n)}});class JLe extends l_{constructor(){super({id:"chatEditing.acceptAllFiles",title:h(4692,"Keep"),icon:K.check,tooltip:h(4693,"Keep All Edits"),precondition:x.and(_e.requestInProgress.negate(),_h),keybinding:{primary:E.CtrlCmd|S.Enter,when:x.and(_e.requestInProgress.negate(),_h,_e.inChatInput),weight:W.WorkbenchContrib},menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:0,when:x.and(MO.negate(),x.and(_h))}]})}async runEditingSessionAction(e,t,i,...n){await t.accept()}}Y(JLe);class eMe extends l_{constructor(){super({id:"chatEditing.discardAllFiles",title:h(4694,"Undo"),icon:K.discard,tooltip:h(4695,"Undo All Edits"),precondition:x.and(_e.requestInProgress.negate(),_h),menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:1,when:x.and(MO.negate(),_h)}],keybinding:{when:x.and(_e.requestInProgress.negate(),_h,_e.inChatInput,_e.inputHasText.negate()),weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Backspace}})}async runEditingSessionAction(e,t,i,...n){await tMe(e,t)}}Y(eMe);async function tMe(s,e){const t=s.get(ei),i=e.entries.get();return i.length>0&&!(await t.confirm({title:h(4696,"Undo all edits?"),message:i.length===1?h(4697,"This will undo changes made by {0} in {1}. Do you want to proceed?","Copilot Edits",Qe(i[0].modifiedURI)):h(4698,"This will undo changes made by {0} in {1} files. Do you want to proceed?","Copilot Edits",i.length),primaryButton:h(4699,"Yes"),type:"info"})).confirmed?!1:(await e.reject(),!0)}class FO extends l_{static{this.ID="chatEditing.clearWorkingSet"}constructor(){super({id:FO.ID,title:h(4700,"Clear Working Set"),icon:K.clearAll,tooltip:h(4700,"Clear Working Set"),precondition:x.and(_e.requestInProgress.negate()),menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:5,when:s4.negate()}]})}async runEditingSessionAction(e,t,i,...n){const o=[...t.entries.get()].map(c=>c.modifiedURI);t.remove(...o);const a=(i.attachmentModel?i.attachmentModel.fileAttachments:[]).map(c=>c.toString());i.attachmentModel.delete(...a)}}Y(FO);class Gb extends l_{static{this.ID="chatEditing.viewChanges"}static{this.LABEL=h(4701,"View All Edits")}constructor(){super({id:Gb.ID,title:Gb.LABEL,tooltip:Gb.LABEL,f1:!1,icon:K.diffMultiple,precondition:_h,menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:4,when:x.and(MO.negate(),x.and(s4,_h))}]})}async runEditingSessionAction(e,t,i,...n){await t.show()}}Y(Gb);Y(class extends X{constructor(){super({id:"workbench.action.chat.undoEdits",title:I(4702,"Undo Requests"),f1:!1,category:Oa,icon:K.x,keybinding:{primary:S.Delete,mac:{primary:E.CtrlCmd|S.Backspace},when:x.and(_e.inChatSession,V.textInputFocus.negate()),weight:W.WorkbenchContrib},menu:[{id:N.ChatMessageTitle,group:"navigation",order:2,when:_e.isRequest}]})}async run(e,...t){let i=t[0];if(!FH(i)&&!lP(i)&&(i=e.get(Ho).lastFocusedWidget?.getFocus()),!i)return;const n=e.get(ne),o=e.get(ei),a=e.get(ff).getSession(i.sessionId);if(!a)return;const c=a.editingSession;if(!c)return;const d=lP(i)?i.id:FH(i)?i.requestId:void 0;if(d){const l=a.getRequests(),u=l.findIndex(A=>A.id===d),g=l.length-u,m=l.slice(u),v=new Set(m.map(A=>A.id)),_=c.entries.get().filter(A=>v.has(A.lastModifyingRequestId))??[],w=_.length>0&&n.getValue("chat.editing.confirmEditRequestRemoval")===!0;let C;g===1?_.length===1?C=h(4703,"This will remove your last request and undo the edits made to {0}. Do you want to proceed?",Qe(_[0].modifiedURI)):C=h(4704,"This will remove your last request and undo edits made to {0} files in your working set. Do you want to proceed?",_.length):_.length===1?C=h(4705,"This will remove all subsequent requests and undo edits made to {0}. Do you want to proceed?",Qe(_[0].modifiedURI)):C=h(4706,"This will remove all subsequent requests and undo edits made to {0} files in your working set. Do you want to proceed?",_.length);const k=w?await o.confirm({title:g===1?h(4707,"Do you want to undo your last edit?"):h(4708,"Do you want to undo {0} edits?",g),message:C,primaryButton:h(4709,"Yes"),checkbox:{label:h(4710,"Don't ask again"),checked:!1},type:"info"}):{confirmed:!0};if(!k.confirmed)return;k.checkboxChecked&&await n.updateValue("chat.editing.confirmEditRequestRemoval",!1);const D=l[u].id;await c.restoreSnapshot(D,void 0)}}});Y(class ele extends X{static{this.id="chat.openFileUpdatedBySnapshot"}constructor(){super({id:ele.id,title:h(4711,"Open File"),menu:[{id:N.ChatEditingCodeBlockContext,group:"navigation",order:0}]})}async run(e,...t){const i=t[0];if(!i?.sessionId)return;await e.get(de).openEditor({resource:i.uri})}});Y(class tle extends X{static{this.id="chat.openFileSnapshot"}constructor(){super({id:tle.id,title:h(4712,"Open File Snapshot"),menu:[{id:N.ChatEditingCodeBlockContext,group:"navigation",order:1}]})}async run(e,...t){const i=t[0];if(!i?.sessionId)return;const n=e.get(ff),o=e.get(ug),r=e.get(de),a=n.getSession(i.sessionId);if(!a)return;const c=o.getEditingSession(a.sessionId)?.getSnapshotUri(i.requestId,i.uri,i.stopId);if(c){const d=await r.openEditor({resource:c,label:h(4713,"{0} (Snapshot)",Qe(i.uri)),options:{transient:!0,activation:qc.ACTIVATE}});mo(d)&&d.updateOptions({readOnly:!0})}}});Y(class extends l_{constructor(){super({id:"workbench.action.edits.addFilesFromReferences",title:I(4714,"Add Files From References"),f1:!1,category:Oa,menu:{id:N.ChatInputSymbolAttachmentContext,group:"navigation",order:1,when:x.and(_e.chatMode.isEqualTo(Rt.Ask),V.hasReferenceProvider)}})}async runEditingSessionAction(e,t,i,...n){if(n.length===0||!Xve(n[0]))return;const o=e.get(Ci),r=e.get(Ne),a=n[0],d=(await o.createModelReference(a.uri)).object.textEditorModel;if(!d)return;const l=new we(a.range.startLineNumber,a.range.startColumn),[u,g,m]=await Promise.all([this.getReferences(l,d,r),this.getDefinitions(l,d,r),this.getImplementations(l,d,r)]),v=[];for(const _ of[...g,...m,...u])v.push(i.attachmentModel.asVariableEntry(_.uri));i.attachmentModel.addContext(...v)}async getReferences(e,t,i){const n=i.referenceProvider.all(t);return(await Promise.all(n.map(async r=>await r.provideReferences(t,e,{includeDeclaration:!0},Ce.None)??[]))).flat()}async getDefinitions(e,t,i){const n=i.definitionProvider.all(t);return(await Promise.all(n.map(async r=>await r.provideDefinition(t,e,Ce.None)??[]))).flat()}async getImplementations(e,t,i){const n=i.implementationProvider.all(t);return(await Promise.all(n.map(async r=>await r.provideImplementation(t,e,Ce.None)??[]))).flat()}});class zb extends l_{static{this.Id="chatEditing.viewPreviousEdits"}static{this.Label=h(4715,"View Previous Edits")}constructor(){super({id:zb.Id,title:zb.Label,tooltip:zb.Label,f1:!1,icon:K.diffMultiple,precondition:_h.negate(),menu:[{id:N.ChatEditingWidgetToolbar,group:"navigation",order:4,when:x.and(MO.negate(),x.and(s4,_h.negate()))}]})}async runEditingSessionAction(e,t,i,...n){await t.show(!0)}}Y(zb);const iMe="workbench.action.chat.newChat";class ile extends X{run(e,...t){const i=t[0],n=e.get(Ho);(i?.widget??n.lastFocusedWidget)?.acceptInput(i?.inputValue)}}const WO=x.or(_e.isRequestPaused,_e.requestInProgress.negate());class o4 extends ile{static{this.ID="workbench.action.chat.submit"}constructor(){const e=_e.chatMode.isEqualTo(Rt.Ask);super({id:o4.ID,title:I(4431,"Send and Dispatch"),f1:!1,category:Oa,icon:K.send,precondition:e,keybinding:{when:_e.inChatInput,primary:S.Enter,weight:W.EditorContrib},menu:[{id:N.ChatExecuteSecondary,group:"group_1",order:1,when:e},{id:N.ChatExecute,order:4,when:x.and(WO,e),group:"navigation"}]})}}const nle="workbench.action.chat.toggleAgentMode";class sle extends X{static{this.ID=nle}constructor(){super({id:sle.ID,title:I(4432,"Set Chat Mode"),f1:!0,category:Oa,precondition:x.and(_e.enabled,_e.requestInProgress.negate()),tooltip:h(4433,"Set Mode"),keybinding:{when:x.and(_e.inChatInput,_e.location.isEqualTo($i.Panel)),primary:E.CtrlCmd|S.Period,weight:W.EditorContrib},menu:[{id:N.ChatExecute,order:1,when:x.and(_e.enabled,_e.location.isEqualTo($i.Panel),_e.inQuickChat.negate()),group:"navigation"}]})}async run(e,...t){const i=e.get(Ge),n=e.get(ne),o=e.get(ei),r=Jde(e,t);if(!r?.chatWidget)return;const a=t.at(0),d=r.chatWidget.viewModel?.model?.getRequests().length??0,l=FB(a?.mode)??this.getNextMode(r.chatWidget,d,n),u=!n.getValue(ky.Edits2Enabled)&&(r.chatWidget.input.currentMode===Rt.Edit||l===Rt.Edit)&&d>0;if(l!==r.chatWidget.input.currentMode){if(u){const g=h(4434,"Switching chat modes will end your current edit session.");if(!r.editingSession)return;if(r.editingSession.entries.get().filter(_=>_.state.get()===_d.Modified).length>0){if(!await ZLe(r.editingSession,g,o))return}else if(!(await o.confirm({title:h(4435,"Start new session?"),message:h(4436,"Changing the chat mode will end your current edit session. Would you like to change the chat mode?"),primaryButton:h(4437,"Yes"),type:"info"})).confirmed)return}r.chatWidget.input.setChatMode(l),u&&await i.executeCommand(iMe)}}getNextMode(e,t,i){const n=[Rt.Ask];(i.getValue(ky.Edits2Enabled)||t===0)&&n.push(Rt.Edit),n.push(Rt.Agent);const o=n.indexOf(e.input.currentMode);return n[(o+1)%n.length]}}const nMe="workbench.action.chat.toggleRequestPaused";class ole extends X{static{this.ID=nMe}constructor(){super({id:ole.ID,title:I(4438,"Toggle Request Paused"),category:Oa,icon:K.debugPause,toggled:{condition:_e.isRequestPaused,icon:K.play,tooltip:h(4439,"Resume Request")},tooltip:h(4440,"Pause Request"),menu:[{id:N.ChatExecute,order:3.5,when:x.and(_e.canRequestBePaused,_e.chatMode.isEqualTo(Rt.Agent),_e.location.isEqualTo($i.Panel),x.or(_e.isRequestPaused.negate(),_e.inputHasText.negate())),group:"navigation"}]})}run(e,...t){const i=t[0],n=e.get(Ho);(i?.widget??n.lastFocusedWidget)?.togglePaused()}}class rle extends X{static{this.ID="workbench.action.chat.switchToNextModel"}constructor(){super({id:rle.ID,title:I(4441,"Switch to Next Model"),category:Oa,f1:!0,precondition:_e.enabled})}run(e,...t){e.get(Ho).lastFocusedWidget?.input.switchToNextModel()}}const ale="workbench.action.chat.openModelPicker";class cle extends X{static{this.ID=ale}constructor(){super({id:cle.ID,title:I(4442,"Open Model Picker"),category:Oa,f1:!0,keybinding:{primary:E.CtrlCmd|E.Alt|S.Period,weight:W.WorkbenchContrib,when:_e.inChatInput},precondition:_e.enabled,menu:{id:N.ChatExecute,order:3,group:"navigation",when:x.and(_e.languageModelsAreUserSelectable,x.or(x.equals(_e.location.key,$i.Panel),x.equals(_e.location.key,$i.Editor),x.equals(_e.location.key,$i.Notebook),x.equals(_e.location.key,$i.Terminal)))}})}async run(e,...t){let n=e.get(Ho).lastFocusedWidget;(!n||n.location===$i.Panel)&&(n=await WLe(e.get(io))),n&&n.input.openModelPicker()}}const sMe="workbench.action.chat.changeModel";class dle extends X{static{this.ID=sMe}constructor(){super({id:dle.ID,title:I(4443,"Change Model"),category:Oa,f1:!1,precondition:_e.enabled})}run(e,...t){const i=t[0];yt(typeof i.vendor=="string"&&typeof i.id=="string"&&typeof i.family=="string");const o=e.get(Ho).getAllWidgets();for(const r of o)r.input.switchModel(i)}}class r4 extends ile{static{this.ID="workbench.action.edits.submit"}constructor(){const e=_e.chatMode.notEqualsTo(Rt.Ask);super({id:r4.ID,title:I(4444,"Send"),f1:!1,category:Oa,icon:K.send,precondition:e,keybinding:{when:_e.inChatInput,primary:S.Enter,weight:W.EditorContrib},menu:[{id:N.ChatExecuteSecondary,group:"group_1",when:x.and(WO,e),order:1},{id:N.ChatExecute,order:4,when:x.and(x.or(x.and(_e.isRequestPaused,_e.inputHasText),_e.requestInProgress.negate()),e),group:"navigation"}]})}}class lle extends X{static{this.ID="workbench.action.chat.submitWithoutDispatching"}constructor(){const e=x.and(x.or(_e.inputHasText,_e.hasPromptFile),WO,_e.chatMode.isEqualTo(Rt.Ask));super({id:lle.ID,title:I(4445,"Send"),f1:!1,category:Oa,precondition:e,keybinding:{when:_e.inChatInput,primary:E.Alt|E.Shift|S.Enter,weight:W.EditorContrib},menu:[{id:N.ChatExecuteSecondary,group:"group_1",order:2,when:_e.chatMode.isEqualTo(Rt.Ask)}]})}run(e,...t){const i=t[0],n=e.get(Ho);(i?.widget??n.lastFocusedWidget)?.acceptInput(i?.inputValue,{noCommandDetection:!0})}}class hle extends X{static{this.ID="workbench.action.chat.submitWithCodebase"}constructor(){const e=x.and(x.or(_e.inputHasText,_e.hasPromptFile),WO);super({id:hle.ID,title:I(4446,"Send with {0}",`${eD}codebase`),precondition:e,menu:{id:N.ChatExecuteSecondary,group:"group_1",order:3,when:x.equals(_e.location.key,$i.Panel)},keybinding:{when:_e.inChatInput,primary:E.CtrlCmd|S.Enter,weight:W.EditorContrib}})}run(e,...t){const i=t[0],n=e.get(Ho),o=i?.widget??n.lastFocusedWidget;if(!o)return;const a=e.get(kw).getToolByName("codebase");a&&(o.input.attachmentModel.addContext({id:a.id,name:a.displayName??"",fullName:a.displayName??"",value:void 0,icon:ke.isThemeIcon(a.icon)?a.icon:void 0,kind:"tool"}),o.acceptInput())}}const oMe="workbench.action.chat.cancel";class a4 extends X{static{this.ID=oMe}constructor(){super({id:a4.ID,title:I(4448,"Cancel"),f1:!1,category:Oa,icon:K.stopCircle,menu:{id:N.ChatExecute,when:x.and(_e.isRequestPaused.negate(),_e.requestInProgress),order:4,group:"navigation"},keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Escape,win:{primary:E.Alt|S.Backspace}}})}run(e,...t){const i=t[0],n=e.get(Ho),o=i?.widget??n.lastFocusedWidget;if(!o)return;const r=e.get(ff);o.viewModel&&r.cancelCurrentRequestForSession(o.viewModel.sessionId)}}var fb;(function(s){s.serverCount=new O("mcp.serverCount",void 0,{type:"number",description:h(7733,"Context key that has the number of registered MCP servers")}),s.hasUnknownTools=new O("mcp.hasUnknownTools",void 0,{type:"boolean",description:h(7734,"Indicates whether there are MCP servers with unknown tools.")}),s.hasServersWithErrors=new O("mcp.hasServersWithErrors",void 0,{type:"boolean",description:h(7735,"Indicates whether there are any MCP servers with errors.")}),s.toolsCount=new O("mcp.toolsCount",void 0,{type:"number",description:h(7736,"Context key that has the number of registered MCP tools")})})(fb||(fb={}));let oZ=class extends F{static{this.ID="workbench.contrib.mcp.contextKey"}constructor(e,t){super();const i=fb.serverCount.bindTo(t),n=fb.toolsCount.bindTo(t),o=fb.hasUnknownTools.bindTo(t);this._store.add(Bse(fb.hasServersWithErrors,t,r=>e.servers.read(r).some(a=>a.connectionState.read(r).state===Xc.Kind.Error))),this._store.add(fi(r=>{const a=e.servers.read(r),c=a.map(d=>d.tools.read(r));i.set(a.length),n.set(c.reduce((d,l)=>d+l.length,0)),o.set(e.lazyCollectionState.read(r)!==rx.AllKnown||a.some(d=>{if(d.trusted.read(r)===!1)return!1;const l=d.toolsState.read(r);return l===_p.Unknown||l===_p.Outdated||l===_p.RefreshingFromUnknown}))}))}};oZ=f([p(0,NI),p(1,fe)],oZ);const rMe=/("[^"\\]*(?:\\.[^"\\]*)*")|('[^'\\]*(?:\\.[^'\\]*)*')|(\/\*[^\/\*]*(?:(?:\*|\/)[^\/\*]*)*?\*\/)|(\/{2,}.*?(?:(?:\r?\n)|$))|(,\s*[}\]])/g;function aMe(s){return s.replace(rMe,function(e,t,i,n,o,r){if(n)return"";if(o){const a=o.length;return o[a-1]===`
`?o[a-2]==="\r"?`\r
`:`
`:""}else return r?e.substring(1):e})}function cMe(s){const e=aMe(s);try{return JSON.parse(e)}catch{const i=e.replace(/,\s*([}\]])/g,"$1");return JSON.parse(i)}}var qb;(function(s){s.ListServer="workbench.mcp.listServer",s.ServerOptions="workbench.mcp.serverOptions",s.ResetTrust="workbench.mcp.resetTrust",s.ResetCachedTools="workbench.mcp.resetCachedTools",s.AddConfiguration="workbench.mcp.addConfiguration",s.RemoveStoredInput="workbench.mcp.removeStoredInput",s.EditStoredInput="workbench.mcp.editStoredInput",s.ShowConfiguration="workbench.mcp.showConfiguration",s.ShowOutput="workbench.mcp.showOutput",s.RestartServer="workbench.mcp.restartServer",s.StartServer="workbench.mcp.startServer",s.StopServer="workbench.mcp.stopServer",s.InstallFromActivation="workbench.mcp.installFromActivation"})(qb||(qb={}));const P1=h(12108,"The input's id is used to associate an input with a variable of the form ${input:id}."),L1=h(12109,"The type of user input prompt to use."),rZ=h(12110,"The description is shown when the user is prompted for input."),aZ=h(12111,"The default value for the input.");h(12112,"User inputs. Used for defining user input prompts, such as free string input or a choice from several options."),h(12113,"The 'promptString' type opens an input box to ask the user for input."),h(12114,"Controls if a password input is shown. Password input hides the typed text."),h(12115,"The 'pickString' type shows a selection list."),h(12116,"An array of strings that defines the options for a quick pick."),h(12117,"Label for the option."),h(12118,"Value for the option."),h(12119,"The 'command' type executes a command."),h(12120,"The command to execute for this input variable."),h(12121,"Optional arguments passed to the command."),h(12121,"Optional arguments passed to the command."),h(12121,"Optional arguments passed to the command.");var dh;(function(s){s.ClaudeDesktop="claude-desktop",s.Windsurf="windsurf",s.CursorGlobal="cursor-global",s.CursorWorkspace="cursor-workspace"})(dh||(dh={}));Object.keys({[dh.ClaudeDesktop]:!0,[dh.Windsurf]:!0,[dh.CursorGlobal]:!0,[dh.CursorWorkspace]:!0});dh.ClaudeDesktop+"",h(7718,"Claude Desktop"),dh.Windsurf+"",h(7719,"Windsurf"),dh.CursorGlobal+"",h(7720,"Cursor (Global)"),dh.CursorWorkspace+"",h(7721,"Cursor (Workspace)");const cZ="mcp",dMe={"mcp-server-time":{command:"python",args:["-m","mcp_server_time","--local-timezone=America/Los_Angeles"],env:{}}},lMe={"my-mcp-server":{url:"http://localhost:3001/mcp",headers:{}}},iT={type:"object",additionalProperties:!1,examples:[dMe["mcp-server-time"]],properties:{type:{type:"string",enum:["stdio"],description:h(7722,"The type of the server.")},command:{type:"string",description:h(7723,"The command to run the server.")},args:{type:"array",description:h(7724,"Arguments passed to the server."),items:{type:"string"}},envFile:{type:"string",description:h(7725,"Path to a file containing environment variables for the server."),examples:["${workspaceFolder}/.env"]},env:{description:h(7726,"Environment variables passed to the server."),additionalProperties:{anyOf:[{type:"null"},{type:"string"},{type:"number"}]}}}};h(7727,"Model Context Protocol Servers"),lMe["my-mcp-server"],h(7722,"The type of the server."),h(7728,"The URL of the Streamable HTTP or SSE endpoint."),h(7729,"Additional headers sent to the server.");h(7730,"Contributes Model Context Protocol servers. Users of this should also use `vscode.lm.registerMcpConfigurationProvider`."),h(7731,"Unique ID for the collection."),h(7732,"Display name for the collection.");var Go;(function(s){s[s.Stdio=0]="Stdio",s[s.HTTP=1]="HTTP",s[s.NpmPackage=2]="NpmPackage",s[s.PipPackage=3]="PipPackage",s[s.DockerImage=4]="DockerImage"})(Go||(Go={}));const M1={[Go.NpmPackage]:{title:h(7656,"Enter NPM Package Name"),placeholder:h(7657,"Package name (e.g., @org/package)"),pickLabel:h(7658,"NPM Package"),pickDescription:h(7659,"Install from an NPM package name")},[Go.PipPackage]:{title:h(7660,"Enter Pip Package Name"),placeholder:h(7661,"Package name (e.g., package-name)"),pickLabel:h(7662,"Pip Package"),pickDescription:h(7663,"Install from a Pip package name")},[Go.DockerImage]:{title:h(7664,"Enter Docker Image Name"),placeholder:h(7665,"Image name (e.g., mcp/imagename)"),pickLabel:h(7666,"Docker Image"),pickDescription:h(7667,"Install from a Docker image")}};var zC;(function(s){s.IsSupported="github.copilot.chat.mcp.setup.check",s.ValidatePackage="github.copilot.chat.mcp.setup.validatePackage",s.StartFlow="github.copilot.chat.mcp.setup.flow"})(zC||(zC={}));let pP=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){this._explicitConfigUri=e,this._quickInputService=t,this._configurationService=i,this._jsonEditingService=n,this._workspaceService=o,this._environmentService=r,this._commandService=a,this._mcpRegistry=c,this._openerService=d,this._editorService=l,this._fileService=u,this._notificationService=g,this._telemetryService=m,this._mcpService=v}async getServerType(){const e=[{kind:Go.Stdio,label:h(7668,"Command (stdio)"),description:h(7669,"Run a local command that implements the MCP protocol")},{kind:Go.HTTP,label:h(7670,"HTTP (HTTP or Server-Sent Events)"),description:h(7671,"Connect to a remote HTTP server that implements the MCP protocol")}];let t;try{t=await this._commandService.executeCommand(zC.IsSupported)}catch{}return t&&(e.unshift({type:"separator",label:h(7672,"Manual Install")}),e.push({type:"separator",label:h(7673,"Model-Assisted")},...Object.entries(M1).map(([n,{pickLabel:o,pickDescription:r}])=>({kind:Number(n),label:o,description:r})))),(await this._quickInputService.pick(e,{placeHolder:h(7674,"Choose the type of MCP server to add")}))?.kind}async getStdioConfig(){const e=await this._quickInputService.input({title:h(7675,"Enter Command"),placeHolder:h(7676,"Command to run (with optional arguments)"),ignoreFocusLost:!0});if(!e)return;this._telemetryService.publicLog2("mcp.addserver",{packageType:"stdio"});const t=e.match(/(?:[^\s"]+|"[^"]*")+/g);return{type:"stdio",command:t[0].replace(/"/g,""),args:t.slice(1).map(i=>i.replace(/"/g,""))}}async getSSEConfig(){const e=await this._quickInputService.input({title:h(7677,"Enter Server URL"),placeHolder:h(7678,"URL of the MCP server (e.g., http://localhost:3000)"),ignoreFocusLost:!0});if(e)return this._telemetryService.publicLog2("mcp.addserver",{packageType:"sse"}),{url:e}}async getServerId(e=`my-mcp-server-${Pn().split("-")[0]}`){return await this._quickInputService.input({title:h(7679,"Enter Server ID"),placeHolder:h(7680,"Unique identifier for this server"),value:e,ignoreFocusLost:!0})}async getConfigurationTarget(){const e=[{target:us.USER,label:h(7681,"User Settings"),description:h(7682,"Available in all workspaces")}];return this._environmentService.remoteAuthority&&e.push({target:us.USER_REMOTE,label:h(7683,"Remote Settings"),description:h(7684,"Available on this remote machine")}),this._workspaceService.getWorkspace().folders.length>0&&e.push({target:us.WORKSPACE,label:h(7685,"Workspace Settings"),description:h(7686,"Available in this workspace")}),e.length===1?e[0].target:(await this._quickInputService.pick(e,{title:h(7687,"Choose where to save the configuration")}))?.target}async getAssistedConfig(e){const t=await this._quickInputService.input({ignoreFocusLost:!0,title:M1[e].title,placeHolder:M1[e].placeholder});if(!t)return;let i;(function(c){c.Retry="retry",c.Cancel="cancel",c.Allow="allow"})(i||(i={}));const o=new U().add(this._quickInputService.createQuickPick());o.title=h(7688,"Loading package details..."),o.busy=!0,o.ignoreFocusOut=!0;const r=this.getPackageType(e);switch(this._telemetryService.publicLog2("mcp.addserver",{packageType:r}),this._commandService.executeCommand(zC.ValidatePackage,{type:r,name:t,targetConfig:{...iT,properties:{...iT.properties,name:{type:"string",description:"Suggested name of the server, alphanumeric and hyphen only"}},required:[...iT.required||[],"name"]}}).then(c=>{!c||c.state==="error"?(o.title=c?.error||"Unknown error loading package",o.items=[{id:i.Retry,label:h(7689,"Try a different package")},{id:i.Cancel,label:h(7690,"Cancel")}]):(o.title=h(7691,"Install {0} from {1}?",t,c.publisher),o.items=[{id:i.Allow,label:h(7692,"Allow")},{id:i.Cancel,label:h(7690,"Cancel")}]),o.busy=!1}),await new Promise(c=>{o.onDidAccept(()=>c(o.selectedItems[0]?.id)),o.onDidHide(()=>c(void 0)),o.show()}).finally(()=>o.dispose())){case i.Retry:return this.getAssistedConfig(e);case i.Allow:break;case i.Cancel:default:return}return await this._commandService.executeCommand(zC.StartFlow,{name:t,type:r})}showOnceDiscovered(e){const t=new U;t.add(fi(i=>{const n=this._mcpRegistry.collections.read(i),o=this._mcpService.servers.read(i),r=OF(n,c=>OF(c.serverDefinitions.read(i),d=>d.label===e?{server:d,collection:c}:void 0)),a=r&&o.find(c=>c.definition.id===r.server.id);r&&a&&(r.collection.presentation?.origin?this._openerService.openEditor({resource:r.collection.presentation.origin,options:{selection:r.server.presentation?.origin?.range,preserveFocus:!0}}):this._commandService.executeCommand(qb.ServerOptions,e),a.start(!0).then(c=>{c.state===Xc.Kind.Error&&a.showOutput()}),t.dispose())})),t.add(Lp(()=>t.dispose(),5e3))}writeToUserSetting(e,t,i,n){const o={...Zve(this._configurationService.inspect(cZ),i)};return o.servers={...o.servers,[e]:t},n&&(o.inputs=[...o.inputs||[],...n]),this._configurationService.updateValue(cZ,o,i)}async run(){const e=await this.getServerType();if(e===void 0)return;let t,i,n,o;switch(e){case Go.Stdio:t=await this.getStdioConfig();break;case Go.HTTP:t=await this.getSSEConfig();break;case Go.NpmPackage:case Go.PipPackage:case Go.DockerImage:{const u=await this.getAssistedConfig(e);t=u?.server,i=u?.name,n=u?.inputs,o=u?.inputValues;break}default:sd()}if(!t)return;const r=await this.getServerId(i);if(!r)return;let a;const c=this._workspaceService.getWorkspace();if(!this._explicitConfigUri&&(a=await this.getConfigurationTarget(),!a))return;const d=this._explicitConfigUri?R.parse(this._explicitConfigUri):a===us.WORKSPACE&&c.folders.length===1?R.joinPath(c.folders[0].uri,".vscode","mcp.json"):void 0;if(d?await this._jsonEditingService.write(d,[{path:["servers",r],value:t},...(n||[]).map(u=>({path:["inputs",-1],value:u}))],!0):await this.writeToUserSetting(r,t,a,n),o)for(const[u,g]of Object.entries(o))await this._mcpRegistry.setSavedInput(u,a??us.WORKSPACE,g);const l=this.getPackageType(e);l&&this._telemetryService.publicLog2("mcp.addserver.completed",{packageType:l,serverType:t.type,target:a===us.WORKSPACE?"workspace":"user"}),this.showOnceDiscovered(r)}async pickForUrlHandler(e,t=!1){const i=decodeURIComponent(Qe(e)).replace(/\.json$/,""),n=h(7693,"Install MCP server {0}",i),o=[{id:"install",label:h(7694,"Install Server"),description:h(7695,"Install in your user settings")},{id:"show",label:h(7696,"Show Configuration",i)},{id:"rename",label:h(7697,'Rename "{0}"',i)},{id:"cancel",label:h(7690,"Cancel")}];t&&([o[0],o[1]]=[o[1],o[0]]);const r=await this._quickInputService.pick(o,{placeHolder:n,ignoreFocusLost:!0}),a=()=>this._editorService.getEditors(Ii.MOST_RECENTLY_ACTIVE).filter(c=>c.editor.resource?.toString()===e.toString());switch(r?.id){case"show":await this._editorService.openEditor({resource:e});break;case"install":await this._editorService.save(a());try{const c=await this._fileService.readFile(e),{inputs:d,...l}=cMe(c.value.toString());await this.writeToUserSetting(i,l,us.USER_LOCAL,d),this._editorService.closeEditors(a()),this.showOnceDiscovered(i)}catch(c){this._notificationService.error(h(7698,"Error installing MCP server {0}: {1}",i,c.message)),await this._editorService.openEditor({resource:e})}break;case"rename":{const c=await this._quickInputService.input({placeHolder:h(7699,"Enter new name"),value:i});if(c){const d=e.with({path:`/${encodeURIComponent(c)}.json`});return await this._editorService.save(a()),await this._fileService.move(e,d),this.pickForUrlHandler(d,t)}break}}}getPackageType(e){switch(e){case Go.NpmPackage:return"npm";case Go.PipPackage:return"pip";case Go.DockerImage:return"docker";case Go.Stdio:return"stdio";case Go.HTTP:return"sse";default:return}}};pP=f([p(1,Wt),p(2,ne),p(3,Xie),p(4,It),p(5,wn),p(6,Ge),p(7,jN),p(8,de),p(9,de),p(10,je),p(11,Dt),p(12,ai),p(13,NI)],pP);const N1="mcp-install";let dZ=class extends F{static{this.scheme=N1}constructor(e,t,i){super(),this._instaService=t,this._fileService=i,this._fileSystemProvider=new Ih(()=>this._instaService.invokeFunction(n=>{const o=n.get(je),r=new YSe;return this._register(o.registerProvider(N1,r)),N1})),this._register(e.registerHandler(this))}async handleURL(e,t){if(e.path!=="mcp/install")return!1;let i;try{i=JSON.parse(decodeURIComponent(e.query))}catch{return!1}const{name:n,...o}=i,r=this._fileSystemProvider.value,a=R.from({scheme:r,path:`/${encodeURIComponent(n)}.json`});return await this._fileService.writeFile(a,Le.fromString(JSON.stringify(o,null,"	"))),this._instaService.createInstance(pP,void 0).pickForUrlHandler(a,!0),Promise.resolve(!0)}};dZ=f([p(0,$M),p(1,Z),p(2,je)],dZ);const hMe={original:"MCP",value:"MCP"};let lZ=class extends F{constructor(e,t,i,n){super();let o;(function(a){a[a.None=0]="None",a[a.NewTools=1]="NewTools",a[a.Error=2]="Error",a[a.Refreshing=3]="Refreshing"})(o||(o={}));const r=ve(a=>{const c=t.servers.read(a),d=[];for(const g of c){let m=o.None;switch(g.toolsState.read(a)){case _p.Unknown:case _p.Outdated:g.trusted.read(a)===!1?m=o.None:m=g.connectionState.read(a).state===Xc.Kind.Error?o.Error:o.NewTools;break;case _p.RefreshingFromUnknown:m=o.Refreshing;break;default:m=g.connectionState.read(a).state===Xc.Kind.Error?o.Error:o.None;break}d[m]??=[],d[m].push(g)}const l=t.lazyCollectionState.read(a);l===rx.LoadingUnknown?d[o.Refreshing]??=[]:l===rx.HasUnknown&&(d[o.NewTools]??=[]);const u=d.length-1;return{state:u,servers:d[u]||[]}});this._store.add(e.register(N.ChatInput,qb.ListServer,(a,c)=>{if(a instanceof wr)return i.createInstance(class extends nI{render(d){super.render(d),d.classList.add("chat-mcp");const l=en("button.chat-mcp-action",[en("span@icon")]);this._register(fi(u=>{const{state:g}=r.read(u),{root:m,icon:v}=l;this.updateTooltip(),d.classList.toggle("chat-mcp-has-action",g!==o.None),m.parentElement||d.appendChild(m),m.ariaLabel=this.getLabelForState(r.read(u)),m.className="chat-mcp-action",v.className="",g===o.NewTools?(m.classList.add("chat-mcp-action-new"),v.classList.add(...ke.asClassNameArray(K.refresh))):g===o.Error?(m.classList.add("chat-mcp-action-error"),v.classList.add(...ke.asClassNameArray(K.warning))):g===o.Refreshing?(m.classList.add("chat-mcp-action-refreshing"),v.classList.add(...ke.asClassNameArray(Jve))):m.remove()}))}async onClick(d){d.preventDefault(),d.stopPropagation();const{state:l,servers:u}=r.get();if(l===o.NewTools)u.forEach(g=>g.stop().then(()=>g.start())),t.activateCollections();else if(l===o.Refreshing)u.at(-1)?.showOutput();else if(l===o.Error){const g=u.at(-1);g&&n.executeCommand(qb.ServerOptions,g.definition.id)}else n.executeCommand(qb.ListServer)}getTooltip(){return this.getLabelForState()||super.getTooltip()}getLabelForState({state:d,servers:l}=r.get()){return d===o.NewTools?h(7642,"New tools available ({0})",l.length||1):d===o.Error?h(7643,"Error loading {0} tool(s)",l.length||1):d===o.Refreshing?h(7644,"Discovering tools..."):null}},a,{...c,keybindingNotRenderedWithLabel:!0})},T.fromObservable(r)))}};lZ=f([p(0,iq),p(1,NI),p(2,Z),p(3,Ge)],lZ);class c4 extends X{static{this.ID="workbench.mcp.addConfiguration"}constructor(){super({id:c4.ID,title:I(7647,"Add Server..."),metadata:{description:I(7648,"Installs a new Model Context protocol to the mcp.json settings")},category:hMe,f1:!0,menu:{id:N.EditorContent,when:x.and(x.regex(hi.Path.key,/\.vscode[/\\]mcp\.json$/),$v.isEqualTo(roe))}})}async run(e,t){return e.get(Z).createInstance(pP,t).run()}}class d4 extends X{static{this.id="workbench.action.chat.attachTools"}constructor(){super({id:d4.id,title:h(4475,"Select Tools..."),icon:K.tools,f1:!1,category:Oa,precondition:_e.chatMode.isEqualTo(Rt.Agent),menu:{when:_e.chatMode.isEqualTo(Rt.Agent),id:N.ChatInput,group:"navigation",order:100},keybinding:{when:x.and(_e.inChatInput,_e.chatMode.isEqualTo(Rt.Agent)),primary:E.CtrlCmd|E.Shift|S.Slash,weight:W.EditorContrib}})}async run(e,...t){const i=e.get(Wt),n=e.get(NI),o=e.get(jN),r=e.get(kw),a=e.get(Ho),c=e.get(ai),d=e.get(Ge),l=e.get(Aw),u=e.get(de);let g=a.lastFocusedWidget;if(!g){let Ae=function(jn){return jn&&typeof jn=="object"&&jn.widget};const di=t[0];Ae(di)&&(g=di.widget)}if(!g)return;const m=new Map;for(const Ae of n.servers.get())for(const di of Ae.tools.get())m.set(di.id,Ae);let v;(function(Ae){Ae[Ae.Extension=0]="Extension",Ae[Ae.Mcp=1]="Mcp",Ae[Ae.Other=2]="Other"})(v||(v={}));const _={type:"item",label:h(4476,"Add MCP Server..."),iconClass:ke.asClassName(K.add),pickable:!1,run:()=>d.executeCommand(c4.ID)},w={type:"item",label:h(4477,"Install Extension..."),iconClass:ke.asClassName(K.add),pickable:!1,run:()=>l.openSearch("@tag:language-model-tools")},C={type:"item",label:h(4478,"Add More Tools..."),iconClass:ke.asClassName(K.add),pickable:!1,run:async()=>{(await i.pick([_,w],{canPickMany:!1,title:h(4479,"Add tools to chat")}))?.run()}},k={type:"item",children:[],label:h(4480,"Other Tools"),source:{type:"internal"},ordinal:v.Other,picked:!0},D=new Set(g.input.selectedToolsModel.tools.get()),A=new Map;for(const Ae of r.getTools()){if(!Ae.supportsToolPicker)continue;let di;if(Ae.source.type==="mcp"){const _i=m.get(Ae.id);if(!_i)continue;const vn=Ae.source.type+_i.definition.id;if(di=A.get(vn),!di){const Cs=o.collections.get().find(Ks=>Ks.id===_i.collection.id),on=[];Cs?.presentation?.origin&&on.push({iconClass:ke.asClassName(K.settingsGear),tooltip:h(4481,"Configure {0}",Cs.label),action:()=>u.openEditor({resource:Cs.presentation.origin})}),_i.connectionState.get().state===Xc.Kind.Error&&on.push({iconClass:ke.asClassName(K.warning),tooltip:h(4482,"Show Output"),action:()=>_i.showOutput()}),di={type:"item",label:h(4483,"MCP Server: {0}",_i?.definition.label),status:h(4484,"from {0}",_i.collection.label),ordinal:v.Mcp,source:Ae.source,picked:!1,children:[],buttons:on},A.set(vn,di)}}else if(Ae.source.type==="extension"){const _i=Ae.source.type+vs.toKey(Ae.source.extensionId);di=A.get(_i)??{type:"item",label:Ae.source.label,ordinal:v.Extension,picked:!1,source:Ae.source,children:[]},A.set(_i,di)}else Ae.source.type==="internal"?di=k:sd();const jn=D.has(Ae);di.children.push({tool:Ae,parent:di,type:"item",label:Ae.displayName,description:Ae.userDescription,picked:jn,indented:!0}),jn&&(di.picked=!0)}function B(Ae){return!!Ae.children}function q(Ae){return!!Ae.tool}function Q(Ae){return!!Ae.run}function ie(Ae){return typeof Ae.action=="function"}const oe=new U,be=[];for(const Ae of Array.from(A.values()).sort((di,jn)=>di.ordinal-jn.ordinal))be.push({type:"separator",label:Ae.status}),be.push(Ae),be.push(...Ae.children);const me=oe.add(i.createQuickPick({useSeparators:!0}));me.placeholder=h(4485,"Select tools that are available to chat"),me.canSelectMany=!0,me.keepScrollPosition=!0,me.matchOnDescription=!0,be.length===0?(me.placeholder=h(4479,"Add tools to chat"),me.canSelectMany=!1,be.push(_,w)):be.push({type:"separator"},C);let zt=new Set,ft=!1;const Qt=()=>{ft=!0;try{const Ae=be.filter(_i=>_i.type==="item"&&!!_i.picked);zt=new Set(Ae),me.selectedItems=Ae;const di=[],jn=[];for(const _i of be)_i.type==="item"&&!_i.picked&&(B(_i)?di.push(_i.source):q(_i)&&_i.parent.picked&&jn.push(_i.tool));g.input.selectedToolsModel.update(di,jn)}finally{ft=!1}};Qt(),me.items=be,me.show(),oe.add(me.onDidTriggerItemButton(Ae=>{ie(Ae.button)&&(Ae.button.action(),oe.dispose())})),oe.add(me.onDidChangeSelection(Ae=>{if(ft)return;const di=Ae.find(Q);if(di){di.run(),me.hide();return}const{added:jn,removed:_i}=Fz(zt,new Set(Ae));for(const vn of jn)if(vn.picked=!0,B(vn))for(const Cs of vn.children)Cs.picked=!0;else q(vn)&&(vn.parent.picked=!0);for(const vn of _i)if(vn.picked=!1,B(vn))for(const Cs of vn.children)Cs.picked=!1;else q(vn)&&vn.parent.children.every(Cs=>!Cs.picked)&&(vn.parent.picked=!1);Qt()})),oe.add(me.onDidAccept(()=>{me.activeItems.find(Q)?.run()})),await Promise.race([T.toPromise(T.any(me.onDidAccept,me.onDidHide))]),c.publicLog2("chat/selectedTools",{enabled:g.input.selectedToolsModel.tools.get().length,total:As.length(r.getTools())}),oe.dispose()}}let HH=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this.attachment=e,this.resourceLabels=t,this.contextKeyService=i,this.contextMenuService=n,this.hoverService=o,this.labelService=r,this.menuService=a,this.fileService=c,this.languageService=d,this.modelService=l,this.renderDisposables=this._register(new U),this.domNode=j(".chat-attached-context-attachment.show-file-icons.implicit"),this.render()}render(){Xi(this.domNode),this.renderDisposables.clear();const e=this.attachment.isPromptFile===!1?h(4515,"file"):h(4516,"prompt");this.domNode.classList.toggle("disabled",!this.attachment.enabled);const t=this.resourceLabels.create(this.domNode,{supportIcons:!0}),i=R.isUri(this.attachment.value)?this.attachment.value:this.attachment.value.uri,n=R.isUri(this.attachment.value)||!this.attachment.isSelection?void 0:this.attachment.value.range,o=Qe(i),r=_s(i),a=`${o} ${r}`,c=n?h(4517,"Attached {0}, {1}, line {2} to line {3}",e,a,n.startLineNumber,n.endLineNumber):h(4518,"Attached {0}, {1}",e,a),d=this.labelService.getUriLabel(i,{relative:!0}),l=h(4519,"Current {0} context",e),u=h(4520,"disabled"),m=`${l+(this.attachment.enabled?"":` (${u})`)}
${d}`,v=this.attachment.isPromptFile?ke.fromId(K.bookmark.id):void 0;t.setFile(i,{fileKind:Pi.FILE,hidePath:!0,range:n,title:m,icon:v}),this.domNode.ariaLabel=c,this.domNode.tabIndex=0;const _=h(4521,"Current {0}",e),w=ee(this.domNode,j("span.chat-implicit-hint",void 0,_));this._register(this.hoverService.setupManagedHover(Ir("element"),w,m));const C=this.attachment.enabled?h(4522,"Disable current {0} context",e):h(4523,"Enable current {0} context",e),k=this.renderDisposables.add(new zu(this.domNode,{supportIcons:!0,title:C}));k.icon=this.attachment.enabled?K.eye:K.eyeClosed,this.renderDisposables.add(k.onDidClick(B=>{B.stopPropagation(),this.attachment.enabled=!this.attachment.enabled}));const D=this.renderDisposables.add(this.contextKeyService.createScoped(this.domNode));this.renderDisposables.add(new hi(D,this.fileService,this.languageService,this.modelService)).set(i),this.renderDisposables.add(re(this.domNode,pe.CONTEXT_MENU,async B=>{const q=new bs(Et(B),B);Vi.stop(B,!0),this.contextMenuService.showContextMenu({contextKeyService:D,getAnchor:()=>q,getActions:()=>{const Q=this.menuService.getMenuActions(N.ChatInputResourceAttachmentContext,D,{arg:i});return rI(Q)}})}))}};HH=f([p(2,fe),p(3,bi),p(4,Ti),p(5,ui),p(6,fn),p(7,je),p(8,vi),p(9,ci)],HH);const UH=".prompt.md",$H=".instructions.md",ule="copilot-instructions.md",O1="chat.promptFiles",hZ="chat.promptFilesLocations",uZ="chat.instructionsFilesLocations",uMe=".github/prompts",gMe=".github/instructions";function pMe(s){const e=an(s.path);if(e.endsWith(UH))return"prompt";if(e.endsWith($H)||e===ule)return"instructions"}function gle(s){return pMe(s)!==void 0}const fMe=s=>s.scheme==="untitled",mMe=s=>{const e=an(s.path);return e.endsWith(UH)?an(s.path,UH):e.endsWith($H)?an(s.path,$H):e===ule?an(s.path,".md"):an(s.path)};let GH=class extends F{get uri(){return this.model.reference.uri}onDispose(e){return this._register(this._onDispose.event(e)),this}constructor(e,t,i,n,o,r,a,c,d,l){super(),this.model=e,this.resourceLabels=t,this.contextKeyService=i,this.contextMenuService=n,this.hoverService=o,this.labelService=r,this.menuService=a,this.fileService=c,this.languageService=d,this.modelService=l,this._onDispose=this._register(new M),this.renderDisposables=this._register(new U),this.domNode=j(".chat-prompt-attachment.chat-attached-context-attachment.show-file-icons.implicit"),this.render=this.render.bind(this),this.dispose=this.dispose.bind(this),this.model.onUpdate(this.render),this.model.onDispose(this.dispose),this.render()}render(){Xi(this.domNode),this.renderDisposables.clear(),this.domNode.classList.remove("warning","error","disabled");const{topError:e}=this.model,t=this.resourceLabels.create(this.domNode,{supportIcons:!0}),i=this.model.reference.uri,n=Qe(i),o=_s(i),r=`${n} ${o}`,a=this.languageService.guessLanguageIdByFilepathOrFirstLine(i)==="prompt",c=a?h(4524,"Prompt file, {0}",r):h(4525,"Instructions attachment, {0}",r),d=a?h(4526,"Prompt"):h(4527,"Instructions"),l=this.labelService.getUriLabel(i,{relative:!0});let u=`${d} ${l}`;if(e){const{errorSubject:C}=e,k=C==="root";this.domNode.classList.add(k?"error":"warning");const D=k?h(4528,"Error"):h(4529,"Warning");u+=`
[${D}]: ${e.localizedMessage}`}const g=mMe(i);t.setFile(R.file(g),{fileKind:Pi.FILE,hidePath:!0,range:void 0,title:u,icon:ke.fromId(K.bookmark.id),extraClasses:[]}),this.domNode.ariaLabel=c,this.domNode.tabIndex=0;const m=ee(this.domNode,j("span.chat-implicit-hint",void 0,d));this._register(this.hoverService.setupManagedHover(Ir("element"),m,u));const v=this.renderDisposables.add(new zu(this.domNode,{supportIcons:!0,title:h(4530,"Remove")}));v.icon=K.close,this.renderDisposables.add(v.onDidClick(C=>{C.stopPropagation(),this.model.dispose()}));const _=this.renderDisposables.add(this.contextKeyService.createScoped(this.domNode));this.renderDisposables.add(new hi(_,this.fileService,this.languageService,this.modelService)).set(i),this.renderDisposables.add(re(this.domNode,pe.CONTEXT_MENU,async C=>{const k=new bs(Et(C),C);Vi.stop(C,!0),this.contextMenuService.showContextMenu({contextKeyService:_,getAnchor:()=>k,getActions:()=>{const D=this.menuService.getMenuActions(N.ChatInputResourceAttachmentContext,_,{arg:i});return rI(D)}})}))}dispose(){this._onDispose.fire(),super.dispose()}};GH=f([p(2,fe),p(3,bi),p(4,Ti),p(5,ui),p(6,fn),p(7,je),p(8,vi),p(9,ci)],GH);const ple="prompt",fle="instructions";let zH=class extends F{onAttachmentsChange(e){return this._register(this._onAttachmentsChange.event(e)),this}get references(){return this.model.references}get chatAttachments(){return this.model.chatAttachments}allSettled(){return this.model.allSettled()}get empty(){return this.children.length===0}get hasInstructions(){return this.references.some(e=>{const t=this.modelService.getModel(e);return(t?t.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e))===fle})}constructor(e,t,i,n,o,r){super(),this.model=e,this.resourceLabels=t,this.initService=i,this.languageService=n,this.modelService=o,this.logService=r,this.children=[],this._onAttachmentsChange=this._register(new M),this.render=this.render.bind(this),this._register(this.model.onAdd(a=>{const c=this.initService.createInstance(GH,a,this.resourceLabels);c.onDispose(this.handleAttachmentDispose.bind(this,c)),this.children.push(c),this.parentNode&&this.parentNode.appendChild(c.domNode),this._onAttachmentsChange.fire()}))}handleAttachmentDispose(e){const t=`[onChildDispose] Widget for instructions attachment '${e.uri.path}'`;let i=!1;return this.children=this.children.filter(n=>n===e?(i&&this.logService.warn(`${t} is present in the children references list multiple times.`),i=!0,!1):!0),i||this.logService.warn(`${t} was disposed, but was not found in the child references.`),this.parentNode||this.logService.warn(`${t} no parent node reference found.`),this.parentNode?.removeChild(e.domNode),this._onAttachmentsChange.fire(),this}render(e){this.parentNode=e;for(const t of this.children)this.parentNode.appendChild(t.domNode);return this}dispose(){for(const e of this.children)e.dispose();super.dispose()}};zH=f([p(2,Z),p(3,vi),p(4,ci),p(5,Re)],zH);class vMe extends Error{constructor(e,t){super(e,t)}sameTypeAs(e){return e==null?!1:e instanceof this.constructor}equal(e){return this.sameTypeAs(e)}}class iS extends vMe{constructor(e,t,i){super(t,i),this.uri=e}}class l4 extends iS{constructor(e,t,i=`Failed to resolve prompt contents stream for '${e.toString()}': ${t}.`){super(e,i),this.originalError=t,this.errorType="FailedToResolveContentsStream"}}class mle extends l4{constructor(e,t){super(e,t,`Failed to open '${e.fsPath}': ${t}.`),this.errorType="OpenError"}}const gZ=" -> ";class qH extends iS{constructor(e,t){$e(t.length>=2,`Recursive path must contain at least two paths, got '${t.length}'.`),super(e,"Recursive references found."),this.recursivePath=t,this.errorType="RecursiveReferenceError"}get message(){return`${super.message} ${this.getRecursivePathString("fullpath")}`}getRecursivePathString(e,t=gZ){const i=e==="fullpath"&&t===gZ;if(i&&this.defaultPathStringCache!==void 0)return this.defaultPathStringCache;const n=this.recursivePath.map(o=>{if(e==="fullpath")return`'${o}'`;if(e==="basename")return`'${an(o)}'`;sd(e,`Unknown filename format '${e}'.`)}).join(t);return i&&(this.defaultPathStringCache=n),n}equal(e){if(!this.sameTypeAs(e)||this.uri.toString()!==e.uri.toString()||this.recursivePath.length!==e.recursivePath.length)return!1;const t=this.getRecursivePathString("fullpath"),i=e.getRecursivePathString("fullpath");return t.length!==i.length?!1:t===i}toString(){return`"${this.message}"(${this.uri})`}}class qC extends iS{constructor(e,t=""){const i=t?`: ${t}`:"";super(e,`Resource at ${e.path} is not a prompt file${i}`),this.errorType="NotPromptFileError"}}class vle extends qC{constructor(e,t=""){const i=t?`: ${t}`:"";super(e,`Entity at '${e.path}' is a folder${i}`),this.errorType="FolderReferenceError"}}class pZ{constructor(e){this.options=e,this.originalError=e.originalError,this.errorSubject=e.errorSubject,this.errorsCount=e.errorsCount,this.parentUri=e.parentUri}get localizedMessage(){const{originalError:e,parentUri:t,errorSubject:i,errorsCount:n}=this;$e(n>=1,`Error count must be at least 1, got '${n}'.`);const o=n>1?h(5083,`
(+{0} more issues)`,n-1):"";if(i==="root")return e instanceof mle?h(5084,"Cannot open '{0}'.{1}",e.uri.path,o):e instanceof l4?h(5085,"Cannot read '{0}'.{1}",e.uri.path,o):e instanceof qH?h(5086,"Recursion to itself."):e.message+o;ad(t,"Parent URI must be defined for error of non-root link.");const r=i==="child"?h(5087,"Contains"):h(5088,"Indirectly referenced prompt '{0}' contains",t.path),a=e instanceof qH?h(5089,"recursive"):h(5090,"broken");return h(5091,"{0} a {1} link to '{2}' that will be ignored.{3}",r,a,e.uri.path,o)}}class _le{constructor(e,t){this.range=e,this.message=t}}class Cp extends _le{toString(){return`warning(${this.message})${this.range}`}}class vv extends _le{toString(){return`error(${this.message})${this.range}`}}class pn{constructor(e){this._range=e}get range(){return this._range}sameRange(e){return this.range.equalsRange(e)}equals(e){return e instanceof this.constructor?this.sameRange(e.range):!1}withRange(e){return this._range=new P(e.startLineNumber??this.range.startLineNumber,e.startColumn??this.range.startColumn,e.endLineNumber??this.range.endLineNumber,e.endColumn??this.range.endColumn),this}static render(e){return e.map(aI("text")).join("")}static fullRange(e){$e(e.length>0,"Cannot get full range for an empty list of tokens.");const t=e[0],i=e[e.length-1];return $e(t.range.startLineNumber<=i.range.startLineNumber,"First token must start on previous or the same line as the last token."),t!==i&&t.range.startLineNumber===i.range.startLineNumber&&$e(t.range.endColumn<=i.range.startColumn,["First token must end at least on previous or the same column as the last token.",`First token: ${t}; Last token: ${i}.`].join(`
`)),new P(t.range.startLineNumber,t.range.startColumn,i.range.endLineNumber,i.range.endColumn)}shortText(e=32){return this.text.length<=e?this.text:`${this.text.slice(0,e-1)}...`}}class h4 extends pn{get text(){return pn.render(this.tokens)}constructor(e,t){super(e),this.tokens=t}static fromTokens(e){$e(e.length>0,"Cannot infer range from an empty list of tokens.");const t=pn.fullRange(e);return new h4(t,e)}toString(){return`text(${this.shortText()})${this.range}`}}class nD extends pn{}class sg extends nD{}class u4 extends sg{constructor(e){super(pn.fullRange(e)),this.tokens=e,this.valueTypeName="string"}get cleanText(){return pn.render(this.tokens.slice(1,this.tokens.length-1))}get text(){return pn.render(this.tokens)}toString(){return`front-matter-string(${this.shortText()})${this.range}`}}class ble{get range(){return this.recordToken.range}constructor(e,t){this.recordToken=e,this.languageId=t,this.issues=[],this.issues.push(...this.validate())}get diagnostics(){return this.issues}get errorDiagnostics(){return this.diagnostics.filter(e=>e instanceof vv)}get warningDiagnostics(){return this.diagnostics.filter(e=>e instanceof Cp)}}class g4 extends ble{get text(){return this.valueToken?.cleanText}constructor(e,t,i){const n=t.nameToken.text;$e(n===e,`Record token must be '${e}', got '${n}'.`),super(t,i)}validate(){const{valueToken:e}=this.recordToken,t=[];return e instanceof u4?(this.valueToken=e,t):(t.push(new vv(e.range,h(5078,"Value of the '{0}' metadata must be '{1}', got '{2}'.",this.recordName,"string",e.valueTypeName))),t)}}class p4 extends nD{constructor(e){super(pn.fullRange(e)),this.tokens=e}get text(){return pn.render(this.tokens)}toString(){return`front-matter-record-name(${this.shortText()})${this.range}`}}class yle extends nD{constructor(e){super(pn.fullRange(e)),this.tokens=e}get text(){return pn.render(this.tokens)}toString(){return`front-matter-delimiter(${this.shortText()})${this.range}`}}class xf extends nD{constructor(e){super(pn.fullRange(e)),this.tokens=e}get nameToken(){return this.tokens[0]}get valueToken(){return this.tokens[2]}static fromTokens(e){$e(e.length===3,`A front matter record must consist of exactly 3 tokens, got '${e.length}'.`);const t=e[0],i=e[1],n=e[2];return $e(t instanceof p4,`Token #1 must be a front matter record name, got '${t}'.`),$e(i instanceof yle,`Token #2 must be a front matter record delimiter, got '${i}'.`),$e(n instanceof sg,`Token #3 must be a front matter value, got '${n}'.`),new xf([t,i,n])}get text(){return pn.render(this.tokens)}toString(){return`front-matter-record(${this.shortText()})${this.range}`}}const F1="applyTo";class fZ extends g4{constructor(e,t){super(F1,e,t)}get recordName(){return F1}validate(){const e=[...super.validate()];if(this.valueToken===void 0)return e;if(this.languageId!==fle)return e.push(new vv(this.range,h(5075,"The '{0}' metadata record is only valid in instruction files.",this.recordName))),delete this.valueToken,e;const{cleanText:t}=this.valueToken;return this.isValidGlob(t)===!1&&(e.push(new Cp(this.valueToken.range,h(5076,"Invalid glob pattern '{0}'.",t))),delete this.valueToken),e}isValidGlob(e){try{const t=Km(e);return!e_e(t)}catch{return!1}}static isApplyToRecord(e){return e instanceof xf?e.nameToken.text===F1:!1}}class sD extends F{constructor(){super(...arguments),this._onDispose=this._register(new M),this._disposed=!1}onDispose(e){return this.disposed?(e(),this):(this._register(this._onDispose.event(e)),this)}get disposed(){return this._disposed}dispose(){this.disposed||(this._disposed=!0,this._onDispose.fire(),super.dispose())}assertNotDisposed(e){_Me(this,e)}}function _Me(s,e){if(!s.disposed)return;throw typeof e=="string"?new Error(e):e}class wle extends sD{get tokensLeft(){return this.tokens.length-this.index}constructor(e){super(),this.tokens=e,this.stream=Tne(null),this.index=0,this.sendTokens()}startStream(){return this.interval!==void 0?this:this.tokens.length===0?(this.stream.end(),this):(this.interval=setInterval(()=>{if(this.tokensLeft===0){clearInterval(this.interval),delete this.interval;return}this.sendTokens()},1),this)}stopStream(){return this.interval===void 0?this:(clearInterval(this.interval),delete this.interval,this)}sendTokens(e=25){if(this.tokensLeft<=0)return;let t=Math.min(this.tokensLeft,e);for(;t>0;)$e(this.index<this.tokens.length,`Token index '${this.index}' is out of bounds.`),this.stream.write(this.tokens[this.index]),this.index++,t--;this.tokensLeft===0&&this.stream.end()}pause(){return this.stopStream(),this.stream.pause()}resume(){return this.startStream(),this.stream.resume()}destroy(){this.dispose()}removeListener(e,t){return this.stream.removeListener(e,t)}on(e,t){if(e==="data"){this.stream.on(e,t),this.startStream();return}if(e==="error")return this.stream.on(e,t);if(e==="end")return this.stream.on(e,t);sd(e,`Unexpected event name '${e}'.`)}dispose(){this.stopStream(),this.stream.destroy(),super.dispose()}}class Un extends pn{static newOnLine(e,t,i){const{range:n}=e;return new i(new P(n.startLineNumber,t,n.startLineNumber,t+i.symbol.length))}}class h_ extends Un{static{this.symbol="@"}get text(){return h_.symbol}toString(){return`at${this.range}`}}class Sg extends Un{static{this.symbol="	"}get text(){return Sg.symbol}toString(){return`tab${this.range}`}}class Oo extends Un{static{this.symbol="-"}get text(){return Oo.symbol}toString(){return`dash${this.range}`}}class Cg extends Un{static{this.symbol="#"}get text(){return Cg.symbol}toString(){return`hash${this.range}`}}class ul extends Un{static{this.symbol=":"}get text(){return ul.symbol}toString(){return`colon${this.range}`}}class oD extends Un{static{this.symbol="'"}get text(){return oD.symbol}sameType(e){return e instanceof this.constructor}toString(){return`quote${this.range}`}}class rD extends Un{static{this.symbol="/"}get text(){return rD.symbol}toString(){return`slash${this.range}`}}class Eg extends Un{static{this.symbol=" "}get text(){return Eg.symbol}toString(){return`space${this.range}`}}class aD extends Un{static{this.symbol=","}get text(){return aD.symbol}toString(){return`comma${this.range}`}}class If extends Un{static{this.symbol="\f"}get text(){return If.symbol}toString(){return`formfeed${this.range}`}}class nS extends Un{static{this.symbol="$"}get text(){return nS.symbol}toString(){return`dollarSign${this.range}`}}class Df extends Un{static{this.symbol="\v"}get text(){return Df.symbol}toString(){return`vtab${this.range}`}}class cD extends Un{static{this.symbol='"'}get text(){return cD.symbol}sameType(e){return e instanceof this.constructor}toString(){return`double-quote${this.range}`}}class bh extends Un{static{this.symbol="!"}get text(){return bh.symbol}toString(){return`exclamation-mark${this.range}`}}class jh extends Un{static{this.symbol="["}get text(){return jh.symbol}toString(){return`left-bracket${this.range}`}}class og extends Un{static{this.symbol="]"}get text(){return og.symbol}toString(){return`right-bracket${this.range}`}}class sS extends Un{static{this.symbol="{"}get text(){return sS.symbol}toString(){return`left-curly-brace${this.range}`}}class Wm extends Un{static{this.symbol="}"}get text(){return Wm.symbol}toString(){return`right-curly-brace${this.range}`}}class dD extends Un{static{this.symbol="("}get text(){return dD.symbol}toString(){return`left-parenthesis${this.range}`}}class BO extends Un{static{this.symbol=")"}get text(){return BO.symbol}toString(){return`right-parenthesis${this.range}`}}class rg extends Un{static{this.symbol="<"}get text(){return rg.symbol}toString(){return`left-angle-bracket${this.range}`}}class u_ extends Un{static{this.symbol=">"}get text(){return u_.symbol}toString(){return`right-angle-bracket${this.range}`}}const sk="mode",W1=Object.freeze([Rt.Ask,Rt.Edit,Rt.Agent]);class mZ extends g4{constructor(e,t){super(sk,e,t)}get recordName(){return sk}get chatMode(){return this.value}validate(){const e=[...super.validate()];if(this.text===void 0)return e;const i=[...W1].indexOf(this.text);return i!==-1?(this.value=W1[i],e):(e.push(new vv(this.range,h(5077,"Value of the '{0}' metadata must be one of ({1}), got '{2}'.",sk,W1.map(n=>`'${n}'`).join(", "),this.text))),e)}static isModeRecord(e){return e instanceof xf?e.nameToken.text===sk:!1}}class Sle extends sg{constructor(e){super(pn.fullRange(e)),this.tokens=e,this.valueTypeName="array"}get items(){const e=[];for(const t of this.tokens)t instanceof sg&&e.push(t);return e}get text(){return pn.render(this.tokens)}toString(){return`front-matter-array(${this.shortText()})${this.range}`}}const B1="tools";class fP extends ble{get recordName(){return B1}get toolNames(){return this.validToolNames===void 0?[]:[...this.validToolNames.values()]}constructor(e,t){$e(fP.isToolsRecord(e),`Record token must be a tools token, got '${e.nameToken.text}'.`),super(e,t)}validate(){const e=[],{valueToken:t}=this.recordToken;if(!(t instanceof Sle))return e.push(new vv(t.range,h(5079,"Value of the '{0}' metadata must be '{1}', got '{2}'.",B1,"array",t.valueTypeName))),e;this.valueToken=t,this.validToolNames=new Set;for(const i of this.valueToken.items)e.push(...this.validateToolName(i,this.validToolNames));return e}validateToolName(e,t){const i=[];if(!(e instanceof u4))return i.push(new Cp(e.range,h(5080,"Expected a tool name ({0}), got '{1}'.","string",e.text))),i;const n=e.cleanText.trim();return n.length===0?(i.push(new Cp(e.range,h(5081,"Tool name cannot be empty."))),i):t.has(n)?(i.push(new Cp(e.range,h(5082,"Duplicate tool name '{0}'.",n))),i):(t.add(n),i)}static isToolsRecord(e){return e instanceof xf?e.nameToken.text===B1:!1}}const V1="description";class vZ extends g4{get recordName(){return V1}constructor(e,t){super(V1,e,t)}static isDescriptionRecord(e){return e instanceof xf?e.nameToken.text===V1:!1}}class Mo extends Un{static{this.symbol=`
`}static{this.byte=Le.fromString(Mo.symbol)}get text(){return Mo.symbol}get byte(){return Mo.byte}toString(){return`newline${this.range}`}}class Cr extends Un{static{this.symbol="\r"}static{this.byte=Le.fromString(Cr.symbol)}get byte(){return Cr.byte}get text(){return Cr.symbol}toString(){return`CR${this.range}`}}const Cle=Object.freeze([Eg,Sg,Cr,Mo,If,Df]);class Yp extends pn{constructor(e,t){super(e),this.text=t}static newOnLine(e,t,i){const{range:n}=t,o=new we(n.startLineNumber,i),r=new we(n.startLineNumber,i+e.length);return new Yp(P.fromPositions(o,r),e)}equals(e){return!super.equals(e)||!(e instanceof Yp)?!1:this.text===e.text}toString(){return`word("${this.shortText()}")${this.range}`}}class bMe extends F{constructor(e){super(),this.decoder=e,this.messages=[],this._register(e)}async*[Symbol.asyncIterator](){const e=t=>{t!==void 0?this.messages.push(t):(this.decoder.removeListener("data",e),this.decoder.removeListener("end",e)),this.resolveOnNewEvent&&(this.resolveOnNewEvent(),delete this.resolveOnNewEvent)};for(this.decoder.on("data",e),this.decoder.on("end",e),this.decoder.start();;){const t=this.messages.shift();if(t!==void 0){yield t;continue}if(this.decoder.ended)return this.dispose(),null;await new Promise(i=>{this.resolveOnNewEvent=i})}}}class kf extends sD{constructor(e){super(),this.stream=e,this._ended=!1,this._onData=this._register(new M),this._onEnd=this._register(new M),this._onError=this._register(new M),this._listeners=this._register(new ti),this.started=!1,this.settledPromise=new aa,this.tryOnStreamData=this.tryOnStreamData.bind(this),this.onStreamError=this.onStreamError.bind(this),this.onStreamEnd=this.onStreamEnd.bind(this)}get settled(){return $e(this.started,["Cannot get `settled` promise of a stream that has not been started.","Please call `start()` first."].join(" ")),this.settledPromise.p}start(){return $e(!this._ended,"Cannot start stream that has already ended."),$e(!this.disposed,"Cannot start stream that has already disposed."),this.started?this:(this.started=!0,this.stream.on("end",this.onStreamEnd),this.stream.on("error",this.onStreamError),this.stream.on("data",this.tryOnStreamData),this.stream instanceof kf&&this.stream.start(),this)}get ended(){return this._ended}tryOnStreamData(e){try{this.onStreamData(e)}catch(t){this.onStreamError(t)}}on(e,t){if(e==="data")return this.onData(t);if(e==="error")return this.onError(t);if(e==="end")return this.onEnd(t);throw new Error(`Invalid event name: ${e}`)}onData(e){$e(!this.ended,"Cannot subscribe to the `data` event because the decoder stream has already ended.");let t=this._listeners.get("data");t||(t=new ti,this._listeners.set("data",t)),t.set(e,this._onData.event(e))}onError(e){$e(!this.ended,"Cannot subscribe to the `error` event because the decoder stream has already ended.");let t=this._listeners.get("error");t||(t=new ti,this._listeners.set("error",t)),t.set(e,this._onError.event(e))}onEnd(e){$e(!this.ended,"Cannot subscribe to the `end` event because the decoder stream has already ended.");let t=this._listeners.get("end");t||(t=new ti,this._listeners.set("end",t)),t.set(e,this._onEnd.event(e))}pause(){this.stream.pause()}resume(){$e(!this.ended,"Cannot resume the stream because it has already ended."),this.stream.resume()}destroy(){this.dispose()}removeListener(e,t){const i=this._listeners.get(e);if(i!==void 0)for(const[n]of i)n===t&&i.deleteAndDispose(n)}onStreamEnd(){this._ended||(this._ended=!0,this._onEnd.fire(),this.settledPromise.complete())}onStreamError(e){this._onError.fire(e)}async consumeAll(){$e(!this._ended,"Cannot consume all messages of the stream that has already ended.");const e=[];for await(const t of this){if(t===null)break;e.push(t)}return e}[Symbol.asyncIterator](){return $e(!this._ended,"Cannot iterate on messages of the stream that has already ended."),this._register(new bMe(this))[Symbol.asyncIterator]()}dispose(){this.settledPromise.complete(),this._listeners.clearAndDisposeAll(),this.stream.removeListener("data",this.tryOnStreamData),this.stream.removeListener("error",this.onStreamError),this.stream.removeListener("end",this.onStreamEnd),this.stream.destroy(),super.dispose()}}class f4 extends pn{constructor(e,t){$e(!isNaN(e),"The line number must not be a NaN."),$e(e>0,`The line number must be >= 1, got "${e}".`),super(new P(e,1,e,t.length+1)),this.text=t}equals(e){return!super.equals(e)||!(e instanceof f4)?!1:this.text===e.text}toString(){return`line("${this.shortText()}")${this.range}`}}class yMe extends kf{constructor(){super(...arguments),this.buffer=Le.alloc(0)}onStreamData(e){this.buffer=Le.concat([this.buffer,e]),this.processData(!1)}processData(e){for(;this.buffer.byteLength>0;){const t=this.lastEmittedLine?this.lastEmittedLine.range.startLineNumber+1:1,i=this.findEndOfLineTokens(t,e),n=i[0];if(n===void 0){e&&this.emitLine(t,this.buffer.slice(0));break}this.emitLine(t,this.buffer.slice(0,n.range.startColumn-1)),ad(this.lastEmittedLine,"No last emitted line found."),i.length===1&&n instanceof Cr&&i.splice(0,1,new Mo(n.range));let o=this.lastEmittedLine.range.endColumn;for(const r of i){const a=r.byte.byteLength,c=o+a;this._onData.fire(r.withRange({startColumn:o,endColumn:c})),this.buffer=this.buffer.slice(a),o=c}}e&&$e(this.buffer.byteLength===0,"Expected the input data buffer to be empty when the stream ends.")}findEndOfLineTokens(e,t){const i=[],n=this.buffer.indexOf(Cr.byte),o=this.buffer.indexOf(Mo.byte);return n>=0&&(n<o||o===-1)?(i.push(new Cr(new P(e,n+1,e,n+1+Cr.byte.byteLength))),o===n+1&&i.push(new Mo(new P(e,o+1,e,o+1+Mo.byte.byteLength))),this.buffer.byteLength>n+1||t?i:[]):(o>=0&&i.push(new Mo(new P(e,o+1,e,o+1+Mo.byte.byteLength))),i)}emitLine(e,t){const i=new f4(e,t.toString());this._onData.fire(i),this.lastEmittedLine=i,this.buffer=this.buffer.slice(t.byteLength)}onStreamEnd(){this.buffer.byteLength>0&&this.processData(!0),super.onStreamEnd()}}const Ele=Object.freeze([dD,BO,jh,og,sS,Wm,rg,u_,Eg,Sg,Df,If,ul,Cg,Oo,bh,h_,rD,nS,oD,cD,aD]),wMe=Object.freeze(Ele.map(aI("symbol")));class xle extends kf{constructor(e){super(new yMe(e))}onStreamData(e){if(e instanceof Cr||e instanceof Mo){this._onData.fire(e);return}const t=e.text.split("");let i=0;for(;i<t.length;){const n=i+1,o=Ele.find(a=>a.symbol===t[i]);if(o){this._onData.fire(Un.newOnLine(e,n,o)),i++;continue}let r="";for(;i<t.length&&!wMe.includes(t[i]);)r+=t[i],i++;this._onData.fire(Yp.newOnLine(r,e,n))}}}class qs{get consumed(){return this.isConsumed}constructor(e=[]){this.currentTokens=e,this.isConsumed=!1,this.startTokensCount=this.currentTokens.length}get tokens(){return this.currentTokens}assertNotConsumed(){$e(this.isConsumed===!1,"The parser object is already consumed and should not be used anymore.")}}function Uo(s,e,t){const i=t.value;return t.value=function(...n){return $e(this.isConsumed===!1,"The parser object is already consumed and should not be used anymore."),i.apply(this,n)},t}const _Z=Object.freeze([...Cle,aD]);class KH extends qs{constructor(e){for(const t of _Z)for(const i of Ile)$e(t!==i,`Delimiter tokens list must not contain value start token '${i}'.`);super([e]),this.startToken=e,this.arrayItemAllowed=!0}accept(e){if(this.currentValueParser!==void 0){const t=this.currentValueParser.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="failure")return this.isConsumed=!0,{result:"failure",wasTokenConsumed:n};const{nextParser:o}=t;return o instanceof sg?(this.currentTokens.push(o),delete this.currentValueParser,{result:"success",nextParser:this,wasTokenConsumed:n}):(this.currentValueParser=o,{result:"success",nextParser:this,wasTokenConsumed:n})}if(e instanceof og)return $e(this.currentValueParser===void 0,"Unexpected end of array. Last value is not finished."),this.currentTokens.push(e),this.isConsumed=!0,{result:"success",nextParser:this.asArrayToken(),wasTokenConsumed:!0};for(const t of _Z)if(e instanceof t)return this.currentTokens.push(e),this.arrayItemAllowed===!1&&e instanceof aD&&(this.arrayItemAllowed=!0),{result:"success",nextParser:this,wasTokenConsumed:!0};return this.arrayItemAllowed===!0&&jy.isValueStartToken(e)?(this.currentValueParser=new jy,this.arrayItemAllowed=!1,this.accept(e)):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}asArrayToken(){this.isConsumed=!0;const e=this.currentTokens[this.currentTokens.length-1];ad(e,"No tokens found."),$e(e instanceof og,"Cannot find a closing bracket of the array.");const t=[];for(const i of this.currentTokens)i instanceof sg&&t.push(i);return new Sle([this.startToken,...t,e])}}KH.__decorator=f([Uo],KH.prototype,"accept",null);class jH extends qs{constructor(e){super([e]),this.startToken=e}accept(e){return this.currentTokens.push(e),e instanceof Un&&this.startToken.sameType(e)?{result:"success",nextParser:this.asStringToken(),wasTokenConsumed:!0}:{result:"success",nextParser:this,wasTokenConsumed:!0}}asStringToken(){const e=this.currentTokens[this.currentTokens.length-1];return ad(e,"No matching end token found."),$e(this.startToken.sameType(e),`String starts with \`${this.startToken.text}\`, but ends with \`${e.text}\`.`),new u4([this.startToken,...this.currentTokens.slice(1,this.currentTokens.length-1),e])}}jH.__decorator=f([Uo],jH.prototype,"accept",null);class m4 extends sg{constructor(e,t){super(e),this.value=t,this.valueTypeName="boolean"}static fromToken(e){const t=SMe(e);return ad(t,`Cannot convert '${e}' to a boolean value.`),new m4(e.range,t)}get text(){return`${this.value}`}toString(){return`front-matter-boolean(${this.shortText()})${this.range}`}}const SMe=s=>s.text.toLowerCase()==="true"?!0:s.text.toLowerCase()==="false"?!1:null,Ile=Object.freeze([Yp,oD,cD,jh]);class jy extends qs{get tokens(){return this.currentValueParser===void 0?[]:this.currentValueParser.tokens}accept(e){if(this.currentValueParser!==void 0){const t=this.currentValueParser.accept(e),{result:i,wasTokenConsumed:n}=t;if(this.isConsumed=this.currentValueParser.consumed,i==="success"){const{nextParser:o}=t;return o instanceof sg?{result:"success",nextParser:o,wasTokenConsumed:n}:(this.currentValueParser=o,{result:"success",nextParser:this,wasTokenConsumed:n})}return{result:"failure",wasTokenConsumed:n}}if(e instanceof oD||e instanceof cD)return this.currentValueParser=new jH(e),{result:"success",nextParser:this,wasTokenConsumed:!0};if(e instanceof jh)return this.currentValueParser=new KH(e),{result:"success",nextParser:this,wasTokenConsumed:!0};if(e instanceof Yp){this.isConsumed=!0;try{return{result:"success",nextParser:m4.fromToken(e),wasTokenConsumed:!0}}catch{return{result:"failure",wasTokenConsumed:!1}}}return this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}}static isValueStartToken(e){for(const t of Ile)if(e instanceof t)return!0;return!1}}jy.__decorator=f([Uo],jy.prototype,"accept",null);const CMe=[Yp,Oo],v4=[Eg,Sg],EMe=[...v4,ul];class YH extends qs{constructor(e){super([e])}accept(e){for(const t of CMe)if(e instanceof t)return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0};for(const t of EMe)if(e instanceof t){const i=new p4(this.currentTokens);return this.isConsumed=!0,{result:"success",nextParser:new QH([i,e]),wasTokenConsumed:!0}}return this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}}}YH.__decorator=f([Uo],YH.prototype,"accept",null);class QH extends qs{constructor(e){super([...e])}accept(e){const t=this.currentTokens[this.currentTokens.length-1];if((e instanceof Eg||e instanceof Sg)===!0&&t instanceof ul){const n=new yle([t,e]),o=this.currentTokens[0];return $e(o instanceof p4,`Expected a front matter record name, got '${o}'.`),this.isConsumed=!0,{result:"success",nextParser:new XH([o,n]),wasTokenConsumed:!0}}for(const n of v4)if(e instanceof n)return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0};return e instanceof ul?(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}}QH.__decorator=f([Uo],QH.prototype,"accept",null);class XH extends qs{constructor(e){super(e)}accept(e){if(this.currentValueParser!==void 0){const t=this.currentValueParser.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="failure")return this.isConsumed=!0,{result:"failure",wasTokenConsumed:n};const{nextParser:o}=t;if(o instanceof sg){this.currentTokens.push(o),delete this.currentValueParser,this.isConsumed=!0;try{return{result:"success",nextParser:xf.fromTokens([this.currentTokens[0],this.currentTokens[1],o]),wasTokenConsumed:n}}catch{return{result:"failure",wasTokenConsumed:n}}}return this.currentValueParser=o,{result:"success",nextParser:this,wasTokenConsumed:n}}for(const t of v4)if(e instanceof t)return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0};return jy.isValueStartToken(e)?(this.currentValueParser=new jy,this.accept(e)):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}}XH.__decorator=f([Uo],XH.prototype,"accept",null);class xMe extends kf{constructor(e){if(e instanceof wle){super(e);return}super(new xle(e))}onStreamData(e){if(this.current!==void 0){const t=this.current.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="failure"){this.reEmitCurrentTokens(),n===!1&&this._onData.fire(e),delete this.current;return}const{nextParser:o}=t;if(o instanceof nD){this._onData.fire(o),n===!1&&this._onData.fire(e),delete this.current;return}this.current=o,n===!1&&this._onData.fire(e);return}if(e instanceof Yp){this.current=new YH(e);return}for(const t of Cle)if(e instanceof t){this._onData.fire(e);return}this.reEmitCurrentTokens()}onStreamEnd(){try{if(this.current===void 0)return;this.reEmitCurrentTokens()}finally{delete this.current,super.onStreamEnd()}}reEmitCurrentTokens(){if(this.current!==void 0){for(const e of this.current.tokens)this._onData.fire(e);delete this.current}}}class IMe extends F{get metadata(){return Object.freeze({...this.meta})}get diagnostics(){return this.issues}constructor(e,t){super(),this.contentsToken=e,this.languageId=t,this.issues=[],this.meta={},this.recordNames=new Set,this.stream=this._register(new xMe(new wle(e.tokens))),this.stream.onData(this.onData.bind(this)),this.stream.onError(this.onError.bind(this))}onData(e){if(!(e instanceof xf)){if(e instanceof Un)return;this.issues.push(new vv(e.range,h(5070,"Unexpected token '{0}'.",e.text)));return}const t=e.nameToken.text;if(this.recordNames.has(t)){this.issues.push(new Cp(e.range,h(5071,"Duplicate metadata record '{0}' will be ignored.",t)));return}if(vZ.isDescriptionRecord(e)){const i=new vZ(e,this.languageId),{diagnostics:n}=i;this.issues.push(...n),this.meta.description=i,this.recordNames.add(t);return}if(fP.isToolsRecord(e)){const i=new fP(e,this.languageId),{diagnostics:n}=i;return this.issues.push(...n),this.meta.tools=i,this.recordNames.add(t),this.validateToolsAndModeCompatibility()}if(mZ.isModeRecord(e)){const i=new mZ(e,this.languageId),{diagnostics:n}=i;return this.issues.push(...n),this.meta.mode=i,this.recordNames.add(t),this.validateToolsAndModeCompatibility()}if(fZ.isApplyToRecord(e)){const i=new fZ(e,this.languageId),{diagnostics:n}=i;this.issues.push(...n),this.meta.applyTo=i,this.recordNames.add(t);return}this.issues.push(new Cp(e.range,h(5072,"Unknown metadata record '{0}' will be ignored.",t)))}get toolsAndModeCompatible(){const{tools:e,mode:t}=this.meta;return e===void 0||t===void 0||t.chatMode===Rt.Agent}validateToolsAndModeCompatibility(){if(this.toolsAndModeCompatible===!0)return;const{tools:e,mode:t}=this.meta;ad(e,"Tools metadata must have been present."),ad(t,"Mode metadata must have been present."),$e(t.chatMode!==Rt.Agent,"Mode metadata must not be agent mode."),this.issues.push(new Cp(t.range,h(5073,"Record '{0}' is implied to have the '{1}' value if '{2}' record is present so the specified value will be ignored.",t.recordName,Rt.Agent,e.recordName)))}onError(e){this.issues.push(new vv(this.contentsToken.range,h(5074,"Failed to parse prompt header: {0}",e.message)))}get settled(){return this.stream.settled}start(){return this.stream.start(),this}}class oS extends pn{}const ZH="#",bZ=":";class VO extends oS{constructor(e,t){for(const i of t)$e(_4.includes(i)===!1&&lD.includes(i)===!1,`Variable 'name' cannot contain character '${i}', got '${t}'.`);super(e),this.name=t}get text(){return`${ZH}${this.name}`}equals(e){return!super.sameRange(e.range)||!(e instanceof VO)||this.text.length!==e.text.length?!1:this.text===e.text}toString(){return`${this.text}${this.range}`}}class Yy extends VO{constructor(e,t,i){super(e,t),this.data=i;for(const n of i)$e(lD.includes(n)===!1,`Variable 'data' cannot contain character '${n}', got '${i}'.`)}get text(){return`${ZH}${this.name}${bZ}${this.data}`}equals(e){return e instanceof Yy?super.equals(e):!1}get dataRange(){const{range:e}=this,t=e.startColumn+ZH.length+this.name.length+bZ.length,i=new P(e.startLineNumber,t,e.endLineNumber,e.endColumn);if(!i.isEmpty())return i}}const lD=[Eg,Sg,Mo,Cr,Df,If,Cg,h_].map(s=>s.symbol),_4=[Cg,ul,bh,rg,u_,jh,og].map(s=>s.symbol);class mP extends qs{constructor(e){super([e])}accept(e){if(lD.includes(e.text))try{return{result:"success",nextParser:this.asPromptVariable(),wasTokenConsumed:!1}}catch{return{result:"failure",wasTokenConsumed:!1}}finally{this.isConsumed=!0}return e instanceof ul?(this.isConsumed=!0,this.currentTokens.length<=1?{result:"failure",wasTokenConsumed:!1}:{result:"success",nextParser:new vP([...this.currentTokens,e]),wasTokenConsumed:!0}):_4.includes(e.text)?(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asPromptVariable(){$e(this.currentTokens.length>1,"Cannot create a prompt variable out of incomplete token sequence.");const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1],i=this.currentTokens.slice(1),n=pn.render(i);return new VO(new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn),n)}}mP.__decorator=f([Uo],mP.prototype,"accept",null);class vP extends qs{constructor(e){const t=e[0],i=e[e.length-1];$e(e.length>2,`Tokens list must contain at least 3 items, got '${e.length}'.`),$e(t instanceof Cg,`The first token must be a '#', got '${t} '.`),$e(i instanceof ul,`The last token must be a ':', got '${i} '.`),super([...e])}accept(e){if(lD.includes(e.text)){this.isConsumed=!0;const t=this.currentTokens[0],i=this.currentTokens[this.currentTokens.length-1],n=this.currentTokens.slice(1,this.startTokensCount-1),o=this.currentTokens.slice(this.startTokensCount),r=new P(t.range.startLineNumber,t.range.startColumn,i.range.endLineNumber,i.range.endColumn),a=pn.render(n),c=pn.render(o);return{result:"success",nextParser:new Yy(r,a,c),wasTokenConsumed:!1}}return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0}}asPromptVariableWithData(){const e=this.currentTokens.slice(1,this.startTokensCount-1),t=this.currentTokens.slice(this.startTokensCount),i=pn.render(e),n=pn.render(t),o=this.currentTokens[0],r=this.currentTokens[this.currentTokens.length-1];return new Yy(new P(o.range.startLineNumber,o.range.startColumn,r.range.endLineNumber,r.range.endColumn),i,n)}}vP.__decorator=f([Uo],vP.prototype,"accept",null);const DMe="@";class b4 extends oS{constructor(e,t){for(const i of t)$e(_4.includes(i)===!1&&lD.includes(i)===!1,`Mention 'name' cannot contain character '${i}', got '${t}'.`);super(e),this.name=t}get text(){return`${DMe}${this.name}`}equals(e){return!super.sameRange(e.range)||!(e instanceof b4)||this.text.length!==e.text.length?!1:this.text===e.text}toString(){return`${this.text}${this.range}`}}const kMe=[Eg,Sg,Mo,Cr,Df,If,h_,ul,Cg].map(s=>s.symbol),TMe=[bh,rg,u_,jh,og].map(s=>s.symbol);class _P extends qs{constructor(e){super([e])}accept(e){if(kMe.includes(e.text))try{return{result:"success",nextParser:this.asPromptAtMention(),wasTokenConsumed:!1}}catch{return{result:"failure",wasTokenConsumed:!1}}finally{this.isConsumed=!0}return TMe.includes(e.text)?(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asPromptAtMention(){$e(this.currentTokens.length>1,"Cannot create a prompt @mention out of incomplete token sequence.");const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1],n=this.currentTokens.slice(1).map(aI("text")).join("");return new b4(new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn),n)}}_P.__decorator=f([Uo],_P.prototype,"accept",null);const AMe="/";class y4 extends oS{constructor(e,t){for(const i of t)$e(kle.includes(i)===!1&&Dle.includes(i)===!1,`Slash command 'name' cannot contain character '${i}', got '${t}'.`);super(e),this.name=t}get text(){return`${AMe}${this.name}`}equals(e){return!super.sameRange(e.range)||!(e instanceof y4)||this.text.length!==e.text.length?!1:this.text===e.text}toString(){return`${this.text}${this.range}`}}const Dle=[Eg,Sg,Mo,Cr,Df,If,ul,h_,Cg,rD].map(s=>s.symbol),kle=[bh,rg,u_,jh,og].map(s=>s.symbol);class bP extends qs{constructor(e){super([e])}accept(e){if(Dle.includes(e.text))try{return{result:"success",nextParser:this.asPromptSlashCommand(),wasTokenConsumed:!1}}catch{return{result:"failure",wasTokenConsumed:!1}}finally{this.isConsumed=!0}return kle.includes(e.text)?(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asPromptSlashCommand(){$e(this.currentTokens.length>1,"Cannot create a prompt /command out of incomplete token sequence.");const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1],n=this.currentTokens.slice(1).map(aI("text")).join("");return new y4(new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn),n)}}bP.__decorator=f([Uo],bP.prototype,"accept",null);class rS extends pn{}class Ep extends rS{constructor(e,t,i,n){$e(!isNaN(e),"The line number must not be a NaN."),$e(e>0,`The line number must be >= 1, got "${e}".`),$e(t>0,`The column number must be >= 1, got "${t}".`),$e(i[0]==="["&&i[i.length-1]==="]",`The caption must be enclosed in square brackets, got "${i}".`),$e(n[0]==="("&&n[n.length-1]===")",`The reference must be enclosed in parentheses, got "${n}".`),super(new P(e,t,e,t+i.length+n.length)),this.caption=i,this.reference=n;try{new URL(this.path),this.isURL=!0}catch{this.isURL=!1}}get text(){return`${this.caption}${this.reference}`}get path(){return this.reference.slice(1,this.reference.length-1)}equals(e){return!super.sameRange(e.range)||!(e instanceof Ep)?!1:this.text===e.text}get linkRange(){if(this.path.length===0)return;const{range:e}=this,t=e.startColumn+this.caption.length+1,i=t+this.path.length;return new P(e.startLineNumber,t,e.endLineNumber,i)}toString(){return`md-link("${this.shortText()}")${this.range}`}}class w4 extends rS{constructor(e,t,i,n){$e(!isNaN(e),"The line number must not be a NaN."),$e(e>0,`The line number must be >= 1, got "${e}".`),$e(t>0,`The column number must be >= 1, got "${t}".`),$e(i[0]==="!",`The caption must start with '!' character, got "${i}".`),$e(i[1]==="["&&i[i.length-1]==="]",`The caption must be enclosed in square brackets, got "${i}".`),$e(n[0]==="("&&n[n.length-1]===")",`The reference must be enclosed in parentheses, got "${n}".`),super(new P(e,t,e,t+i.length+n.length)),this.caption=i,this.reference=n;try{new URL(this.path),this.isURL=!0}catch{this.isURL=!1}}get text(){return`${this.caption}${this.reference}`}get path(){return this.reference.slice(1,this.reference.length-1)}equals(e){return!super.sameRange(e.range)||!(e instanceof w4)?!1:this.text===e.text}get linkRange(){if(this.path.length===0)return;const{range:e}=this,t=e.startColumn+this.caption.length+1,i=t+this.path.length;return new P(e.startLineNumber,t,e.endLineNumber,i)}toString(){return`md-image("${this.shortText()}")${this.range}`}}const Tle=[Cr,Mo,Df,If].map(s=>s.symbol);class Ale extends qs{constructor(e){super([e])}accept(e){return Tle.includes(e.text)?{result:"failure",wasTokenConsumed:!1}:e instanceof og?{result:"success",nextParser:new RMe([...this.tokens,e]),wasTokenConsumed:!0}:(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}}class RMe extends qs{accept(e){return e instanceof dD?{result:"success",wasTokenConsumed:!0,nextParser:new PMe([...this.tokens],e)}:{result:"failure",wasTokenConsumed:!1}}}class PMe extends qs{constructor(e,t){super([t]),this.captionTokens=e,this.openParensCount=1}get tokens(){return[...this.captionTokens,...this.currentTokens]}accept(e){if(e instanceof dD&&(this.openParensCount+=1),e instanceof BO&&(this.openParensCount-=1,$e(this.openParensCount>=0,`Unexpected right parenthesis token encountered: '${e}'.`),this.openParensCount===0)){const{startLineNumber:t,startColumn:i}=this.captionTokens[0].range,n=this.captionTokens.map(r=>r.text).join("");this.currentTokens.push(e);const o=this.currentTokens.map(r=>r.text).join("");return{result:"success",wasTokenConsumed:!0,nextParser:new Ep(t,i,n,o)}}return Tle.includes(e.text)?{result:"failure",wasTokenConsumed:!1}:(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}}class JH extends qs{constructor(e){super([e])}get tokens(){const e=this.markdownLinkParser?.tokens??[];return[...this.currentTokens,...e]}accept(e){if(!this.markdownLinkParser)return e instanceof jh?(this.markdownLinkParser=new Ale(e),{result:"success",nextParser:this,wasTokenConsumed:!0}):{result:"failure",wasTokenConsumed:!1};const t=this.markdownLinkParser.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="success"){const{nextParser:o}=t;if(o instanceof Ep){this.isConsumed=!0;const r=this.currentTokens[0];return{result:i,wasTokenConsumed:n,nextParser:new w4(r.range.startLineNumber,r.range.startColumn,`${r.text}${o.caption}`,o.reference)}}return this.markdownLinkParser=o,{result:i,wasTokenConsumed:n,nextParser:this}}return this.isConsumed=!0,t}}JH.__decorator=f([Uo],JH.prototype,"accept",null);class S4 extends rS{constructor(e,t){$e(t.startsWith("<!--"),`The comment must start with '<!--', got '${t.substring(0,10)}'.`),super(e),this.text=t}get hasEndMarker(){return this.text.endsWith("-->")}equals(e){return!super.sameRange(e.range)||!(e instanceof S4)?!1:this.text===e.text}toString(){return`md-comment("${this.shortText()}")${this.range}`}}class eU extends qs{constructor(e){super([e])}accept(e){const t=this.currentTokens[this.currentTokens.length-1];if(e instanceof bh&&t instanceof rg)return this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0};if(e instanceof Oo){if(this.currentTokens.push(e),t instanceof bh)return{result:"success",nextParser:this,wasTokenConsumed:!0};if(t instanceof Oo){const i=this.currentTokens[0],n=this.currentTokens[1],o=this.currentTokens[2],r=this.currentTokens[3];return $e(i instanceof rg,`The first token must be a '<', got '${i}'.`),$e(n instanceof bh,`The second token must be a '!', got '${n}'.`),$e(o instanceof Oo,`The third token must be a '-', got '${o}'.`),$e(r instanceof Oo,`The fourth token must be a '-', got '${r}'.`),this.isConsumed=!0,{result:"success",nextParser:new yP([i,n,o,r]),wasTokenConsumed:!0}}}return this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}}}eU.__decorator=f([Uo],eU.prototype,"accept",null);class yP extends qs{constructor(e){super(e)}accept(e){return e instanceof u_&&this.endsWithDashes?(this.currentTokens.push(e),{result:"success",nextParser:this.asMarkdownComment(),wasTokenConsumed:!0}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}asMarkdownComment(){this.isConsumed=!0;const e=this.currentTokens.map(aI("text")).join("");return new S4(this.range,e)}get range(){const e=this.currentTokens[0],t=this.currentTokens[this.currentTokens.length-1];return new P(e.range.startLineNumber,e.range.startColumn,t.range.endLineNumber,t.range.endColumn)}get endsWithDashes(){return!(!(this.currentTokens[this.currentTokens.length-1]instanceof Oo)||!(this.currentTokens[this.currentTokens.length-2]instanceof Oo))}}yP.__decorator=f([Uo],yP.prototype,"accept",null);class C4 extends rS{}class _v extends C4{get text(){return pn.render(this.tokens)}get dashTokens(){return this.tokens.filter(e=>e instanceof Oo)}constructor(e,t){super(e),this.tokens=t}static fromTokens(e){const t=pn.fullRange(e);return new _v(t,e)}toString(){return`frontmatter-marker(${this.dashTokens.length}:${this.range})`}}class Qy extends C4{constructor(e,t,i,n){super(e),this.startMarker=t,this.content=i,this.endMarker=n}get text(){return[this.startMarker.text,this.content.text,this.endMarker.text].join("")}get contentRange(){return this.content.range}get contentToken(){return this.content}equals(e){return!super.sameRange(e.range)||!(e instanceof Qy)||this.text.length!==e.text.length?!1:this.text===e.text}static fromTokens(e,t,i){const n=pn.fullRange([...e,...i]);return new Qy(n,_v.fromTokens(e),h4.fromTokens(t),_v.fromTokens(i))}toString(){return`frontmatter("${this.shortText()}")${this.range}`}}class wP extends qs{constructor(e){const{range:t}=e;$e(t.startLineNumber===1,`Front Matter header must start at the first line, but it starts at line #${t.startLineNumber}.`),$e(t.startColumn===1,`Front Matter header must start at the beginning of the line, but it starts at ${t.startColumn}.`),super([e])}accept(e){const t=this.currentTokens[this.currentTokens.length-1];return e instanceof Oo||e instanceof Cr?t instanceof Oo?(this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:this}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):e instanceof Mo?(this.isConsumed=!0,{result:"success",wasTokenConsumed:!0,nextParser:new SP(_v.fromTokens([...this.currentTokens,e]))}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}static mayStartHeader(e){return e instanceof Oo&&e.range.startLineNumber===1&&e.range.startColumn===1}}wP.__decorator=f([Uo],wP.prototype,"accept",null);class SP extends qs{constructor(e){super([]),this.startMarker=e}get tokens(){const e=this.maybeEndMarker!==void 0?this.maybeEndMarker.tokens:[];return[...this.startMarker.tokens,...this.currentTokens,...e]}asFrontMatterHeader(){return ad(this.maybeEndMarker,"Cannot convert to Front Matter header token without an end marker."),$e(this.maybeEndMarker.dashCount===this.startMarker.dashTokens.length,["Start and end markers must have the same number of dashes",`, got ${this.startMarker.dashTokens.length} / ${this.maybeEndMarker.dashCount}.`].join("")),this.isConsumed=!0,Qy.fromTokens(this.startMarker.tokens,this.currentTokens,this.maybeEndMarker.tokens)}accept(e){return this.maybeEndMarker!==void 0?this.acceptEndMarkerToken(e):!(e instanceof Oo)||e.range.startColumn!==1?(this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:this}):($e(this.maybeEndMarker===void 0,"End marker parser must not be present."),this.maybeEndMarker=new tU(e),{result:"success",wasTokenConsumed:!0,nextParser:this})}acceptEndMarkerToken(e){ad(this.maybeEndMarker,"Partial end marker parser must be initialized.");const t=this.maybeEndMarker.accept(e),{result:i,wasTokenConsumed:n}=t;if(i==="success"){const{nextParser:o}=t;if(o instanceof _v===!1)return{result:"success",wasTokenConsumed:n,nextParser:this};const a=o;return a.dashTokens.length!==this.startMarker.dashTokens.length?this.handleEndMarkerParsingFailure(a.tokens,n):(this.isConsumed=!0,{result:"success",wasTokenConsumed:!0,nextParser:Qy.fromTokens(this.startMarker.tokens,this.currentTokens,this.maybeEndMarker.tokens)})}if(i==="failure")return this.handleEndMarkerParsingFailure(this.maybeEndMarker.tokens,n);sd(i,`Unexpected result '${i}' while parsing the end marker.`)}handleEndMarkerParsingFailure(e,t){return this.currentTokens.push(...e),delete this.maybeEndMarker,{result:"success",wasTokenConsumed:t,nextParser:this}}}SP.__decorator=f([Uo],SP.prototype,"accept",null);class tU extends qs{constructor(e){const{range:t}=e;$e(t.startColumn===1,`Front Matter header must start at the beginning of the line, but it starts at ${t.startColumn}.`),super([e])}get dashCount(){return this.tokens.filter(e=>e instanceof Oo).length}accept(e){const t=this.currentTokens[this.currentTokens.length-1];return e instanceof Oo||e instanceof Cr?t instanceof Oo?(this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:this}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1}):e instanceof Mo?(this.isConsumed=!0,this.currentTokens.push(e),{result:"success",wasTokenConsumed:!0,nextParser:_v.fromTokens([...this.currentTokens])}):(this.isConsumed=!0,{result:"failure",wasTokenConsumed:!1})}}tU.__decorator=f([Uo],tU.prototype,"accept",null);class LMe extends kf{constructor(e){super(new xle(e))}onStreamData(e){if(this.current===void 0&&wP.mayStartHeader(e)){this.current=new wP(e);return}if(this.current===void 0){this._onData.fire(e);return}const t=this.current.accept(e);if(t.result==="success"){const{nextParser:i}=t;i instanceof C4?(this._onData.fire(i),delete this.current):this.current=i}else this.reEmitCurrentTokens();t.wasTokenConsumed||this.onStreamData(e)}onStreamEnd(){try{if(this.current===void 0)return;if(this.current instanceof SP){this._onData.fire(this.current.asFrontMatterHeader()),delete this.current;return}}catch{this.reEmitCurrentTokens()}finally{delete this.current,super.onStreamEnd()}}reEmitCurrentTokens(){if(this.current!==void 0){for(const e of this.current.tokens)this._onData.fire(e);delete this.current}}}class MMe extends kf{constructor(e){super(new LMe(e))}onStreamData(e){if(e instanceof jh&&!this.current){this.current=new Ale(e);return}if(e instanceof rg&&!this.current){this.current=new eU(e);return}if(e instanceof bh&&!this.current){this.current=new JH(e);return}if(!this.current){this._onData.fire(e);return}const t=this.current.accept(e);if(t.result==="success"){const{nextParser:i}=t;i instanceof rS?(this._onData.fire(i),delete this.current):this.current=i}else{for(const i of this.current.tokens)this._onData.fire(i);delete this.current}t.wasTokenConsumed||this.onStreamData(e)}onStreamEnd(){if(this.current){if(this.current instanceof yP)return this._onData.fire(this.current.asMarkdownComment()),delete this.current,this.onStreamEnd();const{tokens:e}=this.current;for(const t of[...e])this._onData.fire(t);delete this.current}super.onStreamEnd()}}class E4 extends oS{constructor(e,t){super(e),this.contents=t}get text(){return[nS.symbol,sS.symbol,this.contents,Wm.symbol].join("")}equals(e){return!super.sameRange(e.range)||!(e instanceof E4)||this.text.length!==e.text.length?!1:this.text===e.text}toString(){return`${this.text}${this.range}`}}class CP extends qs{constructor(e){super([e])}accept(e){return e instanceof sS?(this.currentTokens.push(e),this.isConsumed=!0,{result:"success",nextParser:new EP(this.currentTokens),wasTokenConsumed:!0}):{result:"failure",wasTokenConsumed:!1}}}CP.__decorator=f([Uo],CP.prototype,"accept",null);class EP extends qs{constructor(e){super(e)}accept(e){return e instanceof Wm?(this.currentTokens.push(e),this.isConsumed=!0,{result:"success",nextParser:this.asPromptTemplateVariable(),wasTokenConsumed:!0}):(this.currentTokens.push(e),{result:"success",nextParser:this,wasTokenConsumed:!0})}get contents(){const e=[];if(this.currentTokens.length<3)return"";for(let t=2;t<this.currentTokens.length;t++){const i=this.currentTokens[t],n=t===this.currentTokens.length-1;if(i instanceof Wm&&n===!0)break;e.push(i)}return pn.render(e)}asPromptTemplateVariable(){const e=this.currentTokens[0],t=this.currentTokens[1],i=this.currentTokens[this.currentTokens.length-1];return $e(this.currentTokens.length>=3,"Prompt template variable should have at least 3 tokens."),$e(i instanceof Wm,'Last token is not a "}".'),$e(e instanceof nS,'First token must be a "$".'),$e(t instanceof sS,'Second token must be a "{".'),new E4(pn.fullRange(this.currentTokens),this.contents)}}EP.__decorator=f([Uo],EP.prototype,"accept",null);class NMe extends kf{constructor(e){super(new MMe(e))}onStreamData(e){if(e instanceof Cg&&!this.current){this.current=new mP(e);return}if(e instanceof h_&&!this.current){this.current=new _P(e);return}if(e instanceof rD&&!this.current){this.current=new bP(e);return}if(e instanceof nS&&!this.current){this.current=new CP(e);return}if(!this.current){this._onData.fire(e);return}const t=this.current.accept(e);switch(t.result){case"success":{const{nextParser:i}=t;i instanceof oS?(this._onData.fire(i),delete this.current):this.current=i;break}case"failure":{this.reEmitCurrentTokens();break}}t.wasTokenConsumed||this.onStreamData(e)}onStreamEnd(){try{if(this.current===void 0)return;if(this.current instanceof mP)return this._onData.fire(this.current.asPromptVariable());if(this.current instanceof vP)return this._onData.fire(this.current.asPromptVariableWithData());if(this.current instanceof _P)return this._onData.fire(this.current.asPromptAtMention());if(this.current instanceof bP)return this._onData.fire(this.current.asPromptSlashCommand());if(this.current instanceof CP)throw new Error("Incomplete template variable token.");if(this.current instanceof EP)return this._onData.fire(this.current.asPromptTemplateVariable());sd(this.current,`Unknown parser object '${this.current}'`)}catch{this.reEmitCurrentTokens()}finally{delete this.current,super.onStreamEnd()}}reEmitCurrentTokens(){if(this.current!==void 0){for(const e of this.current.tokens)this._onData.fire(e);delete this.current}}}const OMe=Object.freeze({encode:s=>{throw new Error("The `encode` method is not implemented.")},decode:s=>new NMe(s)}),H1="file";class Bm extends Yy{constructor(e,t){super(e,H1,t),this.path=t}static from(e){return $e(e.name===H1,`Variable name must be '${H1}', got '${e.name}'.`),new Bm(e.range,e.data)}equals(e){return e instanceof Bm?super.equals(e):!1}get linkRange(){return super.dataRange}}function FMe(s,e,t){const i=t.value;ad(i,`Method '${e}' is not defined.`);const n=new WeakMap;return t.value=function(...o){let r=n.get(this);r||(r=new ti,n.set(this,r),this._register({dispose:()=>{n.get(this)?.dispose(),n.delete(this)}})),r.get(e)?.dispose(!0);const a=o.length>0?o[o.length-1]:void 0,c=Ce.isCancellationToken(a)?a:void 0,d=new li(c);return r.set(e,d),Ce.isCancellationToken(a)?o[o.length-1]=d.token:o.push(d.token),i.call(this,...o)},t}const Rle={allowNonPromptFiles:!1};class xP extends sD{constructor(e){super(),this.onChangeEmitter=this._register(new M),this.onContentChangedEmitter=this._register(new M),this.onContentChanged=this.onContentChangedEmitter.event,this.options={...Rle,...e},this.onChangeEmitter.fire=this.onChangeEmitter.fire.bind(this.onChangeEmitter)}onContentsChanged(e,t){return(t?.isCancellationRequested?Promise.reject(new fo):this.getContentsStream(e,t)).then(n=>{if(t?.isCancellationRequested||this.disposed)throw n.destroy(),new fo;this.onContentChangedEmitter.fire(n)}).catch(n=>{if(n instanceof iS){this.onContentChangedEmitter.fire(n);return}this.onContentChangedEmitter.fire(new l4(this.uri,n))}),this}start(){return $e(!this.disposed,"Cannot start contents provider that was already disposed."),this.onContentsChanged("full"),this._register(this.onChangeEmitter.event(this.onContentsChanged,this)),this}}xP.__decorator=f([FMe],xP.prototype,"onContentsChanged",null);const WMe={...Rle,seenReferences:[]};let yx=class extends sD{get tokens(){return[...this.receivedTokens]}get header(){return this.promptHeader}onSettled(e){const t=this._onSettled.event(e);return(this.stream?.ended&&this.stream.disposed===!1||this.errorCondition)&&setTimeout(e.bind(void 0,this.errorCondition)),t}onUpdate(e){return this._register(this._onUpdate.event(e)),this}get errorCondition(){return this._errorCondition}get resolveFailed(){if(this.firstParseResult.gotFirstResult)return!!this._errorCondition}async settled(){return $e(this.started,"Cannot wait on the parser that did not start yet."),await this.firstParseResult.promise,this.errorCondition?this:this.disposed?this:(ad(this.stream,"No stream reference found."),await this.stream.settled,this.promptHeader&&await this.promptHeader.settled,this)}async allSettled(){return await this.settled(),await Promise.allSettled(this.references.map(e=>e.allSettled())),this}constructor(e,t,i,n,o){super(),this.promptContentsProvider=e,this.instantiationService=i,this.workspaceService=n,this.logService=o,this.receivedTokens=[],this._references=[],this._onUpdate=this._register(new M),this._onSettled=this._register(new M),this.firstParseResult=new BMe,this.started=!1,this.options={...WMe,...t},this._onUpdate.fire=this._onUpdate.fire.bind(this._onUpdate);const r=[...this.options.seenReferences];if(r.includes(this.uri.path))return r.push(this.uri.path),this._errorCondition=new qH(this.uri,r),this._onUpdate.fire(),this.firstParseResult.complete(),this;r.push(this.uri.path),this._register(this.promptContentsProvider.onContentChanged(a=>{this.onContentsChanged(a,r),this.firstParseResult.complete()})),this.promptContentsProvider.onDispose(this.dispose.bind(this))}onContentsChanged(e,t){if(this.stream?.dispose(),delete this.stream,delete this._errorCondition,this.receivedTokens=[],this.promptHeader?.dispose(),delete this.promptHeader,this.disposeReferences(),e instanceof iS){this._errorCondition=e,this._onUpdate.fire(),this._onSettled.fire(e);return}if(this.stream=OMe.decode(e),this.stream.on("error",this.onStreamEnd.bind(this,this.stream)),this.stream.on("end",this.onStreamEnd.bind(this,this.stream)),this.stream.on("data",i=>{if((i instanceof rS||i instanceof oS)&&this.receivedTokens.push(i),i instanceof Qy){this.promptHeader=new IMe(i.contentToken,this.promptContentsProvider.languageId).start();return}if(i instanceof Yy)try{this.onReference(Bm.from(i),[...t])}catch{}i instanceof Ep&&!i.isURL&&this.onReference(i,[...t])}),this.stream.disposed){this.logService.warn(`[prompt parser][${Qe(this.uri)}] cannot start stream that has been already disposed, aborting`);return}this.stream.start()}onReference(e,t){const{parentFolder:i}=this,n=i!==null&&cy(e.path)===!1?R.joinPath(i,e.path):R.file(e.path),o=this.promptContentsProvider.createNew({uri:n}),r=this.instantiationService.createInstance(iU,o,e,{seenReferences:t});return r.onDispose(o.dispose.bind(o)),this._references.push(r),r.onUpdate(this._onUpdate.fire),this._onUpdate.fire(),r.start(),this}onStreamEnd(e,t){return e.disposed===!0?this:(t&&this.logService.warn(`[prompt parser][${Qe(this.uri)}] received an error on the chat prompt decoder stream: ${t}`),this._onUpdate.fire(),this._onSettled.fire(t),this)}disposeReferences(){for(const e of[...this._references])e.dispose();this._references.length=0}start(){return this.started?this:(this.started=!0,this.errorCondition?this:(this.promptContentsProvider.start(),this))}get uri(){return this.promptContentsProvider.uri}get parentFolder(){if(this.uri.scheme==="file")return _s(this.uri);const{folders:e}=this.workspaceService.getWorkspace();return e.length===1?e[0].uri:null}get references(){return[...this._references]}get allReferences(){const e=[];for(const t of this.references)e.push(t),t.type==="file"&&e.push(...t.allReferences);return e}get allValidReferences(){return this.allReferences.filter(e=>{const{errorCondition:t}=e;return t?t instanceof vle?!1:t instanceof qC:!0})}get allValidReferencesUris(){return this.allValidReferences.map(e=>e.uri)}get metadata(){if(this.header===void 0)return{};const{metadata:e}=this.header;if(e===void 0)return{};const{tools:t,mode:i,description:n,applyTo:o}=e;return{mode:t!==void 0?Rt.Agent:i?.chatMode,description:n?.text,tools:t?.toolNames,applyTo:o?.text}}get allToolsMetadata(){let e=!1;const t=[],{tools:i,mode:n}=this.metadata;if(i!==void 0&&(t.push(...i),e=!0),(e===!0||n===Rt.Agent)===!1)return null;for(const r of this.references){const{allToolsMetadata:a}=r;a!==null&&(t.push(...a),e=!0)}return e===!1?null:[...new Set(t)]}get errors(){const e=[];for(const t of this.references){const{errorCondition:i}=t;i&&!(i instanceof qC)&&e.push(i)}return e}get allErrors(){const e=[];for(const t of this.references){const{errorCondition:i}=t;i&&!(i instanceof qC)&&e.push({originalError:i,parentUri:this.uri}),e.push(...t.allErrors)}return e}get topError(){if(this.errorCondition)return new pZ({errorSubject:"root",errorsCount:1,originalError:this.errorCondition});const e=[...this.errors],t=[];for(const d of this.references)t.push(...d.allErrors);if(e.length===0&&t.length===0)return;const i=e[0],n=t[0],o=i!==void 0,r=o?{originalError:i,parentUri:this.uri}:n,a=e.length+t.length,c=o?"child":"indirect-child";return new pZ({errorSubject:c,originalError:r.originalError,parentUri:r.parentUri,errorsCount:a})}sameUri(e){return this.uri.toString()===e.toString()}get isPromptFile(){return gle(this.uri)}toString(){return`prompt:${this.uri.path}`}dispose(){this.disposed||(this.disposeReferences(),this.stream?.dispose(),delete this.stream,this.promptHeader?.dispose(),delete this.promptHeader,super.dispose())}};yx=f([p(2,Z),p(3,It),p(4,Re)],yx);let iU=class extends sD{constructor(e,t,i={},n){super(),this.promptContentsProvider=e,this.token=t,this.parser=this._register(n.createInstance(yx,this.promptContentsProvider,i))}get linkRange(){if(this.token instanceof Bm)return this.token.dataRange;if(this.token instanceof Ep)return this.token.linkRange}get type(){if(this.token instanceof Bm||this.token instanceof Ep)return"file";sd(this.token,`Unknown token type '${this.token}'.`)}get subtype(){if(this.token instanceof Bm)return"prompt";if(this.token instanceof Ep)return"markdown";sd(this.token,`Unknown token type '${this.token}'.`)}start(){return this.parser.start(),this}onUpdate(e){return this.parser.onUpdate(e),this}get range(){return this.token.range}get path(){return this.token.path}get text(){return this.token.text}get resolveFailed(){return this.parser.resolveFailed}get errorCondition(){return this.parser.errorCondition}get topError(){return this.parser.topError}get uri(){return this.parser.uri}get isPromptFile(){return this.parser.isPromptFile}get errors(){return this.parser.errors}get allErrors(){return this.parser.allErrors}get references(){return this.parser.references}get allReferences(){return this.parser.allReferences}get metadata(){return this.parser.metadata}get allToolsMetadata(){return this.parser.allToolsMetadata}get allValidReferences(){return this.parser.allValidReferences}async settled(){return await this.parser.settled(),this}async allSettled(){return await this.parser.allSettled(),this}toString(){return`prompt-reference/${this.type}:${this.subtype}/${this.token}`}};iU=f([p(3,Z)],iU);class BMe extends aa{constructor(){super(...arguments),this._gotResult=!1}get gotFirstResult(){return this._gotResult}get promise(){return this.p}complete(){return this._gotResult=!0,super.complete(void 0)}}var nU;let wx=nU=class extends xP{get sourceName(){return"file"}get languageId(){const e=this.modelService.getModel(this.uri);if(e!==null)return e.getLanguageId();const t=this.languageService.guessLanguageIdByFilepathOrFirstLine(this.uri);return t!==null?t:ple}constructor(e,t={},i,n,o){super(t),this.uri=e,this.fileService=i,this.modelService=n,this.languageService=o,this._register(this.fileService.onDidFilesChange(r=>{if(r.contains(this.uri,ph.ADDED,ph.UPDATED))return this.onChangeEmitter.fire("full");if(r.contains(this.uri,ph.DELETED))return this.onChangeEmitter.fire(r)}))}async getContentsStream(e,t){$e(!t?.isCancellationRequested,new fo);let i;try{const n=await this.fileService.resolve(this.uri);$e(!t?.isCancellationRequested,new fo),$e(n.isFile,new vle(this.uri));const{allowNonPromptFiles:o}=this.options;if(o!==!0&&gle(this.uri)===!1)throw new qC(this.uri);if(i=await this.fileService.readFileStream(this.uri),this.disposed||t?.isCancellationRequested)throw i.value.destroy(),new fo;return i.value}catch(n){throw n instanceof iS||n instanceof fo?n:new mle(this.uri,n)}}createNew(e,t={}){return new nU(e.uri,t,this.fileService,this.modelService,this.languageService)}toString(){return`file-prompt-contents-provider:${this.uri.path}`}};wx=nU=f([p(2,je),p(3,ci),p(4,vi)],wx);var sU;let oU=sU=class extends xP{get uri(){return this.model.uri}get sourceName(){return"text-model"}get languageId(){return this.model.getLanguageId()}constructor(e,t={},i,n){super(t),this.model=e,this.initService=i,this.logService=n,this._register(this.model.onWillDispose(this.dispose.bind(this))),this._register(this.model.onDidChangeContent(this.onChangeEmitter.fire))}async getContentsStream(e,t){const i=Tne(null);if(this.model.isDisposed())return i.end(),i.destroy(),i;let n=1;const o=this.model.getLineCount(),r=setInterval(()=>{if(n>=o&&(clearInterval(r),i.end(),i.destroy()),this.model.isDisposed()||t?.isCancellationRequested){clearInterval(r),i.error(new fo),i.destroy();return}try{i.write(Le.fromString(this.model.getLineContent(n))),n!==o&&i.write(Le.fromString(this.model.getEOL()))}catch(a){this.logService.error(["[text model contents provider]: ",`Failed to write line #${n} of text model '${this.uri.path}' to stream: `].join(""),a)}n++},1);return i}createNew(e,t={}){return e instanceof ry?this.initService.createInstance(sU,e,t):this.initService.createInstance(wx,e.uri,t)}toString(){return`text-model-prompt-contents-provider:${this.uri.path}`}};oU=sU=f([p(2,Z),p(3,Re)],oU);const VMe=(s,e,t,i)=>{if(fMe(s)){const n=t.getModel(s);return ad(n,`Cannot find model of untitled document '${s.path}'.`),i.createInstance(oU,n,e)}return i.createInstance(wx,s,e)};let rU=class extends yx{constructor(e,t={},i,n,o,r){const a=VMe(e,t,n,o);super(a,t,o,r,i),this.contentsProvider=this._register(a)}toString(){const{sourceName:e}=this.contentsProvider;return`prompt-parser:${e}:${this.uri.path}`}};rU=f([p(2,Re),p(3,ci),p(4,Z),p(5,It)],rU);let aU=class extends F{get reference(){return this._reference}get references(){const{reference:e}=this,{errorCondition:t}=e;return t?[]:[...e.allValidReferencesUris,e.uri]}get toolsMetadata(){return this.reference.allToolsMetadata}get allSettled(){return this.reference.allSettled()}get topError(){return this.reference.topError}onUpdate(e){return this._register(this._onUpdate.event(e)),this}onDispose(e){return this._register(this._onDispose.event(e)),this}constructor(e,t){super(),this.uri=e,this.initService=t,this._onUpdate=this._register(new M),this._onDispose=this._register(new M),this._reference=this._register(this.initService.createInstance(rU,this.uri,{allowNonPromptFiles:!0})),this._reference.onUpdate(this._onUpdate.fire.bind(this._onUpdate))}resolve(){return this._reference.start(),this}dispose(){this._onDispose.fire(),super.dispose()}};aU=f([p(1,Z)],aU);var cU;(function(s){s.KEY=O1,s.PROMPT_LOCATIONS_KEY=hZ,s.INSTRUCTIONS_LOCATION_KEY=uZ,s.enabled=e=>{const t=e.getValue(O1);return yZ(t)??!1},s.enabledCtx=x.equals(`config.${O1}`,!0),s.getLocationsValue=(e,t)=>{const i=t==="instructions"?uZ:hZ,n=e.getValue(i);if(!(n==null||Array.isArray(n))&&typeof n=="object"){const o={};for(const[r,a]of Object.entries(n)){const c=r.trim(),d=yZ(a);d!==void 0&&c&&(o[c]=d)}return o}},s.promptSourceFolders=(e,t)=>{const i=s.getLocationsValue(e,t),n=t==="instructions"?gMe:uMe;if(i&&typeof i=="object"){const o=[];i[n]!==!1&&o.push(n);for(const[r,a]of Object.entries(i))a===!1||r===n||o.push(r);return o}return[]}})(cU||(cU={}));const yZ=s=>{if(typeof s=="boolean")return s;if(typeof s=="string"){const e=s.trim().toLowerCase();return e==="true"?!0:e==="false"?!1:void 0}},HMe="vscode.prompt.instructions",UMe=(s,e)=>{let t=HMe;return e&&(t+=".root"),`${t}__${s}`},np=(s,e)=>{const{uri:t,isPromptFile:i}=s;let n=`${t}`;i&&(n=UMe(t,e));const o=i?`prompt:${Qe(t)}`:`file:${Qe(t)}`;return{id:n,name:o,value:t,kind:"file",modelDescription:i?"Prompt instructions file":"File attachment",isRoot:e}};let dU=class extends F{get references(){const e=[];for(const t of this.attachments.values())e.push(...t.references);return e}get toolsMetadata(){const e=[];for(const t of this.attachments.values()){const{toolsMetadata:i}=t;i!==null&&e.push(...i)}return[...new Set(e)]}get chatAttachments(){const e=[],t=[...this.attachments.values()];for(const i of t){const{reference:n}=i;e.push(...n.allValidReferences.map(o=>np(o,!1))),e.push(np({uri:n.uri,isPromptFile:!0},!0))}return e}async allSettled(){const e=[...this.attachments.values()];return await Promise.allSettled(e.map(t=>t.allSettled)),this}constructor(e,t){super(),this.initService=e,this.configService=t,this._onUpdate=this._register(new M),this.onUpdate=this._onUpdate.event,this._onAdd=this._register(new M),this.onAdd=this._onAdd.event,this._onRemove=this._register(new M),this.onRemove=this._onRemove.event,this.attachments=this._register(new ti),this._onUpdate.fire=this._onUpdate.fire.bind(this._onUpdate)}add(e){const t=Array.isArray(e)?e:[e];if(t.length!==0)for(const i of t){if(this.attachments.has(i.path))continue;const n=this.initService.createInstance(aU,i).onUpdate(this._onUpdate.fire).onDispose(()=>{this.attachments.deleteAndLeak(i.path),this._onUpdate.fire(),this._onRemove.fire(n)}).resolve();this.attachments.set(i.path,n),this._onAdd.fire(n),this._onUpdate.fire()}}remove(e){return this.attachments.has(e.path)?(this.attachments.deleteAndDispose(e.path),this):this}get featureEnabled(){return cU.enabled(this.configService)}clear(){for(const e of this.attachments.values())this.remove(e.uri);return this._onUpdate.fire(),this}};dU=f([p(0,Z),p(1,ne)],dU);let lU=class extends eW{constructor(e,t,i,n,o){super(i,t,n,o,e)}dispose(){this.textEditorModelHandle&&this.modelService.destroyModel(this.textEditorModelHandle),super.dispose()}};lU=f([p(1,vi),p(2,ci),p(3,eoe),p(4,Nr)],lU);var nT;let Qd=class extends qR{constructor(e,t,i,n,o,r,a,c,d){super(e,t,o,r,a,c,d),this.editorService=i,this.textFileService=n}save(e,t){return this.resource.scheme!==ae.untitled&&!this.fileService.hasProvider(this.resource)?this.saveAs(e,t):this.doSave(t,!1,e)}saveAs(e,t){return this.doSave(t,!0,e)}async doSave(e,t,i){let n;if(t?n=await this.textFileService.saveAs(this.resource,void 0,{...e,suggestedTarget:this.preferredResource}):n=await this.textFileService.save(this.resource,e),!!n)return{resource:n}}async revert(e,t){await this.textFileService.revert(this.resource,t)}};Qd=f([p(2,de),p(3,Ps),p(4,ui),p(5,je),p(6,Us),p(7,ir),p(8,pg)],Qd);let wZ=class extends Qd{static{nT=this}static{this.ID="workbench.editors.resourceEditorInput"}get typeId(){return nT.ID}get editorId(){return id.id}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(e,void 0,c,a,l,d,u,g,m),this.name=t,this.description=i,this.preferredLanguageId=n,this.preferredContents=o,this.textModelService=r,this.cachedModel=void 0,this.modelReference=void 0}getName(){return this.name||super.getName()}setName(e){this.name!==e&&(this.name=e,this._onDidChangeLabel.fire())}getDescription(){return this.description}setDescription(e){this.description!==e&&(this.description=e,this._onDidChangeLabel.fire())}setLanguageId(e,t){this.setPreferredLanguageId(e),this.cachedModel?.setLanguageId(e,t)}setPreferredLanguageId(e){this.preferredLanguageId=e}setPreferredContents(e){this.preferredContents=e}async resolve(){const e=this.preferredContents,t=this.preferredLanguageId;this.preferredContents=void 0,this.preferredLanguageId=void 0,this.modelReference||(this.modelReference=this.textModelService.createModelReference(this.resource));const i=await this.modelReference,n=i.object;if(!(n instanceof lU))throw i.dispose(),this.modelReference=void 0,new Error(`Unexpected model for TextResourceEditorInput: ${this.resource}`);return this.cachedModel=n,(typeof e=="string"||typeof t=="string")&&n.updateTextEditorModel(typeof e=="string"?Ane(e):void 0,t),n}matches(e){return this===e?!0:e instanceof nT?At(e.resource,this.resource):Ql(e)?super.matches(e):!1}dispose(){this.modelReference&&(this.modelReference.then(e=>e.dispose()),this.modelReference=void 0),this.cachedModel=void 0,super.dispose()}};wZ=nT=f([p(5,Ci),p(6,Ps),p(7,de),p(8,je),p(9,ui),p(10,Us),p(11,ir),p(12,pg)],wZ);var sT;let hU=class extends Qd{static{sT=this}static{this.ID="workbench.editors.untitledEditorInput"}get typeId(){return sT.ID}get editorId(){return id.id}constructor(e,t,i,n,o,r,a,c,d,l,u){super(e.resource,void 0,n,t,i,o,c,l,u),this.model=e,this.environmentService=r,this.pathService=a,this.textModelService=d,this.modelResolve=void 0,this.modelDisposables=this._register(new U),this.cachedUntitledTextEditorModelReference=void 0,this.registerModelListeners(e),this._register(this.textFileService.untitled.onDidCreate(g=>this.onDidCreateUntitledModel(g)))}registerModelListeners(e){this.modelDisposables.clear(),this.modelDisposables.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this.modelDisposables.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire())),this.modelDisposables.add(e.onDidRevert(()=>this.dispose()))}onDidCreateUntitledModel(e){At(e.resource,this.model.resource)&&e!==this.model&&(this.model=e,this.registerModelListeners(e))}getName(){return this.model.name}getDescription(e=Ot.MEDIUM){if(!this.model.hasAssociatedFilePath){const t=this.resource.path;return t!==this.getName()?t:void 0}return super.getDescription(e)}getTitle(e){if(!this.model.hasAssociatedFilePath){const t=this.getName(),i=this.getDescription();return i&&i!==t?`${t}  ${i}`:t}return super.getTitle(e)}isDirty(){return this.model.isDirty()}getEncoding(){return this.model.getEncoding()}setEncoding(e,t){return this.model.setEncoding(e)}get hasLanguageSetExplicitly(){return this.model.hasLanguageSetExplicitly}get hasAssociatedFilePath(){return this.model.hasAssociatedFilePath}setLanguageId(e,t){this.model.setLanguageId(e,t)}getLanguageId(){return this.model.getLanguageId()}async resolve(){return this.modelResolve||(this.modelResolve=(async()=>{this.cachedUntitledTextEditorModelReference=await this.textModelService.createModelReference(this.resource)})()),await this.modelResolve,this.isDisposed()&&this.disposeModelReference(),this.model}toUntyped(e){const t={resource:this.model.hasAssociatedFilePath?Wz(this.model.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):this.resource,forceUntitled:!0,options:{override:this.editorId}};return typeof e?.preserveViewState=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=this.model.isModified()?this.model.textEditorModel?.getValue():void 0,t.options.viewState=Ob(this,e.preserveViewState,this.editorService),typeof t.contents=="string"&&!this.model.hasAssociatedFilePath&&!e.preserveResource&&(t.resource=void 0)),t}matches(e){return this===e?!0:e instanceof sT?At(e.resource,this.resource):aoe(e)?super.matches(e):!1}dispose(){this.modelResolve=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){Xe(this.cachedUntitledTextEditorModelReference),this.cachedUntitledTextEditorModelReference=void 0}};hU=sT=f([p(1,Ps),p(2,ui),p(3,de),p(4,je),p(5,wn),p(6,_c),p(7,Us),p(8,Ci),p(9,ir),p(10,pg)],hU);const $Me=["text/plain","text/html","application/vnd.code.notebook.error","application/vnd.code.notebook.stdout","application/x.notebook.stdout","application/x.notebook.stream","application/vnd.code.notebook.stderr","application/x.notebook.stderr","image/png","image/jpeg","image/svg"];function GMe(s,e,t){const i=s.cellViewModel.handle,n=t.textModel,o=t.getCellByHandle(i);if(!o||o.outputsViewModels.length===0||!n)return;const r=n.uri,a=o.uri,c=n.cells.indexOf(o.model),d=s?.model.outputId;let l=0;d!==void 0&&(l=o.outputsViewModels.findIndex(v=>v.model.outputId===d));const u=ud.generateCellOutputUriWithIndex(r,a,l),g=KT(Zd(r));return{value:u,id:u.toString(),name:h(7946,"{0}  Cell {1}  Output {2}",g,`${c+1}`,`${l+1}`),icon:e==="application/vnd.code.notebook.error"?ke.fromId("error"):void 0,kind:"notebookOutput",outputIndex:l,mimeType:e}}new O("userHasOpenedNotebook",!1);new O("notebookFindWidgetFocused",!1);new O("interactiveWindowOpen",!1);new O("mostRecentReplEditor",void 0);x.equals("activeEditor",Loe);x.equals("activeEditor",FCe);x.equals("activeEditor",WCe);new O("isCompositeNotebook",!1);const zMe=new O("notebookEditorFocused",!1);new O("notebookCellListFocused",!1);new O("notebookOutputFocused",!1);new O("notebookOutputInputFocused",!1);const qMe=new O("notebookEditable",!0);new O("notebookHasRunningCell",!1);new O("notebookHasSomethingRunning",!1);new O("notebookUseConsolidatedOutputButton",!1);new O("notebookCellToolbarLocation","left");new O("notebookCursorNavigationMode",!1);new O("notebookLastCellFailed",!1);new O("notebookType",void 0);new O("notebookCellType",void 0);new O("notebookCellEditable",!1);new O("notebookCellFocused",!1);new O("notebookCellEditorFocused",!1);new O("notebookCellMarkdownEditMode",!1);new O("notebookCellLineNumbers","inherit");new O("notebookCellExecutionState",void 0);new O("notebookCellExecuting",!1);const x4=new O("notebookCellHasOutputs",!1);new O("notebookCellIsFirstOutput",!1);const KMe=new O("hasHiddenOutputs",!1);new O("notebookCellOutputMimeType",void 0);new O("notebookCellInputIsCollapsed",!1);new O("notebookCellOutputIsCollapsed",!1);new O("notebookCellResource","");new O("notebookCellGenerateByChat",!1);new O("notebookCellHasErrorDiagnostics",!1);new O("notebookCellOutputMimeTypeListForChat",[]);new O("notebookKernel",void 0);const jMe=new O("notebookKernelCount",0),YMe=new O("notebookKernelSourceCount",0);new O("notebookKernelSelected",!1);new O("notebookInterruptibleKernel",!1);new O("notebookMissingKernelExtension",!1);new O("notebookHasOutputs",!1);new O("kernelHasVariableProvider",!1);const HO=I(8079,"Notebook");W.EditorContrib;W.WorkbenchContrib+1;var SZ;(function(s){s[s.RunSection=0]="RunSection",s[s.EditCell=1]="EditCell",s[s.ExecuteAboveCells=2]="ExecuteAboveCells",s[s.ExecuteCellAndBelow=3]="ExecuteCellAndBelow",s[s.SaveCell=4]="SaveCell",s[s.SplitCell=5]="SplitCell",s[s.ClearCellOutput=6]="ClearCellOutput"})(SZ||(SZ={}));var Sx;(function(s){s.Copy="1_copy",s.Insert="2_insert",s.Edit="3_edit",s.Share="4_share"})(Sx||(Sx={}));x.or(x.greater(jMe.key,0),x.greater(YMe.key,0));ge.appendMenuItem(N.NotebookCellTitle,{submenu:N.NotebookCellInsert,title:h(8080,"Insert Cell"),group:Sx.Insert,when:qMe.isEqualTo(!0)});ge.appendMenuItem(N.EditorContext,{submenu:N.NotebookCellTitle,title:h(8081,"Notebook Cell"),group:Sx.Insert,when:zMe});ge.appendMenuItem(N.NotebookCellTitle,{title:h(8082,"Share"),submenu:N.EditorContextShare,group:Sx.Share});Pe("notebook-kernel-select",K.serverEnvironment,h(8356,"Configure icon to select a kernel in notebook editors."));Pe("notebook-execute",K.play,h(8357,"Icon to execute in notebook editors."));Pe("notebook-execute-above",K.runAbove,h(8358,"Icon to execute above cells in notebook editors."));Pe("notebook-execute-below",K.runBelow,h(8359,"Icon to execute below cells in notebook editors."));Pe("notebook-stop",K.primitiveSquare,h(8360,"Icon to stop an execution in notebook editors."));Pe("notebook-delete-cell",K.trash,h(8361,"Icon to delete a cell in notebook editors."));Pe("notebook-execute-all",K.runAll,h(8362,"Icon to execute all cells in notebook editors."));Pe("notebook-edit",K.pencil,h(8363,"Icon to edit a cell in notebook editors."));Pe("notebook-stop-edit",K.check,h(8364,"Icon to stop editing a cell in notebook editors."));Pe("notebook-move-up",K.arrowUp,h(8365,"Icon to move up a cell in notebook editors."));Pe("notebook-move-down",K.arrowDown,h(8366,"Icon to move down a cell in notebook editors."));Pe("notebook-clear",K.clearAll,h(8367,"Icon to clear cell outputs in notebook editors."));Pe("notebook-split-cell",K.splitVertical,h(8368,"Icon to split a cell in notebook editors."));Pe("notebook-state-success",K.check,h(8369,"Icon to indicate a success state in notebook editors."));Pe("notebook-state-error",K.error,h(8370,"Icon to indicate an error state in notebook editors."));Pe("notebook-state-pending",K.clock,h(8371,"Icon to indicate a pending state in notebook editors."));Pe("notebook-state-executing",K.sync,h(8372,"Icon to indicate an executing state in notebook editors."));Pe("notebook-collapsed",K.chevronRight,h(8373,"Icon to annotate a collapsed section in notebook editors."));Pe("notebook-expanded",K.chevronDown,h(8374,"Icon to annotate an expanded section in notebook editors."));Pe("notebook-open-as-text",K.fileCode,h(8375,"Icon to open the notebook in a text editor."));Pe("notebook-revert",K.discard,h(8376,"Icon to revert in notebook editors."));Pe("notebook-diff-cell-toggle-whitespace",K.whitespace,h(8377,"Icon for the toggle whitespace action in the diff editor."));Pe("notebook-render-output",K.preview,h(8378,"Icon to render output in diff editor."));Pe("notebook-mimetype",K.code,h(8379,"Icon for a mime type in notebook editors."));const Ple=Pe("notebook-copy",K.copy,h(8380,"Icon to copy content to clipboard"));Pe("notebook-diff-editor-previous-change",K.arrowUp,h(8381,"Icon for the previous change action in the diff editor."));Pe("notebook-diff-editor-next-change",K.arrowDown,h(8382,"Icon for the next change action in the diff editor."));Pe("variables-view-icon",K.variableGroup,h(8383,"View icon of the variables view."));function QMe(s){let e="";const t=s.cellViewModel;let i=t.outputsViewModels.indexOf(s),n=0;for(;i<t.model.outputs.length;){const r=t.model.outputs[i].outputs.find(a=>_q(a.mime));if(!r)break;e=e+Lle.decode(r.data.buffer),i=i+1,n++}return{text:e.trim(),count:n}}const Lle=new TextDecoder;function XMe(s,e,t=!1){let i=`${s}`;const n=1e5;if(i=Lle.decode(e.data.slice(0,n).buffer),e.data.byteLength>n)i=i+"...(truncated)";else if(s==="application/vnd.code.notebook.error"){i=i.replace(/\\u001b\[[0-9;]*m/gi,"");try{const o=JSON.parse(i);!o.stack||t?i=`${o.name}: ${o.message}`:i=o.stack}catch{}}return i.trim()}async function ZMe(s,e,t,i){const n=e.model,o=s&&CZ.includes(s)?n.outputs.find(a=>a.mime===s):n.outputs.find(a=>CZ.includes(a.mime));if(s=o?.mime,!s||!o)return;const r=_q(s)?QMe(e).text:XMe(s,o);try{await t.writeText(r)}catch(a){i.error(`Failed to copy content: ${a}`)}}const CZ=["text/latex","text/html","application/vnd.code.notebook.error","application/vnd.code.notebook.stdout","application/x.notebook.stdout","application/x.notebook.stream","application/vnd.code.notebook.stderr","application/x.notebook.stderr","text/plain","text/markdown","application/json"],JMe="notebook.cellOutput.copy";Y(class extends X{constructor(){super({id:"notebook.cellOuput.showEmptyOutputs",title:h(8042,"Show Empty Outputs"),menu:{id:N.NotebookOutputToolbar,when:x.and(x4,KMe)},f1:!1,category:HO})}run(e,t){const i=t.cell;if(i&&i.cellKind===ap.Code)for(let n=1;n<i.outputsViewModels.length;n++)i.outputsViewModels[n].visible.get()||(i.outputsViewModels[n].setVisible(!0,!0),i.updateOutputHeight(n,1,"command"))}});Y(class extends X{constructor(){super({id:JMe,title:h(8043,"Copy Cell Output"),menu:{id:N.NotebookOutputToolbar,when:x4},category:HO,icon:Ple})}getNoteboookEditor(e,t){return t&&"notebookEditor"in t?t.notebookEditor:rl(e.activeEditorPane)}async run(e,t){const i=this.getNoteboookEditor(e.get(de),t);if(!i)return;let n;if(t&&"outputId"in t&&typeof t.outputId=="string"?n=UO(t.outputId,i):t&&"outputViewModel"in t&&(n=t.outputViewModel),!n){const r=i.getActiveCell();if(!r)return;r.focusedOutputId!==void 0?n=r.outputsViewModels.find(a=>a.model.outputId===r.focusedOutputId):n=r.outputsViewModels.find(a=>a.pickedMimeType?.isTrusted)}if(!n)return;const o=n.pickedMimeType?.mimeType;if(o?.startsWith("image/")){const r={skipReveal:!0,outputId:n.model.outputId,altOutputId:n.model.alternativeOutputId};await i.focusNotebookCell(n.cellViewModel,"output",r),i.copyOutputImage(n)}else{const r=e.get(Vs),a=e.get(Re);ZMe(o,n,r,a)}}});function UO(s,e){const t=e.getViewModel();if(t){const i=t.viewCells.filter(n=>n.cellKind===ap.Code);for(const n of i){const o=n.outputsViewModels.find(r=>r.model.outputId===s||r.model.alternativeOutputId===s);if(o)return o}}}const eNe="notebook.cellOutput.openInTextEditor";Y(class extends X{constructor(){super({id:eNe,title:h(8044,"Open Cell Output in Text Editor"),f1:!1,category:HO,icon:Ple})}getNoteboookEditor(e,t){return t&&"notebookEditor"in t?t.notebookEditor:rl(e.activeEditorPane)}async run(e,t){const i=this.getNoteboookEditor(e.get(de),t),n=e.get(II);if(!i)return;let o;t&&"outputId"in t&&typeof t.outputId=="string"?o=UO(t.outputId,i):t&&"outputViewModel"in t&&(o=t.outputViewModel);const r=e.get(mi);if(o?.model.outputId&&i.textModel?.uri){const a=await n.resolve(i.textModel.uri);await r.open(ud.generateCellOutputUriWithId(i.textModel.uri,o.model.outputId)),a.dispose()}}});const tNe="notebook.cellOutput.openInOutputPreview";Y(class extends X{constructor(){super({id:tNe,title:h(8045,"Open in Output Preview"),menu:{id:N.NotebookOutputToolbar,when:x.and(x4,x.equals("config.notebook.output.openInPreviewEditor.enabled",!0))},f1:!1,category:HO})}getNotebookEditor(e,t){return t&&"notebookEditor"in t?t.notebookEditor:rl(e.activeEditorPane)}async run(e,t){const i=this.getNotebookEditor(e.get(de),t);if(!i)return;let n;if(t&&"outputId"in t&&typeof t.outputId=="string"?n=UO(t.outputId,i):t&&"outputViewModel"in t&&(n=t.outputViewModel),!n)return;const o=n.cellViewModel;if(!o)return;const r=i.getCellByHandle(o.handle);if(!r)return;const a=i.getCellIndex(r);if(a===void 0)return;const c=o.outputsViewModels.indexOf(n);if(c===-1||!i.textModel)return;const d=ud.generateOutputEditorUri(i.textModel.uri,r.id,a,n.model.outputId,c);e.get(mi).open(d,{openToSide:!0})}});const IP="application/vnd.code.additional-editor-data";let uU=class{constructor(e,t,i,n,o){this.chatWidgetService=e,this.extensionService=t,this.fileService=i,this.environmentService=n,this.logService=o,this.kind=new Ut("chat.attach.image"),this.providedPasteEditKinds=[this.kind],this.copyMimeTypes=[],this.pasteMimeTypes=["image/*"],this.imagesFolder=Ct(this.environmentService.workspaceStorageHome,"vscode-chat-images"),DRe(this.fileService,this.logService,this.imagesFolder)}async provideDocumentPasteEdits(e,t,i,n,o){if(!this.extensionService.extensions.some(D=>ay(D,"chatReferenceBinaryData")))return;const r=["image/png","image/jpeg","image/jpg","image/bmp","image/gif","image/tiff"];let a,c;for(const D of r)if(c=i.get(D),c){a=D;break}if(!c||!a)return;const d=await c.asFile()?.data();if(o.isCancellationRequested||!d)return;const l=this.chatWidgetService.getWidgetByInputUri(e.uri);if(!l)return;const u=l.attachmentModel.attachments,g=h(4843,"Pasted Image");let m=g;for(let D=2;u.some(A=>A.name===m);D++)m=`${g} ${D}`;const v=await IRe(this.fileService,this.imagesFolder,d,a);if(o.isCancellationRequested||!v)return;const _=await EO(d);if(o.isCancellationRequested||!_)return;const w=await iNe(_,a,o,m,v);if(o.isCancellationRequested||!w||(l.attachmentModel.addContext(w),l.attachmentModel.getAttachmentIDs().has(w.id)))return;const k=Nle(e,w,a,this.kind,h(4844,"Pasted Image Attachment"),this.chatWidgetService);return Ole(k)}};uU=f([p(2,je),p(3,Hs),p(4,Re)],uU);async function iNe(s,e,t,i,n){const o=await Mle(s);if(!t.isCancellationRequested)return{kind:"image",value:s,id:o,name:i,icon:K.fileMedia,mimeType:e,isPasted:!0,references:[{reference:n,kind:"reference"}]}}async function Mle(s){const e=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join("")}class nNe{constructor(){this.providedPasteEditKinds=[],this.copyMimeTypes=[IP],this.pasteMimeTypes=[]}async prepareDocumentPaste(e,t,i,n){if(e.uri.scheme===yv.INPUT_SCHEME)return;const o=new JI,r={range:t[0],uri:e.uri.toJSON()};return o.append(IP,Xw(JSON.stringify(r))),o}}class sNe{constructor(e,t){this.chatWidgetService=e,this.modelService=t,this.kind=new Ut("chat.attach.text"),this.providedPasteEditKinds=[this.kind],this.copyMimeTypes=[],this.pasteMimeTypes=[IP]}async provideDocumentPasteEdits(e,t,i,n,o){if(e.uri.scheme!==yv.INPUT_SCHEME)return;const r=i.get(Si.text),a=i.get("vscode-editor-data"),c=i.get(IP);if(!a||!r||!c)return;const d=await r.asString(),l=JSON.parse(await a.asString()),u=JSON.parse(await c.asString()),g=this.chatWidgetService.getWidgetByInputUri(e.uri);if(!g)return;const m=u.range.startLineNumber,v=u.range.endLineNumber;if(m===v){const k=this.modelService.getModel(R.revive(u.uri));if(!k||k.getLineContent(m)!==d)return}const _=oNe(d,R.revive(u.uri),l.mode,u.range);if(o.isCancellationRequested||!_||g.attachmentModel.getAttachmentIDs().has(_.id))return;const C=Nle(e,_,Si.text,this.kind,h(4845,"Pasted Code Attachment"),this.chatWidgetService);return C.yieldTo=[{kind:Ut.Empty.append("text","plain")}],Ole(C)}}function oNe(s,e,t,i){const n=Qe(e),o=i.startLineNumber,r=i.endLineNumber,a=`Copied Selection of Code: 


 From the file: ${n} From lines ${o} to ${r} 
 \`\`\`${s}\`\`\``,c=o===r?h(4846,"1 line"):h(4847,"{0} lines",r+1-o);return{kind:"paste",value:a,id:`${n}${o}${r}${i.startColumn}${i.endColumn}`,name:`${n} ${c}`,icon:K.code,pastedLines:c,language:t,fileName:e.toString(),copiedFrom:{uri:e,range:i},code:s,references:[{reference:e,kind:"reference"}]}}function Nle(s,e,t,i,n,o){const r={resource:s.uri,variable:e,undo:()=>{const a=o.getWidgetByInputUri(s.uri);if(!a)throw new Error("No widget found for undo");a.attachmentModel.delete(e.id)},redo:()=>{const a=o.getWidgetByInputUri(s.uri);if(!a)throw new Error("No widget found for redo");a.attachmentModel.addContext(e)},metadata:{needsConfirmation:!1,label:e.name}};return{insertText:"",title:n,kind:i,handledMimeType:t,additionalEdit:{edits:[r]}}}function Ole(s){return{edits:[s],dispose:()=>{}}}let EZ=class extends F{constructor(e,t,i,n,o,r,a){super(),this._register(e.documentPasteEditProvider.register({scheme:yv.INPUT_SCHEME,pattern:"*",hasAccessToAllModels:!0},new uU(t,i,n,r,a))),this._register(e.documentPasteEditProvider.register({scheme:yv.INPUT_SCHEME,pattern:"*",hasAccessToAllModels:!0},new sNe(t,o))),this._register(e.documentPasteEditProvider.register("*",new nNe))}};EZ=f([p(0,Ne),p(1,Ho),p(2,cn),p(3,je),p(4,ci),p(5,Hs),p(6,Re)],EZ);async function xZ(s,e,t,i,n,o){if(aoe(s))return await rNe(s,t,i);if(!s.resource)return;let r;try{r=await e.stat(s.resource)}catch{return}if(!r.isDirectory&&!r.isFile)return;const a=await pU(e,o,s.resource);return a?n.extensions.some(c=>ay(c,"chatReferenceBinaryData"))?a:void 0:await gU(s.resource,r.isDirectory,i)}async function rNe(s,e,t){if(s.resource)return await gU(s.resource,!1,t);const i=e.editors.filter(n=>n instanceof hU);for(const n of i)if((await n.resolve()).textEditorModel?.getValue()===s.contents)return await gU(n.resource,!1,t)}async function gU(s,e,t){let i=qn.NotOmitted;if(!e){try{(await t.createModelReference(s)).dispose()}catch{i=qn.Full}/\.(svg)$/i.test(s.path)&&(i=qn.Full)}return{kind:e?"directory":"file",value:s,id:s.toString(),name:Qe(s),omittedState:i}}const aNe=/\.(png|jpg|jpeg|gif|webp)$/i;async function pU(s,e,t,i){if(!t)return;const n=aNe.exec(t.path);if(!n)return;const o=dNe(n),r=Qe(t);let a;if(i)a=i;else{let l;try{l=await s.stat(t)}catch{return}const u=await s.readFile(t);if(l.size>30*1024*1024)throw e.error(h(4592,"Image is too large"),h(4593,"The image {0} is too large to be attached.",r)),new Error("Image is too large");a=u.value}const c=/\.gif$/i.test(t.path);return(await Fle([{id:t.toString(),name:r,data:a.buffer,icon:K.fileMedia,resource:t,mimeType:o,omittedState:c?qn.Partial:qn.NotOmitted}]))[0]}async function Fle(s){return Promise.all(s.map(async e=>({id:e.id||await Mle(e.data),name:e.name,fullName:e.resource?e.resource.path:void 0,value:await EO(e.data,e.mimeType),icon:e.icon,kind:"image",isFile:!1,isDirectory:!1,omittedState:e.omittedState||qn.NotOmitted,references:e.resource?[{reference:e.resource,kind:"reference"}]:[]})))}const cNe={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp"};function dNe(s){const e=s[1].toLowerCase();return cNe[e]}function lNe(s){return s.map(e=>{let t;return"severity"in e?t=ix.fromMarker(e):t={filterUri:R.revive(e.uri),filterSeverity:Bn.Warning},ix.toEntry(t)})}function hNe(s){return s.map(e=>{const t=R.file(e.fsPath);return{kind:"symbol",id:uNe(t,e.range),value:{uri:t,range:e.range},symbolKind:e.kind,icon:Rne.toIcon(e.kind),fullName:e.name,name:e.name}})}function uNe(s,e){let t="";return e&&(t=`:${e.startLineNumber}`,e.startLineNumber!==e.endLineNumber&&(t+=`-${e.endLineNumber}`)),s.fsPath+t}function gNe(s,e){const t=rl(e.activeEditorPane);if(!t)return[];const i=UO(s.outputId,t);if(!i)return[];const n=i.pickedMimeType?.mimeType;if(n&&$Me.includes(n)){const o=GMe(i,n,t);return o?[o]:[]}return[]}let fU=class extends F{constructor(e,t,i,n){super(),this.fileService=t,this.dialogService=i,this.webContentExtractorService=n,this._attachments=new Map,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.promptInstructions=this._register(e.createInstance(dU))}get attachments(){return Array.from(this._attachments.values())}get size(){return this._attachments.size}get fileAttachments(){return this.attachments.filter(e=>e.kind==="file"&&R.isUri(e.value)).map(e=>e.value)}getAttachmentIDs(){return new Set(this._attachments.keys())}clear(e=!1){const t=Array.from(this._attachments.keys());this._attachments.clear(),e&&this.promptInstructions.clear(),this._onDidChange.fire({deleted:t,added:[],updated:[]})}delete(...e){const t=[];for(const i of e)this._attachments.delete(i)&&t.push(i);t.length>0&&this._onDidChange.fire({deleted:t,added:[],updated:[]})}async addFile(e,t){if(/\.(png|jpe?g|gif|bmp|webp)$/i.test(e.path)){const i=await this.asImageVariableEntry(e);i&&this.addContext(i);return}this.addContext(this.asVariableEntry(e,t))}addFolder(e){this.addContext({kind:"directory",value:e,id:e.toString(),name:Qe(e)})}asVariableEntry(e,t){return{kind:"file",value:t?{uri:e,range:t}:e,id:e.toString()+(t?.toString()??""),name:Qe(e)}}async asImageVariableEntry(e){if(e.scheme===ae.file&&await this.fileService.canHandleResource(e))return await pU(this.fileService,this.dialogService,e);if(e.scheme===ae.http||e.scheme===ae.https){const t=await this.webContentExtractorService.readImage(e,Ce.None);if(t)return await pU(this.fileService,this.dialogService,e,t)}}addContext(...e){const t=[];for(const i of e)this._attachments.has(i.id)||(this._attachments.set(i.id,i),t.push(i));t.length>0&&this._onDidChange.fire({deleted:[],added:t,updated:[]})}clearAndSetContext(...e){const t=Array.from(this._attachments.keys());this._attachments.clear();const i=[];for(const n of e)this._attachments.set(n.id,n),i.push(n);(t.length>0||i.length>0)&&this._onDidChange.fire({deleted:t,added:i,updated:[]})}updateContent(e,t){const i=[],n=[],o=[];for(const r of e)this._attachments.delete(r)&&i.push(r);for(const r of t){const a=this._attachments.get(r.id);a?ic(a,r)||(this._attachments.set(r.id,r),o.push(r)):(this._attachments.set(r.id,r),n.push(r))}(i.length>0||n.length>0||o.length>0)&&this._onDidChange.fire({deleted:i,added:n,updated:o})}};fU=f([p(0,Z),p(1,je),p(2,ei),p(3,YN)],fU);const I4="revealInExplorer",$O="workbench.action.files.revert",Wle="explorer.openToSide",Ble="explorer.openWith",Vle="selectForCompare",Hle="compareSelected",Ule="compareFiles",D4="workbench.files.action.compareWithSaved",hD="copyFilePath",uD="copyRelativeFilePath",k4="workbench.action.files.saveAs",$le=I(6992,"Save As..."),GO="workbench.action.files.save",Gle=I(6993,"Save"),zle="workbench.action.files.saveWithoutFormatting",pNe=I(6994,"Save without Formatting"),T4="saveAll",fNe=I(6995,"Save All"),zO="workbench.files.action.saveAllInGroup",qle="workbench.action.files.saveFiles",g_=new O("groupFocusedInOpenEditors",!1),qO=new O("dirtyEditorFocusedInOpenEditors",!1),A4=new O("readonlyEditorFocusedInOpenEditors",!1),Kle=new O("openEditorsSelectedFileOrUntitled",!0),R4=new O("resourceSelectedForCompare",!1),jle="removeRootFolder",mNe=h(6996,"Remove Folder from Workspace"),vNe="previousCompressedFolder",_Ne="nextCompressedFolder",bNe="firstCompressedFolder",yNe="lastCompressedFolder",aS="workbench.action.files.newUntitledFile",Yle=I(6997,"New Untitled Text File"),wNe="workbench.action.files.newFile",SNe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var yu;(function(s){s[s.NO_ACTION=0]="NO_ACTION",s[s.CLOSE_PICKER=1]="CLOSE_PICKER",s[s.REFRESH_PICKER=2]="REFRESH_PICKER",s[s.REMOVE_ITEM=3]="REMOVE_ITEM"})(yu||(yu={}));function U1(s){const e=s;return Array.isArray(e.items)}function IZ(s){const e=s;return!!e.picks&&e.additionalPicks instanceof Promise}class P4 extends F{constructor(e,t){super(),this.prefix=e,this.options=t}provide(e,t,i){const n=new U;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;let o;const r=n.add(new Pt),a=async()=>{const d=r.value=new U;o?.dispose(!0),e.busy=!1,o=d.add(new li(t));const l=o.token;let u=e.value.substring(this.prefix.length);this.options?.shouldSkipTrimPickFilter||(u=u.trim());const g=this._getPicks(u,d,l,i),m=(_,w)=>{let C,k;if(U1(_)?(C=_.items,k=_.active):C=_,C.length===0){if(w)return!1;(u.length>0||e.hideInput)&&this.options?.noResultsPick&&(t_e(this.options.noResultsPick)?C=[this.options.noResultsPick(u)]:C=[this.options.noResultsPick])}return e.items=C,k&&(e.activeItems=[k]),!0},v=async _=>{let w=!1,C=!1;await Promise.all([(async()=>{typeof _.mergeDelay=="number"&&(await Da(_.mergeDelay),l.isCancellationRequested)||C||(w=m(_.picks,!0))})(),(async()=>{e.busy=!0;try{const k=await _.additionalPicks;if(l.isCancellationRequested)return;let D,A;U1(_.picks)?(D=_.picks.items,A=_.picks.active):D=_.picks;let B,q;if(U1(k)?(B=k.items,q=k.active):B=k,B.length>0||!w){let Q;if(!A&&!q){const ie=e.activeItems[0];ie&&D.indexOf(ie)!==-1&&(Q=ie)}m({items:[...D,...B],active:A||q||Q})}}finally{l.isCancellationRequested||(e.busy=!1),C=!0}})()])};if(g!==null)if(IZ(g))await v(g);else if(!(g instanceof Promise))m(g);else{e.busy=!0;try{const _=await g;if(l.isCancellationRequested)return;IZ(_)?await v(_):m(_)}finally{l.isCancellationRequested||(e.busy=!1)}}};n.add(e.onDidChangeValue(()=>a())),a(),n.add(e.onDidAccept(d=>{if(i?.handleAccept){d.inBackground||e.hide(),i.handleAccept?.(e.activeItems[0],d.inBackground);return}const[l]=e.selectedItems;typeof l?.accept=="function"&&(d.inBackground||e.hide(),l.accept(e.keyMods,d))}));const c=async(d,l)=>{if(typeof l.trigger!="function")return;const u=l.buttons?.indexOf(d)??-1;if(u>=0){const g=l.trigger(u,e.keyMods),m=typeof g=="number"?g:await g;if(t.isCancellationRequested)return;switch(m){case yu.NO_ACTION:break;case yu.CLOSE_PICKER:e.hide();break;case yu.REFRESH_PICKER:a();break;case yu.REMOVE_ITEM:{const v=e.items.indexOf(l);if(v!==-1){const _=e.items.slice(),w=_.splice(v,1),C=e.activeItems.filter(D=>D!==w[0]),k=e.keepScrollPosition;e.keepScrollPosition=!0,e.items=_,C&&(e.activeItems=C),e.keepScrollPosition=k}break}}}};return n.add(e.onDidTriggerItemButton(({button:d,item:l})=>c(d,l))),n.add(e.onDidTriggerSeparatorButton(({button:d,separator:l})=>c(d,l))),n}}const DP=0,DZ=[DP,[]];function kZ(s,e,t,i){if(!s||!e)return DZ;const n=s.length,o=e.length;if(n<o)return DZ;const r=s.toLowerCase();return CNe(e,t,o,s,r,n,i)}function CNe(s,e,t,i,n,o,r){const a=[],c=[];for(let g=0;g<t;g++){const m=g*o,v=m-o,_=g>0,w=s[g],C=e[g];for(let k=0;k<o;k++){const D=k>0,A=m+k,B=A-1,q=v+k-1,Q=D?a[B]:0,ie=_&&D?a[q]:0,oe=_&&D?c[q]:0;let be;!ie&&_?be=0:be=ENe(w,C,i,n,k,oe),be&&ie+be>=Q&&(r||_||n.startsWith(e,k))?(c[A]=oe+1,a[A]=ie+be):(c[A]=DP,a[A]=Q)}}const d=[];let l=t-1,u=o-1;for(;l>=0&&u>=0;){const g=l*o+u;c[g]===DP||(d.push(u),l--),u--}return[a[t*o-1],d.reverse()]}function ENe(s,e,t,i,n,o){let r=0;if(!xNe(e,i[n]))return r;if(r+=1,o>0&&(r+=o*5),s===t[n]&&(r+=1),n===0)r+=8;else{const a=INe(t.charCodeAt(n-1));a?r+=a:n_e(t.charCodeAt(n))&&o===0&&(r+=2)}return r}function xNe(s,e){return s===e?!0:s==="/"||s==="\\"?e==="/"||e==="\\":!1}function INe(s){switch(s){case st.Slash:case st.Backslash:return 5;case st.Underline:case st.Dash:case st.Period:case st.Space:case st.SingleQuote:case st.DoubleQuote:case st.Colon:return 4;default:return 0}}const Qle=[void 0,[]];function $1(s,e,t=0,i=0){const n=e;return n.values&&n.values.length>1?DNe(s,n.values,t,i):Xle(s,e,t,i)}function DNe(s,e,t,i){let n=0;const o=[];for(const r of e){const[a,c]=Xle(s,r,t,i);if(typeof a!="number")return Qle;n+=a,o.push(...c)}return[n,bU(o)]}function Xle(s,e,t,i){const n=Mz(e.original,e.originalLowercase,t,s,s.toLowerCase(),i,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return n?[n[0],vw(n)]:Qle}const kP=Object.freeze({score:0}),oT=1<<18,mU=1<<17,vU=65536;function kNe(s,e,t,i){const n=i.values?i.values:[i];return lc({[i.normalized]:{values:n.map(r=>({value:r.normalized,expectContiguousMatch:r.expectContiguousMatch})),label:s,description:e,allowNonContiguousMatches:t}})}function _U(s,e,t,i,n){if(!s||!e.normalized)return kP;const o=i.getItemLabel(s);if(!o)return kP;const r=i.getItemDescription(s),a=kNe(o,r,t,e),c=n[a];if(c)return c;const d=TNe(o,r,i.getItemPath(s),e);return n[a]=d,d}function TNe(s,e,t,i,n){const o=!t||!i.containsPathSeparator;return t&&(fh?i.pathNormalized===t:oo(i.pathNormalized,t))?{score:oT,labelMatch:[{start:0,end:s.length}],descriptionMatch:e?[{start:0,end:e.length}]:void 0}:i.values&&i.values.length>1?ANe(s,e,t,i.values,o):Zle(s,e,t,i,o)}function ANe(s,e,t,i,n,o){let r=0;const a=[],c=[];for(const d of i){const{score:l,labelMatch:u,descriptionMatch:g}=Zle(s,e,t,d,n);if(l===DP)return kP;r+=l,u&&a.push(...u),g&&c.push(...g)}return{score:r,labelMatch:bU(a),descriptionMatch:bU(c)}}function Zle(s,e,t,i,n,o){if(n||!e){const[r,a]=kZ(s,i.normalized,i.normalizedLowercase,!i.expectContiguousMatch);if(r){const c=Bz(i.normalized,s);let d;if(c){d=mU;const l=Math.round(i.normalized.length/s.length*100);d+=l}else d=vU;return{score:d+r,labelMatch:c||TZ(a)}}}if(e){let r=e;t&&(r=`${e}${XT}`);const a=r.length,c=`${r}${s}`,[d,l]=kZ(c,i.normalized,i.normalizedLowercase,!i.expectContiguousMatch);if(d){const u=TZ(l),g=[],m=[];return u.forEach(v=>{v.start<a&&v.end>a?(g.push({start:0,end:v.end-a}),m.push({start:v.start,end:a})):v.start>=a?g.push({start:v.start-a,end:v.end-a}):m.push(v)}),{score:d,labelMatch:g,descriptionMatch:m}}}return kP}function TZ(s){const e=[];if(!s)return e;let t;for(const i of s)t&&t.end===i?t.end+=1:(t={start:i,end:i+1},e.push(t));return e}function bU(s){const e=s.sort((n,o)=>n.start-o.start),t=[];let i;for(const n of e)!i||!RNe(i,n)?(i=n,t.push(n)):(i.start=Math.min(i.start,n.start),i.end=Math.max(i.end,n.end));return t}function RNe(s,e){return!(s.end<e.start||e.end<s.start)}function PNe(s,e,t,i,n,o){const r=_U(s,t,i,n,o),a=_U(e,t,i,n,o),c=r.score,d=a.score;if((c===oT||d===oT)&&c!==d)return c===oT?-1:1;if(c>vU||d>vU){if(c!==d)return c>d?-1:1;if(c<mU&&d<mU){const w=LNe(r.labelMatch,a.labelMatch);if(w!==0)return w}const v=n.getItemLabel(s)||"",_=n.getItemLabel(e)||"";if(v.length!==_.length)return v.length-_.length}if(c!==d)return c>d?-1:1;const l=Array.isArray(r.labelMatch)&&r.labelMatch.length>0,u=Array.isArray(a.labelMatch)&&a.labelMatch.length>0;if(l&&!u)return-1;if(u&&!l)return 1;const g=AZ(s,r,n),m=AZ(e,a,n);return g&&m&&g!==m?m>g?-1:1:MNe(s,e,t,n)}function AZ(s,e,t){let i=-1,n=-1;if(e.descriptionMatch&&e.descriptionMatch.length?i=e.descriptionMatch[0].start:e.labelMatch&&e.labelMatch.length&&(i=e.labelMatch[0].start),e.labelMatch&&e.labelMatch.length){if(n=e.labelMatch[e.labelMatch.length-1].end,e.descriptionMatch&&e.descriptionMatch.length){const o=t.getItemDescription(s);o&&(n+=o.length)}}else e.descriptionMatch&&e.descriptionMatch.length&&(n=e.descriptionMatch[e.descriptionMatch.length-1].end);return n-i}function LNe(s,e){if(!s&&!e||(!s||!s.length)&&(!e||!e.length))return 0;if(!e||!e.length)return-1;if(!s||!s.length)return 1;const t=s[0].start,n=s[s.length-1].end-t,o=e[0].start,a=e[e.length-1].end-o;return n===a?0:a<n?1:-1}function MNe(s,e,t,i){const n=i.getItemLabel(s)||"",o=i.getItemLabel(e)||"",r=i.getItemDescription(s),a=i.getItemDescription(e),c=n.length+(r?r.length:0),d=o.length+(a?a.length:0);if(c!==d)return c-d;const l=i.getItemPath(s),u=i.getItemPath(e);return l&&u&&l.length!==u.length?l.length-u.length:n!==o?Z0(n,o,t.normalized):r&&a&&r!==a?Z0(r,a,t.normalized):l&&u&&l!==u?Z0(l,u,t.normalized):0}function RZ(s){return s.startsWith('"')&&s.endsWith('"')}const Jle=" ";function Cx(s){typeof s!="string"&&(s="");const e=s.toLowerCase(),{pathNormalized:t,normalized:i,normalizedLowercase:n}=PZ(s),o=t.indexOf(XT)>=0,r=RZ(s);let a;const c=s.split(Jle);if(c.length>1)for(const d of c){const l=RZ(d),{pathNormalized:u,normalized:g,normalizedLowercase:m}=PZ(d);g&&(a||(a=[]),a.push({original:d,originalLowercase:d.toLowerCase(),pathNormalized:u,normalized:g,normalizedLowercase:m,expectContiguousMatch:l}))}return{original:s,originalLowercase:e,pathNormalized:t,normalized:i,normalizedLowercase:n,values:a,containsPathSeparator:o,expectContiguousMatch:r}}function PZ(s){let e;bn?e=s.replace(/\//g,XT):e=s.replace(/\\/g,XT);const t=i_e(e).replace(/\s|"/g,"");return{pathNormalized:e,normalized:t,normalizedLowercase:t.toLowerCase()}}function LZ(s){return Array.isArray(s)?Cx(s.map(e=>e.original).join(Jle)):Cx(s.original)}var yU,wU,SU;Ve(SNe);let Ex=class extends P4{constructor(e,t,i,n,o){super(e,{canAcceptInBackground:!0,noResultsPick:{label:h(3259,"No matching editors"),groupId:-1}}),this.editorGroupService=t,this.editorService=i,this.modelService=n,this.languageService=o,this.pickState=new class{constructor(){this.scorerCache=Object.create(null),this.isQuickNavigating=void 0}reset(r){r||(this.scorerCache=Object.create(null)),this.isQuickNavigating=r}}}provide(e,t){return this.pickState.reset(!!e.quickNavigate),super.provide(e,t)}_getPicks(e){const t=Cx(e),i=this.doGetEditorPickItems().filter(o=>{if(!t.normalized)return!0;const r=_U(o,t,!0,z6,this.pickState.scorerCache);return r.score?(o.highlights={label:r.labelMatch,description:r.descriptionMatch},!0):!1});if(t.normalized){const o=this.editorGroupService.getGroups(Jo.GRID_APPEARANCE).map(r=>r.id);i.sort((r,a)=>r.groupId!==a.groupId?o.indexOf(r.groupId)-o.indexOf(a.groupId):PNe(r,a,t,!0,z6,this.pickState.scorerCache))}const n=[];if(this.editorGroupService.count>1){let o;for(const r of i){if(typeof o!="number"||o!==r.groupId){const a=this.editorGroupService.getGroup(r.groupId);a&&n.push({type:"separator",label:a.label}),o=r.groupId}n.push(r)}}else n.push(...i);return n}doGetEditorPickItems(){const e=this.doGetEditors(),t=new Map;for(const{groupId:i}of e)if(!t.has(i)){const n=this.editorGroupService.getGroup(i);n&&t.set(i,n.ariaLabel)}return this.doGetEditors().map(({editor:i,groupId:n})=>{const o=Di.getOriginalUri(i,{supportSideBySide:qt.PRIMARY}),r=i.isDirty()&&!i.isSaving(),a=i.getDescription(),c=a?`${i.getName()} ${a}`:i.getName();return{groupId:n,resource:o,label:i.getName(),ariaLabel:t.size>1?r?h(3260,"{0}, unsaved changes, {1}",c,t.get(n)):h(3261,"{0}, {1}",c,t.get(n)):r?h(3262,"{0}, unsaved changes",c):c,description:a,iconClasses:ch(this.modelService,this.languageService,o,void 0,i.getIcon()).concat(i.getLabelExtraClasses()),italic:!this.editorGroupService.getGroup(n)?.isPinned(i),buttons:[{iconClass:r?"dirty-editor "+ke.asClassName(K.closeDirty):ke.asClassName(K.close),tooltip:h(3263,"Close Editor"),alwaysVisible:r}],trigger:async()=>{const d=this.editorGroupService.getGroup(n);return d&&(await d.closeEditor(i,{preserveFocus:!0}),!d.contains(i))?yu.REMOVE_ITEM:yu.NO_ACTION},accept:(d,l)=>this.editorGroupService.getGroup(n)?.openEditor(i,{preserveFocus:l.inBackground})}})}};Ex=f([p(1,xe),p(2,de),p(3,ci),p(4,vi)],Ex);let Xy=class extends Ex{static{yU=this}static{this.PREFIX="edt active "}constructor(e,t,i,n){super(yU.PREFIX,e,t,i,n)}doGetEditors(){const e=this.editorGroupService.activeGroup;return e.getEditors(Ii.MOST_RECENTLY_ACTIVE).map(t=>({editor:t,groupId:e.id}))}};Xy=yU=f([p(0,xe),p(1,de),p(2,ci),p(3,vi)],Xy);let CU=class extends Ex{static{wU=this}static{this.PREFIX="edt "}constructor(e,t,i,n){super(wU.PREFIX,e,t,i,n)}doGetEditors(){const e=[];for(const t of this.editorGroupService.getGroups(Jo.GRID_APPEARANCE))for(const i of t.getEditors(Ii.SEQUENTIAL))e.push({editor:i,groupId:t.id});return e}};CU=wU=f([p(0,xe),p(1,de),p(2,ci),p(3,vi)],CU);let xx=class extends Ex{static{SU=this}static{this.PREFIX="edt mru "}constructor(e,t,i,n){super(SU.PREFIX,e,t,i,n)}doGetEditors(){const e=[];for(const t of this.editorService.getEditors(Ii.MOST_RECENTLY_ACTIVE))e.push(t);return e}};xx=SU=f([p(0,xe),p(1,de),p(2,ci),p(3,vi)],xx);const NNe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var L_;let ks=class extends dl{static{L_=this}static{this.ID="workbench.editorinputs.sidebysideEditorInput"}get typeId(){return L_.ID}get capabilities(){let e=this.primary.capabilities;return e&=~Je.CanSplitInGroup,this.secondary.hasCapability(Je.RequiresTrust)&&(e|=Je.RequiresTrust),this.secondary.hasCapability(Je.Singleton)&&(e|=Je.Singleton),e|=Je.MultipleEditors,e}get resource(){if(this.hasIdenticalSides)return this.primary.resource}constructor(e,t,i,n,o){super(),this.preferredName=e,this.preferredDescription=t,this.secondary=i,this.primary=n,this.editorService=o,this.hasIdenticalSides=this.primary.matches(this.secondary),this.registerListeners()}registerListeners(){this._register(T.once(T.any(this.primary.onWillDispose,this.secondary.onWillDispose))(()=>{this.isDisposed()||this.dispose()})),this._register(this.primary.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.primary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.secondary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.primary.onDidChangeLabel(()=>this._onDidChangeLabel.fire())),this._register(this.secondary.onDidChangeLabel(()=>this._onDidChangeLabel.fire()))}getName(){const e=this.getPreferredName();return e||(this.hasIdenticalSides?this.primary.getName():h(3858,"{0} - {1}",this.secondary.getName(),this.primary.getName()))}getPreferredName(){return this.preferredName}getDescription(e){const t=this.getPreferredDescription();return t||(this.hasIdenticalSides?this.primary.getDescription(e):super.getDescription(e))}getPreferredDescription(){return this.preferredDescription}getTitle(e){let t;this.hasIdenticalSides?t=this.primary.getTitle(e)??this.getName():t=super.getTitle(e);const i=this.getPreferredTitle();return i&&(t=`${i} (${t})`),t}getPreferredTitle(){if(this.preferredName&&this.preferredDescription)return`${this.preferredName} ${this.preferredDescription}`;if(this.preferredName||this.preferredDescription)return this.preferredName??this.preferredDescription}getLabelExtraClasses(){return this.hasIdenticalSides?this.primary.getLabelExtraClasses():super.getLabelExtraClasses()}getAriaLabel(){return this.hasIdenticalSides?this.primary.getAriaLabel():super.getAriaLabel()}getTelemetryDescriptor(){return{...this.primary.getTelemetryDescriptor(),...super.getTelemetryDescriptor()}}isDirty(){return this.primary.isDirty()}isSaving(){return this.primary.isSaving()}async save(e,t){const i=await this.primary.save(e,t);return this.saveResultToEditor(i)}async saveAs(e,t){const i=await this.primary.saveAs(e,t);return this.saveResultToEditor(i)}saveResultToEditor(e){if(!e||!this.hasIdenticalSides)return e;if(this.primary.matches(e))return this;if(e instanceof dl)return new L_(this.preferredName,this.preferredDescription,e,e,this.editorService);if(!Q_(e)&&!d1(e)&&!FS(e)&&!wC(e))return{primary:e,secondary:e,label:this.preferredName,description:this.preferredDescription}}revert(e,t){return this.primary.revert(e,t)}async rename(e,t){if(!this.hasIdenticalSides)return;const i=await this.primary.rename(e,t);if(i){if(SC(i.editor))return{editor:new L_(this.preferredName,this.preferredDescription,i.editor,i.editor,this.editorService),options:{...i.options,viewState:Ob(this,e,this.editorService)}};if(Ql(i.editor))return{editor:{label:this.preferredName,description:this.preferredDescription,primary:i.editor,secondary:i.editor,options:{...i.options,viewState:Ob(this,e,this.editorService)}}}}}isReadonly(){return this.primary.isReadonly()}toUntyped(e){const t=this.primary.toUntyped(e),i=this.secondary.toUntyped(e);if(t&&i&&!Q_(t)&&!Q_(i)&&!d1(t)&&!d1(i)&&!FS(t)&&!FS(i)&&!wC(t)&&!wC(i)){const n={label:this.preferredName,description:this.preferredDescription,primary:t,secondary:i};return typeof e?.preserveViewState=="number"&&(n.options={viewState:Ob(this,e.preserveViewState,this.editorService)}),n}}matches(e){return this===e?!0:QSe(e)||Q_(e)?!1:e instanceof L_?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):FS(e)?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):!1}};ks=L_=f([p(4,de)],ks);class ehe{canSerialize(e){const t=e;if(t.primary&&t.secondary){const[i,n]=this.getSerializers(t.secondary.typeId,t.primary.typeId);return!!(i?.canSerialize(t.secondary)&&n?.canSerialize(t.primary))}return!1}serialize(e){const t=e;if(t.primary&&t.secondary){const[i,n]=this.getSerializers(t.secondary.typeId,t.primary.typeId);if(n&&i){const o=n.serialize(t.primary),r=i.serialize(t.secondary);if(o&&r){const a={name:t.getPreferredName(),description:t.getPreferredDescription(),primarySerialized:o,secondarySerialized:r,primaryTypeId:t.primary.typeId,secondaryTypeId:t.secondary.typeId};return JSON.stringify(a)}}}}deserialize(e,t){const i=JSON.parse(t),[n,o]=this.getSerializers(i.secondaryTypeId,i.primaryTypeId);if(o&&n){const r=o.deserialize(e,i.primarySerialized),a=n.deserialize(e,i.secondarySerialized);if(r instanceof dl&&a instanceof dl)return this.createEditorInput(e,i.name,i.description,a,r)}}getSerializers(e,t){const i=Ke.as(iv.EditorFactory);return[i.getEditorSerializer(e),i.getEditorSerializer(t)]}}class Jje extends ehe{createEditorInput(e,t,i,n,o){return e.createInstance(ks,t,i,n,o)}}class KO extends ww{constructor(e,t,i){super(t),this.id=e,this.memento=new bw(this.id,i),this._register(i.onWillSaveState(()=>{this.saveState(),this.memento.saveMemento()}))}getId(){return this.id}getMemento(e,t){return this.memento.getMemento(e,t)}reloadMemento(e){return this.memento.reloadMemento(e)}onDidChangeMementoValue(e,t){return this.memento.onDidChangeValue(e,t)}saveState(){}}class ONe extends KO{get onDidFocus(){return this._onDidFocus||(this._onDidFocus=this.registerFocusTrackEvents().onDidFocus),this._onDidFocus.event}get onDidBlur(){return this._onDidBlur||(this._onDidBlur=this.registerFocusTrackEvents().onDidBlur),this._onDidBlur.event}hasFocus(){return this._hasFocus}registerFocusTrackEvents(){const e=jt(this.getContainer()),t=this._register(Fo(e)),i=this._onDidFocus=this._register(new M);this._register(t.onDidFocus(()=>{this._hasFocus=!0,i.fire()}));const n=this._onDidBlur=this._register(new M);return this._register(t.onDidBlur(()=>{this._hasFocus=!1,n.fire()})),{onDidFocus:i,onDidBlur:n}}constructor(e,t,i,n){super(e,i,n),this.telemetryService=t,this._onTitleAreaUpdate=this._register(new M),this.onTitleAreaUpdate=this._onTitleAreaUpdate.event,this._hasFocus=!1,this.visible=!1}getTitle(){}create(e){this.parent=e}getContainer(){return this.parent}setVisible(e){this.visible!==!!e&&(this.visible=e)}focus(){}getMenuIds(){return[]}getActions(){return[]}getSecondaryActions(){return[]}getContextMenuActions(){return[]}getActionViewItem(e,t){}getActionsContext(){return null}getActionRunner(){return this.actionRunner||(this.actionRunner=this._register(new hg)),this.actionRunner}updateTitleArea(){this._onTitleAreaUpdate.fire()}isVisible(){return this.visible}getControl(){}}class eYe{constructor(e,t,i,n,o,r){this.ctor=e,this.id=t,this.name=i,this.cssClass=n,this.order=o,this.requestedIndex=r}instantiate(e){return e.createInstance(this.ctor)}}class tYe extends F{constructor(){super(...arguments),this._onDidRegister=this._register(new M),this.onDidRegister=this._onDidRegister.event,this._onDidDeregister=this._register(new M),this.onDidDeregister=this._onDidDeregister.event,this.composites=[]}registerComposite(e){this.compositeById(e.id)||(this.composites.push(e),this._onDidRegister.fire(e))}deregisterComposite(e){const t=this.compositeById(e);t&&(this.composites.splice(this.composites.indexOf(t),1),this._onDidDeregister.fire(t))}getComposite(e){return this.compositeById(e)}getComposites(){return this.composites.slice(0)}compositeById(e){return this.composites.find(t=>t.id===e)}}class Mu extends ONe{static{this.EDITOR_MEMENTOS=new Map}get minimumWidth(){return cp.width}get maximumWidth(){return OA.width}get minimumHeight(){return cp.height}get maximumHeight(){return OA.height}get input(){return this._input}get options(){return this._options}get window(){return Vz(this.group.windowId,!0).window}get scopedContextKeyService(){}constructor(e,t,i,n,o){super(e,i,n,o),this.group=t,this.onDidChangeSizeConstraints=T.None,this._onDidChangeControl=this._register(new M),this.onDidChangeControl=this._onDidChangeControl.event}create(e){super.create(e),this.createEditor(e)}async setInput(e,t,i,n){this._input=e,this._options=t}clearInput(){this._input=void 0,this._options=void 0}setOptions(e){this._options=e}setVisible(e){super.setVisible(e),this.setEditorVisible(e)}setEditorVisible(e){}setBoundarySashes(e){}getEditorMemento(e,t,i,n=10){const o=`${this.getId()}${i}`;let r=Mu.EDITOR_MEMENTOS.get(o);return r||(r=this._register(new KC(this.getId(),i,this.getMemento(he.WORKSPACE,gt.MACHINE),n,e,t)),Mu.EDITOR_MEMENTOS.set(o,r)),r}getViewState(){}saveState(){for(const[,e]of Mu.EDITOR_MEMENTOS)e.id===this.getId()&&e.saveState();super.saveState()}dispose(){this._input=void 0,this._options=void 0,super.dispose()}}class KC extends F{static{this.SHARED_EDITOR_STATE=-1}constructor(e,t,i,n,o,r){super(),this.id=e,this.key=t,this.memento=i,this.limit=n,this.editorGroupService=o,this.configurationService=r,this.cleanedUp=!1,this.shareEditorState=!1,this.updateConfiguration(void 0),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e)))}updateConfiguration(e){(!e||e.affectsConfiguration(void 0,"workbench.editor.sharedViewState"))&&(this.shareEditorState=this.configurationService.getValue(void 0,"workbench.editor.sharedViewState")===!0)}saveEditorState(e,t,i){const n=this.doGetResource(t);if(!n||!e)return;const o=this.doLoad();let r=o.get(n.toString());r||(r=Object.create(null),o.set(n.toString(),r)),r[e.id]=i,this.shareEditorState&&(r[KC.SHARED_EDITOR_STATE]=i),SC(t)&&this.clearEditorStateOnDispose(n,t)}loadEditorState(e,t){const i=this.doGetResource(t);if(!i||!e)return;const o=this.doLoad().get(i.toString());if(o){const r=o[e.id];if(r)return r;if(this.shareEditorState)return o[KC.SHARED_EDITOR_STATE]}}clearEditorState(e,t){SC(e)&&this.editorDisposables?.delete(e);const i=this.doGetResource(e);if(i){const n=this.doLoad();if(t){const o=n.get(i.toString());o&&(delete o[t.id],HT(o)&&n.delete(i.toString()))}else n.delete(i.toString())}}clearEditorStateOnDispose(e,t){this.editorDisposables||(this.editorDisposables=new Map),this.editorDisposables.has(t)||this.editorDisposables.set(t,T.once(t.onWillDispose)(()=>{this.clearEditorState(e),this.editorDisposables?.delete(t)}))}moveEditorState(e,t,i){const n=this.doLoad(),o=[...n.keys()];for(const r of o){const a=R.parse(r);if(!i.isEqualOrParent(a,e))continue;let c;if(At(e,a))c=t;else{const l=s_e(a.path,e.path);c=Ct(t,a.path.substr(l+e.path.length+1))}const d=n.get(r,o_e.None);d&&(n.delete(r),n.set(c.toString(),d))}}doGetResource(e){return SC(e)?e.resource:e}doLoad(){if(!this.cache){this.cache=new zm(this.limit);const e=this.memento[this.key];Array.isArray(e)&&this.cache.fromJSON(e)}return this.cache}saveState(){const e=this.doLoad();this.cleanedUp||(this.cleanUp(),this.cleanedUp=!0),this.memento[this.key]=e.toJSON()}cleanUp(){const e=this.doLoad(),t=[...e.entries()];for(const[i,n]of t)for(const o of Object.keys(n)){const r=Number(o);r===KC.SHARED_EDITOR_STATE&&this.shareEditorState||this.editorGroupService.getGroup(r)||(delete n[r],HT(n)&&e.delete(i))}}}let TP=class extends Mu{constructor(e,t,i,n,o,r,a,c,d,l){super(e,t,n,c,r),this.instantiationService=o,this.textResourceConfigurationService=a,this.editorService=d,this.editorGroupService=l,this.groupListener=this._register(new Pt),this.viewState=this.getEditorMemento(l,a,i,100)}setEditorVisible(e){this.groupListener.value=this.group.onWillCloseEditor(t=>this.onWillCloseEditor(t)),super.setEditorVisible(e)}onWillCloseEditor(e){const t=e.editor;t===this.input&&this.updateEditorViewState(t)}clearInput(){this.updateEditorViewState(this.input),super.clearInput()}saveState(){this.updateEditorViewState(this.input),super.saveState()}updateEditorViewState(e){if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);t&&(this.tracksDisposedEditorViewState()||(this.editorViewStateDisposables||(this.editorViewStateDisposables=new Map),this.editorViewStateDisposables.has(e)||this.editorViewStateDisposables.set(e,T.once(e.onWillDispose)(()=>{this.clearEditorViewState(t,this.group),this.editorViewStateDisposables?.delete(e)}))),e.isDisposed()&&!this.tracksDisposedEditorViewState()||!this.shouldRestoreEditorViewState(e)&&!this.group.contains(e)?this.clearEditorViewState(t,this.group):e.isDisposed()||this.saveEditorViewState(t))}shouldRestoreEditorViewState(e,t){return t?.newInGroup?this.textResourceConfigurationService.getValue(Di.getOriginalUri(e,{supportSideBySide:qt.PRIMARY}),"workbench.editor.restoreViewState")!==!1:!0}getViewState(){const e=this.input;if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);if(t)return this.computeEditorViewState(t)}saveEditorViewState(e){const t=this.computeEditorViewState(e);t&&this.viewState.saveEditorState(this.group,e,t)}loadEditorViewState(e,t){if(!e||!this.tracksEditorViewState(e)||!this.shouldRestoreEditorViewState(e,t))return;const i=this.toEditorViewStateResource(e);if(i)return this.viewState.loadEditorState(this.group,i)}moveEditorViewState(e,t,i){return this.viewState.moveEditorState(e,t,i)}clearEditorViewState(e,t){this.viewState.clearEditorState(e,t)}dispose(){if(super.dispose(),this.editorViewStateDisposables){for(const[,e]of this.editorViewStateDisposables)e.dispose();this.editorViewStateDisposables=void 0}}tracksDisposedEditorViewState(){return!1}};TP=f([p(3,ai),p(4,Z),p(5,it),p(6,ir),p(7,pt),p(8,de),p(9,xe)],TP);var Kf;Ve(NNe);function FNe(s){const e=s;return typeof e?.primary=="object"&&typeof e.secondary=="object"}let xp=class extends TP{static{Kf=this}static{this.ID=XSe}static{this.SIDE_BY_SIDE_LAYOUT_SETTING="workbench.editor.splitInGroupLayout"}static{this.VIEW_STATE_PREFERENCE_KEY="sideBySideEditorViewState"}get minimumPrimaryWidth(){return this.primaryEditorPane?this.primaryEditorPane.minimumWidth:0}get maximumPrimaryWidth(){return this.primaryEditorPane?this.primaryEditorPane.maximumWidth:Number.POSITIVE_INFINITY}get minimumPrimaryHeight(){return this.primaryEditorPane?this.primaryEditorPane.minimumHeight:0}get maximumPrimaryHeight(){return this.primaryEditorPane?this.primaryEditorPane.maximumHeight:Number.POSITIVE_INFINITY}get minimumSecondaryWidth(){return this.secondaryEditorPane?this.secondaryEditorPane.minimumWidth:0}get maximumSecondaryWidth(){return this.secondaryEditorPane?this.secondaryEditorPane.maximumWidth:Number.POSITIVE_INFINITY}get minimumSecondaryHeight(){return this.secondaryEditorPane?this.secondaryEditorPane.minimumHeight:0}get maximumSecondaryHeight(){return this.secondaryEditorPane?this.secondaryEditorPane.maximumHeight:Number.POSITIVE_INFINITY}set minimumWidth(e){}set maximumWidth(e){}set minimumHeight(e){}set maximumHeight(e){}get minimumWidth(){return this.minimumPrimaryWidth+this.minimumSecondaryWidth}get maximumWidth(){return this.maximumPrimaryWidth+this.maximumSecondaryWidth}get minimumHeight(){return this.minimumPrimaryHeight+this.minimumSecondaryHeight}get maximumHeight(){return this.maximumPrimaryHeight+this.maximumSecondaryHeight}constructor(e,t,i,n,o,r,a,c,d){super(Kf.ID,e,Kf.VIEW_STATE_PREFERENCE_KEY,t,i,o,a,n,c,d),this.configurationService=r,this.onDidCreateEditors=this._register(new M),this._onDidChangeSizeConstraints=this._register(new Pne),this.onDidChangeSizeConstraints=T.any(this.onDidCreateEditors.event,this._onDidChangeSizeConstraints.event),this._onDidChangeSelection=this._register(new M),this.onDidChangeSelection=this._onDidChangeSelection.event,this.primaryEditorPane=void 0,this.secondaryEditorPane=void 0,this.splitviewDisposables=this._register(new U),this.editorDisposables=this._register(new U),this.dimension=new Ye(0,0),this.lastFocusedSide=void 0,this.orientation=this.configurationService.getValue(Kf.SIDE_BY_SIDE_LAYOUT_SETTING)==="vertical"?St.VERTICAL:St.HORIZONTAL,this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e)))}onConfigurationUpdated(e){e.affectsConfiguration(Kf.SIDE_BY_SIDE_LAYOUT_SETTING)&&(this.orientation=this.configurationService.getValue(Kf.SIDE_BY_SIDE_LAYOUT_SETTING)==="vertical"?St.VERTICAL:St.HORIZONTAL,this.splitview&&this.recreateSplitview())}recreateSplitview(){const e=jt(this.getContainer()),t=this.getSplitViewRatio();this.splitview&&(this.splitview.el.remove(),this.splitviewDisposables.clear()),this.createSplitView(e,t),this.layout(this.dimension)}getSplitViewRatio(){let e;if(this.splitview){const t=this.splitview.getViewSize(0),i=this.splitview.getViewSize(1);if(Math.abs(t-i)>1){const n=this.splitview.orientation===St.HORIZONTAL?this.dimension.width:this.dimension.height;e=t/n}}return e}createEditor(e){e.classList.add("side-by-side-editor"),this.secondaryEditorContainer=j(".side-by-side-editor-container.editor-instance"),this.primaryEditorContainer=j(".side-by-side-editor-container.editor-instance"),this.createSplitView(e)}createSplitView(e,t){this.splitview=this.splitviewDisposables.add(new OT(e,{orientation:this.orientation})),this.splitviewDisposables.add(this.splitview.onDidSashReset(()=>this.splitview?.distributeViewSizes())),this.orientation===St.HORIZONTAL?this.splitview.orthogonalEndSash=this._boundarySashes?.bottom:(this.splitview.orthogonalStartSash=this._boundarySashes?.left,this.splitview.orthogonalEndSash=this._boundarySashes?.right);let i=EE.Distribute,n=EE.Distribute;if(t){const a=this.splitview.orientation===St.HORIZONTAL?this.dimension.width:this.dimension.height;i=Math.round(a*t),n=a-i,this.splitview.layout(this.orientation===St.HORIZONTAL?this.dimension.width:this.dimension.height)}const o=jt(this.secondaryEditorContainer);this.splitview.addView({element:o,layout:a=>this.layoutPane(this.secondaryEditorPane,a),minimumSize:this.orientation===St.HORIZONTAL?cp.width:cp.height,maximumSize:Number.POSITIVE_INFINITY,onDidChange:T.None},i);const r=jt(this.primaryEditorContainer);this.splitview.addView({element:r,layout:a=>this.layoutPane(this.primaryEditorPane,a),minimumSize:this.orientation===St.HORIZONTAL?cp.width:cp.height,maximumSize:Number.POSITIVE_INFINITY,onDidChange:T.None},n),this.updateStyles()}getTitle(){return this.input?this.input.getName():h(3324,"Side by Side Editor")}async setInput(e,t,i,n){const o=this.input;await super.setInput(e,t,i,n),(!o||!e.matches(o))&&(o&&this.disposeEditors(),this.createEditors(e));const{primary:r,secondary:a,viewState:c}=this.loadViewState(e,t,i);if(this.lastFocusedSide=c?.focus,typeof c?.ratio=="number"&&this.splitview){const d=this.splitview.orientation===St.HORIZONTAL?this.dimension.width:this.dimension.height;this.splitview.resizeView(0,Math.round(d*c.ratio))}else this.splitview?.distributeViewSizes();await Promise.all([this.secondaryEditorPane?.setInput(e.secondary,a,i,n),this.primaryEditorPane?.setInput(e.primary,r,i,n)]),typeof t?.target=="number"&&(this.lastFocusedSide=t.target)}loadViewState(e,t,i){const n=FNe(t?.viewState)?t?.viewState:this.loadEditorViewState(e,i);let o=Object.create(null),r;return t?.target===qt.SECONDARY?r={...t}:o={...t},o.viewState=n?.primary,n?.secondary&&(r?r.viewState=n?.secondary:r={viewState:n.secondary}),{primary:o,secondary:r,viewState:n}}createEditors(e){this.secondaryEditorPane=this.doCreateEditor(e.secondary,jt(this.secondaryEditorContainer)),this.primaryEditorPane=this.doCreateEditor(e.primary,jt(this.primaryEditorContainer)),this.layout(this.dimension),this._onDidChangeSizeConstraints.input=T.any(T.map(this.secondaryEditorPane.onDidChangeSizeConstraints,()=>{}),T.map(this.primaryEditorPane.onDidChangeSizeConstraints,()=>{})),this.onDidCreateEditors.fire(void 0),this.editorDisposables.add(this.primaryEditorPane.onDidFocus(()=>this.onDidFocusChange(qt.PRIMARY))),this.editorDisposables.add(this.secondaryEditorPane.onDidFocus(()=>this.onDidFocusChange(qt.SECONDARY)))}doCreateEditor(e,t){const i=Ke.as(iv.EditorPane).getEditorPane(e);if(!i)throw new Error("No editor pane descriptor for editor found");const n=i.instantiate(this.instantiationService,this.group);return n.create(t),n.setVisible(this.isVisible()),R8(n)&&this.editorDisposables.add(n.onDidChangeSelection(o=>this._onDidChangeSelection.fire(o))),this.editorDisposables.add(n),n}onDidFocusChange(e){this.lastFocusedSide=e,this._onDidChangeControl.fire()}getSelection(){const e=this.getLastFocusedEditorPane();if(R8(e)){const t=e.getSelection();if(t)return new L4(t,e===this.primaryEditorPane?qt.PRIMARY:qt.SECONDARY)}}setOptions(e){super.setOptions(e),typeof e?.target=="number"&&(this.lastFocusedSide=e.target),this.getLastFocusedEditorPane()?.setOptions(e)}setEditorVisible(e){this.primaryEditorPane?.setVisible(e),this.secondaryEditorPane?.setVisible(e),super.setEditorVisible(e)}clearInput(){super.clearInput(),this.primaryEditorPane?.clearInput(),this.secondaryEditorPane?.clearInput(),this.disposeEditors()}focus(){super.focus(),this.getLastFocusedEditorPane()?.focus()}getLastFocusedEditorPane(){return this.lastFocusedSide===qt.SECONDARY?this.secondaryEditorPane:this.primaryEditorPane}layout(e){this.dimension=e,jt(this.splitview).layout(this.orientation===St.HORIZONTAL?e.width:e.height)}setBoundarySashes(e){this._boundarySashes=e,this.splitview&&(this.splitview.orthogonalEndSash=e.bottom)}layoutPane(e,t){e?.layout(this.orientation===St.HORIZONTAL?new Ye(t,this.dimension.height):new Ye(this.dimension.width,t))}getControl(){return this.getLastFocusedEditorPane()?.getControl()}getPrimaryEditorPane(){return this.primaryEditorPane}getSecondaryEditorPane(){return this.secondaryEditorPane}tracksEditorViewState(e){return e instanceof ks}computeEditorViewState(e){if(!this.input||!At(e,this.toEditorViewStateResource(this.input)))return;const t=this.primaryEditorPane?.getViewState(),i=this.secondaryEditorPane?.getViewState();if(!(!t||!i))return{primary:t,secondary:i,focus:this.lastFocusedSide,ratio:this.getSplitViewRatio()}}toEditorViewStateResource(e){let t,i;if(e instanceof ks&&(t=e.primary.resource,i=e.secondary.resource),!(!i||!t))return R.from({scheme:"sideBySide",path:`${AE(i.toString())}${AE(t.toString())}`})}updateStyles(){super.updateStyles(),this.primaryEditorContainer&&(this.orientation===St.HORIZONTAL?(this.primaryEditorContainer.style.borderLeftWidth="1px",this.primaryEditorContainer.style.borderLeftStyle="solid",this.primaryEditorContainer.style.borderLeftColor=this.getColor(pxe)??"",this.primaryEditorContainer.style.borderTopWidth="0"):(this.primaryEditorContainer.style.borderTopWidth="1px",this.primaryEditorContainer.style.borderTopStyle="solid",this.primaryEditorContainer.style.borderTopColor=this.getColor(gxe)??"",this.primaryEditorContainer.style.borderLeftWidth="0"))}dispose(){this.disposeEditors(),super.dispose()}disposeEditors(){this.editorDisposables.clear(),this.secondaryEditorPane=void 0,this.primaryEditorPane=void 0,this.lastFocusedSide=void 0,this.secondaryEditorContainer&&Xi(this.secondaryEditorContainer),this.primaryEditorContainer&&Xi(this.primaryEditorContainer)}};xp=Kf=f([p(1,ai),p(2,Z),p(3,pt),p(4,it),p(5,ne),p(6,ir),p(7,de),p(8,xe)],xp);class L4{constructor(e,t){this.selection=e,this.side=t}compare(e){return e instanceof L4?this.side!==e.side?X_.DIFFERENT:this.selection.compare(e.selection):X_.DIFFERENT}restore(e){const t={...e,target:this.side};return this.selection.restore(t)}}class sp{static{this.instantiatedEditorPanes=new Set}static didInstantiateEditorPane(e){return sp.instantiatedEditorPanes.has(e)}static{this._onWillInstantiateEditorPane=new M}static{this.onWillInstantiateEditorPane=sp._onWillInstantiateEditorPane.event}static create(e,t,i){return new sp(e,t,i)}constructor(e,t,i){this.ctor=e,this.typeId=t,this.name=i}instantiate(e,t){sp._onWillInstantiateEditorPane.fire({typeId:this.typeId});const i=e.createInstance(this.ctor,t);return sp.instantiatedEditorPanes.add(this.typeId),i}describes(e){return e.getId()===this.typeId}}class WNe{constructor(){this.mapEditorPanesToEditors=new Map}registerEditorPane(e,t){return this.mapEditorPanesToEditors.set(e,t),Ie(()=>{this.mapEditorPanesToEditors.delete(e)})}getEditorPane(e){const t=this.findEditorPaneDescriptors(e);if(t.length!==0)return t.length===1?t[0]:e.prefersEditorPane(t)}findEditorPaneDescriptors(e,t){const i=[];for(const n of this.mapEditorPanesToEditors.keys()){const o=this.mapEditorPanesToEditors.get(n)||[];for(const r of o){const a=r.ctor;if(!t&&e.constructor===a){i.push(n);break}else if(t&&e instanceof a){i.push(n);break}}}return!t&&i.length===0?this.findEditorPaneDescriptors(e,!0):i}getEditorPaneByType(e){return As.find(this.mapEditorPanesToEditors.keys(),t=>t.typeId===e)}getEditorPanes(){return Array.from(this.mapEditorPanesToEditors.keys())}getEditors(){const e=[];for(const t of this.mapEditorPanesToEditors.keys()){const i=this.mapEditorPanesToEditors.get(t);i&&e.push(...i.map(n=>n.ctor))}return e}}Ke.add(iv.EditorPane,new WNe);function BNe(s,e){const t=s.get(de),i=s.get(nn),n=s.get(lg);return new Promise(o=>{let r=[...e];const a=t.onDidCloseEditor(async c=>{if(c.context===jd.MOVE)return;let d=Di.getOriginalUri(c.editor,{supportSideBySide:qt.PRIMARY}),l=Di.getOriginalUri(c.editor,{supportSideBySide:qt.SECONDARY});if(c.context===jd.REPLACE){const u=Di.getOriginalUri(t.activeEditor,{supportSideBySide:qt.PRIMARY}),g=Di.getOriginalUri(t.activeEditor,{supportSideBySide:qt.SECONDARY});i.extUri.isEqual(d,u)&&(d=void 0),i.extUri.isEqual(l,g)&&(l=void 0)}if(r=r.filter(u=>!(i.extUri.isEqual(u,d)||i.extUri.isEqual(u,l)||c.context!==jd.REPLACE&&(d?.scheme===ae.untitled&&i.extUri.isEqual(u,d.with({scheme:u.scheme}))||l?.scheme===ae.untitled&&i.extUri.isEqual(u,l.with({scheme:u.scheme}))))),r.length===0){const u=e.filter(g=>n.isDirty(g));return u.length>0&&await Pp.settled(u.map(async g=>await new Promise(m=>{if(!n.isDirty(g))return m();const v=n.onDidChangeDirty(_=>{if(!_.isDirty()&&i.extUri.isEqual(g,_.resource))return v.dispose(),m()})}))),a.dispose(),o()}})})}function M4(s,e,t,i){let n=s.getAriaLabel();return t&&!t.isPinned(s)&&(n=h(2820,"{0}, preview",n)),t?.isSticky(e??s)&&(n=h(2821,"{0}, pinned",n)),t&&typeof i=="number"&&i>1&&(n=`${n}, ${t.ariaLabel}`),n}var EU;let xU=class extends TP{static{EU=this}static{this.VIEW_STATE_PREFERENCE_KEY="textEditorViewState"}constructor(e,t,i,n,o,r,a,c,d,l){super(e,t,EU.VIEW_STATE_PREFERENCE_KEY,i,n,o,r,a,c,d),this.fileService=l,this._onDidChangeSelection=this._register(new M),this.onDidChangeSelection=this._onDidChangeSelection.event,this._onDidChangeScroll=this._register(new M),this.onDidChangeScroll=this._onDidChangeScroll.event,this.inputListener=this._register(new Pt),this._register(this.textResourceConfigurationService.onDidChangeConfiguration(u=>this.handleConfigurationChangeEvent(u))),this._register(T.any(this.editorGroupService.onDidAddGroup,this.editorGroupService.onDidRemoveGroup)(()=>{const u=this.computeAriaLabel();this.editorContainer?.setAttribute("aria-label",u),this.updateEditorControlOptions({ariaLabel:u})})),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(u=>this.onDidChangeFileSystemProvider(u.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(u=>this.onDidChangeFileSystemProvider(u.scheme)))}handleConfigurationChangeEvent(e){const t=this.getActiveResource();this.shouldHandleConfigurationChangeEvent(e,t)&&(this.isVisible()?this.updateEditorConfiguration(t):this.hasPendingConfigurationChange=!0)}shouldHandleConfigurationChangeEvent(e,t){return e.affectsConfiguration(t,"editor")||e.affectsConfiguration(t,"problems.visibility")}consumePendingConfigurationChangeEvent(){this.hasPendingConfigurationChange&&(this.updateEditorConfiguration(),this.hasPendingConfigurationChange=!1)}computeConfiguration(e){const t=ra(e.editor)?Tr(e.editor):Object.create(null);return Object.assign(t,this.getConfigurationOverrides(e)),t.ariaLabel=this.computeAriaLabel(),t}computeAriaLabel(){return this.input?M4(this.input,void 0,this.group,this.editorGroupService.count):h(3329,"Editor")}onDidChangeFileSystemProvider(e){this.input&&this.getActiveResource()?.scheme===e&&this.updateReadonly(this.input)}onDidChangeInputCapabilities(e){this.input===e&&this.updateReadonly(e)}updateReadonly(e){this.updateEditorControlOptions({...this.getReadonlyConfiguration(e.isReadonly())})}getReadonlyConfiguration(e){return{readOnly:!!e,readOnlyMessage:typeof e!="boolean"?e:void 0}}getConfigurationOverrides(e){return{overviewRulerLanes:3,lineNumbersMinChars:3,fixedOverflowWidgets:!0,...this.getReadonlyConfiguration(this.input?.isReadonly()),renderValidationDecorations:e.problems?.visibility!==!1?"on":"off"}}createEditor(e){this.editorContainer=e,this.createEditorControl(e,this.computeConfiguration(this.textResourceConfigurationService.getValue(this.getActiveResource()))),this.registerCodeEditorListeners()}registerCodeEditorListeners(){const e=this.getMainControl();e&&(this._register(e.onDidChangeModelLanguage(()=>this.updateEditorConfiguration())),this._register(e.onDidChangeModel(()=>this.updateEditorConfiguration())),this._register(e.onDidChangeCursorPosition(t=>this._onDidChangeSelection.fire({reason:this.toEditorPaneSelectionChangeReason(t)}))),this._register(e.onDidChangeModelContent(()=>this._onDidChangeSelection.fire({reason:xS.EDIT}))),this._register(e.onDidScrollChange(()=>this._onDidChangeScroll.fire())))}toEditorPaneSelectionChangeReason(e){switch(e.source){case td.PROGRAMMATIC:return xS.PROGRAMMATIC;case td.NAVIGATION:return xS.NAVIGATION;case td.JUMP:return xS.JUMP;default:return xS.USER}}getSelection(){const e=this.getMainControl();if(e){const t=e.getSelection();if(t)return new AP(t)}}async setInput(e,t,i,n){await super.setInput(e,t,i,n),this.inputListener.value=e.onDidChangeCapabilities(()=>this.onDidChangeInputCapabilities(e)),this.updateEditorConfiguration(),jt(this.editorContainer).setAttribute("aria-label",this.computeAriaLabel())}clearInput(){this.inputListener.clear(),super.clearInput()}getScrollPosition(){const e=this.getMainControl();if(!e)throw new Error("Control has not yet been initialized");return{scrollTop:e.getScrollTop()-e.getTopForLineNumber(1),scrollLeft:e.getScrollLeft()}}setScrollPosition(e){const t=this.getMainControl();if(!t)throw new Error("Control has not yet been initialized");t.setScrollTop(e.scrollTop),e.scrollLeft&&t.setScrollLeft(e.scrollLeft)}setEditorVisible(e){e&&this.consumePendingConfigurationChangeEvent(),super.setEditorVisible(e)}toEditorViewStateResource(e){return e.resource}updateEditorConfiguration(e=this.getActiveResource()){let t;if(e&&(t=this.textResourceConfigurationService.getValue(e)),!t)return;const i=this.computeConfiguration(t);let n=i;this.lastAppliedEditorOptions&&(n=r_e(this.lastAppliedEditorOptions,n)),Object.keys(n).length>0&&(this.lastAppliedEditorOptions=i,this.updateEditorControlOptions(n))}getActiveResource(){const e=this.getMainControl();if(e){const t=e.getModel();if(t)return t.uri}if(this.input)return this.input.resource}dispose(){this.lastAppliedEditorOptions=void 0,super.dispose()}};xU=EU=f([p(2,ai),p(3,Z),p(4,it),p(5,ir),p(6,pt),p(7,de),p(8,xe),p(9,je)],xU);class AP{static{this.TEXT_EDITOR_SELECTION_THRESHOLD=10}constructor(e){this.textSelection=e}compare(e){if(!(e instanceof AP))return X_.DIFFERENT;const t=Math.min(this.textSelection.selectionStartLineNumber,this.textSelection.positionLineNumber),i=Math.min(e.textSelection.selectionStartLineNumber,e.textSelection.positionLineNumber);return t===i?X_.IDENTICAL:Math.abs(t-i)<AP.TEXT_EDITOR_SELECTION_THRESHOLD?X_.SIMILAR:X_.DIFFERENT}restore(e){return{...e,selection:this.textSelection,selectionRevealType:Dm.CenterIfOutsideViewport}}log(){return`line: ${this.textSelection.startLineNumber}-${this.textSelection.endLineNumber}, col:  ${this.textSelection.startColumn}-${this.textSelection.endColumn}`}}class the extends Gv{get originalModel(){return this._originalModel}get modifiedModel(){return this._modifiedModel}constructor(e,t){super(),this._originalModel=e,this._modifiedModel=t}async resolve(){await Promise.all([this._originalModel?.resolve(),this._modifiedModel?.resolve()])}isResolved(){return!!(this._originalModel?.isResolved()&&this._modifiedModel?.isResolved())}dispose(){super.dispose()}}class ihe extends the{get originalModel(){return this._originalModel}get modifiedModel(){return this._modifiedModel}get textDiffEditorModel(){return this._textDiffEditorModel}constructor(e,t){super(e,t),this._textDiffEditorModel=void 0,this._originalModel=e,this._modifiedModel=t,this.updateTextDiffEditorModel()}async resolve(){await super.resolve(),this.updateTextDiffEditorModel()}updateTextDiffEditorModel(){this.originalModel?.isResolved()&&this.modifiedModel?.isResolved()&&(this._textDiffEditorModel?(this._textDiffEditorModel.original=this.originalModel.textEditorModel,this._textDiffEditorModel.modified=this.modifiedModel.textEditorModel):this._textDiffEditorModel={original:this.originalModel.textEditorModel,modified:this.modifiedModel.textEditorModel})}isResolved(){return!!this._textDiffEditorModel}isReadonly(){return!!this.modifiedModel&&this.modifiedModel.isReadonly()}dispose(){this._textDiffEditorModel=void 0,super.dispose()}}var rT;let go=class extends ks{static{rT=this}static{this.ID="workbench.editors.diffEditorInput"}get typeId(){return rT.ID}get editorId(){return this.modified.editorId===this.original.editorId?this.modified.editorId:void 0}get capabilities(){let e=super.capabilities;return this.labels.forceDescription&&(e|=Je.ForceDescription),e}constructor(e,t,i,n,o,r){super(e,t,i,n,r),this.original=i,this.modified=n,this.forceOpenAsBinary=o,this.cachedModel=void 0,this.labels=this.computeLabels()}computeLabels(){let e,t=!1;if(this.preferredName)e=this.preferredName;else{const l=this.original.getName(),u=this.modified.getName();e=h(3857,"{0}  {1}",l,u),t=l===u}let i,n,o;if(this.preferredDescription)i=this.preferredDescription,n=this.preferredDescription,o=this.preferredDescription;else{i=this.computeLabel(this.original.getDescription(Ot.SHORT),this.modified.getDescription(Ot.SHORT)),o=this.computeLabel(this.original.getDescription(Ot.LONG),this.modified.getDescription(Ot.LONG));const l=this.original.getDescription(Ot.MEDIUM),u=this.modified.getDescription(Ot.MEDIUM);if(typeof l=="string"&&typeof u=="string"&&(l||u)){const[g,m]=Lne([l,u]);n=this.computeLabel(g,m)}}let r=this.computeLabel(this.original.getTitle(Ot.SHORT)??this.original.getName(),this.modified.getTitle(Ot.SHORT)??this.modified.getName(),"  "),a=this.computeLabel(this.original.getTitle(Ot.MEDIUM)??this.original.getName(),this.modified.getTitle(Ot.MEDIUM)??this.modified.getName(),"  "),c=this.computeLabel(this.original.getTitle(Ot.LONG)??this.original.getName(),this.modified.getTitle(Ot.LONG)??this.modified.getName(),"  ");const d=this.getPreferredTitle();return d&&(r=`${d} (${r})`,a=`${d} (${a})`,c=`${d} (${c})`),{name:e,shortDescription:i,mediumDescription:n,longDescription:o,forceDescription:t,shortTitle:r,mediumTitle:a,longTitle:c}}computeLabel(e,t,i=" - "){if(!(!e||!t))return e===t?t:`${e}${i}${t}`}getName(){return this.labels.name}getDescription(e=Ot.MEDIUM){switch(e){case Ot.SHORT:return this.labels.shortDescription;case Ot.LONG:return this.labels.longDescription;case Ot.MEDIUM:default:return this.labels.mediumDescription}}getTitle(e){switch(e){case Ot.SHORT:return this.labels.shortTitle;case Ot.LONG:return this.labels.longTitle;default:case Ot.MEDIUM:return this.labels.mediumTitle}}async resolve(){const e=await this.createModel();return this.cachedModel?.dispose(),this.cachedModel=e,this.cachedModel}prefersEditorPane(e){return this.forceOpenAsBinary?e.find(t=>t.typeId===ZSe):e.find(t=>t.typeId===lq)}async createModel(){const[e,t]=await Promise.all([this.original.resolve(),this.modified.resolve()]);return t instanceof eW&&e instanceof eW?new ihe(e,t):new the(q6(e)?e:void 0,q6(t)?t:void 0)}toUntyped(e){const t=super.toUntyped(e);if(t)return{...t,modified:t.primary,original:t.secondary}}matches(e){return this===e?!0:e instanceof rT?this.modified.matches(e.modified)&&this.original.matches(e.original)&&e.forceOpenAsBinary===this.forceOpenAsBinary:Q_(e)?this.modified.matches(e.modified)&&this.original.matches(e.original):!1}dispose(){this.cachedModel&&(this.cachedModel.dispose(),this.cachedModel=void 0),super.dispose()}};go=rT=f([p(5,de)],go);class rYe extends ehe{createEditorInput(e,t,i,n,o){return e.createInstance(go,t,i,n,o,void 0)}}var IU;let Kb=class extends xU{static{IU=this}static{this.ID=lq}get scopedContextKeyService(){if(!this.diffEditorControl)return;const e=this.diffEditorControl.getOriginalEditor(),t=this.diffEditorControl.getModifiedEditor();return(e.hasTextFocus()?e:t).invokeWithinContext(i=>i.get(fe))}constructor(e,t,i,n,o,r,a,c,d,l){super(IU.ID,e,t,i,n,o,a,r,c,d),this.preferencesService=l,this.diffEditorControl=void 0,this.inputLifecycleStopWatch=void 0,this._previousViewModel=null}getTitle(){return this.input?this.input.getName():h(3326,"Text Diff Editor")}createEditorControl(e,t){this.diffEditorControl=this._register(this.instantiationService.createInstance(Xu,e,t,{}))}updateEditorControlOptions(e){this.diffEditorControl?.updateOptions(e)}getMainControl(){return this.diffEditorControl?.getModifiedEditor()}async setInput(e,t,i,n){this._previousViewModel&&(this._previousViewModel.dispose(),this._previousViewModel=null),this.inputLifecycleStopWatch=void 0,await super.setInput(e,t,i,n);try{const o=await e.resolve();if(n.isCancellationRequested)return;if(!(o instanceof ihe)){this.openAsBinary(e,t);return}const r=jt(this.diffEditorControl),a=o,c=a.textDiffEditorModel?r.createViewModel(a.textDiffEditorModel):null;this._previousViewModel=c,await c?.waitForDiff(),r.setModel(c);let d=!1;Jse(t?.viewState)||(d=this.restoreTextDiffEditorViewState(e,t,i,r));let l=!1;t&&(l=aB(t,r,Qi.Immediate)),!l&&!d&&r.revealFirstDiff(),r.updateOptions({...this.getReadonlyConfiguration(a.modifiedModel?.isReadonly()),originalEditable:!a.originalModel?.isReadonly()}),r.handleInitialized(),this.inputLifecycleStopWatch=new Xn(!1)}catch(o){await this.handleSetInputError(o,e,t)}}async handleSetInputError(e,t,i){if(this.isFileBinaryError(e))return this.openAsBinary(t,i);if(e.fileOperationResult===Kn.FILE_TOO_LARGE){let n;throw e instanceof a_e?n=h(3327,"At least one file is not displayed in the text compare editor because it is very large ({0}).",qo.formatSize(e.size)):n=h(3328,"At least one file is not displayed in the text compare editor because it is very large."),JSe(this.group,t,i,n,this.preferencesService)}throw e}restoreTextDiffEditorViewState(e,t,i,n){const o=this.loadEditorViewState(e,i);return o?(t?.selection&&o.modified&&(o.modified.cursorState=[]),n.restoreViewState(o),t?.revealIfVisible&&n.revealFirstDiff(),!0):!1}openAsBinary(e,t){const i=e.original,n=e.modified,o=this.instantiationService.createInstance(go,e.getName(),e.getDescription(),i,n,!0),r=Ke.as(iv.EditorFactory).getFileEditorFactory();r.isFileEditor(i)&&i.setForceOpenAsBinary(),r.isFileEditor(n)&&n.setForceOpenAsBinary(),this.group.replaceEditors([{editor:e,replacement:o,options:{...t,activation:qc.PRESERVE,pinned:this.group.isPinned(e),sticky:this.group.isSticky(e)}}])}setOptions(e){super.setOptions(e),e&&aB(e,jt(this.diffEditorControl),Qi.Smooth)}shouldHandleConfigurationChangeEvent(e,t){return super.shouldHandleConfigurationChangeEvent(e,t)?!0:e.affectsConfiguration(t,"diffEditor")||e.affectsConfiguration(t,"accessibility.verbosity.diffEditor")}computeConfiguration(e){const t=super.computeConfiguration(e);if(ra(e.diffEditor)){const n=Tr(e.diffEditor);n.diffCodeLens=n.codeLens,delete n.codeLens,n.diffWordWrap=n.wordWrap,delete n.wordWrap,Object.assign(t,n)}const i=e.accessibility?.verbosity?.diffEditor??!1;return t.accessibilityVerbose=i,t}getConfigurationOverrides(e){return{...super.getConfigurationOverrides(e),...this.getReadonlyConfiguration(this.input?.isReadonly()),originalEditable:this.input instanceof go&&!this.input.original.isReadonly(),lineDecorationsWidth:"2ch"}}updateReadonly(e){e instanceof go?this.diffEditorControl?.updateOptions({...this.getReadonlyConfiguration(e.isReadonly()),originalEditable:!e.original.isReadonly()}):super.updateReadonly(e)}isFileBinaryError(e){return Array.isArray(e)?e.some(i=>this.isFileBinaryError(i)):e.textFileOperationResult===coe.FILE_IS_BINARY}clearInput(){this._previousViewModel&&(this._previousViewModel.dispose(),this._previousViewModel=null),super.clearInput();const e=this.inputLifecycleStopWatch?.elapsed();this.inputLifecycleStopWatch=void 0,typeof e=="number"&&this.logInputLifecycleTelemetry(e,this.getControl()?.getModel()?.modified?.getLanguageId()),this.diffEditorControl?.setModel(null)}logInputLifecycleTelemetry(e,t){let i=!1;this.diffEditorControl instanceof Xu&&(i=this.diffEditorControl.collapseUnchangedRegions),this.telemetryService.publicLog2("diffEditor.editorVisibleTime",{editorVisibleTimeMs:e,languageId:t??"",collapseUnchangedRegions:i})}getControl(){return this.diffEditorControl}focus(){super.focus(),this.diffEditorControl?.focus()}hasFocus(){return this.diffEditorControl?.hasTextFocus()||super.hasFocus()}setEditorVisible(e){super.setEditorVisible(e),e?this.diffEditorControl?.onVisible():this.diffEditorControl?.onHide()}layout(e){this.diffEditorControl?.layout(e)}setBoundarySashes(e){this.diffEditorControl?.setBoundarySashes(e)}tracksEditorViewState(e){return e instanceof go}computeEditorViewState(e){if(!this.diffEditorControl)return;const t=this.diffEditorControl.getModel();if(!t||!t.modified||!t.original)return;const i=this.toEditorViewStateResource(t);if(i&&At(i,e))return this.diffEditorControl.saveViewState()??void 0}toEditorViewStateResource(e){let t,i;if(e instanceof go?(t=e.original.resource,i=e.modified.resource):SC(e)||(t=e.original.uri,i=e.modified.uri),!(!t||!i))return R.from({scheme:"diff",path:`${AE(t.toString())}${AE(i.toString())}`})}};Kb=IU=f([p(1,ai),p(2,Z),p(3,it),p(4,ir),p(5,de),p(6,pt),p(7,xe),p(8,je),p(9,Hv)],Kb);function Vm(s,e,t=ol){if(t===ol||t===Rr)return t;let i=s.getGroups(Jo.GRID_APPEARANCE)[t];if(!i&&t<9){for(let n=0;n<=t;n++){const o=s.getGroups(Jo.GRID_APPEARANCE);o[n]||s.addGroup(o[n-1],zv(e))}i=s.getGroups(Jo.GRID_APPEARANCE)[t]}return i?.id??Rr}function Qp(s,e){const t=typeof e=="number"?s.getGroup(e):e;return s.getGroups(Jo.GRID_APPEARANCE).indexOf(t??s.activeGroup)}const MZ="toggle.diff.renderSideBySide",NZ="workbench.action.compareEditor.nextChange",OZ="workbench.action.compareEditor.previousChange",nhe="workbench.action.compareEditor.focusPrimarySide",she="workbench.action.compareEditor.focusSecondarySide",ohe="workbench.action.compareEditor.focusOtherSide",VNe="workbench.action.compareEditor.openSide",HNe="toggle.diff.ignoreTrimWhitespace",FZ="workbench.action.compareEditor.swapSides";function UNe(){Me.registerCommandAndKeybindingRule({id:NZ,weight:W.WorkbenchContrib,when:tW,primary:E.Alt|S.F5,handler:(a,...c)=>e(a,c,!0)}),ge.appendMenuItem(N.CommandPalette,{command:{id:NZ,title:I(2941,"Go to Next Change")}}),Me.registerCommandAndKeybindingRule({id:OZ,weight:W.WorkbenchContrib,when:tW,primary:E.Alt|E.Shift|S.F5,handler:(a,...c)=>e(a,c,!1)}),ge.appendMenuItem(N.CommandPalette,{command:{id:OZ,title:I(2942,"Go to Previous Change")}});function s(a,c){const d=a.get(de),l=c.length>0&&c[0]instanceof R?c[0]:void 0;for(const u of[d.activeEditorPane,...d.visibleEditorPanes])if(u instanceof Kb&&(!l||u.input instanceof go&&At(u.input.primary.resource,l)))return u}function e(a,c,d){const l=s(a,c);l&&l.getControl()?.goToDiff(d?"next":"previous")}let t;(function(a){a[a.Original=0]="Original",a[a.Modified=1]="Modified",a[a.Toggle=2]="Toggle"})(t||(t={}));function i(a,c,d){const l=s(a,c);if(l)switch(d){case t.Original:l.getControl()?.getOriginalEditor().focus();break;case t.Modified:l.getControl()?.getModifiedEditor().focus();break;case t.Toggle:return l.getControl()?.getModifiedEditor().hasWidgetFocus()?i(a,c,t.Original):i(a,c,t.Modified)}}function n(a,c){const d=a.get(ir),u=s(a,c)?.getControl()?.getModifiedEditor()?.getModel();if(!u)return;const g="diffEditor.renderSideBySide",m=d.getValue(u.uri,g);d.updateValue(u.uri,g,!m)}function o(a,c){const d=a.get(ir),u=s(a,c)?.getControl()?.getModifiedEditor()?.getModel();if(!u)return;const g="diffEditor.ignoreTrimWhitespace",m=d.getValue(u.uri,g);d.updateValue(u.uri,g,!m)}async function r(a,c){const d=a.get(de),l=s(a,c),u=l?.group,g=l?.input;if(!l||typeof u>"u"||!(g instanceof go)||!g.modified.resource)return;const m=g.toUntyped({preserveViewState:u.id,preserveResource:!0});if(m){if(g.modified.isModified()&&d.findEditors({resource:g.modified.resource,typeId:g.modified.typeId,editorId:g.modified.editorId}).length===0){const v={...m.modified};v.options||(v.options={}),v.options.pinned=!0,v.options.inactive=!0,await d.openEditor(v,u)}await d.replaceEditors([{editor:g,replacement:{...m,original:m.modified,modified:m.original,options:{...m.options,pinned:!0}}}],u)}}Me.registerCommandAndKeybindingRule({id:MZ,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>n(a,c)}),Me.registerCommandAndKeybindingRule({id:nhe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>i(a,c,t.Modified)}),Me.registerCommandAndKeybindingRule({id:she,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>i(a,c,t.Original)}),Me.registerCommandAndKeybindingRule({id:ohe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>i(a,c,t.Toggle)}),Me.registerCommandAndKeybindingRule({id:HNe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>o(a,c)}),Me.registerCommandAndKeybindingRule({id:FZ,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(a,...c)=>r(a,c)}),ge.appendMenuItem(N.CommandPalette,{command:{id:MZ,title:I(2943,"Toggle Inline View"),category:h(2944,"Compare")},when:Fb}),ge.appendMenuItem(N.CommandPalette,{command:{id:FZ,title:I(2945,"Swap Left and Right Editor Side"),category:h(2944,"Compare")},when:x.and(Fb,doe)})}function Ns(s,e,t,i){const n=$Ne(s,e,t,i),o=n.length&&n[0].preserveFocus||!1,r={groupedEditors:[],preserveFocus:o};for(const a of n){const c=qNe(a,t);if(!c)continue;const{group:d,editor:l}=c;let u;for(const g of r.groupedEditors)if(g.group.id===d.id){u=g;break}u||(u={group:d,editors:[]},r.groupedEditors.push(u)),l&&u.editors.push(l)}return r}function $Ne(s,e,t,i){const n=i.lastFocusedList;let o=n instanceof Rv&&n.getHTMLElement()===wh(),r=zNe(s,o,e,t,i);if(!r){const c=t.activeGroup,d=c.activeEditor;r={groupId:c.id,editorIndex:d?c.getIndexOfEditor(d):void 0},o=!1}const a=rhe(r,o,e,t,i);return GNe(r,a)}function GNe(s,e){if(e.length<=1)return e;const t=e.findIndex(i=>i.groupId===s.groupId&&i.editorIndex===s.editorIndex);if(t!==-1)e.splice(t,1),e.unshift(s);else if(s.editorIndex===void 0)e.unshift(s);else throw new Error("Editor context not found in multi editor context");return e}function zNe(s,e,t,i,n){const o=s.filter(r=>P8(r)||R.isUri(r));for(const r of o)if(P8(r))return r;for(const r of o){const a=t.findEditors(r);if(a.length){const c=a[0],d=i.getGroup(c.groupId);return{groupId:c.groupId,editorIndex:d?.getIndexOfEditor(c.editor)}}}if(e){const r=n.lastFocusedList;for(const a of r.getFocusedElements())if(ahe(a))return DU(a,void 0,i)}}function rhe(s,e,t,i,n){if(e){const r=n.lastFocusedList.getSelectedElements().filter(ahe);if(r.length>1)return r.map(a=>DU(a,s.preserveFocus,i));if(r.length===0)return rhe(s,!1,t,i,n)}else{const o=i.getGroup(s.groupId),r=s.editorIndex!==void 0?o?.getEditorByIndex(s.editorIndex):o?.activeEditor;if(o&&r&&o.isSelected(r))return o.selectedEditors.map(a=>DU({editor:a,groupId:o.id},s.preserveFocus,i))}return[s]}function DU(s,e,t){if(rq(s))return{groupId:s.id,editorIndex:void 0,preserveFocus:e};const i=t.getGroup(s.groupId);return{groupId:s.groupId,editorIndex:i?i.getIndexOfEditor(s.editor):-1,preserveFocus:e}}function ahe(s){return rq(s)||iW(s)}function qNe(s,e){const t=e.getGroup(s.groupId);if(!t)return;if(s.editorIndex===void 0)return{group:t,editor:void 0};const i=t.getEditorByIndex(s.editorIndex);return{group:t,editor:i}}const che="workbench.action.closeUnmodifiedEditors",dhe="workbench.action.closeEditorsInGroup",lhe="workbench.action.closeEditorsAndGroup",KNe="workbench.action.closeEditorsToTheRight",cS="workbench.action.closeActiveEditor",jNe="workbench.action.closeActivePinnedEditor",YNe="workbench.action.closeGroup",hhe="workbench.action.closeOtherEditors",Il="moveActiveEditor",xg="copyActiveEditor",Ig="layoutEditorGroups",QNe="workbench.action.keepEditor",XNe="workbench.action.toggleKeepEditors",ZNe="workbench.action.toggleEditorGroupLock",JNe="workbench.action.lockEditorGroup",jO="workbench.action.unlockEditorGroup",eOe="workbench.action.showEditorsInGroup",uhe="workbench.action.reopenWithEditor",tOe="reopenActiveEditorWith",iOe="workbench.action.pinEditor",N4="workbench.action.unpinEditor",ghe="workbench.action.splitEditor",kU="workbench.action.splitEditorUp",TU="workbench.action.splitEditorDown",AU="workbench.action.splitEditorLeft",RU="workbench.action.splitEditorRight",phe="workbench.action.toggleMaximizeEditorGroup",nOe="workbench.action.splitEditorInGroup",sOe="workbench.action.toggleSplitEditorInGroup",oOe="workbench.action.joinEditorInGroup",rOe="workbench.action.toggleSplitEditorInGroupLayout",aOe="workbench.action.focusFirstSideEditor",cOe="workbench.action.focusSecondSideEditor",dOe="workbench.action.focusOtherSideEditor",lOe="workbench.action.focusLeftGroupWithoutWrap",hOe="workbench.action.focusRightGroupWithoutWrap",uOe="workbench.action.focusAboveGroupWithoutWrap",gOe="workbench.action.focusBelowGroupWithoutWrap",WZ="workbench.action.openEditorAtIndex",pOe="workbench.action.moveEditorToNewWindow",fOe="workbench.action.copyEditorToNewWindow",mOe="workbench.action.moveEditorGroupToNewWindow",vOe="workbench.action.copyEditorGroupToNewWindow",_Oe="workbench.action.newEmptyEditorWindow",BZ="_workbench.open",VZ="_workbench.diff",bOe="_workbench.openWith",yOe=[ghe,cS,N4,jO,phe],HZ=function(s){return!(!ra(s)||!Tt(s.to)||!Ym(s.by)&&!Tt(s.by)||!Ym(s.value)&&!ec(s.value))};function wOe(){const s={type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right"]},by:{type:"string",enum:["tab","group"]},value:{type:"number"}}};Me.registerCommandAndKeybindingRule({id:Il,weight:W.WorkbenchContrib,when:V.editorTextFocus,primary:0,handler:(o,r)=>e(!0,r,o),metadata:{description:h(3200,"Move the active editor by tabs or groups"),args:[{name:h(3201,"Active editor move argument"),description:h(3202,`Argument Properties:
	* 'to': String value providing where to move.
	* 'by': String value providing the unit for move (by tab or by group).
	* 'value': Number value providing how many positions or an absolute position to move.`),constraint:HZ,schema:s}]}}),Me.registerCommandAndKeybindingRule({id:xg,weight:W.WorkbenchContrib,when:V.editorTextFocus,primary:0,handler:(o,r)=>e(!1,r,o),metadata:{description:h(3203,"Copy the active editor by groups"),args:[{name:h(3204,"Active editor copy argument"),description:h(3205,`Argument Properties:
	* 'to': String value providing where to copy.
	* 'value': Number value providing how many positions or an absolute position to copy.`),constraint:HZ,schema:s}]}});function e(o,r=Object.create(null),a){r.to=r.to||"right",r.by=r.by||"tab",r.value=typeof r.value=="number"?r.value:1;const c=a.get(xe).activeGroup,d=c.selectedEditors;if(d.length>0)switch(r.by){case"tab":if(o)return t(r,c,d);break;case"group":return n(o,r,c,d,a)}}function t(o,r,a){const c=o.to;c==="first"||c==="right"?a=[...a].reverse():c==="position"&&(o.value??1)<r.getIndexOfEditor(a[0])&&(a=[...a].reverse());for(const d of a)i(o,r,d)}function i(o,r,a){let c=r.getIndexOfEditor(a);switch(o.to){case"first":c=0;break;case"last":c=r.count-1;break;case"left":c=c-(o.value??1);break;case"right":c=c+(o.value??1);break;case"center":c=Math.round(r.count/2)-1;break;case"position":c=(o.value??1)-1;break}c=c<0?0:c>=r.count?r.count-1:c,r.moveEditor(a,r,{index:c})}function n(o,r,a,c,d){const l=d.get(xe),u=d.get(ne);let g;switch(r.to){case"left":g=l.findGroup({direction:Jt.LEFT},a),g||(g=l.addGroup(a,Jt.LEFT));break;case"right":g=l.findGroup({direction:Jt.RIGHT},a),g||(g=l.addGroup(a,Jt.RIGHT));break;case"up":g=l.findGroup({direction:Jt.UP},a),g||(g=l.addGroup(a,Jt.UP));break;case"down":g=l.findGroup({direction:Jt.DOWN},a),g||(g=l.addGroup(a,Jt.DOWN));break;case"first":g=l.findGroup({location:Za.FIRST},a);break;case"last":g=l.findGroup({location:Za.LAST},a);break;case"previous":g=l.findGroup({location:Za.PREVIOUS},a);break;case"next":g=l.findGroup({location:Za.NEXT},a),g||(g=l.addGroup(a,zv(u)));break;case"center":g=l.getGroups(Jo.GRID_APPEARANCE)[l.count/2-1];break;case"position":g=l.getGroups(Jo.GRID_APPEARANCE)[(r.value??1)-1];break}if(g){const m=Aq(a,c);o?a.moveEditors(m,g):a.id!==g.id&&a.copyEditors(m,g),g.focus()}}}function SOe(){function s(e,t){if(!t||typeof t!="object")return;e.get(xe).applyLayout(t)}Ee.registerCommand(Ig,(e,t)=>{s(e,t)}),Ee.registerCommand({id:"vscode.setEditorLayout",handler:(e,t)=>s(e,t),metadata:{description:`Set the editor layout. Editor layout is represented as a tree of groups in which the first group is the root group of the layout.
					The orientation of the first group is 0 (horizontal) by default unless specified otherwise. The other orientations are 1 (vertical).
					The orientation of subsequent groups is the opposite of the orientation of the group that contains it.
					Here are some examples: A layout representing 1 row and 2 columns: { orientation: 0, groups: [{}, {}] }.
					A layout representing 3 rows and 1 column: { orientation: 1, groups: [{}, {}, {}] }.
					A layout representing 3 rows and 1 column in which the second row has 2 columns: { orientation: 1, groups: [{}, { groups: [{}, {}] }, {}] }
					`,args:[{name:"args",schema:{type:"object",required:["groups"],properties:{orientation:{type:"number",default:0,description:"The orientation of the root group in the layout. 0 for horizontal, 1 for vertical.",enum:[0,1],enumDescriptions:[h(3206,"Horizontal"),h(3207,"Vertical")]},groups:{$ref:"#/definitions/editorGroupsSchema",default:[{},{}]}}}}]}}),Ee.registerCommand({id:"vscode.getEditorLayout",handler:e=>e.get(xe).getLayout(),metadata:{description:"Get Editor Layout",args:[],returns:"An editor layout object, in the same format as vscode.setEditorLayout"}})}function COe(){function s(e,t,i){return e?[{...e.editorOptions,...t??Object.create(null)},e.sideBySide?Rr:i]:[t,i]}Ee.registerCommand({id:"vscode.open",handler:(e,t)=>{e.get(Ge).executeCommand(BZ,t)},metadata:{description:"Opens the provided resource in the editor.",args:[{name:"Uri"}]}}),Ee.registerCommand(BZ,async function(e,t,i,n,o){const r=e.get(de),a=e.get(xe),c=e.get(mi),d=e.get(_c),l=e.get(ne),u=e.get(aq),g=typeof t=="string"?t:R.from(t,!0),[m,v]=i??[];if(v||typeof m=="number"||RE(g,ae.untitled)){const[_,w]=s(o,v,m),C=R.isUri(g)?g:R.parse(g);let k;u.isUntitledWithAssociatedResource(C)?k={resource:C.with({scheme:d.defaultUriScheme}),forceUntitled:!0,options:_,label:n}:k={resource:C,options:_,label:n},await r.openEditor(k,Vm(a,l,w))}else{if(RE(g,ae.command))return;await c.open(g,{openToSide:o?.sideBySide,editorOptions:o?.editorOptions})}}),Ee.registerCommand({id:"vscode.diff",handler:(e,t,i,n)=>{e.get(Ge).executeCommand(VZ,t,i,n)},metadata:{description:"Opens the provided resources in the diff editor to compare their contents.",args:[{name:"left",description:"Left-hand side resource of the diff editor"},{name:"right",description:"Right-hand side resource of the diff editor"},{name:"title",description:"Human readable title for the diff editor"}]}}),Ee.registerCommand(VZ,async function(e,t,i,n,o,r){const a=e.get(de),c=e.get(xe),d=e.get(ne),[l,u]=o??[],[g,m]=s(r,u,l);let v,_;typeof n=="string"?v=n:n&&(v=n.label,_=n.description),await a.openEditor({original:{resource:R.from(t,!0)},modified:{resource:R.from(i,!0)},label:v,description:_,options:g},Vm(c,d,m))}),Ee.registerCommand(bOe,async(e,t,i,n)=>{const o=e.get(de),r=e.get(xe),a=e.get(ne),[c,d]=n??[];await o.openEditor({resource:R.from(t,!0),options:{pinned:!0,...d,override:i}},Vm(r,a,c))}),Ee.registerCommand({id:"vscode.changes",handler:(e,t,i)=>{e.get(Ge).executeCommand("_workbench.changes",t,i)},metadata:{description:"Opens a list of resources in the changes editor to compare their contents.",args:[{name:"title",description:"Human readable title for the diff editor"},{name:"resources",description:"List of resources to open in the changes editor"}]}}),Ee.registerCommand("_workbench.changes",async(e,t,i)=>{const n=e.get(de),o=[];for(const[r,a,c]of i)o.push({resource:R.revive(r),original:{resource:R.revive(a)},modified:{resource:R.revive(c)}});await n.openEditor({resources:o,label:t})}),Ee.registerCommand("_workbench.openMultiDiffEditor",async(e,t)=>{await e.get(de).openEditor({multiDiffSource:t.multiDiffSourceUri?R.revive(t.multiDiffSourceUri):void 0,resources:t.resources?.map(n=>({original:{resource:R.revive(n.originalUri)},modified:{resource:R.revive(n.modifiedUri)}})),label:t.title})})}function EOe(){const s=(t,i)=>{const n=t.get(de),o=n.activeEditorPane;if(o){const r=o.group.getEditorByIndex(i);r&&n.openEditor(r)}};Ee.registerCommand({id:WZ,handler:s});for(let t=0;t<9;t++){const i=t,n=t+1;Me.registerCommandAndKeybindingRule({id:WZ+n,weight:W.WorkbenchContrib,when:void 0,primary:E.Alt|e(n),mac:{primary:E.WinCtrl|e(n)},handler:o=>s(o,i)})}function e(t){switch(t){case 0:return S.Digit0;case 1:return S.Digit1;case 2:return S.Digit2;case 3:return S.Digit3;case 4:return S.Digit4;case 5:return S.Digit5;case 6:return S.Digit6;case 7:return S.Digit7;case 8:return S.Digit8;case 9:return S.Digit9}throw new Error("invalid index")}}function xOe(){for(let t=1;t<8;t++)Me.registerCommandAndKeybindingRule({id:s(t),weight:W.WorkbenchContrib,when:void 0,primary:E.CtrlCmd|e(t),handler:i=>{const n=i.get(xe),o=i.get(ne);if(t>n.count)return;const r=n.getGroups(Jo.GRID_APPEARANCE);if(r[t])return r[t].focus();const a=zv(o),c=n.findGroup({location:Za.LAST});if(!c)return;n.addGroup(c,a).focus()}});function s(t){switch(t){case 1:return"workbench.action.focusSecondEditorGroup";case 2:return"workbench.action.focusThirdEditorGroup";case 3:return"workbench.action.focusFourthEditorGroup";case 4:return"workbench.action.focusFifthEditorGroup";case 5:return"workbench.action.focusSixthEditorGroup";case 6:return"workbench.action.focusSeventhEditorGroup";case 7:return"workbench.action.focusEighthEditorGroup"}throw new Error("Invalid index")}function e(t){switch(t){case 1:return S.Digit2;case 2:return S.Digit3;case 3:return S.Digit4;case 4:return S.Digit5;case 5:return S.Digit6;case 6:return S.Digit7;case 7:return S.Digit8}throw new Error("Invalid index")}}function fhe(s,e,t){if(!t.groupedEditors.length)return;const{group:i,editors:n}=t.groupedEditors[0],o=t.preserveFocus,r=s.addGroup(i,e);for(const a of n)a&&!a.hasCapability(Je.Singleton)&&i.copyEditor(a,r,{preserveFocus:o});r.focus()}function IOe(){[{id:kU,direction:Jt.UP},{id:TU,direction:Jt.DOWN},{id:AU,direction:Jt.LEFT},{id:RU,direction:Jt.RIGHT}].forEach(({id:s,direction:e})=>{Ee.registerCommand(s,function(t,...i){const n=Ns(i,t.get(de),t.get(xe),t.get(Ei));fhe(t.get(xe),e,n)})})}function DOe(){function s(t,i,...n){const o=t.get(xe),r=t.get(de);let a;if(i||n.length?a=!1:a=o.partOptions.preventPinnedEditorClose==="keyboard"||o.partOptions.preventPinnedEditorClose==="keyboardAndMouse",a){const l=o.activeGroup,u=l.activeEditor;if(u&&l.isSticky(u)){const g=l.getEditors(Ii.MOST_RECENTLY_ACTIVE,{excludeSticky:!0})[0];if(g)return l.openEditor(g);const m=r.getEditors(Ii.MOST_RECENTLY_ACTIVE,{excludeSticky:!0})[0];if(m)return Promise.resolve(o.getGroup(m.groupId)?.openEditor(m.editor))}}const c=Ns(n,t.get(de),t.get(xe),t.get(Ei)),d=c.preserveFocus;return Promise.all(c.groupedEditors.map(async({group:l,editors:u})=>{const g=u.filter(m=>!a||!l.isSticky(m));await l.closeEditors(g,{preserveFocus:d})}))}Me.registerCommandAndKeybindingRule({id:cS,weight:W.WorkbenchContrib,when:void 0,primary:E.CtrlCmd|S.KeyW,win:{primary:E.CtrlCmd|S.F4,secondary:[E.CtrlCmd|S.KeyW]},handler:(t,...i)=>s(t,!1,...i)}),Ee.registerCommand(jNe,(t,...i)=>s(t,!0,...i)),Me.registerCommandAndKeybindingRule({id:dhe,weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.KeyW),handler:(t,...i)=>{const n=Ns(i,t.get(de),t.get(xe),t.get(Ei));return Promise.all(n.groupedEditors.map(async({group:o})=>{await o.closeAllEditors({excludeSticky:!0})}))}}),Me.registerCommandAndKeybindingRule({id:YNe,weight:W.WorkbenchContrib,when:x.and(hq,bN),primary:E.CtrlCmd|S.KeyW,win:{primary:E.CtrlCmd|S.F4,secondary:[E.CtrlCmd|S.KeyW]},handler:(t,...i)=>{const n=t.get(xe),o=Ns(i,t.get(de),n,t.get(Ei));o.groupedEditors.length&&n.removeGroup(o.groupedEditors[0].group)}}),Me.registerCommandAndKeybindingRule({id:che,weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.KeyU),handler:(t,...i)=>{const n=Ns(i,t.get(de),t.get(xe),t.get(Ei));return Promise.all(n.groupedEditors.map(async({group:o})=>{await o.closeEditors({savedOnly:!0,excludeSticky:!0},{preserveFocus:n.preserveFocus})}))}}),Me.registerCommandAndKeybindingRule({id:hhe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,mac:{primary:E.CtrlCmd|E.Alt|S.KeyT},handler:(t,...i)=>{const n=Ns(i,t.get(de),t.get(xe),t.get(Ei));return Promise.all(n.groupedEditors.map(async({group:o,editors:r})=>{const a=o.getEditors(Ii.SEQUENTIAL,{excludeSticky:!0}).filter(c=>!r.includes(c));for(const c of r)c&&o.pinEditor(c);await o.closeEditors(a,{preserveFocus:n.preserveFocus})}))}}),Me.registerCommandAndKeybindingRule({id:KNe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:async(t,...i)=>{const n=Ns(i,t.get(de),t.get(xe),t.get(Ei));if(n.groupedEditors.length){const{group:o,editors:r}=n.groupedEditors[0];o.activeEditor&&o.pinEditor(o.activeEditor),await o.closeEditors({direction:uq.RIGHT,except:r[0],excludeSticky:!0},{preserveFocus:n.preserveFocus})}}}),Me.registerCommandAndKeybindingRule({id:uhe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(t,...i)=>e(t,ZT.PICK,...i)}),Me.registerCommandAndKeybindingRule({id:tOe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(t,i,...n)=>e(t,i??ZT.PICK,...n)});async function e(t,i,...n){const o=t.get(de),r=t.get(mf),a=t.get(ai),c=Ns(n,o,t.get(xe),t.get(Ei)),d=new Map;for(const{group:l,editors:u}of c.groupedEditors)for(const g of u){const m=g.toUntyped();if(!m)return;m.options={...o.activeEditorPane?.options,override:i};const v=await r.resolveEditor(m,l);if(!eCe(v))return;let _=d.get(l);_||(_=[],d.set(l,_)),_.push({editor:g,replacement:v.editor,forceReplaceDirty:g.resource?.scheme===ae.untitled,options:v.options}),a.publicLog2("workbenchEditorReopen",{scheme:g.resource?.scheme??"",ext:g.resource?YM(g.resource):"",from:g.editorId??"",to:v.editor.editorId??""})}for(const[l,u]of d)await l.replaceEditors(u),await l.openEditor(u[0].replacement)}Ee.registerCommand(lhe,async(t,...i)=>{const n=t.get(xe),o=Ns(i,t.get(de),n,t.get(Ei));if(o.groupedEditors.length){const{group:r}=o.groupedEditors[0];await r.closeAllEditors(),r.count===0&&n.getGroup(r.id)&&n.removeGroup(r)}})}function kOe(){const s=[{id:lOe,direction:Jt.LEFT},{id:hOe,direction:Jt.RIGHT},{id:uOe,direction:Jt.UP},{id:gOe,direction:Jt.DOWN}];for(const e of s)Ee.registerCommand(e.id,async t=>{const i=t.get(xe);(i.findGroup({direction:e.direction},i.activeGroup,!1)??i.activeGroup).focus()})}function TOe(){async function s(t,i){const n=t.get(Z);if(!i.groupedEditors.length)return;const{group:o,editors:r}=i.groupedEditors[0],a=r[0];a&&await o.replaceEditors([{editor:a,replacement:n.createInstance(ks,void 0,void 0,a,a),forceReplaceDirty:!0}])}Y(class extends X{constructor(){super({id:nOe,title:I(3208,"Split Editor in Group"),category:te.View,precondition:CC,f1:!0,keybinding:{weight:W.WorkbenchContrib,when:CC,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.Backslash)}})}run(t,...i){return s(t,Ns(i,t.get(de),t.get(xe),t.get(Ei)))}});async function e(t){if(!t.groupedEditors.length)return;const{group:i,editors:n}=t.groupedEditors[0],o=n[0];if(!o||!(o instanceof ks))return;let r;const a=i.activeEditorPane;if(a instanceof xp&&i.activeEditor===o){for(const c of[a.getPrimaryEditorPane(),a.getSecondaryEditorPane()])if(c?.hasFocus()){r={viewState:c.getViewState()};break}}await i.replaceEditors([{editor:o,replacement:o.primary,options:r}])}Y(class extends X{constructor(){super({id:oOe,title:I(3209,"Join Editor in Group"),category:te.View,precondition:mu,f1:!0,keybinding:{weight:W.WorkbenchContrib,when:mu,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.Backslash)}})}run(t,...i){return e(Ns(i,t.get(de),t.get(xe),t.get(Ei)))}}),Y(class extends X{constructor(){super({id:sOe,title:I(3210,"Toggle Split Editor in Group"),category:te.View,precondition:x.or(CC,mu),f1:!0})}async run(t,...i){const n=Ns(i,t.get(de),t.get(xe),t.get(Ei));if(!n.groupedEditors.length)return;const{editors:o}=n.groupedEditors[0];o[0]instanceof ks?await e(n):o[0]&&await s(t,n)}}),Y(class extends X{constructor(){super({id:rOe,title:I(3211,"Toggle Layout of Split Editor in Group"),category:te.View,precondition:mu,f1:!0})}async run(t){const i=t.get(ne),n=i.getValue(xp.SIDE_BY_SIDE_LAYOUT_SETTING);let o;return n!=="horizontal"?o="horizontal":o="vertical",i.updateValue(xp.SIDE_BY_SIDE_LAYOUT_SETTING,o)}})}function AOe(){Y(class extends X{constructor(){super({id:aOe,title:I(3212,"Focus First Side in Active Editor"),category:te.View,precondition:x.or(mu,Fb),f1:!0})}async run(s){const e=s.get(de),t=s.get(Ge),i=e.activeEditorPane;i instanceof xp?i.getSecondaryEditorPane()?.focus():i instanceof Kb&&await t.executeCommand(she)}}),Y(class extends X{constructor(){super({id:cOe,title:I(3213,"Focus Second Side in Active Editor"),category:te.View,precondition:x.or(mu,Fb),f1:!0})}async run(s){const e=s.get(de),t=s.get(Ge),i=e.activeEditorPane;i instanceof xp?i.getPrimaryEditorPane()?.focus():i instanceof Kb&&await t.executeCommand(nhe)}}),Y(class extends X{constructor(){super({id:dOe,title:I(3214,"Focus Other Side in Active Editor"),category:te.View,precondition:x.or(mu,Fb),f1:!0})}async run(s){const e=s.get(de),t=s.get(Ge),i=e.activeEditorPane;i instanceof xp?i.getPrimaryEditorPane()?.hasFocus()?i.getSecondaryEditorPane()?.focus():i.getPrimaryEditorPane()?.focus():i instanceof Kb&&await t.executeCommand(ohe)}})}function ROe(){Me.registerCommandAndKeybindingRule({id:QNe,weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.Enter),handler:async(e,...t)=>{const i=Ns(t,e.get(de),e.get(xe),e.get(Ei));for(const{group:n,editors:o}of i.groupedEditors)for(const r of o)n.pinEditor(r)}}),Ee.registerCommand({id:XNe,handler:e=>{const t=e.get(ne),n=t.getValue("workbench.editor.enablePreview")!==!0;t.updateValue("workbench.editor.enablePreview",n)}});function s(e,t,...i){const o=Ns(i,e.get(de),e.get(xe),e.get(Ei)).groupedEditors[0]?.group;o?.lock(t??!o.isLocked)}Y(class extends X{constructor(){super({id:ZNe,title:I(3215,"Toggle Editor Group Lock"),category:te.View,f1:!0})}async run(e,...t){s(e,void 0,...t)}}),Y(class extends X{constructor(){super({id:JNe,title:I(3216,"Lock Editor Group"),category:te.View,precondition:hA.toNegated(),f1:!0})}async run(e,...t){s(e,!0,...t)}}),Y(class extends X{constructor(){super({id:jO,title:I(3217,"Unlock Editor Group"),precondition:hA,category:te.View,f1:!0})}async run(e,...t){s(e,!1,...t)}}),Me.registerCommandAndKeybindingRule({id:iOe,weight:W.WorkbenchContrib,when:uA.toNegated(),primary:lt(E.CtrlCmd|S.KeyK,E.Shift|S.Enter),handler:async(e,...t)=>{const i=Ns(t,e.get(de),e.get(xe),e.get(Ei));for(const{group:n,editors:o}of i.groupedEditors)for(const r of o)n.stickEditor(r)}}),Me.registerCommandAndKeybindingRule({id:VNe,weight:W.WorkbenchContrib,when:V.inDiffEditor,primary:lt(E.CtrlCmd|S.KeyK,E.Shift|S.KeyO),handler:async e=>{const t=e.get(de),i=e.get(xe),n=t.activeEditor,o=t.activeTextEditorControl;if(!Zu(o)||!(n instanceof go))return;let r;return o.getOriginalEditor().hasTextFocus()?r=n.original:r=n.modified,i.activeGroup.openEditor(r)}}),Me.registerCommandAndKeybindingRule({id:N4,weight:W.WorkbenchContrib,when:uA,primary:lt(E.CtrlCmd|S.KeyK,E.Shift|S.Enter),handler:async(e,...t)=>{const i=Ns(t,e.get(de),e.get(xe),e.get(Ei));for(const{group:n,editors:o}of i.groupedEditors)for(const r of o)n.unstickEditor(r)}}),Me.registerCommandAndKeybindingRule({id:eOe,weight:W.WorkbenchContrib,when:void 0,primary:void 0,handler:(e,...t)=>{const i=e.get(xe),n=e.get(Wt),r=Ns(t,e.get(de),i,e.get(Ei)).groupedEditors[0]?.group;return r&&i.activateGroup(r),n.quickAccess.show(Xy.PREFIX)}})}function cYe(){wOe(),SOe(),UNe(),COe(),EOe(),DOe(),ROe(),TOe(),AOe(),xOe(),IOe(),kOe()}class POe{constructor(e){this.root=new RP;for(const[t,i]of e)for(const n of i)this.root.add(t,n)}toString(){return this.root.toString()}getAttributes(e,t){const i=e.lastIndexOf(".");return i<1?{dirname:t,basename:e,extname:""}:{dirname:t,basename:e.substring(0,i),extname:e.substring(i+1)}}nest(e,t){const i=new RP;for(const r of e){const a=this.getAttributes(r,t),c=this.root.get(r,a);for(const d of c)i.add(d,r)}const n=(r,a=new Set)=>{if(a.has(r))return[];a.add(r);const c=this.getAttributes(r,t),d=i.get(r,c);return d.length===0?[r]:d.length===1&&d[0]===r?[r]:d.flatMap(l=>n(l,a))},o=new Map;for(const r of e){let a=n(r);a.length===0&&(a=[r]);for(const c of a){let d=o.get(c);d||o.set(c,d=new Set),r!==c&&d.add(r)}}return o}}class RP{constructor(){this.value=new O4,this.map=new Map}add(e,t){if(e==="")this.value.add(e,t);else if(e[0]==="*")this.value.add(e,t);else{const i=e[0],n=e.slice(1);let o=this.map.get(i);o||this.map.set(i,o=new RP),o.add(n,t)}}get(e,t){const i=[];i.push(...this.value.get(e,t));const n=e[0],o=e.slice(1),r=this.map.get(n);return r&&i.push(...r.get(o,t)),i}toString(e=""){const t=[];return this.value.hasItems&&t.push(`* => 
`+this.value.toString(e+"  ")),t.map(i=>e+i).join(`
`)}}class O4{constructor(){this.star=[],this.epsilon=[],this.map=new Map,this.hasItems=!1}add(e,t){if(this.hasItems=!0,e==="*")this.star.push(new $Z(t));else if(e==="")this.epsilon.push(new $Z(t));else{const i=e[e.length-1],n=e.slice(0,e.length-1);if(i==="*")throw Error("Unexpected star in SufTrie key: "+e);{let o=this.map.get(i);o||this.map.set(i,o=new O4),o.add(n,t)}}}get(e,t){const i=[];e===""&&i.push(...this.epsilon.map(a=>a.substitute(t))),this.star.length&&i.push(...this.star.map(a=>a.substitute(t,e)));const n=e[e.length-1],o=e.slice(0,e.length-1),r=this.map.get(n);return r&&i.push(...r.get(o,t)),i}toString(e=""){const t=[];return this.star.length&&t.push("* => "+this.star.join("; ")),this.epsilon.length&&t.push(" => "+this.epsilon.join("; ")),t.map(i=>e+i).join(`
`)}}var Ul;(function(s){s.capture="capture",s.basename="basename",s.dirname="dirname",s.extname="extname"})(Ul||(Ul={}));const UZ=/\$[({](capture|basename|dirname|extname)[)}]/g;class $Z{constructor(e){this.tokens=[],UZ.lastIndex=0;let t,i=0;for(;t=UZ.exec(e);){const n=e.slice(i,t.index);this.tokens.push(n);const o=t[1];switch(o){case Ul.basename:case Ul.dirname:case Ul.extname:case Ul.capture:this.tokens.push({capture:o});break;default:throw Error("unknown substitution type: "+o)}i=t.index+t[0].length}if(i!==e.length){const n=e.slice(i,e.length);this.tokens.push(n)}}substitute(e,t){return this.tokens.map(i=>{if(typeof i=="string")return i;switch(i.capture){case Ul.basename:return e.basename;case Ul.dirname:return e.dirname;case Ul.extname:return e.extname;case Ul.capture:return t||""}}).join("")}}class Ts{constructor(e,t,i,n,o,r,a,c,d,l=Zd(e),u,g=!1){this.resource=e,this.fileService=t,this.configService=i,this.filesConfigService=n,this._parent=o,this._isDirectory=r,this._isSymbolicLink=a,this._readonly=c,this._locked=d,this._name=l,this._mtime=u,this._unknown=g,this.error=void 0,this._isExcluded=!1,this.markedAsFindResult=!1,this._isDirectoryResolved=!1}get isExcluded(){return this._isExcluded?!0:this._parent?this._parent.isExcluded:!1}set isExcluded(e){this._isExcluded=e}hasChildren(e){return this.hasNests?this.nestedChildren?.some(t=>e(t))??!1:this.isDirectory}get hasNests(){return!!this.nestedChildren?.length}get isDirectoryResolved(){return this._isDirectoryResolved}get isSymbolicLink(){return!!this._isSymbolicLink}get isDirectory(){return!!this._isDirectory}get isReadonly(){return this.filesConfigService.isReadonly(this.resource,{resource:this.resource,name:this.name,readonly:this._readonly,locked:this._locked})}get mtime(){return this._mtime}get name(){return this._name}get isUnknown(){return this._unknown}get parent(){return this._parent}get root(){return this._parent?this._parent.root:this}get children(){return new Map}updateName(e){this._parent?.removeChild(this),this._name=e,this._parent?.addChild(this)}getId(){let e=this.root.resource.toString()+"::"+this.resource.toString();return this.isMarkedAsFiltered()&&(e+="::findFilterResult"),e}toString(){return`ExplorerItem: ${this.name}`}get isRoot(){return this===this.root}static create(e,t,i,n,o,r){const a=new Ts(n.resource,e,t,i,o,n.isDirectory,n.isSymbolicLink,n.readonly,n.locked,n.name,n.mtime,!n.isFile&&!n.isDirectory);if(a.isDirectory&&(a._isDirectoryResolved=!!n.children||!!r&&r.some(c=>od(c,a.resource)),n.children))for(let c=0,d=n.children.length;c<d;c++){const l=Ts.create(e,t,i,n.children[c],a,r);a.addChild(l)}return a}static mergeLocalWithDisk(e,t){if(e.resource.toString()!==t.resource.toString())return;const i=e.isDirectory||t.isDirectory;if(!(i&&t._isDirectoryResolved&&!e._isDirectoryResolved)&&(t.resource=e.resource,t.isRoot||t.updateName(e.name),t._isDirectory=e.isDirectory,t._mtime=e.mtime,t._isDirectoryResolved=e._isDirectoryResolved,t._isSymbolicLink=e.isSymbolicLink,t.error=e.error,i&&e._isDirectoryResolved)){const n=new In;t.children.forEach(o=>{n.set(o.resource,o)}),t.children.clear(),e.children.forEach(o=>{const r=n.get(o.resource);r?(Ts.mergeLocalWithDisk(o,r),t.addChild(r),n.delete(o.resource)):t.addChild(o)}),n.forEach(o=>{o instanceof YO&&t.addChild(o)})}}addChild(e){e._parent=this,e.updateResource(!1),this.children.set(this.getPlatformAwareName(e.name),e)}getChild(e){return this.children.get(this.getPlatformAwareName(e))}fetchChildren(e){const t=this.configService.getValue({resource:this.root.resource}).explorer.fileNesting;return t.enabled&&this.nestedChildren?this.nestedChildren:(async()=>{if(!this._isDirectoryResolved){const n=e===tCe.Modified;this.error=void 0;try{const o=await this.fileService.resolve(this.resource,{resolveSingleChildDescendants:!0,resolveMetadata:n}),r=Ts.create(this.fileService,this.configService,this.filesConfigService,o,this);Ts.mergeLocalWithDisk(r,this)}catch(o){throw this.error=o,o}this._isDirectoryResolved=!0}const i=[];if(t.enabled){const n=[],o=[];for(const a of this.children.entries())a[1].nestedParent=void 0,a[1].isDirectory?o.push(a):n.push(a);const r=this.fileNester.nest(n.map(([a])=>a),this.getPlatformAwareName(this.name));for(const[a,c]of n){const d=r.get(a);if(d!==void 0){c.nestedChildren=[];for(const l of d.keys()){const u=jt(this.children.get(l));c.nestedChildren.push(u),u.nestedParent=c}i.push(c)}else c.nestedChildren=void 0}for(const[a,c]of o.values())i.push(c)}else this.children.forEach(n=>{i.push(n)});return i})()}get fileNester(){if(!this.root._fileNester){const e=this.configService.getValue({resource:this.root.resource}).explorer.fileNesting,t=Object.entries(e.patterns).filter(i=>typeof i[0]=="string"&&typeof i[1]=="string"&&i[0]&&i[1]).map(([i,n])=>[this.getPlatformAwareName(i.trim()),n.split(",").map(o=>this.getPlatformAwareName(o.trim().replace(/\u200b/g,"").trim())).filter(o=>o!=="")]);this.root._fileNester=new POe(t)}return this.root._fileNester}removeChild(e){this.nestedChildren=void 0,this.children.delete(this.getPlatformAwareName(e.name))}forgetChildren(){this.children.clear(),this.nestedChildren=void 0,this._isDirectoryResolved=!1,this._fileNester=void 0}getPlatformAwareName(e){return this.fileService.hasCapability(this.resource,hh.PathCaseSensitive)?e:e.toLowerCase()}move(e){this.nestedParent?.removeChild(this),this._parent?.removeChild(this),e.removeChild(this),e.addChild(this),this.updateResource(!0)}updateResource(e){this._parent&&(this.resource=Ct(this._parent.resource,this.name)),e&&this.isDirectory&&this.children.forEach(t=>{t.updateResource(!0)})}rename(e){this.updateName(e.name),this._mtime=e.mtime,this.updateResource(!0)}find(e){const t=!this.fileService.hasCapability(e,hh.PathCaseSensitive);return e&&this.resource.scheme===e.scheme&&oo(this.resource.authority,e.authority)&&(t?c_e(e.path,this.resource.path):e.path.startsWith(this.resource.path))?this.findByPath(jm(e.path,Yc.sep),this.resource.path.length,t):null}findByPath(e,t,i){if(d_e(jm(this.resource.path,Yc.sep),e,i))return this;if(this.isDirectory){for(;t<e.length&&e[t]===Yc.sep;)t++;let n=e.indexOf(Yc.sep,t);n===-1&&(n=e.length);const o=e.substring(t,n),r=this.children.get(this.getPlatformAwareName(o));if(r)return r.findByPath(e,n,i)}return null}isMarkedAsFiltered(){return this.markedAsFindResult}markItemAndParentsAsFiltered(){this.markedAsFindResult=!0,this.parent?.markItemAndParentsAsFiltered()}unmarkItemAndChildren(){this.markedAsFindResult=!1,this.children.forEach(e=>e.unmarkItemAndChildren())}}Ts.__decorator=f([Gt],Ts.prototype,"children",null);class YO extends Ts{constructor(e,t,i,n,o){super(R.file(""),e,t,i,n,o),this._isDirectoryResolved=!0}}var aT,cT;let PP=class{static{aT=this}static{this.MAX_PARALLEL_UPLOADS=20}constructor(e,t,i,n,o){this.progressService=e,this.dialogService=t,this.explorerService=i,this.editorService=n,this.fileService=o}upload(e,t){const i=new li,n=this.progressService.withProgress({location:Xo.Window,delay:800,cancellable:!0,title:h(6998,"Uploading")},async o=>this.doUpload(e,this.toTransfer(t),o,i.token),()=>i.dispose(!0));return this.progressService.withProgress({location:ld,delay:500},()=>n),n}toTransfer(e){if(l_e(e))return e.dataTransfer;const t={items:[]};for(const i of e)t.items.push({webkitGetAsEntry:()=>({name:i.name,isDirectory:!1,isFile:!0,createReader:()=>{throw new Error("Unsupported for files")},file:n=>n(i)})});return t}async doUpload(e,t,i,n){const o=t.items,r=[];for(const u of o)r.push(u.webkitGetAsEntry());const a=[],c={startTime:Date.now(),progressScheduler:new Hz(u=>{i.report(u[u.length-1])},1e3),filesTotal:r.length,filesUploaded:0,totalBytesUploaded:0},d=new K6(aT.MAX_PARALLEL_UPLOADS);await Pp.settled(r.map(u=>d.queue(async()=>{if(n.isCancellationRequested)return;if(e&&u.name&&e.getChild(u.name)){const{confirmed:m}=await this.dialogService.confirm(F4(u.name));if(!m||(await this.explorerService.applyBulkEdit([new sc(Ct(e.resource,u.name),void 0,{recursive:!0,folder:e.getChild(u.name)?.isDirectory})],{undoLabel:h(6999,"Overwrite {0}",u.name),progressLabel:h(7e3,"Overwriting {0}",u.name)}),n.isCancellationRequested))return}const g=await this.doUploadEntry(u,e.resource,e,i,c,n);g&&a.push(g)}))),c.progressScheduler.dispose();const l=a[0];!n.isCancellationRequested&&l?.isFile&&await this.editorService.openEditor({resource:l.resource,options:{pinned:!0}})}async doUploadEntry(e,t,i,n,o,r){if(r.isCancellationRequested||!e.name||!e.isFile&&!e.isDirectory)return;let a=0;const c=(l,u)=>{a+=u,o.totalBytesUploaded+=u;const g=o.totalBytesUploaded/((Date.now()-o.startTime)/1e3);let m;l<qo.MB?o.filesTotal===1?m=`${e.name}`:m=h(7001,"{0} of {1} files ({2}/s)",o.filesUploaded,o.filesTotal,qo.formatSize(g)):m=h(7002,"{0} ({1} of {2}, {3}/s)",e.name,qo.formatSize(a),qo.formatSize(l),qo.formatSize(g)),o.progressScheduler.work({message:m})};o.filesUploaded++,c(0,0);const d=Ct(t,e.name);if(e.isFile){const l=await new Promise((u,g)=>e.file(u,g));return r.isCancellationRequested?void 0:(typeof l.stream=="function"&&l.size>qo.MB?await this.doUploadFileBuffered(d,l,c,r):await this.doUploadFileUnbuffered(d,l,c),{isFile:!0,resource:d})}else{if(await this.fileService.createFolder(d),r.isCancellationRequested)return;const l=e.createReader(),u=[];let g=!1;do{const C=await new Promise((k,D)=>l.readEntries(k,D));C.length>0?u.push(...C):g=!0}while(!g&&!r.isCancellationRequested);o.filesTotal+=u.length;const m=i&&i.getChild(e.name)||void 0,v=[],_=[];for(const C of u)C.isFile?v.push(C):C.isDirectory&&_.push(C);const w=new K6(aT.MAX_PARALLEL_UPLOADS);await Pp.settled(v.map(C=>w.queue(()=>this.doUploadEntry(C,d,m,n,o,r))));for(const C of _)await this.doUploadEntry(C,d,m,n,o,r);return{isFile:!1,resource:d}}}async doUploadFileBuffered(e,t,i,n){const o=h_e({highWaterMark:10}),r=this.fileService.writeFile(e,o);try{const a=t.stream().getReader();let c=await a.read();for(;!c.done&&!n.isCancellationRequested;){const d=Le.wrap(c.value);if(await o.write(d),n.isCancellationRequested)break;i(t.size,d.byteLength),c=await a.read()}o.end(void 0)}catch(a){o.error(a),o.end()}n.isCancellationRequested||await r}doUploadFileUnbuffered(e,t,i){return new Promise((n,o)=>{const r=new FileReader;r.onload=async a=>{try{if(a.target?.result instanceof ArrayBuffer){const c=Le.wrap(new Uint8Array(a.target.result));await this.fileService.writeFile(e,c),i(t.size,c.byteLength)}else throw new Error("Could not read from dropped file.");n()}catch(c){o(c)}},r.readAsArrayBuffer(t)})}};PP=aT=f([p(0,pl),p(1,ei),p(2,Zi),p(3,de),p(4,je)],PP);let PU=class{constructor(e,t,i,n,o,r,a,c,d,l,u){this.fileService=e,this.hostService=t,this.contextService=i,this.configurationService=n,this.dialogService=o,this.workspaceEditingService=r,this.explorerService=a,this.editorService=c,this.progressService=d,this.notificationService=l,this.instantiationService=u}async import(e,t,i){const n=new li,o=this.progressService.withProgress({location:Xo.Window,delay:800,cancellable:!0,title:h(7003,"Copying...")},async()=>await this.doImport(e,t,i,n.token),()=>n.dispose(!0));return this.progressService.withProgress({location:ld,delay:500},()=>o),o}async doImport(e,t,i,n){const o=$t((await this.instantiationService.invokeFunction(d=>rde(d,t))).map(d=>d.resource));await Promise.all(o.map(d=>this.fileService.activateProvider(d.scheme)));const r=$t(o.filter(d=>this.fileService.hasProvider(d))),a=await this.fileService.resolveAll(r.map(d=>({resource:d})));if(n.isCancellationRequested)return;this.hostService.focus(i);const c=a.filter(d=>d.success&&d.stat?.isDirectory).map(d=>({uri:d.stat.resource}));if(c.length>0&&e.isRoot){let d;(function(v){v[v.Copy=1]="Copy",v[v.Add=2]="Add"})(d||(d={}));const l=[{label:c.length>1?h(7004,"&&Copy Folders"):h(7005,"&&Copy Folder"),run:()=>d.Copy}];let u;const g=this.contextService.getWorkspace().folders.map(v=>v.uri.scheme);c.some(v=>g.indexOf(v.uri.scheme)>=0)?(l.unshift({label:c.length>1?h(7006,"&&Add Folders to Workspace"):h(7007,"&&Add Folder to Workspace"),run:()=>d.Add}),u=c.length>1?h(7008,"Do you want to copy the folders or add the folders to the workspace?"):h(7009,"Do you want to copy '{0}' or add '{0}' as a folder to the workspace?",Qe(c[0].uri))):u=c.length>1?h(7010,"Are you sure to want to copy folders?"):h(7011,"Are you sure to want to copy '{0}'?",Qe(c[0].uri));const{result:m}=await this.dialogService.prompt({type:Fe.Info,message:u,buttons:l,cancelButton:!0});if(m===d.Add)return this.workspaceEditingService.addFolders(c);if(m===d.Copy)return this.importResources(e,r,n)}else if(e instanceof Ts)return this.importResources(e,r,n)}async importResources(e,t,i){if(t&&t.length>0){const n=await this.fileService.resolve(e.resource);if(i.isCancellationRequested)return;const o=new Set,r=this.fileService.hasCapability(e.resource,hh.PathCaseSensitive);n.children&&n.children.forEach(g=>{o.add(r?g.name:g.name.toLowerCase())});let a=0;const c=$t(await Pp.settled(t.map(async g=>{if(!await this.fileService.exists(g)){a++;return}if(!(o.has(r?Qe(g):Qe(g).toLowerCase())&&!(await this.dialogService.confirm(F4(Qe(g)))).confirmed))return g})));a>0&&this.notificationService.error(a>1?h(7012,"Some or all of the dropped files could not be accessed for import."):h(7013,"The dropped file could not be accessed for import."));const d=c.map(g=>{const m=Qe(g),v=Ct(e.resource,m);return new sc(g,v,{overwrite:!0,copy:!0})}),l=this.configurationService.getValue().explorer.confirmUndo;if(await this.explorerService.applyBulkEdit(d,{undoLabel:c.length===1?h(7014,"Import {0}",Qe(c[0])):h(7015,"Import {0} resources",c.length),progressLabel:c.length===1?h(7016,"Copying {0}",Qe(c[0])):h(7017,"Copying {0} resources",c.length),progressLocation:Xo.Window,confirmBeforeUndo:l===Iu.Verbose||l===Iu.Default}),this.configurationService.getValue().explorer.autoOpenDroppedFile&&d.length===1){const g=this.explorerService.findClosest(d[0].newResource);g&&!g.isDirectory&&this.editorService.openEditor({resource:g.resource,options:{pinned:!0}})}}}};PU=f([p(0,je),p(1,Hn),p(2,It),p(3,ne),p(4,ei),p(5,uc),p(6,Zi),p(7,de),p(8,pl),p(9,Dt),p(10,Z)],PU);let LU=class{static{cT=this}static{this.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY="workbench.explorer.downloadPath"}constructor(e,t,i,n,o,r){this.fileService=e,this.explorerService=t,this.progressService=i,this.logService=n,this.fileDialogService=o,this.storageService=r}download(e){const t=new li,i=this.progressService.withProgress({location:Xo.Window,delay:800,cancellable:Kt,title:h(7018,"Downloading")},async n=>this.doDownload(e,n,t),()=>t.dispose(!0));return this.progressService.withProgress({location:ld,delay:500},()=>i),i}async doDownload(e,t,i){for(const n of e){if(i.token.isCancellationRequested)return;Kt?await this.doDownloadBrowser(n.resource,t,i):await this.doDownloadNative(n,t,i)}}async doDownloadBrowser(e,t,i){const n=await this.fileService.resolve(e,{resolveMetadata:!0});if(i.token.isCancellationRequested)return;const o=32*qo.MB,r=n.isDirectory||n.size>o,a=Fp();if(r&&OE.supported(a))try{const c=await a.showDirectoryPicker(),d={startTime:Date.now(),progressScheduler:new Hz(l=>{t.report(l[l.length-1])},1e3),filesTotal:n.isDirectory?0:1,filesDownloaded:0,totalBytesDownloaded:0,fileBytesDownloaded:0};if(n.isDirectory){const l=await c.getDirectoryHandle(n.name,{create:!0});await this.downloadFolderBrowser(n,l,d,i.token)}else await this.downloadFileBrowser(c,n,d,i.token);d.progressScheduler.dispose()}catch(c){this.logService.warn(c),i.cancel()}else if(n.isFile){let c;try{c=(await this.fileService.readFile(n.resource,{limits:{size:o}},i.token)).value.buffer}catch{c=nc.uriToBrowserUri(n.resource)}i.token.isCancellationRequested||u_e(c,n.name)}}async downloadFileBufferedBrowser(e,t,i,n){const o=await this.fileService.readFileStream(e,void 0,n);if(n.isCancellationRequested){t.close();return}return new Promise((r,a)=>{const c=o.value,d=new U;d.add(Ie(()=>t.close())),d.add(_w(n.onCancellationRequested)(()=>{d.dispose(),a(Ab())})),g_e(c,{onData:l=>{t.write(l.buffer),this.reportProgress(o.name,o.size,l.byteLength,i)},onError:l=>{d.dispose(),a(l)},onEnd:()=>{d.dispose(),r()}},n)})}async downloadFileUnbufferedBrowser(e,t,i,n){const o=await this.fileService.readFile(e,void 0,n);n.isCancellationRequested||(t.write(o.value.buffer),this.reportProgress(o.name,o.size,o.value.byteLength,i)),t.close()}async downloadFileBrowser(e,t,i,n){i.filesDownloaded++,i.fileBytesDownloaded=0,this.reportProgress(t.name,0,0,i);const r=await(await e.getFileHandle(t.name,{create:!0})).createWritable();return t.size>qo.MB?this.downloadFileBufferedBrowser(t.resource,r,i,n):this.downloadFileUnbufferedBrowser(t.resource,r,i,n)}async downloadFolderBrowser(e,t,i,n){if(e.children){i.filesTotal+=e.children.map(o=>o.isFile).length;for(const o of e.children){if(n.isCancellationRequested)return;if(o.isFile)await this.downloadFileBrowser(t,o,i,n);else{const r=await t.getDirectoryHandle(o.name,{create:!0}),a=await this.fileService.resolve(o.resource,{resolveMetadata:!0});await this.downloadFolderBrowser(a,r,i,n)}}}}reportProgress(e,t,i,n){n.fileBytesDownloaded+=i,n.totalBytesDownloaded+=i;const o=n.totalBytesDownloaded/((Date.now()-n.startTime)/1e3);let r;t<qo.MB?n.filesTotal===1?r=e:r=h(7019,"{0} of {1} files ({2}/s)",n.filesDownloaded,n.filesTotal,qo.formatSize(o)):r=h(7020,"{0} ({1} of {2}, {3}/s)",e,qo.formatSize(n.fileBytesDownloaded),qo.formatSize(t),qo.formatSize(o)),n.progressScheduler.work({message:r})}async doDownloadNative(e,t,i){t.report({message:e.name});let n;const o=this.storageService.get(cT.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY,he.APPLICATION);o?n=Ct(R.file(o),e.name):n=Ct(e.isDirectory?await this.fileDialogService.defaultFolderPath(ae.file):await this.fileDialogService.defaultFilePath(ae.file),e.name);const r=await this.fileDialogService.showSaveDialog({availableFileSystems:[ae.file],saveLabel:h(7021,"Download"),title:h(7022,"Choose Where to Download"),defaultUri:n});r?(this.storageService.store(cT.LAST_USED_DOWNLOAD_PATH_STORAGE_KEY,_s(r).fsPath,he.APPLICATION,gt.MACHINE),await this.explorerService.applyBulkEdit([new sc(e.resource,r,{overwrite:!0,copy:!0})],{undoLabel:h(7023,"Download {0}",e.name),progressLabel:h(7024,"Downloading {0}",e.name),progressLocation:Xo.Window})):i.cancel()}};LU=cT=f([p(0,je),p(1,Zi),p(2,pl),p(3,Re),p(4,to),p(5,it)],LU);function F4(s){return{message:h(7025,"A file or folder with the name '{0}' already exists in the destination folder. Do you want to replace it?",s),detail:h(7026,"This action is irreversible!"),primaryButton:h(7027,"&&Replace"),type:"warning"}}function LOe(s){return s.length>1?{message:h(7028,"The following {0} files and/or folders already exist in the destination folder. Do you want to replace them?",s.length),detail:Lu(s)+`
`+h(7026,"This action is irreversible!"),primaryButton:h(7027,"&&Replace"),type:"warning"}:F4(Qe(s[0]))}const gD="explorer.newFile",mhe=I(6891,"New File..."),QO="explorer.newFolder",vhe=I(6892,"New Folder..."),MOe=h(6893,"Rename..."),NOe=h(6894,"Delete"),OOe=h(6895,"Copy"),FOe=h(6896,"Paste"),_he=new O("fileCopied",!1),bhe="explorer.download",WOe=h(6897,"Download..."),yhe="explorer.upload",BOe=h(6898,"Upload..."),GZ="explorer.confirmDelete",VOe=5e6;function whe(s,e){e.message==="string"&&(e=e.message),s.error(bo(e,!1))}async function She(s,e){s&&(s.indexOf("/")>=0||s.indexOf("\\")>=0)&&await e.refresh()}async function W4(s,e,t,i,n,o,r,a=!1,c=!1){let d;r?d=bn?h(6899,"&&Move to Recycle Bin"):h(6900,"&&Move to Trash"):d=h(6901,"&&Delete");const l=$z(o,v=>v.resource),u=new Set;for(const v of l)for(const _ of e.getDirty(v.resource))u.add(_);if(u.size){let v;if(l.length>1?v=h(6902,"You are deleting files with unsaved changes. Do you want to continue?"):l[0].isDirectory?u.size===1?v=h(6903,"You are deleting a folder {0} with unsaved changes in 1 file. Do you want to continue?",l[0].name):v=h(6904,"You are deleting a folder {0} with unsaved changes in {1} files. Do you want to continue?",l[0].name,u.size):v=h(6905,"You are deleting {0} with unsaved changes. Do you want to continue?",l[0].name),(await t.confirm({type:"warning",message:v,detail:h(6906,"Your changes will be lost if you don't save them."),primaryButton:d})).confirmed)a=!0;else return}if(!a){const v=l.filter(_=>n.isReadonly(_.resource));if(v.length){let _;if(v.length>1?_=h(6907,"You are deleting files that are configured to be read-only. Do you want to continue?"):v[0].isDirectory?_=h(6908,"You are deleting a folder {0} that is configured to be read-only. Do you want to continue?",l[0].name):_=h(6909,"You are deleting a file {0} that is configured to be read-only. Do you want to continue?",l[0].name),!(await t.confirm({type:"warning",message:_,detail:h(6910,"The read-only protection will be overridden if you continue."),primaryButton:h(6911,"Continue")})).confirmed)return}}let g;const m=l.some(v=>v.isDirectory)?h(6912,"This action is irreversible!"):l.length>1?h(6913,"You can restore these files using the Undo command."):h(6914,"You can restore this file using the Undo command.");if(a||r&&i.getValue(GZ)===!1)g={confirmed:!0};else if(r){let{message:v,detail:_}=HOe(l);_+=_?`
`:"",bn?_+=l.length>1?h(6915,"You can restore these files from the Recycle Bin."):h(6916,"You can restore this file from the Recycle Bin."):_+=l.length>1?h(6917,"You can restore these files from the Trash."):h(6918,"You can restore this file from the Trash."),g=await t.confirm({message:v,detail:_,primaryButton:d,checkbox:{label:h(6919,"Do not ask me again")}})}else{let{message:v,detail:_}=UOe(l);_+=_?`
`:"",_+=m,g=await t.confirm({type:"warning",message:v,detail:_,primaryButton:d})}if(g.confirmed&&g.checkboxChecked===!0&&await i.updateValue(GZ,!1),!!g.confirmed)try{const v=l.map(w=>new sc(w.resource,void 0,{recursive:!0,folder:w.isDirectory,ignoreIfNotExists:c,skipTrashBin:!r,maxSize:VOe})),_={undoLabel:l.length>1?h(6920,"Delete {0} files",l.length):h(6921,"Delete {0}",l[0].name),progressLabel:l.length>1?h(6922,"Deleting {0} files",l.length):h(6923,"Deleting {0}",l[0].name)};await s.applyBulkEdit(v,_)}catch(v){let _,w,C;if(r?(_=bn?h(6924,"Failed to delete using the Recycle Bin. Do you want to permanently delete instead?"):h(6925,"Failed to delete using the Trash. Do you want to permanently delete instead?"),w=m,C=h(6926,"&&Delete Permanently")):(_=bo(v,!1),C=h(6927,"&&Retry")),(await t.confirm({type:"warning",message:_,detail:w,primaryButton:C})).confirmed)return r&&(r=!1),a=!0,c=!0,W4(s,e,t,i,n,o,r,a,c)}}function HOe(s){return Che(s)?{message:h(6928,"Are you sure you want to delete the following {0} files/directories and their contents?",s.length),detail:Lu(s.map(e=>e.resource))}:s.length>1?s[0].isDirectory?{message:h(6929,"Are you sure you want to delete the following {0} directories and their contents?",s.length),detail:Lu(s.map(e=>e.resource))}:{message:h(6930,"Are you sure you want to delete the following {0} files?",s.length),detail:Lu(s.map(e=>e.resource))}:s[0].isDirectory&&!s[0].isSymbolicLink?{message:h(6931,"Are you sure you want to delete '{0}' and its contents?",s[0].name),detail:""}:{message:h(6932,"Are you sure you want to delete '{0}'?",s[0].name),detail:""}}function UOe(s){return Che(s)?{message:h(6933,"Are you sure you want to permanently delete the following {0} files/directories and their contents?",s.length),detail:Lu(s.map(e=>e.resource))}:s.length>1?s[0].isDirectory?{message:h(6934,"Are you sure you want to permanently delete the following {0} directories and their contents?",s.length),detail:Lu(s.map(e=>e.resource))}:{message:h(6935,"Are you sure you want to permanently delete the following {0} files?",s.length),detail:Lu(s.map(e=>e.resource))}:s[0].isDirectory?{message:h(6936,"Are you sure you want to permanently delete '{0}' and its contents?",s[0].name),detail:""}:{message:h(6937,"Are you sure you want to permanently delete '{0}'?",s[0].name),detail:""}}function Che(s){const e=s.find(i=>i.isDirectory),t=s.find(i=>!i.isDirectory);return!!e&&!!t}async function MU(s,e,t,i,n,o){let r=typeof n.resource=="string"?n.resource:Zd(n.resource),a=Ct(i.resource,r);if(!(o==="disabled"&&!await GOe(e,t,a))){for(;!n.allowOverwrite&&s.findClosest(a);)o!=="disabled"&&(r=$Oe(r,!!n.isDirectory,o)),a=Ct(i.resource,r);return a}}function $Oe(s,e,t){if(t==="simple"){let u=s,g="";e||(g=XM(s),u=an(s,g));const m=/^(.+ copy)( \d+)?$/;return m.test(u)?u.replace(m,(v,_,w)=>{const C=w?parseInt(w):1;return C===0?`${_}`:C<Ia.MAX_SAFE_SMALL_INTEGER?`${_} ${C+1}`:`${_}${w} copy`})+g:`${u} copy${g}`}const i="[\\.\\-_]",n=Ia.MAX_SAFE_SMALL_INTEGER,o=RegExp("(.*"+i+")(\\d+)(\\..*)$");if(!e&&s.match(o))return s.replace(o,(u,g,m,v)=>{const _=parseInt(m);return _<n?g+String(_+1).padStart(m.length,"0")+v:`${g}${m}.1${v}`});const r=RegExp("(\\d+)("+i+".*)(\\..*)$");if(!e&&s.match(r))return s.replace(r,(u,g,m,v)=>{const _=parseInt(g);return _<n?String(_+1).padStart(g.length,"0")+m+v:`${g}${m}.1${v}`});const a=RegExp("(\\d+)(\\..*)$");if(!e&&s.match(a))return s.replace(a,(u,g,m)=>{const v=parseInt(g);return v<n?String(v+1).padStart(g.length,"0")+m:`${g}.1${m}`});const c=s.lastIndexOf(".");if(!e&&c>=0)return`${s.substr(0,c)}.1${s.substr(c)}`;const d=RegExp("(\\d+)$");if(!e&&c===-1&&s.match(d))return s.replace(d,(u,g)=>{const m=parseInt(g);return m<n?String(m+1).padStart(g.length,"0"):`${g}.1`});const l=RegExp("(.*)(\\d*)$");return!e&&c===-1&&s.match(l)?s.replace(l,(u,g,m)=>{let v=parseInt(m);return isNaN(v)&&(v=0),v<n?g+String(v+1).padStart(m.length,"0"):`${g}${m}.1`}):e&&s.match(/(\d+)$/)?s.replace(/(\d+)$/,(u,...g)=>{const m=parseInt(g[0]);return m<n?String(m+1).padStart(g[0].length,"0"):`${g[0]}.1`}):e&&s.match(/^(\d+)/)?s.replace(/^(\d+)(.*)$/,(u,...g)=>{const m=parseInt(g[0]);return m<n?String(m+1).padStart(g[0].length,"0")+g[1]:`${g[0]}${g[1]}.1`}):`${s}.1`}async function GOe(s,e,t){if(!await s.exists(t))return!0;const{confirmed:n}=await e.confirm({type:Fe.Warning,message:h(6938,"A file or folder with the name '{0}' already exists in the destination folder. Do you want to replace it?",an(t.path)),primaryButton:h(6939,"&&Replace")});return n}class LP extends X{static{this.ID="workbench.files.action.compareFileWith"}static{this.LABEL=I(6940,"Compare Active File With...")}constructor(){super({id:LP.ID,title:LP.LABEL,f1:!0,category:te.File,precondition:$v,metadata:{description:I(6941,"Opens a picker to select a file to diff with the active editor.")}})}async run(e){const t=e.get(de),i=e.get(Ci),n=e.get(Wt),o=t.activeEditor,r=Di.getOriginalUri(o);if(r&&i.canHandleResource(r)){const a=await n.quickAccess.pick("",{itemActivation:Sw.SECOND});if(a?.length===1){const c=a[0].resource;R.isUri(c)&&i.canHandleResource(c)&&t.openEditor({original:{resource:r},modified:{resource:c},options:{pinned:!0}})}}}}class XO extends X{static{this.ID="workbench.action.toggleAutoSave"}constructor(){super({id:XO.ID,title:I(6942,"Toggle Auto Save"),f1:!0,category:te.File,metadata:{description:I(6943,"Toggle the ability to save files automatically after typing")}})}run(e){return e.get(Us).toggleAutoSave()}}let NU=class extends Xt{constructor(e,t,i,n,o){super(e,t),this.commandService=i,this.notificationService=n,this.workingCopyService=o,this.lastDirtyState=this.workingCopyService.hasDirty,this.enabled=this.lastDirtyState,this.registerListeners()}registerListeners(){this._register(this.workingCopyService.onDidChangeDirty(e=>this.updateEnablement(e)))}updateEnablement(e){const t=e.isDirty()||this.workingCopyService.hasDirty;this.lastDirtyState!==t&&(this.enabled=t,this.lastDirtyState=this.enabled)}async run(e){try{await this.doRun(e)}catch(t){whe(this.notificationService,t)}}};NU=f([p(2,Ge),p(3,Dt),p(4,lg)],NU);class G1 extends NU{static{this.ID="workbench.files.action.saveAllInGroup"}static{this.LABEL=h(6944,"Save All in Group")}get class(){return"explorer-action "+ke.asClassName(K.saveAll)}doRun(e){return this.commandService.executeCommand(zO,{},e)}}let jC=class extends Xt{static{this.ID="workbench.files.action.closeGroup"}static{this.LABEL=h(6945,"Close Group")}constructor(e,t,i){super(e,t,ke.asClassName(K.closeAll)),this.commandService=i}run(e){return this.commandService.executeCommand(lhe,{},e)}};jC=f([p(2,Ge)],jC);class MP extends X{static{this.ID="workbench.files.action.focusFilesExplorer"}static{this.LABEL=I(6946,"Focus on Files Explorer")}constructor(){super({id:MP.ID,title:MP.LABEL,f1:!0,category:te.File,metadata:{description:I(6947,"Moves focus to the file explorer view container.")}})}async run(e){await e.get(da).openPaneComposite(vI,We.Sidebar,!0)}}class NP extends X{static{this.ID="workbench.files.action.showActiveFileInExplorer"}static{this.LABEL=I(6948,"Reveal Active File in Explorer View")}constructor(){super({id:NP.ID,title:NP.LABEL,f1:!0,category:te.File,metadata:{description:I(6949,"Reveals and selects the active file within the explorer view.")}})}async run(e){const t=e.get(Ge),i=e.get(de),n=Di.getOriginalUri(i.activeEditor,{supportSideBySide:qt.PRIMARY});n&&t.executeCommand(I4,n)}}class OP extends X{static{this.ID="workbench.action.files.showOpenedFileInNewWindow"}static{this.LABEL=I(6950,"Open Active File in New Empty Workspace")}constructor(){super({id:OP.ID,title:OP.LABEL,f1:!0,category:te.File,precondition:yN,metadata:{description:I(6951,"Opens the active file in a new window with no folders open.")}})}async run(e){const t=e.get(de),i=e.get(Hn),n=e.get(ei),o=e.get(je),r=Di.getOriginalUri(t.activeEditor,{supportSideBySide:qt.PRIMARY});r&&(o.hasProvider(r)?i.openWindow([{fileUri:r}],{forceNewWindow:!0}):n.error(h(6952,"The active editor must contain an openable resource.")))}}function Ehe(s,e,t,i){if(t=qOe(t),!t||t.length===0||/^\s+$/.test(t))return{content:h(6953,"A file or folder name must be provided."),severity:Fe.Error};if(t[0]==="/"||t[0]==="\\")return{content:h(6954,"A file or folder name cannot start with a slash."),severity:Fe.Error};const n=$t(t.split(/[\\/]/)),o=e.parent;if(t!==e.name){const r=o?.getChild(t);if(r&&r!==e)return{content:h(6955,"A file or folder **{0}** already exists at this location. Please choose a different name.",t),severity:Fe.Error}}if(n.some(r=>!s.hasValidBasename(e.resource,i,r))){const r=t.replace(/\*/g,"\\*");return{content:h(6956,"The name **{0}** is not valid as a file or folder name. Please choose a different name.",zOe(r)),severity:Fe.Error}}return n.some(r=>/^\s|\s$/.test(r))?{content:h(6957,"Leading or trailing whitespace detected in file or folder name."),severity:Fe.Warning}:null}function zOe(s){return s?.length>255?`${s.substr(0,255)}...`:s}function qOe(s){return s&&(s=Uz(s,"	"),s=jm(s,"/"),s=jm(s,"\\"),s)}class FP extends X{static{this.ID="workbench.files.action.compareNewUntitledTextFiles"}static{this.LABEL=I(6958,"Compare New Untitled Text Files")}constructor(){super({id:FP.ID,title:FP.LABEL,f1:!0,category:te.File,metadata:{description:I(6959,"Opens a new diff editor with two untitled files.")}})}async run(e){await e.get(de).openEditor({original:{resource:void 0},modified:{resource:void 0},options:{pinned:!0}})}}class YC extends X{static{this.ID="workbench.files.action.compareWithClipboard"}static{this.LABEL=I(6960,"Compare Active File with Clipboard")}static{this.SCHEME_COUNTER=0}constructor(){super({id:YC.ID,title:YC.LABEL,f1:!0,category:te.File,keybinding:{primary:lt(E.CtrlCmd|S.KeyK,S.KeyC),weight:W.WorkbenchContrib},metadata:{description:I(6961,"Opens a new diff editor to compare the active file with the contents of the clipboard.")}})}async run(e){const t=e.get(de),i=e.get(Z),n=e.get(Ci),o=e.get(je),r=Di.getOriginalUri(t.activeEditor,{supportSideBySide:qt.PRIMARY}),a=`clipboardCompare${YC.SCHEME_COUNTER++}`;if(r&&(o.hasProvider(r)||r.scheme===ae.untitled)){if(!this.registrationDisposal){const l=i.createInstance(OU);this.registrationDisposal=n.registerTextModelContentProvider(a,l)}const c=Qe(r),d=h(6962,"Clipboard  {0}",c);await t.openEditor({original:{resource:r.with({scheme:a})},modified:{resource:r},label:d,options:{pinned:!0}}).finally(()=>{Xe(this.registrationDisposal),this.registrationDisposal=void 0})}}dispose(){Xe(this.registrationDisposal),this.registrationDisposal=void 0}}let OU=class{constructor(e,t,i){this.clipboardService=e,this.languageService=t,this.modelService=i}async provideTextContent(e){const t=await this.clipboardService.readText();return this.modelService.createModel(t,this.languageService.createByFilepathOrFirstLine(e),e)}};OU=f([p(0,Vs),p(1,vi),p(2,ci)],OU);function KOe(s,e,t){s.prompt(Fe.Error,bo(e,!1),[{label:h(6963,"Retry"),run:()=>t()}])}async function xhe(s,e){const t=s.get(Zi),i=s.get(je),n=s.get(ne),o=s.get(Us),r=s.get(de),a=s.get(io),c=s.get(Dt),d=s.get(Lh),l=s.get(Ge),u=s.get(_c),g=!a.isViewVisible(ld),m=await a.openView(ld,!0);if(g&&await Da(500),!m){if(e)throw new Error("Open a folder or workspace first.");return l.executeCommand(aS)}const v=t.getContext(!1),_=v.length>0?v[0]:void 0;let w;if(_?w=_.isDirectory?_:_.parent||t.roots[0]:w=t.roots[0],w.isReadonly)throw new Error("Parent folder is readonly.");const C=new YO(i,n,o,w,e);w.addChild(C);const k=async A=>{try{const B=Ct(w.resource,A);A.endsWith("/")&&(e=!0),await t.applyBulkEdit([new sc(void 0,B,{folder:e})],{undoLabel:h(6964,"Create {0}",A),progressLabel:h(6965,"Creating {0}",A),confirmBeforeUndo:!0}),await She(A,t),e?await t.select(B,!0):await r.openEditor({resource:B,options:{pinned:!0}})}catch(B){KOe(c,B,()=>k(A))}},D=(await d.getEnvironment())?.os??$u;await t.setEditable(C,{validationMessage:A=>Ehe(u,C,A,D),onFinish:async(A,B)=>{w.removeChild(C),await t.setEditable(C,null),B&&k(A)}})}Ee.registerCommand({id:gD,handler:async s=>{await xhe(s,!1)}});Ee.registerCommand({id:QO,handler:async s=>{await xhe(s,!0)}});const jOe=async s=>{const e=s.get(Zi),t=s.get(Dt),i=s.get(Lh),n=s.get(_c),o=s.get(ne),r=e.getContext(!1),a=r.length>0?r[0]:void 0;if(!a)return;const c=(await i.getEnvironment())?.os??$u;await e.setEditable(a,{validationMessage:d=>Ehe(n,a,d,c),onFinish:async(d,l)=>{if(l){const u=a.parent.resource,g=Ct(u,d);if(a.resource.toString()!==g.toString())try{await e.applyBulkEdit([new sc(a.resource,g)],{confirmBeforeUndo:o.getValue().explorer.confirmUndo===Iu.Verbose,undoLabel:h(6966,"Rename {0} to {1}",a.name,d),progressLabel:h(6967,"Renaming {0} to {1}",a.name,d)}),await She(d,e)}catch(m){t.error(m)}}await e.setEditable(a,null)}})},YOe=async s=>{const t=s.get(Zi).getContext(!0).filter(i=>!i.isRoot);t.length&&await W4(s.get(Zi),s.get(dg),s.get(ei),s.get(ne),s.get(Us),t,!0)},Ihe=async s=>{const t=s.get(Zi).getContext(!0).filter(i=>!i.isRoot);t.length&&await W4(s.get(Zi),s.get(dg),s.get(ei),s.get(ne),s.get(Us),t,!1)};let nm=!1;const QOe=async s=>{const e=s.get(Zi),t=e.getContext(!0);t.length>0&&(await e.setToCopy(t,!1),nm=!1)},XOe=async s=>{const e=s.get(Zi),t=e.getContext(!0);t.length>0&&(await e.setToCopy(t,!0),nm=!0)},ZOe=async s=>{const e=s.get(Zi),t=s.get(Dt),i=s.get(Z),n=e.getContext(!0),o=n.length?n:e.roots,r=i.createInstance(LU);try{await r.download(o)}catch(a){throw t.error(a),a}};Ee.registerCommand({id:bhe,handler:ZOe});const JOe=async s=>{const e=s.get(Zi),t=s.get(Dt),i=s.get(Z),n=e.getContext(!1),o=n.length?n[0]:e.roots[0];try{const r=await p_e();r&&await i.createInstance(PP).upload(o,r)}catch(r){throw t.error(r),r}};Ee.registerCommand({id:yhe,handler:JOe});const e0e=async(s,e)=>{const t=s.get(Vs),i=s.get(Zi),n=s.get(je),o=s.get(Dt),r=s.get(de),a=s.get(ne),c=s.get(nn),d=s.get(ei);s.get(Hn);const l=i.getContext(!1),g=e&&e.length>0&&a.getValue("explorer.confirmPasteNative"),m=await t0e(e,t);if(g&&m.files.length>=1){const k=m.files.length>1?h(6968,"Are you sure you want to paste the following {0} items?",m.files.length):h(6969,"Are you sure you want to paste '{0}'?",an(m.type==="paths"?m.files[0].fsPath:m.files[0].name)),D=m.files.length>1?Lu(m.files.map(B=>{if(R.isUri(B))return B.fsPath;if(m.type==="paths"){const q=uv(B);if(q)return q}return B.name})):void 0,A=await d.confirm({message:k,detail:D,checkbox:{label:h(6919,"Do not ask me again")},primaryButton:h(6970,"&&Paste")});if(!A.confirmed)return;A.checkboxChecked===!0&&await a.updateValue("explorer.confirmPasteNative",!1)}const v=l.length?l[0]:i.roots[0],_=a.getValue().explorer.incrementalNaming;if(i.getEditable())return;try{let k=[];if(m.type==="paths"){const D=$t(await Promise.all(m.files.map(async A=>{if(v.resource.toString()!==A.toString()&&od(v.resource,A))throw new Error(h(6971,"File to paste is an ancestor of the destination folder"));const B=await n.stat(A);let q;c.extUri.isEqual(v.resource,A)?q=v.parent:q=v.isDirectory?v:v.parent;const Q=await MU(i,n,d,q,{resource:A,isDirectory:B.isDirectory,allowOverwrite:nm||_==="disabled"},_);if(Q)return{source:A,target:Q}})));if(D.length>=1)if(nm){const A=D.map(q=>new sc(q.source,q.target,{overwrite:_==="disabled"})),B={confirmBeforeUndo:a.getValue().explorer.confirmUndo===Iu.Verbose,progressLabel:D.length>1?h(6972,"Moving {0} files",D.length):h(6973,"Moving {0}",Zd(D[0].target)),undoLabel:D.length>1?h(6974,"Move {0} files",D.length):h(6975,"Move {0}",Zd(D[0].target))};await i.applyBulkEdit(A,B)}else{const A=D.map(B=>new sc(B.source,B.target,{copy:!0,overwrite:_==="disabled"}));await C(D.map(B=>B.target),A)}k=D.map(A=>A.target)}else{const D=$t(await Promise.all(m.files.map(async A=>{const B=v.isDirectory?v:v.parent,q=await MU(i,n,d,B,{resource:A.name,isDirectory:!1,allowOverwrite:nm||_==="disabled"},_);if(q)return{target:q,edit:new sc(void 0,q,{overwrite:_==="disabled",contents:(async()=>Le.wrap(new Uint8Array(await A.arrayBuffer())))()})}})));await C(D.map(A=>A.target),D.map(A=>A.edit)),k=D.map(A=>A.target)}if(k.length){const D=k[0];if(await i.select(D),k.length===1){const A=i.findClosest(D);A&&!A.isDirectory&&await r.openEditor({resource:A.resource,options:{pinned:!0,preserveFocus:!0}})}}}catch(k){whe(o,new Error(h(6976,"The file(s) to paste have been deleted or moved since you copied them. {0}",ya(k))))}finally{nm&&(await i.setToCopy([],!1),nm=!1)}async function C(k,D){const A=a.getValue().explorer.confirmUndo,B={confirmBeforeUndo:A===Iu.Default||A===Iu.Verbose,progressLabel:k.length>1?h(6977,"Copying {0} files",k.length):h(6978,"Copying {0}",Zd(k[0])),undoLabel:k.length>1?h(6979,"Paste {0} files",k.length):h(6980,"Paste {0}",Zd(k[0]))};await i.applyBulkEdit(D,B)}};async function t0e(s,e,t){if(s&&s.length>0){const i=[...s].map(n=>uv(n)).filter(n=>!!n&&cy(n)).map(n=>R.file(n));return i.length?{type:"paths",files:i}:{type:"data",files:[...s].filter(n=>!uv(n))}}else return{type:"paths",files:$z(await e.readResources(),i=>i)}}const i0e=async s=>{const e=s.get(de),i=s.get(Zi).getContext(!0);await e.openEditors(i.filter(n=>!n.isDirectory).map(n=>({resource:n.resource,options:{preserveFocus:!0}})))};class ZO extends X{constructor(e,t,i){super({id:e,title:t,f1:!0,category:te.File,precondition:loe}),this.newReadonlyState=i}async run(e){const t=e.get(de),i=e.get(Us),n=Di.getOriginalUri(t.activeEditor,{supportSideBySide:qt.PRIMARY});n&&await i.updateReadonly(n,this.newReadonlyState)}}class WP extends ZO{static{this.ID="workbench.action.files.setActiveEditorReadonlyInSession"}static{this.LABEL=I(6981,"Set Active Editor Read-only in Session")}constructor(){super(WP.ID,WP.LABEL,!0)}}class BP extends ZO{static{this.ID="workbench.action.files.setActiveEditorWriteableInSession"}static{this.LABEL=I(6982,"Set Active Editor Writeable in Session")}constructor(){super(BP.ID,BP.LABEL,!1)}}class VP extends ZO{static{this.ID="workbench.action.files.toggleActiveEditorReadonlyInSession"}static{this.LABEL=I(6983,"Toggle Active Editor Read-only in Session")}constructor(){super(VP.ID,VP.LABEL,"toggle")}}class HP extends ZO{static{this.ID="workbench.action.files.resetActiveEditorReadonlyInSession"}static{this.LABEL=I(6984,"Reset Active Editor Read-only in Session")}constructor(){super(HP.ID,HP.LABEL,"reset")}}let FU=class extends Gv{constructor(e,t,i){super(),this.resource=e,this.name=t,this.fileService=i,this.mime=Si.binary}getName(){return this.name}getSize(){return this.size}getMime(){return this.mime}getETag(){return this.etag}async resolve(){if(this.fileService.hasProvider(this.resource)){const e=await this.fileService.stat(this.resource);this.etag=e.etag,typeof e.size=="number"&&(this.size=e.size)}return super.resolve()}};FU=f([p(2,je)],FU);var WU,Zg;(function(s){s[s.None=0]="None",s[s.Text=1]="Text",s[s.Binary=2]="Binary"})(Zg||(Zg={}));let BU=WU=class extends Qd{get typeId(){return iCe}get editorId(){return id.id}get capabilities(){let e=Je.CanSplitInGroup;return this.model?this.model.isReadonly()&&(e|=Je.Readonly):this.fileService.hasProvider(this.resource)?this.filesConfigurationService.isReadonly(this.resource)&&(e|=Je.Readonly):e|=Je.Untitled,e&Je.Readonly||(e|=Je.CanDropIntoEditor),e}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C){super(e,t,v,d,u,g,m,w,C),this.instantiationService=c,this.textModelService=l,this.pathService=_,this.forceOpenAs=Zg.None,this.model=void 0,this.cachedTextFileModelReference=void 0,this.modelListeners=this._register(new U),this.model=this.textFileService.files.get(e),i&&this.setPreferredName(i),n&&this.setPreferredDescription(n),o&&this.setPreferredEncoding(o),r&&this.setPreferredLanguageId(r),typeof a=="string"&&this.setPreferredContents(a),this._register(this.textFileService.files.onDidCreate(k=>this.onDidCreateTextFileModel(k))),this.model&&this.registerModelListeners(this.model)}onDidCreateTextFileModel(e){At(e.resource,this.resource)&&(this.model=e,this.registerModelListeners(e))}registerModelListeners(e){this.modelListeners.clear(),this.modelListeners.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this.modelListeners.add(e.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire())),this.modelListeners.add(e.onDidSaveError(()=>this._onDidChangeDirty.fire())),this.modelListeners.add(T.once(e.onWillDispose)(()=>{this.modelListeners.clear(),this.model=void 0}))}getName(){return this.preferredName||super.getName()}setPreferredName(e){this.allowLabelOverride()&&this.preferredName!==e&&(this.preferredName=e,this._onDidChangeLabel.fire())}allowLabelOverride(){return this.resource.scheme!==this.pathService.defaultUriScheme&&this.resource.scheme!==ae.vscodeUserData&&this.resource.scheme!==ae.file&&this.resource.scheme!==ae.vscodeRemote}getPreferredName(){return this.preferredName}isReadonly(){return this.model?this.model.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}getDescription(e){return this.preferredDescription||super.getDescription(e)}setPreferredDescription(e){this.allowLabelOverride()&&this.preferredDescription!==e&&(this.preferredDescription=e,this._onDidChangeLabel.fire())}getPreferredDescription(){return this.preferredDescription}getTitle(e){let t=super.getTitle(e);const i=this.getPreferredTitle();return i&&(t=`${i} (${t})`),t}getPreferredTitle(){if(this.preferredName&&this.preferredDescription)return`${this.preferredName} ${this.preferredDescription}`;if(this.preferredName||this.preferredDescription)return this.preferredName??this.preferredDescription}getEncoding(){return this.model?this.model.getEncoding():this.preferredEncoding}getPreferredEncoding(){return this.preferredEncoding}async setEncoding(e,t){return this.setPreferredEncoding(e),this.model?.setEncoding(e,t)}setPreferredEncoding(e){this.preferredEncoding=e,this.setForceOpenAsText()}getLanguageId(){return this.model?this.model.getLanguageId():this.preferredLanguageId}getPreferredLanguageId(){return this.preferredLanguageId}setLanguageId(e,t){this.setPreferredLanguageId(e),this.model?.setLanguageId(e,t)}setPreferredLanguageId(e){this.preferredLanguageId=e,this.setForceOpenAsText()}setPreferredContents(e){this.preferredContents=e,this.setForceOpenAsText()}setForceOpenAsText(){this.forceOpenAs=Zg.Text}setForceOpenAsBinary(){this.forceOpenAs=Zg.Binary}isDirty(){return!!this.model?.isDirty()}isSaving(){return this.model?.hasState(Fk.SAVED)||this.model?.hasState(Fk.CONFLICT)||this.model?.hasState(Fk.ERROR)?!1:this.filesConfigurationService.hasShortAutoSaveDelay(this)?!0:super.isSaving()}prefersEditorPane(e){return this.forceOpenAs===Zg.Binary?e.find(t=>t.typeId===nCe):e.find(t=>t.typeId===roe)}resolve(e){return this.forceOpenAs===Zg.Binary?this.doResolveAsBinary():this.doResolveAsText(e)}async doResolveAsText(e){try{const t=this.preferredContents;this.preferredContents=void 0,await this.textFileService.files.resolve(this.resource,{languageId:this.preferredLanguageId,encoding:this.preferredEncoding,contents:typeof t=="string"?Ane(t):void 0,reload:{async:!0},allowBinary:this.forceOpenAs===Zg.Text,reason:hoe.EDITOR,limits:this.ensureLimits(e)}),this.cachedTextFileModelReference||(this.cachedTextFileModelReference=await this.textModelService.createModelReference(this.resource));const i=this.cachedTextFileModelReference.object;return this.isDisposed()&&this.disposeModelReference(),i}catch(t){if(t.textFileOperationResult===coe.FILE_IS_BINARY)return this.doResolveAsBinary();throw t}}async doResolveAsBinary(){const e=this.instantiationService.createInstance(FU,this.preferredResource,this.getName());return await e.resolve(),e}isResolved(){return!!this.model}async rename(e,t){return{editor:{resource:t,encoding:this.getEncoding(),options:{viewState:Ob(this,e,this.editorService)}}}}toUntyped(e){const t={resource:this.preferredResource,forceFile:!0,options:{override:this.editorId}};return typeof e?.preserveViewState=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=(()=>{const i=this.textFileService.files.get(this.resource);if(i?.isDirty()&&!i.textEditorModel.isTooLargeForHeapOperation())return i.textEditorModel.getValue()})(),t.options={...t.options,viewState:Ob(this,e.preserveViewState,this.editorService)}),t}matches(e){return this===e?!0:e instanceof WU?At(e.resource,this.resource):Ql(e)?super.matches(e):!1}dispose(){this.model=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){Xe(this.cachedTextFileModelReference),this.cachedTextFileModelReference=void 0}};BU=WU=f([p(7,Z),p(8,Ps),p(9,Ci),p(10,ui),p(11,je),p(12,Us),p(13,de),p(14,_c),p(15,ir),p(16,pg)],BU);const Dhe="saveConflictResolutionContext",VU="conflictResolution",B4="learnMoreDirtyWriteError",khe=h(6821,"Use the actions in the editor tool bar to either undo your changes or overwrite the content of the file with your changes.");let zZ=class extends F{static{this.ID="workbench.contrib.textFileSaveErrorHandler"}constructor(e,t,i,n,o,r,a){super(),this.notificationService=e,this.textFileService=t,this.editorService=n,this.instantiationService=r,this.storageService=a,this.messages=new In,this.activeConflictResolutionResource=void 0,this.conflictResolutionContext=new O(Dhe,!1,!0).bindTo(i);const c=this._register(r.createInstance(gA));this._register(o.registerTextModelContentProvider(VU,c)),this.textFileService.files.saveErrorHandler=this,this.registerListeners()}registerListeners(){this._register(this.textFileService.files.onDidSave(e=>this.onFileSavedOrReverted(e.model.resource))),this._register(this.textFileService.files.onDidRevert(e=>this.onFileSavedOrReverted(e.resource))),this._register(this.editorService.onDidActiveEditorChange(()=>this.onActiveEditorChanged()))}onActiveEditorChanged(){let e=!1,t;const i=this.editorService.activeEditor;i instanceof go&&i.original.resource?.scheme===VU&&(e=!0,t=i.modified.resource),this.conflictResolutionContext.set(e),this.activeConflictResolutionResource=t}onFileSavedOrReverted(e){const t=this.messages.get(e);t&&(t.close(),this.messages.delete(e))}onSaveError(e,t,i){const n=e,o=t.resource;let r;const a=[],c=[];if(n.fileOperationResult===Kn.FILE_MODIFIED_SINCE)if(this.activeConflictResolutionResource&&At(this.activeConflictResolutionResource,t.resource)){if(this.storageService.getBoolean(B4,he.APPLICATION))return;r=khe,a.push(this.instantiationService.createInstance(UP)),c.push(this.instantiationService.createInstance(UU))}else r=h(6822,"Failed to save '{0}': The content of the file is newer. Please compare your version with the file contents or overwrite the content of the file with your changes.",Qe(o)),a.push(this.instantiationService.createInstance($U,t)),a.push(this.instantiationService.createInstance(c0e,t,i)),c.push(this.instantiationService.createInstance(zU));else{const u=n.fileOperationResult===Kn.FILE_WRITE_LOCKED,g=u&&n.options?.unlock,m=n.fileOperationResult===Kn.FILE_PERMISSION_DENIED,v=o.scheme===ae.file;v&&(m||g)?a.push(this.instantiationService.createInstance(s0e,t,i,!!g)):u?a.push(this.instantiationService.createInstance(a0e,t,i)):a.push(this.instantiationService.createInstance(o0e,t,i)),a.push(this.instantiationService.createInstance(GU,t)),a.push(this.instantiationService.createInstance(r0e,t)),u?g&&v?r=bn?h(6823,"Failed to save '{0}': File is read-only. Select 'Overwrite as Admin' to retry as administrator.",Qe(o)):h(6824,"Failed to save '{0}': File is read-only. Select 'Overwrite as Sudo' to retry as superuser.",Qe(o)):r=h(6825,"Failed to save '{0}': File is read-only. Select 'Overwrite' to attempt to make it writeable.",Qe(o)):v&&m?r=bn?h(6826,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Admin' to retry as administrator.",Qe(o)):h(6827,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Sudo' to retry as superuser.",Qe(o)):r=h(6828,"Failed to save '{0}': {1}",Qe(o),bo(e,!1))}const d={primary:a,secondary:c},l=this.notificationService.notify({id:`${lc(t.resource.toString())}`,severity:Fe.Error,message:r,actions:d});T.once(l.onDidClose)(()=>{Xe(a),Xe(c)}),this.messages.set(t.resource,l)}dispose(){super.dispose(),this.messages.clear()}};zZ=f([p(0,Dt),p(1,Ps),p(2,fe),p(3,de),p(4,Ci),p(5,Z),p(6,it)],zZ);const HU=[];function n0e(){for(;HU.length>0;)HU.pop()?.close()}let UP=class extends Xt{constructor(e){super("workbench.files.action.resolveConflictLearnMore",h(6829,"Learn More")),this.openerService=e}async run(){await this.openerService.open(R.parse("https://go.microsoft.com/fwlink/?linkid=868264"))}};UP=f([p(0,mi)],UP);let UU=class extends Xt{constructor(e){super("workbench.files.action.resolveConflictLearnMoreDoNotShowAgain",h(6830,"Don't Show Again")),this.storageService=e}async run(e){this.storageService.store(B4,!0,he.APPLICATION,gt.USER),e.dispose()}};UU=f([p(0,it)],UU);let $U=class extends Xt{constructor(e,t,i,n,o){super("workbench.files.action.resolveConflict",h(6831,"Compare")),this.model=e,this.editorService=t,this.notificationService=i,this.instantiationService=n,this.productService=o}async run(){if(!this.model.isDisposed()){const e=this.model.resource,t=Qe(e),i=h(6832,"{0} (in file)  {1} (in {2}) - Resolve save conflict",t,t,this.productService.nameLong);await gA.open(e,VU,i,this.editorService,{pinned:!0});const n={primary:[this.instantiationService.createInstance(UP)]},o=this.notificationService.notify({id:`${lc(e.toString())}`,severity:Fe.Info,message:khe,actions:n,neverShowAgain:{id:B4,isSecondary:!0}});T.once(o.onDidClose)(()=>Xe(n.primary)),HU.push(o)}}};$U=f([p(1,de),p(2,Dt),p(3,Z),p(4,Vn)],$U);class s0e extends Xt{constructor(e,t,i){super("workbench.files.action.saveModelElevated",i?bn?h(6833,"Overwrite as Admin..."):h(6834,"Overwrite as Sudo..."):bn?h(6835,"Retry as Admin..."):h(6836,"Retry as Sudo...")),this.model=e,this.options=t,this.triedToUnlock=i}async run(){this.model.isDisposed()||await this.model.save({...this.options,writeElevated:!0,writeUnlock:this.triedToUnlock,reason:gi.EXPLICIT})}}class o0e extends Xt{constructor(e,t){super("workbench.files.action.saveModel",h(6837,"Retry")),this.model=e,this.options=t}async run(){this.model.isDisposed()||await this.model.save({...this.options,reason:gi.EXPLICIT})}}class r0e extends Xt{constructor(e){super("workbench.files.action.revertModel",h(6838,"Revert")),this.model=e}async run(){this.model.isDisposed()||await this.model.revert()}}let GU=class extends Xt{constructor(e,t){super("workbench.files.action.saveModelAs",$le.value),this.model=e,this.editorService=t}async run(){if(!this.model.isDisposed()){const e=this.findEditor();e&&await this.editorService.save(e,{saveAs:!0,reason:gi.EXPLICIT})}}findEditor(){let e;const t=this.editorService.findEditors(this.model.resource,{supportSideBySide:qt.PRIMARY});for(const i of t)if(i.editor instanceof BU){e=i;break}else e||(e=i);return e}};GU=f([p(1,de)],GU);class a0e extends Xt{constructor(e,t){super("workbench.files.action.unlock",h(6839,"Overwrite")),this.model=e,this.options=t}async run(){this.model.isDisposed()||await this.model.save({...this.options,writeUnlock:!0,reason:gi.EXPLICIT})}}class c0e extends Xt{constructor(e,t){super("workbench.files.action.saveIgnoreModifiedSince",h(6839,"Overwrite")),this.model=e,this.options=t}async run(){this.model.isDisposed()||await this.model.save({...this.options,ignoreModifiedSince:!0,reason:gi.EXPLICIT})}}let zU=class extends Xt{constructor(e){super("workbench.files.action.configureSaveConflict",h(6840,"Configure")),this.preferencesService=e}async run(){this.preferencesService.openSettings({query:"files.saveConflictResolution"})}};zU=f([p(0,Hv)],zU);const d0e=(s,e)=>The(s,e,!0),l0e=(s,e)=>The(s,e,!1);async function The(s,e,t){const i=s.get(de),n=i.activeEditorPane;if(!n)return;const o=n.input,r=n.group;if(n0e(),t){const a={ignoreModifiedSince:!0,reason:gi.EXPLICIT};await i.save({editor:o,groupId:r.id},a)}else await i.revert({editor:o,groupId:r.id});return await i.openEditor({resource:e},r),r.closeEditor(o)}function h0e(s){const e=s.lastFocusedList,t=e?.getHTMLElement();if(t&&hf(t)){let i;if(e instanceof Rv){const n=e.getFocusedElements();n.length&&(i=n[0])}else if(e instanceof Mne){const n=e.getFocus();n.length&&(i=n[0])}return i}}function dS(s,e,t){if(R.isUri(s))return s;const i=h0e(t);return i instanceof Ts?i.resource:i instanceof Yn?i.getResource():Di.getOriginalUri(e.activeEditor,{supportSideBySide:qt.PRIMARY})}function pD(s,e,t,i,n){const o=e.lastFocusedList,r=o?.getHTMLElement();if(r&&hf(r)){if(o instanceof Mne&&o.getFocus().every(l=>l instanceof Ts)){const l=n.getContext(!0,!0);if(l.length)return l.map(u=>u.resource)}if(o instanceof Rv){const l=$t(o.getSelectedElements().filter(_=>_ instanceof Yn).map(_=>_.getResource())),u=o.getFocusedElements(),g=u.length?u[0]:void 0;let m;if(R.isUri(s))m=s.toString();else if(g instanceof Yn){const _=g.getResource();m=_?_.toString():void 0}const v=l.findIndex(_=>_.toString()===m);if(v!==-1){const _=l[v];return l.splice(v,1),l.unshift(_),l}}}const c=i.activeGroup.selectedEditors;if(c.length>1&&R.isUri(s)){const l=c.findIndex(u=>u.matches({resource:s}));if(l!==-1){const u=c[l];return c.splice(l,1),c.unshift(u),c.map(g=>Di.getOriginalUri(g)).filter(g=>!!g)}}const d=dS(s,t,e);return d?[d]:[]}function Ahe(s){const e=s.get(Ei).lastFocusedList,t=e?.getHTMLElement();if(t&&hf(t)&&e instanceof Rv){const i=$t(e.getSelectedElements().filter(a=>a instanceof Yn)),n=e.getFocusedElements(),o=n.length?n[0]:void 0;let r;return o instanceof Yn&&(r=o),i.some(a=>a===r)?i:r?[r]:void 0}}const JO="addRootFolder",Rhe=I(2816,"Add Folder to Workspace..."),Phe="setRootFolder",Lhe="_workbench.pickWorkspaceFolder";Ee.registerCommand({id:"workbench.action.files.openFileFolderInNewWindow",handler:s=>s.get(to).pickFileFolderAndOpen({forceNewWindow:!0})});Ee.registerCommand({id:"_files.pickFolderAndOpen",handler:(s,e)=>s.get(to).pickFolderAndOpen(e)});Ee.registerCommand({id:"workbench.action.files.openFolderInNewWindow",handler:s=>s.get(to).pickFolderAndOpen({forceNewWindow:!0})});Ee.registerCommand({id:"workbench.action.files.openFileInNewWindow",handler:s=>s.get(to).pickFileAndOpen({forceNewWindow:!0})});Ee.registerCommand({id:"workbench.action.openWorkspaceInNewWindow",handler:s=>s.get(to).pickWorkspaceAndOpen({forceNewWindow:!0})});Ee.registerCommand({id:JO,handler:async s=>{const e=s.get(uc),t=await Mhe(s);!t||!t.length||await e.addFolders(t.map(i=>({uri:i})))}});Ee.registerCommand({id:Phe,handler:async s=>{const e=s.get(uc),t=s.get(It),i=await Mhe(s);!i||!i.length||await e.updateFolders(0,t.getWorkspace().folders.length,i.map(n=>({uri:n})))}});async function Mhe(s){const e=s.get(to),t=s.get(_c);return await e.showOpenDialog({openLabel:f_e(h(2817,"&&Add")),title:h(2818,"Add Folder to Workspace"),canSelectFolders:!0,canSelectMany:!0,defaultUri:await e.defaultFolderPath(),availableFileSystems:[t.defaultUriScheme]})}Ee.registerCommand(Lhe,async function(s,e){const t=s.get(Wt),i=s.get(ui),n=s.get(It),o=s.get(ci),r=s.get(vi),a=n.getWorkspace().folders;if(!a.length)return;const c=a.map(g=>{const m=g.name,v=i.getUriLabel(_s(g.uri),{relative:!0});return{label:m,description:v!==m?v:void 0,folder:g,iconClasses:ch(o,r,g.uri,Pi.ROOT_FOLDER)}}),d=(e?e[0]:void 0)||Object.create(null);d.activeItem||(d.activeItem=c[0]),d.placeHolder||(d.placeHolder=h(2819,"Select workspace folder")),typeof d.matchOnDescription!="boolean"&&(d.matchOnDescription=!0);const l=(e?e[1]:void 0)||Ce.None,u=await t.pick(c,d,l);if(u)return a[c.indexOf(u)]});Ee.registerCommand({id:"vscode.openFolder",handler:(s,e,t)=>{const i=s.get(Ge);if(typeof t=="boolean"&&(t={forceNewWindow:t}),!e){const a={forceNewWindow:t?.forceNewWindow};return t?.forceLocalWindow&&(a.remoteAuthority=null,a.availableFileSystems=["file"]),i.executeCommand("_files.pickFolderAndOpen",a)}const n=R.from(e,!0),o={forceNewWindow:t?.forceNewWindow,forceReuseWindow:t?.forceReuseWindow,noRecentEntry:t?.noRecentEntry,remoteAuthority:t?.forceLocalWindow?null:void 0,forceProfile:t?.forceProfile,forceTempProfile:t?.forceTempProfile},r=Gz(n)||n.scheme===ae.untitled?{workspaceUri:n}:{folderUri:n};return i.executeCommand("_files.windowOpen",[r],o)},metadata:{description:"Open a folder or workspace in the current window or new window depending on the newWindow argument. Note that opening in the same window will shutdown the current extension host process and start a new one on the given folder/workspace unless the newWindow parameter is set to true.",args:[{name:"uri",description:"(optional) Uri of the folder or workspace file to open. If not provided, a native dialog will ask the user for the folder",constraint:s=>s==null||s instanceof R},{name:"options",description:"(optional) Options. Object with the following properties: `forceNewWindow`: Whether to open the folder/workspace in a new window or the same. Defaults to opening in the same window. `forceReuseWindow`: Whether to force opening the folder/workspace in the same window.  Defaults to false. `noRecentEntry`: Whether the opened URI will appear in the 'Open Recent' list. Defaults to false. Note, for backward compatibility, options can also be of type boolean, representing the `forceNewWindow` setting.",constraint:s=>s===void 0||typeof s=="object"||typeof s=="boolean"}]}});Ee.registerCommand({id:"vscode.newWindow",handler:(s,e)=>{const t=s.get(Ge),i={forceReuseWindow:e&&e.reuseWindow,remoteAuthority:e&&e.remoteAuthority};return t.executeCommand("_files.newWindow",i)},metadata:{description:"Opens an new window depending on the newWindow argument.",args:[{name:"options",description:"(optional) Options. Object with the following properties: `reuseWindow`: Whether to open a new window or the same. Defaults to opening in a new window. ",constraint:s=>s===void 0||typeof s=="object"}]}});Ee.registerCommand("_workbench.removeFromRecentlyOpened",function(s,e){return s.get(Nh).removeRecentlyOpened([e])});Ee.registerCommand({id:"vscode.removeFromRecentlyOpened",handler:(s,e)=>{const t=s.get(Nh);return typeof e=="string"?e=e.match(/^[^:/?#]+:\/\//)?R.parse(e):R.file(e):e=R.revive(e),t.removeRecentlyOpened([e])},metadata:{description:"Removes an entry with the given path from the recently opened list.",args:[{name:"path",description:"URI or URI string to remove from recently opened.",constraint:s=>typeof s=="string"||s instanceof R}]}});Ee.registerCommand("_workbench.addToRecentlyOpened",async function(s,e){const t=s.get(Nh),i=e.uri,n=e.label,o=e.remoteAuthority;let r;return e.type==="workspace"?r={workspace:await t.getWorkspaceIdentifier(i),label:n,remoteAuthority:o}:e.type==="folder"?r={folderUri:i,label:n,remoteAuthority:o}:r={fileUri:i,label:n,remoteAuthority:o},t.addRecentlyOpened([r])});Ee.registerCommand("_workbench.getRecentlyOpened",async function(s){return s.get(Nh).getRecentlyOpened()});const lS=I(2797,"Workspaces");class e0 extends X{static{this.ID="workbench.action.files.openFile"}constructor(){super({id:e0.ID,title:I(2798,"Open File..."),category:te.File,f1:!0,keybinding:{when:Ku.toNegated(),weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyO}})}async run(e,t){return e.get(to).pickFileAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}class t0 extends X{static{this.ID="workbench.action.files.openFolder"}constructor(){super({id:t0.ID,title:I(2799,"Open Folder..."),category:te.File,f1:!0,precondition:xw,keybinding:{weight:W.WorkbenchContrib,primary:void 0,linux:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyO)},win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyO)}}})}async run(e,t){return e.get(to).pickFolderAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}class i0 extends X{static{this.ID="workbench.action.files.openFolderViaWorkspace"}constructor(){super({id:i0.ID,title:I(2799,"Open Folder..."),category:te.File,f1:!0,precondition:x.and(xw.toNegated(),ml.isEqualTo("workspace")),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyO}})}run(e){return e.get(Ge).executeCommand(Phe)}}class Ix extends X{static{this.ID="workbench.action.files.openFileFolder"}static{this.LABEL=I(2800,"Open...")}constructor(){super({id:Ix.ID,title:Ix.LABEL,category:te.File,f1:!0,precondition:x.and(Ku,xw),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyO}})}async run(e,t){return e.get(to).pickFileFolderAndOpen({forceNewWindow:!1,telemetryExtraData:t})}}class n0 extends X{static{this.ID="workbench.action.openWorkspace"}constructor(){super({id:n0.ID,title:I(2801,"Open Workspace from File..."),category:te.File,f1:!0,precondition:vl})}async run(e,t){return e.get(to).pickWorkspaceAndOpen({telemetryExtraData:t})}}class fD extends X{static{this.ID="workbench.action.closeFolder"}constructor(){super({id:fD.ID,title:I(2802,"Close Workspace"),category:lS,f1:!0,precondition:x.and(ml.notEqualsTo("empty"),yN),keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyF)}})}async run(e){const t=e.get(Hn),i=e.get(wn);return t.openWindow({forceReuseWindow:!0,remoteAuthority:i.remoteAuthority})}}class V4 extends X{static{this.ID="workbench.action.openWorkspaceConfigFile"}constructor(){super({id:V4.ID,title:I(2803,"Open Workspace Configuration File"),category:lS,f1:!0,precondition:ml.isEqualTo("workspace")})}async run(e){const t=e.get(It),i=e.get(de),n=t.getWorkspace().configuration;n&&await i.openEditor({resource:n,options:{pinned:!0}})}}class H4 extends X{static{this.ID="workbench.action.addRootFolder"}constructor(){super({id:H4.ID,title:Rhe,category:lS,f1:!0,precondition:x.or(vl,ml.isEqualTo("workspace"))})}run(e){return e.get(Ge).executeCommand(JO)}}class s0 extends X{static{this.ID="workbench.action.removeRootFolder"}constructor(){super({id:s0.ID,title:I(2804,"Remove Folder from Workspace..."),category:lS,f1:!0,precondition:x.and(wN.notEqualsTo("0"),x.or(vl,ml.isEqualTo("workspace")))})}async run(e){const t=e.get(Ge),i=e.get(uc),n=await t.executeCommand(Lhe);n&&await i.removeFolders([n.uri])}}class o0 extends X{static{this.ID="workbench.action.saveWorkspaceAs"}constructor(){super({id:o0.ID,title:I(2805,"Save Workspace As..."),category:lS,f1:!0,precondition:vl})}async run(e){const t=e.get(uc),i=e.get(It),n=await t.pickNewWorkspacePath();if(n&&Gz(n))switch(i.getWorkbenchState()){case Zo.EMPTY:case Zo.FOLDER:{const o=i.getWorkspace().folders.map(r=>({uri:r.uri}));return t.createAndEnterWorkspace(o,n)}case Zo.WORKSPACE:return t.saveAndEnterWorkspace(n)}}}class r0 extends X{static{this.ID="workbench.action.duplicateWorkspaceInNewWindow"}constructor(){super({id:r0.ID,title:I(2806,"Duplicate As Workspace in New Window"),category:lS,f1:!0,precondition:vl})}async run(e){const t=e.get(It),i=e.get(uc),n=e.get(Hn),o=e.get(Nh),r=e.get(wn),a=t.getWorkspace().folders,c=r.remoteAuthority,d=await o.createUntitledWorkspace(a,c);return await i.copyWorkspaceSettings(d),n.openWindow([{workspaceUri:d.configPath}],{forceNewWindow:!0,remoteAuthority:c})}}Y(H4);Y(s0);Y(e0);Y(t0);Y(i0);Y(Ix);Y(n0);Y(V4);Y(fD);Y(o0);Y(r0);ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:e0.ID,title:h(2807,"&&Open File...")},order:1,when:Ku.toNegated()});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:t0.ID,title:h(2808,"Open &&Folder...")},order:2,when:xw});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:i0.ID,title:h(2808,"Open &&Folder...")},order:2,when:x.and(xw.toNegated(),ml.isEqualTo("workspace"))});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:Ix.ID,title:h(2809,"&&Open...")},order:1,when:x.and(Ku,xw)});ge.appendMenuItem(N.MenubarFileMenu,{group:"2_open",command:{id:n0.ID,title:h(2810,"Open Wor&&kspace from File...")},order:3,when:vl});ge.appendMenuItem(N.MenubarFileMenu,{group:"3_workspace",command:{id:JO,title:h(2811,"A&&dd Folder to Workspace...")},when:x.or(vl,ml.isEqualTo("workspace")),order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"3_workspace",command:{id:o0.ID,title:h(2812,"Save Workspace As...")},order:2,when:vl});ge.appendMenuItem(N.MenubarFileMenu,{group:"3_workspace",command:{id:r0.ID,title:h(2813,"Duplicate Workspace")},order:3,when:vl});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:fD.ID,title:h(2814,"Close &&Folder")},order:3,when:x.and(ml.isEqualTo("folder"),yN)});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:fD.ID,title:h(2815,"Close &&Workspace")},order:3,when:x.and(ml.isEqualTo("workspace"),yN)});const u0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var pc;(function(s){s[s.NONE=0]="NONE",s[s.EDITS=1]="EDITS",s[s.NAVIGATION=2]="NAVIGATION"})(pc||(pc={}));var qZ;(function(s){s[s.DEFAULT=0]="DEFAULT",s[s.EDITOR_GROUP=1]="EDITOR_GROUP",s[s.EDITOR=2]="EDITOR"})(qZ||(qZ={}));class mn extends X{constructor(e,t,i){super(e),this.commandId=t,this.commandArgs=i}run(e){return e.get(Ge).executeCommand(this.commandId,this.commandArgs)}}class Nhe extends X{getDirection(e){return zv(e)}async run(e,...t){const i=e.get(xe),n=e.get(ne),o=e.get(de),r=e.get(Ei),a=this.getDirection(n),c=Ns(t,o,i,r);fhe(i,a,c)}}class Ohe extends Nhe{static{this.ID=ghe}constructor(){super({id:Ohe.ID,title:I(3076,"Split Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Backslash},category:te.View})}}class CYe extends Nhe{constructor(){super({id:"workbench.action.splitEditorOrthogonal",title:I(3077,"Split Editor Orthogonal"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View})}getDirection(e){return zv(e)===Jt.RIGHT?Jt.DOWN:Jt.RIGHT}}class EYe extends mn{constructor(){super({id:AU,title:I(3078,"Split Editor Left"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},AU)}}class xYe extends mn{constructor(){super({id:RU,title:I(3079,"Split Editor Right"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},RU)}}class IYe extends mn{static{this.LABEL=h(3080,"Split Editor Up")}constructor(){super({id:kU,title:I(3080,"Split Editor Up"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},kU)}}class DYe extends mn{static{this.LABEL=h(3081,"Split Editor Down")}constructor(){super({id:TU,title:I(3081,"Split Editor Down"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.Backslash)},category:te.View},TU)}}class kYe extends X{constructor(){super({id:"workbench.action.joinTwoGroups",title:I(3082,"Join Editor Group with Next Group"),f1:!0,category:te.View})}async run(e,t){const i=e.get(xe);let n;if(t&&typeof t.groupId=="number"?n=i.getGroup(t.groupId):n=i.activeGroup,n){const o=[Jt.RIGHT,Jt.DOWN,Jt.LEFT,Jt.UP];for(const r of o){const a=i.findGroup({direction:r},n);if(a&&n!==a){i.mergeGroup(n,a);break}}}}}class TYe extends X{constructor(){super({id:"workbench.action.joinAllGroups",title:I(3083,"Join All Editor Groups"),f1:!0,category:te.View})}async run(e){const t=e.get(xe);t.mergeAllGroups(t.activeGroup)}}class AYe extends X{constructor(){super({id:"workbench.action.navigateEditorGroups",title:I(3084,"Navigate Between Editor Groups"),f1:!0,category:te.View})}async run(e){const t=e.get(xe);t.findGroup({location:Za.NEXT},t.activeGroup,!0)?.focus()}}class RYe extends X{constructor(){super({id:"workbench.action.focusActiveEditorGroup",title:I(3085,"Focus Active Editor Group"),f1:!0,category:te.View})}async run(e){e.get(xe).activeGroup.focus()}}class Tf extends X{constructor(e,t){super(e),this.scope=t}async run(e){const t=e.get(xe);t.findGroup(this.scope,t.activeGroup,!0)?.focus()}}class PYe extends Tf{constructor(){super({id:"workbench.action.focusFirstEditorGroup",title:I(3086,"Focus First Editor Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Digit1},category:te.View},{location:Za.FIRST})}}class LYe extends Tf{constructor(){super({id:"workbench.action.focusLastEditorGroup",title:I(3087,"Focus Last Editor Group"),f1:!0,category:te.View},{location:Za.LAST})}}class MYe extends Tf{constructor(){super({id:"workbench.action.focusNextGroup",title:I(3088,"Focus Next Editor Group"),f1:!0,category:te.View},{location:Za.NEXT})}}class NYe extends Tf{constructor(){super({id:"workbench.action.focusPreviousGroup",title:I(3089,"Focus Previous Editor Group"),f1:!0,category:te.View},{location:Za.PREVIOUS})}}class OYe extends Tf{constructor(){super({id:"workbench.action.focusLeftGroup",title:I(3090,"Focus Left Editor Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.LeftArrow)},category:te.View},{direction:Jt.LEFT})}}class FYe extends Tf{constructor(){super({id:"workbench.action.focusRightGroup",title:I(3091,"Focus Right Editor Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.RightArrow)},category:te.View},{direction:Jt.RIGHT})}}class WYe extends Tf{constructor(){super({id:"workbench.action.focusAboveGroup",title:I(3092,"Focus Editor Group Above"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.UpArrow)},category:te.View},{direction:Jt.UP})}}class BYe extends Tf{constructor(){super({id:"workbench.action.focusBelowGroup",title:I(3093,"Focus Editor Group Below"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.DownArrow)},category:te.View},{direction:Jt.DOWN})}}let QC=class extends Xt{static{this.ID="workbench.action.closeActiveEditor"}static{this.LABEL=h(3094,"Close Editor")}constructor(e,t,i){super(e,t,ke.asClassName(K.close)),this.commandService=i}run(e){return this.commandService.executeCommand(cS,void 0,e)}};QC=f([p(2,Ge)],QC);let Ip=class extends Xt{static{this.ID="workbench.action.unpinActiveEditor"}static{this.LABEL=h(3095,"Unpin Editor")}constructor(e,t,i){super(e,t,ke.asClassName(K.pinned)),this.commandService=i}run(e){return this.commandService.executeCommand(N4,void 0,e)}};Ip=f([p(2,Ge)],Ip);let XC=class extends Xt{static{this.ID="workbench.action.closeActiveEditor"}static{this.LABEL=h(3096,"Close")}constructor(e,t,i){super(e,t,ke.asClassName(K.close)),this.editorGroupService=i}async run(e){const t=e?this.editorGroupService.getGroup(e.groupId):this.editorGroupService.activeGroup;if(!t)return;const i=e?.editorIndex!==void 0?t.getEditorByIndex(e.editorIndex):t.activeEditor;if(!i)return;const n=[];t.isSelected(i)?n.push(...t.selectedEditors):n.push(i);for(const o of n)await t.closeEditor(o,{preserveFocus:e?.preserveFocus})}};XC=f([p(2,xe)],XC);class $Ye extends X{constructor(){super({id:"workbench.action.revertAndCloseActiveEditor",title:I(3097,"Revert and Close Editor"),f1:!0,category:te.View})}async run(e){const t=e.get(de),i=e.get(Re),n=t.activeEditorPane;if(n){const o=n.input,r=n.group;try{await t.revert({editor:o,groupId:r.id})}catch(a){i.error(a),await t.revert({editor:o,groupId:r.id},{soft:!0})}await r.closeEditor(o)}}}class GYe extends X{constructor(){super({id:"workbench.action.closeEditorsToTheLeft",title:I(3098,"Close Editors to the Left in Group"),f1:!0,category:te.View})}async run(e,t){const i=e.get(xe),{group:n,editor:o}=this.getTarget(i,t);n&&o&&await n.closeEditors({direction:uq.LEFT,except:o,excludeSticky:!0})}getTarget(e,t){return t?{editor:t.editor,group:e.getGroup(t.groupId)}:{group:e.activeGroup,editor:e.activeGroup.activeEditor}}}class Fhe extends X{groupsToClose(e){const t=[],i=e.getGroups(Jo.GRID_APPEARANCE);for(let n=i.length-1;n>=0;n--)t.push(i[n]);return t}async run(e){const t=e.get(de),i=e.get(Re),n=e.get(pl),o=e.get(xe),r=e.get(Us),a=e.get(to),c=new Set,d=new Set,l=new Set,u=new Map;for(const{editor:g,groupId:m}of t.getEditors(Ii.SEQUENTIAL,{excludeSticky:this.excludeSticky})){let v=!1,_=!1;if(g.closeHandler)try{v=g.closeHandler.showConfirm()}catch(w){i.error(w),_=!0}if((!g.closeHandler||_)&&(v=g.isDirty()&&!g.isSaving()),!!v)if(typeof g.closeHandler?.confirm=="function"){let w=u.get(g.typeId);w||(w=new Set,u.set(g.typeId,w)),w.add({editor:g,groupId:m})}else!g.hasCapability(Je.Untitled)&&r.getAutoSaveMode(g).mode===pA.ON_FOCUS_CHANGE?d.add({editor:g,groupId:m}):ca&&(bn||fh)&&!g.hasCapability(Je.Untitled)&&r.getAutoSaveMode(g).mode===pA.ON_WINDOW_CHANGE?l.add({editor:g,groupId:m}):c.add({editor:g,groupId:m})}if(c.size>0){const g=Array.from(c.values());switch(await this.revealEditorsToConfirm(g,o),await a.showSaveConfirm(g.map(({editor:v})=>v instanceof ks?v.primary.getName():v.getName()))){case Yi.CANCEL:return;case Yi.DONT_SAVE:await this.revertEditors(t,i,n,g);break;case Yi.SAVE:await t.save(g,{reason:gi.EXPLICIT});break}}for(const[,g]of u){const m=Array.from(g.values());await this.revealEditorsToConfirm(m,o);const v=await m.at(0)?.editor.closeHandler?.confirm?.(m);if(typeof v=="number")switch(v){case Yi.CANCEL:return;case Yi.DONT_SAVE:await this.revertEditors(t,i,n,m);break;case Yi.SAVE:await t.save(m,{reason:gi.EXPLICIT});break}}if(d.size>0){const g=Array.from(d.values());await t.save(g,{reason:gi.FOCUS_CHANGE})}if(l.size>0){const g=Array.from(l.values());await t.save(g,{reason:gi.WINDOW_CHANGE})}return this.doCloseAll(o)}revertEditors(e,t,i,n){return i.withProgress({location:Xo.Window,delay:800,title:h(3099,"Reverting Editors...")},()=>this.doRevertEditors(e,t,n))}async doRevertEditors(e,t,i){try{await e.revert(i)}catch(n){t.error(n),await e.revert(i,{soft:!0})}}async revealEditorsToConfirm(e,t){try{const i=new Set;for(const{editor:n,groupId:o}of e){if(i.has(o))continue;i.add(o),await t.getGroup(o)?.openEditor(n)}}catch{}}async doCloseAll(e){await Promise.all(this.groupsToClose(e).map(t=>t.closeAllEditors({excludeSticky:this.excludeSticky})))}}class Dx extends Fhe{static{this.ID="workbench.action.closeAllEditors"}static{this.LABEL=I(3100,"Close All Editors")}constructor(){super({id:Dx.ID,title:Dx.LABEL,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyW)},icon:K.closeAll,category:te.View})}get excludeSticky(){return!0}}class zYe extends Fhe{constructor(){super({id:"workbench.action.closeAllGroups",title:I(3101,"Close All Editor Groups"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyW)},category:te.View})}get excludeSticky(){return!1}async doCloseAll(e){await super.doCloseAll(e);for(const t of this.groupsToClose(e))e.removeGroup(t)}}class qYe extends X{constructor(){super({id:"workbench.action.closeEditorsInOtherGroups",title:I(3102,"Close Editors in Other Groups"),f1:!0,category:te.View})}async run(e,t){const i=e.get(xe),n=t?i.getGroup(t.groupId):i.activeGroup;await Promise.all(i.getGroups(Jo.MOST_RECENTLY_ACTIVE).map(async o=>{if(!(n&&o.id===n.id))return o.closeAllEditors({excludeSticky:!0})}))}}class KYe extends X{constructor(){super({id:"workbench.action.closeEditorInAllGroups",title:I(3103,"Close Editor in All Groups"),f1:!0,category:te.View})}async run(e){const t=e.get(de),i=e.get(xe),n=t.activeEditor;n&&await Promise.all(i.getGroups(Jo.MOST_RECENTLY_ACTIVE).map(o=>o.closeEditor(n)))}}class Whe extends X{constructor(e,t,i){super(e),this.direction=t,this.isMove=i}async run(e,t){const i=e.get(xe);let n;if(t&&typeof t.groupId=="number"?n=i.getGroup(t.groupId):n=i.activeGroup,n){let o;if(this.isMove){const r=this.findTargetGroup(i,n);r&&(o=i.moveGroup(n,r,this.direction))}else o=i.copyGroup(n,n,this.direction);o&&i.activateGroup(o)}}findTargetGroup(e,t){const i=[this.direction];switch(this.direction){case Jt.LEFT:case Jt.RIGHT:i.push(Jt.UP,Jt.DOWN);break;case Jt.UP:case Jt.DOWN:i.push(Jt.LEFT,Jt.RIGHT);break}for(const n of i){const o=e.findGroup({direction:n},t);if(o)return o}}}class a0 extends Whe{constructor(e,t){super(e,t,!0)}}class jYe extends a0{constructor(){super({id:"workbench.action.moveActiveEditorGroupLeft",title:I(3104,"Move Editor Group Left"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.LeftArrow)},category:te.View},Jt.LEFT)}}class YYe extends a0{constructor(){super({id:"workbench.action.moveActiveEditorGroupRight",title:I(3105,"Move Editor Group Right"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.RightArrow)},category:te.View},Jt.RIGHT)}}class QYe extends a0{constructor(){super({id:"workbench.action.moveActiveEditorGroupUp",title:I(3106,"Move Editor Group Up"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.UpArrow)},category:te.View},Jt.UP)}}class XYe extends a0{constructor(){super({id:"workbench.action.moveActiveEditorGroupDown",title:I(3107,"Move Editor Group Down"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.DownArrow)},category:te.View},Jt.DOWN)}}class c0 extends Whe{constructor(e,t){super(e,t,!1)}}class ZYe extends c0{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupLeft",title:I(3108,"Duplicate Editor Group Left"),f1:!0,category:te.View},Jt.LEFT)}}class JYe extends c0{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupRight",title:I(3109,"Duplicate Editor Group Right"),f1:!0,category:te.View},Jt.RIGHT)}}class eQe extends c0{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupUp",title:I(3110,"Duplicate Editor Group Up"),f1:!0,category:te.View},Jt.UP)}}class tQe extends c0{constructor(){super({id:"workbench.action.duplicateActiveEditorGroupDown",title:I(3111,"Duplicate Editor Group Down"),f1:!0,category:te.View},Jt.DOWN)}}class iQe extends X{constructor(){super({id:"workbench.action.minimizeOtherEditors",title:I(3112,"Expand Editor Group"),f1:!0,category:te.View,precondition:bN})}async run(e){e.get(xe).arrangeGroups(SN.EXPAND)}}class nQe extends X{constructor(){super({id:"workbench.action.minimizeOtherEditorsHideSidebar",title:I(3113,"Expand Editor Group and Hide Side Bars"),f1:!0,category:te.View,precondition:x.or(bN,Tm,pp)})}async run(e){const t=e.get(xe),i=e.get(yi);i.setPartHidden(!0,ot.SIDEBAR_PART),i.setPartHidden(!0,ot.AUXILIARYBAR_PART),t.arrangeGroups(SN.EXPAND)}}class sQe extends X{constructor(){super({id:"workbench.action.evenEditorWidths",title:I(3114,"Reset Editor Group Sizes"),f1:!0,category:te.View})}async run(e){e.get(xe).arrangeGroups(SN.EVEN)}}class oQe extends X{constructor(){super({id:"workbench.action.toggleEditorWidths",title:I(3115,"Toggle Editor Group Sizes"),f1:!0,category:te.View})}async run(e){e.get(xe).toggleExpandGroup()}}class rQe extends X{constructor(){super({id:"workbench.action.maximizeEditorHideSidebar",title:I(3116,"Maximize Editor Group and Hide Side Bars"),f1:!0,category:te.View,precondition:x.or(x.and(WS.negate(),uoe),Tm,pp)})}async run(e){const t=e.get(yi),i=e.get(xe);e.get(de).activeEditor&&(t.setPartHidden(!0,ot.SIDEBAR_PART),t.setPartHidden(!0,ot.AUXILIARYBAR_PART),i.arrangeGroups(SN.MAXIMIZE))}}class aQe extends X{constructor(){super({id:phe,title:I(3117,"Toggle Maximize Editor Group"),f1:!0,category:te.View,precondition:x.or(uoe,WS),keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyM)},menu:[{id:N.EditorTitle,order:-1e4,group:"navigation",when:WS},{id:N.EmptyEditorGroup,order:-1e4,group:"navigation",when:WS}],icon:K.screenFull,toggled:WS})}async run(e,...t){const i=e.get(xe),n=e.get(de),o=e.get(Ei),r=Ns(t,n,i,o);r.groupedEditors.length&&i.toggleMaximizeGroup(r.groupedEditors[0].group)}}class hS extends X{async run(e){const t=e.get(xe),i=this.navigate(t);if(!i)return;const{groupId:n,editor:o}=i;if(!o)return;const r=t.getGroup(n);r&&await r.openEditor(o)}}class cQe extends hS{constructor(){super({id:"workbench.action.nextEditor",title:I(3118,"Open Next Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.PageDown,mac:{primary:E.CtrlCmd|E.Alt|S.RightArrow,secondary:[E.CtrlCmd|E.Shift|S.BracketRight]}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ii.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;if(n+1<i.length)return{editor:i[n+1],groupId:t.id};const o=new Set;let r=e.activeGroup;for(;r&&!o.has(r.id);)if(r=e.findGroup({location:Za.NEXT},r,!0),r){o.add(r.id);const a=r.getEditors(Ii.SEQUENTIAL);if(a.length>0)return{editor:a[0],groupId:r.id}}}}class dQe extends hS{constructor(){super({id:"workbench.action.previousEditor",title:I(3119,"Open Previous Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.PageUp,mac:{primary:E.CtrlCmd|E.Alt|S.LeftArrow,secondary:[E.CtrlCmd|E.Shift|S.BracketLeft]}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ii.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;if(n>0)return{editor:i[n-1],groupId:t.id};const o=new Set;let r=e.activeGroup;for(;r&&!o.has(r.id);)if(r=e.findGroup({location:Za.PREVIOUS},r,!0),r){o.add(r.id);const a=r.getEditors(Ii.SEQUENTIAL);if(a.length>0)return{editor:a[a.length-1],groupId:r.id}}}}class lQe extends hS{constructor(){super({id:"workbench.action.nextEditorInGroup",title:I(3120,"Open Next Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.PageDown),mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Alt|S.RightArrow)}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ii.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;return{editor:n+1<i.length?i[n+1]:i[0],groupId:t.id}}}class hQe extends hS{constructor(){super({id:"workbench.action.previousEditorInGroup",title:I(3121,"Open Previous Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.PageUp),mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Alt|S.LeftArrow)}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ii.SEQUENTIAL),n=t.activeEditor?i.indexOf(t.activeEditor):-1;return{editor:n>0?i[n-1]:i[i.length-1],groupId:t.id}}}class uQe extends hS{constructor(){super({id:"workbench.action.firstEditorInGroup",title:I(3122,"Open First Editor in Group"),f1:!0,category:te.View})}navigate(e){const t=e.activeGroup;return{editor:t.getEditors(Ii.SEQUENTIAL)[0],groupId:t.id}}}class gQe extends hS{constructor(){super({id:"workbench.action.lastEditorInGroup",title:I(3123,"Open Last Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.Alt|S.Digit0,secondary:[E.CtrlCmd|S.Digit9],mac:{primary:E.WinCtrl|S.Digit0,secondary:[E.CtrlCmd|S.Digit9]}},category:te.View})}navigate(e){const t=e.activeGroup,i=t.getEditors(Ii.SEQUENTIAL);return{editor:i[i.length-1],groupId:t.id}}}class Bhe extends X{static{this.ID="workbench.action.navigateForward"}static{this.LABEL=h(3124,"Go Forward")}constructor(){super({id:Bhe.ID,title:{...I(3124,"Go Forward"),mnemonicTitle:h(3125,"&&Forward")},f1:!0,icon:K.arrowRight,precondition:x.has("canNavigateForward"),keybinding:{weight:W.WorkbenchContrib,win:{primary:E.Alt|S.RightArrow,secondary:[S.BrowserForward]},mac:{primary:E.WinCtrl|E.Shift|S.Minus,secondary:[S.BrowserForward]},linux:{primary:E.CtrlCmd|E.Shift|S.Minus,secondary:[S.BrowserForward]}},menu:[{id:N.MenubarGoMenu,group:"1_history_nav",order:2},{id:N.CommandCenter,order:2,when:x.has("config.workbench.navigationControl.enabled")}]})}async run(e){await e.get(So).goForward(pc.NONE)}}class Vhe extends X{static{this.ID="workbench.action.navigateBack"}static{this.LABEL=h(3126,"Go Back")}constructor(){super({id:Vhe.ID,title:{...I(3126,"Go Back"),mnemonicTitle:h(3127,"&&Back")},f1:!0,precondition:x.has("canNavigateBack"),icon:K.arrowLeft,keybinding:{weight:W.WorkbenchContrib,win:{primary:E.Alt|S.LeftArrow,secondary:[S.BrowserBack]},mac:{primary:E.WinCtrl|S.Minus,secondary:[S.BrowserBack]},linux:{primary:E.CtrlCmd|E.Alt|S.Minus,secondary:[S.BrowserBack]}},menu:[{id:N.MenubarGoMenu,group:"1_history_nav",order:1},{id:N.CommandCenter,order:1,when:x.has("config.workbench.navigationControl.enabled")}]})}async run(e){await e.get(So).goBack(pc.NONE)}}class pQe extends X{constructor(){super({id:"workbench.action.navigateLast",title:I(3128,"Go Previous"),f1:!0})}async run(e){await e.get(So).goPrevious(pc.NONE)}}class fQe extends X{constructor(){super({id:"workbench.action.navigateForwardInEditLocations",title:I(3129,"Go Forward in Edit Locations"),f1:!0})}async run(e){await e.get(So).goForward(pc.EDITS)}}class mQe extends X{constructor(){super({id:"workbench.action.navigateBackInEditLocations",title:I(3130,"Go Back in Edit Locations"),f1:!0})}async run(e){await e.get(So).goBack(pc.EDITS)}}class vQe extends X{constructor(){super({id:"workbench.action.navigatePreviousInEditLocations",title:I(3131,"Go Previous in Edit Locations"),f1:!0})}async run(e){await e.get(So).goPrevious(pc.EDITS)}}class _Qe extends X{constructor(){super({id:"workbench.action.navigateToLastEditLocation",title:I(3132,"Go to Last Edit Location"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyQ)}})}async run(e){await e.get(So).goLast(pc.EDITS)}}class bQe extends X{constructor(){super({id:"workbench.action.navigateForwardInNavigationLocations",title:I(3133,"Go Forward in Navigation Locations"),f1:!0})}async run(e){await e.get(So).goForward(pc.NAVIGATION)}}class yQe extends X{constructor(){super({id:"workbench.action.navigateBackInNavigationLocations",title:I(3134,"Go Back in Navigation Locations"),f1:!0})}async run(e){await e.get(So).goBack(pc.NAVIGATION)}}class wQe extends X{constructor(){super({id:"workbench.action.navigatePreviousInNavigationLocations",title:I(3135,"Go Previous in Navigation Locations"),f1:!0})}async run(e){await e.get(So).goPrevious(pc.NAVIGATION)}}class SQe extends X{constructor(){super({id:"workbench.action.navigateToLastNavigationLocation",title:I(3136,"Go to Last Navigation Location"),f1:!0})}async run(e){await e.get(So).goLast(pc.NAVIGATION)}}class Hhe extends X{static{this.ID="workbench.action.reopenClosedEditor"}constructor(){super({id:Hhe.ID,title:I(3137,"Reopen Closed Editor"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.KeyT},category:te.View})}async run(e){await e.get(So).reopenLastClosedEditor()}}class Uhe extends X{static{this.ID="workbench.action.clearRecentFiles"}constructor(){super({id:Uhe.ID,title:I(3138,"Clear Recently Opened..."),f1:!0,category:te.File})}async run(e){const t=e.get(ei),i=e.get(Nh),n=e.get(So),{confirmed:o}=await t.confirm({type:"warning",message:h(3139,"Do you want to clear all recently opened files and workspaces?"),detail:h(3140,"This action is irreversible!"),primaryButton:h(3141,"&&Clear")});o&&(i.clearRecentlyOpened(),n.clearRecentlyOpened())}}class $he extends X{static{this.ID="workbench.action.showEditorsInActiveGroup"}constructor(){super({id:$he.ID,title:I(3142,"Show Editors in Active Group By Most Recently Used"),f1:!0,category:te.View})}async run(e){e.get(Wt).quickAccess.show(Xy.PREFIX)}}class Ghe extends X{static{this.ID="workbench.action.showAllEditors"}constructor(){super({id:Ghe.ID,title:I(3143,"Show All Editors By Appearance"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyP),mac:{primary:E.CtrlCmd|E.Alt|S.Tab}},category:te.File})}async run(e){e.get(Wt).quickAccess.show(CU.PREFIX)}}class zhe extends X{static{this.ID="workbench.action.showAllEditorsByMostRecentlyUsed"}constructor(){super({id:zhe.ID,title:I(3144,"Show All Editors By Most Recently Used"),f1:!0,category:te.View})}async run(e){e.get(Wt).quickAccess.show(xx.PREFIX)}}class d0 extends X{constructor(e,t,i){super(e),this.prefix=t,this.itemActivation=i}async run(e){const t=e.get(He),i=e.get(Wt),n=t.lookupKeybindings(this.desc.id);i.quickAccess.show(this.prefix,{quickNavigateConfiguration:{keybindings:n},itemActivation:this.itemActivation})}}class CQe extends d0{constructor(){super({id:"workbench.action.quickOpenPreviousRecentlyUsedEditor",title:I(3145,"Quick Open Previous Recently Used Editor"),f1:!0,category:te.View},xx.PREFIX,void 0)}}class EQe extends d0{constructor(){super({id:"workbench.action.quickOpenLeastRecentlyUsedEditor",title:I(3146,"Quick Open Least Recently Used Editor"),f1:!0,category:te.View},xx.PREFIX,void 0)}}class xQe extends d0{constructor(){super({id:"workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup",title:I(3147,"Quick Open Previous Recently Used Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Tab,mac:{primary:E.WinCtrl|S.Tab}},precondition:hq.toNegated(),category:te.View},Xy.PREFIX,void 0)}}class IQe extends d0{constructor(){super({id:"workbench.action.quickOpenLeastRecentlyUsedEditorInGroup",title:I(3148,"Quick Open Least Recently Used Editor in Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Tab,mac:{primary:E.WinCtrl|E.Shift|S.Tab}},precondition:hq.toNegated(),category:te.View},Xy.PREFIX,Sw.LAST)}}class qU extends X{static{this.ID="workbench.action.openPreviousEditorFromHistory"}constructor(){super({id:qU.ID,title:I(3149,"Quick Open Previous Editor from History"),f1:!0})}async run(e){const t=e.get(He),i=e.get(Wt),n=e.get(xe),o=t.lookupKeybindings(qU.ID);let r;n.activeGroup.count===0&&(r=Sw.FIRST),i.quickAccess.show("",{quickNavigateConfiguration:{keybindings:o},itemActivation:r})}}class DQe extends X{constructor(){super({id:"workbench.action.openNextRecentlyUsedEditor",title:I(3150,"Open Next Recently Used Editor"),f1:!0,category:te.View})}async run(e){e.get(So).openNextRecentlyUsedEditor()}}class kQe extends X{constructor(){super({id:"workbench.action.openPreviousRecentlyUsedEditor",title:I(3151,"Open Previous Recently Used Editor"),f1:!0,category:te.View})}async run(e){e.get(So).openPreviouslyUsedEditor()}}class TQe extends X{constructor(){super({id:"workbench.action.openNextRecentlyUsedEditorInGroup",title:I(3152,"Open Next Recently Used Editor In Group"),f1:!0,category:te.View})}async run(e){const t=e.get(So),i=e.get(xe);t.openNextRecentlyUsedEditor(i.activeGroup.id)}}class AQe extends X{constructor(){super({id:"workbench.action.openPreviousRecentlyUsedEditorInGroup",title:I(3153,"Open Previous Recently Used Editor In Group"),f1:!0,category:te.View})}async run(e){const t=e.get(So),i=e.get(xe);t.openPreviouslyUsedEditor(i.activeGroup.id)}}class RQe extends X{constructor(){super({id:"workbench.action.clearEditorHistory",title:I(3154,"Clear Editor History"),f1:!0})}async run(e){const t=e.get(ei),i=e.get(So),{confirmed:n}=await t.confirm({type:"warning",message:h(3155,"Do you want to clear the history of recently opened editors?"),detail:h(3140,"This action is irreversible!"),primaryButton:h(3141,"&&Clear")});n&&i.clear()}}class PQe extends mn{constructor(){super({id:"workbench.action.moveEditorLeftInGroup",title:I(3156,"Move Editor Left"),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.PageUp,mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.LeftArrow)}},f1:!0,category:te.View},Il,{to:"left"})}}class LQe extends mn{constructor(){super({id:"workbench.action.moveEditorRightInGroup",title:I(3157,"Move Editor Right"),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.PageDown,mac:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.RightArrow)}},f1:!0,category:te.View},Il,{to:"right"})}}class MQe extends mn{constructor(){super({id:"workbench.action.moveEditorToPreviousGroup",title:I(3158,"Move Editor into Previous Group"),keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Alt|S.LeftArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|S.LeftArrow}},f1:!0,category:te.View},Il,{to:"previous",by:"group"})}}class NQe extends mn{constructor(){super({id:"workbench.action.moveEditorToNextGroup",title:I(3159,"Move Editor into Next Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Alt|S.RightArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|S.RightArrow}},category:te.View},Il,{to:"next",by:"group"})}}class OQe extends mn{constructor(){super({id:"workbench.action.moveEditorToAboveGroup",title:I(3160,"Move Editor into Group Above"),f1:!0,category:te.View},Il,{to:"up",by:"group"})}}class FQe extends mn{constructor(){super({id:"workbench.action.moveEditorToBelowGroup",title:I(3161,"Move Editor into Group Below"),f1:!0,category:te.View},Il,{to:"down",by:"group"})}}class WQe extends mn{constructor(){super({id:"workbench.action.moveEditorToLeftGroup",title:I(3162,"Move Editor into Left Group"),f1:!0,category:te.View},Il,{to:"left",by:"group"})}}class BQe extends mn{constructor(){super({id:"workbench.action.moveEditorToRightGroup",title:I(3163,"Move Editor into Right Group"),f1:!0,category:te.View},Il,{to:"right",by:"group"})}}class VQe extends mn{constructor(){super({id:"workbench.action.moveEditorToFirstGroup",title:I(3164,"Move Editor into First Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.Shift|E.Alt|S.Digit1,mac:{primary:E.CtrlCmd|E.WinCtrl|S.Digit1}},category:te.View},Il,{to:"first",by:"group"})}}class HQe extends mn{constructor(){super({id:"workbench.action.moveEditorToLastGroup",title:I(3165,"Move Editor into Last Group"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.Shift|E.Alt|S.Digit9,mac:{primary:E.CtrlCmd|E.WinCtrl|S.Digit9}},category:te.View},Il,{to:"last",by:"group"})}}class UQe extends mn{constructor(){super({id:"workbench.action.splitEditorToPreviousGroup",title:I(3166,"Split Editor into Previous Group"),f1:!0,category:te.View},xg,{to:"previous",by:"group"})}}class $Qe extends mn{constructor(){super({id:"workbench.action.splitEditorToNextGroup",title:I(3167,"Split Editor into Next Group"),f1:!0,category:te.View},xg,{to:"next",by:"group"})}}class GQe extends mn{constructor(){super({id:"workbench.action.splitEditorToAboveGroup",title:I(3168,"Split Editor into Group Above"),f1:!0,category:te.View},xg,{to:"up",by:"group"})}}class zQe extends mn{constructor(){super({id:"workbench.action.splitEditorToBelowGroup",title:I(3169,"Split Editor into Group Below"),f1:!0,category:te.View},xg,{to:"down",by:"group"})}}class qQe extends mn{static{this.ID="workbench.action.splitEditorToLeftGroup"}static{this.LABEL=h(3170,"Split Editor into Left Group")}constructor(){super({id:"workbench.action.splitEditorToLeftGroup",title:I(3170,"Split Editor into Left Group"),f1:!0,category:te.View},xg,{to:"left",by:"group"})}}class KQe extends mn{constructor(){super({id:"workbench.action.splitEditorToRightGroup",title:I(3171,"Split Editor into Right Group"),f1:!0,category:te.View},xg,{to:"right",by:"group"})}}class jQe extends mn{constructor(){super({id:"workbench.action.splitEditorToFirstGroup",title:I(3172,"Split Editor into First Group"),f1:!0,category:te.View},xg,{to:"first",by:"group"})}}class YQe extends mn{constructor(){super({id:"workbench.action.splitEditorToLastGroup",title:I(3173,"Split Editor into Last Group"),f1:!0,category:te.View},xg,{to:"last",by:"group"})}}class qhe extends mn{static{this.ID="workbench.action.editorLayoutSingle"}constructor(){super({id:qhe.ID,title:I(3174,"Single Column Editor Layout"),f1:!0,category:te.View},Ig,{groups:[{}],orientation:cc.HORIZONTAL})}}class Khe extends mn{static{this.ID="workbench.action.editorLayoutTwoColumns"}constructor(){super({id:Khe.ID,title:I(3175,"Two Columns Editor Layout"),f1:!0,category:te.View},Ig,{groups:[{},{}],orientation:cc.HORIZONTAL})}}class jhe extends mn{static{this.ID="workbench.action.editorLayoutThreeColumns"}constructor(){super({id:jhe.ID,title:I(3176,"Three Columns Editor Layout"),f1:!0,category:te.View},Ig,{groups:[{},{},{}],orientation:cc.HORIZONTAL})}}class Yhe extends mn{static{this.ID="workbench.action.editorLayoutTwoRows"}constructor(){super({id:Yhe.ID,title:I(3177,"Two Rows Editor Layout"),f1:!0,category:te.View},Ig,{groups:[{},{}],orientation:cc.VERTICAL})}}class Qhe extends mn{static{this.ID="workbench.action.editorLayoutThreeRows"}constructor(){super({id:Qhe.ID,title:I(3178,"Three Rows Editor Layout"),f1:!0,category:te.View},Ig,{groups:[{},{},{}],orientation:cc.VERTICAL})}}class Xhe extends mn{static{this.ID="workbench.action.editorLayoutTwoByTwoGrid"}constructor(){super({id:Xhe.ID,title:I(3179,"Grid Editor Layout (2x2)"),f1:!0,category:te.View},Ig,{groups:[{groups:[{},{}]},{groups:[{},{}]}],orientation:cc.HORIZONTAL})}}class Zhe extends mn{static{this.ID="workbench.action.editorLayoutTwoColumnsBottom"}constructor(){super({id:Zhe.ID,title:I(3180,"Two Columns Bottom Editor Layout"),f1:!0,category:te.View},Ig,{groups:[{},{groups:[{},{}]}],orientation:cc.VERTICAL})}}class Jhe extends mn{static{this.ID="workbench.action.editorLayoutTwoRowsRight"}constructor(){super({id:Jhe.ID,title:I(3181,"Two Rows Right Editor Layout"),f1:!0,category:te.View},Ig,{groups:[{},{groups:[{},{}]}],orientation:cc.HORIZONTAL})}}class l0 extends X{constructor(e,t){super(e),this.direction=t}async run(e){const t=e.get(xe),i=e.get(yi),n=qd(),o=i.hasFocus(ot.EDITOR_PART)||n.activeElement===n.body,r=t.addGroup(t.activeGroup,this.direction);t.activateGroup(r),o&&r.focus()}}class QQe extends l0{constructor(){super({id:"workbench.action.newGroupLeft",title:I(3182,"New Editor Group to the Left"),f1:!0,category:te.View},Jt.LEFT)}}class XQe extends l0{constructor(){super({id:"workbench.action.newGroupRight",title:I(3183,"New Editor Group to the Right"),f1:!0,category:te.View},Jt.RIGHT)}}class ZQe extends l0{constructor(){super({id:"workbench.action.newGroupAbove",title:I(3184,"New Editor Group Above"),f1:!0,category:te.View},Jt.UP)}}class JQe extends l0{constructor(){super({id:"workbench.action.newGroupBelow",title:I(3185,"New Editor Group Below"),f1:!0,category:te.View},Jt.DOWN)}}class eXe extends X{constructor(){super({id:"workbench.action.toggleEditorType",title:I(3186,"Toggle Editor Type"),f1:!0,category:te.View,precondition:_I})}async run(e){const t=e.get(de),i=e.get(mf),n=t.activeEditorPane;if(!n)return;const o=Di.getCanonicalUri(n.input);if(!o)return;const r=i.getEditors(o).map(a=>a.id).filter(a=>a!==n.input.editorId);r.length!==0&&await t.replaceEditors([{editor:n.input,replacement:{resource:o,options:{override:r[0]}}}],n.group)}}class tXe extends X{constructor(){super({id:"workbench.action.reopenTextEditor",title:I(3187,"Reopen Editor with Text Editor"),f1:!0,category:te.View,precondition:_I})}async run(e){const t=e.get(de),i=t.activeEditorPane;if(!i)return;const n=Di.getCanonicalUri(i.input);n&&await t.replaceEditors([{editor:i.input,replacement:{resource:n,options:{override:id.id}}}],i.group)}}class eue extends X{constructor(e,t,i,n){super({id:e,title:t,category:te.View,precondition:$v,keybinding:i,f1:!0}),this.move=n}async run(e,...t){const i=e.get(xe),n=e.get(de),o=e.get(Ei),r=Ns(t,n,i,o);if(!r.groupedEditors.length)return;const a=await i.createAuxiliaryEditorPart(),{group:c,editors:d}=r.groupedEditors[0],l=Aq(c,d,r.preserveFocus);this.move?c.moveEditors(l,a.activeGroup):c.copyEditors(l,a.activeGroup),a.activeGroup.focus()}}class iXe extends eue{constructor(){super(pOe,{...I(3188,"Move Editor into New Window"),mnemonicTitle:h(3189,"&&Move Editor into New Window")},void 0,!0)}}class nXe extends eue{constructor(){super(fOe,{...I(3190,"Copy Editor into New Window"),mnemonicTitle:h(3191,"&&Copy Editor into New Window")},{primary:lt(E.CtrlCmd|S.KeyK,S.KeyO),weight:W.WorkbenchContrib},!1)}}class tue extends X{constructor(e,t,i){super({id:e,title:t,category:te.View,f1:!0}),this.move=i}async run(e){const t=e.get(xe),i=t.activeGroup,n=await t.createAuxiliaryEditorPart();t.mergeGroup(i,n.activeGroup,{mode:this.move?FE.MOVE_EDITORS:FE.COPY_EDITORS}),n.activeGroup.focus()}}class sXe extends tue{constructor(){super(mOe,{...I(3192,"Move Editor Group into New Window"),mnemonicTitle:h(3193,"&&Move Editor Group into New Window")},!0)}}class oXe extends tue{constructor(){super(vOe,{...I(3194,"Copy Editor Group into New Window"),mnemonicTitle:h(3195,"&&Copy Editor Group into New Window")},!1)}}class rXe extends X{constructor(){super({id:"workbench.action.restoreEditorsToMainWindow",title:{...I(3196,"Restore Editors into Main Window"),mnemonicTitle:h(3197,"&&Restore Editors into Main Window")},f1:!0,precondition:_l,category:te.View})}async run(e){const t=e.get(xe);t.mergeAllGroups(t.mainPart.activeGroup)}}class aXe extends X{constructor(){super({id:_Oe,title:{...I(3198,"New Empty Editor Window"),mnemonicTitle:h(3199,"&&New Empty Editor Window")},f1:!0,category:te.View})}async run(e){(await e.get(xe).createAuxiliaryEditorPart()).activeGroup.focus()}}class Ac{constructor(e){this.identifier=e}}class lu{constructor(e){this.identifier=e}}async function g0e(s){const e=[],t=Si.uriList.toLowerCase();if(s.has(t))try{const i=await s.get(t)?.asString(),n=JSON.stringify(hl.parse(i??""));e.push(...ade(n))}catch{}return e}let $P=class{constructor(e,t,i,n,o,r,a,c){this.options=e,this.fileService=t,this.workspacesService=i,this.editorService=n,this.workspaceEditingService=o,this.hostService=r,this.contextService=a,this.instantiationService=c}async handleDrop(e,t,i,n,o){const r=await this.instantiationService.invokeFunction(d=>rde(d,e));if(!r.length)return;if(await this.hostService.focus(t),this.options.allowWorkspaceOpen){const d=$t(r.filter(l=>l.allowWorkspaceOpen&&l.resource?.scheme===ae.file).map(l=>l.resource));if(d.length>0&&await this.handleWorkspaceDrop(d))return}const a=$t(r.filter(d=>d.isExternal&&d.resource?.scheme===ae.file).map(d=>d.resource));a.length&&this.workspacesService.addRecentlyOpened(a.map(d=>({fileUri:d})));const c=i?.();await this.editorService.openEditors(r.map(d=>({...d,resource:d.resource,options:{...d.options,...o,pinned:!0}})),c,{validateTrust:!0}),n?.(c)}async handleWorkspaceDrop(e){const t=[],i=[];return await Promise.all(e.map(async n=>{if(Gz(n)){t.push({workspaceUri:n});return}try{const o=await this.fileService.stat(n);o.isDirectory&&(t.push({folderUri:o.resource}),i.push({uri:o.resource}))}catch{}})),t.length===0?!1:(t.length>i.length||i.length===1?await this.hostService.openWindow(t):qM(this.contextService.getWorkspace())?await this.workspaceEditingService.addFolders(i):await this.workspaceEditingService.createAndEnterWorkspace(i),!0)}};$P=f([p(1,je),p(2,Nh),p(3,de),p(4,uc),p(5,Hn),p(6,It),p(7,Z)],$P);function ag(s,e,t,i){if(e.length===0||!t.dataTransfer)return;const n=s.get(Ps),o=s.get(de),r=s.get(je),a=s.get(ui),c=$t(e.map(v=>R.isUri(v)?{resource:v}:iW(v)?R.isUri(v.editor.resource)?{resource:v.editor.resource}:void 0:{resource:v.selection?SF(v.resource,v.selection):v.resource,isDirectory:v.isDirectory,selection:v.selection})),d=c.filter(({resource:v})=>r.hasProvider(v));if(!i?.disableStandardTransfer){const v=bn?`\r
`:`
`;t.dataTransfer.setData(Ds.TEXT,d.map(({resource:w})=>a.getUriLabel(w,{noPrefix:!0})).join(v));const _=d.find(({isDirectory:w})=>!w);if(_){const w=nc.uriToFileUri(_.resource);w.scheme===ae.file&&t.dataTransfer.setData(Ds.DOWNLOAD_URL,[Si.binary,Qe(_.resource),w.toString()].join(":"))}}const l=d.filter(({isDirectory:v})=>!v);l.length&&t.dataTransfer.setData(Ds.RESOURCES,JSON.stringify(l.map(({resource:v})=>v.toString())));const u=Ke.as(UK.DragAndDropContribution).getAll();for(const v of u)v.setData(c,t);const g=[];for(const v of e){let _;if(iW(v)){const w=v.editor.toUntyped({preserveViewState:v.groupId});w&&(_={...w,resource:Di.getCanonicalUri(w)})}else if(R.isUri(v)){const{selection:w,uri:C}=gne(v);_={resource:C,options:w?{selection:w}:void 0}}else v.isDirectory||(_={resource:v.resource,options:{selection:v.selection}});if(_){{const w=_.resource;if(w){const C=n.files.get(w);C&&(typeof _.languageId!="string"&&(_.languageId=C.getLanguageId()),typeof _.encoding!="string"&&(_.encoding=C.getEncoding()),typeof _.contents!="string"&&C.isDirty()&&!C.textEditorModel.isTooLargeForHeapOperation()&&(_.contents=C.textEditorModel.getValue())),_.options?.viewState||(_.options={..._.options,viewState:(()=>{for(const k of o.visibleEditorPanes)if(At(k.input.resource,w)){const D=k.getViewState();if(D)return D}})()})}}g.push(_)}}g.length&&t.dataTransfer.setData(ho.EDITORS,m_e(g));const m=d.filter(({isDirectory:v})=>v).map(({resource:v})=>v);if(g.length||m.length){const v=[...m];for(const _ of g)_.resource?v.push(_.options?.selection?SF(_.resource,_.options.selection):_.resource):Q_(_)?_.modified.resource&&v.push(_.modified.resource):FS(_)?_.primary.resource&&v.push(_.primary.resource):wC(_)&&v.push(_.result.resource);i?.disableStandardTransfer||t.dataTransfer.setData(Si.uriList,hl.create(v.slice(0,1))),t.dataTransfer.setData(Ds.INTERNAL_URI_LIST,hl.create(v))}}class p0e{constructor(e,t){this.type=e,this.id=t}update(e){}getData(){return{type:this.type,id:this.id}}}class RS{constructor(e){this.compositeId=e}get id(){return this.compositeId}}class PS{constructor(e){this.viewId=e}get id(){return this.viewId}}class Xd extends F{static get INSTANCE(){return Xd.instance||(Xd.instance=new Xd,kne(Xd.instance)),Xd.instance}constructor(){super(),this.transferData=Ru.getInstance(),this.onDragStart=this._register(new M),this.onDragEnd=this._register(new M),this._register(this.onDragEnd.event(e=>{const t=e.dragAndDropData.getData().id,i=e.dragAndDropData.getData().type;this.readDragData(i)?.getData().id===t&&this.transferData.clearData(i==="view"?PS.prototype:RS.prototype)}))}readDragData(e){if(this.transferData.hasData(e==="view"?PS.prototype:RS.prototype)){const t=this.transferData.getData(e==="view"?PS.prototype:RS.prototype);if(t&&t[0])return new p0e(e,t[0].id)}}writeDragData(e,t){this.transferData.setData([t==="view"?new PS(e):new RS(e)],t==="view"?PS.prototype:RS.prototype)}registerTarget(e,t){const i=new U;return i.add(new Wp(e,{onDragEnter:n=>{if(n.preventDefault(),t.onDragEnter){const o=this.readDragData("composite")||this.readDragData("view");o&&t.onDragEnter({eventData:n,dragAndDropData:o})}},onDragLeave:n=>{const o=this.readDragData("composite")||this.readDragData("view");t.onDragLeave&&o&&t.onDragLeave({eventData:n,dragAndDropData:o})},onDrop:n=>{if(t.onDrop){const o=this.readDragData("composite")||this.readDragData("view");if(!o)return;t.onDrop({eventData:n,dragAndDropData:o}),this.onDragEnd.fire({eventData:n,dragAndDropData:o})}},onDragOver:n=>{if(n.preventDefault(),t.onDragOver){const o=this.readDragData("composite")||this.readDragData("view");if(!o)return;t.onDragOver({eventData:n,dragAndDropData:o})}}})),t.onDragStart&&this.onDragStart.event(n=>{t.onDragStart(n)},this,i),t.onDragEnd&&this.onDragEnd.event(n=>{t.onDragEnd(n)},this,i),this._register(i)}registerDraggable(e,t,i){e.draggable=!0;const n=new U;return n.add(new Wp(e,{onDragStart:o=>{const{id:r,type:a}=t();this.writeDragData(r,a),o.dataTransfer?.setDragImage(e,0,0),this.onDragStart.fire({eventData:o,dragAndDropData:this.readDragData(a)})},onDragEnd:o=>{const{type:r}=t(),a=this.readDragData(r);a&&this.onDragEnd.fire({eventData:o,dragAndDropData:a})},onDragEnter:o=>{if(i.onDragEnter){const r=this.readDragData("composite")||this.readDragData("view");if(!r)return;r&&i.onDragEnter({eventData:o,dragAndDropData:r})}},onDragLeave:o=>{const r=this.readDragData("composite")||this.readDragData("view");r&&i.onDragLeave?.({eventData:o,dragAndDropData:r})},onDrop:o=>{if(i.onDrop){const r=this.readDragData("composite")||this.readDragData("view");if(!r)return;i.onDrop({eventData:o,dragAndDropData:r}),this.onDragEnd.fire({eventData:o,dragAndDropData:r})}},onDragOver:o=>{if(i.onDragOver){const r=this.readDragData("composite")||this.readDragData("view");if(!r)return;i.onDragOver({eventData:o,dragAndDropData:r})}}})),i.onDragStart&&this.onDragStart.event(o=>{i.onDragStart(o)},this,n),i.onDragEnd&&this.onDragEnd.event(o=>{i.onDragEnd(o)},this,n),this._register(n)}}function GP(s,e,t){s&&(s.dropEffect=t?e:"none")}let KZ=class{constructor(e,t){this.toResource=e,this.instantiationService=t}getDragURI(e){const t=this.toResource(e);return t?t.toString():null}getDragLabel(e){const t=$t(e.map(this.toResource));return t.length===1?Qe(t[0]):t.length>1?String(t.length):void 0}onDragStart(e,t){const i=[],n=e.elements;for(const o of n){const r=this.toResource(o);r&&i.push(r)}this.onWillDragElements(n,t),i.length&&this.instantiationService.invokeFunction(o=>ag(o,i,t))}onWillDragElements(e,t){}onDragOver(e,t,i,n,o){return!1}drop(e,t,i,n,o){}dispose(){}};KZ=f([p(1,Z)],KZ);class U4 extends F{static{this.CHANNEL_NAME="monaco-workbench-global-dragged-over"}constructor(){super(),this.broadcaster=this._register(new sCe(U4.CHANNEL_NAME)),this.draggedOver=!1,this.registerListeners()}registerListeners(){this._register(T.runAndSubscribe(km,({window:e,disposables:t})=>{t.add(re(e,pe.DRAG_OVER,()=>this.markDraggedOver(!1),!0)),t.add(re(e,pe.DRAG_LEAVE,()=>this.clearDraggedOver(!1),!0))},{window:zi,disposables:this._store})),this._register(this.broadcaster.onDidReceiveData(e=>{e===!0?this.markDraggedOver(!0):this.clearDraggedOver(!0)}))}get isDraggedOver(){return this.draggedOver}markDraggedOver(e){this.draggedOver!==!0&&(this.draggedOver=!0,e||this.broadcaster.postData(!0))}clearDraggedOver(e){this.draggedOver!==!1&&(this.draggedOver=!1,e||this.broadcaster.postData(!1))}}const f0e=new U4;function iue(){return f0e.isDraggedOver}const nue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),m0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(m0e);class zP extends F{static{this.HEADER_SIZE=22}get ariaHeaderLabel(){return this._ariaHeaderLabel}set ariaHeaderLabel(e){this._ariaHeaderLabel=e,this.header?.setAttribute("aria-label",this.ariaHeaderLabel)}get draggableElement(){return this.header}get dropTargetElement(){return this.element}get dropBackground(){return this.styles.dropBackground}get minimumBodySize(){return this._minimumBodySize}set minimumBodySize(e){this._minimumBodySize=e,this._onDidChange.fire(void 0)}get maximumBodySize(){return this._maximumBodySize}set maximumBodySize(e){this._maximumBodySize=e,this._onDidChange.fire(void 0)}get headerSize(){return this.headerVisible?zP.HEADER_SIZE:0}get minimumSize(){const e=this.headerSize,i=!this.headerVisible||this.isExpanded()?this.minimumBodySize:0;return e+i}get maximumSize(){const e=this.headerSize,i=!this.headerVisible||this.isExpanded()?this.maximumBodySize:0;return e+i}getAriaHeaderLabel(e){return h(30,"{0} Section",e)}constructor(e){super(),this.expandedSize=void 0,this._headerVisible=!0,this._collapsible=!0,this._bodyRendered=!1,this.styles={dropBackground:void 0,headerBackground:void 0,headerBorder:void 0,headerForeground:void 0,leftBorder:void 0},this.animationTimer=void 0,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._onDidChangeExpansionState=this._register(new M),this.onDidChangeExpansionState=this._onDidChangeExpansionState.event,this.orthogonalSize=0,this._expanded=typeof e.expanded>"u"?!0:!!e.expanded,this._orientation=typeof e.orientation>"u"?St.VERTICAL:e.orientation,this._ariaHeaderLabel=this.getAriaHeaderLabel(e.title),this._minimumBodySize=typeof e.minimumBodySize=="number"?e.minimumBodySize:this._orientation===St.HORIZONTAL?200:120,this._maximumBodySize=typeof e.maximumBodySize=="number"?e.maximumBodySize:Number.POSITIVE_INFINITY,this.element=j(".pane")}isExpanded(){return this._expanded}setExpanded(e){return!e&&!this.collapsible||this._expanded===!!e?!1:(this.element?.classList.toggle("expanded",e),this._expanded=!!e,this.updateHeader(),e?(this._bodyRendered||(this.renderBody(this.body),this._bodyRendered=!0),typeof this.animationTimer=="number"&&Et(this.element).clearTimeout(this.animationTimer),ee(this.element,this.body)):this.animationTimer=Et(this.element).setTimeout(()=>{this.body.remove()},200),this._onDidChangeExpansionState.fire(e),this._onDidChange.fire(e?this.expandedSize:void 0),!0)}get headerVisible(){return this._headerVisible}set headerVisible(e){this._headerVisible!==!!e&&(this._headerVisible=!!e,this.updateHeader(),this._onDidChange.fire(void 0))}get collapsible(){return this._collapsible}set collapsible(e){this._collapsible!==!!e&&(this._collapsible=!!e,this.updateHeader())}get orientation(){return this._orientation}set orientation(e){this._orientation!==e&&(this._orientation=e,this.element&&(this.element.classList.toggle("horizontal",this.orientation===St.HORIZONTAL),this.element.classList.toggle("vertical",this.orientation===St.VERTICAL)),this.header&&this.updateHeader())}render(){this.element.classList.toggle("expanded",this.isExpanded()),this.element.classList.toggle("horizontal",this.orientation===St.HORIZONTAL),this.element.classList.toggle("vertical",this.orientation===St.VERTICAL),this.header=j(".pane-header"),ee(this.element,this.header),this.header.setAttribute("tabindex","0"),this.header.setAttribute("role","button"),this.header.setAttribute("aria-label",this.ariaHeaderLabel),this.renderHeader(this.header);const e=Fo(this.header);this._register(e),this._register(e.onDidFocus(()=>this.header?.classList.add("focused"),null)),this._register(e.onDidBlur(()=>this.header?.classList.remove("focused"),null)),this.updateHeader();const t=this._register(new U),i=this._register(new Ko(this.header,"keydown")),n=T.map(i.event,r=>new vo(r),t);this._register(T.filter(n,r=>r.keyCode===S.Enter||r.keyCode===S.Space,t)(()=>this.setExpanded(!this.isExpanded()),null)),this._register(T.filter(n,r=>r.keyCode===S.LeftArrow,t)(()=>this.setExpanded(!1),null)),this._register(T.filter(n,r=>r.keyCode===S.RightArrow,t)(()=>this.setExpanded(!0),null)),this._register(Dh.addTarget(this.header));const o=this.header;[pe.CLICK,Yo.Tap].forEach(r=>{this._register(re(o,r,a=>{a.defaultPrevented||this.setExpanded(!this.isExpanded())}))}),this.body=ee(this.element,j(".pane-body")),!this._bodyRendered&&this.isExpanded()&&(this.renderBody(this.body),this._bodyRendered=!0),this.isExpanded()||this.body.remove()}layout(e){const t=this.headerVisible?zP.HEADER_SIZE:0,i=this._orientation===St.VERTICAL?this.orthogonalSize:e,n=this._orientation===St.VERTICAL?e-t:this.orthogonalSize-t;this.isExpanded()&&(this.body.classList.toggle("wide",i>=600),this.layoutBody(n,i),this.expandedSize=e)}style(e){this.styles=e,this.header&&this.updateHeader()}updateHeader(){if(!this.header)return;const e=!this.headerVisible||this.isExpanded();this.collapsible?(this.header.setAttribute("tabindex","0"),this.header.setAttribute("role","button")):(this.header.removeAttribute("tabindex"),this.header.removeAttribute("role")),this.header.style.lineHeight=`${this.headerSize}px`,this.header.classList.toggle("hidden",!this.headerVisible),this.header.classList.toggle("expanded",e),this.header.classList.toggle("not-collapsible",!this.collapsible),this.header.setAttribute("aria-expanded",String(e)),this.header.style.color=this.collapsible?this.styles.headerForeground??"":"",this.header.style.backgroundColor=(this.collapsible?this.styles.headerBackground:"transparent")??"",this.header.style.borderTop=this.styles.headerBorder&&this.orientation===St.VERTICAL?`1px solid ${this.styles.headerBorder}`:"",this.element.style.borderLeft=this.styles.leftBorder&&this.orientation===St.HORIZONTAL?`1px solid ${this.styles.leftBorder}`:""}}class $4 extends F{static{this.DefaultDragOverBackgroundColor=new ye(new qm(128,128,128,.5))}constructor(e,t,i){super(),this.pane=e,this.dnd=t,this.context=i,this.dragOverCounter=0,this._onDidDrop=this._register(new M),this.onDidDrop=this._onDidDrop.event,e.draggableElement.draggable=!0,this._register(re(e.draggableElement,"dragstart",n=>this.onDragStart(n))),this._register(re(e.dropTargetElement,"dragenter",n=>this.onDragEnter(n))),this._register(re(e.dropTargetElement,"dragleave",n=>this.onDragLeave(n))),this._register(re(e.dropTargetElement,"dragend",n=>this.onDragEnd(n))),this._register(re(e.dropTargetElement,"drop",n=>this.onDrop(n)))}onDragStart(e){if(!this.dnd.canDrag(this.pane)||!e.dataTransfer){e.preventDefault(),e.stopPropagation();return}const t=this.pane.draggableElement?.textContent||"";e.dataTransfer.effectAllowed="move",ZM&&e.dataTransfer?.setData(Ds.TEXT,t),JM(e,this.pane.element,t),this.context.draggable=this}onDragEnter(e){!this.context.draggable||this.context.draggable===this||this.dnd.canDrop(this.context.draggable.pane,this.pane)&&(this.dragOverCounter++,this.render())}onDragLeave(e){!this.context.draggable||this.context.draggable===this||this.dnd.canDrop(this.context.draggable.pane,this.pane)&&(this.dragOverCounter--,this.dragOverCounter===0&&this.render())}onDragEnd(e){this.context.draggable&&(this.dragOverCounter=0,this.render(),this.context.draggable=null)}onDrop(e){this.context.draggable&&(Vi.stop(e),this.dragOverCounter=0,this.render(),this.dnd.canDrop(this.context.draggable.pane,this.pane)&&this.context.draggable!==this&&this._onDidDrop.fire({from:this.context.draggable.pane,to:this.pane}),this.context.draggable=null)}render(){let e=null;this.dragOverCounter>0&&(e=this.pane.dropBackground??$4.DefaultDragOverBackgroundColor.toString()),this.pane.dropTargetElement.style.backgroundColor=e||""}}class v0e extends F{constructor(e,t={}){super(),this.dndContext={draggable:null},this.paneItems=[],this.orthogonalSize=0,this.size=0,this.animationTimer=void 0,this._onDidDrop=this._register(new M),this.onDidDrop=this._onDidDrop.event,this.dnd=t.dnd,this.orientation=t.orientation??St.VERTICAL,this.element=ee(e,j(".monaco-pane-view")),this.splitview=this._register(new OT(this.element,{orientation:this.orientation})),this.onDidSashReset=this.splitview.onDidSashReset,this.onDidSashChange=this.splitview.onDidSashChange,this.onDidScroll=this.splitview.onDidScroll;const i=this._register(new U),n=this._register(new Ko(this.element,"keydown")),o=T.map(T.filter(n.event,r=>Ph(r.target)&&r.target.classList.contains("pane-header"),i),r=>new vo(r),i);this._register(T.filter(o,r=>r.keyCode===S.UpArrow,i)(()=>this.focusPrevious())),this._register(T.filter(o,r=>r.keyCode===S.DownArrow,i)(()=>this.focusNext()))}addPane(e,t,i=this.splitview.length){const n=new U;e.onDidChangeExpansionState(this.setupAnimation,this,n);const o={pane:e,disposable:n};if(this.paneItems.splice(i,0,o),e.orientation=this.orientation,e.orthogonalSize=this.orthogonalSize,this.splitview.addView(e,t,i),this.dnd){const r=new $4(e,this.dnd,this.dndContext);n.add(r),n.add(r.onDidDrop(this._onDidDrop.fire,this._onDidDrop))}}removePane(e){const t=this.paneItems.findIndex(n=>n.pane===e);if(t===-1)return;this.splitview.removeView(t,e.isExpanded()?EE.Distribute:void 0),this.paneItems.splice(t,1)[0].disposable.dispose()}movePane(e,t){const i=this.paneItems.findIndex(r=>r.pane===e),n=this.paneItems.findIndex(r=>r.pane===t);if(i===-1||n===-1)return;const[o]=this.paneItems.splice(i,1);this.paneItems.splice(n,0,o),this.splitview.moveView(i,n)}resizePane(e,t){const i=this.paneItems.findIndex(n=>n.pane===e);i!==-1&&this.splitview.resizeView(i,t)}getPaneSize(e){const t=this.paneItems.findIndex(i=>i.pane===e);return t===-1?-1:this.splitview.getViewSize(t)}layout(e,t){this.orthogonalSize=this.orientation===St.VERTICAL?t:e,this.size=this.orientation===St.HORIZONTAL?t:e;for(const i of this.paneItems)i.pane.orthogonalSize=this.orthogonalSize;this.splitview.layout(this.size)}setBoundarySashes(e){this.boundarySashes=e,this.updateSplitviewOrthogonalSashes(e)}updateSplitviewOrthogonalSashes(e){this.orientation===St.VERTICAL?(this.splitview.orthogonalStartSash=e?.left,this.splitview.orthogonalEndSash=e?.right):this.splitview.orthogonalEndSash=e?.bottom}flipOrientation(e,t){this.orientation=this.orientation===St.VERTICAL?St.HORIZONTAL:St.VERTICAL;const i=this.paneItems.map(r=>this.getPaneSize(r.pane));this.splitview.dispose(),Xi(this.element),this.splitview=this._register(new OT(this.element,{orientation:this.orientation})),this.updateSplitviewOrthogonalSashes(this.boundarySashes);const n=this.orientation===St.VERTICAL?t:e,o=this.orientation===St.HORIZONTAL?t:e;this.paneItems.forEach((r,a)=>{r.pane.orthogonalSize=n,r.pane.orientation=this.orientation;const c=this.size===0?0:o*i[a]/this.size;this.splitview.addView(r.pane,c,a)}),this.size=o,this.orthogonalSize=n,this.splitview.layout(this.size)}setupAnimation(){typeof this.animationTimer=="number"&&Et(this.element).clearTimeout(this.animationTimer),this.element.classList.add("animated"),this.animationTimer=Et(this.element).setTimeout(()=>{this.animationTimer=void 0,this.element.classList.remove("animated")},200)}getPaneHeaderElements(){return[...this.element.querySelectorAll(".pane-header")]}focusPrevious(){const e=this.getPaneHeaderElements(),t=e.indexOf(this.element.ownerDocument.activeElement);t!==-1&&e[Math.max(t-1,0)].focus()}focusNext(){const e=this.getPaneHeaderElements(),t=e.indexOf(this.element.ownerDocument.activeElement);t!==-1&&e[Math.min(t+1,e.length-1)].focus()}dispose(){super.dispose(),this.paneItems.forEach(e=>e.disposable.dispose())}}const _0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(_0e);let kx=class extends F{get enabled(){return this._enabled}set enabled(e){e?(this.el.setAttribute("aria-disabled","false"),this.el.tabIndex=0,this.el.style.pointerEvents="auto",this.el.style.opacity="1",this.el.style.cursor="pointer",this._enabled=!1):(this.el.setAttribute("aria-disabled","true"),this.el.tabIndex=-1,this.el.style.pointerEvents="none",this.el.style.opacity="0.4",this.el.style.cursor="default",this._enabled=!0),this._enabled=e}set link(e){typeof e.label=="string"?this.el.textContent=e.label:(Xi(this.el),this.el.appendChild(e.label)),this.el.href=e.href,typeof e.tabIndex<"u"&&(this.el.tabIndex=e.tabIndex),this.setTooltip(e.title),this._link=e}constructor(e,t,i={},n,o){super(),this._link=t,this._hoverService=n,this._enabled=!0,this.el=ee(e,j("a.monaco-link",{tabIndex:t.tabIndex??0,href:t.href},t.label)),this.hoverDelegate=i.hoverDelegate??Ir("mouse"),this.setTooltip(t.title),this.el.setAttribute("role","button");const r=this._register(new Ko(this.el,"click")),a=this._register(new Ko(this.el,"keypress")),c=T.chain(a.event,u=>u.map(g=>new vo(g)).filter(g=>g.keyCode===S.Enter)),d=this._register(new Ko(this.el,Yo.Tap)).event;this._register(Dh.addTarget(this.el));const l=T.any(r.event,c,d);this._register(l(u=>{this.enabled&&(Vi.stop(u,!0),i?.opener?i.opener(this._link.href):o.open(this._link.href,{allowCommands:!0}))})),this.enabled=!0}setTooltip(e){this.hoverDelegate.showNativeHover?this.el.title=e??"":!this.hover&&e?this.hover=this._register(this._hoverService.setupManagedHover(this.hoverDelegate,this.el,e)):this.hover&&this.hover.update(e)}};kx=f([p(3,Ti),p(4,mi)],kx);class b0e extends F{constructor(e,t){super(),this.progressBar=e,this.group=t,this.registerListeners()}registerListeners(){this._register(this.group.onDidModelChange(e=>{(e.kind===ct.EDITOR_ACTIVE||e.kind===ct.EDITOR_CLOSE&&this.group.isEmpty)&&this.progressBar.stop().hide()}))}show(e,t){return this.group.isEmpty?v_e:e===!0?this.doShow(!0,t):this.doShow(e,t)}doShow(e,t){return typeof e=="boolean"?this.progressBar.infinite().show(t):this.progressBar.total(e).show(t),{total:i=>{this.progressBar.total(i)},worked:i=>{this.progressBar.hasTotal()?this.progressBar.worked(i):this.progressBar.infinite().show()},done:()=>{this.progressBar.stop().hide()}}}async showWhile(e,t){if(this.group.isEmpty)try{await e}catch{}return this.doShowWhile(e,t)}async doShowWhile(e,t){try{this.progressBar.infinite().show(t),await e}catch{}finally{this.progressBar.stop().hide()}}}var xs;(function(s){let e;(function(n){n[n.None=0]="None",n[n.Done=1]="Done",n[n.Infinite=2]="Infinite",n[n.While=3]="While",n[n.Work=4]="Work"})(e=s.Type||(s.Type={})),s.None={type:e.None},s.Done={type:e.Done},s.Infinite={type:e.Infinite};class t{constructor(o,r,a){this.whilePromise=o,this.whileStart=r,this.whileDelay=a,this.type=e.While}}s.While=t;class i{constructor(o,r){this.total=o,this.worked=r,this.type=e.Work}}s.Work=i})(xs||(xs={}));class y0e extends F{constructor(e,t){super(),this.progressBar=e,this.scope=t,this.progressState=xs.None,this.registerListeners()}registerListeners(){this._register(this.scope.onDidChangeActive(()=>{this.scope.isActive?this.onDidScopeActivate():this.onDidScopeDeactivate()}))}onDidScopeActivate(){if(this.progressState.type!==xs.Done.type)if(this.progressState.type===xs.Type.While){let e;if(this.progressState.whileDelay>0){const t=this.progressState.whileDelay-(Date.now()-this.progressState.whileStart);t>0&&(e=t)}this.doShowWhile(e)}else this.progressState.type===xs.Type.Infinite?this.progressBar.infinite().show():this.progressState.type===xs.Type.Work&&(this.progressState.total&&this.progressBar.total(this.progressState.total).show(),this.progressState.worked&&this.progressBar.worked(this.progressState.worked).show())}onDidScopeDeactivate(){this.progressBar.stop().hide()}show(e,t){return typeof e=="boolean"?this.progressState=xs.Infinite:this.progressState=new xs.Work(e,void 0),this.scope.isActive&&(this.progressState.type===xs.Type.Infinite?this.progressBar.infinite().show(t):this.progressState.type===xs.Type.Work&&typeof this.progressState.total=="number"&&this.progressBar.total(this.progressState.total).show(t)),{total:i=>{this.progressState=new xs.Work(i,this.progressState.type===xs.Type.Work?this.progressState.worked:void 0),this.scope.isActive&&this.progressBar.total(i)},worked:i=>{!this.scope.isActive||this.progressBar.hasTotal()?(this.progressState=new xs.Work(this.progressState.type===xs.Type.Work?this.progressState.total:void 0,this.progressState.type===xs.Type.Work&&typeof this.progressState.worked=="number"?this.progressState.worked+i:i),this.scope.isActive&&this.progressBar.worked(i)):(this.progressState=xs.Infinite,this.progressBar.infinite().show())},done:()=>{this.progressState=xs.Done,this.scope.isActive&&this.progressBar.stop().hide()}}}async showWhile(e,t){this.progressState.type===xs.Type.While&&(e=Promise.allSettled([e,this.progressState.whilePromise])),this.progressState=new xs.While(e,t||0,Date.now());try{this.doShowWhile(t),await e}catch{}finally{(this.progressState.type!==xs.Type.While||this.progressState.whilePromise===e)&&(this.progressState=xs.None,this.scope.isActive&&this.progressBar.stop().hide())}}doShowWhile(e){this.scope.isActive&&this.progressBar.infinite().show(e)}}class w0e extends F{get isActive(){return this._isActive}constructor(e,t){super(),this.scopeId=e,this._isActive=t,this._onDidChangeActive=this._register(new M),this.onDidChangeActive=this._onDidChangeActive.event}onScopeOpened(e){e===this.scopeId&&(this._isActive||(this._isActive=!0,this._onDidChangeActive.fire()))}onScopeClosed(e){e===this.scopeId&&this._isActive&&(this._isActive=!1,this._onDidChangeActive.fire())}}class S0e extends F{get primaryActions(){return this._primaryActions}get secondaryActions(){return this._secondaryActions}constructor(e,t,i,n){super(),this.options=t,this.menuService=i,this.contextKeyService=n,this._primaryActions=[],this._secondaryActions=[],this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.disposables=this._register(new U),this.menu=this._register(i.createMenu(e,n)),this._register(this.menu.onDidChange(()=>this.updateActions())),this.updateActions()}updateActions(){this.disposables.clear();const e=Xm(this.menu.getActions(this.options));this._primaryActions=e.primary,this._secondaryActions=e.secondary,this.disposables.add(this.updateSubmenus([...this._primaryActions,...this._secondaryActions],{})),this._onDidChange.fire()}updateSubmenus(e,t){const i=new U;for(const n of e)if(n instanceof xh&&!t[n.item.submenu.id]){const o=t[n.item.submenu.id]=i.add(this.menuService.createMenu(n.item.submenu,this.contextKeyService));i.add(o.onDidChange(()=>this.updateActions())),i.add(this.updateSubmenus(n.actions,t))}return i}}let qP=class extends F{constructor(e,t,i,n,o){super(),this.menuId=e,this.contextMenuId=t,this.options=i,this.contextKeyService=n,this.menuService=o,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.menuActions=this._register(new S0e(e,this.options,o,n)),this._register(this.menuActions.onDidChange(()=>this._onDidChange.fire()))}getPrimaryActions(){return this.menuActions.primaryActions}getSecondaryActions(){return this.menuActions.secondaryActions}getContextMenuActions(){if(this.contextMenuId){const e=this.menuService.getMenuActions(this.contextMenuId,this.contextKeyService,this.options);return Xm(e).secondary}return[]}};qP=f([p(3,fe),p(4,fn)],qP);function KU(s){return s.lookupKeybinding("history.showPrevious")?.getElectronAccelerator()==="Up"&&s.lookupKeybinding("history.showNext")?.getElectronAccelerator()==="Down"}const sue=new N("menu.view.filter"),mD=new N("submenu.view.filter");ge.appendMenuItem(sue,{submenu:mD,title:h(3514,"More Filters..."),group:"navigation",icon:K.filter});class C0e extends Nne{constructor(){super(...arguments),this._checked=!1}set checked(e){this._checked!==e&&(this._checked=e,this.updateChecked())}updateChecked(){this.element&&this.element.classList.toggle("checked",this._checked)}render(e){super.render(e),this.updateChecked()}}let jU=class extends lf{get onDidFocus(){return this.focusTracker.onDidFocus}get onDidBlur(){return this.focusTracker.onDidBlur}constructor(e,t,i,n,o){super(),this.options=e,this.instantiationService=t,this.contextViewService=i,this.keybindingService=o,this._onDidChangeFilterText=this._register(new M),this.onDidChangeFilterText=this._onDidChangeFilterText.event,this.isMoreFiltersChecked=!1,this.delayedFilterUpdate=new ju(300),this._register(Ie(()=>this.delayedFilterUpdate.cancel())),e.focusContextKey&&(this.focusContextKey=new O(e.focusContextKey,!1).bindTo(n)),this.element=j(".viewpane-filter"),[this.filterInputBox,this.focusTracker]=this.createInput(this.element),this._register(this.filterInputBox),this._register(this.focusTracker);const r=ee(this.element,j(".viewpane-filter-controls"));this.filterBadge=this.createBadge(r),this.toolbar=this._register(this.createToolBar(r)),this.adjustInputBox()}hasFocus(){return this.filterInputBox.hasFocus()}focus(){this.filterInputBox.focus()}blur(){this.filterInputBox.blur()}updateBadge(e){this.filterBadge.classList.toggle("hidden",!e),this.filterBadge.textContent=e||"",this.adjustInputBox()}setFilterText(e){this.filterInputBox.value=e}getFilterText(){return this.filterInputBox.value}getHistory(){return this.filterInputBox.getHistory()}layout(e){this.element.parentElement?.classList.toggle("grow",e>700),this.element.classList.toggle("small",e<400),this.adjustInputBox(),this.lastWidth=e}relayout(){this.lastWidth&&this.layout(this.lastWidth)}checkMoreFilters(e){this.isMoreFiltersChecked=e,this.moreFiltersActionViewItem&&(this.moreFiltersActionViewItem.checked=e)}createInput(e){const t=this.options.history||[],i=this._register(this.instantiationService.createInstance(vH,e,this.contextViewService,{placeholder:this.options.placeholder,ariaLabel:this.options.ariaLabel,history:new Set(t),showHistoryHint:()=>KU(this.keybindingService),inputBoxStyles:JT}));this.options.text&&(i.value=this.options.text),this._register(i.onDidChange(o=>this.delayedFilterUpdate.trigger(()=>this.onDidInputChange(i)))),this._register(No(i.inputElement,pe.KEY_DOWN,o=>this.onInputKeyDown(o,i))),this._register(No(e,pe.KEY_DOWN,this.handleKeyboardEvent)),this._register(No(e,pe.KEY_UP,this.handleKeyboardEvent)),this._register(No(i.inputElement,pe.CLICK,o=>{o.stopPropagation(),o.preventDefault()}));const n=this._register(Fo(i.inputElement));return this.focusContextKey&&(this._register(n.onDidFocus(()=>this.focusContextKey.set(!0))),this._register(n.onDidBlur(()=>this.focusContextKey.set(!1))),this._register(Ie(()=>this.focusContextKey.reset()))),[i,n]}createBadge(e){const t=ee(e,j(".viewpane-filter-badge.hidden"));return t.style.backgroundColor=vt(eN),t.style.color=vt(zz),t.style.border=`1px solid ${vt(tt)}`,t}createToolBar(e){return this.instantiationService.createInstance(Y_,e,sue,{hiddenItemStrategy:Lk.NoHide,actionViewItemProvider:(t,i)=>{if(t instanceof xh&&t.item.submenu.id===mD.id)return this.moreFiltersActionViewItem=this.instantiationService.createInstance(C0e,t,i),this.moreFiltersActionViewItem.checked=this.isMoreFiltersChecked,this.moreFiltersActionViewItem}})}onDidInputChange(e){e.addToHistory(),this._onDidChangeFilterText.fire(e.value)}adjustInputBox(){this.filterInputBox.inputElement.style.paddingRight=this.element.classList.contains("small")||this.filterBadge.classList.contains("hidden")?"25px":"150px"}handleKeyboardEvent(e){(e.equals(S.Space)||e.equals(S.LeftArrow)||e.equals(S.RightArrow)||e.equals(S.Home)||e.equals(S.End))&&e.stopPropagation()}onInputKeyDown(e,t){let i=!1;e.equals(S.Tab)&&!this.toolbar.isEmpty()&&(this.toolbar.focus(),i=!0),i&&(e.stopPropagation(),e.preventDefault())}};jU=f([p(1,Z),p(2,rf),p(3,fe),p(4,He)],jU);var YU;Ve(nue);var ZC;(function(s){s[s.Default=0]="Default",s[s.WhenExpanded=1]="WhenExpanded",s[s.Always=2]="Always"})(ZC||(ZC={}));const jZ=new Xt("viewpane.action.filter"),E0e=Pe("view-pane-container-expanded",K.chevronDown,h(3515,"Icon for an expanded view pane container.")),x0e=Pe("view-pane-container-collapsed",K.chevronRight,h(3516,"Icon for a collapsed view pane container.")),YZ=Ke.as(qp.ViewsRegistry);let QU=class{get enabled(){return this._enabled}constructor(e,t,i,n,o,r){this.container=e,this.delegate=t,this.instantiationService=i,this.openerService=n,this.contextKeyService=o,this.items=[],this._enabled=!1,this.disposables=new U,this.enabledDisposables=this.disposables.add(new U),this.renderDisposables=this.disposables.add(new U),this.disposables.add(T.runAndSubscribe(this.delegate.onDidChangeViewWelcomeState,()=>this.onDidChangeViewWelcomeState())),this.disposables.add(r.onWillShutdown(()=>this.dispose()))}layout(e,t){this._enabled&&(this.element.style.height=`${e}px`,this.element.style.width=`${t}px`,this.element.classList.toggle("wide",t>640),this.scrollableElement.scanDomNode())}focus(){this._enabled&&this.element.focus()}onDidChangeViewWelcomeState(){const e=this.delegate.shouldShowWelcome();if(this._enabled===e)return;if(this._enabled=e,!e){this.enabledDisposables.clear();return}this.container.classList.add("welcome");const t=ee(this.container,j(".welcome-view"));this.element=j(".welcome-view-content",{tabIndex:0}),this.scrollableElement=new oI(this.element,{alwaysConsumeMouseWheel:!0,horizontal:cd.Hidden,vertical:cd.Visible}),ee(t,this.scrollableElement.getDomNode()),this.enabledDisposables.add(Ie(()=>{this.container.classList.remove("welcome"),this.scrollableElement.dispose(),t.remove(),this.scrollableElement=void 0,this.element=void 0})),this.contextKeyService.onDidChangeContext(this.onDidChangeContext,this,this.enabledDisposables),T.chain(YZ.onDidChangeViewWelcomeContent,i=>i.filter(n=>n===this.delegate.id))(this.onDidChangeViewWelcomeContent,this,this.enabledDisposables),this.onDidChangeViewWelcomeContent()}onDidChangeViewWelcomeContent(){const e=YZ.getViewWelcomeContent(this.delegate.id);this.items=[];for(const t of e)if(t.when==="default")this.defaultItem={descriptor:t,visible:!0};else{const i=t.when?this.contextKeyService.contextMatchesRules(t.when):!0;this.items.push({descriptor:t,visible:i})}this.render()}onDidChangeContext(){let e=!1;for(const t of this.items){if(!t.descriptor.when||t.descriptor.when==="default")continue;const i=this.contextKeyService.contextMatchesRules(t.descriptor.when);t.visible!==i&&(t.visible=i,e=!0)}e&&this.render()}render(){this.renderDisposables.clear(),this.element.innerText="";const e=this.getContentDescriptors();if(e.length===0){this.container.classList.remove("welcome"),this.scrollableElement.scanDomNode();return}let t=0;for(const{content:i,precondition:n,renderSecondaryButtons:o}of e){const r=i.split(`
`);for(let a of r){if(a=a.trim(),!a)continue;const c=y_e(a);if(c.nodes.length===1&&typeof c.nodes[0]!="string"){const d=c.nodes[0],l=ee(this.element,j(".button-container")),u=new zu(l,{title:d.title,supportIcons:!0,secondary:!!(o&&t>0),...tA});if(u.label=d.label,u.onDidClick(g=>{this.openerService.open(d.href,{allowCommands:!0})},null,this.renderDisposables),this.renderDisposables.add(u),t++,n){const g=()=>u.enabled=this.contextKeyService.contextMatchesRules(n);g();const m=new Set(n.keys());T.filter(this.contextKeyService.onDidChangeContext,_=>_.affectsSome(m))(g,null,this.renderDisposables)}}else{const d=ee(this.element,j("p"));for(const l of c.nodes)if(typeof l=="string")ee(d,...gf(l));else{const u=this.renderDisposables.add(this.instantiationService.createInstance(kx,d,l,{}));if(n&&l.href.startsWith("command:")){const g=()=>u.enabled=this.contextKeyService.contextMatchesRules(n);g();const m=new Set(n.keys());T.filter(this.contextKeyService.onDidChangeContext,_=>_.affectsSome(m))(g,null,this.renderDisposables)}}}}}this.container.classList.add("welcome"),this.scrollableElement.scanDomNode()}getContentDescriptors(){const e=this.items.filter(t=>t.visible);return e.length===0&&this.defaultItem?[this.defaultItem.descriptor]:e.map(t=>t.descriptor)}dispose(){this.disposables.dispose()}};QU=f([p(2,Z),p(3,mi),p(4,fe),p(5,wd)],QU);let Tx=class extends zP{static{YU=this}static{this.AlwaysShowActionsConfig="workbench.view.alwaysShowHeaderActions"}get title(){return this._title}get titleDescription(){return this._titleDescription}get singleViewPaneContainerTitle(){return this._singleViewPaneContainerTitle}constructor(e,t,i,n,o,r,a,c,d,l,u){super({...e,orientation:r.getViewLocationById(e.id)===We.Panel?St.HORIZONTAL:St.VERTICAL}),this.keybindingService=t,this.contextMenuService=i,this.configurationService=n,this.contextKeyService=o,this.viewDescriptorService=r,this.instantiationService=a,this.openerService=c,this.themeService=d,this.hoverService=l,this.accessibleViewInformationService=u,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new M),this.onDidBlur=this._onDidBlur.event,this._onDidChangeBodyVisibility=this._register(new M),this.onDidChangeBodyVisibility=this._onDidChangeBodyVisibility.event,this._onDidChangeTitleArea=this._register(new M),this.onDidChangeTitleArea=this._onDidChangeTitleArea.event,this._onDidChangeViewWelcomeState=this._register(new M),this.onDidChangeViewWelcomeState=this._onDidChangeViewWelcomeState.event,this._isVisible=!1,this.headerActionViewItems=this._register(new ti),this.id=e.id,this._title=e.title,this._titleDescription=e.titleDescription,this._singleViewPaneContainerTitle=e.singleViewPaneContainerTitle,this.showActions=e.showActions??ZC.Default,this.scopedContextKeyService=this._register(o.createScoped(this.element)),this.scopedContextKeyService.createKey("view",this.id);const g=this.scopedContextKeyService.createKey("viewLocation",Zc(r.getViewLocationById(this.id)));this._register(T.filter(r.onDidChangeLocation,v=>v.views.some(_=>_.id===this.id))(()=>g.set(Zc(r.getViewLocationById(this.id)))));const m=this._register(this.instantiationService.createChild(new uf([fe,this.scopedContextKeyService])));this.menuActions=this._register(m.createInstance(qP,e.titleMenuId??N.ViewTitle,N.ViewTitleContext,{shouldForwardArgs:!e.donotForwardArgs,renderShortTitle:!0})),this._register(this.menuActions.onDidChange(()=>this.updateActions()))}get headerVisible(){return super.headerVisible}set headerVisible(e){super.headerVisible=e,this.element.classList.toggle("merged-header",!e)}setVisible(e){this._isVisible!==e&&(this._isVisible=e,this.isExpanded()&&this._onDidChangeBodyVisibility.fire(e))}isVisible(){return this._isVisible}isBodyVisible(){return this._isVisible&&this.isExpanded()}setExpanded(e){const t=super.setExpanded(e);return t&&this._onDidChangeBodyVisibility.fire(e),this.updateTwistyIcon(),t}render(){super.render();const e=Fo(this.element);this._register(e),this._register(e.onDidFocus(()=>this._onDidFocus.fire())),this._register(e.onDidBlur(()=>this._onDidBlur.fire()))}renderHeader(e){this.headerContainer=e,this.twistiesContainer=ee(e,j(`.twisty-container${ke.asCSSSelector(this.getTwistyIcon(this.isExpanded()))}`)),this.renderHeaderTitle(e,this.title);const t=ee(e,j(".actions"));t.classList.toggle("show-always",this.showActions===ZC.Always),t.classList.toggle("show-expanded",this.showActions===ZC.WhenExpanded),this.toolbar=this.instantiationService.createInstance(nq,t,{orientation:xa.HORIZONTAL,actionViewItemProvider:(o,r)=>{const a=this.createActionViewItem(o,r);return a&&this.headerActionViewItems.set(a.action.id,a),a},ariaLabel:h(3517,"{0} actions",this.title),getKeyBinding:o=>this.keybindingService.lookupKeybinding(o.id),renderDropdownAsChildElement:!0,actionRunner:this.getActionRunner(),resetMenu:this.menuActions.menuId}),this._register(this.toolbar),this.setActions(),this._register(re(t,pe.CLICK,o=>o.preventDefault()));const i=this.viewDescriptorService.getViewContainerByViewId(this.id);i?this._register(this.viewDescriptorService.getViewContainerModel(i).onDidChangeContainerInfo(({title:o})=>this.updateTitle(this.title))):console.error(`View container model not found for view ${this.id}`);const n=T.filter(this.configurationService.onDidChangeConfiguration,o=>o.affectsConfiguration(YU.AlwaysShowActionsConfig));this._register(n(this.updateActionsVisibility,this)),this.updateActionsVisibility()}updateHeader(){super.updateHeader(),this.updateTwistyIcon()}updateTwistyIcon(){this.twistiesContainer&&(this.twistiesContainer.classList.remove(...ke.asClassNameArray(this.getTwistyIcon(!this._expanded))),this.twistiesContainer.classList.add(...ke.asClassNameArray(this.getTwistyIcon(this._expanded))))}getTwistyIcon(e){return e?E0e:x0e}style(e){super.style(e);const t=this.getIcon();if(this.iconContainer){const i=__e(e.headerForeground,vt(Zn));R.isUri(t)?(this.iconContainer.style.backgroundColor=i,this.iconContainer.style.color=""):(this.iconContainer.style.color=i,this.iconContainer.style.backgroundColor="")}}getIcon(){return this.viewDescriptorService.getViewDescriptorById(this.id)?.containerIcon||vAe}renderHeaderTitle(e,t){this.iconContainer=ee(e,j(".icon",void 0));const i=this.getIcon();let n;if(R.isUri(i)){n=`view-${this.id.replace(/[\.\:]/g,"-")}`;const r=`.pane-header .icon.${n}`;OM(r,`
				mask: ${hy(i)} no-repeat 50% 50%;
				mask-size: 24px;
				-webkit-mask: ${hy(i)} no-repeat 50% 50%;
				-webkit-mask-size: 16px;
			`)}else ke.isThemeIcon(i)&&(n=ke.asClassName(i));n&&this.iconContainer.classList.add(...n.split(" "));const o=this.calculateTitle(t);this.titleContainer=ee(e,j("h3.title",{},o)),this.titleContainerHover=this._register(this.hoverService.setupManagedHover(Ir("mouse"),this.titleContainer,o)),this._titleDescription&&this.setTitleDescription(this._titleDescription),this.iconContainerHover=this._register(this.hoverService.setupManagedHover(Ir("mouse"),this.iconContainer,o)),this.iconContainer.setAttribute("aria-label",this._getAriaLabel(o,this._titleDescription))}_getAriaLabel(e,t){const i=this.viewDescriptorService.getViewDescriptorById(this.id)?.accessibilityHelpContent,n=this.accessibleViewInformationService?.hasShownAccessibleView(this.id);return!i||n?t?`${e} - ${t}`:e:h(3518,"Use Alt+F1 for accessibility help {0}",e)}updateTitle(e){const t=this.calculateTitle(e);this.titleContainer&&(this.titleContainer.textContent=t,this.titleContainerHover?.update(t)),this.updateAriaHeaderLabel(t,this._titleDescription),this._title=e,this._onDidChangeTitleArea.fire()}updateAriaHeaderLabel(e,t){const i=this._getAriaLabel(e,t);this.iconContainer&&(this.iconContainerHover?.update(e),this.iconContainer.setAttribute("aria-label",i)),this.ariaHeaderLabel=this.getAriaHeaderLabel(i)}setTitleDescription(e){this.titleDescriptionContainer?(this.titleDescriptionContainer.textContent=e??"",this.titleDescriptionContainerHover?.update(e??"")):e&&this.titleContainer&&(this.titleDescriptionContainer=b_e(this.titleContainer,j("span.description",{},e)),this.titleDescriptionContainerHover=this._register(this.hoverService.setupManagedHover(Ir("mouse"),this.titleDescriptionContainer,e)))}updateTitleDescription(e){this.setTitleDescription(e),this.updateAriaHeaderLabel(this._title,e),this._titleDescription=e,this._onDidChangeTitleArea.fire()}calculateTitle(e){const t=this.viewDescriptorService.getViewContainerByViewId(this.id),i=this.viewDescriptorService.getViewContainerModel(t),n=this.viewDescriptorService.getViewDescriptorById(this.id);return!(this.viewDescriptorService.getDefaultContainerById(this.id)===t)&&n?.containerTitle&&i.title!==n.containerTitle?`${n.containerTitle}: ${e}`:e}renderBody(e){this.viewWelcomeController=this._register(this.instantiationService.createInstance(QU,e,this))}layoutBody(e,t){this.viewWelcomeController.layout(e,t)}onDidScrollRoot(){}getProgressIndicator(){if(this.progressBar===void 0&&(this.progressBar=this._register(new One(this.element,Fne)),this.progressBar.hide()),this.progressIndicator===void 0){const e=this;this.progressIndicator=this._register(new y0e(jt(this.progressBar),new class extends w0e{constructor(){super(e.id,e.isBodyVisible()),this._register(e.onDidChangeBodyVisibility(t=>t?this.onScopeOpened(e.id):this.onScopeClosed(e.id)))}}))}return this.progressIndicator}getProgressLocation(){return this.viewDescriptorService.getViewContainerByViewId(this.id).id}getLocationBasedColors(){return I0e(this.viewDescriptorService.getViewLocationById(this.id))}focus(){this.viewWelcomeController.enabled?this.viewWelcomeController.focus():this.element&&this.element.focus(),(hf(this.element)||qz(this.element))&&this._onDidFocus.fire()}setActions(){if(this.toolbar){const e=[...this.menuActions.getPrimaryActions()];this.shouldShowFilterInHeader()&&e.unshift(jZ),this.toolbar.setActions(eA(e),eA(this.menuActions.getSecondaryActions())),this.toolbar.context=this.getActionsContext()}}updateActionsVisibility(){if(!this.headerContainer)return;const e=this.configurationService.getValue("workbench.view.alwaysShowHeaderActions");this.headerContainer.classList.toggle("actions-always-visible",e)}updateActions(){this.setActions(),this._onDidChangeTitleArea.fire()}createActionViewItem(e,t){if(e.id===jZ.id){const i=this;return new class extends QM{constructor(){super(null,e)}setFocusable(){}get trapsArrowNavigation(){return!0}render(n){n.classList.add("viewpane-filter-container");const o=i.getFilterWidget();ee(n,o.element),o.relayout()}}}return mw(this.instantiationService,e,{...t,menuAsChild:e instanceof xh})}getActionsContext(){}getActionRunner(){}getOptimalWidth(){return 0}saveState(){}shouldShowWelcome(){return!1}getFilterWidget(){}shouldShowFilterInHeader(){return!1}};Tx=YU=f([p(1,He),p(2,bi),p(3,ne),p(4,fe),p(5,$s),p(6,Z),p(7,mi),p(8,pt),p(9,Ti)],Tx);let XU=class extends Tx{constructor(e,t,i,n,o,r,a,c,d,l,u){super(e,t,i,n,o,r,a,c,d,l,u);const g=this._register(a.createChild(new uf([fe,this.scopedContextKeyService])));this.filterWidget=this._register(g.createInstance(jU,e.filterOptions))}getFilterWidget(){return this.filterWidget}renderBody(e){super.renderBody(e),this.filterContainer=ee(e,j(".viewpane-filter-container"))}layoutBody(e,t){super.layoutBody(e,t),this.dimension=new Ye(t,e);const i=!this.filterContainer?.hasChildNodes(),n=this.shouldShowFilterInHeader();i!==n&&(n&&kh(this.filterContainer),this.updateActions(),n||ee(this.filterContainer,this.filterWidget.element)),n||(e=e-44),this.filterWidget.layout(t),this.layoutBodyContent(e,t)}shouldShowFilterInHeader(){return!(this.dimension&&this.dimension.width<600&&this.dimension.height>100)}};XU=f([p(1,He),p(2,bi),p(3,ne),p(4,fe),p(5,$s),p(6,Z),p(7,mi),p(8,pt),p(9,Ti)],XU);function I0e(s){let e,t,i,n,o;switch(s){case We.Panel:e=hre,t=Iq,i=Dxe,n=kxe,o=Txe;break;case We.Sidebar:case We.AuxiliaryBar:default:e=Dq,t=kq,i=Lxe,n=Mxe,o=Nxe}return{background:e,overlayBackground:t,listOverrideStyles:{listBackground:e,treeStickyScrollBackground:i,treeStickyScrollBorder:n,treeStickyScrollShadow:o}}}class p_ extends X{constructor(e){super(e),this.desc=e}run(e,...t){const i=e.get(io).getActiveViewWithId(this.desc.viewId);if(i)return this.runInView(e,i,...t)}}const D0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var jf;const z1={LEFT:"left",FIRST:"first",LAST:"last"};function oue(s){const e=s;return!!(e&&typeof e=="object"&&Array.isArray(e.editors)&&Array.isArray(e.mru))}function k0e(s){const e=s;return e.kind===ct.EDITOR_OPEN&&e.editorIndex!==void 0}function T0e(s){const e=s;return e.kind===ct.EDITOR_MOVE&&e.editorIndex!==void 0&&e.oldEditorIndex!==void 0}function A0e(s){const e=s;return e.kind===ct.EDITOR_CLOSE&&e.editorIndex!==void 0&&e.context!==void 0&&e.sticky!==void 0}let KP=class extends F{static{jf=this}static{this.IDS=0}get id(){return this._id}get active(){return this.selection[0]??null}constructor(e,t,i){super(),this.instantiationService=t,this.configurationService=i,this._onDidModelChange=this._register(new M({leakWarningThreshold:500})),this.onDidModelChange=this._onDidModelChange.event,this.editors=[],this.mru=[],this.editorListeners=new Set,this.locked=!1,this.selection=[],this.preview=null,this.sticky=-1,this.transient=new Set,oue(e)?this._id=this.deserialize(e):this._id=jf.IDS++,this.onConfigurationUpdated(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e)))}onConfigurationUpdated(e){e&&!e.affectsConfiguration("workbench.editor.openPositioning")&&!e.affectsConfiguration("workbench.editor.focusRecentEditorAfterClose")||(this.editorOpenPositioning=this.configurationService.getValue("workbench.editor.openPositioning"),this.focusRecentEditorAfterClose=this.configurationService.getValue("workbench.editor.focusRecentEditorAfterClose"))}get count(){return this.editors.length}get stickyCount(){return this.sticky+1}getEditors(e,t){const i=e===Ii.MOST_RECENTLY_ACTIVE?this.mru.slice(0):this.editors.slice(0);return t?.excludeSticky?e===Ii.MOST_RECENTLY_ACTIVE?i.filter(n=>!this.isSticky(n)):i.slice(this.sticky+1):i}getEditorByIndex(e){return this.editors[e]}get activeEditor(){return this.active}isActive(e){return this.matches(this.active,e)}get previewEditor(){return this.preview}openEditor(e,t){const i=t?.sticky||typeof t?.index=="number"&&this.isSticky(t.index),n=t?.pinned||t?.sticky,o=!!t?.transient,r=t?.active||!this.activeEditor||!n&&this.preview===this.activeEditor,a=this.findEditor(e,t);if(a){const[c,d]=a;return this.doSetTransient(c,d,o===!1?!1:this.isTransient(c)),n&&this.doPin(c,d),this.setSelection(r?c:this.activeEditor,t?.inactiveSelection??[]),t&&typeof t.index=="number"&&this.moveEditor(c,t.index),i&&this.doStick(c,this.indexOf(c)),{editor:c,isNew:!1}}else{const c=e,d=this.indexOf(this.active);let l;if(t&&typeof t.index=="number"?l=t.index:this.editorOpenPositioning===z1.FIRST?(l=0,!i&&this.isSticky(l)&&(l=this.sticky+1)):this.editorOpenPositioning===z1.LAST?l=this.editors.length:(this.editorOpenPositioning===z1.LEFT?d===0||!this.editors.length?l=0:l=d:l=d+1,!i&&this.isSticky(l)&&(l=this.sticky+1)),i&&(this.sticky++,this.isSticky(l)||(l=this.sticky)),(n||!this.preview)&&this.splice(l,!1,c),o&&this.doSetTransient(c,l,!0),!n){if(this.preview){const g=this.indexOf(this.preview);l>g&&l--,this.replaceEditor(this.preview,c,l,!r)}this.preview=c}this.registerEditorListeners(c);const u={kind:ct.EDITOR_OPEN,editor:c,editorIndex:l};return this._onDidModelChange.fire(u),this.setSelection(r?c:this.activeEditor,t?.inactiveSelection??[]),{editor:c,isNew:!0}}}registerEditorListeners(e){const t=new U;this.editorListeners.add(t),t.add(T.once(e.onWillDispose)(()=>{const i=this.editors.indexOf(e);if(i>=0){const n={kind:ct.EDITOR_WILL_DISPOSE,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}})),t.add(e.onDidChangeDirty(()=>{const i={kind:ct.EDITOR_DIRTY,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(e.onDidChangeLabel(()=>{const i={kind:ct.EDITOR_LABEL,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(e.onDidChangeCapabilities(()=>{const i={kind:ct.EDITOR_CAPABILITIES,editor:e,editorIndex:this.editors.indexOf(e)};this._onDidModelChange.fire(i)})),t.add(this.onDidModelChange(i=>{i.kind===ct.EDITOR_CLOSE&&i.editor?.matches(e)&&(Xe(t),this.editorListeners.delete(t))}))}replaceEditor(e,t,i,n=!0){const o=this.doCloseEditor(e,jd.REPLACE,n);if(this.splice(i,!1,t),o){const r={kind:ct.EDITOR_CLOSE,...o};this._onDidModelChange.fire(r)}}closeEditor(e,t=jd.UNKNOWN,i=!0){const n=this.doCloseEditor(e,t,i);if(n){const o={kind:ct.EDITOR_CLOSE,...n};return this._onDidModelChange.fire(o),n}}doCloseEditor(e,t,i){const n=this.indexOf(e);if(n===-1)return;const o=this.editors[n],r=this.isSticky(n),a=this.active===o;if(i&&a)if(this.mru.length>1){let c;this.focusRecentEditorAfterClose?c=this.mru[1]:n===this.editors.length-1?c=this.editors[n-1]:c=this.editors[n+1];const d=this.selection.filter(l=>l!==o&&l!==c);this.doSetSelection(c,this.editors.indexOf(c),d)}else this.doSetSelection(null,void 0,[]);else if(!a&&this.doIsSelected(o)){const c=this.selection.filter(d=>d!==o&&d!==this.activeEditor);this.doSetSelection(this.activeEditor,this.indexOf(this.activeEditor),c)}return this.preview===o&&(this.preview=null),this.transient.delete(o),this.splice(n,!0),{editor:o,sticky:r,editorIndex:n,context:t}}moveEditor(e,t){t>=this.editors.length?t=this.editors.length-1:t<0&&(t=0);const i=this.indexOf(e);if(i<0||t===i)return;const n=this.editors[i],o=this.sticky;this.isSticky(i)&&t>this.sticky?this.sticky--:!this.isSticky(i)&&t<=this.sticky&&this.sticky++,this.editors.splice(i,1),this.editors.splice(t,0,n);const r={kind:ct.EDITOR_MOVE,editor:n,oldEditorIndex:i,editorIndex:t};if(this._onDidModelChange.fire(r),o!==this.sticky){const a={kind:ct.EDITOR_STICKY,editor:n,editorIndex:t};this._onDidModelChange.fire(a)}return n}setActive(e){let t;return e?t=this.setEditorActive(e):this.setGroupActive(),t}setGroupActive(){this._onDidModelChange.fire({kind:ct.GROUP_ACTIVE})}setEditorActive(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doSetSelection(i,n,[]),i}get selectedEditors(){return this.editors.filter(e=>this.doIsSelected(e))}isSelected(e){let t;return typeof e=="number"?t=this.editors[e]:t=this.findEditor(e)?.[0],!!t&&this.doIsSelected(t)}doIsSelected(e){return this.selection.includes(e)}setSelection(e,t){const i=this.findEditor(e);if(!i)return;const[n,o]=i,r=new Set;for(const a of t){const c=this.findEditor(a);if(!c)return;const[d]=c;d!==n&&r.add(d)}this.doSetSelection(n,o,Array.from(r))}doSetSelection(e,t,i){const n=this.activeEditor,o=this.selection;let r;e?r=[e,...i]:r=[],this.selection=r;const a=e&&typeof t=="number"&&n!==e;if(a){const c=this.indexOf(e,this.mru);this.mru.splice(c,1),this.mru.unshift(e);const d={kind:ct.EDITOR_ACTIVE,editor:e,editorIndex:t};this._onDidModelChange.fire(d)}if(a||o.length!==r.length||o.some(c=>!r.includes(c))){const c={kind:ct.EDITORS_SELECTION};this._onDidModelChange.fire(c)}}setIndex(e){this._onDidModelChange.fire({kind:ct.GROUP_INDEX})}setLabel(e){this._onDidModelChange.fire({kind:ct.GROUP_LABEL})}pin(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doPin(i,n),i}doPin(e,t){if(this.isPinned(e))return;this.setTransient(e,!1),this.preview=null;const i={kind:ct.EDITOR_PIN,editor:e,editorIndex:t};this._onDidModelChange.fire(i)}unpin(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doUnpin(i,n),i}doUnpin(e,t){if(!this.isPinned(e))return;const i=this.preview;this.preview=e;const n={kind:ct.EDITOR_PIN,editor:e,editorIndex:t};this._onDidModelChange.fire(n),i&&this.closeEditor(i,jd.UNPIN)}isPinned(e){let t;return typeof e=="number"?t=this.editors[e]:t=e,!this.matches(this.preview,t)}stick(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doStick(i,n),i}doStick(e,t){if(this.isSticky(t))return;this.pin(e);const i=this.sticky+1;this.moveEditor(e,i),this.sticky++;const n={kind:ct.EDITOR_STICKY,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}unstick(e){const t=this.findEditor(e);if(!t)return;const[i,n]=t;return this.doUnstick(i,n),i}doUnstick(e,t){if(!this.isSticky(t))return;const i=this.sticky;this.moveEditor(e,i),this.sticky--;const n={kind:ct.EDITOR_STICKY,editor:e,editorIndex:i};this._onDidModelChange.fire(n)}isSticky(e){if(this.sticky<0)return!1;let t;return typeof e=="number"?t=e:t=this.indexOf(e),t<0?!1:t<=this.sticky}setTransient(e,t){if(!t&&this.transient.size===0)return;const i=this.findEditor(e);if(!i)return;const[n,o]=i;return this.doSetTransient(n,o,t),n}doSetTransient(e,t,i){if(i){if(this.transient.has(e))return;this.transient.add(e)}else{if(!this.transient.has(e))return;this.transient.delete(e)}const n={kind:ct.EDITOR_TRANSIENT,editor:e,editorIndex:t};this._onDidModelChange.fire(n)}isTransient(e){if(this.transient.size===0)return!1;let t;return typeof e=="number"?t=this.editors[e]:t=this.findEditor(e)?.[0],!!t&&this.transient.has(t)}splice(e,t,i){const n=this.editors[e];if(t&&this.isSticky(e)&&this.sticky--,i?this.editors.splice(e,t?1:0,i):this.editors.splice(e,t?1:0),!t&&i)this.mru.length===0?this.mru.push(i):this.mru.splice(1,0,i);else{const o=this.indexOf(n,this.mru);t&&!i?this.mru.splice(o,1):t&&i&&this.mru.splice(o,1,i)}}indexOf(e,t=this.editors,i){let n=-1;if(!e)return n;for(let o=0;o<t.length;o++){const r=t[o];if(this.matches(r,e,i))if(i?.supportSideBySide&&r instanceof ks&&!(e instanceof ks))n=o;else{n=o;break}}return n}findEditor(e,t){const i=this.indexOf(e,this.editors,t);if(i!==-1)return[this.editors[i],i]}isFirst(e,t=this.editors){return this.matches(t[0],e)}isLast(e,t=this.editors){return this.matches(t[t.length-1],e)}contains(e,t){return this.indexOf(e,this.editors,t)!==-1}matches(e,t,i){if(!e||!t)return!1;if(i?.supportSideBySide&&e instanceof ks&&!(t instanceof ks))switch(i.supportSideBySide){case qt.ANY:if(this.matches(e.primary,t,i)||this.matches(e.secondary,t,i))return!0;break;case qt.BOTH:if(this.matches(e.primary,t,i)&&this.matches(e.secondary,t,i))return!0;break}const n=e===t;return i?.strictEquals?n:n||e.matches(t)}get isLocked(){return this.locked}lock(e){this.isLocked!==e&&(this.locked=e,this._onDidModelChange.fire({kind:ct.GROUP_LOCKED}))}clone(){const e=this.instantiationService.createInstance(jf,void 0);e.editors=this.editors.slice(0),e.mru=this.mru.slice(0),e.preview=this.preview,e.selection=this.selection.slice(0),e.sticky=this.sticky;for(const t of e.editors)e.registerEditorListeners(t);return e}serialize(){const e=Ke.as(iv.EditorFactory),t=[],i=[];let n,o=this.sticky;for(let a=0;a<this.editors.length;a++){const c=this.editors[a];let d=!1;const l=e.getEditorSerializer(c);if(l){const u=l.canSerialize(c)?l.serialize(c):void 0;typeof u=="string"?(d=!0,i.push({id:c.typeId,value:u}),t.push(c),this.preview===c&&(n=t.length-1)):d=!1}!d&&this.isSticky(a)&&o--}const r=this.mru.map(a=>this.indexOf(a,t)).filter(a=>a>=0);return{id:this.id,locked:this.locked?!0:void 0,editors:i,mru:r,preview:n,sticky:o>=0?o:void 0}}deserialize(e){const t=Ke.as(iv.EditorFactory);return typeof e.id=="number"?(this._id=e.id,jf.IDS=Math.max(e.id+1,jf.IDS)):this._id=jf.IDS++,e.locked&&(this.locked=!0),this.editors=$t(e.editors.map((i,n)=>{let o;const r=t.getEditorSerializer(i.id);if(r){const a=r.deserialize(this.instantiationService,i.value);a instanceof dl&&(o=a,this.registerEditorListeners(o))}return!o&&typeof e.sticky=="number"&&n<=e.sticky&&e.sticky--,o})),this.mru=$t(e.mru.map(i=>this.editors[i])),this.selection=this.mru.length>0?[this.mru[0]]:[],typeof e.preview=="number"&&(this.preview=this.editors[e.preview]),typeof e.sticky=="number"&&(this.sticky=e.sticky),this._id}dispose(){Xe(Array.from(this.editorListeners)),this.editorListeners.clear(),this.transient.clear(),super.dispose()}};KP=jf=f([p(1,Z),p(2,ne)],KP);const R0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class P0e{constructor(e){this._container=e}set text(e){kh(this._container,...gf(e??""))}set title(e){!this.hover&&e?this.hover=Kz().setupManagedHover(Ir("mouse"),this._container,e):this.hover&&this.hover.update(e)}dispose(){this.hover?.dispose()}}var ZU,eC,dT;Ve(R0e);let jP=class extends Mu{static{ZU=this}static{this.PLACEHOLDER_LABEL_MAX_LENGTH=1024}constructor(e,t,i,n,o){super(e,t,i,n,o),this.inputDisposable=this._register(new Pt)}createEditor(e){this.container=j(".monaco-editor-pane-placeholder",{tabIndex:0}),this.container.style.outline="none",this.scrollbar=this._register(new oI(this.container,{horizontal:cd.Auto,vertical:cd.Auto})),e.appendChild(this.scrollbar.getDomNode())}async setInput(e,t,i,n){await super.setInput(e,t,i,n),!n.isCancellationRequested&&(this.inputDisposable.value=await this.renderInput(e,t))}async renderInput(e,t){const[i,n]=lm(this.container,this.scrollbar);Xi(i);const o=new U,{icon:r,label:a,actions:c}=await this.getContents(e,t,o),d=w_e(a,ZU.PLACEHOLDER_LABEL_MAX_LENGTH),l=i.appendChild(j(".editor-placeholder-icon-container")),u=o.add(new P0e(l));u.text=r;const g=i.appendChild(j(".editor-placeholder-label-container")),m=j("span");if(m.textContent=d,g.appendChild(m),i.setAttribute("aria-label",`${M4(e,void 0,this.group,void 0)}, ${d}`),c.length){const v=i.appendChild(j(".editor-placeholder-buttons-container")),_=o.add(new Ene(v));for(let w=0;w<c.length;w++){const C=o.add(_.addButton({...tA,secondary:w!==0}));C.label=c[w].label,o.add(C.onDidClick(k=>{k&&Vi.stop(k,!0),c[w].run()}))}}return n.scanDomNode(),o}clearInput(){this.container&&Xi(this.container),this.inputDisposable.clear(),super.clearInput()}layout(e){const[t,i]=lm(this.container,this.scrollbar);Nz(t,e.width,e.height),i.scanDomNode(),t.classList.toggle("max-height-200px",e.height<=200)}focus(){super.focus(),this.container?.focus()}dispose(){this.container?.remove(),super.dispose()}};jP=ZU=f([p(2,ai),p(3,pt),p(4,it)],jP);let JU=class extends jP{static{eC=this}static{this.ID="workbench.editors.workspaceTrustRequiredEditor"}static{this.LABEL=h(3250,"Workspace Trust Required")}static{this.DESCRIPTOR=sp.create(eC,this.ID,this.LABEL)}constructor(e,t,i,n,o,r){super(eC.ID,e,t,i,r),this.commandService=n,this.workspaceService=o}getTitle(){return eC.LABEL}async getContents(){return{icon:"$(workspace-untrusted)",label:IE(hC(this.workspaceService.getWorkspace()))?h(3251,"The file is not displayed in the editor because trust has not been granted to the folder."):h(3252,"The file is not displayed in the editor because trust has not been granted to the workspace."),actions:[{label:h(3253,"Manage Workspace Trust"),run:()=>this.commandService.executeCommand("workbench.trust.manage")}]}}};JU=eC=f([p(1,ai),p(2,pt),p(3,Ge),p(4,It),p(5,it)],JU);let e2=class extends jP{static{dT=this}static{this.ID="workbench.editors.errorEditor"}static{this.LABEL=h(3254,"Error Editor")}static{this.DESCRIPTOR=sp.create(dT,this.ID,this.LABEL)}constructor(e,t,i,n,o,r){super(dT.ID,e,t,i,n),this.fileService=o,this.dialogService=r}async getContents(e,t,i){const n=e.resource,o=t.error,r=o?.fileOperationResult===Kn.FILE_NOT_FOUND;let a;r?a=h(3255,"The editor could not be opened because the file was not found."):EC(o)&&o.forceMessage?a=o.message:o?a=h(3256,"The editor could not be opened due to an unexpected error. Please consult the log for more details."):a=h(3257,"The editor could not be opened due to an unexpected error.");let c="$(error)";EC(o)&&(o.forceSeverity===Fe.Info?c="$(info)":o.forceSeverity===Fe.Warning&&(c="$(warning)"));let d;return EC(o)&&o.actions.length>0?d=o.actions.map(l=>({label:l.label,run:()=>{const u=l.run();u instanceof Promise&&u.catch(g=>this.dialogService.error(bo(g)))}})):d=[{label:h(3258,"Try Again"),run:()=>this.group.openEditor(e,{...t,source:tN.USER})}],r&&n&&this.fileService.hasProvider(n)&&i.add(this.fileService.onDidFilesChange(l=>{l.contains(n,ph.ADDED,ph.UPDATED)&&this.group.openEditor(e,t)})),{icon:c,label:a,actions:d??[]}}};e2=dT=f([p(1,ai),p(2,pt),p(3,it),p(4,je),p(5,ei)],e2);let t2=class extends F{get minimumWidth(){return this._activeEditorPane?.minimumWidth??cp.width}get minimumHeight(){return this._activeEditorPane?.minimumHeight??cp.height}get maximumWidth(){return this._activeEditorPane?.maximumWidth??OA.width}get maximumHeight(){return this._activeEditorPane?.maximumHeight??OA.height}get activeEditorPane(){return this._activeEditorPane}constructor(e,t,i,n,o,r,a,c,d,l){super(),this.editorGroupParent=e,this.editorPanesParent=t,this.groupView=i,this.layoutService=n,this.instantiationService=o,this.workspaceTrustService=a,this.logService=c,this.dialogService=d,this.hostService=l,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onDidChangeSizeConstraints=this._register(new M),this.onDidChangeSizeConstraints=this._onDidChangeSizeConstraints.event,this._activeEditorPane=null,this.editorPanes=[],this.mapEditorPaneToPendingSetInput=new Map,this.activeEditorPaneDisposables=this._register(new U),this.editorPanesRegistry=Ke.as(iv.EditorPane),this.editorOperation=this._register(new S_e(r)),this.registerListeners()}registerListeners(){this._register(this.workspaceTrustService.onDidChangeTrust(()=>this.onDidChangeWorkspaceTrust()))}onDidChangeWorkspaceTrust(){const e=this._activeEditorPane?.input,t=this._activeEditorPane?.options;e?.hasCapability(Je.RequiresTrust)&&this.groupView.openEditor(e,t)}async openEditor(e,t,i,n=Object.create(null)){try{return await this.doOpenEditor(this.getEditorPaneDescriptor(e),e,t,i,n)}catch(o){return t?.ignoreError?{error:o}:this.doShowError(o,e,t,i,n)}}async doShowError(e,t,i,n,o){this.logService.error(e);let r=!1;if(i?.source===tN.USER&&(!EC(e)||e.allowDialog)&&(r=await this.doShowErrorDialog(e,t)),r)return{error:e};const a={...i};return ys(e)||(a.error=e),{...await this.doOpenEditor(e2.DESCRIPTOR,t,a,n,o),error:e}}async doShowErrorDialog(e,t){let i=Fe.Error,n,o=bo(e),r;EC(e)&&(r=e.actions,i=e.forceSeverity??Fe.Error,e.forceMessage&&(n=e.message,o=void 0)),n||(n=h(3247,"Unable to open '{0}'",t.getName()));const a=[];if(r&&r.length>0)for(const u of r)a.push({label:u.label,run:()=>u});else a.push({label:h(3248,"&&OK"),run:()=>{}});let c;a.length===1&&(c={run:()=>{d=!0}});let d=!1;const{result:l}=await this.dialogService.prompt({type:i,message:n,detail:o,buttons:a,cancelButton:c});if(l){const u=l.run();u instanceof Promise&&u.catch(g=>this.dialogService.error(bo(g))),d=!0}return d}async doOpenEditor(e,t,i,n,o=Object.create(null)){const r=this.doShowEditorPane(e),a=wh(),{changed:c,cancelled:d}=await this.doSetInput(r,t,i,o);return d||((!i||!i.preserveFocus)&&this.shouldRestoreFocus(a)?r.focus():n?.preserveWindowOrder||this.hostService.moveTop(Vz(this.groupView.windowId,!0).window)),{pane:r,changed:c,cancelled:d}}shouldRestoreFocus(e){if(!this.layoutService.isRestored()||!e)return!0;const t=wh();return!!(!t||t===e.ownerDocument.body||e===t||!Wne(t)||Hu(t,this.editorGroupParent))}getEditorPaneDescriptor(e){return e.hasCapability(Je.RequiresTrust)&&!this.workspaceTrustService.isWorkspaceTrusted()?JU.DESCRIPTOR:jt(this.editorPanesRegistry.getEditorPane(e))}doShowEditorPane(e){if(this._activeEditorPane&&e.describes(this._activeEditorPane))return this._activeEditorPane;this.doHideActiveEditorPane();const t=this.doCreateEditorPane(e);this.doSetActiveEditorPane(t);const i=jt(t.getContainer());return this.editorPanesParent.appendChild(i),Qo(i),t.setVisible(!0),this.pagePosition&&t.layout(new Ye(this.pagePosition.width,this.pagePosition.height),{top:this.pagePosition.top,left:this.pagePosition.left}),this.boundarySashes&&t.setBoundarySashes(this.boundarySashes),t}doCreateEditorPane(e){const t=this.doInstantiateEditorPane(e);if(!t.getContainer()){const i=j(".editor-instance");this.editorPanesParent.appendChild(i);try{t.create(i)}catch(n){throw i.remove(),Qs(i),n}}return t}doInstantiateEditorPane(e){const t=this.editorPanes.find(n=>e.describes(n));if(t)return t;const i=this._register(e.instantiate(this.instantiationService,this.groupView));return this.editorPanes.push(i),i}doSetActiveEditorPane(e){this._activeEditorPane=e,this.activeEditorPaneDisposables.clear(),e&&(this.activeEditorPaneDisposables.add(e.onDidChangeSizeConstraints(t=>this._onDidChangeSizeConstraints.fire(t))),this.activeEditorPaneDisposables.add(e.onDidFocus(()=>this._onDidFocus.fire()))),this._onDidChangeSizeConstraints.fire(void 0)}async doSetInput(e,t,i,n){let o=e.input?.matches(t);if(o&&!i?.forceReload)return this.mapEditorPaneToPendingSetInput.has(e)&&await this.mapEditorPaneToPendingSetInput.get(e),o=e.input?.matches(t),o&&e.setOptions(i),{changed:!1,cancelled:!o};const r=this.editorOperation.start(this.layoutService.isRestored()?800:3200);let a=!1;try{e.clearInput();const c=e.setInput(t,i,n,r.token);this.mapEditorPaneToPendingSetInput.set(e,c),await c,r.isCurrent()||(a=!0)}catch(c){if(!r.isCurrent())a=!0;else throw c}finally{r.isCurrent()&&this.mapEditorPaneToPendingSetInput.delete(e),r.stop()}return{changed:!o,cancelled:a}}doHideActiveEditorPane(){if(!this._activeEditorPane)return;this.editorOperation.stop(),this.safeRun(()=>this._activeEditorPane?.clearInput()),this.safeRun(()=>this._activeEditorPane?.setVisible(!1)),this.mapEditorPaneToPendingSetInput.delete(this._activeEditorPane);const e=this._activeEditorPane.getContainer();e&&(e.remove(),Qs(e)),this.doSetActiveEditorPane(null)}closeEditor(e){this._activeEditorPane?.input&&e.matches(this._activeEditorPane.input)&&this.doHideActiveEditorPane()}setVisible(e){this.safeRun(()=>this._activeEditorPane?.setVisible(e))}layout(e){this.pagePosition=e,this.safeRun(()=>this._activeEditorPane?.layout(new Ye(e.width,e.height),e))}setBoundarySashes(e){this.boundarySashes=e,this.safeRun(()=>this._activeEditorPane?.setBoundarySashes(e))}safeRun(e){try{e()}catch(t){this.logService.error(t)}}};t2=f([p(3,yi),p(4,Z),p(5,Uu),p(6,Lv),p(7,Re),p(8,ei),p(9,Hn)],t2);var lT;const rue={text:h(3234,"Show All Commands"),id:"workbench.action.showCommands"},L0e={text:h(3235,"Go to File"),id:"workbench.action.quickOpen"},M0e={text:h(3236,"Open File"),id:"workbench.action.files.openFile"},N0e={text:h(3237,"Open Folder"),id:"workbench.action.files.openFolder"},O0e={text:h(3238,"Open File or Folder"),id:"workbench.action.files.openFileFolder"},F0e={text:h(3239,"Open Recent"),id:"workbench.action.openRecent"},W0e={text:h(3240,"New Untitled Text File"),id:"workbench.action.files.newUntitledFile"},B0e={text:h(3241,"Find in Files"),id:"workbench.action.findInFiles"},V0e={text:h(3242,"Toggle Terminal"),id:"workbench.action.terminal.toggleTerminal",when:{web:x.equals("terminalProcessSupported",!0)}},H0e={text:h(3243,"Start Debugging"),id:"workbench.action.debug.start",when:{web:x.equals("terminalProcessSupported",!0)}},U0e={text:h(3244,"Open Settings"),id:"workbench.action.openSettings"},QZ=x.and(x.equals("chatSetupHidden",!1),x.equals("chatSetupDisabled",!1)),aue={text:h(3245,"Open Chat"),id:"workbench.action.chat.open",when:{native:QZ,web:QZ}},XZ=$t([rue,...Yt&&!Kt?[O0e]:[M0e,N0e],F0e,Yt&&!Kt?W0e:void 0,aue]),ZZ=[],JZ=[rue,L0e,aue],eJ=[B0e,H0e,V0e,U0e];let i2=class extends F{static{lT=this}static{this.CACHED_WHEN="editorGroupWatermark.whenConditions"}constructor(e,t,i,n,o,r){super(),this.keybindingService=t,this.contextService=i,this.contextKeyService=n,this.configurationService=o,this.storageService=r,this.transientDisposables=this._register(new U),this.keybindingLabels=this._register(new U),this.enabled=!1,this.cachedWhen=this.storageService.getObject(lT.CACHED_WHEN,he.PROFILE,Object.create(null)),this.workbenchState=this.contextService.getWorkbenchState();const a=en(".editor-group-watermark",[en(".letterpress"),en(".shortcuts@shortcuts")]);ee(e,a.root),this.shortcuts=a.shortcuts,this.registerListeners(),this.render()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("workbench.tips.enabled")&&this.enabled!==this.configurationService.getValue("workbench.tips.enabled")&&this.render()})),this._register(this.contextService.onDidChangeWorkbenchState(e=>{this.workbenchState!==e&&(this.workbenchState=e,this.render())})),this._register(this.storageService.onWillSaveState(e=>{if(e.reason===Jx.SHUTDOWN){const t=[...XZ,...ZZ,...JZ,...eJ];for(const i of t){const n=Kt?i.when?.web:i.when?.native;n&&(this.cachedWhen[i.id]=this.contextKeyService.contextMatchesRules(n))}this.storageService.store(lT.CACHED_WHEN,JSON.stringify(this.cachedWhen),he.PROFILE,gt.MACHINE)}}))}render(){if(this.enabled=this.configurationService.getValue("workbench.tips.enabled"),Xi(this.shortcuts),this.transientDisposables.clear(),!this.enabled)return;const e=this.filterEntries(this.workbenchState!==Zo.EMPTY?JZ:XZ,!1),t=this.filterEntries(this.workbenchState!==Zo.EMPTY?eJ:ZZ,!0).slice(0,Math.max(0,5-e.length)),i=[...e,...t],n=ee(this.shortcuts,j(".watermark-box")),o=()=>{Xi(n),this.keybindingLabels.clear();for(const r of i){const a=this.keybindingService.lookupKeybinding(r.id);if(!a)continue;const c=ee(n,j("dl")),d=ee(c,j("dt"));d.textContent=r.text;const l=ee(c,j("dd"));this.keybindingLabels.add(new VM(l,$u,{renderUnboundKeybindings:!0,...Bne})).set(a)}};o(),this.transientDisposables.add(this.keybindingService.onDidUpdateKeybindings(o))}filterEntries(e,t){const i=e.filter(n=>Kt&&!n.when?.web||!Kt&&!n.when?.native||this.cachedWhen[n.id]).filter(n=>!!Ee.getCommand(n.id)).filter(n=>!!this.keybindingService.lookupKeybinding(n.id));return t&&C_e(i),i}};i2=lT=f([p(1,He),p(2,It),p(3,fe),p(4,ne),p(5,it)],i2);H("editorWatermark.foreground",{dark:et(po,.6),light:et(po,.68),hcDark:po,hcLight:po},h(3246,"Foreground color for the labels in the editor watermark."));const $0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),G0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(G0e);class G4{}class z0e{constructor(e,t,i,n){this._disposables=new U,this._onDidSelectItem=new M,this._onDidFocusItem=new M,this._onDidChangeFocus=new M,this.onDidSelectItem=this._onDidSelectItem.event,this.onDidFocusItem=this._onDidFocusItem.event,this.onDidChangeFocus=this._onDidChangeFocus.event,this._items=new Array,this._nodes=new Array,this._freeNodes=new Array,this._enabled=!0,this._focusedItemIdx=-1,this._selectedItemIdx=-1,this._domNode=document.createElement("div"),this._domNode.className="monaco-breadcrumbs",this._domNode.tabIndex=0,this._domNode.setAttribute("role","list"),this._scrollable=new oI(this._domNode,{vertical:cd.Hidden,horizontal:cd.Auto,horizontalScrollbarSize:t,useShadows:!1,scrollYToX:!0}),this._separatorIcon=i,this._disposables.add(this._scrollable),this._disposables.add(No(this._domNode,"click",a=>this._onClick(a))),e.appendChild(this._scrollable.getDomNode());const o=iN(this._domNode);this._style(o,n);const r=Fo(this._domNode);this._disposables.add(r),this._disposables.add(r.onDidBlur(a=>this._onDidChangeFocus.fire(!1))),this._disposables.add(r.onDidFocus(a=>this._onDidChangeFocus.fire(!0)))}setHorizontalScrollbarSize(e){this._scrollable.updateOptions({horizontalScrollbarSize:e})}dispose(){this._disposables.dispose(),this._pendingLayout?.dispose(),this._pendingDimLayout?.dispose(),this._onDidSelectItem.dispose(),this._onDidFocusItem.dispose(),this._onDidChangeFocus.dispose(),this._domNode.remove(),this._nodes.length=0,this._freeNodes.length=0}layout(e){e&&Ye.equals(e,this._dimension)||(e?(this._pendingDimLayout?.dispose(),this._pendingDimLayout=this._updateDimensions(e)):(this._pendingLayout?.dispose(),this._pendingLayout=this._updateScrollbar()))}_updateDimensions(e){const t=new U;return t.add(E_e(Et(this._domNode),()=>{this._dimension=e,this._domNode.style.width=`${e.width}px`,this._domNode.style.height=`${e.height}px`,t.add(this._updateScrollbar())})),t}_updateScrollbar(){return j6(Et(this._domNode),()=>{j6(Et(this._domNode),()=>{this._scrollable.setRevealOnScroll(!1),this._scrollable.scanDomNode(),this._scrollable.setRevealOnScroll(!0)})})}_style(e,t){let i="";t.breadcrumbsBackground&&(i+=`.monaco-breadcrumbs { background-color: ${t.breadcrumbsBackground}}`),t.breadcrumbsForeground&&(i+=`.monaco-breadcrumbs .monaco-breadcrumb-item { color: ${t.breadcrumbsForeground}}
`),t.breadcrumbsFocusForeground&&(i+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused { color: ${t.breadcrumbsFocusForeground}}
`),t.breadcrumbsFocusAndSelectionForeground&&(i+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused.selected { color: ${t.breadcrumbsFocusAndSelectionForeground}}
`),t.breadcrumbsHoverForeground&&(i+=`.monaco-breadcrumbs:not(.disabled	) .monaco-breadcrumb-item:hover:not(.focused):not(.selected) { color: ${t.breadcrumbsHoverForeground}}
`),e.innerText=i}setEnabled(e){this._enabled=e,this._domNode.classList.toggle("disabled",!this._enabled)}domFocus(){const e=this._focusedItemIdx>=0?this._focusedItemIdx:this._items.length-1;e>=0&&e<this._items.length?this._focus(e,void 0):this._domNode.focus()}isDOMFocused(){return qz(this._domNode)}getFocused(){return this._items[this._focusedItemIdx]}setFocused(e,t){this._focus(this._items.indexOf(e),t)}focusPrev(e){this._focusedItemIdx>0&&this._focus(this._focusedItemIdx-1,e)}focusNext(e){this._focusedItemIdx+1<this._nodes.length&&this._focus(this._focusedItemIdx+1,e)}_focus(e,t){this._focusedItemIdx=-1;for(let i=0;i<this._nodes.length;i++){const n=this._nodes[i];i!==e?n.classList.remove("focused"):(this._focusedItemIdx=i,n.classList.add("focused"),n.focus())}this._reveal(this._focusedItemIdx,!0),this._onDidFocusItem.fire({type:"focus",item:this._items[this._focusedItemIdx],node:this._nodes[this._focusedItemIdx],payload:t})}reveal(e){const t=this._items.indexOf(e);t>=0&&this._reveal(t,!1)}revealLast(){this._reveal(this._items.length-1,!1)}_reveal(e,t){if(e<0||e>=this._nodes.length)return;const i=this._nodes[e];if(!i)return;const{width:n}=this._scrollable.getScrollDimensions(),{scrollLeft:o}=this._scrollable.getScrollPosition();(!t||i.offsetLeft>o+n||i.offsetLeft<o)&&(this._scrollable.setRevealOnScroll(!1),this._scrollable.setScrollPosition({scrollLeft:i.offsetLeft}),this._scrollable.setRevealOnScroll(!0))}getSelection(){return this._items[this._selectedItemIdx]}setSelection(e,t){this._select(this._items.indexOf(e),t)}_select(e,t){this._selectedItemIdx=-1;for(let i=0;i<this._nodes.length;i++){const n=this._nodes[i];i!==e?n.classList.remove("selected"):(this._selectedItemIdx=i,n.classList.add("selected"))}this._onDidSelectItem.fire({type:"select",item:this._items[this._selectedItemIdx],node:this._nodes[this._selectedItemIdx],payload:t})}getItems(){return this._items}setItems(e){let t,i=[];try{t=x_e(this._items,e,(n,o)=>n.equals(o)),i=this._items.splice(t,this._items.length-t,...e.slice(t)),this._render(t),Xe(i),Xe(e.slice(0,t)),this._focus(-1,void 0)}catch(n){const o=new Error(`BreadcrumbsItem#setItems: newItems: ${e.length}, prefix: ${t}, removed: ${i.length}`);throw o.name=n.name,o.stack=n.stack,o}}_render(e){let t=!1;for(;e<this._items.length&&e<this._nodes.length;e++){const i=this._items[e],n=this._nodes[e];this._renderItem(i,n),t=!0}for(;e<this._nodes.length;){const i=this._nodes.pop();i&&(this._freeNodes.push(i),i.remove(),t=!0)}for(;e<this._items.length;e++){const i=this._items[e],n=this._freeNodes.length>0?this._freeNodes.pop():document.createElement("div");n&&(this._renderItem(i,n),this._domNode.appendChild(n),this._nodes.push(n),t=!0)}t&&this.layout(void 0)}_renderItem(e,t){Xi(t),t.className="";try{e.render(t)}catch(n){t.innerText="<<RENDER ERROR>>",console.error(n)}t.tabIndex=-1,t.setAttribute("role","listitem"),t.classList.add("monaco-breadcrumb-item");const i=j(ke.asCSSSelector(this._separatorIcon));t.appendChild(i)}_onClick(e){if(this._enabled)for(let t=e.target;t;t=t.parentElement){const i=this._nodes.indexOf(t);if(i>=0){this._focus(i,e),this._select(i,e);break}}}}class SXe{constructor(){this._map=new Map}register(e,t){if(this._map.has(e))throw new Error(`group (${e}) has already a widget`);return this._map.set(e,t),{dispose:()=>this._map.delete(e)}}getWidget(e){return this._map.get(e)}}class co{constructor(){}static{this.IsEnabled=co._stub("breadcrumbs.enabled")}static{this.UseQuickPick=co._stub("breadcrumbs.useQuickPick")}static{this.FilePath=co._stub("breadcrumbs.filePath")}static{this.SymbolPath=co._stub("breadcrumbs.symbolPath")}static{this.SymbolSortOrder=co._stub("breadcrumbs.symbolSortOrder")}static{this.Icons=co._stub("breadcrumbs.icons")}static{this.TitleScrollbarSizing=co._stub("workbench.editor.titleScrollbarSizing")}static{this.FileExcludes=co._stub("files.exclude")}static _stub(e){return{bindTo(t){const i=new M,n=t.onDidChangeConfiguration(o=>{o.affectsConfiguration(e)&&i.fire(void 0)});return new class{constructor(){this.name=e,this.onDidChange=i.event}getValue(o){return o?t.getValue(e,o):t.getValue(e)}updateValue(o,r){return r?t.updateValue(e,o,r):t.updateValue(e,o)}dispose(){n.dispose(),i.dispose()}}}}}}Ke.as(Js.Configuration).registerConfiguration({id:"breadcrumbs",title:h(2888,"Breadcrumb Navigation"),order:101,type:"object",properties:{"breadcrumbs.enabled":{description:h(2889,"Enable/disable navigation breadcrumbs."),type:"boolean",default:!0},"breadcrumbs.filePath":{description:h(2890,"Controls whether and how file paths are shown in the breadcrumbs view."),type:"string",default:"on",enum:["on","off","last"],enumDescriptions:[h(2891,"Show the file path in the breadcrumbs view."),h(2892,"Do not show the file path in the breadcrumbs view."),h(2893,"Only show the last element of the file path in the breadcrumbs view.")]},"breadcrumbs.symbolPath":{description:h(2894,"Controls whether and how symbols are shown in the breadcrumbs view."),type:"string",default:"on",enum:["on","off","last"],enumDescriptions:[h(2895,"Show all symbols in the breadcrumbs view."),h(2896,"Do not show symbols in the breadcrumbs view."),h(2897,"Only show the current symbol in the breadcrumbs view.")]},"breadcrumbs.symbolSortOrder":{description:h(2898,"Controls how symbols are sorted in the breadcrumbs outline view."),type:"string",default:"position",scope:Ht.LANGUAGE_OVERRIDABLE,enum:["position","name","type"],enumDescriptions:[h(2899,"Show symbol outline in file position order."),h(2900,"Show symbol outline in alphabetical order."),h(2901,"Show symbol outline in symbol type order.")]},"breadcrumbs.icons":{description:h(2902,"Render breadcrumb items with icons."),type:"boolean",default:!0},"breadcrumbs.showFiles":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2903,"When enabled breadcrumbs show `file`-symbols.")},"breadcrumbs.showModules":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2904,"When enabled breadcrumbs show `module`-symbols.")},"breadcrumbs.showNamespaces":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2905,"When enabled breadcrumbs show `namespace`-symbols.")},"breadcrumbs.showPackages":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2906,"When enabled breadcrumbs show `package`-symbols.")},"breadcrumbs.showClasses":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2907,"When enabled breadcrumbs show `class`-symbols.")},"breadcrumbs.showMethods":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2908,"When enabled breadcrumbs show `method`-symbols.")},"breadcrumbs.showProperties":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2909,"When enabled breadcrumbs show `property`-symbols.")},"breadcrumbs.showFields":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2910,"When enabled breadcrumbs show `field`-symbols.")},"breadcrumbs.showConstructors":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2911,"When enabled breadcrumbs show `constructor`-symbols.")},"breadcrumbs.showEnums":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2912,"When enabled breadcrumbs show `enum`-symbols.")},"breadcrumbs.showInterfaces":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2913,"When enabled breadcrumbs show `interface`-symbols.")},"breadcrumbs.showFunctions":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2914,"When enabled breadcrumbs show `function`-symbols.")},"breadcrumbs.showVariables":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2915,"When enabled breadcrumbs show `variable`-symbols.")},"breadcrumbs.showConstants":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2916,"When enabled breadcrumbs show `constant`-symbols.")},"breadcrumbs.showStrings":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2917,"When enabled breadcrumbs show `string`-symbols.")},"breadcrumbs.showNumbers":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2918,"When enabled breadcrumbs show `number`-symbols.")},"breadcrumbs.showBooleans":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2919,"When enabled breadcrumbs show `boolean`-symbols.")},"breadcrumbs.showArrays":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2920,"When enabled breadcrumbs show `array`-symbols.")},"breadcrumbs.showObjects":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2921,"When enabled breadcrumbs show `object`-symbols.")},"breadcrumbs.showKeys":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2922,"When enabled breadcrumbs show `key`-symbols.")},"breadcrumbs.showNull":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2923,"When enabled breadcrumbs show `null`-symbols.")},"breadcrumbs.showEnumMembers":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2924,"When enabled breadcrumbs show `enumMember`-symbols.")},"breadcrumbs.showStructs":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2925,"When enabled breadcrumbs show `struct`-symbols.")},"breadcrumbs.showEvents":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2926,"When enabled breadcrumbs show `event`-symbols.")},"breadcrumbs.showOperators":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2927,"When enabled breadcrumbs show `operator`-symbols.")},"breadcrumbs.showTypeParameters":{type:"boolean",default:!0,scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(2928,"When enabled breadcrumbs show `typeParameter`-symbols.")}}});var YP;(function(s){s[s.OutlinePane=1]="OutlinePane",s[s.Breadcrumbs=2]="Breadcrumbs",s[s.QuickPick=4]="QuickPick"})(YP||(YP={}));var tJ;(function(s){s.icons="outline.icons",s.collapseItems="outline.collapseItems",s.problemsEnabled="outline.problems.enabled",s.problemsColors="outline.problems.colors",s.problemsBadges="outline.problems.badges"})(tJ||(tJ={}));var iJ;(function(s){s.Collapsed="alwaysCollapse",s.Expanded="alwaysExpand"})(iJ||(iJ={}));class QP{constructor(e,t){this.uri=e,this.kind=t}}class n2{constructor(e,t){this.element=e,this.outline=t}}let s2=class{constructor(e,t,i,n,o){this.resource=e,this.editor=t,this._workspaceService=n,this._outlineService=o,this._disposables=new U,this._currentOutline=new Pt,this._outlineDisposables=new U,this._onDidUpdate=new M,this.onDidUpdate=this._onDidUpdate.event,this._cfgFilePath=co.FilePath.bindTo(i),this._cfgSymbolPath=co.SymbolPath.bindTo(i),this._disposables.add(this._cfgFilePath.onDidChange(r=>this._onDidUpdate.fire(this))),this._disposables.add(this._cfgSymbolPath.onDidChange(r=>this._onDidUpdate.fire(this))),this._workspaceService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspaceFolders,this,this._disposables),this._fileInfo=this._initFilePathInfo(e),t&&(this._bindToEditor(t),this._disposables.add(o.onDidChange(()=>this._bindToEditor(t))),this._disposables.add(t.onDidChangeControl(()=>this._bindToEditor(t)))),this._onDidUpdate.fire(this)}dispose(){this._disposables.dispose(),this._cfgFilePath.dispose(),this._cfgSymbolPath.dispose(),this._currentOutline.dispose(),this._outlineDisposables.dispose(),this._onDidUpdate.dispose()}isRelative(){return!!this._fileInfo.folder}getElements(){let e=[];if(this._cfgFilePath.getValue()==="on"?e=e.concat(this._fileInfo.path):this._cfgFilePath.getValue()==="last"&&this._fileInfo.path.length>0&&(e=e.concat(this._fileInfo.path.slice(-1))),this._cfgSymbolPath.getValue()==="off"||!this._currentOutline.value)return e;const t=this._currentOutline.value.config.breadcrumbsDataSource.getBreadcrumbElements();for(let i=this._cfgSymbolPath.getValue()==="last"&&t.length>0?t.length-1:0;i<t.length;i++)e.push(new n2(t[i],this._currentOutline.value));return t.length===0&&!this._currentOutline.value.isEmpty&&e.push(new n2(this._currentOutline.value,this._currentOutline.value)),e}_initFilePathInfo(e){if(xz(e,ae.untitled,ae.data))return{folder:void 0,path:[]};const t={folder:this._workspaceService.getWorkspaceFolder(e)??void 0,path:[]};let i=e;for(;i&&i.path!=="/"&&!(t.folder&&At(t.folder.uri,i));){t.path.unshift(new QP(i,t.path.length===0?Pi.FILE:Pi.FOLDER));const n=i.path.length;if(i=_s(i),i.path.length===n)break}return t.folder&&this._workspaceService.getWorkbenchState()===Zo.WORKSPACE&&t.path.unshift(new QP(t.folder.uri,Pi.ROOT_FOLDER)),t}_onDidChangeWorkspaceFolders(){this._fileInfo=this._initFilePathInfo(this.resource),this._onDidUpdate.fire(this)}_bindToEditor(e){const t=new li;this._currentOutline.clear(),this._outlineDisposables.clear(),this._outlineDisposables.add(Ie(()=>t.dispose(!0))),this._outlineService.createOutline(e,YP.Breadcrumbs,t.token).then(i=>{t.token.isCancellationRequested&&(i?.dispose(),i=void 0),this._currentOutline.value=i,this._onDidUpdate.fire(this),i&&this._outlineDisposables.add(i.onDidChange(()=>this._onDidUpdate.fire(this)))}).catch(i=>{this._onDidUpdate.fire(this),mt(i)})}};s2=f([p(2,ne),p(3,It),p(4,$q)],s2);const cue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(cue);let XP=class{constructor(e,t,i,n,o){this.resource=t,this._instantiationService=i,this._themeService=n,this._configurationService=o,this._disposables=new U,this._fakeEvent=new UIEvent("fakeEvent"),this._onWillPickElement=new M,this.onWillPickElement=this._onWillPickElement.event,this._previewDispoables=new Pt,this._domNode=document.createElement("div"),this._domNode.className="monaco-breadcrumbs-picker show-file-icons",e.appendChild(this._domNode)}dispose(){this._disposables.dispose(),this._previewDispoables.dispose(),this._onWillPickElement.dispose(),this._domNode.remove(),setTimeout(()=>this._tree.dispose(),0)}async show(e,t,i,n,o){const a=this._themeService.getColorTheme().getColor(Vne);this._arrow=document.createElement("div"),this._arrow.className="arrow",this._arrow.style.borderColor=`transparent transparent ${a?a.toString():""}`,this._domNode.appendChild(this._arrow),this._treeContainer=document.createElement("div"),this._treeContainer.style.background=a?a.toString():"",this._treeContainer.style.paddingTop="2px",this._treeContainer.style.borderRadius="3px",this._treeContainer.style.boxShadow=`0 0 8px 2px ${this._themeService.getColorTheme().getColor(Hne)}`,this._treeContainer.style.border=`1px solid ${this._themeService.getColorTheme().getColor(oy)}`,this._domNode.appendChild(this._treeContainer),this._layoutInfo={maxHeight:t,width:i,arrowSize:n,arrowOffset:o,inputHeight:0},this._tree=this._createTree(this._treeContainer,e),this._disposables.add(this._tree.onDidOpen(async c=>{const{element:d,editorOptions:l,sideBySide:u}=c;await this._revealElement(d,{...l,preserveFocus:!1},u)})),this._disposables.add(this._tree.onDidChangeFocus(c=>{this._previewDispoables.value=this._previewElement(c.elements[0])})),this._disposables.add(this._tree.onDidChangeContentHeight(()=>{this._layout()})),this._domNode.focus();try{await this._setInput(e),this._layout()}catch(c){mt(c)}}_layout(){const e=2*this._layoutInfo.arrowSize,t=Math.min(this._layoutInfo.maxHeight-e,this._tree.contentHeight),i=t+e;this._domNode.style.height=`${i}px`,this._domNode.style.width=`${this._layoutInfo.width}px`,this._arrow.style.top=`-${2*this._layoutInfo.arrowSize}px`,this._arrow.style.borderWidth=`${this._layoutInfo.arrowSize}px`,this._arrow.style.marginLeft=`${this._layoutInfo.arrowOffset}px`,this._treeContainer.style.height=`${t}px`,this._treeContainer.style.width=`${this._layoutInfo.width}px`,this._tree.layout(t,this._layoutInfo.width)}restoreViewState(){}};XP=f([p(2,Z),p(3,pt),p(4,ne)],XP);class q0e{getHeight(e){return 22}getTemplateId(e){return"FileStat"}}class K0e{getId(e){return R.isUri(e)?e.toString():FF(e)?e.id:Yu(e)?e.uri.toString():e.resource.toString()}}let o2=class{constructor(e){this._fileService=e}hasChildren(e){return R.isUri(e)||FF(e)||Yu(e)||e.isDirectory}async getChildren(e){if(FF(e))return e.folders;let t;return Yu(e)?t=e.uri:R.isUri(e)?t=e:t=e.resource,(await this._fileService.resolve(t)).children??[]}};o2=f([p(0,je)],o2);let r2=class{constructor(e,t){this._labels=e,this._configService=t,this.templateId="FileStat"}renderTemplate(e){return this._labels.create(e,{supportHighlights:!0})}renderElement(e,t,i){const n=this._configService.getValue("explorer.decorations"),{element:o}=e;let r,a;Yu(o)?(r=o.uri,a=Pi.ROOT_FOLDER):(r=o.resource,a=o.isDirectory?Pi.FOLDER:Pi.FILE),i.setFile(r,{fileKind:a,hidePath:!0,fileDecorations:n,matches:vw(e.filterData),extraClasses:["picker-item"]})}disposeTemplate(e){e.dispose()}};r2=f([p(1,ne)],r2);class j0e{getKeyboardNavigationLabel(e){return e.name}}class Y0e{getWidgetAriaLabel(){return h(2940,"Breadcrumbs")}getAriaLabel(e){return e.name}}let a2=class{constructor(e,t){this._workspaceService=e,this._cachedExpressions=new Map,this._disposables=new U;const i=co.FileExcludes.bindTo(t),n=()=>{e.getWorkspace().folders.forEach(o=>{const r=i.getValue({resource:o.uri});if(!r)return;const a={};for(const c in r){if(typeof r[c]!="boolean")continue;const d=c.indexOf("**/")!==0?Yc.join(o.uri.path,c):c;a[d]=r[c]}this._cachedExpressions.set(o.uri.toString(),Km(a))})};n(),this._disposables.add(i),this._disposables.add(i.onDidChange(n)),this._disposables.add(e.onDidChangeWorkspaceFolders(n))}dispose(){this._disposables.dispose()}filter(e,t){if(Yu(e))return!0;const i=this._workspaceService.getWorkspaceFolder(e.resource);return!i||!this._cachedExpressions.has(i.uri.toString())?!0:!this._cachedExpressions.get(i.uri.toString())(zM(i.uri.path,e.resource.path),Qe(e.resource))}};a2=f([p(0,It),p(1,ne)],a2);let Q0e=class{compare(e,t){return Yu(e)&&Yu(t)?e.index-t.index:e.isDirectory===t.isDirectory?I_e(e.name,t.name):e.isDirectory?-1:1}},c2=class extends XP{constructor(e,t,i,n,o,r,a){super(e,t,i,n,o),this._workspaceService=r,this._editorService=a}_createTree(e){this._treeContainer.classList.add("file-icon-themable-tree"),this._treeContainer.classList.add("show-file-icons");const t=n=>{this._treeContainer.classList.toggle("align-icons-and-twisties",n.hasFileIcons&&!n.hasFolderIcons),this._treeContainer.classList.toggle("hide-arrows",n.hidesExplorerArrows===!0)};this._disposables.add(this._themeService.onDidFileIconThemeChange(t)),t(this._themeService.getFileIconTheme());const i=this._instantiationService.createInstance(vd,PO);return this._disposables.add(i),this._instantiationService.createInstance(Cz,"BreadcrumbsFilePicker",e,new q0e,[this._instantiationService.createInstance(r2,i)],this._instantiationService.createInstance(o2),{multipleSelectionSupport:!1,sorter:new Q0e,filter:this._instantiationService.createInstance(a2),identityProvider:new K0e,keyboardNavigationLabelProvider:new j0e,accessibilityProvider:this._instantiationService.createInstance(Y0e),showNotFoundMessage:!1,overrideStyles:{listBackground:Vne}})}async _setInput(e){const{uri:t,kind:i}=e;let n;i===Pi.ROOT_FOLDER?n=this._workspaceService.getWorkspace():n=_s(t);const o=this._tree;await o.setInput(n);let r;for(const{element:a}of o.getNode().children)if(Yu(a)&&At(a.uri,t)){r=a;break}else if(At(a.resource,t)){r=a;break}r&&(o.reveal(r,.5),o.setFocus([r],this._fakeEvent)),o.domFocus()}_previewElement(e){return F.None}async _revealElement(e,t,i){return!Yu(e)&&e.isFile?(this._onWillPickElement.fire(),await this._editorService.openEditor({resource:e.resource,options:t},i?Rr:void 0),!0):!1}};c2=f([p(2,Z),p(3,pt),p(4,ne),p(5,It),p(6,de)],c2);let d2=class{constructor(e,t,i){this.comparator=e,this._order=i.getValue(t,"breadcrumbs.symbolSortOrder")}compare(e,t){return this._order==="name"?this.comparator.compareByName(e,t):this._order==="type"?this.comparator.compareByType(e,t):this.comparator.compareByPosition(e,t)}};d2=f([p(2,ir)],d2);class X0e extends XP{_createTree(e,t){const{config:i}=t.outline;return this._instantiationService.createInstance(Une,"BreadcrumbsOutlinePicker",e,i.delegate,i.renderers,i.treeDataSource,{...i.options,sorter:this._instantiationService.createInstance(d2,i.comparator,void 0),collapseByDefault:!0,expandOnlyOnTwistieClick:!0,multipleSelectionSupport:!1,showNotFoundMessage:!1})}_setInput(e){const t=e.outline.captureViewState();this.restoreViewState=()=>{t.dispose()};const i=this._tree;return i.setInput(e.outline),e.element!==e.outline&&(i.reveal(e.element,.5),i.setFocus([e.element],this._fakeEvent)),i.domFocus(),Promise.resolve()}_previewElement(e){return this._tree.getInput().preview(e)}async _revealElement(e,t,i){return this._onWillPickElement.fire(),await this._tree.getInput().reveal(e,t,i,!1),!0}}var l2,h2,Fl;Ve(cue);let ZP=l2=class extends G4{constructor(e,t,i,n){super(),this.model=e,this.element=t,this.options=i,this._instantiationService=n,this._disposables=new U}dispose(){this._disposables.dispose()}equals(e){return e instanceof l2?this.element.element===e.element.element&&this.options.showFileIcons===e.options.showFileIcons&&this.options.showSymbolIcons===e.options.showSymbolIcons:!1}render(e){const{element:t,outline:i}=this.element;if(t===i){const a=j("span",void 0,"");e.appendChild(a);return}const n=i.config.delegate.getTemplateId(t),o=i.config.renderers.find(a=>a.templateId===n);if(!o){e.innerText="<<NO RENDERER>>";return}const r=o.renderTemplate(e);o.renderElement({element:t,children:[],depth:0,visibleChildrenCount:0,visibleChildIndex:0,collapsible:!1,collapsed:!1,visible:!0,filterData:void 0},0,r,void 0),this._disposables.add(Ie(()=>{o.disposeTemplate(r)})),t instanceof WA&&i.uri&&this._disposables.add(this._instantiationService.invokeFunction(a=>due(a,e,t.symbol.name,{symbol:t.symbol,uri:i.uri},this.model,this.options.dragEditor)))}};ZP=l2=f([p(3,Z)],ZP);let JP=h2=class extends G4{constructor(e,t,i,n,o,r){super(),this.model=e,this.element=t,this.options=i,this._labels=n,this._hoverDelegate=o,this._instantiationService=r,this._disposables=new U}dispose(){this._disposables.dispose()}equals(e){return e instanceof h2?SE.isEqual(this.element.uri,e.element.uri)&&this.options.showFileIcons===e.options.showFileIcons&&this.options.showSymbolIcons===e.options.showSymbolIcons:!1}render(e){const t=this._labels.create(e,{hoverDelegate:this._hoverDelegate});t.setFile(this.element.uri,{hidePath:!0,hideIcon:this.element.kind===Pi.FOLDER||!this.options.showFileIcons,fileKind:this.element.kind,fileDecorations:{colors:this.options.showDecorationColors,badges:!1}}),e.classList.add(Pi[this.element.kind].toLowerCase()),this._disposables.add(t),this._disposables.add(this._instantiationService.invokeFunction(i=>due(i,e,Qe(this.element.uri),this.element.uri,this.model,this.options.dragEditor)))}};JP=h2=f([p(5,Z)],JP);function due(s,e,t,i,n,o){const r=s.get(Z);return e.draggable=!0,new Wp(e,{onDragStart:a=>{a.dataTransfer&&(a.dataTransfer.effectAllowed="copyMove",r.invokeFunction(c=>{R.isUri(i)?ag(c,[i],a):(ag(c,[{resource:i.uri,selection:i.symbol.range}],a),cde([{name:i.symbol.name,fsPath:i.uri.fsPath,range:i.symbol.range,kind:i.symbol.kind}],a)),o&&n.editor&&n.editor?.input&&Ru.getInstance().setData([new Ac({editor:n.editor.input,groupId:n.editor.group.id})],Ac.prototype)}),JM(a,e,t))}})}const Z0e=Pe("breadcrumb-separator",K.chevronRight,h(2929,"Icon for the separator in the breadcrumbs."));let Rn=class{static{Fl=this}static{this.HEIGHT=22}static{this.SCROLLBAR_SIZES={default:3,large:8}}static{this.Payload_Reveal={}}static{this.Payload_RevealAside={}}static{this.Payload_Pick={}}static{this.CK_BreadcrumbsPossible=new O("breadcrumbsPossible",!1,h(2930,"Whether the editor can show breadcrumbs"))}static{this.CK_BreadcrumbsVisible=new O("breadcrumbsVisible",!1,h(2931,"Whether breadcrumbs are currently visible"))}static{this.CK_BreadcrumbsActive=new O("breadcrumbsActive",!1,h(2932,"Whether breadcrumbs have focus"))}get onDidVisibilityChange(){return this._onDidVisibilityChange.event}constructor(e,t,i,n,o,r,a,c,d,l,u,g){this._options=t,this._editorGroup=i,this._contextKeyService=n,this._contextViewService=o,this._instantiationService=r,this._quickInputService=a,this._fileService=c,this._editorService=d,this._labelService=l,this._disposables=new U,this._breadcrumbsDisposables=new U,this._model=new Pt,this._breadcrumbsPickerShowing=!1,this._onDidVisibilityChange=this._disposables.add(new M),this.domNode=document.createElement("div"),this.domNode.classList.add("breadcrumbs-control"),ee(e,this.domNode),this._cfUseQuickPick=co.UseQuickPick.bindTo(u),this._cfShowIcons=co.Icons.bindTo(u),this._cfTitleScrollbarSizing=co.TitleScrollbarSizing.bindTo(u),this._labels=this._instantiationService.createInstance(vd,PO);const m=this._cfTitleScrollbarSizing.getValue()??"default",v=t.widgetStyles??$ne;this._widget=new z0e(this.domNode,Fl.SCROLLBAR_SIZES[m],Z0e,v),this._widget.onDidSelectItem(this._onSelectEvent,this,this._disposables),this._widget.onDidFocusItem(this._onFocusEvent,this,this._disposables),this._widget.onDidChangeFocus(this._updateCkBreadcrumbsActive,this,this._disposables),this._ckBreadcrumbsPossible=Fl.CK_BreadcrumbsPossible.bindTo(this._contextKeyService),this._ckBreadcrumbsVisible=Fl.CK_BreadcrumbsVisible.bindTo(this._contextKeyService),this._ckBreadcrumbsActive=Fl.CK_BreadcrumbsActive.bindTo(this._contextKeyService),this._hoverDelegate=Ir("mouse"),this._disposables.add(g.register(this._editorGroup.id,this._widget)),this.hide()}dispose(){this._disposables.dispose(),this._breadcrumbsDisposables.dispose(),this._model.dispose(),this._ckBreadcrumbsPossible.reset(),this._ckBreadcrumbsVisible.reset(),this._ckBreadcrumbsActive.reset(),this._cfUseQuickPick.dispose(),this._cfShowIcons.dispose(),this._widget.dispose(),this._labels.dispose(),this.domNode.remove()}get model(){return this._model.value}layout(e){this._widget.layout(e)}isHidden(){return this.domNode.classList.contains("hidden")}hide(){const e=this.isHidden();this._breadcrumbsDisposables.clear(),this._ckBreadcrumbsVisible.set(!1),this.domNode.classList.toggle("hidden",!0),e||this._onDidVisibilityChange.fire()}show(){const e=this.isHidden();this._ckBreadcrumbsVisible.set(!0),this.domNode.classList.toggle("hidden",!1),e&&this._onDidVisibilityChange.fire()}revealLast(){this._widget.revealLast()}update(){this._breadcrumbsDisposables.clear();const e=Di.getCanonicalUri(this._editorGroup.activeEditor,{supportSideBySide:qt.PRIMARY}),t=this.isHidden();if(!e||!this._fileService.hasProvider(e))return this._ckBreadcrumbsPossible.set(!1),t?!1:(this.hide(),!0);const i=Di.getOriginalUri(this._editorGroup.activeEditor,{supportSideBySide:qt.PRIMARY});this.show(),this._ckBreadcrumbsPossible.set(!0);const n=this._instantiationService.createInstance(s2,i??e,this._editorGroup.activeEditorPane);this._model.value=n,this.domNode.classList.toggle("backslash-path",this._labelService.getSeparator(e.scheme,e.authority)==="\\");const o=()=>{this.domNode.classList.toggle("relative-path",n.isRelative());const l=this._cfShowIcons.getValue(),u={...this._options,showFileIcons:this._options.showFileIcons&&l,showSymbolIcons:this._options.showSymbolIcons&&l},g=n.getElements().map(m=>m instanceof QP?this._instantiationService.createInstance(JP,n,m,u,this._labels,this._hoverDelegate):this._instantiationService.createInstance(ZP,n,m,u));g.length===0?(this._widget.setEnabled(!1),this._widget.setItems([new class extends G4{render(m){m.innerText=h(2933,"no elements")}equals(m){return m===this}dispose(){}}])):(this._widget.setEnabled(!0),this._widget.setItems(g),this._widget.reveal(g[g.length-1]))},r=n.onDidUpdate(o),a=this._cfShowIcons.onDidChange(o);o(),this._breadcrumbsDisposables.clear(),this._breadcrumbsDisposables.add(r),this._breadcrumbsDisposables.add(Ie(()=>this._model.clear())),this._breadcrumbsDisposables.add(a),this._breadcrumbsDisposables.add(Ie(()=>this._widget.setItems([])));const c=()=>{const l=this._cfTitleScrollbarSizing.getValue()??"default";this._widget.setHorizontalScrollbarSize(Fl.SCROLLBAR_SIZES[l])};c();const d=this._cfTitleScrollbarSizing.onDidChange(c);return this._breadcrumbsDisposables.add(d),this._breadcrumbsDisposables.add({dispose:()=>{this._breadcrumbsPickerShowing&&this._contextViewService.hideContextView({source:this})}}),t!==this.isHidden()}_onFocusEvent(e){e.item&&this._breadcrumbsPickerShowing&&(this._breadcrumbsPickerIgnoreOnceItem=void 0,this._widget.setSelection(e.item))}_onSelectEvent(e){if(!e.item)return;if(e.item===this._breadcrumbsPickerIgnoreOnceItem){this._breadcrumbsPickerIgnoreOnceItem=void 0,this._widget.setFocused(void 0),this._widget.setSelection(void 0);return}const{element:t}=e.item;this._editorGroup.focus();const i=this._getEditorGroup(e.payload);if(i!==void 0){this._widget.setFocused(void 0),this._widget.setSelection(void 0),this._revealInEditor(e,t,i);return}if(this._cfUseQuickPick.getValue()){this._widget.setFocused(void 0),this._widget.setSelection(void 0),this._quickInputService.quickAccess.show(t instanceof n2?"@":"");return}let n,o;this._contextViewService.showContextView({render:r=>{e.item instanceof JP?n=this._instantiationService.createInstance(c2,r,e.item.model.resource):e.item instanceof ZP&&(n=this._instantiationService.createInstance(X0e,r,e.item.model.resource));const a=n.onWillPickElement(()=>this._contextViewService.hideContextView({source:this,didPick:!0})),c=Wse.getInstance(Et(this.domNode)).onDidChange(()=>this._contextViewService.hideContextView({source:this})),d=Fo(r),l=d.onDidBlur(()=>{this._breadcrumbsPickerIgnoreOnceItem=this._widget.isDOMFocused()?e.item:void 0,this._contextViewService.hideContextView({source:this})});return this._breadcrumbsPickerShowing=!0,this._updateCkBreadcrumbsActive(),Wo(n,a,c,d,l)},getAnchor:()=>{if(!o){const r=Et(this.domNode),a=r.innerWidth-8;let c=Math.min(r.innerHeight*.7,300);const d=Math.min(a,Math.max(240,a/4.17)),l=8;let u;const g=Bs(e.node.firstChild),m=g.top+g.height+l;m+c>=r.innerHeight&&(c=r.innerHeight-m-30);let v=g.left;if(v+d>=a&&(v=a-d),e.payload instanceof bs){const _=d-2*l;u=e.payload.posx-v,u>_&&(v=Math.min(a-d,v+u-_),u=_)}else u=g.left+g.width*.3-v;n.show(t,c,d,l,Math.max(0,u)),o={x:v,y:m}}return o},onHide:r=>{r?.didPick||n.restoreViewState(),this._breadcrumbsPickerShowing=!1,this._updateCkBreadcrumbsActive(),r?.source===this&&(this._widget.setFocused(void 0),this._widget.setSelection(void 0)),n.dispose()}})}_updateCkBreadcrumbsActive(){const e=this._widget.isDOMFocused()||this._breadcrumbsPickerShowing;this._ckBreadcrumbsActive.set(e)}async _revealInEditor(e,t,i,n=!1){if(t instanceof QP)if(t.kind===Pi.FILE)await this._editorService.openEditor({resource:t.uri,options:{pinned:n}},i);else{const o=this._widget.getItems(),r=o.indexOf(e.item);this._widget.setFocused(o[r+1]),this._widget.setSelection(o[r+1],Fl.Payload_Pick)}else t.outline.reveal(t,{pinned:n},i===Rr,!1)}_getEditorGroup(e){return e===Fl.Payload_RevealAside?Rr:e===Fl.Payload_Reveal?ol:void 0}};Rn=Fl=f([p(3,fe),p(4,rf),p(5,Z),p(6,Wt),p(7,je),p(8,de),p(9,ui),p(10,ne),p(11,Bh)],Rn);let eL=class{get control(){return this._control}get onDidEnablementChange(){return this._onDidEnablementChange.event}get onDidVisibilityChange(){return this._onDidVisibilityChange.event}constructor(e,t,i,n,o,r){this._container=e,this._editorGroup=t,this._options=i,this._instantiationService=o,this._disposables=new U,this._controlDisposables=new U,this._onDidEnablementChange=this._disposables.add(new M),this._onDidVisibilityChange=this._disposables.add(new M);const a=this._disposables.add(co.IsEnabled.bindTo(n));this._disposables.add(a.onDidChange(()=>{const c=a.getValue();!c&&this._control?(this._controlDisposables.clear(),this._control=void 0,this._onDidEnablementChange.fire()):c&&!this._control&&(this._control=this.createControl(),this._control.update(),this._onDidEnablementChange.fire())})),a.getValue()&&(this._control=this.createControl()),this._disposables.add(r.onDidChangeFileSystemProviderRegistrations(c=>{this._control?.model&&this._control.model.resource.scheme!==c.scheme||this._control?.update()&&this._onDidEnablementChange.fire()}))}createControl(){const e=this._controlDisposables.add(this._instantiationService.createInstance(Rn,this._container,this._options,this._editorGroup));return this._controlDisposables.add(e.onDidVisibilityChange(()=>this._onDidVisibilityChange.fire())),e}dispose(){this._disposables.dispose(),this._controlDisposables.dispose()}};eL=f([p(3,ne),p(4,Z),p(5,je)],eL);Y(class extends X{constructor(){super({id:"breadcrumbs.toggle",title:{...I(2934,"Toggle Breadcrumbs"),mnemonicTitle:h(2935,"Toggle &&Breadcrumbs")},category:te.View,toggled:{condition:x.equals("config.breadcrumbs.enabled",!0),title:h(2936,"Toggle Breadcrumbs"),mnemonicTitle:h(2937,"Toggle &&Breadcrumbs")},menu:[{id:N.CommandPalette},{id:N.MenubarAppearanceMenu,group:"4_editor",order:2},{id:N.NotebookToolbar,group:"notebookLayout",order:2},{id:N.StickyScrollContext},{id:N.NotebookStickyScrollContext,group:"notebookView",order:2},{id:N.NotebookToolbarContext,group:"notebookView",order:2}]})}run(e){const t=e.get(ne),i=co.IsEnabled.bindTo(t).getValue();co.IsEnabled.bindTo(t).updateValue(!i)}});function z4(s,e){const t=s.get(xe),n=s.get(Bh).getWidget(t.activeGroup.id);if(n){const o=n.getItems().at(-1);n.setFocused(o),e&&n.setSelection(o,Rn.Payload_Pick)}}Y(class extends X{constructor(){super({id:"breadcrumbs.focusAndSelect",title:I(2938,"Focus and Select Breadcrumbs"),precondition:Rn.CK_BreadcrumbsVisible,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Period,when:Rn.CK_BreadcrumbsPossible},f1:!0})}run(e,...t){z4(e,!0)}});Y(class extends X{constructor(){super({id:"breadcrumbs.focus",title:I(2939,"Focus Breadcrumbs"),precondition:Rn.CK_BreadcrumbsVisible,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Semicolon,when:Rn.CK_BreadcrumbsPossible},f1:!0})}run(e,...t){z4(e,!1)}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.toggleToOn",weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.Period,when:x.not("config.breadcrumbs.enabled"),handler:async s=>{const e=s.get(Z),t=s.get(ne),i=co.IsEnabled.bindTo(t);return i.getValue()||(await i.updateValue(!0),await Da(50)),e.invokeFunction(z4,!0)}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.focusNext",weight:W.WorkbenchContrib,primary:S.RightArrow,secondary:[E.CtrlCmd|S.RightArrow],mac:{primary:S.RightArrow,secondary:[E.Alt|S.RightArrow]},when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive),handler(s){const e=s.get(xe),i=s.get(Bh).getWidget(e.activeGroup.id);i&&i.focusNext()}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.focusPrevious",weight:W.WorkbenchContrib,primary:S.LeftArrow,secondary:[E.CtrlCmd|S.LeftArrow],mac:{primary:S.LeftArrow,secondary:[E.Alt|S.LeftArrow]},when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive),handler(s){const e=s.get(xe),i=s.get(Bh).getWidget(e.activeGroup.id);i&&i.focusPrev()}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.focusNextWithPicker",weight:W.WorkbenchContrib+1,primary:E.CtrlCmd|S.RightArrow,mac:{primary:E.Alt|S.RightArrow},when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive,of),handler(s){const e=s.get(xe),i=s.get(Bh).getWidget(e.activeGroup.id);i&&i.focusNext()}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.focusPreviousWithPicker",weight:W.WorkbenchContrib+1,primary:E.CtrlCmd|S.LeftArrow,mac:{primary:E.Alt|S.LeftArrow},when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive,of),handler(s){const e=s.get(xe),i=s.get(Bh).getWidget(e.activeGroup.id);i&&i.focusPrev()}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.selectFocused",weight:W.WorkbenchContrib,primary:S.Enter,secondary:[S.DownArrow],when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive),handler(s){const e=s.get(xe),i=s.get(Bh).getWidget(e.activeGroup.id);i&&i.setSelection(i.getFocused(),Rn.Payload_Pick)}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.revealFocused",weight:W.WorkbenchContrib,primary:S.Space,secondary:[E.CtrlCmd|S.Enter],when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive),handler(s){const e=s.get(xe),i=s.get(Bh).getWidget(e.activeGroup.id);i&&i.setSelection(i.getFocused(),Rn.Payload_Reveal)}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.selectEditor",weight:W.WorkbenchContrib+1,primary:S.Escape,when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive),handler(s){const e=s.get(xe),i=s.get(Bh).getWidget(e.activeGroup.id);i&&(i.setFocused(void 0),i.setSelection(void 0),e.activeGroup.activeEditorPane?.focus())}});Me.registerCommandAndKeybindingRule({id:"breadcrumbs.revealFocusedFromTreeAside",weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.Enter,when:x.and(Rn.CK_BreadcrumbsVisible,Rn.CK_BreadcrumbsActive,of),handler(s){const e=s.get(de),i=s.get(Ei).lastFocusedList;if(!(i instanceof Une)&&!(i instanceof Cz))return;const n=i.getFocus()[0];if(R.isUri(n?.resource))return e.openEditor({resource:n.resource,options:{pinned:!0}},Rr);const o=i.getInput();if(o&&typeof o.outlineKind=="string")return o.reveal(n,{pinned:!0,preserveFocus:!1},!0,!1)}});const J0e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),e1e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var hT;Ve(e1e);class lue extends hg{constructor(e){super(),this.context=e}run(e,t){let i=this.context;return t?.preserveFocus&&(i={...this.context,preserveFocus:!0}),super.run(e,i)}}let Ax=class extends ww{static{hT=this}static{this.EDITOR_TAB_HEIGHT={normal:35,compact:22}}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(g),this.parent=e,this.editorPartsView=t,this.groupsView=i,this.groupView=n,this.tabsModel=o,this.contextMenuService=r,this.instantiationService=a,this.contextKeyService=c,this.keybindingService=d,this.notificationService=l,this.quickInputService=u,this.editorResolverService=m,this.hostService=v,this.editorTransfer=Ru.getInstance(),this.groupTransfer=Ru.getInstance(),this.treeItemsTransfer=Ru.getInstance(),this.editorActionsToolbarDisposables=this._register(new U),this.editorActionsDisposables=this._register(new U),this.renderDropdownAsChildElement=!1;const _=this.create(e);this.contextMenuContextKeyService=this._register(this.contextKeyService.createScoped(_));const w=this._register(this.instantiationService.createChild(new uf([fe,this.contextMenuContextKeyService])));this.resourceContext=this._register(w.createInstance(hi)),this.editorPinnedContext=goe.bindTo(this.contextMenuContextKeyService),this.editorIsFirstContext=poe.bindTo(this.contextMenuContextKeyService),this.editorIsLastContext=foe.bindTo(this.contextMenuContextKeyService),this.editorStickyContext=uA.bindTo(this.contextMenuContextKeyService),this.editorAvailableEditorIds=_I.bindTo(this.contextMenuContextKeyService),this.editorCanSplitInGroupContext=CC.bindTo(this.contextMenuContextKeyService),this.sideBySideEditorContext=mu.bindTo(this.contextMenuContextKeyService),this.groupLockedContext=hA.bindTo(this.contextMenuContextKeyService)}create(e){return this.updateTabHeight(),e}get editorActionsEnabled(){return this.groupsView.partOptions.editorActionsLocation==="default"&&this.groupsView.partOptions.showTabs!=="none"}createEditorActionsToolBar(e,t){this.editorActionsToolbarContainer=j("div"),this.editorActionsToolbarContainer.classList.add(...t),e.appendChild(this.editorActionsToolbarContainer),this.handleEditorActionToolBarVisibility(this.editorActionsToolbarContainer)}handleEditorActionToolBarVisibility(e){const t=this.editorActionsEnabled,i=!!this.editorActionsToolbar;t&&!i?this.doCreateEditorActionsToolBar(e):!t&&i&&(this.editorActionsToolbar?.getElement().remove(),this.editorActionsToolbar=void 0,this.editorActionsToolbarDisposables.clear(),this.editorActionsDisposables.clear()),e.classList.toggle("hidden",!t)}doCreateEditorActionsToolBar(e){const t={groupId:this.groupView.id};this.editorActionsToolbar=this.editorActionsToolbarDisposables.add(this.instantiationService.createInstance(nq,e,{actionViewItemProvider:(i,n)=>this.actionViewItemProvider(i,n),orientation:xa.HORIZONTAL,ariaLabel:h(3321,"Editor actions"),getKeyBinding:i=>this.getKeybinding(i),actionRunner:this.editorActionsToolbarDisposables.add(new lue(t)),anchorAlignmentProvider:()=>Pb.RIGHT,renderDropdownAsChildElement:this.renderDropdownAsChildElement,telemetrySource:"editorPart",resetMenu:N.EditorTitle,overflowBehavior:{maxItems:9,exempted:yOe},highlightToggledItems:!0})),this.editorActionsToolbar.context=t,this.editorActionsToolbarDisposables.add(this.editorActionsToolbar.actionRunner.onDidRun(i=>{i.error&&!ys(i.error)&&this.notificationService.error(i.error)}))}actionViewItemProvider(e,t){const i=this.groupView.activeEditorPane;if(i instanceof Mu){const n=i.getActionViewItem(e,t);if(n)return n}return mw(this.instantiationService,e,{...t,menuAsChild:this.renderDropdownAsChildElement})}updateEditorActionsToolbar(){if(!this.editorActionsEnabled)return;this.editorActionsDisposables.clear();const e=this.groupView.createEditorActions(this.editorActionsDisposables);this.editorActionsDisposables.add(e.onDidChange(()=>this.updateEditorActionsToolbar()));const t=jt(this.editorActionsToolbar),{primary:i,secondary:n}=this.prepareEditorActions(e.actions);t.setActions(eA(i),eA(n))}getEditorPaneAwareContextKeyService(){return this.groupView.activeEditorPane?.scopedContextKeyService??this.contextKeyService}clearEditorActionsToolbar(){if(!this.editorActionsEnabled)return;jt(this.editorActionsToolbar).setActions([],[])}onGroupDragStart(e,t){if(e.target!==t)return!1;const i=this.isNewWindowOperation(e);this.groupTransfer.setData([new lu(this.groupView.id)],lu.prototype),e.dataTransfer&&(e.dataTransfer.effectAllowed="copyMove");let n=!1;if(this.groupsView.partOptions.showTabs==="multiple"?n=this.doFillResourceDataTransfers(this.groupView.getEditors(Ii.SEQUENTIAL),e,i):this.groupView.activeEditor&&(n=this.doFillResourceDataTransfers([this.groupView.activeEditor],e,i)),!n&&ZM&&e.dataTransfer?.setData(Ds.TEXT,String(this.groupView.label)),this.groupView.activeEditor){let o=this.groupView.activeEditor.getName();this.groupsView.partOptions.showTabs==="multiple"&&this.groupView.count>1&&(o=h(3322,"{0} (+{1})",o,this.groupView.count-1)),JM(e,t,o)}return i}async onGroupDragEnd(e,t,i,n){if(this.groupTransfer.clearData(lu.prototype),e.target!==i||!n||iue())return;const o=await this.maybeCreateAuxiliaryEditorPartAt(e,i);if(!o)return;const r=o.activeGroup;this.groupsView.mergeGroup(this.groupView,r.id,{mode:this.isMoveOperation(t??e,r.id)?FE.MOVE_EDITORS:FE.COPY_EDITORS}),r.focus()}async maybeCreateAuxiliaryEditorPartAt(e,t){const{point:i,display:n}=await this.hostService.getCursorScreenPoint()??{point:{x:e.screenX,y:e.screenY}},o=Fp();if(o.document.visibilityState==="visible"&&o.document.hasFocus()&&i.x>=o.screenX&&i.x<=o.screenX+o.outerWidth&&i.y>=o.screenY&&i.y<=o.screenY+o.outerHeight)return;const r=t.offsetWidth/2,a=30+t.offsetHeight/2,c={x:i.x-r,y:i.y-a};return n&&(c.x<n.x&&(c.x=n.x),c.y<n.y&&(c.y=n.y)),this.editorPartsView.createAuxiliaryEditorPart({bounds:c})}isNewWindowOperation(e){return this.groupsView.partOptions.dragToOpenWindow?!e.altKey:e.altKey}isMoveOperation(e,t,i){return i?.hasCapability(Je.Singleton)?!0:!(e.ctrlKey&&!Yt||e.altKey&&Yt)||t===this.groupView.id}doFillResourceDataTransfers(e,t,i){return e.length?(this.instantiationService.invokeFunction(ag,e.map(n=>({editor:n,groupId:this.groupView.id})),t,{disableStandardTransfer:i}),!0):!1}onTabContextMenu(e,t,i){this.resourceContext.set(Di.getOriginalUri(e,{supportSideBySide:qt.PRIMARY})),this.editorPinnedContext.set(this.tabsModel.isPinned(e)),this.editorIsFirstContext.set(this.tabsModel.isFirst(e)),this.editorIsLastContext.set(this.tabsModel.isLast(e)),this.editorStickyContext.set(this.tabsModel.isSticky(e)),this.groupLockedContext.set(this.tabsModel.isLocked),this.editorCanSplitInGroupContext.set(e.hasCapability(Je.CanSplitInGroup)),this.sideBySideEditorContext.set(e.typeId===ks.ID),moe(this.editorAvailableEditorIds,e,this.editorResolverService);let n=i;op(t)&&(n=new bs(Et(i),t)),this.contextMenuService.showContextMenu({getAnchor:()=>n,menuId:N.EditorTitleContext,menuActionOptions:{shouldForwardArgs:!0,arg:this.resourceContext.get()},contextKeyService:this.contextMenuContextKeyService,getActionsContext:()=>({groupId:this.groupView.id,editorIndex:this.groupView.getIndexOfEditor(e)}),getKeyBinding:o=>this.keybindingService.lookupKeybinding(o.id,this.contextMenuContextKeyService),onHide:()=>this.groupsView.activeGroup.focus()})}getKeybinding(e){return this.keybindingService.lookupKeybinding(e.id,this.getEditorPaneAwareContextKeyService())}getKeybindingLabel(e){const t=this.getKeybinding(e);return t?t.getLabel()??void 0:void 0}get tabHeight(){return this.groupsView.partOptions.tabHeight!=="compact"?hT.EDITOR_TAB_HEIGHT.normal:hT.EDITOR_TAB_HEIGHT.compact}getHoverTitle(e){const t=e.getTitle(Ot.LONG);return this.tabsModel.isPinned(e)?t:{markdown:new Gi("",{supportThemeIcons:!0,isTrusted:!0}).appendText(t).appendMarkdown(' (_preview_ [$(gear)](command:workbench.action.openSettings?%5B%22workbench.editor.enablePreview%22%5D "Configure Preview Mode"))'),markdownNotSupportedFallback:t+" (preview)"}}updateTabHeight(){this.parent.style.setProperty("--editor-group-tab-height",`${this.tabHeight}px`)}updateOptions(e,t){e.tabHeight!==t.tabHeight&&this.updateTabHeight(),(e.editorActionsLocation!==t.editorActionsLocation||e.showTabs!==t.showTabs)&&this.editorActionsToolbarContainer&&(this.handleEditorActionToolBarVisibility(this.editorActionsToolbarContainer),this.updateEditorActionsToolbar())}};Ax=hT=f([p(5,bi),p(6,Z),p(7,fe),p(8,He),p(9,Dt),p(10,Wt),p(11,pt),p(12,mf),p(13,Hn)],Ax);class hue extends F{constructor(e){super(),this.model=e,this._onDidModelChange=this._register(new M),this.onDidModelChange=this._onDidModelChange.event,this._register(this.model.onDidModelChange(t=>{const i=t.editorIndex??t.editor;i!==void 0&&!this.filter(i)||this._onDidModelChange.fire(t)}))}get id(){return this.model.id}get isLocked(){return this.model.isLocked}get stickyCount(){return this.model.stickyCount}get activeEditor(){return this.model.activeEditor&&this.filter(this.model.activeEditor)?this.model.activeEditor:null}get previewEditor(){return this.model.previewEditor&&this.filter(this.model.previewEditor)?this.model.previewEditor:null}get selectedEditors(){return this.model.selectedEditors.filter(e=>this.filter(e))}isPinned(e){return this.model.isPinned(e)}isTransient(e){return this.model.isTransient(e)}isSticky(e){return this.model.isSticky(e)}isActive(e){return this.model.isActive(e)}isSelected(e){return this.model.isSelected(e)}isFirst(e){return this.model.isFirst(e,this.getEditors(Ii.SEQUENTIAL))}isLast(e){return this.model.isLast(e,this.getEditors(Ii.SEQUENTIAL))}getEditors(e,t){return this.model.getEditors(e,t).filter(n=>this.filter(n))}findEditor(e,t){const i=this.model.findEditor(e,t);if(i)return this.filter(i[1])?i:void 0}}class uue extends hue{get count(){return this.model.stickyCount}getEditors(e,t){return t?.excludeSticky?[]:e===Ii.SEQUENTIAL?this.model.getEditors(Ii.SEQUENTIAL).slice(0,this.model.stickyCount):super.getEditors(e,t)}isSticky(e){return!0}getEditorByIndex(e){return e<this.count?this.model.getEditorByIndex(e):void 0}indexOf(e,t,i){const n=this.model.indexOf(e,t,i);return n<0||n>=this.model.stickyCount?-1:n}contains(e,t){const i=this.model.indexOf(e,void 0,t);return i>=0&&i<this.model.stickyCount}filter(e){return this.model.isSticky(e)}}class gue extends hue{get count(){return this.model.count-this.model.stickyCount}get stickyCount(){return 0}isSticky(e){return!1}getEditors(e,t){return e===Ii.SEQUENTIAL?this.model.getEditors(Ii.SEQUENTIAL).slice(this.model.stickyCount):super.getEditors(e,t)}getEditorByIndex(e){return e>=0?this.model.getEditorByIndex(e+this.model.stickyCount):void 0}indexOf(e,t,i){const n=this.model.indexOf(e,t,i);return n<this.model.stickyCount||n>=this.model.count?-1:n-this.model.stickyCount}contains(e,t){const i=this.model.indexOf(e,void 0,t);return i>=this.model.stickyCount&&i<this.model.count}filter(e){return!this.model.isSticky(e)}}var Ba;Ve(J0e);let Rx=class extends Ax{static{Ba=this}static{this.SCROLLBAR_SIZES={default:3,large:10}}static{this.TAB_WIDTH={compact:38,shrink:80,fit:120}}static{this.DRAG_OVER_OPEN_TAB_THRESHOLD=1500}static{this.MOUSE_WHEEL_EVENT_THRESHOLD=150}static{this.MOUSE_WHEEL_DISTANCE_THRESHOLD=1.5}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C){super(e,t,i,n,o,r,a,c,d,l,u,g,w,C),this.editorService=m,this.pathService=v,this.treeViewsDragAndDropService=_,this.closeEditorAction=this._register(this.instantiationService.createInstance(XC,XC.ID,XC.LABEL)),this.unpinEditorAction=this._register(this.instantiationService.createInstance(Ip,Ip.ID,Ip.LABEL)),this.tabResourceLabels=this._register(this.instantiationService.createInstance(vd,PO)),this.tabLabels=[],this.tabActionBars=[],this.tabDisposables=[],this.dimensions={container:Ye.None,available:Ye.None},this.layoutScheduler=this._register(new Pt),this.path=bn?D_e:Yc,this.lastMouseWheelEventTime=0,this.isMouseOverTabs=!1,this.updateEditorLabelScheduler=this._register(new yn(()=>this.doUpdateEditorLabels(),0)),(async()=>this.path=await this.pathService.path)(),this._register(this.tabResourceLabels.onDidChangeDecorations(()=>this.doHandleDecorationsChange()))}create(e){return super.create(e),this.titleContainer=e,this.tabsAndActionsContainer=j(".tabs-and-actions-container"),this.titleContainer.appendChild(this.tabsAndActionsContainer),this.tabsContainer=j(".tabs-container",{role:"tablist",draggable:!0}),this._register(Dh.addTarget(this.tabsContainer)),this.tabSizingFixedDisposables=this._register(new U),this.updateTabSizing(!1),this.tabsScrollbar=this.createTabsScrollbar(this.tabsContainer),this.tabsAndActionsContainer.appendChild(this.tabsScrollbar.getDomNode()),this.registerTabsContainerListeners(this.tabsContainer,this.tabsScrollbar),this.createEditorActionsToolBar(this.tabsAndActionsContainer,["editor-actions"]),this.updateTabsControlVisibility(),this.tabsAndActionsContainer}createTabsScrollbar(e){const t=this._register(new Gne(e,{horizontal:cd.Auto,horizontalScrollbarSize:this.getTabsScrollbarSizing(),vertical:cd.Hidden,scrollYToX:!0,useShadows:!1}));return this._register(t.onScroll(i=>{i.scrollLeftChanged&&(e.scrollLeft=i.scrollLeft)})),t}updateTabsScrollbarSizing(){this.tabsScrollbar?.updateOptions({horizontalScrollbarSize:this.getTabsScrollbarSizing()})}updateTabSizing(e){const[t,i]=lm(this.tabsContainer,this.tabSizingFixedDisposables);i.clear();const n=this.groupsView.partOptions;n.tabSizing==="fixed"?(t.style.setProperty("--tab-sizing-fixed-min-width",`${n.tabSizingFixedMinWidth}px`),t.style.setProperty("--tab-sizing-fixed-max-width",`${n.tabSizingFixedMaxWidth}px`),i.add(re(t,pe.MOUSE_ENTER,()=>{this.isMouseOverTabs=!0})),i.add(re(t,pe.MOUSE_LEAVE,()=>{this.isMouseOverTabs=!1,this.updateTabsFixedWidth(!1)}))):e&&(t.style.removeProperty("--tab-sizing-fixed-min-width"),t.style.removeProperty("--tab-sizing-fixed-max-width"),this.updateTabsFixedWidth(!1))}updateTabsFixedWidth(e){this.forEachTab((t,i,n)=>{if(e){const{width:o}=n.getBoundingClientRect();n.style.setProperty("--tab-sizing-current-width",`${o}px`)}else n.style.removeProperty("--tab-sizing-current-width")})}getTabsScrollbarSizing(){return this.groupsView.partOptions.titleScrollbarSizing!=="large"?Ba.SCROLLBAR_SIZES.default:Ba.SCROLLBAR_SIZES.large}registerTabsContainerListeners(e,t){this._register(re(e,pe.SCROLL,()=>{e.classList.contains("scroll")&&t.setScrollPosition({scrollLeft:e.scrollLeft})}));for(const r of[Yo.Tap,pe.DBLCLICK])this._register(re(e,r,a=>{if(r===pe.DBLCLICK){if(a.target!==e)return}else if(a.tapCount!==2||a.initialTarget!==e)return;Vi.stop(a),this.editorService.openEditor({resource:void 0,options:{pinned:!0,index:this.groupView.count,override:id.id}},this.groupView.id)}));this._register(re(e,pe.MOUSE_DOWN,r=>{r.button===1&&r.preventDefault()})),fh&&this._register(re(e,pe.MOUSE_UP,r=>{r.button===1&&r.preventDefault()}));let i,n=!1;this._register(new Wp(e,{onDragStart:r=>{n=this.onGroupDragStart(r,e)},onDrag:r=>{i=r},onDragEnter:r=>{if(e.classList.add("scroll"),r.target===e){if(!this.isSupportedDropTransfer(r)){r.dataTransfer&&(r.dataTransfer.dropEffect="none");return}this.editorTransfer.hasData(Ac.prototype)||r.dataTransfer&&(r.dataTransfer.dropEffect="copy"),this.updateDropFeedback(e,!0,r)}},onDragLeave:r=>{this.updateDropFeedback(e,!1,r),e.classList.remove("scroll")},onDragEnd:r=>{this.updateDropFeedback(e,!1,r),e.classList.remove("scroll"),this.onGroupDragEnd(r,i,e,n)},onDrop:r=>{if(this.updateDropFeedback(e,!1,r),e.classList.remove("scroll"),r.target===e){const a=this.groupTransfer.hasData(lu.prototype);this.onDrop(r,a?this.groupView.count:this.tabsModel.count,e)}}})),this._register(re(e,pe.MOUSE_WHEEL,r=>{const a=this.groupView.activeEditor;if(!a||this.groupView.count<2)return;if(this.groupsView.partOptions.scrollToSwitchTabs===!0){if(r.shiftKey)return}else if(!r.shiftKey)return;const c=Date.now();if(c-this.lastMouseWheelEventTime<Ba.MOUSE_WHEEL_EVENT_THRESHOLD-2*(Math.abs(r.deltaX)+Math.abs(r.deltaY)))return;this.lastMouseWheelEventTime=c;let d;if(r.deltaX+r.deltaY<-Ba.MOUSE_WHEEL_DISTANCE_THRESHOLD)d=-1;else if(r.deltaX+r.deltaY>Ba.MOUSE_WHEEL_DISTANCE_THRESHOLD)d=1;else return;const l=this.groupView.getEditorByIndex(this.groupView.getIndexOfEditor(a)+d);l&&(this.groupView.openEditor(l),Vi.stop(r,!0))}));const o=r=>{Vi.stop(r);let a=e;op(r)&&(a=new bs(Et(this.parent),r)),this.contextMenuService.showContextMenu({getAnchor:()=>a,menuId:N.EditorTabsBarContext,contextKeyService:this.contextKeyService,menuActionOptions:{shouldForwardArgs:!0},getActionsContext:()=>({groupId:this.groupView.id}),getKeyBinding:c=>this.getKeybinding(c),onHide:()=>this.groupView.focus()})};this._register(re(e,Yo.Contextmenu,r=>o(r))),this._register(re(e,pe.CONTEXT_MENU,r=>o(r)))}doHandleDecorationsChange(){this.layout(this.dimensions)}updateEditorActionsToolbar(){super.updateEditorActionsToolbar(),this.layout(this.dimensions)}openEditor(e,t){const i=this.handleOpenedEditors();return t?.focusTabControl&&this.withTab(e,(n,o,r)=>r.focus()),i}openEditors(e){return this.handleOpenedEditors()}handleOpenedEditors(){this.updateTabsControlVisibility();const[e,t]=lm(this.tabsContainer,this.tabsScrollbar);for(let r=e.children.length;r<this.tabsModel.count;r++)e.appendChild(this.createTab(r,e,t));const i=this.didActiveEditorChange(),n=this.tabLabels;this.computeTabLabels();let o=!1;return i||n.length!==this.tabLabels.length||n.some((r,a)=>!this.equalsEditorInputLabel(r,this.tabLabels.at(a)))?(this.redraw({forceRevealActiveTab:!0}),o=!0):this.layout(this.dimensions,{forceRevealActiveTab:!0}),o}didActiveEditorChange(){return!!(!this.activeTabLabel?.editor&&this.tabsModel.activeEditor||this.activeTabLabel?.editor&&!this.tabsModel.activeEditor||!this.activeTabLabel?.editor||!this.tabsModel.isActive(this.activeTabLabel.editor))}equalsEditorInputLabel(e,t){return e===t?!0:!e||!t?!1:e.name===t.name&&e.description===t.description&&e.forceDescription===t.forceDescription&&e.title===t.title&&e.ariaLabel===t.ariaLabel}beforeCloseEditor(e){if(this.isMouseOverTabs&&this.groupsView.partOptions.tabSizing==="fixed"){const t=this.tabsModel.isLast(e);this.updateTabsFixedWidth(!t)}}closeEditor(e){this.handleClosedEditors()}closeEditors(e){this.handleClosedEditors()}handleClosedEditors(){if(this.tabsModel.count){const e=jt(this.tabsContainer);for(;e.children.length>this.tabsModel.count;)e.lastChild?.remove(),Xe(this.tabDisposables.pop());this.computeTabLabels(),this.redraw({forceRevealActiveTab:!0})}else this.tabsContainer&&Xi(this.tabsContainer),this.tabDisposables=Xe(this.tabDisposables),this.tabResourceLabels.clear(),this.tabLabels=[],this.activeTabLabel=void 0,this.tabActionBars=[],this.clearEditorActionsToolbar(),this.updateTabsControlVisibility()}moveEditor(e,t,i){const n=this.tabLabels[t];this.tabLabels.splice(t,1),this.tabLabels.splice(i,0,n),this.forEachTab((o,r,a,c,d,l)=>{this.redrawTab(o,r,a,c,d,l)},Math.min(t,i),Math.max(t,i)),this.layout(this.dimensions,{forceRevealActiveTab:!0})}pinEditor(e){this.withTab(e,(t,i,n,o,r)=>this.redrawTabLabel(t,i,n,o,r))}stickEditor(e){this.doHandleStickyEditorChange(e)}unstickEditor(e){this.doHandleStickyEditorChange(e)}doHandleStickyEditorChange(e){this.withTab(e,(t,i,n,o,r,a)=>this.redrawTab(t,i,n,o,r,a)),this.forEachTab((t,i,n,o,r)=>{this.redrawTabBorders(i,n)}),this.layout(this.dimensions,{forceRevealActiveTab:!0})}setActive(e){this.forEachTab((t,i,n,o,r,a)=>{this.redrawTabSelectedActiveAndDirty(e,t,n,a)}),this.updateEditorActionsToolbar(),this.layout(this.dimensions,{forceRevealActiveTab:!0})}updateEditorSelections(){this.forEachTab((e,t,i,n,o,r)=>{this.redrawTabSelectedActiveAndDirty(this.groupsView.activeGroup===this.groupView,e,i,r)})}updateEditorLabel(e){this.updateEditorLabelScheduler.schedule()}doUpdateEditorLabels(){this.computeTabLabels(),this.forEachTab((e,t,i,n,o)=>{this.redrawTabLabel(e,t,i,n,o)}),this.layout(this.dimensions)}updateEditorDirty(e){this.withTab(e,(t,i,n,o,r,a)=>this.redrawTabSelectedActiveAndDirty(this.groupsView.activeGroup===this.groupView,t,n,a))}updateOptions(e,t){super.updateOptions(e,t),e.labelFormat!==t.labelFormat&&this.computeTabLabels(),e.titleScrollbarSizing!==t.titleScrollbarSizing&&this.updateTabsScrollbarSizing(),e.alwaysShowEditorActions!==t.alwaysShowEditorActions&&this.updateEditorActionsToolbar(),(e.tabSizingFixedMinWidth!==t.tabSizingFixedMinWidth||e.tabSizingFixedMaxWidth!==t.tabSizingFixedMaxWidth||e.tabSizing!==t.tabSizing)&&this.updateTabSizing(!0),(e.labelFormat!==t.labelFormat||e.tabActionLocation!==t.tabActionLocation||e.tabActionCloseVisibility!==t.tabActionCloseVisibility||e.tabActionUnpinVisibility!==t.tabActionUnpinVisibility||e.tabSizing!==t.tabSizing||e.pinnedTabSizing!==t.pinnedTabSizing||e.showIcons!==t.showIcons||e.hasIcons!==t.hasIcons||e.highlightModifiedTabs!==t.highlightModifiedTabs||e.wrapTabs!==t.wrapTabs||!ic(e.decorations,t.decorations))&&this.redraw()}updateStyles(){this.redraw()}forEachTab(e,t,i){this.tabsModel.getEditors(Ii.SEQUENTIAL).forEach((n,o)=>{typeof t=="number"&&t>o||typeof i=="number"&&i<o||this.doWithTab(o,n,e)})}withTab(e,t){this.doWithTab(this.tabsModel.indexOf(e),e,t)}doWithTab(e,t,i){const o=jt(this.tabsContainer).children[e],r=this.tabResourceLabels.get(e),a=this.tabLabels[e],c=this.tabActionBars[e];o&&r&&a&&i(t,e,o,r,a,c)}createTab(e,t,i){const n=j(".tab",{draggable:!0,role:"tab"});this._register(Dh.addTarget(n));const o=j(".tab-border-top-container");n.appendChild(o);const r=this.tabResourceLabels.create(n,{hoverTargetOverride:n}),a=j(".tab-actions");n.appendChild(a);const c=this,d=new lue({groupId:this.groupView.id,get editorIndex(){return c.toEditorIndex(e)}}),l=new Ar(a,{ariaLabel:h(3323,"Tab actions"),actionRunner:d}),u=l.onWillRun(w=>{w.action.id===this.closeEditorAction.id&&this.blockRevealActiveTabOnce()}),g=Wo(d,l,u,Ie(k_e(this.tabActionBars,l))),m=j(".tab-fade-hider");n.appendChild(m);const v=j(".tab-border-bottom-container");n.appendChild(v);const _=this.registerTabListeners(n,e,t,i);return this.tabDisposables.push(Wo(_,g,d,r)),n}toEditorIndex(e){const t=jt(this.tabsModel.getEditorByIndex(e));return this.groupView.getIndexOfEditor(t)}registerTabListeners(e,t,i,n){const o=new U,r=async(l,u)=>{if(e.blur(),op(l)&&(l.button!==0||Yt&&l.ctrlKey)){l.button===1&&l.preventDefault();return}if(this.originatesFromTabActionBar(l))return;const g=this.tabsModel.getEditorByIndex(t);if(g)if(l.shiftKey){let m;if(this.lastSingleSelectSelectedEditor&&this.tabsModel.isSelected(this.lastSingleSelectSelectedEditor))m=this.lastSingleSelectSelectedEditor;else{const v=jt(this.groupView.activeEditor);this.lastSingleSelectSelectedEditor=v,m=v}await this.selectEditorsBetween(g,m)}else if(l.ctrlKey&&!Yt||l.metaKey&&Yt)this.tabsModel.isSelected(g)?await this.unselectEditor(g):(await this.selectEditor(g),this.lastSingleSelectSelectedEditor=g);else{const m=this.tabsModel.isSelected(g)?this.groupView.selectedEditors.filter(v=>!v.matches(g)):[];await this.groupView.openEditor(g,{preserveFocus:u,activation:qc.ACTIVATE},{inactiveSelection:m,focusTabControl:!0})}},a=l=>{Vi.stop(l);const u=this.tabsModel.getEditorByIndex(t);u&&this.onTabContextMenu(u,l,e)};o.add(re(e,pe.MOUSE_DOWN,l=>r(l,!1))),o.add(re(e,Yo.Tap,l=>r(l,!0))),o.add(re(e,Yo.Change,l=>{n.setScrollPosition({scrollLeft:n.getScrollPosition().scrollLeft-l.translationX})})),o.add(re(e,pe.MOUSE_UP,async l=>{if(Vi.stop(l),e.blur(),op(l)&&(l.button!==0||Yt&&l.ctrlKey)||this.originatesFromTabActionBar(l))return;!(l.ctrlKey&&!Yt||l.metaKey&&Yt)&&!l.shiftKey&&this.groupView.selectedEditors.length>1&&await this.unselectAllEditors()})),o.add(re(e,pe.AUXCLICK,l=>{if(l.button===1){Vi.stop(l,!0);const u=this.tabsModel.getEditorByIndex(t);if(u){if(gq(this.tabsModel,u,pq.MOUSE,this.groupsView.partOptions))return;this.blockRevealActiveTabOnce(),this.closeEditorAction.run({groupId:this.groupView.id,editorIndex:this.groupView.getIndexOfEditor(u)})}}})),o.add(re(e,pe.KEY_DOWN,l=>{const u=new vo(l);u.shiftKey&&u.keyCode===S.F10&&a(l)})),o.add(re(e,Yo.Contextmenu,l=>{a(l)})),o.add(re(e,pe.KEY_UP,l=>{const u=new vo(l);let g=!1;if(u.equals(S.Enter)||u.equals(S.Space)){g=!0;const m=this.tabsModel.getEditorByIndex(t);m&&this.groupView.openEditor(m)}else if([S.LeftArrow,S.RightArrow,S.UpArrow,S.DownArrow,S.Home,S.End].some(m=>u.equals(m))){let m=this.toEditorIndex(t);u.equals(S.LeftArrow)||u.equals(S.UpArrow)?m=m-1:u.equals(S.RightArrow)||u.equals(S.DownArrow)?m=m+1:u.equals(S.Home)?m=0:m=this.groupView.count-1;const v=this.groupView.getEditorByIndex(m);v&&(g=!0,this.groupView.openEditor(v,{preserveFocus:!0},{focusTabControl:!0}))}g&&Vi.stop(l,!0),n.setScrollPosition({scrollLeft:i.scrollLeft})}));for(const l of[Yo.Tap,pe.DBLCLICK])o.add(re(e,l,u=>{if(l===pe.DBLCLICK)Vi.stop(u);else if(u.tapCount!==2)return;const g=this.tabsModel.getEditorByIndex(t);if(g&&this.tabsModel.isPinned(g))switch(this.groupsView.partOptions.doubleClickTabToToggleEditorGroupSizes){case"maximize":this.groupsView.toggleMaximizeGroup(this.groupView);break;case"expand":this.groupsView.toggleExpandGroup(this.groupView);break}else this.groupView.pinEditor(g)}));o.add(re(e,pe.CONTEXT_MENU,l=>{Vi.stop(l,!0);const u=this.tabsModel.getEditorByIndex(t);u&&this.onTabContextMenu(u,l,e)},!0));let c,d=!1;return o.add(new Wp(e,{onDragStart:l=>{const u=this.tabsModel.getEditorByIndex(t);if(!u)return;d=this.isNewWindowOperation(l);const g=this.groupView.selectedEditors;if(this.editorTransfer.setData(g.map(m=>new Ac({editor:m,groupId:this.groupView.id})),Ac.prototype),l.dataTransfer)if(l.dataTransfer.effectAllowed="copyMove",g.length>1){const m=`${u.getName()} + ${g.length-1}`;JM(l,e,m)}else l.dataTransfer.setDragImage(e,0,0);this.doFillResourceDataTransfers(g,l,d),PE(Et(this.parent),()=>this.updateDropFeedback(e,!1,l,t))},onDrag:l=>{c=l},onDragEnter:l=>{if(!this.isSupportedDropTransfer(l)){l.dataTransfer&&(l.dataTransfer.dropEffect="none");return}this.editorTransfer.hasData(Ac.prototype)||l.dataTransfer&&(l.dataTransfer.dropEffect="copy"),this.updateDropFeedback(e,!0,l,t)},onDragOver:(l,u)=>{if(u>=Ba.DRAG_OVER_OPEN_TAB_THRESHOLD){const g=this.tabsModel.getEditorByIndex(t);g&&this.tabsModel.activeEditor!==g&&this.groupView.openEditor(g,{preserveFocus:!0})}this.updateDropFeedback(e,!0,l,t)},onDragEnd:async l=>{this.updateDropFeedback(e,!1,l,t);const u=this.editorTransfer.getData(Ac.prototype);if(this.editorTransfer.clearData(Ac.prototype),!d||iue()||!u||u.length===0)return;const g=await this.maybeCreateAuxiliaryEditorPartAt(l,e);if(!g)return;const m=g.activeGroup,v=Aq(this.groupView,u.map(_=>_.identifier.editor));this.isMoveOperation(c??l,m.id,u[0].identifier.editor)?this.groupView.moveEditors(v,m):this.groupView.copyEditors(v,m),m.focus()},onDrop:l=>{this.updateDropFeedback(e,!1,l,t);let u=t;this.getTabDragOverLocation(l,e)==="right"&&u++,this.onDrop(l,u,i)}})),o}isSupportedDropTransfer(e){if(this.groupTransfer.hasData(lu.prototype)){const t=this.groupTransfer.getData(lu.prototype);return!(Array.isArray(t)&&t.length>0&&t[0].identifier===this.groupView.id)}return!!(this.editorTransfer.hasData(Ac.prototype)||e.dataTransfer&&e.dataTransfer.types.length>0)}updateDropFeedback(e,t,i,n){const o=typeof n=="number";let r;t?o?r=this.computeDropTarget(i,n,e):r={leftElement:e.lastElementChild,rightElement:void 0}:r=void 0,this.updateDropTarget(r)}updateDropTarget(e){const t=this.dropTarget;if(t===e||t&&e&&t.leftElement===e.leftElement&&t.rightElement===e.rightElement)return;const i="drop-target-left",n="drop-target-right";t&&(t.leftElement?.classList.remove(i),t.rightElement?.classList.remove(n)),e&&(e.leftElement?.classList.add(i),e.rightElement?.classList.add(n)),this.dropTarget=e}getTabDragOverLocation(e,t){const i=t.getBoundingClientRect();return e.clientX-i.left<=i.width/2?"left":"right"}computeDropTarget(e,t,i){const n=this.getTabDragOverLocation(e,i)==="left",o=t===this.tabsModel.count-1;if(n&&t===0)return{leftElement:void 0,rightElement:i};if(!n&&o)return{leftElement:i,rightElement:void 0};const a=n?i.previousElementSibling:i,c=n?i:i.nextElementSibling;return{leftElement:a,rightElement:c}}async selectEditor(e){this.groupView.isActive(e)||await this.groupView.setSelection(e,this.groupView.selectedEditors)}async selectEditorsBetween(e,t){const i=this.groupView.getIndexOfEditor(e);if(i===-1)throw new tn;const n=this.groupView.getIndexOfEditor(t);if(n===-1)throw new tn;let o=this.groupView.selectedEditors,r=n;for(;r>=0&&r<=this.groupView.count-1;){r=n<i?r-1:r+1;const u=this.groupView.getEditorByIndex(r);if(!u||!this.groupView.isSelected(u))break;o=o.filter(g=>!g.matches(u))}const a=n<i?n:i,c=n<i?i:n,d=this.groupView.getEditors(Ii.SEQUENTIAL).slice(a,c+1);for(const u of d)this.groupView.isSelected(u)||o.push(u);const l=o.filter(u=>!u.matches(e));await this.groupView.setSelection(e,l)}async unselectEditor(e){const t=this.groupView.isActive(e);if(t&&this.groupView.selectedEditors.length===1)return;let i=jt(this.groupView.activeEditor);if(t){const o=this.groupView.getEditors(Ii.MOST_RECENTLY_ACTIVE);for(let r=1;r<o.length;r++){const a=o[r];if(this.groupView.isSelected(a)){i=a;break}}}const n=this.groupView.selectedEditors.filter(o=>!o.matches(e)&&!o.matches(i));await this.groupView.setSelection(i,n)}async unselectAllEditors(){if(this.groupView.selectedEditors.length>1){const e=jt(this.groupView.activeEditor);await this.groupView.setSelection(e,[])}}computeTabLabels(){const{labelFormat:e}=this.groupsView.partOptions,{verbosity:t,shortenDuplicates:i}=this.getLabelConfigFlags(e),n=[];let o=-1;this.tabsModel.getEditors(Ii.SEQUENTIAL).forEach((r,a)=>{n.push({editor:r,name:r.getName(),description:r.getDescription(t),forceDescription:r.hasCapability(Je.ForceDescription),title:r.getTitle(Ot.LONG),ariaLabel:M4(r,a,this.groupView,this.editorPartsView.count)}),r===this.tabsModel.activeEditor&&(o=a)}),i&&this.shortenTabLabels(n),this.tabLabels=n,this.activeTabLabel=n[o]}shortenTabLabels(e){const t=new Map;for(const i of e)typeof i.description=="string"?xk(t,i.name,[]).push(i):i.description="";for(const[,i]of t){if(i.length===1&&!i[0].forceDescription){i[0].description="";continue}const n=new Map;for(const c of i)xk(n,c.description,[]).push(c);let o=!1;for(const[,c]of n)if(!o&&c.length>1){const[d,...l]=c.map(({editor:u})=>u.getDescription(Ot.LONG));o=l.some(u=>u!==d)}if(o){n.clear();for(const c of i)c.description=c.editor.getDescription(Ot.LONG),xk(n,c.description,[]).push(c)}const r=[];for(const[c]of n)r.push(c);if(r.length===1){for(const c of n.get(r[0])||[])c.forceDescription||(c.description="");continue}const a=Lne(r,this.path.sep);r.forEach((c,d)=>{for(const l of n.get(c)||[])l.description=a[d]})}}getLabelConfigFlags(e){switch(e){case"short":return{verbosity:Ot.SHORT,shortenDuplicates:!1};case"medium":return{verbosity:Ot.MEDIUM,shortenDuplicates:!1};case"long":return{verbosity:Ot.LONG,shortenDuplicates:!1};default:return{verbosity:Ot.MEDIUM,shortenDuplicates:!0}}}redraw(e){if(this.tabsAndActionsContainer){let t=this.getColor(lxe);!t&&ly(this.theme.type)&&(t=this.getColor(tB)||this.getColor(tt)),t?(this.tabsAndActionsContainer.classList.add("tabs-border-bottom"),this.tabsAndActionsContainer.style.setProperty("--tabs-border-bottom-color",t.toString())):(this.tabsAndActionsContainer.classList.remove("tabs-border-bottom"),this.tabsAndActionsContainer.style.removeProperty("--tabs-border-bottom-color"))}this.forEachTab((t,i,n,o,r,a)=>{this.redrawTab(t,i,n,o,r,a)}),this.updateEditorActionsToolbar(),this.layout(this.dimensions,e)}redrawTab(e,t,i,n,o,r){const a=this.tabsModel.isSticky(t),c=this.groupsView.partOptions;this.redrawTabLabel(e,t,i,n,o);const d=a&&c.tabActionUnpinVisibility,l=!d&&c.tabActionCloseVisibility,u=d||l;let g;u?g=d?this.unpinEditorAction:this.closeEditorAction:g=a?this.unpinEditorAction:this.closeEditorAction,r.hasAction(g)||(r.isEmpty()||r.clear(),r.push(g,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(g)})),i.classList.toggle("pinned-action-off",a&&!d),i.classList.toggle("close-action-off",!d&&!l);for(const v of["left","right"])i.classList.toggle(`tab-actions-${v}`,u&&c.tabActionLocation===v);const m=a&&c.pinnedTabSizing==="shrink"?"shrink":c.tabSizing;for(const v of["fit","shrink","fixed"])i.classList.toggle(`sizing-${v}`,m===v);i.classList.toggle("has-icon",c.showIcons&&c.hasIcons),i.classList.toggle("sticky",a);for(const v of["normal","compact","shrink"])i.classList.toggle(`sticky-${v}`,a&&c.pinnedTabSizing===v);if(!c.wrapTabs&&a&&c.pinnedTabSizing!=="normal"){let v=0;switch(c.pinnedTabSizing){case"compact":v=Ba.TAB_WIDTH.compact;break;case"shrink":v=Ba.TAB_WIDTH.shrink;break}i.style.left=`${t*v}px`}else i.style.left="auto";this.redrawTabBorders(t,i),this.redrawTabSelectedActiveAndDirty(this.groupsView.activeGroup===this.groupView,e,i,r)}redrawTabLabel(e,t,i,n,o){const r=this.groupsView.partOptions;let a,c=!1,d=!!r.decorations?.badges;const l=!!r.decorations?.colors;let u;r.pinnedTabSizing==="compact"&&this.tabsModel.isSticky(t)?(a=r.showIcons&&r.hasIcons?"":o.name?.charAt(0).toUpperCase(),u="",c=!0,d=!1):(a=o.name,u=o.description||""),o.ariaLabel&&(i.setAttribute("aria-label",o.ariaLabel),i.setAttribute("aria-description","")),n.setResource({name:a,description:u,resource:Di.getOriginalUri(e,{supportSideBySide:qt.BOTH})},{title:this.getHoverTitle(e),extraClasses:$t(["tab-label",d?"tab-label-has-badge":void 0].concat(e.getLabelExtraClasses())),italic:!this.tabsModel.isPinned(e),forceLabel:c,fileDecorations:{colors:l,badges:d},icon:e.getIcon(),hideIcon:r.showIcons===!1});const g=Di.getOriginalUri(e,{supportSideBySide:qt.PRIMARY});g?i.setAttribute("data-resource-name",Zd(g)):i.removeAttribute("data-resource-name")}redrawTabSelectedActiveAndDirty(e,t,i,n){const o=this.tabsModel.isActive(t),r=this.doRedrawTabDirty(e,o,t,i);this.doRedrawTabActive(e,!r,t,i,n)}doRedrawTabActive(e,t,i,n,o){const r=this.tabsModel.isActive(i),a=this.tabsModel.isSelected(i);if(n.classList.toggle("active",r),n.classList.toggle("selected",a),n.setAttribute("aria-selected",r?"true":"false"),n.tabIndex=r?0:-1,o.setFocusable(r),r){const d=this.getColor(e?MA:nxe);n.classList.toggle("tab-border-bottom",!!d),n.style.setProperty("--tab-border-bottom-color",d??"")}let c=null;t&&(r&&(c=this.getColor(e?NA:sxe)),c===null&&a&&(c=this.getColor(oxe))),n.classList.toggle("tab-border-top",!!c),n.style.setProperty("--tab-border-top-color",c??"")}doRedrawTabDirty(e,t,i,n){let o=!1;if(i.isDirty()&&!i.isSaving())if(n.classList.add("dirty"),this.groupsView.partOptions.highlightModifiedTabs){let r;e&&t?r=this.getColor($E):e&&!t?r=this.getColor(nB):!e&&t?r=this.getColor(axe):r=this.getColor(cxe),r&&(o=!0,n.classList.add("dirty-border-top"),n.style.setProperty("--tab-dirty-border-top-color",r))}else n.classList.remove("dirty-border-top"),n.style.removeProperty("--tab-dirty-border-top-color");else n.classList.remove("dirty","dirty-border-top"),n.style.removeProperty("--tab-dirty-border-top-color");return o}redrawTabBorders(e,t){const n=this.tabsModel.isSticky(e)&&this.tabsModel.stickyCount===e+1,o=this.tabsModel.stickyCount!==this.tabsModel.count,r=(n&&o?this.getColor(ixe):void 0)||this.getColor(tB)||this.getColor(tt);t.style.borderRight=r?`1px solid ${r}`:"",t.style.outlineColor=this.getColor(kr)||""}prepareEditorActions(e){return this.groupsView.activeGroup===this.groupView?e:{primary:this.groupsView.partOptions.alwaysShowEditorActions?e.primary:e.primary.filter(i=>i.id===jO),secondary:e.secondary}}getHeight(){return this.dimensions.used?this.dimensions.used.height:this.computeHeight()}computeHeight(){let e;return this.visible?this.groupsView.partOptions.wrapTabs&&this.tabsAndActionsContainer?.classList.contains("wrapping")?e=this.tabsAndActionsContainer.offsetHeight:e=this.tabHeight:e=0,e}layout(e,t){if(Object.assign(this.dimensions,e),this.visible){if(!this.layoutScheduler.value){const i=PE(Et(this.parent),()=>{this.doLayout(this.dimensions,this.layoutScheduler.value?.options),this.layoutScheduler.clear()});this.layoutScheduler.value={options:t,dispose:()=>i.dispose()}}t?.forceRevealActiveTab&&(this.layoutScheduler.value.options={...this.layoutScheduler.value.options,forceRevealActiveTab:!0})}return this.dimensions.used||(this.dimensions.used=new Ye(e.container.width,this.computeHeight())),this.dimensions.used}doLayout(e,t){e.container!==Ye.None&&e.available!==Ye.None&&this.doLayoutTabs(e,t);const i=this.dimensions.used,n=this.dimensions.used=new Ye(e.container.width,this.computeHeight());i&&i.height!==n.height&&this.groupView.relayout()}doLayoutTabs(e,t){this.doLayoutTabsWrapping(e)||this.doLayoutTabsNonWrapping(t)}doLayoutTabsWrapping(e){const[t,i,n,o]=lm(this.tabsAndActionsContainer,this.tabsContainer,this.editorActionsToolbarContainer,this.tabsScrollbar),r=t.classList.contains("wrapping");let a=r;function c(d){a=d,t.classList.toggle("wrapping",a),i.style.setProperty("--last-tab-margin-right",a?`${n.offsetWidth}px`:"0");for(const l of i.children)l.classList.remove("last-in-row")}if(this.groupsView.partOptions.wrapTabs){const d=i.offsetWidth,l=i.scrollWidth,u=()=>{const g=this.getLastTab();return g?!(g.offsetWidth+n.offsetWidth-e.available.width>1):!0};(a||l>d&&u())&&c(!0),a&&(i.offsetHeight>e.available.height||l===d&&i.offsetHeight===this.tabHeight||!u())&&c(!1)}else r&&c(!1);if(a&&!r){const d=i.offsetWidth;o.setScrollDimensions({width:d,scrollWidth:d})}if(a){const d=new Map;let l,u;for(const g of i.children){const m=g,v=m.offsetTop;v!==l&&(l=v,u&&d.set(u,!0)),u=m,d.set(m,!1)}u&&d.set(u,!0);for(const[g,m]of d)g.classList.toggle("last-in-row",m)}return a}doLayoutTabsNonWrapping(e){const[t,i]=lm(this.tabsContainer,this.tabsScrollbar),n=t.offsetWidth,o=t.scrollWidth;let r=0;if(this.tabsModel.stickyCount>0){let A=0;switch(this.groupsView.partOptions.pinnedTabSizing){case"compact":A=Ba.TAB_WIDTH.compact;break;case"shrink":A=Ba.TAB_WIDTH.shrink;break}r=this.tabsModel.stickyCount*A}const a=this.tabsModel.activeEditor?this.getTabAndIndex(this.tabsModel.activeEditor):void 0,[c,d]=a??[void 0,void 0];let l=this.groupsView.partOptions.pinnedTabSizing!=="normal"&&typeof d=="number"&&this.tabsModel.isSticky(d),u=n-r;this.tabsModel.stickyCount>0&&u<Ba.TAB_WIDTH.fit?(t.classList.add("disable-sticky-tabs"),u=n,r=0,l=!1):t.classList.remove("disable-sticky-tabs");let g,m;!this.blockRevealActiveTab&&c&&(g=c.offsetLeft,m=c.offsetWidth);const{width:v,scrollWidth:_}=i.getScrollDimensions();i.setScrollDimensions({width:n,scrollWidth:o});const w=v!==n||_!==o;if(this.blockRevealActiveTab||typeof g!="number"||typeof m!="number"||l||!w&&!e?.forceRevealActiveTab){this.blockRevealActiveTab=!1;return}const C=i.getScrollPosition().scrollLeft,k=m<=u,D=g-r;k&&C+u<D+m?i.setScrollPosition({scrollLeft:C+(D+m-(C+u))}):(C>D||!k)&&i.setScrollPosition({scrollLeft:D})}updateTabsControlVisibility(){jt(this.tabsAndActionsContainer).classList.toggle("empty",!this.visible),!this.visible&&this.dimensions&&(this.dimensions.used=void 0)}get visible(){return this.tabsModel.count>0}getTabAndIndex(e){const t=this.tabsModel.indexOf(e),i=this.getTabAtIndex(t);if(i)return[i,t]}getTabAtIndex(e){if(e>=0)return jt(this.tabsContainer).children[e]}getLastTab(){return this.getTabAtIndex(this.tabsModel.count-1)}blockRevealActiveTabOnce(){this.blockRevealActiveTab=!0}originatesFromTabActionBar(e){let t;return op(e)?t=e.target||e.srcElement:t=e.initialTarget,!!WF(t,"action-item","tab")}async onDrop(e,t,i){Vi.stop(e,!0),this.updateDropFeedback(i,!1,e,t),i.classList.remove("scroll");let n=this.tabsModel instanceof gue?t+this.groupView.stickyCount:t;const o={sticky:this.tabsModel instanceof uue&&this.tabsModel.stickyCount===n,index:n};if(this.groupTransfer.hasData(lu.prototype)){const r=this.groupTransfer.getData(lu.prototype);if(Array.isArray(r)&&r.length>0){const a=this.editorPartsView.getGroup(r[0].identifier);if(a){const c={index:n};this.isMoveOperation(e,a.id)||(c.mode=FE.COPY_EDITORS),this.groupsView.mergeGroup(a,this.groupView,c)}this.groupView.focus(),this.groupTransfer.clearData(lu.prototype)}}else if(this.editorTransfer.hasData(Ac.prototype)){const r=this.editorTransfer.getData(Ac.prototype);if(Array.isArray(r)&&r.length>0){const a=this.editorPartsView.getGroup(r[0].identifier.groupId);if(a)for(const c of r){const d=c.identifier.editor;if(a.id!==c.identifier.groupId)continue;const l=a.getIndexOfEditor(d);a===this.groupView&&l<n&&n--,this.isMoveOperation(e,c.identifier.groupId,d)?a.moveEditor(d,this.groupView,{...o,index:n}):a.copyEditor(d,this.groupView,{...o,index:n}),n++}}this.groupView.focus(),this.editorTransfer.clearData(Ac.prototype)}else if(this.treeItemsTransfer.hasData(fC.prototype)){const r=this.treeItemsTransfer.getData(fC.prototype);if(Array.isArray(r)&&r.length>0){const a=[];for(const c of r){const d=await this.treeViewsDragAndDropService.removeDragOperationTransfer(c.identifier);if(d){const l=await g0e(d);a.push(...l.map(u=>({...u,options:{...u.options,pinned:!0,index:n}})))}}this.editorService.openEditors(a,this.groupView,{validateTrust:!0})}this.treeItemsTransfer.clearData(fC.prototype)}else this.instantiationService.createInstance($P,{allowWorkspaceOpen:!1}).handleDrop(e,Et(this.parent),()=>this.groupView,()=>this.groupView.focus(),o)}dispose(){super.dispose(),this.tabDisposables=Xe(this.tabDisposables)}};Rx=Ba=f([p(5,bi),p(6,Z),p(7,fe),p(8,He),p(9,Dt),p(10,Wt),p(11,pt),p(12,de),p(13,_c),p(14,kz),p(15,mf),p(16,Hn)],Rx);Fv((s,e)=>{const t=s.getColor(tB);t&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title > .tabs-and-actions-container.wrapping .tabs-container > .tab {
				border-bottom: 1px solid ${t};
			}
		`);const i=s.getColor(kr);i&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab.active,
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab.active:hover  {
				outline: 1px solid;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.selected:not(.active):not(:hover)  {
				outline: 1px dotted;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab.active:focus {
				outline-style: dashed;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.active {
				outline: 1px dotted;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:hover  {
				outline: 1px dashed;
				outline-offset: -5px;
			}

			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.active > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.active:hover > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.dirty > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab.sticky > .tab-actions .action-label,
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:hover > .tab-actions .action-label {
				opacity: 1 !important;
			}
		`);const n=s.getColor(tt);n&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .editor-actions {
				outline: 1px solid ${n}
			}
		`);const o=s.getColor(JW);o&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab:not(.selected):hover {
				background-color: ${o} !important;
			}
		`);const r=s.getColor(exe);r&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:not(.selected):hover  {
				background-color: ${r} !important;
			}
		`);const a=s.getColor(eB);a&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab:not(.selected):hover  {
				color: ${a} !important;
			}
		`);const c=s.getColor(txe);c&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:not(.selected):hover  {
				color: ${c} !important;
			}
		`);const d=s.getColor(iB);d&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container.active > .title .tabs-container > .tab:hover > .tab-border-bottom-container {
				display: block;
				position: absolute;
				left: 0;
				pointer-events: none;
				width: 100%;
				z-index: 10;
				bottom: 0;
				height: 1px;
				background-color: ${d};
			}
		`);const l=s.getColor(rxe);if(l&&e.addRule(`
			.monaco-workbench .part.editor > .content .editor-group-container > .title .tabs-container > .tab:hover > .tab-border-bottom-container  {
				display: block;
				position: absolute;
				left: 0;
				pointer-events: none;
				width: 100%;
				z-index: 10;
				bottom: 0;
				height: 1px;
				background-color: ${l};
			}
		`),!ly(s.type)&&!T_e&&!i){const u=QEe(s),g=s.getColor(ss),m=s.getColor(are),v=s.getColor(RN);let _;m&&g&&(_=m.flatten(g,g,u));let w;m&&g&&v&&g&&(w=m.flatten(g,v,g,u));const C=(Q,ie,oe=!1)=>`
			.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-shrink:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after,
			.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-fixed:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after {
				background: linear-gradient(to left, ${Q}, transparent) !important;
			}

			.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-shrink:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after,
			.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":""} > .title .tabs-container > .tab.sizing-fixed:not(.dragged):not(.sticky-compact):hover > .tab-label > .monaco-icon-label-container::after {
				background: linear-gradient(to left, ${ie}, transparent) !important;
			}
		`;if(o&&_&&w){const Q=o.flatten(_),ie=o.flatten(w);e.addRule(C(Q,ie,!0))}if(r&&_&&w){const Q=r.flatten(_),ie=r.flatten(w);e.addRule(C(Q,ie))}if(v&&w){const Q=v.flatten(w);e.addRule(`
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container.active > .title .tabs-container > .tab.sizing-shrink.dragged-over:not(.active):not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container:not(.active) > .title .tabs-container > .tab.sizing-shrink.dragged-over:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container.active > .title .tabs-container > .tab.sizing-fixed.dragged-over:not(.active):not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container:not(.active) > .title .tabs-container > .tab.sizing-fixed.dragged-over:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after {
					background: linear-gradient(to left, ${Q}, transparent) !important;
				}
		`)}const k=(Q,ie,oe,be)=>`
				.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-shrink${be?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content:not(.dragged-over) .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-fixed${be?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after {
					background: linear-gradient(to left, ${Q}, transparent);
				}

				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-shrink${be?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after,
				.monaco-workbench .part.editor > .content.dragged-over .editor-group-container${oe?".active":":not(.active)"} > .title .tabs-container > .tab.sizing-fixed${be?".active":""}:not(.dragged):not(.sticky-compact) > .tab-label > .monaco-icon-label-container::after {
					background: linear-gradient(to left, ${ie}, transparent);
				}
		`,D=s.getColor(xq);if(D&&_&&w){const Q=D.flatten(_),ie=D.flatten(w);e.addRule(k(Q,ie,!0,!0))}const A=s.getColor(XEe);if(A&&_&&w){const Q=A.flatten(_),ie=A.flatten(w);e.addRule(k(Q,ie,!1,!0))}const B=s.getColor(rre);if(B&&_&&w){const Q=B.flatten(_),ie=B.flatten(w);e.addRule(k(Q,ie,!0,!1))}const q=s.getColor(ZEe);if(q&&_&&w){const Q=q.flatten(_),ie=q.flatten(w);e.addRule(k(Q,ie,!1,!1))}}});const pue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(pue);class t1e extends Ax{constructor(){super(...arguments),this.activeLabel=Object.create(null)}get breadcrumbsControl(){return this.breadcrumbsControlFactory?.control}create(e){super.create(e);const t=this.titleContainer=e;t.draggable=!0,this.registerContainerListeners(t),this._register(Dh.addTarget(t));const i=j(".label-container");return t.appendChild(i),this.editorLabel=this._register(this.instantiationService.createInstance(TH,i,{})).element,this._register(re(this.editorLabel.element,pe.CLICK,n=>this.onTitleLabelClick(n))),this.breadcrumbsControlFactory=this._register(this.instantiationService.createInstance(eL,i,this.groupView,{showFileIcons:!1,showSymbolIcons:!0,showDecorationColors:!1,widgetStyles:{...$ne,breadcrumbsBackground:ye.transparent.toString()},showPlaceholder:!1,dragEditor:!0})),this._register(this.breadcrumbsControlFactory.onDidEnablementChange(()=>this.handleBreadcrumbsEnablementChange())),t.classList.toggle("breadcrumbs",!!this.breadcrumbsControl),this._register(Ie(()=>t.classList.remove("breadcrumbs"))),this.createEditorActionsToolBar(t,["title-actions"]),t}registerContainerListeners(e){let t,i=!1;this._register(new Wp(e,{onDragStart:n=>{i=this.onGroupDragStart(n,e)},onDrag:n=>{t=n},onDragEnd:n=>{this.onGroupDragEnd(n,t,e,i)}})),this._register(re(e,pe.DBLCLICK,n=>this.onTitleDoubleClick(n))),this._register(re(e,pe.AUXCLICK,n=>this.onTitleAuxClick(n))),this._register(re(e,Yo.Tap,n=>this.onTitleTap(n)));for(const n of[pe.CONTEXT_MENU,Yo.Contextmenu])this._register(re(e,n,o=>{this.tabsModel.activeEditor&&this.onTabContextMenu(this.tabsModel.activeEditor,o,e)}))}onTitleLabelClick(e){Vi.stop(e,!1),setTimeout(()=>this.quickInputService.quickAccess.show())}onTitleDoubleClick(e){Vi.stop(e),this.groupView.pinEditor()}onTitleAuxClick(e){e.button===1&&this.tabsModel.activeEditor&&(Vi.stop(e,!0),gq(this.tabsModel,this.tabsModel.activeEditor,pq.MOUSE,this.groupsView.partOptions)||this.groupView.closeEditor(this.tabsModel.activeEditor))}onTitleTap(e){const t=e.initialTarget;!Ph(t)||!this.editorLabel||!Hu(t,this.editorLabel.element)||setTimeout(()=>this.quickInputService.quickAccess.show(),50)}openEditor(e){return this.doHandleOpenEditor()}openEditors(e){return this.doHandleOpenEditor()}doHandleOpenEditor(){const e=this.ifActiveEditorChanged(()=>this.redraw());return e||this.ifActiveEditorPropertiesChanged(()=>this.redraw()),e}beforeCloseEditor(e){}closeEditor(e){this.ifActiveEditorChanged(()=>this.redraw())}closeEditors(e){this.ifActiveEditorChanged(()=>this.redraw())}moveEditor(e,t,i){this.ifActiveEditorChanged(()=>this.redraw())}pinEditor(e){this.ifEditorIsActive(e,()=>this.redraw())}stickEditor(e){}unstickEditor(e){}setActive(e){this.redraw()}updateEditorSelections(){}updateEditorLabel(e){this.ifEditorIsActive(e,()=>this.redraw())}updateEditorDirty(e){this.ifEditorIsActive(e,()=>{const t=jt(this.titleContainer);e.isDirty()&&!e.isSaving()?t.classList.add("dirty"):t.classList.remove("dirty")})}updateOptions(e,t){super.updateOptions(e,t),(e.labelFormat!==t.labelFormat||!ic(e.decorations,t.decorations))&&this.redraw()}updateStyles(){this.redraw()}handleBreadcrumbsEnablementChange(){jt(this.titleContainer).classList.toggle("breadcrumbs",!!this.breadcrumbsControl),this.redraw()}ifActiveEditorChanged(e){return!this.activeLabel.editor&&this.tabsModel.activeEditor||this.activeLabel.editor&&!this.tabsModel.activeEditor||!this.activeLabel.editor||!this.tabsModel.isActive(this.activeLabel.editor)?(e(),!0):!1}ifActiveEditorPropertiesChanged(e){!this.activeLabel.editor||!this.tabsModel.activeEditor||this.activeLabel.pinned!==this.tabsModel.isPinned(this.tabsModel.activeEditor)&&e()}ifEditorIsActive(e,t){this.tabsModel.isActive(e)&&t()}redraw(){const e=this.tabsModel.activeEditor??void 0,t=this.groupsView.partOptions,i=e?this.tabsModel.isPinned(e):!1,n=this.groupsView.activeGroup===this.groupView;this.activeLabel={editor:e,pinned:i},this.breadcrumbsControl&&(n?(this.breadcrumbsControl.update(),this.breadcrumbsControl.domNode.classList.toggle("preview",!i)):this.breadcrumbsControl.hide());const[o,r]=lm(this.titleContainer,this.editorLabel);if(!e)o.classList.remove("dirty"),r.clear(),this.clearEditorActionsToolbar();else{this.updateEditorDirty(e);const{labelFormat:a}=this.groupsView.partOptions;let c;this.breadcrumbsControl&&!this.breadcrumbsControl.isHidden()||a==="default"&&!n?c="":c=e.getDescription(this.getVerbosity(a))||"",r.setResource({resource:Di.getOriginalUri(e,{supportSideBySide:qt.BOTH}),name:e.getName(),description:c},{title:this.getHoverTitle(e),italic:!i,extraClasses:["single-tab","title-label"].concat(e.getLabelExtraClasses()),fileDecorations:{colors:!!t.decorations?.colors,badges:!!t.decorations?.badges},icon:e.getIcon(),hideIcon:t.showIcons===!1}),n?o.style.color=this.getColor(Gp)||"":o.style.color=this.getColor(JEe)||"",this.updateEditorActionsToolbar()}}getVerbosity(e){switch(e){case"short":return Ot.SHORT;case"long":return Ot.LONG;default:return Ot.MEDIUM}}prepareEditorActions(e){return this.groupsView.activeGroup===this.groupView?e:{primary:this.groupsView.partOptions.alwaysShowEditorActions?e.primary:e.primary.filter(i=>i.id===cS||i.id===jO),secondary:e.secondary}}getHeight(){return this.tabHeight}layout(e){return this.breadcrumbsControl?.layout(void 0),new Ye(e.container.width,this.getHeight())}}let u2=class extends F{constructor(e,t,i,n,o,r){super(),this.parent=e,this.groupsView=i,this.groupView=n,this.model=o,this.instantiationService=r;const a=this._register(new uue(this.model)),c=this._register(new gue(this.model));this.stickyEditorTabsControl=this._register(this.instantiationService.createInstance(Rx,this.parent,t,this.groupsView,this.groupView,a)),this.unstickyEditorTabsControl=this._register(this.instantiationService.createInstance(Rx,this.parent,t,this.groupsView,this.groupView,c)),this.handleTabBarsStateChange()}handleTabBarsStateChange(){this.activeControl=this.model.activeEditor?this.getEditorTabsController(this.model.activeEditor):void 0,this.handleTabBarsLayoutChange()}handleTabBarsLayoutChange(){if(this.groupView.count===0)return;const e=this.parent.classList.contains("two-tab-bars"),t=this.groupView.count!==this.groupView.stickyCount&&this.groupView.stickyCount>0;this.parent.classList.toggle("two-tab-bars",t),e!==t&&this.groupView.relayout()}didActiveControlChange(){return this.activeControl!==(this.model.activeEditor?this.getEditorTabsController(this.model.activeEditor):void 0)}getEditorTabsController(e){return this.model.isSticky(e)?this.stickyEditorTabsControl:this.unstickyEditorTabsControl}openEditor(e,t){const i=this.didActiveControlChange(),o=this.getEditorTabsController(e).openEditor(e,t)||i;return o&&this.handleOpenedEditors(),o}openEditors(e){const t=e.filter(c=>this.model.isSticky(c)),i=e.filter(c=>!this.model.isSticky(c)),n=this.didActiveControlChange(),o=this.stickyEditorTabsControl.openEditors(t),r=this.unstickyEditorTabsControl.openEditors(i),a=o||r||n;return a&&this.handleOpenedEditors(),a}handleOpenedEditors(){this.handleTabBarsStateChange()}beforeCloseEditor(e){this.getEditorTabsController(e).beforeCloseEditor(e)}closeEditor(e){this.stickyEditorTabsControl.closeEditor(e),this.unstickyEditorTabsControl.closeEditor(e),this.handleClosedEditors()}closeEditors(e){const t=e.filter(n=>this.model.isSticky(n)),i=e.filter(n=>!this.model.isSticky(n));this.stickyEditorTabsControl.closeEditors(t),this.unstickyEditorTabsControl.closeEditors(i),this.handleClosedEditors()}handleClosedEditors(){this.handleTabBarsStateChange()}moveEditor(e,t,i,n){n?(this.model.isSticky(e)?(this.stickyEditorTabsControl.openEditor(e),this.unstickyEditorTabsControl.closeEditor(e)):(this.stickyEditorTabsControl.closeEditor(e),this.unstickyEditorTabsControl.openEditor(e)),this.handleTabBarsStateChange()):this.model.isSticky(e)?this.stickyEditorTabsControl.moveEditor(e,t,i,n):this.unstickyEditorTabsControl.moveEditor(e,t-this.model.stickyCount,i-this.model.stickyCount,n)}pinEditor(e){this.getEditorTabsController(e).pinEditor(e)}stickEditor(e){this.unstickyEditorTabsControl.closeEditor(e),this.stickyEditorTabsControl.openEditor(e),this.handleTabBarsStateChange()}unstickEditor(e){this.stickyEditorTabsControl.closeEditor(e),this.unstickyEditorTabsControl.openEditor(e),this.handleTabBarsStateChange()}setActive(e){this.stickyEditorTabsControl.setActive(e),this.unstickyEditorTabsControl.setActive(e)}updateEditorSelections(){this.stickyEditorTabsControl.updateEditorSelections(),this.unstickyEditorTabsControl.updateEditorSelections()}updateEditorLabel(e){this.getEditorTabsController(e).updateEditorLabel(e)}updateEditorDirty(e){this.getEditorTabsController(e).updateEditorDirty(e)}updateOptions(e,t){this.stickyEditorTabsControl.updateOptions(e,t),this.unstickyEditorTabsControl.updateOptions(e,t)}layout(e){const t=this.stickyEditorTabsControl.layout(e),i={container:e.container,available:new Ye(e.available.width,e.available.height-t.height)},n=this.unstickyEditorTabsControl.layout(i);return new Ye(e.container.width,t.height+n.height)}getHeight(){return this.stickyEditorTabsControl.getHeight()+this.unstickyEditorTabsControl.getHeight()}dispose(){this.parent.classList.toggle("two-tab-bars",!1),super.dispose()}};u2=f([p(5,Z)],u2);Ve(pue);class i1e extends Ax{constructor(){super(...arguments),this.activeEditor=null}prepareEditorActions(e){return{primary:[],secondary:[]}}openEditor(e){return this.handleOpenedEditors()}openEditors(e){return this.handleOpenedEditors()}handleOpenedEditors(){const e=this.activeEditorChanged();return this.activeEditor=this.tabsModel.activeEditor,e}activeEditorChanged(){return!!(!this.activeEditor&&this.tabsModel.activeEditor||this.activeEditor&&!this.tabsModel.activeEditor||!this.activeEditor||!this.tabsModel.isActive(this.activeEditor))}beforeCloseEditor(e){}closeEditor(e){this.handleClosedEditors()}closeEditors(e){this.handleClosedEditors()}handleClosedEditors(){this.activeEditor=this.tabsModel.activeEditor}moveEditor(e,t,i){}pinEditor(e){}stickEditor(e){}unstickEditor(e){}setActive(e){}updateEditorSelections(){}updateEditorLabel(e){}updateEditorDirty(e){}getHeight(){return 0}layout(e){return new Ye(e.container.width,this.getHeight())}}Ve($0e);let g2=class extends ww{get breadcrumbsControl(){return this.breadcrumbsControlFactory?.control}constructor(e,t,i,n,o,r,a){super(a),this.parent=e,this.editorPartsView=t,this.groupsView=i,this.groupView=n,this.model=o,this.instantiationService=r,this.editorTabsControlDisposable=this._register(new U),this.breadcrumbsControlDisposables=this._register(new U),this.editorTabsControl=this.createEditorTabsControl(),this.breadcrumbsControlFactory=this.createBreadcrumbsControl()}createEditorTabsControl(){let e;switch(this.groupsView.partOptions.showTabs){case"none":e=i1e;break;case"single":e=t1e;break;case"multiple":default:e=this.groupsView.partOptions.pinnedTabsOnSeparateRow?u2:Rx;break}const t=this.instantiationService.createInstance(e,this.parent,this.editorPartsView,this.groupsView,this.groupView,this.model);return this.editorTabsControlDisposable.add(t)}createBreadcrumbsControl(){if(this.groupsView.partOptions.showTabs==="single")return;const e=j(".breadcrumbs-below-tabs");this.parent.appendChild(e);const t=this.breadcrumbsControlDisposables.add(this.instantiationService.createInstance(eL,e,this.groupView,{showFileIcons:!0,showSymbolIcons:!0,showDecorationColors:!1,showPlaceholder:!0,dragEditor:!1}));return this.breadcrumbsControlDisposables.add(t.onDidEnablementChange(()=>this.groupView.relayout())),this.breadcrumbsControlDisposables.add(t.onDidVisibilityChange(()=>this.groupView.relayout())),t}openEditor(e,t){const i=this.editorTabsControl.openEditor(e,t);this.handleOpenedEditors(i)}openEditors(e){const t=this.editorTabsControl.openEditors(e);this.handleOpenedEditors(t)}handleOpenedEditors(e){e?this.breadcrumbsControl?.update():this.breadcrumbsControl?.revealLast()}beforeCloseEditor(e){return this.editorTabsControl.beforeCloseEditor(e)}closeEditor(e){this.editorTabsControl.closeEditor(e),this.handleClosedEditors()}closeEditors(e){this.editorTabsControl.closeEditors(e),this.handleClosedEditors()}handleClosedEditors(){this.groupView.activeEditor||this.breadcrumbsControl?.update()}moveEditor(e,t,i,n){return this.editorTabsControl.moveEditor(e,t,i,n)}pinEditor(e){return this.editorTabsControl.pinEditor(e)}stickEditor(e){return this.editorTabsControl.stickEditor(e)}unstickEditor(e){return this.editorTabsControl.unstickEditor(e)}setActive(e){return this.editorTabsControl.setActive(e)}updateEditorSelections(){this.editorTabsControl.updateEditorSelections()}updateEditorLabel(e){return this.editorTabsControl.updateEditorLabel(e)}updateEditorDirty(e){return this.editorTabsControl.updateEditorDirty(e)}updateOptions(e,t){e.showTabs!==t.showTabs||t.showTabs!=="single"&&e.pinnedTabsOnSeparateRow!==t.pinnedTabsOnSeparateRow?(this.editorTabsControlDisposable.clear(),this.breadcrumbsControlDisposables.clear(),Xi(this.parent),this.editorTabsControl=this.createEditorTabsControl(),this.breadcrumbsControlFactory=this.createBreadcrumbsControl()):this.editorTabsControl.updateOptions(e,t)}layout(e){const t=this.editorTabsControl.layout(e);let i;return this.breadcrumbsControl?.isHidden()===!1&&(i=new Ye(e.container.width,Rn.HEIGHT),this.breadcrumbsControl.layout(i)),new Ye(e.container.width,t.height+(i?i.height:0))}getHeight(){const e=this.editorTabsControl.getHeight(),t=this.breadcrumbsControl?.isHidden()===!1?Rn.HEIGHT:0;return{total:e+t,offset:e}}};g2=f([p(5,Z),p(6,pt)],g2);var Bg;Ve(D0e);let tL=Bg=class extends ww{static createNew(e,t,i,n,o,r){return o.createInstance(Bg,null,e,t,i,n,r)}static createFromSerialized(e,t,i,n,o,r,a){return r.createInstance(Bg,e,t,i,n,o,a)}static createCopy(e,t,i,n,o,r,a){return r.createInstance(Bg,e,t,i,n,o,a)}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A,B,q){super(d),this.editorPartsView=t,this.groupsView=i,this.groupsLabel=n,this._index=o,this.instantiationService=a,this.contextKeyService=c,this.telemetryService=l,this.keybindingService=u,this.menuService=g,this.contextMenuService=m,this.fileDialogService=v,this.editorService=_,this.filesConfigurationService=w,this.uriIdentityService=C,this.logService=k,this.editorResolverService=D,this.hostService=A,this.dialogService=B,this.fileService=q,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onWillDispose=this._register(new M),this.onWillDispose=this._onWillDispose.event,this._onDidModelChange=this._register(new M),this.onDidModelChange=this._onDidModelChange.event,this._onDidActiveEditorChange=this._register(new M),this.onDidActiveEditorChange=this._onDidActiveEditorChange.event,this._onDidOpenEditorFail=this._register(new M),this.onDidOpenEditorFail=this._onDidOpenEditorFail.event,this._onWillCloseEditor=this._register(new M),this.onWillCloseEditor=this._onWillCloseEditor.event,this._onDidCloseEditor=this._register(new M),this.onDidCloseEditor=this._onDidCloseEditor.event,this._onWillMoveEditor=this._register(new M),this.onWillMoveEditor=this._onWillMoveEditor.event,this._onWillOpenEditor=this._register(new M),this.onWillOpenEditor=this._onWillOpenEditor.event,this.disposedEditorsWorker=this._register(new Hz(ie=>this.handleDisposedEditors(ie),0)),this.mapEditorToPendingConfirmation=new Map,this.containerToolBarMenuDisposable=this._register(new Pt),this.whenRestoredPromise=new aa,this.whenRestored=this.whenRestoredPromise.p,this._disposed=!1,this.element=j("div"),this._onDidChange=this._register(new Pne),this.onDidChange=this._onDidChange.event,e instanceof Bg?this.model=this._register(e.model.clone()):oue(e)?this.model=this._register(a.createInstance(KP,e)):this.model=this._register(a.createInstance(KP,void 0)),this.scopedContextKeyService=this._register(this.contextKeyService.createScoped(this.element)),this.element.classList.add(...$t(["editor-group-container",this.model.isLocked?"locked":void 0])),this.registerContainerListeners(),this.createContainerToolbar(),this.createContainerContextMenu(),this._register(this.instantiationService.createInstance(i2,this.element)),this.progressBar=this._register(new One(this.element,Fne)),this.progressBar.hide(),this.scopedInstantiationService=this._register(this.instantiationService.createChild(new uf([fe,this.scopedContextKeyService],[Uu,this._register(new b0e(this.progressBar,this))]))),this.resourceContext=this._register(this.scopedInstantiationService.createInstance(hi)),this.handleGroupContextKeys(),this.titleContainer=j(".title"),this.element.appendChild(this.titleContainer),this.titleControl=this._register(this.scopedInstantiationService.createInstance(g2,this.titleContainer,this.editorPartsView,this.groupsView,this,this.model)),this.editorContainer=j(".editor-container"),this.element.appendChild(this.editorContainer),this.editorPane=this._register(this.scopedInstantiationService.createInstance(t2,this.element,this.editorContainer,this)),this._onDidChange.input=this.editorPane.onDidChangeSizeConstraints,this.doTrackFocus(),this.updateTitleContainer(),this.updateContainer(),this.updateStyles(),(this.restoreEditors(e,r)??Promise.resolve()).finally(()=>{this.whenRestoredPromise.complete()}),this.registerListeners()}handleGroupContextKeys(){const e=this.editorPartsView.bind(oCe,this),t=this.editorPartsView.bind(goe,this),i=this.editorPartsView.bind(poe,this),n=this.editorPartsView.bind(foe,this),o=this.editorPartsView.bind(uA,this),r=this.editorPartsView.bind(rCe,this),a=this.editorPartsView.bind(hA,this),c=voe.bindTo(this.scopedContextKeyService),d=_oe.bindTo(this.scopedContextKeyService),l=boe.bindTo(this.scopedContextKeyService),u=this.editorPartsView.bind($v,this),g=this.editorPartsView.bind(aCe,this),m=this.editorPartsView.bind(yoe,this),v=this.editorPartsView.bind(loe,this),_=this.editorPartsView.bind(doe,this),w=this.editorPartsView.bind(tW,this),C=this.editorPartsView.bind(Fb,this),k=this.editorPartsView.bind(_I,this),D=this.editorPartsView.bind(CC,this),A=this.editorPartsView.bind(mu,this),B=this._register(new Pt),q=()=>{B.clear(),this.scopedContextKeyService.bufferChangeEvents(()=>{const ie=this.activeEditor,oe=this.activeEditorPane;if(this.resourceContext.set(Di.getOriginalUri(ie,{supportSideBySide:qt.PRIMARY})),moe(k,ie,this.editorResolverService),ie?(D.set(ie.hasCapability(Je.CanSplitInGroup)),A.set(ie.typeId===ks.ID),e.set(ie.isDirty()&&!ie.isSaving()),B.value=ie.onDidChangeDirty(()=>{e.set(ie.isDirty()&&!ie.isSaving())})):(D.set(!1),A.set(!1),e.set(!1)),oe){u.set(oe.getId()),m.set(!oe.input.hasCapability(Je.Untitled)),g.set(!!oe.input.isReadonly());const be=Di.getOriginalUri(oe.input,{supportSideBySide:qt.PRIMARY}),me=Di.getOriginalUri(oe.input,{supportSideBySide:qt.SECONDARY});_.set(oe.input instanceof go&&!oe.input.original.isReadonly()&&!!be&&(this.fileService.hasProvider(be)||be.scheme===ae.untitled)&&!!me&&(this.fileService.hasProvider(me)||me.scheme===ae.untitled)),v.set(!!be&&this.fileService.hasProvider(be)&&!this.fileService.hasCapability(be,hh.Readonly));const zt=oe?.getId()===lq;C.set(zt),w.set(zt)}else u.reset(),m.reset(),g.reset(),_.reset(),v.reset()})},Q=ie=>{switch(ie.kind){case ct.GROUP_LOCKED:a.set(this.isLocked);break;case ct.EDITOR_ACTIVE:i.set(this.model.isFirst(this.model.activeEditor)),n.set(this.model.isLast(this.model.activeEditor)),t.set(this.model.activeEditor?this.model.isPinned(this.model.activeEditor):!1),o.set(this.model.activeEditor?this.model.isSticky(this.model.activeEditor):!1);break;case ct.EDITOR_CLOSE:t.set(this.model.activeEditor?this.model.isPinned(this.model.activeEditor):!1),o.set(this.model.activeEditor?this.model.isSticky(this.model.activeEditor):!1);case ct.EDITOR_OPEN:case ct.EDITOR_MOVE:i.set(this.model.isFirst(this.model.activeEditor)),n.set(this.model.isLast(this.model.activeEditor));break;case ct.EDITOR_PIN:ie.editor&&ie.editor===this.model.activeEditor&&t.set(this.model.isPinned(this.model.activeEditor));break;case ct.EDITOR_STICKY:ie.editor&&ie.editor===this.model.activeEditor&&o.set(this.model.isSticky(this.model.activeEditor));break;case ct.EDITORS_SELECTION:c.set(this.model.selectedEditors.length>1),d.set(this.model.selectedEditors.length===2),l.set(this.model.selectedEditors.every(oe=>oe.resource&&(this.fileService.hasProvider(oe.resource)||oe.resource.scheme===ae.untitled)));break}r.set(this.count)};this._register(this.onDidModelChange(ie=>Q(ie))),this._register(this.onDidActiveEditorChange(()=>q())),q(),Q({kind:ct.EDITOR_ACTIVE}),Q({kind:ct.GROUP_LOCKED})}registerContainerListeners(){this._register(re(this.element,pe.DBLCLICK,e=>{this.isEmpty&&(Vi.stop(e),this.editorService.openEditor({resource:void 0,options:{pinned:!0,override:id.id}},this.id))})),this._register(re(this.element,pe.AUXCLICK,e=>{this.isEmpty&&e.button===1&&(Vi.stop(e,!0),this.groupsView.removeGroup(this))}))}createContainerToolbar(){const e=j(".editor-group-container-toolbar");this.element.appendChild(e);const t=this._register(new Ar(e,{ariaLabel:h(3227,"Empty editor group actions"),highlightToggledItems:!0})),i=this._register(this.menuService.createMenu(N.EmptyEditorGroup,this.scopedContextKeyService)),n=()=>{this.containerToolBarMenuDisposable.value=Ie(()=>t.clear());const o=Xm(i.getActions({arg:{groupId:this.id},shouldForwardArgs:!0}),"navigation");for(const r of[...o.primary,...o.secondary]){const a=this.keybindingService.lookupKeybinding(r.id);t.push(r,{icon:!0,label:!1,keybinding:a?.getLabel()})}};n(),this._register(i.onDidChange(n))}createContainerContextMenu(){this._register(re(this.element,pe.CONTEXT_MENU,e=>this.onShowContainerContextMenu(e))),this._register(re(this.element,Yo.Contextmenu,()=>this.onShowContainerContextMenu()))}onShowContainerContextMenu(e){if(!this.isEmpty)return;let t=this.element;e&&(t=new bs(Et(this.element),e)),this.contextMenuService.showContextMenu({menuId:N.EmptyEditorGroupContext,contextKeyService:this.contextKeyService,getAnchor:()=>t,onHide:()=>this.focus()})}doTrackFocus(){const e=this._register(Fo(this.element));this._register(e.onDidFocus(()=>{this.isEmpty&&this._onDidFocus.fire()}));const t=i=>{let n;if(op(i)){if(i.button!==0||Yt&&i.ctrlKey)return;n=i.target}else n=i.initialTarget;WF(n,"monaco-action-bar",this.titleContainer)||WF(n,"monaco-breadcrumb-item",this.titleContainer)||setTimeout(()=>{this.focus()})};this._register(re(this.titleContainer,pe.MOUSE_DOWN,i=>t(i))),this._register(re(this.titleContainer,Yo.Tap,i=>t(i))),this._register(this.editorPane.onDidFocus(()=>{this._onDidFocus.fire()}))}updateContainer(){this.isEmpty?(this.element.classList.add("empty"),this.element.tabIndex=0,this.element.setAttribute("aria-label",h(3228,"{0} (empty)",this.ariaLabel))):(this.element.classList.remove("empty"),this.element.removeAttribute("tabIndex"),this.element.removeAttribute("aria-label")),this.updateStyles()}updateTitleContainer(){this.titleContainer.classList.toggle("tabs",this.groupsView.partOptions.showTabs==="multiple"),this.titleContainer.classList.toggle("show-file-icons",this.groupsView.partOptions.showIcons)}restoreEditors(e,t){if(this.count===0)return;let i;e instanceof Bg?i=mj(e):i=Object.create(null);const n=this.model.activeEditor;if(!n)return;i.pinned=this.model.isPinned(n),i.sticky=this.model.isSticky(n),i.preserveFocus=!0;const o={preserveWindowOrder:!0,skipTitleUpdate:!0},r=wh(),a=this.doShowEditor(n,{active:!0,isNew:!1},i,o).then(()=>{this.groupsView.activeGroup===this&&r&&hf(r)&&!t?.preserveFocus&&this.focus()});return this.titleControl.openEditors(this.editors),a}registerListeners(){this._register(this.model.onDidModelChange(e=>this.onDidGroupModelChange(e))),this._register(this.groupsView.onDidChangeEditorPartOptions(e=>this.onDidChangeEditorPartOptions(e))),this._register(this.groupsView.onDidVisibilityChange(e=>this.onDidVisibilityChange(e))),this._register(this.onDidFocus(()=>this.onDidGainFocus()))}onDidGroupModelChange(e){switch(this._onDidModelChange.fire(e),e.kind){case ct.GROUP_LOCKED:this.element.classList.toggle("locked",this.isLocked);break;case ct.EDITORS_SELECTION:this.onDidChangeEditorSelection();break}if(e.editor)switch(e.kind){case ct.EDITOR_OPEN:k0e(e)&&this.onDidOpenEditor(e.editor,e.editorIndex);break;case ct.EDITOR_CLOSE:A0e(e)&&this.handleOnDidCloseEditor(e.editor,e.editorIndex,e.context,e.sticky);break;case ct.EDITOR_WILL_DISPOSE:this.onWillDisposeEditor(e.editor);break;case ct.EDITOR_DIRTY:this.onDidChangeEditorDirty(e.editor);break;case ct.EDITOR_TRANSIENT:this.onDidChangeEditorTransient(e.editor);break;case ct.EDITOR_LABEL:this.onDidChangeEditorLabel(e.editor);break}}onDidOpenEditor(e,t){this.telemetryService.publicLog("editorOpened",this.toEditorTelemetryDescriptor(e)),this.updateContainer()}handleOnDidCloseEditor(e,t,i,n){this._onWillCloseEditor.fire({groupId:this.id,editor:e,context:i,index:t,sticky:n});const o=[e];e instanceof ks&&o.push(e.primary,e.secondary);for(const r of o)this.canDispose(r)&&r.dispose();this.updateContainer(),this._onDidCloseEditor.fire({groupId:this.id,editor:e,context:i,index:t,sticky:n})}canDispose(e){for(const t of this.editorPartsView.groups)if(t instanceof Bg&&t.model.contains(e,{strictEquals:!0,supportSideBySide:qt.ANY}))return!1;return!0}toResourceTelemetryDescriptor(e){if(!e)return;const t=e?e.scheme===ae.file?e.fsPath:e.path:void 0;if(!t)return;let i=YM(e);const n=i.indexOf("?");return i=n!==-1?i.substr(0,n):i,{mimeType:new A_e(R_e(e).join(", ")),scheme:e.scheme,ext:i,path:lc(t)}}toEditorTelemetryDescriptor(e){const t=e.getTelemetryDescriptor(),i=Di.getOriginalUri(e,{supportSideBySide:qt.BOTH});return R.isUri(i)?(t.resource=this.toResourceTelemetryDescriptor(i),t):(i&&(i.primary&&(t.resource=this.toResourceTelemetryDescriptor(i.primary)),i.secondary&&(t.resourceSecondary=this.toResourceTelemetryDescriptor(i.secondary))),t)}onWillDisposeEditor(e){this.disposedEditorsWorker.work(e)}handleDisposedEditors(e){let t;const i=[];for(const n of e){const o=this.model.findEditor(n);if(!o)continue;const r=o[0];r.isDisposed()&&(this.model.isActive(r)?t=r:i.push(r))}for(const n of i)this.doCloseEditor(n,!0);t&&this.doCloseEditor(t,!0)}onDidChangeEditorPartOptions(e){this.updateTitleContainer(),this.titleControl.updateOptions(e.oldPartOptions,e.newPartOptions),(e.oldPartOptions.showTabs!==e.newPartOptions.showTabs||e.oldPartOptions.tabHeight!==e.newPartOptions.tabHeight||e.oldPartOptions.showTabs==="multiple"&&e.oldPartOptions.pinnedTabsOnSeparateRow!==e.newPartOptions.pinnedTabsOnSeparateRow)&&(this.relayout(),this.model.activeEditor&&this.titleControl.openEditors(this.model.getEditors(Ii.SEQUENTIAL))),this.updateStyles(),e.oldPartOptions.enablePreview&&!e.newPartOptions.enablePreview&&this.model.previewEditor&&this.pinEditor(this.model.previewEditor)}onDidChangeEditorDirty(e){this.pinEditor(e),this.titleControl.updateEditorDirty(e)}onDidChangeEditorTransient(e){!this.model.isTransient(e)&&!this.groupsView.partOptions.enablePreview&&this.pinEditor(e)}onDidChangeEditorLabel(e){this.titleControl.updateEditorLabel(e)}onDidChangeEditorSelection(){this.titleControl.updateEditorSelections()}onDidVisibilityChange(e){this.editorPane.setVisible(e)}onDidGainFocus(){this.activeEditor&&this.model.setTransient(this.activeEditor,!1)}get index(){return this._index}get label(){return this.groupsLabel?h(3229,"{0}: Group {1}",this.groupsLabel,this._index+1):h(3230,"Group {0}",this._index+1)}get ariaLabel(){return this.groupsLabel?h(3231,"{0}: Editor Group {1}",this.groupsLabel,this._index+1):h(3232,"Editor Group {0}",this._index+1)}get disposed(){return this._disposed}get isEmpty(){return this.count===0}get titleHeight(){return this.titleControl.getHeight()}notifyIndexChanged(e){this._index!==e&&(this._index=e,this.model.setIndex(e))}notifyLabelChanged(e){this.groupsLabel!==e&&(this.groupsLabel=e,this.model.setLabel(e))}setActive(e){this.active=e,!e&&this.activeEditor&&this.selectedEditors.length>1&&this.setSelection(this.activeEditor,[]),this.element.classList.toggle("active",e),this.element.classList.toggle("inactive",!e),this.titleControl.setActive(e),this.updateStyles(),this.model.setActive(void 0)}get id(){return this.model.id}get windowId(){return this.groupsView.windowId}get editors(){return this.model.getEditors(Ii.SEQUENTIAL)}get count(){return this.model.count}get stickyCount(){return this.model.stickyCount}get activeEditorPane(){return this.editorPane?this.editorPane.activeEditorPane??void 0:void 0}get activeEditor(){return this.model.activeEditor}get selectedEditors(){return this.model.selectedEditors}get previewEditor(){return this.model.previewEditor}isPinned(e){return this.model.isPinned(e)}isSticky(e){return this.model.isSticky(e)}isSelected(e){return this.model.isSelected(e)}isTransient(e){return this.model.isTransient(e)}isActive(e){return this.model.isActive(e)}async setSelection(e,t){this.isActive(e)?this.model.setSelection(e,t):await this.openEditor(e,{activation:qc.ACTIVATE},{inactiveSelection:t})}contains(e,t){return this.model.contains(e,t)}getEditors(e,t){return this.model.getEditors(e,t)}findEditors(e,t){const i=this.uriIdentityService.asCanonicalUri(e);return this.getEditors(Ii.SEQUENTIAL).filter(n=>{if(n.resource&&At(n.resource,i))return!0;if(t?.supportSideBySide===qt.PRIMARY||t?.supportSideBySide===qt.ANY){const o=Di.getCanonicalUri(n,{supportSideBySide:qt.PRIMARY});if(o&&At(o,i))return!0}if(t?.supportSideBySide===qt.SECONDARY||t?.supportSideBySide===qt.ANY){const o=Di.getCanonicalUri(n,{supportSideBySide:qt.SECONDARY});if(o&&At(o,i))return!0}return!1})}getEditorByIndex(e){return this.model.getEditorByIndex(e)}getIndexOfEditor(e){return this.model.indexOf(e)}isFirst(e){return this.model.isFirst(e)}isLast(e){return this.model.isLast(e)}focus(){this.activeEditorPane?this.activeEditorPane.focus():this.element.focus(),this._onDidFocus.fire()}pinEditor(e=this.activeEditor||void 0){if(e&&!this.model.isPinned(e)){const t=this.model.pin(e);t&&this.titleControl.pinEditor(t)}}stickEditor(e=this.activeEditor||void 0){this.doStickEditor(e,!0)}unstickEditor(e=this.activeEditor||void 0){this.doStickEditor(e,!1)}doStickEditor(e,t){if(e&&this.model.isSticky(e)!==t){const i=this.getIndexOfEditor(e),n=t?this.model.stick(e):this.model.unstick(e);if(!n)return;const o=this.getIndexOfEditor(n);o!==i&&this.titleControl.moveEditor(n,i,o,!0),t?this.titleControl.stickEditor(n):this.titleControl.unstickEditor(n)}}async openEditor(e,t,i){return this.doOpenEditor(e,t,{...i,supportSideBySide:qt.BOTH})}async doOpenEditor(e,t,i){if(!e||e.isDisposed())return;this._onWillOpenEditor.fire({editor:e,groupId:this.id});const n=t?.sticky||!this.groupsView.partOptions.enablePreview&&!t?.transient||e.isDirty()||(t?.pinned??typeof t?.index=="number")||typeof t?.index=="number"&&this.model.isSticky(t.index)||e.hasCapability(Je.Scratchpad),o={index:t?t.index:void 0,pinned:n,sticky:t?.sticky||typeof t?.index=="number"&&this.model.isSticky(t.index),transient:!!t?.transient,inactiveSelection:i?.inactiveSelection,active:this.count===0||!t||!t.inactive,supportSideBySide:i?.supportSideBySide};!o.active&&!o.pinned&&this.model.activeEditor&&!this.model.isPinned(this.model.activeEditor)&&(o.active=!0);let r=!1,a=!1;if(t?.activation===qc.ACTIVATE?r=!0:t?.activation===qc.RESTORE?a=!0:t?.activation===qc.PRESERVE?(r=!1,a=!1):o.active&&(r=!t||!t.preserveFocus,a=!r),typeof o.index=="number"){const u=this.model.indexOf(e);u!==-1&&u!==o.index&&this.doMoveEditorInsideGroup(e,o)}const{editor:c,isNew:d}=this.model.openEditor(e,o);d&&this.count===1&&this.editorPartsView.groups.length>1&&c.editorId&&this.groupsView.partOptions.autoLockGroups?.has(c.editorId)&&this.lock(!0);const l=this.doShowEditor(c,{active:!!o.active,isNew:d},t,i);return r?this.groupsView.activateGroup(this):a&&this.groupsView.restoreGroup(this),l}doShowEditor(e,t,i,n){let o;return t.active?o=(async()=>{const{pane:r,changed:a,cancelled:c,error:d}=await this.editorPane.openEditor(e,i,n,{newInGroup:t.isNew});if(!c)return a&&this._onDidActiveEditorChange.fire({editor:e}),d&&this._onDidOpenEditorFail.fire(e),!r&&this.activeEditor===e&&this.doCloseEditor(e,i?.preserveFocus,{fromError:!0}),r})():o=Promise.resolve(void 0),n?.skipTitleUpdate||this.titleControl.openEditor(e,n),o}async openEditors(e){const t=$t(e).filter(({editor:a})=>!a.isDisposed()),i=t.at(0);if(!i)return;const n={supportSideBySide:qt.BOTH};await this.doOpenEditor(i.editor,i.options,n);const o=t.slice(1),r=this.getIndexOfEditor(i.editor)+1;return await Pp.settled(o.map(({editor:a,options:c},d)=>this.doOpenEditor(a,{...c,inactive:!0,pinned:!0,index:r+d},{...n,skipTitleUpdate:!0}))),this.titleControl.openEditors(o.map(({editor:a})=>a)),this.editorPane.activeEditorPane??void 0}moveEditors(e,t){const i={skipTitleUpdate:this!==t};let n=!1;const o=new Set;for(const{editor:r,options:a}of e)this.moveEditor(r,t,a,i)?o.add(r):n=!0;return i.skipTitleUpdate&&(t.titleControl.openEditors(Array.from(o)),this.titleControl.closeEditors(Array.from(o))),!n}moveEditor(e,t,i,n){return this===t?(this.doMoveEditorInsideGroup(e,i),!0):this.doMoveOrCopyEditorAcrossGroups(e,t,i,{...n,keepCopy:!1})}doMoveEditorInsideGroup(e,t){const i=t?t.index:void 0;if(typeof i!="number")return;const n=this.model.indexOf(e),o=this.model.getEditorByIndex(n);if(o){if(n!==i){const r=this.model.stickyCount;this.model.moveEditor(o,i),this.model.pin(o),this.titleControl.moveEditor(o,n,i,r!==this.model.stickyCount),this.titleControl.pinEditor(o)}t?.sticky&&this.stickEditor(o)}}doMoveOrCopyEditorAcrossGroups(e,t,i,n){const o=n?.keepCopy;if(!o||e.hasCapability(Je.Singleton)){const a=e.canMove(this.id,t.id);if(typeof a=="string")return this.dialogService.error(a,h(3233,"Try saving or reverting the editor first and then try again.")),!1}const r=mj(this,e,{...i,pinned:!0,sticky:i?.sticky??(!o&&this.model.isSticky(e))});return o||this._onWillMoveEditor.fire({groupId:this.id,editor:e,target:t.id}),t.doOpenEditor(o?e.copy():e,r,n),o||this.doCloseEditor(e,!0,{...n,context:jd.MOVE}),!0}copyEditors(e,t){const i={skipTitleUpdate:this!==t};for(const{editor:n,options:o}of e)this.copyEditor(n,t,o,i);if(i.skipTitleUpdate){const n=e.map(({editor:o})=>o);t.titleControl.openEditors(n)}}copyEditor(e,t,i,n){this===t?this.doMoveEditorInsideGroup(e,i):this.doMoveOrCopyEditorAcrossGroups(e,t,i,{...n,keepCopy:!0})}async closeEditor(e=this.activeEditor||void 0,t){return this.doCloseEditorWithConfirmationHandling(e,t)}async doCloseEditorWithConfirmationHandling(e=this.activeEditor||void 0,t,i){return!e||await this.handleCloseConfirmation([e])?!1:(this.doCloseEditor(e,t?.preserveFocus,i),!0)}doCloseEditor(e,t=this.groupsView.activeGroup!==this,i){i?.skipTitleUpdate||this.titleControl.beforeCloseEditor(e),this.model.isActive(e)?this.doCloseActiveEditor(t,i):this.doCloseInactiveEditor(e,i),i?.skipTitleUpdate||this.titleControl.closeEditor(e)}doCloseActiveEditor(e=this.groupsView.activeGroup!==this,t){const i=this.activeEditor,n=!e&&this.shouldRestoreFocus(this.element),o=this.groupsView.partOptions.closeEmptyGroups;if(o&&this.active&&this.count===1){const c=this.groupsView.getGroups(Jo.MOST_RECENTLY_ACTIVE)[1];c&&(n?c.focus():this.groupsView.activateGroup(c,!0))}i&&this.model.closeEditor(i,t?.context);const r=this.model.activeEditor;if(r){let a;e&&this.groupsView.activeGroup!==this&&(a=qc.PRESERVE);const c={preserveFocus:e,activation:a,ignoreError:t?.fromError},d={preserveWindowOrder:!0};this.doOpenEditor(r,c,d)}else i&&this.editorPane.closeEditor(i),n&&!o&&this.focus(),this._onDidActiveEditorChange.fire({editor:void 0}),o&&this.groupsView.removeGroup(this,e)}shouldRestoreFocus(e){const t=wh();return t===e.ownerDocument.body?!0:Hu(t,e)}doCloseInactiveEditor(e,t){this.model.closeEditor(e,t?.context)}async handleCloseConfirmation(e){if(!e.length)return!1;const t=e.shift();let i=this.mapEditorToPendingConfirmation.get(t);i||(i=this.doHandleCloseConfirmation(t),this.mapEditorToPendingConfirmation.set(t,i));let n;try{n=await i}finally{this.mapEditorToPendingConfirmation.delete(t)}return n||this.handleCloseConfirmation(e)}async doHandleCloseConfirmation(e,t){if(!this.shouldConfirmClose(e)||e instanceof ks&&this.model.contains(e.primary)||this.editorPartsView.groups.some(r=>{if(r===this)return!1;const a=r;return!!(a.contains(e,{supportSideBySide:qt.BOTH})||e instanceof ks&&a.contains(e.primary))}))return!1;let i=Yi.CANCEL,n=gi.EXPLICIT,o=!1;if(!e.hasCapability(Je.Untitled)&&!t?.skipAutoSave&&!e.closeHandler&&(this.filesConfigurationService.getAutoSaveMode(e).mode===pA.ON_FOCUS_CHANGE?(o=!0,i=Yi.SAVE,n=gi.FOCUS_CHANGE):ca&&(bn||fh)&&this.filesConfigurationService.getAutoSaveMode(e).mode===pA.ON_WINDOW_CHANGE&&(o=!0,i=Yi.SAVE,n=gi.WINDOW_CHANGE)),!o){(!this.activeEditor||!this.activeEditor.matches(e))&&await this.doOpenEditor(e),await this.hostService.focus(Et(this.element));let r=!1;if(typeof e.closeHandler?.confirm=="function")try{i=await e.closeHandler.confirm([{editor:e,groupId:this.id}])}catch(a){this.logService.error(a),r=!0}if(typeof e.closeHandler?.confirm!="function"||r){let a;e instanceof ks?a=e.primary.getName():a=e.getName(),i=await this.fileDialogService.showSaveConfirm([a])}}if(!e.closeHandler&&!this.shouldConfirmClose(e))return i===Yi.CANCEL;switch(i){case Yi.SAVE:return!await e.save(this.id,{reason:n})&&o?this.doHandleCloseConfirmation(e,{skipAutoSave:!0}):e.isDirty();case Yi.DONT_SAVE:try{return await e.revert(this.id),e.isDirty()}catch(r){return this.logService.error(r),await e.revert(this.id,{soft:!0}),e.isDirty()}case Yi.CANCEL:return!0}}shouldConfirmClose(e){if(e.closeHandler)try{return e.closeHandler.showConfirm()}catch(t){this.logService.error(t)}return e.isDirty()&&!e.isSaving()}async closeEditors(e,t){if(this.isEmpty)return!0;const i=this.doGetEditorsToClose(e);return await this.handleCloseConfirmation(i.slice(0))?!1:(this.doCloseEditors(i,t),!0)}doGetEditorsToClose(e){if(Array.isArray(e))return e;const t=e,i=typeof t.direction=="number";let n=this.model.getEditors(i?Ii.SEQUENTIAL:Ii.MOST_RECENTLY_ACTIVE,t);return t.savedOnly?n=n.filter(o=>!o.isDirty()||o.isSaving()):i&&t.except?n=t.direction===uq.LEFT?n.slice(0,this.model.indexOf(t.except,n)):n.slice(this.model.indexOf(t.except,n)+1):t.except&&(n=n.filter(o=>t.except&&!o.matches(t.except))),n}doCloseEditors(e,t){let i=!1;for(const n of e)this.isActive(n)?i=!0:this.doCloseInactiveEditor(n);i&&this.doCloseActiveEditor(t?.preserveFocus),e.length&&this.titleControl.closeEditors(e)}closeAllEditors(e){return this.isEmpty?(this.groupsView.partOptions.closeEmptyGroups&&this.groupsView.removeGroup(this),!0):e?.excludeConfirming?(this.doCloseAllEditors(e),!0):this.handleCloseConfirmation(this.model.getEditors(Ii.MOST_RECENTLY_ACTIVE,e)).then(t=>t?!1:(this.doCloseAllEditors(e),!0))}doCloseAllEditors(e){let t=this.model.getEditors(Ii.SEQUENTIAL,e);e?.excludeConfirming&&(t=t.filter(n=>!this.shouldConfirmClose(n)));const i=[];for(const n of t)this.isActive(n)||this.doCloseInactiveEditor(n),i.push(n);this.activeEditor&&i.includes(this.activeEditor)&&this.doCloseActiveEditor(),i.length&&this.titleControl.closeEditors(i)}async replaceEditors(e){let t;const i=[];for(let{editor:n,replacement:o,forceReplaceDirty:r,options:a}of e){const c=this.getIndexOfEditor(n);if(c>=0){const d=this.isActive(n);a?a.index=c:a={index:c},a.inactive=!d,a.pinned=a.pinned??!0;const l={editor:n,replacement:o,forceReplaceDirty:r,options:a};d?t=l:i.push(l)}}for(const{editor:n,replacement:o,forceReplaceDirty:r,options:a}of i)if(await this.doOpenEditor(o,a),!n.matches(o)){let c=!1;if(r?(this.doCloseEditor(n,!0,{context:jd.REPLACE}),c=!0):c=await this.doCloseEditorWithConfirmationHandling(n,{preserveFocus:!0},{context:jd.REPLACE}),!c)return}if(t){const n=this.doOpenEditor(t.replacement,t.options);t.editor.matches(t.replacement)||(t.forceReplaceDirty?this.doCloseEditor(t.editor,!0,{context:jd.REPLACE}):await this.doCloseEditorWithConfirmationHandling(t.editor,{preserveFocus:!0},{context:jd.REPLACE})),await n}}get isLocked(){return this.model.isLocked}lock(e){this.model.lock(e)}createEditorActions(e){let t={primary:[],secondary:[]},i;const n=this.activeEditorPane;if(n instanceof Mu){const o=n.scopedContextKeyService??this.scopedContextKeyService,r=e.add(this.menuService.createMenu(N.EditorTitle,o,{emitEventsForSubmenuChanges:!0,eventDebounceDelay:0}));i=r.onDidChange;const a=(c,d)=>d==="navigation"&&c.actions.length<=1;t=Xm(r.getActions({arg:this.resourceContext.get(),shouldForwardArgs:!0}),"navigation",a)}else{const o=e.add(new M);i=o.event,e.add(this.onDidActiveEditorChange(()=>o.fire()))}return{actions:t,onDidChange:i}}updateStyles(){const e=this.isEmpty;e?this.element.style.backgroundColor=this.getColor(dxe)||"":this.element.style.backgroundColor="";const t=this.getColor(uxe)||this.getColor(tt);!e&&t?(this.titleContainer.classList.add("title-border-bottom"),this.titleContainer.style.setProperty("--title-border-bottom-color",t)):(this.titleContainer.classList.remove("title-border-bottom"),this.titleContainer.style.removeProperty("--title-border-bottom-color"));const{showTabs:i}=this.groupsView.partOptions;this.titleContainer.style.backgroundColor=this.getColor(i==="multiple"?are:hxe)||"",this.editorContainer.style.backgroundColor=this.getColor(ss)||""}get minimumWidth(){return this.editorPane.minimumWidth}get minimumHeight(){return this.editorPane.minimumHeight}get maximumWidth(){return this.editorPane.maximumWidth}get maximumHeight(){return this.editorPane.maximumHeight}get proportionalLayout(){return this.lastLayout?!(this.lastLayout.width===this.minimumWidth||this.lastLayout.height===this.minimumHeight):!0}layout(e,t,i,n){this.lastLayout={width:e,height:t,top:i,left:n},this.element.classList.toggle("max-height-478px",t<=478);const o=this.titleControl.layout({container:new Ye(e,t),available:new Ye(e,t-this.editorPane.minimumHeight)});this.progressBar.getContainer().style.top=`${Math.max(this.titleHeight.offset-2,0)}px`;const r=Math.max(0,t-o.height);this.editorContainer.style.height=`${r}px`,this.editorPane.layout({width:e,height:r,top:i+o.height,left:n})}relayout(){if(this.lastLayout){const{width:e,height:t,top:i,left:n}=this.lastLayout;this.layout(e,t,i,n)}}setBoundarySashes(e){this.editorPane.setBoundarySashes(e)}toJSON(){return this.model.serialize()}dispose(){this._disposed=!0,this._onWillDispose.fire(),super.dispose()}};tL=Bg=f([p(6,Z),p(7,fe),p(8,pt),p(9,ai),p(10,He),p(11,fn),p(12,bi),p(13,to),p(14,de),p(15,Us),p(16,nn),p(17,Re),p(18,mf),p(19,Hn),p(20,ei),p(21,je)],tL);var tC;Ve(u0e);const iL=j;let bv=class extends Tx{static{tC=this}static{this.DEFAULT_VISIBLE_OPEN_EDITORS=9}static{this.DEFAULT_MIN_VISIBLE_OPEN_EDITORS=0}static{this.ID="workbench.explorer.openEditorsView"}static{this.NAME=I(7168,"Open Editors")}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_){super(e,a,n,r,c,i,t,v,d,u),this.editorGroupService=o,this.telemetryService=l,this.workingCopyService=g,this.filesConfigurationService=m,this.fileService=_,this.needsRefresh=!1,this.elements=[],this.blockFocusActiveEditorTracking=!1,this.structuralRefreshDelay=0,this.sortOrder=r.getValue("explorer.openEditors.sortOrder"),this.registerUpdateEvents(),this._register(this.configurationService.onDidChangeConfiguration(w=>this.onConfigurationChange(w))),this._register(this.workingCopyService.onDidChangeDirty(w=>this.updateDirtyIndicator(w)))}registerUpdateEvents(){const e=()=>{if(!this.isBodyVisible()||!this.list){this.needsRefresh=!0;return}this.listRefreshScheduler?.schedule(this.structuralRefreshDelay)},t=this._register(new ti),i=n=>{const o=n.onDidModelChange(r=>{if(this.listRefreshScheduler?.isScheduled())return;if(!this.isBodyVisible()||!this.list){this.needsRefresh=!0;return}const a=this.getIndex(n,r.editor);switch(r.kind){case ct.EDITOR_ACTIVE:this.focusActiveEditor();break;case ct.GROUP_INDEX:case ct.GROUP_LABEL:a>=0&&this.list.splice(a,1,[n]);break;case ct.EDITOR_DIRTY:case ct.EDITOR_STICKY:case ct.EDITOR_CAPABILITIES:case ct.EDITOR_PIN:case ct.EDITOR_LABEL:this.list.splice(a,1,[new Yn(r.editor,n)]),this.focusActiveEditor();break;case ct.EDITOR_OPEN:case ct.EDITOR_MOVE:case ct.EDITOR_CLOSE:e();break}});t.set(n.id,o)};this.editorGroupService.groups.forEach(n=>i(n)),this._register(this.editorGroupService.onDidAddGroup(n=>{i(n),e()})),this._register(this.editorGroupService.onDidMoveGroup(()=>e())),this._register(this.editorGroupService.onDidChangeActiveGroup(()=>this.focusActiveEditor())),this._register(this.editorGroupService.onDidRemoveGroup(n=>{t.deleteAndDispose(n.id),e()}))}renderHeaderTitle(e){super.renderHeaderTitle(e,this.title);const t=ee(e,iL(".open-editors-dirty-count-container"));this.dirtyCountElement=ee(t,iL(".dirty-count.monaco-count-badge.long")),this.dirtyCountElement.style.backgroundColor=vt(eN),this.dirtyCountElement.style.color=vt(zz),this.dirtyCountElement.style.border=`1px solid ${vt(tt)}`,this.updateDirtyIndicator()}renderBody(e){super.renderBody(e),e.classList.add("open-editors"),e.classList.add("show-file-icons");const t=new JC;this.list&&this.list.dispose(),this.listLabels&&this.listLabels.clear(),this.dnd=new p2(this.sortOrder,this.instantiationService,this.editorGroupService),this.listLabels=this.instantiationService.createInstance(vd,{onDidChangeVisibility:this.onDidChangeBodyVisibility}),this.list=this.instantiationService.createInstance(zne,"OpenEditors",e,t,[new h0(this.keybindingService,this.instantiationService),new u0(this.listLabels,this.instantiationService,this.keybindingService,this.configurationService)],{identityProvider:{getId:o=>o instanceof Yn?o.getId():o.id.toString()},dnd:this.dnd,overrideStyles:this.getLocationBasedColors().listOverrideStyles,accessibilityProvider:new s1e}),this._register(this.list),this._register(this.listLabels);let i=[];this.listRefreshScheduler=this._register(new yn(()=>{if(!this.list)return;i=Xe(i);const o=this.list.length,r=this.getElements();this.list.splice(0,this.list.length,r),this.focusActiveEditor(),o!==this.list.length&&this.updateSize(),this.needsRefresh=!1,(this.sortOrder==="alphabetical"||this.sortOrder==="fullPath")&&r.forEach(a=>{a instanceof Yn&&i.push(a.editor.onDidChangeLabel(()=>this.listRefreshScheduler?.schedule()))})},this.structuralRefreshDelay)),this.updateSize(),this.handleContextKeys(),this._register(this.list.onContextMenu(o=>this.onListContextMenu(o))),this._register(this.list.onMouseMiddleClick(o=>{if(o&&o.element instanceof Yn){if(gq(o.element.group,o.element.editor,pq.MOUSE,this.editorGroupService.partOptions))return;o.element.group.closeEditor(o.element.editor,{preserveFocus:!0})}})),this._register(this.list.onDidOpen(o=>{const r=o.element;if(r)if(r instanceof Yn){if(op(o.browserEvent)&&o.browserEvent.button===1)return;this.withActiveEditorFocusTrackingDisabled(()=>{this.openEditor(r,{preserveFocus:o.editorOptions.preserveFocus,pinned:o.editorOptions.pinned,sideBySide:o.sideBySide})})}else this.withActiveEditorFocusTrackingDisabled(()=>{this.editorGroupService.activateGroup(r),o.editorOptions.preserveFocus||r.focus()});else return})),this.listRefreshScheduler.schedule(0),this._register(this.onDidChangeBodyVisibility(o=>{o&&this.needsRefresh&&this.listRefreshScheduler?.schedule(0)}));const n=this.viewDescriptorService.getViewContainerModel(this.viewDescriptorService.getViewContainerByViewId(this.id));this._register(n.onDidChangeAllViewDescriptors(()=>{this.updateSize()}))}handleContextKeys(){if(!this.list)return;cCe.bindTo(this.list.contextKeyService),woe.bindTo(this.list.contextKeyService);const e=g_.bindTo(this.contextKeyService),t=qO.bindTo(this.contextKeyService),i=A4.bindTo(this.contextKeyService),n=Kle.bindTo(this.contextKeyService),o=this.instantiationService.createInstance(hi);this._register(o),this._register(this.list.onDidChangeFocus(r=>{o.reset(),e.reset(),t.reset(),i.reset();const a=r.elements.length?r.elements[0]:void 0;if(a instanceof Yn){const c=a.getResource();t.set(a.editor.isDirty()&&!a.editor.isSaving()),i.set(!!a.editor.isReadonly()),o.set(c??null)}else a&&e.set(!0)})),this._register(this.list.onDidChangeSelection(r=>{const a=r.elements.every(c=>{if(c instanceof Yn){const d=c.getResource();return d&&(d.scheme===ae.untitled||this.fileService.hasProvider(d))}return!1});n.set(a)}))}focus(){super.focus(),this.list?.domFocus()}layoutBody(e,t){super.layoutBody(e,t),this.list?.layout(e,t)}get showGroups(){return this.editorGroupService.groups.length>1}getElements(){return this.elements=[],this.editorGroupService.getGroups(Jo.GRID_APPEARANCE).forEach(e=>{this.showGroups&&this.elements.push(e);let t=e.editors.map(i=>new Yn(i,e));this.sortOrder==="alphabetical"?t=t.sort((i,n)=>BF(i.editor.getName(),n.editor.getName())):this.sortOrder==="fullPath"&&(t=t.sort((i,n)=>{const o=i.editor.resource,r=n.editor.resource;if(o===void 0&&r===void 0)return BF(i.editor.getName(),n.editor.getName());if(o===void 0)return-1;if(r===void 0)return 1;{const a=o.scheme,c=r.scheme;return a!==ae.file&&c!==ae.file?Y6.compare(o,r):a!==ae.file?-1:c!==ae.file?1:Y6.compare(o,r)}})),this.elements.push(...t)}),this.elements}getIndex(e,t){return t?this.elements.findIndex(i=>i instanceof Yn&&i.editor===t&&i.group.id===e.id):this.elements.findIndex(i=>!(i instanceof Yn)&&i.id===e.id)}openEditor(e,t){e&&(this.telemetryService.publicLog2("workbenchActionExecuted",{id:"workbench.files.openFile",from:"openEditors"}),t.sideBySide&&t.preserveFocus||this.editorGroupService.activateGroup(e.group),(t.sideBySide?this.editorGroupService.sideGroup:e.group).openEditor(e.editor,t))}onListContextMenu(e){if(!e.element)return;const t=e.element;this.contextMenuService.showContextMenu({menuId:N.OpenEditorsContext,menuActionOptions:{shouldForwardArgs:!0,arg:t instanceof Yn?Di.getOriginalUri(t.editor):{}},contextKeyService:this.list?.contextKeyService,getAnchor:()=>e.anchor,getActionsContext:()=>t instanceof Yn?{groupId:t.groupId,editorIndex:t.group.getIndexOfEditor(t.editor)}:{groupId:t.id}})}withActiveEditorFocusTrackingDisabled(e){this.blockFocusActiveEditorTracking=!0;try{e()}finally{this.blockFocusActiveEditorTracking=!1}}focusActiveEditor(){if(!(!this.list||this.blockFocusActiveEditorTracking)){if(this.list.length&&this.editorGroupService.activeGroup){const e=this.getIndex(this.editorGroupService.activeGroup,this.editorGroupService.activeGroup.activeEditor);if(e>=0){try{this.list.setFocus([e]),this.list.setSelection([e]),this.list.reveal(e)}catch{}return}}this.list.setFocus([]),this.list.setSelection([])}}onConfigurationChange(e){e.affectsConfiguration("explorer.openEditors")&&this.updateSize(),(e.affectsConfiguration("explorer.decorations")||e.affectsConfiguration("explorer.openEditors.sortOrder"))&&(this.sortOrder=this.configurationService.getValue("explorer.openEditors.sortOrder"),this.dnd&&(this.dnd.sortOrder=this.sortOrder),this.listRefreshScheduler?.schedule())}updateSize(){this.minimumBodySize=this.orientation===St.VERTICAL?this.getMinExpandedBodySize():170,this.maximumBodySize=this.orientation===St.VERTICAL?this.getMaxExpandedBodySize():Number.POSITIVE_INFINITY}updateDirtyIndicator(e){if(e&&e.isDirty()&&!(e.capabilities&WE.Untitled)&&this.filesConfigurationService.hasShortAutoSaveDelay(e.resource))return;const t=this.workingCopyService.dirtyCount;t===0?this.dirtyCountElement.classList.add("hidden"):(this.dirtyCountElement.textContent=h(7169,"{0} unsaved",t),this.dirtyCountElement.classList.remove("hidden"))}get elementCount(){return this.editorGroupService.groups.map(e=>e.count).reduce((e,t)=>e+t,this.showGroups?this.editorGroupService.groups.length:0)}getMaxExpandedBodySize(){let e=this.configurationService.getValue("explorer.openEditors.minVisible");return typeof e!="number"&&(e=tC.DEFAULT_MIN_VISIBLE_OPEN_EDITORS),this.viewDescriptorService.getViewContainerModel(this.viewDescriptorService.getViewContainerByViewId(this.id)).visibleViewDescriptors.length<=1?Number.POSITIVE_INFINITY:Math.max(this.elementCount,e)*JC.ITEM_HEIGHT}getMinExpandedBodySize(){let e=this.configurationService.getValue("explorer.openEditors.visible");return typeof e!="number"&&(e=tC.DEFAULT_VISIBLE_OPEN_EDITORS),this.computeMinExpandedBodySize(e)}computeMinExpandedBodySize(e=tC.DEFAULT_VISIBLE_OPEN_EDITORS){return Math.min(Math.max(e,1),this.elementCount)*JC.ITEM_HEIGHT}setStructuralRefreshDelay(e){this.structuralRefreshDelay=e}getOptimalWidth(){if(!this.list)return super.getOptimalWidth();const e=this.list.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".open-editor > a"));return qne(e,t)}};bv=tC=f([p(1,Z),p(2,$s),p(3,bi),p(4,xe),p(5,ne),p(6,He),p(7,fe),p(8,pt),p(9,ai),p(10,Ti),p(11,lg),p(12,Us),p(13,mi),p(14,je)],bv);class n1e extends hg{async run(e){if(this.editor)return super.run(e,{groupId:this.editor.groupId,editorIndex:this.editor.group.getIndexOfEditor(this.editor.editor)})}}class JC{static{this.ITEM_HEIGHT=22}getHeight(e){return JC.ITEM_HEIGHT}getTemplateId(e){return e instanceof Yn?u0.ID:h0.ID}}class h0{static{this.ID="editorgroup"}constructor(e,t){this.keybindingService=e,this.instantiationService=t}get templateId(){return h0.ID}renderTemplate(e){const t=Object.create(null);t.root=ee(e,iL(".editor-group")),t.name=ee(t.root,iL("span.name")),t.actionBar=new Ar(e);const i=this.instantiationService.createInstance(G1,G1.ID,G1.LABEL),n=this.keybindingService.lookupKeybinding(i.id);t.actionBar.push(i,{icon:!0,label:!1,keybinding:n?n.getLabel():void 0});const o=this.instantiationService.createInstance(jC,jC.ID,jC.LABEL),r=this.keybindingService.lookupKeybinding(o.id);return t.actionBar.push(o,{icon:!0,label:!1,keybinding:r?r.getLabel():void 0}),t}renderElement(e,t,i){i.editorGroup=e,i.name.textContent=e.label,i.actionBar.context={groupId:e.id}}disposeTemplate(e){e.actionBar.dispose()}}class u0{static{this.ID="openeditor"}constructor(e,t,i,n){this.labels=e,this.instantiationService=t,this.keybindingService=i,this.configurationService=n,this.closeEditorAction=this.instantiationService.createInstance(QC,QC.ID,QC.LABEL),this.unpinEditorAction=this.instantiationService.createInstance(Ip,Ip.ID,Ip.LABEL)}get templateId(){return u0.ID}renderTemplate(e){const t=Object.create(null);return t.container=e,t.actionRunner=new n1e,t.actionBar=new Ar(e,{actionRunner:t.actionRunner}),t.root=this.labels.create(e),t}renderElement(e,t,i){const n=e.editor;i.actionRunner.editor=e,i.container.classList.toggle("dirty",n.isDirty()&&!n.isSaving()),i.container.classList.toggle("sticky",e.isSticky()),i.root.setResource({resource:Di.getOriginalUri(n,{supportSideBySide:qt.BOTH}),name:n.getName(),description:n.getDescription(Ot.MEDIUM)},{italic:e.isPreview(),extraClasses:["open-editor"].concat(e.editor.getLabelExtraClasses()),fileDecorations:this.configurationService.getValue().explorer.decorations,title:n.getTitle(Ot.LONG),icon:n.getIcon()});const o=e.isSticky()?this.unpinEditorAction:this.closeEditorAction;i.actionBar.hasAction(o)||(i.actionBar.isEmpty()||i.actionBar.clear(),i.actionBar.push(o,{icon:!0,label:!1,keybinding:this.keybindingService.lookupKeybinding(o.id)?.getLabel()}))}disposeTemplate(e){e.actionBar.dispose(),e.root.dispose(),e.actionRunner.dispose()}}class p2{set sortOrder(e){this._sortOrder=e}constructor(e,t,i){this.instantiationService=t,this.editorGroupService=i,this._sortOrder=e}get dropHandler(){return this.instantiationService.createInstance($P,{allowWorkspaceOpen:!1})}getDragURI(e){if(e instanceof Yn){const t=e.getResource();if(t)return t.toString()}return null}getDragLabel(e){if(e.length>1)return String(e.length);const t=e[0];return t instanceof Yn?t.editor.getName():t.label}onDragStart(e,t){const i=e.elements,n=[];if(i)for(const o of i)o instanceof Yn&&n.push(o);n.length&&this.instantiationService.invokeFunction(ag,n,t)}onDragOver(e,t,i,n,o){if(e instanceof VF&&!To(o,Ds.FILES,ho.FILES))return!1;if(this._sortOrder!=="editorOrder")return e instanceof Q6?!1:{accept:!0,effect:{type:q_.Move},feedback:[-1]};let r;switch(n){case Qr.TOP:case Qr.CENTER_TOP:r=i===0&&t instanceof tL?hm.After:hm.Before;break;case Qr.CENTER_BOTTOM:case Qr.BOTTOM:r=hm.After;break}return{accept:!0,effect:{type:q_.Move,position:r},feedback:[i]}}drop(e,t,i,n,o){let r=t instanceof Yn?t.group:t||this.editorGroupService.groups[this.editorGroupService.count-1],a=t instanceof Yn?t.group.getIndexOfEditor(t.editor):0;switch(n){case Qr.TOP:case Qr.CENTER_TOP:t instanceof tL&&r.index!==0&&(r=this.editorGroupService.groups[r.index-1],a=r.count);break;case Qr.BOTTOM:case Qr.CENTER_BOTTOM:t instanceof Yn&&a++;break}if(e instanceof Q6){for(const c of e.elements){const d=c.group.getIndexOfEditor(c.editor);c.group===r&&d<a&&a--,c.group.moveEditor(c.editor,r,{index:a,preserveFocus:!0}),a++}this.editorGroupService.activateGroup(r)}else this.dropHandler.handleDrop(o,zi,()=>r,()=>r.focus(),{index:a})}dispose(){}}p2.__decorator=f([Gt],p2.prototype,"dropHandler",null);class s1e{getWidgetAriaLabel(){return h(7168,"Open Editors")}getAriaLabel(e){return e instanceof Yn?`${e.editor.getName()}, ${e.editor.getDescription()}`:e.ariaLabel}}const o1e="workbench.action.toggleEditorGroupLayout";Y(class extends X{constructor(){super({id:"workbench.action.toggleEditorGroupLayout",title:I(7170,"Toggle Vertical/Horizontal Editor Layout"),f1:!0,keybinding:{primary:E.Shift|E.Alt|S.Digit0,mac:{primary:E.CtrlCmd|E.Alt|S.Digit0},weight:W.WorkbenchContrib},icon:K.editorLayout,menu:{id:N.ViewTitle,group:"navigation",when:x.and(x.equals("view",bv.ID),bN),order:10}})}async run(s){const e=s.get(xe),t=e.orientation===cc.VERTICAL?cc.HORIZONTAL:cc.VERTICAL;e.setGroupOrientation(t),e.activeGroup.focus()}});ge.appendMenuItem(N.MenubarLayoutMenu,{group:"5_flip",command:{id:o1e,title:{...I(7171,"Flip Layout"),mnemonicTitle:h(7172,"Flip &&Layout")}},order:1});Y(class extends X{constructor(){super({id:"workbench.action.files.saveAll",title:fNe,f1:!0,icon:K.saveAll,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",bv.ID),order:20}})}async run(s){await s.get(Ge).executeCommand(T4)}});Y(class extends X{constructor(){super({id:"openEditors.closeAll",title:Dx.LABEL,f1:!1,icon:K.closeAll,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",bv.ID),order:30}})}async run(s){const e=s.get(Z),t=new Dx;await e.invokeFunction(i=>t.run(i))}});Y(class extends X{constructor(){super({id:"openEditors.newUntitledFile",title:I(7173,"New Untitled Text File"),f1:!1,icon:K.newFile,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",bv.ID),order:5}})}async run(s){await s.get(Ge).executeCommand(aS)}});async function q4(s,e){const t=s.get(xe),i=s.get(Bt),n=s.get(Ps);let o=Ahe(s);if(!o){const a=t.activeGroup;a.activeEditor&&(o=[],a.activeEditor instanceof ks&&!e?.saveAs&&!(a.activeEditor.primary.hasCapability(Je.Untitled)||a.activeEditor.secondary.hasCapability(Je.Untitled))&&a.activeEditor.secondary.isModified()?(o.push({groupId:a.id,editor:a.activeEditor.primary}),o.push({groupId:a.id,editor:a.activeEditor.secondary})):o.push({groupId:a.id,editor:a.activeEditor}))}if(!o||o.length===0)return;await K4(s,o,e);const r=i.getFocusedCodeEditor();if(r instanceof pd&&!r.isSimpleWidget){const a=r.getModel()?.uri;a&&!o.some(({editor:c})=>At(Di.getCanonicalUri(c,{supportSideBySide:qt.PRIMARY}),a))&&(n.files.get(a)?.isReadonly()||await n.save(a,e))}}function fue(s,e,t){const i=[];for(const n of e)for(const o of n.getEditors(Ii.MOST_RECENTLY_ACTIVE))o.isDirty()&&i.push({groupId:n.id,editor:o});return K4(s,i,t)}async function K4(s,e,t){const i=s.get(de),n=s.get(Dt),o=s.get(Z);try{await i.save(e,t)}catch(r){if(!ys(r)){const a=[Ri({id:"workbench.action.files.saveEditors",label:h(6985,"Retry"),run:()=>o.invokeFunction(d=>K4(d,e,t))})],c=e.filter(({editor:d})=>!d.hasCapability(Je.Untitled));c.length>0&&a.push(Ri({id:"workbench.action.files.revertEditors",label:c.length>1?h(6986,"Revert All"):h(6987,"Revert"),run:()=>i.revert(c)})),n.notify({id:e.map(({editor:d})=>lc(d.resource?.toString())).join(),severity:Fe.Error,message:h(6988,"Failed to save '{0}': {1}",e.map(({editor:d})=>d.getName()).join(", "),bo(r,!1)),actions:{primary:a}})}}}Me.registerCommandAndKeybindingRule({when:void 0,weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyS,id:GO,handler:s=>q4(s,{reason:gi.EXPLICIT,force:!0})});Me.registerCommandAndKeybindingRule({when:void 0,weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyS),win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyS)},id:zle,handler:s=>q4(s,{reason:gi.EXPLICIT,force:!0,skipSaveParticipants:!0})});Me.registerCommandAndKeybindingRule({id:k4,weight:W.WorkbenchContrib,when:void 0,primary:E.CtrlCmd|E.Shift|S.KeyS,handler:s=>q4(s,{reason:gi.EXPLICIT,saveAs:!0})});Me.registerCommandAndKeybindingRule({when:void 0,weight:W.WorkbenchContrib,primary:void 0,mac:{primary:E.CtrlCmd|E.Alt|S.KeyS},win:{primary:lt(E.CtrlCmd|S.KeyK,S.KeyS)},id:T4,handler:s=>fue(s,s.get(xe).getGroups(Jo.MOST_RECENTLY_ACTIVE),{reason:gi.EXPLICIT})});Ee.registerCommand({id:zO,handler:(s,e,t)=>{const i=s.get(xe),n=Ns([t],s.get(de),i,s.get(Ei));let o;return n.groupedEditors.length?o=n.groupedEditors.map(({group:r})=>r):o=i.getGroups(Jo.MOST_RECENTLY_ACTIVE),fue(s,o,{reason:gi.EXPLICIT})}});Ee.registerCommand({id:qle,handler:async s=>(await s.get(de).saveAll({includeUntitled:!1,reason:gi.EXPLICIT})).success});Ee.registerCommand({id:$O,handler:async s=>{const e=s.get(xe),t=s.get(de);let i=Ahe(s);if(!i){const n=e.activeGroup;n.activeEditor&&(i=[{groupId:n.id,editor:n.activeEditor}])}if(!(!i||i.length===0))try{await t.revert(i.filter(({editor:n})=>!n.hasCapability(Je.Untitled)),{force:!0})}catch(n){s.get(Dt).error(h(6989,"Failed to revert '{0}': {1}",i.map(({editor:r})=>r.getName()).join(", "),bo(n,!1)))}}});const r1e=(s,e,t)=>{if(Array.isArray(e)){const i=s.get(Hn),n=s.get(Hs);e=e.map(o=>HF(o)&&o.workspaceUri.scheme===ae.untitled?{workspaceUri:Ct(n.untitledWorkspacesHome,o.workspaceUri.path,P_e)}:o),i.openWindow(e,t)}},a1e=(s,e)=>{s.get(Hn).openWindow(e)};Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:dCe,primary:E.CtrlCmd|S.Enter,mac:{primary:E.WinCtrl|S.Enter},id:Wle,handler:async(s,e)=>{const t=s.get(de),i=s.get(je),n=s.get(Zi),o=pD(e,s.get(Ei),t,s.get(xe),n);if(o.length){const r=o.filter(u=>u.scheme===ae.untitled),a=o.filter(u=>u.scheme!==ae.untitled),l=(await Promise.all(a.map(async u=>{const g=n.findClosest(u);return g||await i.stat(u)}))).filter(u=>!u.isDirectory).map(u=>({resource:u.resource,options:{pinned:!0}})).concat(...r.map(u=>({resource:u,options:{pinned:!0}})));await t.openEditors(l,Rr)}}});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Ra,yo.toNegated()),primary:S.Enter,mac:{primary:E.CtrlCmd|S.DownArrow},id:"explorer.openAndPassFocus",handler:async(s,e)=>{const t=s.get(de),n=s.get(Zi).getContext(!0);n.length&&await t.openEditors(n.map(o=>({resource:o.resource,options:{preserveFocus:!1,pinned:!0}})))}});const q1="showModifications";let Pg=[];Me.registerCommandAndKeybindingRule({id:D4,when:void 0,weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyD),handler:async(s,e)=>{const t=s.get(Z),i=s.get(Ci),n=s.get(de),o=s.get(je),r=s.get(Ei);let a=!1;if(Pg.length===0){a=!0;const d=t.createInstance(gA);Pg.push(d),Pg.push(i.registerTextModelContentProvider(q1,d))}const c=dS(e,n,r);if(c&&o.hasProvider(c)){const d=Qe(c),l=h(6990,"{0} (in file)  {1}",d,d);try{await gA.open(c,q1,l,n,{pinned:!0}),a&&Pg.push(n.onDidVisibleEditorsChange(()=>{n.editors.some(u=>!!Di.getCanonicalUri(u,{supportSideBySide:qt.SECONDARY,filterByScheme:q1}))||(Pg=Xe(Pg))}))}catch{Pg=Xe(Pg)}}}});let f2,K1;Ee.registerCommand({id:Vle,handler:(s,e)=>{f2=dS(e,s.get(de),s.get(Ei)),K1||(K1=R4.bindTo(s.get(fe))),K1.set(!0)}});Ee.registerCommand({id:Hle,handler:async(s,e)=>{const t=s.get(de),i=pD(e,s.get(Ei),t,s.get(xe),s.get(Zi));return i.length===2?t.openEditor({original:{resource:i[0]},modified:{resource:i[1]},options:{pinned:!0}}):!0}});Ee.registerCommand({id:Ule,handler:(s,e)=>{const t=s.get(de),i=dS(e,t,s.get(Ei));f2&&i&&t.openEditor({original:{resource:f2},modified:{resource:i},options:{pinned:!0}})}});async function j4(s,e,t,i,n){if(s.length){const o=bn?`\r
`:`
`;let r;const a=e?"explorer.copyRelativePathSeparator":"explorer.copyPathSeparator",c=n.getValue(a);(c==="/"||c==="\\")&&(r=c);const d=s.map(l=>i.getUriLabel(l,{relative:e,noPrefix:!0,separator:r})).join(o);await t.writeText(d)}}const mue=async(s,e)=>{const t=pD(e,s.get(Ei),s.get(de),s.get(xe),s.get(Zi));await j4(t,!1,s.get(Vs),s.get(ui),s.get(ne))};Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus.toNegated(),primary:E.CtrlCmd|E.Alt|S.KeyC,win:{primary:E.Shift|E.Alt|S.KeyC},id:hD,handler:mue});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Alt|S.KeyC),win:{primary:E.Shift|E.Alt|S.KeyC},id:hD,handler:mue});const vue=async(s,e)=>{const t=pD(e,s.get(Ei),s.get(de),s.get(xe),s.get(Zi));await j4(t,!0,s.get(Vs),s.get(ui),s.get(ne))};Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus.toNegated(),primary:E.CtrlCmd|E.Shift|E.Alt|S.KeyC,win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyC)},id:uD,handler:vue});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:V.focus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|E.Alt|S.KeyC),win:{primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|E.Shift|S.KeyC)},id:uD,handler:vue});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:void 0,primary:lt(E.CtrlCmd|S.KeyK,S.KeyP),id:"workbench.action.files.copyPathOfActiveFile",handler:async s=>{const t=s.get(de).activeEditor,i=Di.getOriginalUri(t,{supportSideBySide:qt.PRIMARY});await j4(i?[i]:[],!1,s.get(Vs),s.get(ui),s.get(ne))}});Ee.registerCommand({id:I4,handler:async(s,e)=>{const t=s.get(io),i=s.get(It),n=s.get(Zi),o=s.get(de),r=s.get(Ei),a=dS(e,o,r);if(a&&i.isInsideWorkspace(a)){const c=await t.openView(ld,!1);if(c){const d=c.autoReveal;c.autoReveal=!1,c.setExpanded(!0),await n.select(a,"force"),c.focus(),c.autoReveal=d}}else{const c=t.getViewWithId(bv.ID);c&&(c.setExpanded(!0),c.focus())}}});Ee.registerCommand({id:Ble,handler:async(s,e)=>{const t=s.get(de),i=s.get(Ei),n=dS(e,t,i);if(n)return t.openEditor({resource:n,options:{override:ZT.PICK,source:tN.USER}})}});Ee.registerCommand({id:jle,handler:(s,e)=>{const t=s.get(It),i=s.get(nn),n=t.getWorkspace(),o=pD(e,s.get(Ei),s.get(de),s.get(xe),s.get(Zi)).filter(a=>n.folders.some(c=>i.extUri.isEqual(c.uri,a)));return o.length===0?s.get(Ge).executeCommand(s0.ID):s.get(uc).removeFolders(o)}});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Ra,bI,fq.negate()),primary:S.LeftArrow,id:vNe,handler:s=>{const t=s.get(da).getActivePaneComposite(We.Sidebar);if(t?.getId()!==vI)return;t.getViewPaneContainer().getExplorerView().previousCompressedStat()}});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Ra,bI,mq.negate()),primary:S.RightArrow,id:_Ne,handler:s=>{const t=s.get(da).getActivePaneComposite(We.Sidebar);if(t?.getId()!==vI)return;t.getViewPaneContainer().getExplorerView().nextCompressedStat()}});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Ra,bI,fq.negate()),primary:S.Home,id:bNe,handler:s=>{const t=s.get(da).getActivePaneComposite(We.Sidebar);if(t?.getId()!==vI)return;t.getViewPaneContainer().getExplorerView().firstCompressedStat()}});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib+10,when:x.and(Ra,bI,mq.negate()),primary:S.End,id:yNe,handler:s=>{const t=s.get(da).getActivePaneComposite(We.Sidebar);if(t?.getId()!==vI)return;t.getViewPaneContainer().getExplorerView().lastCompressedStat()}});Me.registerCommandAndKeybindingRule({weight:W.WorkbenchContrib,when:null,primary:Kt?bn?lt(E.CtrlCmd|S.KeyK,S.KeyN):E.CtrlCmd|E.Alt|S.KeyN:E.CtrlCmd|S.KeyN,secondary:Kt?[E.CtrlCmd|S.KeyN]:void 0,id:aS,metadata:{description:Yle,args:[{isOptional:!0,name:"New Untitled Text File arguments",description:"The editor view type or language ID if known",schema:{type:"object",properties:{viewType:{type:"string"},languageId:{type:"string"}}}}]},handler:async(s,e)=>{await s.get(de).openEditor({resource:void 0,options:{override:e?.viewType,pinned:!0},languageId:e?.languageId})}});Ee.registerCommand({id:wNe,handler:async(s,e)=>{const t=s.get(de),i=s.get(to),n=s.get(je),o=h(6991,"Create File"),r=Ct(await i.defaultFilePath(),e?.fileName??"Untitled.txt"),a=await i.showSaveDialog({saveLabel:o,title:o,defaultUri:r});a&&(await n.createFile(a,void 0,{overwrite:!0}),await t.openEditor({resource:a,options:{override:e?.viewType,pinned:!0},languageId:e?.languageId}))}});Y(LP);Y(MP);Y(NP);Y(YC);Y(FP);Y(XO);Y(OP);Y(WP);Y(BP);Y(VP);Y(HP);Ee.registerCommand("_files.windowOpen",r1e);Ee.registerCommand("_files.newWindow",a1e);const Dg=10,_ue="renameFile";Me.registerCommandAndKeybindingRule({id:_ue,weight:W.WorkbenchContrib+Dg,when:x.and(Ra,Cd.toNegated(),Oh),primary:S.F2,mac:{primary:S.Enter},handler:jOe});const bue="moveFileToTrash";Me.registerCommandAndKeybindingRule({id:bue,weight:W.WorkbenchContrib+Dg,when:x.and(Ra,yI),primary:S.Delete,mac:{primary:E.CtrlCmd|S.Backspace,secondary:[S.Delete]},handler:YOe});const g0="deleteFile";Me.registerCommandAndKeybindingRule({id:g0,weight:W.WorkbenchContrib+Dg,when:Ra,primary:E.Shift|S.Delete,mac:{primary:E.CtrlCmd|E.Alt|S.Backspace},handler:Ihe});Me.registerCommandAndKeybindingRule({id:g0,weight:W.WorkbenchContrib+Dg,when:x.and(Ra,yI.toNegated()),primary:S.Delete,mac:{primary:E.CtrlCmd|S.Backspace},handler:Ihe});const yue="filesExplorer.cut";Me.registerCommandAndKeybindingRule({id:yue,weight:W.WorkbenchContrib+Dg,when:x.and(Ra,Cd.toNegated(),Oh),primary:E.CtrlCmd|S.KeyX,handler:XOe});const wue="filesExplorer.copy";Me.registerCommandAndKeybindingRule({id:wue,weight:W.WorkbenchContrib+Dg,when:x.and(Ra,Cd.toNegated()),primary:E.CtrlCmd|S.KeyC,handler:QOe});const Y4="filesExplorer.paste";Ee.registerCommand(Y4,e0e);Me.registerKeybindingRule({id:`^${Y4}`,weight:W.WorkbenchContrib+Dg,when:x.and(Ra,Oh),primary:E.CtrlCmd|S.KeyV});Me.registerCommandAndKeybindingRule({id:"filesExplorer.cancelCut",weight:W.WorkbenchContrib+Dg,when:x.and(Ra,Soe),primary:S.Escape,handler:async s=>{await s.get(Zi).setToCopy([],!0)}});Me.registerCommandAndKeybindingRule({id:"filesExplorer.openFilePreserveFocus",weight:W.WorkbenchContrib+Dg,when:x.and(Ra,yo.toNegated()),primary:S.Space,handler:i0e});const vD={id:hD,title:h(6854,"Copy Path")},_D={id:uD,title:h(6855,"Copy Relative Path")},Zy={id:I4,title:h(6856,"Reveal in Explorer View")};Q4(hD,vD.title,hi.IsFileSystemResource,"1_cutcopypaste",!0);Q4(uD,_D.title,hi.IsFileSystemResource,"1_cutcopypaste",!0);Q4(Zy.id,Zy.title,hi.IsFileSystemResource,"2_files",!1,1);function Q4(s,e,t,i,n,o){const r=n!==!0?voe.negate():void 0;ge.appendMenuItem(N.EditorTitleContext,{command:{id:s,title:e,precondition:r},when:t,group:i,order:o})}Sue("workbench.files.action.acceptLocalChanges",h(6857,"Use your changes and overwrite file contents"),K.check,-10,d0e);Sue("workbench.files.action.revertLocalChanges",h(6858,"Discard your changes and revert to file contents"),K.discard,-9,l0e);function Sue(s,e,t,i,n){Ee.registerCommand(s,n),ge.appendMenuItem(N.EditorTitle,{command:{id:s,title:e,icon:t},when:x.equals(Dhe,!0),group:"navigation",order:i})}function Td({id:s,title:e,category:t,metadata:i},n){ge.appendMenuItem(N.CommandPalette,{command:{id:s,title:e,category:t,metadata:i},when:n})}Td({id:hD,title:I(6859,"Copy Path of Active File"),category:te.File});Td({id:uD,title:I(6860,"Copy Relative Path of Active File"),category:te.File});Td({id:GO,title:Gle,category:te.File});Td({id:zle,title:pNe,category:te.File});Td({id:zO,title:I(6861,"Save All in Group"),category:te.File});Td({id:qle,title:I(6862,"Save All Files"),category:te.File});Td({id:$O,title:I(6863,"Revert File"),category:te.File});Td({id:D4,title:I(6864,"Compare Active File with Saved"),category:te.File,metadata:{description:I(6865,"Opens a new diff editor to compare the active file with the version on disk.")}});Td({id:k4,title:$le,category:te.File});Td({id:gD,title:mhe,category:te.File},wN.notEqualsTo("0"));Td({id:QO,title:vhe,category:te.File,metadata:{description:I(6866,"Create a new folder or directory")}},wN.notEqualsTo("0"));Td({id:aS,title:Yle,category:te.File});const X4=x.or(hi.IsFileSystemResource,hi.Scheme.isEqualTo(ae.untitled)),p0={id:Wle,title:h(6867,"Open to the Side")};ge.appendMenuItem(N.OpenEditorsContext,{group:"navigation",order:10,command:p0,when:X4});ge.appendMenuItem(N.OpenEditorsContext,{group:"1_open",order:10,command:{id:uhe,title:h(6868,"Reopen Editor With...")},when:x.and(_I,g_.toNegated())});ge.appendMenuItem(N.OpenEditorsContext,{group:"1_cutcopypaste",order:10,command:vD,when:hi.IsFileSystemResource});ge.appendMenuItem(N.OpenEditorsContext,{group:"1_cutcopypaste",order:20,command:_D,when:hi.IsFileSystemResource});ge.appendMenuItem(N.OpenEditorsContext,{group:"2_save",order:10,command:{id:GO,title:Gle,precondition:qO},when:x.or(hi.Scheme.isEqualTo(ae.untitled),x.and(g_.toNegated(),A4.toNegated(),vq.toNegated()))});ge.appendMenuItem(N.OpenEditorsContext,{group:"2_save",order:20,command:{id:$O,title:h(6863,"Revert File"),precondition:qO},when:x.and(g_.toNegated(),A4.toNegated(),hi.Scheme.notEqualsTo(ae.untitled),vq.toNegated())});ge.appendMenuItem(N.OpenEditorsContext,{group:"2_save",order:30,command:{id:zO,title:h(6869,"Save All"),precondition:Coe},when:g_});ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:10,command:{id:D4,title:h(6870,"Compare with Saved"),precondition:qO},when:x.and(hi.IsFileSystemResource,vq.toNegated(),Wv.toNegated())});const Cue={id:Ule,title:h(6871,"Compare with Selected")};ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:20,command:Cue,when:x.and(hi.HasResource,R4,X4,Wv.toNegated())});const Eue={id:Vle,title:h(6872,"Select for Compare")};ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:30,command:Eue,when:x.and(hi.HasResource,X4,Wv.toNegated())});const Z4={id:Hle,title:h(6873,"Compare Selected")};ge.appendMenuItem(N.OpenEditorsContext,{group:"3_compare",order:30,command:Z4,when:x.and(hi.HasResource,Wv,Kle)});ge.appendMenuItem(N.EditorTitleContext,{group:"1_compare",order:30,command:Z4,when:x.and(hi.HasResource,_oe,boe)});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:10,command:{id:cS,title:h(6874,"Close")},when:g_.toNegated()});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:20,command:{id:hhe,title:h(6875,"Close Others")},when:g_.toNegated()});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:30,command:{id:che,title:h(6876,"Close Saved")}});ge.appendMenuItem(N.OpenEditorsContext,{group:"4_close",order:40,command:{id:dhe,title:h(6877,"Close All")}});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:4,command:{id:gD,title:mhe,precondition:Oh},when:yo});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:6,command:{id:QO,title:vhe,precondition:Oh},when:yo});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:10,command:p0,when:x.and(yo.toNegated(),hi.HasResource)});ge.appendMenuItem(N.ExplorerContext,{group:"navigation",order:20,command:{id:Ble,title:h(6878,"Open With...")},when:x.and(yo.toNegated(),Eoe)});ge.appendMenuItem(N.ExplorerContext,{group:"3_compare",order:20,command:Cue,when:x.and(yo.toNegated(),hi.HasResource,R4,Wv.toNegated())});ge.appendMenuItem(N.ExplorerContext,{group:"3_compare",order:30,command:Eue,when:x.and(yo.toNegated(),hi.HasResource,Wv.toNegated())});ge.appendMenuItem(N.ExplorerContext,{group:"3_compare",order:30,command:Z4,when:x.and(yo.toNegated(),hi.HasResource,Wv)});ge.appendMenuItem(N.ExplorerContext,{group:"5_cutcopypaste",order:8,command:{id:yue,title:h(6879,"Cut")},when:x.and(Cd.toNegated(),Oh)});ge.appendMenuItem(N.ExplorerContext,{group:"5_cutcopypaste",order:10,command:{id:wue,title:OOe},when:Cd.toNegated()});ge.appendMenuItem(N.ExplorerContext,{group:"5_cutcopypaste",order:20,command:{id:Y4,title:FOe,precondition:x.and(Oh,_he)},when:yo});ge.appendMenuItem(N.ExplorerContext,{group:"5b_importexport",order:10,command:{id:bhe,title:WOe},when:x.or(x.and(Eu.toNegated(),hi.Scheme.notEqualsTo(ae.file)),x.and(Eu,yo.toNegated(),Cd.toNegated()),x.and(Eu,lCe))});ge.appendMenuItem(N.ExplorerContext,{group:"5b_importexport",order:20,command:{id:yhe,title:BOe},when:x.and(Eu,yo,Oh)});ge.appendMenuItem(N.ExplorerContext,{group:"6_copypath",order:10,command:vD,when:hi.IsFileSystemResource});ge.appendMenuItem(N.ExplorerContext,{group:"6_copypath",order:20,command:_D,when:hi.IsFileSystemResource});ge.appendMenuItem(N.ExplorerContext,{group:"2_workspace",order:10,command:{id:JO,title:Rhe},when:x.and(Cd,x.or(vl,ml.isEqualTo("workspace")))});ge.appendMenuItem(N.ExplorerContext,{group:"2_workspace",order:30,command:{id:jle,title:mNe},when:x.and(Cd,yo,x.and(wN.notEqualsTo("0"),x.or(vl,ml.isEqualTo("workspace"))))});ge.appendMenuItem(N.ExplorerContext,{group:"7_modification",order:10,command:{id:_ue,title:MOe,precondition:Oh},when:Cd.toNegated()});ge.appendMenuItem(N.ExplorerContext,{group:"7_modification",order:20,command:{id:bue,title:NOe},alt:{id:g0,title:h(6880,"Delete Permanently")},when:x.and(Cd.toNegated(),yI)});ge.appendMenuItem(N.ExplorerContext,{group:"7_modification",order:20,command:{id:g0,title:h(6880,"Delete Permanently")},when:x.and(Cd.toNegated(),yI.toNegated())});for(const s of[N.EmptyEditorGroupContext,N.EditorTabsBarContext])ge.appendMenuItem(s,{command:{id:aS,title:h(6881,"New Text File")},group:"1_file",order:10}),ge.appendMenuItem(s,{command:{id:"workbench.action.quickOpen",title:h(6882,"Open File...")},group:"1_file",order:20});ge.appendMenuItem(N.MenubarFileMenu,{group:"1_new",command:{id:aS,title:h(6883,"&&New Text File")},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"4_save",command:{id:GO,title:h(6884,"&&Save"),precondition:x.or($v,x.and(wI,CN))},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"4_save",command:{id:k4,title:h(6885,"Save &&As..."),precondition:x.or($v,x.and(wI,CN))},order:2});ge.appendMenuItem(N.MenubarFileMenu,{group:"4_save",command:{id:T4,title:h(6886,"Save A&&ll"),precondition:Coe},order:3});ge.appendMenuItem(N.MenubarFileMenu,{group:"5_autosave",command:{id:XO.ID,title:h(6887,"A&&uto Save"),toggled:x.notEquals("config.files.autoSave","off")},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:$O,title:h(6888,"Re&&vert File"),precondition:x.or(x.and(yoe),x.and(hi.Scheme.notEqualsTo(ae.untitled),wI,CN))},order:1});ge.appendMenuItem(N.MenubarFileMenu,{group:"6_close",command:{id:cS,title:h(6889,"&&Close Editor"),precondition:x.or($v,x.and(wI,CN))},order:2});ge.appendMenuItem(N.MenubarGoMenu,{group:"3_global_nav",command:{id:"workbench.action.quickOpen",title:h(6890,"Go to &&File...")},order:1});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"navigation",order:10,command:p0,when:x.and(hi.IsFileSystemResource,yo.toNegated())});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"navigation",order:20,command:Zy,when:hi.IsFileSystemResource});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"1_cutcopypaste",order:10,command:vD,when:hi.IsFileSystemResource});ge.appendMenuItem(N.ChatAttachmentsContext,{group:"1_cutcopypaste",order:20,command:_D,when:hi.IsFileSystemResource});for(const s of[N.ChatInlineResourceAnchorContext,N.ChatInputResourceAttachmentContext])ge.appendMenuItem(s,{group:"navigation",order:10,command:p0,when:x.and(hi.HasResource,yo.toNegated())}),ge.appendMenuItem(s,{group:"navigation",order:20,command:Zy,when:hi.IsFileSystemResource}),ge.appendMenuItem(s,{group:"1_cutcopypaste",order:10,command:vD,when:hi.IsFileSystemResource}),ge.appendMenuItem(s,{group:"1_cutcopypaste",order:20,command:_D,when:hi.IsFileSystemResource});const c1e=new O("chatAttachmentResource",void 0,{type:"URI",description:h(4610,"The full value of the chat attachment resource, including scheme and path")});let nJ=class extends F{constructor(e,t=[],i=j(".chat-attached-context"),n,o,r,a,c,d,l,u,g){super(),this.variables=e,this.contentReferences=t,this.domNode=i,this.contextKeyService=n,this.instantiationService=o,this.openerService=r,this.hoverService=a,this.commandService=c,this.themeService=d,this.labelService=l,this.notebookService=u,this.editorService=g,this.attachedContextDisposables=this._register(new U),this._onDidChangeVisibility=this._register(new M),this._contextResourceLabels=this._register(this.instantiationService.createInstance(vd,{onDidChangeVisibility:this._onDidChangeVisibility.event})),this.initAttachedContext(i),i.childElementCount||(this.domNode=void 0)}initAttachedContext(e){Xi(e),this.attachedContextDisposables.clear();const t=this.attachedContextDisposables.add(Zm());this.variables.forEach(async i=>{let n=R.isUri(i.value)?i.value:i.value&&typeof i.value=="object"&&"uri"in i.value&&R.isUri(i.value.uri)?i.value.uri:void 0,o=i.value&&typeof i.value=="object"&&"range"in i.value&&P.isIRange(i.value.range)?i.value.range:void 0;const r=ee(e,j(".chat-attached-context-attachment.show-file-icons")),a=this._contextResourceLabels.create(r,{supportIcons:!0,hoverDelegate:t,hoverTargetOverride:r});this.attachedContextDisposables.add(a);const c=this.contentReferences.find(w=>typeof w.reference=="object"&&"variableName"in w.reference&&w.reference.variableName===i.name||R.isUri(w.reference)&&an(w.reference.path)===i.name),d=c?.options?.status?.kind===Ay.Omitted,l=d||c?.options?.status?.kind===Ay.Partial;let u;const g=(w,C,k,D)=>{if(i.omittedState===qn.Full)this.customAttachment(r,C,t,w,d);else{const A={hidePath:!0,title:c?.options?.status?.description};a.setFile(k,i.kind==="file"?{...A,fileKind:Pi.FILE,range:o}:{...A,fileKind:Pi.FOLDER,icon:D||(this.themeService.getFileIconTheme().hasFolderIcons?void 0:Kne)})}this.instantiationService.invokeFunction(A=>{k&&this.attachedContextDisposables.add(jb(A,r,k))})},m=(w,C,k,D)=>{const A=fm(i)&&i.isURL,B=this.customAttachment(r,i.name,t,w,d,!0,A,i.value);if(C){r.style.cursor="pointer";const Q=()=>{this.openResource(C,!1,void 0)};this.attachedContextDisposables.add(re(r,"click",Q))}const q=i.omittedState===qn.Partial?qn.Partial:d?qn.Full:void 0;this.createImageElements(D,r,B,k,C,q),this.attachedContextDisposables.add(this.hoverService.setupDelayedHover(r,{content:B,appearance:{showPointer:!0}})),r.style.position="relative"},v=w=>{const C=w.fullName??w.name,k=w.icon?.id?`$(${w.icon.id})${C}`:C;a.setLabel(k,c?.options?.status?.description)};if(n&&vce(i)){const w=i.name,C=this.getOutputItem(n,i);switch(C?.mime.startsWith("image/")?i.omittedState===qn.Full?u=h(4611,"Omitted: {0}",w):i.omittedState===qn.Partial?u=h(4612,"Partially omitted: {0}",w):u=h(4613,"Attached: {0}",w):d?u=h(4614,"Omitted: {0}.",w):l?u=h(4615,"Partially attached: {0}.",w):u=h(4616,"Attached: {0}.",w),C?.mime){case"application/vnd.code.notebook.error":{v(i);break}case"image/png":case"image/jpeg":case"image/svg":{m(u,n,i.name,C.data.buffer);break}default:g(u,i.name,n,ke.fromId("output"))}this.instantiationService.invokeFunction(k=>{n&&this.attachedContextDisposables.add(jb(k,r,n))})}else if(n&&(i.kind==="file"||i.kind==="directory")){const w=an(n.path),C=jM(n.path),k=`${w} ${C}`;d?u=o?h(4617,"Omitted: {0}, line {1} to line {2}.",k,o.startLineNumber,o.endLineNumber):h(4618,"Omitted: {0}.",k):l?u=o?h(4619,"Partially attached: {0}, line {1} to line {2}.",k,o.startLineNumber,o.endLineNumber):h(4620,"Partially attached: {0}.",k):u=o?h(4621,"Attached: {0}, line {1} to line {2}.",k,o.startLineNumber,o.endLineNumber):h(4622,"Attached: {0}.",k),g(u,k,n)}else if(fm(i)){i.omittedState===qn.Full?u=h(4623,"Omitted this image: {0}",i.name):i.omittedState===qn.Partial?u=h(4624,"Partially omitted this image: {0}",i.name):u=h(4625,"Attached image, {0}",i.name);const w=i.references?.[0]?.reference,C=w&&R.isUri(w)?w:void 0;m(u,C,C?.toString()??"",i.value)}else if(_ce(i)){u=h(4626,"Attached element, {0}",i.name),r.style.cursor="pointer";const w=i.name,C=i.icon?.id?`$(${i.icon.id})${w}`:w;a.setLabel(C,void 0,{title:h(4627,"Click to view the contents of: {0}",w)}),this._register(re(r,pe.CLICK,async()=>{const k=i.value?.toString()||"";await this.editorService.openEditor({resource:void 0,contents:k,options:{pinned:!0}})}))}else if(mce(i)){u=h(4628,"Attached context, {0}",i.name);const w=["file-icon",`${i.language}-lang-file-icon`];if(i.copiedFrom){n=i.copiedFrom.uri,o=i.copiedFrom.range;const k=an(n.path);a.setLabel(k,void 0,{extraClasses:w})}else a.setLabel(i.fileName,void 0,{extraClasses:w});r.appendChild(j("span.attachment-additional-info",{},`Pasted ${i.pastedLines}`)),r.style.position="relative";const C={markdown:{value:`**${i.copiedFrom?this.labelService.getUriLabel(i.copiedFrom.uri,{relative:!0}):i.fileName}**

---

\`\`\`${i.language}
${i.code}
\`\`\``},markdownNotSupportedFallback:i.code};if(!this.attachedContextDisposables.isDisposed){this.attachedContextDisposables.add(this.hoverService.setupManagedHover(t,r,C,{trapFocus:!0}));const k=i.copiedFrom?.uri;k&&this.attachedContextDisposables.add(this.instantiationService.invokeFunction(D=>jb(D,r,k)))}}else u=h(4629,"Attached context: {0}.",i.name),v(i);if(i.kind==="symbol"){const w=this.attachedContextDisposables.add(this.contextKeyService.createScoped(r));this.attachedContextDisposables.add(this.instantiationService.invokeFunction(C=>xue(C,r,w,{...i,kind:i.symbolKind},N.ChatInputSymbolAttachmentContext)))}l&&r.classList.add("warning");const _=c?.options?.status?.description;if(l){u=`${u}${_?` ${_}`:""}`;for(const w of[".monaco-icon-suffix-container",".monaco-icon-name-container"]){const C=a.element.querySelector(w);C&&C.classList.add("warning")}}this.attachedContextDisposables.isDisposed||(n&&(r.style.cursor="pointer",this.attachedContextDisposables.isDisposed||this.attachedContextDisposables.add(re(r,pe.CLICK,async w=>{Vi.stop(w,!0),i.kind==="directory"?this.openResource(n,!0):this.openResource(n,!1,o)}))),r.ariaLabel=u,r.tabIndex=0)})}getOutputItem(e,t){const i=ud.parseCellOutputUri(e);if(!i||typeof i.cellHandle!="number"||typeof i.outputIndex!="number")return;const n=this.notebookService.getNotebookTextModel(i.notebook);if(!n)return;const o=n.cells.find(a=>a.handle===i.cellHandle);return o?(o.outputs.length>i.outputIndex?o.outputs[i.outputIndex]:void 0)?.outputs.find(a=>a.mime===t.mimeType):void 0}customAttachment(e,t,i,n,o,r,a,c){const d=j("div.chat-attached-context-pill",{},j(o?"span.codicon.codicon-warning":"span.codicon.codicon-file-media")),l=j("span.chat-attached-context-custom-text",{},t);e.appendChild(d),e.appendChild(l);const u=j("div.chat-attached-context-hover");return u.setAttribute("aria-label",n),a&&!o&&c&&(u.textContent=h(4630,"{0}",ERe(c)),this.attachedContextDisposables.add(this.hoverService.setupDelayedHover(e,{content:u,appearance:{showPointer:!0}}))),o&&(e.classList.add("warning"),u.textContent=h(4631,"Selected model does not support this {0} type.",r?"image":"file"),this.attachedContextDisposables.add(this.hoverService.setupDelayedHover(e,{content:u,appearance:{showPointer:!0}}))),u}openResource(e,t,i){if(t){this.commandService.executeCommand(Zy.id,e);return}const o={fromUserGesture:!0,editorOptions:i?{selection:i}:void 0};this.openerService.open(e,o)}createImageElements(e,t,i,n,o,r){if(r===qn.Full)return;r===qn.Partial&&t.classList.add("partial-warning");const a=new Blob([e],{type:"image/png"}),c=URL.createObjectURL(a),d=j("img.chat-attached-context-pill-image",{src:c,alt:""}),l=j("div.chat-attached-context-pill",{},d),u=t.querySelector(".chat-attached-context-pill");u&&u.replaceWith(l);const g=j("img.chat-attached-context-image",{src:c,alt:""}),m=j("div.chat-attached-context-image-container",{},g);if(i.appendChild(m),o){const v=j("a.chat-attached-context-url",{},r===qn.Partial?h(4632,"This GIF was partially omitted - current frame was be sent."):n),_=j("div.chat-attached-context-url-separator");this._register(re(v,"click",()=>this.openResource(o,!1,void 0))),i.append(_,v)}g.onload=()=>{URL.revokeObjectURL(c)},g.onerror=()=>{const v=j("div.chat-attached-context-pill",{},j("span.codicon.codicon-file-media")),_=j("div.chat-attached-context-pill",{},v),w=t.querySelector(".chat-attached-context-pill");w&&w.replaceWith(_)}}};nJ=f([p(3,fe),p(4,Z),p(5,mi),p(6,Ti),p(7,Ge),p(8,pt),p(9,ui),p(10,bl),p(11,de)],nJ);function jb(s,e,t){const i=s.get(fe),n=s.get(Z),o=new U,r=o.add(i.createScoped(e));return o.add(Iue(s,r,t)),e.draggable=!0,o.add(re(e,"dragstart",a=>{n.invokeFunction(c=>ag(c,[t],a)),a.dataTransfer?.setDragImage(e,0,0)})),o.add(Due(s,e,r,N.ChatInputResourceAttachmentContext,t)),o}function xue(s,e,t,i,n){const o=s.get(Z),r=s.get(Ne),a=s.get(Ci),c=new U;c.add(Iue(s,t,i.value.uri)),c1e.bindTo(t).set(i.value.uri.toString()),e.draggable=!0,c.add(re(e,"dragstart",g=>{o.invokeFunction(m=>ag(m,[{resource:i.value.uri,selection:i.value.range}],g)),cde([{fsPath:i.value.uri.fsPath,range:i.value.range,name:i.name,kind:i.kind}],g),g.dataTransfer?.setDragImage(e,0,0)}));const l=[[V.hasDefinitionProvider.bindTo(t),r.definitionProvider],[V.hasReferenceProvider.bindTo(t),r.referenceProvider],[V.hasImplementationProvider.bindTo(t),r.implementationProvider],[V.hasTypeDefinitionProvider.bindTo(t),r.typeDefinitionProvider]],u=async()=>{const g=await a.createModelReference(i.value.uri);try{const m=g.object.textEditorModel;for(const[v,_]of l)v.set(_.has(m))}finally{g.dispose()}};return c.add(Due(s,e,t,n,i.value,u)),c}function Iue(s,e,t){const i=s.get(je),n=s.get(vi),o=s.get(ci),r=new hi(e,i,n,o);return r.set(t),r}function Due(s,e,t,i,n,o){const r=s.get(bi),a=s.get(fn);return re(e,pe.CONTEXT_MENU,async c=>{const d=new bs(Et(c),c);Vi.stop(c,!0);try{await o?.()}catch(l){console.error(l)}r.showContextMenu({contextKeyService:t,getAnchor:()=>d,getActions:()=>{const l=a.getMenuActions(i,t,{arg:n});return rI(l)}})})}let Xp=class extends F{get onDidDelete(){return this._onDidDelete.event}constructor(e,t,i,n,o,r,a,c){super(),this.attachment=e,this.shouldFocusClearButton=t,this.hoverDelegate=o,this.currentLanguageModel=r,this.commandService=a,this.openerService=c,this._onDidDelete=this._register(new M),this.element=ee(i,j(".chat-attached-context-attachment.show-file-icons")),this.label=n.create(this.element,{supportIcons:!0,hoverDelegate:o,hoverTargetOverride:this.element}),this._register(this.label),this.element.tabIndex=0}modelSupportsVision(){return kue(this.currentLanguageModel)}attachClearButton(){if(this.attachment.range)return;const e=new zu(this.element,{supportIcons:!0,hoverDelegate:this.hoverDelegate,title:h(4594,"Remove from context")});e.icon=K.close,this._register(e),this._register(T.once(e.onDidClick)(t=>{this._onDidDelete.fire(t)})),this._register(No(this.element,pe.KEY_DOWN,t=>{(t.keyCode===S.Backspace||t.keyCode===S.Delete)&&this._onDidDelete.fire(t.browserEvent)})),this.shouldFocusClearButton&&e.focus()}addResourceOpenHandlers(e,t){this.element.style.cursor="pointer",this._register(re(this.element,pe.CLICK,i=>{Vi.stop(i,!0),this.attachment.kind==="directory"?this.openResource(e,!0):this.openResource(e,!1,t)})),this._register(re(this.element,pe.KEY_DOWN,i=>{const n=new vo(i);(n.equals(S.Enter)||n.equals(S.Space))&&(Vi.stop(i,!0),this.attachment.kind==="directory"?this.openResource(e,!0):this.openResource(e,!1,t))}))}openResource(e,t,i){if(t){this.commandService.executeCommand(Zy.id,e);return}const o={fromUserGesture:!0,editorOptions:i?{selection:i}:void 0};this.openerService.open(e,o)}};Xp=f([p(6,Ge),p(7,mi)],Xp);function kue(s){return s?.metadata.capabilities?.vision??!1}let m2=class extends Xp{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(i,o,r,a,c,n,d,l),this.themeService=u,this.hoverService=g,this.languageModelsService=m,this.instantiationService=v;const _=an(e.path),w=jM(e.path),C=`${_} ${w}`;let k=t?h(4595,"Attached file, {0}, line {1} to line {2}",C,t.startLineNumber,t.endLineNumber):h(4596,"Attached file, {0}",C);if(i.omittedState===qn.Full)k=h(4597,"Omitted this file: {0}",i.name),this.renderOmittedWarning(C,k,c);else{const D={hidePath:!0};this.label.setFile(e,i.kind==="file"?{...D,fileKind:Pi.FILE,range:t}:{...D,fileKind:Pi.FOLDER,icon:this.themeService.getFileIconTheme().hasFolderIcons?void 0:Kne})}this.element.ariaLabel=k,this.instantiationService.invokeFunction(D=>{this._register(jb(D,this.element,e))}),this.addResourceOpenHandlers(e,t),this.attachClearButton()}renderOmittedWarning(e,t,i){const n=j("div.chat-attached-context-pill",{},j("span.codicon.codicon-warning")),o=j("span.chat-attached-context-custom-text",{},e);this.element.appendChild(n),this.element.appendChild(o);const r=j("div.chat-attached-context-hover");r.setAttribute("aria-label",t),this.element.classList.add("warning"),r.textContent=h(4598,"{0} does not support this {1} type.",this.currentLanguageModel?this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name:this.currentLanguageModel,"file"),this._register(this.hoverService.setupManagedHover(i,this.element,r,{trapFocus:!0}))}};m2=f([p(8,Ge),p(9,mi),p(10,pt),p(11,Ti),p(12,Tw),p(13,Z)],m2);let v2=class extends Xp{constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(t,n,o,r,a,i,c,d),this.hoverService=l,this.languageModelsService=u,this.telemetryService=g;let m;t.omittedState===qn.Full?m=h(4599,"Omitted this image: {0}",t.name):t.omittedState===qn.Partial?m=h(4600,"Partially omitted this image: {0}",t.name):m=h(4601,"Attached image, {0}",t.name);const v=t.references?.[0]?.reference;e=v&&R.isUri(v)?v:void 0;const _=()=>{e&&this.openResource(e,!1,void 0)},w=this.currentLanguageModel?this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name??this.currentLanguageModel.identifier:"unknown",C=this.modelSupportsVision();this.telemetryService.publicLog2("copilot.attachImage",{currentModel:w,supportsVision:C});const k=e?.toString()||t.fullName||t.name;this._register(Tue(e,t.name,k,this.element,t.value,this.hoverService,m,w,_,this.currentLanguageModel,t.omittedState)),e&&this.addResourceOpenHandlers(e,void 0),this.attachClearButton()}};v2=f([p(7,Ge),p(8,mi),p(9,Ti),p(10,Tw),p(11,ai)],v2);function Tue(s,e,t,i,n,o,r,a,c,d,l){const u=new U;l===qn.Partial&&i.classList.add("partial-warning"),i.ariaLabel=r,i.style.position="relative",s&&(i.style.cursor="pointer",u.add(re(i,"click",c)));const g=kue(d),m=j("div.chat-attached-context-pill",{},j(g?"span.codicon.codicon-file-media":"span.codicon.codicon-warning")),v=j("span.chat-attached-context-custom-text",{},e);i.appendChild(m),i.appendChild(v);const _=j("div.chat-attached-context-hover");if(_.setAttribute("aria-label",r),!g&&d)i.classList.add("warning"),_.textContent=h(4598,"{0} does not support this {1} type.",a,"image"),u.add(o.setupDelayedHover(i,{content:_,appearance:{showPointer:!0}}));else{u.add(o.setupDelayedHover(i,{content:_,appearance:{showPointer:!0}}));const w=new Blob([n],{type:"image/png"}),C=URL.createObjectURL(w),k=j("img.chat-attached-context-pill-image",{src:C,alt:""}),D=j("div.chat-attached-context-pill",{},k),A=i.querySelector(".chat-attached-context-pill");A&&A.replaceWith(D);const B=j("img.chat-attached-context-image",{src:C,alt:""}),q=j("div.chat-attached-context-image-container",{},B);if(_.appendChild(q),s){const Q=j("a.chat-attached-context-url",{},l===qn.Partial?h(4602,"This GIF was partially omitted - current frame will be sent."):t),ie=j("div.chat-attached-context-url-separator");u.add(re(Q,"click",()=>c())),_.append(ie,Q)}B.onload=()=>{URL.revokeObjectURL(C)},B.onerror=()=>{const Q=j("div.chat-attached-context-pill",{},j("span.codicon.codicon-file-media")),ie=j("div.chat-attached-context-pill",{},Q),oe=i.querySelector(".chat-attached-context-pill");oe&&oe.replaceWith(ie)}}return u}let _2=class extends Xp{constructor(e,t,i,n,o,r,a,c,d,l){super(e,i,n,o,r,t,a,c),this.hoverService=d,this.instantiationService=l;const u=h(4603,"Attached context, {0}",e.name);this.element.ariaLabel=u;const g=["file-icon",`${e.language}-lang-file-icon`];let m,v;if(e.copiedFrom){m=e.copiedFrom.uri,v=e.copiedFrom.range;const k=an(m.path);this.label.setLabel(k,void 0,{extraClasses:g})}else this.label.setLabel(e.fileName,void 0,{extraClasses:g});this.element.appendChild(j("span.attachment-additional-info",{},`Pasted ${e.pastedLines}`)),this.element.style.position="relative";const _=e.copiedFrom?.uri,w={markdown:{value:`${_?this.instantiationService.invokeFunction(k=>k.get(ui).getUriLabel(_,{relative:!0})):e.fileName}

---

\`\`\`${e.language}

${e.code}
\`\`\``},markdownNotSupportedFallback:e.code};this._register(this.hoverService.setupManagedHover(r,this.element,w,{trapFocus:!0}));const C=e.copiedFrom?.uri;C&&(this._register(this.instantiationService.invokeFunction(jb,this.element,C)),this.addResourceOpenHandlers(C,v)),this.attachClearButton()}};_2=f([p(6,Ge),p(7,mi),p(8,Ti),p(9,Z)],_2);let b2=class extends Xp{constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(i,o,r,a,c,n,d,l),this.contextKeyService=u,this.instantiationService=g;const m=i.fullName??i.name,v=i.icon?.id?`$(${i.icon.id})${m}`:m;if(this.label.setLabel(v,void 0),this.element.ariaLabel=h(4603,"Attached context, {0}",i.name),i.kind==="diagnostic"&&(i.filterUri?(e=i.filterUri?R.revive(i.filterUri):void 0,t=i.filterRange):(this.element.style.cursor="pointer",this._register(re(this.element,pe.CLICK,()=>{this.commandService.executeCommand("workbench.panel.markers.view.focus")})))),i.kind==="symbol"){const _=this._register(this.contextKeyService.createScoped(this.element));this._register(this.instantiationService.invokeFunction(xue,this.element,_,{...i,kind:i.symbolKind},N.ChatInputSymbolAttachmentContext))}e&&this.addResourceOpenHandlers(e,t),this.attachClearButton()}};b2=f([p(8,Ge),p(9,mi),p(10,fe),p(11,Z)],b2);let y2=class extends Xp{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){switch(super(t,n,o,r,a,i,c,d),this.hoverService=l,this.languageModelsService=u,this.notebookService=g,this.instantiationService=m,t.mimeType){case"application/vnd.code.notebook.error":{this.renderErrorOutput(e,t);break}case"image/png":case"image/jpeg":case"image/svg":{this.renderImageOutput(e,t);break}default:this.renderGenericOutput(e,t)}this.instantiationService.invokeFunction(v=>{this._register(jb(v,this.element,e))}),this.addResourceOpenHandlers(e,void 0),this.attachClearButton()}getAriaLabel(e){return h(4604,"Attached Notebook output, {0}",e.name)}renderErrorOutput(e,t){const i=t.name,n=t.icon?.id?`$(${t.icon.id})${i}`:i,o=this.getOutputItem(e,t)?.data.buffer??new Uint8Array;let r;try{const a=JSON.parse(new TextDecoder().decode(o));a.name&&a.message&&(r=`${a.name}: ${a.message}`)}catch{}this.label.setLabel(n,void 0,{title:r}),this.element.ariaLabel=this.getAriaLabel(t)}renderGenericOutput(e,t){this.element.ariaLabel=this.getAriaLabel(t),this.label.setFile(e,{hidePath:!0,icon:ke.fromId("output")})}renderImageOutput(e,t){let i;t.omittedState===qn.Full?i=h(4605,"Omitted this Notebook ouput: {0}",t.name):t.omittedState===qn.Partial?i=h(4606,"Partially omitted this Notebook output: {0}",t.name):i=this.getAriaLabel(t);const n=()=>this.openResource(e,!1,void 0),o=this.currentLanguageModel?this.languageModelsService.lookupLanguageModel(this.currentLanguageModel.identifier)?.name??this.currentLanguageModel.identifier:"unknown",r=this.getOutputItem(e,t)?.data.buffer??new Uint8Array;this._register(Tue(e,t.name,t.name,this.element,r,this.hoverService,i,o,n,this.currentLanguageModel,t.omittedState))}getOutputItem(e,t){const i=ud.parseCellOutputUri(e);if(!i||typeof i.cellHandle!="number"||typeof i.outputIndex!="number")return;const n=this.notebookService.getNotebookTextModel(i.notebook);if(!n)return;const o=n.cells.find(a=>a.handle===i.cellHandle);return o?(o.outputs.length>i.outputIndex?o.outputs[i.outputIndex]:void 0)?.outputs.find(a=>a.mime===t.mimeType):void 0}};y2=f([p(7,Ge),p(8,mi),p(9,Ti),p(10,Tw),p(11,bl),p(12,Z)],y2);let w2=class extends Xp{constructor(e,t,i,n,o,r,a,c,d){super(e,i,n,o,r,t,a,c);const l=h(4607,"Attached element, {0}",e.name);this.element.ariaLabel=l,this.element.style.position="relative",this.element.style.cursor="pointer";const u=e.name,g=e.icon?.id?`$(${e.icon.id})${u}`:u;this.label.setLabel(g,void 0,{title:h(4608,"Click to view the contents of: {0}",u)}),this._register(re(this.element,pe.CLICK,async()=>{const m=e.value?.toString()||"";await d.openEditor({resource:void 0,contents:m,options:{pinned:!0}})})),this.attachClearButton()}};w2=f([p(6,Ge),p(7,mi),p(8,de)],w2);var sJ;(function(s){s[s.CommandPalette=0]="CommandPalette",s[s.StatusBarWindowIndicatorMenu=1]="StatusBarWindowIndicatorMenu"})(sJ||(sJ={}));var S2;(function(s){s.DARK="dark",s.LIGHT="light",s.HIGH_CONTRAST_LIGHT="hcLight",s.HIGH_CONTRAST_DARK="hcDark"})(S2||(S2={}));var oJ;(function(s){s.Null="null",s.Enum="enum",s.String="string",s.MultilineString="multiline-string",s.Integer="integer",s.Number="number",s.Boolean="boolean",s.Array="array",s.Exclude="exclude",s.Include="include",s.Complex="complex",s.NullableInteger="nullable-integer",s.NullableNumber="nullable-number",s.Object="object",s.BooleanObject="boolean-object",s.LanguageTag="language-tag",s.ExtensionToggle="extension-toggle",s.ComplexObject="complex-object"})(oJ||(oJ={}));var sm;(function(s){s[s.None=0]="None",s[s.LanguageTagSettingMatch=1]="LanguageTagSettingMatch",s[s.RemoteMatch=2]="RemoteMatch",s[s.NonContiguousQueryInSettingId=4]="NonContiguousQueryInSettingId",s[s.DescriptionOrValueMatch=8]="DescriptionOrValueMatch",s[s.NonContiguousWordsInSettingsLabel=16]="NonContiguousWordsInSettingsLabel",s[s.ContiguousWordsInSettingsLabel=32]="ContiguousWordsInSettingsLabel",s[s.ContiguousQueryInSettingId=64]="ContiguousQueryInSettingId",s[s.AllWordsInSettingsLabel=128]="AllWordsInSettingsLabel",s[s.ExactMatch=256]="ExactMatch"})(sm||(sm={}));sm.AllWordsInSettingsLabel|sm.ContiguousWordsInSettingsLabel|sm.NonContiguousWordsInSettingsLabel|sm.NonContiguousQueryInSettingId|sm.ContiguousQueryInSettingId;const ZXe="editor.contrib.defineKeybinding",d1e="settings";class l1e{constructor(e,t,i){if(this.location=t,this.parent=i,t[t.length-1]==="\\")throw Error("Unexpected path format, do not use trailing backslashes");t[t.length-1]!=="/"&&(t+="/"),this.isPathIgnored=this.parseIgnoreFile(e,this.location,this.parent)}updateContents(e){this.isPathIgnored=this.parseIgnoreFile(e,this.location,this.parent)}isPathIncludedInTraversal(e,t){if(e[0]!=="/"||e[e.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+e);return!this.isPathIgnored(e,t)}isArbitraryPathIgnored(e,t){if(e[0]!=="/"||e[e.length-1]==="/")throw Error("Unexpected path format, expectred to begin with slash and end without. got:"+e);const i=e.split("/").filter(r=>r);let n=!1,o="";for(let r=0;r<i.length;r++){const a=r===i.length-1,c=i[r];if(o=o+"/"+c,!this.isPathIncludedInTraversal(o,a?t:!0)){n=!0;break}}return n}gitignoreLinesToExpression(e,t,i){const n=e.map(r=>this.gitignoreLineToGlob(r,t)),o=Object.create(null);for(const r of n)o[r]=!0;return Km(o,{trimForExclusions:i})}parseIgnoreFile(e,t,i){const n=e.split(`
`).map(_=>_.trim()).filter(_=>_&&_[0]!=="#"),o=n.filter(_=>!_.endsWith("/")),r=o.filter(_=>!_.includes("!")),a=this.gitignoreLinesToExpression(r,t,!0),c=o.filter(_=>_.includes("!")).map(_=>_.replace(/!/g,"")),d=this.gitignoreLinesToExpression(c,t,!1),l=n.filter(_=>!_.includes("!")),u=this.gitignoreLinesToExpression(l,t,!0),g=n.filter(_=>_.includes("!")).map(_=>_.replace(/!/g,"")),m=this.gitignoreLinesToExpression(g,t,!1);return(_,w)=>_.startsWith(t)?w&&u(_)&&!m(_)||a(_)&&!d(_)?!0:i?i.isPathIgnored(_,w):!1:!1}gitignoreLineToGlob(e,t){const i=e.indexOf("/");return i===-1||i===e.length-1?e="**/"+e:(i===0?t.slice(-1)==="/"&&(e=e.slice(1)):t.slice(-1)!=="/"&&(e="/"+e),e=t+e),e}}var C2;(function(s){s.FileContributionRegistry="workbench.registry.explorer.fileContributions"})(C2||(C2={}));class h1e extends F{constructor(){super(...arguments),this._onDidRegisterDescriptor=this._register(new M),this.onDidRegisterDescriptor=this._onDidRegisterDescriptor.event,this.descriptors=[]}register(e){this.descriptors.push(e),this._onDidRegisterDescriptor.fire(e)}create(e,t,i){return this.descriptors.map(n=>{const o=n.create(e,t);return i.add(o),o})}}const E2=new h1e;Ke.add(C2.FileContributionRegistry,E2);var x2,Ld;class nL{static{this.ITEM_HEIGHT=22}getHeight(e){return nL.ITEM_HEIGHT}getTemplateId(e){return sL.ID}}const I2=new M;let D2=class{constructor(e,t,i,n,o,r,a,c,d,l){this.fileFilter=e,this.findProvider=t,this.progressService=i,this.configService=n,this.notificationService=o,this.layoutService=r,this.fileService=a,this.explorerService=c,this.contextService=d,this.filesConfigService=l}getParent(e){if(e.parent)return e.parent;throw new Error("getParent only supported for cached parents")}hasChildren(e){return Array.isArray(e)||e.hasChildren(t=>this.fileFilter.filter(t,um.Visible))}getChildren(e){if(Array.isArray(e))return e;if(this.findProvider.isShowingFilterResults())return Array.from(e.children.values());const t=e.error,i=this.explorerService.sortOrderConfiguration.sortOrder,n=e.fetchChildren(i);if(Array.isArray(n))return n;const o=n.then(r=>(e instanceof Ts&&e.isRoot&&!e.error&&t&&this.contextService.getWorkbenchState()!==Zo.FOLDER&&I2.fire(e.resource),r),r=>{if(e instanceof Ts&&e.isRoot)if(this.contextService.getWorkbenchState()===Zo.FOLDER){const a=new Ts(e.resource,this.fileService,this.configService,this.filesConfigService,void 0,void 0,!1);return a.error=r,[a]}else I2.fire(e.resource);else this.notificationService.error(r);return[]});return this.progressService.withProgress({location:Xo.Explorer,delay:this.layoutService.isRestored()?800:1500},r=>o),o}};D2=f([p(2,pl),p(3,ne),p(4,Dt),p(5,yi),p(6,je),p(7,Zi),p(8,It),p(9,Us)],D2);class rJ extends Ts{constructor(e,t,i,n,o,r){super(e,t,i,n,o,r)}}class u1e{constructor(){this._tree=new Map,this._highlightedItems=new Map}get highlightedItems(){return Array.from(this._highlightedItems.values())}get(e){const t=this.find(e);if(t===void 0)return 0;const{treeLayer:i,relPath:n}=t;return this._highlightedItems.set(n,e),i.childMatches}find(e){const t=this._tree.get(e.root.name);if(t===void 0)return;const i=Gu(e.root.resource,e.resource);if(i===void 0||i.startsWith(".."))throw new Error("Resource is not a child of the root");if(i==="")return{treeLayer:t,relPath:i};let n=t;for(const o of i.split("/")){if(!n.stats[o])return;n=n.stats[o]}return{treeLayer:n,relPath:i}}add(e,t){const i=Gu(t.resource,e);if(i===void 0||i.startsWith(".."))throw new Error("Resource is not a child of the root");let n=this._tree.get(t.name);n||(n={childMatches:0,stats:{},isMatch:!1},this._tree.set(t.name,n)),n.childMatches++;let o=n;for(const r of i.split("/"))o.stats[r]||(o.stats[r]={childMatches:0,stats:{},isMatch:!1}),o=o.stats[r],o.childMatches++;o.childMatches--,o.isMatch=!0}isMatch(e){const t=this.find(e);if(t===void 0)return!1;const{treeLayer:i}=t;return i.isMatch}clear(){this._tree.clear()}}let k2=class{get highlightTree(){return this.findHighlightTree}constructor(e,t,i,n,o,r,a,c,d){this.filesFilter=e,this.treeProvider=t,this.searchService=i,this.fileService=n,this.configurationService=o,this.filesConfigService=r,this.progressService=a,this.explorerService=c,this.sessionId=0,this.phantomParents=new Set,this.findHighlightTree=new u1e,this.explorerFindActiveContextKey=xoe.bindTo(d)}isShowingFilterResults(){return!!this.filterSessionStartState}isVisible(e){return!this.filterSessionStartState||this.explorerService.isEditable(e)?!0:this.filterSessionStartState.rootsWithProviders.has(e.root)?e.isMarkedAsFiltered():!0}startSession(){this.sessionId++}async endSession(){this.filterSessionStartState&&await this.endFilterSession(),this.highlightSessionStartState&&this.endHighlightSession()}async find(e,t,i){const n=this.doFind(e,t,i);return await this.progressService.withProgress({location:Xo.Explorer,delay:750},o=>n)}async doFind(e,t,i){return t.findMode===F_e.Highlight?(this.filterSessionStartState&&await this.endFilterSession(),this.highlightSessionStartState||this.startHighlightSession(),await this.doHighlightFind(e,t.matchType,i)):(this.highlightSessionStartState&&this.endHighlightSession(),this.filterSessionStartState||this.startFilterSession(),await this.doFilterFind(e,t.matchType,i))}startFilterSession(){const e=this.treeProvider(),t=e.getInput();if(!t)return;const i=this.explorerService.roots.filter(n=>this.searchSupportsScheme(n.resource.scheme));this.filterSessionStartState={viewState:e.getViewState(),input:t,rootsWithProviders:new Set(i)},this.explorerFindActiveContextKey.set(!0)}async doFilterFind(e,t,i){if(!this.filterSessionStartState)throw new Error("ExplorerFindProvider: no session state");const n=Array.from(this.filterSessionStartState.rootsWithProviders),o=await this.getSearchResults(e,n,t,i);if(i.isCancellationRequested)return;this.clearPhantomElements();for(const{explorerRoot:c,files:d,directories:l}of o)this.addWorkspaceFilterResults(c,d,l);await this.treeProvider().setInput(this.filterSessionStartState.input);const a=o.some(({hitMaxResults:c})=>c);return{isMatch:c=>c.isMarkedAsFiltered(),matchCount:o.reduce((c,{files:d,directories:l})=>c+d.length+l.length,0),warningMessage:a?h(7152,"The result set only contains a subset of all matches. Be more specific in your search to narrow down the results."):void 0}}addWorkspaceFilterResults(e,t,i){const n=[...t.map(o=>({resource:o,isDirectory:!1})),...i.map(o=>({resource:o,isDirectory:!0}))];for(const{resource:o,isDirectory:r}of n){const a=e.find(o);if(a&&a.root===e){a.markItemAndParentsAsFiltered();continue}const c=this.createPhantomItems(o,e,r);if(c.length===0)throw new Error("Phantom item was not created even though it is not in the model");const d=c[0].parent;d instanceof rJ||this.phantomParents.add(d),c[c.length-1].markItemAndParentsAsFiltered()}}createPhantomItems(e,t,i){const n=Gu(t.resource,e);if(!n)throw new Error("Resource is not a child of the root");const o=[];let r=t,a=t.resource;const c=n.split("/");for(const d of c){a=a.with({path:`${a.path}/${d}`});let l=r.getChild(d);if(!l){const u=c[c.length-1]===d?i:!0;l=new rJ(a,this.fileService,this.configurationService,this.filesConfigService,r,u),r.addChild(l),o.push(l)}r=l}return o}async endFilterSession(){if(this.clearPhantomElements(),this.explorerFindActiveContextKey.set(!1),!this.filterSessionStartState)throw new Error("ExplorerFindProvider: no session state to restore");await this.treeProvider().setInput(this.filterSessionStartState.input,this.filterSessionStartState.viewState),this.filterSessionStartState=void 0,this.explorerService.refresh()}clearPhantomElements(){for(const e of this.phantomParents)e.forgetChildren();this.phantomParents.clear(),this.explorerService.roots.forEach(e=>e.unmarkItemAndChildren())}startHighlightSession(){const e=this.explorerService.roots.filter(t=>this.searchSupportsScheme(t.resource.scheme));this.highlightSessionStartState={rootsWithProviders:new Set(e)}}async doHighlightFind(e,t,i){if(!this.highlightSessionStartState)throw new Error("ExplorerFindProvider: no highlight session state");const n=Array.from(this.highlightSessionStartState.rootsWithProviders),o=await this.getSearchResults(e,n,t,i);if(i.isCancellationRequested)return;this.clearHighlights();for(const{explorerRoot:a,files:c,directories:d}of o)this.addWorkspaceHighlightResults(a,c.concat(d));const r=o.some(({hitMaxResults:a})=>a);return{isMatch:a=>this.findHighlightTree.isMatch(a)||this.findHighlightTree.get(a)>0&&this.treeProvider().isCollapsed(a),matchCount:o.reduce((a,{files:c,directories:d})=>a+c.length+d.length,0),warningMessage:r?h(7152,"The result set only contains a subset of all matches. Be more specific in your search to narrow down the results."):void 0}}addWorkspaceHighlightResults(e,t){const i=new Set,n=r=>{for(;r;)i.add(r),r=r.parent};for(const r of t){const a=e.find(r);if(a&&a.root===e){this.findHighlightTree.add(r,e),n(a.parent);continue}const c=p1e(r,e);c&&(this.findHighlightTree.add(r,e),n(c.parent))}const o=this.treeProvider();for(const r of i)o.hasNode(r)&&o.rerender(r)}endHighlightSession(){this.highlightSessionStartState=void 0,this.clearHighlights()}clearHighlights(){const e=this.treeProvider();for(const t of this.findHighlightTree.highlightedItems)e.hasNode(t)&&e.rerender(t);this.findHighlightTree.clear()}searchSupportsScheme(e){return e!==ae.file&&e!==ae.vscodeRemote?!1:this.searchService.schemeHasFileSearchProvider(e)}async getSearchResults(e,t,i,n){const o=e.toLowerCase(),r=i===W_e.Fuzzy;return await Promise.all(t.map((a,c)=>this.searchInWorkspace(o,a,c,r,n)))}async searchInWorkspace(e,t,i,n,o){const r=v1e(n?f1e(e):m1e(e)),a=xce(this.configurationService.getValue({resource:t.resource}))||{},c={folderQueries:[{folder:t.resource,disregardIgnoreFiles:!this.configurationService.getValue("explorer.excludeGitIgnore")}],type:bp.File,shouldGlobMatchFilePattern:!0,cacheKey:`explorerfindprovider:${t.name}:${i}:${this.sessionId}`,excludePattern:a};let d,l;try{[d,l]=await Promise.all([this.searchService.fileSearch({...c,filePattern:`**/${r}`,maxResults:512},o),this.searchService.fileSearch({...c,filePattern:`**/${r}/**`},o)])}catch(_){if(!ys(_))throw _}if(!d||!l||o.isCancellationRequested)return{explorerRoot:t,files:[],directories:[],hitMaxResults:!1};const u=d.results.map(_=>_.resource),g=g1e(l.results.map(_=>_.resource),t,r),m=u.filter(_=>!this.filesFilter.isIgnored(_,t.resource,!1)),v=g.filter(_=>!this.filesFilter.isIgnored(_,t.resource,!0));return{explorerRoot:t,files:m,directories:v,hitMaxResults:!!d.limitHit||!!l.limitHit}}};k2=f([p(2,kI),p(3,je),p(4,ne),p(5,Us),p(6,pl),p(7,Zi),p(8,fe)],k2);function g1e(s,e,t){const i=new Mp;for(const o of s){const r=Gu(e.resource,o);if(!r)throw new Error("Resource is not a child of the root");let a=e.resource;const c=r.split("/").slice(0,-1);for(const d of c)a=a.with({path:`${a.path}/${d}`}),i.add(a)}const n=[];for(const o of i){const r=o.path.split("/"),a=r[r.length-1];!a||!Db(t,a)||n.push(o)}return n}function p1e(s,e){const t=Gu(e.resource,s);if(!t)throw new Error("Resource is not a child of the root");let i=e,n=e.resource;const o=t.split("/");for(const r of o){n=n.with({path:`${n.path}/${r}`});const a=i.getChild(r);if(!a)return i;i=a}}function f1e(s){return s?"*"+s.split("").join("*")+"*":"*"}function m1e(s){return s?"*"+s+"*":"*"}function v1e(s){let e="";for(let t=0;t<s.length;t++){const i=s[t];/[a-zA-Z]/.test(i)?e+=`[${i.toLowerCase()}${i.toUpperCase()}]`:e+=i}return e}class aJ{static{this.ID=0}get index(){return this._index}get count(){return this.items.length}get current(){return this.items[this._index]}get currentId(){return`${this.id}_${this.index}`}get labels(){return this._labels}constructor(e,t,i,n,o){this.id=e,this.items=t,this.depth=n,this.collapsed=o,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._index=t.length-1,this.updateLabels(i),this._updateLabelDisposable=i.label.onDidRender(()=>this.updateLabels(i))}updateLabels(e){this._labels=Array.from(e.container.querySelectorAll(".label-name"));let t="";for(let i=0;i<this.labels.length;i++){const n=t.length?`${this.items[i].name}, compact, ${t}`:this.items[i].name;this.labels[i].setAttribute("aria-label",n),this.labels[i].setAttribute("aria-level",`${this.depth+i}`),t=t.length?`${this.items[i].name} ${t}`:this.items[i].name}this.updateCollapsed(this.collapsed),this._index<this.labels.length&&this.labels[this._index].classList.add("active")}previous(){this._index<=0||this.setIndex(this._index-1)}next(){this._index>=this.items.length-1||this.setIndex(this._index+1)}first(){this._index!==0&&this.setIndex(0)}last(){this._index!==this.items.length-1&&this.setIndex(this.items.length-1)}setIndex(e){e<0||e>=this.items.length||(this.labels[this._index].classList.remove("active"),this._index=e,this.labels[this._index].classList.add("active"),this._onDidChange.fire())}updateCollapsed(e){this.collapsed=e;for(let t=0;t<this.labels.length;t++)this.labels[t].setAttribute("aria-expanded",e?"false":"true")}dispose(){this._onDidChange.dispose(),this._updateLabelDisposable.dispose()}}let sL=class{static{x2=this}static{this.ID="file"}constructor(e,t,i,n,o,r,a,c,d,l,u,g){this.labels=t,this.highlightTree=i,this.updateWidth=n,this.contextViewService=o,this.themeService=r,this.configurationService=a,this.explorerService=c,this.labelService=d,this.contextService=l,this.contextMenuService=u,this.instantiationService=g,this.compressedNavigationControllers=new Map,this._onDidChangeActiveDescendant=new L_e,this.onDidChangeActiveDescendant=this._onDidChangeActiveDescendant.event,this.config=this.configurationService.getValue();const m=()=>{const v=this.configurationService.getValue("workbench.tree.indent"),_=Math.max(22-v,0);e.style.setProperty("--vscode-explorer-align-offset-margin-left",`${_}px`)};this.configListener=this.configurationService.onDidChangeConfiguration(v=>{v.affectsConfiguration("explorer")&&(this.config=this.configurationService.getValue()),v.affectsConfiguration("workbench.tree.indent")&&m()}),m()}getWidgetAriaLabel(){return h(7153,"Files Explorer")}get templateId(){return x2.ID}renderTemplate(e){const t=new U,i=t.add(this.labels.create(e,{supportHighlights:!0}));t.add(i.onDidRender(()=>{try{o.currentContext&&this.updateWidth(o.currentContext)}catch{}}));const n=E2.create(this.instantiationService,e,t);t.add(E2.onDidRegisterDescriptor(r=>{const a=r.create(this.instantiationService,e);n.push(t.add(a)),a.setResource(o.currentContext?.resource)}));const o={templateDisposables:t,elementDisposables:t.add(new U),label:i,container:e,contribs:n};return o}renderElement(e,t,i){const n=e.element;i.currentContext=n;const o=this.explorerService.getEditableData(n);i.label.element.classList.remove("compressed"),o?(i.label.element.style.display="none",i.contribs.forEach(r=>r.setResource(void 0)),i.elementDisposables.add(this.renderInputBox(i.container,n,o))):(i.label.element.style.display="flex",this.renderStat(n,n.name,void 0,e.filterData,i))}renderCompressedElements(e,t,i,n){const o=e.element.elements[e.element.elements.length-1];i.currentContext=o;const r=e.element.elements.filter(c=>this.explorerService.isEditable(c)),a=r.length===0?void 0:this.explorerService.getEditableData(r[0]);if(a)i.label.element.classList.remove("compressed"),i.label.element.style.display="none",i.contribs.forEach(c=>c.setResource(void 0)),i.elementDisposables.add(this.renderInputBox(i.container,r[0],a));else{i.label.element.classList.add("compressed"),i.label.element.style.display="flex";const c=`compressed-explorer_${aJ.ID++}`,d=e.element.elements.map(m=>m.name);let l=e.filterData;if(l&&l.length>2){const m=d.join("/").length-d[d.length-1].length;l=[l[0],l[1]+m,...l.slice(2)]}this.renderStat(o,d,c,l,i);const u=new aJ(c,e.element.elements,i,e.depth,e.collapsed);i.elementDisposables.add(u);const g=this.compressedNavigationControllers.get(o)??[];this.compressedNavigationControllers.set(o,[...g,u]),i.elementDisposables.add(this._onDidChangeActiveDescendant.add(u.onDidChange)),i.elementDisposables.add(re(i.container,"mousedown",m=>{const v=oL(m.target);v&&u.setIndex(v.index)})),i.elementDisposables.add(Ie(()=>{const m=this.compressedNavigationControllers.get(o)??[],v=m.findIndex(_=>_===u);if(v<0)throw new Error("Disposing unknown navigation controller");m.length===1?this.compressedNavigationControllers.delete(o):m.splice(v,1)}))}}renderStat(e,t,i,n,o){o.label.element.style.display="flex";const r=["explorer-item"];this.explorerService.isCut(e)&&r.push("cut");const a=this.themeService.getFileIconTheme();o.container.parentElement?.parentElement?.querySelector(".monaco-tl-twistie")?.classList.toggle("force-twistie",e.hasNests&&a.hidesExplorerArrows);const d=a.hasFileIcons&&(a.hidesExplorerArrows||!a.hasFolderIcons),l=e.nestedParent&&d;o.contribs.forEach(g=>g.setResource(e.resource)),o.label.setResource({resource:e.resource,name:t},{fileKind:e.isRoot?Pi.ROOT_FOLDER:e.isDirectory?Pi.FOLDER:Pi.FILE,extraClasses:l?[...r,"align-nest-icon-with-parent-icon"]:r,fileDecorations:this.config.explorer.decorations,matches:vw(n),separator:this.labelService.getSeparator(e.resource.scheme,e.resource.authority),domId:i});const u=e.isDirectory?this.highlightTree.get(e):0;if(u>0){const g=new $ie(o.label.element.lastElementChild,{},{...Gie,badgeBackground:vt(K_e),badgeBorder:vt(q_e)});g.setCount(u),g.setTitleFormat(h(7154,"Directory contains {0} matches",u)),o.elementDisposables.add(g)}o.label.element.classList.toggle("highlight-badge",u>0)}renderInputBox(e,t,i){const n=this.labels.create(e),o=["explorer-item","explorer-item-edited"],r=t.isRoot?Pi.ROOT_FOLDER:t.isDirectory?Pi.FOLDER:Pi.FILE,a=this.themeService.getFileIconTheme(),c=a.hasFileIcons&&(a.hidesExplorerArrows||!a.hasFolderIcons),d=t.nestedParent&&c,l={hidePath:!0,hideLabel:!0,fileKind:r,extraClasses:d?[...o,"align-nest-icon-with-parent-icon"]:o},u=t.name?_s(t.resource):t.resource,g=t.name||"";n.setFile(Ct(u,g||" "),l),n.element.firstElementChild.style.display="none";const m=new M_e(n.element,this.contextViewService,{validationOptions:{validation:D=>{const A=i.validationMessage(D);return!A||A.severity!==Fe.Error?null:{content:A.content,formatContent:!0,type:FD.ERROR}}},ariaLabel:h(7155,"Type file name. Press Enter to confirm or Escape to cancel."),inputBoxStyles:JT}),v=g.lastIndexOf(".");let _="prefix";m.value=g,m.focus(),m.select({start:0,end:v>0&&!t.isDirectory?v:g.length});const w=_w((D,A)=>{n.element.style.display="none";const B=m.value;Xe(k),n.element.remove(),A&&i.onFinish(B,D)}),C=()=>{if(m.isInputValid()){const D=i.validationMessage(m.value);D?m.showMessage({content:D.content,formatContent:!0,type:D.severity===Fe.Info?FD.INFO:D.severity===Fe.Warning?FD.WARNING:FD.ERROR}):m.hideMessage()}};C();const k=[m,m.onDidChange(D=>{n.setFile(Ct(u,D||" "),l)}),No(m.inputElement,pe.KEY_DOWN,D=>{if(D.equals(S.F2)){const A=m.value.lastIndexOf(".");if(t.isDirectory||A===-1)return;_==="prefix"?(_="all",m.select({start:0,end:m.value.length})):_==="all"?(_="suffix",m.select({start:A+1,end:m.value.length})):(_="prefix",m.select({start:0,end:A}))}else D.equals(S.Enter)?m.validate()||w(!0,!0):D.equals(S.Escape)&&w(!1,!0)}),No(m.inputElement,pe.KEY_UP,D=>{C()}),re(m.inputElement,pe.BLUR,async()=>{for(;;){await Da(0);const D=m.inputElement.ownerDocument;if(!D.hasFocus())break;if(hf(m.inputElement))return;if(Ph(D.activeElement)&&N_e(D.activeElement,"context-view"))await T.toPromise(this.contextMenuService.onDidHideContextMenu);else break}w(m.isInputValid(),!0)}),n];return Ie(()=>{w(!1,!1)})}disposeElement(e,t,i){i.currentContext=void 0,i.elementDisposables.clear()}disposeCompressedElements(e,t,i){i.currentContext=void 0,i.elementDisposables.clear()}disposeTemplate(e){e.templateDisposables.dispose()}getCompressedNavigationController(e){return this.compressedNavigationControllers.get(e)}getAriaLabel(e){return e.name}getAriaLevel(e){let t=0,i=e.parent;for(;i;)i=i.parent,t++;return this.contextService.getWorkbenchState()===Zo.WORKSPACE&&(t=t+1),t}getActiveDescendantId(e){return this.compressedNavigationControllers.get(e)?.[0]?.currentId??void 0}dispose(){this.configListener.dispose()}};sL=x2=f([p(4,rf),p(5,pt),p(6,ne),p(7,Zi),p(8,ui),p(9,It),p(10,bi),p(11,Z)],sL);let T2=class{constructor(e,t,i,n,o,r){this.contextService=e,this.configurationService=t,this.explorerService=i,this.editorService=n,this.uriIdentityService=o,this.fileService=r,this.hiddenExpressionPerRoot=new Map,this.editorsAffectingFilter=new Set,this._onDidChange=new M,this.toDispose=[],this.ignoreFileResourcesPerRoot=new Map,this.ignoreTreesPerRoot=new Map,this.toDispose.push(this.contextService.onDidChangeWorkspaceFolders(()=>this.updateConfiguration())),this.toDispose.push(this.configurationService.onDidChangeConfiguration(a=>{(a.affectsConfiguration("files.exclude")||a.affectsConfiguration("explorer.excludeGitIgnore"))&&this.updateConfiguration()})),this.toDispose.push(this.fileService.onDidFilesChange(a=>{for(const[c,d]of this.ignoreFileResourcesPerRoot.entries())d.forEach(async l=>{a.contains(l,ph.UPDATED)&&await this.processIgnoreFile(c,l,!0),a.contains(l,ph.DELETED)&&(this.ignoreTreesPerRoot.get(c)?.delete(_s(l)),d.delete(l),this._onDidChange.fire())})})),this.toDispose.push(this.editorService.onDidVisibleEditorsChange(()=>{const a=this.editorService.visibleEditors;let c=!1;for(const d of a){if(!d.resource)continue;const l=this.explorerService.findClosest(d.resource);if(l&&l.isExcluded){c=!0;break}}for(const d of this.editorsAffectingFilter)if(!a.includes(d)){c=!0;break}c&&(this.editorsAffectingFilter.clear(),this._onDidChange.fire())})),this.updateConfiguration()}get onDidChange(){return this._onDidChange.event}updateConfiguration(){let e=!1,t=!1;this.contextService.getWorkspace().folders.forEach(i=>{const n=this.configurationService.getValue({resource:i.uri}),o=n?.files?.exclude||Object.create(null),r=n.explorer.excludeGitIgnore;if(r&&!this.ignoreTreesPerRoot.has(i.uri.toString())&&(t=!0,this.ignoreFileResourcesPerRoot.set(i.uri.toString(),new Mp),this.ignoreTreesPerRoot.set(i.uri.toString(),Hie.forUris(c=>this.uriIdentityService.extUri.ignorePathCasing(c)))),!r&&this.ignoreTreesPerRoot.has(i.uri.toString())&&(t=!0,this.ignoreFileResourcesPerRoot.delete(i.uri.toString()),this.ignoreTreesPerRoot.delete(i.uri.toString())),!e){const c=this.hiddenExpressionPerRoot.get(i.uri.toString());e=!c||!ic(c.original,o)}const a=Tr(o);this.hiddenExpressionPerRoot.set(i.uri.toString(),{original:a,parsed:Km(a)})}),(e||t)&&(this.editorsAffectingFilter.clear(),this._onDidChange.fire())}async processIgnoreFile(e,t,i){const n=_s(t),o=this.ignoreTreesPerRoot.get(e);if(!o||!i&&o.has(n))return;const r=await this.fileService.readFile(t);if(i)o.get(n)?.updateContents(r.value.toString());else{const a=o.findSubstr(n),c=new l1e(r.value.toString(),n.path,a);o.set(n,c),this.ignoreFileResourcesPerRoot.get(e)?.has(t)||this.ignoreFileResourcesPerRoot.get(e)?.add(t)}this._onDidChange.fire()}filter(e,t){return e.name===".gitignore"&&this.ignoreTreesPerRoot.has(e.root.resource.toString())?(this.processIgnoreFile(e.root.resource.toString(),e.resource,!1),!0):this.isVisible(e,t)}isVisible(e,t){if(e.isExcluded=!1,t===um.Hidden)return e.isExcluded=!0,!1;if(this.explorerService.getEditableData(e))return!0;if((this.hiddenExpressionPerRoot.get(e.root.resource.toString())?.parsed(zM(e.root.resource.path,e.resource.path),e.name,r=>!!(e.parent&&e.parent.getChild(r)))?!0:this.isIgnored(e.resource,e.root.resource,e.isDirectory))||e.parent?.isExcluded){e.isExcluded=!0;const a=this.editorService.visibleEditors.find(c=>c.resource&&this.uriIdentityService.extUri.isEqualOrParent(c.resource,e.resource));return a&&e.root===this.explorerService.findClosestRoot(e.resource)?(this.editorsAffectingFilter.add(a),!0):!1}return!0}isIgnored(e,t,i){const o=this.ignoreTreesPerRoot.get(t.toString())?.findSubstr(e)?.isPathIncludedInTraversal(e.path,i);return o===void 0?!1:!o}dispose(){Xe(this.toDispose)}};T2=f([p(0,It),p(1,ne),p(2,Zi),p(3,de),p(4,nn),p(5,je)],T2);let A2=class{constructor(e,t){this.explorerService=e,this.contextService=t}compare(e,t){if(e.isRoot){if(t.isRoot){const c=this.contextService.getWorkspaceFolder(e.resource),d=this.contextService.getWorkspaceFolder(t.resource);return c&&d?c.index-d.index:-1}return-1}if(t.isRoot)return 1;const i=this.explorerService.sortOrderConfiguration.sortOrder,n=this.explorerService.sortOrderConfiguration.lexicographicOptions;this.explorerService.sortOrderConfiguration.reverse&&([e,t]=[t,e]);let r,a;switch(n){case"upper":r=G_e,a=z_e;break;case"lower":r=U_e,a=$_e;break;case"unicode":r=V_e,a=H_e;break;default:r=BF,a=B_e}switch(i){case"type":if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;if(e.isDirectory&&t.isDirectory)return r(e.name,t.name);break;case"filesFirst":if(e.isDirectory&&!t.isDirectory)return 1;if(t.isDirectory&&!e.isDirectory)return-1;break;case"foldersNestsFiles":if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;if(e.hasNests&&!t.hasNests)return-1;if(t.hasNests&&!e.hasNests)return 1;break;case"mixed":break;default:if(e.isDirectory&&!t.isDirectory)return-1;if(t.isDirectory&&!e.isDirectory)return 1;break}switch(i){case"type":return a(e.name,t.name);case"modified":return e.mtime!==t.mtime?e.mtime&&t.mtime&&e.mtime<t.mtime?1:-1:r(e.name,t.name);default:return r(e.name,t.name)}}};A2=f([p(0,Zi),p(1,It)],A2);let R2=class{static{Ld=this}static{this.CONFIRM_DND_SETTING_KEY="explorer.confirmDragAndDrop"}constructor(e,t,i,n,o,r,a,c,d,l){this.isCollapsed=e,this.explorerService=t,this.editorService=i,this.dialogService=n,this.contextService=o,this.fileService=r,this.configurationService=a,this.instantiationService=c,this.workspaceEditingService=d,this.uriIdentityService=l,this.compressedDropTargetDisposable=F.None,this.disposables=new U,this.dropEnabled=!1;const u=g=>{(!g||g.affectsConfiguration("explorer.enableDragAndDrop"))&&(this.dropEnabled=this.configurationService.getValue("explorer.enableDragAndDrop"))};u(void 0),this.disposables.add(this.configurationService.onDidChangeConfiguration(g=>u(g)))}onDragOver(e,t,i,n,o){if(!this.dropEnabled)return!1;if(t){const r=Ld.getCompressedStatFromDragEvent(t,o);if(r){const a=oL(o.target);if(a&&a.index<a.count-1){const c=this.handleDragOver(e,r,i,n,o);return c?(a.element!==this.compressedDragOverElement&&(this.compressedDragOverElement=a.element,this.compressedDropTargetDisposable.dispose(),this.compressedDropTargetDisposable=Ie(()=>{a.element.classList.remove("drop-target"),this.compressedDragOverElement=void 0}),a.element.classList.add("drop-target")),typeof c=="boolean"?c:{...c,feedback:[]}):(this.compressedDropTargetDisposable.dispose(),!1)}}}return this.compressedDropTargetDisposable.dispose(),this.handleDragOver(e,t,i,n,o)}handleDragOver(e,t,i,n,o){const r=o&&(o.ctrlKey&&!Yt||o.altKey&&Yt),a=e instanceof VF,d={type:a||r?q_.Copy:q_.Move,position:hm.Over};if(a){if(!To(o,Ds.FILES,ho.FILES,Ds.RESOURCES))return!1}else{if(e instanceof O_e)return!1;{const l=Ld.getStatsFromDragAndDropData(e),u=l.every(g=>g.isRoot);if(!t)return!r&&l.every(g=>!!g.parent&&g.parent.isRoot)?!1:u?{accept:!0,effect:{type:q_.Move,position:hm.After}}:{accept:!0,bubble:WD.Down,effect:d,autoExpand:!1};if(!Array.isArray(l)||!r&&l.every(g=>g.isReadonly)||l.some(g=>g.isRoot?!1:!!(this.uriIdentityService.extUri.isEqual(g.resource,t.resource)||!r&&this.uriIdentityService.extUri.isEqual(_s(g.resource),t.resource)||this.uriIdentityService.extUri.isEqualOrParent(t.resource,g.resource))))return!1;if(u){if(!t.isRoot)return!1;let g;switch(n){case Qr.TOP:case Qr.CENTER_TOP:g=hm.Before;break;case Qr.CENTER_BOTTOM:case Qr.BOTTOM:g=hm.After;break}return{accept:!0,effect:{type:q_.Move,position:g}}}}}if(t){if(t.isDirectory)return t.isReadonly?!1:{accept:!0,bubble:WD.Down,effect:d,autoExpand:!0};if(this.contextService.getWorkspace().folders.every(l=>l.uri.toString()!==t.resource.toString()))return{accept:!0,bubble:WD.Up,effect:d}}else return{accept:!0,bubble:WD.Down,effect:d};return!1}getDragURI(e){return this.explorerService.isEditable(e)?null:e.resource.toString()}getDragLabel(e,t){return e.length===1?Ld.getCompressedStatFromDragEvent(e[0],t).name:String(e.length)}onDragStart(e,t){const i=Ld.getStatsFromDragAndDropData(e,t);if(i&&i.length&&t.dataTransfer){this.instantiationService.invokeFunction(o=>ag(o,i,t));const n=i.filter(o=>o.resource.scheme===ae.file).map(o=>o.resource.fsPath);n.length&&t.dataTransfer.setData(ho.FILES,JSON.stringify(n))}}async drop(e,t,i,n,o){if(this.compressedDropTargetDisposable.dispose(),t){const a=Ld.getCompressedStatFromDragEvent(t,o);a&&(t=a)}if(t||(t=this.explorerService.roots[this.explorerService.roots.length-1],n=Qr.BOTTOM),!t.isDirectory&&t.parent&&(t=t.parent),t.isReadonly)return;const r=t;if(r)try{e instanceof VF?!Kt||qM(this.contextService.getWorkspace())&&OE.supported(zi)?await this.instantiationService.createInstance(PU).import(r,o,zi):await this.instantiationService.createInstance(PP).upload(t,o):await this.handleExplorerDrop(e,r,i,n,o)}catch(a){this.dialogService.error(bo(a))}}async handleExplorerDrop(e,t,i,n,o){const r=Ld.getStatsFromDragAndDropData(e),a=new Map(r.map(g=>[g,this.isCollapsed(g)]));for(const[g,m]of a)if(m){const v=g.nestedChildren;if(v)for(const _ of v)a.set(_,!0)}const c=$z([...a.keys()],g=>g.resource),d=o.ctrlKey&&!Yt||o.altKey&&Yt;if(!d&&this.configurationService.getValue(Ld.CONFIRM_DND_SETTING_KEY)){const g=c.length>1&&c.every(_=>_.isRoot)?h(7156,"Are you sure you want to change the order of multiple root folders in your workspace?"):c.length>1?h(7157,"Are you sure you want to move the following {0} files into '{1}'?",c.length,t.name):c[0].isRoot?h(7158,"Are you sure you want to change the order of root folder '{0}' in your workspace?",c[0].name):h(7159,"Are you sure you want to move '{0}' into '{1}'?",c[0].name,t.name),m=c.length>1&&!c.every(_=>_.isRoot)?Lu(c.map(_=>_.resource)):void 0,v=await this.dialogService.confirm({message:g,detail:m,checkbox:{label:h(7160,"Do not ask me again")},primaryButton:h(7161,"&&Move")});if(!v.confirmed)return;v.checkboxChecked===!0&&await this.configurationService.updateValue(Ld.CONFIRM_DND_SETTING_KEY,!1)}await this.doHandleRootDrop(c.filter(g=>g.isRoot),t,n);const u=c.filter(g=>!g.isRoot);return d?this.doHandleExplorerDropOnCopy(u,t):this.doHandleExplorerDropOnMove(u,t)}async doHandleRootDrop(e,t,i){if(e.length===0)return;const n=this.contextService.getWorkspace().folders;let o;const r=[],a=[],c=[];for(let d=0;d<n.length;d++){const l={uri:n[d].uri,name:n[d].name};t instanceof Ts&&this.uriIdentityService.extUri.isEqual(n[d].uri,t.resource)&&(o=d);for(const u of e)if(this.uriIdentityService.extUri.isEqual(n[d].uri,u.resource)){r.push(d);break}e.every(u=>u.resource.toString()!==n[d].uri.toString())?a.push(l):c.push(l)}if(o===void 0)o=a.length;else{switch(i){case Qr.BOTTOM:case Qr.CENTER_BOTTOM:o++;break}for(const d of r)d<o&&o--}return a.splice(o,0,...c),this.workspaceEditingService.updateFolders(0,a.length,a)}async doHandleExplorerDropOnCopy(e,t){const i=this.configurationService.getValue().explorer,n=[];for(const{resource:a,isDirectory:c}of e){const d=i.incrementalNaming==="disabled",l=await MU(this.explorerService,this.fileService,this.dialogService,t,{resource:a,isDirectory:c,allowOverwrite:d},i.incrementalNaming);if(!l)continue;const u=new sc(a,l,{copy:!0,overwrite:d});n.push(u)}const o=cJ(e);await this.explorerService.applyBulkEdit(n,{confirmBeforeUndo:i.confirmUndo===Iu.Default||i.confirmUndo===Iu.Verbose,undoLabel:h(7162,"Copy {0}",o),progressLabel:h(7163,"Copying {0}",o)});const r=n.filter(a=>{const c=a.newResource?this.explorerService.findClosest(a.newResource):void 0;return c&&!c.isDirectory}).map(a=>({resource:a.newResource,options:{pinned:!0}}));await this.editorService.openEditors(r)}async doHandleExplorerDropOnMove(e,t){const i=e.filter(r=>!r.isReadonly).map(r=>new sc(r.resource,Ct(t.resource,r.name))),n=cJ(e),o={confirmBeforeUndo:this.configurationService.getValue().explorer.confirmUndo===Iu.Verbose,undoLabel:h(7164,"Move {0}",n),progressLabel:h(7165,"Moving {0}",n)};try{await this.explorerService.applyBulkEdit(i,o)}catch(r){if(r.fileOperationResult===Kn.FILE_MOVE_CONFLICT){const a=[];for(const l of i)l.newResource&&await this.fileService.exists(l.newResource)&&a.push(l.newResource);const c=LOe(a),{confirmed:d}=await this.dialogService.confirm(c);d&&await this.explorerService.applyBulkEdit(i.map(l=>new sc(l.oldResource,l.newResource,{overwrite:!0})),o)}else throw r}}static getStatsFromDragAndDropData(e,t){return e.context?e.context:t&&e.elements.length===1?(e.context=[Ld.getCompressedStatFromDragEvent(e.elements[0],t)],e.context):e.elements}static getCompressedStatFromDragEvent(e,t){const i=Et(t).document.elementFromPoint(t.clientX,t.clientY),n=oL(i);if(n){const{count:o,index:r}=n;let a=o-1;for(;a>r&&e.parent;)e=e.parent,a--;return e}return e}onDragEnd(){this.compressedDropTargetDisposable.dispose()}dispose(){this.compressedDropTargetDisposable.dispose()}};R2=Ld=f([p(1,Zi),p(2,de),p(3,ei),p(4,It),p(5,je),p(6,ne),p(7,Z),p(8,uc),p(9,nn)],R2);function oL(s){if(!Ph(s))return null;let e=s;for(;e&&!e.classList.contains("monaco-list-row");){if(e.classList.contains("label-name")&&e.hasAttribute("data-icon-label-count")){const t=Number(e.getAttribute("data-icon-label-count")),i=Number(e.getAttribute("data-icon-label-index"));if(ec(t)&&ec(i))return{element:e,count:t,index:i}}e=e.parentElement}return null}function _1e(s){return!!oL(s)}class b1e{isIncompressible(e){return e.isRoot||!e.isDirectory||e instanceof YO||!e.parent||e.parent.isRoot}}function cJ(s){return s.length===1?s[0].name:s.every(e=>e.isDirectory)?h(7166,"{0} folders",s.length):s.every(e=>!e.isDirectory)?h(7167,"{0} files",s.length):`${s.length} files and folders`}function y1e(s){if(s.isRoot&&s.error)return{tooltip:h(7141,"Unable to resolve workspace folder ({0})",bo(s.error)),letter:"!",color:j_e};if(s.isSymbolicLink)return{tooltip:h(7142,"Symbolic Link"),letter:""};if(s.isUnknown)return{tooltip:h(7143,"Unknown File Type"),letter:"?"};if(s.isExcluded)return{color:Y_e}}let P2=class{constructor(e,t){this.explorerService=e,this.label=h(7144,"Explorer"),this._onDidChange=new M,this.toDispose=new U,this.toDispose.add(this._onDidChange),this.toDispose.add(t.onDidChangeWorkspaceFolders(i=>{this._onDidChange.fire(i.changed.concat(i.added).map(n=>n.uri))})),this.toDispose.add(I2.event(i=>{this._onDidChange.fire([i])}))}get onDidChange(){return this._onDidChange.event}async provideDecorations(e){const t=this.explorerService.findClosest(e);if(!t)throw new Error("ExplorerItem not found");return y1e(t)}dispose(){this.toDispose.dispose()}};P2=f([p(0,Zi),p(1,It)],P2);var uT;function w1e(s,e){for(const t of e)if(s.hasNode(t)&&!s.isCollapsed(t)){for(const[,i]of t.children.entries())if(s.hasNode(i)&&s.isCollapsible(i)&&!s.isCollapsed(i))return!0}return!1}function S1e(s,e){for(const t of e)if(s.hasNode(t)&&!s.isCollapsed(t))return!0;return!1}const C1e={getId:s=>s instanceof YO?`new:${s.getId()}`:s.getId()};function E1e(s,e,t,i){let n;n=s.length?s[0]:void 0,t&&e.length>1&&(n=void 0);const o=n&&i.getCompressedNavigationController(n),r=o&&o.length?o[0]:void 0;n=r?r.current:n;const a=[];for(const c of e){const d=i.getCompressedNavigationController(c),l=d&&d.length?d[0]:void 0;if(l&&n&&l===r){c===n&&a.push(c);continue}l?a.push(...l.items):a.push(c)}return n?t&&a.indexOf(n)>=0?a:[n]:t?a:[]}let Jy=class extends Tx{static{uT=this}static{this.TREE_VIEW_STATE_STORAGE_KEY="workbench.explorer.treeViewState"}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A,B,q,Q,ie){super(e,l,t,g,u,i,n,ie,_,C),this.contextService=o,this.progressService=r,this.editorService=a,this.editorResolverService=c,this.layoutService=d,this.decorationService=m,this.labelService=v,this.telemetryService=w,this.explorerService=k,this.storageService=D,this.clipboardService=A,this.fileService=B,this.uriIdentityService=q,this.commandService=Q,this._autoReveal=!1,this.delegate=e.delegate,this.resourceContext=n.createInstance(hi),this._register(this.resourceContext),this.parentReadonlyContext=Ioe.bindTo(u),this.folderContext=yo.bindTo(u),this.readonlyContext=hCe.bindTo(u),this.availableEditorIdsContext=Eoe.bindTo(u),this.rootContext=Cd.bindTo(u),this.resourceMoveableToTrash=yI.bindTo(u),this.compressedFocusContext=bI.bindTo(u),this.compressedFocusFirstContext=fq.bindTo(u),this.compressedFocusLastContext=mq.bindTo(u),this.viewHasSomeCollapsibleRootItem=uCe.bindTo(u),this.viewVisibleContextKey=wI.bindTo(u),this.explorerService.registerView(this)}get autoReveal(){return this._autoReveal}set autoReveal(e){this._autoReveal=e}get name(){return this.labelService.getWorkspaceLabel(this.contextService.getWorkspace())}get title(){return this.name}set title(e){}setVisible(e){this.viewVisibleContextKey.set(e),super.setVisible(e)}get fileCopiedContextKey(){return _he.bindTo(this.contextKeyService)}get resourceCutContextKey(){return Soe.bindTo(this.contextKeyService)}renderHeader(e){super.renderHeader(e),this.dragHandler=new jne(e,()=>this.setExpanded(!0));const t=e.querySelector(".title"),i=()=>{t.textContent=this.name,this.updateTitle(this.name),this.ariaHeaderLabel=h(7145,"Explorer Section: {0}",this.name),t.setAttribute("aria-label",this.ariaHeaderLabel)};this._register(this.contextService.onDidChangeWorkspaceName(i)),this._register(this.labelService.onDidChangeFormatters(i)),i()}layoutBody(e,t){super.layoutBody(e,t),this.tree.layout(e,t)}renderBody(e){super.renderBody(e),this.container=e,this.treeContainer=ee(e,j(".explorer-folders-view")),this.createTree(this.treeContainer),this._register(this.labelService.onDidChangeFormatters(()=>{this._onDidChangeTitleArea.fire()})),this.onConfigurationUpdated(void 0),this._register(this.editorService.onDidActiveEditorChange(()=>{this.selectActiveFile()})),this._register(this.configurationService.onDidChangeConfiguration(t=>this.onConfigurationUpdated(t))),this._register(this.onDidChangeBodyVisibility(async t=>{t&&(await this.setTreeInput(),this.updateAnyCollapsedContext(),this.selectActiveFile(!0))})),this._register(re(Et(this.container),pe.PASTE,async t=>{!this.hasFocus()||this.readonlyContext.get()||t.clipboardData?.files?.length&&await this.commandService.executeCommand("filesExplorer.paste",t.clipboardData?.files)}))}focus(){if(super.focus(),this.tree.domFocus(),this.tree.getFocusedPart()===X6.Tree){const e=this.tree.getFocus();e.length===1&&this._autoReveal&&this.tree.reveal(e[0],.5)}}hasFocus(){return qz(this.container)}getFocus(){return this.tree.getFocus()}focusNext(){this.tree.focusNext()}focusLast(){this.tree.focusLast()}getContext(e){const t=this.tree.getFocusedPart()===X6.StickyScroll?this.tree.getStickyScrollFocus():this.tree.getFocus();return E1e(t,this.tree.getSelection(),e,this.renderer)}isItemVisible(e){return this.filter?this.filter.filter(e,um.Visible):!1}isItemCollapsed(e){return this.tree.isCollapsed(e)}async setEditable(e,t){t?(this.horizontalScrolling=this.tree.options.horizontalScrolling,this.horizontalScrolling&&this.tree.updateOptions({horizontalScrolling:!1}),await this.tree.expand(e.parent)):(this.horizontalScrolling!==void 0&&this.tree.updateOptions({horizontalScrolling:this.horizontalScrolling}),this.horizontalScrolling=void 0,this.treeContainer.classList.remove("highlight")),await this.refresh(!1,e.parent,!1),t?(this.treeContainer.classList.add("highlight"),this.tree.reveal(e)):this.tree.domFocus()}async selectActiveFile(e=this._autoReveal){if(this._autoReveal){const t=Di.getCanonicalUri(this.editorService.activeEditor,{supportSideBySide:qt.PRIMARY});if(t){const i=this.tree.getFocus(),n=this.tree.getSelection();return i.length===1&&this.uriIdentityService.extUri.isEqual(i[0].resource,t)&&n.length===1&&this.uriIdentityService.extUri.isEqual(n[0].resource,t)?void 0:this.explorerService.select(t,e)}}}createTree(e){this.filter=this.instantiationService.createInstance(T2),this._register(this.filter),this._register(this.filter.onDidChange(()=>this.refresh(!0)));const t=this.instantiationService.createInstance(vd,{onDidChangeVisibility:this.onDidChangeBodyVisibility});this._register(t),this.findProvider=this.instantiationService.createInstance(k2,this.filter,()=>this.tree);const i=a=>this.tree.updateWidth(a);this.renderer=this.instantiationService.createInstance(sL,e,t,this.findProvider.highlightTree,i),this._register(this.renderer),this._register(Aue(e,this.themeService));const n=()=>this.configurationService.getValue("explorer.compactFolders"),o=a=>this.configurationService.getValue({resource:a?.root.resource}).explorer.fileNesting;this.tree=this.instantiationService.createInstance(Q_e,"FileExplorer",e,new nL,new b1e,[this.renderer],this.instantiationService.createInstance(D2,this.filter,this.findProvider),{compressionEnabled:n(),accessibilityProvider:this.renderer,identityProvider:C1e,keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:a=>{if(!this.explorerService.isEditable(a))return a.name},getCompressedNodeKeyboardNavigationLabel:a=>{if(!a.some(c=>this.explorerService.isEditable(c)))return a.map(c=>c.name).join("/")}},multipleSelectionSupport:!0,filter:this.filter,sorter:this.instantiationService.createInstance(A2),dnd:this.instantiationService.createInstance(R2,a=>this.isItemCollapsed(a)),collapseByDefault:a=>!(a instanceof Ts&&(a.hasNests&&o(a).expand||this.findProvider.isShowingFilterResults())),autoExpandSingleChildren:!0,expandOnlyOnTwistieClick:a=>{if(a instanceof Ts){if(a.hasNests)return!0;if(this.configurationService.getValue("workbench.tree.expandMode")==="doubleClick")return!0}return!1},paddingBottom:nL.ITEM_HEIGHT,overrideStyles:this.getLocationBasedColors().listOverrideStyles,findProvider:this.findProvider}),this._register(this.tree),this._register(this.themeService.onDidColorThemeChange(()=>this.tree.rerender()));const r=T.filter(this.configurationService.onDidChangeConfiguration,a=>a.affectsConfiguration("explorer.compactFolders"));this._register(r(a=>this.tree.updateOptions({compressionEnabled:n()}))),gCe.bindTo(this.tree.contextKeyService),woe.bindTo(this.tree.contextKeyService),this._register(this.tree.onDidChangeFocus(a=>this.onFocusChanged(a.elements))),this.onFocusChanged([]),this._register(this.tree.onDidOpen(async a=>{const c=a.element;if(!c)return;if(!(UF(a.browserEvent)&&a.browserEvent.shiftKey)){if(c.isDirectory||this.explorerService.isEditable(void 0))return;this.telemetryService.publicLog2("workbenchActionExecuted",{id:"workbench.files.openFile",from:"explorer"});try{this.delegate?.willOpenElement(a.browserEvent),await this.editorService.openEditor({resource:c.resource,options:{preserveFocus:a.editorOptions.preserveFocus,pinned:a.editorOptions.pinned,source:tN.USER}},a.sideBySide?Rr:ol)}finally{this.delegate?.didOpenElement()}}})),this._register(this.tree.onContextMenu(a=>this.onContextMenu(a))),this._register(this.tree.onDidScroll(async a=>{const c=this.explorerService.getEditable();a.scrollTopChanged&&c&&this.tree.getRelativeTop(c.stat)===null&&await c.data.onFinish("",!1)})),this._register(this.tree.onDidChangeCollapseState(a=>{const c=a.node.element?.element;c&&this.renderer.getCompressedNavigationController(c instanceof Array?c[0]:c)?.forEach(l=>l.updateCollapsed(a.node.collapsed)),this.updateAnyCollapsedContext()})),this.updateAnyCollapsedContext(),this._register(this.tree.onMouseDblClick(a=>{const c=this.configurationService.getValue("workbench.list.scrollByPage");a.element===null&&!c&&this.commandService.executeCommand(gD)})),this._register(this.storageService.onWillSaveState(()=>{this.storeTreeViewState()}))}onConfigurationUpdated(e){if(!e||e.affectsConfiguration("explorer.autoReveal")){const t=this.configurationService.getValue();this._autoReveal=t?.explorer?.autoReveal}e&&(e.affectsConfiguration("explorer.decorations.colors")||e.affectsConfiguration("explorer.decorations.badges"))&&this.refresh(!0)}storeTreeViewState(){this.storageService.store(uT.TREE_VIEW_STATE_STORAGE_KEY,JSON.stringify(this.tree.getViewState()),he.WORKSPACE,gt.MACHINE)}setContextKeys(e){const t=this.contextService.getWorkspace().folders,i=e?e.resource:t[t.length-1].uri;if(e=e||this.explorerService.findClosest(i),this.resourceContext.set(i),this.folderContext.set(!!e&&e.isDirectory),this.readonlyContext.set(!!e&&!!e.isReadonly),this.parentReadonlyContext.set(!!e?.parent?.isReadonly),this.rootContext.set(!!e&&e.isRoot),i){const n=i?this.editorResolverService.getEditors(i).map(o=>o.id):[];this.availableEditorIdsContext.set(n.join(","))}else this.availableEditorIdsContext.reset()}async onContextMenu(e){if(Wne(e.browserEvent.target))return;const t=e.element;let i=e.anchor;if(Ph(i)&&t){const a=this.renderer.getCompressedNavigationController(t);a&&a.length>0&&(UF(e.browserEvent)||_1e(e.browserEvent.target)?i=a[0].labels[a[0].index]:a.forEach(c=>c.last()))}this.fileCopiedContextKey.set(await this.clipboardService.hasResources()),this.setContextKeys(t);const n=this.tree.getSelection(),o=this.explorerService.roots;let r;if(t instanceof Ts){const a=this.renderer.getCompressedNavigationController(t);r=a&&a.length?a[0].current.resource:t.resource}else r=o.length===1?o[0].resource:{};this.contextMenuService.showContextMenu({menuId:N.ExplorerContext,menuActionOptions:{arg:r,shouldForwardArgs:!0},contextKeyService:this.tree.contextKeyService,getAnchor:()=>i,onHide:a=>{a&&this.tree.domFocus()},getActionsContext:()=>t&&n&&n.indexOf(t)>=0?n.map(a=>a.resource):t instanceof Ts?[t.resource]:[]})}onFocusChanged(e){const t=e&&e.length?e[0]:void 0;if(this.setContextKeys(t),t){const n=!!this.configurationService.getValue().files?.enableTrash,o=this.fileService.hasCapability(t.resource,hh.Trash);this.resourceMoveableToTrash.set(n&&o)}else this.resourceMoveableToTrash.reset();const i=t&&this.renderer.getCompressedNavigationController(t);if(!i){this.compressedFocusContext.set(!1);return}this.compressedFocusContext.set(!0),i.forEach(n=>{this.updateCompressedNavigationContextKeys(n)})}refresh(e,t,i=!0){if(!this.tree||!this.isBodyVisible()||t&&!this.tree.hasNode(t)||this.findProvider?.isShowingFilterResults()&&e)return Promise.resolve(void 0);i&&this.explorerService.isEditable(void 0)&&this.tree.domFocus();const n=t||this.tree.getInput();return this.tree.updateChildren(n,e,!!t)}getOptimalWidth(){const e=this.tree.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".explorer-item .label-name"));return qne(e,t)}async setTreeInput(){if(!this.isBodyVisible())return Promise.resolve(void 0);this.setTreeInputPromise&&await this.setTreeInputPromise;const e=!this.tree.getInput();e&&dr("code/willResolveExplorer");const t=this.explorerService.roots;let i=t[0];(this.contextService.getWorkbenchState()!==Zo.FOLDER||t[0].error)&&(i=t);let n;if(this.tree&&this.tree.getInput())n=this.tree.getViewState();else{const a=this.storageService.get(uT.TREE_VIEW_STATE_STORAGE_KEY,he.WORKSPACE);a&&(n=JSON.parse(a))}const o=this.tree.getInput(),r=this.setTreeInputPromise=this.tree.setInput(i,n).then(async()=>{if(Array.isArray(i)){if(!n||o instanceof Ts)for(let a=0;a<Math.min(i.length,5);a++)try{await this.tree.expand(i[a])}catch{}if(!o&&i.length===1&&this.configurationService.getValue().explorer.expandSingleFolderWorkspaces&&await this.tree.expand(i[0]).catch(()=>{}),Array.isArray(o)){const a=new In;o.forEach(c=>a.set(c.resource,!0)),await Promise.all(i.map(async c=>{if(!a.has(c.resource))try{await this.tree.expand(c)}catch{}}))}}e&&dr("code/didResolveExplorer")});this.progressService.withProgress({location:Xo.Explorer,delay:this.layoutService.isRestored()?800:1500},a=>r),await r,this.decorationsProvider||(this.decorationsProvider=new P2(this.explorerService,this.contextService),this._register(this.decorationService.registerDecorationsProvider(this.decorationsProvider)))}async selectResource(e,t=this._autoReveal,i=0){if(i===2||!e||!this.isBodyVisible())return;this.setTreeInputPromise&&await this.setTreeInputPromise;let n=this.explorerService.findClosestRoot(e);for(;n&&n.resource.toString()!==e.toString();){try{await this.tree.expand(n)}catch{return this.selectResource(e,t,i+1)}if(!n.children.size)n=null;else for(const o of n.children.values()){if(this.uriIdentityService.extUri.isEqualOrParent(e,o.resource)){n=o;break}n=null}}if(n){if(n===this.tree.getInput()){this.tree.setFocus([]),this.tree.setSelection([]);return}try{n.nestedParent&&await this.tree.expand(n.nestedParent),(t===!0||t==="force")&&this.tree.getRelativeTop(n)===null&&this.tree.reveal(n,.5),this.tree.setFocus([n]),this.tree.setSelection([n])}catch{return this.selectResource(e,t,i+1)}}}itemsCopied(e,t,i){this.fileCopiedContextKey.set(e.length>0),this.resourceCutContextKey.set(t&&e.length>0),i?.forEach(n=>this.tree.rerender(n)),t&&e.forEach(n=>this.tree.rerender(n))}expandAll(){this.explorerService.isEditable(void 0)&&this.tree.domFocus(),this.tree.expandAll()}collapseAll(){this.explorerService.isEditable(void 0)&&this.tree.domFocus();const e=this.tree.getInput();if(Array.isArray(e)&&w1e(this.tree,e)){e.forEach(t=>{t.children.forEach(i=>this.tree.hasNode(i)&&this.tree.collapse(i,!0))});return}this.tree.collapseAll()}previousCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.previous(),this.updateCompressedNavigationContextKeys(i)})}nextCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.next(),this.updateCompressedNavigationContextKeys(i)})}firstCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.first(),this.updateCompressedNavigationContextKeys(i)})}lastCompressedStat(){const e=this.tree.getFocus();if(!e.length)return;this.renderer.getCompressedNavigationController(e[0]).forEach(i=>{i.last(),this.updateCompressedNavigationContextKeys(i)})}updateCompressedNavigationContextKeys(e){this.compressedFocusFirstContext.set(e.index===0),this.compressedFocusLastContext.set(e.index===e.count-1)}updateAnyCollapsedContext(){const e=this.tree.getInput();if(e===void 0)return;const t=Array.isArray(e)?e:Array.from(e.children.values());this.viewHasSomeCollapsibleRootItem.set(S1e(this.tree,t)),this.storeTreeViewState()}hasPhantomElements(){return!!this.findProvider?.isShowingFilterResults()}dispose(){this.dragHandler?.dispose(),super.dispose()}};Jy.__decorator=f([Gt],Jy.prototype,"fileCopiedContextKey",null);Jy.__decorator=f([Gt],Jy.prototype,"resourceCutContextKey",null);Jy=uT=f([p(1,bi),p(2,$s),p(3,Z),p(4,It),p(5,pl),p(6,de),p(7,mf),p(8,yi),p(9,He),p(10,fe),p(11,ne),p(12,Pv),p(13,ui),p(14,pt),p(15,ai),p(16,Ti),p(17,Zi),p(18,it),p(19,Vs),p(20,je),p(21,nn),p(22,Ge),p(23,mi)],Jy);function Aue(s,e){s.classList.add("file-icon-themable-tree"),s.classList.add("show-file-icons");const t=i=>{s.classList.toggle("align-icons-and-twisties",i.hasFileIcons&&!i.hasFolderIcons),s.classList.toggle("hide-arrows",i.hidesExplorerArrows===!0)};return t(e.getFileIconTheme()),e.onDidFileIconThemeChange(t)}const Rue=x.or(x.and(yo,Oh),x.and(yo.toNegated(),Ioe.toNegated()));Y(class extends X{constructor(){super({id:"workbench.files.action.createFileFromExplorer",title:h(7146,"New File..."),f1:!1,icon:K.newFile,precondition:Rue,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",ld),order:10}})}run(s){s.get(Ge).executeCommand(gD)}});Y(class extends X{constructor(){super({id:"workbench.files.action.createFolderFromExplorer",title:h(7147,"New Folder..."),f1:!1,icon:K.newFolder,precondition:Rue,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",ld),order:20}})}run(s){s.get(Ge).executeCommand(QO)}});Y(class extends X{constructor(){super({id:"workbench.files.action.refreshFilesExplorer",title:I(7148,"Refresh Explorer"),f1:!0,icon:K.refresh,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",ld),order:30},metadata:{description:I(7149,"Forces a refresh of the Explorer.")},precondition:xoe.negate()})}async run(s){const e=s.get(io),t=s.get(Zi);await e.openView(ld),await t.refresh()}});Y(class extends X{constructor(){super({id:"workbench.files.action.collapseExplorerFolders",title:I(7150,"Collapse Folders in Explorer"),f1:!0,icon:K.collapseAll,menu:{id:N.ViewTitle,group:"navigation",when:x.equals("view",ld),order:40},metadata:{description:I(7151,"Folds all folders in the Explorer.")}})}run(s){const t=s.get(io).getViewWithId(ld);t!==null&&t.collapseAll()}});class x1e extends F{constructor(e,t){super(),this.title=e,this.context=t,this._onDidChangeHeight=this._register(new M),this.onDidChangeHeight=this._onDidChangeHeight.event,this._isExpanded=si(this,!1),this.hasFollowingContent=this.context.contentIndex+1<this.context.content.length}get domNode(){return this._domNode??=this.init(),this._domNode}init(){const e=this.title,t=rL(".chat-used-context-label",void 0),i=this._register(new X_e(t,{buttonBackground:void 0,buttonBorder:void 0,buttonForeground:void 0,buttonHoverBackground:void 0,buttonSecondaryBackground:void 0,buttonSecondaryForeground:void 0,buttonSecondaryHoverBackground:void 0,buttonSeparator:void 0}));this._domNode=rL(".chat-used-context",void 0,t),i.label=e,this._register(i.onDidClick(()=>{const o=this._isExpanded.get();this._isExpanded.set(!o,void 0)})),this._register(fi(o=>{const r=this._isExpanded.read(o);i.icon=r?K.chevronDown:K.chevronRight,this._domNode?.classList.toggle("chat-used-context-collapsed",!r),this.updateAriaLabel(i.element,typeof e=="string"?e:e.value,this.isExpanded()),this._domNode?.isConnected&&queueMicrotask(()=>{this._onDidChangeHeight.fire()})}));const n=this.initContent();return this._domNode.appendChild(n),this._domNode}updateAriaLabel(e,t,i){e.ariaLabel=i?h(4634,"{0}, expanded",t):h(4635,"{0}, collapsed",t)}addDisposable(e){this._register(e)}get expanded(){return this._isExpanded}isExpanded(){return this._isExpanded.get()}setExpanded(e){this._isExpanded.set(e,void 0)}}class I1e extends F{get inUse(){return this._inUse}constructor(e){super(),this._itemFactory=e,this.pool=[],this._inUse=new Set}get(){if(this.pool.length>0){const t=this.pool.pop();return this._inUse.add(t),t}const e=this._register(this._itemFactory());return this._inUse.add(e),e}release(e){this._inUse.delete(e),this.pool.push(e)}}var L2;const rL=j;let M2=class extends x1e{constructor(e,t,i,n,o,r,a,c){super(t??(e.length>1?h(4654,"Used {0} references",e.length):h(4655,"Used {0} reference",1)),i),this.data=e,this.contentReferencesListPool=n,this.openerService=o,this.menuService=r,this.instantiationService=a,this.contextMenuService=c}initContent(){const t=this._register(this.contentReferencesListPool.get()).object;this._register(t.onDidOpen(a=>{if(a.element&&"reference"in a.element&&typeof a.element.reference=="object"){const c="variableName"in a.element.reference?a.element.reference.value:a.element.reference,d=R.isUri(c)?c:c?.uri;d&&this.openerService.open(d,{fromUserGesture:!0,editorOptions:{...a.editorOptions,selection:c&&"range"in c?c.range:void 0}})}})),this._register(t.onContextMenu(a=>{Vi.stop(a.browserEvent,!0);const c=a.element&&eE(a.element);c&&this.contextMenuService.showContextMenu({getAnchor:()=>a.anchor,getActions:()=>{const d=this.menuService.getMenuActions(N.ChatAttachmentsContext,t.contextKeyService,{shouldForwardArgs:!0,arg:c});return rI(d)}})}));const i=this._register(this.instantiationService.createInstance(hi));this._register(t.onDidChangeFocus(a=>{i.reset();const c=a.elements.length?a.elements[0]:void 0,d=c&&eE(c);i.set(d??null)}));const r=Math.min(this.data.length,6)*22;return t.layout(r),t.getHTMLElement().style.height=`${r}px`,t.splice(0,t.length,this.data),t.getHTMLElement().parentElement}hasSameContent(e,t,i){return e.kind==="references"&&e.references.length===this.data.length&&!!t.length===this.hasFollowingContent}};M2=f([p(4,mi),p(5,fn),p(6,Z),p(7,bi)],M2);let dJ=class extends M2{constructor(e,t,i,n,o,r,a,c,d){super(e,t,i,n,r,a,c,d),this.options=o,e.length===0&&Qs(this.domNode)}isExpanded(){const e=this.context.element;return e.usedReferencesExpanded??!!(this.options.expandedWhenEmptyResponse&&e.response.value.length===0)}setExpanded(e){const t=this.context.element;t.usedReferencesExpanded=!this.isExpanded()}};dJ=f([p(5,mi),p(6,fn),p(7,Z),p(8,bi)],dJ);let N2=class extends F{get inUse(){return this._pool.inUse}constructor(e,t,i,n,o){super(),this._onDidChangeVisibility=e,this.menuId=t,this.instantiationService=i,this.themeService=n,this.labelService=o,this._pool=this._register(new I1e(()=>this.listFactory()))}listFactory(){const e=this._register(this.instantiationService.createInstance(vd,{onDidChangeVisibility:this._onDidChangeVisibility})),t=rL(".chat-used-context-list");return this._register(Aue(t,this.themeService)),this.instantiationService.createInstance(zne,"ChatListRenderer",t,new D1e,[this.instantiationService.createInstance(aL,e,this.menuId)],{alwaysConsumeMouseWheel:!1,accessibilityProvider:{getAriaLabel:n=>{if(n.kind==="warning")return n.content.value;const o=n.reference;return typeof o=="string"?o:"variableName"in o?o.variableName:R.isUri(o)?an(o.path):an(o.uri.path)},getWidgetAriaLabel:()=>h(4656,"Collapsible Chat List")},dnd:{getDragURI:n=>eE(n)?.toString()??null,getDragLabel:(n,o)=>{const r=$t(n.map(eE));if(r.length)return r.length===1?this.labelService.getUriLabel(r[0],{relative:!0}):`${r.length}`},dispose:()=>{},onDragOver:()=>!1,drop:()=>{},onDragStart:(n,o)=>{try{const r=n.getData(),a=$t(r.map(eE));this.instantiationService.invokeFunction(c=>ag(c,a,o))}catch{}}}})}get(){const e=this._pool.get();let t=!1;return{object:e,isStale:()=>t,dispose:()=>{t=!0,this._pool.release(e)}}}};N2=f([p(2,Z),p(3,pt),p(4,ui)],N2);class D1e{getHeight(e){return 22}getTemplateId(e){return aL.TEMPLATE_ID}}let aL=class{static{L2=this}static{this.TEMPLATE_ID="chatCollapsibleListRenderer"}constructor(e,t,i,n,o,r){this.labels=e,this.menuId=t,this.themeService=i,this.productService=n,this.instantiationService=o,this.contextKeyService=r,this.templateId=L2.TEMPLATE_ID}renderTemplate(e){const t=new U,i=t.add(this.labels.create(e,{supportHighlights:!0,supportIcons:!0}));let n,o,r;if(this.menuId){o=rL(".chat-collapsible-list-action-bar"),r=t.add(this.contextKeyService.createScoped(o));const a=t.add(this.instantiationService.createChild(new uf([fe,r])));n=t.add(a.createInstance(Y_,o,this.menuId,{menuOptions:{shouldForwardArgs:!0,arg:void 0}})),i.element.appendChild(o)}return{templateDisposables:t,label:i,toolbar:n,actionBarContainer:o,contextKeyService:r}}getReferenceIcon(e){return ke.isThemeIcon(e.iconPath)?e.iconPath:this.themeService.getColorTheme().type===S2.DARK&&e.iconPath?.dark?e.iconPath?.dark:e.iconPath?.light}renderElement(e,t,i,n){if(e.kind==="warning"){i.label.setResource({name:e.content.value},{icon:K.warning});return}const o=e.reference,r=this.getReferenceIcon(e);i.label.element.style.display="flex";let a;if(typeof o=="object"&&"variableName"in o)if(o.value){const c=R.isUri(o.value)?o.value:o.value.uri;i.label.setResource({resource:c,name:Zd(c),description:`#${o.variableName}`,range:"range"in o.value?o.value.range:void 0},{icon:r,title:e.options?.status?.description??e.title})}else if(o.variableName.startsWith("kernelVariable")){const d=`${o.variableName.split(":")[1]}`;i.label.setLabel("Kernel variable",d,{title:e.options?.status?.description})}else i.label.setLabel("Unknown variable type");else if(typeof o=="string")i.label.setLabel(o,void 0,{iconPath:R.isUri(r)?r:void 0,title:e.options?.status?.description??e.title});else{const c="uri"in o?o.uri:o;a=c;const d=e.excluded?["excluded"]:[];if(c.scheme==="https"&&TF(c.authority,"github.com")&&c.path.includes("/tree/")){const l=c.path.split("/").slice(1,3).join("/"),u=c.path.split("/").slice(5).join("/");i.label.setResource({resource:c,name:l,description:u},{icon:K.github,title:e.title,strikethrough:e.excluded,extraClasses:d})}else if(c.scheme===this.productService.urlProtocol&&TF(c.authority,d1e)){const l=c.path.substring(1);i.label.setResource({resource:c,name:l},{icon:K.settingsGear,title:h(4657,"Open setting '{0}'",l),strikethrough:e.excluded,extraClasses:d})}else xz(c,ae.mailto,ae.http,ae.https)?i.label.setResource({resource:c,name:c.toString()},{icon:r??K.globe,title:e.options?.status?.description??e.title??c.toString(),strikethrough:e.excluded,extraClasses:d}):i.label.setFile(c,{fileKind:Pi.FILE,fileDecorations:void 0,range:"range"in o?o.range:void 0,title:e.options?.status?.description??e.title,strikethrough:e.excluded,extraClasses:d})}for(const c of[".monaco-icon-suffix-container",".monaco-icon-name-container"]){const d=i.label.element.querySelector(c);d&&(e.options?.status?.kind===Ay.Omitted||e.options?.status?.kind===Ay.Partial?d.classList.add("warning"):d.classList.remove("warning"))}e.state!==void 0&&(i.actionBarContainer&&(e.state===_d.Modified&&!i.actionBarContainer.classList.contains("modified")?(i.actionBarContainer.classList.add("modified"),i.label.element.querySelector(".monaco-icon-name-container")?.classList.add("modified")):e.state!==_d.Modified&&(i.actionBarContainer.classList.remove("modified"),i.label.element.querySelector(".monaco-icon-name-container")?.classList.remove("modified"))),i.toolbar&&(i.toolbar.context=a),i.contextKeyService&&e.state!==void 0&&LO.bindTo(i.contextKeyService).set(e.state))}disposeTemplate(e){e.templateDisposables.dispose()}};aL=L2=f([p(2,pt),p(3,Vn),p(4,Z),p(5,fe)],aL);function eE(s){if(s.kind==="warning")return null;const{reference:e}=s;return typeof e=="string"||"variableName"in e?null:R.isUri(e)?e:e.uri}Y(class Pue extends X{static{this.id="workbench.action.chat.addToChatAction"}constructor(){super({id:Pue.id,title:{...I(4658,"Add File to Chat")},f1:!1,menu:[{id:N.ChatAttachmentsContext,group:"chat",order:1,when:x.and(hi.IsFileSystemResource,yo.negate())}]})}async run(e,t){const i=e.get(Ho);if(!t)return;const n=i.lastFocusedWidget;n&&n.attachmentModel.addFile(t)}});Y(class Lue extends X{static{this.id="workbench.action.chat.copyLink"}constructor(){super({id:Lue.id,title:{...I(4659,"Copy Link")},f1:!1,menu:[{id:N.ChatAttachmentsContext,group:"chat",order:0,when:x.or(hi.Scheme.isEqualTo(ae.http),hi.Scheme.isEqualTo(ae.https))}]})}async run(e,t){await e.get(Vs).writeResources([t])}});var Io;(function(s){s[s.FILE_INTERNAL=0]="FILE_INTERNAL",s[s.FILE_EXTERNAL=1]="FILE_EXTERNAL",s[s.FOLDER=2]="FOLDER",s[s.IMAGE=3]="IMAGE",s[s.SYMBOL=4]="SYMBOL",s[s.HTML=5]="HTML",s[s.MARKER=6]="MARKER",s[s.NOTEBOOK_CELL_OUTPUT=7]="NOTEBOOK_CELL_OUTPUT"})(Io||(Io={}));const k1e=/^data:image\/[a-z]+;base64,/,T1e=/^https?:\/\/.+/;let O2=class extends ww{constructor(e,t,i,n,o,r,a,c,d,l,u){super(i),this.attachmentModel=e,this.styles=t,this.extensionService=n,this.fileService=o,this.editorService=r,this.dialogService=a,this.textModelService=c,this.webContentExtractorService=d,this.chatWidgetService=l,this.logService=u,this.overlays=new Map,this.overlayTextBackground="",this.currentActiveTarget=void 0,this.updateStyles()}addOverlay(e,t){this.removeOverlay(e);const{overlay:i,disposable:n}=this.createOverlay(e,t);this.overlays.set(e,{overlay:i,disposable:n})}removeOverlay(e){this.currentActiveTarget===e&&(this.currentActiveTarget=void 0);const t=this.overlays.get(e);t&&(t.overlay.remove(),t.disposable.dispose(),this.overlays.delete(e))}createOverlay(e,t){const i=document.createElement("div");i.classList.add("chat-dnd-overlay"),this.updateOverlayStyles(i),t.appendChild(i);const n=new Wp(e,{onDragOver:o=>{o.stopPropagation(),o.preventDefault(),e!==this.currentActiveTarget&&(this.currentActiveTarget&&this.setOverlay(this.currentActiveTarget,void 0),this.currentActiveTarget=e,this.onDragEnter(o,e))},onDragLeave:o=>{e===this.currentActiveTarget&&(this.currentActiveTarget=void 0),this.onDragLeave(o,e)},onDrop:o=>{o.stopPropagation(),o.preventDefault(),e===this.currentActiveTarget&&(this.currentActiveTarget=void 0,this.onDrop(o,e))}});return{overlay:i,disposable:n}}onDragEnter(e,t){const i=this.guessDropType(e);this.updateDropFeedback(e,t,i)}onDragLeave(e,t){this.updateDropFeedback(e,t,void 0)}onDrop(e,t){this.updateDropFeedback(e,t,void 0),this.drop(e)}async drop(e){const t=await this.resolveAttachmentsFromDragEvent(e);t.length!==0&&this.attachmentModel.addContext(...t)}updateDropFeedback(e,t,i){const n=i!==void 0;e.dataTransfer&&(e.dataTransfer.dropEffect=n?"copy":"none"),this.setOverlay(t,i)}guessDropType(e){if(To(e,ho.NOTEBOOK_CELL_OUTPUT))return Io.NOTEBOOK_CELL_OUTPUT;if(A1e(e))return this.extensionService.extensions.some(t=>ay(t,"chatReferenceBinaryData"))?Io.IMAGE:void 0;if(To(e,"text/html"))return Io.HTML;if(To(e,ho.SYMBOLS))return Io.SYMBOL;if(To(e,ho.MARKERS))return Io.MARKER;if(To(e,Ds.FILES))return Io.FILE_EXTERNAL;if(To(e,ho.EDITORS))return Io.FILE_INTERNAL;if(To(e,Si.uriList,ho.FILES,Ds.RESOURCES,Ds.INTERNAL_URI_LIST))return Io.FOLDER}isDragEventSupported(e){return this.guessDropType(e)!==void 0}getDropTypeName(e){switch(e){case Io.FILE_INTERNAL:return h(4675,"File");case Io.FILE_EXTERNAL:return h(4675,"File");case Io.FOLDER:return h(4676,"Folder");case Io.IMAGE:return h(4677,"Image");case Io.SYMBOL:return h(4678,"Symbol");case Io.MARKER:return h(4679,"Problem");case Io.HTML:return h(4680,"URL");case Io.NOTEBOOK_CELL_OUTPUT:return h(4681,"Output")}}async resolveAttachmentsFromDragEvent(e){if(!this.isDragEventSupported(e))return[];if(To(e,ho.NOTEBOOK_CELL_OUTPUT)){const o=FRe(e);if(o)return gNe(o,this.editorService)}const t=ORe(e);if(t)return lNe(t);if(To(e,ho.SYMBOLS)){const o=NRe(e);return hNe(o)}const i=ode(e);if(i.length>0)return $t(await Promise.all(i.map(o=>xZ(o,this.fileService,this.editorService,this.textModelService,this.extensionService,this.dialogService))));const n=e.dataTransfer?.getData(Ds.INTERNAL_URI_LIST);if(n){const o=hl.parse(n);if(o.length)return $t(await Promise.all(o.map(r=>xZ({resource:R.parse(r)},this.fileService,this.editorService,this.textModelService,this.extensionService,this.dialogService))))}return!To(e,Ds.INTERNAL_URI_LIST)&&To(e,Si.uriList)&&(To(e,Si.html)||To(e,Si.text))?this.resolveHTMLAttachContext(e):[]}async downloadImageAsUint8Array(e){try{const i=await this.webContentExtractorService.readImage(R.parse(e),Ce.None);if(i)return i.buffer}catch(i){this.logService.warn("Fetch failed:",i)}const t=this.chatWidgetService.lastFocusedWidget?.inputEditor.getSelection();t&&this.chatWidgetService.lastFocusedWidget&&this.chatWidgetService.lastFocusedWidget.inputEditor.executeEdits("chatInsertUrl",[{range:t,text:e}]),this.logService.warn(`Image URLs must end in .jpg, .png, .gif, .webp, or .bmp. Failed to fetch image from this URL: ${e}`)}async resolveHTMLAttachContext(e){const t=new Set(this.attachmentModel.attachments.map(d=>d.name)),i=()=>{const d=h(4682,"Image from URL");let l=d,u=1;for(;t.has(l);)l=`${d} ${++u}`;return t.add(l),l},n=async d=>{const l=R.parse(d);if(k1e.test(d))return{data:sde(d),name:i(),resource:l};if(T1e.test(d)){const u=await this.downloadImageAsUint8Array(d);if(u)return{data:u,name:i(),resource:l,id:d}}},o=async d=>{try{const l=await d.arrayBuffer();return{data:new Uint8Array(l),name:i()}}catch(l){this.logService.error("Error reading file:",l)}},r=[],a=P1e(e);if(a.length){const d=await Promise.all(a.map(l=>o(l)));r.push(...d.filter(l=>!!l))}const c=R1e(e);if(c.length){const d=await Promise.all(c.map(n));r.push(...d.filter(l=>!!l))}return await Fle(r)}setOverlay(e,t){this.overlayText?.remove(),this.overlayText=void 0;const{overlay:i}=this.overlays.get(e);if(t!==void 0){const o=gf(`$(${K.attach.id}) ${this.getOverlayText(t)}`).map(r=>typeof r=="string"?j("span.overlay-text",void 0,r):r);this.overlayText=j("span.attach-context-overlay-text",void 0,...o),this.overlayText.style.backgroundColor=this.overlayTextBackground,i.appendChild(this.overlayText)}i.classList.toggle("visible",t!==void 0)}getOverlayText(e){const t=this.getDropTypeName(e);return h(4683,"Attach {0} as Context",t)}updateOverlayStyles(e){e.style.backgroundColor=this.getColor(this.styles.overlayBackground)||"",e.style.color=this.getColor(this.styles.listForeground)||""}updateStyles(){this.overlays.forEach(e=>this.updateOverlayStyles(e.overlay)),this.overlayTextBackground=this.getColor(this.styles.listBackground)||""}};O2=f([p(2,pt),p(3,cn),p(4,je),p(5,de),p(6,ei),p(7,Ci),p(8,YN),p(9,Ho),p(10,Re)],O2);function A1e(s){if(To(s,"image"))return!0;if(To(s,Ds.FILES)){const e=s.dataTransfer?.files;if(e&&e.length>0)return Array.from(e).some(i=>i.type.startsWith("image/"));const t=s.dataTransfer?.items;if(t&&t.length>0)return Array.from(t).some(i=>i.type.startsWith("image/"))}return!1}function R1e(s,e){const t=s.dataTransfer?.getData("text/uri-list");if(t)try{const i=hl.parse(t);if(i.length>0)return i}catch{return[]}return[]}function P1e(s){const e=s.dataTransfer?.files;return e?Array.from(e).filter(t=>t.type.startsWith("image/")):[]}const L1e=j;let F2=class extends F{constructor(e,t,i,n,o,r){super(),this.location=i,this.options=n,this.clickHandler=o,this.chatAgentService=r;const a=ee(e,L1e(".interactive-session-followups"));t.forEach(c=>this.renderFollowup(a,c))}renderFollowup(e,t){if(!this.chatAgentService.getDefaultAgent(this.location))return;const i=Rke(this.chatAgentService,this.location,"",t.agentId,t.subCommand);if(i===void 0)return;const n=t.kind==="reply"?t.title||t.message:t.title,o=t.kind==="reply"?t.message:t.title,r=(i+("tooltip"in t&&t.tooltip||o)).trim(),a=this._register(new zu(e,{...this.options,title:r}));t.kind==="reply"?a.element.classList.add("interactive-followup-reply"):t.kind==="command"&&a.element.classList.add("interactive-followup-command"),a.element.ariaLabel=h(4777,"Follow up question: {0}",n),a.label=new Gi(n),this._register(a.onDidClick(()=>this.clickHandler(t)))}};F2=f([p(5,pf)],F2);function M1e(s){return(e,t,i)=>new W2(s,e,t,i)}let W2=class extends Z_e{constructor(e,t,i,n){e.defaultValue&&typeof e.defaultValue=="object"&&(e.toStorage??=c=>JSON.stringify(c),e.fromStorage??=c=>JSON.parse(c));let o=e.defaultValue;const r=n.get(e.key,t);if(r!==void 0&&e.fromStorage)try{o=e.fromStorage(r)}catch{o=e.defaultValue}super(new Yne(void 0,`storage/${e.key}`,void 0),o,Qne),this._store=new U,this._didChange=!1;const a=n.onDidChangeValue(t,e.key,this._store);this._store.add(a(c=>{c.external&&c.key===e.key&&!this._didChange&&this.set(e.defaultValue,void 0)})),this._store.add(n.onWillSaveState(()=>{if(this._didChange){this._didChange=!1;const c=this.get();e.toStorage?n.store(e.key,e.toStorage(c),t,i):n.store(e.key,String(c),t,i)}}))}_setValue(e){super._setValue(e),this._didChange=!0}dispose(){this._store.dispose()}};W2=f([p(3,it)],W2);const N1e=M1e({defaultValue:{},key:"chat/selectedTools"});let B2=class extends F{constructor(e,t,i,n){super(),this._selectedTools=this._register(N1e(he.WORKSPACE,gt.MACHINE,n)),this._allTools=kn(t.onDidChangeTools,()=>Array.from(t.getTools()));const o=this._selectedTools.map(c=>(c.disabledBuckets?.length||c.disabledTools?.length)&&{buckets:new Set(c.disabledBuckets),toolIds:new Set(c.disabledTools)});this.tools=ve(c=>{const d=this._allTools.read(c);if(e.read(c)!==Rt.Agent)return d;const l=o.read(c);return l?d.filter(u=>!(l.toolIds.has(u.id)||l.buckets.has(PR.toKey(u.source)))):d});const r=ve(c=>{const d=this._allTools.read(c).length,l=this.tools.read(c).length;return{count:d,enabled:l}}),a=this._store.add(new M);this.toolsActionItemViewItemProvider=Object.assign((c,d)=>{if(c instanceof wr)return i.createInstance(class extends nI{render(l){this.options.icon=!1,this.options.label=!0,l.classList.add("chat-mcp","chat-attachment-button"),super.render(l)}updateLabel(){this._store.add(fi(l=>{yt(this.label);const{enabled:u,count:g}=r.read(l),m=g===0?"$(tools)":u!==g?h(4848,"{0} {1} of {2}","$(tools)",u,g):h(4849,"{0} {1}","$(tools)",g);kh(this.label,...gf(m)),this.element?.isConnected&&a.fire()}))}},c,{...d,keybindingNotRenderedWithLabel:!0})},{onDidRender:a.event})}selectOnly(e){const t=new Set(e),i=this._allTools.get().filter(n=>!t.has(n.id));this.update([],i)}update(e,t){this._selectedTools.set({disabledBuckets:e.map(PR.toKey),disabledTools:t.map(i=>i.id)},void 0)}asEnablementMap(){const e=new Map,t=new Set(this.tools.get().map(i=>i.id));for(const i of this._allTools.get())i.supportsToolPicker&&e.set(i,t.has(i.id));return e}};B2=f([p(1,kw),p(2,Z),p(3,it)],B2);let V2=class extends yx{constructor(e,t={},i,n,o){const r=i.createInstance(wx,e,t);super(r,t,i,n,o),this._register(r)}toString(){return`file-prompt:${this.uri.path}`}};V2=f([p(2,Z),p(3,It),p(4,Re)],V2);let H2=class extends V2{constructor(e,t,i,n){const{data:o}=e;$e(o instanceof R,`Variable data must be an URI, got '${o}'.`),super(o,{},t,i,n),this.reference=e}get id(){return this.reference.id}get range(){return this.reference.range}set range(e){this.reference.range=e}get data(){return this.uri}get isFile(){return this.reference.isFile}get fullName(){return this.reference.fullName}get icon(){return this.reference.icon}get modelDescription(){return this.reference.modelDescription}};H2=f([p(1,Z),p(2,It),p(3,Re)],H2);let lJ=class extends F{static{this.ID="chat.implicitContext"}constructor(e,t,i,n,o,r,a){super(),this.codeEditorService=e,this.editorService=t,this.chatWidgetService=i,this.chatService=n,this.chatEditingService=o,this.configurationService=r,this.ignoredFilesService=a,this._currentCancelTokenSource=this._register(new Pt),this._implicitContextEnablement=this.configurationService.getValue("chat.implicitContext.enabled");const c=this._register(new U);this._register(T.runAndSubscribe(t.onDidActiveEditorChange,()=>{c.clear();const d=this.findActiveCodeEditor();d&&c.add(T.debounce(T.any(d.onDidChangeModel,d.onDidChangeCursorSelection,d.onDidScrollChange,d.onDidChangeModelLanguage),()=>{},500)(()=>this.updateImplicitContext()));const l=this.findActiveNotebookEditor();if(l){const u=c.add(new U);c.add(l.onDidChangeActiveCell(()=>{u.clear();const g=this.codeEditorService.getActiveCodeEditor();g&&g.getModel()?.uri.scheme===ae.vscodeNotebookCell&&u.add(T.debounce(T.any(g.onDidChangeModel,g.onDidChangeCursorSelection,g.onDidScrollChange),()=>{},500)(()=>this.updateImplicitContext()))})),c.add(T.debounce(T.any(l.onDidChangeModel,l.onDidChangeActiveCell),()=>{},500)(()=>this.updateImplicitContext()))}this.updateImplicitContext()})),this._register(fi(d=>{this.chatEditingService.editingSessionsObs.read(d),this.updateImplicitContext()})),this._register(this.configurationService.onDidChangeConfiguration(d=>{d.affectsConfiguration("chat.implicitContext.enabled")&&(this._implicitContextEnablement=this.configurationService.getValue("chat.implicitContext.enabled"),this.updateImplicitContext())})),this._register(this.chatService.onDidSubmitRequest(({chatSessionId:d})=>{const l=this.chatWidgetService.getWidgetBySessionId(d);l?.input.implicitContext&&this._implicitContextEnablement[l.location]==="first"&&l.viewModel?.getItems().length!==0&&l.input.implicitContext.setValue(void 0,!1,void 0)})),this._register(this.chatWidgetService.onDidAddWidget(async d=>{await this.updateImplicitContext(d)}))}findActiveCodeEditor(){const e=this.codeEditorService.getActiveCodeEditor();if(e){const t=e.getModel();if(t?.uri.scheme===ae.vscodeNotebookCell)return;if(t)return e}for(const t of this.editorService.getVisibleTextEditorControls(Ii.MOST_RECENTLY_ACTIVE)){let i;if(Zu(t))i=t.getModifiedEditor();else if(mo(t))i=t;else continue;if(i.getModel())return i}}findActiveNotebookEditor(){return rl(this.editorService.activeEditorPane)}async updateImplicitContext(e){const t=this._currentCancelTokenSource.value=new li,i=this.findActiveCodeEditor(),n=i?.getModel(),o=i?.getSelection();let r,a=!1,c;if(n)if(c=n.getLanguageId(),o&&!o.isEmpty())r={uri:n.uri,range:o},a=!0;else{const g=i?.getVisibleRanges();if(g&&g.length>0){let m=g[0];g.slice(1).forEach(v=>{m=m.plusRange(v)}),r={uri:n.uri,range:m}}else r=n.uri}const d=this.findActiveNotebookEditor();if(d){const g=d.getActiveCell();if(g){const m=this.codeEditorService.getActiveCodeEditor(),v=m?.getSelection(),_=m?.getVisibleRanges()||[];if(r=g.uri,At(m?.getModel()?.uri,g.uri)){if(v&&!v.isEmpty())r={uri:g.uri,range:v},a=!0;else if(_.length>0){let w=_[0];_.slice(1).forEach(C=>{w=w.plusRange(C)}),r={uri:g.uri,range:w}}}}else r=d.textModel?.uri}const l=r instanceof R?r:r?.uri;if(l&&(await this.ignoredFilesService.fileIsIgnored(l,t.token)||l.path.endsWith(".copilotmd"))&&(r=void 0),t.token.isCancellationRequested)return;const u=e?[e]:[...this.chatWidgetService.getWidgetsByLocations($i.Panel),...this.chatWidgetService.getWidgetsByLocations($i.Editor)];for(const g of u){if(!g.input.implicitContext)continue;const m=this._implicitContextEnablement[g.location],v=g.viewModel?.getItems().length===0;m==="first"&&!v?g.input.implicitContext.setValue(void 0,!1,void 0):m==="always"||m==="first"&&v?g.input.implicitContext.setValue(r,a,c):m==="never"&&g.input.implicitContext.setValue(void 0,!1,void 0)}}};lJ=f([p(0,Bt),p(1,de),p(2,Ho),p(3,ff),p(4,ug),p(5,ne),p(6,Pq)],lJ);let U2=class extends F{get id(){return this.prompt!==void 0?np(this.prompt,!0).id:R.isUri(this.value)?"vscode.implicit.file":this.value?this._isSelection?"vscode.implicit.selection":"vscode.implicit.viewport":"vscode.implicit"}get name(){return this.prompt!==void 0?np(this.prompt,!0).name:R.isUri(this.value)?`file:${Qe(this.value)}`:this.value?`file:${Qe(this.value.uri)}`:"implicit"}get modelDescription(){return this.prompt!==void 0?np(this.prompt,!0).modelDescription:R.isUri(this.value)?"User's active file":this._isSelection?"User's active selection":"User's current visible code"}get isSelection(){return this._isSelection}get value(){return this._value}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._onDidChangeValue.fire()}constructor(e,t,i){super(),this.promptsService=e,this.modelService=t,this.logService=i,this.kind="implicit",this.isFile=!0,this._isSelection=!1,this._onDidChangeValue=this._register(new M),this.onDidChangeValue=this._onDidChangeValue.event,this._enabled=!0}setValue(e,t,i){this._value=e,this._isSelection=t,this.removePrompt(),e&&i===ple&&this.addPrompt(e),this._onDidChangeValue.fire()}async toBaseEntries(){return this.prompt===void 0?[{kind:"file",id:this.id,name:this.name,value:this.value,modelDescription:this.modelDescription}]:(await this.prompt.allSettled(),[...this.prompt.allValidReferences.map(e=>np(e,!1)),np({uri:this.prompt.uri,isPromptFile:!0},!0)])}get isPromptFile(){return this.prompt!==void 0}addPrompt(e){const t=R.isUri(e)?e:e.uri,i=this.modelService.getModel(t),n=i!==null;if(n===!1||i.isDisposed())return this.logService.warn(`cannot create prompt parser instance for ${t.path} (model exists: ${n})`);this.prompt=this.promptsService.getSyntaxParserFor(i)}removePrompt(){delete this.prompt}dispose(){this.removePrompt(),super.dispose()}};U2=f([p(0,zq),p(1,ci),p(2,Re)],U2);let hJ=class extends F{static{this.ID="chat.relatedFilesWorkingSet"}constructor(e,t){super(),this.chatEditingService=e,this.chatWidgetService=t,this.chatEditingSessionDisposables=new Map,this._register(fi(i=>{this.chatEditingService.editingSessionsObs.read(i).forEach(o=>{const r=this.chatWidgetService.getWidgetBySessionId(o.chatSessionId);r&&!this.chatEditingSessionDisposables.has(o.chatSessionId)&&this._handleNewEditingSession(o,r)})}))}_updateRelatedFileSuggestions(e,t){this._currentRelatedFilesRetrievalOperation||e.entries.get().length>0||t.attachmentModel.fileAttachments.length===0||(this._currentRelatedFilesRetrievalOperation=this.chatEditingService.getRelatedFiles(e.chatSessionId,t.getInput(),t.attachmentModel.fileAttachments,Ce.None).then(n=>{if(!n?.length||!t.viewModel?.sessionId||!t.input.relatedFiles)return;const o=this.chatEditingService.getEditingSession(t.viewModel.sessionId);if(!o||o.entries.get().length)return;const r=new Mp([...t.attachmentModel.fileAttachments,...t.input.relatedFiles.removedFiles]);if(!r.size)return;const a=new In;for(const c of n)for(const d of c.files){if(a.size>=2)break;r.has(d.uri)||(a.set(d.uri,h(4968,"{0} (Suggested)",d.description)),r.add(d.uri))}t.input.relatedFiles.value=[...a.entries()].map(([c,d])=>({uri:c,description:d}))}).finally(()=>{this._currentRelatedFilesRetrievalOperation=void 0}))}_handleNewEditingSession(e,t){const i=new U;i.add(e.onDidDispose(()=>{i.clear()})),this._updateRelatedFileSuggestions(e,t);const n=T.debounce(t.inputEditor.onDidChangeModelContent,()=>null,3e3);i.add(n(()=>{this._updateRelatedFileSuggestions(e,t)})),i.add(t.attachmentModel.onDidChange(()=>{this._updateRelatedFileSuggestions(e,t)})),i.add(e.onDidDispose(()=>{i.dispose()})),i.add(t.onDidAcceptInput(()=>{t.input.relatedFiles?.clear(),this._updateRelatedFileSuggestions(e,t)})),this.chatEditingSessionDisposables.set(e.chatSessionId,i)}dispose(){for(const e of this.chatEditingSessionDisposables.values())e.dispose();super.dispose()}};hJ=f([p(0,ug),p(1,Ho)],hJ);class O1e extends F{constructor(){super(...arguments),this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._removedFiles=new Mp,this._value=[]}get removedFiles(){return this._removedFiles}get value(){return this._value}set value(e){this._value=e,this._onDidChange.fire()}remove(e){this._value=this._value.filter(t=>!At(t.uri,e)),this._removedFiles.add(e),this._onDidChange.fire()}clearRemovedFiles(){this._removedFiles.clear()}clear(){this._value=[],this._removedFiles.clear(),this._onDidChange.fire()}}let $2=class extends J_e{constructor(e,t,i,n){super(e,t),this._options=t,this.actionWidgetService=i,this.keybindingService=n}show(){let e=this._options.actionBarActions??this._options.actionBarActionProvider?.getActions()??[];const t=this._options.actions??this._options.actionProvider?.getActions()??[],i=[],n=new Map;for(const c of t){let d=c.category;d||(d={label:"",order:Number.MAX_SAFE_INTEGER}),n.has(d.label)||n.set(d.label,[]),n.get(d.label).push(c)}const o=Array.from(n.entries()).sort((c,d)=>{const l=c[1][0]?.category?.order??Number.MAX_SAFE_INTEGER,u=d[1][0]?.category?.order??Number.MAX_SAFE_INTEGER;return l-u});for(const[c,d]of o){c&&i.push({label:c,kind:Jr.Header,canPreview:!1,disabled:!1,hideIcon:!1});for(const l of d)i.push({item:l,tooltip:l.tooltip,description:l.description,kind:Jr.Action,canPreview:!1,group:{title:"",icon:ke.fromId(l.checked?K.check.id:K.blank.id)},disabled:!1,hideIcon:!1,label:l.label,keybinding:this._options.showItemKeybindings?this.keybindingService.lookupKeybinding(l.id):void 0})}const r=wh(),a={onSelect:(c,d)=>{this.actionWidgetService.hide(),c.run()},onHide:()=>{Ph(r)&&r.focus()}};e=e.map(c=>({...c,run:async(...d)=>(this.actionWidgetService.hide(),c.run(...d))})),this.actionWidgetService.show(this._options.label??"",!1,i,a,this.element,void 0,e)}};$2=f([p(2,Ed),p(3,He)],$2);let cL=class extends QM{constructor(e,t,i,n,o){super(void 0,e),this.actionWidgetOptions=t,this._actionWidgetService=i,this._keybindingService=n,this._contextKeyService=o,this.actionItem=null}render(e){this.actionItem=e;const t=i=>(this.element=ee(i,j("a.action-label")),this.renderLabel(this.element));this.actionWidgetDropdown=this._register(new $2(e,{...this.actionWidgetOptions,labelRenderer:t},this._actionWidgetService,this._keybindingService)),this._register(this.actionWidgetDropdown.onDidChangeVisibility(i=>{this.element?.setAttribute("aria-expanded",`${i}`)})),this.updateTooltip(),this.updateEnabled()}renderLabel(e){return e.classList.add("codicon"),this._action.label&&this._register(Kz().setupManagedHover(this.options.hoverDelegate??Ir("mouse"),e,this._action.label)),null}setAriaLabelAttributes(e){e.setAttribute("role","button"),e.setAttribute("aria-haspopup","true"),e.setAttribute("aria-expanded","false"),e.ariaLabel=this._action.label||""}getTooltip(){const e=this._keybindingService.lookupKeybinding(this.action.id,this._contextKeyService),t=e&&e.getLabel(),i=this.action.tooltip??this.action.label;return t?`${i} (${t})`:i}show(){this.actionWidgetDropdown?.show()}updateEnabled(){const e=!this.action.enabled;this.actionItem?.classList.toggle("disabled",e),this.element?.classList.toggle("disabled",e)}};cL=f([p(2,Ed),p(3,He),p(4,fe)],cL);function F1e(s){return{getActions:()=>s.getModels().map(e=>({id:e.metadata.id,enabled:!0,checked:e.metadata.id===s.getCurrentModel()?.metadata.id,category:e.metadata.modelPickerCategory,class:void 0,description:e.metadata.cost,tooltip:e.metadata.description??e.metadata.name,label:e.metadata.name,run:()=>{s.setModel(e)}}))}}function W1e(s,e,t,i){const n=s.createMenu(N.ChatModelPicker,e),o=nN(n.getActions());n.dispose();const r=[];return o.length>0&&r.push(...o),i.entitlement===ii.Limited&&r.push({id:"moreModels",label:h(4970,"Add Premium Models"),enabled:!0,tooltip:h(4971,"Add premium models"),class:void 0,run:()=>{t.executeCommand("workbench.action.chat.upgradePlan")}}),r}let G2=class extends cL{constructor(e,t,i,n,o,r,a,c,d){const l={...e,label:t.metadata.name,tooltip:h(4972,"Pick Model"),run:()=>{}},u={actionProvider:F1e(i),actionBarActions:W1e(o,r,a,c)};super(l,u,n,d,r),this.currentModel=t,this._register(i.onDidChangeModel(g=>{this.currentModel=g,this.element&&this.renderLabel(this.element)}))}renderLabel(e){return this.setAriaLabelAttributes(e),kh(e,j("span.chat-model-label",void 0,this.currentModel.metadata.name),...gf("$(chevron-down)")),null}render(e){super.render(e),e.classList.add("chat-modelPicker-item")}};G2=f([p(3,Ed),p(4,fn),p(5,fe),p(6,Ge),p(7,Gq),p(8,He)],G2);let z2=class extends cL{constructor(e,t,i,n,o,r){const a=l=>({...e,id:XLe(l),label:OB(l),class:void 0,enabled:!0,checked:t.getMode()===l,run:async()=>{const u=await e.run({mode:l});return this.renderLabel(this.element),u}}),d={actionProvider:{getActions:()=>{const l=[a(Rt.Edit)];return n.hasToolsAgent&&l.push(a(Rt.Agent)),l.unshift(a(Rt.Ask)),l}},showItemKeybindings:!1};super(e,d,i,o,r),this.delegate=t,this._register(t.onDidChangeMode(()=>this.renderLabel(this.element)))}renderLabel(e){if(!this.element)return null;this.setAriaLabelAttributes(e);const t=OB(this.delegate.getMode());return kh(e,j("span.chat-model-label",void 0,t),...gf("$(chevron-down)")),null}render(e){super.render(e),e.classList.add("chat-modelPicker-item")}};z2=f([p(2,Ed),p(3,pf),p(4,He),p(5,fe)],z2);var gT;const Vf=j,uJ=250;let yv=class extends F{static{gT=this}static{this.INPUT_SCHEME="chatSessionInput"}static{this._counter=0}get attachmentModel(){return this._attachmentModel}async getAttachedAndImplicitContext(e){const t=[...this.attachmentModel.attachments];if(this.implicitContext?.enabled&&this.implicitContext.value){const o=await this.implicitContext.toBaseEntries();t.push(...o)}const i=this.variableService.getDynamicVariables(e);for(const o of i)o instanceof H2&&t.push(...o.allValidReferences.map(r=>np(r,!1)));const n=performance.now();return await this.promptInstructionsAttachmentsPart.allSettled(),this.logService.trace(`[] instructions tree resolved in ${performance.now()-n}ms`),t.push(...this.promptInstructionsAttachmentsPart.chatAttachments),t}get hasPromptFileAttachments(){return this.promptInstructionsAttachmentsPart.hasInstructions?!0:this.implicitContext===void 0?!1:this.implicitContext.isPromptFile&&this.implicitContext.enabled}get implicitContext(){return this._implicitContext}get relatedFiles(){return this._relatedFiles}get inputPartHeight(){return this._inputPartHeight}get followupsHeight(){return this._followupsHeight}get editSessionWidgetHeight(){return this._editSessionWidgetHeight}get attachmentsHeight(){return this.attachmentsContainer.offsetHeight+(this.attachmentsContainer.checkVisibility()?6:0)}get inputEditor(){return this._inputEditor}get currentLanguageModel(){return this._currentLanguageModel?.identifier}get selectedLanguageModel(){return this._currentLanguageModel}get currentMode(){return this._currentMode===Rt.Agent&&!this.agentService.hasToolsAgent?Rt.Edit:this._currentMode}get selectedElements(){const e=[],i=this._chatEditList?.object?.getSelectedElements()??[];for(const n of i)n.kind==="reference"&&R.isUri(n.reference)&&e.push(n.reference);return e}get attemptedWorkingSetEntriesCount(){return this._attemptedWorkingSetEntriesCount}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A,B,q,Q){super(),this.location=e,this.options=t,this.historyService=o,this.modelService=r,this.instantiationService=a,this.contextKeyService=c,this.configurationService=d,this.keybindingService=l,this.accessibilityService=u,this.languageModelsService=g,this.logService=m,this.fileService=v,this.editorService=_,this.themeService=w,this.textModelResolverService=C,this.storageService=k,this.labelService=D,this.variableService=A,this.agentService=B,this.sharedWebExtracterService=q,this.experimentService=Q,this._onDidLoadInputState=this._register(new M),this.onDidLoadInputState=this._onDidLoadInputState.event,this._onDidChangeHeight=this._register(new M),this.onDidChangeHeight=this._onDidChangeHeight.event,this._onDidFocus=this._register(new M),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new M),this.onDidBlur=this._onDidBlur.event,this._onDidChangeContext=this._register(new M),this.onDidChangeContext=this._onDidChangeContext.event,this._onDidAcceptFollowup=this._register(new M),this.onDidAcceptFollowup=this._onDidAcceptFollowup.event,this._indexOfLastAttachedContextDeletedWithKeyboard=-1,this._onDidChangeVisibility=this._register(new M),this._contextResourceLabels=this.instantiationService.createInstance(vd,{onDidChangeVisibility:this._onDidChangeVisibility.event}),this.inputEditorHeight=0,this.followupsDisposables=this._register(new U),this.attachedContextDisposables=this._register(new Pt),this._inputPartHeight=0,this._followupsHeight=0,this._editSessionWidgetHeight=0,this._waitForPersistedLanguageModel=this._register(new Pt),this._onDidChangeCurrentLanguageModel=this._register(new M),this._onDidChangeCurrentChatMode=this._register(new M),this.onDidChangeCurrentChatMode=this._onDidChangeCurrentChatMode.event,this._currentMode=Rt.Ask,this.inputUri=R.parse(`${gT.INPUT_SCHEME}:input-${gT._counter++}`),this._chatEditsActionsDisposables=this._register(new U),this._chatEditsDisposables=this._register(new U),this._attemptedWorkingSetEntriesCount=0,this._attachmentModel=this._register(this.instantiationService.createInstance(fU)),this.selectedToolsModel=this._register(this.instantiationService.createInstance(B2,kn(this,this.onDidChangeCurrentChatMode,()=>this.currentMode))),this.dnd=this._register(this.instantiationService.createInstance(O2,this._attachmentModel,i)),this.getInputState=()=>({...n(),chatContextAttachments:this._attachmentModel.attachments,chatMode:this._currentMode}),this.inputEditorMaxHeight=this.options.renderStyle==="compact"?uJ/3:uJ,this.inputEditorHasText=_e.inputHasText.bindTo(c),this.chatCursorAtTop=_e.inputCursorAtTop.bindTo(c),this.inputEditorHasFocus=_e.inputHasFocus.bindTo(c),this.promptFileAttached=_e.hasPromptFile.bindTo(c),this.chatMode=_e.chatMode.bindTo(c),this.history=this.loadHistory(),this._register(this.historyService.onDidClearHistory(()=>this.history=new Z6([{text:"",state:this.getInputState()}],FLe,gJ))),this._register(this.configurationService.onDidChangeConfiguration(ie=>{ie.affectsConfiguration(zn.Chat)&&this.inputEditor.updateOptions({ariaLabel:this._getAriaLabel()})})),this._chatEditsListPool=this._register(this.instantiationService.createInstance(N2,this._onDidChangeVisibility.event,N.ChatEditingWidgetModifiedFilesToolbar)),this._hasFileAttachmentContextKey=_e.hasFileAttachments.bindTo(c),this.promptInstructionsAttachmentsPart=this._register(a.createInstance(zH,this.attachmentModel.promptInstructions,this._contextResourceLabels)),this.promptInstructionsAttachmentsPart.onAttachmentsChange(()=>{this._handleAttachedContextChange(),this._onDidChangeHeight.fire()}),this.initSelectedModel(),this._register(this.onDidChangeCurrentChatMode(()=>this.accessibilityService.alert(this._currentMode))),this._register(this._onDidChangeCurrentLanguageModel.event(()=>{this._currentLanguageModel?.metadata.name&&this.accessibilityService.alert(this._currentLanguageModel.metadata.name)}))}getSelectedModelStorageKey(){return`chat.currentLanguageModel.${this.location}`}getSelectedModelIsDefaultStorageKey(){return`chat.currentLanguageModel.${this.location}.isDefault`}initSelectedModel(){const e=this.storageService.get(this.getSelectedModelStorageKey(),he.APPLICATION),t=this.storageService.getBoolean(this.getSelectedModelIsDefaultStorageKey(),he.APPLICATION,e==="github.copilot-chat/gpt-4o");if(e){const i=this.languageModelsService.lookupLanguageModel(e);i?(!t||i.isDefault)&&(this.setCurrentLanguageModel({metadata:i,identifier:e}),this.checkModelSupported()):this._waitForPersistedLanguageModel.value=this.languageModelsService.onDidChangeLanguageModels(n=>{const o=n.added?.find(r=>r.identifier===e);o&&(this._waitForPersistedLanguageModel.clear(),(!t||o.metadata.isDefault)&&o.metadata.isUserSelectable&&(this.setCurrentLanguageModel({metadata:o.metadata,identifier:e}),this.checkModelSupported()))})}this._register(this._onDidChangeCurrentChatMode.event(()=>{this.checkModelSupported()})),this._register(this.configurationService.onDidChangeConfiguration(i=>{i.affectsConfiguration(ky.Edits2Enabled)&&this.checkModelSupported()}))}switchModel(e){const i=this.getModels().find(n=>n.metadata.vendor===e.vendor&&n.metadata.id===e.id&&n.metadata.family===e.family);i&&this.setCurrentLanguageModel(i)}switchToNextModel(){const e=this.getModels();if(e.length>0){const i=(e.findIndex(n=>n.identifier===this._currentLanguageModel?.identifier)+1)%e.length;this.setCurrentLanguageModel(e[i])}}openModelPicker(){this.modelWidget?.show()}checkModelSupported(){this._currentLanguageModel&&!this.modelSupportedForDefaultAgent(this._currentLanguageModel)&&this.setCurrentLanguageModelToDefault()}setChatMode(e){this.options.supportsChangingModes&&(e=FB(e)??Rt.Ask,this._currentMode=e,this.chatMode.set(e),this._onDidChangeCurrentChatMode.fire())}modelSupportedForDefaultAgent(e){return this.currentMode===Rt.Agent||this.currentMode===Rt.Edit&&this.configurationService.getValue(ky.Edits2Enabled)?this.configurationService.getValue("chat.agent.allModels")?!0:(typeof e.metadata.capabilities?.agentMode>"u"||e.metadata.capabilities.agentMode)&&!!e.metadata.capabilities?.toolCalling:!0}getModels(){const e=this.languageModelsService.getLanguageModelIds().map(t=>({identifier:t,metadata:this.languageModelsService.lookupLanguageModel(t)})).filter(t=>t.metadata?.isUserSelectable&&this.modelSupportedForDefaultAgent(t));return e.sort((t,i)=>t.metadata.name.localeCompare(i.metadata.name)),e}setCurrentLanguageModelToDefault(){const e=this.languageModelsService.getLanguageModelIds().find(n=>this.languageModelsService.lookupLanguageModel(n)?.isDefault),i=this.languageModelsService.getLanguageModelIds().find(n=>{const o=this.languageModelsService.lookupLanguageModel(n);return o?.isUserSelectable&&!o.isDefault})&&e?{metadata:this.languageModelsService.lookupLanguageModel(e),identifier:e}:void 0;i&&this.setCurrentLanguageModel(i)}setCurrentLanguageModel(e){this._currentLanguageModel=e,this.cachedDimensions&&this.layout(this.cachedDimensions.height,this.cachedDimensions.width),this.storageService.store(this.getSelectedModelStorageKey(),e.identifier,he.APPLICATION,gt.USER),this.storageService.store(this.getSelectedModelIsDefaultStorageKey(),!!e.metadata.isDefault,he.APPLICATION,gt.USER),this._onDidChangeCurrentLanguageModel.fire(e)}loadHistory(){const e=this.historyService.getHistory(this.location);return e.length===0&&e.push({text:"",state:this.getInputState()}),new Z6(e,50,gJ)}_getAriaLabel(){if(this.configurationService.getValue(zn.Chat)){const t=this.keybindingService.lookupKeybinding(Bo.OpenAccessibilityHelp)?.getLabel();return t?h(4789,"Chat Input,  Type to ask questions or type / for topics, press enter to send out the request. Use {0} for Chat Accessibility Help.",t):h(4790,"Chat Input,  Type code here and press Enter to run. Use the Chat Accessibility Help command for more information.")}return h(4791,"Chat Input")}initForNewChatModel(e,t){this.history=this.loadHistory(),this.history.add({text:e.inputValue??this.history.current().text,state:e.inputState??this.getInputState()});const i=e.inputState?.chatContextAttachments??[];if(this._attachmentModel.clearAndSetContext(...i),e.inputValue&&this.setValue(e.inputValue,!1),e.inputState?.chatMode&&this.setChatMode(e.inputState.chatMode),t){const n=this.getDefaultModeExperimentStorageKey();this.storageService.getBoolean(n,he.WORKSPACE,!1)||Promise.all([this.experimentService.getTreatment("chat.defaultMode"),this.experimentService.getTreatment("chat.defaultLanguageModel")]).then(([r,a])=>{if(typeof r=="string"){this.storageService.store(n,!0,he.WORKSPACE,gt.MACHINE);const c=FB(r);c&&(this.logService.trace(`Applying default mode from experiment: ${c}`),this.setChatMode(c),this.checkModelSupported())}typeof a=="string"&&this._currentMode===Rt.Agent&&(this.storageService.store(n,!0,he.WORKSPACE,gt.MACHINE),this.logService.trace(`Applying default language model from experiment: ${a}`),this.setExpModelOrWait(a))})}}setExpModelOrWait(e){const t=this.languageModelsService.lookupLanguageModel(e);t?(this.setCurrentLanguageModel({metadata:t,identifier:e}),this.checkModelSupported(),this._waitForPersistedLanguageModel.clear()):this._waitForPersistedLanguageModel.value=this.languageModelsService.onDidChangeLanguageModels(i=>{const n=i.added?.find(o=>o.identifier===e);n&&(this._waitForPersistedLanguageModel.clear(),n.metadata.isUserSelectable&&(this.setCurrentLanguageModel({metadata:n.metadata,identifier:e}),this.checkModelSupported()))})}getDefaultModeExperimentStorageKey(){return`chat.${this.options.widgetViewKindTag}.hasSetDefaultModeByExperiment`}logInputHistory(){const e=[...this.history].map(t=>JSON.stringify(t)).join(`
`);this.logService.info(`[${this.location}] Chat input history:`,e)}setVisible(e){this._onDidChangeVisibility.fire(e)}get element(){return this.container}async showPreviousValue(){const e=this.getInputState();if(this.history.isAtEnd())this.saveCurrentValue(e);else{const t=this.getFilteredEntry(this._inputEditor.getValue(),e);this.history.has(t)||(this.saveCurrentValue(e),this.history.resetCursor())}this.navigateHistory(!0)}async showNextValue(){const e=this.getInputState();if(!this.history.isAtEnd()){{const t=this.getFilteredEntry(this._inputEditor.getValue(),e);this.history.has(t)||(this.saveCurrentValue(e),this.history.resetCursor())}this.navigateHistory(!1)}}async navigateHistory(e){const t=e?this.history.previous():this.history.next();let i=t.state?.chatContextAttachments??[];i.length>0&&(i=(await Promise.all(i.map(async o=>{if(fm(o)&&o.references?.length&&R.isUri(o.references[0].reference)){const r=o.references[0].reference;try{const a=r.toString(!0).startsWith("http")?await this.sharedWebExtracterService.readImage(r,Ce.None):(await this.fileService.readFile(r)).value;if(!a)return;const c={...o};return c.value=fm(o)&&o.isPasted?a.buffer:await EO(a.buffer),c}catch(a){this.logService.error("Failed to fetch and reference.",a);return}}return o}))).filter(o=>o!==void 0)),this._attachmentModel.clearAndSetContext(...i),zc(t.text),this.setValue(t.text,!0),this._onDidLoadInputState.fire(t.state);const n=this._inputEditor.getModel();if(n)if(e){const o=this._inputEditor._getViewModel()?.getLineLength(1)??1,r=n.getLineLength(1);o===r?this._inputEditor.setPosition({lineNumber:1,column:o+1}):this._inputEditor.setPosition({lineNumber:1,column:o})}else this._inputEditor.setPosition(pJ(n))}setValue(e,t){this.inputEditor.setValue(e),this.inputEditor.setPosition({lineNumber:1,column:e.length+1}),t||this.saveCurrentValue(this.getInputState())}saveCurrentValue(e){const t=this.getFilteredEntry(this._inputEditor.getValue(),e);this.history.replaceLast(t)}focus(){this._inputEditor.focus()}hasFocus(){return this._inputEditor.hasWidgetFocus()}async acceptInput(e){if(e){const t=this._inputEditor.getValue(),i=this.getInputState(),n=this.getFilteredEntry(t,i);this.history.replaceLast(n),this.history.add({text:""})}this.attachmentModel.clear(),this._onDidLoadInputState.fire({}),this.accessibilityService.isScreenReaderOptimized()&&Yt?this._acceptInputForVoiceover():(this._inputEditor.focus(),this._inputEditor.setValue(""))}validateCurrentMode(){!this.agentService.hasToolsAgent&&this._currentMode===Rt.Agent&&this.setChatMode(Rt.Edit)}getFilteredEntry(e,t){const i=t.chatContextAttachments?.map(o=>{if(fm(o)&&o.references?.length&&o.value){const r={...o};return r.value=void 0,r}return o});return t.chatContextAttachments=i,{text:e,state:t}}_acceptInputForVoiceover(){const e=this._inputEditor.getDomNode();e&&(e.remove(),this._inputEditor.setValue(""),this._inputEditorElement.appendChild(e),this._inputEditor.focus())}_handleAttachedContextChange(){this._hasFileAttachmentContextKey.set(!!this._attachmentModel.attachments.find(e=>e.kind==="file")),this.renderAttachedContext()}render(e,t,i){let n;this.options.renderStyle==="compact"?n=en(".interactive-input-part",[en(".interactive-input-and-edit-session",[en(".chat-editing-session@chatEditingSessionWidgetContainer"),en(".interactive-input-and-side-toolbar@inputAndSideToolbar",[en(".chat-input-container@inputContainer",[en(".chat-editor-container@editorContainer"),en(".chat-input-toolbars@inputToolbars")])]),en(".chat-attachments-container@attachmentsContainer",[en(".chat-attachment-toolbar@attachmentToolbar"),en(".chat-attached-context@attachedContextContainer"),en(".chat-related-files@relatedFilesContainer")]),en(".interactive-input-followups@followupsContainer")])]):n=en(".interactive-input-part",[en(".interactive-input-followups@followupsContainer"),en(".chat-editing-session@chatEditingSessionWidgetContainer"),en(".interactive-input-and-side-toolbar@inputAndSideToolbar",[en(".chat-input-container@inputContainer",[en(".chat-attachments-container@attachmentsContainer",[en(".chat-attachment-toolbar@attachmentToolbar"),en(".chat-related-files@relatedFilesContainer"),en(".chat-attached-context@attachedContextContainer")]),en(".chat-editor-container@editorContainer"),en(".chat-input-toolbars@inputToolbars")])])]),this.container=n.root,e.append(this.container),this.container.classList.toggle("compact",this.options.renderStyle==="compact"),this.followupsContainer=n.followupsContainer;const o=n.inputAndSideToolbar,r=n.inputContainer,a=n.editorContainer;this.attachmentsContainer=n.attachmentsContainer,this.attachedContextContainer=n.attachedContextContainer,this.relatedFilesContainer=n.relatedFilesContainer;const c=n.inputToolbars,d=n.attachmentToolbar;this.chatEditingSessionWidgetContainer=n.chatEditingSessionWidgetContainer,this.options.enableImplicitContext&&(this._implicitContext=this._register(this.instantiationService.createInstance(U2)),this._register(this._implicitContext.onDidChangeValue(()=>this._handleAttachedContextChange()))),this.renderAttachedContext(),this._register(this._attachmentModel.onDidChange(()=>this._handleAttachedContextChange())),this.renderChatEditingSessionState(null),this.options.renderWorkingSet&&(this._relatedFiles=this._register(new O1e),this._register(this._relatedFiles.onDidChange(()=>this.renderChatRelatedFiles()))),this.renderChatRelatedFiles(),this.dnd.addOverlay(this.options.dndContainer??e,this.options.dndContainer??e);const l=this._register(this.contextKeyService.createScoped(r));_e.inChatInput.bindTo(l).set(!0);const u=this._register(this.instantiationService.createChild(new uf([fe,l]))),{historyNavigationBackwardsEnablement:g,historyNavigationForwardsEnablement:m}=this._register(kO(l,this));this.historyNavigationBackwardsEnablement=g,this.historyNavigationForewardsEnablement=m;const v=MLe(this.configurationService);v.overflowWidgetsDomNode=this.options.editorOverflowWidgetsDomNode,v.pasteAs=cI.pasteAs.defaultValue,v.readOnly=!1,v.ariaLabel=this._getAriaLabel(),v.fontFamily=gSe,v.fontSize=13,v.lineHeight=20,v.padding=this.options.renderStyle==="compact"?{top:2,bottom:2}:{top:8,bottom:8},v.cursorWidth=1,v.wrappingStrategy="advanced",v.bracketPairColorization={enabled:!1},v.suggest={showIcons:!0,showSnippets:!1,showWords:!0,showStatusBar:!1,insertMode:"replace"},v.scrollbar={...v.scrollbar??{},vertical:"hidden"},v.stickyScroll={enabled:!1},this._inputEditorElement=ee(a,Vf(Mue));const _=NLe();_.contributions?.push(...TE.getSomeEditorContributions([ws.ID,qy.ID,tg.ID,md.ID,mv.ID])),this._inputEditor=this._register(u.createInstance(gI,this._inputEditorElement,v,_)),ia.get(this._inputEditor)?.forceRenderingAbove(),v.overflowWidgetsDomNode?.classList.add("hideSuggestTextIcons"),this._inputEditorElement.classList.add("hideSuggestTextIcons"),this._register(this._inputEditor.onDidChangeModelContent(()=>{const D=Math.min(this._inputEditor.getContentHeight(),this.inputEditorMaxHeight);D!==this.inputEditorHeight&&(this.inputEditorHeight=D,this._onDidChangeHeight.fire());const A=this._inputEditor.getModel(),B=!!A&&A.getValue().trim().length>0;this.inputEditorHasText.set(B)})),this._register(this._inputEditor.onDidContentSizeChange(D=>{D.contentHeightChanged&&(this.inputEditorHeight=D.contentHeight,this._onDidChangeHeight.fire())})),this._register(this._inputEditor.onDidFocusEditorText(()=>{this.inputEditorHasFocus.set(!0),this._onDidFocus.fire(),r.classList.toggle("focused",!0)})),this._register(this._inputEditor.onDidBlurEditorText(()=>{this.inputEditorHasFocus.set(!1),r.classList.toggle("focused",!1),this._onDidBlur.fire()})),this._register(this._inputEditor.onDidBlurEditorWidget(()=>{md.get(this._inputEditor)?.clearWidgets(),tg.get(this._inputEditor)?.clearWidgets()}));const w=this._register(Zm());if(this._register(No(c,pe.CLICK,D=>this.inputEditor.focus())),this._register(No(this.attachmentsContainer,pe.CLICK,D=>this.inputEditor.focus())),this.inputActionsToolbar=this._register(this.instantiationService.createInstance(Y_,c,N.ChatInput,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{shouldForwardArgs:!0},hiddenItemStrategy:Lk.Ignore,hoverDelegate:w})),this.inputActionsToolbar.context={widget:i},this._register(this.inputActionsToolbar.onDidChangeMenuItems(()=>{this.cachedDimensions&&typeof this.cachedInputToolbarWidth=="number"&&this.cachedInputToolbarWidth!==this.inputActionsToolbar.getItemsWidth()&&this.layout(this.cachedDimensions.height,this.cachedDimensions.width)})),this.executeToolbar=this._register(this.instantiationService.createInstance(Y_,c,this.options.menus.executeToolbar,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{shouldForwardArgs:!0},hoverDelegate:w,hiddenItemStrategy:Lk.Ignore,actionViewItemProvider:(D,A)=>{if((this.location===$i.Panel||this.location===$i.Editor)&&(D.id===o4.ID||D.id===a4.ID||D.id===r4.ID)&&D instanceof wr){const B=this.instantiationService.createInstance(wr,{id:"chat.moreExecuteActions",title:h(4792,"More..."),icon:K.chevronDown},void 0,void 0,void 0,void 0);return this.instantiationService.createInstance(q2,D,B,{...A,menuAsChild:!1})}if(D.id===ale&&D instanceof wr){if(this._currentLanguageModel||this.setCurrentLanguageModelToDefault(),this._currentLanguageModel){const B={getCurrentModel:()=>this._currentLanguageModel,onDidChangeModel:this._onDidChangeCurrentLanguageModel.event,setModel:q=>{this._waitForPersistedLanguageModel.clear(),this.setCurrentLanguageModel(q),this.renderAttachedContext()},getModels:()=>this.getModels()};return this.modelWidget=this.instantiationService.createInstance(G2,D,this._currentLanguageModel,B)}}else if(D.id===nle&&D instanceof wr){const B={getMode:()=>this.currentMode,onDidChangeMode:this._onDidChangeCurrentChatMode.event};return this.instantiationService.createInstance(z2,D,B)}}})),this.executeToolbar.getElement().classList.add("chat-execute-toolbar"),this.executeToolbar.context={widget:i},this._register(this.executeToolbar.onDidChangeMenuItems(()=>{this.cachedDimensions&&typeof this.cachedExecuteToolbarWidth=="number"&&this.cachedExecuteToolbarWidth!==this.executeToolbar.getItemsWidth()&&this.layout(this.cachedDimensions.height,this.cachedDimensions.width)})),this.options.menus.inputSideToolbar){const D=this._register(this.instantiationService.createInstance(Y_,o,this.options.menus.inputSideToolbar,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{shouldForwardArgs:!0},hoverDelegate:w}));this.inputSideToolbarContainer=D.getElement(),D.getElement().classList.add("chat-side-toolbar"),D.context={widget:i}}let C=this.modelService.getModel(this.inputUri);if(C||(C=this.modelService.createModel("",null,this.inputUri,!0)),this.textModelResolverService.createModelReference(this.inputUri).then(D=>{if(this._store.isDisposed){D.dispose();return}this._register(D)}),this.inputModel=C,this.inputModel.updateOptions({bracketColorizationOptions:{enabled:!1,independentColorPoolPerBracketType:!1}}),this._inputEditor.setModel(this.inputModel),t){this.inputModel.setValue(t);const D=this.inputModel.getLineCount();this._inputEditor.setPosition({lineNumber:D,column:this.inputModel.getLineMaxColumn(D)})}const k=()=>{const D=this._inputEditor.getModel();if(!D)return;const A=this._inputEditor.getPosition();if(!A)return;const B=A.lineNumber===1&&A.column-1<=(this._inputEditor._getViewModel()?.getLineLength(1)??0);this.chatCursorAtTop.set(B),this.historyNavigationBackwardsEnablement.set(B),this.historyNavigationForewardsEnablement.set(A.equals(pJ(D)))};this._register(this._inputEditor.onDidChangeCursorPosition(D=>k())),k(),this._register(this.themeService.onDidFileIconThemeChange(()=>{this.renderAttachedContext()})),this.addFilesToolbar=this._register(this.instantiationService.createInstance(Y_,d,N.ChatInputAttachmentToolbar,{telemetrySource:this.options.menus.telemetrySource,label:!0,menuOptions:{shouldForwardArgs:!0,renderShortTitle:!0},hiddenItemStrategy:Lk.Ignore,hoverDelegate:w,actionViewItemProvider:(D,A)=>{if(D.id==="workbench.action.chat.attachContext")return this.instantiationService.createInstance(B1e,void 0,D,A);if(D.id===d4.id)return this.selectedToolsModel.toolsActionItemViewItemProvider(D,A)}})),this.addFilesToolbar.context={widget:i,placeholder:h(4793,"Search for files and context to add to your request")},this._register(this.addFilesToolbar.onDidChangeMenuItems(()=>{this.cachedDimensions&&this._onDidChangeHeight.fire()})),this._register(this.selectedToolsModel.toolsActionItemViewItemProvider.onDidRender(()=>this._onDidChangeHeight.fire()))}renderAttachedContext(){const e=this.attachedContextContainer,t=this.attachmentsContainer.offsetHeight,i=new U;this.attachedContextDisposables.value=i,Xi(e);const n=i.add(Zm()),o=[...this.attachmentModel.attachments.entries()],r=!!o.length||!!this.implicitContext?.value||!this.promptInstructionsAttachmentsPart.empty;if(G_(!!(r||this.addFilesToolbar&&!this.addFilesToolbar.isEmpty()),this.attachmentsContainer),G_(r,this.attachedContextContainer),o.length||(this._indexOfLastAttachedContextDeletedWithKeyboard=-1),this.implicitContext?.value){const a=i.add(this.instantiationService.createInstance(HH,this.implicitContext,this._contextResourceLabels));e.appendChild(a.domNode)}this.promptFileAttached.set(this.hasPromptFileAttachments),this.promptInstructionsAttachmentsPart.render(e);for(const[a,c]of o){const d=R.isUri(c.value)?c.value:c.value&&typeof c.value=="object"&&"uri"in c.value&&R.isUri(c.value.uri)?c.value.uri:void 0,l=c.value&&typeof c.value=="object"&&"range"in c.value&&P.isIRange(c.value.range)?c.value.range:void 0,u=a===Math.min(this._indexOfLastAttachedContextDeletedWithKeyboard,this.attachmentModel.size-1);let g;d&&vce(c)?g=this.instantiationService.createInstance(y2,d,c,this._currentLanguageModel,u,e,this._contextResourceLabels,n):d&&(c.kind==="file"||c.kind==="directory")?g=this.instantiationService.createInstance(m2,d,l,c,this._currentLanguageModel,u,e,this._contextResourceLabels,n):fm(c)?g=this.instantiationService.createInstance(v2,d,c,this._currentLanguageModel,u,e,this._contextResourceLabels,n):_ce(c)?g=this.instantiationService.createInstance(w2,c,this._currentLanguageModel,u,e,this._contextResourceLabels,n):mce(c)?g=this.instantiationService.createInstance(_2,c,this._currentLanguageModel,u,e,this._contextResourceLabels,n):g=this.instantiationService.createInstance(b2,d,l,c,this._currentLanguageModel,u,e,this._contextResourceLabels,n),i.add(g),i.add(g.onDidDelete(m=>{this.handleAttachmentDeletion(m,a,c)}))}t!==this.attachmentsContainer.offsetHeight&&this._onDidChangeHeight.fire()}handleAttachmentDeletion(e,t,i){UF(e)&&(this._indexOfLastAttachedContextDeletedWithKeyboard=t),this._attachmentModel.delete(i.id),this._attachmentModel.size===0&&this.focus(),this._onDidChangeContext.fire({removed:[i]})}async renderChatEditingSessionState(e){G_(!!e,this.chatEditingSessionWidgetContainer);const t=new Mp,i=e?.entries.get().map(v=>(t.add(v.modifiedURI),{reference:v.modifiedURI,state:v.state.get(),kind:"reference"}))??[];if(!e||!this.options.renderWorkingSet||!i.length){Xi(this.chatEditingSessionWidgetContainer),this._chatEditsDisposables.clear(),this._chatEditList=void 0;return}const n=this.chatEditingSessionWidgetContainer.querySelector(".chat-editing-session-container.show-file-icons")??ee(this.chatEditingSessionWidgetContainer,Vf(".chat-editing-session-container.show-file-icons"));for(const v of e.entries.get())t.has(v.modifiedURI)||(i.unshift({reference:v.modifiedURI,state:v.state.get(),kind:"reference"}),t.add(v.modifiedURI));i.sort((v,_)=>v.kind==="reference"&&_.kind==="reference"?v.state===_.state||v.state===void 0||_.state===void 0?v.reference.toString().localeCompare(_.reference.toString()):v.state-_.state:0);const o=n.querySelector(".chat-editing-session-overview")??ee(n,Vf(".chat-editing-session-overview")),r=o.querySelector(".working-set-title")??ee(o,Vf(".working-set-title")),a=r.querySelector("span.working-set-count")??ee(r,Vf("span.working-set-count"));a.textContent=i.length===1?h(4794,"1 file changed"):h(4795,"{0} files changed",i.length),r.ariaLabel=a.textContent,r.tabIndex=0,this._chatEditsActionsDisposables.clear();const c=o.querySelector(".chat-editing-session-actions")??ee(o,Vf(".chat-editing-session-actions"));if(this._chatEditsActionsDisposables.add(this.instantiationService.createInstance(kH,c,N.ChatEditingWidgetToolbar,{telemetrySource:this.options.menus.telemetrySource,menuOptions:{arg:{sessionId:e.chatSessionId}},buttonConfigProvider:v=>{if(v.id===Gb.ID||v.id===FO.ID||v.id===zb.Id)return{showIcon:!0,showLabel:!1,isSecondary:!0}}})),!e)return;const d=n.querySelector(".chat-editing-session-list")??ee(n,Vf(".chat-editing-session-list"));if(!this._chatEditList){this._chatEditList=this._chatEditsListPool.get();const v=this._chatEditList.object;this._chatEditsDisposables.add(this._chatEditList),this._chatEditsDisposables.add(v.onDidFocus(()=>{this._onDidFocus.fire()})),this._chatEditsDisposables.add(v.onDidOpen(async _=>{if(_.element?.kind==="reference"&&R.isUri(_.element.reference)){const w=_.element.reference,C=e.getEntry(w),k=await this.editorService.openEditor({resource:w,options:_.editorOptions},_.sideBySide?Rr:ol);k&&C?.getEditorIntegration(k).reveal(!0,_.editorOptions.preserveFocus)}})),this._chatEditsDisposables.add(re(v.getHTMLElement(),"click",_=>{this.hasFocus()||this._onDidFocus.fire()},!0)),ee(d,v.getHTMLElement()),ee(n,d)}const g=Math.min(i.length,6)*22,m=this._chatEditList.object;m.layout(g),m.getHTMLElement().style.height=`${g}px`,m.splice(0,m.length,i),this._onDidChangeHeight.fire()}async renderChatRelatedFiles(){const e=this.relatedFilesContainer;Xi(e);const t=this.configurationService.getValue("chat.renderRelatedFiles");if(G_(!!(this.relatedFiles?.value.length&&t),e),!t||!this.relatedFiles?.value.length)return;const i=Ir("element");for(const{uri:n,description:o}of this.relatedFiles.value){const r=this._chatEditsActionsDisposables.add(new zu(e,{supportIcons:!0,secondary:!0,hoverDelegate:i}));r.label=this.labelService.getUriBasenameLabel(n),r.element.classList.add("monaco-icon-label"),r.element.title=h(4796,"{0} - {1}",this.labelService.getUriLabel(n,{relative:!0}),o??""),this._chatEditsActionsDisposables.add(r.onDidClick(async()=>{d.remove(),await this._attachmentModel.addFile(n),this.relatedFiles?.remove(n)}));const a=this._chatEditsActionsDisposables.add(new zu(e,{supportIcons:!1,secondary:!0,hoverDelegate:i,ariaLabel:h(4797,"Add suggestion {0}",this.labelService.getUriLabel(n,{relative:!0}))}));a.icon=K.add,a.setTitle(h(4798,"Add suggestion")),this._chatEditsActionsDisposables.add(a.onDidClick(async()=>{d.remove(),await this._attachmentModel.addFile(n),this.relatedFiles?.remove(n)}));const c=document.createElement("div");c.classList.add("separator");const d=document.createElement("span");d.classList.add("monaco-button-dropdown","sidebyside-button"),d.appendChild(a.element),d.appendChild(c),d.appendChild(r.element),ee(e,d),this._chatEditsActionsDisposables.add(Ie(()=>{d.remove()}))}this._onDidChangeHeight.fire()}async renderFollowups(e,t){this.options.renderFollowups&&(this.followupsDisposables.clear(),Xi(this.followupsContainer),e&&e.length>0&&this.followupsDisposables.add(this.instantiationService.createInstance(F2,this.followupsContainer,e,this.location,void 0,i=>this._onDidAcceptFollowup.fire({followup:i,response:t}))),this._onDidChangeHeight.fire())}get contentHeight(){const e=this.getLayoutData();return e.followupsHeight+e.inputPartEditorHeight+e.inputPartVerticalPadding+e.inputEditorBorder+e.attachmentsHeight+e.toolbarsHeight+e.chatEditingStateHeight}layout(e,t){return this.cachedDimensions=new Ye(t,e),this._layout(e,t)}_layout(e,t,i=!0){const n=this.getLayoutData(),o=Math.min(n.inputPartEditorHeight,e-n.followupsHeight-n.attachmentsHeight-n.inputPartVerticalPadding-n.toolbarsHeight),r=t-n.inputPartHorizontalPadding;this.followupsContainer.style.width=`${r}px`,this._inputPartHeight=n.inputPartVerticalPadding+n.followupsHeight+o+n.inputEditorBorder+n.attachmentsHeight+n.toolbarsHeight+n.chatEditingStateHeight,this._followupsHeight=n.followupsHeight,this._editSessionWidgetHeight=n.chatEditingStateHeight;const a=this._inputEditor.getScrollWidth(),d={width:t-n.inputPartHorizontalPadding-n.editorBorder-n.inputPartHorizontalPaddingInside-n.toolbarsWidth-n.sideToolbarWidth,height:o};if((!this.previousInputEditorDimension||this.previousInputEditorDimension.width!==d.width||this.previousInputEditorDimension.height!==d.height)&&(this._inputEditor.layout(d),this.previousInputEditorDimension=d),i&&a<10)return this._layout(e,t,!1)}getLayoutData(){const e=this.cachedExecuteToolbarWidth=this.executeToolbar.getItemsWidth(),t=this.cachedInputToolbarWidth=this.inputActionsToolbar.getItemsWidth(),i=(this.executeToolbar.getItemsLength()-1)*4,n=this.inputActionsToolbar.getItemsLength()?(this.inputActionsToolbar.getItemsLength()-1)*4:0;return{inputEditorBorder:2,followupsHeight:this.followupsContainer.offsetHeight,inputPartEditorHeight:Math.min(this._inputEditor.getContentHeight(),this.inputEditorMaxHeight),inputPartHorizontalPadding:this.options.renderStyle==="compact"?16:32,inputPartVerticalPadding:this.options.renderStyle==="compact"?12:28,attachmentsHeight:this.attachmentsHeight,editorBorder:2,inputPartHorizontalPaddingInside:12,toolbarsWidth:this.options.renderStyle==="compact"?e+i+t+n:0,toolbarsHeight:this.options.renderStyle==="compact"?0:22,chatEditingStateHeight:this.chatEditingSessionWidgetContainer.offsetHeight,sideToolbarWidth:this.inputSideToolbarContainer?$a(this.inputSideToolbarContainer)+4:0}}getViewState(){return this.getInputState()}saveState(){this.history.isAtEnd()&&this.saveCurrentValue(this.getInputState());const e=[...this.history];this.historyService.saveHistory(this.location,e)}};yv=gT=f([p(4,bre),p(5,ci),p(6,Z),p(7,fe),p(8,ne),p(9,He),p(10,Nr),p(11,Tw),p(12,Re),p(13,je),p(14,de),p(15,pt),p(16,Ci),p(17,it),p(18,ui),p(19,Rq),p(20,pf),p(21,YN),p(22,noe)],yv);const gJ=s=>JSON.stringify({...s,state:{...s.state,chatMode:void 0}});function pJ(s){return{lineNumber:s.getLineCount(),column:s.getLineLength(s.getLineCount())+1}}let q2=class extends oP{constructor(e,t,i,n,o,r,a,c,d,l){super(e,t,[],"",{...i,getKeyBinding:m=>a.lookupKeybinding(m.id,r)},o,a,c,r,d,l);const u=n.createMenu(N.ChatExecuteSecondary,r),g=()=>{const m=nN(u.getActions({shouldForwardArgs:!0}));this.update(t,m)};g(),this._register(u.onDidChange(()=>g()))}};q2=f([p(3,fn),p(4,bi),p(5,fe),p(6,He),p(7,Dt),p(8,pt),p(9,Nr)],q2);const Mue=".interactive-input-editor";OLe(Mue);class B1e extends Qm{constructor(e,t,i){super(e,t,{...i,icon:!1,label:!0,keybindingNotRenderedWithLabel:!0})}render(e){e.classList.add("chat-attachment-button"),super.render(e)}updateLabel(){yt(this.label);const e=`$(attach) ${this.action.label}`;kh(this.label,...gf(e))}}const V1e=/^@([\w_\-\.]+)(?=(\s|$|\b))/i,H1e=/^#([\w_\-]+)(:\d+)?(?=(\s|$|\b))/i,U1e=/^\/([\w_\-\.:]+)(?=(\s|$|\b))/i;let K2=class{constructor(e,t,i,n){this.agentService=e,this.variableService=t,this.slashCommandService=i,this.promptsService=n}parseChatRequest(e,t,i=$i.Panel,n){const o=[],r=this.variableService.getDynamicVariables(e),a=new Map(this.variableService.getSelectedTools(e).filter(g=>g.canBeReferencedInPrompt&&g.toolReferenceName).map(g=>[g.toolReferenceName,g]));let c=1,d=1;for(let g=0;g<t.length;g++){const m=t.charAt(g-1),v=t.charAt(g);let _;if((m.match(/\s/)||g===0)&&(v===eD?_=this.tryToParseVariable(t.slice(g),g,new we(c,d),o,a):v===LK?_=this.tryToParseAgent(t.slice(g),t,g,new we(c,d),o,i,n):v===lv&&(_=this.tryToParseSlashCommand(t.slice(g),t,g,new we(c,d),o,i,n)),_||(_=this.tryToParseDynamicVariable(t.slice(g),g,new we(c,d),r))),_){if(g!==0){const w=o.at(-1),C=w?.range.endExclusive??0,k=w?.editorRange.endLineNumber??1,D=w?.editorRange.endColumn??1;o.push(new _u(new Hi(C,g),new P(k,D,c,d),t.slice(C,g)))}o.push(_)}v===`
`?(c++,d=1):d++}const l=o.at(-1),u=l?.range.endExclusive??0;return u<t.length&&o.push(new _u(new Hi(u,t.length),new P(l?.editorRange.endLineNumber??1,l?.editorRange.endColumn??1,c,d),t.slice(u,t.length))),{parts:o,text:t}}tryToParseAgent(e,t,i,n,o,r,a){const c=e.match(V1e);if(!c||a?.mode!==void 0&&a.mode!==Rt.Ask)return;const[d,l]=c,u=new Hi(i,i+d.length),g=new P(n.lineNumber,n.column,n.lineNumber,n.column+d.length);let m=this.agentService.getAgentsByName(l);if(!m.length){const k=this.agentService.getAgentByFullyQualifiedId(l);k&&(m=[k])}const v=m.length>1&&a?.selectedAgent?a.selectedAgent:m.find(k=>k.locations.includes(r));if(!v||o.some(k=>k instanceof eh)||o.some(k=>k instanceof _u&&k.text.trim()!==""||!(k instanceof eh)))return;const w=o.at(-1)?.range.endExclusive??0;if(t.slice(w,i).trim()==="")return new eh(u,g,v)}tryToParseVariable(e,t,i,n,o){const r=e.match(H1e);if(!r)return;const[a,c]=r,d=new Hi(t,t+a.length),l=new P(i.lineNumber,i.column,i.lineNumber,i.column+a.length),u=o.get(c);if(u)return new ZE(d,l,c,u.id,u.displayName,u.icon)}tryToParseSlashCommand(e,t,i,n,o,r,a){const c=e.match(U1e);if(!c||o.some(C=>!(C instanceof eh)&&!(C instanceof _u&&C.text.trim()==="")))return;const l=o.at(-1)?.range.endExclusive??0;if(t.slice(l,i).trim()!=="")return;const[g,m]=c,v=new Hi(i,i+g.length),_=new P(n.lineNumber,n.column,n.lineNumber,n.column+g.length),w=o.find(C=>C instanceof eh);if(w){const C=w.agent.slashCommands.find(k=>k.name===m);if(C)return new Ty(v,_,C)}else{const k=this.slashCommandService.getCommands(r,a?.mode??Rt.Ask).find(A=>A.command===m);if(k)return new JE(v,_,k);{const B=this.agentService.getDefaultAgent(r,a?.mode)?.slashCommands.find(q=>q.name===m);if(B)return new Ty(v,_,B)}const D=this.promptsService.asPromptSlashCommand(m);if(D)return new ex(v,_,D)}}tryToParseDynamicVariable(e,t,i,n){const o=n.find(r=>r.range.startLineNumber===i.lineNumber&&r.range.startColumn===i.column);if(o){const r=o.range.endColumn-o.range.startColumn,a=e.substring(0,r),c=new Hi(t,t+r);return new tx(c,o.range,a,o.id,o.modelDescription,o.data,o.fullName,o.icon,o.isFile,o.isDirectory)}}};K2=f([p(0,pf),p(1,Rq),p(2,_re),p(3,zq)],K2);var Er;(function(s){function e(m){return{mime:m.mime,valueBytes:m.data}}s.toNotebookOutputItemDto=e;function t(m){return{outputId:m.outputId,metadata:m.metadata,items:m.outputs.map(e)}}s.toNotebookOutputDto=t;function i(m){return{cellKind:m.cellKind,language:m.language,mime:m.mime,source:m.source,internalMetadata:m.internalMetadata,metadata:m.metadata,outputs:m.outputs.map(t)}}s.toNotebookCellDataDto=i;function n(m){return{metadata:m.metadata,cells:m.cells.map(i)}}s.toNotebookDataDto=n;function o(m){return{mime:m.mime,data:m.valueBytes}}s.fromNotebookOutputItemDto=o;function r(m){return{outputId:m.outputId,metadata:m.metadata,outputs:m.items.map(o)}}s.fromNotebookOutputDto=r;function a(m){return{cellKind:m.cellKind,language:m.language,mime:m.mime,source:m.source,outputs:m.outputs.map(r),metadata:m.metadata,internalMetadata:m.internalMetadata}}s.fromNotebookCellDataDto=a;function c(m){return{metadata:m.metadata,cells:m.cells.map(a)}}s.fromNotebookDataDto=c;function d(m){return{handle:m.handle,uri:m.uri,source:m.textBuffer.getLinesContent(),eol:m.textBuffer.getEOL(),language:m.language,cellKind:m.cellKind,outputs:m.outputs.map(t),metadata:m.metadata,internalMetadata:m.internalMetadata}}s.toNotebookCellDto=d;function l(m){return m.editType===LR.Output?{editType:m.editType,cellHandle:m.cellHandle,append:m.append,outputs:m.outputs.map(r)}:m.editType===LR.OutputItems?{editType:m.editType,append:m.append,outputId:m.outputId,items:m.items.map(o)}:m}s.fromCellExecuteUpdateDto=l;function u(m){return m}s.fromCellExecuteCompleteDto=u;function g(m){return m.editType===sl.Replace?{editType:m.editType,index:m.index,count:m.count,cells:m.cells.map(a)}:m}s.fromCellEditOperationDto=g})(Er||(Er={}));const $1e="workbench.action.chat.addDynamicVariable";class G1e{get onDidAddProgress(){return this._onDidAddProgress.event}constructor(e){this.content=e,this.kind="progressTask",this.deferred=new aa,this._onDidAddProgress=new M,this.progress=[]}task(){return this.deferred.p}isSettled(){return this.deferred.isSettled}complete(e){this.deferred.complete(e)}add(e){this.progress.push(e),this._onDidAddProgress.fire(e)}}let fJ=class extends F{constructor(e,t,i,n,o,r,a,c,d,l){super(),this._chatAgentService=t,this._chatService=i,this._chatEditingService=n,this._languageFeaturesService=o,this._chatWidgetService=r,this._instantiationService=a,this._logService=c,this._extensionService=d,this._uriIdentityService=l,this._agents=this._register(new ti),this._agentCompletionProviders=this._register(new ti),this._agentIdsToCompletionProviders=this._register(new ti),this._chatParticipantDetectionProviders=this._register(new ti),this._chatRelatedFilesProviders=this._register(new ti),this._pendingProgress=new Map,this._responsePartHandlePool=0,this._activeTasks=new Map,this._unresolvedAnchors=new Map,this._proxy=e.getProxy(Ze.ExtHostChatAgents2),this._register(this._chatService.onDidDisposeSession(u=>{this._proxy.$releaseSession(u.sessionId)})),this._register(this._chatService.onDidPerformUserAction(u=>{if(typeof u.agentId=="string"){for(const[g,m]of this._agents)if(m.id===u.agentId){u.action.kind==="vote"?this._proxy.$acceptFeedback(g,u.result??{},u.action):this._proxy.$acceptAction(g,u.result||{},u);break}}}))}$unregisterAgent(e){this._agents.deleteAndDispose(e)}$transferActiveChatSession(e){const t=this._chatWidgetService.lastFocusedWidget,i=t?.viewModel?.model.sessionId;if(!i){this._logService.error("MainThreadChat#$transferActiveChatSession: No active chat session found");return}const n=t?.inputEditor.getValue()??"",o=t.location,r=t.input.currentMode;this._chatService.transferChatSession({sessionId:i,inputValue:n,location:o,mode:r},R.revive(e))}async $registerAgent(e,t,i,n,o){await this._extensionService.whenInstalledExtensionsRegistered();const r=this._chatAgentService.getAgent(i,!0);if(!r&&!o)throw this._chatAgentService.getAgentsByName(i).length?new Error(`chatParticipant must be declared with an ID in package.json. The "id" property may be missing! "${i}"`):new Error(`chatParticipant must be declared in package.json: ${i}`);const a={invoke:async(d,l,u,g)=>{this._pendingProgress.set(d.requestId,l);try{return await this._proxy.$invokeAgent(e,d,{history:u},g)??{}}finally{this._pendingProgress.delete(d.requestId)}},setRequestPaused:(d,l)=>{this._proxy.$setRequestPaused(e,d,l)},provideFollowups:async(d,l,u,g)=>this._agents.get(e)?.hasFollowups?this._proxy.$provideFollowups(d,e,l,{history:u},g):[],provideChatTitle:(d,l)=>this._proxy.$provideChatTitle(e,d,l),provideSampleQuestions:(d,l)=>this._proxy.$provideSampleQuestions(e,d,l)};let c;if(!r&&o){const d=this._extensionService.extensions.find(l=>vs.equals(l.identifier,t));c=this._chatAgentService.registerDynamicAgent({id:i,name:o.name,description:o.description,extensionId:t,extensionDisplayName:d?.displayName??t.value,extensionPublisherId:d?.publisher??"",publisherDisplayName:o.publisherName,fullName:o.fullName,metadata:gn(n),slashCommands:[],disambiguation:[],locations:[$i.Panel],modes:[Rt.Ask]},a)}else c=this._chatAgentService.registerAgentImplementation(i,a);this._agents.set(e,{id:i,extensionId:t,dispose:c.dispose,hasFollowups:n.hasFollowups})}async $updateAgent(e,t){await this._extensionService.whenInstalledExtensionsRegistered();const i=this._agents.get(e);if(!i){this._logService.error(`MainThreadChatAgents2#$updateAgent: No agent with handle ${e} registered`);return}i.hasFollowups=t.hasFollowups,this._chatAgentService.updateAgent(i.id,gn(t))}async $handleProgressChunk(e,t,i){const n=t.kind==="notebookEdit"?j2.fromChatEdit(gn(t)):gn(t);if((n.kind==="notebookEdit"||n.kind==="textEdit"||n.kind==="codeblockUri")&&(n.uri=this._uriIdentityService.asCanonicalUri(n.uri)),n.kind==="progressTask"){const o=++this._responsePartHandlePool,r=`${e}_${o}`,a=new G1e(n.content);return this._activeTasks.set(r,a),this._pendingProgress.get(e)?.(a),o}else if(i!==void 0){const o=`${e}_${i}`,r=this._activeTasks.get(o);switch(n.kind){case"progressTaskResult":return r&&n.content?(r.complete(n.content.value),this._activeTasks.delete(o)):r?.complete(void 0),i;case"warning":case"reference":r?.add(n);return}}n.kind==="inlineReference"&&n.resolveId&&(this._unresolvedAnchors.has(e)||this._unresolvedAnchors.set(e,new Map),this._unresolvedAnchors.get(e)?.set(n.resolveId,n)),this._pendingProgress.get(e)?.(n)}$handleAnchorResolve(e,t,i){const n=this._unresolvedAnchors.get(e)?.get(t);if(n&&(this._unresolvedAnchors.get(e)?.delete(t),i)){const o=gn(i);n.inlineReference=o.inlineReference}}$registerAgentCompletionsProvider(e,t,i){const n=async(o,r)=>(await this._proxy.$invokeCompletionProvider(e,o,r)).map(c=>({...c,icon:c.icon?ke.fromId(c.icon):void 0}));this._agentIdsToCompletionProviders.set(t,this._chatAgentService.registerAgentCompletionProvider(t,n)),this._agentCompletionProviders.set(e,this._languageFeaturesService.completionProvider.register({scheme:yv.INPUT_SCHEME,hasAccessToAllModels:!0},{_debugDisplayName:"chatAgentCompletions:"+e,triggerCharacters:i,provideCompletionItems:async(o,r,a,c)=>{const d=this._chatWidgetService.getWidgetByInputUri(o.uri);if(!d||!d.viewModel)return;const l=i.map(D=>dy(D)).join(""),u=new RegExp(`[${l}]\\S*`,"g"),g=Xne(r.column,u,o.getLineContent(r.lineNumber),0)?.word??"";if(g&&!i.some(D=>g.startsWith(D)))return;const v=this._instantiationService.createInstance(K2).parseChatRequest(d.viewModel.sessionId,o.getValue()).parts.find(D=>D instanceof eh),_=this._agents.get(e)?.id;if(v?.agent.id!==_)return;const w=z1e(o,r,u);return w?{suggestions:(await n(g,c)).map(D=>{const A=D.insertText??(typeof D.label=="string"?D.label:D.label.label),B=new P(w.insert.startLineNumber,w.insert.startColumn,w.insert.endLineNumber,w.insert.startColumn+A.length);return{label:D.label,range:w,insertText:A+" ",kind:De.Text,detail:D.detail,documentation:D.documentation,command:{id:$1e,title:"",arguments:[{id:D.id,widget:d,range:B,variableData:gn(D.value),command:D.command}]}}})}:null}}))}$unregisterAgentCompletionsProvider(e,t){this._agentCompletionProviders.deleteAndDispose(e),this._agentIdsToCompletionProviders.deleteAndDispose(t)}$registerChatParticipantDetectionProvider(e){this._chatParticipantDetectionProviders.set(e,this._chatAgentService.registerChatParticipantDetectionProvider(e,{provideParticipantDetection:async(t,i,n,o)=>await this._proxy.$detectChatParticipant(e,t,{history:i},n,o)}))}$unregisterChatParticipantDetectionProvider(e){this._chatParticipantDetectionProviders.deleteAndDispose(e)}$registerRelatedFilesProvider(e,t){this._chatRelatedFilesProviders.set(e,this._chatEditingService.registerRelatedFilesProvider(e,{description:t.description,provideRelatedFiles:async(i,n)=>(await this._proxy.$provideRelatedFiles(e,i,n))?.map(o=>({uri:R.from(o.uri),description:o.description}))??[]}))}$unregisterRelatedFilesProvider(e){this._chatRelatedFilesProviders.deleteAndDispose(e)}};fJ=f([ht(qe.MainThreadChatAgents2),p(1,pf),p(2,ff),p(3,ug),p(4,Ne),p(5,Ho),p(6,Z),p(7,Re),p(8,cn),p(9,nn)],fJ);function z1e(s,e,t){const i=Xne(e.column,t,s.getLineContent(e.lineNumber),0);if(!i&&s.getWordUntilPosition(e).word)return;let n,o;return i?(n=new P(e.lineNumber,i.startColumn,e.lineNumber,e.column),o=new P(e.lineNumber,i.startColumn,e.lineNumber,i.endColumn)):n=o=P.fromPositions(e),{insert:n,replace:o}}var j2;(function(s){function e(t){return{kind:"notebookEdit",uri:t.uri,done:t.done,edits:t.edits.map(Er.fromCellEditOperationDto)}}s.fromChatEdit=e})(j2||(j2={}));var Y2;let mJ=class extends F{static{Y2=this}static{this._requestHandlePool=0}constructor(e,t){super(),this.codeMapperService=t,this.providers=this._register(new ti),this._responseMap=new Map,this._proxy=e.getProxy(Ze.ExtHostCodeMapper)}$registerCodeMapperProvider(e,t){const i={displayName:t,mapCode:async(o,r,a)=>{const c=String(Y2._requestHandlePool++);this._responseMap.set(c,r);const d={requestId:c,codeBlocks:o.codeBlocks,chatRequestId:o.chatRequestId,chatRequestModel:o.chatRequestModel,chatSessionId:o.chatSessionId,location:o.location};try{return await this._proxy.$mapCode(e,d,a).then(l=>l??void 0)}finally{this._responseMap.delete(c)}}},n=this.codeMapperService.registerCodeMapperProvider(e,i);this.providers.set(e,n)}$unregisterCodeMapperProvider(e){this.providers.deleteAndDispose(e)}$handleProgress(e,t){const i=this._responseMap.get(e);if(i){const n=t.edits,o=R.revive(t.uri);n.length?n.every(tne.isTextEdit)?i.textEdit(o,n):i.notebookEdit(o,n.map(Er.fromCellEditOperationDto)):i.textEdit(o,[])}return Promise.resolve()}};mJ=Y2=f([ht(qe.MainThreadCodeMapper),p(1,vre)],mJ);let vJ=class extends F{constructor(e,t){super(),this._languageModelToolsService=t,this._tools=this._register(new ti),this._runningToolCalls=new Map,this._proxy=e.getProxy(Ze.ExtHostLanguageModelTools),this._register(this._languageModelToolsService.onDidChangeTools(i=>this._proxy.$onDidChangeTools([...this._languageModelToolsService.getTools()])))}async $getTools(){return Array.from(this._languageModelToolsService.getTools())}async $invokeTool(e,t){const i=await this._languageModelToolsService.invokeTool(e,(o,r)=>this._proxy.$countTokensForInvocation(e.callId,o,r),t??Ce.None),n={content:i.content};return pAe(i)?new ta(n):n}$acceptToolProgress(e,t){this._runningToolCalls.get(e)?.progress.report(t)}$countTokensForInvocation(e,t,i){const n=this._runningToolCalls.get(e);if(!n)throw new Error(`Tool invocation call ${e} not found`);return n.countTokens(t,i)}$registerTool(e){const t=this._languageModelToolsService.registerToolImplementation(e,{invoke:async(i,n,o,r)=>{try{this._runningToolCalls.set(i.callId,{countTokens:n,progress:o});const a=await this._proxy.$invokeTool(i,r),c=a instanceof ta?a.value:a;return gn(c)}finally{this._runningToolCalls.delete(i.callId)}},prepareToolInvocation:(i,n)=>this._proxy.$prepareToolInvocation(e,i,n)});this._tools.set(e,t)}$unregisterTool(e){this._tools.deleteAndDispose(e)}};vJ=f([ht(qe.MainThreadLanguageModelTools),p(1,kw)],vJ);const Nue=J("embeddingsService");class q1e{constructor(){this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this.providers=new Map}get allProviders(){return this.providers.keys()}registerProvider(e,t){return this.providers.set(e,t),this._onDidChange.fire(),{dispose:()=>{this.providers.delete(e),this._onDidChange.fire()}}}computeEmbeddings(e,t,i){const n=this.providers.get(e);return n?n.provideEmbeddings(t,i):Promise.reject(new Error(`No embeddings provider registered with id: ${e}`))}}G(Nue,q1e,z.Delayed);let _J=class{constructor(e,t){this.embeddingsService=t,this._store=new U,this._providers=this._store.add(new ti),this._proxy=e.getProxy(Ze.ExtHostEmbeddings),this._store.add(t.onDidChange(()=>{this._proxy.$acceptEmbeddingModels(Array.from(t.allProviders))}))}dispose(){this._store.dispose()}$registerEmbeddingProvider(e,t){const i=this.embeddingsService.registerProvider(t,{provideEmbeddings:(n,o)=>this._proxy.$provideEmbeddings(e,n,o)});this._providers.set(e,i)}$unregisterEmbeddingProvider(e){this._providers.deleteAndDispose(e)}$computeEmbeddings(e,t,i){return this.embeddingsService.computeEmbeddings(e,t,i)}};_J=f([ht(qe.MainThreadEmbeddings),p(1,Nue)],_J);var Q2;let X2=class extends F{static{Q2=this}static{this.standardSupportedLinkSchemes=new Set([ae.http,ae.https,ae.mailto,ae.vscode,"vscode-insider"])}constructor(e,t,i){super(),this._openerService=t,this._productService=i,this._webviews=new Map,this._proxy=e.getProxy(Ze.ExtHostWebviews)}addWebview(e,t,i){if(this._webviews.has(e))throw new Error("Webview already registered");this._webviews.set(e,t),this.hookupWebviewEventDelegate(e,t,i)}$setHtml(e,t){this.tryGetWebview(e)?.setHtml(t)}$setOptions(e,t){const i=this.tryGetWebview(e);i&&(i.contentOptions=lL(t))}async $postMessage(e,t,...i){const n=this.tryGetWebview(e);if(!n)return!1;const{message:o,arrayBuffers:r}=gAe(t,i);return n.postMessage(o,r)}hookupWebviewEventDelegate(e,t,i){const n=new U;n.add(t.onDidClickLink(o=>this.onDidClickLink(e,o))),n.add(t.onMessage(o=>{const r=hAe(o.message,i);this._proxy.$onMessage(e,r.message,new ta(r.buffers))})),n.add(t.onMissingCsp(o=>this._proxy.$onMissingCsp(e,o.value))),n.add(t.onDidDispose(()=>{n.dispose(),this._webviews.delete(e)}))}onDidClickLink(e,t){const i=this.getWebview(e);this.isSupportedLink(i,R.parse(t))&&this._openerService.open(t,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:Array.isArray(i.contentOptions.enableCommandUris)||i.contentOptions.enableCommandUris===!0,fromWorkspace:!0})}isSupportedLink(e,t){return Q2.standardSupportedLinkSchemes.has(t.scheme)||!Kt&&this._productService.urlProtocol===t.scheme?!0:t.scheme===ae.command?Array.isArray(e.contentOptions.enableCommandUris)?e.contentOptions.enableCommandUris.includes(t.path):e.contentOptions.enableCommandUris===!0:!1}tryGetWebview(e){return this._webviews.get(e)}getWebview(e){const t=this.tryGetWebview(e);if(!t)throw new Error(`Unknown webview handle:${e}`);return t}getWebviewResolvedFailedContent(e){return`<!DOCTYPE html>
		<html>
			<head>
				<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
				<meta http-equiv="Content-Security-Policy" content="default-src 'none';">
			</head>
			<body>${h(2441,"An error occurred while loading view: {0}",jz(e))}</body>
		</html>`}};X2=Q2=f([p(1,mi),p(2,Vn)],X2);function dL(s){return{id:s.id,location:R.revive(s.location)}}function lL(s){return{allowScripts:s.enableScripts,allowForms:s.enableForms,enableCommandUris:s.enableCommandUris,localResourceRoots:Array.isArray(s.localResourceRoots)?s.localResourceRoots.map(e=>R.revive(e)):void 0,portMapping:s.portMapping}}class K1e{constructor(e,t,i,n){this.editor=e,this.line=t,this.height=i,this.webview=n,this.domNode=document.createElement("div"),this.domNode.style.zIndex="10",this.afterLineNumber=t,this.afterColumn=1,this.heightInLines=i,e.changeViewZones(o=>this._id=o.addZone(this)),n.mountTo(this.domNode,Et(e.getDomNode()))}dispose(){this.editor.changeViewZones(e=>this._id&&e.removeZone(this._id))}}let bJ=class{constructor(e,t,i){this._editorService=t,this._webviewService=i,this._disposables=new U,this._insets=new Map,this._proxy=e.getProxy(Ze.ExtHostEditorInsets)}dispose(){this._disposables.dispose()}async $createEditorInset(e,t,i,n,o,r,a,c){let d;t=t.substr(0,t.indexOf(","));for(const v of this._editorService.listCodeEditors())if(v.getId()===t&&v.hasModel()&&At(v.getModel().uri,R.revive(i))){d=v;break}if(!d){setTimeout(()=>this._proxy.$onDidDispose(e));return}const l=new U,u=this._webviewService.createWebviewElement({title:void 0,options:{enableFindWidget:!1},contentOptions:lL(r),extension:{id:a,location:R.revive(c)}}),g=new K1e(d,n,o,u),m=()=>{l.dispose(),this._proxy.$onDidDispose(e),this._insets.delete(e)};l.add(d.onDidChangeModel(m)),l.add(d.onDidDispose(m)),l.add(g),l.add(u),l.add(u.onMessage(v=>this._proxy.$onDidReceiveMessage(e,v.message))),this._insets.set(e,g)}$disposeEditorInset(e){const t=this.getInset(e);this._insets.delete(e),t.dispose()}$setHtml(e,t){this.getInset(e).webview.setHtml(t)}$setOptions(e,t){const i=this.getInset(e);i.webview.contentOptions=lL(t)}async $postMessage(e,t){return this.getInset(e).webview.postMessage(t),!0}getInset(e){const t=this._insets.get(e);if(!t)throw new Error("Unknown inset");return t}};bJ=f([ht(qe.MainThreadEditorInsets),p(1,Bt),p(2,ON)],bJ);const j1e=s=>h(1787,"Extension '{0}' not found.",s),yJ=h(1788,"Make sure you use the full extension ID, including the publisher, e.g.: {0}","ms-dotnettools.csharp");let Z2=class{constructor(e,t,i){this.logger=e,this.extensionManagementService=t,this.extensionGalleryService=i}get location(){}async listExtensions(e,t,i){let n=await this.extensionManagementService.getInstalled(Fn.User,i);const o=ebe.map(a=>a.toLowerCase());if(t&&t!==""){if(o.indexOf(t.toLowerCase())<0){this.logger.info("Invalid category please enter a valid category. To list valid categories run --category without a category specified");return}n=n.filter(a=>a.manifest.categories?a.manifest.categories.map(d=>d.toLowerCase()).indexOf(t.toLowerCase())>-1:!1)}else if(t===""){this.logger.info("Possible Categories: "),o.forEach(a=>{this.logger.info(a)});return}this.location&&this.logger.info(h(1789,"Extensions installed on {0}:",this.location)),n=n.sort((a,c)=>a.identifier.id.localeCompare(c.identifier.id));let r;for(const a of n)r!==a.identifier.id&&(r=a.identifier.id,this.logger.info(e?`${r}@${a.manifest.version}`:r))}async installExtensions(e,t,i,n){const o=[];try{e.length&&this.logger.info(this.location?h(1790,"Installing extensions on {0}...",this.location):h(1791,"Installing extensions..."));const r=[],a=[],c=(l,u,g)=>{a.push({id:l,version:u!=="prerelease"?u:void 0,installOptions:{...i,isBuiltin:g,installPreReleaseVersion:u==="prerelease"||i.installPreReleaseVersion}})};for(const l of e)if(l instanceof R)r.push({vsix:l,installOptions:i});else{const[u,g]=J6(l);c(u,g,!1)}for(const l of t)if(l instanceof R)r.push({vsix:l,installOptions:{...i,isBuiltin:!0,donotIncludePackAndDependencies:!0}});else{const[u,g]=J6(l);c(u,g,!0)}const d=await this.extensionManagementService.getInstalled(void 0,i.profileLocation);if(r.length&&await Promise.all(r.map(async({vsix:l,installOptions:u})=>{try{await this.installVSIX(l,u,n,d)}catch(g){this.logger.error(g),o.push(l.toString())}})),a.length){const l=await this.installGalleryExtensions(a,d,n);o.push(...l)}}catch(r){throw this.logger.error(h(1792,"Error while installing extensions: {0}",ya(r))),r}if(o.length)throw new Error(h(1793,"Failed Installing Extensions: {0}",o.join(", ")))}async updateExtensions(e){const t=await this.extensionManagementService.getInstalled(Fn.User,e),i=[];for(const a of t)a.identifier.uuid&&i.push({...a.identifier,preRelease:a.preRelease});this.logger.trace(h(1794,"Fetching latest versions for {0} extensions",i.length));const n=await this.extensionGalleryService.getExtensions(i,{compatible:!0},Ce.None),o=[];for(const a of n)for(const c of t)ja(c.identifier,a.identifier)&&By.gt(a.version,c.manifest.version)&&o.push({extension:a,options:{operation:rne.Update,installPreReleaseVersion:c.preRelease,profileLocation:e,isApplicationScoped:c.isApplicationScoped}});if(!o.length){this.logger.info(h(1795,"No extension to update"));return}this.logger.info(h(1796,"Updating extensions: {0}",o.map(a=>a.extension.identifier.id).join(", ")));const r=await this.extensionManagementService.installGalleryExtensions(o);for(const a of r)a.error?this.logger.error(h(1797,"Error while updating extension {0}: {1}",a.identifier.id,ya(a.error))):this.logger.info(h(1798,"Extension '{0}' v{1} was successfully updated.",a.identifier.id,a.local?.manifest.version))}async installGalleryExtensions(e,t,i){if(e=e.filter(a=>{const{id:c,version:d,installOptions:l}=a,u=t.find(g=>ja(g.identifier,{id:c}));if(u){if(!i&&(!d||d==="prerelease"&&u.preRelease))return this.logger.info(h(1799,"Extension '{0}' v{1} is already installed. Use '--force' option to update to latest version or provide '@<version>' to install a specific version, for example: '{2}@1.2.3'.",c,u.manifest.version,c)),!1;if(d&&u.manifest.version===d)return this.logger.info(h(1800,"Extension '{0}' is already installed.",`${c}@${d}`)),!1;u.preRelease&&d!=="prerelease"&&(l.preRelease=!1)}return!0}),!e.length)return[];const n=[],o=[],r=await this.getGalleryExtensions(e);if(await Promise.all(e.map(async({id:a,version:c,installOptions:d})=>{const l=r.get(a.toLowerCase());if(!l){this.logger.error(`${j1e(c?`${a}@${c}`:a)}
${yJ}`),n.push(a);return}try{const g=await this.extensionGalleryService.getManifest(l,Ce.None);if(g&&!this.validateExtensionKind(g))return}catch(g){this.logger.error(g.message||g.stack||g),n.push(a);return}const u=t.find(g=>ja(g.identifier,l.identifier));if(u){if(l.version===u.manifest.version){this.logger.info(h(1800,"Extension '{0}' is already installed.",c?`${a}@${c}`:a));return}this.logger.info(h(1801,"Updating the extension '{0}' to the version {1}",a,l.version))}d.isBuiltin?this.logger.info(c?h(1802,"Installing builtin extension '{0}' v{1}...",a,c):h(1803,"Installing builtin extension '{0}'...",a)):this.logger.info(c?h(1804,"Installing extension '{0}' v{1}...",a,c):h(1805,"Installing extension '{0}'...",a)),o.push({extension:l,options:{...d,installGivenVersion:!!c,isApplicationScoped:d.isApplicationScoped||u?.isApplicationScoped}})})),o.length){const a=await this.extensionManagementService.installGalleryExtensions(o);for(const c of a)c.error?(this.logger.error(h(1806,"Error while installing extension {0}: {1}",c.identifier.id,ya(c.error))),n.push(c.identifier.id)):this.logger.info(h(1807,"Extension '{0}' v{1} was successfully installed.",c.identifier.id,c.local?.manifest.version))}return n}async installVSIX(e,t,i,n){const o=await this.extensionManagementService.getManifest(e);if(!o)throw new Error("Invalid vsix");if(await this.validateVSIX(o,i,t.profileLocation,n))try{await this.extensionManagementService.install(e,{...t,installGivenVersion:!0}),this.logger.info(h(1808,"Extension '{0}' was successfully installed.",Qe(e)))}catch(a){if(ys(a))this.logger.info(h(1809,"Cancelled installing extension '{0}'.",Qe(e)));else throw a}}async getGalleryExtensions(e){const t=new Map,i=e.some(r=>r.installOptions.installPreReleaseVersion),n=await this.extensionManagementService.getTargetPlatform(),o=[];for(const r of e)tbe.test(r.id)&&o.push({...r,preRelease:i});if(o.length){const r=await this.extensionGalleryService.getExtensions(o,{targetPlatform:n},Ce.None);for(const a of r)t.set(a.identifier.id.toLowerCase(),a)}return t}validateExtensionKind(e){return!0}async validateVSIX(e,t,i,n){if(!t){const o={id:nu(e.publisher,e.name)},r=n.find(a=>ja(o,a.identifier)&&By.gt(a.manifest.version,e.version));if(r)return this.logger.info(h(1810,"A newer version of extension '{0}' v{1} is already installed. Use '--force' option to downgrade to older version.",r.identifier.id,r.manifest.version,e.version)),!1}return this.validateExtensionKind(e)}async uninstallExtensions(e,t,i){const n=async o=>{if(o instanceof R){const r=await this.extensionManagementService.getManifest(o);return Pz(r.publisher,r.name)}return o};for(const o of e){const r=await n(o),c=(await this.extensionManagementService.getInstalled(void 0,i)).filter(d=>ja(d.identifier,{id:r}));if(!c.length)throw new Error(`${this.notInstalled(r)}
${yJ}`);if(c.some(d=>d.type===Fn.System)){this.logger.info(h(1811,"Extension '{0}' is a Built-in extension and cannot be uninstalled",r));return}if(!t&&c.some(d=>d.isBuiltin)){this.logger.info(h(1812,"Extension '{0}' is marked as a Built-in extension by user. Please use '--force' option to uninstall it.",r));return}this.logger.info(h(1813,"Uninstalling {0}...",r));for(const d of c)await this.extensionManagementService.uninstall(d,{profileLocation:i});this.location?this.logger.info(h(1814,"Extension '{0}' was successfully uninstalled from {1}!",r,this.location)):this.logger.info(h(1815,"Extension '{0}' was successfully uninstalled!",r))}}async locateExtension(e){const t=await this.extensionManagementService.getInstalled();e.forEach(i=>{t.forEach(n=>{if(n.identifier.id===i&&n.location.scheme===ae.file){this.logger.info(n.location.fsPath);return}})})}notInstalled(e){return this.location?h(1816,"Extension '{0}' is not installed on {1}.",e,this.location):h(1817,"Extension '{0}' is not installed.",e)}};Z2=f([p(1,CI),p(2,yq)],Z2);Ee.registerCommand("_remoteCLI.openExternal",function(s,e){return s.get(mi).open(Tt(e)?e:R.revive(e),{openExternal:!0,allowTunneling:!0})});Ee.registerCommand("_remoteCLI.windowOpen",function(s,e,t){const i=s.get(Ge);return e.length?i.executeCommand("_files.windowOpen",e,t):i.executeCommand("_files.newWindow",t)});Ee.registerCommand("_remoteCLI.getSystemStatus",function(s){return s.get(Ge).executeCommand("_issues.getSystemStatus")});Ee.registerCommand("_remoteCLI.manageExtensions",async function(s,e){const t=s.get(Z),n=s.get(Xre).remoteExtensionManagementServer?.extensionManagementService;if(!n)return;const o=[],r=new class extends ibe{log(c,d){o.push(d)}},a=t.createChild(new uf([CI,n]));try{const c=a.createInstance(J2,r);if(e.list)await c.listExtensions(!!e.list.showVersions,e.list.category,void 0);else{const d=l=>l.map(u=>Tt(u)?u:R.revive(u));if(Array.isArray(e.install)&&e.install.length)try{await c.installExtensions(d(e.install),[],{isMachineScoped:!0},!!e.force)}catch(l){o.push(l.message)}if(Array.isArray(e.uninstall)&&e.uninstall.length)try{await c.uninstallExtensions(d(e.uninstall),!!e.force,void 0)}catch(l){o.push(l.message)}}return o.join(`
`)}finally{a.dispose()}});let J2=class extends Z2{constructor(e,t,i,n,o,r){super(e,t,i),this._extensionManifestPropertiesService=r;const a=o.remoteAuthority;this._location=a?n.getHostLabel(ae.vscodeRemote,a):void 0}get location(){return this._location}validateExtensionKind(e){return!this._extensionManifestPropertiesService.canExecuteOnWorkspace(e)&&!(Kt&&this._extensionManifestPropertiesService.canExecuteOnWeb(e))?(this.logger.info(h(2391,"Cannot install the '{0}' extension because it is declared to not run in this setup.",Pz(e.publisher,e.name))),!1):!0}};J2=f([p(1,CI),p(2,yq),p(3,ui),p(4,wn),p(5,Kv)],J2);let wJ=class{constructor(e,t){this._clipboardService=t}dispose(){}$readText(){return this._clipboardService.readText()}$writeText(e){return this._clipboardService.writeText(e)}};wJ=f([ht(qe.MainThreadClipboard),p(1,Vs)],wJ);let SJ=class{constructor(e,t,i){this._commandService=t,this._extensionService=i,this._commandRegistrations=new ti,this._proxy=e.getProxy(Ze.ExtHostCommands),this._generateCommandsDocumentationRegistration=Ee.registerCommand("_generateCommandsDocumentation",()=>this._generateCommandsDocumentation())}dispose(){this._commandRegistrations.dispose(),this._generateCommandsDocumentationRegistration.dispose()}async _generateCommandsDocumentation(){const e=await this._proxy.$getContributedCommandMetadata(),t=Ee.getCommands();for(const[n,o]of t)o.metadata&&(e[n]=o.metadata);const i=[];for(const n in e)i.push("`"+n+"` - "+Y1e(e[n]));console.log(i.join(`
`))}$registerCommand(e){this._commandRegistrations.set(e,Ee.registerCommand(e,(t,...i)=>this._proxy.$executeContributedCommand(e,...i).then(n=>gn(n))))}$unregisterCommand(e){this._commandRegistrations.deleteAndDispose(e)}$fireCommandActivationEvent(e){const t=`onCommand:${e}`;this._extensionService.activationEventIsDone(t)||this._extensionService.activateByEvent(t)}async $executeCommand(e,t,i){t instanceof ta&&(t=t.value);for(let n=0;n<t.length;n++)t[n]=gn(t[n]);if(i&&t.length>0&&!Ee.getCommand(e))throw await this._extensionService.activateByEvent(`onCommand:${e}`),new Error("$executeCommand:retry");return this._commandService.executeCommand(e,...t)}$getCommands(){return Promise.resolve([...Ee.getCommands().keys()])}};SJ=f([ht(qe.MainThreadCommands),p(1,Ge),p(2,cn)],SJ);function Y1e(s){if(typeof s=="string")return s;{const t=[Tt(s.description)?s.description:s.description.original];if(t.push(`

`),s.args)for(const i of s.args)t.push(`* _${i.name}_ - ${i.description||""}
`);return s.returns&&t.push(`* _(returns)_ - ${s.returns}`),t.push(`

`),t.join("")}}let CJ=class{constructor(e,t,i,n){this._workspaceContextService=t,this.configurationService=i,this._environmentService=n;const o=e.getProxy(Ze.ExtHostConfiguration);o.$initializeConfiguration(this._getConfigurationData()),this._configurationListener=i.onDidChangeConfiguration(r=>{o.$acceptConfigurationChanged(this._getConfigurationData(),r.change)})}_getConfigurationData(){const e={...this.configurationService.getConfigurationData(),configurationScopes:[]};return(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment)&&(e.configurationScopes=nbe()),e}dispose(){this._configurationListener.dispose()}$updateConfigurationOption(e,t,i,n,o){return n={resource:n?.resource?R.revive(n.resource):void 0,overrideIdentifier:n?.overrideIdentifier},this.writeConfiguration(e,t,i,n,o)}$removeConfigurationOption(e,t,i,n){return i={resource:i?.resource?R.revive(i.resource):void 0,overrideIdentifier:i?.overrideIdentifier},this.writeConfiguration(e,t,void 0,i,n)}writeConfiguration(e,t,i,n,o){e=e??this.deriveConfigurationTarget(t,n);const r=this.configurationService.inspect(t,n);switch(e){case us.MEMORY:return this._updateValue(t,i,e,r?.memory?.override,n,o);case us.WORKSPACE_FOLDER:return this._updateValue(t,i,e,r?.workspaceFolder?.override,n,o);case us.WORKSPACE:return this._updateValue(t,i,e,r?.workspace?.override,n,o);case us.USER_REMOTE:return this._updateValue(t,i,e,r?.userRemote?.override,n,o);default:return this._updateValue(t,i,e,r?.userLocal?.override,n,o)}}_updateValue(e,t,i,n,o,r){return o=r===!0?o:r===!1?{resource:o.resource}:o.overrideIdentifier&&n!==void 0?o:{resource:o.resource},this.configurationService.updateValue(e,t,o,i,{donotNotifyError:!0})}deriveConfigurationTarget(e,t){if(t.resource&&this._workspaceContextService.getWorkbenchState()===Zo.WORKSPACE){const i=Ke.as(Js.Configuration).getConfigurationProperties();if(i[e]&&(i[e].scope===Ht.RESOURCE||i[e].scope===Ht.LANGUAGE_OVERRIDABLE))return us.WORKSPACE_FOLDER}return us.WORKSPACE}};CJ=f([ht(qe.MainThreadConfiguration),p(1,It),p(2,ne),p(3,Hs)],CJ);function J4(s){const e=[];let t;try{const i=JSON.parse(s.arguments),n=i[i.length-1];n&&n.__$stack&&(i.pop(),t=n.__$stack),e.push(...i)}catch{e.push("Unable to log remote console arguments",s.arguments)}return{args:e,stack:t}}function Q1e(s){if(!s)return s;const e=s.indexOf(`
`);return e===-1?s:s.substring(0,e)}function X1e(s,e){const{args:t,stack:i}=J4(s),n=typeof t[0]=="string"&&t.length===1;let o=Q1e(i);o&&(o=`(${o.trim()})`);let r=[];if(typeof t[0]=="string"?o&&n?r=[`%c[${e}] %c${t[0]} %c${o}`,C_("blue"),C_(""),C_("grey")]:r=[`%c[${e}] %c${t[0]}`,C_("blue"),C_(""),...t.slice(1)]:r=[`%c[${e}]%`,C_("blue"),...t],o&&!n&&r.push(o),typeof console[s.severity]!="function")throw new Error("Unknown console method");console[s.severity].apply(console,r)}function C_(s){return`color: ${s}`}function Z1e(s,e,t=null){const i=J4(e).args;let n=i.shift();if(typeof n=="string")switch(e.severity||(e.severity="info"),t&&(/^\[/.test(t)||(t=`[${t}]`),/ $/.test(t)||(t=`${t} `),n=t+n),e.severity){case"log":case"info":s.info(n,...i);break;case"warn":s.warn(n,...i);break;case"error":s.error(n,...i);break}}function J1e(s,e,t){const i=J4(e).args,n=i.shift();typeof n!="string"||e.severity!=="error"||(/^\[/.test(t)||(t=`[${t}]`),/ $/.test(t)||(t=`${t} `),s.error(t+n,...i))}let EJ=class{constructor(e,t,i){this._environmentService=t,this._logService=i;const n=VK(this._environmentService);this._isExtensionDevTestFromCli=n.isExtensionDevTestFromCli}dispose(){}$logExtensionHostMessage(e){this._isExtensionDevTestFromCli?Z1e(this._logService,e):(J1e(this._logService,e,"Extension Host"),X1e(e,"Extension Host"))}};EJ=f([ht(qe.MainThreadConsole),p(1,Hs),p(2,Re)],EJ);let xJ=class{constructor(e,t,i){this.debugService=t,this.visualizerService=i,this._toDispose=new U,this._debugAdaptersHandleCounter=1,this._visualizerHandles=new Map,this._visualizerTreeHandles=new Map,this._proxy=e.getProxy(Ze.ExtHostDebugService);const n=new ti;this._toDispose.add(n),this._toDispose.add(t.onDidNewSession(r=>{this._proxy.$acceptDebugSessionStarted(this.getSessionDto(r)),n.get(r)?.add(r.onDidChangeName(c=>{this._proxy.$acceptDebugSessionNameChanged(this.getSessionDto(r),c)}))})),this._toDispose.add(t.onWillNewSession(r=>{let a=n.get(r);a||(a=new U,n.set(r,a)),a.add(r.onDidCustomEvent(c=>this._proxy.$acceptDebugSessionCustomEvent(this.getSessionDto(r),c)))})),this._toDispose.add(t.onDidEndSession(({session:r,restart:a})=>{this._proxy.$acceptDebugSessionTerminated(this.getSessionDto(r)),this._extHostKnownSessions.delete(r.getId()),a||n.deleteAndDispose(r);for(const[c,d]of this._debugAdapters)d.session===r&&this._debugAdapters.delete(c)})),this._toDispose.add(t.getViewModel().onDidFocusSession(r=>{this._proxy.$acceptDebugSessionActiveChanged(this.getSessionDto(r))})),this._toDispose.add(Ie(()=>{for(const[r,a]of this._debugAdapters)a.fireError(r,new Error("Extension host shut down"))})),this._debugAdapters=new Map,this._debugConfigurationProviders=new Map,this._debugAdapterDescriptorFactories=new Map,this._extHostKnownSessions=new Set;const o=this.debugService.getViewModel();this._toDispose.add(T.any(o.onDidFocusStackFrame,o.onDidFocusThread)(()=>{const r=o.focusedStackFrame,a=o.focusedThread;r?this._proxy.$acceptStackFrameFocus({kind:"stackFrame",threadId:r.thread.threadId,frameId:r.frameId,sessionId:r.thread.session.getId()}):a?this._proxy.$acceptStackFrameFocus({kind:"thread",threadId:a.threadId,sessionId:a.session.getId()}):this._proxy.$acceptStackFrameFocus(void 0)})),this.sendBreakpointsAndListen()}$registerDebugVisualizerTree(e,t){this._visualizerTreeHandles.set(e,this.visualizerService.registerTree(e,{disposeItem:i=>this._proxy.$disposeVisualizedTree(i),getChildren:i=>this._proxy.$getVisualizerTreeItemChildren(e,i),getTreeItem:i=>this._proxy.$getVisualizerTreeItem(e,i),editItem:t?(i,n)=>this._proxy.$editVisualizerTreeItem(i,n):void 0}))}$unregisterDebugVisualizerTree(e){this._visualizerTreeHandles.get(e)?.dispose(),this._visualizerTreeHandles.delete(e)}$registerDebugVisualizer(e,t){const i=this.visualizerService.register({extensionId:new vs(e),id:t,disposeDebugVisualizers:n=>this._proxy.$disposeDebugVisualizers(n),executeDebugVisualizerCommand:n=>this._proxy.$executeDebugVisualizerCommand(n),provideDebugVisualizers:(n,o)=>this._proxy.$provideDebugVisualizers(e,t,n,o).then(r=>r.map(YW.deserialize)),resolveDebugVisualizer:(n,o)=>this._proxy.$resolveDebugVisualizer(n.id,o)});this._visualizerHandles.set(`${e}/${t}`,i)}$unregisterDebugVisualizer(e,t){const i=`${e}/${t}`;this._visualizerHandles.get(i)?.dispose(),this._visualizerHandles.delete(i)}sendBreakpointsAndListen(){this._toDispose.add(this.debugService.getModel().onDidChangeBreakpoints(n=>{if(n&&!n.sessionOnly){const o={};n.added&&(o.added=this.convertToDto(n.added)),n.removed&&(o.removed=n.removed.map(r=>r.getId())),n.changed&&(o.changed=this.convertToDto(n.changed)),(o.added||o.removed||o.changed)&&this._proxy.$acceptBreakpointsDelta(o)}}));const e=this.debugService.getModel().getBreakpoints(),t=this.debugService.getModel().getFunctionBreakpoints(),i=this.debugService.getModel().getDataBreakpoints();(e.length>0||t.length>0)&&this._proxy.$acceptBreakpointsDelta({added:this.convertToDto(e).concat(this.convertToDto(t)).concat(this.convertToDto(i))})}dispose(){this._toDispose.dispose()}createDebugAdapter(e){const t=this._debugAdaptersHandleCounter++,i=new eFe(this,t,this._proxy,e);return this._debugAdapters.set(t,i),i}substituteVariables(e,t){return Promise.resolve(this._proxy.$substituteVariables(e?e.uri:void 0,t))}runInTerminal(e,t){return this._proxy.$runInTerminal(e,t)}$registerDebugTypes(e){this._toDispose.add(this.debugService.getAdapterManager().registerDebugAdapterFactory(e,this))}$registerBreakpoints(e){for(const t of e)if(t.type==="sourceMulti"){const i=t.lines.map(n=>({id:n.id,enabled:n.enabled,lineNumber:n.line+1,column:n.character>0?n.character+1:void 0,condition:n.condition,hitCondition:n.hitCondition,logMessage:n.logMessage,mode:n.mode}));this.debugService.addBreakpoints(R.revive(t.uri),i)}else t.type==="function"?this.debugService.addFunctionBreakpoint({name:t.functionName,mode:t.mode,condition:t.condition,hitCondition:t.hitCondition,enabled:t.enabled,logMessage:t.logMessage},t.id):t.type==="data"&&this.debugService.addDataBreakpoint({description:t.label,src:{type:PA.Variable,dataId:t.dataId},canPersist:t.canPersist,accessTypes:t.accessTypes,accessType:t.accessType,mode:t.mode});return Promise.resolve()}$unregisterBreakpoints(e,t,i){return e.forEach(n=>this.debugService.removeBreakpoints(n)),t.forEach(n=>this.debugService.removeFunctionBreakpoints(n)),i.forEach(n=>this.debugService.removeDataBreakpoints(n)),Promise.resolve()}$registerDebugConfigurationProvider(e,t,i,n,o,r){const a={type:e,triggerKind:t};return i&&(a.provideDebugConfigurations=(c,d)=>this._proxy.$provideDebugConfigurations(r,c,d)),n&&(a.resolveDebugConfiguration=(c,d,l)=>this._proxy.$resolveDebugConfiguration(r,c,d,l)),o&&(a.resolveDebugConfigurationWithSubstitutedVariables=(c,d,l)=>this._proxy.$resolveDebugConfigurationWithSubstitutedVariables(r,c,d,l)),this._debugConfigurationProviders.set(r,a),this._toDispose.add(this.debugService.getConfigurationManager().registerDebugConfigurationProvider(a)),Promise.resolve(void 0)}$unregisterDebugConfigurationProvider(e){const t=this._debugConfigurationProviders.get(e);t&&(this._debugConfigurationProviders.delete(e),this.debugService.getConfigurationManager().unregisterDebugConfigurationProvider(t))}$registerDebugAdapterDescriptorFactory(e,t){const i={type:e,createDebugAdapterDescriptor:n=>Promise.resolve(this._proxy.$provideDebugAdapter(t,this.getSessionDto(n)))};return this._debugAdapterDescriptorFactories.set(t,i),this._toDispose.add(this.debugService.getAdapterManager().registerDebugAdapterDescriptorFactory(i)),Promise.resolve(void 0)}$unregisterDebugAdapterDescriptorFactory(e){const t=this._debugAdapterDescriptorFactories.get(e);t&&(this._debugAdapterDescriptorFactories.delete(e),this.debugService.getAdapterManager().unregisterDebugAdapterDescriptorFactory(t))}getSession(e){if(e)return this.debugService.getModel().getSession(e,!0)}async $startDebugging(e,t,i){const n=e?R.revive(e):void 0,o=this.debugService.getConfigurationManager().getLaunch(n),r=this.getSession(i.parentSessionID),a=typeof i.suppressSaveBeforeStart=="boolean"?!i.suppressSaveBeforeStart:void 0,c={noDebug:i.noDebug,parentSession:r,lifecycleManagedByParent:i.lifecycleManagedByParent,repl:i.repl,compact:i.compact,compoundRoot:r?.compoundRoot,saveBeforeRestart:a,testRun:i.testRun,suppressDebugStatusbar:i.suppressDebugStatusbar,suppressDebugToolbar:i.suppressDebugToolbar,suppressDebugView:i.suppressDebugView};try{return this.debugService.startDebugging(o,t,c,a)}catch(d){throw new fr(d&&d.message?d.message:"cannot start debugging")}}$setDebugSessionName(e,t){this.debugService.getModel().getSession(e)?.setName(t)}$customDebugAdapterRequest(e,t,i){const n=this.debugService.getModel().getSession(e,!0);return n?n.customRequest(t,i).then(o=>o&&o.success?o.body:Promise.reject(new fr(o?o.message:"custom request failed"))):Promise.reject(new fr("debug session not found"))}$getDebugProtocolBreakpoint(e,t){const i=this.debugService.getModel().getSession(e,!0);return i?Promise.resolve(i.getDebugProtocolBreakpoint(t)):Promise.reject(new fr("debug session not found"))}$stopDebugging(e){if(e){const t=this.debugService.getModel().getSession(e,!0);if(t)return this.debugService.stopSession(t,Tce(t))}else return this.debugService.stopSession(void 0);return Promise.reject(new fr("debug session not found"))}$appendDebugConsole(e){this.debugService.getViewModel().focusedSession?.appendToRepl({output:e,sev:Fe.Warning})}$acceptDAMessage(e,t){this.getDebugAdapter(e).acceptMessage(mTe(t,!1))}$acceptDAError(e,t,i,n){this._debugAdapters.get(e)?.fireError(e,new Error(`${t}: ${i}
${n}`))}$acceptDAExit(e,t,i){this._debugAdapters.get(e)?.fireExit(e,t,i)}getDebugAdapter(e){const t=this._debugAdapters.get(e);if(!t)throw new Error("Invalid debug adapter");return t}$sessionCached(e){this._extHostKnownSessions.add(e)}getSessionDto(e){if(e){const t=e.getId();return this._extHostKnownSessions.has(t)?t:{id:t,type:e.configuration.type,name:e.name,folderUri:e.root?e.root.uri:void 0,configuration:e.configuration,parent:e.parentSession?.getId()}}}convertToDto(e){return e.map(t=>{if("name"in t){const i=t;return{type:"function",id:i.getId(),enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,functionName:i.name}}else if("src"in t){const i=t;return{type:"data",id:i.getId(),dataId:i.src.type===PA.Variable?i.src.dataId:i.src.address,enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,accessType:i.accessType,label:i.description,canPersist:i.canPersist}}else if("uri"in t){const i=t;return{type:"source",id:i.getId(),enabled:i.enabled,condition:i.condition,hitCondition:i.hitCondition,logMessage:i.logMessage,uri:i.uri,line:i.lineNumber>0?i.lineNumber-1:0,character:typeof i.column=="number"&&i.column>0?i.column-1:0}}else return}).filter(wa)}};xJ=f([ht(qe.MainThreadDebugService),p(1,Mq),p(2,wre)],xJ);class eFe extends uTe{constructor(e,t,i,n){super(),this._ds=e,this._handle=t,this._proxy=i,this.session=n}fireError(e,t){this._onError.fire(t)}fireExit(e,t,i){this._onExit.fire(t)}startSession(){return Promise.resolve(this._proxy.$startDASession(this._handle,this._ds.getSessionDto(this.session)))}sendMessage(e){this._proxy.$sendDAMessage(this._handle,fTe(e,!0))}async stopSession(){return await this.cancelPendingRequests(),Promise.resolve(this._proxy.$stopDASession(this._handle))}}class tFe{constructor(e,t){this._proxy=e,this._handle=t,this._idPool=0,this._requests=new Map,this._resolver=new Map}enqueue(e,t){const i=++this._idPool,n=new Promise(r=>{this._requests.set(i,{id:i,uri:e}),this._resolver.set(i,r),this._processQueue()}),o=t.onCancellationRequested(()=>{this._requests.delete(i),this._resolver.delete(i)});return n.finally(()=>o.dispose())}_processQueue(){typeof this._timer!="number"&&(this._timer=setTimeout(()=>{const e=this._requests,t=this._resolver;this._proxy.$provideDecorations(this._handle,[...e.values()],Ce.None).then(i=>{for(const[n,o]of t)o(i[n])}),this._requests=new Map,this._resolver=new Map,this._timer=void 0},0))}}let IJ=class{constructor(e,t){this._decorationsService=t,this._provider=new Map,this._proxy=e.getProxy(Ze.ExtHostDecorations)}dispose(){this._provider.forEach(e=>Xe(e)),this._provider.clear()}$registerDecorationProvider(e,t){const i=new M,n=new tFe(this._proxy,e),o=this._decorationsService.registerDecorationsProvider({label:t,onDidChange:i.event,provideDecorations:async(r,a)=>{const c=await n.enqueue(r,a);if(!c)return;const[d,l,u,g]=c;return{weight:10,bubble:d??!1,color:g?.id,tooltip:l,letter:u}}});this._provider.set(e,[i,o])}$onDidChange(e,t){const i=this._provider.get(e);if(i){const[n]=i;n.fire(t&&t.map(o=>R.revive(o)))}}$unregisterDecorationProvider(e){const t=this._provider.get(e);t&&(Xe(t),this._provider.delete(e))}};IJ=f([ht(qe.MainThreadDecorations),p(1,Pv)],IJ);let DJ=class{constructor(e,t,i){this._markerService=t,this._uriIdentService=i,this._activeOwners=new Set,this._proxy=e.getProxy(Ze.ExtHostDiagnostics),this._markerListener=this._markerService.onMarkerChanged(this._forwardMarkers,this)}dispose(){this._markerListener.dispose(),this._activeOwners.forEach(e=>this._markerService.changeAll(e,[])),this._activeOwners.clear()}_forwardMarkers(e){const t=[];for(const i of e){const n=this._markerService.read({resource:i,ignoreResourceFilters:!0});if(n.length===0)t.push([i,[]]);else{const o=n.filter(r=>!this._activeOwners.has(r.owner));o.length>0&&t.push([i,o])}}t.length>0&&this._proxy.$acceptMarkersChange(t)}$changeMany(e,t){for(const i of t){const[n,o]=i;if(o)for(const r of o){if(r.relatedInformation)for(const a of r.relatedInformation)a.resource=R.revive(a.resource);r.code&&typeof r.code!="string"&&(r.code.target=R.revive(r.code.target))}this._markerService.changeOne(e,this._uriIdentService.asCanonicalUri(R.revive(n)),o)}this._activeOwners.add(e)}$clear(e){this._markerService.changeAll(e,[]),this._activeOwners.delete(e)}};DJ=f([ht(qe.MainThreadDiagnostics),p(1,FM),p(2,nn)],DJ);var pT;let kJ=pT=class{constructor(e,t){this._fileDialogService=t}dispose(){}async $showOpenDialog(e){const t=pT._convertOpenOptions(e);return t.defaultUri||(t.defaultUri=await this._fileDialogService.defaultFilePath()),Promise.resolve(this._fileDialogService.showOpenDialog(t))}async $showSaveDialog(e){const t=pT._convertSaveOptions(e);return t.defaultUri||(t.defaultUri=await this._fileDialogService.defaultFilePath()),Promise.resolve(this._fileDialogService.showSaveDialog(t))}static _convertOpenOptions(e){const t={openLabel:e?.openLabel||void 0,canSelectFiles:e?.canSelectFiles||!e?.canSelectFiles&&!e?.canSelectFolders,canSelectFolders:e?.canSelectFolders,canSelectMany:e?.canSelectMany,defaultUri:e?.defaultUri?R.revive(e.defaultUri):void 0,title:e?.title||void 0,availableFileSystems:[]};if(e?.filters){t.filters=[];for(const[i,n]of Object.entries(e.filters))t.filters.push({name:i,extensions:n})}return t}static _convertSaveOptions(e){const t={defaultUri:e?.defaultUri?R.revive(e.defaultUri):void 0,saveLabel:e?.saveLabel||void 0,title:e?.title||void 0};if(e?.filters){t.filters=[];for(const[i,n]of Object.entries(e.filters))t.filters.push({name:i,extensions:n})}return t}};kJ=pT=f([ht(qe.MainThreadDialogs),p(1,to)],kJ);let TJ=class{constructor(e,t,i,n,o){this._textModelResolverService=t,this._languageService=i,this._modelService=n,this._editorWorkerService=o,this._resourceContentProvider=new ti,this._pendingUpdate=new Map,this._proxy=e.getProxy(Ze.ExtHostDocumentContentProviders)}dispose(){this._resourceContentProvider.dispose(),Xe(this._pendingUpdate.values())}$registerTextContentProvider(e,t){const i=this._textModelResolverService.registerTextModelContentProvider(t,{provideTextContent:n=>this._proxy.$provideTextDocumentContent(e,n).then(o=>{if(typeof o=="string"){const r=o.substr(0,1+o.search(/\r?\n/)),a=this._languageService.createByFilepathOrFirstLine(n,r);return this._modelService.createModel(o,a,n)}return null})});this._resourceContentProvider.set(e,i)}$unregisterTextContentProvider(e){this._resourceContentProvider.deleteAndDispose(e)}async $onVirtualDocumentChange(e,t){const i=this._modelService.getModel(R.revive(e));if(!i)return;this._pendingUpdate.get(i.id)?.cancel();const o=new li;this._pendingUpdate.set(i.id,o);try{const r=await this._editorWorkerService.computeMoreMinimalEdits(i.uri,[{text:t,range:i.getFullModelRange()}]);if(this._pendingUpdate.delete(i.id),o.token.isCancellationRequested)return;r&&r.length>0&&i.applyEdits(r.map(a=>qi.replace(P.lift(a.range),a.text)))}catch(r){mt(r)}}};TJ=f([ht(qe.MainThreadDocumentContentProviders),p(1,Ci),p(2,vi),p(3,ci),p(4,vc)],TJ);class Oue{constructor(e,t=1e3*60*3,i=1024*1024*80,n=50){this._extUri=e,this._maxAge=t,this._maxLength=i,this._maxSize=n,this._data=new Array,this._length=0}dispose(){this._data=Xe(this._data)}remove(e){for(const t of[...this._data])this._extUri.isEqualOrParent(t.uri,e)&&t.dispose()}add(e,t,i=0){const n=()=>{const a=this._data.indexOf(r);a>=0&&(this._length-=i,t.dispose(),clearTimeout(o),this._data.splice(a,1))},o=setTimeout(n,this._maxAge),r={uri:e,length:i,dispose:n};this._data.push(r),this._length+=i,this._cleanup()}_cleanup(){for(;this._length>this._maxLength;)this._data[0].dispose();const e=Math.ceil(this._maxSize*1.2);this._data.length>=e&&Xe(this._data.slice(0,e-this._maxSize))}}class iFe extends F{constructor(e,t,i,n){super(),this._model=e,this._onIsCaughtUpWithContentChanges=t,this._proxy=i,this._textFileService=n,this._knownVersionId=this._model.getVersionId(),this._store.add(this._model.onDidChangeContent(o=>{this._knownVersionId=o.versionId,this._proxy.$acceptModelChanged(this._model.uri,o,this._textFileService.isDirty(this._model.uri)),this.isCaughtUpWithContentChanges()&&this._onIsCaughtUpWithContentChanges.fire(this._model.uri)}))}isCaughtUpWithContentChanges(){return this._model.getVersionId()===this._knownVersionId}}let e$=class extends F{constructor(e,t,i,n,o,r,a,c,d){super(),this._modelService=t,this._textFileService=i,this._fileService=n,this._textModelResolverService=o,this._environmentService=r,this._uriIdentityService=a,this._pathService=d,this._onIsCaughtUpWithContentChanges=this._store.add(new M),this.onIsCaughtUpWithContentChanges=this._onIsCaughtUpWithContentChanges.event,this._modelTrackers=new In,this._modelReferenceCollection=this._store.add(new Oue(a.extUri)),this._proxy=e.getProxy(Ze.ExtHostDocuments),this._store.add(t.onModelLanguageChanged(this._onModelModeChanged,this)),this._store.add(i.files.onDidSave(l=>{this._shouldHandleFileEvent(l.model.resource)&&this._proxy.$acceptModelSaved(l.model.resource)})),this._store.add(i.files.onDidChangeDirty(l=>{this._shouldHandleFileEvent(l.resource)&&this._proxy.$acceptDirtyStateChanged(l.resource,l.isDirty())})),this._store.add(T.any(i.files.onDidChangeEncoding,i.untitled.onDidChangeEncoding)(l=>{if(this._shouldHandleFileEvent(l.resource)){const u=l.getEncoding();u&&this._proxy.$acceptEncodingChanged(l.resource,u)}})),this._store.add(c.onDidRunWorkingCopyFileOperation(l=>{const u=l.operation===fa.MOVE;if(u||l.operation===fa.DELETE)for(const g of l.files){const m=u?g.source:g.target;m&&this._modelReferenceCollection.remove(m)}}))}dispose(){Xe(this._modelTrackers.values()),this._modelTrackers.clear(),super.dispose()}isCaughtUpWithContentChanges(e){const t=this._modelTrackers.get(e);return t?t.isCaughtUpWithContentChanges():!0}_shouldHandleFileEvent(e){const t=this._modelService.getModel(e);return!!t&&Cu(t)}handleModelAdded(e){Cu(e)&&this._modelTrackers.set(e.uri,new iFe(e,this._onIsCaughtUpWithContentChanges,this._proxy,this._textFileService))}_onModelModeChanged(e){const{model:t}=e;this._modelTrackers.has(t.uri)&&this._proxy.$acceptModelLanguageChanged(t.uri,t.getLanguageId())}handleModelRemoved(e){this._modelTrackers.has(e)&&(this._modelTrackers.get(e).dispose(),this._modelTrackers.delete(e))}async $trySaveDocument(e){return!!await this._textFileService.save(R.revive(e))}async $tryOpenDocument(e,t){const i=R.revive(e);if(!i.scheme||!(i.fsPath||i.authority))throw new fr("Invalid uri. Scheme and authority or path must be set.");const n=this._uriIdentityService.asCanonicalUri(i);let o;switch(n.scheme){case ae.untitled:o=this._handleUntitledScheme(n,t);break;case ae.file:default:o=this._handleAsResourceInput(n,t);break}let r;try{r=await o}catch(a){throw new fr(`cannot open ${n.toString()}. Detail: ${bo(a)}`)}if(r)if(SE.isEqual(r,n)){if(this._modelTrackers.has(n))return n;throw new fr(`cannot open ${n.toString()}. Detail: Files above 50MB cannot be synchronized with extensions.`)}else throw new fr(`cannot open ${n.toString()}. Detail: Actual document opened as ${r.toString()}`);else throw new fr(`cannot open ${n.toString()}`)}$tryCreateDocument(e){return this._doCreateUntitled(void 0,e)}async _handleAsResourceInput(e,t){if(t?.encoding){const n=await this._textFileService.files.resolve(e,{encoding:t.encoding,reason:hoe.REFERENCE});if(n.isDirty())throw new fr("Cannot re-open a dirty text document with different encoding. Save it first.");await n.setEncoding(t.encoding,pCe.Decode)}const i=await this._textModelResolverService.createModelReference(e);return this._modelReferenceCollection.add(e,i,i.object.textEditorModel.getValueLength()),i.object.textEditorModel.uri}async _handleUntitledScheme(e,t){const i=Wz(e,this._environmentService.remoteAuthority,this._pathService.defaultUriScheme);return await this._fileService.exists(i)?Promise.reject(new Error("file already exists")):await this._doCreateUntitled(e.path?e:void 0,t)}async _doCreateUntitled(e,t){const i=this._textFileService.untitled.create({associatedResource:e,languageId:t?.language,initialValue:t?.content,encoding:t?.encoding}),n=i.resource,o=await this._textModelResolverService.createModelReference(n);if(!this._modelTrackers.has(n))throw o.dispose(),new Error(`expected URI ${n.toString()} to have come to LIFE`);return this._modelReferenceCollection.add(n,o,o.object.textEditorModel.getValueLength()),T.once(i.onDidRevert)(()=>this._modelReferenceCollection.remove(n)),this._proxy.$acceptDirtyStateChanged(n,!0),n}};e$=f([p(1,ci),p(2,Ps),p(3,je),p(4,Ci),p(5,wn),p(6,nn),p(7,dg),p(8,_c)],e$);class Kl{static readFromEditor(e,t,i){const n=Kl._readSelectionsFromCodeEditor(e,i),o=Kl._readOptionsFromCodeEditor(e,t,i),r=Kl._readVisibleRangesFromCodeEditor(e,i);return new Kl(n,o,r)}static _readSelectionsFromCodeEditor(e,t){let i=null;return t&&(i=t.getSelections()),!i&&e&&(i=e.selections),i||(i=[new at(1,1,1,1)]),i}static _readOptionsFromCodeEditor(e,t,i){if(t.isDisposed()){if(e)return e.options;throw new Error("No valid properties")}let n,o;if(i){const a=i.getOptions(),c=a.get(L.lineNumbers);n=a.get(L.cursorStyle),o=c.renderType}else e?(n=e.options.cursorStyle,o=e.options.lineNumbers):(n=obe.Line,o=hs.On);const r=t.getOptions();return{insertSpaces:r.insertSpaces,tabSize:r.tabSize,indentSize:r.indentSize,originalIndentSize:r.originalIndentSize,cursorStyle:n,lineNumbers:o}}static _readVisibleRangesFromCodeEditor(e,t){return t?t.getVisibleRanges():[]}constructor(e,t,i){this.selections=e,this.options=t,this.visibleRanges=i}generateDelta(e,t){const i={options:null,selections:null,visibleRanges:null};return(!e||!Kl._selectionsEqual(e.selections,this.selections))&&(i.selections={selections:this.selections,source:t??void 0}),(!e||!Kl._optionsEqual(e.options,this.options))&&(i.options=this.options),(!e||!Kl._rangesEqual(e.visibleRanges,this.visibleRanges))&&(i.visibleRanges=this.visibleRanges),i.selections||i.options||i.visibleRanges?i:null}static _selectionsEqual(e,t){return rs(e,t,(i,n)=>i.equalsSelection(n))}static _rangesEqual(e,t){return rs(e,t,(i,n)=>i.equalsRange(n))}static _optionsEqual(e,t){return e&&!t||!e&&t?!1:!e&&!t?!0:e.tabSize===t.tabSize&&e.indentSize===t.indentSize&&e.insertSpaces===t.insertSpaces&&e.cursorStyle===t.cursorStyle&&e.lineNumbers===t.lineNumbers}}class nFe{constructor(e,t,i,n,o,r,a){this._modelListeners=new U,this._codeEditorListeners=new U,this._id=e,this._model=t,this._codeEditor=null,this._properties=null,this._focusTracker=n,this._mainThreadDocuments=o,this._modelService=r,this._clipboardService=a,this._onPropertiesChanged=new M,this._modelListeners.add(this._model.onDidChangeOptions(c=>{this._updatePropertiesNow(null)})),this.setCodeEditor(i),this._updatePropertiesNow(null)}dispose(){this._modelListeners.dispose(),this._codeEditor=null,this._codeEditorListeners.dispose()}_updatePropertiesNow(e){this._setProperties(Kl.readFromEditor(this._properties,this._model,this._codeEditor),e)}_setProperties(e,t){const i=e.generateDelta(this._properties,t);this._properties=e,i&&this._onPropertiesChanged.fire(i)}getId(){return this._id}getModel(){return this._model}getCodeEditor(){return this._codeEditor}hasCodeEditor(e){return this._codeEditor===e}setCodeEditor(e){if(!this.hasCodeEditor(e)&&(this._codeEditorListeners.clear(),this._codeEditor=e,this._codeEditor)){this._codeEditorListeners.add(this._codeEditor.onDidChangeModel(()=>{this.setCodeEditor(null)})),this._codeEditorListeners.add(this._codeEditor.onDidFocusEditorWidget(()=>{this._focusTracker.onGainedFocus()})),this._codeEditorListeners.add(this._codeEditor.onDidBlurEditorWidget(()=>{this._focusTracker.onLostFocus()}));let t=null;this._codeEditorListeners.add(this._mainThreadDocuments.onIsCaughtUpWithContentChanges(o=>{if(o.toString()===this._model.uri.toString()){const r=t;t=null,this._updatePropertiesNow(r)}}));const i=()=>this._codeEditor&&this._codeEditor.getModel()===this._model,n=o=>{this._mainThreadDocuments.isCaughtUpWithContentChanges(this._model.uri)?(t=null,this._updatePropertiesNow(o)):t=o};this._codeEditorListeners.add(this._codeEditor.onDidChangeCursorSelection(o=>{i()&&n(o.source)})),this._codeEditorListeners.add(this._codeEditor.onDidChangeConfiguration(o=>{i()&&n(null)})),this._codeEditorListeners.add(this._codeEditor.onDidLayoutChange(()=>{i()&&n(null)})),this._codeEditorListeners.add(this._codeEditor.onDidScrollChange(()=>{i()&&n(null)})),this._updatePropertiesNow(null)}}isVisible(){return!!this._codeEditor}getProperties(){return this._properties}get onPropertiesChanged(){return this._onPropertiesChanged.event}setSelections(e){if(this._codeEditor){this._codeEditor.setSelections(e);return}const t=e.map(at.liftSelection);this._setProperties(new Kl(t,this._properties.options,this._properties.visibleRanges),null)}_setIndentConfiguration(e){const t=this._modelService.getCreationOptions(this._model.getLanguageId(),this._model.uri,this._model.isForSimpleWidget);if(e.tabSize==="auto"||e.insertSpaces==="auto"){let n=t.insertSpaces,o=t.tabSize;e.insertSpaces!=="auto"&&typeof e.insertSpaces<"u"&&(n=e.insertSpaces),e.tabSize!=="auto"&&typeof e.tabSize<"u"&&(o=e.tabSize),this._model.detectIndentation(n,o);return}const i={};typeof e.insertSpaces<"u"&&(i.insertSpaces=e.insertSpaces),typeof e.tabSize<"u"&&(i.tabSize=e.tabSize),typeof e.indentSize<"u"&&(i.indentSize=e.indentSize),this._model.updateOptions(i)}setConfiguration(e){if(this._setIndentConfiguration(e),!!this._codeEditor){if(e.cursorStyle){const t=sbe(e.cursorStyle);this._codeEditor.updateOptions({cursorStyle:t})}if(typeof e.lineNumbers<"u"){let t;switch(e.lineNumbers){case hs.On:t="on";break;case hs.Relative:t="relative";break;case hs.Interval:t="interval";break;default:t="off"}this._codeEditor.updateOptions({lineNumbers:t})}}}setDecorations(e,t){this._codeEditor&&this._codeEditor.setDecorationsByType("exthost-api",e,t)}setDecorationsFast(e,t){if(!this._codeEditor)return;const i=[];for(let n=0,o=Math.floor(t.length/4);n<o;n++)i[n]=new P(t[4*n],t[4*n+1],t[4*n+2],t[4*n+3]);this._codeEditor.setDecorationsByTypeFast(e,i)}revealRange(e,t){if(this._codeEditor)switch(t){case rb.Default:this._codeEditor.revealRange(e,Qi.Smooth);break;case rb.InCenter:this._codeEditor.revealRangeInCenter(e,Qi.Smooth);break;case rb.InCenterIfOutsideViewport:this._codeEditor.revealRangeInCenterIfOutsideViewport(e,Qi.Smooth);break;case rb.AtTop:this._codeEditor.revealRangeAtTop(e,Qi.Smooth);break;default:console.warn(`Unknown revealType: ${t}`);break}}isFocused(){return this._codeEditor?this._codeEditor.hasTextFocus():!1}matches(e){return e?e.getControl()===this._codeEditor:!1}applyEdits(e,t,i){if(this._model.getVersionId()!==e||!this._codeEditor)return!1;typeof i.setEndOfLine<"u"&&this._model.pushEOL(i.setEndOfLine);const n=t.map(o=>({range:P.lift(o.range),text:o.text,forceMoveMarkers:o.forceMoveMarkers}));return i.undoStopBefore&&this._codeEditor.pushUndoStop(),this._codeEditor.executeEdits("MainThreadTextEditor",n),i.undoStopAfter&&this._codeEditor.pushUndoStop(),!0}async insertSnippet(e,t,i,n){if(!this._codeEditor||!this._codeEditor.hasModel())return!1;let o;if(fd.guessNeedsClipboard(t)){const d=new hN(this._codeEditor,fs.Value|fs.Position);if(o=await this._clipboardService.readText(),!d.validate(this._codeEditor))return!1}if(this._codeEditor.getModel().getVersionId()!==e)return!1;const a=cs.get(this._codeEditor);if(!a)return!1;this._codeEditor.focus();const c=i.map(d=>({range:P.lift(d),template:t}));return a.apply(c,{overwriteBefore:0,overwriteAfter:0,undoStopBefore:n.undoStopBefore,undoStopAfter:n.undoStopAfter,adjustWhitespace:!n.keepWhitespace,clipboardText:o}),!0}}var t$;let i$=class{static{t$=this}static{this.INSTANCE_COUNT=0}constructor(e,t,i,n,o,r,a,c){this._editorLocator=e,this._codeEditorService=i,this._editorService=n,this._editorGroupService=o,this._configurationService=r,this._quickDiffModelService=a,this._uriIdentityService=c,this._toDispose=new U,this._instanceId=String(++t$.INSTANCE_COUNT),this._proxy=t.getProxy(Ze.ExtHostEditors),this._textEditorsListenersMap=Object.create(null),this._editorPositionData=null,this._toDispose.add(this._editorService.onDidVisibleEditorsChange(()=>this._updateActiveAndVisibleTextEditors())),this._toDispose.add(this._editorGroupService.onDidRemoveGroup(()=>this._updateActiveAndVisibleTextEditors())),this._toDispose.add(this._editorGroupService.onDidMoveGroup(()=>this._updateActiveAndVisibleTextEditors())),this._registeredDecorationTypes=Object.create(null)}dispose(){Object.keys(this._textEditorsListenersMap).forEach(e=>{Xe(this._textEditorsListenersMap[e])}),this._textEditorsListenersMap=Object.create(null),this._toDispose.dispose();for(const e in this._registeredDecorationTypes)this._codeEditorService.removeDecorationType(e);this._registeredDecorationTypes=Object.create(null)}handleTextEditorAdded(e){const t=e.getId(),i=[];i.push(e.onPropertiesChanged(o=>{this._proxy.$acceptEditorPropertiesChanged(t,o)}));const n=this._getTextEditorDiffInformation(e,i);i.push(fi(o=>{const r=n.read(o);this._proxy.$acceptEditorDiffInformation(t,r)})),this._textEditorsListenersMap[t]=i}handleTextEditorRemoved(e){Xe(this._textEditorsListenersMap[e]),delete this._textEditorsListenersMap[e]}_updateActiveAndVisibleTextEditors(){const e=this._getTextEditorPositionData();ic(this._editorPositionData,e)||(this._editorPositionData=e,this._proxy.$acceptEditorPositionData(this._editorPositionData))}_getTextEditorPositionData(){const e=Object.create(null);for(const t of this._editorService.visibleEditorPanes){const i=this._editorLocator.findTextEditorIdFor(t);i&&(e[i]=Qp(this._editorGroupService,t.group))}return e}_getTextEditorDiffInformation(e,t){const i=e.getCodeEditor();if(!i)return Li(void 0);const[n]=this._codeEditorService.listDiffEditors().filter(a=>a.getOriginalEditor().getId()===i.getId()||a.getModifiedEditor().getId()===i.getId()),o=n?kn(this,n.onDidChangeModel,()=>n.getModel()):kn(this,i.onDidChangeModel,()=>i.getModel()),r=ve(a=>{const c=o.read(a);if(!c)return Li(void 0);const d=J0(c)?c.uri:c.modified.uri;if(J0(c)){const g=this._quickDiffModelService.createQuickDiffModelReference(d);return g?(t.push(g),kn(this,g.object.onDidChange,()=>g.object.getQuickDiffResults().map(m=>({original:m.original,modified:m.modified,changes:m.changes2})))):Li(void 0)}const l=this._configurationService.getValue("diffEditor.diffAlgorithm"),u=this._quickDiffModelService.createQuickDiffModelReference(d,{algorithm:l});return u?(t.push(u),kn(T.any(u.object.onDidChange,n.onDidUpdateDiff),()=>{const g=u.object.getQuickDiffResults().map(_=>({original:_.original,modified:_.modified,changes:_.changes2})),m=n.getDiffComputationResult()?.changes2??[],v=[{original:c.original.uri,modified:c.modified.uri,changes:m.map(_=>_)}];return[...g,...v]})):Li(void 0)});return Yl({owner:this,equalsFn:(a,c)=>rs(a,c,(d,l)=>rbe(this._uriIdentityService,d,l))},a=>{const c=o.read(a),d=r.read(a).read(a);if(!c||!d)return;const l=J0(c)?c.getVersionId():c.modified.getVersionId();return d.map(u=>{const g=u.changes.map(m=>[m.original.startLineNumber,m.original.endLineNumberExclusive,m.modified.startLineNumber,m.modified.endLineNumberExclusive]);return{documentVersion:l,original:u.original,modified:u.modified,changes:g}})})}async $tryShowTextDocument(e,t){const i=R.revive(e),n={preserveFocus:t.preserveFocus,pinned:t.pinned,selection:t.selection,activation:t.preserveFocus?qc.RESTORE:void 0,override:ZT.EXCLUSIVE_ONLY},o={resource:i,options:n},r=await this._editorService.openEditor(o,Vm(this._editorGroupService,this._configurationService,t.position));if(!r)return;const a=r.getControl(),c=mI(a);return c?this._editorLocator.getIdOfCodeEditor(c):void 0}async $tryShowEditor(e,t){const i=this._editorLocator.getEditor(e);if(i){const n=i.getModel();await this._editorService.openEditor({resource:n.uri,options:{preserveFocus:!1}},Vm(this._editorGroupService,this._configurationService,t));return}}async $tryHideEditor(e){const t=this._editorLocator.getEditor(e);if(t){const i=this._editorService.visibleEditorPanes;for(const n of i)if(t.matches(n)){await n.group.closeEditor(n.input);return}}}$trySetSelections(e,t){const i=this._editorLocator.getEditor(e);return i?(i.setSelections(t),Promise.resolve(void 0)):Promise.reject(Nt(`TextEditor(${e})`))}$trySetDecorations(e,t,i){t=`${this._instanceId}-${t}`;const n=this._editorLocator.getEditor(e);return n?(n.setDecorations(t,i),Promise.resolve(void 0)):Promise.reject(Nt(`TextEditor(${e})`))}$trySetDecorationsFast(e,t,i){t=`${this._instanceId}-${t}`;const n=this._editorLocator.getEditor(e);return n?(n.setDecorationsFast(t,i),Promise.resolve(void 0)):Promise.reject(Nt(`TextEditor(${e})`))}$tryRevealRange(e,t,i){const n=this._editorLocator.getEditor(e);return n?(n.revealRange(t,i),Promise.resolve()):Promise.reject(Nt(`TextEditor(${e})`))}$trySetOptions(e,t){const i=this._editorLocator.getEditor(e);return i?(i.setConfiguration(t),Promise.resolve(void 0)):Promise.reject(Nt(`TextEditor(${e})`))}$tryApplyEdits(e,t,i,n){const o=this._editorLocator.getEditor(e);return o?Promise.resolve(o.applyEdits(t,i,n)):Promise.reject(Nt(`TextEditor(${e})`))}$tryInsertSnippet(e,t,i,n,o){const r=this._editorLocator.getEditor(e);return r?Promise.resolve(r.insertSnippet(t,i,n,o)):Promise.reject(Nt(`TextEditor(${e})`))}$registerTextEditorDecorationType(e,t,i){t=`${this._instanceId}-${t}`,this._registeredDecorationTypes[t]=!0,this._codeEditorService.registerDecorationType(`exthost-api-${e}`,t,i)}$removeTextEditorDecorationType(e){e=`${this._instanceId}-${e}`,delete this._registeredDecorationTypes[e],this._codeEditorService.removeDecorationType(e)}$getDiffInformation(e){const t=this._editorLocator.getEditor(e);if(!t)return Promise.reject(new Error("No such TextEditor"));const i=t.getCodeEditor();if(!i)return Promise.reject(new Error("No such CodeEditor"));const n=i.getId(),o=this._codeEditorService.listDiffEditors(),[r]=o.filter(c=>c.getOriginalEditor().getId()===n||c.getModifiedEditor().getId()===n);if(r)return Promise.resolve(r.getLineChanges()||[]);if(!i.hasModel())return Promise.resolve([]);const a=this._quickDiffModelService.createQuickDiffModelReference(i.getModel().uri);if(!a)return Promise.resolve([]);try{const c=a.object.quickDiffs.find(l=>l.kind==="primary"),d=a.object.changes.filter(l=>l.providerId===c?.id);return Promise.resolve(d.map(l=>l.change)??[])}finally{a.dispose()}}};i$=t$=f([p(2,Bt),p(3,de),p(4,xe),p(5,ne),p(6,Fq),p(7,nn)],i$);Ee.registerCommand("_workbench.revertAllDirty",async function(s){if(!s.get(Hs).extensionTestsLocationURI)throw new Error("Command is only available when running extension tests.");const t=s.get(lg);for(const i of t.dirtyWorkingCopies)await i.revert({soft:!0})});class sFe{constructor(e){this.editor=e,this.id=`${e.getId()},${e.getModel().id}`}}class n${constructor(e,t,i,n,o,r){this.removedDocuments=e,this.addedDocuments=t,this.removedEditors=i,this.addedEditors=n,this.oldActiveEditor=o,this.newActiveEditor=r,this.isEmpty=this.removedDocuments.length===0&&this.addedDocuments.length===0&&this.removedEditors.length===0&&this.addedEditors.length===0&&o===r}toString(){let e=`DocumentAndEditorStateDelta
`;return e+=`	Removed Documents: [${this.removedDocuments.map(t=>t.uri.toString(!0)).join(", ")}]
`,e+=`	Added Documents: [${this.addedDocuments.map(t=>t.uri.toString(!0)).join(", ")}]
`,e+=`	Removed Editors: [${this.removedEditors.map(t=>t.id).join(", ")}]
`,e+=`	Added Editors: [${this.addedEditors.map(t=>t.id).join(", ")}]
`,e+=`	New Active Editor: ${this.newActiveEditor}
`,e}}class j1{static compute(e,t){if(!e)return new n$([],[...t.documents.values()],[],[...t.textEditors.values()],void 0,t.activeEditor);const i=Fz(e.documents,t.documents),n=$F(e.textEditors,t.textEditors),o=e.activeEditor!==t.activeEditor?e.activeEditor:void 0,r=e.activeEditor!==t.activeEditor?t.activeEditor:void 0;return new n$(i.removed,i.added,n.removed,n.added,o,r)}constructor(e,t,i){this.documents=e,this.textEditors=t,this.activeEditor=i}}var om;(function(s){s[s.Editor=0]="Editor",s[s.Panel=1]="Panel"})(om||(om={}));let s$=class{constructor(e,t,i,n,o){this._onDidChangeState=e,this._modelService=t,this._codeEditorService=i,this._editorService=n,this._paneCompositeService=o,this._toDispose=new U,this._toDisposeOnEditorRemove=new ti,this._activeEditorOrder=om.Editor,this._modelService.onModelAdded(this._updateStateOnModelAdd,this,this._toDispose),this._modelService.onModelRemoved(r=>this._updateState(),this,this._toDispose),this._editorService.onDidActiveEditorChange(r=>this._updateState(),this,this._toDispose),this._codeEditorService.onCodeEditorAdd(this._onDidAddEditor,this,this._toDispose),this._codeEditorService.onCodeEditorRemove(this._onDidRemoveEditor,this,this._toDispose),this._codeEditorService.listCodeEditors().forEach(this._onDidAddEditor,this),T.filter(this._paneCompositeService.onDidPaneCompositeOpen,r=>r.viewContainerLocation===We.Panel)(r=>this._activeEditorOrder=om.Panel,void 0,this._toDispose),T.filter(this._paneCompositeService.onDidPaneCompositeClose,r=>r.viewContainerLocation===We.Panel)(r=>this._activeEditorOrder=om.Editor,void 0,this._toDispose),this._editorService.onDidVisibleEditorsChange(r=>this._activeEditorOrder=om.Editor,void 0,this._toDispose),this._updateState()}dispose(){this._toDispose.dispose(),this._toDisposeOnEditorRemove.dispose()}_onDidAddEditor(e){this._toDisposeOnEditorRemove.set(e.getId(),Wo(e.onDidChangeModel(()=>this._updateState()),e.onDidFocusEditorText(()=>this._updateState()),e.onDidFocusEditorWidget(()=>this._updateState(e)))),this._updateState()}_onDidRemoveEditor(e){const t=e.getId();this._toDisposeOnEditorRemove.has(t)&&(this._toDisposeOnEditorRemove.deleteAndDispose(t),this._updateState())}_updateStateOnModelAdd(e){if(Cu(e)){if(!this._currentState){this._updateState();return}this._currentState=new j1(this._currentState.documents.add(e),this._currentState.textEditors,this._currentState.activeEditor),this._onDidChangeState(new n$([],[e],[],[],void 0,void 0))}}_updateState(e){const t=new Set;for(const a of this._modelService.getModels())Cu(a)&&t.add(a);const i=new Map;let n=null;for(const a of this._codeEditorService.listCodeEditors()){if(a.isSimpleWidget)continue;const c=a.getModel();if(a.hasModel()&&c&&Cu(c)&&!c.isDisposed()&&this._modelService.getModel(c.uri)){const d=new sFe(a);i.set(d.id,d),(a.hasTextFocus()||e===a&&a.hasWidgetFocus())&&(n=d.id)}}if(!n){let a;if(this._activeEditorOrder===om.Editor?a=this._getActiveEditorFromEditorPart()||this._getActiveEditorFromPanel():a=this._getActiveEditorFromPanel()||this._getActiveEditorFromEditorPart(),a)for(const c of i.values())a===c.editor&&(n=c.id)}const o=new j1(t,i,n),r=j1.compute(this._currentState,o);r.isEmpty||(this._currentState=o,this._onDidChangeState(r))}_getActiveEditorFromPanel(){const e=this._paneCompositeService.getActivePaneComposite(We.Panel);if(e!==void 0){const t=e.getControl();if(mo(t))return t}}_getActiveEditorFromEditorPart(){let e=this._editorService.activeTextEditorControl;return Zu(e)&&(e=e.getModifiedEditor()),e}};s$=f([p(1,ci),p(2,Bt),p(3,de),p(4,da)],s$);let AJ=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w){this._modelService=t,this._textFileService=i,this._editorService=n,this._editorGroupService=c,this._clipboardService=m,this._toDispose=new U,this._textEditors=new Map,this._proxy=e.getProxy(Ze.ExtHostDocumentsAndEditors),this._mainThreadDocuments=this._toDispose.add(new e$(e,this._modelService,this._textFileService,r,a,l,g,u,v)),e.set(qe.MainThreadDocuments,this._mainThreadDocuments),this._mainThreadEditors=this._toDispose.add(new i$(this,e,o,this._editorService,this._editorGroupService,_,w,g)),e.set(qe.MainThreadTextEditors,this._mainThreadEditors),this._toDispose.add(new s$(C=>this._onDelta(C),t,o,this._editorService,d))}dispose(){this._toDispose.dispose()}_onDelta(e){const t=[],i=[],n=e.removedDocuments.map(a=>a.uri);for(const a of e.addedEditors){const c=new nFe(a.id,a.editor.getModel(),a.editor,{onGainedFocus(){},onLostFocus(){}},this._mainThreadDocuments,this._modelService,this._clipboardService);this._textEditors.set(a.id,c),i.push(c)}for(const{id:a}of e.removedEditors){const c=this._textEditors.get(a);c&&(c.dispose(),this._textEditors.delete(a),t.push(a))}const o=Object.create(null);let r=!0;e.newActiveEditor!==void 0&&(r=!1,o.newActiveEditor=e.newActiveEditor),n.length>0&&(r=!1,o.removedDocuments=n),t.length>0&&(r=!1,o.removedEditors=t),e.addedDocuments.length>0&&(r=!1,o.addedDocuments=e.addedDocuments.map(a=>this._toModelAddData(a))),e.addedEditors.length>0&&(r=!1,o.addedEditors=i.map(a=>this._toTextEditorAddData(a))),r||(this._proxy.$acceptDocumentsAndEditorsDelta(o),n.forEach(this._mainThreadDocuments.handleModelRemoved,this._mainThreadDocuments),e.addedDocuments.forEach(this._mainThreadDocuments.handleModelAdded,this._mainThreadDocuments),t.forEach(this._mainThreadEditors.handleTextEditorRemoved,this._mainThreadEditors),i.forEach(this._mainThreadEditors.handleTextEditorAdded,this._mainThreadEditors))}_toModelAddData(e){return{uri:e.uri,versionId:e.getVersionId(),lines:e.getLinesContent(),EOL:e.getEOL(),languageId:e.getLanguageId(),isDirty:this._textFileService.isDirty(e.uri),encoding:this._textFileService.getEncoding(e.uri)}}_toTextEditorAddData(e){const t=e.getProperties();return{id:e.getId(),documentUri:e.getModel().uri,options:t.options,selections:t.selections,visibleRanges:t.visibleRanges,editorPosition:this._findEditorPosition(e)}}_findEditorPosition(e){for(const t of this._editorService.visibleEditorPanes)if(e.matches(t))return Qp(this._editorGroupService,t.group)}findTextEditorIdFor(e){for(const[t,i]of this._textEditors)if(i.matches(e))return t}getIdOfCodeEditor(e){for(const[t,i]of this._textEditors)if(i.getCodeEditor()===e)return t}getEditor(e){return this._textEditors.get(e)}};AJ=f([c_,p(1,ci),p(2,Ps),p(3,de),p(4,Bt),p(5,je),p(6,Ci),p(7,xe),p(8,da),p(9,wn),p(10,dg),p(11,nn),p(12,Vs),p(13,_c),p(14,ne),p(15,Fq)],AJ);class oFe extends F{constructor(e,t){super();const i=()=>{t()?.windowDidDragStart()},n=()=>{t()?.windowDidDragEnd()};this._register(re(e,pe.DRAG_START,()=>{i()})),this._register(re(e,pe.DRAG_END,n)),this._register(re(e,pe.MOUSE_MOVE,o=>{o.buttons===0&&n()})),this._register(re(e,pe.DRAG,o=>{o.shiftKey?n():i()})),this._register(re(e,pe.DRAG_OVER,o=>{o.shiftKey?n():i()}))}}class pr extends dl{static{this.typeId="workbench.editors.webviewInput"}get typeId(){return pr.typeId}get editorId(){return this.viewType}get capabilities(){return Je.Readonly|Je.Singleton|Je.CanDropIntoEditor}get resource(){return R.from({scheme:ae.webviewPanel,path:`webview-panel/webview-${this._resourceId}`})}constructor(e,t,i){super(),this._iconManager=i,this._resourceId=Pn(),this._hasTransfered=!1,this.viewType=e.viewType,this.providedId=e.providedId,this._name=e.name,this._webview=t}dispose(){this.isDisposed()||this._hasTransfered||this._webview?.dispose(),super.dispose()}getName(){return this._name}getTitle(e){return this.getName()}getDescription(){}setName(e){this._name=e,this.webview.setTitle(e),this._onDidChangeLabel.fire()}get webview(){return this._webview}get extension(){return this.webview.extension}get iconPath(){return this._iconPath}set iconPath(e){this._iconPath=e,this._iconManager.setIcons(this._resourceId,e)}matches(e){return super.matches(e)||e===this}get group(){return this._group}updateGroup(e){this._group=e}transfer(e){if(!this._hasTransfered)return this._hasTransfered=!0,e._webview=this._webview,e}claim(e,t,i){return this._webview.claim(e,t,i)}}var o$;const rFe=new O("activeWebviewPanelId","",{type:"string",description:h(11480,"The viewType of the currently active webview panel.")});let RJ=class extends Mu{static{o$=this}static{this.ID="WebviewEditor"}get onDidFocus(){return this._onDidFocusWebview.event}constructor(e,t,i,n,o,r,a,c,d){super(o$.ID,e,t,i,n),this._editorGroupsService=o,this._editorService=r,this._workbenchLayoutService=a,this._hostService=c,this._contextKeyService=d,this._visible=!1,this._isDisposed=!1,this._webviewVisibleDisposables=this._register(new U),this._onFocusWindowHandler=this._register(new Pt),this._onDidFocusWebview=this._register(new M),this._scopedContextKeyService=this._register(new Pt);const l=o.getPart(e);this._register(T.any(l.onDidScroll,l.onDidAddGroup,l.onDidRemoveGroup,l.onDidMoveGroup)(()=>{this.webview&&this._visible&&this.synchronizeWebviewContainerDimensions(this.webview)}))}get webview(){return this.input instanceof pr?this.input.webview:void 0}get scopedContextKeyService(){return this._scopedContextKeyService.value}createEditor(e){const t=document.createElement("div");this._element=t,this._element.id=`webview-editor-element-${Pn()}`,e.appendChild(t),this._scopedContextKeyService.value=this._register(this._contextKeyService.createScoped(t))}dispose(){this._isDisposed=!0,this._element?.remove(),this._element=void 0,super.dispose()}layout(e){this._dimension=e,this.webview&&this._visible&&this.synchronizeWebviewContainerDimensions(this.webview,e)}focus(){super.focus(),!this._onFocusWindowHandler.value&&!Kt&&(this._onFocusWindowHandler.value=this._hostService.onDidChangeFocus(e=>{e&&this._editorService.activeEditorPane===this&&this._workbenchLayoutService.hasFocus(ot.EDITOR_PART)&&this.focus()})),this.webview?.focus()}setEditorVisible(e){this._visible=e,this.input instanceof pr&&this.webview&&(e?this.claimWebview(this.input):this.webview.release(this)),super.setEditorVisible(e)}clearInput(){this.webview&&(this.webview.release(this),this._webviewVisibleDisposables.clear()),super.clearInput()}async setInput(e,t,i,n){if(this.input&&e.matches(this.input))return;const o=e instanceof pr&&e.webview===this.webview;this.webview&&!o&&this.webview.release(this),await super.setInput(e,t,i,n),await e.resolve(),!(n.isCancellationRequested||this._isDisposed)&&e instanceof pr&&(e.updateGroup(this.group.id),o||this.claimWebview(e),this._dimension&&this.layout(this._dimension))}claimWebview(e){e.claim(this,this.window,this.scopedContextKeyService),this._element&&(this._element.setAttribute("aria-flowto",e.webview.container.id),abe(e.webview.container,this._element)),this._webviewVisibleDisposables.clear(),this._webviewVisibleDisposables.add(this._editorGroupsService.createEditorDropTarget(e.webview.container,{containsGroup:t=>this.group.id===t.id})),this._webviewVisibleDisposables.add(new oFe(this.window,()=>this.webview)),this.synchronizeWebviewContainerDimensions(e.webview),this._webviewVisibleDisposables.add(this.trackFocus(e.webview))}synchronizeWebviewContainerDimensions(e,t){if(!this._element?.isConnected)return;const i=this._workbenchLayoutService.getContainer(this.window,ot.EDITOR_PART);e.layoutWebviewOverElement(this._element.parentElement,t,i)}trackFocus(e){const t=new U,i=Fo(e.container);return t.add(i),t.add(i.onDidFocus(()=>this._onDidFocusWebview.fire())),t.add(e.onDidFocus(()=>this._onDidFocusWebview.fire())),t}};RJ=o$=f([p(1,ai),p(2,pt),p(3,it),p(4,xe),p(5,de),p(6,yi),p(7,Hn),p(8,fe)],RJ);let r$=class extends F{constructor(e,t){super(),this._lifecycleService=e,this._configService=t,this._icons=new Map,this._register(this._configService.onDidChangeConfiguration(i=>{i.affectsConfiguration("workbench.iconTheme")&&this.updateStyleSheet()}))}dispose(){super.dispose(),this._styleElement=void 0}get styleElement(){return this._styleElement||(this._styleElement=iN(void 0,void 0,this._store),this._styleElement.className="webview-icons"),this._styleElement}setIcons(e,t){t?this._icons.set(e,t):this._icons.delete(e),this.updateStyleSheet()}async updateStyleSheet(){await this._lifecycleService.when(mc.Starting);const e=[];if(this._configService.getValue("workbench.iconTheme")!==null)for(const[t,i]of this._icons){const n=`.show-file-icons .webview-${t}-name-file-icon::before`;try{e.push(`.monaco-workbench.vs ${n}, .monaco-workbench.hc-light ${n} { content: ""; background-image: ${hy(i.light)}; }`,`.monaco-workbench.vs-dark ${n}, .monaco-workbench.hc-black ${n} { content: ""; background-image: ${hy(i.dark)}; }`)}catch{}}this.styleElement.textContent=e.join(`
`)}};r$=f([p(0,wd),p(1,ne)],r$);function hL(s,e){return s.canResolve(e)}let wv=class extends pr{constructor(e,t,i){super(e,t,i.iconManager),this._webviewWorkbenchService=i,this._resolved=!1}dispose(){super.dispose(),this._resolvePromise?.cancel(),this._resolvePromise=void 0}async resolve(){if(!this._resolved){this._resolved=!0,this._resolvePromise=Tn(e=>this._webviewWorkbenchService.resolveWebview(this,e));try{await this._resolvePromise}catch(e){if(!ys(e))throw e}}return super.resolve()}transfer(e){if(super.transfer(e))return e._resolved=this._resolved,e}};wv.__decorator=f([Gt],wv.prototype,"resolve",null);wv=f([p(2,DI)],wv);class aFe{constructor(){this._awaitingRevival=[]}enqueueForRestoration(e,t){const i=new aa,n=()=>{const r=this._awaitingRevival.findIndex(a=>e===a.input);r>=0&&this._awaitingRevival.splice(r,1)},o=Wo(e.webview.onDidDispose(n),t.onCancellationRequested(()=>{n(),i.cancel()}));return this._awaitingRevival.push({input:e,promise:i,disposable:o}),i.p}reviveFor(e,t){const i=this._awaitingRevival.filter(({input:n})=>hL(e,n));this._awaitingRevival=this._awaitingRevival.filter(({input:n})=>!hL(e,n));for(const{input:n,promise:o,disposable:r}of i)e.resolveWebview(n,t).then(a=>o.complete(a),a=>o.error(a)).finally(()=>{r.dispose()})}}let PJ=class extends F{constructor(e,t,i,n){super(),this._editorService=t,this._instantiationService=i,this._webviewService=n,this._revivers=new Set,this._revivalPool=new aFe,this._onDidChangeActiveWebviewEditor=this._register(new M),this.onDidChangeActiveWebviewEditor=this._onDidChangeActiveWebviewEditor.event,this._iconManager=this._register(this._instantiationService.createInstance(r$)),this._register(e.registerContextKeyProvider({contextKey:rFe,getGroupContextKeyValue:o=>this.getWebviewId(o.activeEditor)})),this._register(t.onDidActiveEditorChange(()=>{this.updateActiveWebview()})),this._register(n.onDidChangeActiveWebview(()=>{this.updateActiveWebview()})),this.updateActiveWebview()}get iconManager(){return this._iconManager}getWebviewId(e){let t;return e instanceof pr?t=e:e instanceof go&&(e.primary instanceof pr?t=e.primary:e.secondary instanceof pr&&(t=e.secondary)),t?.webview.providedViewType??""}updateActiveWebview(){const e=this._editorService.activeEditor;let t;e instanceof pr?t=e:e instanceof go&&(e.primary instanceof pr&&e.primary.webview===this._webviewService.activeWebview?t=e.primary:e.secondary instanceof pr&&e.secondary.webview===this._webviewService.activeWebview&&(t=e.secondary)),t!==this._activeWebview&&(this._activeWebview=t,this._onDidChangeActiveWebviewEditor.fire(t))}openWebview(e,t,i,n){const o=this._webviewService.createWebviewOverlay(e),r=this._instantiationService.createInstance(pr,{viewType:t,name:i,providedId:e.providedViewType},o,this.iconManager);return this._editorService.openEditor(r,{pinned:!0,preserveFocus:n.preserveFocus,activation:n.preserveFocus?qc.RESTORE:void 0},n.group),r}revealWebview(e,t,i){const n=this.findTopLevelEditorForWebview(e);this._editorService.openEditor(n,{preserveFocus:i,activation:i?qc.RESTORE:void 0},t)}findTopLevelEditorForWebview(e){for(const t of this._editorService.editors)if(t===e||t instanceof go&&(e===t.primary||e===t.secondary))return t;return e}openRevivedWebview(e){const t=this._webviewService.createWebviewOverlay(e.webviewInitInfo);t.state=e.state;const i=this._instantiationService.createInstance(wv,{viewType:e.viewType,providedId:e.webviewInitInfo.providedViewType,name:e.title},t);return i.iconPath=e.iconPath,typeof e.group=="number"&&i.updateGroup(e.group),i}registerResolver(e){this._revivers.add(e);const t=new li;return this._revivalPool.reviveFor(e,t.token),Ie(()=>{this._revivers.delete(e),t.dispose(!0)})}shouldPersist(e){return e instanceof wv?!0:As.some(this._revivers.values(),t=>hL(t,e))}async tryRevive(e,t){for(const i of this._revivers.values())if(hL(i,e))return await i.resolveWebview(e,t),!0;return!1}async resolveWebview(e,t){if(!await this.tryRevive(e,t)&&!t.isCancellationRequested)return this._revivalPool.enqueueForRestoration(e,t)}setIcons(e,t){this._iconManager.setIcons(e,t)}};PJ=f([p(0,xe),p(1,de),p(2,Z),p(3,ON)],PJ);var M_;let Yb=class extends wv{static{M_=this}static create(e,t,i,n,o){return e.invokeFunction(r=>{const a=r.get(aq).getValue(t),c=a?Le.fromString(a):void 0,d=r.get(ON).createWebviewOverlay({providedViewType:i,title:void 0,options:{customClasses:o?.customClasses},contentOptions:{},extension:void 0}),l=e.createInstance(M_,{resource:t,viewType:i},d,{untitledDocumentData:c,oldResource:o?.oldResource});return typeof n<"u"&&l.updateGroup(n),l})}static{this.typeId="workbench.editors.webviewEditor"}get resource(){return this._editorResource}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super({providedId:e.viewType,viewType:e.viewType,name:""},t,n),this.instantiationService=o,this.labelService=r,this.customEditorService=a,this.fileDialogService=c,this.undoRedoService=d,this.fileService=l,this.filesConfigurationService=u,this.editorGroupsService=g,this.layoutService=m,this.customEditorLabelService=v,this._editorName=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._editorResource=e.resource,this.oldResource=i.oldResource,this._defaultDirtyState=i.startsDirty,this._backupId=i.backupId,this._untitledDocumentData=i.untitledDocumentData,this.registerListeners()}registerListeners(){this._register(this.labelService.onDidChangeFormatters(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onLabelEvent(e.scheme))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onLabelEvent(e.scheme))),this._register(this.customEditorLabelService.onDidChange(()=>this.updateLabel())),this._register(this.filesConfigurationService.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire()))}onLabelEvent(e){e===this.resource.scheme&&this.updateLabel()}updateLabel(){this._editorName=void 0,this._shortDescription=void 0,this._mediumDescription=void 0,this._longDescription=void 0,this._shortTitle=void 0,this._mediumTitle=void 0,this._longTitle=void 0,this._onDidChangeLabel.fire()}get typeId(){return M_.typeId}get editorId(){return this.viewType}get capabilities(){let e=Je.None;return e|=Je.CanDropIntoEditor,this.customEditorService.getCustomEditorCapabilities(this.viewType)?.supportsMultipleEditorsPerDocument||(e|=Je.Singleton),this._modelRef?this._modelRef.object.isReadonly()&&(e|=Je.Readonly):this.filesConfigurationService.isReadonly(this.resource)&&(e|=Je.Readonly),this.resource.scheme===ae.untitled&&(e|=Je.Untitled),e}getName(){return typeof this._editorName!="string"&&(this._editorName=this.customEditorLabelService.getName(this.resource)??an(this.labelService.getUriLabel(this.resource))),this._editorName}getDescription(e=Ot.MEDIUM){switch(e){case Ot.SHORT:return this.shortDescription;case Ot.LONG:return this.longDescription;case Ot.MEDIUM:default:return this.mediumDescription}}get shortDescription(){return typeof this._shortDescription!="string"&&(this._shortDescription=this.labelService.getUriBasenameLabel(_s(this.resource))),this._shortDescription}get mediumDescription(){return typeof this._mediumDescription!="string"&&(this._mediumDescription=this.labelService.getUriLabel(_s(this.resource),{relative:!0})),this._mediumDescription}get longDescription(){return typeof this._longDescription!="string"&&(this._longDescription=this.labelService.getUriLabel(_s(this.resource))),this._longDescription}get shortTitle(){return typeof this._shortTitle!="string"&&(this._shortTitle=this.getName()),this._shortTitle}get mediumTitle(){return typeof this._mediumTitle!="string"&&(this._mediumTitle=this.labelService.getUriLabel(this.resource,{relative:!0})),this._mediumTitle}get longTitle(){return typeof this._longTitle!="string"&&(this._longTitle=this.labelService.getUriLabel(this.resource)),this._longTitle}getTitle(e){switch(e){case Ot.SHORT:return this.shortTitle;case Ot.LONG:return this.longTitle;default:case Ot.MEDIUM:return this.mediumTitle}}matches(e){return super.matches(e)?!0:this===e||e instanceof M_&&this.viewType===e.viewType&&At(this.resource,e.resource)}copy(){return M_.create(this.instantiationService,this.resource,this.viewType,this.group,this.webview.options)}isReadonly(){return this._modelRef?this._modelRef.object.isReadonly():this.filesConfigurationService.isReadonly(this.resource)}isDirty(){return this._modelRef?this._modelRef.object.isDirty():!!this._defaultDirtyState}async save(e,t){if(!this._modelRef)return;const i=await this._modelRef.object.saveCustomEditor(t);if(i)return At(i,this.resource)?this:{resource:i}}async saveAs(e,t){if(!this._modelRef)return;const i=this._editorResource,n=await this.fileDialogService.pickFileToSave(i,t?.availableFileSystems);if(n&&await this._modelRef.object.saveCustomEditorAs(this._editorResource,n,t))return(await this.rename(e,n))?.editor}async revert(e,t){if(this._modelRef)return this._modelRef.object.revert(t);this._defaultDirtyState=!1,this._onDidChangeDirty.fire()}async resolve(){if(await super.resolve(),this.isDisposed())return null;if(!this._modelRef){const e=this.capabilities;this._modelRef=this._register(jt(await this.customEditorService.models.tryRetain(this.resource,this.viewType))),this._register(this._modelRef.object.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this._modelRef.object.onDidChangeReadonly(()=>this._onDidChangeCapabilities.fire())),this._untitledDocumentData&&(this._defaultDirtyState=!0),this.isDirty()&&this._onDidChangeDirty.fire(),this.capabilities!==e&&this._onDidChangeCapabilities.fire()}return null}async rename(e,t){return{editor:{resource:t}}}undo(){return jt(this._modelRef),this.undoRedoService.undo(this.resource)}redo(){return jt(this._modelRef),this.undoRedoService.redo(this.resource)}onMove(e){this._moveHandler=e}transfer(e){if(super.transfer(e))return e._moveHandler=this._moveHandler,this._moveHandler=void 0,e}get backupId(){return this._modelRef?this._modelRef.object.backupId:this._backupId}get untitledDocumentData(){return this._untitledDocumentData}toUntyped(){return{resource:this.resource,options:{override:this.viewType}}}claim(e,t,i){if(this.doCanMove(t.vscodeWindowId)!==!0)throw fCe(h(5399,"Unable to open the editor in this window, it contains modifications that can only be saved in the original window."),[Ri({id:"openInOriginalWindow",label:h(5400,"Open in Original Window"),run:async()=>{const n=this.editorGroupsService.getPart(this.layoutService.getContainer(Et(this.webview.container).window));this.editorGroupsService.getPart(this.layoutService.getContainer(t.window)).activeGroup.moveEditor(this,n.activeGroup)}})],{forceMessage:!0});return super.claim(e,t,i)}canMove(e,t){const i=this.editorGroupsService.getGroup(t);if(i){const n=this.doCanMove(i.windowId);if(typeof n=="string")return n}return super.canMove(e,t)}doCanMove(e){return this.isModified()&&this._modelRef?.object.canHotExit===!1&&Et(this.webview.container).vscodeWindowId!==e?h(5401,"Unable to move '{0}': The editor contains changes that can only be saved in its current window.",this.getName()):!0}};Yb=M_=f([p(3,DI),p(4,Z),p(5,ui),p(6,Lq),p(7,to),p(8,HM),p(9,je),p(10,Us),p(11,xe),p(12,yi),p(13,pg)],Yb);var N_;let a$=class extends dl{static{N_=this}static create(e,t,i,n,o){return e.createInstance(N_,t,i,n,o)}static{this.windowNames={}}static setName(e,t){t&&(this.windowNames[e.path]=t)}static{this.ID="workbench.input.interactive"}get editorId(){return"interactive"}get typeId(){return N_.ID}get language(){return this._inputModelRef?.object.textEditorModel.getLanguageId()??this._initLanguage}get notebookEditorInput(){return this._notebookEditorInput}get editorInputs(){return[this._notebookEditorInput]}get resource(){return this._resource}get inputResource(){return this._inputResource}get primary(){return this._notebookEditorInput}constructor(e,t,i,n,o,r,a,c,d,l,u){const g=Fm.getOrCreate(o,e,void 0,"interactive",{});super(),this._notebookService=d,this._fileDialogService=l,this.isScratchpad=u.getValue(Moe.InteractiveWindowPromptToSave)!==!0,this._notebookEditorInput=g,this._register(this._notebookEditorInput),this.name=i??N_.windowNames[e.path]??an(e.path,XM(e.path)),this._initLanguage=n,this._resource=e,this._inputResource=t,this._inputResolver=null,this._editorModelReference=null,this._inputModelRef=null,this._textModelService=r,this._interactiveDocumentService=a,this._historyService=c,this._registerListeners()}_registerListeners(){const e=T.once(this.primary.onWillDispose);this._register(e(()=>{this.isDisposed()||this.dispose()})),this._register(this.primary.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.primary.onDidChangeLabel(()=>this._onDidChangeLabel.fire())),this._register(this.primary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire()))}get capabilities(){const e=this.isScratchpad?Je.Scratchpad:0;return Je.Untitled|Je.Readonly|e}async _resolveEditorModel(){return this._editorModelReference||(this._editorModelReference=await this._notebookEditorInput.resolve()),this._editorModelReference}async resolve(){return this._editorModelReference?this._editorModelReference:this._inputResolver?this._inputResolver:(this._inputResolver=this._resolveEditorModel(),this._inputResolver)}async resolveInput(e){if(this._inputModelRef)return this._inputModelRef.object.textEditorModel;const t=e??this._initLanguage??WM;return this._interactiveDocumentService.willCreateInteractiveDocument(this.resource,this.inputResource,t),this._inputModelRef=await this._textModelService.createModelReference(this.inputResource),this._inputModelRef.object.textEditorModel}async save(e,t){if(this._editorModelReference)return this.hasCapability(Je.Untitled)?this.saveAs(e,t):(await this._editorModelReference.save(t),this)}async saveAs(e,t){if(!this._editorModelReference||!this._notebookService.getContributedNotebookType("interactive"))return;const n=this.getName()+".ipynb",o=Ct(await this._fileDialogService.defaultFilePath(),n),r=await this._fileDialogService.pickFileToSave(o,t?.availableFileSystems);if(!r)return;const a=await this._editorModelReference.saveAs(r);return a&&"resource"in a&&a.resource&&this._notebookService.getNotebookTextModel(a.resource)?.dispose(),a}matches(e){return super.matches(e)?!0:e instanceof N_?At(this.resource,e.resource)&&At(this.inputResource,e.inputResource):!1}getName(){return this.name}isDirty(){return this.isScratchpad?!1:this._editorModelReference?.isDirty()??!1}isModified(){return this._editorModelReference?.isModified()??!1}async revert(e,t){this._editorModelReference&&this._editorModelReference.isDirty()&&await this._editorModelReference.revert(t)}dispose(){this._editorModelReference?.revert({soft:!0}),this._notebookEditorInput?.dispose(),this._editorModelReference?.dispose(),this._editorModelReference=null,this._interactiveDocumentService.willRemoveInteractiveDocument(this.resource,this.inputResource),this._inputModelRef?.dispose(),this._inputModelRef=null,super.dispose()}get historyService(){return this._historyService}};a$=N_=f([p(4,Z),p(5,Ci),p(6,Oq),p(7,Cre),p(8,bl),p(9,to),p(10,ne)],a$);class Xs{static{this.compareByStart=rd(e=>e.startLineNumber,fl)}static join(e){if(e.length===0)return;let t=Number.MAX_SAFE_INTEGER,i=0;for(const n of e)t=Math.min(t,n.startLineNumber),i=Math.max(i,n.startLineNumber+n.lineCount);return new Xs(t,i-t)}static fromLineNumbers(e,t){return new Xs(e,t-e)}constructor(e,t){if(this.startLineNumber=e,this.lineCount=t,t<0)throw new tn}join(e){return Xs.fromLineNumbers(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}get endLineNumberExclusive(){return this.startLineNumber+this.lineCount}get isEmpty(){return this.lineCount===0}touches(e){return this.endLineNumberExclusive>=e.startLineNumber&&e.endLineNumberExclusive>=this.startLineNumber}isAfter(e){return this.startLineNumber>=e.endLineNumberExclusive}isBefore(e){return e.startLineNumber>=this.endLineNumberExclusive}delta(e){return new Xs(this.startLineNumber+e,this.lineCount)}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}equals(e){return this.startLineNumber===e.startLineNumber&&this.lineCount===e.lineCount}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}deltaEnd(e){return new Xs(this.startLineNumber,this.lineCount+e)}deltaStart(e){return new Xs(this.startLineNumber+e,this.lineCount-e)}getLines(e){const t=new Array(this.lineCount);for(let i=0;i<this.lineCount;i++)t[i]=e.getLineContent(this.startLineNumber+i);return t}containsRange(e){return this.startLineNumber<=e.startLineNumber&&e.endLineNumberExclusive<=this.endLineNumberExclusive}toRange(){return new P(this.startLineNumber,1,this.endLineNumberExclusive,1)}toInclusiveRange(){if(!this.isEmpty)return new P(this.startLineNumber,1,this.endLineNumberExclusive-1,Ia.MAX_SAFE_SMALL_INTEGER)}toInclusiveRangeOrEmpty(){return this.isEmpty?new P(this.startLineNumber,1,this.startLineNumber,1):new P(this.startLineNumber,1,this.endLineNumberExclusive-1,Ia.MAX_SAFE_SMALL_INTEGER)}intersects(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}}const cFe={start:"<<<<<<<"};class Px{constructor(e,t){this.range=e,this.newLines=t}equals(e){return this.range.equals(e.range)&&rs(this.newLines,e.newLines)}toEdits(e){return new lFe([this]).toEdits(e)}}class dFe{constructor(e,t){this.range=e,this.newText=t}equals(e){return P.equalsRange(this.range,e.range)&&this.newText===e.newText}}class lFe{constructor(e){this.edits=e}toEdits(e){return this.edits.map(t=>t.range.endLineNumberExclusive<=e?{range:new P(t.range.startLineNumber,1,t.range.endLineNumberExclusive,1),text:t.newLines.map(i=>i+`
`).join("")}:t.range.startLineNumber===1?{range:new P(1,1,e,Number.MAX_SAFE_INTEGER),text:t.newLines.join(`
`)}:{range:new P(t.range.startLineNumber-1,Number.MAX_SAFE_INTEGER,e,Number.MAX_SAFE_INTEGER),text:t.newLines.map(i=>`
`+i).join("")})}}function hFe(s,e){return!(e.lineNumber<s.startLineNumber||e.lineNumber>s.endLineNumber||e.lineNumber===s.startLineNumber&&e.column<s.startColumn||e.lineNumber===s.endLineNumber&&e.column>=s.endColumn)}function eJe(s){return s.startLineNumber===s.endLineNumber?new oc(0,s.endColumn-s.startColumn):new oc(s.endLineNumber-s.startLineNumber,s.endColumn-1)}function uFe(s,e){return s.lineNumber===e.lineNumber?new oc(0,e.column-s.column):new oc(e.lineNumber-s.lineNumber,e.column-1)}function gFe(s,e){return e.lineCount===0?new we(s.lineNumber,s.column+e.columnCount):new we(s.lineNumber+e.lineCount,e.columnCount+1)}function LJ(s,e){return s.endLineNumber<e.startLineNumber||s.endLineNumber===e.startLineNumber&&s.endColumn<=e.startColumn}class br{static join(e){return e.reduce((t,i)=>t?t.join(i):i,void 0)}constructor(e,t){this.inputRange=e,this.outputRange=t}extendInputRange(e){if(!e.containsRange(this.inputRange))throw new tn;const t=e.startLineNumber-this.inputRange.startLineNumber,i=e.endLineNumberExclusive-this.inputRange.endLineNumberExclusive;return new br(e,new Xs(this.outputRange.startLineNumber+t,this.outputRange.lineCount-t+i))}join(e){return new br(this.inputRange.join(e.inputRange),this.outputRange.join(e.outputRange))}get resultingDeltaFromOriginalToModified(){return this.outputRange.endLineNumberExclusive-this.inputRange.endLineNumberExclusive}toString(){return`${this.inputRange.toString()} -> ${this.outputRange.toString()}`}addOutputLineDelta(e){return new br(this.inputRange,this.outputRange.delta(e))}addInputLineDelta(e){return new br(this.inputRange.delta(e),this.outputRange)}reverse(){return new br(this.outputRange,this.inputRange)}}class ym{static betweenOutputs(e,t,i){const o=f0.compute(e,t).map(r=>new br(r.output1Range,r.output2Range));return new ym(o,i)}constructor(e,t){this.lineRangeMappings=e,this.inputLineCount=t,dI(()=>sN(e,(i,n)=>i.inputRange.isBefore(n.inputRange)&&i.outputRange.isBefore(n.outputRange)&&n.inputRange.startLineNumber-i.inputRange.endLineNumberExclusive===n.outputRange.startLineNumber-i.outputRange.endLineNumberExclusive))}project(e){const t=GM(this.lineRangeMappings,o=>o.inputRange.startLineNumber<=e);if(!t)return new br(new Xs(e,1),new Xs(e,1));if(t.inputRange.contains(e))return t;const i=new Xs(e,1),n=new Xs(e+t.outputRange.endLineNumberExclusive-t.inputRange.endLineNumberExclusive,1);return new br(i,n)}get outputLineCount(){const e=this.lineRangeMappings.at(-1),t=e?e.outputRange.endLineNumberExclusive-e.inputRange.endLineNumberExclusive:0;return this.inputLineCount+t}reverse(){return new ym(this.lineRangeMappings.map(e=>e.reverse()),this.outputLineCount)}}class f0{static compute(e,t){const i=rd(l=>l.inputRange.startLineNumber,fl),n=Zne(e.map(l=>({source:0,diff:l})),t.map(l=>({source:1,diff:l}))).sort(rd(l=>l.diff,i)),o=[new Array,new Array],r=[0,0],a=new Array;function c(l){const u=br.join(o[0])||new br(l,l.delta(r[0])),g=br.join(o[1])||new br(l,l.delta(r[1]));a.push(new f0(d,u.extendInputRange(d).outputRange,o[0],g.extendInputRange(d).outputRange,o[1])),o[0]=[],o[1]=[]}let d;for(const l of n){const u=l.diff.inputRange;d&&!d.touches(u)&&(c(d),d=void 0),r[l.source]=l.diff.resultingDeltaFromOriginalToModified,d=d?d.join(u):u,o[l.source].push(l.diff)}return d&&c(d),a}constructor(e,t,i,n,o){this.inputRange=e,this.output1Range=t,this.output1LineMappings=i,this.output2Range=n,this.output2LineMappings=o}toString(){return`${this.output1Range} <- ${this.inputRange} -> ${this.output2Range}`}}class Dp extends br{static join(e){return e.reduce((t,i)=>t?t.join(i):i,void 0)}constructor(e,t,i,n,o){super(e,i),this.inputTextModel=t,this.outputTextModel=n,this.rangeMappings=o||[new Nu(this.inputRange.toRange(),this.outputRange.toRange())]}addOutputLineDelta(e){return new Dp(this.inputRange,this.inputTextModel,this.outputRange.delta(e),this.outputTextModel,this.rangeMappings.map(t=>t.addOutputLineDelta(e)))}addInputLineDelta(e){return new Dp(this.inputRange.delta(e),this.inputTextModel,this.outputRange,this.outputTextModel,this.rangeMappings.map(t=>t.addInputLineDelta(e)))}join(e){return new Dp(this.inputRange.join(e.inputRange),this.inputTextModel,this.outputRange.join(e.outputRange),this.outputTextModel)}getLineEdit(){return new Px(this.inputRange,this.getOutputLines())}getReverseLineEdit(){return new Px(this.outputRange,this.getInputLines())}getOutputLines(){return this.outputRange.getLines(this.outputTextModel)}getInputLines(){return this.inputRange.getLines(this.inputTextModel)}}class Nu{constructor(e,t){this.inputRange=e,this.outputRange=t}toString(){function e(t){return`[${t.startLineNumber}:${t.startColumn}, ${t.endLineNumber}:${t.endColumn})`}return`${e(this.inputRange)} -> ${e(this.outputRange)}`}addOutputLineDelta(e){return new Nu(this.inputRange,new P(this.outputRange.startLineNumber+e,this.outputRange.startColumn,this.outputRange.endLineNumber+e,this.outputRange.endColumn))}addInputLineDelta(e){return new Nu(new P(this.inputRange.startLineNumber+e,this.inputRange.startColumn,this.inputRange.endLineNumber+e,this.inputRange.endColumn),this.outputRange)}reverse(){return new Nu(this.outputRange,this.inputRange)}}class mb{constructor(e,t){this.rangeMappings=e,this.inputLineCount=t,dI(()=>sN(e,(i,n)=>LJ(i.inputRange,n.inputRange)&&LJ(i.outputRange,n.outputRange)))}project(e){const t=GM(this.rangeMappings,o=>o.inputRange.getStartPosition().isBeforeOrEqual(e));if(!t)return new Nu(P.fromPositions(e,e),P.fromPositions(e,e));if(hFe(t.inputRange,e))return t;const i=uFe(t.inputRange.getEndPosition(),e),n=gFe(t.outputRange.getEndPosition(),i);return new Nu(P.fromPositions(e),P.fromPositions(n))}projectRange(e){const t=this.project(e.getStartPosition()),i=this.project(e.getEndPosition());return new Nu(t.inputRange.plusRange(i.inputRange),t.outputRange.plusRange(i.outputRange))}get outputLineCount(){const e=this.rangeMappings.at(-1),t=e?e.outputRange.endLineNumber-e.inputRange.endLineNumber:0;return this.inputLineCount+t}reverse(){return new mb(this.rangeMappings.map(e=>e.reverse()),this.outputLineCount)}}let uL=class{constructor(e,t){this.editorWorkerService=e,this.configurationService=t,this.mergeAlgorithm=Vse("mergeEditor.diffAlgorithm","advanced",this.configurationService).map(i=>i==="smart"?"legacy":i==="experimental"?"advanced":i)}async computeDiff(e,t,i){const n=this.mergeAlgorithm.read(i),o=e.getVersionId(),r=t.getVersionId(),a=await this.editorWorkerService.computeDiff(e.uri,t.uri,{ignoreTrimWhitespace:!1,maxComputationTimeMs:0,computeMoves:!1},n);if(!a)throw new Error("Diff computation failed");if(e.isDisposed()||t.isDisposed())return{diffs:null};const c=a.changes.map(u=>new Dp(MJ(u.original),e,MJ(u.modified),t,u.innerChanges?.map(g=>pFe(g)))),d=e.getVersionId(),l=t.getVersionId();return o!==d||r!==l?{diffs:null}:(dI(()=>{for(const u of c){const g=u.inputRange,m=u.outputRange,v=u.inputTextModel,_=u.outputTextModel;for(const w of u.rangeMappings){let C=g.startLineNumber-1<=w.inputRange.startLineNumber&&w.inputRange.endLineNumber<=g.endLineNumberExclusive;C&&w.inputRange.startLineNumber===g.startLineNumber-1&&(C=w.inputRange.endColumn>=v.getLineMaxColumn(w.inputRange.startLineNumber)),C&&w.inputRange.endLineNumber===g.endLineNumberExclusive&&(C=w.inputRange.endColumn===1);let k=m.startLineNumber-1<=w.outputRange.startLineNumber&&w.outputRange.endLineNumber<=m.endLineNumberExclusive;if(k&&w.outputRange.startLineNumber===m.startLineNumber-1&&(k=w.outputRange.endColumn>=_.getLineMaxColumn(w.outputRange.endLineNumber)),k&&w.outputRange.endLineNumber===m.endLineNumberExclusive&&(k=w.outputRange.endColumn===1),!C||!k)return!1}}return c.length===0||c[0].inputRange.startLineNumber===c[0].outputRange.startLineNumber&&sN(c,(u,g)=>g.inputRange.startLineNumber-u.inputRange.endLineNumberExclusive===g.outputRange.startLineNumber-u.outputRange.endLineNumberExclusive&&u.inputRange.endLineNumberExclusive<g.inputRange.startLineNumber&&u.outputRange.endLineNumberExclusive<g.outputRange.startLineNumber)}),{diffs:c})}};uL=f([p(0,vc),p(1,ne)],uL);function MJ(s){return new Xs(s.startLineNumber,s.length)}function pFe(s){return new Nu(s.originalRange,s.modifiedRange)}class fFe{constructor(){this._isOccupied=!1}runExclusivelyOrSkip(e){if(!this._isOccupied){this._isOccupied=!0;try{e()}finally{this._isOccupied=!1}}}runExclusivelyOrThrow(e){if(this._isOccupied)throw new tn("ReentrancyBarrier: reentrant call detected!");this._isOccupied=!0;try{e()}finally{this._isOccupied=!1}}get isOccupied(){return this._isOccupied}makeExclusiveOrSkip(e){return(...t)=>{if(!this._isOccupied){this._isOccupied=!0;try{return e(...t)}finally{this._isOccupied=!1}}}}}class Y1 extends F{get isApplyingChange(){return this._barrier.isOccupied}constructor(e,t,i){super(),this.baseTextModel=e,this.textModel=t,this.diffComputer=i,this._recomputeCount=0,this._state=si(this,Ka.initializing),this._diffs=si(this,[]),this._barrier=new fFe,this._isDisposed=!1,this._isInitializing=!0;const n=Kd("recompute");this._register(fi(o=>{n.read(o),this._recompute(o)})),this._register(e.onDidChangeContent(this._barrier.makeExclusiveOrSkip(()=>{n.trigger(void 0)}))),this._register(t.onDidChangeContent(this._barrier.makeExclusiveOrSkip(()=>{n.trigger(void 0)}))),this._register(Ie(()=>{this._isDisposed=!0}))}get state(){return this._state}get diffs(){return this._diffs}_recompute(e){this._recomputeCount++;const t=this._recomputeCount;this._state.get()===Ka.initializing&&(this._isInitializing=!0),gs(n=>{this._state.set(this._isInitializing?Ka.initializing:Ka.updating,n,hu.other)}),this.diffComputer.computeDiff(this.baseTextModel,this.textModel,e).then(n=>{this._isDisposed||t===this._recomputeCount&&gs(o=>{n.diffs?(this._state.set(Ka.upToDate,o,hu.textChange),this._diffs.set(n.diffs,o,hu.textChange)):this._state.set(Ka.error,o,hu.textChange),this._isInitializing=!1})})}ensureUpToDate(){if(this.state.get()!==Ka.upToDate)throw new tn("Cannot remove diffs when the model is not up to date")}removeDiffs(e,t,i){this.ensureUpToDate(),e.sort(rd(o=>o.inputRange.startLineNumber,fl)),e.reverse();let n=this._diffs.get();for(const o of e){const r=n.length;if(n=n.filter(a=>a!==o),r===n.length)throw new tn;this._barrier.runExclusivelyOrThrow(()=>{const a=o.getReverseLineEdit().toEdits(this.textModel.getLineCount());this.textModel.pushEditOperations(null,a,()=>null,i)}),n=n.map(a=>a.outputRange.isAfter(o.outputRange)?a.addOutputLineDelta(o.inputRange.lineCount-o.outputRange.lineCount):a)}this._diffs.set(n,t,hu.other)}applyEditRelativeToOriginal(e,t,i){this.ensureUpToDate();const n=new Dp(e.range,this.baseTextModel,new Xs(e.range.startLineNumber,e.newLines.length),this.textModel);let o=!1,r=0;const a=new Array;for(const c of this.diffs.get()){if(c.inputRange.touches(e.range))throw new tn("Edit must be conflict free.");c.inputRange.isAfter(e.range)?(o||(o=!0,a.push(n.addOutputLineDelta(r))),a.push(c.addOutputLineDelta(e.newLines.length-e.range.lineCount))):a.push(c),o||(r+=c.outputRange.lineCount-c.inputRange.lineCount)}o||(o=!0,a.push(n.addOutputLineDelta(r))),this._barrier.runExclusivelyOrThrow(()=>{const c=new Px(e.range.delta(r),e.newLines).toEdits(this.textModel.getLineCount());this.textModel.pushEditOperations(null,c,()=>null,i)}),this._diffs.set(a,t,hu.other)}findTouchingDiffs(e){return this.diffs.get().filter(t=>t.inputRange.touches(e))}getResultLine(e,t){let i=0;const n=t?this.diffs.read(t):this.diffs.get();for(const o of n){if(o.inputRange.contains(e)||o.inputRange.endLineNumberExclusive===e)return o;if(o.inputRange.endLineNumberExclusive<e)i=o.resultingDeltaFromOriginalToModified;else break}return e+i}getResultLineRange(e,t){let i=this.getResultLine(e.startLineNumber,t);typeof i!="number"&&(i=i.outputRange.startLineNumber);let n=this.getResultLine(e.endLineNumberExclusive,t);return typeof n!="number"&&(n=n.outputRange.endLineNumberExclusive),Xs.fromLineNumbers(i,n)}}var hu;(function(s){s[s.other=0]="other",s[s.textChange=1]="textChange"})(hu||(hu={}));var Ka;(function(s){s[s.initializing=1]="initializing",s[s.upToDate=2]="upToDate",s[s.updating=3]="updating",s[s.error=4]="error"})(Ka||(Ka={}));function iJe(s,e){Object.entries(e).forEach(([t,i])=>{s.style.setProperty(t,mFe(i))})}function mFe(s){return typeof s=="number"?`${s}px`:s}function nJe(s,e){const t=new U;let i=[];return t.add(cbe({debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const o=e.read(n);s.changeDecorations(r=>{i=r.deltaDecorations(i,o)})})),t.add({dispose:()=>{s.changeDecorations(n=>{i=n.deltaDecorations(i,[])})}}),t}function*vFe(s,e,t){const i=new Jne(e);for(const n of s){i.takeWhile(r=>LE.isGreaterThan(t(n,r)));const o=i.takeWhile(r=>LE.isNeitherLessOrGreaterThan(t(n,r)));yield{left:n,rights:o||[]}}}function*sJe(s,e,t){const i=new Jne(e);for(const n of s){const o=i.takeWhile(a=>LE.isGreaterThan(t(n,a)));o&&(yield{rights:o});const r=i.takeWhile(a=>LE.isNeitherLessOrGreaterThan(t(n,a)));yield{left:n,rights:r||[]}}}function oJe(s,e){return Object.assign(s,e)}function _Fe(s,e){const t={};for(const i in s)t[i]=s[i];for(const i in e){const n=e[i];typeof t[i]=="object"&&n&&typeof n=="object"?t[i]=_Fe(t[i],n):t[i]=n}return t}let NJ=class{constructor(e,t){this.key=e,this.storageService=t,this.hasValue=!1,this.value=void 0}get(){if(!this.hasValue){const e=this.storageService.get(this.key,he.PROFILE);if(e!==void 0)try{this.value=JSON.parse(e)}catch(t){mt(t)}this.hasValue=!0}return this.value}set(e){this.value=e,this.storageService.store(this.key,JSON.stringify(this.value),he.PROFILE,gt.USER)}};NJ=f([p(1,it)],NJ);class e5{static fromDiffs(e,t,i,n,o){return f0.compute(e,t).map(a=>new e5(a.inputRange,i,a.output1Range,n,a.output1LineMappings,a.output2Range,o,a.output2LineMappings))}constructor(e,t,i,n,o,r,a,c){if(this.baseRange=e,this.baseTextModel=t,this.input1Range=i,this.input1TextModel=n,this.input1Diffs=o,this.input2Range=r,this.input2TextModel=a,this.input2Diffs=c,this.input1CombinedDiff=Dp.join(this.input1Diffs),this.input2CombinedDiff=Dp.join(this.input2Diffs),this.isEqualChange=rs(this.input1Diffs,this.input2Diffs,(d,l)=>d.getLineEdit().equals(l.getLineEdit())),this.smartInput1LineRangeEdit=null,this.smartInput2LineRangeEdit=null,this.dumbInput1LineRangeEdit=null,this.dumbInput2LineRangeEdit=null,this.input1Diffs.length===0&&this.input2Diffs.length===0)throw new tn("must have at least one diff")}getInputRange(e){return e===1?this.input1Range:this.input2Range}getInputCombinedDiff(e){return e===1?this.input1CombinedDiff:this.input2CombinedDiff}getInputDiffs(e){return e===1?this.input1Diffs:this.input2Diffs}get isConflicting(){return this.input1Diffs.length>0&&this.input2Diffs.length>0}get canBeCombined(){return this.smartCombineInputs(1)!==void 0}get isOrderRelevant(){const e=this.smartCombineInputs(1),t=this.smartCombineInputs(2);return!e||!t?!1:!e.equals(t)}getEditForBase(e){const t=[];if(e.includesInput1&&this.input1CombinedDiff&&t.push({diff:this.input1CombinedDiff,inputNumber:1}),e.includesInput2&&this.input2CombinedDiff&&t.push({diff:this.input2CombinedDiff,inputNumber:2}),t.length===0)return{edit:void 0,effectiveState:ro.base};if(t.length===1)return{edit:t[0].diff.getLineEdit(),effectiveState:ro.base.withInputValue(t[0].inputNumber,!0,!1)};if(e.kind!==Wi.both)throw new tn;const i=e.smartCombination?this.smartCombineInputs(e.firstInput):this.dumbCombineInputs(e.firstInput);return i?{edit:i,effectiveState:e}:{edit:t[c$(e.firstInput)-1].diff.getLineEdit(),effectiveState:ro.base.withInputValue(c$(e.firstInput),!0,!1)}}smartCombineInputs(e){if(e===1&&this.smartInput1LineRangeEdit!==null)return this.smartInput1LineRangeEdit;if(e===2&&this.smartInput2LineRangeEdit!==null)return this.smartInput2LineRangeEdit;const i=Zne(this.input1Diffs.flatMap(o=>o.rangeMappings.map(r=>({diff:r,input:1}))),this.input2Diffs.flatMap(o=>o.rangeMappings.map(r=>({diff:r,input:2})))).sort(dbe(rd(o=>o.diff.inputRange,P.compareRangesUsingStarts),rd(o=>o.input===e?1:2,fl))).map(o=>{const r=o.input===1?this.input1TextModel:this.input2TextModel;return new dFe(o.diff.inputRange,r.getValueInRange(o.diff.outputRange))}),n=bFe(this.baseRange,i,this.baseTextModel);return e===1?this.smartInput1LineRangeEdit=n:this.smartInput2LineRangeEdit=n,n}dumbCombineInputs(e){if(e===1&&this.dumbInput1LineRangeEdit!==null)return this.dumbInput1LineRangeEdit;if(e===2&&this.dumbInput2LineRangeEdit!==null)return this.dumbInput2LineRangeEdit;let t=this.input1Range.getLines(this.input1TextModel),i=this.input2Range.getLines(this.input2TextModel);e===2&&([t,i]=[i,t]);const n=new Px(this.baseRange,t.concat(i));return e===1?this.dumbInput1LineRangeEdit=n:this.dumbInput2LineRangeEdit=n,n}}function bFe(s,e,t){let i="";const n=s.startLineNumber>1;let o=n?new we(s.startLineNumber-1,t.getLineMaxColumn(s.startLineNumber-1)):new we(s.startLineNumber,1);for(const l of e){const u=l.range.getStartPosition();if(!o.isBeforeOrEqual(u))return;let g=t.getValueInRange(P.fromPositions(o,u));u.lineNumber>t.getLineCount()&&(g+=`
`),i+=g,i+=l.newText,o=l.range.getEndPosition()}const r=s.endLineNumberExclusive<=t.getLineCount(),a=r?new we(s.endLineNumberExclusive,1):new we(s.endLineNumberExclusive-1,Ia.MAX_SAFE_SMALL_INTEGER),c=t.getValueInRange(P.fromPositions(o,a));i+=c;const d=Ch(i);if(n){if(d[0]!=="")return;d.shift()}if(r){if(d[d.length-1]!=="")return;d.pop()}return new Px(s,d)}var Wi;(function(s){s[s.base=0]="base",s[s.input1=1]="input1",s[s.input2=2]="input2",s[s.both=3]="both",s[s.unrecognized=4]="unrecognized"})(Wi||(Wi={}));function c$(s){return s===1?2:1}class bD{constructor(){}get includesInput1(){return!1}get includesInput2(){return!1}includesInput(e){return e===1?this.includesInput1:this.includesInput2}isInputIncluded(e){return e===1?this.includesInput1:this.includesInput2}toggle(e){return this.withInputValue(e,!this.includesInput(e),!0)}getInput(e){return this.isInputIncluded(e)?ew.first:ew.excluded}}class t5 extends bD{get kind(){return Wi.base}toString(){return"base"}swap(){return this}withInputValue(e,t,i=!1){return e===1?t?new m0:this:t?new Sv:this}equals(e){return e.kind===Wi.base}}class m0 extends bD{get kind(){return Wi.input1}get includesInput1(){return!0}toString(){return"1"}swap(){return new Sv}withInputValue(e,t,i=!1){return e===1?t?this:new t5:t?new v0(1,i):new Sv}equals(e){return e.kind===Wi.input1}}class Sv extends bD{get kind(){return Wi.input2}get includesInput2(){return!0}toString(){return"2"}swap(){return new m0}withInputValue(e,t,i=!1){return e===2?t?this:new t5:t?new v0(2,i):new Sv}equals(e){return e.kind===Wi.input2}}class v0 extends bD{constructor(e,t){super(),this.firstInput=e,this.smartCombination=t}get kind(){return Wi.both}get includesInput1(){return!0}get includesInput2(){return!0}toString(){return"2"}swap(){return new v0(c$(this.firstInput),this.smartCombination)}withInputValue(e,t,i=!1){return t?this:e===1?new Sv:new m0}equals(e){return e.kind===Wi.both&&this.firstInput===e.firstInput&&this.smartCombination===e.smartCombination}getInput(e){return e===this.firstInput?ew.first:ew.second}}class yFe extends bD{get kind(){return Wi.unrecognized}toString(){return"unrecognized"}swap(){return this}withInputValue(e,t,i=!1){return t?e===1?new m0:new Sv:this}equals(e){return e.kind===Wi.unrecognized}}var ro;(function(s){s.base=new t5,s.unrecognized=new yFe})(ro||(ro={}));var ew;(function(s){s[s.excluded=0]="excluded",s[s.first=1]="first",s[s.second=2]="second",s[s.unrecognized=3]="unrecognized"})(ew||(ew={}));let gL=class extends Gv{constructor(e,t,i,n,o,r,a,c,d){super(),this.base=e,this.input1=t,this.input2=i,this.resultTextModel=n,this.diffComputer=o,this.options=r,this.telemetry=a,this.languageService=c,this.undoRedoService=d,this.input1TextModelDiffs=this._register(new Y1(this.base,this.input1.textModel,this.diffComputer)),this.input2TextModelDiffs=this._register(new Y1(this.base,this.input2.textModel,this.diffComputer)),this.resultTextModelDiffs=this._register(new Y1(this.base,this.resultTextModel,this.diffComputer)),this.modifiedBaseRanges=ve(this,u=>{const g=this.input1TextModelDiffs.diffs.read(u),m=this.input2TextModelDiffs.diffs.read(u);return e5.fromDiffs(g,m,this.base,this.input1.textModel,this.input2.textModel)}),this.modifiedBaseRangeResultStates=ve(this,u=>new Map(this.modifiedBaseRanges.read(u).map(m=>[m,new OJ(m)]))),this.resultSnapshot=this.resultTextModel.createSnapshot(),this.baseInput1Diffs=this.input1TextModelDiffs.diffs,this.baseInput2Diffs=this.input2TextModelDiffs.diffs,this.baseResultDiffs=this.resultTextModelDiffs.diffs,this.input1ResultMapping=ve(this,u=>this.getInputResultMapping(this.baseInput1Diffs.read(u),this.baseResultDiffs.read(u),this.input1.textModel.getLineCount())),this.resultInput1Mapping=ve(this,u=>this.input1ResultMapping.read(u).reverse()),this.input2ResultMapping=ve(this,u=>this.getInputResultMapping(this.baseInput2Diffs.read(u),this.baseResultDiffs.read(u),this.input2.textModel.getLineCount())),this.resultInput2Mapping=ve(this,u=>this.input2ResultMapping.read(u).reverse()),this.baseResultMapping=ve(this,u=>{const g=new ym(this.baseResultDiffs.read(u),-1);return new ym(g.lineRangeMappings.map(m=>m.inputRange.isEmpty||m.outputRange.isEmpty?new br(m.inputRange.deltaStart(-1),m.outputRange.deltaStart(-1)):m),g.inputLineCount)}),this.resultBaseMapping=ve(this,u=>this.baseResultMapping.read(u).reverse()),this.diffComputingState=ve(this,u=>{const g=[this.input1TextModelDiffs,this.input2TextModelDiffs,this.resultTextModelDiffs].map(m=>m.state.read(u));return g.some(m=>m===Ka.initializing)?Rc.initializing:g.some(m=>m===Ka.updating)?Rc.updating:Rc.upToDate}),this.inputDiffComputingState=ve(this,u=>{const g=[this.input1TextModelDiffs,this.input2TextModelDiffs].map(m=>m.state.read(u));return g.some(m=>m===Ka.initializing)?Rc.initializing:g.some(m=>m===Ka.updating)?Rc.updating:Rc.upToDate}),this.isUpToDate=ve(this,u=>this.diffComputingState.read(u)===Rc.upToDate),this.onInitialized=Mk(this.diffComputingState,u=>u===Rc.upToDate).then(()=>{}),this.firstRun=!0,this.unhandledConflictsCount=ve(this,u=>{const g=this.modifiedBaseRangeResultStates.read(u);let m=0;for(const[v,_]of g)_.handled.read(u)||m++;return m}),this.hasUnhandledConflicts=this.unhandledConflictsCount.map(u=>u>0),this._register(e1(this.modifiedBaseRangeResultStates)),this._register(e1(this.input1ResultMapping)),this._register(e1(this.input2ResultMapping));const l=this.initialize();this.onInitialized=this.onInitialized.then(async()=>{await l}),l.then(()=>{let u=!0;this._register(lbe({changeTracker:{createChangeSummary:()=>{},handleChange:g=>(g.didChange(this.modifiedBaseRangeResultStates)&&(u=!0),g.didChange(this.resultTextModelDiffs.diffs)?g.change===hu.textChange:!0)}},g=>{const m=this.modifiedBaseRangeResultStates.read(g);if(!this.isUpToDate.read(g))return;const v=this.resultTextModelDiffs.diffs.read(g);gs(_=>{if(this.updateBaseRangeAcceptedState(v,m,_),u){u=!1;for(const[w,C]of m){const k=C.accepted.get(),D=!(k.kind===Wi.base||k.kind===Wi.unrecognized);C.handledInput1.set(D,_),C.handledInput2.set(D,_)}}})}))})}async initialize(){this.options.resetResult&&await this.reset()}async reset(){await Mk(this.inputDiffComputingState,t=>t===Rc.upToDate);const e=this.modifiedBaseRangeResultStates.get();gs(t=>{for(const[i,n]of e){let o,r=!1;i.input1Diffs.length===0?(o=ro.base.withInputValue(2,!0),r=!0):i.input2Diffs.length===0||i.isEqualChange?(o=ro.base.withInputValue(1,!0),r=!0):(o=ro.base,r=!1),n.accepted.set(o,t),n.computedFromDiffing=!1,n.previousNonDiffingState=void 0,n.handledInput1.set(r,t),n.handledInput2.set(r,t)}this.resultTextModel.pushEditOperations(null,[{range:new P(1,1,Number.MAX_SAFE_INTEGER,1),text:this.computeAutoMergedResult()}],()=>null)})}computeAutoMergedResult(){const e=this.modifiedBaseRanges.get(),t=this.base.getLinesContent(),i=this.input1.textModel.getLinesContent(),n=this.input2.textModel.getLinesContent(),o=[];function r(c,d){for(let l=d.startLineNumber;l<d.endLineNumberExclusive;l++)o.push(c[l-1])}let a=1;for(const c of e)r(t,Xs.fromLineNumbers(a,c.baseRange.startLineNumber)),a=c.baseRange.endLineNumberExclusive,c.input1Diffs.length===0?r(n,c.input2Range):c.input2Diffs.length===0||c.isEqualChange?r(i,c.input1Range):r(t,c.baseRange);return r(t,Xs.fromLineNumbers(a,t.length+1)),o.join(this.resultTextModel.getEOL())}hasBaseRange(e){return this.modifiedBaseRangeResultStates.get().has(e)}get isApplyingEditInResult(){return this.resultTextModelDiffs.isApplyingChange}getInputResultMapping(e,t,i){const n=ym.betweenOutputs(e,t,i);return new ym(n.lineRangeMappings.map(o=>o.inputRange.isEmpty||o.outputRange.isEmpty?new br(o.inputRange.deltaStart(-1),o.outputRange.deltaStart(-1)):o),n.inputLineCount)}translateInputRangeToBase(e,t){const i=e===1?this.baseInput1Diffs.get():this.baseInput2Diffs.get();return new mb(i.flatMap(o=>o.rangeMappings),0).reverse().projectRange(t).outputRange}translateBaseRangeToInput(e,t){const i=e===1?this.baseInput1Diffs.get():this.baseInput2Diffs.get();return new mb(i.flatMap(o=>o.rangeMappings),0).projectRange(t).outputRange}getLineRangeInResult(e,t){return this.resultTextModelDiffs.getResultLineRange(e,t)}translateResultRangeToBase(e){return new mb(this.baseResultDiffs.get().flatMap(i=>i.rangeMappings),0).reverse().projectRange(e).outputRange}translateBaseRangeToResult(e){return new mb(this.baseResultDiffs.get().flatMap(i=>i.rangeMappings),0).projectRange(e).outputRange}findModifiedBaseRangesInRange(e){return this.modifiedBaseRanges.get().filter(t=>t.baseRange.intersects(e))}updateBaseRangeAcceptedState(e,t,i){const n=vFe(t,e,(o,r)=>o[0].baseRange.touches(r.inputRange)?LE.neitherLessOrGreaterThan:Xs.compareByStart(o[0].baseRange,r.inputRange));for(const o of n){const r=this.computeState(o.left[0],o.rights),a=o.left[1],c=a.accepted.get();c.equals(r)||(!this.firstRun&&!a.computedFromDiffing&&(a.computedFromDiffing=!0,a.previousNonDiffingState=c),a.accepted.set(r,i))}this.firstRun&&(this.firstRun=!1)}computeState(e,t){if(t.length===0)return ro.base;const i=t.map(r=>r.getLineEdit());function n(r){return rs(i,r.map(a=>a.getLineEdit()),(a,c)=>a.equals(c))}if(n(e.input1Diffs))return ro.base.withInputValue(1,!0);if(n(e.input2Diffs))return ro.base.withInputValue(2,!0);const o=[ro.base.withInputValue(1,!0).withInputValue(2,!0,!0),ro.base.withInputValue(2,!0).withInputValue(1,!0,!0),ro.base.withInputValue(1,!0).withInputValue(2,!0,!1),ro.base.withInputValue(2,!0).withInputValue(1,!0,!1)];for(const r of o){const{edit:a}=e.getEditForBase(r);if(a){const d=this.resultTextModelDiffs.getResultLineRange(e.baseRange).getLines(this.resultTextModel);if(rs(a.newLines,d,(l,u)=>l===u))return r}}return ro.unrecognized}getState(e){const t=this.modifiedBaseRangeResultStates.get().get(e);if(!t)throw new tn("object must be from this instance");return t.accepted}setState(e,t,i,n,o=!1){if(!this.isUpToDate.get())throw new tn("Cannot set state while updating");const r=this.modifiedBaseRangeResultStates.get().get(e);if(!r)throw new tn("object must be from this instance");const a=this.resultTextModelDiffs.findTouchingDiffs(e.baseRange),c=new hbe;a&&this.resultTextModelDiffs.removeDiffs(a,n,c);const{edit:d,effectiveState:l}=e.getEditForBase(t);r.accepted.set(l,n),r.previousNonDiffingState=void 0,r.computedFromDiffing=!1;const u=r.handledInput1.get(),g=r.handledInput2.get();(!u||!g)&&this.undoRedoService.pushElement(new wFe(this.resultTextModel.uri,new WeakRef(this),new WeakRef(r),u,g),c),d&&(this.resultTextModel.pushStackElement(),this.resultTextModelDiffs.applyEditRelativeToOriginal(d,n,c),this.resultTextModel.pushStackElement()),r.handledInput1.set(!0,n),r.handledInput2.set(!0,n)}resetDirtyConflictsToBase(){gs(e=>{this.resultTextModel.pushStackElement();for(const t of this.modifiedBaseRanges.get())this.getState(t).get().kind===Wi.unrecognized&&this.setState(t,ro.base,!1,e,!1);this.resultTextModel.pushStackElement()})}isHandled(e){return this.modifiedBaseRangeResultStates.get().get(e).handled}isInputHandled(e,t){const i=this.modifiedBaseRangeResultStates.get().get(e);return t===1?i.handledInput1:i.handledInput2}setInputHandled(e,t,i,n){const o=this.modifiedBaseRangeResultStates.get().get(e);if(o.handled.get()===i)return;const r=new WeakRef(OJ),a=new WeakRef(this);this.undoRedoService.pushElement({type:Yz.Resource,resource:this.resultTextModel.uri,code:"setInputHandled",label:h(7841,"Set Input Handled"),redo(){const c=a.deref(),d=r.deref();c&&!c.isDisposed()&&d&&gs(l=>{t===1?o.handledInput1.set(i,l):o.handledInput2.set(i,l)})},undo(){const c=a.deref(),d=r.deref();c&&!c.isDisposed()&&d&&gs(l=>{t===1?o.handledInput1.set(!i,l):o.handledInput2.set(!i,l)})}}),t===1?o.handledInput1.set(i,n):o.handledInput2.set(i,n)}setHandled(e,t,i){const n=this.modifiedBaseRangeResultStates.get().get(e);n.handled.get()!==t&&(n.handledInput1.set(t,i),n.handledInput2.set(t,i))}setLanguageId(e,t){const i=this.languageService.createById(e);this.base.setLanguage(i,t),this.input1.textModel.setLanguage(i,t),this.input2.textModel.setLanguage(i,t),this.resultTextModel.setLanguage(i,t)}getInitialResultValue(){const e=[];for(;;){const t=this.resultSnapshot.read();if(t===null)break;e.push(t)}return e.join()}async getResultValueWithConflictMarkers(){if(await Mk(this.diffComputingState,c=>c===Rc.upToDate),this.unhandledConflictsCount.get()===0)return this.resultTextModel.getValue();const e=this.resultTextModel.getLinesContent(),t=this.input1.textModel.getLinesContent(),i=this.input2.textModel.getLinesContent(),n=this.modifiedBaseRangeResultStates.get(),o=[];function r(c,d){for(let l=d.startLineNumber;l<d.endLineNumberExclusive;l++)o.push(c[l-1])}let a=1;for(const[c,d]of n){if(d.handled.get())continue;const l=this.resultTextModelDiffs.getResultLineRange(c.baseRange);r(e,Xs.fromLineNumbers(a,Math.max(a,l.startLineNumber))),a=l.endLineNumberExclusive,o.push("<<<<<<<"),d.accepted.get().kind===Wi.unrecognized?r(e,l):r(t,c.input1Range),o.push("======="),r(i,c.input2Range),o.push(">>>>>>>")}return r(e,Xs.fromLineNumbers(a,e.length+1)),o.join(`
`)}get conflictCount(){return Gr(this.modifiedBaseRanges.get(),e=>e.isConflicting)}get combinableConflictCount(){return Gr(this.modifiedBaseRanges.get(),e=>e.isConflicting&&e.canBeCombined)}get conflictsResolvedWithBase(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.base)}get conflictsResolvedWithInput1(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.input1)}get conflictsResolvedWithInput2(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.input2)}get conflictsResolvedWithSmartCombination(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.both&&i.smartCombination})}get manuallySolvedConflictCountThatEqualNone(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>e.isConflicting&&t.accepted.get().kind===Wi.unrecognized)}get manuallySolvedConflictCountThatEqualSmartCombine(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===Wi.both&&i.smartCombination})}get manuallySolvedConflictCountThatEqualInput1(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===Wi.input1})}get manuallySolvedConflictCountThatEqualInput2(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&t.computedFromDiffing&&i.kind===Wi.input2})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBase(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.base})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.input1})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.input2})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.both&&!t.previousNonDiffingState?.smartCombination})}get manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart(){return Gr(this.modifiedBaseRangeResultStates.get().entries(),([e,t])=>{const i=t.accepted.get();return e.isConflicting&&i.kind===Wi.unrecognized&&t.previousNonDiffingState?.kind===Wi.both&&t.previousNonDiffingState?.smartCombination})}};gL=f([p(7,vi),p(8,HM)],gL);function Gr(s,e){let t=0;for(const i of s)e(i)&&t++;return t}class OJ{constructor(e){this.baseRange=e,this.accepted=si(`BaseRangeState${this.baseRange.baseRange}`,ro.base),this.handledInput1=si(`BaseRangeHandledState${this.baseRange.baseRange}.Input1`,!1),this.handledInput2=si(`BaseRangeHandledState${this.baseRange.baseRange}.Input2`,!1),this.computedFromDiffing=!1,this.previousNonDiffingState=void 0,this.handled=ve(this,t=>this.handledInput1.read(t)&&this.handledInput2.read(t))}}var Rc;(function(s){s[s.initializing=1]="initializing",s[s.upToDate=2]="upToDate",s[s.updating=3]="updating"})(Rc||(Rc={}));class wFe{constructor(e,t,i,n,o){this.resource=e,this.mergeEditorModelRef=t,this.stateRef=i,this.input1Handled=n,this.input2Handled=o,this.code="undoMarkAsHandled",this.label=h(7842,"Undo Mark As Handled"),this.type=Yz.Resource}redo(){const e=this.mergeEditorModelRef.deref();if(!e||e.isDisposed())return;const t=this.stateRef.deref();t&&gs(i=>{t.handledInput1.set(!0,i),t.handledInput2.set(!0,i)})}undo(){const e=this.mergeEditorModelRef.deref();if(!e||e.isDisposed())return;const t=this.stateRef.deref();t&&gs(i=>{t.handledInput1.set(this.input1Handled,i),t.handledInput2.set(this.input2Handled,i)})}}const cJe=new O("isMergeEditor",!1,{type:"boolean",description:h(7894,"The editor is a merge editor")}),dJe=new O("isMergeResultEditor",!1,{type:"boolean",description:h(7895,"The editor is a the result editor of a merge editor.")}),lJe=new O("mergeEditorLayout","mixed",{type:"string",description:h(7896,"The layout mode of a merge editor")}),hJe=new O("mergeEditorShowBase",!1,{type:"boolean",description:h(7897,"If the merge editor shows the base version")}),uJe=new O("mergeEditorShowBaseAtTop",!1,{type:"boolean",description:h(7898,"If base should be shown at the top")}),gJe=new O("mergeEditorShowNonConflictingChanges",!1,{type:"boolean",description:h(7899,"If the merge editor shows non-conflicting changes")}),pJe=new O("mergeEditorBaseUri","",{type:"string",description:h(7900,"The uri of the baser of a merge editor")}),fJe=new O("mergeEditorResultUri","",{type:"string",description:h(7901,"The uri of the result of a merge editor")}),FJ="mergeEditorCloseWithConflicts";var d$;let l$=class{constructor(e,t,i,n){this._mergeEditorTelemetry=e,this._instantiationService=t,this._textModelService=i,this._modelService=n}async createInputModel(e){const t=new U,[i,n,o,r]=await Promise.all([this._textModelService.createModelReference(e.base),this._textModelService.createModelReference(e.result),pL(e.input1,this._textModelService,t),pL(e.input2,this._textModelService,t)]);t.add(i),t.add(n);const a=n.object.textEditorModel.uri.with({scheme:"merge-result"}),c=this._modelService.createModel("",{languageId:n.object.textEditorModel.getLanguageId(),onDidChange:T.None},a);t.add(c);const d=this._instantiationService.createInstance(uL),l=this._instantiationService.createInstance(gL,i.object.textEditorModel,o,r,c,d,{resetResult:!0},this._mergeEditorTelemetry);return t.add(l),await l.onInitialized,this._instantiationService.createInstance(h$,l,t,n.object,e.result)}};l$=f([p(1,Z),p(2,Ci),p(3,ci)],l$);let h$=class extends Gv{constructor(e,t,i,n,o,r,a){super(),this.model=e,this.disposable=t,this.result=i,this.resultUri=n,this.textFileService=o,this.dialogService=r,this.editorService=a,this.savedAltVersionId=si(this,this.model.resultTextModel.getAlternativeVersionId()),this.altVersionId=kn(this,c=>this.model.resultTextModel.onDidChangeContent(c),()=>this.model.resultTextModel.getAlternativeVersionId()),this.isDirty=ve(this,c=>this.altVersionId.read(c)!==this.savedAltVersionId.read(c)),this.finished=!1}dispose(){this.disposable.dispose(),super.dispose()}async accept(){const e=await this.model.resultTextModel.getValue();this.result.textEditorModel.setValue(e),this.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(),void 0),await this.textFileService.save(this.result.textEditorModel.uri),this.finished=!0}async _discard(){await this.textFileService.revert(this.model.resultTextModel.uri),this.savedAltVersionId.set(this.model.resultTextModel.getAlternativeVersionId(),void 0),this.finished=!0}shouldConfirmClose(){return!0}async confirmClose(e){dI(()=>e.some(n=>n===this));const t=e.some(n=>n.isDirty.get());let i;if(t){const n=e.length>1,o=n?h(7812,"Do you want keep the merge result of {0} files?",e.length):h(7813,"Do you want keep the merge result of {0}?",Qe(e[0].model.resultTextModel.uri)),r=e.some(c=>c.model.hasUnhandledConflicts.get()),a=[{label:r?h(7814,"&&Save With Conflicts"):h(7815,"&&Save"),run:()=>Yi.SAVE},{label:h(7816,"Do&&n't Save"),run:()=>Yi.DONT_SAVE}];i=(await this.dialogService.prompt({type:Fe.Info,message:o,detail:r?n?h(7817,"The files contain unhandled conflicts. The merge results will be lost if you don't save them."):h(7818,"The file contains unhandled conflicts. The merge result will be lost if you don't save it."):n?h(7819,"The merge results will be lost if you don't save them."):h(7820,"The merge result will be lost if you don't save it."),buttons:a,cancelButton:{run:()=>Yi.CANCEL}})).result}else i=Yi.DONT_SAVE;return i===Yi.SAVE?await Promise.all(e.map(n=>n.accept())):i===Yi.DONT_SAVE&&await Promise.all(e.map(n=>n._discard())),i}async save(e){this.finished||(async()=>{const{confirmed:t}=await this.dialogService.confirm({message:h(7821,"Do you want to accept the merge result?"),detail:h(7822,"This will write the merge result to the original file and close the merge editor."),primaryButton:h(7823,"&&Accept Merge")});if(t){await this.accept();const i=this.editorService.findEditors(this.resultUri).filter(n=>n.editor.typeId==="mergeEditor.Input");await this.editorService.closeEditors(i)}})()}async revert(e){}};h$=f([p(4,Ps),p(5,ei),p(6,de)],h$);let u$=class{static{d$=this}constructor(e,t,i,n,o,r){this._mergeEditorTelemetry=e,this._instantiationService=t,this._textModelService=i,this.textFileService=n,this._modelService=o,this._languageService=r}static{this.FILE_SAVED_SOURCE=mCe.registerSource("merge-editor.source",h(7824,"Before Resolving Conflicts In Merge Editor"))}async createInputModel(e){const t=new U;let i;const n=t.add(new U),o=_=>{At(e.result,_.resource)&&(n.clear(),i=_)};n.add(this.textFileService.files.onDidCreate(o)),this.textFileService.files.models.forEach(o);let[r,a,c,d]=await Promise.all([this._textModelService.createModelReference(e.base).then(_=>({object:_.object.textEditorModel,dispose:()=>_.dispose()})).catch(_=>{mt(_),console.error(_)}),this._textModelService.createModelReference(e.result),pL(e.input1,this._textModelService,t),pL(e.input2,this._textModelService,t)]);if(r===void 0){const _=this._modelService.createModel("",this._languageService.createById(a.object.getLanguageId()));r={dispose:()=>{_.dispose()},object:_}}if(t.add(r),t.add(a),!i)throw new tn;await i.save({source:d$.FILE_SAVED_SOURCE});const g=i.textEditorModel.getLinesContent().some(_=>_.startsWith(cFe.start)),m=this._instantiationService.createInstance(uL),v=this._instantiationService.createInstance(gL,r.object,c,d,a.object.textEditorModel,m,{resetResult:g},this._mergeEditorTelemetry);return t.add(v),await v.onInitialized,this._instantiationService.createInstance(g$,v,t,i,this._mergeEditorTelemetry)}};u$=d$=f([p(1,Z),p(2,Ci),p(3,Ps),p(4,ci),p(5,vi)],u$);let g$=class extends Gv{constructor(e,t,i,n,o,r){super(),this.model=e,this.disposableStore=t,this.resultTextFileModel=i,this.telemetry=n,this._dialogService=o,this._storageService=r,this.isDirty=kn(this,T.any(this.resultTextFileModel.onDidChangeDirty,this.resultTextFileModel.onDidSaveError),()=>this.resultTextFileModel.isDirty()),this.reported=!1,this.dateTimeOpened=new Date}dispose(){this.disposableStore.dispose(),super.dispose(),this.reportClose(!1)}reportClose(e){if(!this.reported){const t=this.model.unhandledConflictsCount.get(),i=new Date().getTime()-this.dateTimeOpened.getTime();this.telemetry.reportMergeEditorClosed({durationOpenedSecs:i/1e3,remainingConflictCount:t,accepted:e,conflictCount:this.model.conflictCount,combinableConflictCount:this.model.combinableConflictCount,conflictsResolvedWithBase:this.model.conflictsResolvedWithBase,conflictsResolvedWithInput1:this.model.conflictsResolvedWithInput1,conflictsResolvedWithInput2:this.model.conflictsResolvedWithInput2,conflictsResolvedWithSmartCombination:this.model.conflictsResolvedWithSmartCombination,manuallySolvedConflictCountThatEqualNone:this.model.manuallySolvedConflictCountThatEqualNone,manuallySolvedConflictCountThatEqualSmartCombine:this.model.manuallySolvedConflictCountThatEqualSmartCombine,manuallySolvedConflictCountThatEqualInput1:this.model.manuallySolvedConflictCountThatEqualInput1,manuallySolvedConflictCountThatEqualInput2:this.model.manuallySolvedConflictCountThatEqualInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBase:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBase,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart:this.model.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart}),this.reported=!0}}async accept(){this.reportClose(!0),await this.resultTextFileModel.save()}get resultUri(){return this.resultTextFileModel.resource}async save(e){await this.resultTextFileModel.save(e)}async revert(e){await this.resultTextFileModel.revert(e)}shouldConfirmClose(){return!0}async confirmClose(e){const t=e.length>1,i=e.some(o=>o.isDirty.get()),n=e.some(o=>o.model.hasUnhandledConflicts.get());if(i){const o=t?h(7825,"Do you want to save the changes you made to {0} files?",e.length):h(7826,"Do you want to save the changes you made to {0}?",Qe(e[0].resultUri)),{result:r}=await this._dialogService.prompt({type:Fe.Info,message:o,detail:n?t?h(7827,"The files contain unhandled conflicts. Your changes will be lost if you don't save them."):h(7828,"The file contains unhandled conflicts. Your changes will be lost if you don't save them."):t?h(7829,"Your changes will be lost if you don't save them."):h(7830,"Your changes will be lost if you don't save them."),buttons:[{label:n?h(7831,"&&Save with Conflicts"):h(7832,"&&Save"),run:()=>Yi.SAVE},{label:h(7833,"Do&&n't Save"),run:()=>Yi.DONT_SAVE}],cancelButton:{run:()=>Yi.CANCEL}});return r}else if(n&&!this._storageService.getBoolean(FJ,he.PROFILE,!1)){const{confirmed:o,checkboxChecked:r}=await this._dialogService.confirm({message:t?h(7834,"Do you want to close {0} merge editors?",e.length):h(7835,"Do you want to close the merge editor for {0}?",Qe(e[0].resultUri)),detail:n?t?h(7836,"The files contain unhandled conflicts."):h(7837,"The file contains unhandled conflicts."):void 0,primaryButton:n?h(7838,"&&Close with Conflicts"):h(7839,"&&Close"),checkbox:{label:h(7840,"Do not ask me again")}});return r&&this._storageService.store(FJ,!0,he.PROFILE,gt.USER),o?Yi.SAVE:Yi.CANCEL}else return Yi.SAVE}};g$=f([p(4,ei),p(5,it)],g$);async function pL(s,e,t){const i=await e.createModelReference(s.uri);return t.add(i),{textModel:i.object.textEditorModel,title:s.title,description:s.description,detail:s.detail}}let p$=class{constructor(e){this.telemetryService=e}reportMergeEditorOpened(e){this.telemetryService.publicLog2("mergeEditor.opened",{conflictCount:e.conflictCount,combinableConflictCount:e.combinableConflictCount,baseVisible:e.baseVisible,isColumnView:e.isColumnView,baseTop:e.baseTop})}reportLayoutChange(e){this.telemetryService.publicLog2("mergeEditor.layoutChanged",{baseVisible:e.baseVisible,isColumnView:e.isColumnView,baseTop:e.baseTop})}reportMergeEditorClosed(e){this.telemetryService.publicLog2("mergeEditor.closed",{conflictCount:e.conflictCount,combinableConflictCount:e.combinableConflictCount,durationOpenedSecs:e.durationOpenedSecs,remainingConflictCount:e.remainingConflictCount,accepted:e.accepted,conflictsResolvedWithBase:e.conflictsResolvedWithBase,conflictsResolvedWithInput1:e.conflictsResolvedWithInput1,conflictsResolvedWithInput2:e.conflictsResolvedWithInput2,conflictsResolvedWithSmartCombination:e.conflictsResolvedWithSmartCombination,manuallySolvedConflictCountThatEqualNone:e.manuallySolvedConflictCountThatEqualNone,manuallySolvedConflictCountThatEqualSmartCombine:e.manuallySolvedConflictCountThatEqualSmartCombine,manuallySolvedConflictCountThatEqualInput1:e.manuallySolvedConflictCountThatEqualInput1,manuallySolvedConflictCountThatEqualInput2:e.manuallySolvedConflictCountThatEqualInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBase:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBase,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput1,manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithInput2,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothNonSmart,manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart:e.manuallySolvedConflictCountThatEqualNoneAndStartedWithBothSmart})}reportAcceptInvoked(e,t){this.telemetryService.publicLog2("mergeEditor.action.accept",{otherAccepted:t,isInput1:e===1})}reportSmartCombinationInvoked(e){this.telemetryService.publicLog2("mergeEditor.action.smartCombination",{otherAccepted:e})}reportRemoveInvoked(e,t){this.telemetryService.publicLog2("mergeEditor.action.remove",{otherAccepted:t,isInput1:e===1})}reportResetToBaseInvoked(){this.telemetryService.publicLog2("mergeEditor.action.resetToBase",{})}reportNavigationToNextConflict(){this.telemetryService.publicLog2("mergeEditor.action.goToNextConflict",{})}reportNavigationToPreviousConflict(){this.telemetryService.publicLog2("mergeEditor.action.goToPreviousConflict",{})}reportConflictCounterClicked(){this.telemetryService.publicLog2("mergeEditor.action.conflictCounterClicked",{})}};p$=f([p(0,ai)],p$);var iC;class wJe{constructor(e,t,i,n){this.uri=e,this.title=t,this.detail=i,this.description=n}}let f$=class extends Qd{static{iC=this}static{this.ID="mergeEditor.Input"}get useWorkingCopy(){return this.configurationService.getValue("mergeEditor.useWorkingCopy")??!1}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(n,void 0,r,a,c,d,u,g,m),this.base=e,this.input1=t,this.input2=i,this.result=n,this._instaService=o,this.configurationService=l,this.logService=v,this._focusedEditor="result",this.closeHandler={showConfirm:()=>this._inputModel?.shouldConfirmClose()??!1,confirm:async _=>{dI(()=>_.every(C=>C.editor instanceof iC));const w=_.map(C=>C.editor._inputModel).filter(wa);return await this._inputModel.confirmClose(w)}},this.mergeEditorModeFactory=this._instaService.createInstance(this.useWorkingCopy?l$:u$,this._instaService.createInstance(p$))}dispose(){super.dispose()}get typeId(){return iC.ID}get editorId(){return id.id}get capabilities(){let e=super.capabilities|Je.MultipleEditors;return this.useWorkingCopy&&(e|=Je.Untitled),e}getName(){return h(7808,"Merging: {0}",super.getName())}async resolve(){if(!this._inputModel){const e=this._register(await this.mergeEditorModeFactory.createInputModel({base:this.base,input1:this.input1,input2:this.input2,result:this.result}));this._inputModel=e,this._register(fi(t=>{e.isDirty.read(t),this._onDidChangeDirty.fire()})),await this._inputModel.model.onInitialized}return this._inputModel}async accept(){await this._inputModel?.accept()}async save(e,t){await this._inputModel?.save(t)}toUntyped(){return{input1:{resource:this.input1.uri,label:this.input1.title,description:this.input1.description,detail:this.input1.detail},input2:{resource:this.input2.uri,label:this.input2.title,description:this.input2.description,detail:this.input2.detail},base:{resource:this.base},result:{resource:this.result},options:{override:this.typeId}}}matches(e){return this===e?!0:e instanceof iC?At(this.base,e.base)&&At(this.input1.uri,e.input1.uri)&&At(this.input2.uri,e.input2.uri)&&At(this.result,e.result):wC(e)?(this.editorId===e.options?.override||e.options?.override===void 0)&&At(this.base,e.base.resource)&&At(this.input1.uri,e.input1.resource)&&At(this.input2.uri,e.input2.resource)&&At(this.result,e.result.resource):!1}async revert(e,t){return this._inputModel?.revert(t)}isDirty(){return this._inputModel?.isDirty.get()??!1}setLanguageId(e,t){this._inputModel?.model.setLanguageId(e,t)}updateFocusedEditor(e){this._focusedEditor!==e&&(this._focusedEditor=e,this.logService.trace("alertFocusedEditor",e),SFe(e))}};f$=iC=f([p(4,Z),p(5,de),p(6,Ps),p(7,ui),p(8,je),p(9,ne),p(10,Us),p(11,ir),p(12,pg),p(13,Re)],f$);function SFe(s){switch(s){case"input1":na(h(7809,"Incoming, Left Input"));break;case"input2":na(h(7810,"Current, Right Input"));break;case"result":na(h(7811,"Merge Result"));break}}const CFe=Pe("multi-diff-editor-label-icon",K.diffMultiple,h(7905,"Icon of the multi diff editor label."));class WJ{constructor(e,t,i,n){if(this.originalUri=e,this.modifiedUri=t,this.goToFileUri=i,this.contextKeys=n,!e&&!t)throw new tn("Invalid arguments")}getKey(){return JSON.stringify([this.modifiedUri?.toString(),this.originalUri?.toString()])}}var O_;let Qb=class extends dl{static{O_=this}static fromResourceMultiDiffEditorInput(e,t){if(!e.multiDiffSource&&!e.resources)throw new tn("MultiDiffEditorInput requires either multiDiffSource or resources");const i=e.multiDiffSource??R.parse(`multi-diff-editor:${new Date().getMilliseconds().toString()+Math.random().toString()}`);return t.createInstance(O_,i,e.label,e.resources?.map(n=>new WJ(n.original.resource,n.modified.resource,n.goToFileResource)),e.isTransient??!1)}static fromSerialized(e,t){return t.createInstance(O_,R.parse(e.multiDiffSourceUri),e.label,e.resources?.map(i=>new WJ(i.originalUri?R.parse(i.originalUri):void 0,i.modifiedUri?R.parse(i.modifiedUri):void 0,i.goToFileUri?R.parse(i.goToFileUri):void 0)),!1)}static{this.ID="workbench.input.multiDiffEditor"}get resource(){return this.multiDiffSource}get capabilities(){return Je.Readonly}get typeId(){return O_.ID}getName(){return this._name}get editorId(){return id.id}getIcon(){return CFe}constructor(e,t,i,n=!1,o,r,a,c,d){super(),this.multiDiffSource=e,this.label=t,this.initialResources=i,this.isTransient=n,this._textModelService=o,this._textResourceConfigurationService=r,this._instantiationService=a,this._multiDiffSourceResolverService=c,this._textFileService=d,this._name="",this._viewModel=new ube(async()=>{const l=await this._createModel();this._register(l);const u=new pSe(l,this._instantiationService);return this._register(u),await ese(u.waitForDiffs(),1e3),u}),this._resolvedSource=new Nke(async()=>{const l=this.initialResources?{resources:gbe.const(this.initialResources)}:await this._multiDiffSourceResolverService.resolve(this.multiDiffSource);return{source:l,resources:l?pbe(this,l.resources):Li([])}}),this.resources=ve(this,l=>this._resolvedSource.cachedPromiseResult.read(l)?.data?.resources.read(l)),this.textFileServiceOnDidChange=new EFe(this._textFileService.files.onDidChangeDirty,l=>l.resource.toString(),l=>l.toString()),this._isDirtyObservables=iA(this,this.resources.map(l=>l??[]),l=>{const u=l.modifiedUri?BJ(this.textFileServiceOnDidChange,this._textFileService,l.modifiedUri):Li(!1),g=l.originalUri?BJ(this.textFileServiceOnDidChange,this._textFileService,l.originalUri):Li(!1);return ve(m=>u.read(m)||g.read(m))},l=>l.getKey()),this._isDirtyObservable=ve(this,l=>this._isDirtyObservables.read(l).some(u=>u.read(l))).keepObserved(this._store),this.onDidChangeDirty=T.fromObservableLight(this._isDirtyObservable),this.closeHandler={async confirm(){return Yi.DONT_SAVE},showConfirm(){return!1}},this._register(fi(l=>{const u=this.resources.read(l),g=this.label??h(7907,"Multi Diff Editor");u&&u.length===1?this._name=h(7908,"{0} (1 file)",g):u?this._name=h(7909,"{0} ({1} files)",g,u.length):this._name=g,this._onDidChangeLabel.fire()}))}serialize(){return{label:this.label,multiDiffSourceUri:this.multiDiffSource.toString(),resources:this.initialResources?.map(e=>({originalUri:e.originalUri?.toString(),modifiedUri:e.modifiedUri?.toString(),goToFileUri:e.goToFileUri?.toString()}))}}setLanguageId(e,t){const n=this._viewModel.requireValue().activeDiffItem.get()?.documentDiffItem;if(!n)return;const o=n.modified??n.original;o&&o.setLanguage(e,t)}async getViewModel(){return this._viewModel.getPromise()}async _createModel(){const e=await this._resolvedSource.getPromise(),t=this._textResourceConfigurationService,i=iA(this,e.resources,async(c,d)=>{let l,u;const g=new U;try{[l,u]=await Promise.all([c.originalUri?this._textModelService.createModelReference(c.originalUri):void 0,c.modifiedUri?this._textModelService.createModelReference(c.modifiedUri):void 0]),l&&g.add(l),u&&g.add(u)}catch(_){console.error(_),mt(_);return}const m=c.modifiedUri??c.originalUri,v={multiDiffEditorItem:c,original:l?.object.textEditorModel,modified:u?.object.textEditorModel,contextKeys:c.contextKeys,get options(){return{...xFe(u?.object.isReadonly()??!0),...IFe(t.getValue(m))}},onOptionsDidChange:_=>this._textResourceConfigurationService.onDidChangeConfiguration(w=>{(w.affectsConfiguration(m,"editor")||w.affectsConfiguration(m,"diffEditor"))&&_()})};return d.add(fSe.createOfNonDisposable(v,g,this))},c=>JSON.stringify([c.modifiedUri?.toString(),c.originalUri?.toString()])),n=si("documents","loading"),o=ve(async c=>{const d=i.read(c),u=(await Promise.all(d)).filter(wa);n.set(u,void 0)}),r=tse(o);return await o.get(),{dispose:()=>r.dispose(),documents:new fbe(n),contextKeys:e.source?.contextKeys}}matches(e){return super.matches(e)?!0:e instanceof O_?this.multiDiffSource.toString()===e.multiDiffSource.toString():!1}isDirty(){return this._isDirtyObservable.get()}async save(e,t){return await this.doSaveOrRevert("save",e,t),this}revert(e,t){return this.doSaveOrRevert("revert",e,t)}async doSaveOrRevert(e,t,i){const n=this._viewModel.currentValue?.items.get();n&&await Promise.all(n.map(async o=>{const r=o.diffEditorViewModel.model,a=r.original.uri.scheme!==ae.untitled&&this._textFileService.isDirty(r.original.uri);await Promise.all([a?e==="save"?this._textFileService.save(r.original.uri,i):this._textFileService.revert(r.original.uri,i):Promise.resolve(),e==="save"?this._textFileService.save(r.modified.uri,i):this._textFileService.revert(r.modified.uri,i)])}))}};Qb=O_=f([p(4,Ci),p(5,ir),p(6,Z),p(7,Ere),p(8,Ps)],Qb);class EFe{constructor(e,t,i){this._event=e,this._getEventArgsKey=t,this._keyToString=i,this._count=0,this._buckets=new Map,this._handleEventChange=n=>{const o=this._getEventArgsKey(n),r=this._buckets.get(o);if(r)for(const a of r)a(n)}}filteredEvent(e){return t=>{const i=this._keyToString(e);let n=this._buckets.get(i);return n||(n=new Set,this._buckets.set(i,n)),n.add(t),this._count++,this._count===1&&(this._eventSubscription=this._event(this._handleEventChange)),{dispose:()=>{n.delete(t),n.size===0&&this._buckets.delete(i),this._count--,this._count===0&&(this._eventSubscription?.dispose(),this._eventSubscription=void 0)}}}}}function BJ(s,e,t){return kn(s.filteredEvent(t),()=>e.isDirty(t))}function xFe(s){return{readOnly:!!s,readOnlyMessage:typeof s!="boolean"?s:void 0}}function IFe(s){const e=Tr(s.editor);if(ra(s.diffEditor)){const t=Tr(s.diffEditor);t.diffCodeLens=t.codeLens,delete t.codeLens,t.diffWordWrap=t.wordWrap,delete t.wordWrap,Object.assign(e,t)}return e}let VJ=class extends F{static{this.ID="workbench.contrib.multiDiffEditorResolver"}constructor(e,t){super(),this._register(e.registerEditor("*",{id:id.id,label:id.displayName,detail:id.providerDisplayName,priority:mm.builtin},{},{createMultiDiffEditorInput:i=>({editor:Qb.fromResourceMultiDiffEditorInput(i,t)})}))}};VJ=f([p(0,mf),p(1,Z)],VJ);H("terminal.background",null,h(10282,"The background color of the terminal, this allows coloring the terminal differently to the panel."));H("terminal.foreground",{light:"#333333",dark:"#CCCCCC",hcDark:"#FFFFFF",hcLight:"#292929"},h(10283,"The foreground color of the terminal."));H("terminalCursor.foreground",null,h(10284,"The foreground color of the terminal cursor."));H("terminalCursor.background",null,h(10285,"The background color of the terminal cursor. Allows customizing the color of a character overlapped by a block cursor."));const ok=H("terminal.selectionBackground",Dne,h(10286,"The selection background color of the terminal."));H("terminal.inactiveSelectionBackground",{light:et(ok,.5),dark:et(ok,.5),hcDark:et(ok,.7),hcLight:et(ok,.5)},h(10287,"The selection background color of the terminal when it does not have focus."));H("terminal.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:"#ffffff"},h(10288,"The selection foreground color of the terminal. When this is null the selection foreground will be retained and have the minimum contrast ratio feature applied."));H("terminalCommandDecoration.defaultBackground",{light:"#00000040",dark:"#ffffff40",hcDark:"#ffffff80",hcLight:"#00000040"},h(10289,"The default terminal command decoration background color."));H("terminalCommandDecoration.successBackground",{dark:"#1B81A8",light:"#2090D3",hcDark:"#1B81A8",hcLight:"#007100"},h(10290,"The terminal command decoration background color for successful commands."));H("terminalCommandDecoration.errorBackground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F14C4C",hcLight:"#B5200D"},h(10291,"The terminal command decoration background color for error commands."));H("terminalOverviewRuler.cursorForeground","#A0A0A0CC",h(10292,"The overview ruler cursor color."));H("terminal.border",zE,h(10293,"The color of the border that separates split panes within the terminal. This defaults to panel.border."));H("terminalOverviewRuler.border",mbe,h(10294,"The overview ruler left-side border color."));H("terminal.findMatchBackground",{dark:e8,light:e8,hcDark:null,hcLight:"#0F4A85"},h(10295,"Color of the current search match in the terminal. The color must not be opaque so as not to hide underlying terminal content."),!0);H("terminal.hoverHighlightBackground",et(vbe,.5),h(10296,"Border color of the other search matches in the terminal."));H("terminal.findMatchBorder",{dark:null,light:null,hcDark:"#f38518",hcLight:"#0F4A85"},h(10297,"Border color of the current search match in the terminal."));H("terminal.findMatchHighlightBackground",{dark:GF,light:GF,hcDark:null,hcLight:null},h(10298,"Color of the other search matches in the terminal. The color must not be opaque so as not to hide underlying terminal content."),!0);H("terminal.findMatchHighlightBorder",{dark:null,light:null,hcDark:"#f38518",hcLight:"#0F4A85"},h(10296,"Border color of the other search matches in the terminal."));H("terminalOverviewRuler.findMatchForeground",{dark:vC,light:vC,hcDark:"#f38518",hcLight:"#0F4A85"},h(10299,"Overview ruler marker color for find matches in the terminal."));H("terminal.dropBackground",RN,h(10300,"Background color when dragging on top of terminals. The color should have transparency so that the terminal contents can still shine through."),!0);H("terminal.tab.activeBorder",MA,h(10301,"Border on the side of the terminal tab in the panel. This defaults to tab.activeBorder."));H("terminal.initialHintForeground",{dark:"#ffffff56",light:"#0007",hcDark:null,hcLight:null},h(10302,"Foreground color of the terminal initial hint."));function DFe(s){let e;if(typeof s=="string"?e=s:s.color?e=s.color.replace(/\./g,"_"):ke.isThemeIcon(s.icon)&&s.icon.color&&(e=s.icon.color.id.replace(/\./g,"_")),e)return`terminal-icon-${e.replace(/\./g,"_")}`}function kFe(s,e,t){const i=s.icon;if(!i)return;const n=[];let o;if(i instanceof R?o=i:i instanceof Object&&"light"in i&&"dark"in i&&(o=e===Ck.LIGHT?i.light:i.dark),o instanceof R){const a=`terminal-uri-icon-${lc(o.path).toString(36)}`;n.push(a),n.push("terminal-uri-icon")}return n}var m$;(function(s){s.FocusAccessibleBuffer="workbench.action.terminal.focusAccessibleBuffer",s.AccessibleBufferGoToNextCommand="workbench.action.terminal.accessibleBufferGoToNextCommand",s.AccessibleBufferGoToPreviousCommand="workbench.action.terminal.accessibleBufferGoToPreviousCommand",s.ScrollToBottomAccessibleView="workbench.action.terminal.scrollToBottomAccessibleView",s.ScrollToTopAccessibleView="workbench.action.terminal.scrollToTopAccessibleView"})(m$||(m$={}));const TFe=[m$.FocusAccessibleBuffer];var fL;(function(s){s.AccessibleViewPreserveCursorPosition="terminal.integrated.accessibleViewPreserveCursorPosition",s.AccessibleViewFocusOnCommandExecution="terminal.integrated.accessibleViewFocusOnCommandExecution"})(fL||(fL={}));fL.AccessibleViewPreserveCursorPosition+"",h(10526,"Preserve the cursor position on reopen of the terminal's accessible view rather than setting it to the bottom of the buffer."),fL.AccessibleViewFocusOnCommandExecution+"",h(10527,"Focus the terminal accessible view when a command is executed.");var v$;(function(s){s.AutoReplies="terminal.integrated.autoReplies"})(v$||(v$={}));v$.AutoReplies+"",h(10528,`A set of messages that, when encountered in the terminal, will be automatically responded to. Provided the message is specific enough, this can help automate away common responses.

Remarks:

- Use {0} to automatically respond to the terminate batch job prompt on Windows.
- The message includes escape sequences so the reply might not happen with styled text.
- Each reply can only happen once every second.
- Use {1} in the reply to mean the enter key.
- To unset a default key, set the value to null.
- Restart VS Code if new don't apply.`,'`"Terminate batch job (Y/N)": "Y\\r"`','`"\\r"`'),h(10529,"The reply to send to the process.");var _$;(function(s){s.Enabled="terminal.integrated.initialHint"})(_$||(_$={}));_$.Enabled+"",h(10571,"Controls if the first terminal without input will show a hint about available actions when it is focused.");var b$;(function(s){s.ShowCommandGuide="terminal.integrated.shellIntegration.showCommandGuide"})(b$||(b$={}));b$.ShowCommandGuide+"",h(10586,"Whether to show the command guide when hovering over a command in the terminal.");var $l;(function(s){s.FindFocus="workbench.action.terminal.focusFind",s.FindHide="workbench.action.terminal.hideFind",s.FindNext="workbench.action.terminal.findNext",s.FindPrevious="workbench.action.terminal.findPrevious",s.ToggleFindRegex="workbench.action.terminal.toggleFindRegex",s.ToggleFindWholeWord="workbench.action.terminal.toggleFindWholeWord",s.ToggleFindCaseSensitive="workbench.action.terminal.toggleFindCaseSensitive",s.SearchWorkspace="workbench.action.terminal.searchWorkspace"})($l||($l={}));const AFe=[$l.FindFocus,$l.FindHide,$l.FindNext,$l.FindPrevious,$l.ToggleFindRegex,$l.ToggleFindWholeWord,$l.ToggleFindCaseSensitive,$l.SearchWorkspace];var mL;(function(s){s.ClearPreviousSessionHistory="workbench.action.terminal.clearPreviousSessionHistory",s.GoToRecentDirectory="workbench.action.terminal.goToRecentDirectory",s.RunRecentCommand="workbench.action.terminal.runRecentCommand"})(mL||(mL={}));const RFe=[mL.GoToRecentDirectory,mL.RunRecentCommand];var y$;(function(s){s.ShellIntegrationCommandHistory="terminal.integrated.shellIntegration.history"})(y$||(y$={}));y$.ShellIntegrationCommandHistory+"",h(10617,"Controls the number of recently used commands to keep in the terminal command history. Set to 0 to disable terminal command history.");var vL;(function(s){s.Enabled="terminal.integrated.stickyScroll.enabled",s.MaxLineCount="terminal.integrated.stickyScroll.maxLineCount"})(vL||(vL={}));vL.Enabled+"",h(10667,"Shows the current command at the top of the terminal. This feature requires [shell integration]({0}) to be activated. See {1}.","https://code.visualstudio.com/docs/terminal/shell-integration",`\`#${$c.ShellIntegrationEnabled}#\``),vL.MaxLineCount+"",h(10668,"Defines the maximum number of sticky lines to show. Sticky scroll lines will never exceed 40% of the viewport regardless of this setting.");var Pc;(function(s){s.SelectPrevSuggestion="workbench.action.terminal.selectPrevSuggestion",s.SelectPrevPageSuggestion="workbench.action.terminal.selectPrevPageSuggestion",s.SelectNextSuggestion="workbench.action.terminal.selectNextSuggestion",s.SelectNextPageSuggestion="workbench.action.terminal.selectNextPageSuggestion",s.AcceptSelectedSuggestion="workbench.action.terminal.acceptSelectedSuggestion",s.AcceptSelectedSuggestionEnter="workbench.action.terminal.acceptSelectedSuggestionEnter",s.HideSuggestWidget="workbench.action.terminal.hideSuggestWidget",s.HideSuggestWidgetAndNavigateHistory="workbench.action.terminal.hideSuggestWidgetAndNavigateHistory",s.RequestCompletions="workbench.action.terminal.requestCompletions",s.ResetWidgetSize="workbench.action.terminal.resetSuggestWidgetSize",s.ToggleDetails="workbench.action.terminal.suggestToggleDetails",s.ToggleDetailsFocus="workbench.action.terminal.suggestToggleDetailsFocus",s.ConfigureSettings="workbench.action.terminal.configureSuggestSettings"})(Pc||(Pc={}));const PFe=[Pc.SelectPrevSuggestion,Pc.SelectPrevPageSuggestion,Pc.SelectNextSuggestion,Pc.SelectNextPageSuggestion,Pc.AcceptSelectedSuggestion,Pc.AcceptSelectedSuggestionEnter,Pc.HideSuggestWidget,Pc.RequestCompletions,Pc.ToggleDetails,Pc.ToggleDetailsFocus];var Va;(function(s){s.Enabled="terminal.integrated.suggest.enabled",s.QuickSuggestions="terminal.integrated.suggest.quickSuggestions",s.SuggestOnTriggerCharacters="terminal.integrated.suggest.suggestOnTriggerCharacters",s.RunOnEnter="terminal.integrated.suggest.runOnEnter",s.WindowsExecutableExtensions="terminal.integrated.suggest.windowsExecutableExtensions",s.Providers="terminal.integrated.suggest.providers",s.ShowStatusBar="terminal.integrated.suggest.showStatusBar",s.CdPath="terminal.integrated.suggest.cdPath",s.InlineSuggestion="terminal.integrated.suggest.inlineSuggestion",s.UpArrowNavigatesHistory="terminal.integrated.suggest.upArrowNavigatesHistory"})(Va||(Va={}));const LFe=["exe","bat","cmd","com","msi","ps1","vbs","js","jar","py","rb","pl","sh"];Va.Enabled+"",h(10711,`Enables terminal intellisense suggestions (preview) for supported shells ({0}) when {1} is set to {2}.

If shell integration is installed manually, {3} needs to be set to {4} before calling the shell integration script.`,"PowerShell v7+, zsh, bash, fish",`\`#${$c.ShellIntegrationEnabled}#\``,"`true`","`VSCODE_SUGGEST`","`1`"),Va.Providers+"",h(10712,"Providers are enabled by default. Omit them by setting the id of the provider to `false`."),Va.QuickSuggestions+"",h(10713,"Controls whether suggestions should automatically show up while typing. Also be aware of the {0}-setting which controls if suggestions are triggered by special characters.",`\`#${Va.SuggestOnTriggerCharacters}#\``),h(10714,"Enable quick suggestions for commands, the first word in a command line input."),h(10715,"Enable quick suggestions for arguments, anything after the first word in a command line input."),h(10716,"Enable quick suggestions when it's unclear what the best suggestion is, if this is on files and folders will be suggested as a fallback."),Va.SuggestOnTriggerCharacters+"",h(10717,"Controls whether suggestions should automatically show up when typing trigger characters."),Va.RunOnEnter+"",h(10718,"Controls whether suggestions should run immediately when `Enter` (not `Tab`) is used to accept the result."),h(10719,"Ignore suggestions and send the enter directly to the shell without completing. This is used as the default value so the suggest widget is as unobtrusive as possible."),h(10720,"Never run on `Enter`."),h(10721,"Run on `Enter` when the suggestion is typed in its entirety."),h(10722,"Run on `Enter` when the suggestion is typed in its entirety or when a file is typed without its extension included."),h(10723,"Always run on `Enter`."),Va.WindowsExecutableExtensions+"",h(10724,`A set of windows command executable extensions that will be included as suggestions in the terminal.

Many executables are included by default, listed below:

{0}.

To exclude an extension, set it to \`false\`

. To include one not in the list, add it and set it to \`true\`.`,LFe.sort().map(s=>`- ${s}`).join(`
`)),Va.ShowStatusBar+"",h(10725,"Controls whether the terminal suggestions status bar should be shown."),Va.CdPath+"",h(10726,"Controls whether to enable $CDPATH support which exposes children of the folders in the $CDPATH variable regardless of the current working directory. $CDPATH is expected to be semi colon-separated on Windows and colon-separated on other platforms."),h(10727,"Disable the feature."),h(10728,"Enable the feature and use relative paths."),h(10729,"Enable the feature and use absolute paths. This is useful when the shell doesn't natively support `$CDPATH`."),Va.InlineSuggestion+"",h(10730,"Controls whether the shell's inline suggestion should be detected and how it is scored."),h(10731,"Disable the feature."),h(10732,"Enable the feature and sort the inline suggestion without forcing it to be on top. This means that exact matches will be will be above the inline suggestion."),h(10733,"Enable the feature and always put the inline suggestion on top."),Va.UpArrowNavigatesHistory+"",h(10734,"Determines whether the up arrow key navigates the command history when focus is on the first suggestion and navigation has not yet occurred. When set to false, the up arrow will move focus to the last suggestion instead.");var vb;(function(s){s.LocalEchoLatencyThreshold="terminal.integrated.localEchoLatencyThreshold",s.LocalEchoEnabled="terminal.integrated.localEchoEnabled",s.LocalEchoExcludePrograms="terminal.integrated.localEchoExcludePrograms",s.LocalEchoStyle="terminal.integrated.localEchoStyle"})(vb||(vb={}));vb.LocalEchoLatencyThreshold+"",h(10735,"Length of network delay, in milliseconds, where local edits will be echoed on the terminal without waiting for server acknowledgement. If '0', local echo will always be on, and if '-1' it will be disabled."),vb.LocalEchoEnabled+"",h(10736,"When local echo should be enabled. This will override {0}","`#terminal.integrated.localEchoLatencyThreshold#`"),h(10737,"Always enabled"),h(10738,"Always disabled"),h(10739,"Enabled only for remote workspaces"),vb.LocalEchoExcludePrograms+"",h(10740,"Local echo will be disabled when any of these program names are found in the terminal title."),vb.LocalEchoStyle+"",h(10741,"Terminal style of locally echoed text; either a font style or an RGB color.");var HJ;(function(s){s.FontZoomIn="workbench.action.terminal.fontZoomIn",s.FontZoomOut="workbench.action.terminal.fontZoomOut",s.FontZoomReset="workbench.action.terminal.fontZoomReset"})(HJ||(HJ={}));var w$;(function(s){s.MouseWheelZoom="terminal.integrated.mouseWheelZoom"})(w$||(w$={}));w$.MouseWheelZoom+"",Yt?h(10747,"Zoom the font of the terminal when using mouse wheel and holding `Cmd`."):h(10748,"Zoom the font of the terminal when using mouse wheel and holding `Ctrl`.");var UJ;(function(s){s.A11yFocusAccessibleBuffer="workbench.action.terminal.focusAccessibleBuffer",s.DeveloperRestartPtyHost="workbench.action.terminal.restartPtyHost"})(UJ||(UJ={}));var $J;(function(s){s.SuggestEnabled="terminal.integrated.suggest.enabled",s.StickyScrollEnabled="terminal.integrated.stickyScroll.enabled"})($J||($J={}));const MFe=[...TFe,...AFe,...RFe,...PFe],NFe="terminal";var GJ;(function(s){s[s.Uninitialized=1]="Uninitialized",s[s.Launching=2]="Launching",s[s.Running=3]="Running",s[s.KilledDuringLaunch=4]="KilledDuringLaunch",s[s.KilledByUser=5]="KilledByUser",s[s.KilledByProcess=6]="KilledByProcess"})(GJ||(GJ={}));var Mt;(function(s){s.Toggle="workbench.action.terminal.toggleTerminal",s.Kill="workbench.action.terminal.kill",s.KillViewOrEditor="workbench.action.terminal.killViewOrEditor",s.KillEditor="workbench.action.terminal.killEditor",s.KillActiveTab="workbench.action.terminal.killActiveTab",s.KillAll="workbench.action.terminal.killAll",s.QuickKill="workbench.action.terminal.quickKill",s.ConfigureTerminalSettings="workbench.action.terminal.openSettings",s.ShellIntegrationLearnMore="workbench.action.terminal.learnMore",s.CopyLastCommand="workbench.action.terminal.copyLastCommand",s.CopyLastCommandOutput="workbench.action.terminal.copyLastCommandOutput",s.CopyLastCommandAndLastCommandOutput="workbench.action.terminal.copyLastCommandAndLastCommandOutput",s.CopyAndClearSelection="workbench.action.terminal.copyAndClearSelection",s.CopySelection="workbench.action.terminal.copySelection",s.CopySelectionAsHtml="workbench.action.terminal.copySelectionAsHtml",s.SelectAll="workbench.action.terminal.selectAll",s.DeleteWordLeft="workbench.action.terminal.deleteWordLeft",s.DeleteWordRight="workbench.action.terminal.deleteWordRight",s.DeleteToLineStart="workbench.action.terminal.deleteToLineStart",s.MoveToLineStart="workbench.action.terminal.moveToLineStart",s.MoveToLineEnd="workbench.action.terminal.moveToLineEnd",s.New="workbench.action.terminal.new",s.NewWithCwd="workbench.action.terminal.newWithCwd",s.NewLocal="workbench.action.terminal.newLocal",s.NewInActiveWorkspace="workbench.action.terminal.newInActiveWorkspace",s.NewWithProfile="workbench.action.terminal.newWithProfile",s.Split="workbench.action.terminal.split",s.SplitActiveTab="workbench.action.terminal.splitActiveTab",s.SplitInActiveWorkspace="workbench.action.terminal.splitInActiveWorkspace",s.Unsplit="workbench.action.terminal.unsplit",s.JoinActiveTab="workbench.action.terminal.joinActiveTab",s.Join="workbench.action.terminal.join",s.Relaunch="workbench.action.terminal.relaunch",s.FocusPreviousPane="workbench.action.terminal.focusPreviousPane",s.CreateTerminalEditor="workbench.action.createTerminalEditor",s.CreateTerminalEditorSameGroup="workbench.action.createTerminalEditorSameGroup",s.CreateTerminalEditorSide="workbench.action.createTerminalEditorSide",s.FocusTabs="workbench.action.terminal.focusTabs",s.FocusNextPane="workbench.action.terminal.focusNextPane",s.ResizePaneLeft="workbench.action.terminal.resizePaneLeft",s.ResizePaneRight="workbench.action.terminal.resizePaneRight",s.ResizePaneUp="workbench.action.terminal.resizePaneUp",s.SizeToContentWidth="workbench.action.terminal.sizeToContentWidth",s.SizeToContentWidthActiveTab="workbench.action.terminal.sizeToContentWidthActiveTab",s.ResizePaneDown="workbench.action.terminal.resizePaneDown",s.Focus="workbench.action.terminal.focus",s.FocusNext="workbench.action.terminal.focusNext",s.FocusPrevious="workbench.action.terminal.focusPrevious",s.Paste="workbench.action.terminal.paste",s.PasteSelection="workbench.action.terminal.pasteSelection",s.SelectDefaultProfile="workbench.action.terminal.selectDefaultShell",s.RunSelectedText="workbench.action.terminal.runSelectedText",s.RunActiveFile="workbench.action.terminal.runActiveFile",s.SwitchTerminal="workbench.action.terminal.switchTerminal",s.ScrollDownLine="workbench.action.terminal.scrollDown",s.ScrollDownPage="workbench.action.terminal.scrollDownPage",s.ScrollToBottom="workbench.action.terminal.scrollToBottom",s.ScrollUpLine="workbench.action.terminal.scrollUp",s.ScrollUpPage="workbench.action.terminal.scrollUpPage",s.ScrollToTop="workbench.action.terminal.scrollToTop",s.Clear="workbench.action.terminal.clear",s.ClearSelection="workbench.action.terminal.clearSelection",s.ChangeIcon="workbench.action.terminal.changeIcon",s.ChangeIconActiveTab="workbench.action.terminal.changeIconActiveTab",s.ChangeColor="workbench.action.terminal.changeColor",s.ChangeColorActiveTab="workbench.action.terminal.changeColorActiveTab",s.Rename="workbench.action.terminal.rename",s.RenameActiveTab="workbench.action.terminal.renameActiveTab",s.RenameWithArgs="workbench.action.terminal.renameWithArg",s.ScrollToPreviousCommand="workbench.action.terminal.scrollToPreviousCommand",s.ScrollToNextCommand="workbench.action.terminal.scrollToNextCommand",s.SelectToPreviousCommand="workbench.action.terminal.selectToPreviousCommand",s.SelectToNextCommand="workbench.action.terminal.selectToNextCommand",s.SelectToPreviousLine="workbench.action.terminal.selectToPreviousLine",s.SelectToNextLine="workbench.action.terminal.selectToNextLine",s.SendSequence="workbench.action.terminal.sendSequence",s.AttachToSession="workbench.action.terminal.attachToSession",s.DetachSession="workbench.action.terminal.detachSession",s.MoveToEditor="workbench.action.terminal.moveToEditor",s.MoveToTerminalPanel="workbench.action.terminal.moveToTerminalPanel",s.MoveIntoNewWindow="workbench.action.terminal.moveIntoNewWindow",s.SetDimensions="workbench.action.terminal.setDimensions",s.FocusHover="workbench.action.terminal.focusHover",s.ShowEnvironmentContributions="workbench.action.terminal.showEnvironmentContributions",s.StartVoice="workbench.action.terminal.startVoice",s.StopVoice="workbench.action.terminal.stopVoice"})(Mt||(Mt={}));[Mt.ClearSelection,Mt.Clear,Mt.CopyAndClearSelection,Mt.CopySelection,Mt.CopySelectionAsHtml,Mt.CopyLastCommand,Mt.CopyLastCommandOutput,Mt.CopyLastCommandAndLastCommandOutput,Mt.DeleteToLineStart,Mt.DeleteWordLeft,Mt.DeleteWordRight,Mt.FocusNextPane,Mt.FocusNext,Mt.FocusPreviousPane,Mt.FocusPrevious,Mt.Focus,Mt.SizeToContentWidth,Mt.Kill,Mt.KillEditor,Mt.MoveToEditor,Mt.MoveToLineEnd,Mt.MoveToLineStart,Mt.MoveToTerminalPanel,Mt.NewInActiveWorkspace,Mt.New,Mt.Paste,Mt.PasteSelection,Mt.ResizePaneDown,Mt.ResizePaneLeft,Mt.ResizePaneRight,Mt.ResizePaneUp,Mt.RunActiveFile,Mt.RunSelectedText,Mt.ScrollDownLine,Mt.ScrollDownPage,Mt.ScrollToBottom,Mt.ScrollToNextCommand,Mt.ScrollToPreviousCommand,Mt.ScrollToTop,Mt.ScrollUpLine,Mt.ScrollUpPage,Mt.SendSequence,Mt.SelectAll,Mt.SelectToNextCommand,Mt.SelectToNextLine,Mt.SelectToPreviousCommand,Mt.SelectToPreviousLine,Mt.SplitInActiveWorkspace,Mt.Split,Mt.Toggle,Mt.FocusHover,Bo.OpenAccessibilityHelp,...MFe];h(10275,"Contributes terminal functionality."),h(10276,"Defines additional terminal profiles that the user can create."),h(10277,"The ID of the terminal profile provider."),h(10278,"Title for this terminal profile."),h(10279,"A codicon, URI, or light and dark URIs to associate with this terminal type."),h(10280,"Icon path when a light theme is used"),h(10281,"Icon path when a dark theme is used");var ji;(function(s){s.IsOpen="terminalIsOpen",s.Count="terminalCount",s.GroupCount="terminalGroupCount",s.TabsNarrow="isTerminalTabsNarrow",s.HasFixedWidth="terminalHasFixedWidth",s.ProcessSupported="terminalProcessSupported",s.Focus="terminalFocus",s.FocusInAny="terminalFocusInAny",s.AccessibleBufferFocus="terminalAccessibleBufferFocus",s.AccessibleBufferOnLastLine="terminalAccessibleBufferOnLastLine",s.EditorFocus="terminalEditorFocus",s.TabsFocus="terminalTabsFocus",s.WebExtensionContributedProfile="terminalWebExtensionContributedProfile",s.TerminalHasBeenCreated="terminalHasBeenCreated",s.TerminalEditorActive="terminalEditorActive",s.TabsMouse="terminalTabsMouse",s.AltBufferActive="terminalAltBufferActive",s.SuggestWidgetVisible="terminalSuggestWidgetVisible",s.A11yTreeFocus="terminalA11yTreeFocus",s.ViewShowing="terminalViewShowing",s.TextSelected="terminalTextSelected",s.TextSelectedInFocused="terminalTextSelectedInFocused",s.FindVisible="terminalFindVisible",s.FindInputFocused="terminalFindInputFocused",s.FindFocused="terminalFindFocused",s.TabsSingularSelection="terminalTabsSingularSelection",s.SplitTerminal="terminalSplitTerminal",s.ShellType="terminalShellType",s.InTerminalRunCommandPicker="inTerminalRunCommandPicker",s.TerminalShellIntegrationEnabled="terminalShellIntegrationEnabled"})(ji||(ji={}));var S$;(function(s){s.isOpen=new O(ji.IsOpen,!1,!0),s.focus=new O(ji.Focus,!1,h(10462,"Whether the terminal is focused.")),s.focusInAny=new O(ji.FocusInAny,!1,h(10463,"Whether any terminal is focused, including detached terminals used in other UI.")),s.editorFocus=new O(ji.EditorFocus,!1,h(10464,"Whether a terminal in the editor area is focused.")),s.count=new O(ji.Count,0,h(10465,"The current number of terminals.")),s.groupCount=new O(ji.GroupCount,0,!0),s.tabsNarrow=new O(ji.TabsNarrow,!1,!0),s.terminalHasFixedWidth=new O(ji.HasFixedWidth,!1,!0),s.tabsFocus=new O(ji.TabsFocus,!1,h(10466,"Whether the terminal tabs widget is focused.")),s.webExtensionContributedProfile=new O(ji.WebExtensionContributedProfile,!1,!0),s.terminalHasBeenCreated=new O(ji.TerminalHasBeenCreated,!1,!0),s.terminalEditorActive=new O(ji.TerminalEditorActive,!1,!0),s.tabsMouse=new O(ji.TabsMouse,!1,!0),s.shellType=new O(ji.ShellType,void 0,{type:"string",description:h(10467,"The shell type of the active terminal, this is set if the type can be detected.")}),s.altBufferActive=new O(ji.AltBufferActive,!1,h(10468,"Whether the terminal's alt buffer is active.")),s.suggestWidgetVisible=new O(ji.SuggestWidgetVisible,!1,h(10469,"Whether the terminal's suggest widget is visible.")),s.notFocus=s.focus.toNegated(),s.viewShowing=new O(ji.ViewShowing,!1,h(10470,"Whether the terminal view is showing")),s.textSelected=new O(ji.TextSelected,!1,h(10471,"Whether text is selected in the active terminal.")),s.textSelectedInFocused=new O(ji.TextSelectedInFocused,!1,h(10472,"Whether text is selected in a focused terminal.")),s.notTextSelected=s.textSelected.toNegated(),s.findVisible=new O(ji.FindVisible,!1,!0),s.notFindVisible=s.findVisible.toNegated(),s.findInputFocus=new O(ji.FindInputFocused,!1,!0),s.findFocus=new O(ji.FindFocused,!1,!0),s.notFindFocus=s.findInputFocus.toNegated(),s.processSupported=new O(ji.ProcessSupported,!1,h(10473,"Whether terminal processes can be launched in the current workspace.")),s.tabsSingularSelection=new O(ji.TabsSingularSelection,!1,h(10474,"Whether one terminal is selected in the terminal tabs list.")),s.splitTerminal=new O(ji.SplitTerminal,!1,h(10475,"Whether the focused tab's terminal is a split terminal.")),s.inTerminalRunCommandPicker=new O(ji.InTerminalRunCommandPicker,!1,h(10476,"Whether the terminal run command picker is currently open.")),s.terminalShellIntegrationEnabled=new O(ji.TerminalShellIntegrationEnabled,!1,h(10477,"Whether shell integration is enabled in the active terminal")),s.shouldShowViewInlineActions=x.and(x.equals("view",NFe),x.notEquals(`config.${$c.TabsHideCondition}`,"never"),x.or(x.not(`config.${$c.TabsEnabled}`),x.and(x.equals(`config.${$c.TabsShowActions}`,"singleTerminal"),x.equals(ji.GroupCount,1)),x.and(x.equals(`config.${$c.TabsShowActions}`,"singleTerminalOrNarrow"),x.or(x.equals(ji.GroupCount,1),x.has(ji.TabsNarrow))),x.and(x.equals(`config.${$c.TabsShowActions}`,"singleGroup"),x.equals(ji.GroupCount,1)),x.equals(`config.${$c.TabsShowActions}`,"always")))})(S$||(S$={}));var fT;let C$=class extends dl{static{fT=this}static{this.ID="workbench.editors.terminal"}setGroup(e){this._group=e,e?.scopedContextKeyService&&this._terminalInstance?.setParentContextKeyService(e.scopedContextKeyService)}get group(){return this._group}get typeId(){return fT.ID}get editorId(){return _j}get capabilities(){return Je.Readonly|Je.Singleton|Je.CanDropIntoEditor|Je.ForceDescription}setTerminalInstance(e){if(this._terminalInstance)throw new Error("cannot set instance that has already been set");this._terminalInstance=e,this._setupInstanceListeners()}copy(){const e=this._terminalInstanceService.createInstance(this._copyLaunchConfig||{},wy.Editor);return e.focusWhenReady(),this._copyLaunchConfig=void 0,this._instantiationService.createInstance(fT,e.resource,e)}setCopyLaunchConfig(e){this._copyLaunchConfig=e}get terminalInstance(){return this._isDetached?void 0:this._terminalInstance}showConfirm(){if(this._isReverted)return!1;const e=this._configurationService.getValue($c.ConfirmOnKill);return(e==="editor"||e==="always")&&this._terminalInstance?.hasChildProcesses||!1}async confirm(e){const{confirmed:t}=await this._dialogService.confirm({type:Fe.Warning,message:h(10145,"Do you want to terminate running processes?"),primaryButton:h(10146,"&&Terminate"),detail:e.length>1?e.map(i=>i.editor.getName()).join(`
`)+`

`+h(10147,"Closing will terminate the running processes in the terminals."):h(10148,"Closing will terminate the running processes in this terminal.")});return t?Yi.DONT_SAVE:Yi.CANCEL}async revert(){this._isReverted=!0}constructor(e,t,i,n,o,r,a,c,d){super(),this.resource=e,this._terminalInstance=t,this._themeService=i,this._terminalInstanceService=n,this._instantiationService=o,this._configurationService=r,this._lifecycleService=a,this._contextKeyService=c,this._dialogService=d,this.closeHandler=this,this._isDetached=!1,this._isShuttingDown=!1,this._isReverted=!1,this._onDidRequestAttach=this._register(new M),this.onDidRequestAttach=this._onDidRequestAttach.event,this._terminalEditorFocusContextKey=S$.editorFocus.bindTo(c),t&&this._setupInstanceListeners()}_setupInstanceListeners(){const e=this._terminalInstance;if(!e)return;const t=e.onDidFocus(()=>this._terminalEditorFocusContextKey.set(!0)),i=e.onDidBlur(()=>this._terminalEditorFocusContextKey.reset());this._register(Ie(()=>{!this._isDetached&&!this._isShuttingDown&&e.dispose(Am.User),Xe([t,i])}));const n=[e.onExit(o=>{e.waitOnExit||this.dispose()}),e.onDisposed(()=>this.dispose()),e.onTitleChanged(()=>this._onDidChangeLabel.fire()),e.onIconChanged(()=>this._onDidChangeLabel.fire()),t,i,e.statusList.onDidChangePrimaryStatus(()=>this._onDidChangeLabel.fire())];this._lifecycleService.onWillShutdown(o=>{this._isShuttingDown=!0,Xe(n),this._configurationService.getValue($c.EnablePersistentSessions)&&o.reason===Ib.RELOAD?e.detachProcessAndDispose(Am.Shutdown):e.dispose(Am.Shutdown)})}getName(){return this._terminalInstance?.title||this.resource.fragment}getIcon(){if(!(!this._terminalInstance||!ke.isThemeIcon(this._terminalInstance.icon)))return this._terminalInstance.icon}getLabelExtraClasses(){if(!this._terminalInstance)return[];const e=["terminal-tab","predefined-file-icon"],t=DFe(this._terminalInstance);t&&e.push(t);const i=kFe(this._terminalInstance,this._themeService.getColorTheme().type);return i&&e.push(...i),e}detachInstance(){this._isShuttingDown||(this._terminalInstance?.detachFromElement(),this._terminalInstance?.setParentContextKeyService(this._contextKeyService),this._isDetached=!0)}getDescription(){return this._terminalInstance?.description}toUntyped(){return{resource:this.resource,options:{override:_j,pinned:!0,forceReload:!0}}}};C$=fT=f([p(2,pt),p(3,Nre),p(4,Z),p(5,ne),p(6,wd),p(7,fe),p(8,ei)],C$);let zJ=class{constructor(e,t,i,n,o){this._editorGroupsService=t,this._configurationService=i,this._logService=n,this._dispoables=new U,this._tabGroupModel=[],this._groupLookup=new Map,this._tabInfoLookup=new Map,this._multiDiffEditorInputListeners=new ti,this._proxy=e.getProxy(Ze.ExtHostEditorTabs),this._dispoables.add(o.onDidEditorsChange(r=>{try{this._updateTabsModel(r)}catch{this._logService.error("Failed to update model, rebuilding"),this._createTabsModel()}})),this._dispoables.add(this._multiDiffEditorInputListeners),this._dispoables.add(this._editorGroupsService.onDidAddGroup(()=>this._createTabsModel())),this._dispoables.add(this._editorGroupsService.onDidRemoveGroup(()=>this._createTabsModel())),this._editorGroupsService.whenReady.then(()=>this._createTabsModel())}dispose(){this._groupLookup.clear(),this._tabInfoLookup.clear(),this._dispoables.dispose()}_buildTabObject(e,t,i){const n=t.editorId;return{id:this._generateTabId(t,e.id),label:t.getName(),editorId:n,input:this._editorInputToDto(t),isPinned:e.isSticky(i),isPreview:!e.isPinned(i),isActive:e.isActive(t),isDirty:t.isDirty()}}_editorInputToDto(e){if(e instanceof f$)return{kind:$o.TextMergeInput,base:e.base,input1:e.input1.uri,input2:e.input2.uri,result:e.resource};if(e instanceof Qd)return{kind:$o.TextInput,uri:e.resource};if(e instanceof ks&&!(e instanceof go)){const t=e.primary.resource,i=e.secondary.resource;return e.primary instanceof Qd&&e.secondary instanceof Qd&&At(t,i)&&t&&i?{kind:$o.TextInput,uri:t}:{kind:$o.UnknownInput}}if(e instanceof Fm)return{kind:$o.NotebookInput,notebookType:e.viewType,uri:e.resource};if(e instanceof Yb)return{kind:$o.CustomEditorInput,viewType:e.viewType,uri:e.resource};if(e instanceof pr)return{kind:$o.WebviewEditorInput,viewType:e.viewType};if(e instanceof C$)return{kind:$o.TerminalEditorInput};if(e instanceof go){if(e.modified instanceof Qd&&e.original instanceof Qd)return{kind:$o.TextDiffInput,modified:e.modified.resource,original:e.original.resource};if(e.modified instanceof Fm&&e.original instanceof Fm)return{kind:$o.NotebookDiffInput,notebookType:e.original.viewType,modified:e.modified.resource,original:e.original.resource}}if(e instanceof a$)return{kind:$o.InteractiveEditorInput,uri:e.resource,inputBoxUri:e.inputResource};if(e instanceof VH)return{kind:$o.ChatEditorInput};if(e instanceof Qb){const t=[];for(const i of e?.resources.get()??[])i.originalUri&&i.modifiedUri&&t.push({kind:$o.TextDiffInput,original:i.originalUri,modified:i.modifiedUri});return{kind:$o.MultiDiffEditorInput,diffEditors:t}}return{kind:$o.UnknownInput}}_generateTabId(e,t){let i;const n=Di.getCanonicalUri(e,{supportSideBySide:qt.BOTH});return n instanceof R?i=n.toString():i=`${n?.primary?.toString()}-${n?.secondary?.toString()}`,`${t}~${e.editorId}-${e.typeId}-${i} `}_onDidGroupActivate(){const e=this._editorGroupsService.activeGroup.id,t=this._groupLookup.get(e);t&&(t.isActive=!0,this._proxy.$acceptTabGroupUpdate(t))}_onDidTabLabelChange(e,t,i){const n=this._generateTabId(t,e),o=this._tabInfoLookup.get(n);o?(o.tab.label=t.getName(),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:o.tab,kind:Nd.TAB_UPDATE})):(this._logService.error("Invalid model for label change, rebuilding"),this._createTabsModel())}_onDidTabOpen(e,t,i){const n=this._editorGroupsService.getGroup(e),o=this._groupLookup.get(e)!==void 0;if(!n||!o){this._createTabsModel();return}const r=this._groupLookup.get(e)?.tabs;if(!r)return;const a=this._buildTabObject(n,t,i);r.splice(i,0,a);const c=this._generateTabId(t,e);this._tabInfoLookup.set(c,{group:n,editorInput:t,tab:a}),t instanceof Qb&&this._multiDiffEditorInputListeners.set(t,T.fromObservableLight(t.resources)(()=>{const d=this._tabInfoLookup.get(c);d&&(d.tab=this._buildTabObject(n,t,i),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:d.tab,kind:Nd.TAB_UPDATE}))})),this._proxy.$acceptTabOperation({groupId:e,index:i,tabDto:a,kind:Nd.TAB_OPEN})}_onDidTabClose(e,t){const i=this._editorGroupsService.getGroup(e),n=this._groupLookup.get(e)?.tabs;if(!i||!n){this._createTabsModel();return}const o=n.splice(t,1);o.length!==0&&(this._tabInfoLookup.delete(o[0]?.id??""),o[0]?.input instanceof Qb&&this._multiDiffEditorInputListeners.deleteAndDispose(o[0]?.input),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:o[0],kind:Nd.TAB_CLOSE}))}_onDidTabActiveChange(e,t){const i=this._groupLookup.get(e)?.tabs;if(!i)return;const n=i[t];n.isActive=!0,this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:n,kind:Nd.TAB_UPDATE})}_onDidTabDirty(e,t,i){const n=this._generateTabId(i,e),o=this._tabInfoLookup.get(n);if(!o){this._logService.error("Invalid model for dirty change, rebuilding"),this._createTabsModel();return}o.tab.isDirty=i.isDirty(),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:o.tab,kind:Nd.TAB_UPDATE})}_onDidTabPinChange(e,t,i){const n=this._generateTabId(i,e),o=this._tabInfoLookup.get(n),r=o?.group,a=o?.tab;if(!r||!a){this._logService.error("Invalid model for sticky change, rebuilding"),this._createTabsModel();return}a.isPinned=r.isSticky(t),this._proxy.$acceptTabOperation({groupId:e,index:t,tabDto:a,kind:Nd.TAB_UPDATE})}_onDidTabPreviewChange(e,t,i){const n=this._generateTabId(i,e),o=this._tabInfoLookup.get(n),r=o?.group,a=o?.tab;if(!r||!a){this._logService.error("Invalid model for sticky change, rebuilding"),this._createTabsModel();return}a.isPreview=!r.isPinned(t),this._proxy.$acceptTabOperation({kind:Nd.TAB_UPDATE,groupId:e,tabDto:a,index:t})}_onDidTabMove(e,t,i,n){const o=this._groupLookup.get(e)?.tabs;if(!o){this._logService.error("Invalid model for move change, rebuilding"),this._createTabsModel();return}const r=o.splice(i,1);r.length!==0&&(o.splice(t,0,r[0]),this._proxy.$acceptTabOperation({kind:Nd.TAB_MOVE,groupId:e,tabDto:r[0],index:t,oldIndex:i}))}_createTabsModel(){if(this._editorGroupsService.groups.length===0)return;this._tabGroupModel=[],this._groupLookup.clear(),this._tabInfoLookup.clear();let e=[];for(const t of this._editorGroupsService.groups){const i={groupId:t.id,isActive:t.id===this._editorGroupsService.activeGroup.id,viewColumn:Qp(this._editorGroupsService,t),tabs:[]};t.editors.forEach((n,o)=>{const r=this._buildTabObject(t,n,o);e.push(r),this._tabInfoLookup.set(this._generateTabId(n,t.id),{group:t,tab:r,editorInput:n})}),i.tabs=e,this._tabGroupModel.push(i),this._groupLookup.set(t.id,i),e=[]}this._proxy.$acceptEditorTabModel(this._tabGroupModel)}_updateTabsModel(e){const t=e.event,i=e.groupId;switch(t.kind){case ct.GROUP_ACTIVE:if(i===this._editorGroupsService.activeGroup.id){this._onDidGroupActivate();break}else return;case ct.EDITOR_LABEL:if(t.editor!==void 0&&t.editorIndex!==void 0){this._onDidTabLabelChange(i,t.editor,t.editorIndex);break}case ct.EDITOR_OPEN:if(t.editor!==void 0&&t.editorIndex!==void 0){this._onDidTabOpen(i,t.editor,t.editorIndex);break}case ct.EDITOR_CLOSE:if(t.editorIndex!==void 0){this._onDidTabClose(i,t.editorIndex);break}case ct.EDITOR_ACTIVE:if(t.editorIndex!==void 0){this._onDidTabActiveChange(i,t.editorIndex);break}case ct.EDITOR_DIRTY:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabDirty(i,t.editorIndex,t.editor);break}case ct.EDITOR_STICKY:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabPinChange(i,t.editorIndex,t.editor);break}case ct.EDITOR_PIN:if(t.editorIndex!==void 0&&t.editor!==void 0){this._onDidTabPreviewChange(i,t.editorIndex,t.editor);break}case ct.EDITOR_TRANSIENT:break;case ct.EDITOR_MOVE:if(T0e(t)&&t.editor&&t.editorIndex!==void 0&&t.oldEditorIndex!==void 0){this._onDidTabMove(i,t.editorIndex,t.oldEditorIndex,t.editor);break}default:this._createTabsModel()}}$moveTab(e,t,i,n){const o=Vm(this._editorGroupsService,this._configurationService,i),r=this._tabInfoLookup.get(e);if(!r?.tab)throw new Error(`Attempted to close tab with id ${e} which does not exist`);let c;const d=this._editorGroupsService.getGroup(r.group.id);if(!d)return;if(this._groupLookup.get(o)===void 0){let u=Jt.RIGHT;i===Rr&&(u=zv(this._configurationService)),c=this._editorGroupsService.addGroup(this._editorGroupsService.groups[this._editorGroupsService.groups.length-1],u)}else c=this._editorGroupsService.getGroup(o);if(!c)return;(t<0||t>c.editors.length)&&(t=c.editors.length);const l=r?.editorInput;l&&d.moveEditor(l,c,{index:t,preserveFocus:n})}async $closeTab(e,t){const i=new Map;for(const o of e){const r=this._tabInfoLookup.get(o),a=r?.tab,c=r?.group,d=r?.editorInput;if(!c||!a||!r||!d)continue;const l=i.get(c);l?l.push(d):i.set(c,[d])}const n=[];for(const[o,r]of i)n.push(await o.closeEditors(r,{preserveFocus:t}));return n.every(o=>o)}async $closeGroup(e,t){const i=[];for(const n of e){const o=this._editorGroupsService.getGroup(n);o&&(i.push(await o.closeAllEditors()),o.count===0&&this._editorGroupsService.getGroup(o.id)&&this._editorGroupsService.removeGroup(o))}return i.every(n=>n)}};zJ=f([ht(qe.MainThreadEditorTabs),p(1,xe),p(2,ne),p(3,Re),p(4,de)],zJ);let qJ=class{dispose(){}$onUnexpectedError(e){e&&e.$isError&&(e=zT(e)),mt(e)}};qJ=f([ht(qe.MainThreadErrors)],qJ);let KJ=class{constructor(e,t,i,n,o,r,a,c,d){this._extensionService=t,this._notificationService=i,this._extensionsWorkbenchService=n,this._hostService=o,this._extensionEnablementService=r,this._timerService=a,this._commandService=c,this._environmentService=d,this._extensionHostKind=e.extensionHostKind;const l=e;this._internalExtensionService=l.internalExtensionService,l._setExtensionHostProxy(new OFe(e.getProxy(Ze.ExtHostExtensionService))),l._setAllMainProxyIdentifiers(Object.keys(qe).map(u=>qe[u]))}dispose(){}$getExtension(e){return this._extensionService.getExtension(e)}$activateExtension(e,t){return this._internalExtensionService._activateById(e,t)}async $onWillActivateExtension(e){this._internalExtensionService._onWillActivateExtension(e)}$onDidActivateExtension(e,t,i,n,o){this._internalExtensionService._onDidActivateExtension(e,t,i,n,o)}$onExtensionRuntimeError(e,t){const i=zT(t);this._internalExtensionService._onExtensionRuntimeError(e,i),console.error(`[${e.value}]${i.message}`),console.error(i.stack)}async $onExtensionActivationError(e,t,i){const n=zT(t);if(this._internalExtensionService._onDidActivateExtensionError(e,n),i){const r=await this._extensionService.getExtension(e.value);if(r){const c=(await this._extensionsWorkbenchService.queryLocal()).find(d=>ja(d.identifier,{id:i.dependency}));if(c?.local){await this._handleMissingInstalledDependency(r,c.local);return}else{await this._handleMissingNotInstalledDependency(r,i.dependency);return}}}if(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment){this._notificationService.error(n);return}console.error(n.message)}async _handleMissingInstalledDependency(e,t){const i=e.displayName||e.name;if(this._extensionEnablementService.isEnabled(t))this._notificationService.notify({severity:Fe.Error,message:h(2396,"Cannot activate the '{0}' extension because it depends on the '{1}' extension, which is not loaded. Would you like to reload the window to load the extension?",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Xt("reload",h(2397,"Reload Window"),"",!0,()=>this._hostService.reload())]}});else{const n=this._extensionEnablementService.getEnablementState(t);n===gu.DisabledByVirtualWorkspace?this._notificationService.notify({severity:Fe.Error,message:h(2398,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in the current workspace",i,t.manifest.displayName||t.manifest.name)}):n===gu.DisabledByTrustRequirement?this._notificationService.notify({severity:Fe.Error,message:h(2399,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is not supported in Restricted Mode",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Xt("manageWorkspaceTrust",h(2400,"Manage Workspace Trust"),"",!0,()=>this._commandService.executeCommand("workbench.trust.manage"))]}}):this._extensionEnablementService.canChangeEnablement(t)?this._notificationService.notify({severity:Fe.Error,message:h(2401,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled. Would you like to enable the extension and reload the window?",i,t.manifest.displayName||t.manifest.name),actions:{primary:[new Xt("enable",h(2402,"Enable and Reload"),"",!0,()=>this._extensionEnablementService.setEnablement([t],n===gu.DisabledGlobally?gu.EnabledGlobally:gu.EnabledWorkspace).then(()=>this._hostService.reload(),o=>this._notificationService.error(o)))]}}):this._notificationService.notify({severity:Fe.Error,message:h(2403,"Cannot activate the '{0}' extension because it depends on the '{1}' extension which is disabled.",i,t.manifest.displayName||t.manifest.name)})}}async _handleMissingNotInstalledDependency(e,t){const i=e.displayName||e.name;let n=null;try{n=(await this._extensionsWorkbenchService.getExtensions([{id:t}],Ce.None))[0]}catch{}n?this._notificationService.notify({severity:Fe.Error,message:h(2404,"Cannot activate the '{0}' extension because it depends on the '{1}' extension from '{2}', which is not installed. Would you like to install the extension and reload the window?",i,n.displayName,n.publisherDisplayName),actions:{primary:[new Xt("install",h(2405,"Install and Reload"),"",!0,()=>this._extensionsWorkbenchService.install(n).then(()=>this._hostService.reload(),o=>this._notificationService.error(o)))]}}):this._notificationService.error(h(2406,"Cannot activate the '{0}' extension because it depends on an unknown '{1}' extension.",i,t))}async $setPerformanceMarks(e){this._extensionHostKind===Ft.LocalProcess?this._timerService.setPerformanceMarks("localExtHost",e):this._extensionHostKind===Ft.LocalWebWorker?this._timerService.setPerformanceMarks("workerExtHost",e):this._timerService.setPerformanceMarks("remoteExtHost",e)}async $asBrowserUri(e){return nc.uriToBrowserUri(R.revive(e))}async $getAllStaticBrowserUris(){return Array.from(nc.getRegisteredBrowserUris(),e=>[e,nc.uriToBrowserUri(e)])}};KJ=f([ht(qe.MainThreadExtensionService),p(1,cn),p(2,Dt),p(3,Aw),p(4,Hn),p(5,gd),p(6,tae),p(7,Ge),p(8,wn)],KJ);class OFe{constructor(e){this._actual=e}async resolveAuthority(e,t){return FFe(await this._actual.$resolveAuthority(e,t))}async getCanonicalURI(e,t){const i=await this._actual.$getCanonicalURI(e,t);return i&&R.revive(i)}startExtensionHost(e){return this._actual.$startExtensionHost(e)}extensionTestsExecute(){return this._actual.$extensionTestsExecute()}activateByEvent(e,t){return this._actual.$activateByEvent(e,t)}activate(e,t){return this._actual.$activate(e,t)}setRemoteEnvironment(e){return this._actual.$setRemoteEnvironment(e)}updateRemoteConnectionData(e){return this._actual.$updateRemoteConnectionData(e)}deltaExtensions(e){return this._actual.$deltaExtensions(e)}test_latency(e){return this._actual.$test_latency(e)}test_up(e){return this._actual.$test_up(e)}test_down(e){return this._actual.$test_down(e)}}function FFe(s){return s.type==="ok"?{type:"ok",value:{...s.value,authority:WFe(s.value.authority)}}:s}function WFe(s){return{...s,connectTo:BFe(s.connectTo)}}function BFe(s){return s.type===_y.WebSocket?new RCe(s.host,s.port):new ACe(s.id)}var Dc;let jJ=Dc=class{constructor(e,t){this._fileService=t,this._fileProvider=new ti,this._disposables=new U,this._proxy=e.getProxy(Ze.ExtHostFileSystem);const i=e.getProxy(Ze.ExtHostFileSystemInfo);for(const n of t.listCapabilities())i.$acceptProviderInfos(R.from({scheme:n.scheme,path:"/dummy"}),n.capabilities);this._disposables.add(t.onDidChangeFileSystemProviderRegistrations(n=>i.$acceptProviderInfos(R.from({scheme:n.scheme,path:"/dummy"}),n.provider?.capabilities??null))),this._disposables.add(t.onDidChangeFileSystemProviderCapabilities(n=>i.$acceptProviderInfos(R.from({scheme:n.scheme,path:"/dummy"}),n.provider.capabilities)))}dispose(){this._disposables.dispose(),this._fileProvider.dispose()}async $registerFileSystemProvider(e,t,i,n){this._fileProvider.set(e,new i5(this._fileService,t,i,n,e,this._proxy))}$unregisterProvider(e){this._fileProvider.deleteAndDispose(e)}$onFileSystemChange(e,t){const i=this._fileProvider.get(e);if(!i)throw new Error("Unknown file provider");i.$onFileSystemChange(t)}async $stat(e){try{const t=await this._fileService.stat(R.revive(e));return{ctime:t.ctime,mtime:t.mtime,size:t.size,permissions:t.readonly?_be.Readonly:void 0,type:Dc._asFileType(t)}}catch(t){return Dc._handleError(t)}}async $readdir(e){try{const t=await this._fileService.resolve(R.revive(e),{resolveMetadata:!1});if(!t.isDirectory){const i=new Error(t.name);throw i.name=ur.FileNotADirectory,i}return t.children?t.children.map(i=>[i.name,Dc._asFileType(i)]):[]}catch(t){return Dc._handleError(t)}}static _asFileType(e){let t=0;return e.isFile?t+=uC.File:e.isDirectory&&(t+=uC.Directory),e.isSymbolicLink&&(t+=uC.SymbolicLink),t}async $readFile(e){try{return(await this._fileService.readFile(R.revive(e))).value}catch(t){return Dc._handleError(t)}}async $writeFile(e,t){try{await this._fileService.writeFile(R.revive(e),t)}catch(i){return Dc._handleError(i)}}async $rename(e,t,i){try{await this._fileService.move(R.revive(e),R.revive(t),i.overwrite)}catch(n){return Dc._handleError(n)}}async $copy(e,t,i){try{await this._fileService.copy(R.revive(e),R.revive(t),i.overwrite)}catch(n){return Dc._handleError(n)}}async $mkdir(e){try{await this._fileService.createFolder(R.revive(e))}catch(t){return Dc._handleError(t)}}async $delete(e,t){try{return await this._fileService.del(R.revive(e),t)}catch(i){return Dc._handleError(i)}}static _handleError(e){if(e instanceof bbe)switch(e.fileOperationResult){case Kn.FILE_NOT_FOUND:e.name=ur.FileNotFound;break;case Kn.FILE_IS_DIRECTORY:e.name=ur.FileIsADirectory;break;case Kn.FILE_PERMISSION_DENIED:e.name=ur.NoPermissions;break;case Kn.FILE_MOVE_CONFLICT:e.name=ur.FileExists;break}else if(e instanceof Error){const t=ybe(e);t!==ur.Unknown&&(e.name=t)}throw e}$ensureActivation(e){return this._fileService.activateProvider(e)}};jJ=Dc=f([ht(qe.MainThreadFileSystem),p(1,je)],jJ);class i5{constructor(e,t,i,n,o,r){this.readOnlyMessage=n,this._handle=o,this._proxy=r,this._onDidChange=new M,this.onDidChangeFile=this._onDidChange.event,this.onDidChangeCapabilities=T.None,this.capabilities=i,this._registration=e.registerProvider(t,this)}dispose(){this._registration.dispose(),this._onDidChange.dispose()}watch(e,t){const i=Math.random();return this._proxy.$watch(this._handle,i,e,t),Ie(()=>{this._proxy.$unwatch(this._handle,i)})}$onFileSystemChange(e){this._onDidChange.fire(e.map(i5._createFileChange))}static _createFileChange(e){return{resource:R.revive(e.resource),type:e.type}}async stat(e){try{return await this._proxy.$stat(this._handle,e)}catch(t){throw t}}async readFile(e){return(await this._proxy.$readFile(this._handle,e)).buffer}writeFile(e,t,i){return this._proxy.$writeFile(this._handle,e,Le.wrap(t),i)}delete(e,t){return this._proxy.$delete(this._handle,e,t)}mkdir(e){return this._proxy.$mkdir(this._handle,e)}readdir(e){return this._proxy.$readdir(this._handle,e)}rename(e,t,i){return this._proxy.$rename(this._handle,e,t,i)}copy(e,t,i){return this._proxy.$copy(this._handle,e,t,i)}open(e,t){return this._proxy.$open(this._handle,e,t)}close(e){return this._proxy.$close(this._handle,e)}async read(e,t,i,n,o){const r=await this._proxy.$read(this._handle,e,t,o);return i.set(r.buffer,n),r.byteLength}write(e,t,i,n,o){return this._proxy.$write(this._handle,e,t,Le.wrap(i).slice(n,n+o))}}var mT;let E$=class{static{mT=this}static{this.MementoKeyAdditionalEdits="file.particpants.additionalEdits"}constructor(e,t,i,n,o,r,a,c,d,l,u){this._fileService=t,this._logService=u,this._listener=new U,this._watches=new ti,this._proxy=e.getProxy(Ze.ExtHostFileSystemEventService),this._listener.add(t.onDidFilesChange(v=>{this._proxy.$onFileEvent({created:v.rawAdded,changed:v.rawUpdated,deleted:v.rawDeleted})}));const g=this,m=new class{async participate(v,_,w,C,k){if(w?.isUndoing)return;const D=new li(k),A=setTimeout(()=>D.cancel(),C),B=await o.withProgress({location:Xo.Notification,title:this._progressLabel(_),cancellable:!0,delay:Math.min(C/2,3e3)},()=>{const ie=g._proxy.$onWillRunFileOperation(_,v,C,D.token);return Sh(ie,D.token)},()=>{D.cancel()}).finally(()=>{D.dispose(),clearTimeout(A)});if(!B||B.edit.edits.length===0)return;const q=B.edit.edits.some(ie=>ie.metadata?.needsConfirmation);let Q=a.getBoolean(mT.MementoKeyAdditionalEdits,he.PROFILE);if(d.extensionTestsLocationURI&&(Q=!1),Q===void 0){let ie;if(B.extensionNames.length===1?_===fa.CREATE?ie=h(2407,"Extension '{0}' wants to make refactoring changes with this file creation",B.extensionNames[0]):_===fa.COPY?ie=h(2408,"Extension '{0}' wants to make refactoring changes with this file copy",B.extensionNames[0]):_===fa.MOVE?ie=h(2409,"Extension '{0}' wants to make refactoring changes with this file move",B.extensionNames[0]):ie=h(2410,"Extension '{0}' wants to make refactoring changes with this file deletion",B.extensionNames[0]):_===fa.CREATE?ie=h(2411,"{0} extensions want to make refactoring changes with this file creation",B.extensionNames.length):_===fa.COPY?ie=h(2412,"{0} extensions want to make refactoring changes with this file copy",B.extensionNames.length):_===fa.MOVE?ie=h(2413,"{0} extensions want to make refactoring changes with this file move",B.extensionNames.length):ie=h(2414,"{0} extensions want to make refactoring changes with this file deletion",B.extensionNames.length),q){const{confirmed:oe}=await r.confirm({type:Fe.Info,message:ie,primaryButton:h(2415,"Show &&Preview"),cancelButton:h(2416,"Skip Changes")});if(Q=!0,!oe)return}else{let oe;(function(zt){zt[zt.OK=0]="OK",zt[zt.Preview=1]="Preview",zt[zt.Cancel=2]="Cancel"})(oe||(oe={}));const{result:be,checkboxChecked:me}=await r.prompt({type:Fe.Info,message:ie,buttons:[{label:h(2417,"&&OK"),run:()=>oe.OK},{label:h(2415,"Show &&Preview"),run:()=>oe.Preview}],cancelButton:{label:h(2416,"Skip Changes"),run:()=>oe.Cancel},checkbox:{label:h(2418,"Do not ask me again")}});if(be===oe.Cancel)return;Q=be===oe.Preview,me&&a.store(mT.MementoKeyAdditionalEdits,Q,he.PROFILE,gt.USER)}}c.info("[onWill-handler] applying additional workspace edit from extensions",B.extensionNames),await n.apply(Au(B.edit,l),{undoRedoGroupId:w?.undoRedoGroupId,showPreview:Q})}_progressLabel(v){switch(v){case fa.CREATE:return h(2419,"Running 'File Create' participants...");case fa.MOVE:return h(2420,"Running 'File Rename' participants...");case fa.COPY:return h(2421,"Running 'File Copy' participants...");case fa.DELETE:return h(2422,"Running 'File Delete' participants...");case fa.WRITE:return h(2423,"Running 'File Write' participants...")}}};this._listener.add(i.addFileOperationParticipant(m)),this._listener.add(i.onDidRunWorkingCopyFileOperation(v=>this._proxy.$onDidRunFileOperation(v.operation,v.files)))}async $watch(e,t,i,n,o){const r=R.revive(i),a={...n};if(a.recursive)try{(await this._fileService.stat(r)).isDirectory||(a.recursive=!1)}catch{}if(o&&!a.recursive){this._logService.trace(`MainThreadFileSystemEventService#$watch(): request to start watching correlated (extension: ${e}, path: ${r.toString(!0)}, recursive: ${a.recursive}, session: ${t}, excludes: ${JSON.stringify(a.excludes)}, includes: ${JSON.stringify(a.includes)})`);const c=new U,d=c.add(this._fileService.createWatcher(r,{...a,recursive:!1}));c.add(d.onDidChange(l=>{this._proxy.$onFileEvent({session:t,created:l.rawAdded,changed:l.rawUpdated,deleted:l.rawDeleted})})),this._watches.set(t,c)}else{this._logService.trace(`MainThreadFileSystemEventService#$watch(): request to start watching uncorrelated (extension: ${e}, path: ${r.toString(!0)}, recursive: ${a.recursive}, session: ${t}, excludes: ${JSON.stringify(a.excludes)}, includes: ${JSON.stringify(a.includes)})`);const c=this._fileService.watch(r,a);this._watches.set(t,c)}}$unwatch(e){this._watches.has(e)&&(this._logService.trace(`MainThreadFileSystemEventService#$unwatch(): request to stop watching (session: ${e})`),this._watches.deleteAndDispose(e))}dispose(){this._listener.dispose(),this._watches.dispose()}};E$=mT=f([ht(qe.MainThreadFileSystemEventService),p(1,je),p(2,dg),p(3,yw),p(4,pl),p(5,ei),p(6,it),p(7,Re),p(8,Hs),p(9,nn),p(10,Re)],E$);Y(class extends X{constructor(){super({id:"files.participants.resetChoice",title:{value:h(2424,"Reset choice for 'File operation needs preview'"),original:"Reset choice for 'File operation needs preview'"},f1:!0})}run(e){e.get(it).remove(E$.MementoKeyAdditionalEdits,he.PROFILE)}});class n5{constructor(){this.requestIdPool=0,this.dataTransferFiles=new Map}add(e){const t=this.requestIdPool++;return this.dataTransferFiles.set(t,$t(Array.from(e,([,i])=>i.asFile()))),{id:t,dispose:()=>{this.dataTransferFiles.delete(t)}}}async resolveFileData(e,t){const i=this.dataTransferFiles.get(e);if(!i)throw new Error("No data transfer found");const n=i.find(o=>o.id===t);if(!n)throw new Error("No matching file found in data transfer");return Le.wrap(await n.data())}dispose(){this.dataTransferFiles.clear()}}var YJ;(function(s){s.CallsTo="incomingCalls",s.CallsFrom="outgoingCalls"})(YJ||(YJ={}));const Fue=new Ni;class _L{static async create(e,t,i){const[n]=Fue.ordered(e);if(!n)return;const o=await n.prepareCallHierarchy(e,t,i);if(o)return new _L(o.roots.reduce((r,a)=>r+a._sessionId,""),n,o.roots,new Qz(o))}constructor(e,t,i,n){this.id=e,this.provider=t,this.roots=i,this.ref=n,this.root=i[0]}dispose(){this.ref.release()}fork(e){const t=this;return new class extends _L{constructor(){super(t.id,t.provider,[e],t.ref.acquire())}}}async resolveIncomingCalls(e,t){try{const i=await this.provider.provideIncomingCalls(e,t);if(An(i))return i}catch(i){Ln(i)}return[]}async resolveOutgoingCalls(e,t){try{const i=await this.provider.provideOutgoingCalls(e,t);if(An(i))return i}catch(i){Ln(i)}return[]}}const tE=new Map;Ee.registerCommand("_executePrepareCallHierarchy",async(s,...e)=>{const[t,i]=e;yt(R.isUri(t)),yt(we.isIPosition(i));let o=s.get(ci).getModel(t),r;if(!o){const c=await s.get(Ci).createModelReference(t);o=c.object.textEditorModel,r=c}try{const a=await _L.create(o,i,Ce.None);return a?(tE.set(a.id,a),tE.forEach((c,d,l)=>{l.size>10&&(c.dispose(),tE.delete(d))}),[a.root]):[]}finally{r?.dispose()}});function Wue(s){return!0}Ee.registerCommand("_executeProvideIncomingCalls",async(s,...e)=>{const[t]=e;yt(Wue());const i=tE.get(t._sessionId);return i?i.resolveIncomingCalls(t,Ce.None):[]});Ee.registerCommand("_executeProvideOutgoingCalls",async(s,...e)=>{const[t]=e;yt(Wue());const i=tE.get(t._sessionId);return i?i.resolveOutgoingCalls(t,Ce.None):[]});var x$;(function(s){const e=[];function t(n){let o=n;return o&&e.push(o),{dispose(){if(o){const r=e.indexOf(o);r>=0&&(e.splice(r,1),o=void 0)}}}}s.register=t;function i(){return e.slice(0)}s.all=i})(x$||(x$={}));var I$;(function(s){s[s.Idle=0]="Idle",s[s.Searching=1]="Searching",s[s.SlowSearch=2]="SlowSearch"})(I$||(I$={}));new O("searchState",I$.Idle);var QJ;(function(s){s.Subtypes="subtypes",s.Supertypes="supertypes"})(QJ||(QJ={}));const Bue=new Ni;class bL{static async create(e,t,i){const[n]=Bue.ordered(e);if(!n)return;const o=await n.prepareTypeHierarchy(e,t,i);if(o)return new bL(o.roots.reduce((r,a)=>r+a._sessionId,""),n,o.roots,new Qz(o))}constructor(e,t,i,n){this.id=e,this.provider=t,this.roots=i,this.ref=n,this.root=i[0]}dispose(){this.ref.release()}fork(e){const t=this;return new class extends bL{constructor(){super(t.id,t.provider,[e],t.ref.acquire())}}}async provideSupertypes(e,t){try{const i=await this.provider.provideSupertypes(e,t);if(An(i))return i}catch(i){Ln(i)}return[]}async provideSubtypes(e,t){try{const i=await this.provider.provideSubtypes(e,t);if(An(i))return i}catch(i){Ln(i)}return[]}}const iE=new Map;Ee.registerCommand("_executePrepareTypeHierarchy",async(s,...e)=>{const[t,i]=e;yt(R.isUri(t)),yt(we.isIPosition(i));let o=s.get(ci).getModel(t),r;if(!o){const c=await s.get(Ci).createModelReference(t);o=c.object.textEditorModel,r=c}try{const a=await bL.create(o,i,Ce.None);if(!a)return[];iE.forEach((c,d,l)=>{l.size>10&&(c.dispose(),iE.delete(d))});for(const c of a.roots)iE.set(c._sessionId,a);return a.roots}finally{r?.dispose()}});function Vue(s){const e=s;return typeof s=="object"&&typeof e.name=="string"&&typeof e.kind=="number"&&R.isUri(e.uri)&&P.isIRange(e.range)&&P.isIRange(e.selectionRange)}Ee.registerCommand("_executeProvideSupertypes",async(s,...e)=>{const[t]=e;yt(Vue(t));const i=iE.get(t._sessionId);return i?i.provideSupertypes(t,Ce.None):[]});Ee.registerCommand("_executeProvideSubtypes",async(s,...e)=>{const[t]=e;yt(Vue(t));const i=iE.get(t._sessionId);return i?i.provideSubtypes(t,Ce.None):[]});var Mi;let XJ=Mi=class extends F{constructor(e,t,i,n,o){if(super(),this._languageService=t,this._languageConfigurationService=i,this._languageFeaturesService=n,this._uriIdentService=o,this._registrations=this._register(new ti),this._pasteEditProviders=new Map,this._documentOnDropEditProviders=new Map,this._proxy=e.getProxy(Ze.ExtHostLanguageFeatures),this._languageService){const r=()=>{const a=[];for(const c of t.getRegisteredLanguageIds()){const d=this._languageConfigurationService.getLanguageConfiguration(c).getWordDefinition();a.push({languageId:c,regexSource:d.source,regexFlags:d.flags})}this._proxy.$setWordDefinitions(a)};this._register(this._languageConfigurationService.onDidChange(a=>{if(!a.languageId)r();else{const c=this._languageConfigurationService.getLanguageConfiguration(a.languageId).getWordDefinition();this._proxy.$setWordDefinitions([{languageId:a.languageId,regexSource:c.source,regexFlags:c.flags}])}})),r()}}$unregister(e){this._registrations.deleteAndDispose(e)}static _reviveLocationDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>Mi._reviveLocationDto(t)),e):(e.uri=R.revive(e.uri),e))}static _reviveLocationLinkDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>Mi._reviveLocationLinkDto(t)),e):(e.uri=R.revive(e.uri),e))}static _reviveWorkspaceSymbolDto(e){return e&&(Array.isArray(e)?(e.forEach(Mi._reviveWorkspaceSymbolDto),e):(e.location=Mi._reviveLocationDto(e.location),e))}static _reviveCodeActionDto(e,t){return e?.forEach(i=>Au(i.edit,t)),e}static _reviveLinkDTO(e){return e.url&&typeof e.url!="string"&&(e.url=R.revive(e.url)),e}static _reviveCallHierarchyItemDto(e){return e&&(e.uri=R.revive(e.uri)),e}static _reviveTypeHierarchyItemDto(e){return e&&(e.uri=R.revive(e.uri)),e}$registerDocumentSymbolProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentSymbolProvider.register(t,{displayName:i,provideDocumentSymbols:(n,o)=>this._proxy.$provideDocumentSymbols(e,n.uri,o)}))}$registerCodeLensSupport(e,t,i){const n={provideCodeLenses:async(o,r)=>{const a=await this._proxy.$provideCodeLenses(e,o.uri,r);if(a)return{lenses:a.lenses,dispose:()=>a.cacheId&&this._proxy.$releaseCodeLenses(e,a.cacheId)}},resolveCodeLens:async(o,r,a)=>{const c=await this._proxy.$resolveCodeLens(e,r,a);if(c)return{...c,range:o.validateRange(c.range)}}};if(typeof i=="number"){const o=new M;this._registrations.set(i,o),n.onDidChange=o.event}this._registrations.set(e,this._languageFeaturesService.codeLensProvider.register(t,n))}$emitCodeLensEvent(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$registerDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.definitionProvider.register(t,{provideDefinition:(i,n,o)=>this._proxy.$provideDefinition(e,i.uri,n,o).then(Mi._reviveLocationLinkDto)}))}$registerDeclarationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.declarationProvider.register(t,{provideDeclaration:(i,n,o)=>this._proxy.$provideDeclaration(e,i.uri,n,o).then(Mi._reviveLocationLinkDto)}))}$registerImplementationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.implementationProvider.register(t,{provideImplementation:(i,n,o)=>this._proxy.$provideImplementation(e,i.uri,n,o).then(Mi._reviveLocationLinkDto)}))}$registerTypeDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.typeDefinitionProvider.register(t,{provideTypeDefinition:(i,n,o)=>this._proxy.$provideTypeDefinition(e,i.uri,n,o).then(Mi._reviveLocationLinkDto)}))}$registerHoverProvider(e,t){this._registrations.set(e,this._languageFeaturesService.hoverProvider.register(t,{provideHover:async(i,n,o,r)=>{const a={verbosityRequest:r?.verbosityRequest?{verbosityDelta:r.verbosityRequest.verbosityDelta,previousHover:{id:r.verbosityRequest.previousHover.id}}:void 0};return await this._proxy.$provideHover(e,i.uri,n,a,o)}}))}$registerEvaluatableExpressionProvider(e,t){this._registrations.set(e,this._languageFeaturesService.evaluatableExpressionProvider.register(t,{provideEvaluatableExpression:(i,n,o)=>this._proxy.$provideEvaluatableExpression(e,i.uri,n,o)}))}$registerInlineValuesProvider(e,t,i){const n={provideInlineValues:(o,r,a,c)=>this._proxy.$provideInlineValues(e,o.uri,r,a,c)};if(typeof i=="number"){const o=new M;this._registrations.set(i,o),n.onDidChangeInlineValues=o.event}this._registrations.set(e,this._languageFeaturesService.inlineValuesProvider.register(t,n))}$emitInlineValuesEvent(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$registerDocumentHighlightProvider(e,t){this._registrations.set(e,this._languageFeaturesService.documentHighlightProvider.register(t,{provideDocumentHighlights:(i,n,o)=>this._proxy.$provideDocumentHighlights(e,i.uri,n,o)}))}$registerMultiDocumentHighlightProvider(e,t){this._registrations.set(e,this._languageFeaturesService.multiDocumentHighlightProvider.register(t,{selector:t,provideMultiDocumentHighlights:(i,n,o,r)=>this._proxy.$provideMultiDocumentHighlights(e,i.uri,n,o.map(a=>a.uri),r).then(a=>{if(a==null)return;const c=new In;return a?.forEach(d=>{const l=R.revive(d.uri);c.has(l)?c.get(l).push(...d.highlights):c.set(l,d.highlights)}),c})}))}$registerLinkedEditingRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.linkedEditingRangeProvider.register(t,{provideLinkedEditingRanges:async(i,n,o)=>{const r=await this._proxy.$provideLinkedEditingRanges(e,i.uri,n,o);if(r)return{ranges:r.ranges,wordPattern:r.wordPattern?Mi._reviveRegExp(r.wordPattern):void 0}}}))}$registerReferenceSupport(e,t){this._registrations.set(e,this._languageFeaturesService.referenceProvider.register(t,{provideReferences:(i,n,o,r)=>this._proxy.$provideReferences(e,i.uri,n,o,r).then(Mi._reviveLocationDto)}))}$registerCodeActionSupport(e,t,i,n,o,r){const a={provideCodeActions:async(c,d,l,u)=>{const g=await this._proxy.$provideCodeActions(e,c.uri,d,l,u);if(g)return{actions:Mi._reviveCodeActionDto(g.actions,this._uriIdentService),dispose:()=>{typeof g.cacheId=="number"&&this._proxy.$releaseCodeActions(e,g.cacheId)}}},providedCodeActionKinds:i.providedKinds,documentation:i.documentation,displayName:n,extensionId:o};r&&(a.resolveCodeAction=async(c,d)=>{const l=await this._proxy.$resolveCodeAction(e,c.cacheId,d);return l.edit&&(c.edit=Au(l.edit,this._uriIdentService)),l.command&&(c.command=l.command),c}),this._registrations.set(e,this._languageFeaturesService.codeActionProvider.register(t,a))}$registerPasteEditProvider(e,t,i){const n=new D$(e,this._proxy,i,this._uriIdentService);this._pasteEditProviders.set(e,n),this._registrations.set(e,Wo(this._languageFeaturesService.documentPasteEditProvider.register(t,n),Ie(()=>this._pasteEditProviders.delete(e))))}$resolvePasteFileData(e,t,i){const n=this._pasteEditProviders.get(e);if(!n)throw new Error("Could not find provider");return n.resolveFileData(t,i)}$registerDocumentFormattingSupport(e,t,i,n){this._registrations.set(e,this._languageFeaturesService.documentFormattingEditProvider.register(t,{extensionId:i,displayName:n,provideDocumentFormattingEdits:(o,r,a)=>this._proxy.$provideDocumentFormattingEdits(e,o.uri,r,a)}))}$registerRangeFormattingSupport(e,t,i,n,o){this._registrations.set(e,this._languageFeaturesService.documentRangeFormattingEditProvider.register(t,{extensionId:i,displayName:n,provideDocumentRangeFormattingEdits:(r,a,c,d)=>this._proxy.$provideDocumentRangeFormattingEdits(e,r.uri,a,c,d),provideDocumentRangesFormattingEdits:o?(r,a,c,d)=>this._proxy.$provideDocumentRangesFormattingEdits(e,r.uri,a,c,d):void 0}))}$registerOnTypeFormattingSupport(e,t,i,n){this._registrations.set(e,this._languageFeaturesService.onTypeFormattingEditProvider.register(t,{extensionId:n,autoFormatTriggerCharacters:i,provideOnTypeFormattingEdits:(o,r,a,c,d)=>this._proxy.$provideOnTypeFormattingEdits(e,o.uri,r,a,c,d)}))}$registerNavigateTypeSupport(e,t){let i;const n={provideWorkspaceSymbols:async(o,r)=>{const a=await this._proxy.$provideWorkspaceSymbols(e,o,r);return i!==void 0&&this._proxy.$releaseWorkspaceSymbols(e,i),i=a.cacheId,Mi._reviveWorkspaceSymbolDto(a.symbols)}};t&&(n.resolveWorkspaceSymbol=async(o,r)=>{const a=await this._proxy.$resolveWorkspaceSymbol(e,o,r);return a&&Mi._reviveWorkspaceSymbolDto(a)}),this._registrations.set(e,x$.register(n))}$registerRenameSupport(e,t,i){this._registrations.set(e,this._languageFeaturesService.renameProvider.register(t,{provideRenameEdits:(n,o,r,a)=>this._proxy.$provideRenameEdits(e,n.uri,o,r,a).then(c=>Au(c,this._uriIdentService)),resolveRenameLocation:i?(n,o,r)=>this._proxy.$resolveRenameLocation(e,n.uri,o,r):void 0}))}$registerNewSymbolNamesProvider(e,t){this._registrations.set(e,this._languageFeaturesService.newSymbolNamesProvider.register(t,{supportsAutomaticNewSymbolNamesTriggerKind:this._proxy.$supportsAutomaticNewSymbolNamesTriggerKind(e),provideNewSymbolNames:(i,n,o,r)=>this._proxy.$provideNewSymbolNames(e,i.uri,n,o,r)}))}$registerDocumentSemanticTokensProvider(e,t,i,n){let o;if(typeof n=="number"){const r=new M;this._registrations.set(n,r),o=r.event}this._registrations.set(e,this._languageFeaturesService.documentSemanticTokensProvider.register(t,new VFe(this._proxy,e,i,o)))}$emitDocumentSemanticTokensEvent(e){const t=this._registrations.get(e);t instanceof M&&t.fire(void 0)}$registerDocumentRangeSemanticTokensProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentRangeSemanticTokensProvider.register(t,new HFe(this._proxy,e,i)))}static _inflateSuggestDto(e,t,i){const n=t[xo.label],o=t[xo.commandId],r=t[xo.commandIdent],a=t[xo.commitCharacters];let c;return o&&(c={$ident:r,id:o,title:"",arguments:r?[r]:t[xo.commandArguments]}),{label:n,extensionId:i,kind:t[xo.kind]??De.Property,tags:t[xo.kindModifier],detail:t[xo.detail],documentation:t[xo.documentation],sortText:t[xo.sortText],filterText:t[xo.filterText],preselect:t[xo.preselect],insertText:t[xo.insertText]??(typeof n=="string"?n:n.label),range:t[xo.range]??e,insertTextRules:t[xo.insertTextRules],commitCharacters:a?Array.from(a):void 0,additionalTextEdits:t[xo.additionalTextEdits],command:c,_id:t.x}}$registerCompletionsProvider(e,t,i,n,o){const r={triggerCharacters:i,_debugDisplayName:`${o.value}(${i.join("")})`,provideCompletionItems:async(a,c,d,l)=>{const u=await this._proxy.$provideCompletionItems(e,a.uri,c,d,l);return u&&{suggestions:u[cb.completions].map(g=>Mi._inflateSuggestDto(u[cb.defaultRanges],g,o)),incomplete:u[cb.isIncomplete]||!1,duration:u[cb.duration],dispose:()=>{typeof u.x=="number"&&this._proxy.$releaseCompletionItems(e,u.x)}}}};n&&(r.resolveCompletionItem=(a,c)=>this._proxy.$resolveCompletionItem(e,a._id,c).then(d=>{if(!d)return a;const l=Mi._inflateSuggestDto(a.range,d,o);return Vu(a,l,!0)})),this._registrations.set(e,this._languageFeaturesService.completionProvider.register(t,r))}$registerInlineCompletionsSupport(e,t,i,n,o,r,a,c){const d={provideInlineCompletions:async(l,u,g,m)=>this._proxy.$provideInlineCompletions(e,l.uri,u,g,m),provideInlineEditsForRange:async(l,u,g,m)=>this._proxy.$provideInlineEditsForRange(e,l.uri,u,g,m),handleItemDidShow:async(l,u,g)=>{i&&await this._proxy.$handleInlineCompletionDidShow(e,l.pid,u.idx,g)},handlePartialAccept:async(l,u,g,m)=>{i&&await this._proxy.$handleInlineCompletionPartialAccept(e,l.pid,u.idx,g,m)},handleEndOfLifetime:async(l,u,g)=>{function m(v,_){return v.kind===Np.Ignored?{...v,supersededBy:v.supersededBy?_(v.supersededBy):void 0}:v}i&&await this._proxy.$handleInlineCompletionEndOfLifetime(e,l.pid,u.idx,m(g,v=>({pid:l.pid,idx:v.idx})))},freeInlineCompletions:l=>{this._proxy.$freeInlineCompletionsList(e,l.pid)},handleRejection:async(l,u)=>{i&&await this._proxy.$handleInlineCompletionRejection(e,l.pid,u.idx)},groupId:n,yieldsToGroupIds:o,debounceDelayMs:a,displayName:r,toString(){return`InlineCompletionsProvider(${n})`}};if(this._registrations.set(e,this._languageFeaturesService.inlineCompletionsProvider.register(t,d)),typeof c=="number"){const l=new M;this._registrations.set(c,l),d.onDidChangeInlineCompletions=l.event}}$emitInlineCompletionsChange(e){const t=this._registrations.get(e);t instanceof M&&t.fire(void 0)}$registerInlineEditProvider(e,t,i,n){const o={displayName:n,provideInlineEdit:async(r,a,c)=>this._proxy.$provideInlineEdit(e,r.uri,a,c),freeInlineEdit:r=>{this._proxy.$freeInlineEdit(e,r.pid)}};this._registrations.set(e,this._languageFeaturesService.inlineEditProvider.register(t,o))}$registerSignatureHelpProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.signatureHelpProvider.register(t,{signatureHelpTriggerCharacters:i.triggerCharacters,signatureHelpRetriggerCharacters:i.retriggerCharacters,provideSignatureHelp:async(n,o,r,a)=>{const c=await this._proxy.$provideSignatureHelp(e,n.uri,o,a,r);if(c)return{value:c,dispose:()=>{this._proxy.$releaseSignatureHelp(e,c.id)}}}}))}$registerInlayHintsProvider(e,t,i,n,o){const r={displayName:o,provideInlayHints:async(a,c,d)=>{const l=await this._proxy.$provideInlayHints(e,a.uri,c,d);if(l)return{hints:gn(l.hints),dispose:()=>{l.cacheId&&this._proxy.$releaseInlayHints(e,l.cacheId)}}}};if(i&&(r.resolveInlayHint=async(a,c)=>{const d=a;if(!d.cacheId)return a;const l=await this._proxy.$resolveInlayHint(e,d.cacheId,c);if(c.isCancellationRequested)throw new fo;return l?{...a,tooltip:l.tooltip,label:gn(l.label),textEdits:l.textEdits}:a}),typeof n=="number"){const a=new M;this._registrations.set(n,a),r.onDidChangeInlayHints=a.event}this._registrations.set(e,this._languageFeaturesService.inlayHintsProvider.register(t,r))}$emitInlayHintsEvent(e){const t=this._registrations.get(e);t instanceof M&&t.fire(void 0)}$registerDocumentLinkProvider(e,t,i){const n={provideLinks:(o,r)=>this._proxy.$provideDocumentLinks(e,o.uri,r).then(a=>{if(a)return{links:a.links.map(Mi._reviveLinkDTO),dispose:()=>{typeof a.cacheId=="number"&&this._proxy.$releaseDocumentLinks(e,a.cacheId)}}})};i&&(n.resolveLink=(o,r)=>{const a=o;return a.cacheId?this._proxy.$resolveDocumentLink(e,a.cacheId,r).then(c=>c&&Mi._reviveLinkDTO(c)):o}),this._registrations.set(e,this._languageFeaturesService.linkProvider.register(t,n))}$registerDocumentColorProvider(e,t){const i=this._proxy;this._registrations.set(e,this._languageFeaturesService.colorProvider.register(t,{provideDocumentColors:(n,o)=>i.$provideDocumentColors(e,n.uri,o).then(r=>r.map(a=>{const[c,d,l,u]=a.color;return{color:{red:c,green:d,blue:l,alpha:u},range:a.range}})),provideColorPresentations:(n,o,r)=>i.$provideColorPresentations(e,n.uri,{color:[o.color.red,o.color.green,o.color.blue,o.color.alpha],range:o.range},r)}))}$registerFoldingRangeProvider(e,t,i,n){const o={id:i.value,provideFoldingRanges:(r,a,c)=>this._proxy.$provideFoldingRanges(e,r.uri,a,c)};if(typeof n=="number"){const r=new M;this._registrations.set(n,r),o.onDidChange=r.event}this._registrations.set(e,this._languageFeaturesService.foldingRangeProvider.register(t,o))}$emitFoldingRangeEvent(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$registerSelectionRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.selectionRangeProvider.register(t,{provideSelectionRanges:(i,n,o)=>this._proxy.$provideSelectionRanges(e,i.uri,n,o)}))}$registerCallHierarchyProvider(e,t){this._registrations.set(e,Fue.register(t,{prepareCallHierarchy:async(i,n,o)=>{const r=await this._proxy.$prepareCallHierarchy(e,i.uri,n,o);if(!(!r||r.length===0))return{dispose:()=>{for(const a of r)this._proxy.$releaseCallHierarchy(e,a._sessionId)},roots:r.map(Mi._reviveCallHierarchyItemDto)}},provideOutgoingCalls:async(i,n)=>{const o=await this._proxy.$provideCallHierarchyOutgoingCalls(e,i._sessionId,i._itemId,n);return o&&(o.forEach(r=>{r.to=Mi._reviveCallHierarchyItemDto(r.to)}),o)},provideIncomingCalls:async(i,n)=>{const o=await this._proxy.$provideCallHierarchyIncomingCalls(e,i._sessionId,i._itemId,n);return o&&(o.forEach(r=>{r.from=Mi._reviveCallHierarchyItemDto(r.from)}),o)}}))}static _reviveRegExp(e){return new RegExp(e.pattern,e.flags)}static _reviveIndentationRule(e){return{decreaseIndentPattern:Mi._reviveRegExp(e.decreaseIndentPattern),increaseIndentPattern:Mi._reviveRegExp(e.increaseIndentPattern),indentNextLinePattern:e.indentNextLinePattern?Mi._reviveRegExp(e.indentNextLinePattern):void 0,unIndentedLinePattern:e.unIndentedLinePattern?Mi._reviveRegExp(e.unIndentedLinePattern):void 0}}static _reviveOnEnterRule(e){return{beforeText:Mi._reviveRegExp(e.beforeText),afterText:e.afterText?Mi._reviveRegExp(e.afterText):void 0,previousLineText:e.previousLineText?Mi._reviveRegExp(e.previousLineText):void 0,action:e.action}}static _reviveOnEnterRules(e){return e.map(Mi._reviveOnEnterRule)}$setLanguageConfiguration(e,t,i){const n={comments:i.comments,brackets:i.brackets,wordPattern:i.wordPattern?Mi._reviveRegExp(i.wordPattern):void 0,indentationRules:i.indentationRules?Mi._reviveIndentationRule(i.indentationRules):void 0,onEnterRules:i.onEnterRules?Mi._reviveOnEnterRules(i.onEnterRules):void 0,autoClosingPairs:void 0,surroundingPairs:void 0,__electricCharacterSupport:void 0};i.autoClosingPairs?n.autoClosingPairs=i.autoClosingPairs:i.__characterPairSupport&&(n.autoClosingPairs=i.__characterPairSupport.autoClosingPairs),i.__electricCharacterSupport&&i.__electricCharacterSupport.docComment&&(n.__electricCharacterSupport={docComment:{open:i.__electricCharacterSupport.docComment.open,close:i.__electricCharacterSupport.docComment.close}}),this._languageService.isRegisteredLanguageId(t)&&this._registrations.set(e,this._languageConfigurationService.register(t,n,100))}$registerTypeHierarchyProvider(e,t){this._registrations.set(e,Bue.register(t,{prepareTypeHierarchy:async(i,n,o)=>{const r=await this._proxy.$prepareTypeHierarchy(e,i.uri,n,o);if(r)return{dispose:()=>{for(const a of r)this._proxy.$releaseTypeHierarchy(e,a._sessionId)},roots:r.map(Mi._reviveTypeHierarchyItemDto)}},provideSupertypes:async(i,n)=>{const o=await this._proxy.$provideTypeHierarchySupertypes(e,i._sessionId,i._itemId,n);return o&&o.map(Mi._reviveTypeHierarchyItemDto)},provideSubtypes:async(i,n)=>{const o=await this._proxy.$provideTypeHierarchySubtypes(e,i._sessionId,i._itemId,n);return o&&o.map(Mi._reviveTypeHierarchyItemDto)}}))}$registerDocumentOnDropEditProvider(e,t,i){const n=new k$(e,this._proxy,i,this._uriIdentService);this._documentOnDropEditProviders.set(e,n),this._registrations.set(e,Wo(this._languageFeaturesService.documentDropEditProvider.register(t,n),Ie(()=>this._documentOnDropEditProviders.delete(e))))}async $resolveDocumentOnDropFileData(e,t,i){const n=this._documentOnDropEditProviders.get(e);if(!n)throw new Error("Could not find provider");return n.resolveDocumentOnDropFileData(t,i)}};XJ=Mi=f([ht(qe.MainThreadLanguageFeatures),p(1,vi),p(2,ds),p(3,Ne),p(4,nn)],XJ);let D$=class{constructor(e,t,i,n){this._handle=e,this._proxy=t,this._uriIdentService=n,this.dataTransfers=new n5,this.copyMimeTypes=i.copyMimeTypes??[],this.pasteMimeTypes=i.pasteMimeTypes??[],this.providedPasteEditKinds=i.providedPasteEditKinds?.map(o=>new Ut(o))??[],i.supportsCopy&&(this.prepareDocumentPaste=async(o,r,a,c)=>{const d=await Fy.fromList(a);if(c.isCancellationRequested)return;const l=await this._proxy.$prepareDocumentPaste(e,o.uri,r,d,c);if(!l)return;const u=new JI;for(const[g,m]of l.items)u.replace(g,Xw(m.asString,m.id));return u}),i.supportsPaste&&(this.provideDocumentPasteEdits=async(o,r,a,c,d)=>{const l=this.dataTransfers.add(a);try{const u=await Fy.fromList(a);if(d.isCancellationRequested)return;const g=await this._proxy.$providePasteEdits(this._handle,l.id,o.uri,r,u,{only:c.only?.value,triggerKind:c.triggerKind},d);return g?{edits:g.map(m=>({...m,kind:m.kind?new Ut(m.kind.value):new Ut(""),yieldTo:m.yieldTo?.map(v=>({kind:new Ut(v)})),additionalEdit:m.additionalEdit?Au(m.additionalEdit,this._uriIdentService,v=>this.resolveFileData(l.id,v)):void 0})),dispose:()=>{this._proxy.$releasePasteEdits(this._handle,l.id)}}:void 0}finally{l.dispose()}}),i.supportsResolve&&(this.resolveDocumentPasteEdit=async(o,r)=>{const a=await this._proxy.$resolvePasteEdit(this._handle,o._cacheId,r);return typeof a.insertText<"u"&&(o.insertText=a.insertText),a.additionalEdit&&(o.additionalEdit=Au(a.additionalEdit,this._uriIdentService)),o})}resolveFileData(e,t){return this.dataTransfers.resolveFileData(e,t)}};D$=f([p(3,nn)],D$);let k$=class{constructor(e,t,i,n){this._handle=e,this._proxy=t,this._uriIdentService=n,this.dataTransfers=new n5,this.dropMimeTypes=i?.dropMimeTypes??["*/*"],this.providedDropEditKinds=i?.providedDropKinds?.map(o=>new Ut(o)),i?.supportsResolve&&(this.resolveDocumentDropEdit=async(o,r)=>{const a=await this._proxy.$resolvePasteEdit(this._handle,o._cacheId,r);return a.additionalEdit&&(o.additionalEdit=Au(a.additionalEdit,this._uriIdentService)),o})}async provideDocumentDropEdits(e,t,i,n){const o=this.dataTransfers.add(i);try{const r=await Fy.fromList(i);if(n.isCancellationRequested)return;const a=await this._proxy.$provideDocumentOnDropEdits(this._handle,o.id,e.uri,t,r,n);return a?{edits:a.map(c=>({...c,yieldTo:c.yieldTo?.map(d=>({kind:new Ut(d)})),kind:c.kind?new Ut(c.kind):void 0,additionalEdit:Au(c.additionalEdit,this._uriIdentService,d=>this.resolveDocumentOnDropFileData(o.id,d))})),dispose:()=>{this._proxy.$releaseDocumentOnDropEdits(this._handle,o.id)}}:void 0}finally{o.dispose()}}resolveDocumentOnDropFileData(e,t){return this.dataTransfers.resolveFileData(e,t)}};k$=f([p(3,nn)],k$);class VFe{constructor(e,t,i,n){this._proxy=e,this._handle=t,this._legend=i,this.onDidChange=n}releaseDocumentSemanticTokens(e){e&&this._proxy.$releaseDocumentSemanticTokens(this._handle,parseInt(e,10))}getLegend(){return this._legend}async provideDocumentSemanticTokens(e,t,i){const n=t?parseInt(t,10):0,o=await this._proxy.$provideDocumentSemanticTokens(this._handle,e.uri,n,i);if(!o||i.isCancellationRequested)return null;const r=Uce(o);return r.type==="full"?{resultId:String(r.id),data:r.data}:{resultId:String(r.id),edits:r.deltas}}}class HFe{constructor(e,t,i){this._proxy=e,this._handle=t,this._legend=i}getLegend(){return this._legend}async provideDocumentRangeSemanticTokens(e,t,i){const n=await this._proxy.$provideDocumentRangeSemanticTokens(this._handle,e.uri,t,i);if(!n||i.isCancellationRequested)return null;const o=Uce(n);if(o.type==="full")return{resultId:String(o.id),data:o.data};throw new Error("Unexpected")}}let ZJ=class{constructor(e,t,i,n,o){this._languageService=t,this._modelService=i,this._resolverService=n,this._languageStatusService=o,this._disposables=new U,this._status=new ti,this._proxy=e.getProxy(Ze.ExtHostLanguages),this._proxy.$acceptLanguageIds(t.getRegisteredLanguageIds()),this._disposables.add(t.onDidChange(r=>{this._proxy.$acceptLanguageIds(t.getRegisteredLanguageIds())}))}dispose(){this._disposables.dispose(),this._status.dispose()}async $changeLanguage(e,t){if(!this._languageService.isRegisteredLanguageId(t))return Promise.reject(new Error(`Unknown language id: ${t}`));const i=R.revive(e),n=await this._resolverService.createModelReference(i);try{n.object.textEditorModel.setLanguage(this._languageService.createById(t))}finally{n.dispose()}}async $tokensAtPosition(e,t){const i=R.revive(e),n=this._modelService.getModel(i);if(!n)return;n.tokenization.tokenizeIfCheap(t.lineNumber);const o=n.tokenization.getLineTokens(t.lineNumber),r=o.findTokenIndexAtOffset(t.column-1);return{type:o.getStandardTokenType(r),range:new P(t.lineNumber,1+o.getStartOffset(r),t.lineNumber,1+o.getEndOffset(r))}}$setLanguageStatus(e,t){this._status.get(e)?.dispose(),this._status.set(e,this._languageStatusService.addStatus(t))}$removeLanguageStatus(e){this._status.get(e)?.dispose()}};ZJ=f([ht(qe.MainThreadLanguages),p(1,vi),p(2,ci),p(3,Ci),p(4,Uq)],ZJ);let JJ=class{constructor(e,t){this.loggerService=t,this.disposables=new U;const i=e.getProxy(Ze.ExtHostLogLevelServiceShape);this.disposables.add(t.onDidChangeLogLevel(n=>{Sbe(n)?i.$setLogLevel(n):i.$setLogLevel(n[1],n[0])}))}$log(e,t){const i=this.loggerService.getLogger(R.revive(e));if(!i)throw new Error("Create the logger before logging");for(const[n,o]of t)Cbe(i,n,o)}async $createLogger(e,t){this.loggerService.createLogger(R.revive(e),t)}async $registerLogger(e){this.loggerService.registerLogger({...e,resource:R.revive(e.resource)})}async $deregisterLogger(e){this.loggerService.deregisterLogger(R.revive(e))}async $setVisibility(e,t){this.loggerService.setVisibility(R.revive(e),t)}$flush(e){const t=this.loggerService.getLogger(R.revive(e));if(!t)throw new Error("Create the logger before flushing");t.flush()}dispose(){this.disposables.dispose()}};JJ=f([ht(qe.MainThreadLogger),p(1,tI)],JJ);Ee.registerCommand("_extensionTests.setLogLevel",function(s,e){const t=s.get(tI),i=s.get(Hs);if(i.isExtensionDevelopment&&i.extensionTestsLocationURI){const n=wbe(e);n!==void 0&&t.setLogLevel(n)}});Ee.registerCommand("_extensionTests.getLogLevel",function(s){const e=s.get(Re);return zF(e.getLevel())});let eee=class{constructor(e,t,i,n,o){this._notificationService=t,this._commandService=i,this._dialogService=n,this.extensionsListener=o.onDidChangeExtensions(r=>{for(const a of r.removed)this._notificationService.removeFilter(a.identifier.value)})}dispose(){this.extensionsListener.dispose()}$showMessage(e,t,i,n){return i.modal?this._showModalMessage(e,t,i.detail,n,i.useCustom):this._showMessage(e,t,n,i)}_showMessage(e,t,i,n){return new Promise(o=>{const r=i.map(l=>Ri({id:`_extension_message_handle_${l.handle}`,label:l.title,enabled:!0,run:()=>(o(l.handle),Promise.resolve())}));let a;n.source&&(a={label:n.source.label,id:n.source.identifier.value}),a||(a=h(2426,"Extension"));const c=[];n.source&&c.push(Ri({id:n.source.identifier.value,label:h(2427,"Manage Extension"),run:()=>this._commandService.executeCommand("_extensions.manage",n.source.identifier.value)}));const d=this._notificationService.notify({severity:e,message:t,actions:{primary:r,secondary:c},source:a});T.once(d.onDidClose)(()=>{o(void 0)})})}async _showModalMessage(e,t,i,n,o){const r=[];let a;for(const d of n){const l={label:d.title,run:()=>d.handle};d.isCloseAffordance?a=l:r.push(l)}a||(r.length>0?a={label:h(2428,"Cancel"),run:()=>{}}:a={label:h(2429,"&&OK"),run:()=>{}});const{result:c}=await this._dialogService.prompt({type:e,message:t,detail:i,buttons:r,cancelButton:a,custom:o});return c}};eee=f([ht(qe.MainThreadMessageService),p(1,Dt),p(2,Ge),p(3,ei),p(4,cn)],eee);const UFe=(s,e,t)=>{const i=new Uint8Array(16);for(let r=0;r<16;r++)i[r]=Math.round(Math.random()*256);const n=Zx(Le.wrap(i));return[`GET ws://localhost${s}?${e}&skipWebSocketFrames=true HTTP/1.1`,"Connection: Upgrade","Upgrade: websocket",`Sec-WebSocket-Key: ${n}`].join(`\r
`)+`\r
\r
`},tee=Le.fromString(`\r
\r
`);async function $Fe(s,e,t,i,n){s.write(Le.fromString(UFe(e,t)));const o=new U;try{return await new Promise((r,a)=>{let c;o.add(s.onData(d=>{c?c=Le.concat([c,d],c.byteLength+d.byteLength):c=d;const l=c.indexOf(tee);if(l===-1)return;r(s),s.pauseData();const u=c.slice(l+tee.byteLength);u.byteLength&&n.onData.fire(u)})),o.add(s.onClose(d=>a(d??new Error("socket closed")))),o.add(s.onEnd(()=>a(new Error("socket ended"))))})}catch(r){throw s.dispose(),r}finally{o.dispose()}}class GFe extends F{constructor(e,t){super(),this.debugLabel=e,this.pausableDataEmitter=this._register(new MF),this.onData=(...i)=>(this.pausableDataEmitter.isPaused&&queueMicrotask(()=>this.pausableDataEmitter.resume()),this.pausableDataEmitter.event(...i)),this.didDisposeEmitter=this._register(new M),this.onDidDispose=this.didDisposeEmitter.event,this.ended=!1,this._register(t.onData),this._register(t.onData.event(i=>this.pausableDataEmitter.fire(i))),this.onClose=this._register(t.onClose).event,this.onEnd=this._register(t.onEnd).event}pauseData(){this.pausableDataEmitter.pause()}drain(){return Promise.resolve()}end(){this.ended=!0,this.closeRemote()}traceSocketEvent(e,t){xV.traceSocketEvent(this,this.debugLabel,e,t)}dispose(){this.ended||this.closeRemote(),this.didDisposeEmitter.fire(),super.dispose()}}let iee=class extends F{constructor(e,t){super(),this._remoteSocketFactoryService=t,this._registrations=new Map,this._remoteSockets=new Map,this._proxy=e.getProxy(Ze.ExtHostManagedSockets)}async $registerSocketFactory(e){const t=this,i=new class{supports(n){return n.id===e}connect(n,o,r,a){return new Promise((c,d)=>{if(n.id!==e)return d(new Error("Invalid connectTo"));const l=n.id;t._proxy.$openRemoteSocket(l).then(u=>{const g={onClose:new M,onData:new M,onEnd:new M};t._remoteSockets.set(u,g),s5.connect(u,t._proxy,o,r,a,g).then(m=>{m.onDidDispose(()=>t._remoteSockets.delete(u)),c(m)},m=>{t._remoteSockets.delete(u),d(m)})}).catch(d)})}};this._registrations.set(e,this._remoteSocketFactoryService.register(_y.Managed,i))}async $unregisterSocketFactory(e){this._registrations.get(e)?.dispose()}$onDidManagedSocketHaveData(e,t){this._remoteSockets.get(e)?.onData.fire(t)}$onDidManagedSocketClose(e,t){this._remoteSockets.get(e)?.onClose.fire({type:RR.NodeSocketCloseEvent,error:t?new Error(t):void 0,hadError:!!t}),this._remoteSockets.delete(e)}$onDidManagedSocketEnd(e){this._remoteSockets.get(e)?.onEnd.fire()}};iee=f([ht(qe.MainThreadManagedSockets),p(1,Cq)],iee);class s5 extends GFe{static connect(e,t,i,n,o,r){const a=new s5(e,t,o,r);return $Fe(a,i,n,o,r)}constructor(e,t,i,n){super(i,n),this.socketId=e,this.proxy=t}write(e){this.proxy.$remoteSocketWrite(this.socketId,e)}closeRemote(){this.proxy.$remoteSocketEnd(this.socketId)}drain(){return this.proxy.$remoteSocketDrain(this.socketId)}}var vT;let nee=class extends F{static{vT=this}static{this._extensionIdPool=new Map}constructor(e,t,i,n,o){super(),this._outputStatusItem=this._register(new Pt),this._outputService=t,this._viewsService=i,this._configurationService=n,this._statusbarService=o,this._proxy=e.getProxy(Ze.ExtHostOutputService);const r=()=>{const a=this._viewsService.isViewVisible(y_)?this._outputService.getActiveChannel():void 0;this._proxy.$setVisibleChannel(a?a.id:null),this._outputStatusItem.value=void 0};this._register(T.any(this._outputService.onActiveOutputChannel,T.filter(this._viewsService.onDidChangeViewVisibility,({id:a})=>a===y_))(()=>r())),r()}async $register(e,t,i,n){const o=(vT._extensionIdPool.get(n)||0)+1;vT._extensionIdPool.set(n,o);const r=`extension-output-${n}-#${o}-${e}`,a=R.revive(t);return Ke.as(uce.OutputChannels).registerChannel({id:r,label:e,source:{resource:a},log:!1,languageId:i,extensionId:n}),this._register(Ie(()=>this.$dispose(r))),r}async $update(e,t,i){const n=this._getChannel(e);n&&(t===NB.Append?n.update(t):ec(i)&&n.update(t,i))}async $reveal(e,t){const i=this._getChannel(e);if(!i)return;const n=this._configurationService.getValue("workbench.view.showQuietly")??{};if(!this._viewsService.isViewVisible(y_)&&n[y_]){this._showChannelQuietly(i);return}this._outputService.showChannel(i.id,t)}_showChannelQuietly(e){const t={name:h(2431,"Show Output"),text:"$(output)",ariaLabel:h(2432,"Show {0} Output Channel",e.label),command:`workbench.action.output.show.${e.id}`,tooltip:h(2433,"Show {0} Output Channel",e.label),kind:"prominent"};this._outputStatusItem.value?this._outputStatusItem.value.update(t):this._outputStatusItem.value=this._statusbarService.addEntry(t,"status.view.showQuietly",ov.RIGHT,{location:{id:"status.notifications",priority:Number.NEGATIVE_INFINITY},alignment:ov.LEFT})}async $close(e){if(this._viewsService.isViewVisible(y_)){const t=this._outputService.getActiveChannel();t&&e===t.id&&this._viewsService.closeView(y_)}}async $dispose(e){this._getChannel(e)?.dispose()}_getChannel(e){return this._outputService.getChannel(e)}};nee=vT=f([ht(qe.MainThreadOutputService),p(1,BN),p(2,io),p(3,ne),p(4,AN)],nee);let see=class{constructor(e,t,i){this._commandService=i,this._progress=new Map,this._proxy=e.getProxy(Ze.ExtHostProgress),this._progressService=t}dispose(){this._progress.forEach(e=>e.resolve()),this._progress.clear()}async $startProgress(e,t,i){const n=this._createTask(e);t.location===Xo.Notification&&i&&(t={...t,location:Xo.Notification,secondaryActions:[Ri({id:i,label:h(2434,"Manage Extension"),run:()=>this._commandService.executeCommand("_extensions.manage",i)})]});try{this._progressService.withProgress(t,n,()=>this._proxy.$acceptProgressCanceled(e))}catch(o){Ln(o)}}$progressReport(e,t){this._progress.get(e)?.progress.report(t)}$progressEnd(e){const t=this._progress.get(e);t&&(t.resolve(),this._progress.delete(e))}_createTask(e){return t=>new Promise(i=>{this._progress.set(e,{resolve:i,progress:t})})}};see=f([ht(qe.MainThreadProgress),p(1,pl),p(2,Ge)],see);let oee=class{constructor(e,t){this.quickDiffService=t,this.providerDisposables=new ti,this.proxy=e.getProxy(Ze.ExtHostQuickDiff)}async $registerQuickDiffProvider(e,t,i,n,o){const r={id:i,label:n,rootUri:R.revive(o),selector:t,kind:"contributed",getOriginalResource:async c=>R.revive(await this.proxy.$provideOriginalResource(e,c,Ce.None))},a=this.quickDiffService.addQuickDiffProvider(r);this.providerDisposables.set(e,a)}async $unregisterQuickDiffProvider(e){this.providerDisposables.has(e)&&this.providerDisposables.deleteAndDispose(e)}dispose(){this.providerDisposables.dispose()}};oee=f([ht(qe.MainThreadQuickDiff),p(1,LN)],oee);function ree(s){s.dark=R.revive(s.dark),s.light&&(s.light=R.revive(s.light))}let aee=class{constructor(e,t){this._items={},this.sessions=new Map,this._proxy=e.getProxy(Ze.ExtHostQuickOpen),this._quickInputService=t}dispose(){for(const[e,t]of this.sessions)t.store.dispose()}$show(e,t,i){const n=new Promise((o,r)=>{this._items[e]={resolve:o,reject:r}});return t={...t,onDidFocus:o=>{o&&this._proxy.$onItemSelected(o.handle)}},t.canPickMany?this._quickInputService.pick(n,t,i).then(o=>{if(o)return o.map(r=>r.handle)}):this._quickInputService.pick(n,t,i).then(o=>{if(o)return o.handle})}$setItems(e,t){return this._items[e]&&(this._items[e].resolve(t),delete this._items[e]),Promise.resolve()}$setError(e,t){return this._items[e]&&(this._items[e].reject(t),delete this._items[e]),Promise.resolve()}$input(e,t,i){const n=Object.create(null);return e&&(n.title=e.title,n.password=e.password,n.placeHolder=e.placeHolder,n.valueSelection=e.valueSelection,n.prompt=e.prompt,n.value=e.value,n.ignoreFocusLost=e.ignoreFocusOut),t&&(n.validateInput=o=>this._proxy.$validateInput(o)),this._quickInputService.input(n,i)}$createOrUpdate(e){const t=e.id;let i=this.sessions.get(t);if(!i){const r=new U,a=e.type==="quickPick"?this._quickInputService.createQuickPick():this._quickInputService.createInputBox();if(r.add(a),r.add(a.onDidAccept(()=>{this._proxy.$onDidAccept(t)})),r.add(a.onDidTriggerButton(c=>{this._proxy.$onDidTriggerButton(t,c.handle)})),r.add(a.onDidChangeValue(c=>{this._proxy.$onDidChangeValue(t,c)})),r.add(a.onDidHide(()=>{this._proxy.$onDidHide(t)})),e.type==="quickPick"){const c=a;r.add(c.onDidChangeActive(d=>{this._proxy.$onDidChangeActive(t,d.map(l=>l.handle))})),r.add(c.onDidChangeSelection(d=>{this._proxy.$onDidChangeSelection(t,d.map(l=>l.handle))})),r.add(c.onDidTriggerItemButton(d=>{this._proxy.$onDidTriggerItemButton(t,d.item.handle,d.button.handle)}))}i={input:a,handlesToItems:new Map,store:r},this.sessions.set(t,i)}const{input:n,handlesToItems:o}=i;for(const r in e)r==="id"||r==="type"||(r==="visible"?e.visible?n.show():n.hide():r==="items"?(o.clear(),e[r].forEach(a=>{a.type!=="separator"&&(a.buttons&&(a.buttons=a.buttons.map(c=>(c.iconPath&&ree(c.iconPath),c))),o.set(a.handle,a))}),n[r]=e[r]):r==="activeItems"||r==="selectedItems"?n[r]=e[r].filter(a=>o.has(a)).map(a=>o.get(a)):r==="buttons"?n[r]=e.buttons.map(a=>a.handle===-1?this._quickInputService.backButton:(a.iconPath&&ree(a.iconPath),a)):n[r]=e[r]);return Promise.resolve(void 0)}$dispose(e){const t=this.sessions.get(e);return t&&(t.store.dispose(),this.sessions.delete(e)),Promise.resolve(void 0)}};aee=f([ht(qe.MainThreadQuickOpen),p(1,Wt)],aee);let cee=class extends F{constructor(e,t,i){super(),this._environmentService=t,this._proxy=e.getProxy(Ze.ExtHostExtensionService);const n=this._environmentService.remoteAuthority;n&&this._register(i.onDidChangeConnectionData(()=>{const o=i.getConnectionData(n);o&&this._proxy.$updateRemoteConnectionData(o)}))}};cee=f([c_,p(1,wn),p(2,Wh)],cee);class zFe{constructor(e){this._proxy=e.getProxy(Ze.ExtHostDocumentSaveParticipant)}async participate(e,t,i,n){if(!e.textEditorModel||!Cu(e.textEditorModel))return;const o=new Promise((r,a)=>{setTimeout(()=>a(new Error(h(2435,"Aborted onWillSaveTextDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason).then(c=>{if(!c.every(d=>d))return Promise.reject(new Error("listener failed"))}).then(r,a)});return KM(o,n)}}let dee=class{constructor(e,t,i){this._textFileService=i,this._saveParticipantDisposable=this._textFileService.files.addSaveParticipant(t.createInstance(zFe,e))}dispose(){this._saveParticipantDisposable.dispose()}};dee=f([c_,p(1,Z),p(2,Ps)],dee);let lee=class{constructor(e,t,i){this.speechService=t,this.logService=i,this.providerRegistrations=new Map,this.speechToTextSessions=new Map,this.textToSpeechSessions=new Map,this.keywordRecognitionSessions=new Map,this.proxy=e.getProxy(Ze.ExtHostSpeech)}$registerProvider(e,t,i){this.logService.trace("[Speech] extension registered provider",i.extension.value);const n=this.speechService.registerSpeechProvider(t,{metadata:i,createSpeechToTextSession:(o,r)=>{if(o.isCancellationRequested)return{onDidChange:T.None};const a=new U,c=Math.random();this.proxy.$createSpeechToTextSession(e,c,r?.language);const d=a.add(new M);return this.speechToTextSessions.set(c,{onDidChange:d}),a.add(o.onCancellationRequested(()=>{this.proxy.$cancelSpeechToTextSession(c),this.speechToTextSessions.delete(c),a.dispose()})),{onDidChange:d.event}},createTextToSpeechSession:(o,r)=>{if(o.isCancellationRequested)return{onDidChange:T.None,synthesize:async()=>{}};const a=new U,c=Math.random();this.proxy.$createTextToSpeechSession(e,c,r?.language);const d=a.add(new M);return this.textToSpeechSessions.set(c,{onDidChange:d}),a.add(o.onCancellationRequested(()=>{this.proxy.$cancelTextToSpeechSession(c),this.textToSpeechSessions.delete(c),a.dispose()})),{onDidChange:d.event,synthesize:async l=>{await this.proxy.$synthesizeSpeech(c,l);const u=new U;try{await Sh(T.toPromise(T.filter(d.event,g=>g.status===RH.Stopped,u),u),o)}finally{u.dispose()}}}},createKeywordRecognitionSession:o=>{if(o.isCancellationRequested)return{onDidChange:T.None};const r=new U,a=Math.random();this.proxy.$createKeywordRecognitionSession(e,a);const c=r.add(new M);return this.keywordRecognitionSessions.set(a,{onDidChange:c}),r.add(o.onCancellationRequested(()=>{this.proxy.$cancelKeywordRecognitionSession(a),this.keywordRecognitionSessions.delete(a),r.dispose()})),{onDidChange:c.event}}});this.providerRegistrations.set(e,{dispose:()=>{n.dispose()}})}$unregisterProvider(e){const t=this.providerRegistrations.get(e);t&&(t.dispose(),this.providerRegistrations.delete(e))}$emitSpeechToTextEvent(e,t){this.speechToTextSessions.get(e)?.onDidChange.fire(t)}$emitTextToSpeechEvent(e,t){this.textToSpeechSessions.get(e)?.onDidChange.fire(t)}$emitKeywordRecognitionEvent(e,t){this.keywordRecognitionSessions.get(e)?.onDidChange.fire(t)}dispose(){this.providerRegistrations.forEach(e=>e.dispose()),this.providerRegistrations.clear(),this.speechToTextSessions.forEach(e=>e.onDidChange.dispose()),this.speechToTextSessions.clear(),this.textToSpeechSessions.forEach(e=>e.onDidChange.dispose()),this.textToSpeechSessions.clear(),this.keywordRecognitionSessions.forEach(e=>e.onDidChange.dispose()),this.keywordRecognitionSessions.clear()}};lee=f([ht(qe.MainThreadSpeech),p(1,NN),p(2,Re)],lee);class qFe{constructor(e){this.timeout=2e4,this._proxy=e.getProxy(Ze.ExtHostWorkspace)}async participate(e,t){const i=new Promise((n,o)=>{setTimeout(()=>o(new Error(h(2395,"Aborted onWillCreateEditSessionIdentity-event after 10000ms"))),this.timeout),this._proxy.$onWillCreateEditSessionIdentity(e.uri,t,this.timeout).then(n,o)});return KM(i,t)}}let hee=class{constructor(e,t,i){this._editSessionIdentityService=i,this._saveParticipantDisposable=this._editSessionIdentityService.addEditSessionIdentityCreateParticipant(t.createInstance(qFe,e))}dispose(){this._saveParticipantDisposable.dispose()}};hee=f([c_,p(1,Z),p(2,Eq)],hee);class nE{get childrenCount(){return this._children.size}get children(){return this._children.values()}get name(){return Yc.basename(this.relativePath)}constructor(e,t,i,n=void 0,o=void 0){this.uri=e,this.relativePath=t,this.context=i,this.element=n,this.parent=o,this._children=new Map}get(e){return this._children.get(e)}set(e,t){this._children.set(e,t)}delete(e){this._children.delete(e)}clear(){this._children.clear()}}nE.__decorator=f([Gt],nE.prototype,"name",null);function Hue(s,e){typeof s.element<"u"&&e.push(s.element);for(const t of s.children)Hue(t,e);return e}class KFe{static getRoot(e){for(;e.parent;)e=e.parent;return e}static collect(e){return Hue(e,[])}static isResourceNode(e){return e instanceof nE}constructor(e,t=R.file("/"),i=SE){this.extUri=i,this.root=new nE(t,"",e)}add(e,t){const i=this.extUri.relativePath(this.root.uri,e)||e.path,n=new t1(!1).reset(i);let o=this.root,r="";for(;;){const a=n.value();r=r+"/"+a;let c=o.get(a);if(c?n.hasNext()||(c.element=t):(c=new nE(this.extUri.joinPath(this.root.uri,r),r,this.root.context,n.hasNext()?void 0:t,o),o.set(a,c)),o=c,!n.hasNext())return;n.next()}}delete(e){const t=this.extUri.relativePath(this.root.uri,e)||e.path,i=new t1(!1).reset(t);return this._delete(this.root,i)}_delete(e,t){const i=t.value(),n=e.get(i);if(n){if(t.hasNext()){const o=this._delete(n,t.next());return typeof o<"u"&&n.childrenCount===0&&e.delete(i),o}return e.delete(i),n.element}}clear(){this.root.clear()}getNode(e){const t=this.extUri.relativePath(this.root.uri,e)||e.path,i=new t1(!1).reset(t);let n=this.root;for(;;){const o=i.value(),r=n.get(o);if(!r||!i.hasNext())return r;n=r,i.next()}}}const jFe=H("scmGraph.historyItemRefColor",Ebe,h(9198,"History item reference color.")),YFe=H("scmGraph.historyItemRemoteRefColor",xbe,h(9199,"History item remote reference color.")),QFe=H("scmGraph.historyItemBaseRefColor","#EA5C00",h(9200,"History item base reference color."));H("scmGraph.historyItemHoverDefaultLabelForeground",Zn,h(9201,"History item hover default label foreground color."));H("scmGraph.historyItemHoverDefaultLabelBackground",eN,h(9202,"History item hover default label background color."));H("scmGraph.historyItemHoverLabelForeground",oN,h(9203,"History item hover label foreground color."));H("scmGraph.historyItemHoverAdditionsForeground",{light:"#587C0C",dark:"#81B88B",hcDark:"#A1E3AD",hcLight:"#374E06"},h(9204,"History item hover additions foreground color."));H("scmGraph.historyItemHoverDeletionsForeground",{light:"#AD0707",dark:"#C74E39",hcDark:"#C74E39",hcLight:"#AD0707"},h(9205,"History item hover deletions foreground color."));H("scmGraph.foreground1","#FFB000",h(9206,"Source control graph foreground color (1).")),H("scmGraph.foreground2","#DC267F",h(9207,"Source control graph foreground color (2).")),H("scmGraph.foreground3","#994F00",h(9208,"Source control graph foreground color (3).")),H("scmGraph.foreground4","#40B0A6",h(9209,"Source control graph foreground color (4).")),H("scmGraph.foreground5","#B66DFF",h(9210,"Source control graph foreground color (5)."));function yL(s){if(s!==void 0){if(ke.isThemeIcon(s))return s;if(WT(s))return R.revive(s);{const e=s;return{light:R.revive(e.light),dark:R.revive(e.dark)}}}}function XFe(s){const e=yL(s.authorIcon),t=s.references?.map(i=>({...i,icon:yL(i.icon)}));return{...s,authorIcon:e,references:t}}function E_(s,e){return s?{...s,icon:yL(s.icon),color:e}:void 0}class ZFe extends F{constructor(e,t,i){super(),this.modelService=t,this.languageService=i,this._register(e.registerTextModelContentProvider(ae.vscodeSourceControl,this))}async provideTextContent(e){const t=this.modelService.getModel(e);return t||this.modelService.createModel("",this.languageService.createById("scminput"),e)}}class JFe{get resourceTree(){if(!this._resourceTree){const e=this.provider.rootUri??R.file("/");this._resourceTree=new KFe(this,e,this._uriIdentService.extUri);for(const t of this.resources)this._resourceTree.add(t.sourceUri,t)}return this._resourceTree}get hideWhenEmpty(){return!!this.features.hideWhenEmpty}get contextValue(){return this.features.contextValue}constructor(e,t,i,n,o,r,a,c){this.sourceControlHandle=e,this.handle=t,this.provider=i,this.features=n,this.label=o,this.id=r,this.multiDiffEditorEnableViewChanges=a,this._uriIdentService=c,this.resources=[],this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this._onDidChangeResources=new M,this.onDidChangeResources=this._onDidChangeResources.event}toJSON(){return{$mid:Dn.ScmResourceGroup,sourceControlHandle:this.sourceControlHandle,groupHandle:this.handle}}splice(e,t,i){this.resources.splice(e,t,...i),this._resourceTree=void 0,this._onDidChangeResources.fire()}$updateGroup(e){this.features={...this.features,...e},this._onDidChange.fire()}$updateGroupLabel(e){this.label=e,this._onDidChange.fire()}}class eWe{constructor(e,t,i,n,o,r,a,c,d,l,u){this.proxy=e,this.sourceControlHandle=t,this.groupHandle=i,this.handle=n,this.sourceUri=o,this.resourceGroup=r,this.decorations=a,this.contextValue=c,this.command=d,this.multiDiffEditorOriginalUri=l,this.multiDiffEditorModifiedUri=u}open(e){return this.proxy.$executeResourceCommand(this.sourceControlHandle,this.groupHandle,this.handle,e)}toJSON(){return{$mid:Dn.ScmResource,sourceControlHandle:this.sourceControlHandle,groupHandle:this.groupHandle,handle:this.handle}}}class tWe{get historyItemRef(){return this._historyItemRef}get historyItemRemoteRef(){return this._historyItemRemoteRef}get historyItemBaseRef(){return this._historyItemBaseRef}get historyItemRefChanges(){return this._historyItemRefChanges}constructor(e,t){this.proxy=e,this.handle=t,this._historyItemRef=i1({owner:this,equalsFn:Rk},void 0),this._historyItemRemoteRef=i1({owner:this,equalsFn:Rk},void 0),this._historyItemBaseRef=i1({owner:this,equalsFn:Rk},void 0),this._historyItemRefChanges=si(this,{added:[],modified:[],removed:[],silent:!1})}async resolveHistoryItemRefsCommonAncestor(e){return this.proxy.$resolveHistoryItemRefsCommonAncestor(this.handle,e,Ce.None)}async provideHistoryItemRefs(e){return(await this.proxy.$provideHistoryItemRefs(this.handle,e,Ce.None))?.map(i=>({...i,icon:yL(i.icon)}))}async provideHistoryItems(e){return(await this.proxy.$provideHistoryItems(this.handle,e,Ce.None))?.map(i=>XFe(i))}async provideHistoryItemChanges(e,t){return(await this.proxy.$provideHistoryItemChanges(this.handle,e,t,Ce.None))?.map(n=>({uri:R.revive(n.uri),originalUri:n.originalUri&&R.revive(n.originalUri),modifiedUri:n.modifiedUri&&R.revive(n.modifiedUri)}))}$onDidChangeCurrentHistoryItemRefs(e,t,i){gs(n=>{this._historyItemRef.set(E_(e,jFe),n),this._historyItemRemoteRef.set(E_(t,YFe),n),this._historyItemBaseRef.set(E_(i,QFe),n)})}$onDidChangeHistoryItemRefs(e){const t=e.added.map(o=>E_(o)),i=e.modified.map(o=>E_(o)),n=e.removed.map(o=>E_(o));this._historyItemRefChanges.set({added:t,modified:i,removed:n,silent:e.silent},void 0)}}class o5{static{this.ID_HANDLE=0}get id(){return this._id}get handle(){return this._handle}get label(){return this._label}get rootUri(){return this._rootUri}get inputBoxTextModel(){return this._inputBoxTextModel}get contextValue(){return this._providerId}get acceptInputCommand(){return this.features.acceptInputCommand}get count(){return this._count}get statusBarCommands(){return this._statusBarCommands}get name(){return this._name??this._label}get commitTemplate(){return this._commitTemplate}get actionButton(){return this._actionButton}get historyProvider(){return this._historyProvider}constructor(e,t,i,n,o,r,a,c,d){if(this.proxy=e,this._handle=t,this._providerId=i,this._label=n,this._rootUri=o,this._inputBoxTextModel=r,this._quickDiffService=a,this._uriIdentService=c,this._workspaceContextService=d,this._id=`scm${o5.ID_HANDLE++}`,this.groups=[],this._onDidChangeResourceGroups=new M,this.onDidChangeResourceGroups=this._onDidChangeResourceGroups.event,this._onDidChangeResources=new M,this.onDidChangeResources=this._onDidChangeResources.event,this._groupsByHandle=Object.create(null),this.features={},this._count=si(this,void 0),this._statusBarCommands=si(this,void 0),this._commitTemplate=si(this,""),this._actionButton=si(this,void 0),this._historyProvider=si(this,void 0),o){const l=this._workspaceContextService.getWorkspaceFolder(o);l?.uri.toString()===o.toString()?this._name=l.name:o.path!=="/"&&(this._name=Qe(o))}}$updateSourceControl(e){if(this.features={...this.features,...e},typeof e.commitTemplate<"u"&&this._commitTemplate.set(e.commitTemplate,void 0),typeof e.actionButton<"u"&&this._actionButton.set(e.actionButton??void 0,void 0),typeof e.count<"u"&&this._count.set(e.count,void 0),typeof e.statusBarCommands<"u"&&this._statusBarCommands.set(e.statusBarCommands,void 0),e.hasQuickDiffProvider&&!this._quickDiff?this._quickDiff=this._quickDiffService.addQuickDiffProvider({id:`${this._providerId}.quickDiffProvider`,label:e.quickDiffLabel??this.label,rootUri:this.rootUri,kind:"primary",getOriginalResource:async t=>{if(!this.features.hasQuickDiffProvider)return null;const i=await this.proxy.$provideOriginalResource(this.handle,t,Ce.None);return i&&R.revive(i)}}):e.hasQuickDiffProvider===!1&&this._quickDiff&&(this._quickDiff.dispose(),this._quickDiff=void 0),e.hasSecondaryQuickDiffProvider&&!this._stagedQuickDiff?this._stagedQuickDiff=this._quickDiffService.addQuickDiffProvider({id:`${this._providerId}.secondaryQuickDiffProvider`,label:e.secondaryQuickDiffLabel??this.label,rootUri:this.rootUri,kind:"secondary",getOriginalResource:async t=>{if(!this.features.hasSecondaryQuickDiffProvider)return null;const i=await this.proxy.$provideSecondaryOriginalResource(this.handle,t,Ce.None);return i&&R.revive(i)}}):e.hasSecondaryQuickDiffProvider===!1&&this._stagedQuickDiff&&(this._stagedQuickDiff.dispose(),this._stagedQuickDiff=void 0),e.hasHistoryProvider&&!this.historyProvider.get()){const t=new tWe(this.proxy,this.handle);this._historyProvider.set(t,void 0)}else e.hasHistoryProvider===!1&&this.historyProvider.get()&&this._historyProvider.set(void 0,void 0)}$registerGroups(e){const t=e.map(([i,n,o,r,a])=>{const c=new JFe(this.handle,i,this,r,o,n,a,this._uriIdentService);return this._groupsByHandle[i]=c,c});this.groups.splice(this.groups.length,0,...t),this._onDidChangeResourceGroups.fire()}$updateGroup(e,t){const i=this._groupsByHandle[e];i&&i.$updateGroup(t)}$updateGroupLabel(e,t){const i=this._groupsByHandle[e];i&&i.$updateGroupLabel(t)}$spliceGroupResourceStates(e){for(const[t,i]of e){const n=this._groupsByHandle[t];if(!n){console.warn(`SCM group ${t} not found in provider ${this.label}`);continue}i.reverse();for(const[o,r,a]of i){const c=a.map(d=>{const[l,u,g,m,v,_,w,C,k,D]=d,[A,B]=g,q=ke.isThemeIcon(A)?A:R.revive(A),Q=(ke.isThemeIcon(B)?B:R.revive(B))||q,ie={icon:q,iconDark:Q,tooltip:m,strikeThrough:v,faded:_};return new eWe(this.proxy,this.handle,t,l,R.revive(u),n,ie,w||void 0,C,R.revive(k),R.revive(D))});n.splice(o,r,c)}}this._onDidChangeResources.fire()}$unregisterGroup(e){const t=this._groupsByHandle[e];t&&(delete this._groupsByHandle[e],this.groups.splice(this.groups.indexOf(t),1),this._onDidChangeResourceGroups.fire())}async getOriginalResource(e){if(!this.features.hasQuickDiffProvider)return null;const t=await this.proxy.$provideOriginalResource(this.handle,e,Ce.None);return t&&R.revive(t)}$onDidChangeHistoryProviderCurrentHistoryItemRefs(e,t,i){this.historyProvider.get()&&this._historyProvider.get()?.$onDidChangeCurrentHistoryItemRefs(e,t,i)}$onDidChangeHistoryProviderHistoryItemRefs(e){this.historyProvider.get()&&this._historyProvider.get()?.$onDidChangeHistoryItemRefs(e)}toJSON(){return{$mid:Dn.ScmProvider,handle:this.handle}}dispose(){this._stagedQuickDiff?.dispose(),this._quickDiff?.dispose()}}let uee=class{constructor(e,t,i,n,o,r,a,c,d){this.scmService=t,this.scmViewService=i,this.languageService=n,this.modelService=o,this.textModelService=r,this.quickDiffService=a,this._uriIdentService=c,this.workspaceContextService=d,this._repositories=new Map,this._repositoryBarriers=new Map,this._repositoryDisposables=new Map,this._disposables=new U,this._proxy=e.getProxy(Ze.ExtHostSCM),this._disposables.add(new ZFe(this.textModelService,this.modelService,this.languageService))}dispose(){Xe(this._repositories.values()),this._repositories.clear(),Xe(this._repositoryDisposables.values()),this._repositoryDisposables.clear(),this._disposables.dispose()}async $registerSourceControl(e,t,i,n,o){this._repositoryBarriers.set(e,new Rp);const r=await this.textModelService.createModelReference(R.revive(o)),a=new o5(this._proxy,e,t,i,n?R.revive(n):void 0,r.object.textEditorModel,this.quickDiffService,this._uriIdentService,this.workspaceContextService),c=this.scmService.registerSCMProvider(a);this._repositories.set(e,c);const d=Wo(r,T.filter(this.scmViewService.onDidFocusRepository,l=>l===c)(l=>this._proxy.$setSelectedSourceControl(e)),c.input.onDidChange(({value:l})=>this._proxy.$onInputBoxValueChange(e,l)));this._repositoryDisposables.set(e,d),this.scmViewService.focusedRepository===c&&setTimeout(()=>this._proxy.$setSelectedSourceControl(e),0),c.input.value&&setTimeout(()=>this._proxy.$onInputBoxValueChange(e,c.input.value),0),this._repositoryBarriers.get(e)?.open()}async $updateSourceControl(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$updateSourceControl(t)}async $unregisterSourceControl(e){await this._repositoryBarriers.get(e)?.wait();const t=this._repositories.get(e);t&&(this._repositoryDisposables.get(e).dispose(),this._repositoryDisposables.delete(e),t.dispose(),this._repositories.delete(e))}async $registerGroups(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);if(!n)return;const o=n.provider;o.$registerGroups(t),o.$spliceGroupResourceStates(i)}async $updateGroup(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);if(!n)return;n.provider.$updateGroup(t,i)}async $updateGroupLabel(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);if(!n)return;n.provider.$updateGroupLabel(t,i)}async $spliceResourceStates(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$spliceGroupResourceStates(t)}async $unregisterGroup(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$unregisterGroup(t)}async $setInputBoxValue(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&i.input.setValue(t,!1)}async $setInputBoxPlaceholder(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(i.input.placeholder=t)}async $setInputBoxEnablement(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(i.input.enabled=t)}async $setInputBoxVisibility(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(i.input.visible=t)}async $showValidationMessage(e,t,i){await this._repositoryBarriers.get(e)?.wait();const n=this._repositories.get(e);n&&n.input.showValidationMessage(t,i)}async $setValidationProviderIsEnabled(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);i&&(t?i.input.validateInput=async(n,o)=>{const r=await this._proxy.$validateInput(e,n,o);return r&&{message:r[0],type:r[1]}}:i.input.validateInput=async()=>{})}async $onDidChangeHistoryProviderCurrentHistoryItemRefs(e,t,i,n){await this._repositoryBarriers.get(e)?.wait();const o=this._repositories.get(e);if(!o)return;o.provider.$onDidChangeHistoryProviderCurrentHistoryItemRefs(t,i,n)}async $onDidChangeHistoryProviderHistoryItemRefs(e,t){await this._repositoryBarriers.get(e)?.wait();const i=this._repositories.get(e);if(!i)return;i.provider.$onDidChangeHistoryProviderHistoryItemRefs(t)}};uee=f([ht(qe.MainThreadSCM),p(1,Are),p(2,Rre),p(3,vi),p(4,ci),p(5,Ci),p(6,LN),p(7,nn),p(8,It)],uee);var gee;(function(s){s.FindInFilesActionId="workbench.action.findInFiles",s.FocusActiveEditorCommandId="search.action.focusActiveEditor",s.FocusSearchFromResults="search.action.focusSearchFromResults",s.OpenMatch="search.action.openResult",s.OpenMatchToSide="search.action.openResultToSide",s.RemoveActionId="search.action.remove",s.CopyPathCommandId="search.action.copyPath",s.CopyMatchCommandId="search.action.copyMatch",s.CopyAllCommandId="search.action.copyAll",s.OpenInEditorCommandId="search.action.openInEditor",s.ClearSearchHistoryCommandId="search.action.clearHistory",s.FocusSearchListCommandID="search.action.focusSearchList",s.ReplaceActionId="search.action.replace",s.ReplaceAllInFileActionId="search.action.replaceAllInFile",s.ReplaceAllInFolderActionId="search.action.replaceAllInFolder",s.CloseReplaceWidgetActionId="closeReplaceInFilesWidget",s.ToggleCaseSensitiveCommandId="toggleSearchCaseSensitive",s.ToggleWholeWordCommandId="toggleSearchWholeWord",s.ToggleRegexCommandId="toggleSearchRegex",s.TogglePreserveCaseId="toggleSearchPreserveCase",s.AddCursorsAtSearchResults="addCursorsAtSearchResults",s.RevealInSideBarForSearchResults="search.action.revealInSideBar",s.ReplaceInFilesActionId="workbench.action.replaceInFiles",s.ShowAllSymbolsActionId="workbench.action.showAllSymbols",s.QuickTextSearchActionId="workbench.action.quickTextSearch",s.CancelSearchActionId="search.action.cancel",s.RefreshSearchResultsActionId="search.action.refreshSearchResults",s.FocusNextSearchResultActionId="search.action.focusNextSearchResult",s.FocusPreviousSearchResultActionId="search.action.focusPreviousSearchResult",s.ToggleSearchOnTypeActionId="workbench.action.toggleSearchOnType",s.CollapseSearchResultsActionId="search.action.collapseSearchResults",s.ExpandSearchResultsActionId="search.action.expandSearchResults",s.ExpandRecursivelyCommandId="search.action.expandRecursively",s.ClearSearchResultsActionId="search.action.clearSearchResults",s.GetSearchResultsActionId="search.action.getSearchResults",s.ViewAsTreeActionId="search.action.viewAsTree",s.ViewAsListActionId="search.action.viewAsList",s.ShowAIResultsActionId="search.action.showAIResults",s.HideAIResultsActionId="search.action.hideAIResults",s.SearchWithAIActionId="search.action.searchWithAI",s.ToggleQueryDetailsActionId="workbench.action.search.toggleQueryDetails",s.ExcludeFolderFromSearchId="search.action.excludeFromSearch",s.FocusNextInputActionId="search.focus.nextInputBox",s.FocusPreviousInputActionId="search.focus.previousInputBox",s.RestrictSearchToFolderId="search.action.restrictSearchToFolder",s.FindInFolderId="filesExplorer.findInFolder",s.FindInWorkspaceId="filesExplorer.findInWorkspace"})(gee||(gee={}));const iWe={SearchViewVisibleKey:new O("searchViewletVisible",!0),SearchViewFocusedKey:new O("searchViewletFocus",!1),SearchResultListFocusedKey:new O("searchResultListFocused",!0),InputBoxFocusedKey:new O("inputBoxFocus",!1),SearchInputBoxFocusedKey:new O("searchInputBoxFocus",!1),ReplaceInputBoxFocusedKey:new O("replaceInputBoxFocus",!1),PatternIncludesFocusedKey:new O("patternIncludesInputBoxFocus",!1),PatternExcludesFocusedKey:new O("patternExcludesInputBoxFocus",!1),ReplaceActiveKey:new O("replaceActive",!1),HasSearchResults:new O("hasSearchResult",!1),FirstMatchFocusKey:new O("firstMatchFocus",!1),FileMatchOrMatchFocusKey:new O("fileMatchOrMatchFocus",!1),FileMatchOrFolderMatchFocusKey:new O("fileMatchOrFolderMatchFocus",!1),FileMatchOrFolderMatchWithResourceFocusKey:new O("fileMatchOrFolderMatchWithResourceFocus",!1),FileFocusKey:new O("fileMatchFocus",!1),FolderFocusKey:new O("folderMatchFocus",!1),ResourceFolderFocusKey:new O("folderMatchWithResourceFocus",!1),IsEditableItemKey:new O("isEditableItem",!0),MatchFocusKey:new O("matchFocus",!1),SearchResultHeaderFocused:new O("searchResultHeaderFocused",!1),ViewHasSearchPatternKey:new O("viewHasSearchPattern",!1),ViewHasReplacePatternKey:new O("viewHasReplacePattern",!1),ViewHasFilePatternKey:new O("viewHasFilePattern",!1),ViewHasSomeCollapsibleKey:new O("viewHasSomeCollapsibleResult",!1),InTreeViewKey:new O("inTreeView",!1),hasAIResultProvider:new O("hasAIResultProviderKey",!1),AIResultsTitle:new O("aiResultsTitle",!1),AIResultsRequested:new O("aiResultsRequested",!1)};let pee=class{constructor(e,t,i,n,o){this._searchService=t,this._telemetryService=i,this.contextKeyService=o,this._searchProvider=new Map,this._proxy=e.getProxy(Ze.ExtHostSearch),this._proxy.$enableExtensionHostSearch()}dispose(){this._searchProvider.forEach(e=>e.dispose()),this._searchProvider.clear()}$registerTextSearchProvider(e,t){this._searchProvider.set(e,new Q1(this._searchService,WC.text,t,e,this._proxy))}$registerAITextSearchProvider(e,t){iWe.hasAIResultProvider.bindTo(this.contextKeyService).set(!0),this._searchProvider.set(e,new Q1(this._searchService,WC.aiText,t,e,this._proxy))}$registerFileSearchProvider(e,t){this._searchProvider.set(e,new Q1(this._searchService,WC.file,t,e,this._proxy))}$unregisterProvider(e){Xe(this._searchProvider.get(e)),this._searchProvider.delete(e)}$handleFileMatch(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleFindMatch(t,i)}$handleTextMatch(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleFindMatch(t,i)}$handleKeywordResult(e,t,i){const n=this._searchProvider.get(e);if(!n)throw new Error("Got result for unknown provider");n.handleKeywordResult(t,i)}$handleTelemetry(e,t){this._telemetryService.publicLog(e,t)}};pee=f([ht(qe.MainThreadSearch),p(1,kI),p(2,ai),p(3,ne),p(4,fe)],pee);class r5{static{this._idPool=0}constructor(e,t=++r5._idPool,i=new Map,n=[]){this.progress=e,this.id=t,this.matches=i,this.keywords=n}addMatch(e){const t=this.matches.get(e.resource.toString());t?t.results&&e.results&&t.results.push(...e.results):this.matches.set(e.resource.toString(),e),this.progress?.(e)}addKeyword(e){this.keywords.push(e)}}class Q1{constructor(e,t,i,n,o){this._scheme=i,this._handle=n,this._proxy=o,this._registrations=new U,this._searches=new Map,this._registrations.add(e.registerSearchResultProvider(this._scheme,t,this))}async getAIName(){return this.cachedAIName===void 0&&(this.cachedAIName=await this._proxy.$getAIName(this._handle)),this.cachedAIName}dispose(){this._registrations.dispose()}fileSearch(e,t=Ce.None){return this.doSearch(e,void 0,t)}textSearch(e,t,i=Ce.None){return this.doSearch(e,t,i)}doSearch(e,t,i=Ce.None){if(!e.folderQueries.length)throw new Error("Empty folderQueries");const n=new r5(t);this._searches.set(n.id,n);const o=this._provideSearchResults(e,n.id,i);return Promise.resolve(o).then(r=>(this._searches.delete(n.id),{results:Array.from(n.matches.values()),aiKeywords:Array.from(n.keywords),stats:r.stats,limitHit:r.limitHit,messages:r.messages}),r=>(this._searches.delete(n.id),Promise.reject(r)))}clearCache(e){return Promise.resolve(this._proxy.$clearCache(e))}handleFindMatch(e,t){const i=this._searches.get(e);i&&t.forEach(n=>{n.results?i.addMatch(gn(n)):i.addMatch({resource:R.revive(n)})})}handleKeywordResult(e,t){const i=this._searches.get(e);i&&i.addKeyword(t)}_provideSearchResults(e,t,i,n){switch(e.type){case bp.File:return this._proxy.$provideFileSearchResults(this._handle,t,e,i);case bp.Text:return this._proxy.$provideTextSearchResults(this._handle,t,e,i);default:return this._proxy.$provideAITextSearchResults(this._handle,t,e,i)}}}let fee=class{constructor(e,t){this.statusbarService=t,this._store=new U,this._proxy=e.getProxy(Ze.ExtHostStatusBar);const i=[];for(const[o,r]of t.getEntries())i.push(n(o,r));this._proxy.$acceptStaticEntries(i),this._store.add(t.onDidChange(o=>{o.added&&this._proxy.$acceptStaticEntries([n(o.added[0],o.added[1])])}));function n(o,r){return{entryId:o,name:r.entry.name,text:r.entry.text,tooltip:r.entry.tooltip,command:typeof r.entry.command=="string"?r.entry.command:typeof r.entry.command=="object"?r.entry.command.id:void 0,priority:r.priority,alignLeft:r.alignment===ov.LEFT,accessibilityInformation:r.entry.ariaLabel?{label:r.entry.ariaLabel,role:r.entry.role}:void 0}}}dispose(){this._store.dispose()}$setEntry(e,t,i,n,o,r,a,c,d,l,u,g,m){const v=a?{markdown:w=>this._proxy.$provideTooltip(e,w),markdownNotSupportedFallback:void 0}:r;this.statusbarService.setOrUpdateEntry(e,t,i,n,o,v,c,d,l,u,g,m)===Sy.DidDefine&&this._store.add(Ie(()=>this.statusbarService.unsetEntry(e)))}$disposeEntry(e){this.statusbarService.unsetEntry(e)}};fee=f([ht(qe.MainThreadStatusBar),p(1,Tq)],fee);async function nWe(s,e,t,i){return i.invokeFunction(async n=>{const o=n.get(Hs),r=n.get(Uv),a=n.get(wq),c=n.get(it),d=n.get(nn),l=n.get(je),u=n.get(It),g=n.get(Re),m=`extensionStorage.migrate.${s}-${e}`,v=s.toLowerCase()===e.toLowerCase()?`extension.storage.migrateFromLowerCaseKey.${s.toLowerCase()}`:void 0;if(s===e)return;const _=(C,k)=>k?d.extUri.joinPath(r.defaultProfile.globalStorageHome,C.toLowerCase()):d.extUri.joinPath(o.workspaceStorageHome,u.getWorkspace().id,C),w=t?he.PROFILE:he.WORKSPACE;if(!c.getBoolean(m,w,!1)&&!(v&&c.getBoolean(v,w,!1))){g.info(`Migrating ${t?"global":"workspace"} extension storage from ${s} to ${e}...`);const C=a.getExtensionState(s,t);C&&(a.setExtensionState(e,C,t),a.setExtensionState(s,void 0,t));const k=_(s,t),D=_(e,t);if(!d.extUri.isEqual(k,D))try{await l.move(k,D,!0)}catch(A){A.code!==ur.FileNotFound&&g.info(`Error while migrating ${t?"global":"workspace"} file storage from '${s}' to '${e}'`,ya(A))}g.info(`Migrated ${t?"global":"workspace"} extension storage from ${s} to ${e}`),c.store(m,!0,w,gt.MACHINE)}})}let mee=class{constructor(e,t,i,n,o){this._extensionStorageService=t,this._storageService=i,this._instantiationService=n,this._logService=o,this._storageListener=new U,this._sharedStorageKeysToWatch=new Map,this._proxy=e.getProxy(Ze.ExtHostStorage),this._storageListener.add(this._storageService.onDidChangeValue(he.PROFILE,void 0,this._storageListener)(r=>{if(this._sharedStorageKeysToWatch.has(r.key)){const a=this._extensionStorageService.getExtensionStateRaw(r.key,!0);typeof a=="string"&&this._proxy.$acceptValue(!0,r.key,a)}}))}dispose(){this._storageListener.dispose()}async $initializeExtensionStorage(e,t){return await this.checkAndMigrateExtensionStorage(t,e),e&&this._sharedStorageKeysToWatch.set(t,!0),this._extensionStorageService.getExtensionStateRaw(t,e)}async $setValue(e,t,i){this._extensionStorageService.setExtensionState(t,i,e)}$registerExtensionStorageKeysToSync(e,t){this._extensionStorageService.setKeysForSync(e,t)}async checkAndMigrateExtensionStorage(e,t){try{let i=this._extensionStorageService.getSourceExtensionToMigrate(e);!i&&Kt&&e!==e.toLowerCase()&&(i=e.toLowerCase()),i&&(Kt&&i!==i.toLowerCase()&&this._extensionStorageService.getExtensionState(i.toLowerCase(),t)&&!this._extensionStorageService.getExtensionState(i,t)&&(i=i.toLowerCase()),await nWe(i,e,t,this._instantiationService))}catch(i){this._logService.error(i)}}};mee=f([ht(qe.MainThreadStorage),p(1,wq),p(2,it),p(3,Z),p(4,Re)],mee);var T$;let vee=class extends F{static{T$=this}static{this._name="pluginHostTelemetry"}constructor(e,t,i,n,o){super(),this._telemetryService=t,this._configurationService=i,this._environmentService=n,this._productService=o,this._proxy=e.getProxy(Ze.ExtHostTelemetry),kk(this._productService,this._environmentService)&&this._register(this._configurationService.onDidChangeConfiguration(r=>{(r.affectsConfiguration(Ibe)||r.affectsConfiguration(Dbe))&&this._proxy.$onDidChangeTelemetryLevel(this.telemetryLevel)})),this._proxy.$initializeTelemetryLevel(this.telemetryLevel,kk(this._productService,this._environmentService),this._productService.enabledTelemetryLevels)}get telemetryLevel(){return kk(this._productService,this._environmentService)?this._telemetryService.telemetryLevel:Rz.NONE}$publicLog(e,t=Object.create(null)){t[T$._name]=!0,this._telemetryService.publicLog(e,t)}$publicLog2(e,t){this.$publicLog(e,t)}};vee=T$=f([ht(qe.MainThreadTelemetry),p(1,ai),p(2,ne),p(3,Hs),p(4,Vn)],vee);let A$=class extends F{get onProcessReady(){return this._onProcessReady.event}constructor(e,t,i,n){super(),this.instanceId=e,this._cols=t,this._rows=i,this._terminalService=n,this.id=0,this.shouldPersist=!1,this._onProcessData=this._register(new M),this.onProcessData=this._onProcessData.event,this._onProcessReady=this._register(new M),this._onStart=this._register(new M),this.onStart=this._onStart.event,this._onInput=this._register(new M),this.onInput=this._onInput.event,this._onBinary=this._register(new M),this.onBinary=this._onBinary.event,this._onResize=this._register(new M),this.onResize=this._onResize.event,this._onAcknowledgeDataEvent=this._register(new M),this.onAcknowledgeDataEvent=this._onAcknowledgeDataEvent.event,this._onShutdown=this._register(new M),this.onShutdown=this._onShutdown.event,this._onRequestInitialCwd=this._register(new M),this.onRequestInitialCwd=this._onRequestInitialCwd.event,this._onRequestCwd=this._register(new M),this.onRequestCwd=this._onRequestCwd.event,this._onDidChangeProperty=this._register(new M),this.onDidChangeProperty=this._onDidChangeProperty.event,this._onProcessExit=this._register(new M),this.onProcessExit=this._onProcessExit.event,this._pendingInitialCwdRequests=[],this._pendingCwdRequests=[]}emitData(e){this._onProcessData.fire(e)}emitTitle(e){this._onDidChangeProperty.fire({type:Vd.Title,value:e})}emitReady(e,t){this._onProcessReady.fire({pid:e,cwd:t,windowsPty:void 0})}emitProcessProperty({type:e,value:t}){switch(e){case Vd.Cwd:this.emitCwd(t);break;case Vd.InitialCwd:this.emitInitialCwd(t);break;case Vd.Title:this.emitTitle(t);break;case Vd.OverrideDimensions:this.emitOverrideDimensions(t);break;case Vd.ResolvedShellLaunchConfig:this.emitResolvedShellLaunchConfig(t);break}}emitExit(e){this._onProcessExit.fire(e),this.dispose()}emitOverrideDimensions(e){this._onDidChangeProperty.fire({type:Vd.OverrideDimensions,value:e})}emitResolvedShellLaunchConfig(e){this._onDidChangeProperty.fire({type:Vd.ResolvedShellLaunchConfig,value:e})}emitInitialCwd(e){for(;this._pendingInitialCwdRequests.length>0;)this._pendingInitialCwdRequests.pop()(e)}emitCwd(e){for(;this._pendingCwdRequests.length>0;)this._pendingCwdRequests.pop()(e)}async start(){return this._terminalService.requestStartExtensionTerminal(this,this._cols,this._rows)}shutdown(e){this._onShutdown.fire(e)}input(e){this._onInput.fire(e)}resize(e,t){this._onResize.fire({cols:e,rows:t})}clearBuffer(){}acknowledgeDataEvent(){}async setUnicodeVersion(e){}async processBinary(e){this._onBinary.fire(e)}getInitialCwd(){return new Promise(e=>{this._onRequestInitialCwd.fire(),this._pendingInitialCwdRequests.push(e)})}getCwd(){return new Promise(e=>{this._onRequestCwd.fire(),this._pendingCwdRequests.push(e)})}async refreshProperty(e){}async updateProperty(e,t){}};A$=f([p(3,Rw)],A$);var sE;(function(s){s[s.TerminalCommand=0]="TerminalCommand",s[s.Opener=1]="Opener",s[s.Port=2]="Port",s[s.VscodeCommand=3]="VscodeCommand"})(sE||(sE={}));var jl;(function(s){s[s.CwdDetection=0]="CwdDetection",s[s.NaiveCwdDetection=1]="NaiveCwdDetection",s[s.CommandDetection=2]="CommandDetection",s[s.PartialCommandDetection=3]="PartialCommandDetection",s[s.BufferMarkDetection=4]="BufferMarkDetection",s[s.ShellEnvDetection=5]="ShellEnvDetection"})(jl||(jl={}));var _ee;(function(s){s.Windows="windows",s.NoProblemsReported="noProblemsReported"})(_ee||(_ee={}));let bee=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){this._extHostContext=e,this._terminalService=t,this._terminalLinkProviderService=i,this._terminalQuickFixService=n,this._instantiationService=o,this._environmentVariableService=r,this._logService=a,this._terminalProfileResolverService=c,this._terminalGroupService=l,this._terminalEditorService=u,this._terminalProfileService=g,this._terminalCompletionService=m,this._store=new U,this._extHostTerminals=new Map,this._terminalProcessProxies=new Map,this._profileProviders=new Map,this._completionProviders=new Map,this._quickFixProviders=new Map,this._dataEventTracker=new Pt,this._sendCommandEventListener=new Pt,this._linkProvider=this._store.add(new Pt),this._os=$u,this._proxy=e.getProxy(Ze.ExtHostTerminalService),this._store.add(t.onDidCreateInstance(_=>{this._onTerminalOpened(_),this._onInstanceDimensionsChanged(_)})),this._store.add(t.onDidDisposeInstance(_=>this._onTerminalDisposed(_))),this._store.add(t.onAnyInstanceProcessIdReady(_=>this._onTerminalProcessIdReady(_))),this._store.add(t.onDidChangeInstanceDimensions(_=>this._onInstanceDimensionsChanged(_))),this._store.add(t.onAnyInstanceMaximumDimensionsChange(_=>this._onInstanceMaximumDimensionsChanged(_))),this._store.add(t.onDidRequestStartExtensionTerminal(_=>this._onRequestStartExtensionTerminal(_))),this._store.add(t.onDidChangeActiveInstance(_=>this._onActiveTerminalChanged(_?_.instanceId:null))),this._store.add(t.onAnyInstanceTitleChange(_=>_&&this._onTitleChanged(_.instanceId,_.title))),this._store.add(t.onAnyInstanceDataInput(_=>this._proxy.$acceptTerminalInteraction(_.instanceId))),this._store.add(t.onAnyInstanceSelectionChange(_=>this._proxy.$acceptTerminalSelection(_.instanceId,_.selection))),this._store.add(t.onAnyInstanceShellTypeChanged(_=>this._onShellTypeChanged(_.instanceId)));for(const _ of this._terminalService.instances)this._onTerminalOpened(_),_.processReady.then(()=>this._onTerminalProcessIdReady(_)),_.shellType&&this._proxy.$acceptTerminalShellType(_.instanceId,_.shellType);const v=this._terminalService.activeInstance;if(v&&this._proxy.$acceptActiveTerminalChanged(v.instanceId),this._environmentVariableService.collections.size>0){const w=[...this._environmentVariableService.collections.entries()].map(C=>[C[0],sTe(C[1].map)]);this._proxy.$initEnvironmentVariableCollections(w)}d.getEnvironment().then(async _=>{this._os=_?.os||$u,this._updateDefaultProfile()}),this._store.add(this._terminalProfileService.onDidChangeAvailableProfiles(()=>this._updateDefaultProfile()))}dispose(){this._store.dispose();for(const e of this._profileProviders.values())e.dispose();for(const e of this._quickFixProviders.values())e.dispose()}async _updateDefaultProfile(){const e=this._extHostContext.remoteAuthority??void 0,t=this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:e,os:this._os}),i=this._terminalProfileResolverService.getDefaultProfile({remoteAuthority:e,os:this._os,allowAutomationShell:!0});this._proxy.$acceptDefaultProfile(...await Promise.all([t,i]))}async _getTerminalInstance(e){return typeof e=="string"?this._extHostTerminals.get(e):this._terminalService.getInstanceFromId(e)}async $createTerminal(e,t){const i={name:t.name,executable:t.shellPath,args:t.shellArgs,cwd:typeof t.cwd=="string"?t.cwd:R.revive(t.cwd),icon:t.icon,color:t.color,initialText:t.initialText,waitOnExit:t.waitOnExit,ignoreConfigurationCwd:!0,env:t.env,strictEnv:t.strictEnv,hideFromUser:t.hideFromUser,customPtyImplementation:t.isExtensionCustomPtyTerminal?(r,a,c)=>new A$(r,a,c,this._terminalService):void 0,extHostTerminalId:e,forceShellIntegration:t.forceShellIntegration,isFeatureTerminal:t.isFeatureTerminal,isExtensionOwnedTerminal:t.isExtensionOwnedTerminal,useShellEnvironment:t.useShellEnvironment,isTransient:t.isTransient},n=Pp.withAsyncBody(async r=>{const a=await this._terminalService.createTerminal({config:i,location:await this._deserializeParentTerminal(t.location)});r(a)});this._extHostTerminals.set(e,n);const o=await n;this._store.add(o.onDisposed(()=>{this._extHostTerminals.delete(e)}))}async _deserializeParentTerminal(e){if(typeof e=="object"&&"parentTerminal"in e){const t=await this._extHostTerminals.get(e.parentTerminal.toString());return t?{parentTerminal:t}:void 0}return e}async $show(e,t){const i=await this._getTerminalInstance(e);i&&(this._terminalService.setActiveInstance(i),i.target===wy.Editor?await this._terminalEditorService.revealActiveEditor(t):await this._terminalGroupService.showPanel(!t))}async $hide(e){const t=await this._getTerminalInstance(e),i=this._terminalService.activeInstance;i&&i.instanceId===t?.instanceId&&i.target!==wy.Editor&&this._terminalGroupService.hidePanel()}async $dispose(e){(await this._getTerminalInstance(e))?.dispose(Am.Extension)}async $sendText(e,t,i){await(await this._getTerminalInstance(e))?.sendText(t,i)}$sendProcessExit(e,t){this._terminalProcessProxies.get(e)?.emitExit(t)}$startSendingDataEvents(){if(!this._dataEventTracker.value){this._dataEventTracker.value=this._instantiationService.createInstance(R$,(e,t)=>{this._onTerminalData(e,t)});for(const e of this._terminalService.instances)for(const t of e.initialDataEvents||[])this._onTerminalData(e.instanceId,t)}}$stopSendingDataEvents(){this._dataEventTracker.clear()}$startSendingCommandEvents(){if(this._sendCommandEventListener.value)return;const e=this._terminalService.createOnInstanceCapabilityEvent(jl.CommandDetection,i=>i.onCommandFinished),t=e.event(i=>{this._onDidExecuteCommand(i.instance.instanceId,{commandLine:i.data.command,cwd:i.data.cwd,exitCode:i.data.exitCode,output:i.data.getOutput()})});this._sendCommandEventListener.value=Wo(e,t)}$stopSendingCommandEvents(){this._sendCommandEventListener.clear()}$startLinkProvider(){this._linkProvider.value=this._terminalLinkProviderService.registerLinkProvider(new sWe(this._proxy))}$stopLinkProvider(){this._linkProvider.clear()}$registerProcessSupport(e){this._terminalService.registerProcessSupport(e)}$registerCompletionProvider(e,t,...i){this._completionProviders.set(e,this._terminalCompletionService.registerTerminalCompletionProvider(t,e,{id:e,provideCompletions:async(n,o,r,a)=>{const c=await this._proxy.$provideTerminalCompletions(e,{commandLine:n,cursorPosition:o,allowFallbackCompletions:r},a);return{items:c?.items.map(d=>({...d,provider:e})),resourceRequestConfig:c?.resourceRequestConfig}}},...i))}$unregisterCompletionProvider(e){this._completionProviders.get(e)?.dispose(),this._completionProviders.delete(e)}$registerProfileProvider(e,t){this._profileProviders.set(e,this._terminalProfileService.registerTerminalProfileProvider(t,e,{createContributedTerminalProfile:async i=>this._proxy.$createContributedProfileTerminal(e,i)}))}$unregisterProfileProvider(e){this._profileProviders.get(e)?.dispose(),this._profileProviders.delete(e)}async $registerQuickFixProvider(e,t){this._quickFixProviders.set(e,this._terminalQuickFixService.registerQuickFixProvider(e,{provideTerminalQuickFixes:async(i,n,o,r)=>{if(r.isCancellationRequested)return;o.outputMatcher?.length&&o.outputMatcher.length>40&&(o.outputMatcher.length=40,this._logService.warn("Cannot exceed output matcher length of 40"));const a=i.command.match(o.commandLineMatcher);if(!a||!n)return;const c=o.outputMatcher;let d;if(c&&(d=oWe(n,c)),!d)return;const l={commandLineMatch:a,outputMatch:d,commandLine:i.command};if(l){const u=await this._proxy.$provideTerminalQuickFixes(e,l,r);if(u&&Array.isArray(u))return u.map(g=>yee(e,t,g));if(u)return yee(e,t,u)}}}))}$unregisterQuickFixProvider(e){this._quickFixProviders.get(e)?.dispose(),this._quickFixProviders.delete(e)}_onActiveTerminalChanged(e){this._proxy.$acceptActiveTerminalChanged(e)}_onTerminalData(e,t){this._proxy.$acceptTerminalProcessData(e,t)}_onDidExecuteCommand(e,t){this._proxy.$acceptDidExecuteCommand(e,t)}_onTitleChanged(e,t){this._proxy.$acceptTerminalTitleChange(e,t)}_onShellTypeChanged(e){const t=this._terminalService.getInstanceFromId(e);t&&this._proxy.$acceptTerminalShellType(e,t.shellType)}_onTerminalDisposed(e){this._proxy.$acceptTerminalClosed(e.instanceId,e.exitCode,e.exitReason??Am.Unknown)}_onTerminalOpened(e){const t=e.shellLaunchConfig.extHostTerminalId,i={name:e.shellLaunchConfig.name,executable:e.shellLaunchConfig.executable,args:e.shellLaunchConfig.args,cwd:e.shellLaunchConfig.cwd,env:e.shellLaunchConfig.env,hideFromUser:e.shellLaunchConfig.hideFromUser,tabActions:e.shellLaunchConfig.tabActions};this._proxy.$acceptTerminalOpened(e.instanceId,t,e.title,i)}_onTerminalProcessIdReady(e){e.processId!==void 0&&this._proxy.$acceptTerminalProcessId(e.instanceId,e.processId)}_onInstanceDimensionsChanged(e){this._proxy.$acceptTerminalDimensions(e.instanceId,e.cols,e.rows)}_onInstanceMaximumDimensionsChanged(e){this._proxy.$acceptTerminalMaximumDimensions(e.instanceId,e.maxCols,e.maxRows)}_onRequestStartExtensionTerminal(e){const t=e.proxy;this._terminalProcessProxies.set(t.instanceId,t);const i=e.cols&&e.rows?{columns:e.cols,rows:e.rows}:void 0;this._proxy.$startExtensionTerminal(t.instanceId,i).then(e.callback),t.onInput(n=>this._proxy.$acceptProcessInput(t.instanceId,n)),t.onShutdown(n=>this._proxy.$acceptProcessShutdown(t.instanceId,n)),t.onRequestCwd(()=>this._proxy.$acceptProcessRequestCwd(t.instanceId)),t.onRequestInitialCwd(()=>this._proxy.$acceptProcessRequestInitialCwd(t.instanceId))}$sendProcessData(e,t){this._terminalProcessProxies.get(e)?.emitData(t)}$sendProcessReady(e,t,i,n){this._terminalProcessProxies.get(e)?.emitReady(t,i,n)}$sendProcessProperty(e,t){t.type===Vd.Title&&this._terminalService.getInstanceFromId(e)?.rename(t.value),this._terminalProcessProxies.get(e)?.emitProcessProperty(t)}$setEnvironmentVariableCollection(e,t,i,n){if(i){const o={persistent:t,map:oTe(i),descriptionMap:rTe(n)};this._environmentVariableService.set(e,o)}else this._environmentVariableService.delete(e)}};bee=f([ht(qe.MainThreadTerminalService),p(1,Rw),p(2,Bre),p(3,Vre),p(4,Z),p(5,Ore),p(6,Re),p(7,Fre),p(8,Lh),p(9,Wq),p(10,Mre),p(11,Wre),p(12,Hre)],bee);let R$=class extends F{constructor(e,t){super(),this._callback=e,this._terminalService=t,this._register(this._bufferer=new aTe(this._callback));for(const i of this._terminalService.instances)this._registerInstance(i);this._register(this._terminalService.onDidCreateInstance(i=>this._registerInstance(i))),this._register(this._terminalService.onDidDisposeInstance(i=>this._bufferer.stopBuffering(i.instanceId)))}_registerInstance(e){this._register(this._bufferer.startBuffering(e.instanceId,e.onData))}};R$=f([p(1,Rw)],R$);class sWe{constructor(e){this._proxy=e}async provideLinks(e,t){const i=this._proxy;return(await i.$provideLinks(e.instanceId,t)).map(o=>({id:o.id,startIndex:o.startIndex,length:o.length,label:o.label,activate:()=>i.$activateLink(e.instanceId,o.id)}))}}function oWe(s,e){const t=s.join(`
`).match(e.lineMatcher);return t?{regexMatch:t,outputLines:s}:void 0}function yee(s,e,t){let i=sE.TerminalCommand;return"uri"in t?(t.uri=R.revive(t.uri),i=sE.Opener):"id"in t&&(i=sE.VscodeCommand),{id:s,type:i,source:e,...t}}let wee=class extends F{constructor(e,t,i){super(),this._terminalService=t,this._proxy=e.getProxy(Ze.ExtHostTerminalShellIntegration);const n=new Map;this._register(Ie(()=>{for(const u of n.values())u.dispose()}));for(const u of this._terminalService.instances)u.capabilities.get(jl.CommandDetection)&&this._enableShellIntegration(u);const o=this._store.add(this._terminalService.createOnInstanceEvent(u=>T.map(T.filter(u.capabilities.onDidAddCapabilityType,g=>g===jl.CommandDetection),()=>u))).event;this._store.add(o(u=>this._enableShellIntegration(u)));const r=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(jl.CwdDetection,u=>u.onDidChangeCwd));this._store.add(r.event(u=>{this._proxy.$cwdChange(u.instance.instanceId,this._convertCwdToUri(u.data))}));const a=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(jl.ShellEnvDetection,u=>u.onDidChangeEnv));this._store.add(a.event(u=>{if(u.data.value&&typeof u.data.value=="object"){const g=u.data.value,m=Object.keys(g),v=Object.values(g);this._proxy.$shellEnvChange(u.instance.instanceId,m,v,u.data.isTrusted)}}));const c=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(jl.CommandDetection,u=>u.onCommandExecuted));let d;this._store.add(c.event(u=>{if(u.data===d)return;d=u.data;const g=u.instance.instanceId;this._proxy.$shellExecutionStart(g,u.data.command,See(u.data),u.data.isTrusted,this._convertCwdToUri(u.data.cwd)),n.get(g)?.dispose(),n.set(g,T.accumulate(u.instance.onData,50,this._store)(m=>{this._proxy.$shellExecutionData(g,m.join(""))}))}));const l=this._store.add(this._terminalService.createOnInstanceCapabilityEvent(jl.CommandDetection,u=>u.onCommandFinished));this._store.add(l.event(u=>{d=void 0;const g=u.instance.instanceId;n.get(g)?.dispose(),this._proxy.$shellExecutionEnd(g,u.data.command,See(u.data),u.data.isTrusted,u.data.exitCode)})),this._store.add(this._terminalService.onDidDisposeInstance(u=>this._proxy.$closeTerminal(u.instanceId)))}$executeCommand(e,t){this._terminalService.getInstanceFromId(e)?.runCommand(t,!0)}_convertCwdToUri(e){return e?R.file(e):void 0}_enableShellIntegration(e){this._proxy.$shellIntegrationChange(e.instanceId);const t=e.capabilities.get(jl.CwdDetection);t&&this._proxy.$cwdChange(e.instanceId,this._convertCwdToUri(t.getCwd()))}};wee=f([ht(qe.MainThreadTerminalShellIntegration),p(1,Rw),p(2,wn)],wee);function See(s){switch(s.commandLineConfidence){case"high":return TC.High;case"medium":return TC.Medium;case"low":default:return TC.Low}}let Cee=class{constructor(e,t){this._themeService=t,this._proxy=e.getProxy(Ze.ExtHostTheming),this._themeChangeListener=this._themeService.onDidColorThemeChange(i=>{this._proxy.$onColorThemeChange(this._themeService.getColorTheme().type)}),this._proxy.$onColorThemeChange(this._themeService.getColorTheme().type)}dispose(){this._themeChangeListener.dispose()}};Cee=f([ht(qe.MainThreadTheming),p(1,pt)],Cee);let Eee=class extends F{constructor(e,t,i,n,o){super(),this.viewsService=t,this.notificationService=i,this.extensionService=n,this.logService=o,this._dataProviders=this._register(new ti),this._dndControllers=new Map,this._proxy=e.getProxy(Ze.ExtHostTreeViews)}async $registerTreeViewDataProvider(e,t){this.logService.trace("MainThreadTreeViews#$registerTreeViewDataProvider",e,t),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{const i=new aWe(e,this._proxy,this.notificationService),n=new U;this._dataProviders.set(e,{dataProvider:i,dispose:()=>n.dispose()});const o=t.hasHandleDrag||t.hasHandleDrop?new rWe(e,t.dropMimeTypes,t.dragMimeTypes,t.hasHandleDrag,this._proxy):void 0,r=this.getTreeView(e);r?(r.showCollapseAllAction=t.showCollapseAll,r.canSelectMany=t.canSelectMany,r.manuallyManageCheckboxes=t.manuallyManageCheckboxes,r.dragAndDropController=o,o&&this._dndControllers.set(e,o),r.dataProvider=i,this.registerListeners(e,r,n),this._proxy.$setVisible(e,r.visible)):this.notificationService.error("No view is registered with id: "+e)})}$reveal(e,t,i){return this.logService.trace("MainThreadTreeViews#$reveal",e,t?.item,t?.parentChain,i),this.viewsService.openView(e,i.focus).then(()=>{const n=this.getTreeView(e);if(n&&t)return this.reveal(n,this._dataProviders.get(e).dataProvider,t.item,t.parentChain,i)})}$refresh(e,t){this.logService.trace("MainThreadTreeViews#$refresh",e,t);const i=this.getTreeView(e),n=this._dataProviders.get(e);if(i&&n){const o=n.dataProvider.getItemsToRefresh(t);return i.refresh(o.items.length?o.items:void 0,o.checkboxes.length?o.checkboxes:void 0)}return Promise.resolve()}$setMessage(e,t){this.logService.trace("MainThreadTreeViews#$setMessage",e,t.toString());const i=this.getTreeView(e);i&&(i.message=t)}$setTitle(e,t,i){this.logService.trace("MainThreadTreeViews#$setTitle",e,t,i);const n=this.getTreeView(e);n&&(n.title=t,n.description=i)}$setBadge(e,t){this.logService.trace("MainThreadTreeViews#$setBadge",e,t?.value,t?.tooltip);const i=this.getTreeView(e);i&&(i.badge=t)}$resolveDropFileData(e,t,i){const n=this._dndControllers.get(e);if(!n)throw new Error("Unknown tree");return n.resolveDropFileData(t,i)}async $disposeTree(e){const t=this.getTreeView(e);t&&(t.dataProvider=void 0),this._dataProviders.deleteAndDispose(e)}async reveal(e,t,i,n,o){o=o||{select:!1,focus:!1};const r=up(o.select)?!1:o.select,a=up(o.focus)?!1:o.focus;let c=Math.min(ec(o.expand)?o.expand:o.expand===!0?1:0,3);t.isEmpty()&&await e.refresh();for(const l of n){const u=t.getItem(l.handle);u&&await e.expand(u)}const d=t.getItem(i.handle);if(d){await e.reveal(d),r&&e.setSelection([d]),a===!1?e.setFocus():a&&e.setFocus(d);let l=[d];for(;l.length>0&&c>0;c--)await e.expand(l),l=l.reduce((u,g)=>{const m=t.getItem(g.handle);return m&&m.children&&m.children.length&&u.push(...m.children),u},[])}}registerListeners(e,t,i){i.add(t.onDidExpandItem(n=>this._proxy.$setExpanded(e,n.handle,!0))),i.add(t.onDidCollapseItem(n=>this._proxy.$setExpanded(e,n.handle,!1))),i.add(t.onDidChangeSelectionAndFocus(n=>this._proxy.$setSelectionAndFocus(e,n.selection.map(({handle:o})=>o),n.focus.handle))),i.add(t.onDidChangeVisibility(n=>this._proxy.$setVisible(e,n))),i.add(t.onDidChangeCheckboxState(n=>{this._proxy.$changeCheckboxState(e,n.map(o=>({treeItemHandle:o.handle,newState:o.checkbox?.isChecked??!1})))}))}getTreeView(e){const t=Ke.as(qp.ViewsRegistry).getView(e);return t?t.treeView:null}dispose(){for(const e of this._dataProviders){const t=this.getTreeView(e[0]);t&&(t.dataProvider=void 0)}this._dataProviders.dispose(),this._dndControllers.clear(),super.dispose()}};Eee=f([ht(qe.MainThreadTreeViews),p(1,io),p(2,Dt),p(3,cn),p(4,Re)],Eee);class rWe{constructor(e,t,i,n,o){this.treeViewId=e,this.dropMimeTypes=t,this.dragMimeTypes=i,this.hasWillDrop=n,this._proxy=o,this.dataTransfersCache=new n5}async handleDrop(e,t,i,n,o,r){const a=this.dataTransfersCache.add(e);try{const c=await Fy.fromList(e);return i.isCancellationRequested?void 0:await this._proxy.$handleDrop(this.treeViewId,a.id,c,t?.handle,i,n,o,r)}finally{a.dispose()}}async handleDrag(e,t,i){if(!this.hasWillDrop)return;const n=await this._proxy.$handleDrag(this.treeViewId,e,t,i);if(!n)return;const o=new JI;return n.items.forEach(([r,a])=>{o.replace(r,Xw(a.asString))}),o}resolveDropFileData(e,t){return this.dataTransfersCache.resolveFileData(e,t)}}class aWe{constructor(e,t,i){this.treeViewId=e,this._proxy=t,this.notificationService=i,this.itemsMap=new Map,this.hasResolve=this._proxy.$hasResolve(this.treeViewId)}async getChildren(e){return(await this.getChildrenBatch(e?[e]:void 0))?.[0]}getChildrenBatch(e){return e||this.itemsMap.clear(),this._proxy.$getChildren(this.treeViewId,e?e.map(t=>t.handle):void 0).then(t=>{const i=this.convertTransferChildren(e??[],t);return this.postGetChildren(i)},t=>(wAe.is(t)||this.notificationService.error(t),[]))}convertTransferChildren(e,t){const i=Array(e.length);if(t)for(const n of t){const o=n[0];i[o]=n.slice(1)}return i}getItemsToRefresh(e){const t=[],i=[];if(e)for(const n of Object.keys(e)){const o=this.getItem(n);if(o){const r=e[n];if(o.checkbox?.isChecked!==r.checkbox?.isChecked&&i.push(o),this.updateTreeItem(o,r),n===r.handle)t.push(o);else{this.itemsMap.delete(n),this.itemsMap.set(o.handle,o);const a=r.parentHandle?this.itemsMap.get(r.parentHandle):null;a&&t.push(a)}}}return{items:t,checkboxes:i}}getItem(e){return this.itemsMap.get(e)}isEmpty(){return this.itemsMap.size===0}async postGetChildren(e){if(e===void 0)return;const t=[],i=await this.hasResolve;if(e)for(const n of e){const o=[];if(t.push(o),!!n)for(const r of n){const a=new C1(r,i?c=>this._proxy.$resolve(this.treeViewId,r.handle,c):void 0);this.itemsMap.set(r.handle,a),o.push(a)}}return t}updateTreeItem(e,t){if(t.children=t.children?t.children:void 0,e){const i=iI([...Object.keys(e instanceof C1?e.asTreeItem():e),...Object.keys(t)]);for(const n of i)e[n]=t[n];e instanceof C1&&e.resetResolve()}}}let xee=class extends F{constructor(e,t){super(),this.downloadService=t}$download(e,t){return this.downloadService.download(R.revive(e),R.revive(t))}};xee=f([ht(qe.MainThreadDownloadService),p(1,ene)],xee);class cWe{constructor(e,t,i,n){this.proxy=e,this.handle=t,this.extensionId=i,this.extensionDisplayName=n}async handleURL(e,t){return vs.equals(this.extensionId,e.authority)?(await this.proxy.$handleExternalUri(this.handle,e),!0):!1}}let Iee=class extends F{constructor(e,t,i,n){super(),this.urlService=i,this.extensionUrlHandler=n,this.handlers=new Map,this.proxy=e.getProxy(Ze.ExtHostUrls)}async $registerUriHandler(e,t,i){const n=new cWe(this.proxy,e,t,i),o=this.urlService.registerHandler(n);this.handlers.set(e,{extensionId:t,disposable:o}),this.extensionUrlHandler.registerExtensionHandler(t,n)}async $unregisterUriHandler(e){const t=this.handlers.get(e);if(!t)return;const{extensionId:i,disposable:n}=t;this.extensionUrlHandler.unregisterExtensionHandler(i),this.handlers.delete(e),n.dispose()}async $createAppUri(e){return this.urlService.create(e)}dispose(){super.dispose(),this.handlers.forEach(({disposable:e})=>e.dispose()),this.handlers.clear()}};Iee=f([ht(qe.MainThreadUrls),p(1,Az),p(2,$M),p(3,Zre)],Iee);const Uue="default",dWe="workbench.externalUriOpeners",P$={type:"string",enum:[]},Dee="\n- `https://microsoft.com`: Matches this specific domain using https\n- `https://microsoft.com:8080`: Matches this specific domain on this port using https\n- `https://microsoft.com:*`: Matches this specific domain on any port using https\n- `https://microsoft.com/foo`: Matches `https://microsoft.com/foo` and `https://microsoft.com/foo/bar`, but not `https://microsoft.com/foobar` or `https://microsoft.com/bar`\n- `https://*.microsoft.com`: Match all domains ending in `microsoft.com` using https\n- `microsoft.com`: Match this specific domain using either http or https\n- `*.microsoft.com`: Match all domains ending in `microsoft.com` using either http or https\n- `http://192.168.0.1`: Matches this specific IP using http\n- `http://192.168.0.*`: Matches all IP's with this prefix using http\n- `*`: Match all domains using either http or https",lWe={...vN,properties:{[dWe]:{type:"object",markdownDescription:h(6805,"Configure the opener to use for external URIs (http, https)."),defaultSnippets:[{body:{"example.com":"$1"}}],additionalProperties:{anyOf:[{type:"string",markdownDescription:h(6806,`Map URI pattern to an opener id.
Example patterns: 
{0}`,Dee)},{type:"string",markdownDescription:h(6806,`Map URI pattern to an opener id.
Example patterns: 
{0}`,Dee),enum:[Uue],enumDescriptions:[h(6807,"Open using VS Code's standard opener.")]},P$]}}}};function hWe(s,e){P$.enum=s,P$.enumDescriptions=e,Ke.as(Js.Configuration).notifyConfigurationSchemaUpdated(lWe)}var L$;let M$=class extends F{static{L$=this}static{this.STORAGE_ID="externalUriOpeners"}constructor(e,t){super(),this._extensionService=t,this._openers=new Map,this._memento=new bw(L$.STORAGE_ID,e),this._mementoObject=this._memento.getMemento(he.PROFILE,gt.MACHINE);for(const[i,n]of Object.entries(this._mementoObject||{}))this.add(i,n.extensionId,{isCurrentlyRegistered:!1});this.invalidateOpenersOnExtensionsChanged(),this._register(this._extensionService.onDidChangeExtensions(()=>this.invalidateOpenersOnExtensionsChanged())),this._register(this._extensionService.onDidChangeExtensionsStatus(()=>this.invalidateOpenersOnExtensionsChanged()))}didRegisterOpener(e,t){this.add(e,t,{isCurrentlyRegistered:!0})}add(e,t,i){const n=this._openers.get(e);if(n){n.isCurrentlyRegistered=n.isCurrentlyRegistered||i.isCurrentlyRegistered;return}const o={extensionId:t,isCurrentlyRegistered:i.isCurrentlyRegistered};this._openers.set(e,o),this._mementoObject[e]=o,this._memento.saveMemento(),this.updateSchema()}delete(e){this._openers.delete(e),delete this._mementoObject[e],this._memento.saveMemento(),this.updateSchema()}async invalidateOpenersOnExtensionsChanged(){await this._extensionService.whenInstalledExtensionsRegistered();const e=this._extensionService.extensions;for(const[t,i]of this._openers){const n=e.find(o=>o.identifier.value===i.extensionId);n?this._extensionService.canRemoveExtension(n)||i.isCurrentlyRegistered||this.delete(t):this.delete(t)}}updateSchema(){const e=[],t=[];for(const[i,n]of this._openers)e.push(i),t.push(n.extensionId);hWe(e,t)}};M$=L$=f([p(0,it),p(1,cn)],M$);let kee=class extends F{constructor(e,t,i,n,o,r){super(),this.extensionService=n,this.openerService=o,this.notificationService=r,this._registeredOpeners=new Map,this.proxy=e.getProxy(Ze.ExtHostUriOpeners),this._register(i.registerExternalOpenerProvider(this)),this._contributedExternalUriOpenersStore=this._register(new M$(t,n))}async*getOpeners(e){if(!(e.scheme!==ae.http&&e.scheme!==ae.https)){await this.extensionService.activateByEvent(`onOpenExternalUri:${e.scheme}`);for(const[t,i]of this._registeredOpeners)i.schemes.has(e.scheme)&&(yield this.createOpener(t,i))}}createOpener(e,t){return{id:e,label:t.label,canOpen:(i,n)=>this.proxy.$canOpenUri(e,i,n),openExternalUri:async(i,n,o)=>{try{await this.proxy.$openUri(e,{resolvedUri:i,sourceUri:n.sourceUri},o)}catch(r){if(!ys(r)){const a=new Xt("default",h(2439,"Open using default opener"),void 0,void 0,async()=>{await this.openerService.open(i,{allowTunneling:!1,allowContributedOpeners:Uue})});a.tooltip=i.toString(),this.notificationService.notify({severity:Fe.Error,message:h(2440,"Could not open uri with '{0}': {1}",e,r.toString()),actions:{primary:[a]}})}}return!0}}}async $registerUriOpener(e,t,i,n){if(this._registeredOpeners.has(e))throw new Error(`Opener with id '${e}' already registered`);this._registeredOpeners.set(e,{schemes:new Set(t),label:n,extensionId:i}),this._contributedExternalUriOpenersStore.didRegisterOpener(e,i.value)}async $unregisterUriOpener(e){this._registeredOpeners.delete(e),this._contributedExternalUriOpenersStore.delete(e)}dispose(){super.dispose(),this._registeredOpeners.clear()}};kee=f([ht(qe.MainThreadUriOpeners),p(1,it),p(2,Sre),p(3,cn),p(4,mi),p(5,Dt)],kee);let Tee=class{constructor(e,t,i,n){this.hostService=t,this.openerService=i,this.userActivityService=n,this.disposables=new U,this.proxy=e.getProxy(Ze.ExtHostWindow),T.latch(t.onDidChangeFocus)(this.proxy.$onDidChangeWindowFocus,this.proxy,this.disposables),n.onDidChangeIsActive(this.proxy.$onDidChangeWindowActive,this.proxy,this.disposables),this.registerNativeHandle()}dispose(){this.disposables.dispose()}registerNativeHandle(){T.latch(this.hostService.onDidChangeActiveWindow)(async e=>{const t=await this.hostService.getNativeWindowHandle(e);this.proxy.$onDidChangeActiveNativeWindowHandle(t?Zx(t):void 0)},this,this.disposables)}$getInitialState(){return Promise.resolve({isFocused:this.hostService.hasFocus,isActive:this.userActivityService.isActive})}async $openUri(e,t,i){const n=R.from(e);let o;return t&&R.parse(t).toString()===n.toString()?o=t:o=n,this.openerService.open(o,{openExternal:!0,allowTunneling:i.allowTunneling,allowContributedOpeners:i.allowContributedOpeners})}async $asExternalUri(e,t){return(await this.openerService.resolveExternalUri(R.revive(e),t)).resolved}};Tee=f([ht(qe.MainThreadWindow),p(1,Hn),p(2,mi),p(3,Zie)],Tee);var N$;let O$=N$=class extends F{static async create(e,t,i){return e.invokeFunction(async n=>{const r=await n.get(Ci).createModelReference(i);return e.createInstance(N$,t,i,r)})}constructor(e,t,i,n,o,r){super(),this.viewType=e,this._resource=t,this._model=i,this.textFileService=n,this._labelService=o,this._onDidChangeOrphaned=this._register(new M),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this._onDidChangeReadonly=this._register(new M),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this._onDidChangeDirty=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._register(i),this._textFileModel=this.textFileService.files.get(t),this._textFileModel&&(this._register(this._textFileModel.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire())),this._register(this._textFileModel.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))),this._register(this.textFileService.files.onDidChangeDirty(a=>{At(this.resource,a.resource)&&(this._onDidChangeDirty.fire(),this._onDidChangeContent.fire())})),this._register(r.onWillStop(a=>{a.veto(!0,h(5404,"An extension provided text editor for '{0}' is still open that would close otherwise.",this.name))}))}get resource(){return this._resource}get name(){return an(this._labelService.getUriLabel(this._resource))}isReadonly(){return this._model.object.isReadonly()}get backupId(){}get canHotExit(){return!0}isDirty(){return this.textFileService.isDirty(this.resource)}isOrphaned(){return!!this._textFileModel?.hasState(Fk.ORPHAN)}async revert(e){return this.textFileService.revert(this.resource,e)}saveCustomEditor(e){return this.textFileService.save(this.resource,e)}async saveCustomEditorAs(e,t,i){return!!await this.textFileService.saveAs(e,t,i)}};O$=N$=f([p(3,Ps),p(4,ui),p(5,cn)],O$);const het=new O("webviewFindWidgetVisible",!1),uet=new O("webviewFindWidgetFocused",!1),get=new O("webviewFindWidgetEnabled",!1);var Aee;(function(s){s.NotebookRenderer="notebookRenderer",s.CustomEditor="customEditor",s.WebviewView="webviewView"})(Aee||(Aee={}));function pet(s,e){return s.allowMultipleAPIAcquire===e.allowMultipleAPIAcquire&&s.allowScripts===e.allowScripts&&s.allowForms===e.allowForms&&rs(s.localResourceRoots,e.localResourceRoots,At)&&rs(s.portMapping,e.portMapping,(t,i)=>t.extensionHostPort===i.extensionHostPort&&t.webviewPort===i.webviewPort)&&uWe(s,e)}function uWe(s,e){return s.enableCommandUris===e.enableCommandUris?!0:Array.isArray(s.enableCommandUris)&&Array.isArray(e.enableCommandUris)?rs(s.enableCommandUris,e.enableCommandUris):!1}let F$=class{constructor(e,t){this._memento=new bw(e,t),this._state=this._memento.getMemento(he.APPLICATION,gt.MACHINE)}getOrigin(e,t){const i=this._getKey(e,t),n=this._state[i];if(n&&typeof n=="string")return n;const o=Pn();return this._state[i]=o,this._memento.saveMemento(),o}_getKey(e,t){return JSON.stringify({viewType:e,key:t})}};F$=f([p(1,it)],F$);let wL=class{constructor(e,t){this._store=new F$(e,t)}getOrigin(e,t){return this._store.getOrigin(e,t.value)}};wL=f([p(1,it)],wL);let SL=class extends F{constructor(e,t){super(),this.resource=e,this.fileService=t,this._onDidChangeOrphaned=this._register(new M),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this.orphaned=!1,this._onWillDispose=this._register(new M),this.onWillDispose=this._onWillDispose.event,this._register(this.fileService.onDidFilesChange(i=>this.onDidFilesChange(i)))}isOrphaned(){return this.orphaned}async onDidFilesChange(e){let t=!1,i;if(this.orphaned?e.contains(this.resource,ph.ADDED)&&(i=!1,t=!0):e.contains(this.resource,ph.DELETED)&&(i=!0,t=!0),t&&this.orphaned!==i){let n=!1;i&&(await Da(100,Ce.None),this.isDisposed()?n=!0:n=!await this.fileService.exists(this.resource)),this.orphaned!==n&&!this.isDisposed()&&this.setOrphaned(n)}}setOrphaned(e){this.orphaned!==e&&(this.orphaned=e,this._onDidChangeOrphaned.fire())}isDisposed(){return this._store.isDisposed}dispose(){this.orphaned=!1,this._onWillDispose.fire(),super.dispose()}isModified(){return this.isDirty()}};SL=f([p(1,je)],SL);var _T,_b;(function(s){s[s.Custom=0]="Custom",s[s.Text=1]="Text"})(_b||(_b={}));let W$=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.mainThreadWebview=t,this.mainThreadWebviewPanels=i,this._customEditorService=c,this._editorGroupService=d,this._editorService=l,this._instantiationService=u,this._webviewWorkbenchService=g,this._uriIdentityService=m,this._editorProviders=this._register(new ti),this._editorRenameBackups=new Map,this._webviewOriginStore=new wL("mainThreadCustomEditors.origins",o),this._proxyCustomEditors=e.getProxy(Ze.ExtHostCustomEditors),this._register(a.registerWorkingCopyProvider(v=>{const _=[];for(const w of r.workingCopies)w instanceof bb&&od(v,w.editorResource)&&_.push(w);return _})),this._register(g.registerResolver({canResolve:v=>(v instanceof Yb&&n.activateByEvent(`onCustomEditor:${v.viewType}`),!1),resolveWebview:()=>{throw new Error("not implemented")}})),this._register(a.onWillRunWorkingCopyFileOperation(async v=>this.onWillRunWorkingCopyFileOperation(v)))}$registerTextEditorProvider(e,t,i,n,o){this.registerEditorProvider(_b.Text,dL(e),t,i,n,!0,o)}$registerCustomEditorProvider(e,t,i,n,o){this.registerEditorProvider(_b.Custom,dL(e),t,i,{},n,o)}registerEditorProvider(e,t,i,n,o,r,a){if(this._editorProviders.has(i))throw new Error(`Provider for ${i} already registered`);const c=new U;c.add(this._customEditorService.registerCustomEditorCapabilities(i,{supportsMultipleEditorsPerDocument:r})),c.add(this._webviewWorkbenchService.registerResolver({canResolve:d=>d instanceof Yb&&d.viewType===i,resolveWebview:async(d,l)=>{const u=Pn(),g=d.resource;d.webview.origin=this._webviewOriginStore.getOrigin(i,t.id),this.mainThreadWebviewPanels.addWebviewInput(u,d,{serializeBuffersForPostMessage:a}),d.webview.options=n,d.webview.extension=t;let m=d.backupId;d.oldResource&&!d.backupId&&(m=this._editorRenameBackups.get(d.oldResource.toString())?.backupId,this._editorRenameBackups.delete(d.oldResource.toString()));let v;try{v=await this.getOrCreateCustomEditorModel(e,g,i,{backupId:m},l)}catch(w){mt(w),d.webview.setHtml(this.mainThreadWebview.getWebviewResolvedFailedContent(i));return}if(l.isCancellationRequested){v.dispose();return}const _=d.webview.onDidDispose(()=>{if(_.dispose(),v.object.isDirty()){const w=v.object.onDidChangeDirty(()=>{v.object.isDirty()||(w.dispose(),v.dispose())});return}v.dispose()});o.supportsMove&&d.onMove(async w=>{const C=v;v=await this.getOrCreateCustomEditorModel(e,w,i,{},Ce.None),this._proxyCustomEditors.$onMoveCustomEditor(u,w,i),C.dispose()});try{await this._proxyCustomEditors.$resolveCustomEditor(this._uriIdentityService.asCanonicalUri(g),u,i,{title:d.getTitle(),contentOptions:d.webview.contentOptions,options:d.webview.options,active:d===this._editorService.activeEditor},Qp(this._editorGroupService,d.group||0),l)}catch(w){mt(w),d.webview.setHtml(this.mainThreadWebview.getWebviewResolvedFailedContent(i)),v.dispose();return}}})),this._editorProviders.set(i,c)}$unregisterEditorProvider(e){if(!this._editorProviders.has(e))throw new Error(`No provider for ${e} registered`);this._editorProviders.deleteAndDispose(e),this._customEditorService.models.disposeAllModelsForView(e)}async getOrCreateCustomEditorModel(e,t,i,n,o){const r=this._customEditorService.models.tryRetain(t,i);if(r)return r;switch(e){case _b.Text:{const a=O$.create(this._instantiationService,i,t);return this._customEditorService.models.add(t,i,a)}case _b.Custom:{const a=bb.create(this._instantiationService,this._proxyCustomEditors,i,t,n,()=>Array.from(this.mainThreadWebviewPanels.webviewInputs).filter(c=>c instanceof Yb&&At(c.resource,t)),o);return this._customEditorService.models.add(t,i,a)}}}async $onDidEdit(e,t,i,n){(await this.getCustomEditorModel(e,t)).pushEdit(i,n)}async $onContentChange(e,t){(await this.getCustomEditorModel(e,t)).changeContent()}async getCustomEditorModel(e,t){const i=R.revive(e),n=await this._customEditorService.models.get(i,t);if(!n||!(n instanceof bb))throw new Error("Could not find model for webview editor");return n}async onWillRunWorkingCopyFileOperation(e){e.operation===fa.MOVE&&e.waitUntil((async()=>{const t=[];for(const i of e.files)i.source&&t.push(...await this._customEditorService.models.getAllModels(i.source));for(const i of t)if(i instanceof bb&&i.isDirty()){const n=await i.backup(Ce.None);n.meta&&this._editorRenameBackups.set(i.editorResource.toString(),n.meta)}})())}};W$=f([p(3,cn),p(4,it),p(5,lg),p(6,dg),p(7,Lq),p(8,xe),p(9,de),p(10,Z),p(11,DI),p(12,nn)],W$);var ru;(function(s){let e;(function(i){i[i.Allowed=0]="Allowed",i[i.NotAllowed=1]="NotAllowed",i[i.Pending=2]="Pending"})(e=s.Type||(s.Type={})),s.Allowed=Object.freeze({type:e.Allowed}),s.NotAllowed=Object.freeze({type:e.NotAllowed});class t{constructor(n){this.operation=n,this.type=e.Pending}}s.Pending=t})(ru||(ru={}));let bb=_T=class extends SL{static async create(e,t,i,n,o,r,a){const c=r();let d;c.length!==0&&(d=c[0].untitledDocumentData);const{editable:l}=await t.$createCustomDocument(n,i,o.backupId,d,a);return e.createInstance(_T,t,i,n,!!o.backupId,l,!!d,r)}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_){super(_T.toWorkingCopyResource(t,i),d),this._proxy=e,this._viewType=t,this._editorResource=i,this._editable=o,this._getEditors=a,this._fileDialogService=c,this._labelService=l,this._undoService=u,this._environmentService=g,this._pathService=v,this._fromBackup=!1,this._hotExitState=ru.Allowed,this._currentEditIndex=-1,this._savePoint=-1,this._edits=[],this._isDirtyFromContentChange=!1,this.typeId=vCe,this._onDidChangeDirty=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidSave=this._register(new M),this.onDidSave=this._onDidSave.event,this.onDidChangeReadonly=T.None,this._fromBackup=n,o&&(this._register(m.registerWorkingCopy(this)),this._register(_.onWillStop(w=>{w.veto(!0,h(2393,"An extension provided editor for '{0}' is still open that would close otherwise.",this.name))}))),r&&(this._isDirtyFromContentChange=!0)}get editorResource(){return this._editorResource}dispose(){this._editable&&this._undoService.removeElements(this._editorResource),this._proxy.$disposeCustomDocument(this._editorResource,this._viewType),super.dispose()}static toWorkingCopyResource(e,t){const i=e.replace(/[^a-z0-9\-_]/gi,"-"),n=`/${AE(t.with({query:null,fragment:null}).toString(!0))}`;return R.from({scheme:ae.vscodeCustomEditor,authority:i,path:n,query:JSON.stringify(t.toJSON())})}get name(){return an(this._labelService.getUriLabel(this._editorResource))}get capabilities(){return this.isUntitled()?WE.Untitled:WE.None}isDirty(){return this._isDirtyFromContentChange?!0:this._edits.length>0?this._savePoint!==this._currentEditIndex:this._fromBackup}isUntitled(){return this._editorResource.scheme===ae.untitled}isReadonly(){return!this._editable}get viewType(){return this._viewType}get backupId(){return this._backupId}pushEdit(e,t){if(!this._editable)throw new Error("Document is not editable");this.change(()=>{this.spliceEdits(e),this._currentEditIndex=this._edits.length-1}),this._undoService.pushElement({type:Yz.Resource,resource:this._editorResource,label:t??h(2394,"Edit"),code:"undoredo.customEditorEdit",undo:()=>this.undo(),redo:()=>this.redo()})}changeContent(){this.change(()=>{this._isDirtyFromContentChange=!0})}async undo(){if(!this._editable||this._currentEditIndex<0)return;const e=this._edits[this._currentEditIndex];this.change(()=>{--this._currentEditIndex}),await this._proxy.$undo(this._editorResource,this.viewType,e,this.isDirty())}async redo(){if(!this._editable||this._currentEditIndex>=this._edits.length-1)return;const e=this._edits[this._currentEditIndex+1];this.change(()=>{++this._currentEditIndex}),await this._proxy.$redo(this._editorResource,this.viewType,e,this.isDirty())}spliceEdits(e){const t=this._currentEditIndex+1,i=this._edits.length-this._currentEditIndex,n=typeof e=="number"?this._edits.splice(t,i,e):this._edits.splice(t,i);n.length&&this._proxy.$disposeEdits(this._editorResource,this._viewType,n)}change(e){const t=this.isDirty();e(),this._onDidChangeContent.fire(),this.isDirty()!==t&&this._onDidChangeDirty.fire()}async revert(e){this._editable&&(this._currentEditIndex===this._savePoint&&!this._isDirtyFromContentChange&&!this._fromBackup||(e?.soft||this._proxy.$revert(this._editorResource,this.viewType,Ce.None),this.change(()=>{this._isDirtyFromContentChange=!1,this._fromBackup=!1,this._currentEditIndex=this._savePoint,this.spliceEdits()})))}async save(e){const t=!!await this.saveCustomEditor(e);return t&&this._onDidSave.fire({reason:e?.reason,source:e?.source}),t}async saveCustomEditor(e){if(!this._editable)return;if(this.isUntitled()){const i=await this.suggestUntitledSavePath(e);return i?(await this.saveCustomEditorAs(this._editorResource,i,e),i):void 0}const t=Tn(i=>this._proxy.$onSave(this._editorResource,this.viewType,i));this._ongoingSave?.cancel(),this._ongoingSave=t;try{await t,this._ongoingSave===t&&this.change(()=>{this._isDirtyFromContentChange=!1,this._savePoint=this._currentEditIndex,this._fromBackup=!1})}finally{this._ongoingSave===t&&(this._ongoingSave=void 0)}return this._editorResource}suggestUntitledSavePath(e){if(!this.isUntitled())throw new Error("Resource is not untitled");const t=this._environmentService.remoteAuthority,i=Wz(this._editorResource,t,this._pathService.defaultUriScheme);return this._fileDialogService.pickFileToSave(i,e?.availableFileSystems)}async saveCustomEditorAs(e,t,i){return this._editable?(await Tn(n=>this._proxy.$onSaveAs(this._editorResource,this.viewType,t,n)),this.change(()=>{this._savePoint=this._currentEditIndex}),!0):(await this.fileService.copy(e,t,!1),!0)}get canHotExit(){return typeof this._backupId=="string"&&this._hotExitState.type===ru.Type.Allowed}async backup(e){const t=this._getEditors();if(!t.length)throw new Error("No editors found for resource, cannot back up");const i=t[0],o={meta:{viewType:this.viewType,editorResource:this._editorResource,backupId:"",extension:i.extension?{id:i.extension.id.value,location:i.extension.location}:void 0,webview:{origin:i.webview.origin,options:i.webview.options,state:i.webview.state}}};if(!this._editable)return o;this._hotExitState.type===ru.Type.Pending&&this._hotExitState.operation.cancel();const r=new ru.Pending(Tn(c=>this._proxy.$backup(this._editorResource.toJSON(),this.viewType,c)));this._hotExitState=r,e.onCancellationRequested(()=>{r.operation.cancel()});let a="";try{const c=await r.operation;this._hotExitState===r&&(this._hotExitState=ru.Allowed,o.meta.backupId=c,this._backupId=c)}catch(c){if(ys(c))throw c;this._hotExitState===r&&(this._hotExitState=ru.NotAllowed),c.message&&(a=c.message)}if(this._hotExitState===ru.Allowed)return o;throw new Error(`Cannot backup in this state: ${a}`)}};bb=_T=f([p(7,to),p(8,je),p(9,ui),p(10,HM),p(11,wn),p(12,lg),p(13,_c),p(14,cn)],bb);class gWe{constructor(){this._handlesToInputs=new Map,this._inputsToHandles=new Map}add(e,t){this._handlesToInputs.set(e,t),this._inputsToHandles.set(t,e)}getHandleForInput(e){return this._inputsToHandles.get(e)}getInputForHandle(e){return this._handlesToInputs.get(e)}delete(e){const t=this.getInputForHandle(e);this._handlesToInputs.delete(e),t&&this._inputsToHandles.delete(t)}get size(){return this._handlesToInputs.size}[Symbol.iterator](){return this._handlesToInputs.values()}}class pWe{constructor(e){this.prefix=e}fromExternal(e){return this.prefix+e}toExternal(e){return e.startsWith(this.prefix)?e.substr(this.prefix.length):void 0}}let B$=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this._mainThreadWebviews=t,this._configurationService=i,this._editorGroupService=n,this._editorService=o,this._webviewWorkbenchService=c,this.webviewPanelViewType=new pWe("mainThreadWebview-"),this._webviewInputs=new gWe,this._revivers=this._register(new ti),this.webviewOriginStore=new wL("mainThreadWebviewPanel.origins",a),this._proxy=e.getProxy(Ze.ExtHostWebviewPanels),this._register(T.any(o.onDidActiveEditorChange,o.onDidVisibleEditorsChange,n.onDidAddGroup,n.onDidRemoveGroup,n.onDidMoveGroup)(()=>{this.updateWebviewViewStates(this._editorService.activeEditor)})),this._register(c.onDidChangeActiveWebviewEditor(d=>{this.updateWebviewViewStates(d)})),this._register(c.registerResolver({canResolve:d=>{const l=this.webviewPanelViewType.toExternal(d.viewType);return typeof l=="string"&&r.activateByEvent(`onWebviewPanel:${l}`),!1},resolveWebview:()=>{throw new Error("not implemented")}}))}get webviewInputs(){return this._webviewInputs}addWebviewInput(e,t,i){this._webviewInputs.add(e,t),this._mainThreadWebviews.addWebview(e,t.webview,i);const n=t.webview.onDidDispose(()=>{n.dispose(),this._proxy.$onDidDisposeWebviewPanel(e).finally(()=>{this._webviewInputs.delete(e)})})}$createWebviewPanel(e,t,i,n,o){const r=this.getTargetGroupFromShowOptions(o),a=o?{preserveFocus:!!o.preserveFocus,group:r}:{},c=dL(e),d=this.webviewOriginStore.getOrigin(i,c.id),l=this._webviewWorkbenchService.openWebview({origin:d,providedViewType:i,title:n.title,options:mWe(n.panelOptions),contentOptions:lL(n.webviewOptions),extension:c},this.webviewPanelViewType.fromExternal(i),n.title,a);this.addWebviewInput(t,l,{serializeBuffersForPostMessage:n.serializeBuffersForPostMessage})}$disposeWebview(e){const t=this.tryGetWebviewInput(e);t&&t.dispose()}$setTitle(e,t){this.tryGetWebviewInput(e)?.setName(t)}$setIconPath(e,t){const i=this.tryGetWebviewInput(e);i&&(i.iconPath=fWe(t))}$reveal(e,t){const i=this.tryGetWebviewInput(e);if(!i||i.isDisposed())return;const n=this.getTargetGroupFromShowOptions(t);this._webviewWorkbenchService.revealWebview(i,n,!!t.preserveFocus)}getTargetGroupFromShowOptions(e){if(typeof e.viewColumn>"u"||e.viewColumn===ol||this._editorGroupService.count===1&&this._editorGroupService.activeGroup.isEmpty)return ol;if(e.viewColumn===Rr)return Rr;if(e.viewColumn>=0){const t=this._editorGroupService.getGroups(Jo.GRID_APPEARANCE)[e.viewColumn];if(t)return t.id;const i=this._editorGroupService.findGroup({location:Za.LAST});if(i){const n=zv(this._configurationService);return this._editorGroupService.addGroup(i,n)}}return ol}$registerSerializer(e,t){if(this._revivers.has(e))throw new Error(`Reviver for ${e} already registered`);this._revivers.set(e,this._webviewWorkbenchService.registerResolver({canResolve:i=>i.viewType===this.webviewPanelViewType.fromExternal(e),resolveWebview:async i=>{const n=this.webviewPanelViewType.toExternal(i.viewType);if(!n){i.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(i.viewType));return}const o=Pn();this.addWebviewInput(o,i,t);let r;if(i.webview.state)try{r=JSON.parse(i.webview.state)}catch(a){console.error("Could not load webview state",a,i.webview.state)}try{await this._proxy.$deserializeWebviewPanel(o,n,{title:i.getTitle(),state:r,panelOptions:i.webview.options,webviewOptions:i.webview.contentOptions,active:i===this._editorService.activeEditor},Qp(this._editorGroupService,i.group||0))}catch(a){mt(a),i.webview.setHtml(this._mainThreadWebviews.getWebviewResolvedFailedContent(n))}}}))}$unregisterSerializer(e){if(!this._revivers.has(e))throw new Error(`No reviver for ${e} registered`);this._revivers.deleteAndDispose(e)}updateWebviewViewStates(e){if(!this._webviewInputs.size)return;const t={},i=(n,o,r)=>{if(!(r instanceof pr))return;r.updateGroup(n.id);const a=this._webviewInputs.getHandleForInput(r);a&&(t[a]={visible:o===n.activeEditor,active:r===e,position:Qp(this._editorGroupService,n.id)})};for(const n of this._editorGroupService.groups)for(const o of n.editors)o instanceof go?(i(n,o,o.primary),i(n,o,o.secondary)):i(n,o,o);Object.keys(t).length&&this._proxy.$onDidChangeWebviewPanelViewStates(t)}tryGetWebviewInput(e){return this._webviewInputs.getInputForHandle(e)}};B$=f([p(2,ne),p(3,xe),p(4,de),p(5,cn),p(6,it),p(7,DI)],B$);function fWe(s){if(s)return{light:R.revive(s.light),dark:R.revive(s.dark)}}function mWe(s){return{enableFindWidget:s.enableFindWidget,retainContextWhenHidden:s.retainContextWhenHidden}}let V$=class extends F{constructor(e,t,i,n){super(),this.mainThreadWebviews=t,this._telemetryService=i,this._webviewViewService=n,this._webviewViews=this._register(new ti),this._webviewViewProviders=this._register(new ti),this._proxy=e.getProxy(Ze.ExtHostWebviewViews)}$setWebviewViewTitle(e,t){const i=this.getWebviewView(e);i.title=t}$setWebviewViewDescription(e,t){const i=this.getWebviewView(e);i.description=t}$setWebviewViewBadge(e,t){const i=this.getWebviewView(e);i.badge=t}$show(e,t){this.getWebviewView(e).show(t)}$registerWebviewViewProvider(e,t,i){if(this._webviewViewProviders.has(t))throw new Error(`View provider for ${t} already registered`);const n=dL(e),o=this._webviewViewService.register(t,{resolve:async(r,a)=>{const c=Pn();this._webviewViews.set(c,r),this.mainThreadWebviews.addWebview(c,r.webview,{serializeBuffersForPostMessage:i.serializeBuffersForPostMessage});let d;if(r.webview.state)try{d=JSON.parse(r.webview.state)}catch(u){console.error("Could not load webview state",u,r.webview.state)}r.webview.extension=n,i&&(r.webview.options=i);const l=new U;l.add(r.onDidChangeVisibility(u=>{this._proxy.$onDidChangeWebviewViewVisibility(c,u)})),l.add(r.onDispose(()=>{this._proxy.$disposeWebviewView(c),this._webviewViews.deleteAndDispose(c),l.dispose()})),this._telemetryService.publicLog2("webviews:createWebviewView",{extensionId:n.id.value,id:t});try{await this._proxy.$resolveWebviewView(c,t,r.title,d,a)}catch(u){mt(u),r.webview.setHtml(this.mainThreadWebviews.getWebviewResolvedFailedContent(t))}}});this._webviewViewProviders.set(t,o)}$unregisterWebviewViewProvider(e){if(!this._webviewViewProviders.has(e))throw new Error(`No view provider for ${e} registered`);this._webviewViewProviders.deleteAndDispose(e)}getWebviewView(e){const t=this._webviewViews.get(e);if(!t)throw new Error("unknown webview view");return t}};V$=f([p(2,ai),p(3,qre)],V$);let Ree=class extends F{constructor(e,t){super();const i=this._register(t.createInstance(X2,e));e.set(qe.MainThreadWebviews,i);const n=this._register(t.createInstance(B$,e,i));e.set(qe.MainThreadWebviewPanels,n);const o=this._register(t.createInstance(W$,e,i,n));e.set(qe.MainThreadCustomEditors,o);const r=this._register(t.createInstance(V$,e,i));e.set(qe.MainThreadWebviewViews,r)}};Ree=f([c_,p(1,Z)],Ree);let Pee=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w){this._searchService=t,this._contextService=i,this._editSessionIdentityService=n,this._canonicalUriService=o,this._editorService=r,this._workspaceEditingService=a,this._notificationService=c,this._requestService=d,this._instantiationService=l,this._labelService=u,this._environmentService=g,this._workspaceTrustManagementService=v,this._workspaceTrustRequestService=_,this._textFileService=w,this._toDispose=new U,this._activeCancelTokens=Object.create(null),this.registeredEditSessionProviders=new Map,this.registeredCanonicalUriProviders=new Map,this._queryBuilder=this._instantiationService.createInstance(TR),this._proxy=e.getProxy(Ze.ExtHostWorkspace);const C=this._contextService.getWorkspace();C.configuration&&!ca&&!m.hasProvider(C.configuration)?this._proxy.$initializeWorkspace(this.getWorkspaceData(C),this.isWorkspaceTrusted()):this._contextService.getCompleteWorkspace().then(k=>this._proxy.$initializeWorkspace(this.getWorkspaceData(k),this.isWorkspaceTrusted())),this._contextService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspace,this,this._toDispose),this._contextService.onDidChangeWorkbenchState(this._onDidChangeWorkspace,this,this._toDispose),this._workspaceTrustManagementService.onDidChangeTrust(this._onDidGrantWorkspaceTrust,this,this._toDispose)}dispose(){this._toDispose.dispose();for(const e in this._activeCancelTokens)this._activeCancelTokens[e].cancel()}$updateWorkspaceFolders(e,t,i,n){const o=n.map(r=>({uri:R.revive(r.uri),name:r.name}));return this._notificationService.status(this.getStatusMessage(e,o.length,i),{hideAfter:10*1e3}),this._workspaceEditingService.updateFolders(t,i,o,!0)}getStatusMessage(e,t,i){let n;const o=t>0,r=i>0;return o&&!r?t===1?n=h(2442,"Extension '{0}' added 1 folder to the workspace",e):n=h(2443,"Extension '{0}' added {1} folders to the workspace",e,t):r&&!o?i===1?n=h(2444,"Extension '{0}' removed 1 folder from the workspace",e):n=h(2445,"Extension '{0}' removed {1} folders from the workspace",e,i):n=h(2446,"Extension '{0}' changed folders of the workspace",e),n}_onDidChangeWorkspace(){this._proxy.$acceptWorkspaceData(this.getWorkspaceData(this._contextService.getWorkspace()))}getWorkspaceData(e){return this._contextService.getWorkbenchState()===Zo.EMPTY?null:{configuration:e.configuration||void 0,isUntitled:e.configuration?kbe(e.configuration,this._environmentService):!1,folders:e.folders,id:e.id,name:this._labelService.getWorkspaceLabel(e),transient:e.transient}}$startFileSearch(e,t,i){const n=R.revive(e),o=this._contextService.getWorkspace(),r=this._queryBuilder.file(n?[n]:o.folders,gn(t));return this._searchService.fileSearch(r,i).then(a=>a.results.map(c=>c.resource),a=>ys(a)?null:Promise.reject(a))}$startTextSearch(e,t,i,n,o){const r=R.revive(t),a=this._contextService.getWorkspace(),c=r?[r]:a.folders.map(g=>g.uri),d=this._queryBuilder.text(e,c,gn(i));d._reason="startTextSearch";const l=g=>{g.results&&this._proxy.$handleTextSearchResult(g,n)};return this._searchService.textSearch(d,o,l).then(g=>({limitHit:g.limitHit}),g=>ys(g)?null:Promise.reject(g))}$checkExists(e,t,i){return this._instantiationService.invokeFunction(n=>Nce(n,e,t,i))}async $save(e,t){const i=R.revive(e),n=[...this._editorService.findEditors(i,{supportSideBySide:qt.PRIMARY})],o=await this._editorService.save(n,{reason:gi.EXPLICIT,saveAs:t.saveAs,force:!t.saveAs});return this._saveResultToUris(o).at(0)}_saveResultToUris(e){return e.success?$t(e.editors.map(t=>Di.getCanonicalUri(t,{supportSideBySide:qt.PRIMARY}))):[]}$saveAll(e){return this._editorService.saveAll({includeUntitled:e}).then(t=>t.success)}$resolveProxy(e){return this._requestService.resolveProxy(e)}$lookupAuthorization(e){return this._requestService.lookupAuthorization(e)}$lookupKerberosAuthorization(e){return this._requestService.lookupKerberosAuthorization(e)}$loadCertificates(){return this._requestService.loadCertificates()}$requestWorkspaceTrust(e){return this._workspaceTrustRequestService.requestWorkspaceTrust(e)}isWorkspaceTrusted(){return this._workspaceTrustManagementService.isWorkspaceTrusted()}_onDidGrantWorkspaceTrust(){this._proxy.$onDidGrantWorkspaceTrust()}$registerEditSessionIdentityProvider(e,t){const i=this._editSessionIdentityService.registerEditSessionIdentityProvider({scheme:t,getEditSessionIdentifier:async(n,o)=>this._proxy.$getEditSessionIdentifier(n.uri,o),provideEditSessionIdentityMatch:async(n,o,r,a)=>this._proxy.$provideEditSessionIdentityMatch(n.uri,o,r,a)});this.registeredEditSessionProviders.set(e,i),this._toDispose.add(i)}$unregisterEditSessionIdentityProvider(e){this.registeredEditSessionProviders.get(e)?.dispose(),this.registeredEditSessionProviders.delete(e)}$registerCanonicalUriProvider(e,t){const i=this._canonicalUriService.registerCanonicalUriProvider({scheme:t,provideCanonicalUri:async(n,o,r)=>{const a=await this._proxy.$provideCanonicalUri(n,o,r);return a&&R.revive(a)}});this.registeredCanonicalUriProviders.set(e,i),this._toDispose.add(i)}$unregisterCanonicalUriProvider(e){this.registeredCanonicalUriProviders.get(e)?.dispose(),this.registeredCanonicalUriProviders.delete(e)}$resolveDecoding(e,t){return this._textFileService.resolveDecoding(R.revive(e),t)}$validateDetectedEncoding(e,t,i){return this._textFileService.validateDetectedEncoding(R.revive(e),t,i)}$resolveEncoding(e,t){return this._textFileService.resolveEncoding(R.revive(e),t)}};Pee=f([ht(qe.MainThreadWorkspace),p(1,kI),p(2,It),p(3,Eq),p(4,Jie),p(5,de),p(6,uc),p(7,Dt),p(8,UM),p(9,Z),p(10,ui),p(11,Hs),p(12,je),p(13,Lv),p(14,Qie),p(15,Ps)],Pee);const vWe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let Vc=class{constructor(e,t,i,n,o){this.uniqueOwner=e,this.owner=t,this.resource=i,this.comment=n,this.thread=o,this.isRoot=!1,this.replies=[],this.threadId=o.threadId,this.range=o.range,this.threadState=o.state,this.threadRelevance=o.applicability,this.contextValue=o.contextValue,this.controllerHandle=o.controllerHandle,this.threadHandle=o.commentThreadHandle}hasReply(){return this.replies&&this.replies.length!==0}get lastUpdatedAt(){if(this._lastUpdatedAt===void 0){let e=this.comment.timestamp||"";if(this.replies.length){const i=this.replies[this.replies.length-1].lastUpdatedAt;i>e&&(e=i)}this._lastUpdatedAt=e}return this._lastUpdatedAt}};class _r{constructor(e,t,i,n){this.uniqueOwner=e,this.owner=t,this.id=i.toString(),this.resource=i,this.commentThreads=n.filter(o=>o.comments&&o.comments.length).map(o=>_r.createCommentNode(e,t,i,o))}static createCommentNode(e,t,i,n){const{comments:o}=n,r=o.map(a=>new Vc(e,t,i,a,n));return r.length>1&&(r[0].replies=r.slice(1,r.length)),r[0].isRoot=!0,r[0]}get lastUpdatedAt(){if(this._lastUpdatedAt===void 0){let e="";if(!this.commentThreads.length)return e;for(const t of this.commentThreads){const i=t.lastUpdatedAt;i&&i>e&&(e=i)}this._lastUpdatedAt=e}return this._lastUpdatedAt}}const _0="comments";class H$ extends F{constructor(e,t,i,n){super(),this.configurationService=e,this._date=ee(i,j("span.timestamp")),this._date.style.display="none",this._useRelativeTime=this.useRelativeTimeSetting,this.hover=this._register(t.setupManagedHover(Ir("mouse"),this._date,"")),this.setTimestamp(n)}get useRelativeTimeSetting(){return this.configurationService.getValue(_0).useRelativeTime}async setTimestamp(e){(e!==this._timestamp||this.useRelativeTimeSetting!==this._useRelativeTime)&&this.updateDate(e),this._timestamp=e,this._useRelativeTime=this.useRelativeTimeSetting}updateDate(e){if(!e)this._date.textContent="",this._date.style.display="none";else if(e!==this._timestamp||this.useRelativeTimeSetting!==this._useRelativeTime){this._date.style.display="";let t,i;this.useRelativeTimeSetting?(t=this.getRelative(e),i=this.getDateString(e)):t=this.getDateString(e),this._date.textContent=t,this.hover.update(i??"")}}getRelative(e){return Tbe(e,!0,!0)}getDateString(e){return e.toLocaleString(gh)}}const U$=H("commentsView.resolvedIcon",{dark:t8,light:t8,hcDark:tt,hcLight:tt},h(5259,"Icon color for resolved comments.")),$$=H("commentsView.unresolvedIcon",{dark:i8,light:i8,hcDark:tt,hcLight:tt},h(5260,"Icon color for unresolved comments."));H("editorCommentsWidget.replyInputBackground",uae,h(5261,"Background color for comment reply input box."));const _We=H("editorCommentsWidget.resolvedBorder",{dark:U$,light:U$,hcDark:tt,hcLight:tt},h(5262,"Color of borders and arrow for resolved comments.")),a5=H("editorCommentsWidget.unresolvedBorder",{dark:$$,light:$$,hcDark:tt,hcLight:tt},h(5263,"Color of borders and arrow for unresolved comments."));H("editorCommentsWidget.rangeBackground",et(a5,.1),h(5264,"Color of background for comment ranges."));H("editorCommentsWidget.rangeActiveBackground",et(a5,.1),h(5265,"Color of background for currently selected or hovered comment range."));const bWe=new Map([[dd.Unresolved,a5],[dd.Resolved,_We]]),yWe=new Map([[dd.Unresolved,$$],[dd.Resolved,U$]]),$ue="--comment-thread-state-color",Lee="--comment-view-thread-state-color",Gue="--comment-thread-state-background-color";function zue(s,e,t){const i=s!==void 0?t.get(s):void 0;return i!==void 0?e.getColor(i):void 0}function wWe(s,e){return zue(s,e,bWe)}function SWe(s,e){return zue(s,e,yWe)}class rm{static{this._filter=Abe}static{this._messageFilter=ise}constructor(e,t,i){this.filter=e,this.showResolved=!0,this.showUnresolved=!0,e=e.trim(),this.showResolved=t,this.showUnresolved=i;const n=e.startsWith("!");this.textFilter={text:(n?nse(e,"!"):e).trim(),negate:n}}}function c5(s){return!!s.comments&&!!s.comments.length&&s.comments.some(e=>tc(e.body)?e.body.value.length>0:e.body.length>0)}class Xb extends F{get resourceCommentThreads(){return this._resourceCommentThreads}constructor(){super(),this._resourceCommentThreads=[],this.commentThreadsMap=new Map}updateResourceCommentThreads(){const e=this.commentThreadsMap.size>1;this._resourceCommentThreads=[...this.commentThreadsMap.values()].map(t=>t.resourceWithCommentThreads.map(i=>(i.ownerLabel=e?t.ownerLabel:void 0,i)).flat()).flat()}setCommentThreads(e,t,i,n){this.commentThreadsMap.set(e,{ownerLabel:i,resourceWithCommentThreads:this.groupByResource(e,t,n)}),this.updateResourceCommentThreads()}deleteCommentsByOwner(e){if(e){const t=this.commentThreadsMap.get(e);this.commentThreadsMap.set(e,{ownerLabel:t?.ownerLabel,resourceWithCommentThreads:[]})}else this.commentThreadsMap.clear();this.updateResourceCommentThreads()}updateCommentThreads(e){const{uniqueOwner:t,owner:i,ownerLabel:n,removed:o,changed:r,added:a}=e,c=this.commentThreadsMap.get(t)?.resourceWithCommentThreads||[];return o.forEach(d=>{const l=c.findIndex(m=>m.id===d.resource),u=l>=0?c[l]:void 0,g=u?.commentThreads.findIndex(m=>m.threadId===d.threadId)??0;g>=0&&u?.commentThreads.splice(g,1),u?.commentThreads.length===0&&c.splice(l,1)}),r.forEach(d=>{const l=c.findIndex(m=>m.id===d.resource),u=l>=0?c[l]:void 0;if(!u)return;const g=u.commentThreads.findIndex(m=>m.threadId===d.threadId);g>=0?u.commentThreads[g]=_r.createCommentNode(t,i,R.parse(u.id),d):d.comments&&d.comments.length&&u.commentThreads.push(_r.createCommentNode(t,i,R.parse(u.id),d))}),a.forEach(d=>{const l=c.filter(u=>u.resource.toString()===d.resource);if(l.length){const u=l[0];d.comments&&d.comments.length&&u.commentThreads.push(_r.createCommentNode(t,i,u.resource,d))}else c.push(new _r(t,i,R.parse(d.resource),[d]))}),this.commentThreadsMap.set(t,{ownerLabel:n,resourceWithCommentThreads:c}),this.updateResourceCommentThreads(),o.length>0||r.length>0||a.length>0}hasCommentThreads(){return!!this._resourceCommentThreads.length&&this._resourceCommentThreads.some(e=>e.commentThreads.length>0&&e.commentThreads.some(t=>c5(t.thread)))}getMessage(){return this._resourceCommentThreads.length?"":h(5343,"There are no comments in this workspace yet.")}groupByResource(e,t,i){const n=[],o=new Map;for(const r of GT(i,Xb._compareURIs))o.set(r[0].resource,new _r(e,t,R.parse(r[0].resource),r));return o.forEach((r,a,c)=>{n.push(r)}),n}static _compareURIs(e,t){const i=e.resource.toString(),n=t.resource.toString();return i<n?-1:i>n?1:0}}const Qn="workbench.panel.comments",CWe="Comments",G$=I(5344,"Comments");class CL{static{this.RESOURCE_ID="resource-with-comments"}static{this.COMMENT_ID="comment-node"}getHeight(e){return e instanceof Vc&&e.hasReply()?44:22}getTemplateId(e){return e instanceof _r?CL.RESOURCE_ID:e instanceof Vc?CL.COMMENT_ID:""}}class EWe{constructor(e){this.labels=e,this.templateId="resource-with-comments"}renderTemplate(e){const t=ee(e,j(".resource-container")),i=this.labels.create(t),n=ee(t,j(".separator")),o=t.appendChild(j(".owner"));return{resourceLabel:i,owner:o,separator:n}}renderElement(e,t,i,n){i.resourceLabel.setFile(e.element.resource),i.separator.innerText="",e.element.ownerLabel?(i.owner.innerText=e.element.ownerLabel,i.separator.style.display="inline"):(i.owner.innerText="",i.separator.style.display="none")}disposeTemplate(e){e.resourceLabel.dispose()}}let z$=class{constructor(e){this.menuService=e}getResourceActions(e){return{actions:this.getActions(N.CommentsViewThreadActions,e).primary}}getResourceContextActions(e){return this.getActions(N.CommentsViewThreadActions,e).secondary}setContextKeyService(e){this.contextKeyService=e}getActions(e,t){if(!this.contextKeyService)return{primary:[],secondary:[]};const i=[["commentController",t.owner],["resourceScheme",t.resource.scheme],["commentThread",t.contextValue],["canReply",t.thread.canReply]],n=this.contextKeyService.createOverlay(i),o=this.menuService.getMenuActions(e,n,{shouldForwardArgs:!0});return sse(o,"inline")}dispose(){this.contextKeyService=void 0}};z$=f([p(0,fn)],z$);let q$=class{constructor(e,t,i,n,o,r){this.actionViewItemProvider=e,this.menus=t,this.openerService=i,this.configurationService=n,this.hoverService=o,this.themeService=r,this.templateId="comment-node"}renderTemplate(e){const t=ee(e,j(".comment-thread-container")),i=ee(t,j(".comment-metadata-container")),n=ee(i,j(".comment-metadata")),o=ee(n,j(".icon")),r=ee(n,j(".user")),a=new H$(this.configurationService,this.hoverService,ee(n,j(".timestamp-container"))),c=ee(n,j(".relevance")),d=ee(n,j(".separator")),l=ee(n,j(".text")),u=ee(n,j(".range")),g=j("p");u.appendChild(g);const m={icon:o,userNames:r,timestamp:a,relevance:c,separator:d,commentPreview:l,range:g};m.separator.innerText="";const v=ee(i,j(".actions")),_=new Ar(v,{actionViewItemProvider:this.actionViewItemProvider}),w=ee(t,j(".comment-snippet-container")),C={container:w,icon:ee(w,j(".icon")),count:ee(w,j(".count")),lastReplyDetail:ee(w,j(".reply-detail")),separator:ee(w,j(".separator")),timestamp:new H$(this.configurationService,this.hoverService,ee(w,j(".timestamp-container")))};C.separator.innerText="",C.icon.classList.add(...ke.asClassNameArray(K.indent));const k=[m.timestamp,C.timestamp];return{threadMetadata:m,repliesMetadata:C,actionBar:_,disposables:k}}getCountString(e){return e>2?h(5345,"{0} replies",e-1):e===2?h(5346,"1 reply"):h(5347,"1 comment")}getRenderedComment(e,t){const i=Ez(e,{inline:!0,actionHandler:{callback:r=>Kie(this.openerService,r,e.isTrusted),disposables:t}}),n=i.element.getElementsByTagName("img");for(let r=0;r<n.length;r++){const a=n[r],c=j("");c.textContent=a.alt?h(5348,"Image: {0}",a.alt):h(5349,"Image"),a.parentNode.replaceChild(c,a)}const o=[...i.element.getElementsByTagName("h1"),...i.element.getElementsByTagName("h2"),...i.element.getElementsByTagName("h3"),...i.element.getElementsByTagName("h4"),...i.element.getElementsByTagName("h5"),...i.element.getElementsByTagName("h6")];for(const r of o){const a=document.createTextNode(r.textContent||"");r.parentNode.replaceChild(a,r)}for(;i.element.children.length>1&&i.element.firstElementChild?.tagName==="HR";)i.element.removeChild(i.element.firstElementChild);return i}getIcon(e){return e===dd.Unresolved?K.commentUnresolved:K.comment}renderElement(e,t,i,n){i.actionBar.clear();const o=e.element.replies.length+1;if(e.element.threadRelevance===ose.Outdated?(i.threadMetadata.relevance.style.display="",i.threadMetadata.relevance.innerText=h(5350,"Outdated"),i.threadMetadata.separator.style.display="none"):(i.threadMetadata.relevance.innerText="",i.threadMetadata.relevance.style.display="none",i.threadMetadata.separator.style.display=""),i.threadMetadata.icon.classList.remove(...Array.from(i.threadMetadata.icon.classList.values()).filter(d=>d.startsWith("codicon"))),i.threadMetadata.icon.classList.add(...ke.asClassNameArray(this.getIcon(e.element.threadState))),e.element.threadState!==void 0){const d=this.getCommentThreadWidgetStateColor(e.element.threadState,this.themeService.getColorTheme());i.threadMetadata.icon.style.setProperty(Lee,`${d}`),i.threadMetadata.icon.style.color=`var(${Lee})`}i.threadMetadata.userNames.textContent=e.element.comment.userName,i.threadMetadata.timestamp.setTimestamp(e.element.comment.timestamp?new Date(e.element.comment.timestamp):void 0);const r=e.element;if(i.threadMetadata.commentPreview.innerText="",i.threadMetadata.commentPreview.style.height="22px",typeof r.comment.body=="string")i.threadMetadata.commentPreview.innerText=r.comment.body;else{const d=new U;i.disposables.push(d);const l=this.getRenderedComment(r.comment.body,d);i.disposables.push(l);for(let u=l.element.children.length-1;u>=1;u--)l.element.removeChild(l.element.children[u]);i.threadMetadata.commentPreview.appendChild(l.element),i.disposables.push(this.hoverService.setupManagedHover(Ir("mouse"),i.threadMetadata.commentPreview,l.element.textContent??""))}e.element.range&&(e.element.range.startLineNumber===e.element.range.endLineNumber?i.threadMetadata.range.textContent=h(5351,"[Ln {0}]",e.element.range.startLineNumber):i.threadMetadata.range.textContent=h(5352,"[Ln {0}-{1}]",e.element.range.startLineNumber,e.element.range.endLineNumber));const a=this.menus.getResourceActions(e.element);if(i.actionBar.push(a.actions,{icon:!0,label:!1}),i.actionBar.context={commentControlHandle:e.element.controllerHandle,commentThreadHandle:e.element.threadHandle,$mid:Dn.CommentThread},!e.element.hasReply()){i.repliesMetadata.container.style.display="none";return}i.repliesMetadata.container.style.display="",i.repliesMetadata.count.textContent=this.getCountString(o);const c=e.element.replies[e.element.replies.length-1].comment;i.repliesMetadata.lastReplyDetail.textContent=h(5353,"Last reply from {0}",c.userName),i.repliesMetadata.timestamp.setTimestamp(c.timestamp?new Date(c.timestamp):void 0)}getCommentThreadWidgetStateColor(e,t){return e!==void 0?SWe(e,t):void 0}disposeTemplate(e){e.disposables.forEach(t=>t.dispose()),e.actionBar.dispose()}};q$=f([p(2,mi),p(3,ne),p(4,Ti),p(5,pt)],q$);var EL;(function(s){s[s.Resource=0]="Resource",s[s.Comment=1]="Comment"})(EL||(EL={}));class xWe{constructor(e){this.options=e}filter(e,t){return this.options.filter===""&&this.options.showResolved&&this.options.showUnresolved?um.Visible:e instanceof _r?this.filterResourceMarkers(e):this.filterCommentNode(e,t)}filterResourceMarkers(e){if(this.options.textFilter.text&&!this.options.textFilter.negate){const t=rm._filter(this.options.textFilter.text,Qe(e.resource));if(t)return{visibility:!0,data:{type:EL.Resource,uriMatches:t||[]}}}return um.Recurse}filterCommentNode(e,t){if(!(e.threadState===void 0||this.options.showResolved&&dd.Resolved===e.threadState||this.options.showUnresolved&&dd.Unresolved===e.threadState))return!1;if(!this.options.textFilter.text)return!0;const n=rm._messageFilter(this.options.textFilter.text,typeof e.comment.body=="string"?e.comment.body:e.comment.body.value)||rm._messageFilter(this.options.textFilter.text,e.comment.userName)||e.replies.map(o=>rm._messageFilter(this.options.textFilter.text,o.comment.userName)||rm._messageFilter(this.options.textFilter.text,typeof o.comment.body=="string"?o.comment.body:o.comment.body.value)).filter(o=>!!o).flat();return n.length&&!this.options.textFilter.negate?{visibility:!0,data:{type:EL.Comment,textMatches:n}}:n.length&&this.options.textFilter.negate&&t===um.Recurse?!1:n.length===0&&this.options.textFilter.negate&&t===um.Recurse?!0:t}}let K$=class extends Rbe{constructor(e,t,i,n,o,r,a,c,d){const l=new CL,u=mw.bind(void 0,r),g=r.createInstance(z$);g.setContextKeyService(n);const m=[r.createInstance(EWe,e),r.createInstance(q$,u,g)];super("CommentsTree",t,l,m,{accessibilityProvider:i.accessibilityProvider,identityProvider:{getId:v=>v instanceof Xb?"root":v instanceof _r?`${v.uniqueOwner}-${v.id}`:v instanceof Vc?`${v.uniqueOwner}-${v.resource.toString()}-${v.threadId}-${v.comment.uniqueIdInThread}`+(v.isRoot?"-root":""):""},expandOnlyOnTwistieClick:!0,collapseByDefault:!1,overrideStyles:i.overrideStyles,filter:i.filter,sorter:i.sorter,findWidgetEnabled:!1,multipleSelectionSupport:!1},r,n,o,a),this.contextMenuService=c,this.keybindingService=d,this.menus=g,this.disposables.add(this.onContextMenu(v=>this.commentsOnContextMenu(v)))}commentsOnContextMenu(e){const t=e.element;if(!(t instanceof Vc))return;const i=e.browserEvent;i.preventDefault(),i.stopPropagation(),this.setFocus([t]);const n=this.menus.getResourceContextActions(t);n.length&&this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>n,getActionViewItem:o=>{const r=this.keybindingService.lookupKeybinding(o.id);if(r)return new Qm(o,o,{label:!0,keybinding:r.getLabel()})},onHide:o=>{o&&this.domFocus()},getActionsContext:()=>({commentControlHandle:t.controllerHandle,commentThreadHandle:t.threadHandle,$mid:Dn.CommentThread,thread:t.thread})})}filterComments(){this.refilter()}getVisibleItemCount(){let e=0;const t=this.getNode();for(const i of t.children)for(const n of i.children)n.visible&&i.visible&&e++;return e}};K$=f([p(3,fe),p(4,Ei),p(5,Z),p(6,ne),p(7,bi),p(8,He)],K$);const d5=new O("commentsFilterFocus",!1);var cl;(function(s){s.ResourceAscending="resourceAscending",s.UpdatedAtDescending="updatedAtDescending"})(cl||(cl={}));const que=new O("commentsView.showResolvedFilter",!0),Kue=new O("commentsView.showUnResolvedFilter",!0),l5=new O("commentsView.sortBy",cl.ResourceAscending);class IWe extends F{constructor(e,t){super(),this.contextKeyService=t,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this._showUnresolved=Kue.bindTo(this.contextKeyService),this._showResolved=que.bindTo(this.contextKeyService),this._sortBy=l5.bindTo(this.contextKeyService),this._showResolved.set(e.showResolved),this._showUnresolved.set(e.showUnresolved),this._sortBy.set(e.sortBy)}get showUnresolved(){return!!this._showUnresolved.get()}set showUnresolved(e){this._showUnresolved.get()!==e&&(this._showUnresolved.set(e),this._onDidChange.fire({showUnresolved:!0}))}get showResolved(){return!!this._showResolved.get()}set showResolved(e){this._showResolved.get()!==e&&(this._showResolved.set(e),this._onDidChange.fire({showResolved:!0}))}get sortBy(){return this._sortBy.get()??cl.ResourceAscending}set sortBy(e){this._sortBy.get()!==e&&(this._sortBy.set(e),this._onDidChange.fire({sortBy:e}))}}Y(class extends p_{constructor(){super({id:"commentsFocusViewFromFilter",title:h(5368,"Focus Comments view"),keybinding:{when:d5,weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.DownArrow},viewId:Qn})}async runInView(s,e){e.focus()}});Y(class extends p_{constructor(){super({id:"commentsClearFilterText",title:h(5369,"Clear filter text"),keybinding:{when:d5,weight:W.WorkbenchContrib,primary:S.Escape},viewId:Qn})}async runInView(s,e){e.clearFilterText()}});Y(class extends p_{constructor(){super({id:"commentsFocusFilter",title:h(5370,"Focus comments filter"),keybinding:{when:ll.isEqualTo(Qn),weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyF},viewId:Qn})}async runInView(s,e){e.focusFilter()}});Y(class extends p_{constructor(){super({id:`workbench.actions.${Qn}.toggleUnResolvedComments`,title:h(5371,"Show Unresolved"),category:h(5372,"Comments"),toggled:{condition:Kue,title:h(5373,"Show Unresolved")},menu:{id:mD,group:"1_filter",when:x.equals("view",Qn),order:1},viewId:Qn})}async runInView(s,e){e.filters.showUnresolved=!e.filters.showUnresolved}});Y(class extends p_{constructor(){super({id:`workbench.actions.${Qn}.toggleResolvedComments`,title:h(5374,"Show Resolved"),category:h(5372,"Comments"),toggled:{condition:que,title:h(5375,"Show Resolved")},menu:{id:mD,group:"1_filter",when:x.equals("view",Qn),order:1},viewId:Qn})}async runInView(s,e){e.filters.showResolved=!e.filters.showResolved}});const h5=new N("submenu.filter.commentSort");ge.appendMenuItem(mD,{submenu:h5,title:h(5376,"Sort By"),group:"2_sort",icon:K.history,when:x.equals("view",Qn)});Y(class extends p_{constructor(){super({id:`workbench.actions.${Qn}.toggleSortByUpdatedAt`,title:h(5377,"Updated Time"),category:h(5372,"Comments"),icon:K.history,viewId:Qn,toggled:{condition:x.equals(l5.key,cl.UpdatedAtDescending),title:h(5378,"Updated Time")},menu:{id:h5,group:"navigation",order:1,isHiddenByDefault:!1}})}async runInView(s,e){e.filters.sortBy=cl.UpdatedAtDescending}});Y(class extends p_{constructor(){super({id:`workbench.actions.${Qn}.toggleSortByResource`,title:h(5379,"Position in File"),category:h(5372,"Comments"),icon:K.history,viewId:Qn,toggled:{condition:x.equals(l5.key,cl.ResourceAscending),title:h(5380,"Position in File")},menu:{id:h5,group:"navigation",order:0,isHiddenByDefault:!1}})}async runInView(s,e){e.filters.sortBy=cl.ResourceAscending}});const jue=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),DWe=H("editorGutter.commentRangeForeground",{dark:n8(s8,ss),light:yr(n8(s8,ss),.05),hcDark:ye.white,hcLight:ye.black},h(5266,"Editor gutter decoration color for commenting ranges. This color should be opaque.")),Yue=H("editorOverviewRuler.commentForeground",DWe,h(5267,"Editor overview ruler decoration color for resolved comments. This color should be opaque.")),kWe=H("editorOverviewRuler.commentUnresolvedForeground",Yue,h(5268,"Editor overview ruler decoration color for unresolved comments. This color should be opaque.")),TWe=H("editorGutter.commentGlyphForeground",{dark:po,light:po,hcDark:ye.black,hcLight:ye.white},h(5269,"Editor gutter decoration color for commenting glyphs."));H("editorGutter.commentUnresolvedGlyphForeground",TWe,h(5270,"Editor gutter decoration color for commenting glyphs for unresolved comment threads."));class yD extends F{static{this.description="comment-glyph-widget"}constructor(e,t){super(),this._onDidChangeLineNumber=this._register(new M),this.onDidChangeLineNumber=this._onDidChangeLineNumber.event,this._commentsOptions=this.createDecorationOptions(),this._editor=e,this._commentsDecorations=this._editor.createDecorationsCollection(),this._register(this._commentsDecorations.onDidChange(i=>{const n=this._commentsDecorations.length>0?this._commentsDecorations.getRange(0):null;n&&n.endLineNumber!==this._lineNumber&&(this._lineNumber=n.endLineNumber,this._onDidChangeLineNumber.fire(this._lineNumber))})),this._register(Ie(()=>this._commentsDecorations.clear())),this.setLineNumber(t)}createDecorationOptions(){const e=this._threadState===dd.Unresolved,t={description:yD.description,isWholeLine:!0,overviewRuler:{color:ns(e?kWe:Yue),position:il.Center},collapseOnReplaceEdit:!0,linesDecorationsClassName:`comment-range-glyph comment-thread${e?"-unresolved":""}`};return Zt.createDynamic(t)}setThreadState(e){this._threadState!==e&&(this._threadState=e,this._commentsOptions=this.createDecorationOptions(),this._updateDecorations())}_updateDecorations(){const e=[{range:{startLineNumber:this._lineNumber,startColumn:1,endLineNumber:this._lineNumber,endColumn:1},options:this._commentsOptions}];this._commentsDecorations.set(e)}setLineNumber(e){this._lineNumber=e,this._updateDecorations()}getPosition(){const e=this._commentsDecorations.length>0?this._commentsDecorations.getRange(0):null;return{position:{lineNumber:e?e.endLineNumber:this._lineNumber,column:1},preference:[Fi.EXACT]}}}var Wc;(function(s){s.Add="workbench.action.addComment",s.FocusCommentOnCurrentLine="workbench.action.focusCommentOnCurrentLine",s.NextThread="editor.action.nextCommentThreadAction",s.PreviousThread="editor.action.previousCommentThreadAction",s.NextCommentedRange="editor.action.nextCommentedRangeAction",s.PreviousCommentedRange="editor.action.previousCommentedRangeAction",s.NextRange="editor.action.nextCommentingRange",s.PreviousRange="editor.action.previousCommentingRange",s.ToggleCommenting="workbench.action.toggleCommenting",s.Submit="editor.action.submitComment",s.Hide="workbench.action.hideComment",s.CollapseAll="workbench.action.collapseAllComments",s.ExpandAll="workbench.action.expandAllComments",s.ExpandUnresolved="workbench.action.expandUnresolvedComments"})(Wc||(Wc={}));class Lx{constructor(e,t,i,n,o,r,a){this.keybindingService=e,this.contextKeyService=t,this.contextMenuService=i,this.container=n,this.actionHandler=o,this.maxActions=r,this.supportDropdowns=a,this._buttonElements=[],this._toDispose=new U,this._actions=[]}setActions(e,t=!1){this._toDispose.clear(),this._buttonElements.forEach(o=>o.remove()),this._buttonElements=[];const i=e.getActions({shouldForwardArgs:!0});let n=!t;for(const o of i){const[,r]=o;this._actions=r;for(const a of r){const c=this.supportDropdowns&&a instanceof xh?a.actions:[],d=c.length?c[0]:a;let l=this.keybindingService.lookupKeybinding(d.id,this.contextKeyService)?.getLabel();!l&&n&&(l=this.keybindingService.lookupKeybinding(Wc.Submit,this.contextKeyService)?.getLabel());const u=l?`${d.label} (${l})`:d.label,g=this.actionHandler,m=c.length?new Pbe(this.container,{contextMenuProvider:this.contextMenuService,actions:c,actionRunner:this._toDispose.add(new class extends hg{async runAction(v,_){return g(v)}}),secondary:!n,title:u,addPrimaryActionToDropdown:!1,...tA}):new zu(this.container,{secondary:!n,title:u,...tA});if(n=!1,this._buttonElements.push(m.element),this._toDispose.add(m),this._toDispose.add(m.onDidClick(()=>this.actionHandler(d))),m.enabled=d.enabled,m.label=d.label,this.maxActions!==void 0&&this._buttonElements.length>=this.maxActions){console.warn("An extension has contributed more than the allowable number of actions to a comments menu.");return}}}}triggerDefaultAction(){if(this._actions.length){const e=this._actions[0];if(e.enabled)return this.actionHandler(e)}}dispose(){this._toDispose.dispose()}}var Ja;(function(s){s.activeCursorHasCommentingRange=new O("activeCursorHasCommentingRange",!1,{description:h(5388,"Whether the position at the active cursor has a commenting range"),type:"boolean"}),s.activeCursorHasComment=new O("activeCursorHasComment",!1,{description:h(5389,"Whether the position at the active cursor has a comment"),type:"boolean"}),s.activeEditorHasCommentingRange=new O("activeEditorHasCommentingRange",!1,{description:h(5390,"Whether the active editor has a commenting range"),type:"boolean"}),s.WorkspaceHasCommenting=new O("workspaceHasCommenting",!1,{description:h(5391,"Whether the open workspace has either comments or commenting ranges."),type:"boolean"}),s.commentThreadIsEmpty=new O("commentThreadIsEmpty",!1,{type:"boolean",description:h(5392,"Set when the comment thread has no comments")}),s.commentIsEmpty=new O("commentIsEmpty",!1,{type:"boolean",description:h(5393,"Set when the comment has no input")}),s.commentContext=new O("comment",void 0,{type:"string",description:h(5394,"The context value of the comment")}),s.commentThreadContext=new O("commentThread",void 0,{type:"string",description:h(5395,"The context value of the comment thread")}),s.commentControllerContext=new O("commentController",void 0,{type:"string",description:h(5396,"The comment controller id associated with a comment thread")}),s.commentFocused=new O("commentFocused",!1,{type:"boolean",description:h(5397,"Set when the comment is focused")}),s.commentingEnabled=new O("commentingEnabled",!0,{description:h(5398,"Whether commenting functionality is enabled"),type:"boolean"})})(Ja||(Ja={}));const AWe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var bT;Ve(AWe);const Que=new O("editorDictation.inProgress",!1),Xue=I(5125,"Voice");class RWe extends Fr{constructor(){super({id:"workbench.action.editorDictation.start",title:I(5126,"Start Dictation in Editor"),category:Xue,precondition:x.and(wLe,SLe.toNegated(),V.readOnly.toNegated()),f1:!0,keybinding:{primary:E.CtrlCmd|E.Alt|S.KeyV,weight:W.WorkbenchContrib,secondary:bn?[E.Alt|S.Backquote]:void 0}})}runEditorCommand(e,t){const n=e.get(He).enableKeybindingHoldMode(this.desc.id);if(n){let o=!1;const r=setTimeout(()=>{o=!0},500);n.finally(()=>{clearTimeout(r),o&&Rh.get(t)?.stop()})}Rh.get(t)?.start()}}class Mx extends Fr{static{this.ID="workbench.action.editorDictation.stop"}constructor(){super({id:Mx.ID,title:I(5127,"Stop Dictation in Editor"),category:Xue,precondition:Que,f1:!0,keybinding:{primary:S.Escape,weight:W.WorkbenchContrib+100}})}runEditorCommand(e,t){Rh.get(t)?.stop()}}class PWe extends F{constructor(e,t){super(),this.editor=e,this.suppressMouseDown=!0,this.allowEditorOverflow=!0,this.domNode=document.createElement("div");const i=this._register(new Ar(this.domNode)),n=t.lookupKeybinding(Mx.ID)?.getLabel();i.push(Ri({id:Mx.ID,label:n?h(5128,"Stop Dictation ({0})",n):h(5129,"Stop Dictation"),class:ke.asClassName(K.micFilled),run:()=>Rh.get(e)?.stop()}),{icon:!0,label:!1,keybinding:n}),this.domNode.classList.add("editor-dictation-widget"),this.domNode.appendChild(i.domNode)}getId(){return"editorDictation"}getDomNode(){return this.domNode}getPosition(){if(!this.editor.hasModel())return null;const e=this.editor.getSelection();return{position:e.getPosition(),preference:[e.getPosition().equals(e.getStartPosition())?Fi.ABOVE:Fi.BELOW,Fi.EXACT]}}beforeRender(){const e=this.editor.getOption(L.lineHeight),t=this.editor.getLayoutInfo().contentWidth*.7;return this.domNode.style.setProperty("--vscode-editor-dictation-widget-height",`${e}px`),this.domNode.style.setProperty("--vscode-editor-dictation-widget-width",`${t}px`),null}show(){this.editor.addContentWidget(this)}layout(){this.editor.layoutContentWidget(this)}active(){this.domNode.classList.add("recording")}hide(){this.domNode.classList.remove("recording"),this.editor.removeContentWidget(this)}}let Rh=class extends F{static{bT=this}static{this.ID="editorDictation"}static get(e){return e.getContribution(bT.ID)}constructor(e,t,i,n){super(),this.editor=e,this.speechService=t,this.sessionDisposables=this._register(new Pt),this.widget=this._register(new PWe(this.editor,n)),this.editorDictationInProgress=Que.bindTo(i)}async start(){const e=new U;this.sessionDisposables.value=e,this.widget.show(),e.add(Ie(()=>this.widget.hide())),this.editorDictationInProgress.set(!0),e.add(Ie(()=>this.editorDictationInProgress.reset()));const t=this.editor.createDecorationsCollection();e.add(Ie(()=>t.clear())),e.add(this.editor.onDidChangeCursorPosition(()=>this.widget.layout()));let i,n=0;const o=(c,d)=>{i||(i=jt(this.editor.getPosition()));const l=new we(i.lineNumber,i.column+c.length);this.editor.executeEdits(bT.ID,[qi.replace(P.fromPositions(i,i.with(void 0,i.column+n)),c)],[at.fromPositions(l)]),d?t.set([{range:P.fromPositions(i,i.with(void 0,i.column+c.length)),options:{description:"editor-dictation-preview",inlineClassName:"ghost-text-decoration-preview"}}]):t.clear(),n=c.length,d||(i=void 0,n=0),this.editor.revealPositionInCenterIfOutsideViewport(l)},r=new li;e.add(Ie(()=>r.dispose(!0)));const a=await this.speechService.createSpeechToTextSession(r.token,"editor");e.add(a.onDidChange(c=>{if(!r.token.isCancellationRequested)switch(c.status){case pb.Started:this.widget.active();break;case pb.Stopped:e.dispose();break;case pb.Recognizing:{if(!c.text)return;o(c.text,!0);break}case pb.Recognized:{if(!c.text)return;o(`${c.text} `,!1);break}}}))}stop(){this.sessionDisposables.clear()}};Rh=bT=f([p(1,NN),p(2,fe),p(3,He)],Rh);Lt(Rh.ID,Rh,_t.Lazy);Y(RWe);Y(Mx);const pi=new class{constructor(){this.QuickFix=new Ut("quickfix"),this.Refactor=new Ut("refactor"),this.RefactorExtract=this.Refactor.append("extract"),this.RefactorInline=this.Refactor.append("inline"),this.RefactorMove=this.Refactor.append("move"),this.RefactorRewrite=this.Refactor.append("rewrite"),this.Notebook=new Ut("notebook"),this.Source=new Ut("source"),this.SourceOrganizeImports=this.Source.append("organizeImports"),this.SourceFixAll=this.Source.append("fixAll"),this.SurroundWith=this.Refactor.append("surround")}};var Zs;(function(s){s.IfSingle="ifSingle",s.First="first",s.Never="never"})(Zs||(Zs={}));var Lr;(function(s){s.Refactor="refactor",s.RefactorPreview="refactor preview",s.Lightbulb="lightbulb",s.Default="other (default)",s.SourceAction="source action",s.QuickFix="quick fix action",s.FixAll="fix all",s.OrganizeImports="organize imports",s.AutoFix="auto fix",s.QuickFixHover="quick fix hover window",s.OnSave="save participants",s.ProblemsView="problems view"})(Lr||(Lr={}));function LWe(s,e){return!(s.include&&!s.include.intersects(e)||s.excludes&&s.excludes.some(t=>Zue(e,t,s.include))||!s.includeSourceActions&&pi.Source.contains(e))}function MWe(s,e){const t=e.kind?new Ut(e.kind):void 0;return!(s.include&&(!t||!s.include.contains(t))||s.excludes&&t&&s.excludes.some(i=>Zue(t,i,s.include))||!s.includeSourceActions&&t&&pi.Source.contains(t)||s.onlyIncludePreferredActions&&!e.isPreferred)}function Zue(s,e,t){return!(!e.contains(s)||t&&e.contains(t))}class ih{static fromUser(e,t){return!e||typeof e!="object"?new ih(t.kind,t.apply,!1):new ih(ih.getKindFromUser(e,t.kind),ih.getApplyFromUser(e,t.apply),ih.getPreferredUser(e))}static getApplyFromUser(e,t){switch(typeof e.apply=="string"?e.apply.toLowerCase():""){case"first":return Zs.First;case"never":return Zs.Never;case"ifsingle":return Zs.IfSingle;default:return t}}static getKindFromUser(e,t){return typeof e.kind=="string"?new Ut(e.kind):t}static getPreferredUser(e){return typeof e.preferred=="boolean"?e.preferred:!1}constructor(e,t,i){this.kind=e,this.apply=t,this.preferred=i}}class NWe{constructor(e,t,i){this.action=e,this.provider=t,this.highlightRange=i}async resolve(e){if(this.provider?.resolveCodeAction&&!this.action.edit){let t;try{t=await this.provider.resolveCodeAction(this.action,e)}catch(i){Ln(i)}t&&(this.action.edit=t.edit)}return this}}const u5="editor.action.codeAction",g5="editor.action.quickFix",Jue="editor.action.autoFix",p5="editor.action.refactor",f5="editor.action.sourceAction",j$="editor.action.organizeImports",Y$="editor.action.fixAll";class oE extends F{static codeActionsPreferredComparator(e,t){return e.isPreferred&&!t.isPreferred?-1:!e.isPreferred&&t.isPreferred?1:0}static codeActionsComparator({action:e},{action:t}){return e.isAI&&!t.isAI?1:!e.isAI&&t.isAI?-1:An(e.diagnostics)?An(t.diagnostics)?oE.codeActionsPreferredComparator(e,t):-1:An(t.diagnostics)?1:oE.codeActionsPreferredComparator(e,t)}constructor(e,t,i){super(),this.documentation=t,this._register(i),this.allActions=[...e].sort(oE.codeActionsComparator),this.validActions=this.allActions.filter(({action:n})=>!n.disabled)}get hasAutoFix(){return this.validActions.some(({action:e})=>!!e.kind&&pi.QuickFix.contains(new Ut(e.kind))&&!!e.isPreferred)}get hasAIFix(){return this.validActions.some(({action:e})=>!!e.isAI)}get allAIFixes(){return this.validActions.every(({action:e})=>!!e.isAI)}}const Mee={actions:[],documentation:void 0};async function wm(s,e,t,i,n,o){const r=i.filter||{},a={...r,excludes:[...r.excludes||[],pi.Notebook]},c={only:r.include?.value,trigger:i.type},d=new mSe(e,o),l=i.type===jo.Auto,u=OWe(s,e,l?a:r),g=new U,m=u.map(async _=>{const w=setTimeout(()=>n.report(_),1250);try{const C=await _.provideCodeActions(e,t,c,d.token);if(C&&g.add(C),d.token.isCancellationRequested)return Mee;const k=(C?.actions||[]).filter(A=>A&&MWe(r,A)),D=WWe(_,k,r.include);return{actions:k.map(A=>new NWe(A,_)),documentation:D}}catch(C){if(ys(C))throw C;return Ln(C),Mee}finally{clearTimeout(w)}}),v=s.onDidChange(()=>{const _=s.all(e);rs(_,u)||d.cancel()});try{const _=await Promise.all(m),w=_.map(D=>D.actions).flat(),C=[...$t(_.map(D=>D.documentation)),...FWe(s,e,i,w)],k=new oE(w,C,g);return g.add(k),k}catch(_){throw g.dispose(),_}finally{v.dispose(),d.dispose()}}function OWe(s,e,t){return s.all(e).filter(i=>i.providedCodeActionKinds?i.providedCodeActionKinds.some(n=>LWe(t,new Ut(n))):!0)}function*FWe(s,e,t,i){if(e&&i.length)for(const n of s.all(e))n._getAdditionalMenuItems&&(yield*n._getAdditionalMenuItems?.({trigger:t.type,only:t.filter?.include?.value},i.map(o=>o.action)))}function WWe(s,e,t){if(!s.documentation)return;const i=s.documentation.map(n=>({kind:new Ut(n.kind),command:n.command}));if(t){let n;for(const o of i)o.kind.contains(t)&&(n?n.kind.contains(o.kind)&&(n=o):n=o);if(n)return n?.command}for(const n of e)if(n.kind){for(const o of i)if(o.kind.contains(new Ut(n.kind)))return o.command}}var wu;(function(s){s.OnSave="onSave",s.FromProblemsView="fromProblemsView",s.FromCodeActions="fromCodeActions",s.FromAILightbulb="fromAILightbulb",s.FromProblemsHover="fromProblemsHover"})(wu||(wu={}));async function ege(s,e,t,i,n=Ce.None){const o=s.get(yw),r=s.get(Ge),a=s.get(ai),c=s.get(Dt),d=s.get(lI);if(a.publicLog2("codeAction.applyCodeAction",{codeActionTitle:e.action.title,codeActionKind:e.action.kind,codeActionIsPreferred:!!e.action.isPreferred,reason:t}),d.playSignal(Vp.codeActionTriggered),await e.resolve(n),!n.isCancellationRequested&&!(e.action.edit?.edits.length&&!(await o.apply(e.action.edit,{editor:i?.editor,label:e.action.title,quotableLabel:e.action.title,code:"undoredo.codeAction",respectAutoSaveConfig:t!==wu.OnSave,showPreview:i?.preview})).isApplied)){if(e.action.command)try{await r.executeCommand(e.action.command.id,...e.action.command.arguments||[])}catch(l){const u=BWe(l);c.error(typeof u=="string"?u:h(893,"An unknown error occurred while applying the code action"))}setTimeout(()=>d.playSignal(Vp.codeActionApplied),100)}}function BWe(s){return typeof s=="string"?s:s instanceof Error&&typeof s.message=="string"?s.message:void 0}Ee.registerCommand("_executeCodeActionProvider",async function(s,e,t,i,n){if(!(e instanceof R))throw Nt();const{codeActionProvider:o}=s.get(Ne),r=s.get(ci).getModel(e);if(!r)throw Nt();const a=at.isISelection(t)?at.liftSelection(t):P.isIRange(t)?r.validateRange(t):void 0;if(!a)throw Nt();const c=typeof i=="string"?new Ut(i):void 0,d=await wm(o,r,a,{type:jo.Invoke,triggerAction:Lr.Default,filter:{includeSourceActions:!0,include:c}},Qc.None,Ce.None),l=[],u=Math.min(d.validActions.length,typeof n=="number"?n:0);for(let g=0;g<u;g++)l.push(d.validActions[g].resolve(Ce.None));try{return await Promise.all(l),d.validActions.map(g=>g.action)}finally{setTimeout(()=>d.dispose(),100)}});var Q$;let X$=class{static{Q$=this}static{this.codeActionCommands=[p5,u5,f5,j$,Y$]}constructor(e){this.keybindingService=e}getResolver(){const e=new Ih(()=>this.keybindingService.getKeybindings().filter(t=>Q$.codeActionCommands.indexOf(t.command)>=0).filter(t=>t.resolvedKeybinding).map(t=>{let i=t.commandArgs;return t.command===j$?i={kind:pi.SourceOrganizeImports.value}:t.command===Y$&&(i={kind:pi.SourceFixAll.value}),{resolvedKeybinding:t.resolvedKeybinding,...ih.fromUser(i,{kind:Ut.None,apply:Zs.Never})}}));return t=>{if(t.kind)return this.bestKeybindingForCodeAction(t,e.value)?.resolvedKeybinding}}bestKeybindingForCodeAction(e,t){if(!e.kind)return;const i=new Ut(e.kind);return t.filter(n=>n.kind.contains(i)).filter(n=>n.preferred?e.isPreferred:!0).reduceRight((n,o)=>n?n.kind.contains(o.kind)?o:n:o,void 0)}};X$=Q$=f([p(0,He)],X$);const tge=Object.freeze({kind:Ut.Empty,title:h(929,"More Actions...")}),VWe=Object.freeze([{kind:pi.QuickFix,title:h(930,"Quick Fix")},{kind:pi.RefactorExtract,title:h(931,"Extract"),icon:K.wrench},{kind:pi.RefactorInline,title:h(932,"Inline"),icon:K.wrench},{kind:pi.RefactorRewrite,title:h(933,"Rewrite"),icon:K.wrench},{kind:pi.RefactorMove,title:h(934,"Move"),icon:K.wrench},{kind:pi.SurroundWith,title:h(935,"Surround With"),icon:K.surroundWith},{kind:pi.Source,title:h(936,"Source Action"),icon:K.symbolFile},tge]);function HWe(s,e,t){if(!e)return s.map(o=>({kind:Jr.Action,item:o,group:tge,disabled:!!o.action.disabled,label:o.action.disabled||o.action.title,canPreview:!!o.action.edit?.edits.length}));const i=VWe.map(o=>({group:o,actions:[]}));for(const o of s){const r=o.action.kind?new Ut(o.action.kind):Ut.None;for(const a of i)if(a.group.kind.contains(r)){a.actions.push(o);break}}const n=[];for(const o of i)if(o.actions.length){n.push({kind:Jr.Header,group:o.group});for(const r of o.actions){const a=o.group;n.push({kind:Jr.Action,item:r,group:r.action.isAI?{title:a.title,kind:a.kind,icon:K.sparkle}:a,label:r.action.title,disabled:!!r.action.disabled,keybinding:t(r.action)})}}return n}const ige=new O("supportedCodeAction",""),Nee="_typescript.applyFixAllCodeAction";class UWe extends F{constructor(e,t,i,n=250){super(),this._editor=e,this._markerService=t,this._signalChange=i,this._delay=n,this._autoTriggerTimer=this._register(new sI),this._register(this._markerService.onMarkerChanged(o=>this._onMarkerChanges(o))),this._register(this._editor.onDidChangeCursorPosition(()=>this._tryAutoTrigger()))}trigger(e){const t=this._getRangeOfSelectionUnlessWhitespaceEnclosed(e);this._signalChange(t?{trigger:e,selection:t}:void 0)}_onMarkerChanges(e){const t=this._editor.getModel();t&&e.some(i=>At(i,t.uri))&&this._tryAutoTrigger()}_tryAutoTrigger(){this._autoTriggerTimer.cancelAndSet(()=>{this.trigger({type:jo.Auto,triggerAction:Lr.Default})},this._delay)}_getRangeOfSelectionUnlessWhitespaceEnclosed(e){if(!this._editor.hasModel())return;const t=this._editor.getSelection();if(e.type===jo.Invoke)return t;const i=this._editor.getOption(L.lightbulb).enabled;if(i!==n1.Off){{if(i===n1.On)return t;if(i===n1.OnCode){if(!t.isEmpty())return t;const o=this._editor.getModel(),{lineNumber:r,column:a}=t.getPosition(),c=o.getLineContent(r);if(c.length===0)return;if(a===1){if(/\s/.test(c[0]))return}else if(a===o.getLineMaxColumn(r)){if(/\s/.test(c[c.length-1]))return}else if(/\s/.test(c[a-2])&&/\s/.test(c[a-1]))return}}return t}}}var $d;(function(s){let e;(function(i){i[i.Empty=0]="Empty",i[i.Triggered=1]="Triggered"})(e=s.Type||(s.Type={})),s.Empty={type:e.Empty};class t{constructor(n,o,r){this.trigger=n,this.position=o,this._cancellablePromise=r,this.type=e.Triggered,this.actions=r.catch(a=>{if(ys(a))return Z$;throw a})}cancel(){this._cancellablePromise.cancel()}}s.Triggered=t})($d||($d={}));const Z$=Object.freeze({allActions:[],validActions:[],dispose:()=>{},documentation:[],hasAutoFix:!1,hasAIFix:!1,allAIFixes:!1});class $We extends F{constructor(e,t,i,n,o,r){super(),this._editor=e,this._registry=t,this._markerService=i,this._progressService=o,this._configurationService=r,this._codeActionOracle=this._register(new Pt),this._state=$d.Empty,this._onDidChangeState=this._register(new M),this.onDidChangeState=this._onDidChangeState.event,this.codeActionsDisposable=this._register(new Pt),this._disposed=!1,this._supportedCodeActions=ige.bindTo(n),this._register(this._editor.onDidChangeModel(()=>this._update())),this._register(this._editor.onDidChangeModelLanguage(()=>this._update())),this._register(this._registry.onDidChange(()=>this._update())),this._register(this._editor.onDidChangeConfiguration(a=>{a.hasChanged(L.lightbulb)&&this._update()})),this._update()}dispose(){this._disposed||(this._disposed=!0,super.dispose(),this.setState($d.Empty,!0))}_settingEnabledNearbyQuickfixes(){const e=this._editor?.getModel();return this._configurationService?this._configurationService.getValue("editor.codeActionWidget.includeNearbyQuickFixes",{resource:e?.uri}):!1}_update(){if(this._disposed)return;this._codeActionOracle.value=void 0,this.setState($d.Empty);const e=this._editor.getModel();if(e&&this._registry.has(e)&&!this._editor.getOption(L.readOnly)){const t=this._registry.all(e).flatMap(i=>i.providedCodeActionKinds??[]);this._supportedCodeActions.set(t.join(" ")),this._codeActionOracle.value=new UWe(this._editor,this._markerService,i=>{if(!i){this.setState($d.Empty);return}const n=i.selection.getStartPosition(),o=Tn(async c=>{if(this._settingEnabledNearbyQuickfixes()&&i.trigger.type===jo.Invoke&&(i.trigger.triggerAction===Lr.QuickFix||i.trigger.filter?.include?.contains(pi.QuickFix))){const l=await wm(this._registry,e,i.selection,i.trigger,Qc.None,c);this.codeActionsDisposable.value=l;const u=[...l.allActions];if(c.isCancellationRequested)return l.dispose(),Z$;const g=l.validActions?.some(v=>v.action.kind?pi.QuickFix.contains(new Ut(v.action.kind)):!1),m=this._markerService.read({resource:e.uri});if(g){for(const v of l.validActions)v.action.command?.arguments?.some(_=>typeof _=="string"&&_.includes(Nee))&&(v.action.diagnostics=[...m.filter(_=>_.relatedInformation)]);return{validActions:l.validActions,allActions:u,documentation:l.documentation,hasAutoFix:l.hasAutoFix,hasAIFix:l.hasAIFix,allAIFixes:l.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=l}}}else if(!g&&m.length>0){const v=i.selection.getPosition();let _=v,w=Number.MAX_VALUE;const C=[...l.validActions];for(const D of m){const A=D.endColumn,B=D.endLineNumber,q=D.startLineNumber;if(B===v.lineNumber||q===v.lineNumber){_=new we(B,A);const Q={type:i.trigger.type,triggerAction:i.trigger.triggerAction,filter:{include:i.trigger.filter?.include?i.trigger.filter?.include:pi.QuickFix},autoApply:i.trigger.autoApply,context:{notAvailableMessage:i.trigger.context?.notAvailableMessage||"",position:_}},ie=new at(_.lineNumber,_.column,_.lineNumber,_.column),oe=await wm(this._registry,e,ie,Q,Qc.None,c);if(c.isCancellationRequested)return oe.dispose(),Z$;if(oe.validActions.length!==0){for(const be of oe.validActions)be.action.command?.arguments?.some(me=>typeof me=="string"&&me.includes(Nee))&&(be.action.diagnostics=[...m.filter(me=>me.relatedInformation)]);l.allActions.length===0&&u.push(...oe.allActions),Math.abs(v.column-A)<w?C.unshift(...oe.validActions):C.push(...oe.validActions)}w=Math.abs(v.column-A)}}const k=C.filter((D,A,B)=>B.findIndex(q=>q.action.title===D.action.title)===A);return k.sort((D,A)=>D.action.isPreferred&&!A.action.isPreferred?-1:!D.action.isPreferred&&A.action.isPreferred||D.action.isAI&&!A.action.isAI?1:!D.action.isAI&&A.action.isAI?-1:0),{validActions:k,allActions:u,documentation:l.documentation,hasAutoFix:l.hasAutoFix,hasAIFix:l.hasAIFix,allAIFixes:l.allAIFixes,dispose:()=>{this.codeActionsDisposable.value=l}}}}if(i.trigger.type===jo.Invoke){const l=await wm(this._registry,e,i.selection,i.trigger,Qc.None,c);return this.codeActionsDisposable.value=l,l}const d=await wm(this._registry,e,i.selection,i.trigger,Qc.None,c);return this.codeActionsDisposable.value=d,d});i.trigger.type===jo.Invoke&&this._progressService?.showWhile(o,250);const r=new $d.Triggered(i.trigger,n,o);let a=!1;this._state.type===$d.Type.Triggered&&(a=this._state.trigger.type===jo.Invoke&&r.type===$d.Type.Triggered&&r.trigger.type===jo.Auto&&this._state.position!==r.position),a?setTimeout(()=>{this.setState(r)},500):this.setState(r)},void 0),this._codeActionOracle.value.trigger({type:jo.Auto,triggerAction:Lr.Default})}else this._supportedCodeActions.reset()}trigger(e){this._codeActionOracle.value?.trigger(e),this.codeActionsDisposable.dispose()}setState(e,t){e!==this._state&&(this._state.type===$d.Type.Triggered&&this._state.cancel(),this._state=e,!t&&!this._disposed&&this._onDidChangeState.fire(e))}}const GWe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var F_;Ve(GWe);const Oee=Pe("gutter-lightbulb",K.lightBulb,h(937,"Icon which spawns code actions menu from the gutter when there is no space in the editor.")),Fee=Pe("gutter-lightbulb-auto-fix",K.lightbulbAutofix,h(938,"Icon which spawns code actions menu from the gutter when there is no space in the editor and a quick fix is available.")),Wee=Pe("gutter-lightbulb-sparkle",K.lightbulbSparkle,h(939,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix is available.")),Bee=Pe("gutter-lightbulb-aifix-auto-fix",K.lightbulbSparkleAutofix,h(940,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available.")),Vee=Pe("gutter-lightbulb-sparkle-filled",K.sparkleFilled,h(941,"Icon which spawns code actions menu from the gutter when there is no space in the editor and an AI fix and a quick fix is available."));var so;(function(s){let e;(function(i){i[i.Hidden=0]="Hidden",i[i.Showing=1]="Showing"})(e=s.Type||(s.Type={})),s.Hidden={type:e.Hidden};class t{constructor(n,o,r,a){this.actions=n,this.trigger=o,this.editorPosition=r,this.widgetPosition=a,this.type=e.Showing}}s.Showing=t})(so||(so={}));let Nx=class extends F{static{F_=this}static{this.GUTTER_DECORATION=Zt.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:ke.asClassName(K.lightBulb),glyphMargin:{position:LF.Left},stickiness:ki.NeverGrowsWhenTypingAtEdges})}static{this.ID="editor.contrib.lightbulbWidget"}static{this._posPref=[Fi.EXACT]}constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._onClick=this._register(new M),this.onClick=this._onClick.event,this._state=so.Hidden,this._gutterState=so.Hidden,this._iconClasses=[],this.lightbulbClasses=["codicon-"+Oee.id,"codicon-"+Bee.id,"codicon-"+Fee.id,"codicon-"+Wee.id,"codicon-"+Vee.id],this.gutterDecoration=F_.GUTTER_DECORATION,this._domNode=j("div.lightBulbWidget"),this._domNode.role="listbox",this._register(Dh.ignoreTarget(this._domNode)),this._editor.addContentWidget(this),this._register(this._editor.onDidChangeModelContent(i=>{const n=this._editor.getModel();(this.state.type!==so.Type.Showing||!n||this.state.editorPosition.lineNumber>=n.getLineCount())&&this.hide(),(this.gutterState.type!==so.Type.Showing||!n||this.gutterState.editorPosition.lineNumber>=n.getLineCount())&&this.gutterHide()})),this._register(Lbe(this._domNode,i=>{if(this.state.type!==so.Type.Showing)return;this._editor.focus(),i.preventDefault();const{top:n,height:o}=Bs(this._domNode),r=this._editor.getOption(L.lineHeight);let a=Math.floor(r/3);this.state.widgetPosition.position!==null&&this.state.widgetPosition.position.lineNumber<this.state.editorPosition.lineNumber&&(a+=r),this._onClick.fire({x:i.posx,y:n+o+a,actions:this.state.actions,trigger:this.state.trigger})})),this._register(re(this._domNode,"mouseenter",i=>{(i.buttons&1)===1&&this.hide()})),this._register(T.runAndSubscribe(this._keybindingService.onDidUpdateKeybindings,()=>{this._preferredKbLabel=this._keybindingService.lookupKeybinding(Jue)?.getLabel()??void 0,this._quickFixKbLabel=this._keybindingService.lookupKeybinding(g5)?.getLabel()??void 0,this._updateLightBulbTitleAndIcon()})),this._register(this._editor.onMouseDown(async i=>{if(!i.target.element||!this.lightbulbClasses.some(c=>i.target.element&&i.target.element.classList.contains(c))||this.gutterState.type!==so.Type.Showing)return;this._editor.focus();const{top:n,height:o}=Bs(i.target.element),r=this._editor.getOption(L.lineHeight);let a=Math.floor(r/3);this.gutterState.widgetPosition.position!==null&&this.gutterState.widgetPosition.position.lineNumber<this.gutterState.editorPosition.lineNumber&&(a+=r),this._onClick.fire({x:i.event.posx,y:n+o+a,actions:this.gutterState.actions,trigger:this.gutterState.trigger})}))}dispose(){super.dispose(),this._editor.removeContentWidget(this),this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID)}getId(){return"LightBulbWidget"}getDomNode(){return this._domNode}getPosition(){return this._state.type===so.Type.Showing?this._state.widgetPosition:null}update(e,t,i){if(e.validActions.length<=0)return this.gutterHide(),this.hide();if(!this._editor.hasTextFocus())return this.gutterHide(),this.hide();if(!this._editor.getOptions().get(L.lightbulb).enabled)return this.gutterHide(),this.hide();const r=this._editor.getModel();if(!r)return this.gutterHide(),this.hide();const{lineNumber:a,column:c}=r.validatePosition(i),d=r.getOptions().tabSize,l=this._editor.getOptions().get(L.fontInfo),u=r.getLineContent(a),g=Mbe(u,d),m=l.spaceWidth*g>22,v=B=>B>2&&this._editor.getTopForLineNumber(B)===this._editor.getTopForLineNumber(B-1),_=this._editor.getLineDecorations(a);let w=!1;if(_)for(const B of _){const q=B.options.glyphMarginClassName;if(q&&!this.lightbulbClasses.some(Q=>q.includes(Q))){w=!0;break}}let C=a,k=1;if(!m){const B=q=>{const Q=r.getLineContent(q);return/^\s*$|^\s+/.test(Q)||Q.length<=k};if(a>1&&!v(a-1)){const q=r.getLineCount(),Q=a===q,ie=a>1&&B(a-1),oe=!Q&&B(a+1),be=B(a),me=!oe&&!ie;if(!oe&&!ie&&!w)return this.gutterState=new so.Showing(e,t,i,{position:{lineNumber:C,column:k},preference:F_._posPref}),this.renderGutterLightbub(),this.hide();ie||Q||ie&&!be?C-=1:(oe||me&&be)&&(C+=1)}else if(a===1&&(a===r.getLineCount()||!B(a+1)&&!B(a)))if(this.gutterState=new so.Showing(e,t,i,{position:{lineNumber:C,column:k},preference:F_._posPref}),w)this.gutterHide();else return this.renderGutterLightbub(),this.hide();else if(a<r.getLineCount()&&!v(a+1))C+=1;else if(c*l.spaceWidth<22)return this.hide();k=/^\S\s*$/.test(r.getLineContent(C))?2:1}this.state=new so.Showing(e,t,i,{position:{lineNumber:C,column:k},preference:F_._posPref}),this._gutterDecorationID&&(this._removeGutterDecoration(this._gutterDecorationID),this.gutterHide());const D=e.validActions,A=e.validActions[0].action.kind;if(D.length!==1||!A){this._editor.layoutContentWidget(this);return}this._editor.layoutContentWidget(this)}hide(){this.state!==so.Hidden&&(this.state=so.Hidden,this._editor.layoutContentWidget(this))}gutterHide(){this.gutterState!==so.Hidden&&(this._gutterDecorationID&&this._removeGutterDecoration(this._gutterDecorationID),this.gutterState=so.Hidden)}get state(){return this._state}set state(e){this._state=e,this._updateLightBulbTitleAndIcon()}get gutterState(){return this._gutterState}set gutterState(e){this._gutterState=e,this._updateGutterLightBulbTitleAndIcon()}_updateLightBulbTitleAndIcon(){if(this._domNode.classList.remove(...this._iconClasses),this._iconClasses=[],this.state.type!==so.Type.Showing)return;let e,t=!1;this.state.actions.allAIFixes?(e=K.sparkleFilled,this.state.actions.validActions.length===1&&(t=!0)):this.state.actions.hasAutoFix?this.state.actions.hasAIFix?e=K.lightbulbSparkleAutofix:e=K.lightbulbAutofix:this.state.actions.hasAIFix?e=K.lightbulbSparkle:e=K.lightBulb,this._updateLightbulbTitle(this.state.actions.hasAutoFix,t),this._iconClasses=ke.asClassNameArray(e),this._domNode.classList.add(...this._iconClasses)}_updateGutterLightBulbTitleAndIcon(){if(this.gutterState.type!==so.Type.Showing)return;let e,t=!1;this.gutterState.actions.allAIFixes?(e=Vee,this.gutterState.actions.validActions.length===1&&(t=!0)):this.gutterState.actions.hasAutoFix?this.gutterState.actions.hasAIFix?e=Bee:e=Fee:this.gutterState.actions.hasAIFix?e=Wee:e=Oee,this._updateLightbulbTitle(this.gutterState.actions.hasAutoFix,t);const i=Zt.register({description:"codicon-gutter-lightbulb-decoration",glyphMarginClassName:ke.asClassName(e),glyphMargin:{position:LF.Left},stickiness:ki.NeverGrowsWhenTypingAtEdges});this.gutterDecoration=i}renderGutterLightbub(){const e=this._editor.getSelection();e&&(this._gutterDecorationID===void 0?this._addGutterDecoration(e.startLineNumber):this._updateGutterDecoration(this._gutterDecorationID,e.startLineNumber))}_addGutterDecoration(e){this._editor.changeDecorations(t=>{this._gutterDecorationID=t.addDecoration(new P(e,0,e,0),this.gutterDecoration)})}_removeGutterDecoration(e){this._editor.changeDecorations(t=>{t.removeDecoration(e),this._gutterDecorationID=void 0})}_updateGutterDecoration(e,t){this._editor.changeDecorations(i=>{i.changeDecoration(e,new P(t,0,t,0)),i.changeDecorationOptions(e,this.gutterDecoration)})}_updateLightbulbTitle(e,t){this.state.type===so.Type.Showing&&(t?this.title=h(942,"Run: {0}",this.state.actions.validActions[0].action.title):e&&this._preferredKbLabel?this.title=h(943,"Show Code Actions. Preferred Quick Fix Available ({0})",this._preferredKbLabel):!e&&this._quickFixKbLabel?this.title=h(944,"Show Code Actions ({0})",this._quickFixKbLabel):e||(this.title=h(945,"Show Code Actions")))}set title(e){this._domNode.title=e}};Nx=F_=f([p(1,He)],Nx);var W_;const zWe="quickfix-edit-highlight";let Zp=class extends F{static{W_=this}static{this.ID="editor.contrib.codeActionController"}static get(e){return e.getContribution(W_.ID)}constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this._commandService=a,this._configurationService=c,this._actionWidgetService=d,this._instantiationService=l,this._progressService=u,this._activeCodeActions=this._register(new Pt),this._showDisabled=!1,this._disposed=!1,this._editor=e,this._model=this._register(new $We(this._editor,o.codeActionProvider,t,i,r,c)),this._register(this._model.onDidChangeState(g=>this.update(g))),this._lightBulbWidget=new Ih(()=>{const g=this._editor.getContribution(Nx.ID);return g&&this._register(g.onClick(m=>this.showCodeActionsFromLightbulb(m.actions,m))),g}),this._resolver=n.createInstance(X$),this._register(this._editor.onDidLayoutChange(()=>this._actionWidgetService.hide()))}dispose(){this._disposed=!0,super.dispose()}async showCodeActionsFromLightbulb(e,t){if(e.allAIFixes&&e.validActions.length===1){const i=e.validActions[0],n=i.action.command;n&&n.id==="inlineChat.start"&&n.arguments&&n.arguments.length>=1&&(n.arguments[0]={...n.arguments[0],autoSend:!1}),await this.applyCodeAction(i,!1,!1,wu.FromAILightbulb);return}await this.showCodeActionList(e,t,{includeDisabledActions:!1,fromLightbulb:!0})}showCodeActions(e,t,i){return this.showCodeActionList(t,i,{includeDisabledActions:!1,fromLightbulb:!1})}hideCodeActions(){this._actionWidgetService.hide()}manualTriggerAtCurrentPosition(e,t,i,n){if(!this._editor.hasModel())return;Dr.get(this._editor)?.closeMessage();const o=this._editor.getPosition();this._trigger({type:jo.Invoke,triggerAction:t,filter:i,autoApply:n,context:{notAvailableMessage:e,position:o}})}_trigger(e){return this._model.trigger(e)}async applyCodeAction(e,t,i,n){const o=this._progressService.show(!0,500);try{await this._instantiationService.invokeFunction(ege,e,n,{preview:i,editor:this._editor})}finally{t&&this._trigger({type:jo.Auto,triggerAction:Lr.QuickFix,filter:{}}),o.done()}}hideLightBulbWidget(){this._lightBulbWidget.rawValue?.hide(),this._lightBulbWidget.rawValue?.gutterHide()}async update(e){if(e.type!==$d.Type.Triggered){this.hideLightBulbWidget();return}let t;try{t=await e.actions}catch(n){mt(n);return}if(!(this._disposed||this._editor.getSelection()?.startLineNumber!==e.position.lineNumber))if(this._lightBulbWidget.value?.update(t,e.trigger,e.position),e.trigger.type===jo.Invoke){if(e.trigger.filter?.include){const o=this.tryGetValidActionToApply(e.trigger,t);if(o){try{this.hideLightBulbWidget(),await this.applyCodeAction(o,!1,!1,wu.FromCodeActions)}finally{t.dispose()}return}if(e.trigger.context){const r=this.getInvalidActionThatWouldHaveBeenApplied(e.trigger,t);if(r&&r.action.disabled){Dr.get(this._editor)?.showMessage(r.action.disabled,e.trigger.context.position),t.dispose();return}}}const n=!!e.trigger.filter?.include;if(e.trigger.context&&(!t.allActions.length||!n&&!t.validActions.length)){Dr.get(this._editor)?.showMessage(e.trigger.context.notAvailableMessage,e.trigger.context.position),this._activeCodeActions.value=t,t.dispose();return}this._activeCodeActions.value=t,this.showCodeActionList(t,this.toCoords(e.position),{includeDisabledActions:n,fromLightbulb:!1})}else this._actionWidgetService.isVisible?t.dispose():this._activeCodeActions.value=t}getInvalidActionThatWouldHaveBeenApplied(e,t){if(t.allActions.length&&(e.autoApply===Zs.First&&t.validActions.length===0||e.autoApply===Zs.IfSingle&&t.allActions.length===1))return t.allActions.find(({action:i})=>i.disabled)}tryGetValidActionToApply(e,t){if(t.validActions.length&&(e.autoApply===Zs.First&&t.validActions.length>0||e.autoApply===Zs.IfSingle&&t.validActions.length===1))return t.validActions[0]}static{this.DECORATION=Zt.register({description:"quickfix-highlight",className:zWe})}async showCodeActionList(e,t,i){const n=this._editor.createDecorationsCollection(),o=this._editor.getDomNode();if(!o)return;const r=i.includeDisabledActions&&(this._showDisabled||e.validActions.length===0)?e.allActions:e.validActions;if(!r.length)return;const a=we.isIPosition(t)?this.toCoords(t):t,c={onSelect:async(d,l)=>{this.applyCodeAction(d,!0,!!l,i.fromLightbulb?wu.FromAILightbulb:wu.FromCodeActions),this._actionWidgetService.hide(!1),n.clear()},onHide:d=>{this._editor?.focus(),n.clear()},onHover:async(d,l)=>{if(l.isCancellationRequested)return;let u=!1;const g=d.action.kind;if(g){const m=new Ut(g);u=[pi.RefactorExtract,pi.RefactorInline,pi.RefactorRewrite,pi.RefactorMove,pi.Source].some(_=>_.contains(m))}return{canPreview:u||!!d.action.edit?.edits.length}},onFocus:d=>{if(d&&d.action){const l=d.action.ranges,u=d.action.diagnostics;if(n.clear(),l&&l.length>0){const g=u&&u?.length>1?u.map(m=>({range:m,options:W_.DECORATION})):l.map(m=>({range:m,options:W_.DECORATION}));n.set(g)}else if(u&&u.length>0){const g=u.map(v=>({range:v,options:W_.DECORATION}));n.set(g);const m=u[0];if(m.startLineNumber&&m.startColumn){const v=this._editor.getModel()?.getWordAtPosition({lineNumber:m.startLineNumber,column:m.startColumn})?.word;zc(h(926,"Context: {0} at line {1} and column {2}.",v,m.startLineNumber,m.startColumn))}}}else n.clear()}};this._actionWidgetService.show("codeActionWidget",!0,HWe(r,this._shouldShowHeaders(),this._resolver.getResolver()),c,a,o,this._getActionBarActions(e,t,i))}toCoords(e){if(!this._editor.hasModel())return{x:0,y:0};this._editor.revealPosition(e,Qi.Immediate),this._editor.render();const t=this._editor.getScrolledVisiblePosition(e),i=Bs(this._editor.getDomNode()),n=i.left+t.left,o=i.top+t.top+t.height;return{x:n,y:o}}_shouldShowHeaders(){const e=this._editor?.getModel();return this._configurationService.getValue("editor.codeActionWidget.showHeaders",{resource:e?.uri})}_getActionBarActions(e,t,i){if(i.fromLightbulb)return[];const n=e.documentation.map(o=>({id:o.id,label:o.title,tooltip:o.tooltip??"",class:void 0,enabled:!0,run:()=>this._commandService.executeCommand(o.id,...o.arguments??[])}));return i.includeDisabledActions&&e.validActions.length>0&&e.allActions.length!==e.validActions.length&&n.push(this._showDisabled?{id:"hideMoreActions",label:h(927,"Hide Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!1,this.showCodeActionList(e,t,i))}:{id:"showMoreActions",label:h(928,"Show Disabled"),enabled:!0,tooltip:"",class:void 0,run:()=>(this._showDisabled=!0,this.showCodeActionList(e,t,i))}),n}};Zp=W_=f([p(1,FM),p(2,fe),p(3,Z),p(4,Ne),p(5,Uu),p(6,Ge),p(7,ne),p(8,Ed),p(9,Z),p(10,Uu)],Zp);Fv((s,e)=>{((n,o)=>{o&&e.addRule(`.monaco-editor ${n} { background-color: ${o}; }`)})(".quickfix-edit-highlight",s.getColor(GF));const i=s.getColor(rse);i&&e.addRule(`.monaco-editor .quickfix-edit-highlight { border: 1px ${ly(s.type)?"dotted":"solid"} ${i}; box-sizing: border-box; }`)});function qWe(s){return s instanceof nge?s._instance:s}let nge=class{constructor(e){this.instantiationService=e}init(...e){}};function KWe(s,e){return class extends e{constructor(){super(...arguments),this._autorun=void 0}init(...i){this._autorun=ka((n,o)=>{const r=s.read(n);this._instance=o.add(this.instantiationService.createInstance(r,...i))})}dispose(){this._autorun?.dispose()}}}function jWe(s){return Hse()?KWe(s,J$):s.get()}let J$=class extends nge{constructor(e,t){super(t),this.init(e)}};J$=f([p(1,Z)],J$);function YWe(s){return s.sourceId+" @@ "+JSON.stringify({...s,sourceId:void 0})}let xL=class extends F{static cast(){return this}constructor(e,t,i){super(),this._contextKey=e,this._contextKeyService=t,this._commandService=i,this._contextKeyValue=QWe(this._contextKey,this._contextKeyService).recomputeInitiallyAndOnChange(this._store),this.isEnabled=this._contextKeyValue.map(n=>n!==void 0)}log(e){const t=this._contextKeyValue.get();return t?(this._commandService.executeCommand(t,e),!0):!1}};xL=f([p(1,fe),p(2,Ge)],xL);function QWe(s,e){return kn(e.onDidChangeContext,()=>e.getContextKeyValue(s))}var e3;let Zb=class extends F{static{e3=this}static{this._nextMetadataId=0}static{this._metaDataMap=new Map}static editWithMetadata(e,t){const i=this._nextMetadataId++;this._metaDataMap.set(i,e);try{return t()}finally{this._metaDataMap.delete(i)}}static _getCurrentMetadata(){const e={};for(const t of this._metaDataMap.values())Object.assign(e,t);return e}constructor(e,t){super(),this._editor=e,this._instantiationService=t,this._structuredLogger=this._register(this._instantiationService.createInstance(xL.cast(),"editor.inlineSuggest.logChangeReason.commandId")),this._register(ka((i,n)=>{if(!(this._editor instanceof gI)||!this._structuredLogger.isEnabled.read(i))return;const o=[];n.add(this._editor.onBeforeExecuteEdit(({source:r})=>{r&&o.push(r)})),n.add(this._editor.onDidChangeModelContent(r=>{const a=this._editor.getModel();if(!a)return;const c=e3._getCurrentMetadata();o.length===0&&c.source&&o.push(c.source);for(const d of o){const l={...c,sourceId:"TextModel.setChangeReason",source:d,time:Date.now(),modelUri:a.uri.toString(),modelVersion:a.getVersionId()};setTimeout(()=>{this._structuredLogger.log(l)},0)}o.length=0}))}))}};Zb=e3=f([p(1,Z)],Zb);const XWe=[];function ZWe(){return XWe}function JWe(s,e){return new we(s.lineNumber+e.lineNumber-1,e.lineNumber===1?s.column+e.column-1:e.column)}function Hee(s,e){return new we(s.lineNumber-e.lineNumber+1,s.lineNumber-e.lineNumber===0?s.column-e.column+1:s.column)}function eBe(s,e){const i=new Nbe(s).getOffset(e);return s.substring(i)}function Uee(s){return tBe(s).map(t=>t.getEndPosition())}function tBe(s){const e=Obe.createSortPermutation(s,rd(n=>n.range,P.compareRangesUsingStarts)),i=new hc(e.apply(s)).getNewRanges();return e.inverse().apply(i)}function iBe(s,e){const t=si("result",[]),i=[];return e.add(fi(n=>{const o=s.read(n);gs(r=>{if(o.length!==i.length){i.length=o.length;for(let a=0;a<i.length;a++)i[a]||(i[a]=si("item",o[a]));t.set([...i],r)}i.forEach((a,c)=>a.set(o[c],r))})})),t}class nBe{constructor(e){this._contextKeyService=e}bind(e,t){return Bse(e,this._contextKeyService,t instanceof Function?t:i=>t.read(i))}}function sBe(s,e){return new Promise(t=>{let i;const n=setTimeout(()=>{i&&i.dispose(),t()},s);e&&(i=e.onCancellationRequested(()=>{clearTimeout(n),i&&i.dispose(),t()}))})}class b0{static const(e){return new b0(e,e,0)}constructor(e,t,i,n=oBe){this.startValue=e,this.endValue=t,this.durationMs=i,this._interpolationFunction=n,this.startTimeMs=Date.now(),e===t&&(this.durationMs=0)}isFinished(){return Date.now()>=this.startTimeMs+this.durationMs}getValue(){const e=Date.now()-this.startTimeMs;return e>=this.durationMs?this.endValue:this._interpolationFunction(e,this.startValue,this.endValue-this.startValue,this.durationMs)}}function oBe(s,e,t,i){return s===i?e+t:t*(-Math.pow(2,-10*s/i)+1)+e}function rBe(s,e,t,i){return t*((s=s/i-1)*s*s+1)+e}class m5{static const(e){return new m5(b0.const(e))}constructor(e){this._value=si(this,e)}setAnimation(e,t){this._value.set(e,t)}changeAnimation(e,t){const i=e(this._value.get());this._value.set(i,t)}getValue(e){const t=this._value.read(e);return t.isFinished()||v5.instance.invalidateOnNextAnimationFrame(e),t.getValue()}}class v5{constructor(){this._counter=Kd(this),this._isScheduled=!1}static{this.instance=new v5}invalidateOnNextAnimationFrame(e){this._counter.read(e),this._isScheduled||(this._isScheduled=!0,Fp().requestAnimationFrame(()=>{this._isScheduled=!1,this._update()}))}_update(){this._counter.trigger(void 0)}}class Ox{constructor(e,t){this.lineNumber=e,this.parts=t}equals(e){return this.lineNumber===e.lineNumber&&this.parts.length===e.parts.length&&this.parts.every((t,i)=>t.equals(e.parts[i]))}render(e,t=!1){return new hc([...this.parts.map(i=>new ps(P.fromPositions(new we(this.lineNumber,i.column)),t?`[${i.lines.map(n=>n.line).join(`
`)}]`:i.lines.map(n=>n.line).join(`
`)))]).applyToString(e)}renderForScreenReader(e){if(this.parts.length===0)return"";const t=this.parts[this.parts.length-1],i=e.substr(0,t.column-1);return new hc([...this.parts.map(o=>new ps(P.fromPositions(new we(1,o.column)),o.lines.map(r=>r.line).join(`
`)))]).applyToString(i).substring(this.parts[0].column-1)}isEmpty(){return this.parts.every(e=>e.lines.length===0)}get lineCount(){return 1+this.parts.reduce((e,t)=>e+t.lines.length-1,0)}}class IL{constructor(e,t,i,n=[]){this.column=e,this.text=t,this.preview=i,this._inlineDecorations=n,this.lines=Ch(this.text).map((o,r)=>({line:o,lineDecorations:ME.filter(this._inlineDecorations,r+1,1,o.length+1)}))}equals(e){return this.column===e.column&&this.lines.length===e.lines.length&&this.lines.every((t,i)=>t.line===e.lines[i].line&&ME.equalsArr(t.lineDecorations,e.lines[i].lineDecorations))}}class t3{constructor(e,t,i,n=0){this.lineNumber=e,this.columnRange=t,this.text=i,this.additionalReservedLineCount=n,this.parts=[new IL(this.columnRange.endColumnExclusive,this.text,!1)],this.newLines=Ch(this.text)}renderForScreenReader(e){return this.newLines.join(`
`)}render(e,t=!1){const i=this.columnRange.toRange(this.lineNumber);return t?new hc([new ps(P.fromPositions(i.getStartPosition()),"("),new ps(P.fromPositions(i.getEndPosition()),`)[${this.newLines.join(`
`)}]`)]).applyToString(e):new hc([new ps(i,this.newLines.join(`
`))]).applyToString(e)}get lineCount(){return this.newLines.length}isEmpty(){return this.parts.every(e=>e.lines.length===0)}equals(e){return this.lineNumber===e.lineNumber&&this.columnRange.equals(e.columnRange)&&this.newLines.length===e.newLines.length&&this.newLines.every((t,i)=>t===e.newLines[i])&&this.additionalReservedLineCount===e.additionalReservedLineCount}}function $ee(s,e){return rs(s,e,sge)}function sge(s,e){return s===e?!0:!s||!e?!1:s instanceof Ox&&e instanceof Ox||s instanceof t3&&e instanceof t3?s.equals(e):!1}function Su(s,e,t){const i=t?s.range.intersectRanges(t):s.range;if(!i)return s;const n=s.text.replaceAll(`\r
`,`
`),o=e.getValueInRange(i,uy.LF),r=sf(o,n),a=oc.ofText(o.substring(0,r)).addToPosition(s.range.getStartPosition()),c=n.substring(r),d=P.fromPositions(a,s.range.getEndPosition());return new ps(d,c)}function oge(s,e){return s.text.startsWith(e.text)&&aBe(s.range,e.range)}function aBe(s,e){return e.getStartPosition().equals(s.getStartPosition())&&e.getEndPosition().isBeforeOrEqual(s.getEndPosition())}function Gee(s,e,t,i,n=0){let o=Su(s,e);if(o.range.endLineNumber!==o.range.startLineNumber)return;const r=e.getLineContent(o.range.startLineNumber),a=lo(r).length;if(o.range.startColumn-1<=a){const v=lo(o.text).length,_=r.substring(o.range.startColumn-1,a),[w,C]=[o.range.getStartPosition(),o.range.getEndPosition()],k=w.column+_.length<=C.column?w.delta(0,_.length):C,D=P.fromPositions(k,C),A=o.text.startsWith(_)?o.text.substring(_.length):o.text.substring(v);o=new ps(D,A)}const d=e.getValueInRange(o.range),l=cBe(d,o.text);if(!l)return;const u=o.range.startLineNumber,g=new Array;if(t==="prefix"){const v=l.filter(_=>_.originalLength===0);if(v.length>1||v.length===1&&v[0].originalStart!==d.length)return}const m=o.text.length-n;for(const v of l){const _=o.range.startColumn+v.originalStart+v.originalLength;if(t==="subwordSmart"&&i&&i.lineNumber===o.range.startLineNumber&&_<i.column||v.originalLength>0)return;if(v.modifiedLength===0)continue;const w=v.modifiedStart+v.modifiedLength,C=Math.max(v.modifiedStart,Math.min(w,m)),k=o.text.substring(v.modifiedStart,C),D=o.text.substring(C,Math.max(v.modifiedStart,w));k.length>0&&g.push(new IL(_,k,!1)),D.length>0&&g.push(new IL(_,D,!0))}return new Ox(u,g)}let rk;function cBe(s,e){if(rk?.originalValue===s&&rk?.newValue===e)return rk?.changes;{let t=qee(s,e,!0);if(t){const i=zee(t);if(i>0){const n=qee(s,e,!1);n&&zee(n)<i&&(t=n)}}return rk={originalValue:s,newValue:e,changes:t},t}}function zee(s){let e=0;for(const t of s)e+=t.originalLength;return e}function qee(s,e,t){if(s.length>5e3||e.length>5e3)return;function i(d){let l=0;for(let u=0,g=d.length;u<g;u++){const m=d.charCodeAt(u);m>l&&(l=m)}return l}const n=Math.max(i(s),i(e));function o(d){if(d<0)throw new Error("unexpected");return n+d+1}function r(d){let l=0,u=0;const g=new Int32Array(d.length);for(let m=0,v=d.length;m<v;m++)if(t&&d[m]==="("){const _=u*100+l;g[m]=o(2*_),l++}else if(t&&d[m]===")"){l=Math.max(l-1,0);const _=u*100+l;g[m]=o(2*_+1),l===0&&u++}else g[m]=d.charCodeAt(m);return g}const a=r(s),c=r(e);return new Fbe({getElements:()=>a},{getElements:()=>c}).ComputeDiff(!1).changes}function dBe(s,e){let t,i=!1;const n=new Wbe(new Yne(s,void 0,e.update),(o,r)=>{i||(t=e.initial instanceof Function?e.initial():e.initial,i=!0);const a=e.update(o,t,r);return t=a,a},e.changeTracker,()=>{i&&(e.disposeFinal?.(t),i=!1)},e.equalityComparer??Qne,(o,r,a)=>{if(!i)throw new tn("Can only set when there is a listener! This is to prevent leaks.");Pk(r,c=>{t=o,n.setValue(o,c,a)})});return n}class lBe{constructor(){}static asEditOperations(e,t){const i=[];for(const n of e.edits){const o=P.fromPositions(t.getPositionAt(n.replaceRange.start),t.getPositionAt(n.replaceRange.start+n.replaceRange.length));i.push(qi.replace(o,n.newText))}return i}static fromContentChanges(e){const t=e.map(n=>new Sa(Hi.ofStartAndLength(n.rangeOffset,n.rangeLength),n.text));return t.reverse(),new Bp(t)}static fromLineRangeMapping(e,t,i){const n=[];for(const o of i)for(const r of o.innerChanges??[]){const a=t.getValueInRange(r.modifiedRange),c=e.getOffsetAt(r.originalRange.getStartPosition()),d=e.getOffsetAt(r.originalRange.getEndPosition()),l=new Hi(c,d);n.push(new Sa(l,a))}return new Bp(n)}}var i3;(function(s){function e(t,i){return t.isInlineEdit?aE.create(t,i):rE.create(t,i)}s.create=e})(i3||(i3={}));class rge{constructor(e,t,i){this._data=e,this.identity=t,this.displayLocation=i}get source(){return this._data.source}get isFromExplicitRequest(){return this._data.context.triggerKind===Gc.Explicit}get forwardStable(){return this.source.inlineSuggestions.enableForwardStability??!1}get editRange(){return this.getSingleTextEdit().range}get targetRange(){return this.displayLocation?.range??this.editRange}get insertText(){return this.getSingleTextEdit().text}get semanticId(){return this.hash}get action(){return this._sourceInlineCompletion.action}get command(){return this._sourceInlineCompletion.command}get warning(){return this._sourceInlineCompletion.warning}get showInlineEditMenu(){return!!this._sourceInlineCompletion.showInlineEditMenu}get hash(){return JSON.stringify([this.getSingleTextEdit().text,this.getSingleTextEdit().range.getStartPosition().toString()])}get shownCommand(){return this._sourceInlineCompletion.shownCommand}get _sourceInlineCompletion(){return this._data.sourceInlineCompletion}addRef(){this.identity.addRef(),this.source.addRef()}removeRef(){this.identity.removeRef(),this.source.removeRef()}reportInlineEditShown(e){this._data.reportInlineEditShown(e,this.insertText)}reportPartialAccept(e,t){this._data.reportPartialAccept(e,t)}reportEndOfLife(e){this._data.reportEndOfLife(e)}setEndOfLifeReason(e){this._data.setEndOfLifeReason(e)}getSourceCompletion(){return this._sourceInlineCompletion}}class y0{constructor(){this._onDispose=Kd(this),this.onDispose=this._onDispose,this._refCount=1,this.id="InlineCompletionIdentity"+y0.idCounter++}static{this.idCounter=0}addRef(){this._refCount++}removeRef(){this._refCount--,this._refCount===0&&this._onDispose.trigger(void 0)}}class Fx{static create(e,t){const i=new Hi(t.getOffsetAt(e.range.getStartPosition()),t.getOffsetAt(e.range.getEndPosition()));return new Fx(i,e.range,e.label)}constructor(e,t,i){this._offsetRange=e,this.range=t,this.label=i}withEdit(e,t){const i=ase([this._offsetRange],e)[0];if(!i||i.length!==this._offsetRange.length)return;const n=t.getRange(i);return new Fx(i,n,this.label)}}class rE extends rge{static create(e,t){const i=new y0,n=new ps(e.range,e.insertText),o=nA(t).getSingleOffsetEdit(n),r=e.displayLocation?Fx.create(e.displayLocation,t):void 0;return new rE(o,n,e.range,e.snippetInfo,e.additionalTextEdits,e,i,r)}constructor(e,t,i,n,o,r,a,c){super(r,a,c),this._edit=e,this._textEdit=t,this._originalRange=i,this.snippetInfo=n,this.additionalTextEdits=o,this.isInlineEdit=!1}getSingleTextEdit(){return this._textEdit}withIdentity(e){return new rE(this._edit,this._textEdit,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,e,this.displayLocation)}withEdit(e,t){const i=ase([this._edit.replaceRange],e);if(i.length===0)return;const n=new Sa(i[0],this._textEdit.text),o=nA(t),r=o.getSingleTextEdit(n);let a=this.displayLocation;if(!(a&&(a=a.withEdit(e,o),!a)))return new rE(n,r,this._originalRange,this.snippetInfo,this.additionalTextEdits,this._data,this.identity,a)}canBeReused(e,t){const i=this._textEdit.range;return!!i&&i.containsPosition(t)&&this.isVisible(e,t)&&oc.ofRange(i).isGreaterThanOrEqualTo(oc.ofRange(this._originalRange))}isVisible(e,t){const i=Su(this.getSingleTextEdit(),e);if(!this.editRange||!this._originalRange.getStartPosition().equals(this.editRange.getStartPosition())||t.lineNumber!==i.range.startLineNumber||i.isEmpty)return!1;const n=e.getValueInRange(i.range,uy.LF),o=i.text,r=Math.max(0,t.column-i.range.startColumn);let a=o.substring(0,r),c=o.substring(r),d=n.substring(0,r),l=n.substring(r);const u=e.getLineIndentColumn(i.range.startLineNumber);return i.range.startColumn<=u&&(d=d.trimStart(),d.length===0&&(l=l.trimStart()),a=a.trimStart(),a.length===0&&(c=c.trimStart())),a.startsWith(d)&&!!Bbe(l,c)}}class aE extends rge{static create(e,t){const i=hBe(t,e.range,e.insertText),n=new fy(t),r=hc.fromOffsetEdit(i,n).toSingle(n),a=new y0,c=i.edits.map(l=>{const u=P.fromPositions(t.getPositionAt(l.replaceRange.start),t.getPositionAt(l.replaceRange.endExclusive)),g=t.getValueInRange(u);return DL.create(l,g)}),d=e.displayLocation?Fx.create(e.displayLocation,t):void 0;return new aE(i,r,e,a,c,d,!1,t.getVersionId())}constructor(e,t,i,n,o,r,a=!1,c){super(i,n,r),this._edit=e,this._textEdit=t,this._edits=o,this._lastChangePartOfInlineEdit=a,this._inlineEditModelVersion=c,this.snippetInfo=void 0,this.additionalTextEdits=[],this.isInlineEdit=!0}get updatedEditModelVersion(){return this._inlineEditModelVersion}get updatedEdit(){return this._edit}getSingleTextEdit(){return this._textEdit}withIdentity(e){return new aE(this._edit,this._textEdit,this._data,e,this._edits,this.displayLocation,this._lastChangePartOfInlineEdit,this._inlineEditModelVersion)}canBeReused(e,t){return this._lastChangePartOfInlineEdit&&this.updatedEditModelVersion===e.getVersionId()}withEdit(e,t){return this._applyTextModelChanges(e,this._edits,t)}_applyTextModelChanges(e,t,i){if(t=t.map(u=>u.applyTextModelChanges(e)),t.some(u=>u.edit===void 0))return;const n=i.getVersionId();let o=this._inlineEditModelVersion;const r=t.some(u=>u.lastChangeUpdatedEdit);if(r&&(o=n??-1),n===null||o+20<n||(t=t.filter(u=>!u.edit.isEmpty),t.length===0))return;const a=new Bp(t.map(u=>u.edit)),c=nA(i),d=c.getTextEdit(a).toSingle(new fy(i));let l=this.displayLocation;if(!(l&&(l=l.withEdit(e,c),!l)))return new aE(a,d,this._data,this.identity,t,l,r,o)}}function hBe(s,e,t){const i=s.getEOL(),n=s.getValueInRange(e),o=t.replace(/\r\n|\r|\n/g,i),c=Vbe.getDefault().computeDiff(Ch(n),Ch(o),{ignoreTrimWhitespace:!1,computeMoves:!1,extendToSubwords:!0,maxComputationTimeMs:500}).changes.flatMap(g=>g.innerChanges??[]);function d(g,m){const v=oc.fromPosition(m.getStartPosition());return oc.ofRange(m).createRange(v.addToPosition(g))}const l=new K_(o);return new Bp(c.map(g=>{const m=d(e.getStartPosition(),g.originalRange),v=nA(s).getOffsetRange(m),_=l.getValueOfRange(g.modifiedRange),w=new Sa(v,_),C=s.getValueInRange(m);return uBe(w,C,c.length,s)}))}class DL{static create(e,t){const i=sf(e.newText,t),n=Xz(e.newText,t),o=e.newText.substring(i,e.newText.length-n);return new DL(e,o,i,n)}get edit(){return this._edit}get lastChangeUpdatedEdit(){return this._lastChangeUpdatedEdit}constructor(e,t,i,n,o=!1){this._edit=e,this._trimmedNewText=t,this._prefixLength=i,this._suffixLength=n,this._lastChangeUpdatedEdit=o}applyTextModelChanges(e){const t=this._clone();return t._applyTextModelChanges(e),t}_clone(){return new DL(this._edit,this._trimmedNewText,this._prefixLength,this._suffixLength,this._lastChangeUpdatedEdit)}_applyTextModelChanges(e){if(this._lastChangeUpdatedEdit=!1,!this._edit)throw new tn("UpdatedInnerEdits: No edit to apply changes to");const t=this._applyChanges(this._edit,e);if(!t){this._edit=void 0;return}this._edit=t.edit,this._lastChangeUpdatedEdit=t.editHasChanged}_applyChanges(e,t){let i=e.replaceRange.start,n=e.replaceRange.endExclusive,o=e.newText,r=!1;const a=this._prefixLength>0||this._suffixLength>0;for(let c=t.edits.length-1;c>=0;c--){const d=t.edits[c],l=d.newText.length>0&&d.replaceRange.isEmpty;if(l&&!a&&d.replaceRange.start===i&&o.startsWith(d.newText)){i+=d.newText.length,o=o.substring(d.newText.length),n=Math.max(i,n),r=!0;continue}if(l&&a&&d.replaceRange.start===i+this._prefixLength&&this._trimmedNewText.startsWith(d.newText)){n+=d.newText.length,r=!0,this._prefixLength+=d.newText.length,this._trimmedNewText=this._trimmedNewText.substring(d.newText.length);continue}if(d.newText.length===0&&d.replaceRange.length>0&&d.replaceRange.start>=i+this._prefixLength&&d.replaceRange.endExclusive<=n-this._suffixLength){n-=d.replaceRange.length,r=!0;continue}if(d.equals(e)){r=!0,i=d.replaceRange.endExclusive,o="";continue}if(!(d.replaceRange.start>n)){if(d.replaceRange.endExclusive<i){i+=d.newText.length-d.replaceRange.length,n+=d.newText.length-d.replaceRange.length;continue}return}}return this._trimmedNewText.length===0&&i+this._prefixLength===n-this._suffixLength?{edit:new Sa(new Hi(i+this._prefixLength,i+this._prefixLength),""),editHasChanged:!0}:{edit:new Sa(new Hi(i,n),o),editHasChanged:r}}}function uBe(s,e,t,i){const n=i.getEOL();if(s.newText.endsWith(n)&&e.endsWith(n)&&(s=new Sa(s.replaceRange.deltaEnd(-n.length),s.newText.slice(0,-n.length))),t===1&&s.replaceRange.isEmpty&&s.newText.includes(n)&&(s=gBe(s,i)),t===1){const o=sf(e,s.newText),r=Xz(e.slice(o),s.newText.slice(o));if(o+r===e.length)return new Sa(s.replaceRange.deltaStart(o).deltaEnd(-r),s.newText.substring(o,s.newText.length-r));if(o+r===s.newText.length)return new Sa(s.replaceRange.deltaStart(o).deltaEnd(-r),"")}return s}function gBe(s,e){if(!s.replaceRange.isEmpty)throw new tn("Unexpected original range");if(s.replaceRange.start===0)return s;const t=e.getEOL(),i=e.getPositionAt(s.replaceRange.start),n=i.column,o=i.lineNumber;return n===1&&o>1&&e.getLineLength(o)!==0&&s.newText.endsWith(t)&&!s.newText.startsWith(t)?new Sa(s.replaceRange.delta(-1),t+s.newText.slice(0,-t.length)):s}function pBe(s,e){const t=new Gbe,i=new Ube(t,d=>e.getLanguageConfiguration(d)),n=new Hbe(new fBe([s]),i),o=$be(n,[],void 0,!0);let r="";const a=s.getLineContent();function c(d,l){if(d.kind===CS.Pair)if(c(d.openingBracket,l),l=ES(l,d.openingBracket.length),d.child&&(c(d.child,l),l=ES(l,d.child.length)),d.closingBracket)c(d.closingBracket,l),l=ES(l,d.closingBracket.length);else{const g=i.getSingleLanguageBracketTokens(d.openingBracket.languageId).findClosingTokenText(d.openingBracket.bracketIds);r+=g}else if(d.kind!==CS.UnexpectedClosingBracket){if(d.kind===CS.Text||d.kind===CS.Bracket)r+=a.substring(o8(l),o8(ES(l,d.length)));else if(d.kind===CS.List)for(const u of d.children)c(u,l),l=ES(l,u.length)}}return c(o,zbe),r}class fBe{constructor(e){this.lines=e,this.tokenization={getLineTokens:t=>this.lines[t-1]}}getValue(){return this.lines.map(e=>e.getLineContent()).join(`
`)}getLineCount(){return this.lines.length}getLineLength(e){return this.lines[e-1].getLineContent().length}}async function mBe(s,e,t,i,n=Ce.None,o){const r=Pn(),a=new li(n),c=a.token,d={...i,requestUuid:r},l=e instanceof we?SBe(e,t):e,u=new one;for(const D of s)D.groupId&&u.add(D.groupId,D);function g(D){if(!D.yieldsToGroupIds)return[];const A=[];for(const B of D.yieldsToGroupIds||[]){const q=u.get(B);for(const Q of q)A.push(Q)}return A}function m(D,A,B){if(A=[...A,D],B.has(D))return A;B.add(D);try{const q=g(D);for(const Q of q){const ie=m(Q,A,B);if(ie)return ie}}finally{B.delete(D)}}function v(D,A){const B=A.get(D);if(B)return B;const q=m(D,[],new Set);q&&Ln(new Error(`Inline completions: cyclic yield-to dependency detected. Path: ${q.map(ie=>ie.toString?ie.toString():""+ie).join(" -> ")}`));const Q=new aa;return A.set(D,Q.p),(async()=>{if(!q){const ie=g(D);for(const oe of ie){const be=await v(oe,A);if(be&&be.inlineSuggestions.items.length>0)return}}return _(D)})().then(ie=>Q.complete(ie),ie=>Q.error(ie)),Q.p}async function _(D){let A;try{e instanceof we?A=await D.provideInlineCompletions(t,e,d,c):A=await D.provideInlineEditsForRange?.(t,e,d,c)}catch(Q){Ln(Q);return}if(!A)return;const B=[],q=new wBe(A,B,D);for(const Q of A.items)B.push(bBe(Q,q,l,t,o,d));return vBe(c,()=>q.removeRef()),q}const w=new Map,C=Xa.fromPromisesResolveOrder(s.map(D=>v(D,w)));if(c.isCancellationRequested)return a.dispose(!0),new age([],new Set,[]);const k=await _Be(d,C,t);return a.dispose(!0),k}function vBe(s,e){if(s.isCancellationRequested)return e(),F.None;{const t=s.onCancellationRequested(()=>{t.dispose(),e()});return{dispose:()=>t.dispose()}}}async function _Be(s,e,t){const i=new Map;let n=!1;const o=[];for await(const r of e)if(r){r.addRef(),o.push(r);for(const a of r.inlineSuggestionsData)!s.includeInlineEdits&&(a.isInlineEdit||a.showInlineEditMenu)||!s.includeInlineCompletions&&!(a.isInlineEdit||a.showInlineEditMenu)||(i.set(cge(a.getSingleTextEdit()),a),!(a.isInlineEdit||a.showInlineEditMenu)&&s.triggerKind===Gc.Automatic&&(a.getSingleTextEdit().removeCommonPrefix(new fy(t)).isEmpty||(n=!0)));if(n)break}return new age(Array.from(i.values()),new Set(i.keys()),o)}class age{constructor(e,t,i){this.completions=e,this.hashs=t,this.providerResults=i}has(e){return this.hashs.has(cge(e))}isEmpty(){return this.completions.length===0||this.completions.every(e=>e.range.isEmpty()&&e.insertText.length===0)}dispose(){for(const e of this.providerResults)e.removeRef()}}function cge(s){return JSON.stringify([s.text,s.range.getStartPosition().toString()])}function bBe(s,e,t,i,n,o){let r,a,c=s.range?P.lift(s.range):t;if(typeof s.insertText=="string"){if(r=s.insertText,n&&s.completeBracketPairs){r=Kee(r,c.getStartPosition(),i,n);const l=r.length-s.insertText.length;l!==0&&(c=new P(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn+l))}a=void 0}else if("snippet"in s.insertText){const l=s.insertText.snippet.length;if(n&&s.completeBracketPairs){s.insertText.snippet=Kee(s.insertText.snippet,c.getStartPosition(),i,n);const g=s.insertText.snippet.length-l;g!==0&&(c=new P(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn+g))}const u=new fd().parse(s.insertText.snippet);u.children.length===1&&u.children[0]instanceof vr?(r=u.children[0].value,a=void 0):(r=u.toString(),a={snippet:s.insertText.snippet,range:c})}else sd();const d=s.displayLocation?{range:P.lift(s.displayLocation.range),label:s.displayLocation.label}:void 0;return new yBe(c,r,a,d,s.additionalTextEdits||ZWe(),s,e,o,s.isInlineEdit??!1)}class yBe{constructor(e,t,i,n,o,r,a,c,d){this.range=e,this.insertText=t,this.snippetInfo=i,this.displayLocation=n,this.additionalTextEdits=o,this.sourceInlineCompletion=r,this.source=a,this.context=c,this.isInlineEdit=d,this._didShow=!1,this._didReportEndOfLife=!1,this._lastSetEndOfLifeReason=void 0}get showInlineEditMenu(){return this.sourceInlineCompletion.showInlineEditMenu??!1}getSingleTextEdit(){return new ps(this.range,this.insertText)}async reportInlineEditShown(e,t){this._didShow||(this._didShow=!0,this.source.provider.handleItemDidShow?.(this.source.inlineSuggestions,this.sourceInlineCompletion,t),this.sourceInlineCompletion.shownCommand&&await e.executeCommand(this.sourceInlineCompletion.shownCommand.id,...this.sourceInlineCompletion.shownCommand.arguments||[]))}reportPartialAccept(e,t){this.source.provider.handlePartialAccept?.(this.source.inlineSuggestions,this.sourceInlineCompletion,e,t)}reportEndOfLife(e){this._didReportEndOfLife||(this._didReportEndOfLife=!0,e||(e=this._lastSetEndOfLifeReason??{kind:Np.Ignored,userTypingDisagreed:!1,supersededBy:void 0}),e.kind===Np.Rejected&&this.source.provider.handleRejection&&this.source.provider.handleRejection(this.source.inlineSuggestions,this.sourceInlineCompletion),this.source.provider.handleEndOfLifetime&&this.source.provider.handleEndOfLifetime(this.source.inlineSuggestions,this.sourceInlineCompletion,e))}setEndOfLifeReason(e){this._lastSetEndOfLifeReason=e}}class wBe{constructor(e,t,i){this.inlineSuggestions=e,this.inlineSuggestionsData=t,this.provider=i,this.refCount=1}addRef(){this.refCount++}removeRef(){if(this.refCount--,this.refCount===0){for(const e of this.inlineSuggestionsData)e.reportEndOfLife();this.provider.freeInlineCompletions(this.inlineSuggestions)}}}function SBe(s,e){const t=e.getWordAtPosition(s),i=e.getLineMaxColumn(s.lineNumber);return t?new P(s.lineNumber,t.startColumn,s.lineNumber,i):P.fromPositions(s,s.with(void 0,i))}function Kee(s,e,t,i){const n=t.getLineContent(e.lineNumber),o=Sa.replace(new Hi(e.column-1,n.length),s),a=t.tokenization.tokenizeLinesAt(e.lineNumber,[o.apply(n)])?.[0].sliceZeroCopy(o.getRangeAfterApply());return a?pBe(a,i):s}function CBe(s){return{createChangeSummary:e=>({changes:[]}),handleChange(e,t){for(const i in s)e.didChange(s[i])&&t.changes.push({key:i,change:e.change});return!0},beforeUpdate(e,t){for(const i in s){if(i==="changes")throw new tn('property name "changes" is reserved for change tracking');t[i]=s[i].read(e)}}}}var n3;let s3=class extends F{static{n3=this}static{this._requestId=0}constructor(e,t,i,n,o,r,a){super(),this._textModel=e,this._versionId=t,this._debounceValue=i,this._languageConfigurationService=n,this._logService=o,this._configurationService=r,this._instantiationService=a,this._updateOperation=this._register(new Pt),this._loggingEnabled=Vse("editor.inlineSuggest.logFetch",!1,this._configurationService).recomputeInitiallyAndOnChange(this._store),this._structuredFetchLogger=this._register(this._instantiationService.createInstance(xL.cast(),"editor.inlineSuggest.logFetch.commandId")),this._state=dBe(this,{initial:()=>({inlineCompletions:Hc.createEmpty(),suggestWidgetInlineCompletions:Hc.createEmpty()}),disposeFinal:c=>{c.inlineCompletions.dispose(),c.suggestWidgetInlineCompletions.dispose()},changeTracker:CBe({versionId:this._versionId}),update:(c,d,l)=>{const u=Bp.join(l.changes.map(g=>g.change?lBe.fromContentChanges(g.change.changes):Bp.empty).filter(wa));if(u.isEmpty)return d;try{return{inlineCompletions:d.inlineCompletions.createStateWithAppliedEdit(u,this._textModel),suggestWidgetInlineCompletions:d.suggestWidgetInlineCompletions.createStateWithAppliedEdit(u,this._textModel)}}finally{d.inlineCompletions.dispose(),d.suggestWidgetInlineCompletions.dispose()}}}),this.inlineCompletions=this._state.map(this,c=>c.inlineCompletions),this.suggestWidgetInlineCompletions=this._state.map(this,c=>c.suggestWidgetInlineCompletions),this.clearOperationOnTextModelChange=ve(this,c=>{this._versionId.read(c),this._updateOperation.clear()}),this._loadingCount=si(this,0),this.loading=this._loadingCount.map(this,c=>c>0),this.clearOperationOnTextModelChange.recomputeInitiallyAndOnChange(this._store)}_log(e){this._loggingEnabled.get()&&this._logService.info(YWe(e)),this._structuredFetchLogger.log(e)}fetch(e,t,i,n,o,r,a){const c=new EBe(t,i,this._textModel.getVersionId()),d=i.selectedSuggestionInfo?this.suggestWidgetInlineCompletions.get():this.inlineCompletions.get();if(!a&&this._updateOperation.value?.request.satisfies(c))return this._updateOperation.value.promise;if(d?.request?.satisfies(c))return Promise.resolve(!0);const l=!!this._updateOperation.value;this._updateOperation.clear();const u=new li,g=(async()=>{this._loadingCount.set(this._loadingCount.get()+1,void 0);try{const v=this._debounceValue.get(this._textModel),_=qbe(e.map(q=>q.debounceDelayMs),Kbe(fl))??v;if((l||o&&i.triggerKind===Gc.Automatic)&&await sBe(_,u.token),u.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)return!1;const C=n3._requestId++;(this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get())&&this._log({sourceId:"InlineCompletions.fetch",kind:"start",requestId:C,modelUri:this._textModel.uri.toString(),modelVersion:this._textModel.getVersionId(),context:{triggerKind:i.triggerKind},time:Date.now()});const k=new Date;let D,A;try{D=await mBe(e,t,this._textModel,i,u.token,this._languageConfigurationService)}catch(q){throw A=q,q}finally{if(this._loggingEnabled.get()||this._structuredFetchLogger.isEnabled.get()){(u.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId)&&(A="canceled");const q=D?.completions.map(Q=>({range:Q.range.toString(),text:Q.insertText,isInlineEdit:!!Q.isInlineEdit,source:Q.source.provider.groupId}));this._log({sourceId:"InlineCompletions.fetch",kind:"end",requestId:C,durationMs:Date.now()-k.getTime(),error:A,result:q,time:Date.now()})}}if(u.token.isCancellationRequested||this._store.isDisposed||this._textModel.getVersionId()!==c.versionId||r.get())return D.dispose(),!1;const B=new Date;this._debounceValue.update(this._textModel,B.getTime()-k.getTime()),this._updateOperation.clear(),gs(q=>{const Q=this._state.get();i.selectedSuggestionInfo?this._state.set({inlineCompletions:Hc.createEmpty(),suggestWidgetInlineCompletions:Q.suggestWidgetInlineCompletions.createStateWithAppliedResults(D,c,this._textModel,n)},q):this._state.set({inlineCompletions:Q.inlineCompletions.createStateWithAppliedResults(D,c,this._textModel,n),suggestWidgetInlineCompletions:Hc.createEmpty()},q),D.dispose(),Q.inlineCompletions.dispose(),Q.suggestWidgetInlineCompletions.dispose()})}finally{this._loadingCount.set(this._loadingCount.get()-1,void 0)}return!0})(),m=new xBe(c,u,g);return this._updateOperation.value=m,g}clear(e){this._updateOperation.clear();const t=this._state.get();this._state.set({inlineCompletions:Hc.createEmpty(),suggestWidgetInlineCompletions:Hc.createEmpty()},e),t.inlineCompletions.dispose(),t.suggestWidgetInlineCompletions.dispose()}seedInlineCompletionsWithSuggestWidget(){const e=this.inlineCompletions.get(),t=this.suggestWidgetInlineCompletions.get();t&&gs(i=>{if(!e||(t.request?.versionId??-1)>(e.request?.versionId??-1)){e?.dispose();const n=this._state.get();this._state.set({inlineCompletions:t.clone(),suggestWidgetInlineCompletions:Hc.createEmpty()},i),n.inlineCompletions.dispose(),n.suggestWidgetInlineCompletions.dispose()}this.clearSuggestWidgetInlineCompletions(i)})}clearSuggestWidgetInlineCompletions(e){this._updateOperation.value?.request.context.selectedSuggestionInfo&&this._updateOperation.clear()}cancelUpdate(){this._updateOperation.clear()}};s3=n3=f([p(3,ds),p(4,Re),p(5,ne),p(6,Z)],s3);class EBe{constructor(e,t,i){this.position=e,this.context=t,this.versionId=i}satisfies(e){return this.position.equals(e.position)&&cse(this.context.selectedSuggestionInfo,e.context.selectedSuggestionInfo,dse())&&(e.context.triggerKind===Gc.Automatic||this.context.triggerKind===Gc.Explicit)&&this.versionId===e.versionId}get isExplicitRequest(){return this.context.triggerKind===Gc.Explicit}}class xBe{constructor(e,t,i){this.request=e,this.cancellationTokenSource=t,this.promise=i}dispose(){this.cancellationTokenSource.cancel()}}class Hc extends F{static createEmpty(){return new Hc([],void 0)}constructor(e,t){for(const i of e)i.addRef();super(),this.inlineCompletions=e,this.request=t,this._register({dispose:()=>{for(const i of this.inlineCompletions)i.removeRef()}})}_findById(e){return this.inlineCompletions.find(t=>t.identity===e)}_findByHash(e){return this.inlineCompletions.find(t=>t.hash===e)}createStateWithAppliedEdit(e,t){const i=this.inlineCompletions.map(n=>n.withEdit(e,t)).filter(wa);return new Hc(i,this.request)}createStateWithAppliedResults(e,t,i,n){const o=[];for(const r of e.completions){const a=i3.create(r,i),c=this._findByHash(a.hash);c?(o.push(a.withIdentity(c.identity)),c.setEndOfLifeReason({kind:Np.Ignored,userTypingDisagreed:!1,supersededBy:a.getSourceCompletion()})):o.push(a)}if(n){const r=this._findById(n);r&&!e.has(r.getSingleTextEdit())&&r.canBeReused(i,t.position)&&o.unshift(r)}return new Hc(o,t)}clone(){return new Hc(this.inlineCompletions,this.request)}}class IBe{constructor(e,t,i){this.edit=e,this.commands=t,this.inlineCompletion=i}get range(){return this.edit.range}get text(){return this.edit.text}equals(e){return this.edit.equals(e.edit)&&this.inlineCompletion===e.inlineCompletion}}let o3=class extends F{get isAcceptingPartially(){return this._isAcceptingPartially}constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(),this.textModel=e,this._selectedSuggestItem=t,this._textModelVersionId=i,this._positions=n,this._debounceValue=o,this._enabled=r,this._editor=a,this._instantiationService=c,this._commandService=d,this._languageConfigurationService=l,this._accessibilityService=u,this._languageFeaturesService=g,this._source=this._register(this._instantiationService.createInstance(s3,this.textModel,this._textModelVersionId,this._debounceValue)),this._isActive=si(this,!1),this._onlyRequestInlineEditsSignal=Kd(this),this._forceUpdateExplicitlySignal=Kd(this),this._noDelaySignal=Kd(this),this._fetchSpecificProviderSignal=Kd(this),this._selectedInlineCompletionId=si(this,void 0),this.primaryPosition=ve(this,_=>this._positions.read(_)[0]??new we(1,1)),this._isAcceptingPartially=!1,this._onDidAccept=new M,this.onDidAccept=this._onDidAccept.event,this._editorObs=Rs(this._editor),this._suggestPreviewEnabled=this._editorObs.getOption(L.suggest).map(_=>_.preview),this._suggestPreviewMode=this._editorObs.getOption(L.suggest).map(_=>_.previewMode),this._inlineSuggestMode=this._editorObs.getOption(L.inlineSuggest).map(_=>_.mode),this._inlineEditsEnabled=this._editorObs.getOption(L.inlineSuggest).map(_=>!!_.edits.enabled),this._inlineEditsShowCollapsedEnabled=this._editorObs.getOption(L.inlineSuggest).map(_=>_.edits.showCollapsed),this._lastShownInlineCompletionInfo=void 0,this._lastAcceptedInlineCompletionInfo=void 0,this._didUndoInlineEdits=r8({owner:this,changeTracker:{createChangeSummary:()=>({didUndo:!1}),handleChange:(_,w)=>(w.didUndo=_.didChange(this._textModelVersionId)&&!!_.change?.isUndoing,!0)}},(_,w)=>{const C=this._textModelVersionId.read(_);return C!==null&&this._lastAcceptedInlineCompletionInfo&&this._lastAcceptedInlineCompletionInfo.textModelVersionIdAfter===C-1&&this._lastAcceptedInlineCompletionInfo.inlineCompletion.isInlineEdit&&w.didUndo?(this._lastAcceptedInlineCompletionInfo=void 0,!0):!1}),this._preserveCurrentCompletionReasons=new Set([au.Redo,au.Undo,au.AcceptWord]),this.dontRefetchSignal=Kd(this),this._fetchInlineCompletionsPromise=r8({owner:this,changeTracker:{createChangeSummary:()=>({dontRefetch:!1,preserveCurrentCompletion:!1,inlineCompletionTriggerKind:Gc.Automatic,onlyRequestInlineEdits:!1,shouldDebounce:!0,provider:void 0}),handleChange:(_,w)=>(_.didChange(this._textModelVersionId)&&this._preserveCurrentCompletionReasons.has(this._getReason(_.change))?w.preserveCurrentCompletion=!0:_.didChange(this._forceUpdateExplicitlySignal)?w.inlineCompletionTriggerKind=Gc.Explicit:_.didChange(this.dontRefetchSignal)?w.dontRefetch=!0:_.didChange(this._onlyRequestInlineEditsSignal)?w.onlyRequestInlineEdits=!0:_.didChange(this._fetchSpecificProviderSignal)&&(w.provider=_.change),!0)}},(_,w)=>{if(this._source.clearOperationOnTextModelChange.read(_),this._noDelaySignal.read(_),this.dontRefetchSignal.read(_),this._onlyRequestInlineEditsSignal.read(_),this._forceUpdateExplicitlySignal.read(_),this._fetchSpecificProviderSignal.read(_),!(this._enabled.read(_)&&this._selectedSuggestItem.read(_)||this._isActive.read(_))){this._source.cancelUpdate();return}this._textModelVersionId.read(_);const k=this._source.suggestWidgetInlineCompletions.get(),D=this._selectedSuggestItem.read(_);k&&!D&&this._source.seedInlineCompletionsWithSuggestWidget();const A=this.primaryPosition.get();if(w.dontRefetch)return Promise.resolve(!0);if(this._didUndoInlineEdits.read(_)&&w.inlineCompletionTriggerKind!==Gc.Explicit){gs(be=>{this._source.clear(be)});return}let B={triggerKind:w.inlineCompletionTriggerKind,selectedSuggestionInfo:D?.toSelectedSuggestionInfo(),includeInlineCompletions:!w.onlyRequestInlineEdits,includeInlineEdits:this._inlineEditsEnabled.read(_)};B.triggerKind===Gc.Automatic&&this.textModel.getAlternativeVersionId()===this._lastShownInlineCompletionInfo?.alternateTextModelVersionId&&(B={...B,includeInlineCompletions:!this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit,includeInlineEdits:this._lastShownInlineCompletionInfo.inlineCompletion.isInlineEdit});const q=this.selectedInlineCompletion.get()??this._inlineCompletionItems.get()?.inlineEdit,Q=w.preserveCurrentCompletion||q?.forwardStable?q:void 0,ie=this._jumpedToId.map(be=>!!be&&be===this._inlineCompletionItems.get()?.inlineEdit?.semanticId),oe=w.provider?[w.provider]:this._languageFeaturesService.inlineCompletionsProvider.all(this.textModel);return this._source.fetch(oe,A,B,Q?.identity,w.shouldDebounce,ie,!!w.provider)}),this._inlineCompletionItems=Yl({owner:this},_=>{const w=this._source.inlineCompletions.read(_);if(!w)return;const C=this.primaryPosition.read(_);let k;const D=[];for(const A of w.inlineCompletions)A.isInlineEdit?k=A:A.isVisible(this.textModel,C)&&D.push(A);return D.length!==0&&(k=void 0),{inlineCompletions:D,inlineEdit:k}}),this._filteredInlineCompletionItems=Yl({owner:this,equalsFn:a8()},_=>this._inlineCompletionItems.read(_)?.inlineCompletions??[]),this.selectedInlineCompletionIndex=ve(this,_=>{const w=this._selectedInlineCompletionId.read(_),C=this._filteredInlineCompletionItems.read(_),k=this._selectedInlineCompletionId===void 0?-1:C.findIndex(D=>D.semanticId===w);return k===-1?(this._selectedInlineCompletionId.set(void 0,void 0),0):k}),this.selectedInlineCompletion=ve(this,_=>{const w=this._filteredInlineCompletionItems.read(_),C=this.selectedInlineCompletionIndex.read(_);return w[C]}),this.activeCommands=Yl({owner:this,equalsFn:a8()},_=>this.selectedInlineCompletion.read(_)?.source.inlineSuggestions.commands??[]),this.lastTriggerKind=this._source.inlineCompletions.map(this,_=>_?.request?.context.triggerKind),this.inlineCompletionsCount=ve(this,_=>{if(this.lastTriggerKind.read(_)===Gc.Explicit)return this._filteredInlineCompletionItems.read(_).length}),this._hasVisiblePeekWidgets=ve(this,_=>this._editorObs.openedPeekWidgets.read(_)>0),this.state=Yl({owner:this,equalsFn:(_,w)=>!_||!w?_===w:_.kind==="ghostText"&&w.kind==="ghostText"?$ee(_.ghostTexts,w.ghostTexts)&&_.inlineCompletion===w.inlineCompletion&&_.suggestItem===w.suggestItem:_.kind==="inlineEdit"&&w.kind==="inlineEdit"?_.inlineEdit.equals(w.inlineEdit):!1},_=>{const w=this.textModel,k=this._inlineCompletionItems.read(_)?.inlineEdit;if(k){if(this._hasVisiblePeekWidgets.read(_))return;let A=k.getSingleTextEdit();A=Su(A,w);const B=this.primaryPosition.map(be=>xr.fromRangeInclusive(k.targetRange).addMargin(1,1).contains(be.lineNumber)),q=k.source.inlineSuggestions.commands,Q=new IBe(A,q??[],k),ie=k.updatedEdit,oe=ie?hc.fromOffsetEdit(ie,new fy(this.textModel)).edits:[A];return{kind:"inlineEdit",inlineEdit:Q,inlineCompletion:k,edits:oe,cursorAtInlineEdit:B}}const D=this._selectedSuggestItem.read(_);if(D){const A=Su(D.getSingleTextEdit(),w),B=this._computeAugmentation(A,_);if(!this._suggestPreviewEnabled.read(_)&&!B)return;const Q=B?.edit??A,ie=B?B.edit.text.length-A.text.length:0,oe=this._suggestPreviewMode.read(_),be=this._positions.read(_),me=[Q,...X1(this.textModel,be,Q)],zt=me.map((Qt,Ae)=>Gee(Qt,w,oe,be[Ae],ie)).filter(wa),ft=zt[0]??new Ox(Q.range.endLineNumber,[]);return{kind:"ghostText",edits:me,primaryGhostText:ft,ghostTexts:zt,inlineCompletion:B?.completion,suggestItem:D}}else{if(!this._isActive.read(_))return;const A=this.selectedInlineCompletion.read(_);if(!A)return;const B=A.getSingleTextEdit(),q=this._inlineSuggestMode.read(_),Q=this._positions.read(_),ie=[B,...X1(this.textModel,Q,B)],oe=ie.map((be,me)=>Gee(be,w,q,Q[me],0)).filter(wa);return oe[0]?{kind:"ghostText",edits:ie,primaryGhostText:oe[0],ghostTexts:oe,inlineCompletion:A,suggestItem:void 0}:void 0}}),this.status=ve(this,_=>{if(this._source.loading.read(_))return"loading";const w=this.state.read(_);return w?.kind==="ghostText"?"ghostText":w?.kind==="inlineEdit"?"inlineEdit":"noSuggestion"}),this.inlineCompletionState=ve(this,_=>{const w=this.state.read(_);if(!(!w||w.kind!=="ghostText")&&!this._editorObs.inComposition.read(_))return w}),this.inlineEditState=ve(this,_=>{const w=this.state.read(_);if(!(!w||w.kind!=="inlineEdit"))return w}),this.inlineEditAvailable=ve(this,_=>!!this.inlineEditState.read(_)),this.warning=ve(this,_=>this.inlineCompletionState.read(_)?.inlineCompletion?.warning),this.ghostTexts=Yl({owner:this,equalsFn:$ee},_=>{const w=this.inlineCompletionState.read(_);if(w)return w.ghostTexts}),this.primaryGhostText=Yl({owner:this,equalsFn:sge},_=>{const w=this.inlineCompletionState.read(_);if(w)return w?.primaryGhostText}),this.showCollapsed=ve(this,_=>{const w=this.state.read(_);if(!w||w.kind!=="inlineEdit"||w.inlineCompletion.displayLocation)return!1;const C=w.inlineCompletion.updatedEditModelVersion===this._textModelVersionId.read(_);return(this._inlineEditsShowCollapsedEnabled.read(_)||!C)&&this._jumpedToId.read(_)!==w.inlineCompletion.semanticId&&!this._inAcceptFlow.read(_)}),this._tabShouldIndent=ve(this,_=>{if(this._inAcceptFlow.read(_))return!1;function w(D){return D.startLineNumber!==D.endLineNumber}function C(D,A){const B=D.getLineIndentColumn(A),q=D.getLineLastNonWhitespaceColumn(A),Q=Math.max(q,B);return new P(A,B,A,Q)}return this._editorObs.selections.read(_)?.some(D=>D.isEmpty()?this.textModel.getLineLength(D.startLineNumber)===0:w(D)||D.containsRange(C(this.textModel,D.startLineNumber)))}),this.tabShouldJumpToInlineEdit=ve(this,_=>{if(this._tabShouldIndent.read(_))return!1;const w=this.inlineEditState.read(_);return w?this.showCollapsed.read(_)?!0:!w.cursorAtInlineEdit.read(_):!1}),this.tabShouldAcceptInlineEdit=ve(this,_=>{const w=this.inlineEditState.read(_);return!w||this.showCollapsed.read(_)?!1:w.inlineCompletion.targetRange.startLineNumber===this._editorObs.cursorLineNumber.read(_)||this._jumpedToId.read(_)===w.inlineCompletion.semanticId?!0:this._tabShouldIndent.read(_)?!1:w.cursorAtInlineEdit.read(_)}),this._jumpedToId=si(this,void 0),this._inAcceptFlow=si(this,!1),this.inAcceptFlow=this._inAcceptFlow,this._register(tse(this._fetchInlineCompletionsPromise)),this._register(fi(_=>{const C=this.inlineCompletionState.read(_)?.inlineCompletion;C&&this.handleInlineSuggestionShown(C)})),this._register(fi(_=>{this._editorObs.versionId.read(_),this._inAcceptFlow.set(!1,void 0)})),this._register(fi(_=>{this.state.map((C,k)=>!C||C.kind==="inlineEdit"&&!C.cursorAtInlineEdit.read(k)).read(_)&&this._jumpedToId.set(void 0,void 0)}));const m=this.inlineEditState.map(_=>_?.inlineCompletion.semanticId);this._register(fi(_=>{m.read(_)&&(this._editor.pushUndoStop(),this._lastShownInlineCompletionInfo={alternateTextModelVersionId:this.textModel.getAlternativeVersionId(),inlineCompletion:this.state.get().inlineCompletion})}));const v=kn(this._languageFeaturesService.inlineCompletionsProvider.onDidChange,()=>this._languageFeaturesService.inlineCompletionsProvider.all(e));this._register(ka((_,w)=>{const C=v.read(_);for(const k of C)k.onDidChangeInlineCompletions&&w.add(k.onDidChangeInlineCompletions(()=>{if(!this._enabled.get())return;const D=this.state.get();D&&(D.inlineCompletion||D.edits)&&D.inlineCompletion?.source.provider!==k||gs(A=>{this._fetchSpecificProviderSignal.trigger(A,k),this.trigger(A)})}))})),this._didUndoInlineEdits.recomputeInitiallyAndOnChange(this._store)}debugGetSelectedSuggestItem(){return this._selectedSuggestItem}getIndentationInfo(e){let t=!1,i=!0;const n=this?.primaryGhostText.read(e);if(this?._selectedSuggestItem&&n&&n.parts.length>0){const{column:o,lines:r}=n.parts[0],a=r[0].line,c=this.textModel.getLineIndentColumn(n.lineNumber);if(o<=c){let l=qF(a);l===-1&&(l=a.length-1),t=l>0;const u=this.textModel.getOptions().tabSize;i=jbe.visibleColumnFromColumn(a,l+1,u)<u}}return{startsWithIndentation:t,startsWithIndentationLessThanTabSize:i}}_getReason(e){return e?.isUndoing?au.Undo:e?.isRedoing?au.Redo:this.isAcceptingPartially?au.AcceptWord:au.Other}async trigger(e,t){Pk(e,i=>{t?.onlyFetchInlineEdits&&this._onlyRequestInlineEditsSignal.trigger(i),t?.noDelay&&this._noDelaySignal.trigger(i),this._isActive.set(!0,i)}),await this._fetchInlineCompletionsPromise.get()}async triggerExplicitly(e,t=!1){Pk(e,i=>{t&&this._onlyRequestInlineEditsSignal.trigger(i),this._isActive.set(!0,i),this._inAcceptFlow.set(!0,i),this._forceUpdateExplicitlySignal.trigger(i)}),await this._fetchInlineCompletionsPromise.get()}stop(e="automatic",t){Pk(t,i=>{if(e==="explicitCancel"){const n=this.state.get()?.inlineCompletion;n&&n.reportEndOfLife({kind:Np.Rejected})}this._isActive.set(!1,i),this._source.clear(i)})}_computeAugmentation(e,t){const i=this.textModel,n=this._source.suggestWidgetInlineCompletions.read(t),o=n?n.inlineCompletions.filter(a=>!a.isInlineEdit):[this.selectedInlineCompletion.read(t)].filter(wa);return OF(o,a=>{let c=a.getSingleTextEdit();return c=Su(c,i,P.fromPositions(c.range.getStartPosition(),e.range.getEndPosition())),oge(c,e)?{completion:a,edit:c}:void 0})}async _deltaSelectedInlineCompletionIndex(e){await this.triggerExplicitly();const t=this._filteredInlineCompletionItems.get()||[];if(t.length>0){const i=(this.selectedInlineCompletionIndex.get()+e+t.length)%t.length;this._selectedInlineCompletionId.set(t[i].semanticId,void 0)}else this._selectedInlineCompletionId.set(void 0,void 0)}async next(){await this._deltaSelectedInlineCompletionIndex(1)}async previous(){await this._deltaSelectedInlineCompletionIndex(-1)}_getMetadata(e,t=void 0){return{extensionId:e.source.provider.groupId,nes:e.isInlineEdit,type:t}}async accept(e=this._editor){if(e.getModel()!==this.textModel)throw new tn;let t;const i=this.state.get();if(i?.kind==="ghostText"){if(!i||i.primaryGhostText.isEmpty()||!i.inlineCompletion)return;t=i.inlineCompletion}else if(i?.kind==="inlineEdit")t=i.inlineCompletion;else return;if(t.reportEndOfLife({kind:Np.Accepted}),t.command&&t.source.addRef(),e.pushUndoStop(),t.snippetInfo)Zb.editWithMetadata(this._getMetadata(t),()=>{e.executeEdits("inlineSuggestion.accept",[qi.replace(t.editRange,""),...t.additionalTextEdits])}),e.setPosition(t.snippetInfo.range.getStartPosition(),"inlineCompletionAccept"),cs.get(e)?.insert(t.snippetInfo.snippet,{undoStopBefore:!1});else{const n=i.edits,o=Uee(n).map(r=>at.fromPositions(r));if(Zb.editWithMetadata(this._getMetadata(t),()=>{e.executeEdits("inlineSuggestion.accept",[...n.map(r=>qi.replace(r.range,r.text)),...t.additionalTextEdits])}),t.displayLocation===void 0&&e.setSelections(i.kind==="inlineEdit"?o.slice(-1):o,"inlineCompletionAccept"),i.kind==="inlineEdit"&&!this._accessibilityService.isMotionReduced()){const r=new hc(n).getNewRanges(),a=this._store.add(new DBe(e,r,()=>{this._store.delete(a)}))}}this._onDidAccept.fire(),this.stop(),t.command&&(await this._commandService.executeCommand(t.command.id,...t.command.arguments||[]).then(void 0,Ln),t.source.removeRef()),this._inAcceptFlow.set(!0,void 0),this._lastAcceptedInlineCompletionInfo={textModelVersionIdAfter:this.textModel.getVersionId(),inlineCompletion:t}}async acceptNextWord(){await this._acceptNext(this._editor,"word",(e,t)=>{const i=this.textModel.getLanguageIdAtPosition(e.lineNumber,e.column),n=this._languageConfigurationService.getLanguageConfiguration(i),o=new RegExp(n.wordDefinition.source,n.wordDefinition.flags.replace("g","")),r=t.match(o);let a=0;r&&r.index!==void 0?r.index===0?a=r[0].length:a=r.index:a=t.length;const d=/\s+/g.exec(t);return d&&d.index!==void 0&&d.index+d[0].length<a&&(a=d.index+d[0].length),a},Tb.Word)}async acceptNextLine(){await this._acceptNext(this._editor,"line",(e,t)=>{const i=t.match(/\n/);return i&&i.index!==void 0?i.index+1:t.length},Tb.Line)}async _acceptNext(e,t,i,n){if(e.getModel()!==this.textModel)throw new tn;const o=this.inlineCompletionState.get();if(!o||o.primaryGhostText.isEmpty()||!o.inlineCompletion)return;const r=o.primaryGhostText,a=o.inlineCompletion;if(a.snippetInfo){await this.accept(e);return}const c=r.parts[0],d=new we(r.lineNumber,c.column),l=c.text,u=i(d,l);if(u===l.length&&r.parts.length===1){this.accept(e);return}const g=l.substring(0,u),m=this._positions.get(),v=m[0];a.source.addRef();try{this._isAcceptingPartially=!0;try{e.pushUndoStop();const k=P.fromPositions(v,d),D=e.getModel().getValueInRange(k)+g,A=new ps(k,D),B=[A,...X1(this.textModel,m,A)],q=Uee(B).map(Q=>at.fromPositions(Q));Zb.editWithMetadata(this._getMetadata(a,t),()=>{e.executeEdits("inlineSuggestion.accept",B.map(Q=>qi.replace(Q.range,Q.text)))}),e.setSelections(q,"inlineCompletionPartialAccept"),e.revealPositionInCenterIfOutsideViewport(e.getPosition(),Qi.Immediate)}finally{this._isAcceptingPartially=!1}const _=P.fromPositions(a.editRange.getStartPosition(),oc.ofText(g).addToPosition(d)),C=e.getModel().getValueInRange(_,uy.LF).length;a.reportPartialAccept(C,{kind:n,acceptedLength:C})}finally{a.source.removeRef()}}handleSuggestAccepted(e){const t=Su(e.getSingleTextEdit(),this.textModel),i=this._computeAugmentation(t,void 0);if(!i)return;const o=this.textModel.getValueInRange(i.completion.editRange,uy.LF).length+t.text.length;i.completion.reportPartialAccept(t.text.length,{kind:Tb.Suggest,acceptedLength:o})}extractReproSample(){const e=this.textModel.getValue(),t=this.state.get()?.inlineCompletion;return{documentValue:e,inlineCompletion:t?.getSourceCompletion()}}jump(){const e=this.inlineEditState.get();e&&gs(t=>{this._jumpedToId.set(e.inlineCompletion.semanticId,t),this.dontRefetchSignal.trigger(t);const i=e.inlineCompletion.targetRange,n=i.getStartPosition();if(this._editor.setPosition(n,"inlineCompletions.jump"),i.isSingleLine()&&(e.inlineCompletion.displayLocation||!e.inlineCompletion.insertText.includes(`
`)))this._editor.revealPosition(n);else{const r=new P(i.startLineNumber-1,1,i.endLineNumber+1,1);this._editor.revealRange(r,Qi.Immediate)}this._editor.focus()})}async handleInlineSuggestionShown(e){await e.reportInlineEditShown(this._commandService)}};o3=f([p(7,Z),p(8,Ge),p(9,ds),p(10,Nr),p(11,Ne)],o3);var au;(function(s){s[s.Undo=0]="Undo",s[s.Redo=1]="Redo",s[s.AcceptWord=2]="AcceptWord",s[s.Other=3]="Other"})(au||(au={}));function X1(s,e,t){if(e.length===1)return[];const i=e[0],n=e.slice(1),o=t.range.getStartPosition(),r=t.range.getEndPosition(),a=s.getValueInRange(P.fromPositions(i,r)),c=Hee(i,o);if(c.lineNumber<1)return mt(new tn(`positionWithinTextEdit line number should be bigger than 0.
			Invalid subtraction between ${i.toString()} and ${o.toString()}`)),[];const d=eBe(t.text,c);return n.map(l=>{const u=JWe(Hee(l,o),r),g=s.getValueInRange(P.fromPositions(l,u)),m=sf(a,g),v=P.fromPositions(l,l.delta(0,m));return new ps(v,d)})}class DBe extends F{constructor(e,t,i){super(),i&&this._register({dispose:()=>i()}),this._register(Rs(e).setDecorations(Li(t.map(r=>({range:r,options:{description:"animation",className:"edits-fadeout-decoration",zIndex:1}})))));const n=new b0(1,0,1e3,rBe),o=new m5(n);this._register(fi(r=>{const a=o.getValue(r);e.getContainerDomNode().style.setProperty("--animation-opacity",a.toString()),n.isFinished()&&this.dispose()}))}}class kBe extends F{get selectedItem(){return this._currentSuggestItemInfo}constructor(e,t,i){super(),this.editor=e,this.suggestControllerPreselector=t,this.onWillAccept=i,this.isSuggestWidgetVisible=!1,this.isShiftKeyPressed=!1,this._isActive=!1,this._currentSuggestItemInfo=void 0,this._onDidSelectedItemChange=this._register(new M),this.onDidSelectedItemChange=this._onDidSelectedItemChange.event,this._register(e.onKeyDown(o=>{o.shiftKey&&!this.isShiftKeyPressed&&(this.isShiftKeyPressed=!0,this.update(this._isActive))})),this._register(e.onKeyUp(o=>{o.shiftKey&&this.isShiftKeyPressed&&(this.isShiftKeyPressed=!1,this.update(this._isActive))}));const n=ia.get(this.editor);if(n){this._register(n.registerSelector({priority:100,select:(a,c,d)=>{const l=this.editor.getModel();if(!l)return-1;const u=this.suggestControllerPreselector(),g=u?Su(u,l):void 0;if(!g)return-1;const m=we.lift(c),v=d.map((w,C)=>{const k=cE.fromSuggestion(n,l,m,w,this.isShiftKeyPressed),D=Su(k.getSingleTextEdit(),l),A=oge(g,D);return{index:C,valid:A,prefixLength:D.text.length,suggestItem:w}}).filter(w=>w&&w.valid&&w.prefixLength>0),_=Ybe(v,rd(w=>w.prefixLength,fl));return _?_.index:-1}}));let o=!1;const r=()=>{o||(o=!0,this._register(n.widget.value.onDidShow(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})),this._register(n.widget.value.onDidHide(()=>{this.isSuggestWidgetVisible=!1,this.update(!1)})),this._register(n.widget.value.onDidFocus(()=>{this.isSuggestWidgetVisible=!0,this.update(!0)})))};this._register(T.once(n.model.onDidTrigger)(a=>{r()})),this._register(n.onWillInsertSuggestItem(a=>{const c=this.editor.getPosition(),d=this.editor.getModel();if(!c||!d)return;const l=cE.fromSuggestion(n,d,c,a.item,this.isShiftKeyPressed);this.onWillAccept(l)}))}this.update(this._isActive)}update(e){const t=this.getSuggestItemInfo();(this._isActive!==e||!TBe(this._currentSuggestItemInfo,t))&&(this._isActive=e,this._currentSuggestItemInfo=t,this._onDidSelectedItemChange.fire())}getSuggestItemInfo(){const e=ia.get(this.editor);if(!e||!this.isSuggestWidgetVisible)return;const t=e.widget.value.getFocusedItem(),i=this.editor.getPosition(),n=this.editor.getModel();if(!(!t||!i||!n))return cE.fromSuggestion(e,n,i,t.item,this.isShiftKeyPressed)}stopForceRenderingAbove(){ia.get(this.editor)?.stopForceRenderingAbove()}forceRenderingAbove(){ia.get(this.editor)?.forceRenderingAbove()}}class cE{static fromSuggestion(e,t,i,n,o){let{insertText:r}=n.completion,a=!1;if(n.completion.insertTextRules&sh.InsertAsSnippet){const d=new fd().parse(r);d.children.length<100&&iP.adjustWhitespace(t,i,!0,d),r=d.toString(),a=!0}const c=e.getOverwriteInfo(n,o);return new cE(P.fromPositions(i.delta(0,-c.overwriteBefore),i.delta(0,Math.max(c.overwriteAfter,0))),r,n.completion.kind,a)}constructor(e,t,i,n){this.range=e,this.insertText=t,this.completionItemKind=i,this.isSnippetText=n}equals(e){return this.range.equalsRange(e.range)&&this.insertText===e.insertText&&this.completionItemKind===e.completionItemKind&&this.isSnippetText===e.isSnippetText}toSelectedSuggestionInfo(){return new Qbe(this.range,this.insertText,this.completionItemKind,this.isSnippetText)}getSingleTextEdit(){return new ps(this.range,this.insertText)}}function TBe(s,e){return s===e?!0:!s||!e?!1:s.equals(e)}class ABe extends F{constructor(e,t,i){super(),this._editorObs=e,this._handleSuggestAccepted=t,this._suggestControllerPreselector=i,this._suggestWidgetAdaptor=this._register(new kBe(this._editorObs.editor,()=>(this._editorObs.forceUpdate(),this._suggestControllerPreselector()),n=>this._editorObs.forceUpdate(o=>{this._handleSuggestAccepted(n)}))),this.selectedItem=kn(this,n=>this._suggestWidgetAdaptor.onDidSelectedItemChange(()=>{this._editorObs.forceUpdate(o=>n(void 0))}),()=>this._suggestWidgetAdaptor.selectedItem)}stopForceRenderingAbove(){this._suggestWidgetAdaptor.stopForceRenderingAbove()}forceRenderingAbove(){this._suggestWidgetAdaptor.forceRenderingAbove()}}class Wx{static fromOffsetRange(e){return new Wx(e.start+1,e.endExclusive+1)}constructor(e,t){if(this.startColumn=e,this.endColumnExclusive=t,e>t)throw new tn(`startColumn ${e} cannot be after endColumnExclusive ${t}`)}toRange(e){return new P(e,this.startColumn,e,this.endColumnExclusive)}equals(e){return this.startColumn===e.startColumn&&this.endColumnExclusive===e.endColumnExclusive}toZeroBasedOffsetRange(){return new Hi(this.startColumn-1,this.endColumnExclusive-1)}}class _5{static fromRange(e){if(e.endLineNumber===e.startLineNumber)return new _5(e.startLineNumber,new Wx(e.startColumn,e.endColumn))}constructor(e,t){this.lineNumber=e,this.columnRange=t}toRange(){return new P(this.lineNumber,this.columnRange.startColumn,this.lineNumber,this.columnRange.endColumnExclusive)}}const RBe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Sm{static fromLineTokens(e){const t=[];for(let i=0;i<e.getCount();i++)t.push(new jee(e.getTokenText(i),e.getMetadata(i)));return Sm.create(t)}static create(e){return new Sm(e)}constructor(e){this._tokenInfo=e}toLineTokens(e){return Cw.createFromTextAndMetadata(this.map((t,i)=>({text:i.text,metadata:i.metadata})),e)}forEach(e){let t=0;for(const i of this._tokenInfo){const n=new Hi(t,t+i.text.length);e(n,i),t+=i.text.length}}map(e){const t=[];let i=0;for(const n of this._tokenInfo){const o=new Hi(i,i+n.text.length);t.push(e(o,n)),i+=n.text.length}return t}slice(e){const t=[];let i=0;for(const n of this._tokenInfo){const o=i,r=o+n.text.length;if(r>e.start){if(o>=e.endExclusive)break;const a=Math.max(0,e.start-o),c=Math.max(0,r-e.endExclusive);t.push(new jee(n.text.slice(a,n.text.length-c),n.metadata))}i+=n.text.length}return Sm.create(t)}append(e){const t=this._tokenInfo.concat(e._tokenInfo);return Sm.create(t)}}class jee{constructor(e,t){this.text=e,this.metadata=t}}var r3;Ve(RBe);const dge="ghost-text";let Bx=class extends F{static{r3=this}static{this.hot=lN(r3)}constructor(e,t,i,n,o,r){super(),this._editor=e,this._model=t,this._options=i,this._shouldKeepCursorStable=n,this._isClickable=o,this._languageService=r,this._isDisposed=si(this,!1),this._editorObs=Rs(this._editor),this._warningState=ve(a=>{const c=this._model.ghostText.read(a);if(!c)return;const d=this._model.warning.read(a);if(d)return{lineNumber:c.lineNumber,position:new we(c.lineNumber,c.parts[0].column),icon:d.icon}}),this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._useSyntaxHighlighting=this._options.map(a=>a.syntaxHighlightingEnabled),this._extraClassNames=ve(this,a=>{const c=[...this._options.read(a).extraClasses??[]];return this._useSyntaxHighlighting.read(a)&&c.push("syntax-highlighted"),this._warningState.read(a)&&c.push("warning"),c.map(l=>` ${l}`).join("")}),this.uiState=ve(this,a=>{if(this._isDisposed.read(a))return;const c=this._editorObs.model.read(a);if(c!==this._model.targetTextModel.read(a))return;const d=this._model.ghostText.read(a);if(!d)return;const l=d instanceof t3?d.columnRange:void 0,u=this._useSyntaxHighlighting.read(a),g=this._extraClassNames.read(a),{inlineTexts:m,additionalLines:v,hiddenRange:_,additionalLinesOriginalSuffix:w}=PBe(d,c,dge+g),C=c.getLineContent(d.lineNumber),k=new Bp(m.map(Q=>Sa.insert(Q.column-1,Q.text))),D=u?c.tokenization.tokenizeLinesAt(d.lineNumber,[k.apply(C),...v.map(Q=>Q.content)]):void 0,A=k.getNewTextRanges(),B=m.map((Q,ie)=>({...Q,tokens:D?.[0]?.getTokensInRange(A[ie])})),q=v.map((Q,ie)=>{let oe=D?.[ie+1]??Cw.createEmpty(Q.content,this._languageService.languageIdCodec);if(ie===v.length-1&&w){const me=Sm.fromLineTokens(c.tokenization.getLineTokens(w.lineNumber)).slice(w.columnRange.toZeroBasedOffsetRange());oe=Sm.fromLineTokens(oe).append(me).toLineTokens(oe.languageIdCodec)}return{content:oe,decorations:Q.decorations}});return{replacedRange:l,inlineTexts:B,additionalLines:q,hiddenRange:_,lineNumber:d.lineNumber,additionalReservedLineCount:this._model.minReservedLineCount.read(a),targetTextModel:c,syntaxHighlightingEnabled:u}}),this.decorations=ve(this,a=>{const c=this.uiState.read(a);if(!c)return[];const d=[],l=this._extraClassNames.read(a);c.replacedRange&&d.push({range:c.replacedRange.toRange(c.lineNumber),options:{inlineClassName:"inline-completion-text-to-replace"+l,description:"GhostTextReplacement"}}),c.hiddenRange&&d.push({range:c.hiddenRange.toRange(c.lineNumber),options:{inlineClassName:"ghost-text-hidden",description:"ghost-text-hidden"}});for(const u of c.inlineTexts)d.push({range:P.fromPositions(new we(c.lineNumber,u.column)),options:{description:"ghost-text-decoration",after:{content:u.text,tokens:u.tokens,inlineClassName:(u.preview?"ghost-text-decoration-preview":"ghost-text-decoration")+(this._isClickable?" clickable":"")+l+u.lineDecorations.map(g=>" "+g.className).join(" "),cursorStops:Qf.Left,attachedData:new Z1(this)},showIfCollapsed:!0}});return d}),this._additionalLinesWidget=this._register(new LBe(this._editor,ve(a=>{const c=this.uiState.read(a);return c?{lineNumber:c.lineNumber,additionalLines:c.additionalLines,minReservedLineCount:c.additionalReservedLineCount,targetTextModel:c.targetTextModel}:void 0}),this._shouldKeepCursorStable,this._isClickable)),this._isInlineTextHovered=this._editorObs.isTargetHovered(a=>a.target.type===xi.CONTENT_TEXT&&a.target.detail.injectedText?.options.attachedData instanceof Z1&&a.target.detail.injectedText.options.attachedData.owner===this,this._store),this.isHovered=ve(this,a=>this._isDisposed.read(a)?!1:this._isInlineTextHovered.read(a)||this._additionalLinesWidget.isHovered.read(a)),this.height=ve(this,a=>this._editorObs.getOption(L.lineHeight).read(a)+(this._additionalLinesWidget.viewZoneHeight.read(a)??0)),this._register(Ie(()=>{this._isDisposed.set(!0,void 0)})),this._register(this._editorObs.setDecorations(this.decorations)),this._isClickable&&(this._register(this._additionalLinesWidget.onDidClick(a=>this._onDidClick.fire(a))),this._register(this._editor.onMouseUp(a=>{if(a.target.type!==xi.CONTENT_TEXT)return;const c=a.target.detail.injectedText?.options.attachedData;c instanceof Z1&&c.owner===this&&this._onDidClick.fire(a.event)}))),this._register(ka((a,c)=>{}))}static getWarningWidgetContext(e){const t=e.ghostTextViewWarningWidgetData;if(t)return t;if(e.parentElement)return this.getWarningWidgetContext(e.parentElement)}ownsViewZone(e){return this._additionalLinesWidget.viewZoneId===e}};Bx=r3=f([p(5,vi)],Bx);class Z1{constructor(e){this.owner=e}}function PBe(s,e,t){const i=[],n=[];function o(u,g){if(n.length>0){const m=n[n.length-1];g&&m.decorations.push(new ME(m.content.length+1,m.content.length+1+u[0].line.length,g,Nb.Regular)),m.content+=u[0].line,u=u.slice(1)}for(const m of u)n.push({content:m.line,decorations:g?[new ME(1,m.line.length+1,g,Nb.Regular),...m.lineDecorations]:[...m.lineDecorations]})}const r=e.getLineContent(s.lineNumber);let a,c=0;for(const u of s.parts){let g=u.lines;a===void 0?(i.push({column:u.column,text:g[0].line,preview:u.preview,lineDecorations:g[0].lineDecorations}),g=g.slice(1)):o([{line:r.substring(c,u.column-1),lineDecorations:[]}],void 0),g.length>0&&(o(g,t),a===void 0&&u.column<=r.length&&(a=u.column)),c=u.column-1}let d;a!==void 0&&(d=new _5(s.lineNumber,new Wx(c+1,r.length+1)));const l=a!==void 0?new Wx(a,r.length+1):void 0;return{inlineTexts:i,additionalLines:n,hiddenRange:l,additionalLinesOriginalSuffix:d}}class LBe extends F{get viewZoneId(){return this._viewZoneInfo?.viewZoneId}get viewZoneHeight(){return this._viewZoneHeight}constructor(e,t,i,n){super(),this._editor=e,this._lines=t,this._shouldKeepCursorStable=i,this._isClickable=n,this._viewZoneHeight=si("viewZoneHeight",void 0),this.editorOptionsChanged=sA("editorOptionChanged",T.filter(this._editor.onDidChangeConfiguration,o=>o.hasChanged(L.disableMonospaceOptimizations)||o.hasChanged(L.stopRenderingLineAfter)||o.hasChanged(L.renderWhitespace)||o.hasChanged(L.renderControlCharacters)||o.hasChanged(L.fontLigatures)||o.hasChanged(L.fontInfo)||o.hasChanged(L.lineHeight))),this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._viewZoneListener=this._register(new Pt),this.isHovered=Rs(this._editor).isTargetHovered(o=>Yee(o.target.element),this._store),this.hasBeenAccepted=!1,this._editor instanceof gI&&this._shouldKeepCursorStable&&this._register(this._editor.onBeforeExecuteEdit(o=>this.hasBeenAccepted=o.source==="inlineSuggestion.accept")),this._register(fi(o=>{const r=this._lines.read(o);this.editorOptionsChanged.read(o),r?(this.hasBeenAccepted=!1,this.updateLines(r.lineNumber,r.additionalLines,r.minReservedLineCount)):this.clear()}))}dispose(){super.dispose(),this.clear()}clear(){this._viewZoneListener.clear(),this._editor.changeViewZones(e=>{this.removeActiveViewZone(e)})}updateLines(e,t,i){const n=this._editor.getModel();if(!n)return;const{tabSize:o}=n.getOptions();this._editor.changeViewZones(r=>{const a=new U;this.removeActiveViewZone(r);const c=Math.max(t.length,i);if(c>0){const d=document.createElement("div");MBe(d,o,t,this._editor.getOptions(),this._isClickable),this._isClickable&&(a.add(re(d,"mousedown",l=>{l.preventDefault()})),a.add(re(d,"click",l=>{Yee(l.target)&&this._onDidClick.fire(new bs(Et(l),l))}))),this.addViewZone(r,e,c,d)}this._viewZoneListener.value=a})}addViewZone(e,t,i,n){const o=e.addZone({afterLineNumber:t,heightInLines:i,domNode:n,afterColumnAffinity:eI.Right,onComputedHeight:r=>{this._viewZoneHeight.set(r,void 0)}});this.keepCursorStable(t,i),this._viewZoneInfo={viewZoneId:o,heightInLines:i,lineNumber:t}}removeActiveViewZone(e){this._viewZoneInfo&&(e.removeZone(this._viewZoneInfo.viewZoneId),this.hasBeenAccepted||this.keepCursorStable(this._viewZoneInfo.lineNumber,-this._viewZoneInfo.heightInLines),this._viewZoneInfo=void 0,this._viewZoneHeight.set(void 0,void 0))}keepCursorStable(e,t){if(!this._shouldKeepCursorStable)return;const i=this._editor.getSelection()?.getStartPosition()?.lineNumber;i!==void 0&&e<i&&this._editor.setScrollTop(this._editor.getScrollTop()+t*this._editor.getOption(L.lineHeight))}}function Yee(s){return Ph(s)&&s.classList.contains(dge)}function MBe(s,e,t,i,n){const o=i.get(L.disableMonospaceOptimizations),r=i.get(L.stopRenderingLineAfter),a="none",c=i.get(L.renderControlCharacters),d=i.get(L.fontLigatures),l=i.get(L.fontInfo),u=i.get(L.lineHeight);let g="suggest-preview-text";n&&(g+=" clickable");const m=new lse(1e4);m.appendString(`<div class="${g}">`);for(let w=0,C=t.length;w<C;w++){const k=t[w],D=k.content;m.appendString('<div class="view-line'),m.appendString('" style="top:'),m.appendString(String(w*u)),m.appendString('px;width:1000000px;">');const A=D.getLineContent(),B=hse(A),q=Xbe(A);Use(new $se(l.isMonospace&&!o,l.canUseHalfwidthRightwardsArrow,A,!1,B,q,0,D,k.decorations,e,0,l.spaceWidth,l.middotWidth,l.wsmiddotWidth,r,a,c,d!==Zbe.OFF,null),m),m.appendString("</div>")}m.appendString("</div>"),use(s,l);const v=m.build(),_=Qee?Qee.createHTML(v):v;s.innerHTML=_}const Qee=gse("editorGhostText",{createHTML:s=>s});class uu{static{this.empty=new uu([])}static deserialize(e){return new uu(e.map(t=>kp.deserialize(t)))}static fromEdit(e,t){const i=hc.fromOffsetEdit(e,t);return uu.fromTextEdit(i,t)}static fromTextEdit(e,t){const i=e.edits,n=[],o=[];for(let r=0;r<i.length;r++){const a=i[r],c=r+1<i.length?i[r+1]:void 0;if(o.push(a),c&&c.range.startLineNumber===a.range.endLineNumber)continue;const d=ps.joinEdits(o,t);o.length=0;const l=kp.fromSingleTextEdit(d,t);n.push(l)}return new uu(n)}static createFromUnsorted(e){const t=e.slice();return t.sort(rd(i=>i.lineRange.startLineNumber,fl)),new uu(t)}constructor(e){this.edits=e,$e(sN(e,(t,i)=>t.lineRange.endLineNumberExclusive<=i.lineRange.startLineNumber))}toEdit(e){const t=[];for(const i of this.edits){const n=i.toSingleEdit(e);t.push(n)}return new Bp(t)}toString(){return this.edits.map(e=>e.toString()).join(",")}serialize(){return this.edits.map(e=>e.serialize())}getNewLineRanges(){const e=[];let t=0;for(const i of this.edits)e.push(xr.ofLength(i.lineRange.startLineNumber+t,i.newLines.length)),t+=i.newLines.length-i.lineRange.length;return e}mapLineNumber(e){let t=0;for(const i of this.edits){if(i.lineRange.endLineNumberExclusive>e)break;t+=i.newLines.length-i.lineRange.length}return e+t}mapLineRange(e){return new xr(this.mapLineNumber(e.startLineNumber),this.mapLineNumber(e.endLineNumberExclusive))}rebase(e){return new uu(this.edits.map(t=>new kp(e.mapLineRange(t.lineRange),t.newLines)))}humanReadablePatch(e){const t=[];function i(a,c,d,l){const u=d==="unmodified"?" ":d==="deleted"?"-":"+";l===void 0&&(l="[[[[[ WARNING: LINE DOES NOT EXIST ]]]]]");const g=a===-1?"   ":a.toString().padStart(3," "),m=c===-1?"   ":c.toString().padStart(3," ");t.push(`${u} ${g} ${m} ${l}`)}function n(){t.push("---")}let o=0,r=!0;for(const a of Jbe(this.edits,(c,d)=>c.lineRange.distanceToRange(d.lineRange)<=5)){r?r=!1:n();let c=a[0].lineRange.startLineNumber-2;for(const d of a){for(let g=Math.max(1,c);g<d.lineRange.startLineNumber;g++)i(g,g+o,"unmodified",e[g-1]);const l=d.lineRange,u=d.newLines;for(const g of l.mapToLineArray(m=>m)){const m=e[g-1];i(g,-1,"deleted",m)}for(let g=0;g<u.length;g++){const m=u[g];i(-1,l.startLineNumber+o+g,"added",m)}c=l.endLineNumberExclusive,o+=d.newLines.length-d.lineRange.length}for(let d=c;d<=Math.min(c+2,e.length);d++)i(d,d+o,"unmodified",e[d-1])}return t.join(`
`)}apply(e){const t=[];let i=0;for(const n of this.edits){for(;i<n.lineRange.startLineNumber-1;)t.push(e[i]),i++;for(const o of n.newLines)t.push(o);i=n.lineRange.endLineNumberExclusive-1}for(;i<e.length;)t.push(e[i]),i++;return t}toSingleEdit(){}}class kp{static deserialize(e){return new kp(xr.ofLength(e[0],e[1]-e[0]),e[2])}static fromSingleTextEdit(e,t){const i=Ch(e.text);let n=e.range.startLineNumber;const o=t.getValueOfRange(P.fromPositions(new we(e.range.startLineNumber,1),e.range.getStartPosition()));i[0]=o+i[0];let r=e.range.endLineNumber+1;const a=t.getTransformer().getLineLength(e.range.endLineNumber)+1,c=t.getValueOfRange(P.fromPositions(e.range.getEndPosition(),new we(e.range.endLineNumber,a)));i[i.length-1]=i[i.length-1]+c;const d=e.range.startColumn===t.getTransformer().getLineLength(e.range.startLineNumber)+1,l=e.range.endColumn===1;return d&&i[0].length===o.length&&(n++,i.shift()),i.length>0&&n<r&&l&&i[i.length-1].length===c.length&&(r--,i.pop()),new kp(new xr(n,r),i)}constructor(e,t){this.lineRange=e,this.newLines=t}toSingleTextEdit(e){if(this.newLines.length===0){const t=e.getTransformer().textLength;if(this.lineRange.endLineNumberExclusive===t.lineCount+2){let i;if(this.lineRange.startLineNumber>1){const o=this.lineRange.startLineNumber-1,r=e.getTransformer().getLineLength(o)+1;i=new we(o,r)}else i=new we(1,1);const n=t.addToPosition(new we(1,1));return new ps(P.fromPositions(i,n),"")}else return new ps(new P(this.lineRange.startLineNumber,1,this.lineRange.endLineNumberExclusive,1),"")}else if(this.lineRange.isEmpty){let t,i,n;const o=this.lineRange.startLineNumber;return o===e.getTransformer().textLength.lineCount+2?(t=o-1,i=e.getTransformer().getLineLength(t)+1,n=this.newLines.map(r=>`
`+r).join("")):(t=o,i=1,n=this.newLines.map(r=>r+`
`).join("")),new ps(P.fromPositions(new we(t,i)),n)}else{const t=this.lineRange.endLineNumberExclusive-1,i=e.getTransformer().getLineLength(t)+1,n=new P(this.lineRange.startLineNumber,1,t,i),o=this.newLines.join(`
`);return new ps(n,o)}}toSingleEdit(e){const t=this.toSingleTextEdit(e),i=e.getTransformer().getOffsetRange(t.range);return new Sa(i,t.text)}toString(){return`${this.lineRange}->${JSON.stringify(this.newLines)}`}serialize(){return[this.lineRange.startLineNumber,this.lineRange.endLineNumberExclusive,this.newLines]}removeCommonSuffixPrefixLines(e){let t=this.lineRange.startLineNumber,i=this.lineRange.endLineNumberExclusive,n=0;for(;t<i&&n<this.newLines.length&&this.newLines[n]===e.getLineAt(t);)t++,n++;let o=0;for(;t<i&&o+n<this.newLines.length&&this.newLines[this.newLines.length-1-o]===e.getLineAt(i-1);)i--,o++;return n===0&&o===0?this:new kp(new xr(t,i),this.newLines.slice(n,this.newLines.length-o))}toLineEdit(){return new uu([this])}}class lge{get lineEdit(){return kp.fromSingleTextEdit(this.edit.toSingle(this.originalText),this.originalText)}get originalLineRange(){return this.lineEdit.lineRange}get modifiedLineRange(){return this.lineEdit.toLineEdit().getNewLineRanges()[0]}get displayRange(){return this.originalText.lineRange.intersect(this.originalLineRange.join(xr.ofLength(this.originalLineRange.startLineNumber,this.lineEdit.newLines.length)))}constructor(e,t,i,n,o){this.originalText=e,this.edit=t,this.cursorPosition=i,this.commands=n,this.inlineCompletion=o}equals(e){return this.originalText.getValue()===e.originalText.getValue()&&this.edit.equals(e.edit)&&this.cursorPosition.equals(e.cursorPosition)&&this.commands===e.commands&&this.inlineCompletion===e.inlineCompletion}}var Fs;(function(s){s.Jump="jump",s.Accept="accept",s.Inactive="inactive"})(Fs||(Fs={}));class hge{constructor(e,t,i){this._model=e,this.inlineEdit=t,this.tabAction=i,this.action=this.inlineEdit.inlineCompletion.action,this.displayName=this.inlineEdit.inlineCompletion.source.provider.displayName??h(1277,"Inline Edit"),this.extensionCommands=this.inlineEdit.inlineCompletion.source.inlineSuggestions.commands??[],this.displayLocation=this.inlineEdit.inlineCompletion.displayLocation,this.showCollapsed=this._model.showCollapsed}accept(){this._model.accept()}jump(){this._model.jump()}abort(e){console.error(e),this._model.stop()}handleInlineEditShown(){this._model.handleInlineSuggestionShown(this.inlineEdit.inlineCompletion)}}class NBe{constructor(e){this._model=e,this.onDidAccept=this._model.onDidAccept,this.inAcceptFlow=this._model.inAcceptFlow}}class OBe{constructor(e,t,i,n){this.lineRange=i;const o=Rs(e),r=ve(this,a=>o.isFocused.read(a)&&n.showInlineEditMenu?Fs.Accept:Fs.Inactive);this.model=new hge(t,new lge(new K_(""),new hc([n.getSingleTextEdit()]),t.primaryPosition.get(),n.source.inlineSuggestions.commands??[],n),r)}}class ri{static fromPoint(e){return new ri(e.x,e.y,e.x,e.y)}static fromPoints(e,t){return new ri(e.x,e.y,t.x,t.y)}static fromPointSize(e,t){return new ri(e.x,e.y,e.x+t.x,e.y+t.y)}static fromLeftTopRightBottom(e,t,i,n){return new ri(e,t,i,n)}static fromLeftTopWidthHeight(e,t,i,n){return new ri(e,t,e+i,t+n)}static fromRanges(e,t){return new ri(e.start,t.start,e.endExclusive,t.endExclusive)}static hull(e){let t=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(const r of e)t=Math.min(t,r.left),i=Math.min(i,r.top),n=Math.max(n,r.right),o=Math.max(o,r.bottom);return new ri(t,i,n,o)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}constructor(e,t,i,n){if(this.left=e,this.top=t,this.right=i,this.bottom=n,e>i||t>n)throw new tn("Invalid arguments")}withMargin(e,t,i,n){let o,r,a,c;return t===void 0&&i===void 0&&n===void 0?o=r=a=c=e:i===void 0&&n===void 0?(o=r=t,a=c=e):(o=n,r=t,a=e,c=i),new ri(this.left-o,this.top-a,this.right+r,this.bottom+c)}intersectVertical(e){const t=Math.max(this.top,e.start),i=Math.min(this.bottom,e.endExclusive);return new ri(this.left,t,this.right,Math.max(t,i))}intersectHorizontal(e){const t=Math.max(this.left,e.start),i=Math.min(this.right,e.endExclusive);return new ri(t,this.top,Math.max(t,i),this.bottom)}toString(){return`Rect{(${this.left},${this.top}), (${this.right},${this.bottom})}`}intersect(e){const t=Math.max(this.left,e.left),i=Math.min(this.right,e.right),n=Math.max(this.top,e.top),o=Math.min(this.bottom,e.bottom);if(!(t>i||n>o))return new ri(t,n,i,o)}union(e){return new ri(Math.min(this.left,e.left),Math.min(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom))}containsRect(e){return this.left<=e.left&&this.top<=e.top&&this.right>=e.right&&this.bottom>=e.bottom}containsPoint(e){return this.left<=e.x&&this.top<=e.y&&this.right>=e.x&&this.bottom>=e.y}moveToBeContainedIn(e){const t=this.width,i=this.height;let n=this.left,o=this.top;return n<e.left?n=e.left:n+t>e.right&&(n=e.right-t),o<e.top?o=e.top:o+i>e.bottom&&(o=e.bottom-i),new ri(n,o,n+t,o+i)}withWidth(e){return new ri(this.left,this.top,this.left+e,this.bottom)}withHeight(e){return new ri(this.left,this.top,this.right,this.top+e)}withTop(e){return new ri(this.left,e,this.right,this.bottom)}withLeft(e){return new ri(e,this.top,this.right,this.bottom)}translateX(e){return new ri(this.left+e,this.top,this.right+e,this.bottom)}translateY(e){return new ri(this.left,this.top+e,this.right,this.bottom+e)}deltaRight(e){return new ri(this.left,this.top,this.right+e,this.bottom)}deltaTop(e){return new ri(this.left,this.top+e,this.right,this.bottom)}deltaLeft(e){return new ri(this.left+e,this.top,this.right,this.bottom)}deltaBottom(e){return new ri(this.left,this.top,this.right,this.bottom+e)}getLeftBottom(){return new fu(this.left,this.bottom)}getRightBottom(){return new fu(this.right,this.bottom)}getLeftTop(){return new fu(this.left,this.top)}getRightTop(){return new fu(this.right,this.top)}toStyles(){return{position:"absolute",left:`${this.left}px`,top:`${this.top}px`,width:`${this.width}px`,height:`${this.height}px`}}}const FBe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(FBe);class yb{constructor(e,t,i,n=null){this.startLineNumbers=e,this.endLineNumbers=t,this.lastLineRelativePosition=i,this.showEndForLine=n}equals(e){return!!e&&this.lastLineRelativePosition===e.lastLineRelativePosition&&this.showEndForLine===e.showEndForLine&&rs(this.startLineNumbers,e.startLineNumbers)&&rs(this.endLineNumbers,e.endLineNumbers)}static get Empty(){return new yb([],[],0)}}const Xee=gse("stickyScrollViewLayer",{createHTML:s=>s}),J1="data-sticky-line-index",Zee="data-sticky-is-line",WBe="data-sticky-is-line-number",Jee="data-sticky-is-folding-icon";class BBe extends F{get height(){return this._height}constructor(e){super(),this._foldingIconStore=new U,this._rootDomNode=document.createElement("div"),this._lineNumbersDomNode=document.createElement("div"),this._linesDomNodeScrollable=document.createElement("div"),this._linesDomNode=document.createElement("div"),this._renderedStickyLines=[],this._lineNumbers=[],this._lastLineRelativePosition=0,this._minContentWidthInPx=0,this._isOnGlyphMargin=!1,this._height=-1,this._onDidChangeStickyScrollHeight=this._register(new M),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._editor=e,this._lineHeight=e.getOption(L.lineHeight),this._lineNumbersDomNode.className="sticky-widget-line-numbers",this._lineNumbersDomNode.setAttribute("role","none"),this._linesDomNode.className="sticky-widget-lines",this._linesDomNode.setAttribute("role","list"),this._linesDomNodeScrollable.className="sticky-widget-lines-scrollable",this._linesDomNodeScrollable.appendChild(this._linesDomNode),this._rootDomNode.className="sticky-widget",this._rootDomNode.classList.toggle("peek",e instanceof pd),this._rootDomNode.appendChild(this._lineNumbersDomNode),this._rootDomNode.appendChild(this._linesDomNodeScrollable),this._setHeight(0);const t=()=>{this._linesDomNode.style.left=this._editor.getOption(L.stickyScroll).scrollWithEditor?`-${this._editor.getScrollLeft()}px`:"0px"};this._register(this._editor.onDidChangeConfiguration(i=>{i.hasChanged(L.stickyScroll)&&t(),i.hasChanged(L.lineHeight)&&(this._lineHeight=this._editor.getOption(L.lineHeight))})),this._register(this._editor.onDidScrollChange(i=>{i.scrollLeftChanged&&t(),i.scrollWidthChanged&&this._updateWidgetWidth()})),this._register(this._editor.onDidChangeModel(()=>{t(),this._updateWidgetWidth()})),this._register(this._foldingIconStore),t(),this._register(this._editor.onDidLayoutChange(i=>{this._updateWidgetWidth()})),this._updateWidgetWidth()}get lineNumbers(){return this._lineNumbers}get lineNumberCount(){return this._lineNumbers.length}getRenderedStickyLine(e){return this._renderedStickyLines.find(t=>t.lineNumber===e)}getCurrentLines(){return this._lineNumbers}setState(e,t,i){if(i===void 0&&(!this._previousState&&!e||this._previousState&&this._previousState.equals(e)))return;const n=this._isWidgetHeightZero(e),o=n?void 0:e,r=n?0:this._findLineToRebuildWidgetFrom(e,i);this._renderRootNode(o,t,r),this._previousState=e}_isWidgetHeightZero(e){if(!e)return!0;const t=this._getHeightOfLines(e.startLineNumbers,e.lastLineRelativePosition);if(t>0){this._lastLineRelativePosition=e.lastLineRelativePosition;const i=[...e.startLineNumbers];e.showEndForLine!==null&&(i[e.showEndForLine]=e.endLineNumbers[e.showEndForLine]),this._lineNumbers=i}else this._lastLineRelativePosition=0,this._lineNumbers=[];return t===0}_findLineToRebuildWidgetFrom(e,t){if(!e||!this._previousState)return 0;if(t!==void 0)return t;const i=this._previousState,n=e.startLineNumbers.findIndex(o=>!i.startLineNumbers.includes(o));return n===-1?0:n}_updateWidgetWidth(){const e=this._editor.getLayoutInfo(),t=e.contentLeft;this._lineNumbersDomNode.style.width=`${t}px`,this._linesDomNodeScrollable.style.setProperty("--vscode-editorStickyScroll-scrollableWidth",`${this._editor.getScrollWidth()-e.verticalScrollbarWidth}px`),this._rootDomNode.style.width=`${e.width-e.verticalScrollbarWidth}px`}_clearStickyLinesFromLine(e){this._foldingIconStore.clear();for(let t=e;t<this._renderedStickyLines.length;t++){const i=this._renderedStickyLines[t];i.lineNumberDomNode.remove(),i.lineDomNode.remove()}this._renderedStickyLines=this._renderedStickyLines.slice(0,e)}_useFoldingOpacityTransition(e){this._lineNumbersDomNode.style.setProperty("--vscode-editorStickyScroll-foldingOpacityTransition",`opacity ${e?.5:0}s`)}_setFoldingIconsVisibility(e){for(const t of this._renderedStickyLines){const i=t.foldingIcon;i&&i.setVisible(e?!0:i.isCollapsed)}}async _renderRootNode(e,t,i){if(this._clearStickyLinesFromLine(i),!e){this._setHeight(0);return}let n=0;for(const c of this._renderedStickyLines)this._updatePosition(c,n),n+=c.height;const o=this._editor.getLayoutInfo(),r=this._lineNumbers.slice(i);for(const[c,d]of r.entries()){const l=this._renderChildNode(c+i,d,n,t,o);l&&(n+=l.height,this._linesDomNode.appendChild(l.lineDomNode),this._lineNumbersDomNode.appendChild(l.lineNumberDomNode),this._renderedStickyLines.push(l))}t&&(this._setFoldingHoverListeners(),this._useFoldingOpacityTransition(!this._isOnGlyphMargin));const a=n+this._lastLineRelativePosition;this._setHeight(a),this._rootDomNode.style.marginLeft="0px",this._minContentWidthInPx=Math.max(...this._renderedStickyLines.map(c=>c.scrollWidth))+o.verticalScrollbarWidth,this._editor.layoutOverlayWidget(this)}_getHeightOfLines(e,t){let i=0;for(let n=0;n<e.length;n++)i+=this._editor.getLineHeightForLineNumber(e[n]);return i+t}_setHeight(e){this._height!==e&&(this._height=e,this._height===0?this._rootDomNode.style.display="none":(this._rootDomNode.style.display="block",this._lineNumbersDomNode.style.height=`${this._height}px`,this._linesDomNodeScrollable.style.height=`${this._height}px`,this._rootDomNode.style.height=`${this._height}px`),this._onDidChangeStickyScrollHeight.fire({height:this._height}))}_setFoldingHoverListeners(){this._editor.getOption(L.showFoldingControls)==="mouseover"&&(this._foldingIconStore.add(re(this._lineNumbersDomNode,pe.MOUSE_ENTER,()=>{this._isOnGlyphMargin=!0,this._setFoldingIconsVisibility(!0)})),this._foldingIconStore.add(re(this._lineNumbersDomNode,pe.MOUSE_LEAVE,()=>{this._isOnGlyphMargin=!1,this._useFoldingOpacityTransition(!0),this._setFoldingIconsVisibility(!1)})))}_renderChildNode(e,t,i,n,o){const r=this._editor._getViewModel();if(!r)return;const a=r.coordinatesConverter.convertModelPositionToViewPosition(new we(t,1)).lineNumber,c=r.getViewLineRenderingData(a),d=this._editor.getOption(L.lineNumbers);let l;try{l=ME.filter(c.inlineDecorations,a,c.minColumn,c.maxColumn)}catch{l=[]}const u=this._editor.getLineHeightForLineNumber(t),g=new $se(!0,!0,c.content,c.continuesWithWrappedLine,c.isBasicASCII,c.containsRTL,0,c.tokens,l,c.tabSize,c.startVisibleColumn,1,1,1,500,"none",!0,!0,null),m=new lse(2e3),v=Use(g,m);let _;Xee?_=Xee.createHTML(m.build()):_=m.build();const w=document.createElement("span");w.setAttribute(J1,String(e)),w.setAttribute(Zee,""),w.setAttribute("role","listitem"),w.tabIndex=0,w.className="sticky-line-content",w.classList.add(`stickyLine${t}`),w.style.lineHeight=`${u}px`,w.innerHTML=_;const C=document.createElement("span");C.setAttribute(J1,String(e)),C.setAttribute(WBe,""),C.className="sticky-line-number",C.style.lineHeight=`${u}px`;const k=o.contentLeft;C.style.width=`${k}px`;const D=document.createElement("span");d.renderType===hs.On||d.renderType===hs.Interval&&t%10===0?D.innerText=t.toString():d.renderType===hs.Relative&&(D.innerText=Math.abs(t-this._editor.getPosition().lineNumber).toString()),D.className="sticky-line-number-inner",D.style.width=`${o.lineNumbersWidth}px`,D.style.paddingLeft=`${o.lineNumbersLeft}px`,C.appendChild(D);const A=this._renderFoldingIconForLine(n,t);A&&(C.appendChild(A.domNode),A.domNode.style.left=`${o.lineNumbersWidth+o.lineNumbersLeft}px`,A.domNode.style.lineHeight=`${u}px`),this._editor.applyFontInfo(w),this._editor.applyFontInfo(C),C.style.lineHeight=`${u}px`,w.style.lineHeight=`${u}px`,C.style.height=`${u}px`,w.style.height=`${u}px`;const B=new VBe(e,t,w,C,A,v.characterMapping,w.scrollWidth,u);return this._updatePosition(B,i)}_updatePosition(e,t){const i=e.index,n=e.lineDomNode,o=e.lineNumberDomNode;if(i===this._lineNumbers.length-1){const a="0";n.style.zIndex=a,o.style.zIndex=a;const c=`${t+this._lastLineRelativePosition+(e.foldingIcon?.isCollapsed?1:0)}px`;n.style.top=c,o.style.top=c}else{const a="1";n.style.zIndex=a,o.style.zIndex=a,n.style.top=`${t}px`,o.style.top=`${t}px`}return e}_renderFoldingIconForLine(e,t){const i=this._editor.getOption(L.showFoldingControls);if(!e||i==="never")return;const n=e.regions,o=n.findRange(t),r=n.getStartLineNumber(o);if(!(t===r))return;const c=n.isCollapsed(o),d=new HBe(c,r,n.getEndLineNumber(o),this._lineHeight);return d.setVisible(this._isOnGlyphMargin?!0:c||i==="always"),d.domNode.setAttribute(Jee,""),d}getId(){return"editor.contrib.stickyScrollWidget"}getDomNode(){return this._rootDomNode}getPosition(){return{preference:SI.TOP_CENTER,stackOridinal:10}}getMinContentWidthInPx(){return this._minContentWidthInPx}focusLineWithIndex(e){0<=e&&e<this._renderedStickyLines.length&&this._renderedStickyLines[e].lineDomNode.focus()}getEditorPositionFromNode(e){if(!e||e.children.length>0)return null;const t=this._getRenderedStickyLineFromChildDomNode(e);if(!t)return null;const i=vSe(t.characterMapping,e,0);return new we(t.lineNumber,i)}getLineNumberFromChildDomNode(e){return this._getRenderedStickyLineFromChildDomNode(e)?.lineNumber??null}_getRenderedStickyLineFromChildDomNode(e){const t=this.getLineIndexFromChildDomNode(e);return t===null||t<0||t>=this._renderedStickyLines.length?null:this._renderedStickyLines[t]}getLineIndexFromChildDomNode(e){const t=this._getAttributeValue(e,J1);return t?parseInt(t,10):null}isInStickyLine(e){return this._getAttributeValue(e,Zee)!==void 0}isInFoldingIconDomNode(e){return this._getAttributeValue(e,Jee)!==void 0}_getAttributeValue(e,t){for(;e&&e!==this._rootDomNode;){const i=e.getAttribute(t);if(i!==null)return i;e=e.parentElement}}}class VBe{constructor(e,t,i,n,o,r,a,c){this.index=e,this.lineNumber=t,this.lineDomNode=i,this.lineNumberDomNode=n,this.foldingIcon=o,this.characterMapping=r,this.scrollWidth=a,this.height=c}}class HBe{constructor(e,t,i,n){this.isCollapsed=e,this.foldingStartLine=t,this.foldingEndLine=i,this.dimension=n,this.domNode=document.createElement("div"),this.domNode.style.width="26px",this.domNode.style.height=`${n}px`,this.domNode.style.lineHeight=`${n}px`,this.domNode.className=ke.asClassName(e?_Se:bSe)}setVisible(e){this.domNode.style.cursor=e?"pointer":"default",this.domNode.style.opacity=e?"1":"0"}}class dE{constructor(e,t){this.startLineNumber=e,this.endLineNumber=t}}class kL{constructor(e,t,i){this.range=e,this.children=t,this.parent=i}}class uge{constructor(e,t,i,n){this.uri=e,this.version=t,this.element=i,this.outlineProviderId=n}}var lE;(function(s){s.OUTLINE_MODEL="outlineModel",s.FOLDING_PROVIDER_MODEL="foldingProviderModel",s.INDENTATION_MODEL="indentationModel"})(lE||(lE={}));var dp;(function(s){s[s.VALID=0]="VALID",s[s.INVALID=1]="INVALID",s[s.CANCELED=2]="CANCELED"})(dp||(dp={}));let a3=class extends F{constructor(e,t,i,n){switch(super(),this._editor=e,this._modelProviders=[],this._modelPromise=null,this._updateScheduler=this._register(new ju(300)),this._updateOperation=this._register(new U),this._editor.getOption(L.stickyScroll).defaultModel){case lE.OUTLINE_MODEL:this._modelProviders.push(new c3(this._editor,n));case lE.FOLDING_PROVIDER_MODEL:this._modelProviders.push(new l3(this._editor,t,n));case lE.INDENTATION_MODEL:this._modelProviders.push(new d3(this._editor,i));break}}dispose(){this._modelProviders.forEach(e=>e.dispose()),this._updateOperation.clear(),this._cancelModelPromise(),super.dispose()}_cancelModelPromise(){this._modelPromise&&(this._modelPromise.cancel(),this._modelPromise=null)}async update(e){return this._updateOperation.clear(),this._updateOperation.add({dispose:()=>{this._cancelModelPromise(),this._updateScheduler.cancel()}}),this._cancelModelPromise(),await this._updateScheduler.trigger(async()=>{for(const t of this._modelProviders){const{statusPromise:i,modelPromise:n}=t.computeStickyModel(e);this._modelPromise=n;const o=await i;if(this._modelPromise!==n)return null;switch(o){case dp.CANCELED:return this._updateOperation.clear(),null;case dp.VALID:return t.stickyModel}}return null}).catch(t=>(mt(t),null))}};a3=f([p(2,Z),p(3,Ne)],a3);class gge extends F{constructor(e){super(),this._editor=e,this._stickyModel=null}get stickyModel(){return this._stickyModel}_invalid(){return this._stickyModel=null,dp.INVALID}computeStickyModel(e){if(e.isCancellationRequested||!this.isProviderValid())return{statusPromise:this._invalid(),modelPromise:null};const t=Tn(i=>this.createModelFromProvider(i));return{statusPromise:t.then(i=>this.isModelValid(i)?e.isCancellationRequested?dp.CANCELED:(this._stickyModel=this.createStickyModel(e,i),dp.VALID):this._invalid()).then(void 0,i=>(mt(i),dp.CANCELED)),modelPromise:t}}isModelValid(e){return!0}isProviderValid(){return!0}}let c3=class extends gge{constructor(e,t){super(e),this._languageFeaturesService=t}createModelFromProvider(e){return zl.create(this._languageFeaturesService.documentSymbolProvider,this._editor.getModel(),e)}createStickyModel(e,t){const{stickyOutlineElement:i,providerID:n}=this._stickyModelFromOutlineModel(t,this._stickyModel?.outlineProviderId),o=this._editor.getModel();return new uge(o.uri,o.getVersionId(),i,n)}isModelValid(e){return e&&e.children.size>0}_stickyModelFromOutlineModel(e,t){let i;if(As.first(e.children.values())instanceof hB){const a=As.find(e.children.values(),c=>c.id===t);if(a)i=a.children;else{let c="",d=-1,l;for(const[u,g]of e.children.entries()){const m=this._findSumOfRangesOfGroup(g);m>d&&(l=g,d=m,c=g.id)}t=c,i=l.children}}else i=e.children;const n=[],o=Array.from(i.values()).sort((a,c)=>{const d=new dE(a.symbol.range.startLineNumber,a.symbol.range.endLineNumber),l=new dE(c.symbol.range.startLineNumber,c.symbol.range.endLineNumber);return this._comparator(d,l)});for(const a of o)n.push(this._stickyModelFromOutlineElement(a,a.symbol.selectionRange.startLineNumber));return{stickyOutlineElement:new kL(void 0,n,void 0),providerID:t}}_stickyModelFromOutlineElement(e,t){const i=[];for(const o of e.children.values())if(o.symbol.selectionRange.startLineNumber!==o.symbol.range.endLineNumber)if(o.symbol.selectionRange.startLineNumber!==t)i.push(this._stickyModelFromOutlineElement(o,o.symbol.selectionRange.startLineNumber));else for(const r of o.children.values())i.push(this._stickyModelFromOutlineElement(r,o.symbol.selectionRange.startLineNumber));i.sort((o,r)=>this._comparator(o.range,r.range));const n=new dE(e.symbol.selectionRange.startLineNumber,e.symbol.range.endLineNumber);return new kL(n,i,void 0)}_comparator(e,t){return e.startLineNumber!==t.startLineNumber?e.startLineNumber-t.startLineNumber:t.endLineNumber-e.endLineNumber}_findSumOfRangesOfGroup(e){let t=0;for(const i of e.children.values())t+=this._findSumOfRangesOfGroup(i);return e instanceof WA?t+e.symbol.range.endLineNumber-e.symbol.selectionRange.startLineNumber:t}};c3=f([p(1,Ne)],c3);class pge extends gge{constructor(e){super(e),this._foldingLimitReporter=this._register(new SSe(e))}createStickyModel(e,t){const i=this._fromFoldingRegions(t),n=this._editor.getModel();return new uge(n.uri,n.getVersionId(),i,void 0)}isModelValid(e){return e!==null}_fromFoldingRegions(e){const t=e.length,i=[],n=new kL(void 0,[],void 0);for(let o=0;o<t;o++){const r=e.getParentIndex(o);let a;r!==-1?a=i[r]:a=n;const c=new kL(new dE(e.getStartLineNumber(o),e.getEndLineNumber(o)+1),[],a);a.children.push(c),i.push(c)}return n}}let d3=class extends pge{constructor(e,t){super(e),this._languageConfigurationService=t,this.provider=this._register(new ySe(e.getModel(),this._languageConfigurationService,this._foldingLimitReporter))}async createModelFromProvider(e){return this.provider.compute(e)}};d3=f([p(1,ds)],d3);let l3=class extends pge{constructor(e,t,i){super(e),this._languageFeaturesService=i;const n=sq.getFoldingRangeProviders(this._languageFeaturesService,e.getModel());n.length>0&&(this.provider=this._register(new wSe(e.getModel(),n,t,this._foldingLimitReporter,void 0)))}isProviderValid(){return this.provider!==void 0}async createModelFromProvider(e){return this.provider?.compute(e)??null}};l3=f([p(2,Ne)],l3);class UBe{constructor(e,t,i,n){this.startLineNumber=e,this.endLineNumber=t,this.top=i,this.height=n}}let h3=class extends F{static{this.ID="store.contrib.stickyScrollController"}constructor(e,t,i){super(),this._languageFeaturesService=t,this._languageConfigurationService=i,this._onDidChangeStickyScroll=this._register(new M),this.onDidChangeStickyScroll=this._onDidChangeStickyScroll.event,this._model=null,this._cts=null,this._stickyModelProvider=null,this._editor=e,this._sessionStore=this._register(new U),this._updateSoon=this._register(new yn(()=>this.update(),50)),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.stickyScroll)&&this.readConfiguration()})),this.readConfiguration()}readConfiguration(){this._sessionStore.clear(),this._editor.getOption(L.stickyScroll).enabled&&(this._sessionStore.add(this._editor.onDidChangeModel(()=>{this._model=null,this.updateStickyModelProvider(),this._onDidChangeStickyScroll.fire(),this.update()})),this._sessionStore.add(this._editor.onDidChangeHiddenAreas(()=>this.update())),this._sessionStore.add(this._editor.onDidChangeModelContent(()=>this._updateSoon.schedule())),this._sessionStore.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>this.update())),this._sessionStore.add(Ie(()=>{this._stickyModelProvider?.dispose(),this._stickyModelProvider=null})),this.updateStickyModelProvider(),this.update())}getVersionId(){return this._model?.version}updateStickyModelProvider(){this._stickyModelProvider?.dispose(),this._stickyModelProvider=null;const e=this._editor;e.hasModel()&&(this._stickyModelProvider=new a3(e,()=>this._updateSoon.schedule(),this._languageConfigurationService,this._languageFeaturesService))}async update(){this._cts?.dispose(!0),this._cts=new li,await this.updateStickyModel(this._cts.token),this._onDidChangeStickyScroll.fire()}async updateStickyModel(e){if(!this._editor.hasModel()||!this._stickyModelProvider||this._editor.getModel().isTooLargeForTokenization()){this._model=null;return}const t=await this._stickyModelProvider.update(e);e.isCancellationRequested||(this._model=t)}updateIndex(e){return e===-1?e=0:e<0&&(e=-e-2),e}getCandidateStickyLinesIntersectingFromStickyModel(e,t,i,n,o,r){if(t.children.length===0)return;let a=r;const c=[];for(let u=0;u<t.children.length;u++){const g=t.children[u];g.range&&c.push(g.range.startLineNumber)}const d=this.updateIndex(MT(c,e.startLineNumber,(u,g)=>u-g)),l=this.updateIndex(MT(c,e.endLineNumber,(u,g)=>u-g));for(let u=d;u<=l;u++){const g=t.children[u];if(!g)return;const m=g.range;if(m){const v=m.startLineNumber,_=m.endLineNumber;if(e.startLineNumber<=_+1&&v-1<=e.endLineNumber&&v!==a){a=v;const w=this._editor.getLineHeightForLineNumber(v);i.push(new UBe(v,_-1,o,w)),this.getCandidateStickyLinesIntersectingFromStickyModel(e,g,i,n+1,o+w,v)}}else this.getCandidateStickyLinesIntersectingFromStickyModel(e,g,i,n,o,r)}}getCandidateStickyLinesIntersecting(e){if(!this._model?.element)return[];let t=[];this.getCandidateStickyLinesIntersectingFromStickyModel(e,this._model.element,t,0,0,-1);const i=this._editor._getViewModel()?.getHiddenAreas();if(i)for(const n of i)t=t.filter(o=>!(o.startLineNumber>=n.startLineNumber&&o.endLineNumber<=n.endLineNumber+1));return t}};h3=f([p(1,Ne),p(2,ds)],h3);var u3;let bd=class extends F{static{u3=this}static{this.ID="store.contrib.stickyScrollController"}constructor(e,t,i,n,o,r,a){super(),this._editor=e,this._contextMenuService=t,this._languageFeaturesService=i,this._instaService=n,this._contextKeyService=a,this._sessionStore=new U,this._maxStickyLines=Number.MAX_SAFE_INTEGER,this._candidateDefinitionsLength=-1,this._focusedStickyElementIndex=-1,this._enabled=!1,this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1,this._endLineNumbers=[],this._mouseTarget=null,this._onDidChangeStickyScrollHeight=this._register(new M),this.onDidChangeStickyScrollHeight=this._onDidChangeStickyScrollHeight.event,this._stickyScrollWidget=new BBe(this._editor),this._stickyLineCandidateProvider=new h3(this._editor,i,o),this._register(this._stickyScrollWidget),this._register(this._stickyLineCandidateProvider),this._widgetState=yb.Empty;const c=this._stickyScrollWidget.getDomNode();this._register(this._editor.onDidChangeLineHeight(l=>{l.changes.forEach(u=>{const g=u.lineNumber;this._widgetState.startLineNumbers.includes(g)&&this._renderStickyScroll(g)})})),this._register(this._editor.onDidChangeConfiguration(l=>{this._readConfigurationChange(l)})),this._register(re(c,pe.CONTEXT_MENU,async l=>{this._onContextMenu(Et(c),l)})),this._stickyScrollFocusedContextKey=V.stickyScrollFocused.bindTo(this._contextKeyService),this._stickyScrollVisibleContextKey=V.stickyScrollVisible.bindTo(this._contextKeyService);const d=this._register(Fo(c));this._register(d.onDidBlur(l=>{this._positionRevealed===!1&&c.clientHeight===0?(this._focusedStickyElementIndex=-1,this.focus()):this._disposeFocusStickyScrollStore()})),this._register(d.onDidFocus(l=>{this.focus()})),this._registerMouseListeners(),this._register(re(c,pe.MOUSE_DOWN,l=>{this._onMouseDown=!0})),this._register(this._stickyScrollWidget.onDidChangeStickyScrollHeight(l=>{this._onDidChangeStickyScrollHeight.fire(l)})),this._onDidResize(),this._readConfiguration()}get stickyScrollCandidateProvider(){return this._stickyLineCandidateProvider}get stickyScrollWidgetState(){return this._widgetState}get stickyScrollWidgetHeight(){return this._stickyScrollWidget.height}static get(e){return e.getContribution(u3.ID)}_disposeFocusStickyScrollStore(){this._stickyScrollFocusedContextKey.set(!1),this._focusDisposableStore?.dispose(),this._focused=!1,this._positionRevealed=!1,this._onMouseDown=!1}isFocused(){return this._focused}focus(){if(this._onMouseDown){this._onMouseDown=!1,this._editor.focus();return}this._stickyScrollFocusedContextKey.get()!==!0&&(this._focused=!0,this._focusDisposableStore=new U,this._stickyScrollFocusedContextKey.set(!0),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumbers.length-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}focusNext(){this._focusedStickyElementIndex<this._stickyScrollWidget.lineNumberCount-1&&this._focusNav(!0)}focusPrevious(){this._focusedStickyElementIndex>0&&this._focusNav(!1)}selectEditor(){this._editor.focus()}_focusNav(e){this._focusedStickyElementIndex=e?this._focusedStickyElementIndex+1:this._focusedStickyElementIndex-1,this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex)}goToFocused(){const e=this._stickyScrollWidget.lineNumbers;this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:e[this._focusedStickyElementIndex],column:1})}_revealPosition(e){this._reveaInEditor(e,()=>this._editor.revealPosition(e))}_revealLineInCenterIfOutsideViewport(e){this._reveaInEditor(e,()=>this._editor.revealLineInCenterIfOutsideViewport(e.lineNumber,Qi.Smooth))}_reveaInEditor(e,t){this._focused&&this._disposeFocusStickyScrollStore(),this._positionRevealed=!0,t(),this._editor.setSelection(P.fromPositions(e)),this._editor.focus()}_registerMouseListeners(){const e=this._register(new U),t=this._register(new qN(this._editor,{extractLineNumberFromMouseEvent:c=>{const d=this._stickyScrollWidget.getEditorPositionFromNode(c.target.element);return d?d.lineNumber:0}})),i=c=>{if(!this._editor.hasModel()||c.target.type!==xi.OVERLAY_WIDGET||c.target.detail!==this._stickyScrollWidget.getId())return null;const d=c.target.element;if(!d||d.innerText!==d.innerHTML)return null;const l=this._stickyScrollWidget.getEditorPositionFromNode(d);return l?{range:new P(l.lineNumber,l.column,l.lineNumber,l.column+d.innerText.length),textElement:d}:null},n=this._stickyScrollWidget.getDomNode();this._register(No(n,pe.CLICK,c=>{if(c.ctrlKey||c.altKey||c.metaKey||!c.leftButton)return;if(c.shiftKey){const g=this._stickyScrollWidget.getLineIndexFromChildDomNode(c.target);if(g===null)return;const m=new we(this._endLineNumbers[g],1);this._revealLineInCenterIfOutsideViewport(m);return}if(this._stickyScrollWidget.isInFoldingIconDomNode(c.target)){const g=this._stickyScrollWidget.getLineNumberFromChildDomNode(c.target);this._toggleFoldingRegionForLine(g);return}if(!this._stickyScrollWidget.isInStickyLine(c.target))return;let u=this._stickyScrollWidget.getEditorPositionFromNode(c.target);if(!u){const g=this._stickyScrollWidget.getLineNumberFromChildDomNode(c.target);if(g===null)return;u=new we(g,1)}this._revealPosition(u)}));const o=c=>{this._mouseTarget=c.target,this._onMouseMoveOrKeyDown(c)},r=c=>{this._onMouseMoveOrKeyDown(c)},a=c=>{this._showEndForLine!==void 0&&(this._showEndForLine=void 0,this._renderStickyScroll())};zi.addEventListener(pe.MOUSE_MOVE,o),zi.addEventListener(pe.KEY_DOWN,r),zi.addEventListener(pe.KEY_UP,a),this._register(Ie(()=>{zi.removeEventListener(pe.MOUSE_MOVE,o),zi.removeEventListener(pe.KEY_DOWN,r),zi.removeEventListener(pe.KEY_UP,a)})),this._register(t.onMouseMoveOrRelevantKeyDown(([c,d])=>{const l=i(c);if(!l||!c.hasTriggerModifier||!this._editor.hasModel()){e.clear();return}const{range:u,textElement:g}=l;if(!u.equalsRange(this._stickyRangeProjectedOnEditor))this._stickyRangeProjectedOnEditor=u,e.clear();else if(g.style.textDecoration==="underline")return;const m=new li;e.add(Ie(()=>m.dispose(!0)));let v;RI(this._languageFeaturesService.definitionProvider,this._editor.getModel(),new we(u.startLineNumber,u.startColumn+1),!1,m.token).then(_=>{if(!m.token.isCancellationRequested)if(_.length!==0){this._candidateDefinitionsLength=_.length;const w=g;v!==w?(e.clear(),v=w,v.style.textDecoration="underline",e.add(Ie(()=>{v.style.textDecoration="none"}))):v||(v=w,v.style.textDecoration="underline",e.add(Ie(()=>{v.style.textDecoration="none"})))}else e.clear()})})),this._register(t.onCancel(()=>{e.clear()})),this._register(t.onExecute(async c=>{if(c.target.type!==xi.OVERLAY_WIDGET||c.target.detail!==this._stickyScrollWidget.getId())return;const d=this._stickyScrollWidget.getEditorPositionFromNode(c.target.element);d&&(!this._editor.hasModel()||!this._stickyRangeProjectedOnEditor||(this._candidateDefinitionsLength>1&&(this._focused&&this._disposeFocusStickyScrollStore(),this._revealPosition({lineNumber:d.lineNumber,column:1})),this._instaService.invokeFunction(kae,c,this._editor,{uri:this._editor.getModel().uri,range:this._stickyRangeProjectedOnEditor})))}))}_onContextMenu(e,t){const i=new bs(e,t);this._contextMenuService.showContextMenu({menuId:N.StickyScrollContext,getAnchor:()=>i})}_onMouseMoveOrKeyDown(e){if(!e.shiftKey||!this._mouseTarget||!Ph(this._mouseTarget))return;const t=this._stickyScrollWidget.getLineIndexFromChildDomNode(this._mouseTarget);t===null||this._showEndForLine===t||(this._showEndForLine=t,this._renderStickyScroll())}_toggleFoldingRegionForLine(e){if(!this._foldingModel||e===null)return;const t=this._stickyScrollWidget.getRenderedStickyLine(e),i=t?.foldingIcon;if(!i)return;CSe(this._foldingModel,1,[e]),i.isCollapsed=!i.isCollapsed;const n=(i.isCollapsed?this._editor.getTopForLineNumber(i.foldingEndLine):this._editor.getTopForLineNumber(i.foldingStartLine))-this._editor.getOption(L.lineHeight)*t.index+1;this._editor.setScrollTop(n),this._renderStickyScroll(e)}_readConfiguration(){const e=this._editor.getOption(L.stickyScroll);if(e.enabled===!1){this._editor.removeOverlayWidget(this._stickyScrollWidget),this._resetState(),this._sessionStore.clear(),this._enabled=!1;return}else e.enabled&&!this._enabled&&(this._editor.addOverlayWidget(this._stickyScrollWidget),this._sessionStore.add(this._editor.onDidScrollChange(i=>{i.scrollTopChanged&&(this._showEndForLine=void 0,this._renderStickyScroll())})),this._sessionStore.add(this._editor.onDidLayoutChange(()=>this._onDidResize())),this._sessionStore.add(this._editor.onDidChangeModelTokens(i=>this._onTokensChange(i))),this._sessionStore.add(this._stickyLineCandidateProvider.onDidChangeStickyScroll(()=>{this._showEndForLine=void 0,this._renderStickyScroll()})),this._enabled=!0);this._editor.getOption(L.lineNumbers).renderType===hs.Relative&&this._sessionStore.add(this._editor.onDidChangeCursorPosition(()=>{this._showEndForLine=void 0,this._renderStickyScroll(0)}))}_readConfigurationChange(e){(e.hasChanged(L.stickyScroll)||e.hasChanged(L.minimap)||e.hasChanged(L.lineHeight)||e.hasChanged(L.showFoldingControls)||e.hasChanged(L.lineNumbers))&&this._readConfiguration(),(e.hasChanged(L.lineNumbers)||e.hasChanged(L.folding)||e.hasChanged(L.showFoldingControls))&&this._renderStickyScroll(0)}_needsUpdate(e){const t=this._stickyScrollWidget.getCurrentLines();for(const i of t)for(const n of e.ranges)if(i>=n.fromLineNumber&&i<=n.toLineNumber)return!0;return!1}_onTokensChange(e){this._needsUpdate(e)&&this._renderStickyScroll(0)}_onDidResize(){const t=this._editor.getLayoutInfo().height/this._editor.getOption(L.lineHeight);this._maxStickyLines=Math.round(t*.25),this._renderStickyScroll(0)}async _renderStickyScroll(e){const t=this._editor.getModel();if(!t||t.isTooLargeForTokenization()){this._resetState();return}const i=this._updateAndGetMinRebuildFromLine(e),n=this._stickyLineCandidateProvider.getVersionId();if(n===void 0||n===t.getVersionId())if(!this._focused)await this._updateState(i);else if(this._focusedStickyElementIndex===-1)await this._updateState(i),this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1,this._focusedStickyElementIndex!==-1&&this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex);else{const r=this._stickyScrollWidget.lineNumbers[this._focusedStickyElementIndex];await this._updateState(i),this._stickyScrollWidget.lineNumberCount===0?this._focusedStickyElementIndex=-1:(this._stickyScrollWidget.lineNumbers.includes(r)||(this._focusedStickyElementIndex=this._stickyScrollWidget.lineNumberCount-1),this._stickyScrollWidget.focusLineWithIndex(this._focusedStickyElementIndex))}}_updateAndGetMinRebuildFromLine(e){if(e!==void 0){const t=this._minRebuildFromLine!==void 0?this._minRebuildFromLine:1/0;this._minRebuildFromLine=Math.min(e,t)}return this._minRebuildFromLine}async _updateState(e){this._minRebuildFromLine=void 0,this._foldingModel=await sq.get(this._editor)?.getFoldingModel()??void 0,this._widgetState=this.findScrollWidgetState();const t=this._widgetState.startLineNumbers.length>0;this._stickyScrollVisibleContextKey.set(t),this._stickyScrollWidget.setState(this._widgetState,this._foldingModel,e)}async _resetState(){this._minRebuildFromLine=void 0,this._foldingModel=void 0,this._widgetState=yb.Empty,this._stickyScrollVisibleContextKey.set(!1),this._stickyScrollWidget.setState(void 0,void 0)}findScrollWidgetState(){if(!this._editor.hasModel())return yb.Empty;const e=this._editor.getModel(),t=Math.min(this._maxStickyLines,this._editor.getOption(L.stickyScroll).maxLineCount),i=this._editor.getScrollTop();let n=0;const o=[],r=[],a=this._editor.getVisibleRanges();if(a.length!==0){const c=new dE(a[0].startLineNumber,a[a.length-1].endLineNumber),d=this._stickyLineCandidateProvider.getCandidateStickyLinesIntersecting(c);for(const l of d){const u=l.startLineNumber,g=l.endLineNumber;if(e.isValidRange({startLineNumber:u,endLineNumber:g,startColumn:1,endColumn:1})&&g-u>0){const v=l.top,_=v+l.height,w=this._editor.getTopForLineNumber(u)-i,C=this._editor.getBottomForLineNumber(g)-i;if(v>w&&v<=C&&(o.push(u),r.push(g+1),_>C&&(n=C-_)),o.length===t)break}}}return this._endLineNumbers=r,new yb(o,r,n,this._showEndForLine)}dispose(){super.dispose(),this._sessionStore.dispose()}};bd=u3=f([p(1,bi),p(2,Ne),p(3,Z),p(4,ds),p(5,Sd),p(6,fe)],bd);const hE=H("inlineEdit.originalBackground",et(gm,.2),h(1278,"Background color for the original text in inline edits."),!0),fge=H("inlineEdit.modifiedBackground",et(j_,.3),h(1279,"Background color for the modified text in inline edits."),!0);H("inlineEdit.originalChangedLineBackground",et(gm,.8),h(1280,"Background color for the changed lines in the original text of inline edits."),!0);const $Be=H("inlineEdit.originalChangedTextBackground",et(gm,.8),h(1281,"Overlay color for the changed text in the original text of inline edits."),!0),GBe=H("inlineEdit.modifiedChangedLineBackground",{light:et(BD,.7),dark:et(BD,.7),hcDark:BD,hcLight:BD},h(1282,"Background color for the changed lines in the modified text of inline edits."),!0),zBe=H("inlineEdit.modifiedChangedTextBackground",et(j_,.7),h(1283,"Overlay color for the changed text in the modified text of inline edits."),!0),qBe=H("inlineEdit.gutterIndicator.primaryForeground",oN,h(1284,"Foreground color for the primary inline edit gutter indicator.")),wb=H("inlineEdit.gutterIndicator.primaryBorder",Zz,h(1285,"Border color for the primary inline edit gutter indicator.")),mge=H("inlineEdit.gutterIndicator.primaryBackground",{light:et(wb,.5),dark:et(wb,.4),hcDark:et(wb,.4),hcLight:et(wb,.5)},h(1286,"Background color for the primary inline edit gutter indicator.")),KBe=H("inlineEdit.gutterIndicator.secondaryForeground",eye,h(1287,"Foreground color for the secondary inline edit gutter indicator.")),vge=H("inlineEdit.gutterIndicator.secondaryBorder",tye,h(1288,"Border color for the secondary inline edit gutter indicator.")),_ge=H("inlineEdit.gutterIndicator.secondaryBackground",vge,h(1289,"Background color for the secondary inline edit gutter indicator.")),jBe=H("inlineEdit.gutterIndicator.successfulForeground",oN,h(1290,"Foreground color for the successful inline edit gutter indicator.")),bge=H("inlineEdit.gutterIndicator.successfulBorder",Zz,h(1291,"Border color for the successful inline edit gutter indicator.")),yge=H("inlineEdit.gutterIndicator.successfulBackground",bge,h(1292,"Background color for the successful inline edit gutter indicator.")),YBe=H("inlineEdit.gutterIndicator.background",{hcDark:et("tab.inactiveBackground",.5),hcLight:et("tab.inactiveBackground",.5),dark:et("tab.inactiveBackground",.5),light:"#5f5f5f18"},h(1293,"Background color for the inline edit gutter indicator.")),nC=H("inlineEdit.originalBorder",{light:gm,dark:gm,hcDark:gm,hcLight:gm},h(1294,"Border color for the original text in inline edits.")),sC=H("inlineEdit.modifiedBorder",{light:yr(j_,.6),dark:j_,hcDark:j_,hcLight:j_},h(1295,"Border color for the modified text in inline edits.")),QBe=H("inlineEdit.tabWillAcceptModifiedBorder",{light:yr(sC,0),dark:yr(sC,0),hcDark:yr(sC,0),hcLight:yr(sC,0)},h(1296,"Modified border color for the inline edits widget when tab will accept it.")),XBe=H("inlineEdit.tabWillAcceptOriginalBorder",{light:yr(nC,0),dark:yr(nC,0),hcDark:yr(nC,0),hcLight:yr(nC,0)},h(1297,"Original border color for the inline edits widget over the original text when tab will accept it."));function Vx(s){return s.map(e=>e===Fs.Accept?QBe:sC)}function w0(s){return s.map(e=>e===Fs.Accept?XBe:nC)}function za(s,e){let t;typeof s=="string"?t=eF(s,e):t=s.map((n,o)=>eF(n,e).read(o));const i=eF(ss,e);return t.map((n,o)=>n.makeOpaque(i.read(o)))}function eF(s,e){return iye({owner:{observeColor:s},equalsFn:(t,i)=>t.equals(i)},e.onDidColorThemeChange,()=>{const t=e.getColorTheme().getColor(s);if(!t)throw new tn(`Missing color: ${s}`);return t})}function Hm(s,e,t){s.layoutInfo.read(t),s.value.read(t);const i=s.model.read(t);if(!i)return 0;let n=0;s.scrollTop.read(t);for(let r=e.startLineNumber;r<e.endLineNumberExclusive;r++){const a=i.getLineMaxColumn(r);let c=s.editor.getOffsetForColumn(r,a);if(c===-1){const d=s.editor.getOption(L.fontInfo).typicalHalfwidthCharacterWidth;c=a*d}n=Math.max(n,c)}const o=e.mapToLineArray(r=>i.getLineContent(r));return n<5&&o.some(r=>r.length>0)&&i.uri.scheme!=="file"&&console.error("unexpected width"),n}function ZBe(s,e,t){return s.layoutInfo.read(t),s.value.read(t),s.model.read(t)?(s.scrollTop.read(t),s.editor.getOffsetForColumn(e.lineNumber,e.column)):0}function b5(s,e,t,i){const n=i.getModel();if(!n)return{prefixTrim:0,prefixLeftOffset:0};const o=s.map(u=>u.isSingleLine()?u.startColumn-1:0),r=e.mapToLineArray(u=>c8(n.getLineContent(u))),a=t.filter(u=>u!=="").map(u=>c8(u)),c=Math.min(...o,...r,...a);let d;if(n.getLineIndentColumn(e.startLineNumber)>=c+1)d=i.getOffsetForColumn(e.startLineNumber,c+1);else if(t.length>0)d=wge(t[0].slice(0,c),i,n);else return{prefixTrim:0,prefixLeftOffset:0};return{prefixTrim:c,prefixLeftOffset:d}}function wge(s,e,t){const i=e.getOption(L.fontInfo).typicalHalfwidthCharacterWidth,n=t.getOptions().tabSize*i,o=s.split("	").length-1;return(s.length-o)*i+o*n}function JBe(s,e){const t=[];for(const i of s){const n=e.mapRange(i.modifiedRange);t.push(new yz(i.originalRange,n))}return t}function tF(...s){return s.filter(e=>typeof e=="string").join(" ")}function eVe(s,e){return new P(e.lineNumber,e.column+s.start,e.lineNumber,e.column+s.endExclusive)}function tVe(s,e){const t=Ch(s),i=[],n=nye(e.mapToLineArray(o=>sye(t[o-1])),fl);return e.forEach(o=>{i.push(new ps(eVe(new Hi(0,n),new we(o,1)),""))}),new hc(i)}class g3{constructor(){this._data=""}moveTo(e){return this._data+=`M ${e.x} ${e.y} `,this}lineTo(e){return this._data+=`L ${e.x} ${e.y} `,this}curveTo(e,t){return this._data+=`Q ${e.x} ${e.y} ${t.x} ${t.y} `,this}curveTo2(e,t,i){return this._data+=`C ${e.x} ${e.y} ${t.x} ${t.y} ${i.x} ${i.y} `,this}build(){return this._data}}function Jp(s){const e=Nv(void 0,(t,i)=>s.read(t)||i);return Yl({debugName:()=>`${s.debugName}.mapOutFalsy`},t=>{if(e.read(t),!!s.read(t))return e})}function Ou(s){return{left:ve(e=>s(e).left),top:ve(e=>s(e).top),width:ve(e=>s(e).right-s(e).left),height:ve(e=>s(e).bottom-s(e).top)}}let p3=class{constructor(e,t,i,n,o,r){this._model=e,this._close=t,this._editorObs=i,this._contextKeyService=n,this._keybindingService=o,this._commandService=r,this._inlineEditsShowCollapsed=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.showCollapsed)}toDisposableLiveElement(){return this._createHoverContent().toDisposableLiveElement()}_createHoverContent(){const e=si("active",void 0),t=u=>({title:u.title,icon:u.icon,keybinding:typeof u.commandId=="string"?this._getKeybinding(u.commandArgs?void 0:u.commandId):ve(g=>typeof u.commandId=="string"?void 0:this._getKeybinding(u.commandArgs?void 0:u.commandId.read(g)).read(g)),isActive:e.map(g=>g===u.id),onHoverChange:g=>e.set(g?u.id:void 0,void 0),onAction:()=>(this._close(!0),this._commandService.executeCommand(typeof u.commandId=="string"?u.commandId:u.commandId.get(),...u.commandArgs??[]))}),i=nVe(this._model.displayName),n=x_(t({id:"gotoAndAccept",title:`${h(1271,"Go To")} / ${h(1272,"Accept")}`,icon:this._model.tabAction.map(u=>u===Fs.Accept?K.check:K.arrowRight),commandId:this._model.tabAction.map(u=>u===Fs.Accept?px:wde)})),o=x_(t({id:"reject",title:h(1273,"Reject"),icon:K.close,commandId:Sde})),r=this._model.extensionCommands.map((u,g)=>x_(t({id:u.id+"_"+g,title:u.title,icon:K.symbolEvent,commandId:u.id,commandArgs:u.arguments}))),a=this._inlineEditsShowCollapsed.map(u=>x_(t(u?{id:"showExpanded",title:h(1274,"Show Expanded"),icon:K.expandAll,commandId:tH}:{id:"showCollapsed",title:h(1275,"Show Collapsed"),icon:K.collapseAll,commandId:tH}))),c=x_(t({id:"settings",title:h(1276,"Settings"),icon:K.gear,commandId:"workbench.action.openSettings",commandArgs:["@tag:nextEditSuggestions"]})),d=this._model.action?[this._model.action]:[],l=d.length>0?sVe(d.map(u=>({id:u.id,label:u.title,enabled:!0,run:()=>this._commandService.executeCommand(u.id,...u.arguments??[]),class:void 0,tooltip:u.tooltip??u.title})),{hoverDelegate:cye}):void 0;return iVe([i,n,o,a,c,r.length?ete():void 0,...r,l?ete():void 0,l])}_getKeybinding(e){return e?kn(this._contextKeyService.onDidChangeContext,()=>this._keybindingService.lookupKeybinding(e)):Li(void 0)}};p3=f([p(3,fe),p(4,He),p(5,Ge)],p3);function iVe(s){return dt.div({class:"content",style:{margin:4,minWidth:150}},s)}function nVe(s){return dt.div({class:"header",style:{color:vt(oye),fontSize:"12px",fontWeight:"600",padding:"0 10px",lineHeight:26}},[s])}function x_(s){return Mv((e,t)=>dt.div({class:["monaco-menu-option",s.isActive?.map(i=>i&&"active")],onmouseenter:()=>s.onHoverChange?.(!0),onmouseleave:()=>s.onHoverChange?.(!1),onclick:s.onAction,onkeydown:i=>{i.key==="Enter"&&s.onAction?.()},tabIndex:0,style:{borderRadius:3}},[dt.elem("span",{style:{fontSize:16,display:"flex"}},[ke.isThemeIcon(s.icon)?gy(s.icon):s.icon.map(i=>gy(i))]),dt.elem("span",{},[s.title]),dt.div({style:{marginLeft:"auto"},ref:i=>{const n=t.add(new VM(i,$u,{disableTitle:!0,...Bne,keybindingLabelShadow:void 0,keybindingLabelBackground:vt(rye),keybindingLabelBorder:"transparent",keybindingLabelBottomBorder:void 0}));t.add(fi(o=>{n.set(s.keybinding.read(o))}))}})]))}function sVe(s,e){return Mv((t,i)=>dt.div({class:["action-widget-action-bar"],style:{padding:"0 10px"}},[dt.div({ref:n=>{i.add(new Ar(n,e)).push(s,{icon:!1,label:!0})}})]))}function ete(){return dt.div({id:"inline-edit-gutter-indicator-menu-separator",class:"menu-separator",style:{color:vt(aye),padding:"4px 0"}},dt.div({style:{borderBottom:`1px solid ${vt(pse)}`}}))}let f3=class extends F{get model(){const e=this._model.get();if(!e)throw new tn("Inline Edit Model not available");return e}constructor(e,t,i,n,o,r,a,c,d,l){super(),this._editorObs=e,this._originalRange=t,this._verticalOffset=i,this._model=n,this._isHoveringOverInlineEdit=o,this._focusIsInMenu=r,this._hoverService=a,this._instantiationService=c,this._accessibilityService=d,this._originalRangeObs=Jp(this._originalRange),this._state=ve(u=>{const g=this._originalRangeObs.read(u);if(g)return{range:g,lineOffsetRange:this._editorObs.observeLineOffsetRange(g,this._store)}}),this._stickyScrollController=bd.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?kn(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):Li(0),this._lineNumberToRender=ve(this,u=>{if(this._verticalOffset.read(u)!==0)return"";const g=this._originalRange.read(u)?.startLineNumber,m=this._editorObs.getOption(L.lineNumbers).read(u);if(g===void 0||m.renderType===hs.Off)return"";if(m.renderType===hs.Interval){const v=this._editorObs.cursorPosition.read(u);return g%10===0||v&&v.lineNumber===g?g.toString():""}if(m.renderType===hs.Relative){const v=this._editorObs.cursorPosition.read(u);if(!v)return"";const _=Math.abs(g-v.lineNumber);return _===0?g.toString():_.toString()}return m.renderType===hs.Custom?m.renderFn?m.renderFn(g):"":g.toString()}),this._availableWidthForIcon=ve(this,u=>{const g=this._editorObs.editor.getModel(),m=this._editorObs.editor,v=this._editorObs.layoutInfo.read(u),_=v.decorationsLeft+v.decorationsWidth-v.glyphMarginLeft;if(!g||_<=0)return()=>0;if(v.lineNumbersLeft===0)return()=>_;const w=this._editorObs.getOption(L.lineNumbers).read(u);if(w.renderType===hs.Relative||w.renderType===hs.Off)return()=>_;const C=m.getOption(L.fontInfo).typicalHalfwidthCharacterWidth,k=v.lineNumbersLeft+v.lineNumbersWidth,A=(g.getLineCount()+1).toString().length,B=[];for(let q=1;q<=A;q++){const Q=10**(q-1),ie=m.getTopForLineNumber(Q),oe=q*C,be=Math.min(_,Math.max(0,k-oe-v.glyphMarginLeft));B.push({firstLineNumberWithDigitCount:Q,topOfLineNumber:ie,usableWidthLeftOfLineNumber:be})}return q=>{for(let Q=B.length-1;Q>=0;Q--)if(q>=B[Q].topOfLineNumber)return B[Q].usableWidthLeftOfLineNumber;throw new tn("Could not find avilable width for icon")}}),this._layout=ve(this,u=>{const g=this._state.read(u);if(!g)return;const m=this._editorObs.layoutInfo.read(u),v=this._editorObs.getOption(L.lineHeight).read(u),_=1,w=m.decorationsLeft+m.decorationsWidth-m.glyphMarginLeft-2*_,C=m.height-2*_,k=ri.fromLeftTopWidthHeight(_,_,w,C),D=k.withTop(this._stickyScrollHeight.read(u)+_),A=g.lineOffsetRange.read(u),B=ri.fromRanges(Hi.fromTo(D.left,D.right),A),q=v,Q=this._verticalOffset.read(u),ie=B.withHeight(q).translateY(Q),oe=D.containsRect(ie),be=this._tabAction.map(on=>on===Fs.Accept?K.keyboardTab:K.arrowRight),me=ve(on=>{if(this._isHoveredOverIconDebounced.read(on)||this._isHoveredOverInlineEditDebounced.read(on))return K.check;if(this._tabAction.read(on)===Fs.Accept)return K.keyboardTab;const Ks=this._editorObs.cursorLineNumber.read(on)??0,Tg=g.range.read(on).startLineNumber;return Ks<=Tg?K.keyboardTabAbove:K.keyboardTabBelow}),zt=22,ft=16,Qt=on=>{const Ks=this._availableWidthForIcon.get()(on.bottom+this._editorObs.editor.getScrollTop())-_;return Math.max(Math.min(Ks,zt),ft)};if(oe){const on=ie,Ks=Math.max(m.lineNumbersLeft+m.lineNumbersWidth-k.left,0),Tg=on.withWidth(Ks),Mf=Math.max(Math.min(m.decorationsWidth,zt),ft),Nf=on.withWidth(Mf).translateX(Ks);return{gutterEditArea:B,icon:me,iconDirection:"right",iconRect:Nf,pillRect:on,lineNumberRect:Tg}}const Ae=k.intersect(B);if(Ae&&Ae.height>=q){const on=ie.moveToBeContainedIn(D).moveToBeContainedIn(Ae),Ks=on.withWidth(Qt(on));return{gutterEditArea:B,icon:me,iconDirection:"right",iconRect:Ks,pillRect:Ks}}const jn=ie.moveToBeContainedIn(k),_i=jn.withWidth(Qt(jn)),vn=_i,Cs=_i.top<ie.top?"top":"bottom";return{gutterEditArea:B,icon:be,iconDirection:Cs,iconRect:vn,pillRect:_i}}),this._iconRef=dt.ref(),this.isVisible=this._layout.map(u=>!!u),this._hoverVisible=si(this,!1),this.isHoverVisible=this._hoverVisible,this._isHoveredOverIcon=si(this,!1),this._isHoveredOverIconDebounced=d8(this._isHoveredOverIcon,100),this.isHoveredOverIcon=this._isHoveredOverIconDebounced,this._tabAction=ve(this,u=>{const g=this._model.read(u);return g?g.tabAction.read(u):Fs.Inactive}),this._indicator=dt.div({class:"inline-edits-view-gutter-indicator",onclick:()=>{const g=this._layout.get()?.icon.get()===K.check;this._editorObs.editor.focus(),g?this.model.accept():this.model.jump()},tabIndex:0,style:{position:"absolute",overflow:"visible"}},Jp(this._layout).map(u=>u?[dt.div({style:{position:"absolute",background:vt(YBe),borderRadius:"4px",...Ou(g=>u.read(g).gutterEditArea)}}),dt.div({class:"icon",ref:this._iconRef,onmouseenter:()=>{this._showHover()},style:{cursor:"pointer",zIndex:"20",position:"absolute",backgroundColor:this._gutterIndicatorStyles.map(g=>g.background),"--vscodeIconForeground":this._gutterIndicatorStyles.map(g=>g.foreground),border:this._gutterIndicatorStyles.map(g=>`1px solid ${g.border}`),boxSizing:"border-box",borderRadius:"4px",display:"flex",justifyContent:"flex-end",transition:"background-color 0.2s ease-in-out, width 0.2s ease-in-out",...Ou(g=>u.read(g).pillRect)}},[dt.div({className:"line-number",style:{lineHeight:u.map(g=>g.lineNumberRect?g.lineNumberRect.height:0),display:u.map(g=>g.lineNumberRect?"flex":"none"),alignItems:"center",justifyContent:"flex-end",width:u.map(g=>g.lineNumberRect?g.lineNumberRect.width:0),height:"100%",color:this._gutterIndicatorStyles.map(g=>g.foreground)}},this._lineNumberToRender),dt.div({style:{rotate:u.map(g=>`${oVe(g.iconDirection)}deg`),transition:"rotate 0.2s ease-in-out",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",marginRight:u.map(g=>g.pillRect.width-g.iconRect.width-(g.lineNumberRect?.width??0)),width:u.map(g=>g.iconRect.width)}},[u.map((g,m)=>gy(g.icon.read(m)))])])]:[])).keepUpdated(this._store),this._gutterIndicatorStyles=this._tabAction.map((u,g)=>{switch(u){case Fs.Inactive:return{background:za(_ge,l).read(g).toString(),foreground:za(KBe,l).read(g).toString(),border:za(vge,l).read(g).toString()};case Fs.Jump:return{background:za(mge,l).read(g).toString(),foreground:za(qBe,l).read(g).toString(),border:za(wb,l).read(g).toString()};case Fs.Accept:return{background:za(yge,l).read(g).toString(),foreground:za(jBe,l).read(g).toString(),border:za(bge,l).read(g).toString()}}}),this._register(this._editorObs.createOverlayWidget({domNode:this._indicator.element,position:Li(null),allowEditorOverflow:!1,minContentWidthInPx:Li(0)})),this._register(this._editorObs.editor.onMouseMove(u=>{if(this._state.get()===void 0)return;const v=this._iconRef.element.getBoundingClientRect(),_=ri.fromLeftTopWidthHeight(v.left,v.top,v.width,v.height),w=new fu(u.event.posx,u.event.posy);this._isHoveredOverIcon.set(_.containsPoint(w),void 0)})),this._register(this._editorObs.editor.onDidScrollChange(()=>{this._isHoveredOverIcon.set(!1,void 0)})),this._isHoveredOverInlineEditDebounced=d8(this._isHoveringOverInlineEdit,100),this._register(_C(this._isHoveredOverInlineEditDebounced,u=>{u&&this.triggerAnimation()})),this._register(fi(u=>{this._indicator.readEffect(u),this._indicator.element&&this._editorObs.editor.applyFontInfo(this._indicator.element)}))}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{outline:`2px solid ${this._gutterIndicatorStyles.map(t=>t.border).get()}`,outlineOffset:"-1px",offset:0},{outline:"2px solid transparent",outlineOffset:"10px",offset:1}],{duration:500}).finished}_showHover(){if(this._hoverVisible.get())return;const e=new U,t=e.add(this._instantiationService.createInstance(p3,this.model,o=>{o&&this._editorObs.editor.focus(),n?.dispose()},this._editorObs).toDisposableLiveElement()),i=e.add(Fo(t.element));e.add(i.onDidBlur(()=>this._focusIsInMenu.set(!1,void 0))),e.add(i.onDidFocus(()=>this._focusIsInMenu.set(!0,void 0))),e.add(Ie(()=>this._focusIsInMenu.set(!1,void 0)));const n=this._hoverService.showInstantHover({target:this._iconRef.element,content:t.element});n?(this._hoverVisible.set(!0,void 0),e.add(this._editorObs.editor.onDidScrollChange(()=>n.dispose())),e.add(n.onDispose(()=>{this._hoverVisible.set(!1,void 0),e.dispose()}))):e.dispose()}};f3=f([p(6,Ti),p(7,Z),p(8,Nr),p(9,pt)],f3);function oVe(s){switch(s){case"top":return 90;case"bottom":return-90;case"right":return 0}}var pa;(function(s){s.FirstTime="firstTime",s.SecondTime="secondTime",s.Active="active"})(pa||(pa={}));let m3=class extends F{constructor(e,t,i,n,o,r){super(),this._host=e,this._model=t,this._indicator=i,this._collapsedView=n,this._storageService=o,this._configurationService=r,this._disposables=this._register(new Pt),this._setupDone=si({name:"setupDone"},!1),this._activeCompletionId=ve(a=>{const c=this._model.read(a);if(!c||!this._setupDone.read(a))return;const d=this._indicator.read(a);if(!(!d||!d.isVisible.read(a)))return c.inlineEdit.inlineCompletion.identity.id}),this._register(this._initializeDebugSetting()),this._disposables.value=this.setupNewUserExperience(),this._setupDone.set(!0,void 0)}setupNewUserExperience(){if(this.getNewUserType()===pa.Active)return;const e=new U;let t=!1,i=!1,n=0,o=0;return e.add(dye(this._activeCompletionId,async(r,a,c,d)=>{if(r===void 0)return;let l=this.getNewUserType();switch(l){case pa.FirstTime:{(n++>=5||t)&&(l=pa.SecondTime,this.setNewUserType(l));break}case pa.SecondTime:{o++>=3&&i&&(l=pa.Active,this.setNewUserType(l));break}}switch(l){case pa.FirstTime:{for(let u=0;u<3&&!d.isCancellationRequested;u++)await this._indicator.get()?.triggerAnimation(),await Da(500);break}case pa.SecondTime:{this._indicator.get()?.triggerAnimation();break}}})),e.add(fi(r=>{this._collapsedView.isVisible.read(r)&&this.getNewUserType()!==pa.Active&&this._collapsedView.triggerAnimation()})),e.add(ka((r,a)=>{const c=this._indicator.read(r);c&&a.add(_C(c.isHoveredOverIcon,async d=>{d&&(t=!0)}))})),e.add(ka((r,a)=>{const c=this._host.read(r);c&&a.add(c.onDidAccept(()=>{i=!0}))})),e}getNewUserType(){return this._storageService.get("inlineEditsGutterIndicatorUserKind",he.APPLICATION,pa.FirstTime)}setNewUserType(e){switch(e){case pa.FirstTime:throw new tn("UserKind should not be set to first time");case pa.SecondTime:break;case pa.Active:this._disposables.clear();break}this._storageService.store("inlineEditsGutterIndicatorUserKind",e,he.APPLICATION,gt.USER)}_initializeDebugSetting(){const e="editor.inlineSuggest.edits.resetNewUserExperience";return this._configurationService.getValue(e)&&this._storageService.remove("inlineEditsGutterIndicatorUserKind",he.APPLICATION),this._configurationService.onDidChangeConfiguration(i=>{i.affectsConfiguration(e)&&this._configurationService.getValue(e)&&(this._storageService.remove("inlineEditsGutterIndicatorUserKind",he.APPLICATION),this._disposables.value=this.setupNewUserExperience())})}};m3=f([p(4,it),p(5,ne)],m3);let v3=class extends F{constructor(e,t,i){super(),this._editor=e,this._edit=t,this._accessibilityService=i,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._iconRef=dt.ref(),this.isHovered=Li(!1),this._editorObs=Rs(this._editor);const o=this._edit.map(d=>d?.edit.edits[0]??null).map(d=>d?Su(d,this._editor.getModel()).range.getStartPosition():null),r=this._editorObs.observePosition(o,this._store),a=ve(d=>{const l=r.read(d);if(!l)return null;const u=this._editorObs.layoutInfoContentLeft.read(d),g=this._editorObs.scrollLeft.read(d);return new fu(u+l.x-g,l.y)}),c=dt.div({class:"inline-edits-collapsed-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:"block"}},[[this.getCollapsedIndicator(a)]]).keepUpdated(this._store).element;this._register(this._editorObs.createOverlayWidget({domNode:c,position:Li(null),allowEditorOverflow:!1,minContentWidthInPx:Li(0)})),this.isVisible=this._edit.map((d,l)=>!!d&&a.read(l)!==null)}triggerAnimation(){return this._accessibilityService.isMotionReduced()?new Animation(null,null).finished:this._iconRef.element.animate([{offset:0,transform:"translateY(-3px)"},{offset:.2,transform:"translateY(1px)"},{offset:.36,transform:"translateY(-1px)"},{offset:.52,transform:"translateY(1px)"},{offset:.68,transform:"translateY(-1px)"},{offset:.84,transform:"translateY(1px)"},{offset:1,transform:"translateY(0px)"}],{duration:2e3}).finished}getCollapsedIndicator(e){const t=this._editorObs.layoutInfoContentLeft,i=e.map((o,r)=>o?o.deltaX(-t.read(r)):null),n=this.createIconPath(i);return dt.svg({class:"collapsedView",ref:this._iconRef,style:{position:"absolute",top:0,left:t,width:this._editorObs.contentWidth,height:this._editorObs.editor.getContentHeight(),overflow:"hidden",pointerEvents:"none"}},[dt.svgElem("path",{class:"collapsedViewPath",d:n,fill:vt(wb)})])}createIconPath(e){return e.map(o=>{if(!o)return new g3().build();const r=o.deltaX(-6/2).deltaY(-1),a=r.deltaX(6),c=r.deltaY(1),d=a.deltaY(1),l=c.deltaX(6/2).deltaY(3);return new g3().moveTo(r).lineTo(a).lineTo(d).lineTo(l).lineTo(c).lineTo(r).build()})}};v3=f([p(2,Nr)],v3);let _3=class extends F{constructor(e,t,i,n,o){super(),this._editor=e,this._languageService=o,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._isHovered=si(this,!1),this.isHovered=this._isHovered,this._viewRef=dt.ref(),this._editorObs=Rs(this._editor);const r=i.map((l,u)=>{let g;switch(l){case Fs.Inactive:g=_ge;break;case Fs.Jump:g=mge;break;case Fs.Accept:g=yge;break}return{border:za(g,n).read(u).toString(),background:vt(ss)}}),c=t.map(l=>l?this.getState(l):void 0).map(l=>l?this.getRendering(l,r):void 0),d=dt.div({class:"inline-edits-custom-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:"block"}},[c]).keepUpdated(this._store);this._register(this._editorObs.createOverlayWidget({domNode:d.element,position:Li(null),allowEditorOverflow:!1,minContentWidthInPx:Li(0)})),this._register(fi(l=>{if(!c.read(l)){this._isHovered.set(!1,void 0);return}this._isHovered.set(d.isHovered.read(l),void 0)}))}getState(e){const t=ve(d=>{const l=e.range.startLineNumber,u=e.range.endLineNumber,g=e.range.startColumn,m=e.range.endColumn,v=this._editor.getModel()?.getLineCount()??0,_=Hm(this._editorObs,new xr(l,l+1),d),w=l+1<=v?Hm(this._editorObs,new xr(l+1,l+2),d):void 0,C=l-1>=1?Hm(this._editorObs,new xr(l-1,l),d):void 0,k=this._editor.getOffsetForColumn(l,g),D=this._editor.getOffsetForColumn(u,m);return{lineWidth:_,lineWidthBelow:w,lineWidthAbove:C,startContentLeftOffset:k,endContentLeftOffset:D}}),i=14,n=0,o=4,r=4,a=2;return{rect:ve(d=>{const l=this._editorObs.getOption(L.fontInfo).read(d).typicalHalfwidthCharacterWidth,u=e.range.startLineNumber,g=e.range.endLineNumber,{lineWidth:m,lineWidthBelow:v,lineWidthAbove:_,startContentLeftOffset:w,endContentLeftOffset:C}=t.read(d),k=this._editorObs.layoutInfoContentLeft.read(d),D=this._editorObs.getOption(L.lineHeight).read(d),A=this._editorObs.scrollTop.read(d),B=this._editorObs.scrollLeft.read(d);let q;u===g&&C+5*l>=m?q="end":v!==void 0&&v+i-r-o<w?q="below":_!==void 0&&_+i-r-o<w?q="above":q="end";let Q,ie,oe=0,be=0;switch(q){case"end":{Q=this._editorObs.editor.getTopForLineNumber(u),ie=m,oe=o+i;break}case"below":{Q=this._editorObs.editor.getTopForLineNumber(u+1),ie=w,oe=o+r,be=n+a;break}case"above":{Q=this._editorObs.editor.getTopForLineNumber(u-1),ie=w,oe=o+r,be=-0+a;break}}return ri.fromLeftTopWidthHeight(k+ie-B,Q-A,l*e.label.length,D).withMargin(n,o).translateX(oe).translateY(be)}),label:e.label}}getRendering(e,t){const i=document.createElement("div"),n=this._editor.getModel().tokenization.tokenizeLinesAt(1,[e.label])?.[0];let o;n?o=rN.fromLineTokens(n).toLineTokens(e.label,this._languageService.languageIdCodec):o=Cw.createEmpty(e.label,this._languageService.languageIdCodec);const r=uN(new pN([o]),gN.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],i,!0);i.style.width=`${r.minWidthInPx}px`;const a=e.rect.map(c=>c.withMargin(0,4));return dt.div({class:"collapsedView",ref:this._viewRef,style:{position:"absolute",...Ou(c=>a.read(c)),overflow:"hidden",boxSizing:"border-box",cursor:"pointer",border:t.map(c=>`1px solid ${c.border}`),borderRadius:"4px",backgroundColor:t.map(c=>c.background),display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap"},onclick:c=>{this._onDidClick.fire(new bs(Et(c),c))}},[i])}};_3=f([p(3,pt),p(4,vi)],_3);const rVe=0,aVe=0,iF=1,nF=1,sF=4;class cVe extends F{constructor(e,t,i,n){super(),this._editor=e,this._edit=t,this._uiState=i,this._tabAction=n,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._display=ve(this,a=>this._uiState.read(a)?"block":"none"),this._editorMaxContentWidthInRange=ve(this,a=>{const c=this._originalDisplayRange.read(a);return c?(this._editorObs.versionId.read(a),Nv(this,(d,l)=>{const u=Hm(this._editorObs,c,d);return Math.max(u,l??0)})):Li(0)}).map((a,c)=>a.read(c)),this._maxPrefixTrim=ve(a=>{const c=this._uiState.read(a);return c?b5(c.deletions,c.originalRange,[],this._editor):{prefixTrim:0,prefixLeftOffset:0}}),this._editorLayoutInfo=ve(this,a=>{const c=this._edit.read(a);if(!c||!this._uiState.read(a))return null;const l=this._editorObs.layoutInfo.read(a),u=this._editorObs.scrollLeft.read(a),g=this._editorObs.getOption(L.fontInfo).map(D=>D.typicalHalfwidthCharacterWidth).read(a),m=l.contentLeft+Math.max(this._editorMaxContentWidthInRange.read(a),g)-u,v=c.originalLineRange,_=this._originalVerticalStartPosition.read(a)??this._editor.getTopForLineNumber(v.startLineNumber)-this._editorObs.scrollTop.read(a),w=this._originalVerticalEndPosition.read(a)??this._editor.getTopForLineNumber(v.endLineNumberExclusive)-this._editorObs.scrollTop.read(a),C=l.contentLeft+this._maxPrefixTrim.read(a).prefixLeftOffset-u;return m<=C?null:{codeRect:ri.fromLeftTopRightBottom(C,_,m,w).withMargin(aVe,rVe),contentLeft:l.contentLeft}}).recomputeInitiallyAndOnChange(this._store),this._originalOverlay=dt.div({style:{pointerEvents:"none"}},ve(a=>{const c=Jp(this._editorLayoutInfo).read(a);if(!c)return;const d=c.map(g=>ri.fromLeftTopRightBottom(g.contentLeft-sF-iF,g.codeRect.top,g.contentLeft,g.codeRect.bottom)),l=ve(g=>{const m=c.read(g).codeRect,v=d.read(g);return m.intersectHorizontal(new Hi(v.left,Number.MAX_SAFE_INTEGER))}),u=l.map(g=>g.withMargin(nF,nF));return[dt.div({class:"originalSeparatorDeletion",style:{...u.read(a).toStyles(),borderRadius:`${sF}px`,border:`${iF+nF}px solid ${vt(ss)}`,boxSizing:"border-box"}}),dt.div({class:"originalOverlayDeletion",style:{...l.read(a).toStyles(),borderRadius:`${sF}px`,border:w0(this._tabAction).map(g=>`${iF}px solid ${vt(g)}`),boxSizing:"border-box",backgroundColor:vt(hE)}}),dt.div({class:"originalOverlayHiderDeletion",style:{...d.read(a).toStyles(),backgroundColor:vt(ss)}})]})).keepUpdated(this._store),this._nonOverflowView=dt.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[[this._originalOverlay]]).keepUpdated(this._store),this.isHovered=Li(!1),this._editorObs=Rs(this._editor);const o=ve(this,a=>{const c=this._edit.read(a);return c?new we(c.originalLineRange.startLineNumber,1):null}),r=ve(this,a=>{const c=this._edit.read(a);return c?new we(c.originalLineRange.endLineNumberExclusive,1):null});this._originalDisplayRange=this._uiState.map(a=>a?.originalRange),this._originalVerticalStartPosition=this._editorObs.observePosition(o,this._store).map(a=>a?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(r,this._store).map(a=>a?.y),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:Li(null),allowEditorOverflow:!1,minContentWidthInPx:ve(a=>{const c=this._editorLayoutInfo.read(a);return c===null?0:c.codeRect.width})}))}}const LS=1,oF=1,rF=4;let b3=class extends F{constructor(e,t,i,n,o){super(),this._editor=e,this._input=t,this._tabAction=i,this._languageService=o,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._state=ve(this,r=>{const a=this._input.read(r);if(!a)return;const c=this._editor.getModel(),d=c.getEOL();if(a.startColumn===1&&a.lineNumber>1&&c.getLineLength(a.lineNumber)!==0&&a.text.endsWith(d)&&!a.text.startsWith(d)){const l=c.getLineLength(a.lineNumber-1)+1;return{lineNumber:a.lineNumber-1,column:l,text:d+a.text.slice(0,-d.length)}}return{lineNumber:a.lineNumber,column:a.startColumn,text:a.text}}),this._trimVertically=ve(this,r=>{const a=this._state.read(r)?.text;if(!a||a.trim()==="")return{topOffset:0,bottomOffset:0,linesTop:0,linesBottom:0};const c=this._editor.getOption(L.lineHeight),d=this._editor.getModel().getEOL();let l=0,u=0,g=0;for(;g<a.length&&a.startsWith(d,g);g+=d.length)l+=1;for(let m=a.length;m>g&&a.endsWith(d,m);m-=d.length)u+=1;return{topOffset:l*c,bottomOffset:u*c,linesTop:l,linesBottom:u}}),this._maxPrefixTrim=ve(r=>{const a=this._state.read(r);if(!a)return{prefixLeftOffset:0,prefixTrim:0};const c=this._editor.getModel(),d=c.getEOL(),l=this._trimVertically.read(r),u=a.text.split(d),g=u.slice(l.linesTop,u.length-l.linesBottom);l.linesTop===0&&(g[0]=c.getLineContent(a.lineNumber)+g[0]);const m=new xr(a.lineNumber,a.lineNumber+(l.linesTop>0?0:1));return b5([],m,g,this._editor)}),this._ghostText=ve(r=>{const a=this._state.read(r),c=this._maxPrefixTrim.read(r);if(!a)return;const l=this._editor.getModel().getEOL(),g=a.text.split(l).map((m,v)=>new Nk(new P(v+1,v===0?1:c.prefixTrim+1,v+1,m.length+1),"modified-background",Nb.Regular));return new Ox(a.lineNumber,[new IL(a.column,a.text,!1,g)])}),this._display=ve(this,r=>this._state.read(r)?"block":"none"),this._editorMaxContentWidthInRange=ve(this,r=>{const a=this._state.read(r);if(!a)return 0;this._editorObs.versionId.read(r);const c=this._editor.getModel(),d=c.getEOL(),l=a.text.startsWith(d)?"":c.getValueInRange(new P(a.lineNumber,1,a.lineNumber,a.column)),u=c.getValueInRange(new P(a.lineNumber,a.column,a.lineNumber,c.getLineLength(a.lineNumber)+1)),m=(l+a.text+u).split(d),v=gN.fromEditor(this._editor).withSetWidth(!1).withScrollBeyondLastColumn(0),_=m.map(w=>{const C=c.tokenization.tokenizeLinesAt(a.lineNumber,[w])?.[0];let k;return C?k=rN.fromLineTokens(C).toLineTokens(w,this._languageService.languageIdCodec):k=Cw.createEmpty(w,this._languageService.languageIdCodec),uN(new pN([k]),v,[],j("div"),!0).minWidthInPx});return Math.max(..._)}),this.startLineOffset=this._trimVertically.map(r=>r.topOffset),this.originalLines=this._state.map(r=>r?new xr(r.lineNumber,Math.min(r.lineNumber+2,this._editor.getModel().getLineCount()+1)):void 0),this._overlayLayout=Mv(this,(r,a)=>{this._ghostText.read(r);const c=this._state.read(r);if(!c)return null;this._editorObs.observePosition(si(this,new we(c.lineNumber,c.column)),a).read(r);const d=this._editorObs.layoutInfo.read(r),l=this._editorObs.scrollLeft.read(r),u=this._editorObs.layoutInfoVerticalScrollbarWidth.read(r),g=d.contentLeft+this._editorMaxContentWidthInRange.read(r)-l,m=this._maxPrefixTrim.read(r).prefixLeftOffset??0,v=d.contentLeft+m-l;if(g<=v)return null;const{topOffset:_,bottomOffset:w}=this._trimVertically.read(r),C=this._editorObs.scrollTop.read(r),k=this._ghostTextView.height.read(r)-_-w,D=this._editor.getTopForLineNumber(c.lineNumber)-C+_,A=D+k,B=new ri(v,D,g,A);return{overlay:B,startsAtContentLeft:m===0,contentLeft:d.contentLeft,minContentWidthRequired:m+B.width+u}}).recomputeInitiallyAndOnChange(this._store),this._modifiedOverlay=dt.div({style:{pointerEvents:"none"}},ve(r=>{const a=Jp(this._overlayLayout).read(r);if(!a)return;const c=a.map(u=>ri.fromLeftTopRightBottom(u.contentLeft-rF-LS,u.overlay.top,u.contentLeft,u.overlay.bottom)).read(r),d=a.map(u=>u.overlay.withMargin(0,LS,0,u.startsAtContentLeft?0:LS).intersectHorizontal(new Hi(c.left,Number.MAX_SAFE_INTEGER))),l=d.map(u=>u.withMargin(oF,oF));return[dt.div({class:"originalUnderlayInsertion",style:{...l.read(r).toStyles(),borderRadius:rF,border:`${LS+oF}px solid ${vt(ss)}`,boxSizing:"border-box"}}),dt.div({class:"originalOverlayInsertion",style:{...d.read(r).toStyles(),borderRadius:rF,border:Vx(this._tabAction).map(u=>`${LS}px solid ${vt(u)}`),boxSizing:"border-box",backgroundColor:vt(fge)}}),dt.div({class:"originalOverlayHiderInsertion",style:{...c.toStyles(),backgroundColor:vt(ss)}})]})).keepUpdated(this._store),this._view=dt.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[[this._modifiedOverlay]]).keepUpdated(this._store),this._editorObs=Rs(this._editor),this._ghostTextView=this._register(n.createInstance(Bx,this._editor,{ghostText:this._ghostText,minReservedLineCount:Li(0),targetTextModel:this._editorObs.model.map(r=>r??void 0),warning:Li(void 0)},si(this,{syntaxHighlightingEnabled:!0,extraClasses:["inline-edit"]}),!0,!0)),this.isHovered=this._ghostTextView.isHovered,this._register(this._ghostTextView.onDidClick(r=>{this._onDidClick.fire(r)})),this._register(this._editorObs.createOverlayWidget({domNode:this._view.element,position:Li(null),allowEditorOverflow:!1,minContentWidthInPx:ve(r=>{const a=this._overlayLayout.read(r);return a===null?0:a.minContentWidthRequired})}))}};b3=f([p(3,Z),p(4,vi)],b3);let y3=class extends F{constructor(e,t,i,n,o){super(),this._editor=e,this._edit=t,this._tabAction=i,this._languageService=n,this._themeService=o,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._originalBubblesDecorationCollection=this._editor.editor.createDecorationsCollection(),this._originalBubblesDecorationOptions={description:"inlineCompletions-original-bubble",className:"inlineCompletions-original-bubble",stickiness:ki.NeverGrowsWhenTypingAtEdges},this._maxPrefixTrim=this._edit.map(r=>r?b5(r.replacements.flatMap(a=>[a.originalRange,a.modifiedRange]),r.originalRange,r.modifiedLines,this._editor.editor):void 0),this._modifiedLineElements=ve(r=>{const a=[];let c=0;const d=this._maxPrefixTrim.read(r),l=this._edit.read(r);if(!l||!d)return;const u=d.prefixTrim,g=tte(l.replacements.map(_=>_.modifiedRange)).map(_=>new P(_.startLineNumber,_.startColumn-u,_.endLineNumber,_.endColumn-u)),m=this._editor.model.get(),v=l.modifiedRange.startLineNumber;for(let _=0;_<l.modifiedRange.length;_++){const w=document.createElement("div"),C=v+_,k=l.modifiedLines[_].slice(u),D=m.tokenization.tokenizeLinesAt(C,[k])?.[0];let A;D?A=rN.fromLineTokens(D).toLineTokens(k,this._languageService.languageIdCodec):A=Cw.createEmpty(k,this._languageService.languageIdCodec);const B=[];for(const Q of g.filter(ie=>ie.startLineNumber===C)){const ie=Math.min(Q.endColumn,k.length+1);B.push(new Nk(new P(1,Q.startColumn,1,ie),"inlineCompletions-modified-bubble",Nb.Regular)),B.push(new Nk(new P(1,Q.startColumn,1,Q.startColumn+1),"start",Nb.Regular)),B.push(new Nk(new P(1,ie-1,1,ie),"end",Nb.Regular))}const q=uN(new pN([A]),gN.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),B,w,!0);this._editor.getOption(L.fontInfo).read(r),c=Math.max(c,q.minWidthInPx),a.push(w)}return{lines:a,requiredWidth:c}}),this._layout=ve(this,r=>{const a=this._modifiedLineElements.read(r),c=this._maxPrefixTrim.read(r),d=this._edit.read(r);if(!a||!c||!d)return;const{prefixLeftOffset:l}=c,{requiredWidth:u}=a,g=this._editor.getOption(L.lineHeight).read(r),m=this._editor.layoutInfoContentLeft.read(r),v=this._editor.layoutInfoVerticalScrollbarWidth.read(r),_=this._editor.scrollLeft.read(r),w=this._editor.scrollTop.read(r),C=m-_,k=this._editor.editor.getModel(),D=d.originalRange.mapToLineArray(Qt=>this._editor.editor.getOffsetForColumn(Qt,k.getLineMaxColumn(Qt))-l),A=Math.max(...D,u),B=d.originalRange.startLineNumber,q=d.originalRange.endLineNumberExclusive-1,Q=this._editor.editor.getTopForLineNumber(B)-w,ie=this._editor.editor.getBottomForLineNumber(q)-w,oe=ri.fromLeftTopWidthHeight(C+l,Q,A,ie-Q),be=ri.fromLeftTopWidthHeight(oe.left,oe.bottom,oe.width,d.modifiedRange.length*g),me=ri.hull([oe,be]),zt=me.intersectVertical(new Hi(oe.bottom,Number.MAX_SAFE_INTEGER)),ft=new ri(zt.left,zt.top,zt.right,zt.bottom);return{originalLinesOverlay:oe,modifiedLinesOverlay:be,background:me,lowerBackground:zt,lowerText:ft,minContentWidthRequired:l+A+v}}),this._viewZoneInfo=ve(r=>{if(!this._editor.getOption(L.inlineSuggest).map(g=>g.edits.allowCodeShifting==="always").read(r))return;const c=this._layout.read(r),d=this._edit.read(r);if(!c||!d)return;const l=c.lowerBackground.height,u=d.originalRange.endLineNumberExclusive;return{height:l,lineNumber:u}}),this._div=dt.div({class:"line-replacement"},[ve(r=>{const a=Jp(this._layout).read(r),c=this._modifiedLineElements.read(r);if(!a||!c)return[];const d=a.read(r),l=this._editor.layoutInfoContentLeft.read(r),u=this._editor.contentWidth.read(r),g=this._editor.editor.getContentHeight(),m=this._editor.getOption(L.lineHeight).read(r);c.lines.forEach(w=>{w.style.width=`${d.lowerText.width}px`,w.style.height=`${m}px`,w.style.position="relative"});const v=Vx(this._tabAction).read(r),_=w0(this._tabAction).read(r);return[dt.div({style:{position:"absolute",top:0,left:l,width:u,height:g,overflow:"hidden",pointerEvents:"none"}},[dt.div({class:"originalOverlayLineReplacement",style:{position:"absolute",...Ou(w=>a.read(w).background.translateX(-l)),borderRadius:"4px",border:za(_,this._themeService).map(w=>`1px solid ${w.toString()}`),pointerEvents:"none",boxSizing:"border-box",background:vt(hE)}}),dt.div({class:"modifiedOverlayLineReplacement",style:{position:"absolute",...Ou(w=>a.read(w).lowerBackground.translateX(-l)),borderRadius:"0 0 4px 4px",background:vt(ss),boxShadow:`${vt(_z)} 0 6px 6px -6px`,border:`1px solid ${vt(v)}`,boxSizing:"border-box",overflow:"hidden",cursor:"pointer",pointerEvents:"auto"},onmousedown:w=>{w.preventDefault()},onclick:w=>this._onDidClick.fire(new bs(Et(w),w))},[dt.div({style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:vt(GBe)}})]),dt.div({class:"modifiedLinesLineReplacement",style:{position:"absolute",boxSizing:"border-box",...Ou(w=>a.read(w).lowerText.translateX(-l)),fontFamily:this._editor.getOption(L.fontFamily),fontSize:this._editor.getOption(L.fontSize),fontWeight:this._editor.getOption(L.fontWeight),pointerEvents:"none",whiteSpace:"nowrap",borderRadius:"0 0 4px 4px",overflow:"hidden"}},[...c.lines])])]})]).keepUpdated(this._store),this.isHovered=this._editor.isTargetHovered(r=>this._isMouseOverWidget(r),this._store),this._previousViewZoneInfo=void 0,this._register(Ie(()=>this._originalBubblesDecorationCollection.clear())),this._register(Ie(()=>this._editor.editor.changeViewZones(r=>this.removePreviousViewZone(r)))),this._register(lye(this._viewZoneInfo,({lastValue:r,newValue:a})=>{r===a||r?.height===a?.height&&r?.lineNumber===a?.lineNumber||this._editor.editor.changeViewZones(c=>{this.removePreviousViewZone(c),a&&this.addViewZone(a,c)})})),this._register(fi(r=>{const a=this._edit.read(r),c=[];a&&c.push(...tte(a.replacements.map(d=>d.originalRange))),this._originalBubblesDecorationCollection.set(c.map(d=>({range:d,options:this._originalBubblesDecorationOptions})))})),this._register(this._editor.createOverlayWidget({domNode:this._div.element,minContentWidthInPx:ve(r=>this._layout.read(r)?.minContentWidthRequired??0),position:Li({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}_isMouseOverWidget(e){const t=this._layout.get();return!t||!(e.event instanceof ESe)?!1:t.lowerBackground.containsPoint(new fu(e.event.relativePos.x,e.event.relativePos.y))}removePreviousViewZone(e){if(!this._previousViewZoneInfo)return;e.removeZone(this._previousViewZoneInfo.id);const t=this._editor.cursorLineNumber.get();t!==null&&t>=this._previousViewZoneInfo.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()-this._previousViewZoneInfo.height),this._previousViewZoneInfo=void 0}addViewZone(e,t){const i=t.addZone({afterLineNumber:e.lineNumber-1,heightInPx:e.height,domNode:j("div")});this._previousViewZoneInfo={height:e.height,lineNumber:e.lineNumber,id:i};const n=this._editor.cursorLineNumber.get();n!==null&&n>=e.lineNumber&&this._editor.editor.setScrollTop(this._editor.scrollTop.get()+e.height)}};y3=f([p(3,vi),p(4,pt)],y3);function tte(s){const e=[];for(;s.length;){let t=s.shift();t.startLineNumber!==t.endLineNumber&&(s.push(new P(t.startLineNumber+1,1,t.endLineNumber,t.endColumn)),t=new P(t.startLineNumber,t.startColumn,t.startLineNumber,Number.MAX_SAFE_INTEGER)),e.push(t)}return e}const MS=0,ak=0,Ad=1,Lg=1,Zh=4,aF=20,ite=12;let TL=class extends F{static fitsInsideViewport(e,t,i,n){const o=Rs(e),r=o.layoutInfoWidth.read(n),a=o.layoutInfoContentLeft.read(n),c=e.getLayoutInfo().verticalScrollbarWidth,d=o.layoutInfoMinimap.read(n).minimapLeft!==0?o.layoutInfoMinimap.read(n).minimapWidth:0,l=Hm(o,i.displayRange,void 0),u=i.lineEdit.newLines.reduce((v,_)=>Math.max(v,wge(_,e,t)),0),g=aF,m=ite+2*Ad;return l+u+g+m<r-a-c-d}constructor(e,t,i,n,o,r,a){super(),this._editor=e,this._edit=t,this._previewTextModel=i,this._uiState=n,this._tabAction=o,this._instantiationService=r,this._themeService=a,this._editorObs=Rs(this._editor),this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._display=ve(this,c=>this._uiState.read(c)?"block":"none"),this.previewRef=dt.ref(),this._editorContainer=dt.div({class:["editorContainer"],style:{position:"absolute",overflow:"hidden",cursor:"pointer"},onmousedown:c=>{c.preventDefault()},onclick:c=>{this._onDidClick.fire(new bs(Et(c),c))}},[dt.div({class:"preview",style:{pointerEvents:"none"},ref:this.previewRef})]).keepUpdated(this._store),this.isHovered=this._editorContainer.didMouseMoveDuringHover,this.previewEditor=this._register(this._instantiationService.createInstance(pd,this.previewRef.element,{glyphMargin:!1,lineNumbers:"off",minimap:{enabled:!1},guides:{indentation:!1,bracketPairs:!1,bracketPairsHorizontal:!1,highlightActiveIndentation:!1},rulers:[],padding:{top:0,bottom:0},folding:!1,selectOnLineNumbers:!1,selectionHighlight:!1,columnSelection:!1,overviewRulerBorder:!1,overviewRulerLanes:0,lineDecorationsWidth:0,lineNumbersMinChars:0,revealHorizontalRightPadding:0,bracketPairColorization:{enabled:!0,independentColorPoolPerBracketType:!1},scrollBeyondLastLine:!1,scrollbar:{vertical:"hidden",horizontal:"hidden",handleMouseWheel:!1},readOnly:!0,wordWrap:"off",wordWrapOverride1:"off",wordWrapOverride2:"off"},{contextKeyValues:{[Ai.inInlineEditsPreviewEditor.key]:!0},contributions:[]},this._editor)),this._previewEditorObs=Rs(this.previewEditor),this._activeViewZones=[],this._updatePreviewEditor=ve(c=>{this._editorContainer.readEffect(c),this._previewEditorObs.model.read(c),this._display.read(c),this._nonOverflowView&&(this._nonOverflowView.element.style.display=this._display.read(c));const d=this._uiState.read(c),l=this._edit.read(c);if(!d||!l)return;const u=l.originalLineRange,g=[];u.startLineNumber>1&&g.push(new P(1,1,u.startLineNumber-1,1)),u.startLineNumber+d.newTextLineCount<this._previewTextModel.getLineCount()+1&&g.push(new P(u.startLineNumber+d.newTextLineCount,1,this._previewTextModel.getLineCount()+1,1)),this.previewEditor.setHiddenAreas(g,void 0,!0);const m=[...this._activeViewZones];this._activeViewZones=[];const v=u.endLineNumberExclusive-u.startLineNumber-d.newTextLineCount;this.previewEditor.changeViewZones(_=>{m.forEach(w=>_.removeZone(w)),v>0&&this._activeViewZones.push(_.addZone({afterLineNumber:u.startLineNumber+d.newTextLineCount-1,heightInLines:v,showInHiddenAreas:!0,domNode:j("div.diagonal-fill.inline-edits-view-zone")}))})}),this._previewEditorWidth=ve(this,c=>{const d=this._edit.read(c);return d?(this._updatePreviewEditor.read(c),Hm(this._previewEditorObs,d.modifiedLineRange,c)):0}),this._cursorPosIfTouchesEdit=ve(this,c=>{const d=this._editorObs.cursorPosition.read(c),l=this._edit.read(c);if(!(!l||!d))return l.modifiedLineRange.contains(d.lineNumber)?d:void 0}),this._originalStartPosition=ve(this,c=>{const d=this._edit.read(c);return d?new we(d.originalLineRange.startLineNumber,1):null}),this._originalEndPosition=ve(this,c=>{const d=this._edit.read(c);return d?new we(d.originalLineRange.endLineNumberExclusive,1):null}),this._originalVerticalStartPosition=this._editorObs.observePosition(this._originalStartPosition,this._store).map(c=>c?.y),this._originalVerticalEndPosition=this._editorObs.observePosition(this._originalEndPosition,this._store).map(c=>c?.y),this._originalDisplayRange=this._edit.map(c=>c?.displayRange),this._editorMaxContentWidthInRange=ve(this,c=>{const d=this._originalDisplayRange.read(c);return d?(this._editorObs.versionId.read(c),Nv(this,(l,u)=>{const g=Hm(this._editorObs,d,l);return Math.max(g,u??0)})):Li(0)}).map((c,d)=>c.read(d)),this._previewEditorLayoutInfo=ve(this,c=>{const d=this._edit.read(c);if(!d||!this._uiState.read(c))return null;const u=d.originalLineRange,g=this._editorObs.scrollLeft.read(c),m=this._editorMaxContentWidthInRange.read(c),v=this._editorObs.layoutInfo.read(c),_=this._previewEditorWidth.read(c),w=v.contentWidth-v.verticalScrollbarWidth,C=this._editor.getContainerDomNode().getBoundingClientRect(),k=v.contentLeft+v.contentWidth+C.left,D=Et(this._editor.getContainerDomNode()).innerWidth-k,A=Et(this._editor.getContainerDomNode()).innerWidth-C.right,B=Math.min(v.contentWidth*.3,_,100),q=0,Q=q+D,ie=this._cursorPosIfTouchesEdit.read(c),oe=Math.max(w+g-q-Math.max(0,B-Q),Math.min(ie?ZBe(this._editorObs,ie,c)+50:0,w+g)),be=Math.min(m+aF,oe),me=m+aF+_+70,zt=oe-be;let ft,Qt;be>g?(ft=0,Qt=v.contentLeft+be-g):(ft=g-be,Qt=v.contentLeft);const Ae=this._originalVerticalStartPosition.read(c)??this._editor.getTopForLineNumber(u.startLineNumber)-this._editorObs.scrollTop.read(c),di=this._originalVerticalEndPosition.read(c)??this._editor.getBottomForLineNumber(u.endLineNumberExclusive-1)-this._editorObs.scrollTop.read(c),jn=v.contentLeft-g;let _i=ri.fromLeftTopRightBottom(jn,Ae,Qt,di);const vn=_i.height===0;vn||(_i=_i.withMargin(ak,MS));const Cs=this._editor.getOption(L.lineHeight)*d.modifiedLineRange.length,on=di-Ae,Ks=Math.max(on,Cs),Tg=zt===0,Mf=0,Nf=Math.min(_+ite,A+v.width-v.contentLeft-Mf);let Yh=ri.fromLeftTopWidthHeight(_i.right+Mf,Ae,Nf,Ks);return vn?Yh=Yh.withMargin(ak,MS).translateY(ak):Yh=Yh.withMargin(ak,MS).translateX(MS+Ad),{codeRect:_i,editRect:Yh,codeScrollLeft:g,contentLeft:v.contentLeft,isInsertion:vn,maxContentWidth:me,shouldShowShadow:Tg,desiredPreviewEditorScrollLeft:ft,previewEditorWidth:Nf}}),this._stickyScrollController=bd.get(this._editorObs.editor),this._stickyScrollHeight=this._stickyScrollController?kn(this._stickyScrollController.onDidChangeStickyScrollHeight,()=>this._stickyScrollController.stickyScrollWidgetHeight):Li(0),this._shouldOverflow=ve(c=>!1),this._originalBackgroundColor=kn(this,this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme().getColor(hE)??ye.transparent),this._backgroundSvg=dt.svg({transform:"translate(-0.5 -0.5)",style:{overflow:"visible",pointerEvents:"none",position:"absolute"}},[dt.svgElem("path",{class:"rightOfModifiedBackgroundCoverUp",d:ve(c=>{const d=this._previewEditorLayoutInfo.read(c);if(!(!d||this._originalBackgroundColor.read(c).isTransparent()))return new g3().moveTo(d.codeRect.getRightTop()).lineTo(d.codeRect.getRightTop().deltaX(1e3)).lineTo(d.codeRect.getRightBottom().deltaX(1e3)).lineTo(d.codeRect.getRightBottom()).build()}),style:{fill:KF(ss,"transparent")}})]).keepUpdated(this._store),this._originalOverlay=dt.div({style:{pointerEvents:"none",display:this._previewEditorLayoutInfo.map(c=>c?.isInsertion?"none":"block")}},ve(c=>{const d=Jp(this._previewEditorLayoutInfo).read(c);if(!d)return;const l=w0(this._tabAction).map(A=>`${Ad}px solid ${vt(A)}`),u=`${Ad+Lg}px solid ${vt(ss)}`,g=d.read(c).codeScrollLeft!==0,m=d.map(A=>A.codeRect.bottom<A.editRect.bottom),v=Zh*2+Ad*2,_=d.map(A=>ri.fromLeftTopRightBottom(A.contentLeft-Zh-Ad,A.codeRect.top,A.contentLeft,A.codeRect.bottom+v)).read(c),w=new Hi(_.left,Number.MAX_SAFE_INTEGER),C=d.map(A=>A.codeRect.intersectHorizontal(w)),k=C.map(A=>A.withMargin(Lg,0,Lg,Lg).intersectHorizontal(w)),D=C.map(A=>ri.fromLeftTopWidthHeight(A.right-v+Ad,A.bottom-Ad,v,v).intersectHorizontal(w));return[dt.div({class:"originalSeparatorSideBySide",style:{...k.read(c).toStyles(),boxSizing:"border-box",borderRadius:`${Zh}px 0 0 ${Zh}px`,borderTop:u,borderBottom:u,borderLeft:g?"none":u}}),dt.div({class:"originalOverlaySideBySide",style:{...C.read(c).toStyles(),boxSizing:"border-box",borderRadius:`${Zh}px 0 0 ${Zh}px`,borderTop:l,borderBottom:l,borderLeft:g?"none":l,backgroundColor:vt(hE)}}),dt.div({class:"originalCornerCutoutSideBySide",style:{pointerEvents:"none",display:m.map(A=>A?"block":"none"),...D.read(c).toStyles()}},[dt.div({class:"originalCornerCutoutBackground",style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",backgroundColor:za(hE,this._themeService).map(A=>A.toString())}}),dt.div({class:"originalCornerCutoutBorder",style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",boxSizing:"border-box",borderTop:l,borderRight:l,borderRadius:"0 100% 0 0",backgroundColor:vt(ss)}})]),dt.div({class:"originalOverlaySideBySideHider",style:{..._.toStyles(),backgroundColor:vt(ss)}})]})).keepUpdated(this._store),this._modifiedOverlay=dt.div({style:{pointerEvents:"none"}},ve(c=>{const d=Jp(this._previewEditorLayoutInfo).read(c);if(!d)return;const u=d.map(C=>C.codeRect.bottom<C.editRect.bottom).map(C=>`0 ${Zh}px ${Zh}px ${C?Zh:0}px`),g=za(Vx(this._tabAction),this._themeService).map(C=>`1px solid ${C.toString()}`),m=`${Ad+Lg}px solid ${vt(ss)}`,v=d.map(C=>C.editRect.withMargin(0,Ad)),_=v.map(C=>C.withMargin(Lg,Lg,Lg,0)),w=ve(C=>{const k=v.read(C),D=d.read(C);return!D.isInsertion||D.contentLeft>=k.left?ri.fromLeftTopWidthHeight(k.left,k.top,0,0):new ri(D.contentLeft,k.top,k.left,k.top+Ad*2)});return[dt.div({class:"modifiedInsertionSideBySide",style:{...w.read(c).toStyles(),backgroundColor:Vx(this._tabAction).map(C=>vt(C))}}),dt.div({class:"modifiedSeparatorSideBySide",style:{..._.read(c).toStyles(),borderRadius:u,borderTop:m,borderBottom:m,borderRight:m,boxSizing:"border-box"}}),dt.div({class:"modifiedOverlaySideBySide",style:{...v.read(c).toStyles(),borderRadius:u,border:g,boxSizing:"border-box",backgroundColor:vt(fge)}})]})).keepUpdated(this._store),this._nonOverflowView=dt.div({class:"inline-edits-view",style:{position:"absolute",overflow:"visible",top:"0px",left:"0px",display:this._display}},[this._backgroundSvg,ve(this,c=>this._shouldOverflow.read(c)?[]:[this._editorContainer,this._originalOverlay,this._modifiedOverlay])]).keepUpdated(this._store),this._register(this._editorObs.createOverlayWidget({domNode:this._nonOverflowView.element,position:Li(null),allowEditorOverflow:!1,minContentWidthInPx:ve(c=>{const d=this._previewEditorLayoutInfo.read(c)?.maxContentWidth;return d===void 0?0:d})})),this.previewEditor.setModel(this._previewTextModel),this._register(fi(c=>{const d=this._previewEditorLayoutInfo.read(c);if(!d)return;const l=d.editRect.withMargin(-0,-0);this.previewEditor.layout({height:l.height,width:d.previewEditorWidth+15}),this._editorContainer.element.style.top=`${l.top}px`,this._editorContainer.element.style.left=`${l.left}px`,this._editorContainer.element.style.width=`${d.previewEditorWidth+MS}px`})),this._register(fi(c=>{const d=this._previewEditorLayoutInfo.read(c);d&&this._previewEditorObs.editor.setScrollLeft(d.desiredPreviewEditorScrollLeft)})),this._updatePreviewEditor.recomputeInitiallyAndOnChange(this._store)}};TL=f([p(5,Z),p(6,pt)],TL);let Sb=class extends F{static{this.MAX_LENGTH=100}constructor(e,t,i,n){super(),this._editor=e,this._edit=t,this._tabAction=i,this._languageService=n,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this._start=this._editor.observePosition(Li(this._edit.range.getStartPosition()),this._store),this._end=this._editor.observePosition(Li(this._edit.range.getEndPosition()),this._store),this._line=document.createElement("div"),this._hoverableElement=si(this,null),this.isHovered=this._hoverableElement.map((o,r)=>o?.didMouseMoveDuringHover.read(r)??!1),this._renderTextEffect=ve(o=>{const r=this._editor.model.get(),a=r.getLineContent(this._edit.range.startLineNumber),c=Sa.replace(new Hi(this._edit.range.startColumn-1,this._edit.range.endColumn-1),this._edit.text),d=c.apply(a),l=r.tokenization.tokenizeLinesAt(this._edit.range.startLineNumber,[d])?.[0];let u;l?u=rN.fromLineTokens(l).slice(c.getRangeAfterApply()).toLineTokens(this._edit.text,this._languageService.languageIdCodec):u=Cw.createEmpty(this._edit.text,this._languageService.languageIdCodec);const g=uN(new pN([u]),gN.fromEditor(this._editor.editor).withSetWidth(!1).withScrollBeyondLastColumn(0),[],this._line,!0);this._line.style.width=`${g.minWidthInPx}px`}),this._layout=ve(this,o=>{this._renderTextEffect.read(o);const r=this._start.read(o),a=this._end.read(o);if(!r||!a||r.x>a.x||r.y>a.y)return;const c=this._editor.getOption(L.lineHeight).read(o),d=this._editor.scrollLeft.read(o),l=this._editor.getOption(L.fontInfo).read(o).typicalHalfwidthCharacterWidth,u=3*l,g=4,m=new fu(u,g),v=ri.fromPoints(r,a).withHeight(c).translateX(-d),_=ri.fromPointSize(v.getLeftBottom().add(m),new fu(this._edit.text.length*l,v.height)),w=_.withLeft(v.left);return{originalLine:v,modifiedLine:_,lowerBackground:w,lineHeight:c}}),this._root=dt.div({class:"word-replacement"},[ve(o=>{const r=Jp(this._layout).read(o);if(!r)return[];const a=this._editor.layoutInfoContentLeft.read(o),c=1,d=w0(this._tabAction).map(u=>vt(u)).read(o),l=Vx(this._tabAction).map(u=>vt(u)).read(o);return[dt.div({style:{position:"absolute",top:0,left:a,width:this._editor.contentWidth,height:this._editor.editor.getContentHeight(),overflow:"hidden",pointerEvents:"none"}},[dt.div({style:{position:"absolute",...Ou(u=>r.read(u).lowerBackground.withMargin(c,2*c,c,0)),background:vt(ss),cursor:"pointer",pointerEvents:"auto"},onmousedown:u=>{u.preventDefault()},onmouseup:u=>this._onDidClick.fire(new bs(Et(u),u)),obsRef:u=>{this._hoverableElement.set(u,void 0)}}),dt.div({style:{position:"absolute",...Ou(u=>r.read(u).modifiedLine.withMargin(1,2)),fontFamily:this._editor.getOption(L.fontFamily),fontSize:this._editor.getOption(L.fontSize),fontWeight:this._editor.getOption(L.fontWeight),pointerEvents:"none",boxSizing:"border-box",borderRadius:"4px",border:`${c}px solid ${l}`,background:vt(zBe),display:"flex",justifyContent:"center",alignItems:"center",outline:`2px solid ${vt(ss)}`}},[this._line]),dt.div({style:{position:"absolute",...Ou(u=>r.read(u).originalLine.withMargin(1)),boxSizing:"border-box",borderRadius:"4px",border:`${c}px solid ${d}`,background:vt($Be),pointerEvents:"none"}},[]),dt.svg({width:11,height:14,viewBox:"0 0 11 14",fill:"none",style:{position:"absolute",left:r.map(u=>u.modifiedLine.left-16),top:r.map(u=>u.modifiedLine.top+Math.round((u.lineHeight-14-5)/2))}},[dt.svgElem("path",{d:"M1 0C1 2.98966 1 5.92087 1 8.49952C1 9.60409 1.89543 10.5 3 10.5H10.5",stroke:vt(l8)}),dt.svgElem("path",{d:"M6 7.5L9.99999 10.49998L6 13.5",stroke:vt(l8)})])])]})]).keepUpdated(this._store),this._register(this._editor.createOverlayWidget({domNode:this._root.element,minContentWidthInPx:Li(0),position:Li({preference:{top:0,left:0}}),allowEditorOverflow:!1}))}};Sb=f([p(3,vi)],Sb);class dVe extends F{static supportsInlineDiffRendering(e){return nte(e)}constructor(e,t,i){super(),this._originalEditor=e,this._state=t,this._modifiedTextModel=i,this._onDidClick=this._register(new M),this.onDidClick=this._onDidClick.event,this.isHovered=Rs(this._originalEditor).isTargetHovered(o=>o.target.type===xi.CONTENT_TEXT&&o.target.detail.injectedText?.options.attachedData instanceof cF&&o.target.detail.injectedText.options.attachedData.owner===this,this._store),this._tokenizationFinished=hVe(this._modifiedTextModel),this._decorations=ve(this,o=>{const r=this._state.read(o);if(!r)return;const a=r.modifiedText,c=r.mode==="insertionInline",d=r.diff.length===1&&r.diff[0].innerChanges?.length===1,l=!0,u=[],g=[],m=Zt.register({className:"inlineCompletions-line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),v=Zt.register({className:"inlineCompletions-line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),_=Zt.register({className:"inlineCompletions-char-delete",description:"char-delete",isWholeLine:!1}),w=Zt.register({className:"inlineCompletions-char-insert",description:"char-insert",isWholeLine:!0}),C=Zt.register({className:"inlineCompletions-char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),k=Zt.register({className:"inlineCompletions-char-insert diff-range-empty",description:"char-insert diff-range-empty"});for(const D of r.diff)if(r.mode!=="sideBySide"&&r.mode!=="deletion"&&r.mode!=="insertionInline"&&(D.original.isEmpty||u.push({range:D.original.toInclusiveRange(),options:v}),D.modified.isEmpty||g.push({range:D.modified.toInclusiveRange(),options:m})),D.modified.isEmpty||D.original.isEmpty)D.original.isEmpty||u.push({range:D.original.toInclusiveRange(),options:_}),D.modified.isEmpty||g.push({range:D.modified.toInclusiveRange(),options:w});else{const B=c&&nte(D);for(const q of D.innerChanges||[]){if(D.original.contains(q.originalRange.startLineNumber)){const Q=this._originalEditor.getModel()?.getValueInRange(q.originalRange,uy.LF);u.push({range:q.originalRange,options:{description:"char-delete",shouldFillLineOnLineBreak:!1,className:tF("inlineCompletions-char-delete",q.originalRange.isSingleLine()&&r.mode==="insertionInline"&&"single-line-inline",q.originalRange.isEmpty()&&"empty",(q.originalRange.isEmpty()&&d||r.mode==="deletion"&&Q===`
`)&&l&&!B&&"diff-range-empty"),inlineClassName:B?tF("strike-through","inlineCompletions"):null,zIndex:1}})}if(D.modified.contains(q.modifiedRange.startLineNumber)&&g.push({range:q.modifiedRange,options:q.modifiedRange.isEmpty()&&l&&!B&&d?k:C}),B){const Q=a.getValueOfRange(q.modifiedRange),ie=Q.length>3?[{text:Q.slice(0,1),extraClasses:["start"],offsetRange:new Hi(q.modifiedRange.startColumn-1,q.modifiedRange.startColumn)},{text:Q.slice(1,-1),extraClasses:[],offsetRange:new Hi(q.modifiedRange.startColumn,q.modifiedRange.endColumn-2)},{text:Q.slice(-1),extraClasses:["end"],offsetRange:new Hi(q.modifiedRange.endColumn-2,q.modifiedRange.endColumn-1)}]:[{text:Q,extraClasses:["start","end"],offsetRange:new Hi(q.modifiedRange.startColumn-1,q.modifiedRange.endColumn)}];this._tokenizationFinished.read(o);const oe=this._modifiedTextModel.tokenization.getLineTokens(q.modifiedRange.startLineNumber);for(const{text:be,extraClasses:me,offsetRange:zt}of ie)u.push({range:P.fromPositions(q.originalRange.getEndPosition()),options:{description:"inserted-text",before:{tokens:oe.getTokensInRange(zt),content:be,inlineClassName:tF("inlineCompletions-char-insert",q.modifiedRange.isSingleLine()&&r.mode==="insertionInline"&&"single-line-inline",...me),cursorStops:Qf.None,attachedData:new cF(this)},zIndex:2,showIfCollapsed:!0}})}}}return{originalDecorations:u,modifiedDecorations:g}}),this._register(Rs(this._originalEditor).setDecorations(this._decorations.map(o=>o?.originalDecorations??[])));const n=this._state.map(o=>o?.modifiedCodeEditor);this._register(ka((o,r)=>{const a=n.read(o);a&&r.add(Rs(a).setDecorations(this._decorations.map(c=>c?.modifiedDecorations??[])))})),this._register(this._originalEditor.onMouseUp(o=>{if(o.target.type!==xi.CONTENT_TEXT)return;const r=o.target.detail.injectedText?.options.attachedData;r instanceof cF&&r.owner===this&&this._onDidClick.fire(o.event)}))}}class cF{constructor(e){this.owner=e}}function nte(s){return s.innerChanges?s.innerChanges.every(e=>D8(e.modifiedRange)&&D8(e.originalRange)):!1}let lVe=0;function hVe(s){return kn(s.onDidChangeTokens,()=>lVe++)}const uVe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(uVe);let w3=class extends F{constructor(e,t,i,n,o,r){super(),this._editor=e,this._host=t,this._model=i,this._ghostTextIndicator=n,this._focusIsInMenu=o,this._instantiationService=r,this._editorObs=Rs(this._editor),this._tabAction=ve(a=>this._model.read(a)?.tabAction.read(a)??Fs.Inactive),this._constructorDone=si(this,!1),this._uiState=ve(this,a=>{const c=this._model.read(a);if(!c||!this._constructorDone.read(a))return;c.handleInlineEditShown();const d=c.inlineEdit;let l=yz.fromEdit(d.edit),u=d.edit.apply(d.originalText),g=h8(l,d.originalText,new K_(u)),m=this.determineRenderState(c,a,g,new K_(u));if(!m){c.abort(`unable to determine view: tried to render ${this._previousView?.view}`);return}if(m.kind==="sideBySide"){const _=tVe(u,d.modifiedLineRange);u=_.applyToString(u),l=JBe(l,_),g=h8(l,d.originalText,new K_(u))}return this._previewTextModel.setLanguage(this._editor.getModel().getLanguageId()),this._previewTextModel.getValue()!==u&&this._previewTextModel.setValue(u),c.showCollapsed.read(a)&&!this._indicator.read(a)?.isHoverVisible.read(a)&&(m={kind:"collapsed"}),{state:m,diff:g,edit:d,newText:u,newTextLineCount:d.modifiedLineRange.length}}),this._previewTextModel=this._register(this._instantiationService.createInstance(ry,"",this._editor.getModel().getLanguageId(),{...ry.DEFAULT_CREATION_OPTIONS,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}},null)),this._indicatorCyclicDependencyCircuitBreaker=si(this,!1),this._indicator=Mv(this,(a,c)=>{if(!this._indicatorCyclicDependencyCircuitBreaker.read(a))return;const d=Yl({owner:this,equalsFn:cse(dse())},u=>{const g=this._ghostTextIndicator.read(u);if(g)return g.lineRange;const m=this._uiState.read(u);if(m){if(m.state?.kind==="custom"){const v=m.state.displayLocation?.range;if(!v)throw new tn("custom view should have a range");return new xr(v.startLineNumber,v.endLineNumber)}return m.state?.kind==="insertionMultiLine"?this._insertion.originalLines.read(u):m.edit.displayRange}}),l=ve(this,u=>{const g=this._model.read(u);if(g)return g;const m=this._ghostTextIndicator.read(u);return m?m.model:g});return c.add(this._instantiationService.createInstance(f3,this._editorObs,d,this._gutterIndicatorOffset,l,this._inlineEditsIsHovered,this._focusIsInMenu))}),this._inlineEditsIsHovered=ve(this,a=>this._sideBySide.isHovered.read(a)||this._wordReplacementViews.read(a).some(c=>c.isHovered.read(a))||this._deletion.isHovered.read(a)||this._inlineDiffView.isHovered.read(a)||this._lineReplacementView.isHovered.read(a)||this._insertion.isHovered.read(a)||this._customView.isHovered.read(a)),this._gutterIndicatorOffset=ve(this,a=>this._uiState.read(a)?.state?.kind==="insertionMultiLine"?this._insertion.startLineOffset.read(a):0),this._sideBySide=this._register(this._instantiationService.createInstance(TL,this._editor,this._model.map(a=>a?.inlineEdit),this._previewTextModel,this._uiState.map(a=>a&&a.state?.kind==="sideBySide"?{newTextLineCount:a.newTextLineCount}:void 0),this._tabAction)),this._deletion=this._register(this._instantiationService.createInstance(cVe,this._editor,this._model.map(a=>a?.inlineEdit),this._uiState.map(a=>a&&a.state?.kind==="deletion"?{originalRange:a.state.originalRange,deletions:a.state.deletions}:void 0),this._tabAction)),this._insertion=this._register(this._instantiationService.createInstance(b3,this._editor,this._uiState.map(a=>a&&a.state?.kind==="insertionMultiLine"?{lineNumber:a.state.lineNumber,startColumn:a.state.column,text:a.state.text}:void 0),this._tabAction)),this._inlineDiffViewState=ve(this,a=>{const c=this._uiState.read(a);if(!(!c||!c.state)&&!(c.state.kind==="wordReplacements"||c.state.kind==="lineReplacement"||c.state.kind==="insertionMultiLine"||c.state.kind==="collapsed"||c.state.kind==="custom"))return{modifiedText:new K_(c.newText),diff:c.diff,mode:c.state.kind,modifiedCodeEditor:this._sideBySide.previewEditor}}),this._inlineCollapsedView=this._register(this._instantiationService.createInstance(v3,this._editor,this._model.map((a,c)=>this._uiState.read(c)?.state?.kind==="collapsed"?a?.inlineEdit:void 0))),this._customView=this._register(this._instantiationService.createInstance(_3,this._editor,this._model.map((a,c)=>this._uiState.read(c)?.state?.kind==="custom"?a?.displayLocation:void 0),this._tabAction)),this._inlineDiffView=this._register(new dVe(this._editor,this._inlineDiffViewState,this._previewTextModel)),this._wordReplacementViews=iA(this,this._uiState.map(a=>a?.state?.kind==="wordReplacements"?a.state.replacements:[]),(a,c)=>c.add(this._instantiationService.createInstance(Sb,this._editorObs,a,this._tabAction))),this._lineReplacementView=this._register(this._instantiationService.createInstance(y3,this._editorObs,this._uiState.map(a=>a?.state?.kind==="lineReplacement"?{originalRange:a.state.originalRange,modifiedRange:a.state.modifiedRange,modifiedLines:a.state.modifiedLines,replacements:a.state.replacements}:void 0),this._tabAction)),this._useCodeShifting=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.allowCodeShifting),this._renderSideBySide=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.renderSideBySide),this._useMultiLineGhostText=this._editorObs.getOption(L.inlineSuggest).map(a=>a.edits.useMultiLineGhostText),this._register(ka((a,c)=>{const d=this._model.read(a);d&&c.add(T.any(this._sideBySide.onDidClick,this._deletion.onDidClick,this._lineReplacementView.onDidClick,this._insertion.onDidClick,...this._wordReplacementViews.read(a).map(l=>l.onDidClick),this._inlineDiffView.onDidClick,this._customView.onDidClick)(l=>{this._viewHasBeenShownLongerThan(350)&&(l.preventDefault(),d.accept())}))})),this._indicator.recomputeInitiallyAndOnChange(this._store),this._wordReplacementViews.recomputeInitiallyAndOnChange(this._store),this._indicatorCyclicDependencyCircuitBreaker.set(!0,void 0),this._register(this._instantiationService.createInstance(m3,this._host,this._model,this._indicator,this._inlineCollapsedView)),this._constructorDone.set(!0,void 0)}getCacheId(e){return e.inlineEdit.inlineCompletion.identity.id}determineView(e,t,i,n){const o=e.inlineEdit,r=this._previousView?.id===this.getCacheId(e),a=this._previousView?.editorWidth!==this._editorObs.layoutInfoWidth.read(t)&&(this._previousView?.view==="sideBySide"||this._previousView?.view==="lineReplacement");if(r&&!a)return this._previousView.view;if(e.displayLocation)return"custom";const c=i.flatMap(v=>v.innerChanges??[]),d=c.length===1;if(d&&this._useCodeShifting.read(t)!=="never"&&gVe(i,o.cursorPosition))return"insertionInline";if(c.map(v=>({original:o.originalText.getValueOfRange(v.originalRange),modified:n.getValueOfRange(v.modifiedRange)})).every(({original:v,modified:_})=>_.trim()===""&&v.length>0&&(v.length>_.length||v.trim()!=="")))return"deletion";if(pVe(i)&&this._useMultiLineGhostText.read(t)&&this._useCodeShifting.read(t)==="always")return"insertionMultiLine";const u=o.originalLineRange.length,g=o.modifiedLineRange.length;return c.every(v=>oc.ofRange(v.originalRange).columnCount<Sb.MAX_LENGTH&&oc.ofRange(v.modifiedRange).columnCount<Sb.MAX_LENGTH)&&d&&u===1&&g===1&&(!c.some(v=>v.originalRange.isEmpty())||!ste(c.map(v=>new ps(v.originalRange,"")),o.originalText).some(v=>v.range.isEmpty()&&oc.ofRange(v.range).columnCount<Sb.MAX_LENGTH))?"wordReplacements":u>0&&g>0?u===1&&g===1?"lineReplacement":this._renderSideBySide.read(t)!=="never"&&TL.fitsInsideViewport(this._editor,this._previewTextModel,o,t)?"sideBySide":"lineReplacement":"sideBySide"}determineRenderState(e,t,i,n){const o=e.inlineEdit,r=this.determineView(e,t,i,n);switch(this._previousView={id:this.getCacheId(e),view:r,editorWidth:this._editor.getLayoutInfo().width,timestamp:Date.now()},r){case"custom":return{kind:"custom",displayLocation:e.displayLocation};case"insertionInline":return{kind:"insertionInline"};case"sideBySide":return{kind:"sideBySide"};case"collapsed":return{kind:"collapsed"}}const a=i.flatMap(d=>d.innerChanges??[]);if(r==="deletion")return{kind:"deletion",originalRange:o.originalLineRange,deletions:a.map(d=>d.originalRange)};if(r==="insertionMultiLine"){const d=a[0];return{kind:"insertionMultiLine",lineNumber:d.originalRange.startLineNumber,column:d.originalRange.startColumn,text:n.getValueOfRange(d.modifiedRange)}}const c=a.map(d=>new ps(d.originalRange,n.getValueOfRange(d.modifiedRange)));if(c.length!==0){if(r==="wordReplacements"){let d=fVe(c,o.originalText);return d.some(l=>l.range.isEmpty())&&(d=ste(c,o.originalText)),{kind:"wordReplacements",replacements:d}}if(r==="lineReplacement")return{kind:"lineReplacement",originalRange:o.originalLineRange,modifiedRange:o.modifiedLineRange,modifiedLines:o.modifiedLineRange.mapToLineArray(d=>n.getLineAt(d)),replacements:a.map(d=>({originalRange:d.originalRange,modifiedRange:d.modifiedRange}))}}}_viewHasBeenShownLongerThan(e){const t=this._previousView?.timestamp;if(!t)throw new tn("viewHasBeenShownLongThan called before a view has been shown");return Date.now()-t>=e}};w3=f([p(5,Z)],w3);function gVe(s,e){if(!e)return!1;const t=e;return s.every(n=>n.innerChanges.every(o=>i(o)));function i(n){if(!n.originalRange.isEmpty()||!(n.modifiedRange.startLineNumber===n.modifiedRange.endLineNumber))return!1;const r=n.originalRange.getStartPosition();return!!(t.isBeforeOrEqual(r)||r.lineNumber<t.lineNumber)}}function pVe(s){const e=s.flatMap(i=>i.innerChanges??[]);if(e.length!==1)return!1;const t=e[0];return!(!t.originalRange.isEmpty()||t.modifiedRange.startLineNumber===t.modifiedRange.endLineNumber)}function fVe(s,e){return Sge(s,e,t=>/^[a-zA-Z]$/.test(t))}function ste(s,e){return Sge(s,e,t=>!/^\s$/.test(t))}function Sge(s,e,t){const i=[];s.sort((o,r)=>P.compareRangesUsingStarts(o.range,r.range));for(const o of s){let r=o.range.startColumn-1,a=o.range.endColumn-2,c="",d="";const l=e.getLineAt(o.range.startLineNumber),u=e.getLineAt(o.range.endLineNumber);if(n(l[r]))for(;n(l[r-1]);)c=l[r-1]+c,r--;if(n(u[a])||a<r)for(;n(u[a+1]);)d+=u[a+1],a++;let g=new ps(new P(o.range.startLineNumber,r+1,o.range.endLineNumber,a+2),c+o.text+d);i.length>0&&P.areIntersectingOrTouching(i[i.length-1].range,g.range)&&(g=ps.joinEdits([i.pop(),g],e)),i.push(g)}function n(o){return o===void 0?!1:t(o)}return i}var S3;let C3=class extends F{static{S3=this}static{this.hot=lN(S3)}constructor(e,t,i,n,o){super(),this._editor=e,this._edit=t,this._model=i,this._focusIsInMenu=n,this._inlineEdit=ve(this,r=>{const a=this._model.read(r);if(!a)return;const c=this._edit.read(r);if(!c)return;const d=this._editor.getModel();if(!d)return;const l=a.inlineEditState.get()?.inlineCompletion.updatedEdit;if(!l)return;const u=l.edits.map(v=>{const _=P.fromPositions(d.getPositionAt(v.replaceRange.start),d.getPositionAt(v.replaceRange.endExclusive));return new ps(_,v.newText)}),g=new hc(u),m=new fy(d);return new lge(m,g,a.primaryPosition.get(),c.commands,c.inlineCompletion)}),this._inlineEditModel=ve(this,r=>{const a=this._model.read(r);if(!a)return;const c=this._inlineEdit.read(r);if(!c)return;const d=ve(this,l=>{if(this._editorObs.isFocused.read(l)){if(a.tabShouldJumpToInlineEdit.read(l))return Fs.Jump;if(a.tabShouldAcceptInlineEdit.read(l))return Fs.Accept}return Fs.Inactive});return new hge(a,c,d)}),this._inlineEditHost=ve(this,r=>{const a=this._model.read(r);if(a)return new NBe(a)}),this._ghostTextIndicator=ve(this,r=>{const a=this._model.read(r);if(!a)return;const c=a.inlineCompletionState.read(r);if(!c)return;const d=c.inlineCompletion;if(!d||!d.showInlineEditMenu)return;const l=xr.ofLength(c.primaryGhostText.lineNumber,1);return new OBe(this._editor,a,l,d)}),this._editorObs=Rs(this._editor),this._register(o.createInstance(w3,this._editor,this._inlineEditHost,this._inlineEditModel,this._ghostTextIndicator,this._focusIsInMenu))}};C3=S3=f([p(4,Z)],C3);function mVe(s){const e=new U,t=e.add(hye());return e.add(fi(i=>{t.setStyle(s.read(i))})),e}let E3=class extends F{constructor(e,t,i,n){super(),this._editor=e,this._model=t,this._focusIsInMenu=i,this._instantiationService=n,this._ghostTexts=ve(this,o=>this._model.read(o)?.ghostTexts.read(o)??[]),this._stablizedGhostTexts=iBe(this._ghostTexts,this._store),this._editorObs=Rs(this._editor),this._ghostTextWidgets=iA(this,this._stablizedGhostTexts,(o,r)=>jF(a=>this._instantiationService.createInstance(Bx.hot.read(a),this._editor,{ghostText:o,warning:this._model.map((c,d)=>{const l=c?.warning?.read(d);return l?{icon:l.icon}:void 0}),minReservedLineCount:Li(0),targetTextModel:this._model.map(c=>c?.textModel)},this._editorObs.getOption(L.inlineSuggest).map(c=>({syntaxHighlightingEnabled:c.syntaxHighlightingEnabled})),!1,!1)).recomputeInitiallyAndOnChange(r)).recomputeInitiallyAndOnChange(this._store),this._inlineEdit=ve(this,o=>this._model.read(o)?.inlineEditState.read(o)?.inlineEdit),this._everHadInlineEdit=Nv(this,(o,r)=>r||!!this._inlineEdit.read(o)||!!this._model.read(o)?.inlineCompletionState.read(o)?.inlineCompletion?.showInlineEditMenu),this._inlineEditWidget=jF(o=>{if(this._everHadInlineEdit.read(o))return this._instantiationService.createInstance(C3.hot.read(o),this._editor,this._inlineEdit,this._model,this._focusIsInMenu)}).recomputeInitiallyAndOnChange(this._store),this._fontFamily=this._editorObs.getOption(L.inlineSuggest).map(o=>o.fontFamily),this._register(mVe(ve(o=>{const r=this._fontFamily.read(o);return r===""||r==="default"?"":`
.monaco-editor .ghost-text-decoration,
.monaco-editor .ghost-text-decoration-preview,
.monaco-editor .ghost-text {
	font-family: ${r};
}`}))),this._register(new iH(this._editor,this._model,this._instantiationService))}shouldShowHoverAtViewZone(e){return this._ghostTextWidgets.get()[0]?.get().ownsViewZone(e)??!1}};E3=f([p(3,Z)],E3);var Vg;let eo=class extends F{static{Vg=this}static{this._instances=new Set}static{this.hot=lN(Vg)}static{this.ID="editor.contrib.inlineCompletionsController"}static getInFocusedEditorOrParent(e){const t=lae(e);return t?Vg.get(t):null}static get(e){return qWe(e.getContribution(Vg.ID))}constructor(e,t,i,n,o,r,a,c,d,l){super(),this.editor=e,this._instantiationService=t,this._contextKeyService=i,this._configurationService=n,this._commandService=o,this._debounceService=r,this._languageFeaturesService=a,this._accessibilitySignalService=c,this._keybindingService=d,this._accessibilityService=l,this._editorObs=Rs(this.editor),this._positions=ve(this,m=>this._editorObs.selections.read(m)?.map(v=>v.getEndPosition())??[new we(1,1)]),this._suggestWidgetAdapter=this._register(new ABe(this._editorObs,m=>this.model.get()?.handleSuggestAccepted(m),()=>this.model.get()?.selectedInlineCompletion.get()?.getSingleTextEdit())),this._enabledInConfig=kn(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(L.inlineSuggest).enabled),this._isScreenReaderEnabled=kn(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this._editorDictationInProgress=kn(this,this._contextKeyService.onDidChangeContext,()=>this._contextKeyService.getContext(this.editor.getDomNode()).getValue("editorDictation.inProgress")===!0),this._enabled=ve(this,m=>this._enabledInConfig.read(m)&&(!this._isScreenReaderEnabled.read(m)||!this._editorDictationInProgress.read(m))),this._debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,"InlineCompletionsDebounce",{min:50,max:50}),this._focusIsInMenu=si(this,!1),this._focusIsInEditorOrMenu=ve(this,m=>{const v=this._editorObs.isFocused.read(m),_=this._focusIsInMenu.read(m);return v||_}),this._cursorIsInIndentation=ve(this,m=>{const v=this._editorObs.cursorPosition.read(m);if(v===null)return!1;const _=this._editorObs.model.read(m);if(!_)return!1;this._editorObs.versionId.read(m);const w=_.getLineIndentColumn(v.lineNumber);return v.column<=w}),this.model=jF(this,m=>{if(this._editorObs.isReadonly.read(m))return;const v=this._editorObs.model.read(m);return v?this._instantiationService.createInstance(o3,v,this._suggestWidgetAdapter.selectedItem,this._editorObs.versionId,this._positions,this._debounceValue,this._enabled,this.editor):void 0}).recomputeInitiallyAndOnChange(this._store),this._playAccessibilitySignal=Kd(this),this._hideInlineEditOnSelectionChange=this._editorObs.getOption(L.inlineSuggest).map(m=>!0),this._view=this._register(this._instantiationService.createInstance(E3,this.editor,this.model,this._focusIsInMenu)),Vg._instances.add(this),this._register(Ie(()=>Vg._instances.delete(this))),this._register(fi(m=>{const v=this.model.read(m);if(v&&v.state.read(m)!==void 0)for(const _ of Vg._instances)_!==this&&_.reject()})),this._register(_C(this._editorObs.onDidType,(m,v)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(_C(this._editorObs.onDidPaste,(m,v)=>{this._enabled.get()&&this.model.get()?.trigger()})),this._register(this._commandService.onDidExecuteCommand(m=>{if(new Set([Ok.Tab.id,Ok.DeleteLeft.id,Ok.DeleteRight.id,px,"acceptSelectedSuggestion"]).has(m.commandId)&&e.hasTextFocus()&&this._enabled.get()){let _=!1;m.commandId===px&&(_=!0),this._editorObs.forceUpdate(w=>{this.model.get()?.trigger(w,{noDelay:_})})}})),this._register(_C(this._editorObs.selections,(m,v,_)=>{if(_.some(w=>w.reason===Ws.Explicit||w.source==="api")){if(!this._hideInlineEditOnSelectionChange.get()&&this.model.get()?.state.get()?.kind==="inlineEdit")return;const w=this.model.get();if(!w)return;w.state.get()?.kind==="ghostText"&&this.model.get()?.stop()}})),this._register(fi(m=>{if(this._focusIsInEditorOrMenu.read(m)||this._contextKeyService.getContextKeyValue("accessibleViewIsShown")||this._configurationService.getValue("editor.inlineSuggest.keepOnBlur")||e.getOption(L.inlineSuggest).keepOnBlur||Gy.dropDownVisible)return;const _=this.model.get();_&&(_.state.get()?.inlineCompletion?.isFromExplicitRequest&&_.inlineEditAvailable.get()||gs(w=>{_.stop("automatic",w)}))})),this._register(fi(m=>{const v=this.model.read(m)?.inlineCompletionState.read(m);v?.suggestItem?v.primaryGhostText.lineCount>=2&&this._suggestWidgetAdapter.forceRenderingAbove():this._suggestWidgetAdapter.stopForceRenderingAbove()})),this._register(Ie(()=>{this._suggestWidgetAdapter.stopForceRenderingAbove()}));const u=Nv(this,(m,v)=>{const w=this.model.read(m)?.state.read(m);return this._suggestWidgetAdapter.selectedItem.get()?v:w?.inlineCompletion?.semanticId});this._register(uye(ve(m=>(this._playAccessibilitySignal.read(m),u.read(m),{})),async(m,v,_,w)=>{const C=this.model.get(),k=C?.state.get();if(!k||!C)return;const D=k.kind==="ghostText"?C.textModel.getLineContent(k.primaryGhostText.lineNumber):"";await Da(50,u8(w)),await Mk(this._suggestWidgetAdapter.selectedItem,Ym,()=>!1,u8(w)),await this._accessibilitySignalService.playSignal(k.kind==="ghostText"?Vp.inlineSuggestion:Vp.nextEditSuggestion),this.editor.getOption(L.screenReaderAnnounceInlineSuggestion)&&(k.kind==="ghostText"?this._provideScreenReaderUpdate(k.primaryGhostText.renderForScreenReader(D)):this._provideScreenReaderUpdate(""))})),this._register(this._configurationService.onDidChangeConfiguration(m=>{m.affectsConfiguration("accessibility.verbosity.inlineCompletions")&&this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue("accessibility.verbosity.inlineCompletions")})})),this.editor.updateOptions({inlineCompletionsAccessibilityVerbose:this._configurationService.getValue("accessibility.verbosity.inlineCompletions")});const g=new nBe(this._contextKeyService);this._register(g.bind(Ai.cursorInIndentation,this._cursorIsInIndentation)),this._register(g.bind(Ai.hasSelection,m=>!this._editorObs.cursorSelection.read(m)?.isEmpty())),this._register(g.bind(Ai.cursorAtInlineEdit,this.model.map((m,v)=>m?.inlineEditState?.read(v)?.cursorAtInlineEdit.read(v)))),this._register(g.bind(Ai.tabShouldAcceptInlineEdit,this.model.map((m,v)=>!!m?.tabShouldAcceptInlineEdit.read(v)))),this._register(g.bind(Ai.tabShouldJumpToInlineEdit,this.model.map((m,v)=>!!m?.tabShouldJumpToInlineEdit.read(v)))),this._register(g.bind(Ai.inlineEditVisible,m=>this.model.read(m)?.inlineEditState.read(m)!==void 0)),this._register(g.bind(Ai.inlineSuggestionHasIndentation,m=>this.model.read(m)?.getIndentationInfo(m)?.startsWithIndentation)),this._register(g.bind(Ai.inlineSuggestionHasIndentationLessThanTabSize,m=>this.model.read(m)?.getIndentationInfo(m)?.startsWithIndentationLessThanTabSize)),this._register(g.bind(Ai.suppressSuggestions,m=>{const _=this.model.read(m)?.inlineCompletionState.read(m);return _?.primaryGhostText&&_?.inlineCompletion?_.inlineCompletion.source.inlineSuggestions.suppressSuggestions:void 0})),this._register(g.bind(Ai.inlineSuggestionVisible,m=>{const _=this.model.read(m)?.inlineCompletionState.read(m);return!!_?.inlineCompletion&&_?.primaryGhostText!==void 0&&!_?.primaryGhostText.isEmpty()})),this._register(this._instantiationService.createInstance(Zb,this.editor))}playAccessibilitySignal(e){this._playAccessibilitySignal.trigger(e)}_provideScreenReaderUpdate(e){const t=this._contextKeyService.getContextKeyValue("accessibleViewIsShown"),i=this._keybindingService.lookupKeybinding("editor.action.accessibleView");let n;!t&&i&&this.editor.getOption(L.inlineCompletionsAccessibilityVerbose)&&(n=h(1263,"Inspect this in the accessible view ({0})",i.getAriaLabel())),na(n?e+", "+n:e)}shouldShowHoverAt(e){const t=this.model.get()?.primaryGhostText.get();return t?t.parts.some(i=>e.containsPosition(new we(t.lineNumber,i.column))):!1}shouldShowHoverAtViewZone(e){return this._view.shouldShowHoverAtViewZone(e)}reject(){gs(e=>{const t=this.model.get();t&&t.stop("explicitCancel",e)})}jump(){const e=this.model.get();e&&e.jump()}testOnlyDisableUi(){this._view.dispose()}};eo=Vg=f([p(1,Z),p(2,fe),p(3,ne),p(4,Ge),p(5,Sd),p(6,Ne),p(7,lI),p(8,He),p(9,Nr)],eo);class Hx extends F{static get(e){return e.getContribution(Hx.ID)}static{this.ID="editor.contrib.placeholderText"}constructor(e){super(),this._editor=e,this._editorObs=Rs(this._editor),this._placeholderText=this._editorObs.getOption(L.placeholder),this._state=Yl({owner:this,equalsFn:Rk},t=>{const i=this._placeholderText.read(t);if(i&&this._editorObs.valueIsEmpty.read(t))return{placeholder:i}}),this._shouldViewBeAlive=vVe(this,t=>this._state.read(t)?.placeholder!==void 0),this._view=Mv((t,i)=>{if(!this._shouldViewBeAlive.read(t))return;const n=en("div.editorPlaceholder");i.add(fi(o=>{const r=this._state.read(o),a=r?.placeholder!==void 0;n.root.style.display=a?"block":"none",n.root.innerText=r?.placeholder??""})),i.add(fi(o=>{const r=this._editorObs.layoutInfo.read(o);n.root.style.left=`${r.contentLeft}px`,n.root.style.width=r.contentWidth-r.verticalScrollbarWidth+"px",n.root.style.top=`${this._editor.getTopForLineNumber(0)}px`})),i.add(fi(o=>{n.root.style.fontFamily=this._editorObs.getOption(L.fontFamily).read(o),n.root.style.fontSize=this._editorObs.getOption(L.fontSize).read(o)+"px",n.root.style.lineHeight=this._editorObs.getOption(L.lineHeight).read(o)+"px"})),i.add(this._editorObs.createOverlayWidget({allowEditorOverflow:!1,minContentWidthInPx:Li(0),position:Li(null),domNode:n.root}))}),this._view.recomputeInitiallyAndOnChange(this._store)}}function vVe(s,e){return Nv(s,(t,i)=>i===!0?!0:e(t))}const _Ve=new O("commentEditorFocused",!1),uE=5*18,bVe=25*18;let tw=class extends gI{constructor(e,t,i,n,o,r,a,c,d,l,u,g){const m={contributions:[{id:bx.ID,ctor:bx,instantiation:_t.BeforeFirstInteraction},{id:jp.ID,ctor:jp,instantiation:_t.BeforeFirstInteraction},{id:ia.ID,ctor:ia,instantiation:_t.Eager},{id:cs.ID,ctor:cs,instantiation:_t.Lazy},{id:ng.ID,ctor:ng,instantiation:_t.Eager},{id:Rh.ID,ctor:Rh,instantiation:_t.Lazy},...TE.getSomeEditorContributions([md.ID,tg.ID,mv.ID,Dr.ID,ws.ID,qy.ID,Ude,eo.ID,Zp.ID,Hx.ID])],contextMenuId:N.SimpleEditorContext};super(e,t,m,o,r,a,i,c,d,l,u,g),this._commentEditorFocused=_Ve.bindTo(i),this._commentEditorEmpty=Ja.commentIsEmpty.bindTo(i),this._commentEditorEmpty.set(!this.getModel()?.getValueLength()),this._parentThread=n,this._register(this.onDidFocusEditorWidget(v=>this._commentEditorFocused.set(!0))),this._register(this.onDidChangeModelContent(v=>this._commentEditorEmpty.set(!this.getModel()?.getValueLength()))),this._register(this.onDidBlurEditorWidget(v=>this._commentEditorFocused.reset()))}getParentThread(){return this._parentThread}_getActions(){return TE.getEditorActions()}updateOptions(e){const t={...e,lineNumbers:"off"};super.updateOptions(t)}static getEditorOptions(e){return{wordWrap:"on",glyphMargin:!1,lineNumbers:"off",folding:!1,selectOnLineNumbers:!1,scrollbar:{vertical:"visible",verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!1},overviewRulerLanes:2,lineDecorationsWidth:0,scrollBeyondLastLine:!1,renderLineHighlight:"none",fixedOverflowWidgets:!0,acceptSuggestionOnEnter:"smart",minimap:{enabled:!1},dropIntoEditor:{enabled:!0},autoClosingBrackets:e.getValue("editor.autoClosingBrackets"),quickSuggestions:!1,accessibilitySupport:e.getValue("editor.accessibilitySupport"),fontFamily:e.getValue("editor.fontFamily"),fontSize:e.getValue("editor.fontSize")}}};tw=f([p(4,Z),p(5,Bt),p(6,Ge),p(7,pt),p(8,Dt),p(9,Nr),p(10,ds),p(11,Ne)],tw);function Cge(s,e,t){const i=e.getLayoutInfo(),n=e.getOption(L.lineHeight),o=e._getViewModel()?.getLineCount()*n;if(o>i.height||o<i.height&&t>uE){const r=Math.ceil((o-i.height)/n),a=i.height+n*r;return dm(a,uE,dm(s.getLayoutInfo().height-90,uE,bVe))}return t}let yVe=0;const wVe="commenteditordecoration";let x3=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k){super(),this.owner=e,this._parentEditor=i,this._commentThread=n,this._scopedInstatiationService=o,this._contextKeyService=r,this._commentMenus=a,this._commentOptions=c,this._pendingComment=d,this._parentThread=l,this._actionRunDelegate=g,this.commentService=m,this.keybindingService=_,this.contextMenuService=w,this.hoverService=C,this.textModelService=k,this._commentThreadDisposables=[],this._editorHeight=uE,this._container=ee(t,j(".comment-form-container")),this._form=ee(this._container,j(".comment-form")),this.commentEditor=this._register(this._scopedInstatiationService.createInstance(tw,this._form,tw.getEditorOptions(v),r,this._parentThread)),this.commentEditorIsEmpty=Ja.commentIsEmpty.bindTo(this._contextKeyService),this.commentEditorIsEmpty.set(!this._pendingComment),this.initialize(u)}async initialize(e){this.avatar=ee(this._form,j(".avatar-container")),this.updateAuthorInfo();const t=this._commentThread.comments&&this._commentThread.comments.length>0,i=Pn()+"-"+(t?this._commentThread.threadId:++yVe),n=JSON.stringify({extensionId:this._commentThread.extensionId,commentThreadId:this._commentThread.threadId});let o=R.from({scheme:ae.commentsInput,path:`/${this._commentThread.extensionId}/commentinput-${i}.md?${n}`});const r=this.commentService.getCommentController(this.owner);r&&(o=o.with({authority:r.id}));const a=await this.textModelService.createModelReference(o);a.object.textEditorModel.setValue(this._pendingComment?.body||""),this._register(a),this.commentEditor.setModel(a.object.textEditorModel),this._pendingComment&&this.commentEditor.setPosition(this._pendingComment.cursor),this.calculateEditorHeight(),this._register(a.object.textEditorModel.onDidChangeContent(()=>{this.setCommentEditorDecorations(),this.commentEditorIsEmpty?.set(!this.commentEditor.getValue()),this.calculateEditorHeight()&&(this.commentEditor.layout({height:this._editorHeight,width:this.commentEditor.getLayoutInfo().width}),this.commentEditor.render(!0))})),this.createTextModelListener(this.commentEditor,this._form),this.setCommentEditorDecorations(),this._pendingComment?this.expandReplyArea():t?this.createReplyButton(this.commentEditor,this._form):e&&this._commentThread.comments&&this._commentThread.comments.length===0&&this.expandReplyArea(),this._error=ee(this._container,j(".validation-error.hidden"));const c=ee(this._container,j(".form-actions"));this._formActions=ee(c,j(".other-actions")),this.createCommentWidgetFormActions(this._formActions,a.object.textEditorModel),this._editorActions=ee(c,j(".editor-actions")),this.createCommentWidgetEditorActions(this._editorActions,a.object.textEditorModel)}calculateEditorHeight(){const e=Cge(this._parentEditor,this.commentEditor,this._editorHeight);return e!==this._editorHeight?(this._editorHeight=e,!0):!1}updateCommentThread(e){const t=this.commentEditor.hasTextFocus(),i=!this._commentThread.comments?.length&&!e.comments?.length;this._reviewThreadReplyButton||this.createReplyButton(this.commentEditor,this._form),this._commentThread.comments&&this._commentThread.comments.length===0&&!i&&this.expandReplyArea(),t&&this.commentEditor.focus()}getPendingComment(){const e=this.commentEditor.getModel();if(e&&e.getValueLength()>0)return{body:e.getValue(),cursor:this.commentEditor.getPosition()??new we(1,1)}}setPendingComment(e){this._pendingComment=e,this.expandReplyArea(),this.commentEditor.setValue(e.body),this.commentEditor.setPosition(e.cursor)}layout(e){this.commentEditor.layout({height:this._editorHeight,width:e-54})}focusIfNeeded(){!this._commentThread.comments||!this._commentThread.comments.length?this.commentEditor.focus():(this.commentEditor.getModel()?.getValueLength()??0)>0&&this.expandReplyArea()}focusCommentEditor(){this.commentEditor.focus()}expandReplyAreaAndFocusCommentEditor(){this.expandReplyArea(),this.commentEditor.focus()}isCommentEditorFocused(){return this.commentEditor.hasWidgetFocus()}updateAuthorInfo(){if(this.avatar.textContent="",typeof this._commentThread.canReply!="boolean"&&this._commentThread.canReply.iconPath){this.avatar.style.display="block";const e=ee(this.avatar,j("img.avatar"));e.src=nc.uriToBrowserUri(R.revive(this._commentThread.canReply.iconPath)).toString(!0)}else this.avatar.style.display="none"}updateCanReply(){this.updateAuthorInfo(),this._commentThread.canReply?this._container.style.display="block":this._container.style.display="none"}async submitComment(){await this._commentFormActions?.triggerDefaultAction(),this._pendingComment=void 0}setCommentEditorDecorations(){const t=this._commentThread.comments&&this._commentThread.comments.length>0?this._commentOptions?.placeHolder||h(5278,"Reply..."):this._commentOptions?.placeHolder||h(5279,"Type a new comment");this.commentEditor.updateOptions({placeholder:t})}createTextModelListener(e,t){this._commentThreadDisposables.push(e.onDidFocusEditorWidget(()=>{this._commentThread.input={uri:e.getModel().uri,value:e.getValue()},this.commentService.setActiveEditingCommentThread(this._commentThread),this.commentService.setActiveCommentAndThread(this.owner,{thread:this._commentThread})})),this._commentThreadDisposables.push(e.getModel().onDidChangeContent(()=>{const i=e.getValue();if(this._commentThread.input&&this._commentThread.input.uri===e.getModel().uri&&this._commentThread.input.value!==i){const n=this._commentThread.input;n.value=i,this._commentThread.input=n}this.commentService.setActiveEditingCommentThread(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeInput(i=>{const n=this._commentThread,o=e.getModel();n.input&&o&&n.input.uri!==o.uri||i&&e.getValue()!==i.value&&(e.setValue(i.value),i.value===""&&(this._pendingComment={body:"",cursor:new we(1,1)},t.classList.remove("expand"),e.getDomNode().style.outline="",this._error.textContent="",this._error.classList.add("hidden")))}))}createCommentWidgetFormActions(e,t){const i=this._commentMenus.getCommentThreadActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentFormActions.setActions(i)})),this._commentFormActions=new Lx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,async n=>{await this._actionRunDelegate?.(),await n.run({thread:this._commentThread,text:this.commentEditor.getValue(),$mid:Dn.CommentThreadReply}),this.hideReplyArea()}),this._register(this._commentFormActions),this._commentFormActions.setActions(i)}createCommentWidgetEditorActions(e,t){const i=this._commentMenus.getCommentEditorActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentEditorActions.setActions(i,!0)})),this._commentEditorActions=new Lx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,async n=>{this._actionRunDelegate?.(),n.run({thread:this._commentThread,text:this.commentEditor.getValue(),$mid:Dn.CommentThreadReply}),this.focusCommentEditor()}),this._register(this._commentEditorActions),this._commentEditorActions.setActions(i,!0)}get isReplyExpanded(){return this._container.classList.contains("expand")}expandReplyArea(){this.isReplyExpanded||(this._container.classList.add("expand"),this.commentEditor.focus(),this.commentEditor.layout())}clearAndExpandReplyArea(){this.isReplyExpanded||(this.commentEditor.setValue(""),this.expandReplyArea())}hideReplyArea(){const e=this.commentEditor.getDomNode();e&&(e.style.outline=""),this.commentEditor.setValue(""),this._pendingComment={body:"",cursor:new we(1,1)},this._container.classList.remove("expand"),this._error.textContent="",this._error.classList.add("hidden")}createReplyButton(e,t){this._reviewThreadReplyButton=ee(t,j(`button.review-thread-reply-button.${ZF}`)),this._register(this.hoverService.setupManagedHover(Ir("mouse"),this._reviewThreadReplyButton,this._commentOptions?.prompt||h(5278,"Reply..."))),this._reviewThreadReplyButton.textContent=this._commentOptions?.prompt||h(5278,"Reply..."),this._register(re(this._reviewThreadReplyButton,"click",i=>this.clearAndExpandReplyArea())),this._register(re(this._reviewThreadReplyButton,"focus",i=>this.clearAndExpandReplyArea())),this._register(e.onDidBlurEditorWidget(()=>{e.getModel().getValueLength()===0&&t.classList.contains("expand")&&t.classList.remove("expand")}))}dispose(){super.dispose(),Xe(this._commentThreadDisposables)}};x3=f([p(12,gg),p(13,ne),p(14,He),p(15,bi),p(16,Ti),p(17,Ci)],x3);class am extends Xt{static{this.ID="toolbar.toggle.pickReactions"}constructor(e,t){super(am.ID,t||h(5381,"Pick Reactions..."),"toggle-reactions",!0),this._menuActions=[],this.toggleDropdownMenu=e}run(){return this.toggleDropdownMenu(),Promise.resolve(!0)}get menuActions(){return this._menuActions}set menuActions(e){this._menuActions=e}}class SVe extends Qm{constructor(e){super(null,e,{})}updateLabel(){if(!this.label)return;const e=this.action;if(e.class&&this.label.classList.add(e.class),e.icon){const t=ee(this.label,j(".reaction-icon")),i=R.revive(e.icon);t.style.backgroundImage=hy(i)}else{const t=ee(this.label,j("span.reaction-label"));t.innerText=e.label}if(e.count){const t=ee(this.label,j("span.reaction-count"));t.innerText=`${e.count}`}}getTooltip(){const e=this.action,t=e.enabled?h(5382,"Toggle reaction, "):"";if(e.count===void 0)return h(5383,"{0}{1} reaction",t,e.label);if(e.reactors===void 0||e.reactors.length===0){if(e.count===1)return h(5384,"{0}1 reaction with {1}",t,e.label);if(e.count>1)return h(5385,"{0}{1} reactions with {2}",t,e.count,e.label)}else{if(e.reactors.length<=10&&e.reactors.length===e.count)return h(5386,"{0}{1} reacted with {2}",t,e.reactors.join(", "),e.label);if(e.count>1){const i=e.reactors.slice(0,10);return h(5387,"{0}{1} and {2} more reacted with {3}",t,i.join(", "),e.count-i.length,e.label)}}}}class AL extends Xt{static{this.ID="toolbar.toggle.reaction"}constructor(e,t="",i="",n=!0,o,r,a,c){super(AL.ID,t,i,n,o),this.reactors=r,this.icon=a,this.count=c}}class CVe extends hg{async runAction(e,t){await e.run(...t)}}let I3=class extends F{get domNode(){return this._domNode}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C){super(),this.parentEditor=e,this.commentThread=t,this.comment=i,this.pendingEdit=n,this.owner=o,this.resource=r,this.parentThread=a,this.markdownRenderer=c,this.instantiationService=d,this.commentService=l,this.notificationService=u,this.contextMenuService=g,this.configurationService=v,this.hoverService=_,this.keybindingService=w,this.textModelService=C,this._md=this._register(new Pt),this._editAction=null,this._commentEditContainer=null,this._reactionsActionBar=this._register(new Pt),this._reactionActions=this._register(new U),this._commentEditor=null,this._commentEditorDisposables=[],this._commentEditorModel=null,this._editorHeight=uE,this._actionRunner=this._register(new CVe),this.toolbar=this._register(new Pt),this._commentFormActions=null,this._commentEditorActions=null,this._onDidClick=new M,this.isEditing=!1,this._domNode=j("div.review-comment"),this._contextKeyService=this._register(m.createScoped(this._domNode)),this._commentContextValue=Ja.commentContext.bindTo(this._contextKeyService),this.comment.contextValue&&this._commentContextValue.set(this.comment.contextValue),this._commentMenus=this.commentService.getCommentMenus(this.owner),this._domNode.tabIndex=-1,this._avatar=ee(this._domNode,j("div.avatar-container")),this.updateCommentUserIcon(this.comment.userIconPath),this._commentDetailsContainer=ee(this._domNode,j(".review-comment-contents")),this.createHeader(this._commentDetailsContainer),this._body=document.createElement("div"),this._body.classList.add("comment-body",ZF),v.getValue(_0)?.maxHeight!==!1&&this._body.classList.add("comment-body-max-height"),this.createScroll(this._commentDetailsContainer,this._body),this.updateCommentBody(this.comment.body),this.createReactionsContainer(this._commentDetailsContainer),this._domNode.setAttribute("aria-label",`${i.userName}, ${this.commentBodyValue}`),this._domNode.setAttribute("role","treeitem"),this._clearTimeout=null,this._register(re(this._domNode,pe.CLICK,()=>this.isEditing||this._onDidClick.fire(this))),this._register(re(this._domNode,pe.CONTEXT_MENU,k=>this.onContextMenu(k))),n&&this.switchToEditMode(),this.activeCommentListeners()}activeCommentListeners(){this._register(re(this._domNode,pe.FOCUS_IN,()=>{this.commentService.setActiveCommentAndThread(this.owner,{thread:this.commentThread,comment:this.comment})},!0))}createScroll(e,t){this._scrollable=this._register(new gye({forceIntegerValues:!0,smoothScrollDuration:125,scheduleAtNextAnimationFrame:n=>PE(Et(e),n)})),this._scrollableElement=this._register(new pye(t,{horizontal:cd.Visible,vertical:cd.Visible},this._scrollable)),this._register(this._scrollableElement.onScroll(n=>{n.scrollLeftChanged&&(t.scrollLeft=n.scrollLeft),n.scrollTopChanged&&(t.scrollTop=n.scrollTop)}));const i=this._register(new Ko(t,"scroll")).event;this._register(i(n=>{const o=this._scrollableElement.getScrollPosition(),r=Math.abs(t.scrollLeft-o.scrollLeft)<=1?void 0:t.scrollLeft,a=Math.abs(t.scrollTop-o.scrollTop)<=1?void 0:t.scrollTop;(r!==void 0||a!==void 0)&&this._scrollableElement.setScrollPosition({scrollLeft:r,scrollTop:a})})),e.appendChild(this._scrollableElement.getDomNode())}updateCommentBody(e){this._body.innerText="",this._md.clear(),this._plainText=void 0,typeof e=="string"?(this._plainText=ee(this._body,j(".comment-body-plainstring")),this._plainText.innerText=e):(this._md.value=this.markdownRenderer.render(e),this._body.appendChild(this._md.value.element))}updateCommentUserIcon(e){if(this._avatar.textContent="",e){const t=ee(this._avatar,j("img.avatar"));t.src=nc.uriToBrowserUri(R.revive(e)).toString(!0),t.onerror=i=>t.remove()}}get onDidClick(){return this._onDidClick.event}createTimestamp(e){this._timestamp=ee(e,j("span.timestamp-container")),this.updateTimestamp(this.comment.timestamp)}updateTimestamp(e){if(!this._timestamp)return;const t=e!==void 0?new Date(e):void 0;t?this._timestampWidget?this._timestampWidget.setTimestamp(t):(this._timestampWidget=new H$(this.configurationService,this.hoverService,this._timestamp,t),this._register(this._timestampWidget)):this._timestampWidget?.dispose()}createHeader(e){const t=ee(e,j(`div.comment-title.${ZF}`)),i=ee(t,j("comment-header-info")),n=ee(i,j("strong.author"));n.innerText=this.comment.userName,this.createTimestamp(i),this._isPendingLabel=ee(i,j("span.isPending")),this.comment.label?this._isPendingLabel.innerText=this.comment.label:this._isPendingLabel.innerText="",this._actionsToolbarContainer=ee(t,j(".comment-actions")),this.createActionsToolbar()}getToolbarActions(e){const t=e.getActions({shouldForwardArgs:!0}),o={primary:[],secondary:[]};return EVe(t,o,!1,r=>/^inline/.test(r)),o}get commentNodeContext(){return[{thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,$mid:Dn.CommentNode},{commentControlHandle:this.commentThread.controllerHandle,commentThreadHandle:this.commentThread.commentThreadHandle,$mid:Dn.CommentThread}]}createToolbar(){this.toolbar.value=new xSe(this._actionsToolbarContainer,this.contextMenuService,{actionViewItemProvider:(e,t)=>e.id===am.ID?new mC(e,e.menuActions,this.contextMenuService,{...t,actionViewItemProvider:(i,n)=>this.actionViewItemProvider(i,n),classNames:["toolbar-toggle-pickReactions",...ke.asClassNameArray(K.reactions)],anchorAlignmentProvider:()=>Pb.RIGHT}):this.actionViewItemProvider(e,t),orientation:xa.HORIZONTAL}),this.toolbar.value.context=this.commentNodeContext,this.toolbar.value.actionRunner=this._actionRunner}createActionsToolbar(){const e=[],t=this._commentMenus.getCommentTitleActions(this.comment,this._contextKeyService);this._register(t),this._register(t.onDidChange(o=>{const{primary:r,secondary:a}=this.getToolbarActions(t);!this.toolbar&&(r.length||a.length)&&this.createToolbar(),this.toolbar.value.setActions(r,a)}));const{primary:i,secondary:n}=this.getToolbarActions(t);e.push(...i),(e.length||n.length)&&(this.createToolbar(),this.toolbar.value.setActions(e,n))}actionViewItemProvider(e,t){return e.id===am.ID?t={label:!1,icon:!0}:t={label:!1,icon:!0},e.id===AL.ID?new SVe(e):e instanceof wr?this.instantiationService.createInstance(nI,e,{hoverDelegate:t.hoverDelegate}):e instanceof xh?this.instantiationService.createInstance(Nne,e,t):new Qm({},e,t)}async submitComment(){this._commentEditor&&this._commentFormActions&&(await this._commentFormActions.triggerDefaultAction(),this.pendingEdit=void 0)}createReactionPicker(e){const t=this._reactionActions.add(new am(()=>{n?.show()},h(5271,"Toggle Reaction")));let i=[];e&&e.length&&(i=e.map(o=>this._reactionActions.add(new Xt(`reaction.command.${o.label}`,`${o.label}`,"",!0,async()=>{try{await this.commentService.toggleReaction(this.owner,this.resource,this.commentThread,this.comment,o)}catch(r){const a=r.message?h(5272,"Toggling the comment reaction failed: {0}.",r.message):h(5273,"Toggling the comment reaction failed");this.notificationService.error(a)}})))),t.menuActions=i;const n=this._reactionActions.add(new mC(t,t.menuActions,this.contextMenuService,{actionViewItemProvider:(o,r)=>o.id===am.ID?n:this.actionViewItemProvider(o,r),classNames:"toolbar-toggle-pickReactions",anchorAlignmentProvider:()=>Pb.RIGHT}));return t}createReactionsContainer(e){this._reactionActionsContainer?.remove(),this._reactionsActionBar.clear(),this._reactionActions.clear(),this._reactionActionsContainer=ee(e,j("div.comment-reactions")),this._reactionsActionBar.value=new Ar(this._reactionActionsContainer,{actionViewItemProvider:(i,n)=>i.id===am.ID?new mC(i,i.menuActions,this.contextMenuService,{actionViewItemProvider:(o,r)=>this.actionViewItemProvider(o,r),classNames:["toolbar-toggle-pickReactions",...ke.asClassNameArray(K.reactions)],anchorAlignmentProvider:()=>Pb.RIGHT}):this.actionViewItemProvider(i,n)});const t=this.commentService.hasReactionHandler(this.owner);if(this.comment.commentReactions?.filter(i=>!!i.count).map(i=>{const n=this._reactionActions.add(new AL(`reaction.${i.label}`,`${i.label}`,i.hasReacted&&(i.canEdit||t)?"active":"",i.canEdit||t,async()=>{try{await this.commentService.toggleReaction(this.owner,this.resource,this.commentThread,this.comment,i)}catch(o){let r;i.hasReacted?r=o.message?h(5274,"Deleting the comment reaction failed: {0}.",o.message):h(5275,"Deleting the comment reaction failed"):r=o.message?h(5276,"Deleting the comment reaction failed: {0}.",o.message):h(5277,"Deleting the comment reaction failed"),this.notificationService.error(r)}},i.reactors,i.iconPath,i.count));this._reactionsActionBar.value?.push(n,{label:!0,icon:!0})}),t){const i=this.createReactionPicker(this.comment.commentReactions||[]);this._reactionsActionBar.value?.push(i,{label:!1,icon:!0})}}get commentBodyValue(){return typeof this.comment.body=="string"?this.comment.body:this.comment.body.value}async createCommentEditor(e){const t=ee(e,j(".edit-textarea"));this._commentEditor=this.instantiationService.createInstance(tw,t,tw.getEditorOptions(this.configurationService),this._contextKeyService,this.parentThread);const i=R.from({scheme:ae.commentsInput,path:`/commentinput-${this.comment.uniqueIdInThread}-${Date.now()}.md`}),n=await this.textModelService.createModelReference(i);if(this._commentEditorModel=n,this._commentEditor.setModel(this._commentEditorModel.object.textEditorModel),this._commentEditor.setValue(this.pendingEdit?.body??this.commentBodyValue),this.pendingEdit)this._commentEditor.setPosition(this.pendingEdit.cursor);else{const r=this._commentEditorModel.object.textEditorModel.getLineCount(),a=this._commentEditorModel.object.textEditorModel.getLineLength(r)+1;this._commentEditor.setPosition(new we(r,a))}this.pendingEdit=void 0,this._commentEditor.layout({width:t.clientWidth-14,height:this._editorHeight}),this._commentEditor.focus(),PE(Et(e),()=>{this._commentEditor.layout({width:t.clientWidth-14,height:this._editorHeight}),this._commentEditor.focus()});const o=this.commentThread;o.input={uri:this._commentEditor.getModel().uri,value:this.commentBodyValue},this.commentService.setActiveEditingCommentThread(o),this.commentService.setActiveCommentAndThread(this.owner,{thread:o,comment:this.comment}),this._commentEditorDisposables.push(this._commentEditor.onDidFocusEditorWidget(()=>{o.input={uri:this._commentEditor.getModel().uri,value:this.commentBodyValue},this.commentService.setActiveEditingCommentThread(o),this.commentService.setActiveCommentAndThread(this.owner,{thread:o,comment:this.comment})})),this._commentEditorDisposables.push(this._commentEditor.onDidChangeModelContent(r=>{if(o.input&&this._commentEditor&&this._commentEditor.getModel().uri===o.input.uri){const a=this._commentEditor.getValue();if(a!==o.input.value){const c=o.input;c.value=a,o.input=c,this.commentService.setActiveEditingCommentThread(o),this.commentService.setActiveCommentAndThread(this.owner,{thread:o,comment:this.comment})}}})),this.calculateEditorHeight(),this._register(this._commentEditorModel.object.textEditorModel.onDidChangeContent(()=>{this._commentEditor&&this.calculateEditorHeight()&&(this._commentEditor.layout({height:this._editorHeight,width:this._commentEditor.getLayoutInfo().width}),this._commentEditor.render(!0))})),this._register(this._commentEditor),this._register(this._commentEditorModel)}calculateEditorHeight(){if(this._commentEditor){const e=Cge(this.parentEditor,this._commentEditor,this._editorHeight);if(e!==this._editorHeight)return this._editorHeight=e,!0}return!1}getPendingEdit(){const e=this._commentEditor?.getModel();if(this._commentEditor&&e&&e.getValueLength()>0)return{body:e.getValue(),cursor:this._commentEditor.getPosition()}}removeCommentEditor(){this.isEditing=!1,this._editAction&&(this._editAction.enabled=!0),this._body.classList.remove("hidden"),this._commentEditorModel?.dispose(),Xe(this._commentEditorDisposables),this._commentEditorDisposables=[],this._commentEditor?.dispose(),this._commentEditor=null,this._commentEditContainer.remove()}layout(e){const t=e!==void 0?e-72:this._commentEditor?.getLayoutInfo().width??0;this._commentEditor?.layout({width:t,height:this._editorHeight});const i=this._body.scrollWidth,n=fye(this._body),o=this._body.scrollHeight,r=mye(this._body)+4;this._scrollableElement.setScrollDimensions({width:n,scrollWidth:i,height:r,scrollHeight:o})}async switchToEditMode(){if(this.isEditing)return;this.isEditing=!0,this._body.classList.add("hidden"),this._commentEditContainer=ee(this._commentDetailsContainer,j(".edit-container")),await this.createCommentEditor(this._commentEditContainer);const e=ee(this._commentEditContainer,j(".form-actions")),t=ee(e,j(".other-actions"));this.createCommentWidgetFormActions(t);const i=ee(e,j(".editor-actions"));this.createCommentWidgetEditorActions(i)}createCommentWidgetFormActions(e){const i=this.commentService.getCommentMenus(this.owner).getCommentActions(this.comment,this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentFormActions?.setActions(i)})),this._commentFormActions=new Lx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,n=>{const o=this._commentEditor.getValue();n.run({thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,text:o,$mid:Dn.CommentThreadNode}),this.removeCommentEditor()}),this._register(this._commentFormActions),this._commentFormActions.setActions(i)}createCommentWidgetEditorActions(e){const i=this.commentService.getCommentMenus(this.owner).getCommentEditorActions(this._contextKeyService);this._register(i),this._register(i.onDidChange(()=>{this._commentEditorActions?.setActions(i,!0)})),this._commentEditorActions=new Lx(this.keybindingService,this._contextKeyService,this.contextMenuService,e,n=>{const o=this._commentEditor.getValue();n.run({thread:this.commentThread,commentUniqueId:this.comment.uniqueIdInThread,text:o,$mid:Dn.CommentThreadNode}),this._commentEditor?.focus()}),this._register(this._commentEditorActions),this._commentEditorActions.setActions(i,!0)}setFocus(e,t=!1){e?(this._domNode.focus(),this._actionsToolbarContainer.classList.add("tabfocused"),this._domNode.tabIndex=0,this.comment.mode===oA.Editing&&this._commentEditor?.focus()):(this._actionsToolbarContainer.classList.contains("tabfocused")&&!this._actionsToolbarContainer.classList.contains("mouseover")&&(this._domNode.tabIndex=-1),this._actionsToolbarContainer.classList.remove("tabfocused"))}async update(e){e.body!==this.comment.body&&this.updateCommentBody(e.body),this.comment.userIconPath&&e.userIconPath&&R.from(this.comment.userIconPath).toString()!==R.from(e.userIconPath).toString()&&this.updateCommentUserIcon(e.userIconPath);const t=e.mode!==void 0&&e.mode!==this.comment.mode;this.comment=e,t&&(e.mode===oA.Editing?await this.switchToEditMode():this.removeCommentEditor()),e.label?this._isPendingLabel.innerText=e.label:this._isPendingLabel.innerText="",this.createReactionsContainer(this._commentDetailsContainer),this.comment.contextValue?this._commentContextValue.set(this.comment.contextValue):this._commentContextValue.reset(),this.comment.timestamp&&this.updateTimestamp(this.comment.timestamp)}onContextMenu(e){const t=new bs(Et(this._domNode),e);this.contextMenuService.showContextMenu({getAnchor:()=>t,menuId:N.CommentThreadCommentContext,menuActionOptions:{shouldForwardArgs:!0},contextKeyService:this._contextKeyService,actionRunner:this._actionRunner,getActionsContext:()=>this.commentNodeContext})}focus(){this.domNode.focus(),this._clearTimeout||(this.domNode.classList.add("focus"),this._clearTimeout=setTimeout(()=>{this.domNode.classList.remove("focus")},3e3))}dispose(){super.dispose(),Xe(this._commentEditorDisposables)}};I3=f([p(8,Z),p(9,gg),p(10,Dt),p(11,bi),p(12,fe),p(13,ne),p(14,Ti),p(15,He),p(16,Ci)],I3);function EVe(s,e,t,i=n=>n==="navigation"){for(const n of s){let[o,r]=n;if(i(o))(Array.isArray(e)?e:e.primary).unshift(...r);else{const a=Array.isArray(e)?e:e.secondary;a.length>0&&a.push(new os),a.push(...r)}}}let D3=class extends F{get length(){return this._commentThread.comments?this._commentThread.comments.length:0}get activeComment(){return this._commentElements.filter(e=>e.isEditing)[0]}constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(),this._parentEditor=e,this.owner=t,this.parentResourceUri=i,this.container=n,this._options=o,this._commentThread=r,this._pendingEdits=a,this._scopedInstatiationService=c,this._parentCommentThreadWidget=d,this.commentService=l,this.openerService=u,this.languageService=g,this._commentElements=[],this._focusedComment=void 0,this._onDidResize=new M,this.onDidResize=this._onDidResize.event,this._commentDisposable=new ti,this._register(re(n,pe.FOCUS_IN,m=>{this.commentService.setActiveEditingCommentThread(this._commentThread)})),this._markdownRenderer=new Ov(this._options,this.languageService,this.openerService)}focus(e){if(e!==void 0){const t=this._commentElements.find(i=>i.comment.uniqueIdInThread===e);if(t){t.focus();return}}this._commentsElement.focus()}hasCommentsInEditMode(){return this._commentElements.some(e=>e.isEditing)}ensureFocusIntoNewEditingComment(){this._commentElements.length===1&&this._commentElements[0].isEditing&&this._commentElements[0].setFocus(!0)}async display(){if(this._commentsElement=ee(this.container,j("div.comments-container")),this._commentsElement.setAttribute("role","presentation"),this._commentsElement.tabIndex=0,this._updateAriaLabel(),this._register(re(this._commentsElement,pe.KEY_DOWN,e=>{const t=new vo(e);if((t.equals(S.UpArrow)||t.equals(S.DownArrow))&&(!this._focusedComment||!this._commentElements[this._focusedComment].isEditing)){const i=n=>{if(this._focusedComment===void 0&&n>=0)return 0;if(this._focusedComment===void 0&&n<0)return this._commentElements.length-1;const o=this._focusedComment+n;return Math.min(Math.max(0,o),this._commentElements.length-1)};this._setFocusedComment(t.equals(S.UpArrow)?i(-1):i(1))}})),this._commentDisposable.clearAndDisposeAll(),this._commentElements=[],this._commentThread.comments)for(const e of this._commentThread.comments){const t=this.createNewCommentNode(e);this._commentElements.push(t),this._commentsElement.appendChild(t.domNode),e.mode===oA.Editing&&await t.switchToEditMode()}this._resizeObserver=new MutationObserver(this._refresh.bind(this)),this._resizeObserver.observe(this.container,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}_refresh(){const e=qu(this.container);this._onDidResize.fire(e)}getDimensions(){return qu(this.container)}layout(e){this._commentElements.forEach(t=>{t.layout(e)})}getPendingEdits(){const e={};return this._commentElements.forEach(t=>{if(t.isEditing){const i=t.getPendingEdit();i&&(e[t.comment.uniqueIdInThread]=i)}}),e}getCommentCoords(e){const t=this._commentElements.filter(i=>i.comment.uniqueIdInThread===e);if(t&&t.length){const i=Bs(this._commentElements[0].domNode),n=Bs(t[0].domNode);return{thread:i,comment:n}}}async updateCommentThread(e,t){const i=this._commentElements.length,n=e.comments?e.comments.length:0,o=[],r=[];for(let u=0;u<i;u++){const g=this._commentElements[u].comment,m=e.comments?e.comments.filter(v=>v.uniqueIdInThread===g.uniqueIdInThread):[];m.length?this._commentElements[u].update(m[0]):(r.push(u),o.push(this._commentElements[u]))}for(let u=o.length-1;u>=0;u--){const g=o[u];this._commentDisposable.deleteAndDispose(g),this._commentElements.splice(r[u],1),g.domNode.remove()}let a=null;const c=[],d=[],l=[];for(let u=n-1;u>=0;u--){const g=e.comments[u],m=this._commentElements.filter(v=>v.comment.uniqueIdInThread===g.uniqueIdInThread);if(m.length)a=m[0].domNode,c.unshift(m[0]);else{const v=this.createNewCommentNode(g);c.unshift(v),a?(this._commentsElement.insertBefore(v.domNode,a),a=v.domNode):(this._commentsElement.appendChild(v.domNode),a=v.domNode),g.mode===oA.Editing&&(l.push(v.switchToEditMode()),d.push(v))}}if(this._commentThread=e,this._commentElements=c,await Promise.all(l),d.length){const u=this._commentElements.indexOf(d[d.length-1]);this._focusedComment=u}this._updateAriaLabel(),t||this._setFocusedComment(this._focusedComment)}_updateAriaLabel(){this._commentThread.isDocumentCommentThread()?this._commentThread.range?this._commentsElement.ariaLabel=h(5280,"Comment thread with {0} comments on lines {1} through {2}. {3}.",this._commentThread.comments?.length,this._commentThread.range.startLineNumber,this._commentThread.range.endLineNumber,this._commentThread.label):this._commentsElement.ariaLabel=h(5281,"Comment thread with {0} comments on the entire document. {1}.",this._commentThread.comments?.length,this._commentThread.label):this._commentsElement.ariaLabel=h(5282,"Comment thread with {0} comments. {1}.",this._commentThread.comments?.length,this._commentThread.label)}_setFocusedComment(e){this._focusedComment!==void 0&&this._commentElements[this._focusedComment]?.setFocus(!1),this._commentElements.length===0||e===void 0?this._focusedComment=void 0:(this._focusedComment=Math.min(e,this._commentElements.length-1),this._commentElements[this._focusedComment].setFocus(!0))}createNewCommentNode(e){const t=this._scopedInstatiationService.createInstance(I3,this._parentEditor,this._commentThread,e,this._pendingEdits?this._pendingEdits[e.uniqueIdInThread]:void 0,this.owner,this.parentResourceUri,this._parentCommentThreadWidget,this._markdownRenderer),i=new U;return i.add(t.onDidClick(n=>this._setFocusedComment(this._commentElements.findIndex(o=>o.comment.uniqueIdInThread===n.comment.uniqueIdInThread)))),i.add(t),this._commentDisposable.set(t,i),t}dispose(){super.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this._commentDisposable.dispose()}};D3=f([p(9,gg),p(10,mi),p(11,vi)],D3);const xVe=Pe("review-comment-collapse",K.chevronUp,h(5283,"Icon to collapse a review comment.")),ote="expand-review-action "+ke.asClassName(xVe),IVe="expand-review-action "+ke.asClassName(K.trashcan);function dF(s){return!!s&&s.length>0}let k3=class extends F{constructor(e,t,i,n,o,r,a){super(),this._delegate=t,this._commentMenus=i,this._commentThread=n,this._contextKeyService=o,this._instantiationService=r,this._contextMenuService=a,this._headElement=j(".head"),e.appendChild(this._headElement),this._register(Ie(()=>this._headElement.remove())),this._fillHead()}_fillHead(){const e=ee(this._headElement,j(".review-title"));this._headingLabel=ee(e,j("span.filename")),this.createThreadLabel();const t=ee(this._headElement,j(".review-actions"));this._actionbarWidget=new Ar(t,{actionViewItemProvider:mw.bind(void 0,this._instantiationService)}),this._register(this._actionbarWidget);const i=dF(this._commentThread.comments)?ote:IVe;if(this._collapseAction=new Xt(Wc.Hide,h(5284,"Collapse"),i,!0,()=>this._delegate.collapse()),!dF(this._commentThread.comments)){const o=this._register(new Pt);o.value=this._commentThread.onDidChangeComments(()=>{dF(this._commentThread.comments)&&(this._collapseAction.class=ote,o.clear())})}const n=this._commentMenus.getCommentThreadTitleActions(this._contextKeyService);this._register(n),this.setActionBarActions(n),this._register(n),this._register(n.onDidChange(o=>{this.setActionBarActions(n)})),this._register(re(this._headElement,pe.CONTEXT_MENU,o=>this.onContextMenu(o))),this._actionbarWidget.context=this._commentThread}setActionBarActions(e){const t=e.getActions({shouldForwardArgs:!0}).reduce((i,[,n])=>[...i,...n],[]);this._actionbarWidget.clear(),this._actionbarWidget.push([...t,this._collapseAction],{label:!1,icon:!0})}updateCommentThread(e){this._commentThread=e,this._actionbarWidget.context=this._commentThread,this.createThreadLabel()}createThreadLabel(){let e;e=this._commentThread.label,e===void 0&&(this._commentThread.comments&&this._commentThread.comments.length||(e=h(5285,"Start discussion"))),e&&(this._headingLabel.textContent=jz(e),this._headingLabel.setAttribute("aria-label",e))}updateHeight(e){this._headElement.style.height=`${e}px`,this._headElement.style.lineHeight=this._headElement.style.height}onContextMenu(e){const t=this._commentMenus.getCommentThreadTitleContextActions(this._contextKeyService);if(!t.length)return;const i=new bs(Et(this._headElement),e);this._contextMenuActionRunner||(this._contextMenuActionRunner=this._register(new hg)),this._contextMenuService.showContextMenu({getAnchor:()=>i,getActions:()=>t,actionRunner:this._contextMenuActionRunner,getActionsContext:()=>({commentControlHandle:this._commentThread.controllerHandle,commentThreadHandle:this._commentThread.commentThreadHandle,$mid:Dn.CommentThread})})}};k3=f([p(4,fe),p(5,Z),p(6,bi)],k3);let T3=class extends F{constructor(e,t,i,n,o,r,a){super(),this._commentThread=t,this._contextKeyService=i,this._commentMenus=n,this._actionRunDelegate=o,this._keybindingService=r,this._contextMenuService=a,this._container=ee(e,j(".comment-additional-actions")),ee(this._container,j(".section-separator")),this._buttonBar=ee(this._container,j(".button-bar")),this._createAdditionalActions(this._buttonBar)}_showMenu(){this._container?.classList.remove("hidden")}_hideMenu(){this._container?.classList.add("hidden")}_enableDisableMenu(e){const t=e.getActions({shouldForwardArgs:!0});for(const i of t){const[,n]=i;for(const o of n){if(o.enabled){this._showMenu();return}for(const r of o.actions??[])if(r.enabled){this._showMenu();return}}}this._hideMenu()}_createAdditionalActions(e){const t=this._commentMenus.getCommentThreadAdditionalActions(this._contextKeyService);this._register(t),this._register(t.onDidChange(()=>{this._commentFormActions.setActions(t,!0),this._enableDisableMenu(t)})),this._commentFormActions=new Lx(this._keybindingService,this._contextKeyService,this._contextMenuService,e,async i=>{this._actionRunDelegate?.(),i.run({thread:this._commentThread,$mid:Dn.CommentThreadInstance})},4,!0),this._register(this._commentFormActions),this._commentFormActions.setActions(t,!0),this._enableDisableMenu(t)}};T3=f([p(5,He),p(6,bi)],T3);var yT;function DVe(s,e,t){const i=new Set;return Wo(...s.map((n,o)=>Wo(n.onDidFocus(()=>{t?.(o,"focus"),i.size||e(!0),i.add(o)}),n.onDidBlur(()=>{t?.(o,"blur"),i.delete(o),i.size||e(!1)}))))}const y5=new O("navigableContainerFocused",!1);let Cv=class{static{yT=this}static{this.ID="workbench.contrib.navigableContainerManager"}constructor(e,t,i){this.logService=t,this.configurationService=i,this.containers=new Set,this.focused=y5.bindTo(e),yT.INSTANCE=this}dispose(){this.containers.clear(),this.focused.reset(),yT.INSTANCE=void 0}get debugEnabled(){return this.configurationService.getValue("workbench.navigibleContainer.enableDebug")}log(e,...t){this.debugEnabled&&this.logService.debug(e,...t)}static register(e){const t=this.INSTANCE;return t?(t.containers.add(e),t.log("NavigableContainerManager.register",e.name),Wo(DVe(e.focusNotifiers,i=>{i?(t.log("NavigableContainerManager.focus",e.name),t.focused.set(!0),t.lastContainer=e):(t.log("NavigableContainerManager.blur",e.name,t.lastContainer?.name),t.lastContainer===e&&(t.focused.set(!1),t.lastContainer=void 0))},(i,n)=>{t.log("NavigableContainerManager.partFocusChange",e.name,i,n)}),Ie(()=>{t.containers.delete(e),t.log("NavigableContainerManager.unregister",e.name,t.lastContainer?.name),t.lastContainer===e&&(t.focused.set(!1),t.lastContainer=void 0)}))):F.None}static getActive(){return this.INSTANCE?.lastContainer}};Cv=yT=f([p(0,fe),p(1,Re),p(2,ne)],Cv);function Ege(s){return Cv.register(s)}rc(Cv.ID,Cv,ac.BlockStartup);Me.registerCommandAndKeybindingRule({id:"widgetNavigation.focusPrevious",weight:W.WorkbenchContrib,when:x.and(y5,x.or(of?.negate(),vye)),primary:E.CtrlCmd|S.UpArrow,handler:()=>{Cv.getActive()?.focusPreviousWidget()}});Me.registerCommandAndKeybindingRule({id:"widgetNavigation.focusNext",weight:W.WorkbenchContrib,when:x.and(y5,x.or(of?.negate(),_ye)),primary:E.CtrlCmd|S.DownArrow,handler:()=>{Cv.getActive()?.focusNextWidget()}});Ve(jue);let A3=class extends F{get commentThread(){return this._commentThread}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_){super(),this.container=e,this._parentEditor=t,this._owner=i,this._parentResourceUri=n,this._contextKeyService=o,this._scopedInstantiationService=r,this._commentThread=a,this._pendingComment=c,this._pendingEdits=d,this._markdownOptions=l,this._commentOptions=u,this._containerDelegate=g,this.commentService=m,this.configurationService=v,this._keybindingService=_,this._commentThreadDisposables=[],this._onDidResize=new M,this.onDidResize=this._onDidResize.event,this._threadIsEmpty=Ja.commentThreadIsEmpty.bindTo(this._contextKeyService),this._threadIsEmpty.set(!a.comments||!a.comments.length),this._focusedContextKey=Ja.commentFocused.bindTo(this._contextKeyService),this._commentMenus=this.commentService.getCommentMenus(this._owner),this._register(this._header=this._scopedInstantiationService.createInstance(k3,e,{collapse:this._containerDelegate.collapse.bind(this)},this._commentMenus,this._commentThread)),this._header.updateCommentThread(this._commentThread);const w=j(".body");e.appendChild(w),this._register(Ie(()=>w.remove()));const C=this._register(Fo(w));this._register(Ege({name:"commentThreadWidget",focusNotifiers:[C],focusNextWidget:()=>{this._commentReply?.isCommentEditorFocused()||this._commentReply?.expandReplyAreaAndFocusCommentEditor()},focusPreviousWidget:()=>{this._commentReply?.isCommentEditorFocused()&&this._commentThread.comments?.length&&this._body.focus()}})),this._register(C.onDidFocus(()=>this._focusedContextKey.set(!0))),this._register(C.onDidBlur(()=>this._focusedContextKey.reset())),this._register(this.configurationService.onDidChangeConfiguration(A=>{A.affectsConfiguration(zn.Comments)&&this._setAriaLabel()})),this._body=this._scopedInstantiationService.createInstance(D3,this._parentEditor,this._owner,this._parentResourceUri,w,this._markdownOptions,this._commentThread,this._pendingEdits,this._scopedInstantiationService,this),this._register(this._body),this._setAriaLabel(),this._styleElement=iN(this.container),this._commentThreadContextValue=Ja.commentThreadContext.bindTo(this._contextKeyService),this._commentThreadContextValue.set(a.contextValue);const k=Ja.commentControllerContext.bindTo(this._contextKeyService),D=this.commentService.getCommentController(this._owner);D?.contextValue&&k.set(D.contextValue),this.currentThreadListeners()}get hasUnsubmittedComments(){return!!this._commentReply?.commentEditor.getValue()||this._body.hasCommentsInEditMode()}_setAriaLabel(){let e=h(5286,"Comment"),t;const i=this.configurationService.getValue(zn.Comments);i&&(t=this._keybindingService.lookupKeybinding(Bo.OpenAccessibilityHelp,this._contextKeyService)?.getLabel()??void 0),t?e=h(5287,"{0}, use ({1}) for accessibility help",e,t):i&&(e=h(5288,"{0}, run the command Open Accessibility Help which is currently not triggerable via keybinding.",e)),this._body.container.ariaLabel=e}updateCurrentThread(e,t){e||t?this.commentService.setCurrentCommentThread(this.commentThread):this.commentService.setCurrentCommentThread(void 0)}currentThreadListeners(){let e=!1,t=!1;this._register(re(this.container,pe.MOUSE_ENTER,i=>{i.toElement===this.container&&(e=!0,this.updateCurrentThread(e,t))},!0)),this._register(re(this.container,pe.MOUSE_LEAVE,i=>{i.fromElement===this.container&&(e=!1,this.updateCurrentThread(e,t))},!0)),this._register(re(this.container,pe.FOCUS_IN,()=>{t=!0,this.updateCurrentThread(e,t)},!0)),this._register(re(this.container,pe.FOCUS_OUT,()=>{t=!1,this.updateCurrentThread(e,t)},!0))}async updateCommentThread(e){const t=this._commentThread.collapsibleState===cr.Expanded&&this._commentThreadState===dd.Unresolved&&e.state===dd.Resolved;this._commentThreadState=e.state,this._commentThread=e,Xe(this._commentThreadDisposables),this._commentThreadDisposables=[],this._bindCommentThreadListeners(),await this._body.updateCommentThread(e,this._commentReply?.isCommentEditorFocused()??!1),this._threadIsEmpty.set(!this._body.length),this._header.updateCommentThread(e),this._commentReply?.updateCommentThread(e),this._commentThread.contextValue?this._commentThreadContextValue.set(this._commentThread.contextValue):this._commentThreadContextValue.reset(),t&&this.configurationService.getValue(_0).collapseOnResolve&&this.collapse()}async display(e,t){const i=Math.max(23,Math.ceil(e*1.2));this._header.updateHeight(i),await this._body.display(),this._commentThread.canReply&&this._createCommentForm(t),this._createAdditionalActions(),this._register(this._body.onDidResize(n=>{this._refresh(n)})),this._commentThread.canReply&&this._commentReply&&this._commentReply.focusIfNeeded(),this._bindCommentThreadListeners()}_refresh(e){this._body.layout(),this._onDidResize.fire(e)}dispose(){super.dispose(),Xe(this._commentThreadDisposables),this.updateCurrentThread(!1,!1)}_bindCommentThreadListeners(){this._commentThreadDisposables.push(this._commentThread.onDidChangeCanReply(()=>{this._commentReply?this._commentReply.updateCanReply():this._commentThread.canReply&&this._createCommentForm(!1)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async e=>{await this.updateCommentThread(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeLabel(e=>{this._header.createThreadLabel()}))}_createCommentForm(e){this._commentReply=this._scopedInstantiationService.createInstance(x3,this._owner,this._body.container,this._parentEditor,this._commentThread,this._scopedInstantiationService,this._contextKeyService,this._commentMenus,this._commentOptions,this._pendingComment,this,e,this._containerDelegate.actionRunner),this._register(this._commentReply)}_createAdditionalActions(){this._additionalActions=this._scopedInstantiationService.createInstance(T3,this._body.container,this._commentThread,this._contextKeyService,this._commentMenus,this._containerDelegate.actionRunner),this._register(this._additionalActions)}getCommentCoords(e){return this._body.getCommentCoords(e)}getPendingEdits(){return this._body.getPendingEdits()}getPendingComment(){if(this._commentReply)return this._commentReply.getPendingComment()}setPendingComment(e){this._pendingComment=e,this._commentReply?.setPendingComment(e)}getDimensions(){return this._body.getDimensions()}layout(e){this._body.layout(e),e!==void 0&&this._commentReply?.layout(e)}ensureFocusIntoNewEditingComment(){this._body.ensureFocusIntoNewEditingComment()}focusCommentEditor(){this._commentReply?.expandReplyAreaAndFocusCommentEditor()}focus(e){this._body.focus(e)}async submitComment(){const e=this._body.activeComment;if(e)return e.submitComment();if((this._commentReply?.getPendingComment()?.body.length??0)>0)return this._commentReply?.submitComment()}async collapse(){await this._containerDelegate.collapse()&&P.isIRange(this.commentThread.range)&&mo(this._parentEditor)&&this._parentEditor.setSelection(this.commentThread.range)}applyTheme(e,t){const i=[];i.push(`.monaco-editor .review-widget > .body { border-top: 1px solid var(${$ue}) }`),i.push(`.monaco-editor .review-widget > .head { background-color: var(${Gue}) }`);const n=e.getColor(Wie);n&&i.push(`.review-widget .body .comment-body a { color: ${n} }`);const o=e.getColor(bye);o&&i.push(`.review-widget .body .comment-body a:hover, a:active { color: ${o} }`);const r=e.getColor(PT);r&&(i.push(`.review-widget .body .comment-body a:focus { outline: 1px solid ${r}; }`),i.push(`.review-widget .body .monaco-editor.focused { outline: 1px solid ${r}; }`));const a=e.getColor(yye);a&&i.push(`.review-widget .body .review-comment blockquote { background: ${a}; }`);const c=e.getColor(wye);c&&i.push(`.review-widget .body .review-comment blockquote { border-color: ${c}; }`);const d=e.getColor(zE);d&&i.push(`.review-widget .body .review-comment .review-comment-contents .comment-reactions .action-item a.action-label { border-color: ${d}; }`);const l=e.getColor(tt);l&&(i.push(`.review-widget .body .comment-form .review-thread-reply-button { outline-color: ${l}; }`),i.push(`.review-widget .body .monaco-editor { outline: 1px solid ${l}; }`));const u=e.getColor(Sye);u&&i.push(`.review-widget .validation-error { border: 1px solid ${u}; }`);const g=e.getColor(Cye);g&&i.push(`.review-widget .validation-error { background: ${g}; }`);const m=e.getColor(Eye);m&&i.push(`.review-widget .body .comment-form .validation-error { color: ${m}; }`);const v="--comment-thread-editor-font-family",_="--comment-thread-editor-font-size",w="--comment-thread-editor-font-weight";this.container?.style.setProperty(v,t.fontFamily),this.container?.style.setProperty(_,`${t.fontSize}px`),this.container?.style.setProperty(w,t.fontWeight),i.push(`.review-widget .body code {
			font-family: var(${v});
			font-weight: var(${w});
		}`),this._styleElement.textContent=i.join(`
`),this._commentReply?.setCommentEditorDecorations()}};A3=f([p(12,gg),p(13,ne),p(14,He)],A3);function rte(s,e){return wWe(s,e)??e.getColor(fae)}var el;(function(s){s[s.None=0]="None",s[s.Widget=1]="Widget",s[s.Editor=2]="Editor"})(el||(el={}));function kVe(s){const e=s.target.range;if(!e||!s.event.leftButton||s.target.type!==xi.GUTTER_LINE_DECORATIONS)return null;const t=s.target.detail;return t.offsetX-t.glyphMarginWidth-t.lineNumbersWidth-t.glyphMarginLeft>20?null:{lineNumber:e.startLineNumber}}function TVe(s,e){if(!s)return null;const{lineNumber:t}=s;return e.target.range?t:null}let R3=class extends hae{get uniqueOwner(){return this._uniqueOwner}get commentThread(){return this._commentThread}get expanded(){return this._isExpanded}constructor(e,t,i,n,o,r,a,c,d,l,u){super(e,{keepEditorSelection:!0,isAccessible:!0,showArrow:!!i.range}),this._uniqueOwner=t,this._commentThread=i,this._pendingComment=n,this._pendingEdits=o,this.themeService=a,this.commentService=c,this.configurationService=l,this.dialogService=u,this._onDidClose=new M,this._onDidCreateThread=new M,this._globalToDispose=new U,this._commentThreadDisposables=[],this._contextKeyService=d.createScoped(this.domNode),this._scopedInstantiationService=this._globalToDispose.add(r.createChild(new uf([fe,this._contextKeyService])));const g=this.commentService.getCommentController(this._uniqueOwner);g&&(this._commentOptions=g.options),this._initialCollapsibleState=n?cr.Expanded:i.initialCollapsibleState,i.initialCollapsibleState=this._initialCollapsibleState,this._commentThreadDisposables=[],this.create(),this._globalToDispose.add(this.themeService.onDidColorThemeChange(this._applyTheme,this)),this._globalToDispose.add(this.editor.onDidChangeConfiguration(m=>{m.hasChanged(L.fontInfo)&&this._applyTheme(this.themeService.getColorTheme())})),this._applyTheme(this.themeService.getColorTheme())}get onDidClose(){return this._onDidClose.event}get onDidCreateThread(){return this._onDidCreateThread.event}getPosition(){if(this.position)return this.position;if(this._commentGlyph)return this._commentGlyph.getPosition().position??void 0}revealRange(){}reveal(e,t=el.None){this.makeVisible(e,t);const i=this._commentThread.comments?.find(n=>n.uniqueIdInThread===e)??this._commentThread.comments?.[0];this.commentService.setActiveCommentAndThread(this.uniqueOwner,{thread:this._commentThread,comment:i})}_expandAndShowZoneWidget(){this._isExpanded||this.show(this.arrowPosition(this._commentThread.range),2)}_setFocus(e,t){t===el.Widget?this._commentThreadWidget.focus(e):t===el.Editor&&this._commentThreadWidget.focusCommentEditor()}_goToComment(e,t){const i=this.editor.getLayoutInfo().height,n=this._commentThreadWidget.getCommentCoords(e);if(n){let o=1;if(this._commentThread.range){const r=n.thread,a=n.comment;o=this.editor.getTopForLineNumber(this._commentThread.range.startLineNumber)-i/2+a.top-r.top}this.editor.setScrollTop(o),this._setFocus(e,t)}else this._goToThread(t)}_goToThread(e){const t=this._commentThread.range?new P(this._commentThread.range.startLineNumber,this._commentThread.range.startColumn,this._commentThread.range.endLineNumber+1,1):new P(1,1,1,1);this.editor.revealRangeInCenter(t),this._setFocus(void 0,e)}makeVisible(e,t=el.None){this._expandAndShowZoneWidget(),e!==void 0?this._goToComment(e,t):this._goToThread(t)}getPendingComments(){return{newComment:this._commentThreadWidget.getPendingComment(),edits:this._commentThreadWidget.getPendingEdits()}}setPendingComment(e){this._pendingComment=e,this.expand(),this._commentThreadWidget.setPendingComment(e)}_fillContainer(e){this.setCssClass("review-widget"),this._commentThreadWidget=this._scopedInstantiationService.createInstance(A3,e,this.editor,this._uniqueOwner,this.editor.getModel().uri,this._contextKeyService,this._scopedInstantiationService,this._commentThread,this._pendingComment,this._pendingEdits,{editor:this.editor,codeBlockFontSize:"",codeBlockFontFamily:this.configurationService.getValue("editor").fontFamily||BM.fontFamily},this._commentOptions,{actionRunner:async()=>{if(!this._commentThread.comments||!this._commentThread.comments.length){const t=this.getPosition();if(t){const i=this._commentThread.range;if(!i)return;let n;if(t.lineNumber!==i.endLineNumber){const o=t.lineNumber-i.endLineNumber;n=new P(i.startLineNumber+o,i.startColumn,i.endLineNumber+o,i.endColumn)}else n=new P(i.startLineNumber,i.startColumn,i.endLineNumber,i.endColumn);await this.commentService.updateCommentThreadTemplate(this.uniqueOwner,this._commentThread.commentThreadHandle,n)}}},collapse:()=>this.collapse(!0)}),this._disposables.add(this._commentThreadWidget)}arrowPosition(e){if(e)return{lineNumber:e.endLineNumber,column:e.endLineNumber===e.startLineNumber?(e.startColumn+e.endColumn+1)/2:1}}deleteCommentThread(){this.dispose(),this.commentService.disposeCommentThread(this.uniqueOwner,this._commentThread.threadId)}doCollapse(){this._commentThread.collapsibleState=cr.Collapsed}async collapse(e=!1){return!e||await this.confirmCollapse()?(this.doCollapse(),!0):!1}async confirmCollapse(){if(this.configurationService.getValue("comments.thread.confirmOnCollapse")==="whenHasUnsubmittedComments"&&this._commentThreadWidget.hasUnsubmittedComments){const t=await this.dialogService.confirm({message:h(5289,"Collapsing this comment thread will discard unsubmitted comments. Are you sure you want to discard these comments?"),primaryButton:h(5290,"Discard"),type:Fe.Warning,checkbox:{label:h(5291,"Never ask me again"),checked:!1}});return t.checkboxChecked&&await this.configurationService.updateValue("comments.thread.confirmOnCollapse","never"),t.confirmed}return!0}expand(e){this._commentThread.collapsibleState=cr.Expanded,e&&this.commentService.setActiveCommentAndThread(this.uniqueOwner,{thread:this._commentThread})}getGlyphPosition(){return this._commentGlyph?this._commentGlyph.getPosition().position.lineNumber:0}async update(e){this._commentThread!==e&&(this._commentThreadDisposables.forEach(n=>n.dispose()),this._commentThread=e,this._commentThreadDisposables=[],this.bindCommentThreadListeners()),await this._commentThreadWidget.updateCommentThread(e);const t=this._commentThread.range?.endLineNumber??1;let i=!1;this._commentGlyph&&(this._commentGlyph.setThreadState(e.state),this._commentGlyph.getPosition().position.lineNumber!==t&&(i=!0,this._commentGlyph.setLineNumber(t))),i&&this._isExpanded||this._commentThread.collapsibleState===cr.Expanded&&!this._isExpanded?this.show(this.arrowPosition(this._commentThread.range),2):this._commentThread.collapsibleState!==cr.Expanded&&this.hide()}_onWidth(e){this._commentThreadWidget.layout(e)}_doLayout(e,t){this._commentThreadWidget.layout(t)}async display(e,t){e&&(this._commentGlyph=new yD(this.editor,e?.endLineNumber??-1),this._commentGlyph.setThreadState(this._commentThread.state),this._globalToDispose.add(this._commentGlyph.onDidChangeLineNumber(async i=>{if(!this._commentThread.range)return;const n=i-this._commentThread.range.endLineNumber,o=new P(this._commentThread.range.startLineNumber+n,this._commentThread.range.startColumn,this._commentThread.range.endLineNumber+n,this._commentThread.range.endColumn);this._commentThread.range=o}))),await this._commentThreadWidget.display(this.editor.getOption(L.lineHeight),t),this._disposables.add(this._commentThreadWidget.onDidResize(i=>{this._refresh(i)})),this._commentThread.collapsibleState===cr.Expanded&&this.show(this.arrowPosition(e),2),t&&this.makeVisible(),this.bindCommentThreadListeners()}bindCommentThreadListeners(){if(this._commentThreadDisposables.push(this._commentThread.onDidChangeComments(async e=>{await this.update(this._commentThread)})),this._commentThreadDisposables.push(this._commentThread.onDidChangeCollapsibleState(e=>{if(e===cr.Expanded&&!this._isExpanded){this.show(this.arrowPosition(this._commentThread.range),2),this._commentThreadWidget.ensureFocusIntoNewEditingComment();return}if(e===cr.Collapsed&&this._isExpanded){this.hide();return}})),this._initialCollapsibleState===void 0){const e=this._commentThread.onDidChangeInitialCollapsibleState(t=>{this._initialCollapsibleState=t,this._commentThread.collapsibleState=this._initialCollapsibleState,e.dispose()});this._commentThreadDisposables.push(e)}this._commentThreadDisposables.push(this._commentThread.onDidChangeState(()=>{const e=rte(this._commentThread.state,this.themeService.getColorTheme())||ye.transparent;this.style({frameColor:e,arrowColor:e}),this.container?.style.setProperty($ue,`${e}`),this.container?.style.setProperty(Gue,`${e.transparent(.1)}`)}))}async submitComment(){return this._commentThreadWidget.submitComment()}_refresh(e){if(this._isExpanded===void 0&&e.height===0&&e.width===0){this.commentThread.collapsibleState=cr.Collapsed;return}if(this._isExpanded){this._commentThreadWidget.layout();const t=Math.ceil(this.editor.getOption(L.lineHeight)*1.2),i=this.editor.getOption(L.lineHeight),n=Math.round(i/3),o=Math.round(i/9)*2,r=Math.ceil((t+e.height+n+o+8)/i);if(this._viewZone?.heightInLines===r)return;const a=this.getPosition();this._viewZone&&a&&a.lineNumber!==this._viewZone.afterLineNumber&&this._viewZone.afterLineNumber!==0&&(this._viewZone.afterLineNumber=a.lineNumber);const c=py.capture(this.editor);this._relayout(r),c.restore(this.editor)}}_applyTheme(e){const t=rte(this._commentThread.state,this.themeService.getColorTheme())||ye.transparent;this.style({arrowColor:t,frameColor:t});const i=this.editor.getOption(L.fontInfo);this._commentThreadWidget.applyTheme(e,i)}show(e,t){const i=this._commentGlyph?.getPosition();let n=P.isIRange(e)?e:e?P.fromPositions(e):void 0;if(i?.position&&n&&i.position.lineNumber!==n.endLineNumber){const o=i.position.lineNumber-n.endLineNumber;n=new P(n.startLineNumber+o,n.startColumn,n.endLineNumber+o,n.endColumn)}this._isExpanded=!0,super.show(n??new P(0,0,0,0),t),this._commentThread.collapsibleState=cr.Expanded,this._refresh(this._commentThreadWidget.getDimensions())}async collapseAndFocusRange(){await this.collapse(!0)&&P.isIRange(this.commentThread.range)&&mo(this.editor)&&this.editor.setSelection(this.commentThread.range)}hide(){this._isExpanded&&(this._isExpanded=!1,this.editor.hasWidgetFocus()&&this.editor.focus(),(!this._commentThread.comments||!this._commentThread.comments.length)&&this.deleteCommentThread()),super.hide()}dispose(){super.dispose(),this._commentGlyph&&(this._commentGlyph.dispose(),this._commentGlyph=void 0),this._globalToDispose.dispose(),this._commentThreadDisposables.forEach(e=>e.dispose()),this._onDidClose.fire(void 0)}};R3=f([p(5,Z),p(6,pt),p(7,gg),p(8,fe),p(9,ne),p(10,ei)],R3);class ate{get id(){return this._decorationId}set id(e){this._decorationId=e}constructor(e,t){this.range=e,this.options=t}}class RL extends F{static{this.description="comment-thread-range-decorator"}constructor(e){super(),this.decorationIds=[],this.activeDecorationIds=[],this.threadCollapseStateListeners=[];const t={description:RL.description,isWholeLine:!1,zIndex:20,className:"comment-thread-range",shouldFillLineOnLineBreak:!0};this.decorationOptions=Zt.createDynamic(t);const i={description:RL.description,isWholeLine:!1,zIndex:20,className:"comment-thread-range-current",shouldFillLineOnLineBreak:!0};this.activeDecorationOptions=Zt.createDynamic(i),this._register(e.onDidChangeCurrentCommentThread(n=>{this.updateCurrent(n)})),this._register(e.onDidUpdateCommentThreads(()=>{this.updateCurrent(void 0)}))}updateCurrent(e){if(!this.editor||e?.resource&&e.resource?.toString()!==this.editor.getModel()?.uri.toString())return;this.currentThreadCollapseStateListener?.dispose();const t=[];if(e){const i=e.range;i&&!(i.startLineNumber===i.endLineNumber&&i.startColumn===i.endColumn)&&e.collapsibleState===cr.Expanded&&(this.currentThreadCollapseStateListener=e.onDidChangeCollapsibleState(n=>{n===cr.Collapsed&&this.updateCurrent(void 0)}),t.push(new ate(i,this.activeDecorationOptions)))}this.editor.changeDecorations(i=>{this.activeDecorationIds=i.deltaDecorations(this.activeDecorationIds,t),t.forEach((n,o)=>n.id=this.decorationIds[o])})}update(e,t){const i=e?.getModel();if(!e||!i)return;Xe(this.threadCollapseStateListeners),this.editor=e;const n=[];for(const o of t)o.threads.forEach(r=>{if(r.isDisposed)return;const a=r.range;!a||a.startLineNumber===a.endLineNumber&&a.startColumn===a.endColumn||(this.threadCollapseStateListeners.push(r.onDidChangeCollapsibleState(()=>{this.update(e,t)})),r.collapsibleState!==cr.Collapsed&&n.push(new ate(a,this.decorationOptions)))});e.changeDecorations(o=>{this.decorationIds=o.deltaDecorations(this.decorationIds,n),n.forEach((r,a)=>r.id=this.decorationIds[a])})}dispose(){Xe(this.threadCollapseStateListeners),this.currentThreadCollapseStateListener?.dispose(),super.dispose()}}Ve(jue);const AVe="editor.contrib.review";class Mg{get id(){return this._decorationId}set id(e){this._decorationId=e}get range(){return{startLineNumber:this._startLineNumber,startColumn:1,endLineNumber:this._endLineNumber,endColumn:1}}constructor(e,t,i,n,o,r,a,c=!1){this._editor=e,this._ownerId=t,this._extensionId=i,this._label=n,this._range=o,this.options=r,this.commentingRangesInfo=a,this.isHover=c,this._startLineNumber=o.startLineNumber,this._endLineNumber=o.endLineNumber}getCommentAction(){return{extensionId:this._extensionId,label:this._label,ownerId:this._ownerId,commentingRangesInfo:this.commentingRangesInfo}}getOriginalRange(){return this._range}getActiveRange(){return this.id?this._editor.getModel().getDecorationRange(this.id):void 0}}class Jb{static{this.description="commenting-range-decorator"}constructor(){this.commentingRangeDecorations=[],this.decorationIds=[],this._lastHover=-1,this._onDidChangeDecorationsCount=new M,this.onDidChangeDecorationsCount=this._onDidChangeDecorationsCount.event;const e={description:Jb.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph comment-diff-added"};this.decorationOptions=Zt.createDynamic(e);const t={description:Jb.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph line-hover"};this.hoverDecorationOptions=Zt.createDynamic(t);const i={description:Jb.description,isWholeLine:!0,linesDecorationsClassName:"comment-range-glyph multiline-add"};this.multilineDecorationOptions=Zt.createDynamic(i)}updateHover(e){this._editor&&this._infos&&e!==this._lastHover&&this._doUpdate(this._editor,this._infos,e),this._lastHover=e??-1}updateSelection(e,t=new P(0,0,0,0)){this._lastSelection=t.isEmpty()?void 0:t,this._lastSelectionCursor=t.isEmpty()?void 0:e,this._editor&&this._infos&&this._doUpdate(this._editor,this._infos,e,t)}update(e,t,i,n){e&&(this._editor=e,this._infos=t,this._doUpdate(e,t,i,n))}_lineHasThread(e,t){return e.getDecorationsInRange(t)?.find(i=>i.options.description===yD.description)}_doUpdate(e,t,i=-1,n=this._lastSelection){if(!e.getModel())return;i=this._lastSelectionCursor??i;const r=[];for(const c of t)c.commentingRanges.ranges.forEach(d=>{const l=new P(d.startLineNumber,d.startColumn,d.endLineNumber,d.endColumn);let u=n?l.intersectRanges(n):void 0;if(n&&i>=0&&u&&!(u.startLineNumber===u.endLineNumber&&i===u.startLineNumber)){let g;i<=u.startLineNumber?(g=u.collapseToStart(),u=new P(u.startLineNumber+1,1,u.endLineNumber,1)):(g=new P(u.endLineNumber,1,u.endLineNumber,1),u=new P(u.startLineNumber,1,u.endLineNumber-1,1)),r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,u,this.multilineDecorationOptions,c.commentingRanges,!0)),this._lineHasThread(e,g)||r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,g,this.hoverDecorationOptions,c.commentingRanges,!0));const m=Math.min(g.startLineNumber,u.startLineNumber)-1,v=l.startLineNumber<=m,_=Math.max(g.endLineNumber,u.endLineNumber)+1,w=l.endLineNumber>=_;if(v){const C=new P(d.startLineNumber,1,m,1);r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,C,this.decorationOptions,c.commentingRanges,!0))}if(w){const C=new P(_,1,d.endLineNumber,1);r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,C,this.decorationOptions,c.commentingRanges,!0))}}else if(l.startLineNumber<=i&&i<=l.endLineNumber){if(l.startLineNumber<i){const m=new P(d.startLineNumber,1,i-1,1);r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,m,this.decorationOptions,c.commentingRanges,!0))}const g=new P(i,1,i,1);if(this._lineHasThread(e,g)||r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,g,this.hoverDecorationOptions,c.commentingRanges,!0)),i<l.endLineNumber){const m=new P(i+1,1,d.endLineNumber,1);r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,m,this.decorationOptions,c.commentingRanges,!0))}}else r.push(new Mg(e,c.uniqueOwner,c.extensionId,c.label,d,this.decorationOptions,c.commentingRanges))});e.changeDecorations(c=>{this.decorationIds=c.deltaDecorations(this.decorationIds,r),r.forEach((d,l)=>d.id=this.decorationIds[l])});const a=this.commentingRangeDecorations.length-r.length;this.commentingRangeDecorations=r,a&&this._onDidChangeDecorationsCount.fire(this.commentingRangeDecorations.length)}areRangesIntersectingOrTouchingByLine(e,t){return!(e.endLineNumber<t.startLineNumber-1||t.endLineNumber+1<e.startLineNumber)}getMatchedCommentAction(e){if(e===void 0){const n=this._infos?.filter(o=>o.commentingRanges.fileComments);return n?n.map(o=>({action:{ownerId:o.uniqueOwner,extensionId:o.extensionId,label:o.label,commentingRangesInfo:o.commentingRanges}})):[]}const t=new Map;for(const n of this.commentingRangeDecorations){const o=n.getActiveRange();if(o&&this.areRangesIntersectingOrTouchingByLine(o,e)){const r=n.getCommentAction(),a=t.get(r.ownerId);if(a?.action.commentingRangesInfo===r.commentingRangesInfo){const c=new P(o.startLineNumber<a.range.startLineNumber?o.startLineNumber:a.range.startLineNumber,o.startColumn<a.range.startColumn?o.startColumn:a.range.startColumn,o.endLineNumber>a.range.endLineNumber?o.endLineNumber:a.range.endLineNumber,o.endColumn>a.range.endColumn?o.endColumn:a.range.endColumn);t.set(r.ownerId,{range:c,action:r})}else t.set(r.ownerId,{range:o,action:r})}}const i=new Set;return Array.from(t.values()).filter(n=>i.has(n.action.ownerId)?!1:(i.add(n.action.ownerId),!0))}getNearestCommentingRange(e,t){let i,n;if(t){n=[];for(let o=this.commentingRangeDecorations.length-1;o>=0;o--)n.push(this.commentingRangeDecorations[o])}else n=this.commentingRangeDecorations;for(const o of n){const r=o.getActiveRange();if(r){if(i&&this.areRangesIntersectingOrTouchingByLine(r,i)){i=P.plusRange(i,r);continue}if(r.startLineNumber<=e.lineNumber&&e.lineNumber<=r.endLineNumber){i=new P(r.startLineNumber,r.startColumn,r.endLineNumber,r.endColumn);continue}if(!(!t&&r.endLineNumber<e.lineNumber)&&!(t&&r.startLineNumber>e.lineNumber))return r}}return n.length>0?n[0].getActiveRange()??void 0:void 0}dispose(){this.commentingRangeDecorations=[]}}function xge(s,e,t,i,n,o,r,a,c){if(!i.resource)return;s.isCommentingEnabled||s.enableCommenting(!0);const d=i.range,l=o?el.Editor:a?el.None:el.Widget,u=e.activeTextEditorControl,g=Zu(u)?[u.getOriginalEditor(),u.getModifiedEditor()]:u?[u]:[],m=i.threadId,v=n?.uniqueIdInThread,_=R.parse(i.resource);for(const w of g){const C=w.getModel();if(C instanceof ry&&t.extUri.isEqual(_,C.uri)){m&&mo(w)&&PL.get(w)?.revealCommentThread(m,v,!0,l);return}}e.openEditor({resource:_,options:{pinned:r,preserveFocus:a,selection:d??new P(1,1,1,1)}},c?Rr:ol).then(w=>{if(w){const C=w.getControl();m&&mo(C)&&PL.get(C)?.revealCommentThread(m,v,!0,l)}})}let PL=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){this.commentService=t,this.instantiationService=i,this.codeEditorService=n,this.contextMenuService=o,this.quickInputService=r,this.viewsService=a,this.configurationService=c,this.editorService=l,this.keybindingService=u,this.accessibilityService=g,this.notificationService=m,this.globalToDispose=new U,this.localToDispose=new U,this.mouseDownInfo=null,this._commentingRangeSpaceReserved=!1,this._commentingRangeAmountReserved=0,this._emptyThreadsToAddQueue=[],this._inProcessContinueOnComments=new Map,this._editorDisposables=[],this._hasRespondedToEditorChange=!1,this._commentInfos=[],this._commentWidgets=[],this._pendingNewCommentCache={},this._pendingEditsCache={},this._computePromise=null,this._activeCursorHasCommentingRange=Ja.activeCursorHasCommentingRange.bindTo(d),this._activeCursorHasComment=Ja.activeCursorHasComment.bindTo(d),this._activeEditorHasCommentingRange=Ja.activeEditorHasCommentingRange.bindTo(d),!(e instanceof pd)&&(this.editor=e,this._commentingRangeDecorator=new Jb,this.globalToDispose.add(this._commentingRangeDecorator.onDidChangeDecorationsCount(v=>{v===0?this.clearEditorListeners():this._editorDisposables.length===0&&this.registerEditorListeners()})),this.globalToDispose.add(this._commentThreadRangeDecorator=new RL(this.commentService)),this.globalToDispose.add(this.commentService.onDidDeleteDataProvider(v=>{v?(delete this._pendingNewCommentCache[v],delete this._pendingEditsCache[v]):(this._pendingNewCommentCache={},this._pendingEditsCache={}),this.beginCompute()})),this.globalToDispose.add(this.commentService.onDidSetDataProvider(v=>this.beginComputeAndHandleEditorChange())),this.globalToDispose.add(this.commentService.onDidUpdateCommentingRanges(v=>this.beginComputeAndHandleEditorChange())),this.globalToDispose.add(this.commentService.onDidSetResourceCommentInfos(async v=>{const _=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;_&&_.toString()===v.resource.toString()&&await this.setComments(v.commentInfos.filter(w=>w!==null))})),this.globalToDispose.add(this.commentService.onDidChangeCommentingEnabled(v=>{v?(this.registerEditorListeners(),this.beginCompute()):(this.tryUpdateReservedSpace(),this.clearEditorListeners(),this._commentingRangeDecorator.update(this.editor,[]),this._commentThreadRangeDecorator.update(this.editor,[]),Xe(this._commentWidgets),this._commentWidgets=[])})),this.globalToDispose.add(this.editor.onWillChangeModel(v=>this.onWillChangeModel(v))),this.globalToDispose.add(this.editor.onDidChangeModel(v=>this.onModelChanged())),this.globalToDispose.add(this.configurationService.onDidChangeConfiguration(v=>{v.affectsConfiguration("diffEditor.renderSideBySide")&&this.beginCompute()})),this.onModelChanged(),this.codeEditorService.registerDecorationType("comment-controller",wVe,{}),this.globalToDispose.add(this.commentService.registerContinueOnCommentProvider({provideContinueOnComments:()=>{const v=[];if(this._commentWidgets)for(const _ of this._commentWidgets){const C=_.getPendingComments().newComment;if(!C)continue;let k;if(_.commentThread.comments&&_.commentThread.comments.length){const D=_.commentThread.comments[_.commentThread.comments.length-1];typeof D.body=="string"?k=D.body:k=D.body.value}C.body!==k&&v.push({uniqueOwner:_.uniqueOwner,uri:_.editor.getModel().uri,range:_.commentThread.range,comment:C,isReply:_.commentThread.comments!==void 0&&_.commentThread.comments.length>0})}return v}})))}registerEditorListeners(){this._editorDisposables=[],this.editor&&(this._editorDisposables.push(this.editor.onMouseMove(e=>this.onEditorMouseMove(e))),this._editorDisposables.push(this.editor.onMouseLeave(()=>this.onEditorMouseLeave())),this._editorDisposables.push(this.editor.onDidChangeCursorPosition(e=>this.onEditorChangeCursorPosition(e.position))),this._editorDisposables.push(this.editor.onDidFocusEditorWidget(()=>this.onEditorChangeCursorPosition(this.editor?.getPosition()??null))),this._editorDisposables.push(this.editor.onDidChangeCursorSelection(e=>this.onEditorChangeCursorSelection(e))),this._editorDisposables.push(this.editor.onDidBlurEditorWidget(()=>this.onEditorChangeCursorSelection())))}clearEditorListeners(){Xe(this._editorDisposables),this._editorDisposables=[]}onEditorMouseLeave(){this._commentingRangeDecorator.updateHover()}onEditorMouseMove(e){const t=e.target.position?.lineNumber;e.event.leftButton.valueOf()&&t&&this.mouseDownInfo?this._commentingRangeDecorator.updateSelection(t,new P(this.mouseDownInfo.lineNumber,1,t,1)):this._commentingRangeDecorator.updateHover(t)}onEditorChangeCursorSelection(e){const t=this.editor?.getPosition()?.lineNumber;t&&this._commentingRangeDecorator.updateSelection(t,e?.selection)}onEditorChangeCursorPosition(e){if(!e)return;const t=P.fromPositions(e,{column:-1,lineNumber:e.lineNumber}),i=this.editor?.getDecorationsInRange(t);let n=!1;if(i)for(const o of i)if(o.options.description===yD.description){n=!1;break}else o.options.description===Jb.description&&(n=!0);this._activeCursorHasCommentingRange.set(n),this._activeCursorHasComment.set(this.getCommentsAtLine(t).length>0)}isEditorInlineOriginal(e){return this.configurationService.getValue("diffEditor.renderSideBySide")?!1:!!this.editorService.visibleTextEditorControls.find(i=>i.getEditorType()===xye.IDiffEditor?i.getOriginalEditor()===e:!1)}beginCompute(){return this._computePromise=Tn(e=>{const t=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;return t?this.commentService.getDocumentComments(t):Promise.resolve([])}),this._computeAndSetPromise=this._computePromise.then(async e=>{await this.setComments($t(e)),this._computePromise=null},e=>console.log(e)),this._computePromise.then(()=>this._computeAndSetPromise=void 0),this._computeAndSetPromise}beginComputeCommentingRanges(){this._computeCommentingRangeScheduler&&(this._computeCommentingRangePromise&&(this._computeCommentingRangePromise.cancel(),this._computeCommentingRangePromise=null),this._computeCommentingRangeScheduler.trigger(()=>{const e=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;return e?this.commentService.getDocumentComments(e):Promise.resolve([])}).then(e=>{if(this.commentService.isCommentingEnabled){const t=$t(e);this._commentingRangeDecorator.update(this.editor,t,this.editor?.getPosition()?.lineNumber,this.editor?.getSelection()??void 0)}},e=>(mt(e),null)))}static get(e){return e.getContribution(AVe)}revealCommentThread(e,t,i,n){const o=this._commentWidgets.filter(r=>r.commentThread.threadId===e);o.length===1?o[0].reveal(t,n):i&&(this._computeAndSetPromise?this._computeAndSetPromise.then(r=>{this.revealCommentThread(e,t,!1,n)}):this.beginCompute().then(r=>{this.revealCommentThread(e,t,!1,n)}))}collapseAll(){for(const e of this._commentWidgets)e.collapse(!0)}expandAll(){for(const e of this._commentWidgets)e.expand()}expandUnresolved(){for(const e of this._commentWidgets)e.commentThread.state===dd.Unresolved&&e.expand()}nextCommentThread(e){this._findNearestCommentThread(e)}_findNearestCommentThread(e,t){if(!this._commentWidgets.length||!this.editor?.hasModel())return;const i=t?this.editor.getSelection().getStartPosition():this.editor.getSelection().getEndPosition(),n=this._commentWidgets.sort((a,c)=>{if(t){const d=a;a=c,c=d}return a.commentThread.range===void 0?-1:c.commentThread.range===void 0?1:a.commentThread.range.startLineNumber<c.commentThread.range.startLineNumber?-1:a.commentThread.range.startLineNumber>c.commentThread.range.startLineNumber?1:a.commentThread.range.startColumn<c.commentThread.range.startColumn?-1:a.commentThread.range.startColumn>c.commentThread.range.startColumn?1:0}),o=fse(n,a=>{const c=t?i.lineNumber:a.commentThread.range?.startLineNumber??0,d=t?a.commentThread.range?.startLineNumber??0:i.lineNumber,l=t?i.column:a.commentThread.range?.startColumn??0,u=t?a.commentThread.range?.startColumn??0:i.column;return c>d?!0:c<d?!1:l>u}),r=n[o];r!==void 0&&(this.editor.setSelection(r.commentThread.range??new P(1,1,1,1)),r.reveal(void 0,e?el.Widget:el.None))}previousCommentThread(e){this._findNearestCommentThread(e,!0)}_findNearestCommentingRange(e){if(!this.editor?.hasModel())return;const t=this.editor.getSelection().getEndPosition(),i=this._commentingRangeDecorator.getNearestCommentingRange(t,e);if(i){const n=e?i.getEndPosition():i.getStartPosition();this.editor.setPosition(n),this.editor.revealLineInCenterIfOutsideViewport(n.lineNumber)}if(this.accessibilityService.isScreenReaderOptimized()){const n=i?.getStartPosition().lineNumber,o=i?.getEndPosition().lineNumber;n&&o&&(n===o?zc(h(5323,"Line {0}",n)):zc(h(5324,"Lines {0} to {1}",n,o)))}}nextCommentingRange(){this._findNearestCommentingRange()}previousCommentingRange(){this._findNearestCommentingRange(!0)}dispose(){this.globalToDispose.dispose(),this.localToDispose.dispose(),Xe(this._editorDisposables),Xe(this._commentWidgets),this.editor=null}onWillChangeModel(e){e.newModelUrl&&this.tryUpdateReservedSpace(e.newModelUrl)}async handleCommentAdded(e,t,i){if(this._commentWidgets.filter(u=>u.uniqueOwner===t&&u.commentThread.threadId===i.threadId).length)return;const o=this._commentWidgets.filter(u=>u.uniqueOwner===t&&u.commentThread.commentThreadHandle===-1&&P.equalsRange(u.commentThread.range,i.range));if(o.length){o[0].update(i);return}const r=this._inProcessContinueOnComments.get(t)?.findIndex(u=>u.range===void 0?i.range===void 0:P.lift(u.range).equalsRange(i.range));let a;r!==void 0&&r>=0&&(a=this._inProcessContinueOnComments.get(t)?.splice(r,1)[0].comment.body);const c=(this._pendingNewCommentCache[t]&&this._pendingNewCommentCache[t][i.threadId])??a,d=this._pendingEditsCache[t]&&this._pendingEditsCache[t][i.threadId],l=i.canReply&&i.isTemplate&&(!i.comments||i.comments.length===0)&&(!i.editorId||i.editorId===e);await this.displayCommentThread(t,i,l,c,d),this._commentInfos.filter(u=>u.uniqueOwner===t)[0].threads.push(i),this.tryUpdateReservedSpace()}onModelChanged(){this.localToDispose.clear(),this.tryUpdateReservedSpace(),this.removeCommentWidgetsAndStoreCache(),this.editor&&(this._hasRespondedToEditorChange=!1,this.localToDispose.add(this.editor.onMouseDown(e=>this.onEditorMouseDown(e))),this.localToDispose.add(this.editor.onMouseUp(e=>this.onEditorMouseUp(e))),this._editorDisposables.length&&(this.clearEditorListeners(),this.registerEditorListeners()),this._computeCommentingRangeScheduler=new ju(200),this.localToDispose.add({dispose:()=>{this._computeCommentingRangeScheduler?.cancel(),this._computeCommentingRangeScheduler=null}}),this.localToDispose.add(this.editor.onDidChangeModelContent(async()=>{this.beginComputeCommentingRanges()})),this.localToDispose.add(this.commentService.onDidUpdateCommentThreads(async e=>{const t=this.editor&&this.editor.hasModel()&&this.editor.getModel().uri;if(!t||!this.commentService.isCommentingEnabled)return;this._computePromise&&await this._computePromise;const i=this._commentInfos.filter(d=>d.uniqueOwner===e.uniqueOwner);if(!i||!i.length)return;const n=e.added.filter(d=>d.resource&&d.resource===t.toString()),o=e.removed.filter(d=>d.resource&&d.resource===t.toString()),r=e.changed.filter(d=>d.resource&&d.resource===t.toString()),a=e.pending.filter(d=>d.uri.toString()===t.toString());o.forEach(d=>{const l=this._commentWidgets.filter(g=>g.uniqueOwner===e.uniqueOwner&&g.commentThread.threadId===d.threadId&&g.commentThread.threadId!=="");if(l.length){const g=l[0],m=this._commentWidgets.indexOf(g);this._commentWidgets.splice(m,1),g.dispose()}const u=this._commentInfos.filter(g=>g.uniqueOwner===e.uniqueOwner)[0].threads;for(let g=0;g<u.length;g++)u[g]===d&&(u.splice(g,1),g--)});for(const d of r){const l=this._commentWidgets.filter(u=>u.uniqueOwner===e.uniqueOwner&&u.commentThread.threadId===d.threadId);l.length&&(l[0].update(d),this.openCommentsView(d))}const c=this.editor?.getId();for(const d of n)await this.handleCommentAdded(c,e.uniqueOwner,d);for(const d of a)await this.resumePendingComment(t,d);this._commentThreadRangeDecorator.update(this.editor,i)})),this.beginComputeAndHandleEditorChange())}async resumePendingComment(e,t){const i=this._commentWidgets.filter(n=>n.uniqueOwner===t.uniqueOwner&&P.lift(n.commentThread.range)?.equalsRange(t.range));if(t.isReply&&i.length)this.commentService.removeContinueOnComment({uniqueOwner:t.uniqueOwner,uri:e,range:t.range,isReply:!0}),i[0].setPendingComment(t.comment);else if(i.length){this.commentService.removeContinueOnComment({uniqueOwner:t.uniqueOwner,uri:e,range:t.range,isReply:!1});const n=i[0].getPendingComments().newComment;let o;!n||t.comment.body.includes(n.body)?o=t.comment:n.body.includes(t.comment.body)?o=n:o={body:`${n}
${t.comment.body}`,cursor:t.comment.cursor},i[0].setPendingComment(o)}else if(!t.isReply){if(!this.commentService.removeContinueOnComment({uniqueOwner:t.uniqueOwner,uri:e,range:t.range,isReply:!1}))return;this._inProcessContinueOnComments.has(t.uniqueOwner)||this._inProcessContinueOnComments.set(t.uniqueOwner,[]),this._inProcessContinueOnComments.get(t.uniqueOwner)?.push(t),await this.commentService.createCommentThreadTemplate(t.uniqueOwner,t.uri,t.range?P.lift(t.range):void 0)}}beginComputeAndHandleEditorChange(){this.beginCompute().then(()=>{if(!this._hasRespondedToEditorChange&&this._commentInfos.some(e=>e.commentingRanges.ranges.length>0||e.commentingRanges.fileComments))if(this._hasRespondedToEditorChange=!0,this.configurationService.getValue(zn.Comments)){const t=this.keybindingService.lookupKeybinding(Bo.OpenAccessibilityHelp)?.getAriaLabel();t?zc(h(5325,"Editor has commenting ranges, run the command Open Accessibility Help ({0}), for more information.",t)):zc(h(5326,"Editor has commenting ranges, run the command Open Accessibility Help, which is currently not triggerable via keybinding, for more information."))}else zc(h(5327,"Editor has commenting ranges."))})}async openCommentsView(e){if(e.comments&&e.comments.length>0&&c5(e)){const t=this.configurationService.getValue(_0).openView;if(t==="file")return this.viewsService.openView(Qn);if((t==="firstFile"||t==="firstFileUnresolved"&&e.state===dd.Unresolved)&&!this.viewsService.getViewWithId(Qn)?.hasRendered)return this.viewsService.openView(Qn)}}async displayCommentThread(e,t,i,n,o){const r=this.editor?.getModel();if(!r||!this.editor||this.isEditorInlineOriginal(this.editor))return;let a;t.range&&!n&&(a=this.commentService.removeContinueOnComment({uniqueOwner:e,uri:r.uri,range:t.range,isReply:!0}));const c=this.instantiationService.createInstance(R3,this.editor,e,t,n??a?.comment,o);await c.display(t.range,i),this._commentWidgets.push(c),this.openCommentsView(t)}onEditorMouseDown(e){this.mouseDownInfo=this._activeEditorHasCommentingRange.get()?kVe(e):null}onEditorMouseUp(e){const t=TVe(this.mouseDownInfo,e);if(this.mouseDownInfo=null,!this.editor||t===null||!e.target.element)return;const i=e.target.element.className.indexOf("comment-range-glyph")>=0,n=e.target.position.lineNumber;let o,r;t!==n?t>n?r=new P(t,this.editor.getModel().getLineLength(t)+1,n,1):r=new P(t,1,n,this.editor.getModel().getLineLength(n)+1):i&&(r=this.editor.getSelection()),r&&r.startLineNumber<=n&&n<=r.endLineNumber?(o=r,this.editor.setSelection(new P(r.endLineNumber,1,r.endLineNumber,1))):i&&(o=new P(n,1,n,1)),o&&this.addOrToggleCommentAtLine(o,e)}getCommentsAtLine(e){return this._commentWidgets.filter(t=>t.getGlyphPosition()===(e?e.endLineNumber:0))}async addOrToggleCommentAtLine(e,t){if(this._addInProgress)this._emptyThreadsToAddQueue.push([e,t]);else{this._addInProgress=!0;const i=this.getCommentsAtLine(e);if(i.length){const n=i.every(o=>o.expanded);i.forEach(n?o=>o.collapse(!0):o=>o.expand(!0)),this.processNextThreadToAdd();return}else this.addCommentAtLine(e,t)}}processNextThreadToAdd(){this._addInProgress=!1;const e=this._emptyThreadsToAddQueue.shift();e&&this.addOrToggleCommentAtLine(e[0],e[1])}clipUserRangeToCommentRange(e,t){return e.startLineNumber<t.startLineNumber&&(e=new P(t.startLineNumber,t.startColumn,e.endLineNumber,e.endColumn)),e.endLineNumber>t.endLineNumber&&(e=new P(e.startLineNumber,e.startColumn,t.endLineNumber,t.endColumn)),e}addCommentAtLine(e,t){const i=this._commentingRangeDecorator.getMatchedCommentAction(e);if(!i.length||!this.editor?.hasModel())return this._addInProgress=!1,i.length||(e?this.notificationService.error(h(5328,"The cursor must be within a commenting range to add a comment.")):this.notificationService.error(h(5329,"File comments are not allowed on this file."))),Promise.resolve();if(i.length>1){if(t&&e)return this.contextMenuService.showContextMenu({getAnchor:()=>t.event,getActions:()=>this.getContextMenuActions(i,e),getActionsContext:()=>i.length?i[0]:void 0,onHide:()=>{this._addInProgress=!1}}),Promise.resolve();{const n=this.getCommentProvidersQuickPicks(i);return this.quickInputService.pick(n,{placeHolder:h(5330,"Select Comment Provider"),matchOnDescription:!0}).then(o=>{if(!o)return;const r=i.filter(a=>a.action.ownerId===o.id);if(r.length){const{ownerId:a}=r[0].action,c=e&&r[0].range?this.clipUserRangeToCommentRange(e,r[0].range):e;this.addCommentAtLine2(c,a)}}).then(()=>{this._addInProgress=!1})}}else{const{ownerId:n}=i[0].action,o=e&&i[0].range?this.clipUserRangeToCommentRange(e,i[0].range):e;this.addCommentAtLine2(o,n)}return Promise.resolve()}getCommentProvidersQuickPicks(e){return e.map(i=>{const{ownerId:n,extensionId:o,label:r}=i.action;return{label:r??o??n,id:n}})}getContextMenuActions(e,t){const i=[];return e.forEach(n=>{const{ownerId:o,extensionId:r,label:a}=n.action;i.push(new Xt("addCommentThread",`${a||r}`,void 0,!0,()=>{const c=n.range?this.clipUserRangeToCommentRange(t,n.range):t;return this.addCommentAtLine2(c,o),Promise.resolve()}))}),i}addCommentAtLine2(e,t){this.editor&&(this.commentService.createCommentThreadTemplate(t,this.editor.getModel().uri,e,this.editor.getId()),this.processNextThreadToAdd())}getExistingCommentEditorOptions(e){const t=e.getOption(L.lineDecorationsWidth);let i=[];const n=e.getRawOptions().extraEditorClassName;return n&&(i=n.split(" ")),{lineDecorationsWidth:t,extraEditorClassName:i}}getWithoutCommentsEditorOptions(e,t,i){let n=i;const o=t.findIndex(a=>a==="inline-comment");o>=0&&t.splice(o,1);const r=e.getOptions();return r.get(L.folding)&&r.get(L.showFoldingControls)!=="never"&&(n+=11),n-=24,{extraEditorClassName:t,lineDecorationsWidth:n}}getWithCommentsLineDecorationWidth(e,t){let i=t;const n=e.getOptions();return n.get(L.folding)&&n.get(L.showFoldingControls)!=="never"&&(i-=11),i+=24,this._commentingRangeAmountReserved=i,this._commentingRangeAmountReserved}getWithCommentsEditorOptions(e,t,i){return t.push("inline-comment"),{lineDecorationsWidth:this.getWithCommentsLineDecorationWidth(e,i),extraEditorClassName:t}}updateEditorLayoutOptions(e,t,i){e.updateOptions({extraEditorClassName:t.join(" "),lineDecorationsWidth:i})}ensureCommentingRangeReservedAmount(e){const t=this.getExistingCommentEditorOptions(e);t.lineDecorationsWidth!==this._commentingRangeAmountReserved&&e.updateOptions({lineDecorationsWidth:this.getWithCommentsLineDecorationWidth(e,t.lineDecorationsWidth)})}tryUpdateReservedSpace(e){if(!this.editor)return;const t=this._commentInfos.some(o=>!!(o.commentingRanges&&(Array.isArray(o.commentingRanges)?o.commentingRanges:o.commentingRanges.ranges).length)||o.threads.length>0);e=e??this.editor.getModel()?.uri;const i=e?this.commentService.resourceHasCommentingRanges(e):!1,n=t||i;if(n&&this.commentService.isCommentingEnabled)if(this._commentingRangeSpaceReserved)this.ensureCommentingRangeReservedAmount(this.editor);else{this._commentingRangeSpaceReserved=!0;const{lineDecorationsWidth:o,extraEditorClassName:r}=this.getExistingCommentEditorOptions(this.editor),a=this.getWithCommentsEditorOptions(this.editor,r,o);this.updateEditorLayoutOptions(this.editor,a.extraEditorClassName,a.lineDecorationsWidth)}else if((!n||!this.commentService.isCommentingEnabled)&&this._commentingRangeSpaceReserved){this._commentingRangeSpaceReserved=!1;const{lineDecorationsWidth:o,extraEditorClassName:r}=this.getExistingCommentEditorOptions(this.editor),a=this.getWithoutCommentsEditorOptions(this.editor,r,o);this.updateEditorLayoutOptions(this.editor,a.extraEditorClassName,a.lineDecorationsWidth)}}async setComments(e){if(!this.editor||!this.commentService.isCommentingEnabled)return;this._commentInfos=e,this.tryUpdateReservedSpace(),this.removeCommentWidgetsAndStoreCache();let t=!1;for(const i of this._commentInfos){!t&&(i.commentingRanges.ranges.length>0||i.commentingRanges.fileComments)&&(t=!0);const n=this._pendingNewCommentCache[i.uniqueOwner],o=this._pendingEditsCache[i.uniqueOwner];i.threads=i.threads.filter(r=>!r.isDisposed);for(const r of i.threads){let a;n&&(a=n[r.threadId]);let c;o&&(c=o[r.threadId]),await this.displayCommentThread(i.uniqueOwner,r,!1,a,c)}for(const r of i.pendingCommentThreads??[])this.resumePendingComment(this.editor.getModel().uri,r)}this._commentingRangeDecorator.update(this.editor,this._commentInfos),this._commentThreadRangeDecorator.update(this.editor,this._commentInfos),t?this._activeEditorHasCommentingRange.set(!0):this._activeEditorHasCommentingRange.set(!1)}collapseAndFocusRange(e){this._commentWidgets?.find(t=>t.commentThread.threadId===e)?.collapseAndFocusRange()}removeCommentWidgetsAndStoreCache(){this._commentWidgets&&this._commentWidgets.forEach(e=>{const t=e.getPendingComments(),i=t.newComment,n=this._pendingNewCommentCache[e.uniqueOwner];let o;if(e.commentThread.comments&&e.commentThread.comments.length){const c=e.commentThread.comments[e.commentThread.comments.length-1];typeof c.body=="string"?o=c.body:o=c.body.value}i&&i.body!==o?(n||(this._pendingNewCommentCache[e.uniqueOwner]={}),this._pendingNewCommentCache[e.uniqueOwner][e.commentThread.threadId]=i):n&&delete n[e.commentThread.threadId];const r=t.edits,a=this._pendingEditsCache[e.uniqueOwner];Object.keys(r).length>0?(a||(this._pendingEditsCache[e.uniqueOwner]={}),this._pendingEditsCache[e.uniqueOwner][e.commentThread.threadId]=r):a&&delete a[e.commentThread.threadId],e.dispose()}),this._commentWidgets=[]}};PL=f([p(1,gg),p(2,Z),p(3,Bt),p(4,bi),p(5,Wt),p(6,io),p(7,ne),p(8,fe),p(9,de),p(10,He),p(11,Nr),p(12,Dt)],PL);var oa;(function(s){s.Terminal="terminal",s.TerminalChat="terminal-chat",s.TerminalHelp="terminal-help",s.DiffEditor="diffEditor",s.MergeEditor="mergeEditor",s.PanelChat="panelChat",s.InlineChat="inlineChat",s.AgentChat="agentChat",s.QuickChat="quickChat",s.InlineCompletions="inlineCompletions",s.KeybindingsEditor="keybindingsEditor",s.Notebook="notebook",s.ReplEditor="replEditor",s.Editor="editor",s.Hover="hover",s.Notification="notification",s.EmptyEditorHint="emptyEditorHint",s.Comments="comments",s.CommentThread="commentThread",s.Repl="repl",s.ReplHelp="replHelp",s.RunAndDebug="runAndDebug",s.Walkthrough="walkthrough",s.SourceControl="scm"})(oa||(oa={}));var fc;(function(s){s.Help="help",s.View="view"})(fc||(fc={}));var cte;(function(s){s.Previous="previous",s.Next="next"})(cte||(cte={}));class Ige extends F{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.id=e,this.options=t,this.provideContent=i,this.onClose=n,this.verbositySettingKey=o,this.onOpen=r,this.actions=a,this.provideNextContent=c,this.providePreviousContent=d,this.onDidChangeContent=l,this.onKeyDown=u,this.getSymbols=g,this.onDidRequestClearLastProvider=m}}const wD={id:N.AccessibleView,group:"navigation",when:Aa},SD={id:N.CommandPalette,group:"",order:1};class RVe extends X{constructor(){super({id:Bo.ShowNext,precondition:x.and(Aa,rP),keybinding:{primary:E.Alt|S.BracketRight,weight:W.WorkbenchContrib},menu:[SD,{...wD,when:x.and(Aa,rP)}],icon:K.arrowDown,title:h(4209,"Show Next in Accessible View")})}run(e){e.get(Fh).next()}}Y(RVe);class PVe extends X{constructor(){super({id:Bo.NextCodeBlock,precondition:x.and(aP,x.or(x.equals(Sp.key,oa.PanelChat),x.equals(Sp.key,oa.InlineChat),x.equals(Sp.key,oa.QuickChat))),keybinding:{primary:E.CtrlCmd|E.Alt|S.PageDown,mac:{primary:E.CtrlCmd|E.Alt|S.PageDown},weight:W.WorkbenchContrib},icon:K.arrowRight,menu:{...wD,when:x.and(Aa,aP)},title:h(4210,"Accessible View: Next Code Block")})}run(e){e.get(Fh).navigateToCodeBlock("next")}}Y(PVe);class LVe extends X{constructor(){super({id:Bo.PreviousCodeBlock,precondition:x.and(aP,x.or(x.equals(Sp.key,oa.PanelChat),x.equals(Sp.key,oa.InlineChat),x.equals(Sp.key,oa.QuickChat))),keybinding:{primary:E.CtrlCmd|E.Alt|S.PageUp,mac:{primary:E.CtrlCmd|E.Alt|S.PageUp},weight:W.WorkbenchContrib},icon:K.arrowLeft,menu:{...wD,when:x.and(Aa,aP)},title:h(4211,"Accessible View: Previous Code Block")})}run(e){e.get(Fh).navigateToCodeBlock("previous")}}Y(LVe);class MVe extends X{constructor(){super({id:Bo.ShowPrevious,precondition:x.and(Aa,rP),keybinding:{primary:E.Alt|S.BracketLeft,weight:W.WorkbenchContrib},icon:K.arrowUp,menu:[SD,{...wD,when:x.and(Aa,rP)}],title:h(4212,"Show Previous in Accessible View")})}run(e){e.get(Fh).previous()}}Y(MVe);class NVe extends X{constructor(){super({id:Bo.GoToSymbol,precondition:x.and(x.or(Aa,ig),$X),keybinding:{primary:E.CtrlCmd|E.Shift|S.KeyO,secondary:[E.CtrlCmd|E.Shift|S.Period],weight:W.WorkbenchContrib+10},icon:K.symbolMisc,menu:[SD,{...wD,when:x.and(x.or(Aa,ig),$X)}],title:h(4213,"Go To Symbol in Accessible View")})}run(e){e.get(Fh).goToSymbol()}}Y(NVe);function Dge(s){return s.register(),s}Dge(new hI({id:Bo.OpenAccessibilityHelp,precondition:void 0,kbOpts:{primary:E.Alt|S.F1,weight:W.WorkbenchContrib,linux:{primary:E.Alt|E.Shift|S.F1,secondary:[E.Alt|S.F1]},kbExpr:ig.toNegated()},menuOpts:[{menuId:N.CommandPalette,group:"",title:h(4214,"Open Accessibility Help"),order:1}]}));const OVe=Dge(new hI({id:Bo.OpenAccessibleView,precondition:void 0,kbOpts:{primary:E.Alt|S.F2,weight:W.WorkbenchContrib,linux:{primary:E.Alt|E.Shift|S.F2,secondary:[E.Alt|S.F2]}},menuOpts:[{menuId:N.CommandPalette,group:"",title:h(4215,"Open Accessible View"),order:1}]}));class FVe extends X{constructor(){super({id:Bo.DisableVerbosityHint,precondition:x.and(x.or(Aa,ig),UX),keybinding:{primary:E.Alt|S.F6,weight:W.WorkbenchContrib},icon:K.bellSlash,menu:[SD,{id:N.AccessibleView,group:"navigation",when:x.and(x.or(Aa,ig),UX)}],title:h(4216,"Disable Accessible View Hint")})}run(e){e.get(Fh).disableHint()}}Y(FVe);class WVe extends X{constructor(){super({id:Bo.AccessibilityHelpConfigureKeybindings,precondition:x.and(ig,GX),icon:K.recordKeys,keybinding:{primary:E.Alt|S.KeyK,weight:W.WorkbenchContrib},menu:[{id:N.AccessibleView,group:"navigation",order:3,when:GX}],title:h(4217,"Accessibility Help Configure Unassigned Keybindings")})}async run(e){await e.get(Fh).configureKeybindings(!0)}}Y(WVe);class BVe extends X{constructor(){super({id:Bo.AccessibilityHelpConfigureAssignedKeybindings,precondition:x.and(ig,zX),icon:K.recordKeys,keybinding:{primary:E.Alt|S.KeyA,weight:W.WorkbenchContrib},menu:[{id:N.AccessibleView,group:"navigation",order:4,when:zX}],title:h(4218,"Accessibility Help Configure Assigned Keybindings")})}async run(e){await e.get(Fh).configureKeybindings(!1)}}Y(BVe);class VVe extends X{constructor(){super({id:Bo.AccessibilityHelpOpenHelpLink,precondition:x.and(ig),keybinding:{primary:E.Alt|S.KeyH,weight:W.WorkbenchContrib},title:h(4219,"Accessibility Help Open Help Link")})}run(e){e.get(Fh).openHelpLink()}}Y(VVe);class HVe extends X{constructor(){super({id:Bo.AccessibleViewAcceptInlineCompletion,precondition:x.and(Aa,x.equals(Sp.key,oa.InlineCompletions)),keybinding:{primary:E.CtrlCmd|S.Slash,mac:{primary:E.WinCtrl|S.Slash},weight:W.WorkbenchContrib},icon:K.check,menu:[SD,{id:N.AccessibleView,group:"navigation",order:0,when:x.and(Aa,x.equals(Sp.key,oa.InlineCompletions))}],title:h(4220,"Accept Inline Completion")})}async run(e){const t=e.get(Bt),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)return;const n=eo.get(i)?.model.get(),o=n?.state.get();!n||!o||(await n.accept(i),n.stop(),i.focus())}}Y(HVe);Ve(vWe);const UVe=new O("commentsView.hasComments",!1),$Ve=new O("commentsView.someCommentsExpanded",!1),GVe=new O("commentsView.commentFocused",!1),zVe="commentsViewState";function qVe(s){const e=[];for(const t of s.resourceCommentThreads){const i=[];for(const n of t.commentThreads)c5(n.thread)&&i.push({element:n});i.length>0&&e.push({element:t,children:i})}return e}let P3=class extends XU{get focusedCommentNode(){const e=this.tree?.getFocus();if(e?.length===1&&e[0]instanceof Vc)return e[0]}get focusedCommentInfo(){if(this.focusedCommentNode)return this.getScreenReaderInfoForNode(this.focusedCommentNode)}focusNextNode(){if(!this.tree)return;const e=this.tree.getFocus()?.[0];if(!e)return;let t=this.tree.navigate(e).next();for(;t&&!(t instanceof Vc);)t=this.tree.navigate(t).next();t&&this.tree.setFocus([t])}focusPreviousNode(){if(!this.tree)return;const e=this.tree.getFocus()?.[0];if(!e)return;let t=this.tree.navigate(e).previous();for(;t&&!(t instanceof Vc);)t=this.tree.navigate(t).previous();t&&this.tree.setFocus([t])}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_){const w=new bw(zVe,v),C=w.getMemento(he.WORKSPACE,gt.MACHINE);super({...e,filterOptions:{placeholder:h(5354,"Filter (e.g. text, author)"),ariaLabel:h(5355,"Filter comments"),history:C.filterHistory||[],text:C.filter||"",focusContextKey:d5.key}},c,a,o,r,i,t,d,l,g),this.editorService=n,this.commentService=u,this.uriIdentityService=m,this.pathService=_,this.totalComments=0,this.currentHeight=0,this.currentWidth=0,this.cachedFilterStats=void 0,this.onDidChangeVisibility=this.onDidChangeBodyVisibility,this.hasCommentsContextKey=UVe.bindTo(r),this.someCommentsExpandedContextKey=$Ve.bindTo(r),this.commentsFocusedContextKey=GVe.bindTo(r),this.stateMemento=w,this.viewState=C,this.filters=this._register(new IWe({showResolved:this.viewState.showResolved!==!1,showUnresolved:this.viewState.showUnresolved!==!1,sortBy:this.viewState.sortBy??cl.ResourceAscending},this.contextKeyService)),this.filter=new xWe(new rm(this.filterWidget.getFilterText(),this.filters.showResolved,this.filters.showUnresolved)),this._register(this.filters.onDidChange(k=>{(k.showResolved||k.showUnresolved)&&this.updateFilter(),k.sortBy&&this.refresh()})),this._register(this.filterWidget.onDidChangeFilterText(()=>this.updateFilter()))}saveState(){this.viewState.filter=this.filterWidget.getFilterText(),this.viewState.filterHistory=this.filterWidget.getHistory(),this.viewState.showResolved=this.filters.showResolved,this.viewState.showUnresolved=this.filters.showUnresolved,this.viewState.sortBy=this.filters.sortBy,this.stateMemento.saveMemento(),super.saveState()}render(){super.render(),this._register(Ege({name:"commentsView",focusNotifiers:[this,this.filterWidget],focusNextWidget:()=>{this.filterWidget.hasFocus()&&this.focus()},focusPreviousWidget:()=>{this.filterWidget.hasFocus()||this.focusFilter()}}))}focusFilter(){this.filterWidget.focus()}clearFilterText(){this.filterWidget.setFilterText("")}getFilterStats(){return this.cachedFilterStats||(this.cachedFilterStats={total:this.totalComments,filtered:this.tree?.getVisibleItemCount()??0}),this.cachedFilterStats}updateFilter(){this.filter.options=new rm(this.filterWidget.getFilterText(),this.filters.showResolved,this.filters.showUnresolved),this.tree?.filterComments(),this.cachedFilterStats=void 0;const{total:e,filtered:t}=this.getFilterStats();this.filterWidget.updateBadge(e===t||e===0?void 0:h(5356,"Showing {0} of {1}",t,e)),this.filterWidget.checkMoreFilters(!this.filters.showResolved||!this.filters.showUnresolved)}renderBody(e){super.renderBody(e),e.classList.add("comments-panel");const t=ee(e,j(".comments-panel-container"));this.treeContainer=ee(t,j(".tree-container")),this.treeContainer.classList.add("file-icon-themable-tree","show-file-icons"),this.cachedFilterStats=void 0,this.createTree(),this.createMessageBox(t),this._register(this.commentService.onDidSetAllCommentThreads(this.onAllCommentsChanged,this)),this._register(this.commentService.onDidUpdateCommentThreads(this.onCommentsUpdated,this)),this._register(this.commentService.onDidDeleteDataProvider(this.onDataProviderDeleted,this)),this._register(this.onDidChangeBodyVisibility(i=>{i&&this.refresh()})),this.renderComments()}focus(){super.focus();const e=this.tree?.getHTMLElement();e&&hf(e)||(!this.commentService.commentsModel.hasCommentThreads()&&this.messageBoxContainer?this.messageBoxContainer.focus():this.tree&&this.tree.domFocus())}renderComments(){this.treeContainer.classList.toggle("hidden",!this.commentService.commentsModel.hasCommentThreads()),this.renderMessage(),this.tree?.setChildren(null,qVe(this.commentService.commentsModel))}collapseAll(){this.tree&&(this.tree.collapseAll(),this.tree.setSelection([]),this.tree.setFocus([]),this.tree.domFocus(),this.tree.focusFirst())}expandAll(){this.tree&&(this.tree.expandAll(),this.tree.setSelection([]),this.tree.setFocus([]),this.tree.domFocus(),this.tree.focusFirst())}get hasRendered(){return!!this.tree}layoutBodyContent(e=this.currentHeight,t=this.currentWidth){this.messageBoxContainer&&(this.messageBoxContainer.style.height=`${e}px`),this.tree?.layout(e,t),this.currentHeight=e,this.currentWidth=t}createMessageBox(e){this.messageBoxContainer=ee(e,j(".message-box-container")),this.messageBoxContainer.setAttribute("tabIndex","0")}renderMessage(){this.messageBoxContainer.textContent=this.commentService.commentsModel.getMessage(),this.messageBoxContainer.classList.toggle("hidden",this.commentService.commentsModel.hasCommentThreads())}makeCommentLocationLabel(e,t){const i=Qe(e);return t?t.startLineNumber===t.endLineNumber?h(5358,"at line {0} column {1} in {2}",t.startLineNumber,t.startColumn,i):h(5359,"from line {0} to line {1} in {2}",t.startLineNumber,t.endLineNumber,i):h(5357,"in {0}",i)}makeScreenReaderLabelInfo(e,t){const i=e.comment.userName,n=this.makeCommentLocationLabel(e.resource,e.range),o=this.getReplyCountAsString(e,t),r=typeof e.comment.body=="string"?e.comment.body:e.comment.body.value;return{userName:i,locationLabel:n,replyCountLabel:o,bodyLabel:r}}getScreenReaderInfoForNode(e,t){let i="";if(t&&this.configurationService.getValue(zn.Comments)){const d=this.keybindingService.lookupKeybinding(OVe.id)?.getAriaLabel();i=d?h(5360,`
Inspect this in the accessible view ({0}).`,d):h(5361,`
Inspect this in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding.`)}const n=this.getRepliesAsString(e,t),o=this.editorService.findEditors(e.resource),r=this.editorService.activeEditorPane?.getControl();let a;e.range&&o?.length&&mo(r)&&(a=r.getModel()?.getValueInRange(e.range),a&&(a=`
Corresponding code: 
`+a)),a||(a="");const c=this.makeScreenReaderLabelInfo(e,t);return e.threadRelevance===ose.Outdated?h(5362,`Outdated from {0}: {1}
{2}
{3}
{4}`,c.userName,c.bodyLabel,c.locationLabel,c.replyCountLabel,a)+n+i:h(5363,`{0}: {1}
{2}
{3}
{4}`,c.userName,c.bodyLabel,c.locationLabel,c.replyCountLabel,a)+n+i}getRepliesAsString(e,t){return!e.replies.length||t?"":`
`+e.replies.map(i=>h(5364,"{0} {1}",i.comment.userName,typeof i.comment.body=="string"?i.comment.body:i.comment.body.value)).join(`
`)}getReplyCountAsString(e,t){return e.replies.length&&!t?h(5365," {0} replies,",e.replies.length):""}createTree(){this.treeLabels=this._register(this.instantiationService.createInstance(vd,this)),this.tree=this._register(this.instantiationService.createInstance(K$,this.treeLabels,this.treeContainer,{overrideStyles:this.getLocationBasedColors().listOverrideStyles,selectionNavigation:!0,filter:this.filter,sorter:{compare:(e,t)=>{if(e instanceof Xb||t instanceof Xb)return 0;if(this.filters.sortBy===cl.UpdatedAtDescending)return e.lastUpdatedAt>t.lastUpdatedAt?-1:1;if(this.filters.sortBy===cl.ResourceAscending){if(e instanceof _r&&t instanceof _r){const i=this.pathService.defaultUriScheme;return e.resource.scheme!==t.resource.scheme&&(e.resource.scheme===i||t.resource.scheme===i)?t.resource.scheme===i?1:-1:e.resource.toString()>t.resource.toString()?1:-1}else if(e instanceof Vc&&t instanceof Vc&&e.thread.range&&t.thread.range)return e.thread.range?.startLineNumber>t.thread.range?.startLineNumber?1:-1}return 0}},keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:e=>{}},accessibilityProvider:{getAriaLabel:e=>e instanceof Xb?h(5366,"Comments for current workspace"):e instanceof _r?h(5367,"Comments in {0}, full path {1}",Qe(e.resource),e.resource.fsPath):e instanceof Vc?this.getScreenReaderInfoForNode(e,!0):"",getWidgetAriaLabel(){return G$.value}}})),this._register(this.tree.onDidOpen(e=>{this.openFile(e.element,e.editorOptions.pinned,e.editorOptions.preserveFocus,e.sideBySide)})),this._register(this.tree.onDidChangeModel(()=>{this.updateSomeCommentsExpanded()})),this._register(this.tree.onDidChangeCollapseState(()=>{this.updateSomeCommentsExpanded()})),this._register(this.tree.onDidFocus(()=>this.commentsFocusedContextKey.set(!0))),this._register(this.tree.onDidBlur(()=>this.commentsFocusedContextKey.set(!1)))}openFile(e,t,i,n){if(!e||!(e instanceof _r||e instanceof Vc))return;const o=e instanceof _r?e.commentThreads[0].thread:e.thread,r=e instanceof _r?e.commentThreads[0].comment:void 0;return xge(this.commentService,this.editorService,this.uriIdentityService,o,r,!1,t,i,n)}async refresh(){if(this.tree&&this.isVisible()&&(this.hasCommentsContextKey.set(this.commentService.commentsModel.hasCommentThreads()),this.cachedFilterStats=void 0,this.renderComments(),this.tree.getSelection().length===0&&this.commentService.commentsModel.hasCommentThreads())){const e=this.commentService.commentsModel.resourceCommentThreads[0].commentThreads[0];e&&(this.tree.setFocus([e]),this.tree.setSelection([e]))}}onAllCommentsChanged(e){this.cachedFilterStats=void 0,this.totalComments+=e.commentThreads.length;for(const t of e.commentThreads);this.refresh()}onCommentsUpdated(e){this.cachedFilterStats=void 0,this.totalComments+=e.added.length,this.totalComments-=e.removed.length;for(const t of this.commentService.commentsModel.resourceCommentThreads)for(const i of t.commentThreads);this.refresh()}onDataProviderDeleted(e){this.cachedFilterStats=void 0,this.totalComments=0,this.refresh()}updateSomeCommentsExpanded(){this.someCommentsExpandedContextKey.set(this.isSomeCommentsExpanded())}areAllCommentsExpanded(){if(!this.tree)return!1;const e=this.tree.navigate();for(;e.next();)if(this.tree.isCollapsed(e.current()))return!1;return!0}isSomeCommentsExpanded(){if(!this.tree)return!1;const e=this.tree.navigate();for(;e.next();)if(!this.tree.isCollapsed(e.current()))return!0;return!1}};P3=f([p(1,Z),p(2,$s),p(3,de),p(4,ne),p(5,fe),p(6,bi),p(7,He),p(8,mi),p(9,pt),p(10,gg),p(11,Ti),p(12,nn),p(13,it),p(14,_c)],P3);Ve(nue);const KVe=new N("Views");ge.appendMenuItem(N.ViewContainerTitle,{submenu:KVe,title:h(3519,"Views"),order:1});var Ao;(function(s){s[s.UP=0]="UP",s[s.DOWN=1]="DOWN",s[s.LEFT=2]="LEFT",s[s.RIGHT=3]="RIGHT"})(Ao||(Ao={}));class Cb extends ww{static{this.OVERLAY_ID="monaco-pane-drop-overlay"}get currentDropOperation(){return this._currentDropOperation}constructor(e,t,i,n,o){super(o),this.paneElement=e,this.orientation=t,this.bounds=i,this.location=n,this.cleanupOverlayScheduler=this._register(new yn(()=>this.dispose(),300)),this.create()}get disposed(){return!!this._disposed}create(){this.container=j("div",{id:Cb.OVERLAY_ID}),this.container.style.top="0px",this.paneElement.appendChild(this.container),this.paneElement.classList.add("dragged-over"),this._register(Ie(()=>{this.container.remove(),this.paneElement.classList.remove("dragged-over")})),this.overlay=j(".pane-overlay-indicator"),this.container.appendChild(this.overlay),this.registerListeners(),this.updateStyles()}updateStyles(){this.overlay.style.backgroundColor=this.getColor(this.location===We.Panel?Iq:kq)||"";const e=this.getColor(kr);this.overlay.style.outlineColor=e||"",this.overlay.style.outlineOffset=e?"-2px":"",this.overlay.style.outlineStyle=e?"dashed":"",this.overlay.style.outlineWidth=e?"2px":"",this.overlay.style.borderColor=e||"",this.overlay.style.borderStyle="solid",this.overlay.style.borderWidth="0px"}registerListeners(){this._register(new Wp(this.container,{onDragOver:e=>{this.positionOverlay(e.offsetX,e.offsetY),this.cleanupOverlayScheduler.isScheduled()&&this.cleanupOverlayScheduler.cancel()},onDragLeave:e=>this.dispose(),onDragEnd:e=>this.dispose(),onDrop:e=>{this.dispose()}})),this._register(re(this.container,pe.MOUSE_OVER,()=>{this.cleanupOverlayScheduler.isScheduled()||this.cleanupOverlayScheduler.schedule()}))}positionOverlay(e,t){const i=this.paneElement.clientWidth,n=this.paneElement.clientHeight,o=i/2,r=n/2;let a;switch(this.orientation===St.VERTICAL?t<r?a=Ao.UP:t>=r&&(a=Ao.DOWN):this.orientation===St.HORIZONTAL&&(e<o?a=Ao.LEFT:e>=o&&(a=Ao.RIGHT)),a){case Ao.UP:this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"50%"});break;case Ao.DOWN:this.doPositionOverlay({bottom:"0",left:"0",width:"100%",height:"50%"});break;case Ao.LEFT:this.doPositionOverlay({top:"0",left:"0",width:"50%",height:"100%"});break;case Ao.RIGHT:this.doPositionOverlay({top:"0",right:"0",width:"50%",height:"100%"});break;default:{let c="0",d="0",l="100%",u="100%";if(this.bounds){const g=this.container.getBoundingClientRect();c=`${this.bounds.top-g.top}px`,d=`${this.bounds.left-g.left}px`,u=`${this.bounds.bottom-this.bounds.top}px`,l=`${this.bounds.right-this.bounds.left}px`}this.doPositionOverlay({top:c,left:d,width:l,height:u})}}this.orientation===St.VERTICAL&&n<=25||this.orientation===St.HORIZONTAL&&i<=25?this.doUpdateOverlayBorder(a):this.doUpdateOverlayBorder(void 0),this.overlay.style.opacity="1",setTimeout(()=>this.overlay.classList.add("overlay-move-transition"),0),this._currentDropOperation=a}doUpdateOverlayBorder(e){this.overlay.style.borderTopWidth=e===Ao.UP?"2px":"0px",this.overlay.style.borderLeftWidth=e===Ao.LEFT?"2px":"0px",this.overlay.style.borderBottomWidth=e===Ao.DOWN?"2px":"0px",this.overlay.style.borderRightWidth=e===Ao.RIGHT?"2px":"0px"}doPositionOverlay(e){this.container.style.height="100%",this.overlay.style.top=e.top||"",this.overlay.style.left=e.left||"",this.overlay.style.bottom=e.bottom||"",this.overlay.style.right=e.right||"",this.overlay.style.width=e.width,this.overlay.style.height=e.height}contains(e){return e===this.container||e===this.overlay}dispose(){super.dispose(),this._disposed=!0}}let L3=class extends qP{constructor(e,t,i,n,o){const r=n.createScoped(e);r.createKey("viewContainer",t.id);const a=r.createKey("viewContainerLocation",Zc(i.getViewContainerLocation(t)));super(N.ViewContainerTitle,N.ViewContainerTitleContext,{shouldForwardArgs:!0,renderShortTitle:!0},r,o),this._register(r),this._register(T.filter(i.onDidChangeContainerLocation,c=>c.viewContainer===t)(()=>a.set(Zc(i.getViewContainerLocation(t)))))}};L3=f([p(2,$s),p(3,fe),p(4,fn)],L3);let M3=class extends KO{get onDidSashChange(){return jt(this.paneview).onDidSashChange}get panes(){return this.paneItems.map(e=>e.pane)}get views(){return this.panes}get length(){return this.paneItems.length}get menuActions(){return this._menuActions}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(e,d,l),this.options=t,this.instantiationService=i,this.configurationService=n,this.layoutService=o,this.contextMenuService=r,this.telemetryService=a,this.extensionService=c,this.storageService=l,this.contextService=u,this.viewDescriptorService=g,this.logService=m,this.paneItems=[],this.visible=!1,this.areExtensionsReady=!1,this.didLayout=!1,this._onTitleAreaUpdate=this._register(new M),this.onTitleAreaUpdate=this._onTitleAreaUpdate.event,this._onDidChangeVisibility=this._register(new M),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._onDidAddViews=this._register(new M),this.onDidAddViews=this._onDidAddViews.event,this._onDidRemoveViews=this._register(new M),this.onDidRemoveViews=this._onDidRemoveViews.event,this._onDidChangeViewVisibility=this._register(new M),this.onDidChangeViewVisibility=this._onDidChangeViewVisibility.event,this._onDidFocusView=this._register(new M),this.onDidFocusView=this._onDidFocusView.event,this._onDidBlurView=this._register(new M),this.onDidBlurView=this._onDidBlurView.event;const v=this.viewDescriptorService.getViewContainerById(e);if(!v)throw new Error("Could not find container");this.viewContainer=v,this.visibleViewsStorageId=`${e}.numberOfVisibleViews`,this.visibleViewsCountFromCache=this.storageService.getNumber(this.visibleViewsStorageId,he.WORKSPACE,void 0),this.viewContainerModel=this.viewDescriptorService.getViewContainerModel(v)}create(e){const t=this.options;t.orientation=this.orientation,this.paneview=this._register(new v0e(e,this.options)),this._boundarySashes&&this.paneview.setBoundarySashes(this._boundarySashes),this._register(this.paneview.onDidDrop(({from:c,to:d})=>this.movePane(c,d))),this._register(this.paneview.onDidScroll(c=>this.onDidScrollPane())),this._register(this.paneview.onDidSashReset(c=>this.onDidSashReset(c))),this._register(re(e,pe.CONTEXT_MENU,c=>this.showContextMenu(new bs(Et(e),c)))),this._register(Dh.addTarget(e)),this._register(re(e,Yo.Contextmenu,c=>this.showContextMenu(new bs(Et(e),c)))),this._menuActions=this._register(this.instantiationService.createInstance(L3,this.paneview.element,this.viewContainer)),this._register(this._menuActions.onDidChange(()=>this.updateTitleArea()));let i;const n=()=>{const c=e.getBoundingClientRect(),d=this.panes[this.panes.length-1].element.getBoundingClientRect(),l=this.orientation===St.VERTICAL?d.bottom:c.top,u=this.orientation===St.HORIZONTAL?d.right:c.left;return{top:l,bottom:c.bottom,left:u,right:c.right}},o=(c,d)=>d.x>=c.left&&d.x<=c.right&&d.y>=c.top&&d.y<=c.bottom;let r;this._register(Xd.INSTANCE.registerTarget(e,{onDragEnter:c=>{if(r=n(),i&&i.disposed&&(i=void 0),!i&&o(r,c.eventData)){const d=c.dragAndDropData.getData();if(d.type==="view"){const l=this.viewDescriptorService.getViewContainerByViewId(d.id),u=this.viewDescriptorService.getViewDescriptorById(d.id);if(l!==this.viewContainer&&(!u||!u.canMoveView||this.viewContainer.rejectAddedViews))return;i=new Cb(e,void 0,r,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService)}if(d.type==="composite"&&d.id!==this.viewContainer.id){const l=this.viewDescriptorService.getViewContainerById(d.id),u=this.viewDescriptorService.getViewContainerModel(l).allViewDescriptors;!u.some(g=>!g.canMoveView)&&u.length>0&&(i=new Cb(e,void 0,r,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService))}}},onDragOver:c=>{i&&i.disposed&&(i=void 0),i&&!o(r,c.eventData)&&(i.dispose(),i=void 0),o(r,c.eventData)&&GP(c.eventData.dataTransfer,"move",i!==void 0)},onDragLeave:c=>{i?.dispose(),i=void 0},onDrop:c=>{if(i){const d=c.dragAndDropData.getData(),l=[];if(d.type==="composite"&&d.id!==this.viewContainer.id){const g=this.viewDescriptorService.getViewContainerById(d.id),m=this.viewDescriptorService.getViewContainerModel(g).allViewDescriptors;m.some(v=>!v.canMoveView)||l.push(...m)}else if(d.type==="view"){const g=this.viewDescriptorService.getViewContainerByViewId(d.id),m=this.viewDescriptorService.getViewDescriptorById(d.id);g!==this.viewContainer&&m&&m.canMoveView&&this.viewDescriptorService.moveViewsToContainer([m],this.viewContainer,void 0,"dnd")}const u=this.panes.length;if(l.length>0&&this.viewDescriptorService.moveViewsToContainer(l,this.viewContainer,void 0,"dnd"),u>0)for(const g of l){const m=this.panes.find(v=>v.id===g.id);m&&this.movePane(m,this.panes[this.panes.length-1])}}i?.dispose(),i=void 0}})),this._register(this.onDidSashChange(()=>this.saveViewSizes())),this._register(this.viewContainerModel.onDidAddVisibleViewDescriptors(c=>this.onDidAddViewDescriptors(c))),this._register(this.viewContainerModel.onDidRemoveVisibleViewDescriptors(c=>this.onDidRemoveViewDescriptors(c)));const a=this.viewContainerModel.visibleViewDescriptors.map((c,d)=>{const l=this.viewContainerModel.getSize(c.id),u=this.viewContainerModel.isCollapsed(c.id);return{viewDescriptor:c,index:d,size:l,collapsed:u}});a.length&&this.onDidAddViewDescriptors(a),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this.areExtensionsReady=!0,this.panes.length&&(this.updateTitleArea(),this.updateViewHeaders()),this._register(this.configurationService.onDidChangeConfiguration(c=>{c.affectsConfiguration(oi.ACTIVITY_BAR_LOCATION)&&this.updateViewHeaders()}))}),this._register(this.viewContainerModel.onDidChangeActiveViewDescriptors(()=>this._onTitleAreaUpdate.fire()))}getTitle(){const e=this.viewContainerModel.title;if(this.isViewMergedWithContainer()){const t=this.paneItems[0].pane.singleViewPaneContainerTitle;if(t)return t;const i=this.paneItems[0].pane.title;return e===i?i:i?`${e}: ${i}`:e}return e}showContextMenu(e){for(const t of this.paneItems)if(Hu(e.target,t.pane.element))return;e.stopPropagation(),e.preventDefault(),this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>this.menuActions?.getContextMenuActions()??[]})}getActionsContext(){if(this.isViewMergedWithContainer())return this.panes[0].getActionsContext()}getActionViewItem(e,t){return this.isViewMergedWithContainer()?this.paneItems[0].pane.createActionViewItem(e,t):mw(this.instantiationService,e,t)}focus(){let e;if(this.lastFocusedPane)e=this.lastFocusedPane;else if(this.paneItems.length>0){for(const{pane:t}of this.paneItems)if(t.isExpanded()){e=t;break}}e&&e.focus()}get orientation(){switch(this.viewDescriptorService.getViewContainerLocation(this.viewContainer)){case We.Sidebar:case We.AuxiliaryBar:return St.VERTICAL;case We.Panel:return Doe(this.layoutService.getPanelPosition())?St.HORIZONTAL:St.VERTICAL}return St.VERTICAL}layout(e){this.paneview&&(this.paneview.orientation!==this.orientation&&this.paneview.flipOrientation(e.height,e.width),this.paneview.layout(e.height,e.width)),this.dimension=e,this.didLayout?this.saveViewSizes():(this.didLayout=!0,this.restoreViewSizes())}setBoundarySashes(e){this._boundarySashes=e,this.paneview?.setBoundarySashes(e)}getOptimalWidth(){return Math.max(...this.panes.map(i=>i.getOptimalWidth()||0))+16}addPanes(e){const t=this.isViewMergedWithContainer();for(const{pane:i,size:n,index:o,disposable:r}of e)this.addPane(i,n,r,o);this.updateViewHeaders(),this.isViewMergedWithContainer()!==t&&this.updateTitleArea(),this._onDidAddViews.fire(e.map(({pane:i})=>i))}setVisible(e){this.visible!==!!e&&(this.visible=e,this._onDidChangeVisibility.fire(e)),this.panes.filter(t=>t.isVisible()!==e).forEach(t=>t.setVisible(e))}isVisible(){return this.visible}updateTitleArea(){this._onTitleAreaUpdate.fire()}createView(e,t){return this.instantiationService.createInstance(e.ctorDescriptor.ctor,...e.ctorDescriptor.staticArguments||[],t)}getView(e){return this.panes.filter(t=>t.id===e)[0]}saveViewSizes(){this.didLayout&&this.viewContainerModel.setSizes(this.panes.map(e=>({id:e.id,size:this.getPaneSize(e)})))}restoreViewSizes(){if(this.didLayout){let e;for(let t=0;t<this.viewContainerModel.visibleViewDescriptors.length;t++){const i=this.panes[t],n=this.viewContainerModel.visibleViewDescriptors[t],o=this.viewContainerModel.getSize(n.id);typeof o=="number"?this.resizePane(i,o):(e=e||this.computeInitialSizes(),this.resizePane(i,e.get(i.id)||200))}}}computeInitialSizes(){const e=new Map;if(this.dimension){const t=this.viewContainerModel.visibleViewDescriptors.reduce((i,{weight:n})=>i+(n||20),0);for(const i of this.viewContainerModel.visibleViewDescriptors)this.orientation===St.VERTICAL?e.set(i.id,this.dimension.height*(i.weight||20)/t):e.set(i.id,this.dimension.width*(i.weight||20)/t)}return e}saveState(){this.panes.forEach(e=>e.saveState()),this.storageService.store(this.visibleViewsStorageId,this.length,he.WORKSPACE,gt.MACHINE)}onContextMenu(e,t){e.stopPropagation(),e.preventDefault();const i=t.menuActions.getContextMenuActions();this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>i})}openView(e,t){let i=this.getView(e);return i||this.toggleViewVisibility(e),i=this.getView(e),i&&(i.setExpanded(!0),t&&i.focus()),i}onDidAddViewDescriptors(e){const t=[];for(const{viewDescriptor:n,collapsed:o,index:r,size:a}of e){const c=this.createView(n,{id:n.id,title:n.name.value,fromExtensionId:n.extensionId,expanded:!o,singleViewPaneContainerTitle:n.singleViewPaneContainerTitle});try{c.render()}catch(d){this.logService.error(`Fail to render view ${n.id}`,d);continue}if(c.draggableElement){const d=re(c.draggableElement,"contextmenu",u=>{u.stopPropagation(),u.preventDefault(),this.onContextMenu(new bs(Et(c.draggableElement),u),c)}),l=T.latch(T.map(c.onDidChange,()=>!c.isExpanded()))(u=>{this.viewContainerModel.setCollapsed(n.id,u)});t.push({pane:c,size:a||c.minimumSize,index:r,disposable:Wo(d,l)})}}this.addPanes(t),this.restoreViewSizes();const i=[];for(const{pane:n}of t)n.setVisible(this.isVisible()),i.push(n);return i}onDidRemoveViewDescriptors(e){e=e.sort((i,n)=>n.index-i.index);const t=[];for(const{index:i}of e)this.paneItems[i]&&t.push(this.paneItems[i].pane);if(t.length){this.removePanes(t);for(const i of t)i.setVisible(!1)}}toggleViewVisibility(e){if(this.viewContainerModel.activeViewDescriptors.some(t=>t.id===e)){const t=!this.viewContainerModel.isVisible(e);this.viewContainerModel.setVisible(e,t)}}addPane(e,t,i,n=this.paneItems.length-1){const o=e.onDidFocus(()=>{this._onDidFocusView.fire(e),this.lastFocusedPane=e}),r=e.onDidBlur(()=>this._onDidBlurView.fire(e)),a=e.onDidChangeTitleArea(()=>{this.isViewMergedWithContainer()&&this.updateTitleArea()}),c=e.onDidChangeBodyVisibility(()=>this._onDidChangeViewVisibility.fire(e)),d=e.onDidChange(()=>{e===this.lastFocusedPane&&!e.isExpanded()&&(this.lastFocusedPane=void 0)}),l=this.viewDescriptorService.getViewContainerLocation(this.viewContainer)===We.Panel;e.style({headerForeground:vt(l?Exe:Pxe),headerBackground:vt(l?Cxe:Rxe),headerBorder:vt(l?xxe:gre),dropBackground:vt(l?Iq:kq),leftBorder:l?vt(Ixe):void 0});const u=new U;u.add(i),u.add(Wo(e,o,r,a,d,c));const g={pane:e,disposable:u};this.paneItems.splice(n,0,g),jt(this.paneview).addPane(e,t,n);let m;e.draggableElement&&u.add(Xd.INSTANCE.registerDraggable(e.draggableElement,()=>({type:"view",id:e.id}),{})),u.add(Xd.INSTANCE.registerTarget(e.dropTargetElement,{onDragEnter:v=>{if(!m){const _=v.dragAndDropData.getData();if(_.type==="view"&&_.id!==e.id){const w=this.viewDescriptorService.getViewContainerByViewId(_.id),C=this.viewDescriptorService.getViewDescriptorById(_.id);if(w!==this.viewContainer&&(!C||!C.canMoveView||this.viewContainer.rejectAddedViews))return;m=new Cb(e.dropTargetElement,this.orientation??St.VERTICAL,void 0,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService)}if(_.type==="composite"&&_.id!==this.viewContainer.id&&!this.viewContainer.rejectAddedViews){const w=this.viewDescriptorService.getViewContainerById(_.id),C=this.viewDescriptorService.getViewContainerModel(w).allViewDescriptors;!C.some(k=>!k.canMoveView)&&C.length>0&&(m=new Cb(e.dropTargetElement,this.orientation??St.VERTICAL,void 0,this.viewDescriptorService.getViewContainerLocation(this.viewContainer),this.themeService))}}},onDragOver:v=>{GP(v.eventData.dataTransfer,"move",m!==void 0)},onDragLeave:v=>{m?.dispose(),m=void 0},onDrop:v=>{if(m){const _=v.dragAndDropData.getData(),w=[];let C;if(_.type==="composite"&&_.id!==this.viewContainer.id&&!this.viewContainer.rejectAddedViews){const k=this.viewDescriptorService.getViewContainerById(_.id),D=this.viewDescriptorService.getViewContainerModel(k).allViewDescriptors;D.length>0&&!D.some(A=>!A.canMoveView)&&(w.push(...D),C=D[0])}else if(_.type==="view"){const k=this.viewDescriptorService.getViewContainerByViewId(_.id),D=this.viewDescriptorService.getViewDescriptorById(_.id);k!==this.viewContainer&&D&&D.canMoveView&&!this.viewContainer.rejectAddedViews&&w.push(D),D&&(C=D)}if(w&&this.viewDescriptorService.moveViewsToContainer(w,this.viewContainer,void 0,"dnd"),C){if(m.currentDropOperation===Ao.DOWN||m.currentDropOperation===Ao.RIGHT){const k=this.panes.findIndex(A=>A.id===C.id);let D=this.panes.findIndex(A=>A.id===e.id);k>=0&&D>=0&&(k>D&&D++,D<this.panes.length&&D!==k&&this.movePane(this.panes[k],this.panes[D]))}if(m.currentDropOperation===Ao.UP||m.currentDropOperation===Ao.LEFT){const k=this.panes.findIndex(A=>A.id===C.id);let D=this.panes.findIndex(A=>A.id===e.id);k>=0&&D>=0&&(k<D&&D--,D>=0&&D!==k&&this.movePane(this.panes[k],this.panes[D]))}w.length>1&&w.slice(1).forEach(k=>{let D=this.panes.findIndex(B=>B.id===C.id);const A=this.panes.findIndex(B=>B.id===k.id);A>=0&&D>=0&&(A>D&&D++,D<this.panes.length&&D!==A&&(this.movePane(this.panes[A],this.panes[D]),C=k))})}}m?.dispose(),m=void 0}}))}removePanes(e){const t=this.isViewMergedWithContainer();e.forEach(i=>this.removePane(i)),this.updateViewHeaders(),t!==this.isViewMergedWithContainer()&&this.updateTitleArea(),this._onDidRemoveViews.fire(e)}removePane(e){const t=this.paneItems.findIndex(n=>n.pane===e);if(t===-1)return;this.lastFocusedPane===e&&(this.lastFocusedPane=void 0),jt(this.paneview).removePane(e);const[i]=this.paneItems.splice(t,1);i.disposable.dispose()}movePane(e,t){const i=this.paneItems.findIndex(c=>c.pane===e),n=this.paneItems.findIndex(c=>c.pane===t),o=this.viewContainerModel.visibleViewDescriptors[i],r=this.viewContainerModel.visibleViewDescriptors[n];if(i<0||i>=this.paneItems.length||n<0||n>=this.paneItems.length)return;const[a]=this.paneItems.splice(i,1);this.paneItems.splice(n,0,a),jt(this.paneview).movePane(e,t),this.viewContainerModel.move(o.id,r.id),this.updateTitleArea()}resizePane(e,t){jt(this.paneview).resizePane(e,t)}getPaneSize(e){return jt(this.paneview).getPaneSize(e)}updateViewHeaders(){this.isViewMergedWithContainer()?(this.paneItems[0].pane.isExpanded()?this.lastMergedCollapsedPane=void 0:(this.lastMergedCollapsedPane=this.paneItems[0].pane,this.paneItems[0].pane.setExpanded(!0)),this.paneItems[0].pane.headerVisible=!1,this.paneItems[0].pane.collapsible=!0):(this.paneItems.length===1?(this.paneItems[0].pane.headerVisible=!0,this.paneItems[0].pane===this.lastMergedCollapsedPane&&this.paneItems[0].pane.setExpanded(!1),this.paneItems[0].pane.collapsible=!1):this.paneItems.forEach(e=>{e.pane.headerVisible=!0,e.pane.collapsible=!0,e.pane===this.lastMergedCollapsedPane&&e.pane.setExpanded(!1)}),this.lastMergedCollapsedPane=void 0)}isViewMergedWithContainer(){return this.options.mergeViewWithContainerWhenSingleView&&this.paneItems.length===1?this.areExtensionsReady?!0:this.visibleViewsCountFromCache===void 0?this.paneItems[0].pane.isExpanded():this.visibleViewsCountFromCache===1:!1}onDidScrollPane(){for(const e of this.panes)e.onDidScrollRoot()}onDidSashReset(e){let t,i;for(let n=e;n>=0;n--)if(this.paneItems[n].pane?.isVisible()&&this.paneItems[n]?.pane.isExpanded()){t=this.paneItems[n].pane;break}for(let n=e+1;n<this.paneItems.length;n++)if(this.paneItems[n].pane?.isVisible()&&this.paneItems[n]?.pane.isExpanded()){i=this.paneItems[n].pane;break}if(t&&i){const n=this.getPaneSize(t),o=this.getPaneSize(i),r=Math.ceil((n+o)/2),a=Math.floor((n+o)/2);n>o?(this.resizePane(t,r),this.resizePane(i,a)):(this.resizePane(i,a),this.resizePane(t,r))}}dispose(){super.dispose(),this.paneItems.forEach(e=>e.disposable.dispose()),this.paneview&&this.paneview.dispose()}};M3=f([p(2,Z),p(3,ne),p(4,yi),p(5,bi),p(6,ai),p(7,cn),p(8,pt),p(9,it),p(10,It),p(11,$s),p(12,Re)],M3);class btt extends X{constructor(e){super(e),this.desc=e}run(e,...t){const i=e.get(io).getActiveViewPaneContainerWithId(this.desc.viewPaneContainerId);if(i)return this.runInViewPaneContainer(e,i,...t)}}class S0 extends X{constructor(e,t){super(e),this.offset=t}async run(e){const t=e.get($s),i=e.get(fe),n=ll.getValue(i);if(n===void 0)return;const o=t.getViewContainerByViewId(n),r=t.getViewContainerModel(o),a=r.visibleViewDescriptors.find(l=>l.id===n),c=r.visibleViewDescriptors.indexOf(a);if(c+this.offset<0||c+this.offset>=r.visibleViewDescriptors.length)return;const d=r.visibleViewDescriptors[c+this.offset];r.move(a.id,d.id)}}Y(class extends S0{constructor(){super({id:"views.moveViewUp",title:h(3520,"Move View Up"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.UpArrow),weight:W.WorkbenchContrib+1,when:ll.notEqualsTo("")}},-1)}});Y(class extends S0{constructor(){super({id:"views.moveViewLeft",title:h(3521,"Move View Left"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.LeftArrow),weight:W.WorkbenchContrib+1,when:ll.notEqualsTo("")}},-1)}});Y(class extends S0{constructor(){super({id:"views.moveViewDown",title:h(3522,"Move View Down"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.DownArrow),weight:W.WorkbenchContrib+1,when:ll.notEqualsTo("")}},1)}});Y(class extends S0{constructor(){super({id:"views.moveViewRight",title:h(3523,"Move View Right"),keybinding:{primary:lt(E.CtrlCmd+S.KeyK,S.RightArrow),weight:W.WorkbenchContrib+1,when:ll.notEqualsTo("")}},1)}});Y(class extends X{constructor(){super({id:"vscode.moveViews",title:h(3524,"Move Views")})}async run(e,t){if(!Array.isArray(t?.viewIds)||typeof t?.destinationId!="string")return Promise.reject("Invalid arguments");const i=e.get($s),n=i.getViewContainerById(t.destinationId);if(n){for(const o of t.viewIds){const r=i.getViewDescriptorById(o);r?.canMoveView&&i.moveViewsToContainer([r],n,kV.Default,this.desc.id)}await e.get(io).openViewContainer(n.id,!0)}}});class jVe{get input(){return this._input}set input(e){this._input=e,this._onDidChangeInput.fire(e)}get onDidChangeInput(){return this._onDidChangeInput.event}get label(){return this._label}set label(e){this._label=e,this._onDidChangeLabel.fire(this._label)}get contextValue(){return this._contextValue}set contextValue(e){this._contextValue=e}get comments(){return this._comments}set comments(e){this._comments=e,this._onDidChangeComments.fire(this._comments)}get onDidChangeComments(){return this._onDidChangeComments.event}set range(e){this._range=e}get range(){return this._range}get onDidChangeCanReply(){return this._onDidChangeCanReply.event}set canReply(e){this._canReply=e,this._onDidChangeCanReply.fire(!!this._canReply)}get canReply(){return this._canReply}get collapsibleState(){return this._collapsibleState}set collapsibleState(e){this.initialCollapsibleState===void 0&&(this.initialCollapsibleState=e),e!==this._collapsibleState&&(this._collapsibleState=e,this._onDidChangeCollapsibleState.fire(this._collapsibleState))}get initialCollapsibleState(){return this._initialCollapsibleState}set initialCollapsibleState(e){this._initialCollapsibleState=e,this._onDidChangeInitialCollapsibleState.fire(e)}get isDisposed(){return this._isDisposed}isDocumentCommentThread(){return this._range===void 0||P.isIRange(this._range)}get state(){return this._state}set state(e){this._state=e,this._onDidChangeState.fire(this._state)}get applicability(){return this._applicability}set applicability(e){this._applicability=e,this._onDidChangeApplicability.fire(e)}get isTemplate(){return this._isTemplate}constructor(e,t,i,n,o,r,a,c,d,l){this.commentThreadHandle=e,this.controllerHandle=t,this.extensionId=i,this.threadId=n,this.resource=o,this._range=r,this._canReply=c,this._isTemplate=d,this.editorId=l,this._onDidChangeInput=new M,this._onDidChangeLabel=new M,this.onDidChangeLabel=this._onDidChangeLabel.event,this._onDidChangeComments=new M,this._onDidChangeCanReply=new M,this._collapsibleState=cr.Collapsed,this._onDidChangeCollapsibleState=new M,this.onDidChangeCollapsibleState=this._onDidChangeCollapsibleState.event,this._onDidChangeInitialCollapsibleState=new M,this.onDidChangeInitialCollapsibleState=this._onDidChangeInitialCollapsibleState.event,this._onDidChangeApplicability=new M,this.onDidChangeApplicability=this._onDidChangeApplicability.event,this._onDidChangeState=new M,this.onDidChangeState=this._onDidChangeState.event,this._isDisposed=!1,d?this.comments=[]:a&&(this._comments=a)}batchUpdate(e){const t=i=>Object.prototype.hasOwnProperty.call(e,i);t("range")&&(this._range=e.range),t("label")&&(this._label=e.label),t("contextValue")&&(this._contextValue=e.contextValue===null?void 0:e.contextValue),t("comments")&&(this.comments=e.comments),t("collapseState")&&(this.collapsibleState=e.collapseState),t("canReply")&&(this.canReply=e.canReply),t("state")&&(this.state=e.state),t("applicability")&&(this.applicability=e.applicability),t("isTemplate")&&(this._isTemplate=e.isTemplate)}hasComments(){return!!this.comments&&this.comments.length>0}dispose(){this._isDisposed=!0,this._onDidChangeCollapsibleState.dispose(),this._onDidChangeComments.dispose(),this._onDidChangeInput.dispose(),this._onDidChangeLabel.dispose(),this._onDidChangeState.dispose()}toJSON(){return{$mid:Dn.CommentThread,commentControlHandle:this.controllerHandle,commentThreadHandle:this.commentThreadHandle}}}class YVe{constructor(e){this.thread=e,this.disposableStore=new U}dispose(){this.disposableStore.dispose()}}class QVe{get handle(){return this._handle}get id(){return this._id}get contextValue(){return this._id}get proxy(){return this._proxy}get label(){return this._label}get reactions(){return this._reactions}set reactions(e){this._reactions=e}get options(){return this._features.options}get features(){return this._features}get owner(){return this._id}constructor(e,t,i,n,o,r,a){this._proxy=e,this._commentService=t,this._handle=i,this._uniqueId=n,this._id=o,this._label=r,this._features=a,this._threads=new ti}get activeComment(){return this._activeComment}async setActiveCommentAndThread(e){return this._activeComment=e,this._proxy.$setActiveComment(this._handle,e?{commentThreadHandle:e.thread.commentThreadHandle,uniqueIdInThread:e.comment?.uniqueIdInThread}:void 0)}updateFeatures(e){this._features=e}createCommentThread(e,t,i,n,o,r,a,c){const d=new jVe(t,this.handle,e,i,R.revive(n).toString(),o,r,!0,a,c),l=new YVe(d);return this._threads.set(t,l),l.disposableStore.add(d.onDidChangeCollapsibleState(()=>{this.proxy.$updateCommentThread(this.handle,d.commentThreadHandle,{collapseState:d.collapsibleState})})),d.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[d],removed:[],changed:[],pending:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[d],removed:[],changed:[],pending:[]}),d}updateCommentThread(e,t,i,n){const o=this.getKnownThread(e);o.batchUpdate(n),o.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[],removed:[],changed:[o],pending:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[],removed:[],changed:[o],pending:[]})}deleteCommentThread(e){const t=this.getKnownThread(e);this._threads.deleteAndDispose(e),t.dispose(),t.isDocumentCommentThread()?this._commentService.updateComments(this._uniqueId,{added:[],removed:[t],changed:[],pending:[]}):this._commentService.updateNotebookComments(this._uniqueId,{added:[],removed:[t],changed:[],pending:[]})}deleteCommentThreadMain(e){for(const{thread:t}of this._threads.values())t.threadId===e&&this._proxy.$deleteCommentThread(this._handle,t.commentThreadHandle)}updateInput(e){const t=this.activeEditingCommentThread;if(t&&t.input){const i=t.input;i.value=e,t.input=i}}updateCommentingRanges(e){this._commentService.updateCommentingRanges(this._uniqueId,e)}getKnownThread(e){const t=this._threads.get(e);if(!t)throw new Error("unknown thread");return t.thread}async getDocumentComments(e,t){if(e.scheme===ae.vscodeNotebookCell)return{uniqueOwner:this._uniqueId,label:this.label,threads:[],commentingRanges:{resource:e,ranges:[],fileComments:!1}};const i=[];for(const o of[...this._threads.keys()]){const r=this._threads.get(o);r.thread.resource===e.toString()&&r.thread.isDocumentCommentThread()&&i.push(r.thread)}const n=await this._proxy.$provideCommentingRanges(this.handle,e,t);return{uniqueOwner:this._uniqueId,label:this.label,threads:i,commentingRanges:{resource:e,ranges:n?.ranges||[],fileComments:!!n?.fileComments}}}async getNotebookComments(e,t){if(e.scheme!==ae.vscodeNotebookCell)return{uniqueOwner:this._uniqueId,label:this.label,threads:[]};const i=[];for(const n of[...this._threads.keys()]){const o=this._threads.get(n);o.thread.resource===e.toString()&&(o.thread.isDocumentCommentThread()||i.push(o.thread))}return{uniqueOwner:this._uniqueId,label:this.label,threads:i}}async toggleReaction(e,t,i,n,o){return this._proxy.$toggleReaction(this._handle,t.commentThreadHandle,e,i,n)}getAllComments(){const e=[];for(const t of[...this._threads.keys()])e.push(this._threads.get(t).thread);return e}createCommentThreadTemplate(e,t,i){return this._proxy.$createCommentThreadTemplate(this.handle,e,t,i)}async updateCommentThreadTemplate(e,t){await this._proxy.$updateCommentThreadTemplate(this.handle,e,t)}toJSON(){return{$mid:Dn.CommentController,handle:this.handle}}}const dte=Pe("comments-view-icon",K.commentDiscussion,h(2392,"View icon of the comments view."));let lte=class extends F{constructor(e,t,i,n,o,r){super(),this._commentService=t,this._viewsService=i,this._viewDescriptorService=n,this._uriIdentityService=o,this._editorService=r,this._handlers=new Map,this._commentControllers=new Map,this._activeEditingCommentThreadDisposables=this._register(new U),this._openViewListener=this._register(new Pt),this._onChangeContainerListener=this._register(new Pt),this._onChangeContainerLocationListener=this._register(new Pt),this._proxy=e.getProxy(Ze.ExtHostComments),this._commentService.unregisterCommentController(),this._register(this._commentService.onDidChangeActiveEditingCommentThread(async a=>{const c=a.controllerHandle,d=this._commentControllers.get(c);d&&(this._activeEditingCommentThreadDisposables.clear(),this._activeEditingCommentThread=a,d.activeEditingCommentThread=this._activeEditingCommentThread)}))}$registerCommentController(e,t,i,n){const o=`${t}-${n}`;this._handlers.set(e,o);const r=new QVe(this._proxy,this._commentService,e,o,t,i,{});this._commentService.registerCommentController(o,r),this._commentControllers.set(e,r),this._register(this._commentService.onResourceHasCommentingRanges(a=>{this.registerView()})),this._register(this._commentService.onDidUpdateCommentThreads(a=>{this.registerView()})),this._commentService.setWorkspaceComments(String(e),[])}$unregisterCommentController(e){const t=this._handlers.get(e);this._handlers.delete(e),this._commentControllers.delete(e),typeof t=="string"&&this._commentService.unregisterCommentController(t)}$updateCommentControllerFeatures(e,t){const i=this._commentControllers.get(e);i&&i.updateFeatures(t)}$createCommentThread(e,t,i,n,o,r,a,c,d){const l=this._commentControllers.get(e);if(l)return l.createCommentThread(a.value,t,i,n,o,r,c,d)}$updateCommentThread(e,t,i,n,o){const r=this._commentControllers.get(e);if(r)return r.updateCommentThread(t,i,n,o)}$deleteCommentThread(e,t){const i=this._commentControllers.get(e);if(i)return i.deleteCommentThread(t)}$updateCommentingRanges(e,t){const i=this._commentControllers.get(e);i&&i.updateCommentingRanges(t)}async $revealCommentThread(e,t,i,n){const o=this._commentControllers.get(e);if(!o)return Promise.resolve();const r=o.getAllComments().find(c=>c.commentThreadHandle===t);if(!r||!r.isDocumentCommentThread())return Promise.resolve();const a=r.comments?.find(c=>c.uniqueIdInThread===i);xge(this._commentService,this._editorService,this._uriIdentityService,r,a,n.focusReply,void 0,n.preserveFocus)}async $hideCommentThread(e,t){const i=this._commentControllers.get(e);if(!i)return Promise.resolve();const n=i.getAllComments().find(o=>o.commentThreadHandle===t);if(!n||!n.isDocumentCommentThread())return Promise.resolve();n.collapsibleState=cr.Collapsed}registerView(){const e=!!this._viewDescriptorService.getViewDescriptorById(Qn);if(!e){const t=Ke.as(qp.ViewContainersRegistry).registerViewContainer({id:Qn,title:G$,ctorDescriptor:new Sr(M3,[Qn,{mergeViewWithContainerWhenSingleView:!0}]),storageId:CWe,hideIfEmpty:!0,icon:dte,order:10},We.Panel);Ke.as(qp.ViewsRegistry).registerViews([{id:Qn,name:G$,canToggleVisibility:!1,ctorDescriptor:new Sr(P3),canMoveView:!0,containerIcon:dte,focusCommand:{id:"workbench.action.focusCommentsPanel"}}],t)}this.registerViewListeners(e)}setComments(){[...this._commentControllers.keys()].forEach(e=>{const t=this._commentControllers.get(e).getAllComments();if(t.length){const i=this.getHandler(e);this._commentService.setWorkspaceComments(i,t)}})}registerViewOpenedListener(){this._openViewListener.value||(this._openViewListener.value=this._viewsService.onDidChangeViewVisibility(e=>{e.id===Qn&&e.visible&&(this.setComments(),this._openViewListener&&this._openViewListener.dispose())}))}registerViewListeners(e){e||this.registerViewOpenedListener(),this._onChangeContainerListener.value||(this._onChangeContainerListener.value=this._viewDescriptorService.onDidChangeContainer(t=>{t.views.find(i=>i.id===Qn)&&(this.setComments(),this.registerViewOpenedListener())})),this._onChangeContainerLocationListener.value||(this._onChangeContainerLocationListener.value=this._viewDescriptorService.onDidChangeContainerLocation(t=>{const i=this._viewDescriptorService.getViewContainerByViewId(Qn);t.viewContainer.id===i?.id&&(this.setComments(),this.registerViewOpenedListener())}))}getHandler(e){if(!this._handlers.has(e))throw new Error("Unknown handler");return this._handlers.get(e)}};lte=f([ht(qe.MainThreadComments),p(1,gg),p(2,io),p(3,$s),p(4,nn),p(5,de)],lte);let hte=class{constructor(e,t,i,n){this._notebookService=t,this._cellStatusBarService=i,this._logService=n,this._disposables=new U,this._notebookSerializer=new Map,this._notebookCellStatusBarRegistrations=new Map,this._proxy=e.getProxy(Ze.ExtHostNotebook)}dispose(){this._disposables.dispose(),Xe(this._notebookSerializer.values())}$registerNotebookSerializer(e,t,i,n,o){const r=new U;r.add(this._notebookService.registerNotebookSerializer(i,t,{options:n,dataToNotebook:async a=>{const c=new Xn;let d;if(a.byteLength===0&&i==="interactive")d=Er.fromNotebookDataDto({cells:[],metadata:{}});else{const l=await this._proxy.$dataToNotebook(e,a,Ce.None);d=Er.fromNotebookDataDto(l.value)}return this._logService.trace(`[NotebookSerializer] dataToNotebook DONE after ${c.elapsed()}ms`,{viewType:i,extensionId:t.id.value}),d},notebookToData:a=>{const c=new Xn,d=this._proxy.$notebookToData(e,new ta(Er.toNotebookDataDto(a)),Ce.None);return this._logService.trace(`[NotebookSerializer] notebookToData DONE after ${c.elapsed()}`,{viewType:i,extensionId:t.id.value}),d},save:async(a,c,d,l)=>({...await this._proxy.$saveNotebook(e,a,c,d,l),children:void 0,resource:a}),searchInNotebooks:async(a,c,d)=>{const l=this._notebookService.getContributedNotebookType(i);if(!l)return{results:[],limitHit:!1};const g=l.selectors.map(C=>(C.include||C).toString());if(!g.length)return{results:[],limitHit:!1};const m=$t([{isFromSettings:!1,filenamePatterns:g},...d.get(i)??[]]),v=Array.from(d.keys()).flatMap(C=>C!==i?d.get(C)??[]:[]),_=await this._proxy.$searchInNotebooks(e,a,m,v,c);return{results:_.results.map(C=>({resource:R.revive(C.resource),cellResults:C.cellResults.map(D=>gn(D))})),limitHit:_.limitHit}}})),o&&r.add(this._notebookService.registerContributedNotebookType(i,o)),this._notebookSerializer.set(e,r),this._logService.trace("[NotebookSerializer] registered notebook serializer",{viewType:i,extensionId:t.id.value})}$unregisterNotebookSerializer(e){this._notebookSerializer.get(e)?.dispose(),this._notebookSerializer.delete(e)}$emitCellStatusBarEvent(e){const t=this._notebookCellStatusBarRegistrations.get(e);t instanceof M&&t.fire(void 0)}async $registerNotebookCellStatusBarItemProvider(e,t,i){const n=this,o={async provideCellStatusBarItems(a,c,d){const l=await n._proxy.$provideNotebookCellStatusBarItems(e,a,c,d);return{items:l?.items??[],dispose(){l&&n._proxy.$releaseNotebookCellStatusBarItems(l.cacheId)}}},viewType:i};if(typeof t=="number"){const a=new M;this._notebookCellStatusBarRegistrations.set(t,a),o.onDidChangeStatusBarItems=a.event}const r=this._cellStatusBarService.registerCellStatusBarItemProvider(o);this._notebookCellStatusBarRegistrations.set(e,r)}async $unregisterNotebookCellStatusBarItemProvider(e,t){const i=n=>{this._notebookCellStatusBarRegistrations.get(n)&&(this._notebookCellStatusBarRegistrations.get(n)?.dispose(),this._notebookCellStatusBarRegistrations.delete(n))};i(e),typeof t=="number"&&i(t)}};hte=f([ht(qe.MainThreadNotebook),p(1,bl),p(2,xre),p(3,Re)],hte);Ee.registerCommand("_executeDataToNotebook",async(s,...e)=>{const[t,i]=e;yt(typeof t=="string","string"),yt(i instanceof Le,"VSBuffer");const o=await s.get(bl).withNotebookDataProvider(t);if(!(o instanceof CO))return;const r=await o.serializer.dataToNotebook(i);return new ta(Er.toNotebookDataDto(r))});Ee.registerCommand("_executeNotebookToData",async(s,...e)=>{const[t,i]=e;yt(typeof t=="string","string"),yt(typeof i=="object");const o=await s.get(bl).withNotebookDataProvider(t);if(!(o instanceof CO))return;const r=Er.fromNotebookDataDto(i.value);return await o.serializer.notebookToData(r)});var N3;(function(s){s[s.cell=0]="cell",s[s.notebook=1]="notebook"})(N3||(N3={}));class XVe{get preloadUris(){return this.preloads.map(e=>e.uri)}get preloadProvides(){return this.preloads.flatMap(e=>e.provides)}constructor(e,t){this._languageService=t,this._onDidChange=new M,this.onDidChange=this._onDidChange.event,this.id=e.id,this.viewType=e.notebookType,this.extension=e.extensionId,this.implementsInterrupt=e.supportsInterrupt??!1,this.label=e.label,this.description=e.description,this.detail=e.detail,this.supportedLanguages=An(e.supportedLanguages)?e.supportedLanguages:t.getRegisteredLanguageIds(),this.implementsExecutionOrder=e.supportsExecutionOrder??!1,this.hasVariableProvider=e.hasVariableProvider??!1,this.localResourceRoot=R.revive(e.extensionLocation),this.preloads=e.preloads?.map(i=>({uri:R.revive(i.uri),provides:i.provides}))??[]}update(e){const t=Object.create(null);e.label!==void 0&&(this.label=e.label,t.label=!0),e.description!==void 0&&(this.description=e.description,t.description=!0),e.detail!==void 0&&(this.detail=e.detail,t.detail=!0),e.supportedLanguages!==void 0&&(this.supportedLanguages=An(e.supportedLanguages)?e.supportedLanguages:this._languageService.getRegisteredLanguageIds(),t.supportedLanguages=!0),e.supportsExecutionOrder!==void 0&&(this.implementsExecutionOrder=e.supportsExecutionOrder,t.hasExecutionOrder=!0),e.supportsInterrupt!==void 0&&(this.implementsInterrupt=e.supportsInterrupt,t.hasInterruptHandler=!0),e.hasVariableProvider!==void 0&&(this.hasVariableProvider=e.hasVariableProvider,t.hasVariableProvider=!0),this._onDidChange.fire(t)}}class ZVe{constructor(e){this.notebookType=e}}let ute=class{constructor(e,t,i,n,o,r){this._languageService=t,this._notebookKernelService=i,this._notebookExecutionStateService=n,this._notebookService=o,this._editors=new ti,this._disposables=new U,this._kernels=new Map,this._kernelDetectionTasks=new Map,this._kernelSourceActionProviders=new Map,this._kernelSourceActionProvidersEventRegistrations=new Map,this._executions=new Map,this._notebookExecutions=new Map,this.variableRequestIndex=0,this.variableRequestMap=new Map,this._proxy=e.getProxy(Ze.ExtHostNotebookKernels),r.listNotebookEditors().forEach(this._onEditorAdd,this),r.onDidAddNotebookEditor(this._onEditorAdd,this,this._disposables),r.onDidRemoveNotebookEditor(this._onEditorRemove,this,this._disposables),this._disposables.add(Ie(()=>{this._executions.forEach(a=>{a.complete({})}),this._notebookExecutions.forEach(a=>a.complete())})),this._disposables.add(this._notebookExecutionStateService.onDidChangeExecution(a=>{a.type===N3.cell&&this._proxy.$cellExecutionChanged(a.notebook,a.cellHandle,a.changed?.state)})),this._disposables.add(this._notebookKernelService.onDidChangeSelectedNotebooks(a=>{for(const[c,[d]]of this._kernels)a.oldKernel===d.id?this._proxy.$acceptNotebookAssociation(c,a.notebook,!1):a.newKernel===d.id&&this._proxy.$acceptNotebookAssociation(c,a.notebook,!0)}))}dispose(){this._disposables.dispose();for(const[,e]of this._kernels.values())e.dispose();for(const[,e]of this._kernelDetectionTasks.values())e.dispose();for(const[,e]of this._kernelSourceActionProviders.values())e.dispose();this._editors.dispose()}_onEditorAdd(e){const t=e.onDidReceiveMessage(i=>{if(!e.hasModel())return;const{selected:n}=this._notebookKernelService.getMatchingKernel(e.textModel);if(n){for(const[o,r]of this._kernels)if(r[0]===n){this._proxy.$acceptKernelMessageFromRenderer(o,e.getId(),i.message);break}}});this._editors.set(e,t)}_onEditorRemove(e){this._editors.deleteAndDispose(e)}async $postMessage(e,t,i){const n=this._kernels.get(e);if(!n)throw new Error("kernel already disposed");const[o]=n;let r=!1;for(const[a]of this._editors)if(a.hasModel()&&this._notebookKernelService.getMatchingKernel(a.textModel).selected===o){if(t===void 0)a.postMessage(i),r=!0;else if(a.getId()===t){a.postMessage(i),r=!0;break}}return r}$receiveVariable(e,t){const i=this.variableRequestMap.get(e);i&&i.emitOne(t)}async $addKernel(e,t){const i=this,n=new class extends XVe{async executeNotebookCellsRequest(r,a){await i._proxy.$executeCells(e,r,a)}async cancelNotebookCellExecution(r,a){await i._proxy.$cancelCells(e,r,a)}provideVariables(r,a,c,d,l){const u=`${e}variables${i.variableRequestIndex++}`;if(i.variableRequestMap.has(u))return i.variableRequestMap.get(u).asyncIterable;const g=new une;return i.variableRequestMap.set(u,g),i._proxy.$provideVariables(e,u,r,a,c,d,l).then(()=>{g.resolve(),i.variableRequestMap.delete(u)}).catch(m=>{g.reject(m),i.variableRequestMap.delete(u)}),g.asyncIterable}}(t,this._languageService),o=this._disposables.add(new U);this._kernels.set(e,[n,o]),o.add(this._notebookKernelService.registerKernel(n))}$updateKernel(e,t){const i=this._kernels.get(e);i&&i[0].update(t)}$removeKernel(e){const t=this._kernels.get(e);t&&(t[1].dispose(),this._kernels.delete(e))}$updateNotebookPriority(e,t,i){const n=this._kernels.get(e);n&&this._notebookKernelService.updateKernelNotebookAffinity(n[0],R.revive(t),i)}$createExecution(e,t,i,n){const o=R.revive(i),r=this._notebookService.getNotebookTextModel(o);if(!r)throw new Error(`Notebook not found: ${o.toString()}`);const a=this._notebookKernelService.getMatchingKernel(r);if(!a.selected||a.selected.id!==t)throw new Error(`Kernel is not selected: ${a.selected?.id} !== ${t}`);const c=this._notebookExecutionStateService.createCellExecution(o,n);c.confirm(),this._executions.set(e,c)}$updateExecution(e,t){const i=t.value;try{this._executions.get(e)?.update(i.map(Er.fromCellExecuteUpdateDto))}catch(n){mt(n)}}$completeExecution(e,t){try{this._executions.get(e)?.complete(Er.fromCellExecuteCompleteDto(t.value))}catch(i){mt(i)}finally{this._executions.delete(e)}}$createNotebookExecution(e,t,i){const n=R.revive(i),o=this._notebookService.getNotebookTextModel(n);if(!o)throw new Error(`Notebook not found: ${n.toString()}`);const r=this._notebookKernelService.getMatchingKernel(o);if(!r.selected||r.selected.id!==t)throw new Error(`Kernel is not selected: ${r.selected?.id} !== ${t}`);const a=this._notebookExecutionStateService.createExecution(n);a.confirm(),this._notebookExecutions.set(e,a)}$beginNotebookExecution(e){try{this._notebookExecutions.get(e)?.begin()}catch(t){mt(t)}}$completeNotebookExecution(e){try{this._notebookExecutions.get(e)?.complete()}catch(t){mt(t)}finally{this._notebookExecutions.delete(e)}}async $addKernelDetectionTask(e,t){const i=new ZVe(t),n=this._notebookKernelService.registerNotebookKernelDetectionTask(i);this._kernelDetectionTasks.set(e,[i,n])}$removeKernelDetectionTask(e){const t=this._kernelDetectionTasks.get(e);t&&(t[1].dispose(),this._kernelDetectionTasks.delete(e))}async $addKernelSourceActionProvider(e,t,i){const n={viewType:i,provideKernelSourceActions:async()=>(await this._proxy.$provideKernelSourceActions(e,Ce.None)).map(a=>{let c=a.documentation;return a.documentation&&typeof a.documentation!="string"&&(c=R.revive(a.documentation)),{label:a.label,command:a.command,description:a.description,detail:a.detail,documentation:c}})};if(typeof t=="number"){const r=new M;this._kernelSourceActionProvidersEventRegistrations.set(t,r),n.onDidChangeSourceActions=r.event}const o=this._notebookKernelService.registerKernelSourceActionProvider(i,n);this._kernelSourceActionProviders.set(e,[n,o])}$removeKernelSourceActionProvider(e,t){const i=this._kernelSourceActionProviders.get(e);i&&(i[1].dispose(),this._kernelSourceActionProviders.delete(e)),typeof t=="number"&&this._kernelSourceActionProvidersEventRegistrations.delete(t)}$emitNotebookKernelSourceActionsChangeEvent(e){const t=this._kernelSourceActionProvidersEventRegistrations.get(e);t instanceof M&&t.fire(void 0)}$variablesUpdated(e){this._notebookKernelService.notifyVariablesChange(R.revive(e))}};ute=f([ht(qe.MainThreadNotebookKernels),p(1,vi),p(2,Dre),p(3,Ire),p(4,bl),p(5,PN)],ute);let O3=class{constructor(e,t,i){this._notebookEditorModelResolverService=t,this._uriIdentityService=i,this._disposables=new U,this._documentEventListenersMapping=new In,this._proxy=e.getProxy(Ze.ExtHostNotebookDocuments),this._modelReferenceCollection=new Oue(this._uriIdentityService.extUri),this._disposables.add(this._notebookEditorModelResolverService.onDidChangeDirty(n=>this._proxy.$acceptDirtyStateChanged(n.resource,n.isDirty()))),this._disposables.add(this._notebookEditorModelResolverService.onDidSaveNotebook(n=>this._proxy.$acceptModelSaved(n))),this._disposables.add(t.onWillFailWithConflict(n=>{this._modelReferenceCollection.remove(n.resource)}))}dispose(){this._disposables.dispose(),this._modelReferenceCollection.dispose(),Xe(this._documentEventListenersMapping.values())}handleNotebooksAdded(e){for(const t of e){const i=new U;i.add(t.onDidChangeContent(n=>{const o={versionId:n.versionId,rawEvents:[]};for(const a of n.rawEvents)switch(a.kind){case Nc.ModelChange:o.rawEvents.push({kind:a.kind,changes:a.changes.map(c=>[c[0],c[1],c[2].map(d=>Er.toNotebookCellDto(d))])});break;case Nc.Move:o.rawEvents.push({kind:a.kind,index:a.index,length:a.length,newIdx:a.newIdx});break;case Nc.Output:o.rawEvents.push({kind:a.kind,index:a.index,outputs:a.outputs.map(Er.toNotebookOutputDto)});break;case Nc.OutputItem:o.rawEvents.push({kind:a.kind,index:a.index,outputId:a.outputId,outputItems:a.outputItems.map(Er.toNotebookOutputItemDto),append:a.append});break;case Nc.ChangeCellLanguage:case Nc.ChangeCellContent:case Nc.ChangeCellMetadata:case Nc.ChangeCellInternalMetadata:o.rawEvents.push(a);break}const r=n.rawEvents.find(a=>a.kind===Nc.ChangeDocumentMetadata);this._proxy.$acceptModelChanged(t.uri,new ta(o),this._notebookEditorModelResolverService.isDirty(t.uri),r?t.metadata:void 0)})),this._documentEventListenersMapping.set(t.uri,i)}}handleNotebooksRemoved(e){for(const t of e)this._documentEventListenersMapping.get(t)?.dispose(),this._documentEventListenersMapping.delete(t)}async $tryCreateNotebook(e){if(e.content){const t=await this._notebookEditorModelResolverService.resolve({untitledResource:void 0},e.viewType);if(T.once(t.object.notebook.onWillDispose)(()=>{t.dispose()}),this._proxy.$acceptDirtyStateChanged(t.object.resource,!0),e.content){const i=Er.fromNotebookDataDto(e.content);t.object.notebook.reset(i.cells,i.metadata,t.object.notebook.transientOptions)}return t.object.notebook.uri}else return(await this._notebookEditorModelResolverService.createUntitledNotebookTextModel(e.viewType)).uri}async $tryOpenNotebook(e){const t=R.revive(e),i=await this._notebookEditorModelResolverService.resolve(t,void 0);return e.scheme==="untitled"&&i.object.notebook.onWillDispose(()=>{i.dispose()}),this._modelReferenceCollection.add(t,i),t}async $trySaveNotebook(e){const t=R.revive(e),i=await this._notebookEditorModelResolverService.resolve(t),n=await i.object.save();return i.dispose(),n}};O3=f([p(1,II),p(2,nn)],O3);class JVe{constructor(e,t){this.editor=e,this.disposables=t}dispose(){this.disposables.dispose()}}let F3=class{constructor(e,t,i,n,o){this._editorService=t,this._notebookEditorService=i,this._editorGroupService=n,this._configurationService=o,this._disposables=new U,this._mainThreadEditors=new Map,this._proxy=e.getProxy(Ze.ExtHostNotebookEditors),this._editorService.onDidActiveEditorChange(()=>this._updateEditorViewColumns(),this,this._disposables),this._editorGroupService.onDidRemoveGroup(()=>this._updateEditorViewColumns(),this,this._disposables),this._editorGroupService.onDidMoveGroup(()=>this._updateEditorViewColumns(),this,this._disposables)}dispose(){this._disposables.dispose(),Xe(this._mainThreadEditors.values())}handleEditorsAdded(e){for(const t of e){const i=new U;i.add(t.onDidChangeVisibleRanges(()=>{this._proxy.$acceptEditorPropertiesChanged(t.getId(),{visibleRanges:{ranges:t.visibleRanges}})})),i.add(t.onDidChangeSelection(()=>{this._proxy.$acceptEditorPropertiesChanged(t.getId(),{selections:{selections:t.getSelections()}})}));const n=new JVe(t,i);this._mainThreadEditors.set(t.getId(),n)}}handleEditorsRemoved(e){for(const t of e)this._mainThreadEditors.get(t)?.dispose(),this._mainThreadEditors.delete(t)}_updateEditorViewColumns(){const e=Object.create(null);for(const t of this._editorService.visibleEditorPanes){const i=rl(t);i&&this._mainThreadEditors.has(i.getId())&&(e[i.getId()]=Qp(this._editorGroupService,t.group))}ic(e,this._currentViewColumnInfo)||(this._currentViewColumnInfo=e,this._proxy.$acceptEditorViewColumns(e))}async $tryShowNotebookDocument(e,t,i){const n={cellSelections:i.selections,preserveFocus:i.preserveFocus,pinned:i.pinned,activation:i.preserveFocus?qc.RESTORE:void 0,label:i.label,override:t},o=await this._editorService.openEditor({resource:R.revive(e),options:n},Vm(this._editorGroupService,this._configurationService,i.position)),r=rl(o);if(r)return r.getId();throw new Error(`Notebook Editor creation failure for document ${JSON.stringify(e)}`)}async $tryRevealRange(e,t,i){const n=this._notebookEditorService.getNotebookEditor(e);if(!n)return;const o=n;if(!o.hasModel()||t.start>=o.getLength())return;const r=o.cellAt(t.start);switch(i){case ab.Default:return o.revealCellRangeInView(t);case ab.InCenter:return o.revealInCenter(r);case ab.InCenterIfOutsideViewport:return o.revealInCenterIfOutsideViewport(r);case ab.AtTop:return o.revealInViewAtTop(r)}}$trySetSelections(e,t){const i=this._notebookEditorService.getNotebookEditor(e);i&&(i.setSelections(t),t.length&&i.setFocus({start:t[0].start,end:t[0].start+1}))}};F3=f([p(1,de),p(2,PN),p(3,xe),p(4,ne)],F3);var wT;class gte{static delta(e,t){if(!e)return{addedDocuments:[...t.documents],removedDocuments:[],addedEditors:[...t.textEditors.values()],removedEditors:[],visibleEditors:[...t.visibleEditors].map(a=>a[0])};const i=Fz(e.documents,t.documents),n=$F(e.textEditors,t.textEditors),o=e.activeEditor!==t.activeEditor?t.activeEditor:void 0,r=$F(e.visibleEditors,t.visibleEditors);return{addedDocuments:i.added,removedDocuments:i.removed.map(a=>a.uri),addedEditors:n.added,removedEditors:n.removed.map(a=>a.getId()),newActiveEditor:o,visibleEditors:r.added.length===0&&r.removed.length===0?void 0:[...t.visibleEditors].map(a=>a[0])}}constructor(e,t,i,n){this.documents=e,this.textEditors=t,this.activeEditor=i,this.visibleEditors=n}}let pte=wT=class{constructor(e,t,i,n,o,r,a){this._notebookService=i,this._notebookEditorService=n,this._editorService=o,this._editorGroupService=r,this._logService=a,this._disposables=new U,this._editorListeners=new ti,this._proxy=e.getProxy(Ze.ExtHostNotebook),this._mainThreadNotebooks=t.createInstance(O3,e),this._mainThreadEditors=t.createInstance(F3,e),e.set(qe.MainThreadNotebookDocuments,this._mainThreadNotebooks),e.set(qe.MainThreadNotebookEditors,this._mainThreadEditors),this._notebookService.onWillAddNotebookDocument(()=>this._updateState(),this,this._disposables),this._notebookService.onDidRemoveNotebookDocument(()=>this._updateState(),this,this._disposables),this._editorService.onDidActiveEditorChange(()=>this._updateState(),this,this._disposables),this._editorService.onDidVisibleEditorsChange(()=>this._updateState(),this,this._disposables),this._notebookEditorService.onDidAddNotebookEditor(this._handleEditorAdd,this,this._disposables),this._notebookEditorService.onDidRemoveNotebookEditor(this._handleEditorRemove,this,this._disposables),this._updateState()}dispose(){this._mainThreadNotebooks.dispose(),this._mainThreadEditors.dispose(),this._disposables.dispose(),this._editorListeners.dispose()}_handleEditorAdd(e){this._editorListeners.set(e.getId(),Wo(e.onDidChangeModel(()=>this._updateState()),e.onDidFocusWidget(()=>this._updateState(e)))),this._updateState()}_handleEditorRemove(e){this._editorListeners.deleteAndDispose(e.getId()),this._updateState()}_updateState(e){const t=new Map,i=new Map;for(const a of this._notebookEditorService.listNotebookEditors())a.hasModel()&&t.set(a.getId(),a);const n=rl(this._editorService.activeEditorPane);let o=null;n?o=n.getId():e?.textModel&&(o=e.getId()),o&&!t.has(o)&&(this._logService.trace("MainThreadNotebooksAndEditors#_updateState: active editor is not in editors list",o,t.keys()),o=null);for(const a of this._editorService.visibleEditorPanes){const c=rl(a);c?.hasModel()&&t.has(c.getId())&&i.set(c.getId(),c)}const r=new gte(new Set(this._notebookService.listNotebookDocuments()),t,o,i);this._onDelta(gte.delta(this._currentState,r)),this._currentState=r}_onDelta(e){if(wT._isDeltaEmpty(e))return;const t={removedDocuments:e.removedDocuments,removedEditors:e.removedEditors,newActiveEditor:e.newActiveEditor,visibleEditors:e.visibleEditors,addedDocuments:e.addedDocuments.map(wT._asModelAddData),addedEditors:e.addedEditors.map(this._asEditorAddData,this)};this._proxy.$acceptDocumentAndEditorsDelta(new ta(t)),this._mainThreadEditors.handleEditorsRemoved(e.removedEditors),this._mainThreadNotebooks.handleNotebooksRemoved(e.removedDocuments),this._mainThreadNotebooks.handleNotebooksAdded(e.addedDocuments),this._mainThreadEditors.handleEditorsAdded(e.addedEditors)}static _isDeltaEmpty(e){return!(e.addedDocuments!==void 0&&e.addedDocuments.length>0||e.removedDocuments!==void 0&&e.removedDocuments.length>0||e.addedEditors!==void 0&&e.addedEditors.length>0||e.removedEditors!==void 0&&e.removedEditors.length>0||e.visibleEditors!==void 0&&e.visibleEditors.length>0||e.newActiveEditor!==void 0)}static _asModelAddData(e){return{viewType:e.viewType,uri:e.uri,metadata:e.metadata,versionId:e.versionId,cells:e.cells.map(Er.toNotebookCellDto)}}_asEditorAddData(e){const t=this._editorService.visibleEditorPanes.find(i=>rl(i)===e);return{id:e.getId(),documentUri:e.textModel.uri,selections:e.getSelections(),visibleRanges:e.visibleRanges,viewColumn:t&&Qp(this._editorGroupService,t.group),viewType:e.getViewModel().viewType}}};pte=wT=f([c_,p(1,Z),p(2,bl),p(3,PN),p(4,de),p(5,xe),p(6,Re)],pte);let fte=class extends F{constructor(e,t){super(),this.messaging=t,this.proxy=e.getProxy(Ze.ExtHostNotebookRenderers),this._register(t.onShouldPostMessage(i=>{this.proxy.$postRendererMessage(i.editorId,i.rendererId,i.message)}))}$postMessage(e,t,i){return this.messaging.receiveMessage(e,t,i)}};fte=f([ht(qe.MainThreadNotebookRenderers),p(1,Tre)],fte);var LL;(function(s){s[s.Save=1]="Save",s[s.Backup=2]="Backup"})(LL||(LL={}));var ST,qa;(function(s){s[s.SAVED=0]="SAVED",s[s.DIRTY=1]="DIRTY",s[s.PENDING_SAVE=2]="PENDING_SAVE",s[s.CONFLICT=3]="CONFLICT",s[s.ORPHAN=4]="ORPHAN",s[s.ERROR=5]="ERROR"})(qa||(qa={}));let mte=class extends SL{static{ST=this}get model(){return this._model}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w){super(t,r),this.typeId=e,this.name=i,this.modelFactory=n,this.externalResolver=o,this.logService=a,this.workingCopyFileService=c,this.filesConfigurationService=d,this.workingCopyBackupService=l,this.notificationService=g,this.workingCopyEditorService=m,this.editorService=v,this.elevatedFileService=_,this.progressService=w,this.capabilities=WE.None,this._model=void 0,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidResolve=this._register(new M),this.onDidResolve=this._onDidResolve.event,this._onDidChangeDirty=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidSaveError=this._register(new M),this.onDidSaveError=this._onDidSaveError.event,this._onDidSave=this._register(new M),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new M),this.onDidRevert=this._onDidRevert.event,this._onDidChangeReadonly=this._register(new M),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this.dirty=!1,this.ignoreDirtyOnModelContentChange=!1,this.versionId=0,this.lastContentChangeFromUndoRedo=void 0,this.saveSequentializer=new Iye,this.ignoreSaveFromSaveParticipants=!1,this.inConflictMode=!1,this.inErrorMode=!1,this._register(u.registerWorkingCopy(this)),this.registerListeners()}registerListeners(){this._register(this.filesConfigurationService.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))}isDirty(){return this.dirty}markModified(){this.setDirty(!0)}setDirty(e){if(!this.isResolved())return;const t=this.dirty;this.doSetDirty(e),e!==t&&this._onDidChangeDirty.fire()}doSetDirty(e){const t=this.dirty,i=this.inConflictMode,n=this.inErrorMode,o=this.savedVersionId;return e?this.dirty=!0:(this.dirty=!1,this.inConflictMode=!1,this.inErrorMode=!1,this.isResolved()&&(this.savedVersionId=this.model.versionId)),()=>{this.dirty=t,this.inConflictMode=i,this.inErrorMode=n,this.savedVersionId=o}}isResolved(){return!!this.model}async resolve(e){if(this.trace("resolve() - enter"),this.isDisposed()){this.trace("resolve() - exit - without resolving because file working copy is disposed");return}if(!e?.contents&&(this.dirty||this.saveSequentializer.isRunning())){this.trace("resolve() - exit - without resolving because file working copy is dirty or being saved");return}return this.doResolve(e)}async doResolve(e){if(e?.contents)return this.resolveFromBuffer(e.contents);if(!(!this.isResolved()&&await this.resolveFromBackup()))return this.resolveFromFile(e)}async resolveFromBuffer(e){this.trace("resolveFromBuffer()");let t,i,n,o;try{const r=await this.fileService.stat(this.resource);t=r.mtime,i=r.ctime,n=r.size,o=r.etag,this.setOrphaned(!1)}catch(r){t=Date.now(),i=Date.now(),n=0,o=VD,this.setOrphaned(r.fileOperationResult===Kn.FILE_NOT_FOUND)}return this.resolveFromContent({resource:this.resource,name:this.name,mtime:t,ctime:i,size:n,etag:o,value:e,readonly:!1,locked:!1},!0)}async resolveFromBackup(){const e=await this.workingCopyBackupService.resolve(this);return this.isResolved()?(this.trace("resolveFromBackup() - exit - withoutresolving because previously new file working copy got created meanwhile"),!0):e?(await this.doResolveFromBackup(e),!0):!1}async doResolveFromBackup(e){this.trace("doResolveFromBackup()"),await this.resolveFromContent({resource:this.resource,name:this.name,mtime:e.meta?e.meta.mtime:Date.now(),ctime:e.meta?e.meta.ctime:Date.now(),size:e.meta?e.meta.size:0,etag:e.meta?e.meta.etag:VD,value:e.value,readonly:!1,locked:!1},!0),e.meta&&e.meta.orphaned&&this.setOrphaned(!0)}async resolveFromFile(e){this.trace("resolveFromFile()");const t=e?.forceReadFromFile;let i;t?i=VD:this.lastResolvedFileStat&&(i=this.lastResolvedFileStat.etag);const n=this.versionId;try{const o=await this.fileService.readFileStream(this.resource,{etag:i,limits:e?.limits});if(this.setOrphaned(!1),n!==this.versionId){this.trace("resolveFromFile() - exit - without resolving because file working copy content changed");return}await this.resolveFromContent(o,!1)}catch(o){const r=o.fileOperationResult;if(this.setOrphaned(r===Kn.FILE_NOT_FOUND),this.isResolved()&&r===Kn.FILE_NOT_MODIFIED_SINCE){o instanceof Dye&&this.updateLastResolvedFileStat(o.stat);return}if(this.isResolved()&&r===Kn.FILE_NOT_FOUND&&!t)return;throw o}}async resolveFromContent(e,t){if(this.trace("resolveFromContent() - enter"),this.isDisposed()){this.trace("resolveFromContent() - exit - because working copy is disposed");return}this.updateLastResolvedFileStat({resource:this.resource,name:e.name,mtime:e.mtime,ctime:e.ctime,size:e.size,etag:e.etag,readonly:e.readonly,locked:e.locked,isFile:!0,isDirectory:!1,isSymbolicLink:!1,children:void 0}),this.isResolved()?await this.doUpdateModel(e.value):await this.doCreateModel(e.value),this.setDirty(!!t),this._onDidResolve.fire()}async doCreateModel(e){this.trace("doCreateModel()"),this._model=this._register(await this.modelFactory.createModel(this.resource,e,Ce.None)),this.installModelListeners(this._model)}async doUpdateModel(e){this.trace("doUpdateModel()"),this.ignoreDirtyOnModelContentChange=!0;try{await this.model?.update(e,Ce.None)}finally{this.ignoreDirtyOnModelContentChange=!1}}installModelListeners(e){this._register(e.onDidChangeContent(t=>this.onModelContentChanged(e,t.isUndoing||t.isRedoing))),this._register(e.onWillDispose(()=>this.dispose()))}onModelContentChanged(e,t){if(this.trace("onModelContentChanged() - enter"),this.versionId++,this.trace(`onModelContentChanged() - new versionId ${this.versionId}`),t&&(this.lastContentChangeFromUndoRedo=Date.now()),!this.ignoreDirtyOnModelContentChange&&!this.isReadonly())if(e.versionId===this.savedVersionId){this.trace("onModelContentChanged() - model content changed back to last saved version");const i=this.dirty;this.setDirty(!1),i&&this._onDidRevert.fire()}else this.trace("onModelContentChanged() - model content changed and marked as dirty"),this.setDirty(!0);this._onDidChangeContent.fire()}async forceResolveFromFile(){this.isDisposed()||await this.externalResolver({forceReadFromFile:!0})}get backupDelay(){return this.model?.configuration?.backupDelay}async backup(e){let t;this.lastResolvedFileStat&&(t={mtime:this.lastResolvedFileStat.mtime,ctime:this.lastResolvedFileStat.ctime,size:this.lastResolvedFileStat.size,etag:this.lastResolvedFileStat.etag,orphaned:this.isOrphaned()});let i;return this.isResolved()&&(i=await Sh(this.model.snapshot(LL.Backup,e),e)),{meta:t,content:i}}static{this.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD=500}async save(e=Object.create(null)){return this.isResolved()?this.isReadonly()?(this.trace("save() - ignoring request for readonly resource"),!1):(this.hasState(qa.CONFLICT)||this.hasState(qa.ERROR))&&(e.reason===gi.AUTO||e.reason===gi.FOCUS_CHANGE||e.reason===gi.WINDOW_CHANGE)?(this.trace("save() - ignoring auto save request for file working copy that is in conflict or error"),!1):(this.trace("save() - enter"),await this.doSave(e),this.trace("save() - exit"),this.hasState(qa.SAVED)):!1}async doSave(e){typeof e.reason!="number"&&(e.reason=gi.EXPLICIT);const t=this.versionId;if(this.trace(`doSave(${t}) - enter with versionId ${t}`),this.ignoreSaveFromSaveParticipants){this.trace(`doSave(${t}) - exit - refusing to save() recursively from save participant`);return}if(this.saveSequentializer.isRunning(t))return this.trace(`doSave(${t}) - exit - found a running save for versionId ${t}`),this.saveSequentializer.running;if(!e.force&&!this.dirty){this.trace(`doSave(${t}) - exit - because not dirty and/or versionId is different (this.isDirty: ${this.dirty}, this.versionId: ${this.versionId})`);return}if(this.saveSequentializer.isRunning())return this.trace(`doSave(${t}) - exit - because busy saving`),this.saveSequentializer.cancelRunning(),this.saveSequentializer.queue(()=>this.doSave(e));this.isResolved()&&this.model.pushStackElement();const i=new li;return this.progressService.withProgress({title:h(12921,"Saving '{0}'",this.name),location:Xo.Window,cancellable:!0,delay:this.isDirty()?3e3:5e3},n=>this.doSaveSequential(t,e,n,i),()=>{i.cancel()}).finally(()=>{i.dispose()})}doSaveSequential(e,t,i,n){return this.saveSequentializer.run(e,(async()=>{if(this.isResolved()&&!t.skipSaveParticipants&&this.workingCopyFileService.hasSaveParticipants)try{if(t.reason===gi.AUTO&&typeof this.lastContentChangeFromUndoRedo=="number"){const a=Date.now()-this.lastContentChangeFromUndoRedo;a<ST.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD&&await Da(ST.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD-a)}if(!n.token.isCancellationRequested){this.ignoreSaveFromSaveParticipants=!0;try{await this.workingCopyFileService.runSaveParticipants(this,{reason:t.reason??gi.EXPLICIT,savedFrom:t.from},i,n.token)}catch(a){ys(a)&&!n.token.isCancellationRequested&&n.cancel()}finally{this.ignoreSaveFromSaveParticipants=!1}}}catch(a){this.logService.error(`[stored file working copy] runSaveParticipants(${e}) - resulted in an error: ${a.toString()}`,this.resource.toString(),this.typeId)}if(n.token.isCancellationRequested||this.isDisposed()||!this.isResolved())return;e=this.versionId,this.inErrorMode=!1,i.report({message:h(12922,"Writing into file...")}),this.trace(`doSave(${e}) - before write()`);const o=jt(this.lastResolvedFileStat),r=this;return this.saveSequentializer.run(e,(async()=>{try{const a={mtime:o.mtime,etag:t.ignoreModifiedSince||!this.filesConfigurationService.preventSaveConflicts(o.resource)?VD:o.etag,unlock:t.writeUnlock};let c;if(typeof r.model.save=="function")try{c=await r.model.save(a,n.token)}catch(d){if(n.token.isCancellationRequested)return;throw d}else{const d=await Sh(r.model.snapshot(LL.Save,n.token),n.token);if(n.token.isCancellationRequested)return;n.dispose(),t?.writeElevated&&this.elevatedFileService.isSupported(o.resource)?c=await this.elevatedFileService.writeFileElevated(o.resource,jt(d),a):c=await this.fileService.writeFile(o.resource,jt(d),a)}this.handleSaveSuccess(c,e,t)}catch(a){this.handleSaveError(a,e,t)}})(),()=>n.cancel())})(),()=>n.cancel())}handleSaveSuccess(e,t,i){this.updateLastResolvedFileStat(e),t===this.versionId?(this.trace(`handleSaveSuccess(${t}) - setting dirty to false because versionId did not change`),this.setDirty(!1)):this.trace(`handleSaveSuccess(${t}) - not setting dirty to false because versionId did change meanwhile`),this.setOrphaned(!1),this._onDidSave.fire({reason:i.reason,stat:e,source:i.source})}handleSaveError(e,t,i){if((i.ignoreErrorHandler?this.logService.trace:this.logService.error).apply(this.logService,[`[stored file working copy] handleSaveError(${t}) - exit - resulted in a save error: ${e.toString()}`,this.resource.toString(),this.typeId]),i.ignoreErrorHandler)throw e;this.setDirty(!0),this.inErrorMode=!0,e.fileOperationResult===Kn.FILE_MODIFIED_SINCE&&(this.inConflictMode=!0),this.doHandleSaveError(e,i),this._onDidSaveError.fire()}doHandleSaveError(e,t){const i=e,n=[];let o;if(i.fileOperationResult===Kn.FILE_MODIFIED_SINCE)o=h(12923,"Failed to save '{0}': The content of the file is newer. Do you want to overwrite the file with your changes?",this.name),n.push(Ri({id:"fileWorkingCopy.overwrite",label:h(12924,"Overwrite"),run:()=>this.save({...t,ignoreModifiedSince:!0,reason:gi.EXPLICIT})})),n.push(Ri({id:"fileWorkingCopy.revert",label:h(12925,"Revert"),run:()=>this.revert()}));else{const c=i.fileOperationResult===Kn.FILE_WRITE_LOCKED,d=c&&i.options?.unlock,l=i.fileOperationResult===Kn.FILE_PERMISSION_DENIED,u=this.elevatedFileService.isSupported(this.resource);kye(e)&&n.push(...e.actions),u&&(l||d)?n.push(Ri({id:"fileWorkingCopy.saveElevated",label:d?bn?h(12926,"Overwrite as Admin..."):h(12927,"Overwrite as Sudo..."):bn?h(12928,"Retry as Admin..."):h(12929,"Retry as Sudo..."),run:()=>{this.save({...t,writeElevated:!0,writeUnlock:d,reason:gi.EXPLICIT})}})):c?n.push(Ri({id:"fileWorkingCopy.unlock",label:h(12924,"Overwrite"),run:()=>this.save({...t,writeUnlock:!0,reason:gi.EXPLICIT})})):n.push(Ri({id:"fileWorkingCopy.retry",label:h(12930,"Retry"),run:()=>this.save({...t,reason:gi.EXPLICIT})})),n.push(Ri({id:"fileWorkingCopy.saveAs",label:h(12931,"Save As..."),run:async()=>{const g=this.workingCopyEditorService.findEditor(this);g&&((await this.editorService.save(g,{saveAs:!0,reason:gi.EXPLICIT})).success||this.doHandleSaveError(e,t))}})),n.push(Ri({id:"fileWorkingCopy.revert",label:h(12925,"Revert"),run:()=>this.revert()})),c?d&&u?o=bn?h(12932,"Failed to save '{0}': File is read-only. Select 'Overwrite as Admin' to retry as administrator.",this.name):h(12933,"Failed to save '{0}': File is read-only. Select 'Overwrite as Sudo' to retry as superuser.",this.name):o=h(12934,"Failed to save '{0}': File is read-only. Select 'Overwrite' to attempt to make it writeable.",this.name):u&&l?o=bn?h(12935,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Admin' to retry as administrator.",this.name):h(12936,"Failed to save '{0}': Insufficient permissions. Select 'Retry as Sudo' to retry as superuser.",this.name):o=h(12937,"Failed to save '{0}': {1}",this.name,bo(e,!1))}const r=this.notificationService.notify({id:`${lc(this.resource.toString())}`,severity:Fe.Error,message:o,actions:{primary:n}}),a=this._register(T.once(T.any(this.onDidSave,this.onDidRevert))(()=>r.close()));this._register(T.once(r.onDidClose)(()=>a.dispose()))}updateLastResolvedFileStat(e){const t=this.isReadonly();this.lastResolvedFileStat?this.lastResolvedFileStat.mtime<=e.mtime?this.lastResolvedFileStat=e:this.lastResolvedFileStat={...this.lastResolvedFileStat,readonly:e.readonly,locked:e.locked}:this.lastResolvedFileStat=e,this.isReadonly()!==t&&this._onDidChangeReadonly.fire()}async revert(e){if(!this.isResolved()||!this.dirty&&!e?.force)return;this.trace("revert()");const t=this.dirty,i=this.doSetDirty(!1);if(!e?.soft)try{await this.forceResolveFromFile()}catch(o){if(o.fileOperationResult!==Kn.FILE_NOT_FOUND)throw i(),o}this._onDidRevert.fire(),t&&this._onDidChangeDirty.fire()}hasState(e){switch(e){case qa.CONFLICT:return this.inConflictMode;case qa.DIRTY:return this.dirty;case qa.ERROR:return this.inErrorMode;case qa.ORPHAN:return this.isOrphaned();case qa.PENDING_SAVE:return this.saveSequentializer.isRunning();case qa.SAVED:return!this.dirty}}async joinState(e){return this.saveSequentializer.running}isReadonly(){return this.filesConfigurationService.isReadonly(this.resource,this.lastResolvedFileStat)}trace(e){this.logService.trace(`[stored file working copy] ${e}`,this.resource.toString(),this.typeId)}dispose(){this.trace("dispose()"),this.inConflictMode=!1,this.inErrorMode=!1,this._model=void 0,super.dispose()}};mte=ST=f([p(5,je),p(6,Re),p(7,dg),p(8,Us),p(9,cq),p(10,lg),p(11,Dt),p(12,iae),p(13,de),p(14,ioe),p(15,pl)],mte);var B_;let vte=B_=class extends Gv{constructor(e,t,i,n,o,r){super(),this.resource=e,this._hasAssociatedFilePath=t,this.viewType=i,this._workingCopyManager=n,this._filesConfigurationService=r,this._onDidChangeDirty=this._register(new M),this._onDidSave=this._register(new M),this._onDidChangeOrphaned=this._register(new M),this._onDidChangeReadonly=this._register(new M),this._onDidRevertUntitled=this._register(new M),this.onDidChangeDirty=this._onDidChangeDirty.event,this.onDidSave=this._onDidSave.event,this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this.onDidChangeReadonly=this._onDidChangeReadonly.event,this.onDidRevertUntitled=this._onDidRevertUntitled.event,this._workingCopyListeners=this._register(new U),this.scratchPad=o}dispose(){this._workingCopy?.dispose(),super.dispose()}get notebook(){return this._workingCopy?.model?.notebookModel}isResolved(){return!!this._workingCopy?.model?.notebookModel}async canDispose(){return this._workingCopy&&B_._isStoredFileWorkingCopy(this._workingCopy)?this._workingCopyManager.stored.canDispose(this._workingCopy):!0}isDirty(){return this._workingCopy?.isDirty()??!1}isModified(){return this._workingCopy?.isModified()??!1}isOrphaned(){return B_._isStoredFileWorkingCopy(this._workingCopy)&&this._workingCopy.hasState(qa.ORPHAN)}hasAssociatedFilePath(){return!B_._isStoredFileWorkingCopy(this._workingCopy)&&!!this._workingCopy?.hasAssociatedFilePath}isReadonly(){return B_._isStoredFileWorkingCopy(this._workingCopy)?this._workingCopy?.isReadonly():this._filesConfigurationService.isReadonly(this.resource)}get hasErrorState(){return this._workingCopy&&"hasState"in this._workingCopy?this._workingCopy.hasState(qa.ERROR):!1}async revert(e){return yt(this.isResolved()),this._workingCopy.revert(e)}async save(e){return yt(this.isResolved()),this._workingCopy.save(e)}async load(e){return!this._workingCopy||!this._workingCopy.model?(this.resource.scheme===ae.untitled?(this._hasAssociatedFilePath?this._workingCopy=await this._workingCopyManager.resolve({associatedResource:this.resource}):this._workingCopy=await this._workingCopyManager.resolve({untitledResource:this.resource,isScratchpad:this.scratchPad}),this._register(this._workingCopy.onDidRevert(()=>this._onDidRevertUntitled.fire()))):(this._workingCopy=await this._workingCopyManager.resolve(this.resource,{limits:e?.limits,reload:e?.forceReadFromFile?{async:!1,force:!0}:void 0}),this._workingCopyListeners.add(this._workingCopy.onDidSave(t=>this._onDidSave.fire(t))),this._workingCopyListeners.add(this._workingCopy.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire())),this._workingCopyListeners.add(this._workingCopy.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))),this._workingCopyListeners.add(this._workingCopy.onDidChangeDirty(()=>this._onDidChangeDirty.fire(),void 0)),this._workingCopyListeners.add(this._workingCopy.onWillDispose(()=>{this._workingCopyListeners.clear(),this._workingCopy?.model?.dispose()}))):await this._workingCopyManager.resolve(this.resource,{reload:{async:!e?.forceReadFromFile,force:e?.forceReadFromFile},limits:e?.limits}),yt(this.isResolved()),this}async saveAs(e){const t=await this._workingCopyManager.saveAs(this.resource,e);if(t)return{resource:t.resource}}static _isStoredFileWorkingCopy(e){return!(e&&e.capabilities&WE.Untitled)}};vte=B_=f([p(5,Us)],vte);class kge extends F{constructor(e,t,i,n,o){super(),this._notebookModel=e,this._notebookService=t,this._configurationService=i,this._telemetryService=n,this._notebookLogService=o,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this.configuration=void 0,this.onWillDispose=e.onWillDispose.bind(e),this._register(e.onDidChangeContent(a=>{for(const c of a.rawEvents)if(c.kind!==Nc.Initialize&&!c.transient){this._onDidChangeContent.fire({isRedoing:!1,isUndoing:!1,isInitial:!1});break}}));const r=this._configurationService.getValue(Moe.remoteSaving);(r||e.uri.scheme===ae.vscodeRemote)&&(this.configuration={backupDelay:1e4}),r&&this.setSaveDelegate().catch(console.error)}async setSaveDelegate(){await this.getNotebookSerializer(),this.save=async(e,t)=>{try{let i=this._notebookService.tryGetDataProviderSync(this.notebookModel.viewType)?.serializer;if(i||(this._notebookLogService.info("WorkingCopyModel","No serializer found for notebook model, checking if provider still needs to be resolved"),i=await this.getNotebookSerializer()),t.isCancellationRequested)throw new fo;return await i.save(this._notebookModel.uri,this._notebookModel.versionId,e,t)}catch(i){if(!t.isCancellationRequested){const n=this._notebookModel.viewType==="jupyter-notebook"||this._notebookModel.viewType==="interactive";this._telemetryService.publicLogError2("notebook/SaveError",{isRemote:this._notebookModel.uri.scheme===ae.vscodeRemote,isIPyNbWorkerSerializer:n&&this._configurationService.getValue("ipynb.experimental.serialization"),error:i})}throw i}}}dispose(){this._notebookModel.dispose(),super.dispose()}get notebookModel(){return this._notebookModel}async snapshot(e,t){return this._notebookService.createNotebookTextDocumentSnapshot(this._notebookModel.uri,e,t)}async update(e,t){const i=await this.getNotebookSerializer(),n=await Tye(e),o=await i.dataToNotebook(n);if(t.isCancellationRequested)throw new fo;this._notebookLogService.info("WorkingCopyModel","Notebook content updated from file system - "+this._notebookModel.uri.toString()),this._notebookModel.reset(o.cells,o.metadata,i.options)}async getNotebookSerializer(){const e=await this._notebookService.withNotebookDataProvider(this.notebookModel.viewType);if(!(e instanceof CO))throw new Error("CANNOT open file notebook with this provider");return e.serializer}get versionId(){return this._notebookModel.alternativeVersionId}pushStackElement(){this._notebookModel.pushStackElement()}}let _te=class{constructor(e,t,i,n,o){this._viewType=e,this._notebookService=t,this._configurationService=i,this._telemetryService=n,this._notebookLogService=o}async createModel(e,t,i){const n=this._notebookService.getNotebookTextModel(e)??await this._notebookService.createNotebookTextModel(this._viewType,e,t);return new kge(n,this._notebookService,this._configurationService,this._telemetryService,this._notebookLogService)}};_te=f([p(1,bl),p(2,ne),p(3,ai),p(4,kre)],_te);class eHe{constructor(e){this._proxy=e.getProxy(Ze.ExtHostNotebookDocumentSaveParticipant)}async participate(e,t,i,n){if(!e.model||!(e.model instanceof kge))return;let o;const r=new Promise((a,c)=>{o=setTimeout(()=>c(new Error(h(2430,"Aborted onWillSaveNotebookDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason,n).then(d=>{clearTimeout(o)}).then(a,c)});return KM(r,n)}}let bte=class{constructor(e,t,i){this.workingCopyFileService=i,this._saveParticipantDisposable=this.workingCopyFileService.addSaveParticipant(t.createInstance(eHe,e))}dispose(){this._saveParticipantDisposable.dispose()}};bte=f([c_,p(1,Z),p(2,dg)],bte);let yte=class{constructor(e,t){this._disposables=new U,this._proxy=e.getProxy(Ze.ExtHostInteractive),this._disposables.add(t.onWillAddInteractiveDocument(i=>{this._proxy.$willAddInteractiveDocument(i.inputUri,`
`,WM,i.notebookUri)})),this._disposables.add(t.onWillRemoveInteractiveDocument(i=>{this._proxy.$willRemoveInteractiveDocument(i.inputUri,i.notebookUri)}))}dispose(){this._disposables.dispose()}};yte=f([ht(qe.MainThreadInteractive),p(1,Oq)],yte);var Gl;(function(s){s.Changed="changed",s.ProcessStarted="processStarted",s.ProcessEnded="processEnded",s.Terminated="terminated",s.Start="start",s.AcquiredInput="acquiredInput",s.DependsOnStarted="dependsOnStarted",s.Active="active",s.Inactive="inactive",s.End="end",s.ProblemMatcherStarted="problemMatcherStarted",s.ProblemMatcherEnded="problemMatcherEnded",s.ProblemMatcherFoundErrors="problemMatcherFoundErrors"})(Gl||(Gl={}));var ML;(function(s){function e(t){return{id:t.id,task:ar.from(t.task)}}s.from=e})(ML||(ML={}));var W3;(function(s){function e(t){return{execution:{id:t.execution.id,task:ar.from(t.execution.task)}}}s.from=e})(W3||(W3={}));var NL;(function(s){function e(t){return{execution:{id:t.execution.id,task:ar.from(t.execution.task)},hasErrors:t.hasErrors}}s.from=e})(NL||(NL={}));var B3;(function(s){function e(t,i){return{id:t.id,processId:i}}s.from=e})(B3||(B3={}));var V3;(function(s){function e(t,i){return{id:t.id,exitCode:i}}s.from=e})(V3||(V3={}));var OL;(function(s){function e(i){const n=Object.assign(Object.create(null),i);return delete n._key,n}s.from=e;function t(i,n){let o=wV.createTaskIdentifier(i,console);return o===void 0&&n&&(o={_key:Pn(),type:"$executeOnly"}),o}s.to=t})(OL||(OL={}));var FL;(function(s){function e(i){if(i!=null)return Object.assign(Object.create(null),i)}s.from=e;function t(i){return i==null?CR.defaults:Object.assign(Object.create(null),CR.defaults,i)}s.to=t})(FL||(FL={}));var WL;(function(s){function e(i){if(i!=null)return Object.assign(Object.create(null),i)}s.from=e;function t(i){return i==null?ER.defaults:Object.assign(Object.create(null),ER.defaults,i)}s.to=t})(WL||(WL={}));var BL;(function(s){function e(i){if(i!=null)return{cwd:i.cwd,env:i.env}}s.from=e;function t(i){return i==null?dx.defaults:{cwd:i.cwd||dx.defaults.cwd,env:i.env}}s.to=t})(BL||(BL={}));var gE;(function(s){function e(n){const o=n;return o&&!!o.process}s.is=e;function t(n){const o=Tt(n.name)?n.name:n.name.value,r=n.args?n.args.map(c=>Tt(c)?c:c.value):[],a={process:o,args:r};return n.options&&(a.options=BL.from(n.options)),a}s.from=t;function i(n){const o={runtime:dc.Process,name:n.process,args:n.args,presentation:void 0};return o.options=BL.to(n.options),o}s.to=i})(gE||(gE={}));var VL;(function(s){function e(i){if(i==null)return;const n={cwd:i.cwd||dx.defaults.cwd,env:i.env};return i.shell&&(n.executable=i.shell.executable,n.shellArgs=i.shell.args,n.shellQuoting=i.shell.quoting),n}s.from=e;function t(i){if(i==null)return;const n={cwd:i.cwd,env:i.env};return i.executable&&(n.shell={executable:i.executable},i.shellArgs&&(n.shell.args=i.shellArgs),i.shellQuoting&&(n.shell.quoting=i.shellQuoting)),n}s.to=t})(VL||(VL={}));var pE;(function(s){function e(n){const o=n;return o&&(!!o.commandLine||!!o.command)}s.is=e;function t(n){const o={};return n.name&&Tt(n.name)&&(n.args===void 0||n.args===null||n.args.length===0)?o.commandLine=n.name:(o.command=n.name,o.args=n.args),n.options&&(o.options=VL.from(n.options)),o}s.from=t;function i(n){const o={runtime:dc.Shell,name:n.commandLine?n.commandLine:n.command,args:n.args,presentation:void 0};return n.options&&(o.options=VL.to(n.options)),o}s.to=i})(pE||(pE={}));var Cm;(function(s){function e(n){const o=n;return o&&o.customExecution==="customExecution"}s.is=e;function t(n){return{customExecution:"customExecution"}}s.from=t;function i(n){return{runtime:dc.CustomExecution,presentation:void 0}}s.to=i})(Cm||(Cm={}));var HL;(function(s){function e(i){const n={label:i.label};return i.kind===Tu.Extension?(n.extensionId=i.extension,i.workspaceFolder?n.scope=i.workspaceFolder.uri:n.scope=i.scope):i.kind===Tu.Workspace&&(n.extensionId="$core",n.scope=i.config.workspaceFolder?i.config.workspaceFolder.uri:ep.Global),n}s.from=e;function t(i,n){let o,r;return i.scope===void 0||typeof i.scope=="number"&&i.scope!==ep.Global?n.getWorkspace().folders.length===0?(o=ep.Global,r=void 0):(o=ep.Folder,r=n.getWorkspace().folders[0]):typeof i.scope=="number"?o=i.scope:(o=ep.Folder,r=n.getWorkspaceFolder(R.revive(i.scope))??void 0),{kind:Tu.Extension,label:i.label,extension:i.extensionId,scope:o,workspaceFolder:r}}s.to=t})(HL||(HL={}));var UL;(function(s){function e(t){const i=t;return i&&Tt(i.id)&&!!i.workspaceFolder}s.is=e})(UL||(UL={}));var ar;(function(s){function e(i){if(i==null||!BC.is(i)&&!Lm.is(i)&&!VC.is(i))return;const n={_id:i._id,name:i.configurationProperties.name,definition:OL.from(i.getDefinition(!0)),source:HL.from(i._source),execution:void 0,presentationOptions:!VC.is(i)&&i.command?FL.from(i.command.presentation):void 0,isBackground:i.configurationProperties.isBackground,problemMatchers:[],hasDefinedMatchers:Lm.is(i)?i.hasDefinedMatchers:!1,runOptions:WL.from(i.runOptions)};if(n.group=H3.from(i.configurationProperties.group),i.configurationProperties.detail&&(n.detail=i.configurationProperties.detail),!VC.is(i)&&i.command)switch(i.command.runtime){case dc.Process:n.execution=gE.from(i.command);break;case dc.Shell:n.execution=pE.from(i.command);break;case dc.CustomExecution:n.execution=Cm.from(i.command);break}if(i.configurationProperties.problemMatchers)for(const o of i.configurationProperties.problemMatchers)Tt(o)&&n.problemMatchers.push(o);return n}s.from=e;function t(i,n,o,r,a){if(!i||typeof i.name!="string")return;let c;if(i.execution&&(pE.is(i.execution)?c=pE.to(i.execution):gE.is(i.execution)?c=gE.to(i.execution):Cm.is(i.execution)&&(c=Cm.to(i.execution))),!c)return;c.presentation=FL.to(i.presentationOptions);const d=HL.to(i.source,n),l=h(2436,"{0}: {1}",d.label,i.name),u=OL.to(i.definition,o),g=Cm.is(i.execution)&&i._id?i._id:`${i.source.extensionId}.${u._key}`;return new Lm(g,d,l,u.type,u,c,i.hasDefinedMatchers,WL.to(i.runOptions),{name:i.name,identifier:l,group:i.group,isBackground:!!i.isBackground,problemMatchers:i.problemMatchers.slice(),detail:i.detail,icon:r,hide:a})}s.to=t})(ar||(ar={}));var H3;(function(s){function e(t){if(t!==void 0)return{_id:typeof t=="string"?t:t._id,isDefault:typeof t=="string"||typeof t.isDefault=="string"?!1:t.isDefault}}s.from=e})(H3||(H3={}));var U3;(function(s){function e(i){return i}s.from=e;function t(i){return i}s.to=t})(U3||(U3={}));let wte=class extends F{constructor(e,t,i,n){super(),this._taskService=t,this._workspaceContextServer=i,this._configurationResolverService=n,this._proxy=e.getProxy(Ze.ExtHostTask),this._providers=new Map,this._register(this._taskService.onDidStateChange(async o=>{if(o.kind===Gl.Changed)return;const r=o.__task;if(o.kind===Gl.Start){const a=ML.from(r.getTaskExecution());let c=a.task.definition;if(a.task?.execution&&Cm.is(a.task.execution)&&o.resolvedVariables){const d=_Ce.parse(a.task.definition);for(const l of d.unresolved()){const u=o.resolvedVariables.get(l.inner);u!==void 0&&d.resolve(l,u)}c=await this._configurationResolverService.resolveAsync(r.getWorkspaceFolder(),d)}this._proxy.$onDidStartTask(a,o.terminalId,c)}else o.kind===Gl.ProcessStarted?this._proxy.$onDidStartTaskProcess(B3.from(r.getTaskExecution(),o.processId)):o.kind===Gl.ProcessEnded?this._proxy.$onDidEndTaskProcess(V3.from(r.getTaskExecution(),o.exitCode)):o.kind===Gl.End?this._proxy.$OnDidEndTask(ML.from(r.getTaskExecution())):o.kind===Gl.ProblemMatcherStarted?this._proxy.$onDidStartTaskProblemMatchers(W3.from({execution:r.getTaskExecution()})):o.kind===Gl.ProblemMatcherEnded?this._proxy.$onDidEndTaskProblemMatchers(NL.from({execution:r.getTaskExecution(),hasErrors:!1})):o.kind===Gl.ProblemMatcherFoundErrors&&this._proxy.$onDidEndTaskProblemMatchers(NL.from({execution:r.getTaskExecution(),hasErrors:!0}))}))}dispose(){for(const e of this._providers.values())e.disposable.dispose();this._providers.clear(),super.dispose()}$createTaskId(e){return new Promise((t,i)=>{const n=ar.to(e,this._workspaceContextServer,!0);n?t(n._id):i(new Error("Task could not be created from DTO"))})}$registerTaskProvider(e,t){const i={provideTasks:o=>Promise.resolve(this._proxy.$provideTasks(e,o)).then(r=>{const a=[];for(const d of r.tasks){const l=ar.to(d,this._workspaceContextServer,!0);l?a.push(l):console.error(`Task System: can not convert task: ${JSON.stringify(d.definition,void 0,0)}. Task will be dropped`)}const c={...r.extension,extensionLocation:R.revive(r.extension.extensionLocation)};return{tasks:a,extension:c}}),resolveTask:o=>{const r=ar.from(o);return r?(r.name=r.name===void 0?"":r.name,Promise.resolve(this._proxy.$resolveTask(e,r)).then(a=>{if(a)return ar.to(a,this._workspaceContextServer,!0,o.configurationProperties.icon,o.configurationProperties.hide)})):Promise.resolve(void 0)}},n=this._taskService.registerTaskProvider(i,t);return this._providers.set(e,{disposable:n,provider:i}),Promise.resolve(void 0)}$unregisterTaskProvider(e){const t=this._providers.get(e);return t&&(t.disposable.dispose(),this._providers.delete(e)),Promise.resolve(void 0)}$fetchTasks(e){return this._taskService.tasks(U3.to(e)).then(t=>{const i=[];for(const n of t){const o=ar.from(n);o&&i.push(o)}return i})}getWorkspace(e){let t;if(typeof e=="string")t=e;else{const i=this._workspaceContextServer.getWorkspace(),n=R.revive(e);i.configuration?.toString()===n.toString()?t=i:t=this._workspaceContextServer.getWorkspaceFolder(n)}return t}async $getTaskExecution(e){if(UL.is(e)){const t=this.getWorkspace(e.workspaceFolder);if(t){const i=await this._taskService.getTask(t,e.id,!0);if(i)return{id:i._id,task:ar.from(i)};throw new Error("Task not found")}else throw new Error("No workspace folder")}else{const t=ar.to(e,this._workspaceContextServer,!0);return{id:t._id,task:ar.from(t)}}}$executeTask(e){return new Promise((t,i)=>{if(UL.is(e)){const n=this.getWorkspace(e.workspaceFolder);n?this._taskService.getTask(n,e.id,!0).then(o=>{if(!o)i(new Error("Task not found"));else{const r={id:e.id,task:ar.from(o)};this._taskService.run(o).then(a=>{(a?.exitCode===void 0||a.exitCode!==0)&&this._proxy.$OnDidEndTask(r)},a=>{}),t(r)}},o=>{i(new Error("Task not found"))}):i(new Error("No workspace folder"))}else{const n=ar.to(e,this._workspaceContextServer,!0);this._taskService.run(n).then(void 0,r=>{});const o={id:n._id,task:ar.from(n)};t(o)}})}$customExecutionComplete(e,t){return new Promise((i,n)=>{this._taskService.getActiveTasks().then(o=>{for(const r of o)if(e===r._id){this._taskService.extensionCallbackTaskComplete(r,t).then(a=>{i(void 0)},a=>{n(a)});return}n(new Error("Task to mark as complete not found"))})})}$terminateTask(e){return new Promise((t,i)=>{this._taskService.getActiveTasks().then(n=>{for(const o of n)if(e===o._id){this._taskService.terminate(o).then(r=>{t(void 0)},r=>{i(void 0)});return}i(new fr("Task to terminate not found"))})})}$registerTaskSystem(e,t){let i;switch(t.platform){case"Web":i=HD.Web;break;case"win32":i=HD.Windows;break;case"darwin":i=HD.Mac;break;case"linux":i=HD.Linux;break;default:i=Aye}this._taskService.registerTaskSystem(e,{platform:i,uriProvider:n=>R.from({scheme:t.scheme,authority:t.authority,path:n}),context:this._extHostContext,resolveVariables:(n,o,r)=>{const a=[];return o.variables.forEach(c=>a.push(c)),Promise.resolve(this._proxy.$resolveVariables(n.uri,{process:o.process,variables:a})).then(c=>{const d=Array.from(Object.values(c.variables));return new Promise((l,u)=>{this._configurationResolverService.resolveWithInteraction(n,d,"tasks",void 0,r).then(g=>{g||l(void 0);const m={process:void 0,variables:new Map};for(let v=0;v<d.length;v++){const _=a[v].substring(2,a[v].length-1);if(g&&c.variables[a[v]]===a[v]){const w=g.get(_);typeof w=="string"&&m.variables.set(_,w)}else m.variables.set(_,d[v])}Tt(c.process)&&(m.process=c.process),l(m)},g=>{u(g)})})})},findExecutable:(n,o,r)=>this._proxy.$findExecutable(n,o,r)})}async $registerSupportedExecutions(e,t,i){return this._taskService.registerSupportedExecutions(e,t,i)}};wte=f([ht(qe.MainThreadTask),p(1,Lre),p(2,It),p(3,toe)],wte);let Ste=class extends F{constructor(e,t){super(),this._labelService=t,this._resourceLabelFormatters=this._register(new ti)}$registerResourceLabelFormatter(e,t){t.priority=!0;const i=this._labelService.registerCachedFormatter(t);this._resourceLabelFormatters.set(e,i)}$unregisterResourceLabelFormatter(e){this._resourceLabelFormatters.deleteAndDispose(e)}};Ste=f([ht(qe.MainThreadLabelService),p(1,ui)],Ste);let Cte=class extends F{constructor(e,t,i,n,o,r,a,c){super(),this.remoteExplorerService=t,this.tunnelService=i,this.notificationService=n,this.configurationService=o,this.logService=r,this.remoteAgentService=a,this.contextKeyService=c,this.elevateionRetry=!1,this.portsAttributesProviders=new Map,this._alreadyRegistered=!1,this._proxy=e.getProxy(Ze.ExtHostTunnelService),this._register(i.onTunnelOpened(()=>this._proxy.$onDidTunnelsChange())),this._register(i.onTunnelClosed(()=>this._proxy.$onDidTunnelsChange()))}processFindingEnabled(){return(!!this.configurationService.getValue(Dj)||this.tunnelService.hasTunnelProvider)&&this.configurationService.getValue(kj)!==Tj}async $setRemoteTunnelService(e){this.remoteExplorerService.namedProcesses.set(e,"Code Extension Host"),this.remoteExplorerService.portsFeaturesEnabled===ku.AdditionalFeatures?this._proxy.$registerCandidateFinder(this.processFindingEnabled()):this._register(this.remoteExplorerService.onEnabledPortsFeatures(()=>this._proxy.$registerCandidateFinder(this.processFindingEnabled()))),this._register(this.configurationService.onDidChangeConfiguration(async t=>{if(this.remoteExplorerService.portsFeaturesEnabled===ku.AdditionalFeatures&&(t.affectsConfiguration(Dj)||t.affectsConfiguration(kj)))return this._proxy.$registerCandidateFinder(this.processFindingEnabled())})),this._register(this.tunnelService.onAddedTunnelProvider(async()=>{if(this.remoteExplorerService.portsFeaturesEnabled===ku.AdditionalFeatures)return this._proxy.$registerCandidateFinder(this.processFindingEnabled())}))}async $registerPortsAttributesProvider(e,t){this.portsAttributesProviders.set(t,e),this._alreadyRegistered||(this.remoteExplorerService.tunnelModel.addAttributesProvider(this),this._alreadyRegistered=!0)}async $unregisterPortsAttributesProvider(e){this.portsAttributesProviders.delete(e)}async providePortAttributes(e,t,i,n){if(this.portsAttributesProviders.size===0)return[];const o=Array.from(this.portsAttributesProviders.entries()).filter(r=>{const a=r[1],c=typeof a.portRange=="number"?[a.portRange,a.portRange+1]:a.portRange,d=c?e.some(u=>c[0]<=u&&u<c[1]):!0,l=!a.commandPattern||i&&i.match(a.commandPattern);return d&&l}).map(r=>r[0]);return o.length===0?[]:this._proxy.$providePortAttributes(o,e,t,i,n)}async $openTunnel(e,t){const i=await this.remoteExplorerService.forward({remote:e.remoteAddress,local:e.localAddressPort,name:e.label,source:{source:Yd.Extension,description:t},elevateIfNeeded:!1});if(!(!i||typeof i=="string"))return!this.elevateionRetry&&e.localAddressPort!==void 0&&i.tunnelLocalPort!==void 0&&this.tunnelService.isPortPrivileged(e.localAddressPort)&&i.tunnelLocalPort!==e.localAddressPort&&this.tunnelService.canElevate&&this.elevationPrompt(e,i,t),kR.fromServiceTunnel(i)}async elevationPrompt(e,t,i){return this.notificationService.prompt(Fe.Info,h(2437,"The extension {0} has forwarded port {1}. You'll need to run as superuser to use port {2} locally.",i,e.remoteAddress.port,e.localAddressPort),[{label:h(2438,"Use Port {0} as Sudo...",t.tunnelRemotePort),run:async()=>{this.elevateionRetry=!0,await this.remoteExplorerService.close({host:t.tunnelRemoteHost,port:t.tunnelRemotePort},Rm.Other),await this.remoteExplorerService.forward({remote:e.remoteAddress,local:e.localAddressPort,name:e.label,source:{source:Yd.Extension,description:i},elevateIfNeeded:!0}),this.elevateionRetry=!1}}])}async $closeTunnel(e){return this.remoteExplorerService.close(e,Rm.Other)}async $getTunnels(){return(await this.tunnelService.tunnels).map(e=>({remoteAddress:{port:e.tunnelRemotePort,host:e.tunnelRemoteHost},localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol}))}async $onFoundNewCandidates(e){this.remoteExplorerService.onFoundNewCandidates(e)}async $setTunnelProvider(e,t){const i={forwardPort:(n,o)=>this._proxy.$forwardPort(n,o).then(a=>{if(a){if(typeof a=="string")return a}else return;const c=a;return this.logService.trace(`ForwardedPorts: (MainThreadTunnelService) New tunnel established by tunnel provider: ${c?.remoteAddress.host}:${c?.remoteAddress.port}`),{tunnelRemotePort:c.remoteAddress.port,tunnelRemoteHost:c.remoteAddress.host,localAddress:typeof c.localAddress=="string"?c.localAddress:Kr(c.localAddress.host,c.localAddress.port),tunnelLocalPort:typeof c.localAddress!="string"?c.localAddress.port:void 0,public:c.public,privacy:c.privacy,protocol:c.protocol??Ha.Http,dispose:async d=>(this.logService.trace(`ForwardedPorts: (MainThreadTunnelService) Closing tunnel from tunnel provider: ${c?.remoteAddress.host}:${c?.remoteAddress.port}`),this._proxy.$closeTunnel({host:c.remoteAddress.host,port:c.remoteAddress.port},d))}})};e&&this.tunnelService.setTunnelFeatures(e),this.tunnelService.setTunnelProvider(i),t&&this.contextKeyService.createKey(MIe.key,!0)}async $setCandidateFilter(){this.remoteExplorerService.setCandidateFilter(e=>this._proxy.$applyCandidateFilter(e))}async $setCandidatePortSource(e){this.remoteAgentService.getEnvironment().then(()=>{switch(e){case MC.None:{Ke.as(Js.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPorts":!1}}]);break}case MC.Output:{Ke.as(Js.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPortsSource":Tj}}]);break}case MC.Hybrid:{Ke.as(Js.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPortsSource":WIe}}]);break}}}).catch(()=>{})}};Cte=f([ht(qe.MainThreadTunnelService),p(1,VN),p(2,TN),p(3,Dt),p(4,ne),p(5,Re),p(6,Lh),p(7,fe)],Cte);function Tge(s){return`onAuthenticationRequest:${s}`}async function tHe(s,e){const t=await s.get(`${e.urlProtocol}.loginAccount`);if(t)try{const i=JSON.parse(t);if(i&&Tt(i.id)&&Tt(i.accessToken)&&Tt(i.providerId))return i}catch(i){console.error(`Failed parsing current auth session value: ${i}`)}}const iHe={type:"object",additionalProperties:!1,properties:{id:{type:"string",description:h(12045,"The id of the authentication provider.")},label:{type:"string",description:h(12046,"The human readable name of the authentication provider.")}}},nHe=gl.registerExtensionPoint({extensionPoint:"authentication",jsonSchema:{description:h(12047,"Contributes authentication"),type:"array",items:iHe},activationEventsGenerator:(s,e)=>{for(const t of s)t.id&&e.push(`onAuthenticationRequest:${t.id}`)}});let Ete=class extends F{constructor(e,t,i,n){super(),this._extensionService=e,this._environmentService=i,this._logService=n,this._onDidRegisterAuthenticationProvider=this._register(new M),this.onDidRegisterAuthenticationProvider=this._onDidRegisterAuthenticationProvider.event,this._onDidUnregisterAuthenticationProvider=this._register(new M),this.onDidUnregisterAuthenticationProvider=this._onDidUnregisterAuthenticationProvider.event,this._onDidChangeSessions=this._register(new M),this.onDidChangeSessions=this._onDidChangeSessions.event,this._onDidChangeDeclaredProviders=this._register(new M),this.onDidChangeDeclaredProviders=this._onDidChangeDeclaredProviders.event,this._authenticationProviders=new Map,this._authenticationProviderDisposables=this._register(new ti),this._declaredProviders=[],this._register(t.onDidChangeExtensionSessionAccess(o=>{this._onDidChangeSessions.fire({providerId:o.providerId,label:o.accountName,event:{added:[],changed:[],removed:[]}})})),this._registerEnvContributedAuthenticationProviders(),this._registerAuthenticationExtentionPointHandler()}get declaredProviders(){return this._declaredProviders}_registerEnvContributedAuthenticationProviders(){if(this._environmentService.options?.authenticationProviders?.length)for(const e of this._environmentService.options.authenticationProviders)this.registerDeclaredAuthenticationProvider(e),this.registerAuthenticationProvider(e.id,e)}_registerAuthenticationExtentionPointHandler(){this._register(nHe.setHandler((e,{added:t,removed:i})=>{this._logService.debug(`Found authentication providers. added: ${t.length}, removed: ${i.length}`),t.forEach(o=>{for(const r of o.value){if(pu(r.id)){o.collector.error(h(12048,"An authentication contribution must specify an id."));continue}if(pu(r.label)){o.collector.error(h(12049,"An authentication contribution must specify a label."));continue}this.declaredProviders.some(a=>a.id===r.id)?o.collector.error(h(12050,"This authentication id '{0}' has already been registered",r.id)):(this.registerDeclaredAuthenticationProvider(r),this._logService.debug(`Declared authentication provider: ${r.id}`))}}),i.flatMap(o=>o.value).forEach(o=>{const r=this.declaredProviders.find(a=>a.id===o.id);r&&(this.unregisterDeclaredAuthenticationProvider(r.id),this._logService.debug(`Undeclared authentication provider: ${r.id}`))})}))}registerDeclaredAuthenticationProvider(e){if(pu(e.id))throw new Error(h(12048,"An authentication contribution must specify an id."));if(pu(e.label))throw new Error(h(12049,"An authentication contribution must specify a label."));if(this.declaredProviders.some(t=>t.id===e.id))throw new Error(h(12050,"This authentication id '{0}' has already been registered",e.id));this._declaredProviders.push(e),this._onDidChangeDeclaredProviders.fire()}unregisterDeclaredAuthenticationProvider(e){const t=this.declaredProviders.findIndex(i=>i.id===e);t>-1&&this.declaredProviders.splice(t,1),this._onDidChangeDeclaredProviders.fire()}isAuthenticationProviderRegistered(e){return this._authenticationProviders.has(e)}registerAuthenticationProvider(e,t){this._authenticationProviders.set(e,t);const i=new U;i.add(t.onDidChangeSessions(n=>this._onDidChangeSessions.fire({providerId:e,label:t.label,event:n}))),NM(t)&&i.add(t),this._authenticationProviderDisposables.set(e,i),this._onDidRegisterAuthenticationProvider.fire({id:e,label:t.label})}unregisterAuthenticationProvider(e){const t=this._authenticationProviders.get(e);t&&(this._authenticationProviders.delete(e),this._onDidUnregisterAuthenticationProvider.fire({id:e,label:t.label})),this._authenticationProviderDisposables.deleteAndDispose(e)}getProviderIds(){const e=[];return this._authenticationProviders.forEach(t=>{e.push(t.id)}),e}getProvider(e){if(this._authenticationProviders.has(e))return this._authenticationProviders.get(e);throw new Error(`No authentication provider '${e}' is currently registered.`)}async getAccounts(e){const t=await this.getSessions(e),i=new Array,n=new Set;for(const o of t)n.has(o.account.label)||(n.add(o.account.label),i.push(o.account));return i}async getSessions(e,t,i,n=!1){const o=this._authenticationProviders.get(e)||await this.tryActivateProvider(e,n);if(o)return await o.getSessions(t,{account:i});throw new Error(`No authentication provider '${e}' is currently registered.`)}async createSession(e,t,i){const n=this._authenticationProviders.get(e)||await this.tryActivateProvider(e,!!i?.activateImmediate);if(n)return await n.createSession(t,{account:i?.account});throw new Error(`No authentication provider '${e}' is currently registered.`)}async removeSession(e,t){const i=this._authenticationProviders.get(e);if(i)return i.removeSession(t);throw new Error(`No authentication provider '${e}' is currently registered.`)}async tryActivateProvider(e,t){await this._extensionService.activateByEvent(Tge(e),t?Op.Immediate:Op.Normal);let i=this._authenticationProviders.get(e);if(i)return i;const n=new U,o=new Promise((a,c)=>{n.add(T.once(this.onDidRegisterAuthenticationProvider)(d=>{if(d.id===e)if(i=this._authenticationProviders.get(e),i)a(i);else throw new Error(`No authentication provider '${e}' is currently registered.`)}))}),r=new Promise((a,c)=>{const d=setTimeout(()=>{c("Timed out waiting for authentication provider to register")},5e3);n.add(Ie(()=>clearTimeout(d)))});return Promise.race([o,r]).finally(()=>n.dispose())}};Ete=f([p(0,cn),p(1,FN),p(2,cf),p(3,Re)],Ete);class sHe extends F{constructor(e,t,i,n,o,r){super(),this._proxy=e,this.id=t,this.label=i,this.supportsMultipleAccounts=n,this.notificationService=o,this.onDidChangeSessions=r.event}async getSessions(e,t){return this._proxy.$getSessions(this.id,e,t)}createSession(e,t){return this._proxy.$createSession(this.id,e,t)}async removeSession(e){await this._proxy.$removeSession(this.id,e),this.notificationService.info(h(2381,"Successfully signed out."))}}let xte=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.authenticationService=t,this.authenticationExtensionsService=i,this.authenticationAccessService=n,this.authenticationUsageService=o,this.dialogService=r,this.notificationService=a,this.extensionService=c,this.telemetryService=d,this.openerService=l,this.logService=u,this._registrations=this._register(new ti),this._sentProviderUsageEvents=new Set,this._sentClientIdUsageEvents=new Set,this._proxy=e.getProxy(Ze.ExtHostAuthentication),this._register(this.authenticationService.onDidChangeSessions(g=>{this._proxy.$onDidChangeAuthenticationSessions(g.providerId,g.label)})),this._register(this.authenticationExtensionsService.onDidChangeAccountPreference(g=>{const m=this.authenticationService.getProvider(g.providerId);this._proxy.$onDidChangeAuthenticationSessions(m.id,m.label,g.extensionIds)}))}async $registerAuthenticationProvider(e,t,i){this.authenticationService.declaredProviders.find(r=>r.id===e)||(this.logService.warn(`Authentication provider ${e} was not declared in the Extension Manifest.`),this.telemetryService.publicLog2("authentication.providerNotDeclared",{id:e}));const n=new M;this._registrations.set(e,n);const o=new sHe(this._proxy,e,t,i,this.notificationService,n);this.authenticationService.registerAuthenticationProvider(e,o)}$unregisterAuthenticationProvider(e){this._registrations.deleteAndDispose(e),this.authenticationService.unregisterAuthenticationProvider(e)}async $ensureProvider(e){if(!this.authenticationService.isAuthenticationProviderRegistered(e))return await this.extensionService.activateByEvent(Tge(e),Op.Immediate)}$sendDidChangeSessions(e,t){const i=this._registrations.get(e);i instanceof M&&i.fire(t)}$removeSession(e,t){return this.authenticationService.removeSession(e,t)}async loginPrompt(e,t,i,n){let o;e.id.startsWith(Mce)?o=h(2382,"The extension '{0}' wants to access the language models provided by {1}.",t,e.label):o=i?h(2383,"The extension '{0}' wants you to sign in again using {1}.",t,e.label):h(2384,"The extension '{0}' wants to sign in using {1}.",t,e.label);const r=[{label:h(2385,"&&Allow"),run(){return!0}}];n?.learnMore&&r.push({label:h(2386,"Learn more"),run:async()=>{const c=this.loginPrompt(e,t,i,n);return await this.openerService.open(R.revive(n.learnMore),{allowCommands:!0}),await c}});const{result:a}=await this.dialogService.prompt({type:Fe.Info,message:o,buttons:r,detail:n?.detail,cancelButton:!0});return a??!1}async continueWithIncorrectAccountPrompt(e,t){const i=await this.dialogService.prompt({message:h(2387,"Incorrect account detected"),detail:h(2388,"The chosen account, {0}, does not match the requested account, {1}.",e,t),type:Fe.Warning,cancelButton:!0,buttons:[{label:h(2389,"Keep {0}",e),run:()=>e},{label:h(2390,"Login with {0}",t),run:()=>t}]});if(!i.result)throw new fo;return i.result===e}async doGetSession(e,t,i,n,o){const r=await this.authenticationService.getSessions(e,t,o.account,!0),a=this.authenticationService.getProvider(e);if(o.forceNewSession&&o.createIfNone)throw new Error("Invalid combination of options. Please remove one of the following: forceNewSession, createIfNone");if(o.forceNewSession&&o.silent)throw new Error("Invalid combination of options. Please remove one of the following: forceNewSession, silent");if(o.createIfNone&&o.silent)throw new Error("Invalid combination of options. Please remove one of the following: createIfNone, silent");o.clearSessionPreference&&this._removeAccountPreference(i,e,t);const c=o.account?r[0]:this._getAccountPreference(i,e,t,r);if(!o.forceNewSession&&r.length){if(c&&this.authenticationAccessService.isAccessAllowed(e,c.account.label,i))return c;if(!a.supportsMultipleAccounts&&this.authenticationAccessService.isAccessAllowed(e,r[0].account.label,i))return r[0]}if(o.createIfNone||o.forceNewSession){let d;typeof o.forceNewSession=="object"?d=o.forceNewSession:typeof o.createIfNone=="object"&&(d=o.createIfNone);const l=!!(o.forceNewSession&&r.length);if(!await this.loginPrompt(a,n,l,d))throw new Error("User did not consent to login.");let g;if(r?.length&&!o.forceNewSession)g=a.supportsMultipleAccounts&&!o.account?await this.authenticationExtensionsService.selectSession(e,i,n,t,r):r[0];else{const m=o.account??c?.account;do g=await this.authenticationService.createSession(e,t,{activateImmediate:!0,account:m});while(m&&m.label!==g.account.label&&!await this.continueWithIncorrectAccountPrompt(g.account.label,m.label))}return this.authenticationAccessService.updateAllowedExtensions(e,g.account.label,[{id:i,name:n,allowed:!0}]),this._updateAccountPreference(i,e,g),g}if(!c&&!this.authenticationExtensionsService.getAccountPreference(i,e)){const d=r.find(l=>this.authenticationAccessService.isAccessAllowed(e,l.account.label,i));if(d)return d}o.silent||(r.length?this.authenticationExtensionsService.requestSessionAccess(e,i,n,t,r):await this.authenticationExtensionsService.requestNewSession(e,t,i,n))}async $getSession(e,t,i,n,o){this.sendClientIdUsageTelemetry(i,e,t);const r=await this.doGetSession(e,t,i,n,o);return r&&(this.sendProviderUsageTelemetry(i,e),this.authenticationUsageService.addAccountUsage(e,r.account.label,t,i,n)),r}async $getAccounts(e){return await this.authenticationService.getAccounts(e)}sendClientIdUsageTelemetry(e,t,i){const n=i.some(r=>r.startsWith("VSCODE_CLIENT_ID:")),o=`${e}|${t}|${n}`;this._sentClientIdUsageEvents.has(o)||(this._sentClientIdUsageEvents.add(o),n&&this.telemetryService.publicLog2("authentication.clientIdUsage",{extensionId:e}))}sendProviderUsageTelemetry(e,t){const i=`${e}|${t}`;this._sentProviderUsageEvents.has(i)||(this._sentProviderUsageEvents.add(i),this.telemetryService.publicLog2("authentication.providerUsage",{providerId:t,extensionId:e}))}_getAccountPreference(e,t,i,n){if(n.length===0)return;const o=this.authenticationExtensionsService.getAccountPreference(e,t);if(o)return n.find(c=>c.account.label===o);const r=this.authenticationExtensionsService.getSessionPreference(t,e,i);if(r){const a=n.find(c=>c.id===r);if(a)return this.authenticationExtensionsService.updateAccountPreference(e,t,a.account),a}}_updateAccountPreference(e,t,i){this.authenticationExtensionsService.updateAccountPreference(e,t,i.account),this.authenticationExtensionsService.updateSessionPreference(t,e,i)}_removeAccountPreference(e,t,i){this.authenticationExtensionsService.removeAccountPreference(e,t),this.authenticationExtensionsService.removeSessionPreference(t,e,i)}};xte=f([ht(qe.MainThreadAuthentication),p(1,Pw),p(2,Vq),p(3,FN),p(4,jre),p(5,ei),p(6,Dt),p(7,cn),p(8,ai),p(9,mi),p(10,Re)],xte);let Ite=class{constructor(e,t,i){this.logService=t,this._timelineService=i,this._providerEmitters=new Map,this._proxy=e.getProxy(Ze.ExtHostTimeline)}$registerTimelineProvider(e){this.logService.trace(`MainThreadTimeline#registerTimelineProvider: id=${e.id}`);const t=this._proxy,i=this._providerEmitters;let n=i.get(e.id);n===void 0&&(n=new M,i.set(e.id,n)),this._timelineService.registerTimelineProvider({...e,onDidChange:n.event,async provideTimeline(o,r,a){return gn(await t.$getTimeline(e.id,o,r,a))},dispose(){i.delete(e.id),n?.dispose()}})}$unregisterTimelineProvider(e){this.logService.trace(`MainThreadTimeline#unregisterTimelineProvider: id=${e}`),this._timelineService.unregisterTimelineProvider(e)}$emitTimelineChangeEvent(e){this.logService.trace(`MainThreadTimeline#emitChangeEvent: id=${e.id}, uri=${e.uri?.toString(!0)}`),this._providerEmitters.get(e.id)?.fire(e)}dispose(){}};Ite=f([ht(qe.MainThreadTimeline),p(1,Re),p(2,zre)],Ite);let Age=0;class oHe{constructor(e,t,i,n){this.result=e,this.fromTaskId=t,this.uriIdentityService=i,this.accessor=n,this.fileCoverage=new In,this.didAddCoverage=Kd(this),this.tree=new zA,this.associatedData=new Map}*allPerTestIDs(){const e=new Set;for(const t of this.tree.nodes)if(t.value&&t.value.perTestData)for(const i of t.value.perTestData)e.has(i)||(e.add(i),yield i)}append(e,t){const i=this.getComputedForUri(e.uri),n=this.result,o=(c,d)=>{d[c]?(d[c].covered+=(e[c]?.covered||0)-(i?.[c]?.covered||0),d[c].total+=(e[c]?.total||0)-(i?.[c]?.total||0)):e[c]&&(d[c]={...e[c]})},r=[...this.treePathForUri(e.uri,!0)],a=[];this.tree.mutatePath(this.treePathForUri(e.uri,!1),c=>{if(a.push(c),a.length===r.length)if(c.value){const d=c.value;d.id=e.id,d.statement=e.statement,d.branch=e.branch,d.declaration=e.declaration}else{const d=c.value=new Dte(e,n,this.accessor);this.fileCoverage.set(e.uri,d)}else if(c.value)o("statement",c.value),o("branch",c.value),o("declaration",c.value),c.value.didChange.trigger(t);else{const d=Tr(e);d.id=String(Age++),d.uri=this.treePathToUri(r.slice(0,a.length)),c.value=new Pge(d,n)}if(e.testIds){c.value.perTestData??=new Set;for(const d of e.testIds)c.value.perTestData.add(d)}}),a&&this.didAddCoverage.trigger(t,a)}filterTreeForTest(e){const t=new zA;for(const i of this.tree.values())if(i instanceof Dte){if(!i.perTestData?.has(e.toString()))continue;const n=[...this.treePathForUri(i.uri,!0)],o=[];t.mutatePath(this.treePathForUri(i.uri,!1),r=>{o.push(r),r.value??=new aHe(this.treePathToUri(n.slice(0,o.length)),i.fromResult)})}return t}getAllFiles(){return this.fileCoverage}getUri(e){return this.fileCoverage.get(e)}getComputedForUri(e){return this.tree.find(this.treePathForUri(e,!1))}*treePathForUri(e,t){yield e.scheme,yield e.authority,yield*(!t&&this.uriIdentityService.extUri.ignorePathCasing(e)?e.path.toLowerCase():e.path).split("/")}treePathToUri(e){return R.from({scheme:e[0],authority:e[1],path:e.slice(2).join("/")})}}const rHe=(s,e,t)=>{let i=s.covered,n=s.total;return e&&(i+=e.covered,n+=e.total),t&&(i+=t.covered,n+=t.total),n===0?1:i/n};class Rge{get tpc(){return rHe(this.statement,this.branch,this.declaration)}constructor(e,t){this.fromResult=t,this.didChange=Kd(this),this.id=e.id,this.uri=e.uri,this.statement=e.statement,this.branch=e.branch,this.declaration=e.declaration}}class Pge extends Rge{}class aHe extends Pge{constructor(e,t){super({id:String(Age++),uri:e,statement:{covered:0,total:0}},t)}}class Dte extends Rge{get hasSynchronousDetails(){return this._details instanceof Array||this.resolved}constructor(e,t,i){super(e,t),this.accessor=i}async detailsForTest(e,t=Ce.None){this._detailsForTest??=new Map;const i=e.toString(),n=this._detailsForTest.get(i);if(n)return n;const o=(async()=>{try{return await this.accessor.getCoverageDetails(this.id,i,t)}catch(r){throw this._detailsForTest?.delete(i),r}})();return this._detailsForTest.set(i,o),o}async details(e=Ce.None){this._details??=this.accessor.getCoverageDetails(this.id,void 0,e);try{const t=await this._details;return this.resolved=!0,t}catch(t){throw this._details=void 0,t}}}const Jc={[Oi.Running]:6,[Oi.Errored]:5,[Oi.Failed]:4,[Oi.Queued]:3,[Oi.Passed]:2,[Oi.Unset]:0,[Oi.Skipped]:1};Rye(Jc,(s,e)=>({statusNode:!0,state:Number(e),priority:s}));const cHe=(s,e)=>Jc[e]-Jc[s],Lge=(...s)=>{switch(s.length){case 0:return Oi.Unset;case 1:return s[0];case 2:return Jc[s[0]]>Jc[s[1]]?s[0]:s[1];default:{let e=s[0];for(let t=1;t<s.length;t++)Jc[e]<Jc[s[t]]&&(e=s[t]);return e}}},dHe=Object.keys(Jc).map(s=>Number(s)).sort(cHe),kte={[Oi.Passed]:0,[Oi.Skipped]:1,[Oi.Failed]:2,[Oi.Errored]:3},Mge=()=>new Uint32Array(dHe.length),lHe=s=>"getOwnDuration"in s,$3=(s,e,t=!1)=>{let i=s.getCurrentComputedState(e);if(i===void 0||t){i=s.getOwnState(e)??Oi.Unset;let n=0;const o=Mge();for(const r of s.getChildren(e)){const a=$3(s,r);n++,o[a]++,i=a===Oi.Skipped&&i===Oi.Unset?Oi.Skipped:Lge(i,a)}n>hHe&&Oge.set(e,o),s.setComputedState(e,i)}return i},Nge=(s,e,t=!1)=>{let i=s.getCurrentComputedDuration(e);if(i===void 0||t){const n=s.getOwnDuration(e);if(n!==void 0)i=n;else{i=void 0;for(const o of s.getChildren(e)){const r=Nge(s,o);r!==void 0&&(i=(i||0)+r)}}s.setComputedDuration(e,i)}return i},hHe=64,Oge=new WeakMap,uHe=(s,e,t,i=!0)=>{const n=s.getCurrentComputedState(e),o=Jc[n],r=$3(s,e,!0),a=Jc[r],c=new Set;if(a!==o){s.setComputedState(e,r),c.add(e);let d=n,l=r;for(const u of s.getParents(e)){const g=Oge.get(u);g&&(g[d]--,g[l]++);const m=s.getCurrentComputedState(u);if(a>o){if(m!==void 0&&Jc[m]>=a||g&&g[l]>1)break;s.setComputedState(u,r),c.add(u)}else{if(m===void 0||Jc[m]>o||g&&g[d]>0)break;l=$3(s,u,!0),s.setComputedState(u,l),c.add(u)}d=m}}if(lHe(s)&&i)for(const d of As.concat(As.single(e),s.getParents(e))){const l=s.getCurrentComputedDuration(d),u=Nge(s,d,!0);if(l===u)break;s.setComputedDuration(d,u),c.add(d)}return c};T.None,Promise.resolve();class gHe{constructor(){this.writeDataEmitter=new M,this.endDeferred=new aa,this.offset=0,this.onDidWriteData=this.writeDataEmitter.event,this.endPromise=this.endDeferred.p,this.buffers=[]}get length(){return this.offset}getRange(e,t){const i=Le.alloc(t);let n=0;for(const o of this.getRangeIter(e,t))i.buffer.set(o.buffer,n),n+=o.byteLength;return n<t?i.slice(0,n):i}*getRangeIter(e,t){let i=0,n=0;for(const o of this.buffers){if(n+o.byteLength<=e){n+=o.byteLength;continue}const r=Math.max(0,e-n),a=Math.min(o.byteLength,r+t-i);if(yield o.slice(r,a),i+=a-r,n+=o.byteLength,i===t)break}}append(e,t){const i=this.offset;let n=e.byteLength;if(t===void 0)return this.push(e),{offset:i,length:n};let o;(function(d){d[d.CR=13]="CR",d[d.LF=10]="LF"})(o||(o={}));const r=Le.fromString(Tte(t,!0)),a=Le.fromString(Tte(t,!1));n+=r.byteLength+a.byteLength,this.push(r);let c=e.byteLength;for(;c>0;c--){const d=e.buffer[c-1];if(d!==o.CR&&d!==o.LF)break}return this.push(e.slice(0,c)),this.push(a),this.push(e.slice(c)),{offset:i,length:n}}push(e){e.byteLength!==0&&(this.buffers.push(e),this.writeDataEmitter.fire(e),this.offset+=e.byteLength)}end(){this.endDeferred.complete()}}const Tte=(s,e)=>`\x1B]633;SetMark;Id=${Gke(s,e)};Hidden\x07`,pHe=(s,e,t)=>({controllerId:s,expand:ao.NotExpandable,item:{...e},children:[],tasks:[],ownComputedState:Oi.Unset,computedState:Oi.Unset});var cm;(function(s){s[s.ComputedStateChange=0]="ComputedStateChange",s[s.OwnStateChange=1]="OwnStateChange",s[s.NewMessage=2]="NewMessage"})(cm||(cm={}));let Eb=class extends F{get completedAt(){return this._completedAt}get tests(){return this.testById.values()}getTestById(e){return this.testById.get(e)?.item}constructor(e,t,i,n,o){super(),this.id=e,this.persist=t,this.request=i,this.insertOrder=n,this.telemetry=o,this.completeEmitter=this._register(new M),this.newTaskEmitter=this._register(new M),this.endTaskEmitter=this._register(new M),this.changeEmitter=this._register(new M),this.testById=new Map,this.testMarkerCounter=0,this.startedAt=Date.now(),this.onChange=this.changeEmitter.event,this.onComplete=this.completeEmitter.event,this.onNewTask=this.newTaskEmitter.event,this.onEndTask=this.endTaskEmitter.event,this.tasks=[],this.name=h(11055,"Test run at {0}",new Date().toLocaleString(gh)),this.counts=Mge(),this.computedStateAccessor={getOwnState:r=>r.ownComputedState,getCurrentComputedState:r=>r.computedState,setComputedState:(r,a)=>r.computedState=a,getChildren:r=>r.children,getParents:r=>{const{testById:a}=this;return function*(){const c=Wn.fromString(r.item.extId).parentId;if(c)for(const d of c.idsToRoot())yield a.get(d.toString())}()}},this.doSerialize=new Ih(()=>({id:this.id,completedAt:this.completedAt,tasks:this.tasks.map(r=>({id:r.id,name:r.name,ctrlId:r.ctrlId,hasCoverage:!!r.coverage.get()})),name:this.name,request:this.request,items:[...this.testById.values()].map(XA.serializeWithoutMessages)})),this.doSerializeWithMessages=new Ih(()=>({id:this.id,completedAt:this.completedAt,tasks:this.tasks.map(r=>({id:r.id,name:r.name,ctrlId:r.ctrlId,hasCoverage:!!r.coverage.get()})),name:this.name,request:this.request,items:[...this.testById.values()].map(XA.serialize)}))}getStateById(e){return this.testById.get(e)}appendOutput(e,t,i,n){const o=e.byteLength>100?e.slice(0,100).toString()+"":e.toString();let r;(n||i)&&(r=this.testMarkerCounter++);const a=this.mustGetTaskIndex(t),c=this.tasks[a],{offset:d,length:l}=c.output.append(e,r),u={location:i,message:o,offset:d,length:l,marker:r,type:nd.Output},g=n&&this.testById.get(n);g?(g.tasks[a].messages.push(u),this.changeEmitter.fire({item:g,result:this,reason:cm.NewMessage,message:u})):c.otherMessages.push(u)}addTask(e){this.tasks.push({...e,coverage:si(this,void 0),otherMessages:[],output:new gHe});for(const t of this.tests)t.tasks.push({duration:void 0,messages:[],state:Oi.Unset});this.newTaskEmitter.fire(this.tasks.length-1)}addTestChainToRun(e,t){let i=this.testById.get(t[0].extId);i||(i=this.addTestToRun(e,t[0],null));for(let n=1;n<t.length;n++)i=this.addTestToRun(e,t[n],i.item.extId)}updateState(e,t,i,n){const o=this.testById.get(e);if(!o)return;const r=this.mustGetTaskIndex(t),a=kte[o.tasks[r].state],c=kte[i];a!==void 0&&(c===void 0||c<a)||this.fireUpdateAndRefresh(o,r,i,n)}appendMessage(e,t,i){const n=this.testById.get(e);n&&(n.tasks[this.mustGetTaskIndex(t)].messages.push(i),this.changeEmitter.fire({item:n,result:this,reason:cm.NewMessage,message:i}))}markTaskComplete(e){const t=this.mustGetTaskIndex(e),i=this.tasks[t];i.running=!1,i.output.end(),this.setAllToState(Oi.Unset,e,n=>n.state===Oi.Queued||n.state===Oi.Running),this.endTaskEmitter.fire(t)}markComplete(){if(this._completedAt!==void 0)throw new Error("cannot complete a test result multiple times");for(const e of this.tasks)e.running&&this.markTaskComplete(e.id);this._completedAt=Date.now(),this.completeEmitter.fire(),this.telemetry.publicLog2("test.outcomes",{failures:this.counts[Oi.Errored]+this.counts[Oi.Failed],passes:this.counts[Oi.Passed],controller:this.request.targets.map(e=>e.controllerId).join(",")})}markRetired(e){for(const[t,i]of this.testById)!i.retired&&(!e||e.hasKeyOrParent(Wn.fromString(t).path))&&(i.retired=!0,this.changeEmitter.fire({reason:cm.ComputedStateChange,item:i,result:this}))}toJSON(){return this.completedAt&&this.persist?this.doSerialize.value:void 0}toJSONWithMessages(){return this.completedAt&&this.persist?this.doSerializeWithMessages.value:void 0}setAllToState(e,t,i){const n=this.mustGetTaskIndex(t);for(const o of this.testById.values())i(o.tasks[n],o)&&this.fireUpdateAndRefresh(o,n,e)}fireUpdateAndRefresh(e,t,i,n){const o=e.ownComputedState,r=e.ownDuration,a={item:e,result:this,reason:cm.OwnStateChange,previousState:o,previousOwnDuration:r};e.tasks[t].state=i,n!==void 0&&(e.tasks[t].duration=n,e.ownDuration=Math.max(e.ownDuration||0,n));const c=Lge(...e.tasks.map(d=>d.state));if(c===o){n!==r&&this.changeEmitter.fire(a);return}e.ownComputedState=c,this.counts[o]--,this.counts[c]++,uHe(this.computedStateAccessor,e).forEach(d=>this.changeEmitter.fire(d===e?a:{item:d,result:this,reason:cm.ComputedStateChange}))}addTestToRun(e,t,i){const n=pHe(e,t);if(this.testById.set(t.extId,n),this.counts[Oi.Unset]++,i&&this.testById.get(i)?.children.push(n),this.tasks.length)for(let o=0;o<this.tasks.length;o++)n.tasks.push({duration:void 0,messages:[],state:Oi.Unset});return n}mustGetTaskIndex(e){const t=this.tasks.findIndex(i=>i.id===e);if(t===-1)throw new Error(`Unknown task ${e} in updateState`);return t}};Eb=f([p(4,ai)],Eb);let Ate=class extends F{constructor(e,t,i,n,o){super(),this.uriIdentityService=t,this.testService=i,this.testProfiles=n,this.resultService=o,this.diffListener=this._register(new Pt),this.testProviderRegistrations=new Map,this.proxy=e.getProxy(Ze.ExtHostTesting),this._register(this.testService.registerExtHost({provideTestFollowups:(r,a)=>this.proxy.$provideTestFollowups(r,a),executeTestFollowup:r=>this.proxy.$executeTestFollowup(r),disposeTestFollowups:r=>this.proxy.$disposeTestFollowups(r),getTestsRelatedToCode:(r,a,c)=>this.proxy.$getTestsRelatedToCode(r,a,c)})),this._register(this.testService.onDidCancelTestRun(({runId:r,taskId:a})=>{this.proxy.$cancelExtensionTestRun(r,a)})),this._register(T.debounce(n.onDidChange,(r,a)=>a)(()=>{const r={};for(const a of[Lo.Run,Lo.Debug,Lo.Coverage])for(const c of this.testProfiles.getGroupDefaultProfiles(a))r[c.controllerId]??=[],r[c.controllerId].push(c.profileId);this.proxy.$setDefaultRunProfiles(r)})),this._register(o.onResultsChanged(r=>{if("completed"in r){const a=r.completed.toJSONWithMessages();a&&this.proxy.$publishTestResults([a])}else"removed"in r&&r.removed.forEach(a=>{a instanceof Eb&&this.proxy.$disposeRun(a.id)})}))}$markTestRetired(e){let t;if(e){t=new zA;for(const i of e)t.insert(Wn.fromString(i).path,void 0)}for(const i of this.resultService.results)i instanceof Eb&&i.markRetired(t)}$publishTestRunProfile(e){const t=this.testProviderRegistrations.get(e.controllerId);t&&this.testProfiles.addProfile(t.instance,e)}$updateTestRunConfig(e,t,i){this.testProfiles.updateProfile(e,t,i)}$removeTestProfile(e,t){this.testProfiles.removeProfile(e,t)}$addTestsToRun(e,t,i){this.withLiveRun(t,n=>n.addTestChainToRun(e,i.map(o=>sx.deserialize(this.uriIdentityService,o))))}$appendCoverage(e,t,i){this.withLiveRun(e,n=>{const o=n.tasks.find(a=>a.id===t);if(!o)return;const r=HB.deserialize(this.uriIdentityService,i);gs(a=>{let c=o.coverage.read(void 0);c?c.append(r,a):(c=new oHe(n,t,this.uriIdentityService,{getCoverageDetails:(d,l,u)=>this.proxy.$getCoverageDetails(d,l,u).then(g=>g.map(UB.deserialize))}),c.append(r,a),o.coverage.set(c,a))})})}$startedExtensionTestRun(e){this.resultService.createLiveResult(e)}$startedTestRunTask(e,t){this.withLiveRun(e,i=>i.addTask(t))}$finishedTestRunTask(e,t){this.withLiveRun(e,i=>i.markTaskComplete(t))}$finishedExtensionTestRun(e){this.withLiveRun(e,t=>t.markComplete())}$updateTestStateInRun(e,t,i,n,o){this.withLiveRun(e,r=>r.updateState(i,t,n,o))}$appendOutputToRun(e,t,i,n,o){const r=n&&{uri:R.revive(n.uri),range:P.lift(n.range)};this.withLiveRun(e,a=>a.appendOutput(i,t,r,o))}$appendTestMessagesInRun(e,t,i,n){const o=this.resultService.getResult(e);if(o&&o instanceof Eb)for(const r of n)o.appendMessage(i,t,nx.deserialize(this.uriIdentityService,r))}$registerTestController(e,t,i){const n=new U,o=si(`${e}.label`,t),r=si(`${e}.cap`,i),a={id:e,label:o,capabilities:r,syncTests:()=>this.proxy.$syncTests(),refreshTests:c=>this.proxy.$refreshTests(e,c),configureRunProfile:c=>this.proxy.$configureRunProfile(e,c),runTests:(c,d)=>this.proxy.$runControllerTests(c,d),startContinuousRun:(c,d)=>this.proxy.$startContinuousRun(c,d),expandTest:(c,d)=>this.proxy.$expandTest(c,isFinite(d)?d:-1),getRelatedCode:(c,d)=>this.proxy.$getCodeRelatedToTest(c,d).then(l=>l.map(u=>({uri:R.revive(u.uri),range:P.lift(u.range)})))};n.add(Ie(()=>this.testProfiles.removeProfile(e))),n.add(this.testService.registerTestController(e,a)),this.testProviderRegistrations.set(e,{instance:a,label:o,capabilities:r,disposable:n})}$updateController(e,t){const i=this.testProviderRegistrations.get(e);i&&gs(n=>{t.label!==void 0&&i.label.set(t.label,n),t.capabilities!==void 0&&i.capabilities.set(t.capabilities,n)})}$unregisterTestController(e){this.testProviderRegistrations.get(e)?.disposable.dispose(),this.testProviderRegistrations.delete(e)}$subscribeToDiffs(){this.proxy.$acceptDiff(this.testService.collection.getReviverDiff().map(tR.serialize)),this.diffListener.value=this.testService.onDidProcessDiff(this.proxy.$acceptDiff,this.proxy)}$unsubscribeFromDiffs(){this.diffListener.clear()}$publishDiff(e,t){this.testService.publishDiff(e,t.map(i=>tR.deserialize(this.uriIdentityService,i)))}async $runTests(e,t){return(await this.testService.runResolvedTests(e,t)).id}async $getCoverageDetails(e,t,i,n){return await this.resultService.getResult(e)?.tasks[t]?.coverage.get()?.getUri(R.from(i))?.details(n)||[]}dispose(){super.dispose();for(const e of this.testProviderRegistrations.values())e.disposable.dispose();this.testProviderRegistrations.clear()}withLiveRun(e,t){const i=this.resultService.getResult(e);return i&&i instanceof Eb?t(i):void 0}};Ate=f([ht(qe.MainThreadTesting),p(1,nn),p(2,Gre),p(3,Ure),p(4,$re)],Ate);let Rte=class extends F{constructor(e,t,i,n){super(),this.secretStorageService=t,this.logService=i,this._sequencer=new Pye,this._proxy=e.getProxy(Ze.ExtHostSecretState),this._register(this.secretStorageService.onDidChangeSecret(o=>{try{const{extensionId:r,key:a}=this.parseKey(o);r&&a&&this._proxy.$onDidChangePassword({extensionId:r,key:a})}catch{}}))}$getPassword(e,t){return this.logService.trace(`[mainThreadSecretState] Getting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doGetPassword(e,t))}async doGetPassword(e,t){const i=this.getKey(e,t),n=await this.secretStorageService.get(i);return this.logService.trace(`[mainThreadSecretState] ${n?"P":"No p"}assword found for: `,e,t),n}$setPassword(e,t,i){return this.logService.trace(`[mainThreadSecretState] Setting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doSetPassword(e,t,i))}async doSetPassword(e,t,i){const n=this.getKey(e,t);await this.secretStorageService.set(n,i),this.logService.trace("[mainThreadSecretState] Password set for: ",e,t)}$deletePassword(e,t){return this.logService.trace(`[mainThreadSecretState] Deleting password for ${e} extension: `,t),this._sequencer.queue(e,()=>this.doDeletePassword(e,t))}async doDeletePassword(e,t){const i=this.getKey(e,t);await this.secretStorageService.delete(i),this.logService.trace("[mainThreadSecretState] Password deleted for: ",e,t)}getKey(e,t){return JSON.stringify({extensionId:e,key:t})}parseKey(e){return JSON.parse(e)}};Rte=f([ht(qe.MainThreadSecretState),p(1,kN),p(2,Re),p(3,cf)],Rte);let Pte=class{constructor(e,t){this.shareService=t,this.providers=new Map,this.providerDisposables=new Map,this.proxy=e.getProxy(Ze.ExtHostShare)}$registerShareProvider(e,t,i,n,o){const r={id:i,label:n,selector:t,priority:o,provideShare:async c=>{const d=await this.proxy.$provideShare(e,c,Ce.None);return typeof d=="string"?d:R.revive(d)}};this.providers.set(e,r);const a=this.shareService.registerShareProvider(r);this.providerDisposables.set(e,a)}$unregisterShareProvider(e){this.providers.has(e)&&this.providers.delete(e),this.providerDisposables.has(e)&&this.providerDisposables.delete(e)}dispose(){this.providers.clear(),Xe(this.providerDisposables.values()),this.providerDisposables.clear()}};Pte=f([ht(qe.MainThreadShare),p(1,Pre)],Pte);let Lte=class extends F{constructor(e,t){super(),this.userDataProfileImportExportService=t,this.registeredHandlers=this._register(new ti),this.proxy=e.getProxy(Ze.ExtHostProfileContentHandlers)}async $registerProfileContentHandler(e,t,i,n){this.registeredHandlers.set(e,this.userDataProfileImportExportService.registerProfileContentHandler(e,{name:t,description:i,extensionId:n,saveProfile:async(o,r,a)=>{const c=await this.proxy.$saveProfile(e,o,r,a);return c?gn(c):null},readProfile:async(o,r)=>this.proxy.$readProfile(e,o,r)}))}async $unregisterProfileContentHandler(e){this.registeredHandlers.deleteAndDispose(e)}};Lte=f([ht(qe.MainThreadProfileContentHandlers),p(1,soe)],Lte);let Mte=class extends F{constructor(e,t){super(),this._aiRelatedInformationService=t,this._registrations=this._register(new ti),this._proxy=e.getProxy(Ze.ExtHostAiRelatedInformation)}$getAiRelatedInformation(e,t){return this._aiRelatedInformationService.getRelatedInformation(e,t,Ce.None)}$registerAiRelatedInformationProvider(e,t){const i={provideAiRelatedInformation:(n,o)=>this._proxy.$provideAiRelatedInformation(e,n,o)};this._registrations.set(e,this._aiRelatedInformationService.registerAiRelatedInformationProvider(t,i))}$unregisterAiRelatedInformationProvider(e){this._registrations.deleteAndDispose(e)}};Mte=f([ht(qe.MainThreadAiRelatedInformation),p(1,Bq)],Mte);let Nte=class extends F{constructor(e,t){super(),this._AiEmbeddingVectorService=t,this._registrations=this._register(new ti),this._proxy=e.getProxy(Ze.ExtHostAiEmbeddingVector)}$registerAiEmbeddingVectorProvider(e,t){const i={provideAiEmbeddingVector:(n,o)=>this._proxy.$provideAiEmbeddingVector(t,n,o)};this._registrations.set(t,this._AiEmbeddingVectorService.registerAiEmbeddingVectorProvider(e,i))}$unregisterAiEmbeddingVectorProvider(e){this._registrations.deleteAndDispose(e)}};Nte=f([ht(qe.MainThreadAiEmbeddingVector),p(1,Kre)],Nte);let Ote=class extends F{constructor(e,t){super(),this._settingsSearchService=t,this._registrations=this._register(new ti),this._proxy=e.getProxy(Ze.ExtHostAiSettingsSearch)}$registerAiSettingsSearchProvider(e){const t={searchSettings:(i,n,o)=>this._proxy.$startSearch(e,i,n,o)};this._registrations.set(e,this._settingsSearchService.registerSettingsSearchProvider(t))}$unregisterAiSettingsSearchProvider(e){this._registrations.deleteAndDispose(e)}$handleSearchResult(e,t){if(!this._registrations.has(e))throw new Error("No AI settings search provider found");this._settingsSearchService.handleSearchResult(t)}};Ote=f([ht(qe.MainThreadAiSettingsSearch),p(1,Mae)],Ote);let Fte=class extends F{constructor(e,t){super(),this._extHostContext=e,this._mcpRegistry=t,this._serverIdCounter=0,this._servers=new Map,this._collectionDefinitions=this._register(new ti);const i=this._proxy=e.getProxy(Ze.ExtHostMcp);this._register(this._mcpRegistry.registerDelegate({priority:e.extensionHostKind===Ft.LocalWebWorker?0:1,waitForInitialProviderPromises(){return i.$waitForInitialCollectionProviders()},canStart(n,o){return!(n.remoteAuthority!==e.remoteAuthority||o.launch.type===hv.Stdio&&e.extensionHostKind===Ft.LocalWebWorker)},start:(n,o,r)=>{const a=++this._serverIdCounter,c=new fHe(e.extensionHostKind,()=>i.$stopMcp(a),d=>i.$sendMessage(a,JSON.stringify(d)));return this._servers.set(a,c),i.$startMcp(a,r),c}}))}$upsertMcpCollection(e,t){const i=t.map(GB.fromSerialized),n=this._collectionDefinitions.get(e.id);if(n)n.servers.set(i,void 0);else{const o=si("mcpServers",i),r=this._mcpRegistry.registerCollection({...e,resolveServerLanch:e.canResolveLaunch?async a=>{const c=await this._proxy.$resolveMcpLaunch(e.id,a.label);return c?ax.fromSerialized(c):void 0}:void 0,remoteAuthority:this._extHostContext.remoteAuthority,serverDefinitions:o});this._collectionDefinitions.set(e.id,{fromExtHost:e,servers:o,dispose:()=>r.dispose()})}}$deleteMcpCollection(e){this._collectionDefinitions.deleteAndDispose(e)}$onDidChangeState(e,t){const i=this._servers.get(e);i&&(i.state.set(t,void 0),Xc.isRunning(t)||(i.dispose(),this._servers.delete(e)))}$onDidPublishLog(e,t,i){typeof t=="string"&&(t=kb.Info,i=t),this._servers.get(e)?.pushLog(t,i)}$onDidReceiveMessage(e,t){this._servers.get(e)?.pushMessage(t)}dispose(){for(const e of this._servers.values())e.extHostDispose();this._servers.clear(),super.dispose()}};Fte=f([ht(qe.MainThreadMcp),p(1,jN)],Fte);class fHe extends F{pushLog(e,t){this._onDidLog.fire({message:t,level:e})}pushMessage(e){let t;try{t=JSON.parse(e)}catch{this.pushLog(kb.Warning,`Failed to parse message: ${JSON.stringify(e)}`)}t&&(Array.isArray(t)?t.forEach(i=>this._onDidReceiveMessage.fire(i)):this._onDidReceiveMessage.fire(t))}constructor(e,t,i){super(),this.stop=t,this.send=i,this.state=si("mcpServerState",{state:Xc.Kind.Starting}),this._onDidLog=this._register(new M),this.onDidLog=this._onDidLog.event,this._onDidReceiveMessage=this._register(new M),this.onDidReceiveMessage=this._onDidReceiveMessage.event,this._register(Lp(()=>{this.pushLog(kb.Info,`Starting server from ${th(e)} extension host`)}))}extHostDispose(){Xc.isRunning(this.state.get())&&(this.pushLog(kb.Warning,"Extension host shut down, server will stop."),this.state.set({state:Xc.Kind.Stopped},void 0)),this.dispose()}dispose(){Xc.isRunning(this.state.get())&&this.stop(),super.dispose()}}let Wte=class extends F{constructor(e,t){super(),this._chatStatusItemService=t}$setEntry(e,t){this._chatStatusItemService.setOrUpdateEntry({id:e,label:t.title,description:t.description,detail:t.detail})}$disposeEntry(e){this._chatStatusItemService.deleteEntry(e)}};Wte=f([ht(qe.MainThreadChatStatus),p(1,Lae)],Wte);let G3;function Jtt(s){G3=s}let z3=class extends VV{constructor(e,t,i,n,o,r,a,c,d){super(t,i,n,o,r,a,c,d),this.workerConfig=e}createExtensionHost(e,t,i){switch(t.kind){case Ft.LocalProcess:return G3==null?null:this._instantiationService.createInstance(G3,t,uh.EagerAutoStart,this._createLocalExtensionHostDataProvider(e,t,i));case Ft.LocalWebWorker:{if(this.workerConfig==null)return null;const n=i?uh.EagerManualStart:uh.EagerAutoStart;return this._instantiationService.createInstance(HR,t,n,this._createLocalExtensionHostDataProvider(e,t,i),this.workerConfig.url,this.workerConfig.options)}case Ft.Remote:return super.createExtensionHost(e,t,i)}}};z3=f([p(4,Z),p(5,Lh),p(6,Wh),p(7,gd),p(8,Re)],z3);let q3=class extends HV{constructor(e,t){super(t),this.allowedExtHostKinds=e}pickExtensionHostKind(e,t,i,n,o){const r=wRe(e.value);if(r!=null)return r;const a=super.pickExtensionHostKind(e,t,i,n,o);return a!=null&&!this.allowedExtHostKinds.includes(a)?this.allowedExtHostKinds[0]??null:a}};q3=f([p(1,Re)],q3);let K3=class extends BV{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A,B,q,Q){const ie=t.createInstance(NV),oe=new z3(e,ie,async()=>await this._scanWebExtensions(),()=>this._getExtensionRegistrySnapshotWhenReady(),t,_,k,r,v);super(ie,oe,new q3(e!=null?[Ft.LocalWebWorker,Ft.LocalProcess,Ft.Remote]:[Ft.LocalProcess,Ft.Remote],v),t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A,B,q,Q)}async deltaExtensions(e,t){await this._handleDeltaExtensions(new qf(e,t))}};K3=f([p(1,Z),p(2,Dt),p(3,cf),p(4,ai),p(5,gd),p(6,je),p(7,Vn),p(8,WN),p(9,It),p(10,ne),p(11,Kv),p(12,Hq),p(13,Re),p(14,Lh),p(15,DN),p(16,wd),p(17,Wh),p(18,HN),p(19,Mh),p(20,Lv),p(21,VN),p(22,ei)],K3);class mHe extends $V{async readExtensionResource(e){return e.scheme===ooe.extensionFile?(await this._fileService.readFile(e)).value.toString():await super.readExtensionResource(e)}}let Fge;mRe({"vs/workbench/services/extensions/worker/webWorkerExtensionHostIframe.html":()=>ede(new URL("/assets/webWorkerExtensionHostIframe-636UTAtK.html",import.meta.url).href,Fge)});function vHe(s,e){const t=s!=null?{...s,url:ede(new URL(s.url,globalThis.location?.href??import.meta.url),Fge)}:void 0;return{[cn.toString()]:new Sr(K3,[t],!1),[Kv.toString()]:new Sr(MV,[],!0),[Sq.toString()]:new Sr(mHe,[],!0),[Lw.toString()]:new Sr(zV,[],!0)}}const Bte=gl.registerExtensionPoint({extensionPoint:"jsonValidation",defaultExtensionKind:["workspace","web"],jsonSchema:{description:h(2574,"Contributes json schema configuration."),type:"array",defaultSnippets:[{body:[{fileMatch:"${1:file.json}",url:"${2:url}"}]}],items:{type:"object",defaultSnippets:[{body:{fileMatch:"${1:file.json}",url:"${2:url}"}}],properties:{fileMatch:{type:["string","array"],description:h(2575,`The file pattern (or an array of patterns) to match, for example "package.json" or "*.launch". Exclusion patterns start with '!'`),items:{type:["string"]}},url:{description:h(2576,"A schema URL ('http:', 'https:') or relative path to the extension folder ('./')."),type:"string"}}}}});class _He{constructor(){Bte.setHandler(e=>{for(const t of e){const i=t.value,n=t.collector,o=t.description.extensionLocation;if(!i||!Array.isArray(i)){n.error(h(2577,"'configuration.jsonValidation' must be a array"));return}i.forEach(r=>{if(!Tt(r.fileMatch)&&!(Array.isArray(r.fileMatch)&&r.fileMatch.every(Tt))){n.error(h(2578,"'configuration.jsonValidation.fileMatch' must be defined as a string or an array of strings."));return}const a=r.url;if(!Tt(a)){n.error(h(2579,"'configuration.jsonValidation.url' must be a URL or relative path"));return}if(a.startsWith("./"))try{const c=Ct(o,a);od(c,o)||n.warn(h(2580,"Expected `contributes.{0}.url` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",Bte.name,c.toString(),o.path))}catch(c){n.error(h(2581,"'configuration.jsonValidation.url' is an invalid relative URL: {0}",c.message))}else if(!/^[^:/?#]+:\/\//.test(a)){n.error(h(2582,"'configuration.jsonValidation.url' must be an absolute URL or start with './'  to reference schemas located in the extension."));return}})}})}}class bHe extends F{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.jsonValidation}render(e){const t=e.contributes?.jsonValidation||[];if(!t.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const i=[h(2583,"File Match"),h(2584,"Schema")],n=t.map(o=>[new Gi().appendMarkdown(`\`${Array.isArray(o.fileMatch)?o.fileMatch.join(", "):o.fileMatch}\``),o.url]);return{data:{headers:i,rows:n},dispose:()=>{}}}}Ke.as(Ew.ExtensionFeaturesRegistry).registerExtensionFeature({id:"jsonValidation",label:h(2585,"JSON Validation"),access:{canToggle:!1},renderer:new Sr(bHe)});let $L=class{static{this.ID="workbench.contrib.jsonValidationExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(_He)}};$L=f([p(0,Z)],$L);rc($L.ID,$L,ac.BlockStartup);const j3=Ke.as(Lye.ColorContribution),ck=j3.getColorReferenceSchema(),Wge="^\\w+[.\\w+]*$",yHe=gl.registerExtensionPoint({extensionPoint:"colors",jsonSchema:{description:h(12622,"Contributes extension defined themable colors"),type:"array",items:{type:"object",properties:{id:{type:"string",description:h(12623,"The identifier of the themable color"),pattern:Wge,patternErrorMessage:h(12624,"Identifiers must only contain letters, digits and dots and can not start with a dot")},description:{type:"string",description:h(12625,"The description of the themable color")},defaults:{type:"object",properties:{light:{description:h(12626,"The default color for light themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default."),type:"string",anyOf:[ck,{type:"string",format:"color-hex"}]},dark:{description:h(12627,"The default color for dark themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default."),type:"string",anyOf:[ck,{type:"string",format:"color-hex"}]},highContrast:{description:h(12628,"The default color for high contrast dark themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default. If not provided, the `dark` color is used as default for high contrast dark themes."),type:"string",anyOf:[ck,{type:"string",format:"color-hex"}]},highContrastLight:{description:h(12629,"The default color for high contrast light themes. Either a color value in hex (#RRGGBB[AA]) or the identifier of a themable color which provides the default. If not provided, the `light` color is used as default for high contrast light themes."),type:"string",anyOf:[ck,{type:"string",format:"color-hex"}]}},required:["light","dark"]}}}}});class wHe{constructor(){yHe.setHandler((e,t)=>{for(const i of t.added){const n=i.value,o=i.collector;if(!n||!Array.isArray(n)){o.error(h(12630,"'configuration.colors' must be a array"));return}const r=(a,c)=>a.length>0?a[0]==="#"?ye.Format.CSS.parseHex(a):a:(o.error(h(12631,"{0} must be either a color value in hex (#RRGGBB[AA] or #RGB[A]) or the identifier of a themable color which provides the default.",c)),ye.red);for(const a of n){if(typeof a.id!="string"||a.id.length===0){o.error(h(12632,"'configuration.colors.id' must be defined and can not be empty"));return}if(!a.id.match(Wge)){o.error(h(12633,"'configuration.colors.id' must only contain letters, digits and dots and can not start with a dot"));return}if(typeof a.description!="string"||a.id.length===0){o.error(h(12634,"'configuration.colors.description' must be defined and can not be empty"));return}const c=a.defaults;if(!c||typeof c!="object"||typeof c.light!="string"||typeof c.dark!="string"){o.error(h(12635,"'configuration.colors.defaults' must be defined and must contain 'light' and 'dark'"));return}if(c.highContrast&&typeof c.highContrast!="string"){o.error(h(12636,"If defined, 'configuration.colors.defaults.highContrast' must be a string."));return}if(c.highContrastLight&&typeof c.highContrastLight!="string"){o.error(h(12637,"If defined, 'configuration.colors.defaults.highContrastLight' must be a string."));return}j3.registerColor(a.id,{light:r(c.light,"configuration.colors.defaults.light"),dark:r(c.dark,"configuration.colors.defaults.dark"),hcDark:r(c.highContrast??c.dark,"configuration.colors.defaults.highContrast"),hcLight:r(c.highContrastLight??c.light,"configuration.colors.defaults.highContrastLight")},a.description)}}for(const i of t.removed){const n=i.value;for(const o of n)j3.deregisterColor(o.id)}})}}class SHe extends F{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.colors}render(e){const t=e.contributes?.colors||[];if(!t.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const i=[h(12638,"ID"),h(12639,"Description"),h(12640,"Dark Default"),h(12641,"Light Default"),h(12642,"High Contrast Default")],n=r=>r[0]==="#"?ye.fromHex(r):void 0,o=t.sort((r,a)=>r.id.localeCompare(a.id)).map(r=>[new Gi().appendMarkdown(`\`${r.id}\``),r.description,n(r.defaults.dark)??new Gi().appendMarkdown(`\`${r.defaults.dark}\``),n(r.defaults.light)??new Gi().appendMarkdown(`\`${r.defaults.light}\``),n(r.defaults.highContrast)??new Gi().appendMarkdown(`\`${r.defaults.highContrast}\``)]);return{data:{headers:i,rows:o},dispose:()=>{}}}}Ke.as(Ew.ExtensionFeaturesRegistry).registerExtensionFeature({id:"colors",label:h(12643,"Colors"),access:{canToggle:!1},renderer:new Sr(SHe)});let GL=class{static{this.ID="workbench.contrib.colorExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(wHe)}};GL=f([p(0,Z)],GL);rc(GL.ID,GL,ac.BlockStartup);const oC=Ke.as(Mye.IconContribution),CHe=oC.getIconReferenceSchema(),Bge=`^${ke.iconNameSegment}(-${ke.iconNameSegment})+$`,EHe=gl.registerExtensionPoint({extensionPoint:"icons",jsonSchema:{description:h(12702,"Contributes extension defined themable icons"),type:"object",propertyNames:{pattern:Bge,description:h(12703,"The identifier of the themable icon"),patternErrorMessage:h(12704,"Identifiers can only contain letters, digits and minuses and need to consist of at least two segments in the form `component-iconname`.")},additionalProperties:{type:"object",properties:{description:{type:"string",description:h(12705,"The description of the themable icon")},default:{anyOf:[CHe,{type:"object",properties:{fontPath:{description:h(12706,"The path of the icon font that defines the icon."),type:"string"},fontCharacter:{description:h(12707,"The character for the icon in the icon font."),type:"string"}},required:["fontPath","fontCharacter"],defaultSnippets:[{body:{fontPath:"${1:myiconfont.woff}",fontCharacter:"${2:\\\\E001}"}}]}],description:h(12708,"The default of the icon. Either a reference to an existing ThemeIcon or an icon in an icon font.")}},required:["description","default"],defaultSnippets:[{body:{description:"${1:my icon}",default:{fontPath:"${2:myiconfont.woff}",fontCharacter:"${3:\\\\E001}"}}}]},defaultSnippets:[{body:{"${1:my-icon-id}":{description:"${2:my icon}",default:{fontPath:"${3:myiconfont.woff}",fontCharacter:"${4:\\\\E001}"}}}}]}});class xHe{constructor(){EHe.setHandler((e,t)=>{for(const i of t.added){const n=i.value,o=i.collector;if(!n||typeof n!="object"){o.error(h(12709,"'configuration.icons' must be an object with the icon names as properties."));return}for(const r in n){if(!r.match(Bge)){o.error(h(12710,"'configuration.icons' keys represent the icon id and can only contain letter, digits and minuses. They need to consist of at least two segments in the form `component-iconname`."));return}const a=n[r];if(typeof a.description!="string"||a.description.length===0){o.error(h(12711,"'configuration.icons.description' must be defined and can not be empty"));return}const c=a.default;if(typeof c=="string")oC.registerIcon(r,{id:c},a.description);else if(typeof c=="object"&&typeof c.fontPath=="string"&&typeof c.fontCharacter=="string"){const d=XM(c.fontPath).substring(1),l=IHe[d];if(!l){o.warn(h(12712,"Expected `contributes.icons.default.fontPath` to have file extension 'woff', woff2' or 'ttf', is '{0}'.",d));return}const u=i.description.extensionLocation,g=Ct(u,c.fontPath),m=DHe(i.description,c.fontPath),v=oC.registerIconFont(m,{src:[{location:g,format:l}]});if(!od(g,u)){o.warn(h(12713,"Expected `contributes.icons.default.fontPath` ({0}) to be included inside extension's folder ({0}).",g.path,u.path));return}oC.registerIcon(r,{fontCharacter:c.fontCharacter,font:{id:m,definition:v}},a.description)}else o.error(h(12714,"'configuration.icons.default' must be either a reference to the id of an other theme icon (string) or a icon definition (object) with properties `fontPath` and `fontCharacter`."))}}for(const i of t.removed){const n=i.value;for(const o in n)oC.deregisterIcon(o)}})}}const IHe={ttf:"truetype",woff:"woff",woff2:"woff2"};function DHe(s,e){return Yc.join(s.identifier.value,e)}let zL=class{static{this.ID="workbench.contrib.iconExtensionPoint"}constructor(e){this.instantiationService=e,this.instantiationService.createInstance(xHe)}};zL=f([p(0,Z)],zL);rc(zL.ID,zL,ac.BlockStartup);class kHe extends X{constructor(){super({id:"menu.resetHiddenStates",title:I(1705,"Reset All Menus"),category:te.View,f1:!0})}run(e){e.get(fn).resetHiddenStates(),e.get(Re).info("did RESET all menu hidden states")}}Y(kHe);let Y3=class extends av{constructor(e,t,i,n,o,r,a){super(!1,e,t,i,n,o,r,a)}};Y3=f([p(1,fe),p(2,Bt),p(3,Dt),p(4,Z),p(5,it),p(6,ne)],Y3);Lt(av.ID,Y3,_t.Lazy);let Q3=class extends Xu{constructor(e,t,i,n,o,r,a,c,d){super(e,n.getRawOptions(),i,o,r,a,c,d),this._parentEditor=n,this._overwriteOptions=t,super.updateOptions(this._overwriteOptions),this._register(n.onDidChangeConfiguration(l=>this._onParentConfigurationChanged(l)))}getParentEditor(){return this._parentEditor}_onParentConfigurationChanged(e){super.updateOptions(this._parentEditor.getRawOptions()),super.updateOptions(this._overwriteOptions)}updateOptions(e){Vu(this._overwriteOptions,e,!0),super.updateOptions(this._overwriteOptions)}};Q3=f([p(4,fe),p(5,Z),p(6,Bt),p(7,lI),p(8,Uu)],Q3);const CD=new class{constructor(){this._implementations=[]}register(e){return this._implementations.push(e),{dispose:()=>{const t=this._implementations.indexOf(e);t!==-1&&this._implementations.splice(t,1)}}}getImplementations(){return this._implementations}};class Vge extends lf{constructor(e){super(),this.label=e,this._onClick=this._register(new M),this.onClick=this._onClick.event,this._domNode=j(".floating-click-widget"),this._domNode.style.padding="6px 11px",this._domNode.style.borderRadius="2px",this._domNode.style.cursor="pointer",this._domNode.style.zIndex="1"}getDomNode(){return this._domNode}render(){Xi(this._domNode),this._domNode.style.backgroundColor=KF(Zz,vt(ss)),this._domNode.style.color=KF(oN,vt(po)),this._domNode.style.border=`1px solid ${vt(tt)}`,ee(this._domNode,j("")).textContent=this.label,this.onclick(this._domNode,()=>this._onClick.fire())}}let qL=class extends F{constructor(e,t,i){super(),this.renderEmitter=new M,this.onDidRender=this.renderEmitter.event,this.menu=this._register(t.createMenu(e,i))}render(){const e=this._register(new U),t=()=>{if(e.clear(),!this.isVisible())return;const i=nN(this.menu.getActions({renderShortTitle:!0,shouldForwardArgs:!0}));if(i.length===0)return;const[n]=i,o=this.createWidget(n,e);e.add(o),e.add(o.onClick(()=>n.run(this.getActionArg()))),o.render()};this._register(this.menu.onDidChange(t)),t()}getActionArg(){}isVisible(){return!0}};qL=f([p(1,fn),p(2,fe)],qL);let Vte=class extends qL{constructor(e,t,i,n){super(e.menuId,i,n),this.options=e,this.instantiationService=t,this.render()}createWidget(e,t){const i=this.instantiationService.createInstance(Vge,e.label),n=i.getDomNode();return this.options.container.appendChild(n),t.add(Ie(()=>n.remove())),i}getActionArg(){return this.options.getActionArg()}};Vte=f([p(1,Z),p(2,fn),p(3,fe)],Vte);var CT;let Hte=class extends F{static{CT=this}constructor(e){super(),this.editorService=e,this._onHighlightRemoved=this._register(new M),this.onHighlightRemoved=this._onHighlightRemoved.event,this.rangeHighlightDecorationId=null,this.editor=null,this.editorDisposables=this._register(new U)}removeHighlightRange(){if(this.editor&&this.rangeHighlightDecorationId){const e=this.rangeHighlightDecorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e)}),this._onHighlightRemoved.fire()}this.rangeHighlightDecorationId=null}highlightRange(e,t){t=t??this.getEditor(e),mo(t)?this.doHighlightRange(t,e):cA(t)&&mo(t.activeCodeEditor)&&this.doHighlightRange(t.activeCodeEditor,e)}doHighlightRange(e,t){this.removeHighlightRange(),e.changeDecorations(i=>{this.rangeHighlightDecorationId=i.addDecoration(t.range,this.createRangeHighlightDecoration(t.isWholeLine))}),this.setEditor(e)}getEditor(e){const t=this.editorService.activeEditor?.resource;if(t&&At(t,e.resource)&&mo(this.editorService.activeTextEditorControl))return this.editorService.activeTextEditorControl}setEditor(e){this.editor!==e&&(this.editorDisposables.clear(),this.editor=e,this.editorDisposables.add(this.editor.onDidChangeCursorPosition(t=>{(t.reason===Ws.NotSet||t.reason===Ws.Explicit||t.reason===Ws.Undo||t.reason===Ws.Redo)&&this.removeHighlightRange()})),this.editorDisposables.add(this.editor.onDidChangeModel(()=>{this.removeHighlightRange()})),this.editorDisposables.add(this.editor.onDidDispose(()=>{this.removeHighlightRange(),this.editor=null})))}static{this._WHOLE_LINE_RANGE_HIGHLIGHT=Zt.register({description:"codeeditor-range-highlight-whole",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"rangeHighlight",isWholeLine:!0})}static{this._RANGE_HIGHLIGHT=Zt.register({description:"codeeditor-range-highlight",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"rangeHighlight"})}createRangeHighlightDecoration(e=!0){return e?CT._WHOLE_LINE_RANGE_HIGHLIGHT:CT._RANGE_HIGHLIGHT}dispose(){super.dispose(),this.editor?.getModel()&&(this.removeHighlightRange(),this.editor=null)}};Hte=CT=f([p(0,de)],Hte);let KL=class extends Vge{constructor(e,t,i,n){super(i&&n.lookupKeybinding(i)?`${t} (${n.lookupKeybinding(i).getLabel()})`:t),this.editor=e}getId(){return"editor.overlayWidget.floatingClickWidget"}getPosition(){return{preference:SI.BOTTOM_RIGHT_CORNER}}render(){super.render(),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}};KL=f([p(3,He)],KL);let Ute=class extends qL{static{this.ID="editor.contrib.floatingClickMenu"}constructor(e,t,i,n){super(N.EditorContent,i,n),this.editor=e,this.instantiationService=t,this.render()}createWidget(e){return this.instantiationService.createInstance(KL,this.editor,e.label,e.id)}isVisible(){return!(this.editor instanceof pd)&&this.editor?.hasModel()&&!this.editor.getOption(L.inDiffEditor)}getActionArg(){return this.editor.getModel()?.uri}};Ute=f([p(1,Z),p(2,fn),p(3,fe)],Ute);class THe extends X{constructor(){super({id:"diffEditor.toggleCollapseUnchangedRegions",title:I(149,"Toggle Collapse Unchanged Regions"),icon:K.map,toggled:x.has("config.diffEditor.hideUnchangedRegions.enabled"),precondition:x.has("isInDiffEditor"),menu:{when:x.has("isInDiffEditor"),id:N.EditorTitle,order:22,group:"navigation"}})}run(e,...t){const i=e.get(ne),n=!i.getValue("diffEditor.hideUnchangedRegions.enabled");i.updateValue("diffEditor.hideUnchangedRegions.enabled",n)}}class Hge extends X{constructor(){super({id:"diffEditor.toggleShowMovedCodeBlocks",title:I(150,"Toggle Show Moved Code Blocks"),precondition:x.has("isInDiffEditor")})}run(e,...t){const i=e.get(ne),n=!i.getValue("diffEditor.experimental.showMoves");i.updateValue("diffEditor.experimental.showMoves",n)}}class Uge extends X{constructor(){super({id:"diffEditor.toggleUseInlineViewWhenSpaceIsLimited",title:I(151,"Toggle Use Inline View When Space Is Limited"),precondition:x.has("isInDiffEditor")})}run(e,...t){const i=e.get(ne),n=!i.getValue("diffEditor.useInlineViewWhenSpaceIsLimited");i.updateValue("diffEditor.useInlineViewWhenSpaceIsLimited",n)}}const ED=I(152,"Diff Editor");class AHe extends Fr{constructor(){super({id:"diffEditor.switchSide",title:I(153,"Switch Side"),icon:K.arrowSwap,precondition:x.has("isInDiffEditor"),f1:!0,category:ED})}runEditorCommand(e,t,i){const n=gS(e);if(n instanceof Xu){if(i&&i.dryRun)return{destinationSelection:n.mapToOtherSide().destinationSelection};n.switchSide()}}}class RHe extends Fr{constructor(){super({id:"diffEditor.exitCompareMove",title:I(154,"Exit Compare Move"),icon:K.close,precondition:V.comparingMovedCode,f1:!1,category:ED,keybinding:{weight:1e4,primary:S.Escape}})}runEditorCommand(e,t,...i){const n=gS(e);n instanceof Xu&&n.exitCompareMove()}}class PHe extends Fr{constructor(){super({id:"diffEditor.collapseAllUnchangedRegions",title:I(155,"Collapse All Unchanged Regions"),icon:K.fold,precondition:x.has("isInDiffEditor"),f1:!0,category:ED})}runEditorCommand(e,t,...i){const n=gS(e);n instanceof Xu&&n.collapseAllUnchangedRegions()}}class LHe extends Fr{constructor(){super({id:"diffEditor.showAllUnchangedRegions",title:I(156,"Show All Unchanged Regions"),icon:K.unfold,precondition:x.has("isInDiffEditor"),f1:!0,category:ED})}runEditorCommand(e,t,...i){const n=gS(e);n instanceof Xu&&n.showAllUnchangedRegions()}}class X3 extends X{constructor(){super({id:"diffEditor.revert",title:I(157,"Revert"),f1:!1,category:ED})}run(e,t){const i=MHe(e,t.originalUri,t.modifiedUri);i instanceof Xu&&i.revertRangeMappings(t.mapping.innerChanges??[])}}const $ge=I(158,"Accessible Diff Viewer");class uS extends X{static{this.id="editor.action.accessibleDiffViewer.next"}constructor(){super({id:uS.id,title:I(159,"Go to Next Difference"),category:$ge,precondition:x.has("isInDiffEditor"),keybinding:{primary:S.F7,weight:W.EditorContrib},f1:!0})}run(e){gS(e)?.accessibleDiffViewerNext()}}class xD extends X{static{this.id="editor.action.accessibleDiffViewer.prev"}constructor(){super({id:xD.id,title:I(160,"Go to Previous Difference"),category:$ge,precondition:x.has("isInDiffEditor"),keybinding:{primary:E.Shift|S.F7,weight:W.EditorContrib},f1:!0})}run(e){gS(e)?.accessibleDiffViewerPrev()}}function MHe(s,e,t){return s.get(Bt).listDiffEditors().find(o=>{const r=o.getModifiedEditor(),a=o.getOriginalEditor();return r&&r.getModel()?.uri.toString()===t.toString()&&a&&a.getModel()?.uri.toString()===e.toString()})||null}function gS(s){const t=s.get(Bt).listDiffEditors(),i=wh();if(i){for(const n of t)if(n.getContainerDomNode().contains(i))return n}return null}function NHe(s,e){if(!e.getOption(L.inDiffEditor))return null;const t=s.get(Bt);for(const i of t.listDiffEditors()){const n=i.getOriginalEditor(),o=i.getModifiedEditor();if(n===e||o===e)return i}return null}class C0 extends X{static{this.ID="editor.action.toggleTabFocusMode"}constructor(){super({id:C0.ID,title:I(1572,"Toggle Tab Key Moves Focus"),precondition:void 0,keybinding:{primary:E.CtrlCmd|S.KeyM,mac:{primary:E.WinCtrl|E.Shift|S.KeyM},weight:W.EditorContrib},metadata:{description:I(1573,"Determines whether the tab key moves focus around the workbench or inserts the tab character in the current editor. This is also called tab trapping, tab navigation, or tab focus mode.")},f1:!0})}run(){const t=!k8.getTabFocusMode();k8.setTabFocusMode(t),t?na(h(1574,"Pressing Tab will now move focus to the next focusable element")):na(h(1575,"Pressing Tab will now insert the tab character"))}}Y(C0);var Jg;(function(s){s.intro=h(5311,"The editor contains commentable range(s). Some useful commands include:"),s.tabFocus=h(5312,"This widget contains a text area, for composition of new comments, and actions, that can be tabbed to once tab moves focus mode has been enabled with the command Toggle Tab Key Moves Focus{0}.",`<keybinding:${C0.ID}>`),s.commentCommands=h(5313,"Some useful comment commands include:"),s.escape=h(5314,"- Dismiss Comment (Escape)"),s.nextRange=h(5315,"- Go to Next Commenting Range{0}.",`<keybinding:${Wc.NextRange}>`),s.previousRange=h(5316,"- Go to Previous Commenting Range{0}.",`<keybinding:${Wc.PreviousRange}>`),s.nextCommentThread=h(5317,"- Go to Next Comment Thread{0}.",`<keybinding:${Wc.NextThread}>`),s.previousCommentThread=h(5318,"- Go to Previous Comment Thread{0}.",`<keybinding:${Wc.PreviousThread}>`),s.nextCommentedRange=h(5319,"- Go to Next Commented Range{0}.",`<keybinding:${Wc.NextCommentedRange}>`),s.previousCommentedRange=h(5320,"- Go to Previous Commented Range{0}.",`<keybinding:${Wc.PreviousCommentedRange}>`),s.addComment=h(5321,"- Add Comment on Current Selection{0}.",`<keybinding:${Wc.Add}>`),s.submitComment=h(5322,"- Submit Comment{0}.",`<keybinding:${Wc.Submit}>`)})(Jg||(Jg={}));const OHe=new O("chatEdits.isGlobalEditingSession",void 0,h(4734,"The current editor is part of the global edit session")),Gge=new O("chatEdits.hasEditorModifications",void 0,h(4735,"The current editor contains chat modifications")),FHe=new O("chatEdits.isReviewModeEnabled",!0,h(4736,"Review mode for chat changes is enabled")),zge=new O("chatEdits.isRequestInProgress",!1,h(4737,"The current editor shows a file from an edit session which is still in progress")),WHe=new O("chatEdits.requestCount",0,h(4738,"The number of turns the editing session in this editor has"));let $te=class{static{this.ID="chat.edits.editorContextKeys"}constructor(e,t){this._store=new U;const i=this._store.add(new ti),n=kn(this,T.any(t.onDidAddGroup,t.onDidRemoveGroup),()=>t.groups);this._store.add(fi(o=>{const r=new Set(i.keys());for(const a of n.read(o))r.delete(a),!i.has(a)&&i.set(a,e.createInstance(Z3,a));for(const a of r)i.deleteAndDispose(a)}))}dispose(){this._store.dispose()}};$te=f([p(0,Z),p(1,xe)],$te);let Z3=class{constructor(e,t,i,n){this._store=new U,this._ctxIsGlobalEditingSession=OHe.bindTo(e.scopedContextKeyService),this._ctxHasEditorModification=Gge.bindTo(e.scopedContextKeyService),this._ctxHasRequestInProgress=zge.bindTo(e.scopedContextKeyService),this._ctxReviewModeEnabled=FHe.bindTo(e.scopedContextKeyService),this._ctxRequestCount=WHe.bindTo(e.scopedContextKeyService);const o=kn(this,e.onDidModelChange,()=>e.activeEditor);this._store.add(fi(r=>{const a=o.read(r),c=Di.getOriginalUri(a,{supportSideBySide:qt.PRIMARY});if(!c){this._reset();return}const d=new J3(c,i,t).value.read(r);if(!d){this._reset();return}const{session:l,entry:u}=d,g=n.getSession(l.chatSessionId),m=g?kn(this,g.onDidChange,()=>g.getRequests().at(-1)?.response).read(r):void 0,v=m?kn(this,m.onDidChange,()=>!m.isPendingConfirmation&&!m.isComplete):Li(!1);this._ctxHasEditorModification.set(u?.state.read(r)===_d.Modified),this._ctxIsGlobalEditingSession.set(l.isGlobalEditingSession),this._ctxReviewModeEnabled.set(u?u.reviewMode.read(r):!1),this._ctxHasRequestInProgress.set(v.read(r));const _=g?kn(this,g.onDidChange,()=>g.getRequests().length):Li(0);this._ctxRequestCount.set(_.read(r))}))}_reset(){this._ctxIsGlobalEditingSession.reset(),this._ctxHasEditorModification.reset(),this._ctxHasRequestInProgress.reset(),this._ctxReviewModeEnabled.reset(),this._ctxRequestCount.reset()}dispose(){this._store.dispose(),this._reset()}};Z3=f([p(1,Nq),p(2,ug),p(3,ff)],Z3);let J3=class{constructor(e,t,i){const n=kn(this,i.onDidChangeSessions,()=>i.getSession2(e)),o=t.editingSessionsObs.map((r,a)=>{for(const c of r){const d=c.readEntry(e,a);if(d)return{session:c,entry:d,isInlineChat:!1}}});this.value=ve(r=>{const a=n.read(r);return a?{session:a.editingSession,entry:a.editingSession.readEntry(e,r),isInlineChat:!0}:o.read(r)})}};J3=f([p(1,ug),p(2,Nq)],J3);let Gte=class extends F{onClose(){this._editor.focus()}constructor(e,t,i,n,o){super(),this._editor=e,this._keybindingService=t,this._contextKeyService=i,this.accessibilityService=n,this._configurationService=o,this.id=oa.Editor,this.options={type:fc.Help,readMoreUrl:"https://go.microsoft.com/fwlink/?linkid=851010"},this.verbositySettingKey=zn.Editor}provideContent(){const e=this._editor.getOptions(),t=[];e.get(L.inDiffEditor)?e.get(L.readOnly)?t.push(Cn.readonlyDiffEditor):t.push(Cn.editableDiffEditor):e.get(L.readOnly)?t.push(Cn.readonlyEditor):t.push(Cn.editableEditor),this.accessibilityService.isScreenReaderOptimized()&&this._configurationService.getValue("accessibility.windowTitleOptimized")?t.push(Cn.defaultWindowTitleIncludesEditorState):t.push(Cn.defaultWindowTitleExcludingEditorState),t.push(Cn.toolbar);const i=VHe(this._keybindingService,this._contextKeyService,this._editor);i&&t.push(i),t.push(Cn.listSignalSounds),t.push(Cn.listAlerts);const n=BHe(this._keybindingService,this._contextKeyService);n&&t.push(n);const o=qge(this._keybindingService,this._contextKeyService,this._editor);return o&&t.push(o),t.push(Cn.suggestActions),t.push(Cn.acceptSuggestAction),t.push(Cn.toggleSuggestionFocus),e.get(L.stickyScroll).enabled&&t.push(Cn.stickScroll),e.get(L.tabFocusMode)?t.push(Cn.tabFocusModeOnMsg):t.push(Cn.tabFocusModeOffMsg),t.push(Cn.codeFolding),t.push(Cn.intellisense),t.push(Cn.showOrFocusHover),t.push(Cn.goToSymbol),t.push(Cn.startDebugging),t.push(Cn.setBreakpoint),t.push(Cn.debugExecuteSelection),t.push(Cn.addToWatch),t.join(`
`)}};Gte=f([p(1,He),p(2,fe),p(3,Nr),p(4,ne)],Gte);function qge(s,e,t){if(e.getContext(t.getDomNode()).getValue(Ja.activeEditorHasCommentingRange.key))return[Jg.intro,Jg.addComment,Jg.nextCommentThread,Jg.previousCommentThread,Jg.nextRange,Jg.previousRange].join(`
`)}function BHe(s,e){if(_e.enabled.getValue(e))return[Cn.quickChat,Cn.startInlineChat].join(`
`)}function VHe(s,e,t){const i=e.getContext(t.getDomNode());if(i.getValue(Gge.key))return Cn.chatEditorModification+`
`+Cn.chatEditActions;if(i.getValue(zge.key))return Cn.chatEditorRequestInProgress}class HHe{constructor(){this.priority=105,this.name="diff-editor",this.when=mse.create("isInDiffEditor",!0),this.type=fc.Help}getProvider(e){const t=e.get(de),i=e.get(Bt),n=e.get(He),o=e.get(fe);if(!(t.activeTextEditorControl instanceof Xu))return;const r=i.getActiveCodeEditor()||i.getFocusedCodeEditor();if(!r)return;const a=h(5130,"Run the command Diff Editor: Switch Side{0} to toggle between the original and modified editors.","<keybinding:diffEditor.switchSide>"),c=h(5131,"The setting, accessibility.verbosity.diffEditorActive, controls if a diff editor announcement is made when it becomes the active editor."),d=["accessibility.signals.diffLineDeleted","accessibility.signals.diffLineInserted","accessibility.signals.diffLineModified"],l=[h(5132,"You are in a diff editor."),h(5133,"View the next{0} or previous{1} diff in diff review mode, which is optimized for screen readers.","<keybinding:"+uS.id+">","<keybinding:"+xD.id+">"),a,c,h(5134,"To control which accessibility signals should be played, the following settings can be configured: {0}.",d.join(", "))],u=qge(n,o,r);return u&&l.push(u),new Ige(oa.DiffEditor,{type:fc.Help},()=>l.join(`
`),()=>r.focus(),zn.DiffEditor)}}let jL=class extends F{static{this.ID="editor.contrib.diffEditorHelper"}constructor(e,t,i,n){if(super(),this._diffEditor=e,this._instantiationService=t,this._textResourceConfigurationService=i,this._notificationService=n,!(this._diffEditor instanceof Q3)){const a=kn(this,c=>this._diffEditor.onDidUpdateDiff(c),()=>this._diffEditor.getDiffComputationResult()).map(c=>c&&!c.identical&&c.changes2.length===0);this._register(ka((c,d)=>{if(a.read(c)){const l=d.add(this._instantiationService.createInstance(KL,this._diffEditor.getModifiedEditor(),h(5135,"Show Whitespace Differences"),null));d.add(l.onClick(()=>{this._textResourceConfigurationService.updateValue(this._diffEditor.getModel().modified.uri,"diffEditor.ignoreTrimWhitespace",!1)})),l.render()}})),this._register(this._diffEditor.onDidUpdateDiff(()=>{const c=this._diffEditor.getDiffComputationResult();c&&c.quitEarly&&this._notificationService.prompt(Fe.Warning,h(5136,"The diff algorithm was stopped early (after {0} ms.)",this._diffEditor.maxComputationTime),[{label:h(5137,"Remove Limit"),run:()=>{this._textResourceConfigurationService.updateValue(this._diffEditor.getModel().modified.uri,"diffEditor.maxComputationTime",0)}}],{})}))}}};jL=f([p(1,Z),p(2,ir),p(3,Dt)],jL);vse(jL.ID,jL);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"diffEditor.experimental.collapseUnchangedRegions",migrateFn:(s,e)=>[["diffEditor.hideUnchangedRegions.enabled",{value:s}],["diffEditor.experimental.collapseUnchangedRegions",{value:void 0}]]}]);CD.register(new HHe);let YL=class extends F{static{this.ID="editor.contrib.largeFileOptimizationsWarner"}constructor(e,t,i){super(),this._editor=e,this._notificationService=t,this._configurationService=i,this._register(this._editor.onDidChangeModel(n=>this._update())),this._update()}_update(){const e=this._editor.getModel();if(e&&e.isTooLargeForTokenization()){const t=h(5156,"{0}: tokenization, wrapping, folding, codelens, word highlighting and sticky scroll have been turned off for this large file in order to reduce memory usage and avoid freezing or crashing.",an(e.uri.path));this._notificationService.prompt(Fe.Info,t,[{label:h(5157,"Forcefully Enable Features"),run:()=>{this._configurationService.updateValue("editor.largeFileOptimizations",!1).then(()=>{this._notificationService.info(h(5158,"Please reopen file in order for this setting to take effect."))},i=>{this._notificationService.error(i)})}}],{neverShowAgain:{id:"editor.contrib.largeFileOptimizationsWarner"}})}}};YL=f([p(1,Dt),p(2,ne)],YL);Lt(YL.ID,YL,_t.AfterFirstRender);class UHe{constructor(e,t,i){this._selection=e,this._cursors=t,this._selectionId=null,this._trimInRegexesAndStrings=i}getEditOperations(e,t){const i=Kge(e,this._cursors,this._trimInRegexesAndStrings);for(let n=0,o=i.length;n<o;n++){const r=i[n];t.addEditOperation(r.range,r.text)}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function Kge(s,e,t){e.sort((a,c)=>a.lineNumber===c.lineNumber?a.column-c.column:a.lineNumber-c.lineNumber);for(let a=e.length-2;a>=0;a--)e[a].lineNumber===e[a+1].lineNumber&&e.splice(a,1);const i=[];let n=0,o=0;const r=e.length;for(let a=1,c=s.getLineCount();a<=c;a++){const d=s.getLineContent(a),l=d.length+1;let u=0;if(o<r&&e[o].lineNumber===a&&(u=e[o].column,o++,u===l)||d.length===0)continue;const g=Lb(d);let m=0;if(g===-1)m=1;else if(g!==d.length-1)m=g+2;else continue;if(!t){if(!s.tokenization.hasAccurateTokensForLine(a))continue;const v=s.tokenization.getLineTokens(a),_=v.getStandardTokenType(v.findTokenIndexAtOffset(m));if(_===jc.String||_===jc.RegEx)continue}m=Math.max(u,m),i[n++]=qi.delete(new P(a,m,a,l))}return i}var rC;function $He(s){return(e,t)=>{if(e.rootUri&&!t.rootUri)return-1;if(!e.rootUri&&t.rootUri)return 1;if(!e.rootUri&&!t.rootUri)return 0;const i=od(s,e.rootUri),n=od(s,t.rootUri);return i&&n?jge(e,t):i?-1:n?1:0}}function jge(s,e){return s.kind==="primary"?-1:e.kind==="primary"?1:s.kind==="secondary"?-1:e.kind==="secondary"?1:0}let zte=class extends F{static{rC=this}static{this.STORAGE_KEY="workbench.scm.quickDiffProviders.hidden"}get providers(){return Array.from(this.quickDiffProviders).sort(jge)}constructor(e,t){super(),this.storageService=e,this.uriIdentityService=t,this.quickDiffProviders=new Set,this._onDidChangeQuickDiffProviders=this._register(new M),this.onDidChangeQuickDiffProviders=this._onDidChangeQuickDiffProviders.event,this.hiddenQuickDiffProviders=new Set,this.loadState()}addQuickDiffProvider(e){return this.quickDiffProviders.add(e),this._onDidChangeQuickDiffProviders.fire(),{dispose:()=>{this.quickDiffProviders.delete(e),this._onDidChangeQuickDiffProviders.fire()}}}async getQuickDiffs(e,t="",i=!1){const n=Array.from(this.quickDiffProviders).filter(a=>!a.rootUri||this.uriIdentityService.extUri.isEqualOrParent(e,a.rootUri)).sort($He(e)),o=await Promise.all(n.map(async a=>{const d=(a.selector?zN(a.selector,e,t,i,void 0,void 0):10)>0?await a.getOriginalResource(e)??void 0:void 0;return{provider:a,originalResource:d}})),r=[];for(const{provider:a,originalResource:c}of o)c&&r.push({id:a.id,label:a.label,kind:a.kind,originalResource:c});return r}toggleQuickDiffProviderVisibility(e){this.isQuickDiffProviderVisible(e)?this.hiddenQuickDiffProviders.add(e):this.hiddenQuickDiffProviders.delete(e),this.saveState(),this._onDidChangeQuickDiffProviders.fire()}isQuickDiffProviderVisible(e){return!this.hiddenQuickDiffProviders.has(e)}loadState(){const e=this.storageService.get(rC.STORAGE_KEY,he.PROFILE);if(e)try{this.hiddenQuickDiffProviders=new Set(JSON.parse(e))}catch{}}saveState(){this.hiddenQuickDiffProviders.size===0?this.storageService.remove(rC.STORAGE_KEY,he.PROFILE):this.storageService.store(rC.STORAGE_KEY,JSON.stringify(Array.from(this.hiddenQuickDiffProviders)),he.PROFILE,gt.USER)}};zte=rC=f([p(0,it),p(1,nn)],zte);async function GHe(s,e,t,i){const n=await s.getQuickDiffs(e,t,i);return n.length>0?n[0].originalResource:null}ue(class extends Se{constructor(){super({id:"editor.action.formatChanges",label:I(7222,"Format Modified Lines"),precondition:x.and(V.writable,V.hasDocumentSelectionFormattingProvider)})}async run(e,t){const i=e.get(Z);if(!t.hasModel())return;const n=await i.invokeFunction(Yge,t.getModel());if(An(n))return i.invokeFunction(fN,t,n,xu.Explicit,Qc.None,Ce.None,!0)}});async function Yge(s,e){const t=s.get(LN),i=s.get(vc),n=s.get(Ci),o=await GHe(t,e.uri,e.getLanguageId(),Cu(e));if(!o)return null;const r=[],a=await n.createModelReference(o);try{if(!i.canComputeDirtyDiff(o,e.uri))return;const c=await i.computeDirtyDiff(o,e.uri,!1);if(!An(c))return;for(const d of c)r.push(e.validateRange(new P(d.modifiedStartLineNumber,1,d.modifiedEndLineNumber||d.modifiedStartLineNumber,Number.MAX_SAFE_INTEGER)))}finally{a.dispose()}return r}let eG=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){if(!e.textEditorModel)return;const i=this.configurationService.getValue("files.trimTrailingWhitespace",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource}),n=this.configurationService.getValue("files.trimTrailingWhitespaceInRegexAndStrings",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource});i&&this.doTrimTrailingWhitespace(e.textEditorModel,t.reason===gi.AUTO,n)}doTrimTrailingWhitespace(e,t,i){let n=[],o=[];const r=E0(e,this.codeEditorService);if(r&&(n=r.getSelections(),t)){o=n.map(d=>d.getPosition());const c=cs.get(r)?.getSessionEnclosingRange();if(c)for(let d=c.startLineNumber;d<=c.endLineNumber;d++)o.push(new we(d,e.getLineMaxColumn(d)))}const a=Kge(e,o,i);a.length&&e.pushEditOperations(n,a,c=>n)}};eG=f([p(0,ne),p(1,Bt)],eG);function E0(s,e){let t=null;if(s.isAttachedToEditor()){for(const i of e.listCodeEditors())if(i.hasModel()&&i.getModel()===s){if(i.hasTextFocus())return i;t=i}}return t}let tG=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){e.textEditorModel&&this.configurationService.getValue("files.insertFinalNewline",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource})&&this.doInsertFinalNewLine(e.textEditorModel)}doInsertFinalNewLine(e){const t=e.getLineCount(),i=e.getLineContent(t),n=Lb(i)===-1;if(!t||n)return;const o=[qi.insert(new we(t,e.getLineMaxColumn(t)),e.getEOL())],r=E0(e,this.codeEditorService);r?r.executeEdits("insertFinalNewLine",o,r.getSelections()):e.pushEditOperations([],o,()=>null)}};tG=f([p(0,ne),p(1,Bt)],tG);let iG=class{constructor(e,t){this.configurationService=e,this.codeEditorService=t}async participate(e,t){e.textEditorModel&&this.configurationService.getValue("files.trimFinalNewlines",{overrideIdentifier:e.textEditorModel.getLanguageId(),resource:e.resource})&&this.doTrimFinalNewLines(e.textEditorModel,t.reason===gi.AUTO)}findLastNonEmptyLine(e){for(let t=e.getLineCount();t>=1;t--)if(e.getLineLength(t)>0)return t;return 0}doTrimFinalNewLines(e,t){const i=e.getLineCount();if(i===1)return;let n=[],o=0;const r=E0(e,this.codeEditorService);if(r&&(n=r.getSelections(),t))for(let l=0,u=n.length;l<u;l++){const g=n[l].positionLineNumber;g>o&&(o=g)}const a=this.findLastNonEmptyLine(e),c=Math.max(a+1,o+1),d=e.validateRange(new P(c,1,i,e.getLineMaxColumn(i)));d.isEmpty()||(e.pushEditOperations(n,[qi.delete(d)],l=>n),r?.setSelections(n))}};iG=f([p(0,ne),p(1,Bt)],iG);let nG=class{constructor(e,t,i){this.configurationService=e,this.codeEditorService=t,this.instantiationService=i}async participate(e,t,i,n){if(!e.textEditorModel||t.reason===gi.AUTO)return;const o=e.textEditorModel,r={overrideIdentifier:o.getLanguageId(),resource:o.uri},a=new Qc(u=>{i.report({message:h(5173,"Running '{0}' Formatter ([configure]({1})).",u.displayName||u.extensionId&&u.extensionId.value||"???","command:workbench.action.openSettings?%5B%22editor.formatOnSave%22%5D")})});if(!this.configurationService.getValue("editor.formatOnSave",r))return;const d=E0(o,this.codeEditorService)||o,l=this.configurationService.getValue("editor.formatOnSaveMode",r);if(l==="file")await this.instantiationService.invokeFunction(JF,d,xu.Silent,a,n);else{const u=await this.instantiationService.invokeFunction(Yge,mo(d)?d.getModel():d);u===null&&l==="modificationsIfAvailable"?await this.instantiationService.invokeFunction(JF,d,xu.Silent,a,n):u&&await this.instantiationService.invokeFunction(fN,d,u,xu.Silent,a,n,!1)}}};nG=f([p(0,ne),p(1,Bt),p(2,Z)],nG);let sG=class extends F{constructor(e,t,i,n,o,r){super(),this.configurationService=e,this.instantiationService=t,this.languageFeaturesService=i,this.hostService=n,this.editorService=o,this.codeEditorService=r,this._register(this.hostService.onDidChangeFocus(()=>{this.triggerCodeActionsCommand()})),this._register(this.editorService.onDidActiveEditorChange(()=>{this.triggerCodeActionsCommand()}))}async triggerCodeActionsCommand(){if(this.configurationService.getValue("editor.codeActions.triggerOnFocusChange")&&this.configurationService.getValue("files.autoSave")==="afterDelay"){const e=this.codeEditorService.getActiveCodeEditor()?.getModel();if(!e)return;const t={overrideIdentifier:e.getLanguageId(),resource:e.uri},i=this.configurationService.getValue("editor.codeActionsOnSave",t);if(!i||Array.isArray(i))return;const n=Object.keys(i).filter(a=>i[a]&&i[a]==="always"&&pi.Source.contains(new Ut(a))),o=new li,r=[];for(const a of n)r.push(new Ut(a));await this.applyOnSaveActions(e,r,[],Qc.None,o.token)}}async participate(e,t,i,n){if(!e.textEditorModel)return;const o=e.textEditorModel,r={overrideIdentifier:o.getLanguageId(),resource:o.uri},a=this.configurationService.getValue("editor.codeActionsOnSave",r);if(!a||t.reason===gi.AUTO||t.reason!==gi.EXPLICIT&&Array.isArray(a))return;const c=Array.isArray(a)?a:Object.keys(a).filter(g=>a[g]&&a[g]!=="never"),d=this.createCodeActionsOnSave(c);if(Array.isArray(a)||d.sort((g,m)=>pi.SourceFixAll.contains(g)?pi.SourceFixAll.contains(m)?0:-1:pi.SourceFixAll.contains(m)?1:0),!d.length)return;const l=Array.isArray(a)?[]:Object.keys(a).filter(g=>a[g]==="never"||!1).map(g=>new Ut(g));i.report({message:h(5174,"Quick Fixes")});const u=Array.isArray(a)?d:d.filter(g=>a[g.value]==="always"||(a[g.value]==="explicit"||a[g.value]===!0)&&t.reason===gi.EXPLICIT);await this.applyOnSaveActions(o,u,l,i,n)}createCodeActionsOnSave(e){const t=e.map(i=>new Ut(i));return t.filter(i=>t.every(n=>n.equals(i)||!n.contains(i)))}async applyOnSaveActions(e,t,i,n,o){const r=new class{constructor(){this._names=new Set}_report(){n.report({message:h(5175,"Getting code actions from {0} ([configure]({1})).",[...this._names].map(a=>`'${a}'`).join(", "),"command:workbench.action.openSettings?%5B%22editor.codeActionsOnSave%22%5D")})}report(a){a.displayName&&!this._names.has(a.displayName)&&(this._names.add(a.displayName),this._report())}};for(const a of t){const c=await this.getActionsToRun(e,a,i,r,o);if(o.isCancellationRequested){c.dispose();return}try{for(const d of c.validActions)if(n.report({message:h(5176,"Applying code action '{0}'.",d.action.title)}),await this.instantiationService.invokeFunction(ege,d,wu.OnSave,{},o),o.isCancellationRequested)return}catch{}finally{c.dispose()}}}getActionsToRun(e,t,i,n,o){return wm(this.languageFeaturesService.codeActionProvider,e,e.getFullModelRange(),{type:jo.Auto,triggerAction:Lr.OnSave,filter:{include:t,excludes:i,includeSourceActions:!0}},n,o)}};sG=f([p(0,ne),p(1,Z),p(2,Ne),p(3,Hn),p(4,de),p(5,Bt)],sG);let oG=class extends F{constructor(e,t){super(),this.instantiationService=e,this.textFileService=t,this.registerSaveParticipants()}registerSaveParticipants(){this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(eG))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(sG))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(nG))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(tG))),this._register(this.textFileService.files.addSaveParticipant(this.instantiationService.createInstance(iG)))}};oG=f([p(0,Z),p(1,Ps)],oG);const zHe=Ke.as(df.Workbench);zHe.registerWorkbenchContribution(oG,mc.Restored);class w5 extends X{static{this.ID="editor.action.toggleMinimap"}constructor(){super({id:w5.ID,title:{...I(5177,"Toggle Minimap"),mnemonicTitle:h(5178,"&&Minimap")},category:te.View,f1:!0,toggled:x.equals("config.editor.minimap.enabled",!0),menu:{id:N.MenubarAppearanceMenu,group:"4_editor",order:1}})}async run(e){const t=e.get(ne),i=!t.getValue("editor.minimap.enabled");return t.updateValue("editor.minimap.enabled",i)}}Y(w5);class iw extends X{static{this.ID="workbench.action.toggleMultiCursorModifier"}static{this.multiCursorModifierConfigurationKey="editor.multiCursorModifier"}constructor(){super({id:iw.ID,title:I(5179,"Toggle Multi-Cursor Modifier"),f1:!0})}run(e){const t=e.get(ne),n=t.getValue("editor").multiCursorModifier==="ctrlCmd"?"alt":"ctrlCmd";return t.updateValue(iw.multiCursorModifierConfigurationKey,n)}}const S5=new O("multiCursorModifier","altKey");let rG=class extends F{constructor(e,t){super(),this.configurationService=e,this._multiCursorModifier=S5.bindTo(t),this._update(),this._register(e.onDidChangeConfiguration(i=>{i.affectsConfiguration("editor.multiCursorModifier")&&this._update()}))}_update(){const t=this.configurationService.getValue("editor").multiCursorModifier==="ctrlCmd"?"ctrlCmd":"altKey";this._multiCursorModifier.set(t)}};rG=f([p(0,ne),p(1,fe)],rG);Ke.as(df.Workbench).registerWorkbenchContribution(rG,mc.Restored);Y(iw);ge.appendMenuItem(N.MenubarSelectionMenu,{group:"4_config",command:{id:iw.ID,title:h(5180,"Switch to Alt+Click for Multi-Cursor")},when:S5.isEqualTo("ctrlCmd"),order:1});ge.appendMenuItem(N.MenubarSelectionMenu,{group:"4_config",command:{id:iw.ID,title:Yt?h(5181,"Switch to Cmd+Click for Multi-Cursor"):h(5182,"Switch to Ctrl+Click for Multi-Cursor")},when:S5.isEqualTo("altKey"),order:1});class C5 extends X{static{this.ID="editor.action.toggleRenderControlCharacter"}constructor(){super({id:C5.ID,title:{...I(5183,"Toggle Control Characters"),mnemonicTitle:h(5184,"Render &&Control Characters")},category:te.View,f1:!0,toggled:x.equals("config.editor.renderControlCharacters",!0),menu:{id:N.MenubarAppearanceMenu,group:"4_editor",order:5}})}run(e){const t=e.get(ne),i=!t.getValue("editor.renderControlCharacters");return t.updateValue("editor.renderControlCharacters",i)}}Y(C5);const Qge="transientWordWrapState",E5="isWordWrapMinified",x5="isDominatedByLongLines",Xge=new O("canToggleWordWrap",!1,!0),Zge=new O("editorWordWrap",!1,h(5187,"Whether the editor is currently using word wrapping."));function QL(s,e,t){t.setTransientModelProperty(s,Qge,e)}function XL(s,e){return e.getTransientModelProperty(s,Qge)}const x0="editor.action.toggleWordWrap";class qHe extends Se{constructor(){super({id:x0,label:I(5188,"View: Toggle Word Wrap"),precondition:void 0,kbOpts:{kbExpr:null,primary:E.Alt|S.KeyZ,weight:W.EditorContrib}})}run(e,t){const i=e.get(Bt),n=e.get(Z);if(!nw(i,t))return;const o=t.getModel(),r=XL(o,i);let a;r?a=null:a={wordWrapOverride:t.getOption(L.wrappingInfo).wrappingColumn===-1?"on":"off"},QL(o,a,i);const c=n.invokeFunction(NHe,t);if(c){const d=c.getOriginalEditor(),l=c.getModifiedEditor(),u=d===t?l:d;nw(i,u)&&(QL(u.getModel(),a,i),c.updateOptions({}))}}}let ZL=class extends F{static{this.ID="editor.contrib.toggleWordWrapController"}constructor(e,t,i){super(),this._editor=e,this._contextKeyService=t,this._codeEditorService=i;const o=this._editor.getOptions().get(L.wrappingInfo),r=this._contextKeyService.createKey(E5,o.isWordWrapMinified),a=this._contextKeyService.createKey(x5,o.isDominatedByLongLines);let c=!1;this._register(e.onDidChangeConfiguration(l=>{if(!l.hasChanged(L.wrappingInfo))return;const g=this._editor.getOptions().get(L.wrappingInfo);r.set(g.isWordWrapMinified),a.set(g.isDominatedByLongLines),c||d()})),this._register(e.onDidChangeModel(l=>{d()})),this._register(i.onDidChangeTransientModelProperty(()=>{d()}));const d=()=>{if(!nw(this._codeEditorService,this._editor))return;const l=XL(this._editor.getModel(),this._codeEditorService);try{c=!0,this._applyWordWrapState(l)}finally{c=!1}}}_applyWordWrapState(e){const t=e?e.wordWrapOverride:"inherit";this._editor.updateOptions({wordWrapOverride2:t})}};ZL=f([p(1,fe),p(2,Bt)],ZL);let JL=class extends F{static{this.ID="diffeditor.contrib.toggleWordWrapController"}constructor(e,t){super(),this._diffEditor=e,this._codeEditorService=t,this._register(this._diffEditor.onDidChangeModel(()=>{this._ensureSyncedWordWrapToggle()}))}_ensureSyncedWordWrapToggle(){const e=this._diffEditor.getOriginalEditor(),t=this._diffEditor.getModifiedEditor();if(!e.hasModel()||!t.hasModel())return;const i=XL(e.getModel(),this._codeEditorService),n=XL(t.getModel(),this._codeEditorService);i&&!n&&nw(this._codeEditorService,e)&&(QL(t.getModel(),i,this._codeEditorService),this._diffEditor.updateOptions({})),!i&&n&&nw(this._codeEditorService,t)&&(QL(e.getModel(),n,this._codeEditorService),this._diffEditor.updateOptions({}))}};JL=f([p(1,Bt)],JL);function nw(s,e){if(!e||e.isSimpleWidget||!e.getModel())return!1;if(e.getOption(L.inDiffEditor)){for(const i of s.listDiffEditors())if(i.getOriginalEditor()===e&&!i.renderSideBySide)return!1}return!0}let eM=class extends F{static{this.ID="workbench.contrib.editorWordWrapContextKeyTracker"}constructor(e,t,i){super(),this._editorService=e,this._codeEditorService=t,this._contextService=i,this._register(T.runAndSubscribe(km,({window:n,disposables:o})=>{o.add(re(n,"focus",()=>this._update(),!0)),o.add(re(n,"blur",()=>this._update(),!0))},{window:zi,disposables:this._store})),this._register(this._editorService.onDidActiveEditorChange(()=>this._update())),this._canToggleWordWrap=Xge.bindTo(this._contextService),this._editorWordWrap=Zge.bindTo(this._contextService),this._activeEditor=null,this._activeEditorListener=new U,this._update()}_update(){const e=this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor();this._activeEditor!==e&&(this._activeEditorListener.clear(),this._activeEditor=e,e&&(this._activeEditorListener.add(e.onDidChangeModel(()=>this._updateFromCodeEditor())),this._activeEditorListener.add(e.onDidChangeConfiguration(t=>{t.hasChanged(L.wrappingInfo)&&this._updateFromCodeEditor()})),this._updateFromCodeEditor()))}_updateFromCodeEditor(){if(nw(this._codeEditorService,this._activeEditor)){const e=this._activeEditor.getOption(L.wrappingInfo);this._setValues(!0,e.wrappingColumn!==-1)}else return this._setValues(!1,!1)}_setValues(e,t){this._canToggleWordWrap.set(e),this._editorWordWrap.set(t)}};eM=f([p(0,de),p(1,Bt),p(2,fe)],eM);rc(eM.ID,eM,ac.AfterRestored);Lt(ZL.ID,ZL,_t.Eager);vse(JL.ID,JL);ue(qHe);ge.appendMenuItem(N.EditorTitle,{command:{id:x0,title:h(5189,"Disable wrapping for this file"),icon:K.wordWrap},group:"navigation",order:1,when:x.and(x.has(x5),x.has(E5))});ge.appendMenuItem(N.EditorTitle,{command:{id:x0,title:h(5190,"Enable wrapping for this file"),icon:K.wordWrap},group:"navigation",order:1,when:x.and(V.inDiffEditor.negate(),x.has(x5),x.not(E5))});ge.appendMenuItem(N.MenubarViewMenu,{command:{id:x0,title:h(5191,"&&Word Wrap"),toggled:Zge,precondition:Xge},order:1,group:"6_editor"});class I5 extends X{static{this.ID="editor.action.toggleRenderWhitespace"}constructor(){super({id:I5.ID,title:{...I(5185,"Toggle Render Whitespace"),mnemonicTitle:h(5186,"&&Render Whitespace")},category:te.View,f1:!0,toggled:x.notEquals("config.editor.renderWhitespace","none"),menu:{id:N.MenubarAppearanceMenu,group:"4_editor",order:4}})}run(e){const t=e.get(ne),i=t.getValue("editor.renderWhitespace");let n;return i==="none"?n="all":n="none",t.updateValue("editor.renderWhitespace",n)}}Y(I5);class KHe{constructor(){this._registeredGutterActionsGenerators=new Set}registerGutterActionsGenerator(e){return this._registeredGutterActionsGenerators.add(e),{dispose:()=>{this._registeredGutterActionsGenerators.delete(e)}}}getGutterActionsGenerators(){return Array.from(this._registeredGutterActionsGenerators.values())}}Ke.add("gutterActionsRegistry",new KHe);const jHe=Ke.as("gutterActionsRegistry");let tM=class extends F{static{this.ID="workbench.contrib.editorLineNumberContextMenu"}constructor(e,t,i,n,o){super(),this.editor=e,this.contextMenuService=t,this.menuService=i,this.contextKeyService=n,this.instantiationService=o,this._register(this.editor.onMouseDown(r=>this.doShow(r,!1)))}show(e){this.doShow(e,!0)}doShow(e,t){const i=this.editor.getModel();if(!e.event.rightButton&&!(Yt&&e.event.leftButton&&e.event.ctrlKey)&&!t||e.target.type!==xi.GUTTER_LINE_NUMBERS&&e.target.type!==xi.GUTTER_GLYPH_MARGIN||!e.target.position||!i)return;const n=e.target.position.lineNumber,o=this.contextKeyService.createOverlay([["editorLineNumber",n]]),r=this.menuService.createMenu(N.EditorLineNumberContext,o),a=[];this.instantiationService.invokeFunction(c=>{for(const l of jHe.getGutterActionsGenerators()){const u=new Map;l({lineNumber:n,editor:this.editor,accessor:c},{push:(g,m="navigation")=>{const v=u.get(m)??[];v.push(g),u.set(m,v)}});for(const[g,m]of u.entries())a.push([g,m])}a.sort((l,u)=>l[0].localeCompare(u[0]));const d=r.getActions({arg:{lineNumber:n,uri:i.uri},shouldForwardArgs:!0});if(a.push(...d),e.target.type===xi.GUTTER_LINE_NUMBERS){const l=this.editor.getSelections(),u={startLineNumber:n,endLineNumber:n,startColumn:1,endColumn:i.getLineLength(n)+1};l?.some(m=>!m.isEmpty()&&m.intersectRanges(u)!==null)||this.editor.setSelection(u,td.PROGRAMMATIC)}this.contextMenuService.showContextMenu({getAnchor:()=>e.event,getActions:()=>os.join(...a.map(l=>l[1])),onHide:()=>r.dispose()})})}};tM=f([p(1,bi),p(2,fn),p(3,fe),p(4,Z)],tM);Lt(tM.ID,tM,_t.AfterFirstRender);var or;let lh=class extends F{static{or=this}static{this.configName="editor.defaultFormatter"}static{this.extensionIds=[]}static{this.extensionItemLabels=[]}static{this.extensionDescriptions=[]}constructor(e,t,i,n,o,r,a,c,d,l){super(),this._extensionService=e,this._extensionEnablementService=t,this._configService=i,this._notificationService=n,this._dialogService=o,this._quickInputService=r,this._languageService=a,this._languageFeaturesService=c,this._languageStatusService=d,this._editorService=l,this._languageStatusStore=this._store.add(new U),this._store.add(this._extensionService.onDidChangeExtensions(this._updateConfigValues,this)),this._store.add(ISe.setFormatterSelector((u,g,m,v)=>this._selectFormatter(u,g,m,v))),this._store.add(l.onDidActiveEditorChange(this._updateStatus,this)),this._store.add(c.documentFormattingEditProvider.onDidChange(this._updateStatus,this)),this._store.add(c.documentRangeFormattingEditProvider.onDidChange(this._updateStatus,this)),this._store.add(i.onDidChangeConfiguration(u=>u.affectsConfiguration(or.configName)&&this._updateStatus())),this._updateConfigValues()}async _updateConfigValues(){await this._extensionService.whenInstalledExtensionsRegistered();let e=[...this._extensionService.extensions];e=e.sort((t,i)=>{const n=t.categories?.find(r=>r==="Formatters"||r==="Programming Languages"),o=i.categories?.find(r=>r==="Formatters"||r==="Programming Languages");return n&&!o?-1:!n&&o?1:t.name.localeCompare(i.name)}),or.extensionIds.length=0,or.extensionItemLabels.length=0,or.extensionDescriptions.length=0,or.extensionIds.push(null),or.extensionItemLabels.push(h(7199,"None")),or.extensionDescriptions.push(h(7200,"None"));for(const t of e)(t.main||t.browser)&&(or.extensionIds.push(t.identifier.value),or.extensionItemLabels.push(t.displayName??""),or.extensionDescriptions.push(t.description??""))}static _maybeQuotes(e){return e.match(/\s/)?`'${e}'`:e}async _analyzeFormatter(e,t,i){const n=this._configService.getValue(or.configName,{resource:i.uri,overrideIdentifier:i.getLanguageId()});if(n){const a=t.find(d=>vs.equals(d.extensionId,n));if(a)return a;const c=await this._extensionService.getExtension(n);if(c&&this._extensionEnablementService.isEnabled(cne(c))){const d=this._languageService.getLanguageName(i.getLanguageId())||i.getLanguageId();return e===T8.File?h(7201,"Extension '{0}' is configured as formatter but it cannot format '{1}'-files",c.displayName||c.name,d):h(7202,"Extension '{0}' is configured as formatter but it can only format '{1}'-files as a whole, not selections or parts of it.",c.displayName||c.name,d)}}else if(t.length===1)return t[0];const o=this._languageService.getLanguageName(i.getLanguageId())||i.getLanguageId();return n?h(7204,"Extension '{0}' is configured as formatter but not available. Select a different default formatter to continue.",n):h(7203,"There are multiple formatters for '{0}' files. One of them should be configured as default formatter.",or._maybeQuotes(o))}async _selectFormatter(e,t,i,n){const o=await this._analyzeFormatter(n,e,t);if(typeof o!="string")return o;if(i!==xu.Silent){const{confirmed:r}=await this._dialogService.confirm({message:h(7205,"Configure Default Formatter"),detail:o,primaryButton:h(7206,"&&Configure...")});if(r)return this._pickAndPersistDefaultFormatter(e,t)}else this._notificationService.prompt(Fe.Info,o,[{label:h(7207,"Configure..."),run:()=>this._pickAndPersistDefaultFormatter(e,t)}],{priority:lne.SILENT})}async _pickAndPersistDefaultFormatter(e,t){const i=e.map((r,a)=>({index:a,label:r.displayName||(r.extensionId?r.extensionId.value:"?"),description:r.extensionId&&r.extensionId.value})),n=this._languageService.getLanguageName(t.getLanguageId())||t.getLanguageId(),o=await this._quickInputService.pick(i,{placeHolder:h(7208,"Select a default formatter for '{0}' files",or._maybeQuotes(n))});if(!(!o||!e[o.index].extensionId))return this._configService.updateValue(or.configName,e[o.index].extensionId.value,{resource:t.uri,overrideIdentifier:t.getLanguageId()}),e[o.index]}_updateStatus(){this._languageStatusStore.clear();const e=mI(this._editorService.activeTextEditorControl);if(!e||!e.hasModel())return;const t=e.getModel(),i=Gse(this._languageFeaturesService.documentFormattingEditProvider,this._languageFeaturesService.documentRangeFormattingEditProvider,t);if(i.length===0)return;const n=new li;this._languageStatusStore.add(Ie(()=>n.dispose(!0))),this._analyzeFormatter(T8.File,i,t).then(o=>{if(n.token.isCancellationRequested||typeof o!="string")return;const r={id:`formatter/configure/dfl/${Pn()}`,title:h(7209,"Configure...")};this._languageStatusStore.add(Ee.registerCommand(r.id,()=>this._pickAndPersistDefaultFormatter(i,t))),this._languageStatusStore.add(this._languageStatusService.addStatus({id:"formatter.conflict",name:h(7210,"Formatter Conflicts"),selector:{language:t.getLanguageId(),pattern:t.uri.fsPath},severity:Fe.Error,label:h(7211,"Formatting"),detail:o,busy:!1,source:"",command:r,accessibilityInfo:void 0}))})}};lh=or=f([p(0,cn),p(1,gd),p(2,ne),p(3,Dt),p(4,ei),p(5,Wt),p(6,vi),p(7,Ne),p(8,Uq),p(9,de)],lh);Ke.as(df.Workbench).registerWorkbenchContribution(lh,mc.Restored);Ke.as(Js.Configuration).registerConfiguration({...Bv,properties:{[lh.configName]:{description:h(7212,"Defines a default formatter which takes precedence over all other formatter settings. Must be the identifier of an extension contributing a formatter."),type:["string","null"],default:null,enum:lh.extensionIds,enumItemLabels:lh.extensionItemLabels,markdownEnumDescriptions:lh.extensionDescriptions}}});async function Jge(s,e,t){const i=s.get(Wt),n=s.get(ne),o=s.get(vi),r={resource:e.uri,overrideIdentifier:e.getLanguageId()},a=n.getValue(lh.configName,r);let c;const d=t.map((g,m)=>{const v=vs.equals(g.extensionId,a),_={index:m,label:g.displayName||"",description:v?h(7213,"(default)"):void 0};return v&&(c=_),_}),l={label:h(7214,"Configure Default Formatter...")},u=await i.pick([...d,{type:"separator"},l],{placeHolder:h(7215,"Select a formatter"),activeItem:c});if(u)if(u===l){const g=o.getLanguageName(e.getLanguageId())||e.getLanguageId(),m=await i.pick(d,{placeHolder:h(7208,"Select a default formatter for '{0}' files",lh._maybeQuotes(g))});m&&t[m.index].extensionId&&n.updateValue(lh.configName,t[m.index].extensionId.value,r);return}else return u.index;else return}ue(class extends Se{constructor(){super({id:"editor.action.formatDocument.multiple",label:h(7216,"Format Document With..."),alias:"Format Document...",precondition:x.and(V.writable,V.hasMultipleDocumentFormattingProvider),contextMenuOpts:{group:"1_modification",order:1.3}})}async run(e,t,i){if(!t.hasModel())return;const n=e.get(Z),o=e.get(Ne),r=t.getModel(),a=Gse(o.documentFormattingEditProvider,o.documentRangeFormattingEditProvider,r),c=await n.invokeFunction(Jge,r,a);typeof c=="number"&&await n.invokeFunction(DSe,a[c],t,xu.Explicit,Ce.None)}});ue(class extends Se{constructor(){super({id:"editor.action.formatSelection.multiple",label:h(7217,"Format Selection With..."),alias:"Format Code...",precondition:x.and(x.and(V.writable),V.hasMultipleDocumentSelectionFormattingProvider),contextMenuOpts:{when:x.and(V.hasNonEmptySelection),group:"1_modification",order:1.31}})}async run(e,t){if(!t.hasModel())return;const i=e.get(Z),n=e.get(Ne),o=t.getModel();let r=t.getSelection();r.isEmpty()&&(r=new P(r.startLineNumber,1,r.startLineNumber,o.getLineMaxColumn(r.startLineNumber)));const a=n.documentRangeFormattingEditProvider.ordered(o),c=await i.invokeFunction(Jge,o,a);typeof c=="number"&&await i.invokeFunction(kSe,a[c],t,r,Ce.None,!0)}});ue(class extends Se{constructor(){super({id:"editor.action.formatDocument.none",label:I(7218,"Format Document"),precondition:x.and(V.writable,V.hasDocumentFormattingProvider.toNegated()),kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyF,linux:{primary:E.CtrlCmd|E.Shift|S.KeyI},weight:W.EditorContrib}})}async run(e,t){if(!t.hasModel())return;const i=e.get(Ge),n=e.get(Aw),o=e.get(Dt),r=e.get(ei),a=e.get(Ne),c=t.getModel(),d=a.documentFormattingEditProvider.all(c).length;if(d>1)return i.executeCommand("editor.action.formatDocument.multiple");if(d===1)return i.executeCommand("editor.action.formatDocument");if(c.isTooLargeForSyncing())o.warn(h(7219,"This file cannot be formatted because it is too large"));else{const l=c.getLanguageId(),u=h(7220,"There is no formatter for '{0}' files installed.",l),{confirmed:g}=await r.confirm({message:u,primaryButton:h(7221,"&&Install Formatter...")});g&&n.openSearch(`category:formatters ${l}`)}}});var qr;let Em=class extends F{static{qr=this}static{this.configName="editor.defaultFoldingRangeProvider"}static{this.extensionIds=[]}static{this.extensionItemLabels=[]}static{this.extensionDescriptions=[]}constructor(e,t){super(),this._extensionService=e,this._configurationService=t,this._store.add(this._extensionService.onDidChangeExtensions(this._updateConfigValues,this)),this._store.add(sq.setFoldingRangeProviderSelector(this._selectFoldingRangeProvider.bind(this))),this._updateConfigValues()}async _updateConfigValues(){await this._extensionService.whenInstalledExtensionsRegistered(),qr.extensionIds.length=0,qr.extensionItemLabels.length=0,qr.extensionDescriptions.length=0,qr.extensionIds.push(null),qr.extensionItemLabels.push(h(7196,"All")),qr.extensionDescriptions.push(h(7197,"All active folding range providers"));const e=[],t=[];for(const n of this._extensionService.extensions)(n.main||n.browser)&&(n.categories?.find(o=>o==="Programming Languages")?e.push(n):t.push(n));const i=(n,o)=>n.name.localeCompare(o.name);for(const n of e.sort(i))qr.extensionIds.push(n.identifier.value),qr.extensionItemLabels.push(n.displayName??""),qr.extensionDescriptions.push(n.description??"");for(const n of t.sort(i))qr.extensionIds.push(n.identifier.value),qr.extensionItemLabels.push(n.displayName??""),qr.extensionDescriptions.push(n.description??"")}_selectFoldingRangeProvider(e,t){const i=this._configurationService.getValue(qr.configName,{overrideIdentifier:t.getLanguageId()});if(i)return e.filter(n=>n.id===i)}};Em=qr=f([p(0,cn),p(1,ne)],Em);Ke.as(Js.Configuration).registerConfiguration({...Bv,properties:{[Em.configName]:{description:h(7198,"Defines a default folding range provider that takes precedence over all other folding range providers. Must be the identifier of an extension contributing a folding range provider."),type:["string","null"],default:null,enum:Em.extensionIds,enumItemLabels:Em.extensionItemLabels,markdownEnumDescriptions:Em.extensionDescriptions}}});Ke.as(df.Workbench).registerWorkbenchContribution(Em,mc.Restored);var ET;let Ev=class{static{ET=this}static{this.IsReading=new O("isReadingLineWithInlayHints",!1,{type:"boolean",description:h(7223,"Whether the current line and its inlay hints are currently focused")})}static{this.ID="editor.contrib.InlayHintsAccessibility"}static get(e){return e.getContribution(ET.ID)??void 0}constructor(e,t,i,n){this._editor=e,this._accessibilitySignalService=i,this._instaService=n,this._sessionDispoosables=new U,this._ariaElement=document.createElement("span"),this._ariaElement.style.position="fixed",this._ariaElement.className="inlayhint-accessibility-element",this._ariaElement.tabIndex=0,this._ariaElement.setAttribute("aria-description",h(7224,"Code with Inlay Hint Information")),this._ctxIsReading=ET.IsReading.bindTo(t)}dispose(){this._sessionDispoosables.dispose(),this._ctxIsReading.reset(),this._ariaElement.remove()}_reset(){Xi(this._ariaElement),this._sessionDispoosables.clear(),this._ctxIsReading.reset()}async _read(e,t){if(this._sessionDispoosables.clear(),this._ariaElement.isConnected||this._editor.getDomNode()?.appendChild(this._ariaElement),!this._editor.hasModel()||!this._ariaElement.isConnected){this._ctxIsReading.set(!1);return}const i=new li;this._sessionDispoosables.add(i);for(const c of t)await c.resolve(i.token);if(i.token.isCancellationRequested)return;const n=this._editor.getModel(),o=[];let r=0,a=!1;for(const c of t){const d=n.getValueInRange({startLineNumber:e,startColumn:r+1,endLineNumber:e,endColumn:c.hint.position.column});if(d.length>0&&(o.push(d),r=c.hint.position.column-1),r>750){o.push(""),a=!0;break}const l=document.createElement("em"),{label:u}=c.hint;if(typeof u=="string")l.innerText=u;else for(const g of u)if(g.command){const m=this._instaService.createInstance(kx,l,{href:_ae(g.command),label:g.label,title:g.command.title},void 0);this._sessionDispoosables.add(m)}else l.innerText+=g.label;o.push(l)}a||o.push(n.getValueInRange({startLineNumber:e,startColumn:r+1,endLineNumber:e,endColumn:Number.MAX_SAFE_INTEGER})),kh(this._ariaElement,...o),this._ariaElement.focus(),this._ctxIsReading.set(!0),this._sessionDispoosables.add(re(this._ariaElement,"focusout",()=>{this._reset()}))}startInlayHintsReading(){if(!this._editor.hasModel())return;const e=this._editor.getPosition().lineNumber,t=Iy.get(this._editor)?.getInlayHintsForLine(e);!t||t.length===0?this._accessibilitySignalService.playSignal(Vp.noInlayHints):this._read(e,t)}stopInlayHintsReading(){this._reset(),this._editor.focus()}};Ev=ET=f([p(1,fe),p(2,lI),p(3,Z)],Ev);Y(class extends Fr{constructor(){super({id:"inlayHints.startReadingLineWithHint",title:I(7225,"Read Line with Inlay Hints"),precondition:V.hasInlayHintsProvider,f1:!0})}runEditorCommand(e,t){Ev.get(t)?.startInlayHintsReading()}});Y(class extends Fr{constructor(){super({id:"inlayHints.stopReadingLineWithHint",title:I(7226,"Stop Inlay Hints Reading"),precondition:Ev.IsReading,f1:!0,keybinding:{weight:W.EditorContrib,primary:S.Escape}})}runEditorCommand(e,t){Ev.get(t)?.stopInlayHintsReading()}});Lt(Ev.ID,Ev,_t.Lazy);const YHe=s=>({type:"string",enum:["always","explicit","never",!0,!1],enumDescriptions:[h(5111,"Triggers Code Actions on explicit saves and auto saves triggered by window or focus changes."),h(5112,"Triggers Code Actions only when explicitly saved"),h(5113,"Never triggers Code Actions on save"),h(5114,'Triggers Code Actions only when explicitly saved. This value will be deprecated in favor of "explicit".'),h(5115,'Never triggers Code Actions on save. This value will be deprecated in favor of "never".')],default:"explicit",description:s}),QHe=s=>({type:["string","boolean"],enum:["explicit","never",!0,!1],enumDescriptions:[h(5116,"Triggers Code Actions only when explicitly saved."),h(5117,"Never triggers Code Actions on save."),h(5118,'Triggers Code Actions only when explicitly saved. This value will be deprecated in favor of "explicit".'),h(5119,'Triggers Code Actions only when explicitly saved. This value will be deprecated in favor of "never".')],default:"explicit",description:s}),aG={oneOf:[{type:"object",additionalProperties:{type:"string"}},{type:"array",items:{type:"string"}}],markdownDescription:h(5120,'Run Code Actions for the editor on save. Code Actions must be specified and the editor must not be shutting down. When {0} is set to `afterDelay`, Code Actions will only be run when the file is saved explicitly. Example: `"source.organizeImports": "explicit" `',"`#files.autoSave#`"),type:["object","array"],additionalProperties:{type:"string",enum:["always","explicit","never",!0,!1]},default:{},scope:Ht.LANGUAGE_OVERRIDABLE},epe=Object.freeze({...Bv,properties:{"editor.codeActionsOnSave":aG}}),cG={oneOf:[{type:"object",additionalProperties:{type:"string"}},{type:"array",items:{type:"string"}}],markdownDescription:h(5121,'Run a series of Code Actions for a notebook on save. Code Actions must be specified and the editor must not be shutting down. When {0} is set to `afterDelay`, Code Actions will only be run when the file is saved explicitly. Example: `"notebook.source.organizeImports": "explicit"`',"`#files.autoSave#`"),type:"object",additionalProperties:{type:["string","boolean"],enum:["explicit","never",!0,!1]},default:{}},XHe=Object.freeze({...Bv,properties:{"notebook.codeActionsOnSave":cG}});let dG=class extends F{constructor(e,t){super(),this.languageFeatures=t,this._onDidChangeSchemaContributions=this._register(new M),this._allProvidedCodeActionKinds=[],this._register(T.runAndSubscribe(T.debounce(t.codeActionProvider.onDidChange,()=>{},1e3),()=>{this._allProvidedCodeActionKinds=this.getAllProvidedCodeActionKinds(),this.updateConfigurationSchema(this._allProvidedCodeActionKinds),this._onDidChangeSchemaContributions.fire()})),e.registerSchemaContribution({getSchemaAdditions:()=>this.getKeybindingSchemaAdditions(),onDidChange:this._onDidChangeSchemaContributions.event})}getAllProvidedCodeActionKinds(){const e=new Map;for(const t of this.languageFeatures.codeActionProvider.allNoModel())for(const i of t.providedCodeActionKinds??[])e.set(i,new Ut(i));return Array.from(e.values())}updateConfigurationSchema(e){const t={...aG.properties},i={...cG.properties};for(const n of e)pi.Source.contains(n)&&!t[n.value]&&(t[n.value]=YHe(h(5122,"Controls whether '{0}' actions should be run on file save.",n.value)),i[n.value]=QHe(h(5122,"Controls whether '{0}' actions should be run on file save.",n.value)));aG.properties=t,cG.properties=i,Ke.as(Js.Configuration).notifyConfigurationSchemaUpdated(epe)}getKeybindingSchemaAdditions(){const e=(i,n)=>({if:{required:["command"],properties:{command:{const:i}}},then:{properties:{args:{required:["kind"],properties:{kind:{anyOf:[{enum:Array.from(n)},{type:"string"}]}}}}}}),t=i=>{const n=new Set;for(const o of this._allProvidedCodeActionKinds)i.contains(o)&&n.add(o.value);return Array.from(n)};return[e(u5,t(Ut.Empty)),e(p5,t(pi.Refactor)),e(f5,t(pi.Source))]}};dG=f([p(0,He),p(1,Ne)],dG);Ke.as(Js.Configuration).registerConfiguration(epe);Ke.as(Js.Configuration).registerConfiguration(XHe);Ke.as(df.Workbench).registerWorkbenchContribution(dG,mc.Eventually);let lG=class extends F{constructor(e,t){super(),this._table=e,this._quickInputService=t}async show(){const e=[];this._table.getColumnLabels().forEach((o,r)=>{o&&e.push({label:o,index:r})});const t=await this._quickInputService.pick(e,{placeHolder:h(7444,"Select the column to resize, type to filter.")});if(!t)return;const i=await this._quickInputService.input({placeHolder:h(7445,"i.e. 20, 60, 100..."),prompt:h(7446,"Please enter a width in percentage for the '{0}' column.",t.label),validateInput:o=>this._validateColumnResizeValue(o)}),n=i?Number.parseInt(i):void 0;n&&this._table.resizeColumn(t.index,n)}async _validateColumnResizeValue(e){const t=Number.parseInt(e);return e&&!Number.isInteger(t)?h(7447,"Please enter an integer."):t<0||t>100?h(7448,"Please enter a number greater than 0 and less than or equal to 100."):null}};lG=f([p(1,Wt)],lG);class ZHe extends X{constructor(){super({id:"list.resizeColumn",title:{value:h(7442,"Resize Column"),original:"Resize Column"},category:{value:h(7443,"List"),original:"List"},precondition:of,f1:!0})}async run(e){const t=e.get(Ei),i=e.get(Z),n=t.lastFocusedList;n instanceof Nye&&await i.createInstance(lG,n).show()}}let iM=class{static{this.ID="workbench.contrib.listContext"}constructor(e){e.createKey("listSupportsTypeNavigation",!0),e.createKey("listSupportsKeyboardNavigation",!0)}};iM=f([p(0,fe)],iM);rc(iM.ID,iM,ac.BlockStartup);Y(ZHe);const tpe=[];function pS(s){tpe.push(s)}function JHe(){return tpe.slice(0)}let nM=class extends F{static{this.ID="workbench.contrib.editorFeaturesInstantiator"}constructor(e,t){super(),this._instantiationService=t,this._instantiated=!1,this._register(e.onWillCreateCodeEditor(()=>this._instantiate())),this._register(e.onWillCreateDiffEditor(()=>this._instantiate())),(e.listCodeEditors().length>0||e.listDiffEditors().length>0)&&this._instantiate()}_instantiate(){if(this._instantiated)return;this._instantiated=!0;const e=JHe();for(const t of e)try{const i=this._instantiationService.createInstance(t);typeof i.dispose=="function"&&this._register(i)}catch(i){mt(i)}}};nM=f([p(0,Bt),p(1,Z)],nM);rc(nM.ID,nM,ac.BlockRestore);let hG=class extends F{constructor(e,t){super();const i=n=>e.activeContainer.classList.toggle("context-menu-visible",n);this._register(t.onDidShowContextMenu(()=>i(!0))),this._register(t.onDidHideContextMenu(()=>i(!1)))}};hG=f([p(0,af),p(1,bi)],hG);Ke.as(df.Workbench).registerWorkbenchContribution(hG,mc.Eventually);function eUe(s){return[Ri({id:"undo",label:h(2762,"Undo"),run:()=>qd().execCommand("undo")}),Ri({id:"redo",label:h(2763,"Redo"),run:()=>qd().execCommand("redo")}),new os,Ri({id:"editor.action.clipboardCutAction",label:h(2764,"Cut"),run:()=>qd().execCommand("cut")}),Ri({id:"editor.action.clipboardCopyAction",label:h(2765,"Copy"),run:()=>qd().execCommand("copy")}),Ri({id:"editor.action.clipboardPasteAction",label:h(2766,"Paste"),run:async e=>{const t=await s.readText();if(_se(e)||bse(e)){const i=e.selectionStart||0,n=e.selectionEnd||0;e.value=`${e.value.substring(0,i)}${t}${e.value.substring(n,e.value.length)}`,e.selectionStart=i+t.length,e.selectionEnd=e.selectionStart,e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}}}),new os,Ri({id:"editor.action.selectAll",label:h(2767,"Select All"),run:()=>qd().execCommand("selectAll")})]}let sM=class extends F{static{this.ID="workbench.contrib.textInputActionsProvider"}constructor(e,t,i){super(),this.layoutService=e,this.contextMenuService=t,this.clipboardService=i,this.textInputActions=new Ih(()=>eUe(this.clipboardService)),this.registerListeners()}registerListeners(){this._register(T.runAndSubscribe(this.layoutService.onDidAddContainer,({container:e,disposables:t})=>{t.add(re(e,"contextmenu",i=>this.onContextMenu(Et(e),i)))},{container:this.layoutService.mainContainer,disposables:this._store}))}onContextMenu(e,t){if(t.defaultPrevented)return;const i=t.target;if(!_se(i)&&!bse(i))return;Vi.stop(t,!0);const n=new bs(e,t);this.contextMenuService.showContextMenu({getAnchor:()=>n,getActions:()=>this.textInputActions.value,getActionsContext:()=>i})}};sM=f([p(0,yi),p(1,bi),p(2,Vs)],sM);rc(sM.ID,sM,ac.BlockRestore);const tUe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(tUe);class iUe extends X{constructor(){super({id:"workbench.action.inspectContextKeys",title:I(2586,"Inspect Context Keys"),category:te.Developer,f1:!0})}run(e){const t=e.get(fe),i=new U,n=iN(void 0,void 0,i);OM("*","cursor: crosshair !important;",n);const o=document.createElement("div"),r=qd();r.body.appendChild(o),i.add(Ie(()=>o.remove())),o.style.position="absolute",o.style.pointerEvents="none",o.style.backgroundColor="rgba(255, 0, 0, 0.5)",o.style.zIndex="1000";const a=i.add(new Ko(r,"mousemove",!0));i.add(a.event(l=>{const u=l.target,g=Bs(u);o.style.top=`${g.top}px`,o.style.left=`${g.left}px`,o.style.width=`${g.width}px`,o.style.height=`${g.height}px`}));const c=i.add(new Ko(r,"mousedown",!0));T.once(c.event)(l=>{l.preventDefault(),l.stopPropagation()},null,i);const d=i.add(new Ko(r,"mouseup",!0));T.once(d.event)(l=>{l.preventDefault(),l.stopPropagation();const u=t.getContext(l.target);console.log(u.collectAllValues()),Xe(i)},null,i)}}class xb extends X{constructor(){super({id:"workbench.action.toggleScreencastMode",title:I(2587,"Toggle Screencast Mode"),category:te.Developer,f1:!0})}run(e){if(xb.disposable){xb.disposable.dispose(),xb.disposable=void 0;return}const t=e.get(af),i=e.get(ne),n=e.get(He),o=new U,r=t.activeContainer,a=ee(r,j(".screencast-mouse"));o.add(Ie(()=>a.remove()));const c=ee(r,j(".screencast-keyboard"));o.add(Ie(()=>c.remove()));const d=o.add(new M),l=o.add(new M),u=o.add(new M);function g(ft,Qt){Qt.add(Qt.add(new Ko(ft,"mousedown",!0)).event(Ae=>d.fire(Ae))),Qt.add(Qt.add(new Ko(ft,"mouseup",!0)).event(Ae=>l.fire(Ae))),Qt.add(Qt.add(new Ko(ft,"mousemove",!0)).event(Ae=>u.fire(Ae)))}for(const{window:ft,disposables:Qt}of YF())g(t.getContainer(ft),Qt);o.add(km(({window:ft,disposables:Qt})=>g(t.getContainer(ft),Qt))),o.add(t.onDidChangeActiveContainer(()=>{t.activeContainer.appendChild(a),t.activeContainer.appendChild(c)}));const m=()=>{a.style.borderColor=ye.fromHex(i.getValue("screencastMode.mouseIndicatorColor")).toString()};let v;const _=()=>{v=dm(i.getValue("screencastMode.mouseIndicatorSize")||20,20,100),a.style.height=`${v}px`,a.style.width=`${v}px`};m(),_(),o.add(d.event(ft=>{a.style.top=`${ft.clientY-v/2}px`,a.style.left=`${ft.clientX-v/2}px`,a.style.display="block",a.style.transform="scale(1)",a.style.transition="transform 0.1s";const Qt=u.event(Ae=>{a.style.top=`${Ae.clientY-v/2}px`,a.style.left=`${Ae.clientX-v/2}px`,a.style.transform=`scale(${.8})`});T.once(l.event)(()=>{a.style.display="none",Qt.dispose()})}));const w=()=>{c.style.fontSize=`${dm(i.getValue("screencastMode.fontSize")||56,20,100)}px`},C=()=>{c.style.bottom=`${dm(i.getValue("screencastMode.verticalOffset")||0,0,90)}%`};let k;const D=()=>{k=dm(i.getValue("screencastMode.keyboardOverlayTimeout")||800,500,5e3)};w(),C(),D(),o.add(i.onDidChangeConfiguration(ft=>{ft.affectsConfiguration("screencastMode.verticalOffset")&&C(),ft.affectsConfiguration("screencastMode.fontSize")&&w(),ft.affectsConfiguration("screencastMode.keyboardOverlayTimeout")&&D(),ft.affectsConfiguration("screencastMode.mouseIndicatorColor")&&m(),ft.affectsConfiguration("screencastMode.mouseIndicatorSize")&&_()}));const A=o.add(new M),B=o.add(new M),q=o.add(new M),Q=o.add(new M);function ie(ft,Qt){Qt.add(Qt.add(new Ko(ft,"keydown",!0)).event(Ae=>A.fire(Ae))),Qt.add(Qt.add(new Ko(ft,"compositionstart",!0)).event(Ae=>B.fire(Ae))),Qt.add(Qt.add(new Ko(ft,"compositionupdate",!0)).event(Ae=>q.fire(Ae))),Qt.add(Qt.add(new Ko(ft,"compositionend",!0)).event(Ae=>Q.fire(Ae)))}for(const{window:ft,disposables:Qt}of YF())ie(ft,Qt);o.add(km(({window:ft,disposables:Qt})=>ie(ft,Qt)));let oe=0,be,me=!1;const zt=new yn(()=>{c.textContent="",be=void 0,oe=0},k);o.add(B.event(ft=>{me=!0})),o.add(q.event(ft=>{ft.data&&me?(oe>20&&(c.innerText="",oe=0),be=be??ee(c,j("span.key")),be.textContent=ft.data):me&&(c.innerText="",ee(c,j("span.key",{},"Backspace"))),zt.schedule()})),o.add(Q.event(ft=>{be=void 0,oe++})),o.add(A.event(ft=>{if(ft.key==="Process"||/[\uac00-\ud787\u3131-\u314e\u314f-\u3163\u3041-\u3094\u30a1-\u30f4\u30fc\u3005\u3006\u3024\u4e00-\u9fa5]/u.test(ft.key)){ft.code==="Backspace"||ft.code.includes("Key")?me=!0:(be=void 0,me=!1),zt.schedule();return}if(ft.isComposing)return;const Qt=i.getValue("screencastMode.keyboardOptions"),Ae=new vo(ft),di=n.softDispatch(Ae,Ae.target);if(di.kind===qT.KbFound&&di.commandId&&!(Qt.showSingleEditorCursorMoves??!0)&&["cursorLeft","cursorRight","cursorUp","cursorDown"].includes(di.commandId))return;(Ae.ctrlKey||Ae.altKey||Ae.metaKey||Ae.shiftKey||oe>20||Ae.keyCode===S.Backspace||Ae.keyCode===S.Escape||Ae.keyCode===S.UpArrow||Ae.keyCode===S.DownArrow||Ae.keyCode===S.LeftArrow||Ae.keyCode===S.RightArrow)&&(c.innerText="",oe=0);const jn=n.resolveKeyboardEvent(Ae),_i=this._isKbFound(di)&&di.commandId?this.getCommandDetails(di.commandId):void 0;let vn=_i?.title,Cs=jn.getLabel();if(_i&&((Qt.showCommandGroups??!1)&&_i.category&&(vn=`${_i.category}: ${vn} `),this._isKbFound(di)&&di.commandId)){const on=n.lookupKeybindings(di.commandId).filter(Ks=>Ks.getLabel()?.endsWith(Cs??""));on.length>0&&(Cs=on[on.length-1].getLabel())}(Qt.showCommands??!0)&&vn&&ee(c,j("span.title",{},`${vn} `)),((Qt.showKeys??!0)||(Qt.showKeybindings??!0)&&this._isKbFound(di))&&(Cs=Cs?.replace("UpArrow","")?.replace("DownArrow","")?.replace("LeftArrow","")?.replace("RightArrow",""),ee(c,j("span.key",{},Cs??""))),oe++,zt.schedule()})),xb.disposable=o}_isKbFound(e){return e.kind===qT.KbFound}getCommandDetails(e){const t=ge.getCommand(e);if(t)return{title:typeof t.title=="string"?t.title:t.title.value,category:t.category?typeof t.category=="string"?t.category:t.category.value:void 0};const i=Ee.getCommand(e);if(i&&i.metadata?.description)return{title:typeof i.metadata.description=="string"?i.metadata.description:i.metadata.description.value}}}class nUe extends X{constructor(){super({id:"workbench.action.logStorage",title:I(2588,"Log Storage Database Contents"),category:te.Developer,f1:!0})}run(e){const t=e.get(it),i=e.get(ei);t.log(),i.info(h(2589,"The storage database contents have been logged to the developer tools."),h(2590,"Open developer tools from the menu and select the Console tab."))}}class sUe extends X{constructor(){super({id:"workbench.action.logWorkingCopies",title:I(2591,"Log Working Copies"),category:te.Developer,f1:!0})}async run(e){const t=e.get(lg),i=e.get(cq),n=e.get(Re),o=e.get(BN),r=await i.getBackups(),a=["","[Working Copies]",...t.workingCopies.length>0?t.workingCopies.map(c=>`${c.isDirty()?" ":""}${c.resource.toString(!0)} (typeId: ${c.typeId||"<no typeId>"})`):["<none>"],"","[Backups]",...r.length>0?r.map(c=>`${c.resource.toString(!0)} (typeId: ${c.typeId||"<no typeId>"})`):["<none>"]];n.info(a.join(`
`)),o.showChannel(Oye,!0)}}class D5 extends X{static{this.SIZE_THRESHOLD=1024*16}constructor(){super({id:"workbench.action.removeLargeStorageDatabaseEntries",title:I(2592,"Remove Large Storage Database Entries..."),category:te.Developer,f1:!0})}async run(e){const t=e.get(it),i=e.get(Wt),n=e.get(Mh),o=e.get(ei),r=e.get(Hs),a=[];for(const u of[he.APPLICATION,he.PROFILE,he.WORKSPACE])if(!(u===he.PROFILE&&n.currentProfile.isDefault))for(const g of[gt.MACHINE,gt.USER])for(const m of t.keys(u,g)){const v=t.get(m,u);v&&(!r.isBuilt||v.length>D5.SIZE_THRESHOLD)&&a.push({key:m,scope:u,target:g,size:v.length,label:m,description:qo.formatSize(v.length),detail:h(2593,"Scope: {0}, Target: {1}",u===he.APPLICATION?h(2594,"Global"):u===he.PROFILE?h(2595,"Profile"):h(2596,"Workspace"),g===gt.MACHINE?h(2597,"Machine"):h(2598,"User"))})}a.sort((u,g)=>g.size-u.size);const c=await new Promise(u=>{const g=new U,m=g.add(i.createQuickPick());m.items=a,m.canSelectMany=!0,m.ok=!1,m.customButton=!0,m.hideCheckAll=!0,m.customLabel=h(2599,"Remove"),m.placeholder=h(2600,"Select large entries to remove from storage"),a.length===0&&(m.description=h(2601,"There are no large storage entries to remove.")),m.show(),g.add(m.onDidCustom(()=>{u(m.selectedItems),m.hide()})),g.add(m.onDidHide(()=>g.dispose()))});if(c.length===0)return;const{confirmed:d}=await o.confirm({type:"warning",message:h(2602,"Do you want to remove the selected storage entries from the database?"),detail:h(2603,`{0}

This action is irreversible and may result in data loss!`,c.map(u=>u.label).join(`
`)),primaryButton:h(2604,"&&Remove")});if(!d)return;const l=new Set;for(const u of c)t.remove(u.key,u.scope),l.add(u.scope);for(const u of l)await t.optimize(u)}}let xm,oM=new Set;const Um=new O("dirtyWorkingCopies","stopped");class oUe extends X{constructor(){super({id:"workbench.action.startTrackDisposables",title:I(2605,"Start Tracking Disposables"),category:te.Developer,f1:!0,precondition:x.and(Um.isEqualTo("pending").negate(),Um.isEqualTo("started").negate())})}run(e){Um.bindTo(e.get(fe)).set("started"),oM.clear(),xm=new Fye,yse(xm)}}class rUe extends X{constructor(){super({id:"workbench.action.snapshotTrackedDisposables",title:I(2606,"Snapshot Tracked Disposables"),category:te.Developer,f1:!0,precondition:Um.isEqualTo("started")})}run(e){Um.bindTo(e.get(fe)).set("pending"),oM=new Set(xm?.computeLeakingDisposables(1e3)?.leaks.map(i=>i.value))}}class aUe extends X{constructor(){super({id:"workbench.action.stopTrackDisposables",title:I(2607,"Stop Tracking Disposables"),category:te.Developer,f1:!0,precondition:Um.isEqualTo("pending")})}run(e){const t=e.get(de);if(Um.bindTo(e.get(fe)).set("stopped"),xm){const n=new Set;for(const r of new Set(xm.computeLeakingDisposables(1e3)?.leaks)??[])oM.has(r.value)&&n.add(r);const o=xm.computeLeakingDisposables(1e3,Array.from(n));o&&t.openEditor({resource:void 0,contents:o.details})}yse(null),xm=void 0,oM.clear()}}Y(iUe);Y(xb);Y(nUe);Y(sUe);Y(D5);zo.commit||(Y(oUe),Y(rUe),Y(aUe));const cUe=Ke.as(Js.Configuration);cUe.registerConfiguration({id:"screencastMode",order:9,title:h(2608,"Screencast Mode"),type:"object",properties:{"screencastMode.verticalOffset":{type:"number",default:20,minimum:0,maximum:90,description:h(2609,"Controls the vertical offset of the screencast mode overlay from the bottom as a percentage of the workbench height.")},"screencastMode.fontSize":{type:"number",default:56,minimum:20,maximum:100,description:h(2610,"Controls the font size (in pixels) of the screencast mode keyboard.")},"screencastMode.keyboardOptions":{type:"object",description:h(2611,"Options for customizing the keyboard overlay in screencast mode."),properties:{showKeys:{type:"boolean",default:!0,description:h(2612,"Show raw keys.")},showKeybindings:{type:"boolean",default:!0,description:h(2613,"Show keyboard shortcuts.")},showCommands:{type:"boolean",default:!0,description:h(2614,"Show command names.")},showCommandGroups:{type:"boolean",default:!1,description:h(2615,"Show command group names, when commands are also shown.")},showSingleEditorCursorMoves:{type:"boolean",default:!0,description:h(2616,"Show single editor cursor move commands.")}},default:{showKeys:!0,showKeybindings:!0,showCommands:!0,showCommandGroups:!1,showSingleEditorCursorMoves:!0},additionalProperties:!1},"screencastMode.keyboardOverlayTimeout":{type:"number",default:800,minimum:500,maximum:5e3,description:h(2617,"Controls how long (in milliseconds) the keyboard overlay is shown in screencast mode.")},"screencastMode.mouseIndicatorColor":{type:"string",format:"color-hex",default:"#FF0000",description:h(2618,"Controls the color in hex (#RGB, #RGBA, #RRGGBB or #RRGGBBAA) of the mouse indicator in screencast mode.")},"screencastMode.mouseIndicatorSize":{type:"number",default:20,minimum:20,maximum:100,description:h(2619,"Controls the size (in pixels) of the mouse indicator in screencast mode.")}}});Y(THe);Y(Hge);Y(Uge);ge.appendMenuItem(N.EditorTitle,{command:{id:new Uge().desc.id,title:h(183,"Use Inline View When Space Is Limited"),toggled:x.has("config.diffEditor.useInlineViewWhenSpaceIsLimited"),precondition:x.has("isInDiffEditor")},order:11,group:"1_diff",when:x.and(V.diffEditorRenderSideBySideInlineBreakpointReached,x.has("isInDiffEditor"))});ge.appendMenuItem(N.EditorTitle,{command:{id:new Hge().desc.id,title:h(184,"Show Moved Code Blocks"),icon:K.move,toggled:mse.create("config.diffEditor.experimental.showMoves",!0),precondition:x.has("isInDiffEditor")},order:10,group:"1_diff",when:x.has("isInDiffEditor")});Y(X3);for(const s of[{icon:K.arrowRight,key:V.diffEditorInlineMode.toNegated()},{icon:K.discard,key:V.diffEditorInlineMode}])ge.appendMenuItem(N.DiffEditorHunkToolbar,{command:{id:new X3().desc.id,title:h(185,"Revert Block"),icon:s.icon},when:x.and(V.diffEditorModifiedWritable,s.key),order:5,group:"primary"}),ge.appendMenuItem(N.DiffEditorSelectionToolbar,{command:{id:new X3().desc.id,title:h(186,"Revert Selection"),icon:s.icon},when:x.and(V.diffEditorModifiedWritable,s.key),order:5,group:"primary"});Y(AHe);Y(RHe);Y(PHe);Y(LHe);ge.appendMenuItem(N.EditorTitle,{command:{id:uS.id,title:h(187,"Open Accessible Diff Viewer"),precondition:x.has("isInDiffEditor")},order:10,group:"2_diff",when:x.and(V.accessibleDiffViewerVisible.negate(),x.has("isInDiffEditor"))});Ee.registerCommandAlias("editor.action.diffReview.next",uS.id);Y(uS);Ee.registerCommandAlias("editor.action.diffReview.prev",xD.id);Y(xD);const dUe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var uG;Ve(dUe);const I0=new O("selectionAnchorSet",!1);let ef=class{static{uG=this}static{this.ID="editor.contrib.selectionAnchorController"}static get(e){return e.getContribution(uG.ID)}constructor(e,t){this.editor=e,this.selectionAnchorSetContextKey=I0.bindTo(t),this.modelChangeListener=e.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}setSelectionAnchor(){if(this.editor.hasModel()){const e=this.editor.getPosition();this.editor.changeDecorations(t=>{this.decorationId&&t.removeDecoration(this.decorationId),this.decorationId=t.addDecoration(at.fromPositions(e,e),{description:"selection-anchor",stickiness:ki.NeverGrowsWhenTypingAtEdges,hoverMessage:new Gi().appendText(h(869,"Selection Anchor")),className:"selection-anchor"})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),na(h(870,"Anchor set at {0}:{1}",e.lineNumber,e.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){const e=this.editor.getModel().getDecorationRange(this.decorationId);e&&this.editor.setPosition(e.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){const e=this.editor.getModel().getDecorationRange(this.decorationId);if(e){const t=this.editor.getPosition();this.editor.setSelection(at.fromPositions(e.getStartPosition(),t)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){const e=this.decorationId;this.editor.changeDecorations(t=>{t.removeDecoration(e),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};ef=uG=f([p(1,fe)],ef);class lUe extends Se{constructor(){super({id:"editor.action.setSelectionAnchor",label:I(871,"Set Selection Anchor"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyB),weight:W.EditorContrib}})}async run(e,t){ef.get(t)?.setSelectionAnchor()}}class hUe extends Se{constructor(){super({id:"editor.action.goToSelectionAnchor",label:I(872,"Go to Selection Anchor"),precondition:I0})}async run(e,t){ef.get(t)?.goToSelectionAnchor()}}class uUe extends Se{constructor(){super({id:"editor.action.selectFromAnchorToCursor",label:I(873,"Select from Anchor to Cursor"),precondition:I0,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyK),weight:W.EditorContrib}})}async run(e,t){ef.get(t)?.selectFromAnchorToCursor()}}class gUe extends Se{constructor(){super({id:"editor.action.cancelSelectionAnchor",label:I(874,"Cancel Selection Anchor"),precondition:I0,kbOpts:{kbExpr:V.editorTextFocus,primary:S.Escape,weight:W.EditorContrib}})}async run(e,t){ef.get(t)?.cancelSelectionAnchor()}}Lt(ef.ID,ef,_t.Lazy);ue(lUe);ue(hUe);ue(uUe);ue(gUe);const pUe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(pUe);const fUe=H("editorOverviewRuler.bracketMatchForeground","#A0A0A0",h(875,"Overview ruler marker color for matching brackets."));class mUe extends Se{constructor(){super({id:"editor.action.jumpToBracket",label:I(876,"Go to Bracket"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Backslash,weight:W.EditorContrib}})}run(e,t){Fu.get(t)?.jumpToBracket()}}class vUe extends Se{constructor(){super({id:"editor.action.selectToBracket",label:I(877,"Select to Bracket"),precondition:void 0,metadata:{description:I(878,"Select the text inside and including the brackets or curly braces"),args:[{name:"args",schema:{type:"object",properties:{selectBrackets:{type:"boolean",default:!0}}}}]}})}run(e,t,i){let n=!0;i&&i.selectBrackets===!1&&(n=!1),Fu.get(t)?.selectToBracket(n)}}class _Ue extends Se{constructor(){super({id:"editor.action.removeBrackets",label:I(879,"Remove Brackets"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Alt|S.Backspace,weight:W.EditorContrib}})}run(e,t){Fu.get(t)?.removeBrackets(this.id)}}class bUe{constructor(e,t,i){this.position=e,this.brackets=t,this.options=i}}class Fu extends F{static{this.ID="editor.contrib.bracketMatchingController"}static get(e){return e.getContribution(Fu.ID)}constructor(e){super(),this._editor=e,this._lastBracketsData=[],this._lastVersionId=0,this._decorations=this._editor.createDecorationsCollection(),this._updateBracketsSoon=this._register(new yn(()=>this._updateBrackets(),50)),this._matchBrackets=this._editor.getOption(L.matchBrackets),this._updateBracketsSoon.schedule(),this._register(e.onDidChangeCursorPosition(t=>{this._matchBrackets!=="never"&&this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelContent(t=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModel(t=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeModelLanguageConfiguration(t=>{this._lastBracketsData=[],this._updateBracketsSoon.schedule()})),this._register(e.onDidChangeConfiguration(t=>{t.hasChanged(L.matchBrackets)&&(this._matchBrackets=this._editor.getOption(L.matchBrackets),this._decorations.clear(),this._lastBracketsData=[],this._lastVersionId=0,this._updateBracketsSoon.schedule())})),this._register(e.onDidBlurEditorWidget(()=>{this._updateBracketsSoon.schedule()})),this._register(e.onDidFocusEditorWidget(()=>{this._updateBracketsSoon.schedule()}))}jumpToBracket(){if(!this._editor.hasModel())return;const e=this._editor.getModel(),t=this._editor.getSelections().map(i=>{const n=i.getStartPosition(),o=e.bracketPairs.matchBracket(n);let r=null;if(o)o[0].containsPosition(n)&&!o[1].containsPosition(n)?r=o[1].getStartPosition():o[1].containsPosition(n)&&(r=o[0].getStartPosition());else{const a=e.bracketPairs.findEnclosingBrackets(n);if(a)r=a[1].getStartPosition();else{const c=e.bracketPairs.findNextBracket(n);c&&c.range&&(r=c.range.getStartPosition())}}return r?new at(r.lineNumber,r.column,r.lineNumber,r.column):new at(n.lineNumber,n.column,n.lineNumber,n.column)});this._editor.setSelections(t),this._editor.revealRange(t[0])}selectToBracket(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),i=[];this._editor.getSelections().forEach(n=>{const o=n.getStartPosition();let r=t.bracketPairs.matchBracket(o);if(!r&&(r=t.bracketPairs.findEnclosingBrackets(o),!r)){const d=t.bracketPairs.findNextBracket(o);d&&d.range&&(r=t.bracketPairs.matchBracket(d.range.getStartPosition()))}let a=null,c=null;if(r){r.sort(P.compareRangesUsingStarts);const[d,l]=r;if(a=e?d.getStartPosition():d.getEndPosition(),c=e?l.getEndPosition():l.getStartPosition(),l.containsPosition(o)){const u=a;a=c,c=u}}a&&c&&i.push(new at(a.lineNumber,a.column,c.lineNumber,c.column))}),i.length>0&&(this._editor.setSelections(i),this._editor.revealRange(i[0]))}removeBrackets(e){if(!this._editor.hasModel())return;const t=this._editor.getModel();this._editor.getSelections().forEach(i=>{const n=i.getPosition();let o=t.bracketPairs.matchBracket(n);o||(o=t.bracketPairs.findEnclosingBrackets(n)),o&&(this._editor.pushUndoStop(),this._editor.executeEdits(e,[{range:o[0],text:""},{range:o[1],text:""}]),this._editor.pushUndoStop())})}static{this._DECORATION_OPTIONS_WITH_OVERVIEW_RULER=Zt.register({description:"bracket-match-overview",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"bracket-match",overviewRuler:{color:ns(fUe),position:il.Center}})}static{this._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER=Zt.register({description:"bracket-match-no-overview",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"bracket-match"})}_updateBrackets(){if(this._matchBrackets==="never")return;this._recomputeBrackets();const e=[];let t=0;for(const i of this._lastBracketsData){const n=i.brackets;n&&(e[t++]={range:n[0],options:i.options},e[t++]={range:n[1],options:i.options})}this._decorations.set(e)}_recomputeBrackets(){if(!this._editor.hasModel()||!this._editor.hasWidgetFocus()){this._lastBracketsData=[],this._lastVersionId=0;return}const e=this._editor.getSelections();if(e.length>100){this._lastBracketsData=[],this._lastVersionId=0;return}const t=this._editor.getModel(),i=t.getVersionId();let n=[];this._lastVersionId===i&&(n=this._lastBracketsData);const o=[];let r=0;for(let u=0,g=e.length;u<g;u++){const m=e[u];m.isEmpty()&&(o[r++]=m.getStartPosition())}o.length>1&&o.sort(we.compare);const a=[];let c=0,d=0;const l=n.length;for(let u=0,g=o.length;u<g;u++){const m=o[u];for(;d<l&&n[d].position.isBefore(m);)d++;if(d<l&&n[d].position.equals(m))a[c++]=n[d];else{let v=t.bracketPairs.matchBracket(m,20),_=Fu._DECORATION_OPTIONS_WITH_OVERVIEW_RULER;!v&&this._matchBrackets==="always"&&(v=t.bracketPairs.findEnclosingBrackets(m,20),_=Fu._DECORATION_OPTIONS_WITHOUT_OVERVIEW_RULER),a[c++]=new bUe(m,v,_)}}this._lastBracketsData=a,this._lastVersionId=i}}Lt(Fu.ID,Fu,_t.AfterFirstRender);ue(vUe);ue(mUe);ue(_Ue);ge.appendMenuItem(N.MenubarGoMenu,{group:"5_infile_nav",command:{id:"editor.action.jumpToBracket",title:h(880,"Go to &&Bracket")},order:2});class yUe{constructor(e,t){this._selection=e,this._isMovingLeft=t}getEditOperations(e,t){if(this._selection.startLineNumber!==this._selection.endLineNumber||this._selection.isEmpty())return;const i=this._selection.startLineNumber,n=this._selection.startColumn,o=this._selection.endColumn;if(!(this._isMovingLeft&&n===1)&&!(!this._isMovingLeft&&o===e.getLineMaxColumn(i)))if(this._isMovingLeft){const r=new P(i,n-1,i,n),a=e.getValueInRange(r);t.addEditOperation(r,null),t.addEditOperation(new P(i,o,i,o),a)}else{const r=new P(i,o,i,o+1),a=e.getValueInRange(r);t.addEditOperation(r,null),t.addEditOperation(new P(i,n,i,n),a)}}computeCursorState(e,t){return this._isMovingLeft?new at(this._selection.startLineNumber,this._selection.startColumn-1,this._selection.endLineNumber,this._selection.endColumn-1):new at(this._selection.startLineNumber,this._selection.startColumn+1,this._selection.endLineNumber,this._selection.endColumn+1)}}class ipe extends Se{constructor(e,t){super(t),this.left=e}run(e,t){if(!t.hasModel())return;const i=[],n=t.getSelections();for(const o of n)i.push(new yUe(o,this.left));t.pushUndoStop(),t.executeCommands(this.id,i),t.pushUndoStop()}}class wUe extends ipe{constructor(){super(!0,{id:"editor.action.moveCarretLeftAction",label:I(881,"Move Selected Text Left"),precondition:V.writable})}}class SUe extends ipe{constructor(){super(!1,{id:"editor.action.moveCarretRightAction",label:I(882,"Move Selected Text Right"),precondition:V.writable})}}ue(wUe);ue(SUe);class CUe extends Se{constructor(){super({id:"editor.action.transposeLetters",label:I(883,"Transpose Letters"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|S.KeyT},weight:W.EditorContrib}})}run(e,t){if(!t.hasModel())return;const i=t.getModel(),n=[],o=t.getSelections();for(const r of o){if(!r.isEmpty())continue;const a=r.startLineNumber,c=r.startColumn,d=i.getLineMaxColumn(a);if(a===1&&(c===1||c===2&&d===2))continue;const l=c===d?r.getPosition():a1.rightPosition(i,r.getPosition().lineNumber,r.getPosition().column),u=a1.leftPosition(i,l),g=a1.leftPosition(i,u),m=i.getValueInRange(P.fromPositions(g,u)),v=i.getValueInRange(P.fromPositions(u,l)),_=P.fromPositions(g,l);n.push(new pI(_,v+m))}n.length>0&&(t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop())}}ue(CUe);const xv="9_cutcopypaste",EUe=ca||document.queryCommandSupported("cut"),npe=ca||document.queryCommandSupported("copy"),xUe=typeof navigator.clipboard>"u"||ZM?document.queryCommandSupported("paste"):!0;function k5(s){return s.register(),s}const IUe=EUe?k5(new hI({id:"editor.action.clipboardCutAction",precondition:void 0,kbOpts:ca?{primary:E.CtrlCmd|S.KeyX,win:{primary:E.CtrlCmd|S.KeyX,secondary:[E.Shift|S.Delete]},weight:W.EditorContrib}:void 0,menuOpts:[{menuId:N.MenubarEditMenu,group:"2_ccp",title:h(884,"Cu&&t"),order:1},{menuId:N.EditorContext,group:xv,title:h(885,"Cut"),when:V.writable,order:1},{menuId:N.CommandPalette,group:"",title:h(885,"Cut"),order:1},{menuId:N.SimpleEditorContext,group:xv,title:h(885,"Cut"),when:V.writable,order:1}]})):void 0,DUe=npe?k5(new hI({id:"editor.action.clipboardCopyAction",precondition:void 0,kbOpts:ca?{primary:E.CtrlCmd|S.KeyC,win:{primary:E.CtrlCmd|S.KeyC,secondary:[E.CtrlCmd|S.Insert]},weight:W.EditorContrib}:void 0,menuOpts:[{menuId:N.MenubarEditMenu,group:"2_ccp",title:h(886,"&&Copy"),order:2},{menuId:N.EditorContext,group:xv,title:h(887,"Copy"),order:2},{menuId:N.CommandPalette,group:"",title:h(887,"Copy"),order:1},{menuId:N.SimpleEditorContext,group:xv,title:h(887,"Copy"),order:2}]})):void 0;ge.appendMenuItem(N.MenubarEditMenu,{submenu:N.MenubarCopy,title:I(888,"Copy As"),group:"2_ccp",order:3});ge.appendMenuItem(N.EditorContext,{submenu:N.EditorContextCopy,title:I(888,"Copy As"),group:xv,order:3});ge.appendMenuItem(N.EditorContext,{submenu:N.EditorContextShare,title:I(889,"Share"),group:"11_share",order:-1,when:x.and(x.notEquals("resourceScheme","output"),V.editorTextFocus)});ge.appendMenuItem(N.ExplorerContext,{submenu:N.ExplorerContextShare,title:I(889,"Share"),group:"11_share",order:-1});const lF=xUe?k5(new hI({id:"editor.action.clipboardPasteAction",precondition:void 0,kbOpts:ca?{primary:E.CtrlCmd|S.KeyV,win:{primary:E.CtrlCmd|S.KeyV,secondary:[E.Shift|S.Insert]},linux:{primary:E.CtrlCmd|S.KeyV,secondary:[E.Shift|S.Insert]},weight:W.EditorContrib}:void 0,menuOpts:[{menuId:N.MenubarEditMenu,group:"2_ccp",title:h(890,"&&Paste"),order:4},{menuId:N.EditorContext,group:xv,title:h(891,"Paste"),when:V.writable,order:4},{menuId:N.CommandPalette,group:"",title:h(891,"Paste"),order:1},{menuId:N.SimpleEditorContext,group:xv,title:h(891,"Paste"),when:V.writable,order:4}]})):void 0;class kUe extends Se{constructor(){super({id:"editor.action.clipboardCopyWithSyntaxHighlightingAction",label:I(892,"Copy with Syntax Highlighting"),precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,weight:W.EditorContrib}})}run(e,t){!t.hasModel()||!t.getOption(L.emptySelectionClipboard)&&t.getSelection().isEmpty()||(A8.forceCopyWithSyntaxHighlighting=!0,t.focus(),t.getContainerDomNode().ownerDocument.execCommand("copy"),A8.forceCopyWithSyntaxHighlighting=!1)}}function spe(s,e){s&&(s.addImplementation(1e4,"code-editor",(t,i)=>{const n=t.get(Bt).getFocusedCodeEditor();if(n&&n.hasTextFocus()){const o=n.getOption(L.emptySelectionClipboard),r=n.getSelection();return r&&r.isEmpty()&&!o||(n.getOption(L.effectiveExperimentalEditContextEnabled)&&e==="cut"?(n.getContainerDomNode().ownerDocument.execCommand("copy"),n.trigger(void 0,Lz.Cut,void 0)):n.getContainerDomNode().ownerDocument.execCommand(e)),!0}return!1}),s.addImplementation(0,"generic-dom",(t,i)=>(qd().execCommand(e),!0)))}spe(IUe,"cut");spe(DUe,"copy");lF&&(lF.addImplementation(1e4,"code-editor",(s,e)=>{const t=s.get(Bt),i=s.get(Vs),n=s.get(ai),o=s.get(Vn),r=t.getFocusedCodeEditor();if(r&&r.hasModel()&&r.hasTextFocus()){if(r.getOption(L.effectiveExperimentalEditContextEnabled)){const l=TSe.get(r.getId());l&&l.onWillPaste()}const c=Xn.create(!0),d=i.triggerPaste(Fp().vscodeWindowId);return d?d.then(async()=>{if(o.quality!=="stable"){const l=c.elapsed();n.publicLog2("editorAsyncPaste",{duration:l})}return md.get(r)?.finishedPaste()??Promise.resolve()}):Kt?(async()=>{const l=await i.readText();if(l!==""){const u=ASe.INSTANCE.get(l);let g=!1,m=null,v=null;u&&(g=r.getOption(L.emptySelectionClipboard)&&!!u.isFromEmptySelection,m=typeof u.multicursorText<"u"?u.multicursorText:null,v=u.mode),r.trigger("keyboard",Lz.Paste,{text:l,pasteOnNewLine:g,multicursorText:m,mode:v})}})():!0}return!1}),lF.addImplementation(0,"generic-dom",(s,e)=>s.get(Vs).triggerPaste(Fp().vscodeWindowId)??!1));npe&&ue(kUe);function ID(s){return x.regex(ige.keys()[0],new RegExp("(\\s|^)"+dy(s.value)+"\\b"))}const T5={type:"object",defaultSnippets:[{body:{kind:""}}],properties:{kind:{type:"string",description:h(894,"Kind of the code action to run.")},apply:{type:"string",description:h(895,"Controls when the returned actions are applied."),default:Zs.IfSingle,enum:[Zs.First,Zs.IfSingle,Zs.Never],enumDescriptions:[h(896,"Always apply the first returned code action."),h(897,"Apply the first returned code action if it is the only one."),h(898,"Do not apply the returned code actions.")]},preferred:{type:"boolean",default:!1,description:h(899,"Controls if only preferred code actions should be returned.")}}};function f_(s,e,t,i,n=Lr.Default){s.hasModel()&&Zp.get(s)?.manualTriggerAtCurrentPosition(e,n,t,i)}class TUe extends Se{constructor(){super({id:g5,label:I(900,"Quick Fix..."),precondition:x.and(V.writable,V.hasCodeActionsProvider),kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Period,weight:W.EditorContrib}})}run(e,t){return f_(t,h(901,"No code actions available"),void 0,void 0,Lr.QuickFix)}}class AUe extends Vo{constructor(){super({id:u5,precondition:x.and(V.writable,V.hasCodeActionsProvider),metadata:{description:"Trigger a code action",args:[{name:"args",schema:T5}]}})}runEditorCommand(e,t,i){const n=ih.fromUser(i,{kind:Ut.Empty,apply:Zs.IfSingle});return f_(t,typeof i?.kind=="string"?n.preferred?h(902,"No preferred code actions for '{0}' available",i.kind):h(903,"No code actions for '{0}' available",i.kind):n.preferred?h(904,"No preferred code actions available"):h(905,"No code actions available"),{include:n.kind,includeSourceActions:!0,onlyIncludePreferredActions:n.preferred},n.apply)}}class RUe extends Se{constructor(){super({id:p5,label:I(906,"Refactor..."),precondition:x.and(V.writable,V.hasCodeActionsProvider),kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|E.Shift|S.KeyR,mac:{primary:E.WinCtrl|E.Shift|S.KeyR},weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:2,when:x.and(V.writable,ID(pi.Refactor))},metadata:{description:"Refactor...",args:[{name:"args",schema:T5}]}})}run(e,t,i){const n=ih.fromUser(i,{kind:pi.Refactor,apply:Zs.Never});return f_(t,typeof i?.kind=="string"?n.preferred?h(907,"No preferred refactorings for '{0}' available",i.kind):h(908,"No refactorings for '{0}' available",i.kind):n.preferred?h(909,"No preferred refactorings available"):h(910,"No refactorings available"),{include:pi.Refactor.contains(n.kind)?n.kind:Ut.None,onlyIncludePreferredActions:n.preferred},n.apply,Lr.Refactor)}}class PUe extends Se{constructor(){super({id:f5,label:I(911,"Source Action..."),precondition:x.and(V.writable,V.hasCodeActionsProvider),contextMenuOpts:{group:"1_modification",order:2.1,when:x.and(V.writable,ID(pi.Source))},metadata:{description:"Source Action...",args:[{name:"args",schema:T5}]}})}run(e,t,i){const n=ih.fromUser(i,{kind:pi.Source,apply:Zs.Never});return f_(t,typeof i?.kind=="string"?n.preferred?h(912,"No preferred source actions for '{0}' available",i.kind):h(913,"No source actions for '{0}' available",i.kind):n.preferred?h(914,"No preferred source actions available"):h(915,"No source actions available"),{include:pi.Source.contains(n.kind)?n.kind:Ut.None,includeSourceActions:!0,onlyIncludePreferredActions:n.preferred},n.apply,Lr.SourceAction)}}class LUe extends Se{constructor(){super({id:j$,label:I(916,"Organize Imports"),precondition:x.and(V.writable,ID(pi.SourceOrganizeImports)),kbOpts:{kbExpr:V.textInputFocus,primary:E.Shift|E.Alt|S.KeyO,weight:W.EditorContrib},metadata:{description:I(917,"Organize imports in the current file. Also called 'Optimize Imports' by some tools")}})}run(e,t){return f_(t,h(918,"No organize imports action available"),{include:pi.SourceOrganizeImports,includeSourceActions:!0},Zs.IfSingle,Lr.OrganizeImports)}}class MUe extends Se{constructor(){super({id:Y$,label:I(919,"Fix All"),precondition:x.and(V.writable,ID(pi.SourceFixAll))})}run(e,t){return f_(t,h(920,"No fix all action available"),{include:pi.SourceFixAll,includeSourceActions:!0},Zs.IfSingle,Lr.FixAll)}}class NUe extends Se{constructor(){super({id:Jue,label:I(921,"Auto Fix..."),precondition:x.and(V.writable,ID(pi.QuickFix)),kbOpts:{kbExpr:V.textInputFocus,primary:E.Alt|E.Shift|S.Period,mac:{primary:E.CtrlCmd|E.Alt|S.Period},weight:W.EditorContrib}})}run(e,t){return f_(t,h(922,"No auto fixes available"),{include:pi.QuickFix,onlyIncludePreferredActions:!0},Zs.IfSingle,Lr.AutoFix)}}Lt(Zp.ID,Zp,_t.Eventually);Lt(Nx.ID,Nx,_t.Lazy);ue(TUe);ue(RUe);ue(PUe);ue(LUe);ue(NUe);ue(MUe);ze(new AUe);Ke.as(Js.Configuration).registerConfiguration({...Bv,properties:{"editor.codeActionWidget.showHeaders":{type:"boolean",scope:Ht.LANGUAGE_OVERRIDABLE,description:h(923,"Enable/disable showing group headers in the Code Action menu."),default:!0}}});Ke.as(Js.Configuration).registerConfiguration({...Bv,properties:{"editor.codeActionWidget.includeNearbyQuickFixes":{type:"boolean",scope:Ht.LANGUAGE_OVERRIDABLE,description:h(924,"Enable/disable showing nearest Quick Fix within a line when not currently on a diagnostic."),default:!0}}});Ke.as(Js.Configuration).registerConfiguration({...Bv,properties:{"editor.codeActions.triggerOnFocusChange":{type:"boolean",scope:Ht.LANGUAGE_OVERRIDABLE,markdownDescription:h(925,"Enable triggering {0} when {1} is set to {2}. Code Actions must be set to {3} to be triggered for window and focus changes.","`#editor.codeActionsOnSave#`","`#files.autoSave#`","`afterDelay`","`always`"),default:!1}}});const OUe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(OUe);class FUe{constructor(e,t,i){this.afterColumn=Ia.MAX_SAFE_SMALL_INTEGER,this.afterLineNumber=e,this.heightInPx=t,this._onHeight=i,this.suppressMouseDown=!0,this.domNode=document.createElement("div")}onComputedHeight(e){this._lastHeight===void 0?this._lastHeight=e:this._lastHeight!==e&&(this._lastHeight=e,this._onHeight())}isVisible(){return this._lastHeight!==0&&this.domNode.hasAttribute("monaco-visible-view-zone")}}class rM{static{this._idPool=0}constructor(e,t){this.allowEditorOverflow=!1,this.suppressMouseDown=!0,this._commands=new Map,this._isEmpty=!0,this._editor=e,this._id=`codelens.widget-${rM._idPool++}`,this.updatePosition(t),this._domNode=document.createElement("span"),this._domNode.className="codelens-decoration"}withCommands(e,t){this._commands.clear();const i=[];let n=!1;for(let o=0;o<e.length;o++){const r=e[o];if(r&&(n=!0,r.command)){const a=gf(r.command.title.trim());if(r.command.id){const c=`c${rM._idPool++}`;i.push(j("a",{id:c,title:r.command.tooltip,role:"button"},...a)),this._commands.set(c,r.command)}else i.push(j("span",{title:r.command.tooltip},...a));o+1<e.length&&i.push(j("span",void 0,"|"))}}n?(kh(this._domNode,...i),this._isEmpty&&t&&this._domNode.classList.add("fadein"),this._isEmpty=!1):kh(this._domNode,j("span",void 0,"no commands"))}getCommand(e){return e.parentElement===this._domNode?this._commands.get(e.id):void 0}getId(){return this._id}getDomNode(){return this._domNode}updatePosition(e){const t=this._editor.getModel().getLineFirstNonWhitespaceColumn(e);this._widgetPosition={position:{lineNumber:e,column:t},preference:[Fi.ABOVE]}}getPosition(){return this._widgetPosition||null}}class hF{constructor(){this._removeDecorations=[],this._addDecorations=[],this._addDecorationsCallbacks=[]}addDecoration(e,t){this._addDecorations.push(e),this._addDecorationsCallbacks.push(t)}removeDecoration(e){this._removeDecorations.push(e)}commit(e){const t=e.deltaDecorations(this._removeDecorations,this._addDecorations);for(let i=0,n=t.length;i<n;i++)this._addDecorationsCallbacks[i](t[i])}}const qte=Zt.register({collapseOnReplaceEdit:!0,description:"codelens"});class Kte{constructor(e,t,i,n,o,r){this._isDisposed=!1,this._editor=t,this._data=e,this._decorationIds=[];let a;const c=[];this._data.forEach((d,l)=>{d.symbol.command&&c.push(d.symbol),i.addDecoration({range:d.symbol.range,options:qte},u=>this._decorationIds[l]=u),a?a=P.plusRange(a,d.symbol.range):a=P.lift(d.symbol.range)}),this._viewZone=new FUe(a.startLineNumber-1,o,r),this._viewZoneId=n.addZone(this._viewZone),c.length>0&&(this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(c,!1))}_createContentWidgetIfNecessary(){this._contentWidget?this._editor.layoutContentWidget(this._contentWidget):(this._contentWidget=new rM(this._editor,this._viewZone.afterLineNumber+1),this._editor.addContentWidget(this._contentWidget))}dispose(e,t){this._decorationIds.forEach(e.removeDecoration,e),this._decorationIds=[],t?.removeZone(this._viewZoneId),this._contentWidget&&(this._editor.removeContentWidget(this._contentWidget),this._contentWidget=void 0),this._isDisposed=!0}isDisposed(){return this._isDisposed}isValid(){return this._decorationIds.some((e,t)=>{const i=this._editor.getModel().getDecorationRange(e),n=this._data[t].symbol;return!!(i&&P.isEmpty(n.range)===i.isEmpty())})}updateCodeLensSymbols(e,t){this._decorationIds.forEach(t.removeDecoration,t),this._decorationIds=[],this._data=e,this._data.forEach((i,n)=>{t.addDecoration({range:i.symbol.range,options:qte},o=>this._decorationIds[n]=o)})}updateHeight(e,t){this._viewZone.heightInPx=e,t.layoutZone(this._viewZoneId),this._contentWidget&&this._editor.layoutContentWidget(this._contentWidget)}computeIfNecessary(e){if(!this._viewZone.isVisible())return null;for(let t=0;t<this._decorationIds.length;t++){const i=e.getDecorationRange(this._decorationIds[t]);i&&(this._data[t].symbol.range=i)}return this._data}updateCommands(e){this._createContentWidgetIfNecessary(),this._contentWidget.withCommands(e,!0);for(let t=0;t<this._data.length;t++){const i=e[t];if(i){const{symbol:n}=this._data[t];n.command=i.command||n.command}}}getCommand(e){return this._contentWidget?.getCommand(e)}getLineNumber(){const e=this._editor.getModel().getDecorationRange(this._decorationIds[0]);return e?e.startLineNumber:-1}update(e){if(this.isValid()){const t=this._editor.getModel().getDecorationRange(this._decorationIds[0]);t&&(this._viewZone.afterLineNumber=t.startLineNumber-1,e.layoutZone(this._viewZoneId),this._contentWidget&&(this._contentWidget.updatePosition(t.startLineNumber),this._editor.layoutContentWidget(this._contentWidget)))}}getItems(){return this._data}}let Ux=class{static{this.ID="css.editor.codeLens"}constructor(e,t,i,n,o,r){this._editor=e,this._languageFeaturesService=t,this._commandService=n,this._notificationService=o,this._codeLensCache=r,this._disposables=new U,this._localToDispose=new U,this._lenses=[],this._oldCodeLensModels=new U,this._provideCodeLensDebounce=i.for(t.codeLensProvider,"CodeLensProvide",{min:250}),this._resolveCodeLensesDebounce=i.for(t.codeLensProvider,"CodeLensResolve",{min:250,salt:"resolve"}),this._resolveCodeLensesScheduler=new yn(()=>this._resolveCodeLensesInViewport(),this._resolveCodeLensesDebounce.default()),this._disposables.add(this._editor.onDidChangeModel(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeModelLanguage(()=>this._onModelChange())),this._disposables.add(this._editor.onDidChangeConfiguration(a=>{(a.hasChanged(L.fontInfo)||a.hasChanged(L.codeLensFontSize)||a.hasChanged(L.codeLensFontFamily))&&this._updateLensStyle(),a.hasChanged(L.codeLens)&&this._onModelChange()})),this._disposables.add(t.codeLensProvider.onDidChange(this._onModelChange,this)),this._onModelChange(),this._updateLensStyle()}dispose(){this._localDispose(),this._localToDispose.dispose(),this._disposables.dispose(),this._oldCodeLensModels.dispose(),this._currentCodeLensModel?.dispose()}_getLayoutInfo(){const e=Math.max(1.3,this._editor.getOption(L.lineHeight)/this._editor.getOption(L.fontSize));let t=this._editor.getOption(L.codeLensFontSize);return(!t||t<5)&&(t=this._editor.getOption(L.fontSize)*.9|0),{fontSize:t,codeLensHeight:t*e|0}}_updateLensStyle(){const{codeLensHeight:e,fontSize:t}=this._getLayoutInfo(),i=this._editor.getOption(L.codeLensFontFamily),n=this._editor.getOption(L.fontInfo),{style:o}=this._editor.getContainerDomNode();o.setProperty("--vscode-editorCodeLens-lineHeight",`${e}px`),o.setProperty("--vscode-editorCodeLens-fontSize",`${t}px`),o.setProperty("--vscode-editorCodeLens-fontFeatureSettings",n.fontFeatureSettings),i&&(o.setProperty("--vscode-editorCodeLens-fontFamily",i),o.setProperty("--vscode-editorCodeLens-fontFamilyDefault",BM.fontFamily)),this._editor.changeViewZones(r=>{for(const a of this._lenses)a.updateHeight(e,r)})}_localDispose(){this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=void 0,this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0,this._localToDispose.clear(),this._oldCodeLensModels.clear(),this._currentCodeLensModel?.dispose()}_onModelChange(){this._localDispose();const e=this._editor.getModel();if(!e||!this._editor.getOption(L.codeLens)||e.isTooLargeForTokenization())return;const t=this._codeLensCache.get(e);if(t&&this._renderCodeLensSymbols(t),!this._languageFeaturesService.codeLensProvider.has(e)){t&&Lp(()=>{const n=this._codeLensCache.get(e);t===n&&(this._codeLensCache.delete(e),this._onModelChange())},30*1e3,this._localToDispose);return}for(const n of this._languageFeaturesService.codeLensProvider.all(e))if(typeof n.onDidChange=="function"){const o=n.onDidChange(()=>i.schedule());this._localToDispose.add(o)}const i=new yn(()=>{const n=Date.now();this._getCodeLensModelPromise?.cancel(),this._getCodeLensModelPromise=Tn(o=>dae(this._languageFeaturesService.codeLensProvider,e,o)),this._getCodeLensModelPromise.then(o=>{this._currentCodeLensModel&&this._oldCodeLensModels.add(this._currentCodeLensModel),this._currentCodeLensModel=o,this._codeLensCache.put(e,o);const r=this._provideCodeLensDebounce.update(e,Date.now()-n);i.delay=r,this._renderCodeLensSymbols(o),this._resolveCodeLensesInViewportSoon()},mt)},this._provideCodeLensDebounce.get(e));this._localToDispose.add(i),this._localToDispose.add(Ie(()=>this._resolveCodeLensesScheduler.cancel())),this._localToDispose.add(this._editor.onDidChangeModelContent(()=>{this._editor.changeDecorations(n=>{this._editor.changeViewZones(o=>{const r=[];let a=-1;this._lenses.forEach(d=>{!d.isValid()||a===d.getLineNumber()?r.push(d):(d.update(o),a=d.getLineNumber())});const c=new hF;r.forEach(d=>{d.dispose(c,o),this._lenses.splice(this._lenses.indexOf(d),1)}),c.commit(n)})}),i.schedule(),this._resolveCodeLensesScheduler.cancel(),this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0})),this._localToDispose.add(this._editor.onDidFocusEditorText(()=>{i.schedule()})),this._localToDispose.add(this._editor.onDidBlurEditorText(()=>{i.cancel()})),this._localToDispose.add(this._editor.onDidScrollChange(n=>{n.scrollTopChanged&&this._lenses.length>0&&this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(this._editor.onDidLayoutChange(()=>{this._resolveCodeLensesInViewportSoon()})),this._localToDispose.add(Ie(()=>{if(this._editor.getModel()){const n=py.capture(this._editor);this._editor.changeDecorations(o=>{this._editor.changeViewZones(r=>{this._disposeAllLenses(o,r)})}),n.restore(this._editor)}else this._disposeAllLenses(void 0,void 0)})),this._localToDispose.add(this._editor.onMouseDown(n=>{if(n.target.type!==xi.CONTENT_WIDGET)return;let o=n.target.element;if(o?.tagName==="SPAN"&&(o=o.parentElement),o?.tagName==="A")for(const r of this._lenses){const a=r.getCommand(o);if(a){this._commandService.executeCommand(a.id,...a.arguments||[]).catch(c=>this._notificationService.error(c));break}}})),i.schedule()}_disposeAllLenses(e,t){const i=new hF;for(const n of this._lenses)n.dispose(i,t);e&&i.commit(e),this._lenses.length=0}_renderCodeLensSymbols(e){if(!this._editor.hasModel())return;const t=this._editor.getModel().getLineCount(),i=[];let n;for(const a of e.lenses){const c=a.symbol.range.startLineNumber;c<1||c>t||(n&&n[n.length-1].symbol.range.startLineNumber===c?n.push(a):(n=[a],i.push(n)))}if(!i.length&&!this._lenses.length)return;const o=py.capture(this._editor),r=this._getLayoutInfo();this._editor.changeDecorations(a=>{this._editor.changeViewZones(c=>{const d=new hF;let l=0,u=0;for(;u<i.length&&l<this._lenses.length;){const g=i[u][0].symbol.range.startLineNumber,m=this._lenses[l].getLineNumber();m<g?(this._lenses[l].dispose(d,c),this._lenses.splice(l,1)):m===g?(this._lenses[l].updateCodeLensSymbols(i[u],d),u++,l++):(this._lenses.splice(l,0,new Kte(i[u],this._editor,d,c,r.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),l++,u++)}for(;l<this._lenses.length;)this._lenses[l].dispose(d,c),this._lenses.splice(l,1);for(;u<i.length;)this._lenses.push(new Kte(i[u],this._editor,d,c,r.codeLensHeight,()=>this._resolveCodeLensesInViewportSoon())),u++;d.commit(a)})}),o.restore(this._editor)}_resolveCodeLensesInViewportSoon(){this._editor.getModel()&&this._resolveCodeLensesScheduler.schedule()}_resolveCodeLensesInViewport(){this._resolveCodeLensesPromise?.cancel(),this._resolveCodeLensesPromise=void 0;const e=this._editor.getModel();if(!e)return;const t=[],i=[];if(this._lenses.forEach(r=>{const a=r.computeIfNecessary(e);a&&(t.push(a),i.push(r))}),t.length===0)return;const n=Date.now(),o=Tn(r=>{const a=t.map((c,d)=>{const l=new Array(c.length),u=c.map((g,m)=>!g.symbol.command&&typeof g.provider.resolveCodeLens=="function"?Promise.resolve(g.provider.resolveCodeLens(e,g.symbol,r)).then(v=>{l[m]=v},Ln):(l[m]=g.symbol,Promise.resolve(void 0)));return Promise.all(u).then(()=>{!r.isCancellationRequested&&!i[d].isDisposed()&&i[d].updateCommands(l)})});return Promise.all(a)});this._resolveCodeLensesPromise=o,this._resolveCodeLensesPromise.then(()=>{const r=this._resolveCodeLensesDebounce.update(e,Date.now()-n);this._resolveCodeLensesScheduler.delay=r,this._currentCodeLensModel&&this._codeLensCache.put(e,this._currentCodeLensModel),this._oldCodeLensModels.clear(),o===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)},r=>{mt(r),o===this._resolveCodeLensesPromise&&(this._resolveCodeLensesPromise=void 0)})}async getModel(){return await this._getCodeLensModelPromise,await this._resolveCodeLensesPromise,this._currentCodeLensModel?.isDisposed?void 0:this._currentCodeLensModel}};Ux=f([p(1,Ne),p(2,Sd),p(3,Ge),p(4,Dt),p(5,oae)],Ux);Lt(Ux.ID,Ux,_t.AfterFirstRender);ue(class extends Se{constructor(){super({id:"codelens.showLensesInCurrentLine",precondition:V.hasCodeLensProvider,label:I(946,"Show CodeLens Commands for Current Line")})}async run(e,t){if(!t.hasModel())return;const i=e.get(Wt),n=e.get(Ge),o=e.get(Dt),r=t.getSelection().positionLineNumber,a=t.getContribution(Ux.ID);if(!a)return;const c=await a.getModel();if(!c)return;const d=[];for(const g of c.lenses)g.symbol.command&&g.symbol.range.startLineNumber===r&&d.push({label:g.symbol.command.title,command:g.symbol.command});if(d.length===0)return;const l=await i.pick(d,{canPickMany:!1,placeHolder:h(947,"Select a command")});if(!l)return;let u=l.command;if(c.isDisposed){const m=(await a.getModel())?.lenses.find(v=>v.symbol.range.startLineNumber===r&&v.symbol.command?.title===u.title);if(!m||!m.symbol.command)return;u=m.symbol.command}try{await n.executeCommand(u.id,...u.arguments||[])}catch(g){o.error(g)}}});class jte extends F{static{this.ID="editor.contrib.colorContribution"}static{this.RECOMPUTE_TIME=1e3}constructor(e){super(),this._editor=e,this._register(e.onMouseDown(t=>this.onMouseDown(t)))}dispose(){super.dispose()}onMouseDown(e){const t=this._editor.getOption(L.colorDecoratorsActivatedOn);if(t!=="click"&&t!=="clickAndHover"||!Ode(e))return;const i=this._editor.getContribution(ws.ID);if(!i||i.isColorPickerVisible)return;const n=e.target.range;if(!n)return;const o=new P(n.startLineNumber,n.startColumn+1,n.endLineNumber,n.endColumn+1);i.showContentHover(o,Ah.Immediate,al.Click,!1)}}class A5{constructor(e,t,i,n){this.owner=e,this.range=t,this.model=i,this.provider=n}static fromBaseColor(e,t){return new A5(e,t.range,t.model,t.provider)}}class WUe extends F{constructor(e,t,i,n){super();const o=e.getModel(),r=i.model;this.color=i.model.color,this.colorPicker=this._register(new IO(t.fragment,r,e.getOption(L.pixelRatio),n,fv.Standalone)),this._register(r.onColorFlushed(a=>{this.color=a})),this._register(r.onDidChangeColor(a=>{vx(o,r,a,i.range,i)})),this._register(e.onDidChangeModelContent(a=>{t.hide(),e.focus()})),vx(o,r,this.color,i.range,i)}}let gG=class{constructor(e,t){this._editor=e,this._themeService=t,this.hoverOrdinal=2}async createColorHover(e,t,i){if(!this._editor.hasModel()||!zy.get(this._editor))return null;const o=await Tde(i,this._editor.getModel(),Ce.None);let r=null,a=null;for(const g of o){const m=g.colorInfo;P.containsRange(m.range,e.range)&&(r=m,a=g.provider)}const c=r??e,d=a??t,l=!!r;return{colorHover:A5.fromBaseColor(this,await Lde(this._editor.getModel(),c,d)),foundInEditor:l}}async updateEditorModel(e){if(!this._editor.hasModel())return;const t=e.model;let i=new P(e.range.startLineNumber,e.range.startColumn,e.range.endLineNumber,e.range.endColumn);this._color&&(await vx(this._editor.getModel(),t,this._color,i,e),i=Mde(this._editor,i,t))}renderHoverParts(e,t){if(!(t.length===0||!this._editor.hasModel()))return this._setMinimumDimensions(e),this._renderedParts=new WUe(this._editor,e,t[0],this._themeService),this._renderedParts}_setMinimumDimensions(e){const t=this._editor.getOption(L.lineHeight)+8;e.setMinimumDimensions(new Ye(302,t))}get _color(){return this._renderedParts?.color}};gG=f([p(1,pt)],gG);var pG;Ve(Ef);class BUe{constructor(e,t){this.value=e,this.foundInEditor=t}}const Yte=8,VUe=22;let fG=class extends F{static{pG=this}static{this.ID="editor.contrib.standaloneColorPickerWidget"}constructor(e,t,i,n,o,r,a,c){super(),this._editor=e,this._standaloneColorPickerVisible=t,this._standaloneColorPickerFocused=i,this._keybindingService=o,this._languageFeaturesService=r,this._editorWorkerService=a,this._hoverService=c,this.allowEditorOverflow=!0,this._position=void 0,this._body=document.createElement("div"),this._colorHover=null,this._selectionSetInEditor=!1,this._onResult=this._register(new M),this.onResult=this._onResult.event,this._renderedHoverParts=this._register(new Pt),this._renderedStatusBar=this._register(new Pt),this._standaloneColorPickerVisible.set(!0),this._standaloneColorPickerParticipant=n.createInstance(gG,this._editor),this._position=this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;const d=this._editor.getSelection(),l=d?{startLineNumber:d.startLineNumber,startColumn:d.startColumn,endLineNumber:d.endLineNumber,endColumn:d.endColumn}:{startLineNumber:0,endLineNumber:0,endColumn:0,startColumn:0},u=this._register(Fo(this._body));this._register(u.onDidBlur(g=>{this.hide()})),this._register(u.onDidFocus(g=>{this.focus()})),this._register(this._editor.onDidChangeCursorPosition(()=>{this._selectionSetInEditor?this._selectionSetInEditor=!1:this.hide()})),this._register(this._editor.onMouseMove(g=>{const m=g.target.element?.classList;m&&m.contains("colorpicker-color-decoration")&&this.hide()})),this._register(this.onResult(g=>{this._render(g.value,g.foundInEditor)})),this._start(l),this._body.style.zIndex="50",this._editor.addContentWidget(this)}updateEditor(){this._colorHover&&this._standaloneColorPickerParticipant.updateEditorModel(this._colorHover)}getId(){return pG.ID}getDomNode(){return this._body}getPosition(){if(!this._position)return null;const e=this._editor.getOption(L.hover).above;return{position:this._position,secondaryPosition:this._position,preference:e?[Fi.ABOVE,Fi.BELOW]:[Fi.BELOW,Fi.ABOVE],positionAffinity:eI.None}}hide(){this.dispose(),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerFocused.set(!1),this._editor.removeContentWidget(this),this._editor.focus()}focus(){this._standaloneColorPickerFocused.set(!0),this._body.focus()}async _start(e){const t=await this._computeAsync(e);t&&this._onResult.fire(new BUe(t.result,t.foundInEditor))}async _computeAsync(e){if(!this._editor.hasModel())return null;const t={range:e,color:{red:0,green:0,blue:0,alpha:1}},i=await this._standaloneColorPickerParticipant.createColorHover(t,new mx(this._editorWorkerService),this._languageFeaturesService.colorProvider);return i?{result:i.colorHover,foundInEditor:i.foundInEditor}:null}_render(e,t){const i=document.createDocumentFragment();this._renderedStatusBar.value=this._register(new XR(this._keybindingService,this._hoverService));const n={fragment:i,statusBar:this._renderedStatusBar.value,onContentsChanged:()=>{},setMinimumDimensions:()=>{},hide:()=>this.hide(),focus:()=>this.focus()};if(this._colorHover=e,this._renderedHoverParts.value=this._standaloneColorPickerParticipant.renderHoverParts(n,[e]),!this._renderedHoverParts.value){this._renderedStatusBar.clear(),this._renderedHoverParts.clear();return}const o=this._renderedHoverParts.value.colorPicker;this._body.classList.add("standalone-colorpicker-body"),this._body.style.maxHeight=Math.max(this._editor.getLayoutInfo().height/4,250)+"px",this._body.style.maxWidth=Math.max(this._editor.getLayoutInfo().width*.66,500)+"px",this._body.tabIndex=0,this._body.appendChild(i),o.layout();const r=o.body,a=r.saturationBox.domNode.clientWidth,c=r.domNode.clientWidth-a-VUe-Yte,d=o.body.enterButton;d?.onClicked(()=>{this.updateEditor(),this.hide()});const l=o.header,u=l.pickedColorNode;u.style.width=a+Yte+"px";const g=l.originalColorNode;g.style.width=c+"px",o.header.closeButton?.onClicked(()=>{this.hide()}),t&&(d&&(d.button.textContent="Replace"),this._selectionSetInEditor=!0,this._editor.setSelection(e.range)),this._editor.layoutContentWidget(this)}};fG=pG=f([p(3,Z),p(4,He),p(5,Ne),p(6,vc),p(7,Ti)],fG);var mG;let Iv=class extends F{static{mG=this}static{this.ID="editor.contrib.standaloneColorPickerController"}constructor(e,t,i){super(),this._editor=e,this._instantiationService=i,this._standaloneColorPickerWidget=null,this._standaloneColorPickerVisible=V.standaloneColorPickerVisible.bindTo(t),this._standaloneColorPickerFocused=V.standaloneColorPickerFocused.bindTo(t)}showOrFocus(){this._editor.hasModel()&&(this._standaloneColorPickerVisible.get()?this._standaloneColorPickerFocused.get()||this._standaloneColorPickerWidget?.focus():this._standaloneColorPickerWidget=this._instantiationService.createInstance(fG,this._editor,this._standaloneColorPickerVisible,this._standaloneColorPickerFocused))}hide(){this._standaloneColorPickerFocused.set(!1),this._standaloneColorPickerVisible.set(!1),this._standaloneColorPickerWidget?.hide(),this._editor.focus()}insertColor(){this._standaloneColorPickerWidget?.updateEditor(),this.hide()}static get(e){return e.getContribution(mG.ID)}};Iv=mG=f([p(1,fe),p(2,Z)],Iv);class HUe extends Fr{constructor(){super({id:"editor.action.showOrFocusStandaloneColorPicker",title:{...I(951,"Show or Focus Standalone Color Picker"),mnemonicTitle:h(952,"&&Show or Focus Standalone Color Picker")},precondition:void 0,menu:[{id:N.CommandPalette}],metadata:{description:I(953,"Show or focus a standalone color picker which uses the default color provider. It displays hex/rgb/hsl colors.")}})}runEditorCommand(e,t){Iv.get(t)?.showOrFocus()}}class UUe extends Se{constructor(){super({id:"editor.action.hideColorPicker",label:I(954,"Hide the Color Picker"),precondition:V.standaloneColorPickerVisible.isEqualTo(!0),kbOpts:{primary:S.Escape,weight:W.EditorContrib},metadata:{description:I(955,"Hide the standalone color picker.")}})}run(e,t){Iv.get(t)?.hide()}}class $Ue extends Se{constructor(){super({id:"editor.action.insertColorWithStandaloneColorPicker",label:I(956,"Insert Color with Standalone Color Picker"),precondition:V.standaloneColorPickerFocused.isEqualTo(!0),kbOpts:{primary:S.Enter,weight:W.EditorContrib},metadata:{description:I(957,"Insert hex/rgb/hsl colors with the focused standalone color picker.")}})}run(e,t){Iv.get(t)?.insertColor()}}ue(UUe);ue($Ue);Y(HUe);Lt(jte.ID,jte,_t.BeforeFirstInteraction);Lt(Iv.ID,Iv,_t.AfterFirstRender);Lt(zy.ID,zy,_t.AfterFirstRender);pS(oH);d_.register(JR);Ee.registerCommand("_executeDocumentColorProvider",function(s,...e){const[t]=e;if(!(t instanceof R))throw Nt();const{model:i,colorProviderRegistry:n,defaultColorDecoratorsEnablement:o}=Rde(s,t);return XK(new EPe,n,i,Ce.None,o)});Ee.registerCommand("_executeColorPresentationProvider",function(s,...e){const[t,i]=e,{uri:n,range:o}=i;if(!(n instanceof R)||!Array.isArray(t)||t.length!==4||!P.isIRange(o))throw Nt();const{model:r,colorProviderRegistry:a,defaultColorDecoratorsEnablement:c}=Rde(s,n),[d,l,u,g]=t;return XK(new xPe({range:o,color:{red:d,green:l,blue:u,alpha:g}}),a,r,Ce.None,c)});class lp{constructor(e,t,i){this.languageConfigurationService=i,this._selection=e,this._insertSpace=t,this._usedEndToken=null}static _haystackHasNeedleAtOffset(e,t,i){if(i<0)return!1;const n=t.length,o=e.length;if(i+n>o)return!1;for(let r=0;r<n;r++){const a=e.charCodeAt(i+r),c=t.charCodeAt(r);if(a!==c&&!(a>=st.A&&a<=st.Z&&a+32===c)&&!(c>=st.A&&c<=st.Z&&c+32===a))return!1}return!0}_createOperationsForBlockComment(e,t,i,n,o,r){const a=e.startLineNumber,c=e.startColumn,d=e.endLineNumber,l=e.endColumn,u=o.getLineContent(a),g=o.getLineContent(d);let m=u.lastIndexOf(t,c-1+t.length),v=g.indexOf(i,l-1-i.length);if(m!==-1&&v!==-1)if(a===d)u.substring(m+t.length,v).indexOf(i)>=0&&(m=-1,v=-1);else{const w=u.substring(m+t.length),C=g.substring(0,v);(w.indexOf(i)>=0||C.indexOf(i)>=0)&&(m=-1,v=-1)}let _;m!==-1&&v!==-1?(n&&m+t.length<u.length&&u.charCodeAt(m+t.length)===st.Space&&(t=t+" "),n&&v>0&&g.charCodeAt(v-1)===st.Space&&(i=" "+i,v-=1),_=lp._createRemoveBlockCommentOperations(new P(a,m+t.length+1,d,v+1),t,i)):(_=lp._createAddBlockCommentOperations(e,t,i,this._insertSpace),this._usedEndToken=_.length===1?i:null);for(const w of _)r.addTrackedEditOperation(w.range,w.text)}static _createRemoveBlockCommentOperations(e,t,i){const n=[];return P.isEmpty(e)?n.push(qi.delete(new P(e.startLineNumber,e.startColumn-t.length,e.endLineNumber,e.endColumn+i.length))):(n.push(qi.delete(new P(e.startLineNumber,e.startColumn-t.length,e.startLineNumber,e.startColumn))),n.push(qi.delete(new P(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn+i.length)))),n}static _createAddBlockCommentOperations(e,t,i,n){const o=[];return P.isEmpty(e)?o.push(qi.replace(new P(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),t+"  "+i)):(o.push(qi.insert(new we(e.startLineNumber,e.startColumn),t+(n?" ":""))),o.push(qi.insert(new we(e.endLineNumber,e.endColumn),(n?" ":"")+i))),o}getEditOperations(e,t){const i=this._selection.startLineNumber,n=this._selection.startColumn;e.tokenization.tokenizeIfCheap(i);const o=e.getLanguageIdAtPosition(i,n),r=this.languageConfigurationService.getLanguageConfiguration(o).comments;!r||!r.blockCommentStartToken||!r.blockCommentEndToken||this._createOperationsForBlockComment(this._selection,r.blockCommentStartToken,r.blockCommentEndToken,this._insertSpace,e,t)}computeCursorState(e,t){const i=t.getInverseEditOperations();if(i.length===2){const n=i[0],o=i[1];return new at(n.range.endLineNumber,n.range.endColumn,o.range.startLineNumber,o.range.startColumn)}else{const n=i[0].range,o=this._usedEndToken?-this._usedEndToken.length-1:0;return new at(n.endLineNumber,n.endColumn+o,n.endLineNumber,n.endColumn+o)}}}var nh;(function(s){s[s.Toggle=0]="Toggle",s[s.ForceAdd=1]="ForceAdd",s[s.ForceRemove=2]="ForceRemove"})(nh||(nh={}));class cu{constructor(e,t,i,n,o,r,a){this.languageConfigurationService=e,this._selection=t,this._indentSize=i,this._type=n,this._insertSpace=o,this._selectionId=null,this._deltaColumn=0,this._moveEndPositionDown=!1,this._ignoreEmptyLines=r,this._ignoreFirstLine=a||!1}static _gatherPreflightCommentStrings(e,t,i,n){e.tokenization.tokenizeIfCheap(t);const o=e.getLanguageIdAtPosition(t,1),r=n.getLanguageConfiguration(o).comments,a=r?r.lineCommentToken:null;if(!a)return null;const c=[];for(let d=0,l=i-t+1;d<l;d++)c[d]={ignore:!1,commentStr:a,commentStrOffset:0,commentStrLength:a.length};return c}static _analyzeLines(e,t,i,n,o,r,a,c){let d=!0,l;e===nh.Toggle?l=!0:e===nh.ForceAdd?l=!1:l=!0;for(let u=0,g=n.length;u<g;u++){const m=n[u],v=o+u;if(v===o&&a){m.ignore=!0;continue}const _=i.getLineContent(v),w=qF(_);if(w===-1){m.ignore=r,m.commentStrOffset=_.length;continue}if(d=!1,m.ignore=!1,m.commentStrOffset=w,l&&!lp._haystackHasNeedleAtOffset(_,m.commentStr,w)&&(e===nh.Toggle?l=!1:e===nh.ForceAdd||(m.ignore=!0)),l&&t){const C=w+m.commentStrLength;C<_.length&&_.charCodeAt(C)===st.Space&&(m.commentStrLength+=1)}}if(e===nh.Toggle&&d){l=!1;for(let u=0,g=n.length;u<g;u++)n[u].ignore=!1}return{supported:!0,shouldRemoveComments:l,lines:n}}static _gatherPreflightData(e,t,i,n,o,r,a,c){const d=cu._gatherPreflightCommentStrings(i,n,o,c);return d===null?{supported:!1}:cu._analyzeLines(e,t,i,d,n,r,a,c)}_executeLineComments(e,t,i,n){let o;i.shouldRemoveComments?o=cu._createRemoveLineCommentsOperations(i.lines,n.startLineNumber):(cu._normalizeInsertionPoint(e,i.lines,n.startLineNumber,this._indentSize),o=this._createAddLineCommentsOperations(i.lines,n.startLineNumber));const r=new we(n.positionLineNumber,n.positionColumn);for(let a=0,c=o.length;a<c;a++)t.addEditOperation(o[a].range,o[a].text),P.isEmpty(o[a].range)&&P.getStartPosition(o[a].range).equals(r)&&e.getLineContent(r.lineNumber).length+1===r.column&&(this._deltaColumn=(o[a].text||"").length);this._selectionId=t.trackSelection(n)}_attemptRemoveBlockComment(e,t,i,n){let o=t.startLineNumber,r=t.endLineNumber;const a=n.length+Math.max(e.getLineFirstNonWhitespaceColumn(t.startLineNumber),t.startColumn);let c=e.getLineContent(o).lastIndexOf(i,a-1),d=e.getLineContent(r).indexOf(n,t.endColumn-1-i.length);return c!==-1&&d===-1&&(d=e.getLineContent(o).indexOf(n,c+i.length),r=o),c===-1&&d!==-1&&(c=e.getLineContent(r).lastIndexOf(i,d),o=r),t.isEmpty()&&(c===-1||d===-1)&&(c=e.getLineContent(o).indexOf(i),c!==-1&&(d=e.getLineContent(o).indexOf(n,c+i.length))),c!==-1&&e.getLineContent(o).charCodeAt(c+i.length)===st.Space&&(i+=" "),d!==-1&&e.getLineContent(r).charCodeAt(d-1)===st.Space&&(n=" "+n,d-=1),c!==-1&&d!==-1?lp._createRemoveBlockCommentOperations(new P(o,c+i.length+1,r,d+1),i,n):null}_executeBlockComment(e,t,i){e.tokenization.tokenizeIfCheap(i.startLineNumber);const n=e.getLanguageIdAtPosition(i.startLineNumber,1),o=this.languageConfigurationService.getLanguageConfiguration(n).comments;if(!o||!o.blockCommentStartToken||!o.blockCommentEndToken)return;const r=o.blockCommentStartToken,a=o.blockCommentEndToken;let c=this._attemptRemoveBlockComment(e,i,r,a);if(!c){if(i.isEmpty()){const d=e.getLineContent(i.startLineNumber);let l=qF(d);l===-1&&(l=d.length),c=lp._createAddBlockCommentOperations(new P(i.startLineNumber,l+1,i.startLineNumber,d.length+1),r,a,this._insertSpace)}else c=lp._createAddBlockCommentOperations(new P(i.startLineNumber,e.getLineFirstNonWhitespaceColumn(i.startLineNumber),i.endLineNumber,e.getLineMaxColumn(i.endLineNumber)),r,a,this._insertSpace);c.length===1&&(this._deltaColumn=r.length+1)}this._selectionId=t.trackSelection(i);for(const d of c)t.addEditOperation(d.range,d.text)}getEditOperations(e,t){let i=this._selection;if(this._moveEndPositionDown=!1,i.startLineNumber===i.endLineNumber&&this._ignoreFirstLine){t.addEditOperation(new P(i.startLineNumber,e.getLineMaxColumn(i.startLineNumber),i.startLineNumber+1,1),i.startLineNumber===e.getLineCount()?"":`
`),this._selectionId=t.trackSelection(i);return}i.startLineNumber<i.endLineNumber&&i.endColumn===1&&(this._moveEndPositionDown=!0,i=i.setEndPosition(i.endLineNumber-1,e.getLineMaxColumn(i.endLineNumber-1)));const n=cu._gatherPreflightData(this._type,this._insertSpace,e,i.startLineNumber,i.endLineNumber,this._ignoreEmptyLines,this._ignoreFirstLine,this.languageConfigurationService);return n.supported?this._executeLineComments(e,t,n,i):this._executeBlockComment(e,t,i)}computeCursorState(e,t){let i=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(i=i.setEndPosition(i.endLineNumber+1,1)),new at(i.selectionStartLineNumber,i.selectionStartColumn+this._deltaColumn,i.positionLineNumber,i.positionColumn+this._deltaColumn)}static _createRemoveLineCommentsOperations(e,t){const i=[];for(let n=0,o=e.length;n<o;n++){const r=e[n];r.ignore||i.push(qi.delete(new P(t+n,r.commentStrOffset+1,t+n,r.commentStrOffset+r.commentStrLength+1)))}return i}_createAddLineCommentsOperations(e,t){const i=[],n=this._insertSpace?" ":"";for(let o=0,r=e.length;o<r;o++){const a=e[o];a.ignore||i.push(qi.insert(new we(t+o,a.commentStrOffset+1),a.commentStr+n))}return i}static nextVisibleColumn(e,t,i,n){return i?e+(t-e%t):e+n}static _normalizeInsertionPoint(e,t,i,n){let o=Ia.MAX_SAFE_SMALL_INTEGER,r,a;for(let c=0,d=t.length;c<d;c++){if(t[c].ignore)continue;const l=e.getLineContent(i+c);let u=0;for(let g=0,m=t[c].commentStrOffset;u<o&&g<m;g++)u=cu.nextVisibleColumn(u,n,l.charCodeAt(g)===st.Tab,1);u<o&&(o=u)}o=Math.floor(o/n)*n;for(let c=0,d=t.length;c<d;c++){if(t[c].ignore)continue;const l=e.getLineContent(i+c);let u=0;for(r=0,a=t[c].commentStrOffset;u<o&&r<a;r++)u=cu.nextVisibleColumn(u,n,l.charCodeAt(r)===st.Tab,1);u>o?t[c].commentStrOffset=r-1:t[c].commentStrOffset=r}}}class R5 extends Se{constructor(e,t){super(t),this._type=e}run(e,t){const i=e.get(ds);if(!t.hasModel())return;const n=t.getModel(),o=[],r=n.getOptions(),a=t.getOption(L.comments),c=t.getSelections().map((l,u)=>({selection:l,index:u,ignoreFirstLine:!1}));c.sort((l,u)=>P.compareRangesUsingStarts(l.selection,u.selection));let d=c[0];for(let l=1;l<c.length;l++){const u=c[l];d.selection.endLineNumber===u.selection.startLineNumber&&(d.index<u.index?u.ignoreFirstLine=!0:(d.ignoreFirstLine=!0,d=u))}for(const l of c)o.push(new cu(i,l.selection,r.indentSize,this._type,a.insertSpace,a.ignoreEmptyLines,l.ignoreFirstLine));t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class GUe extends R5{constructor(){super(nh.Toggle,{id:"editor.action.commentLine",label:I(958,"Toggle Line Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.Slash,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"5_insert",title:h(959,"&&Toggle Line Comment"),order:1}})}}class zUe extends R5{constructor(){super(nh.ForceAdd,{id:"editor.action.addCommentLine",label:I(960,"Add Line Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyC),weight:W.EditorContrib}})}}class qUe extends R5{constructor(){super(nh.ForceRemove,{id:"editor.action.removeCommentLine",label:I(961,"Remove Line Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyU),weight:W.EditorContrib}})}}class KUe extends Se{constructor(){super({id:"editor.action.blockComment",label:I(962,"Toggle Block Comment"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyA,linux:{primary:E.CtrlCmd|E.Shift|S.KeyA},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"5_insert",title:h(963,"Toggle &&Block Comment"),order:2}})}run(e,t){const i=e.get(ds);if(!t.hasModel())return;const n=t.getOption(L.comments),o=[],r=t.getSelections();for(const a of r)o.push(new lp(a,n.insertSpace,i));t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}ue(GUe);ue(zUe);ue(qUe);ue(KUe);class uF{constructor(e){this.selections=e}equals(e){const t=this.selections.length,i=e.selections.length;if(t!==i)return!1;for(let n=0;n<t;n++)if(!this.selections[n].equalsSelection(e.selections[n]))return!1;return!0}}class gF{constructor(e,t,i){this.cursorState=e,this.scrollTop=t,this.scrollLeft=i}}class sw extends F{static{this.ID="editor.contrib.cursorUndoRedoController"}static get(e){return e.getContribution(sw.ID)}constructor(e){super(),this._editor=e,this._isCursorUndoRedo=!1,this._undoStack=[],this._redoStack=[],this._register(e.onDidChangeModel(t=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeModelContent(t=>{this._undoStack=[],this._redoStack=[]})),this._register(e.onDidChangeCursorSelection(t=>{if(this._isCursorUndoRedo||!t.oldSelections||t.oldModelVersionId!==t.modelVersionId)return;const i=new uF(t.oldSelections);this._undoStack.length>0&&this._undoStack[this._undoStack.length-1].cursorState.equals(i)||(this._undoStack.push(new gF(i,e.getScrollTop(),e.getScrollLeft())),this._redoStack=[],this._undoStack.length>50&&this._undoStack.shift())}))}cursorUndo(){!this._editor.hasModel()||this._undoStack.length===0||(this._redoStack.push(new gF(new uF(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._undoStack.pop()))}cursorRedo(){!this._editor.hasModel()||this._redoStack.length===0||(this._undoStack.push(new gF(new uF(this._editor.getSelections()),this._editor.getScrollTop(),this._editor.getScrollLeft())),this._applyState(this._redoStack.pop()))}_applyState(e){this._isCursorUndoRedo=!0,this._editor.setSelections(e.cursorState.selections),this._editor.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}),this._isCursorUndoRedo=!1}}class jUe extends Se{constructor(){super({id:"cursorUndo",label:I(974,"Cursor Undo"),precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.KeyU,weight:W.EditorContrib}})}run(e,t,i){sw.get(t)?.cursorUndo()}}class YUe extends Se{constructor(){super({id:"cursorRedo",label:I(975,"Cursor Redo"),precondition:void 0})}run(e,t,i){sw.get(t)?.cursorRedo()}}Lt(sw.ID,sw,_t.Eager);ue(jUe);ue(YUe);const QUe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class XUe{constructor(e,t,i){this.selection=e,this.targetPosition=t,this.copy=i,this.targetSelection=null}getEditOperations(e,t){const i=e.getValueInRange(this.selection);if(this.copy||t.addEditOperation(this.selection,null),t.addEditOperation(new P(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column),i),this.selection.containsPosition(this.targetPosition)&&!(this.copy&&(this.selection.getEndPosition().equals(this.targetPosition)||this.selection.getStartPosition().equals(this.targetPosition)))){this.targetSelection=this.selection;return}if(this.copy){this.targetSelection=new at(this.targetPosition.lineNumber,this.targetPosition.column,this.selection.endLineNumber-this.selection.startLineNumber+this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber>this.selection.endLineNumber){this.targetSelection=new at(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}if(this.targetPosition.lineNumber<this.selection.endLineNumber){this.targetSelection=new at(this.targetPosition.lineNumber,this.targetPosition.column,this.targetPosition.lineNumber+this.selection.endLineNumber-this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column+this.selection.endColumn-this.selection.startColumn:this.selection.endColumn);return}this.selection.endColumn<=this.targetPosition.column?this.targetSelection=new at(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column-this.selection.endColumn+this.selection.startColumn:this.targetPosition.column-this.selection.endColumn+this.selection.startColumn,this.targetPosition.lineNumber,this.selection.startLineNumber===this.selection.endLineNumber?this.targetPosition.column:this.selection.endColumn):this.targetSelection=new at(this.targetPosition.lineNumber-this.selection.endLineNumber+this.selection.startLineNumber,this.targetPosition.column,this.targetPosition.lineNumber,this.targetPosition.column+this.selection.endColumn-this.selection.startColumn)}computeCursorState(e,t){return this.targetSelection}}Ve(QUe);function I_(s){return Yt?s.altKey:s.ctrlKey}class Im extends F{static{this.ID="editor.contrib.dragAndDrop"}static{this.TRIGGER_KEY_VALUE=Yt?S.Alt:S.Ctrl}static get(e){return e.getContribution(Im.ID)}constructor(e){super(),this._editor=e,this._dndDecorationIds=this._editor.createDecorationsCollection(),this._register(this._editor.onMouseDown(t=>this._onEditorMouseDown(t))),this._register(this._editor.onMouseUp(t=>this._onEditorMouseUp(t))),this._register(this._editor.onMouseDrag(t=>this._onEditorMouseDrag(t))),this._register(this._editor.onMouseDrop(t=>this._onEditorMouseDrop(t))),this._register(this._editor.onMouseDropCanceled(()=>this._onEditorMouseDropCanceled())),this._register(this._editor.onKeyDown(t=>this.onEditorKeyDown(t))),this._register(this._editor.onKeyUp(t=>this.onEditorKeyUp(t))),this._register(this._editor.onDidBlurEditorWidget(()=>this.onEditorBlur())),this._register(this._editor.onDidBlurEditorText(()=>this.onEditorBlur())),this._mouseDown=!1,this._modifierPressed=!1,this._dragSelection=null}onEditorBlur(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1}onEditorKeyDown(e){!this._editor.getOption(L.dragAndDrop)||this._editor.getOption(L.columnSelection)||(I_(e)&&(this._modifierPressed=!0),this._mouseDown&&I_(e)&&this._editor.updateOptions({mouseStyle:"copy"}))}onEditorKeyUp(e){!this._editor.getOption(L.dragAndDrop)||this._editor.getOption(L.columnSelection)||(I_(e)&&(this._modifierPressed=!1),this._mouseDown&&e.keyCode===Im.TRIGGER_KEY_VALUE&&this._editor.updateOptions({mouseStyle:"default"}))}_onEditorMouseDown(e){this._mouseDown=!0}_onEditorMouseUp(e){this._mouseDown=!1,this._editor.updateOptions({mouseStyle:"text"})}_onEditorMouseDrag(e){const t=e.target;if(this._dragSelection===null){const n=(this._editor.getSelections()||[]).filter(o=>t.position&&o.containsPosition(t.position));if(n.length===1)this._dragSelection=n[0];else return}I_(e.event)?this._editor.updateOptions({mouseStyle:"copy"}):this._editor.updateOptions({mouseStyle:"default"}),t.position&&(this._dragSelection.containsPosition(t.position)?this._removeDecoration():this.showAt(t.position))}_onEditorMouseDropCanceled(){this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}_onEditorMouseDrop(e){if(e.target&&(this._hitContent(e.target)||this._hitMargin(e.target))&&e.target.position){const t=new we(e.target.position.lineNumber,e.target.position.column);if(this._dragSelection===null){let i=null;if(e.event.shiftKey){const n=this._editor.getSelection();if(n){const{selectionStartLineNumber:o,selectionStartColumn:r}=n;i=[new at(o,r,t.lineNumber,t.column)]}}else i=(this._editor.getSelections()||[]).map(n=>n.containsPosition(t)?new at(t.lineNumber,t.column,t.lineNumber,t.column):n);this._editor.setSelections(i||[],"mouse",Ws.Explicit)}else(!this._dragSelection.containsPosition(t)||(I_(e.event)||this._modifierPressed)&&(this._dragSelection.getEndPosition().equals(t)||this._dragSelection.getStartPosition().equals(t)))&&(this._editor.pushUndoStop(),this._editor.executeCommand(Im.ID,new XUe(this._dragSelection,t,I_(e.event)||this._modifierPressed)),this._editor.pushUndoStop())}this._editor.updateOptions({mouseStyle:"text"}),this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1}static{this._DECORATION_OPTIONS=Zt.register({description:"dnd-target",className:"dnd-target"})}showAt(e){this._dndDecorationIds.set([{range:new P(e.lineNumber,e.column,e.lineNumber,e.column),options:Im._DECORATION_OPTIONS}]),this._editor.revealPosition(e,Qi.Immediate)}_removeDecoration(){this._dndDecorationIds.clear()}_hitContent(e){return e.type===xi.CONTENT_TEXT||e.type===xi.CONTENT_EMPTY}_hitMargin(e){return e.type===xi.GUTTER_GLYPH_MARGIN||e.type===xi.GUTTER_LINE_NUMBERS||e.type===xi.GUTTER_LINE_DECORATIONS}dispose(){this._removeDecoration(),this._dragSelection=null,this._mouseDown=!1,this._modifierPressed=!1,super.dispose()}}Lt(Im.ID,Im,_t.BeforeFirstInteraction);const ZUe="editor.action.pasteAs";Lt(md.ID,md,_t.Eager);pS(XV);ze(new class extends Vo{constructor(){super({id:mde,precondition:KK,kbOpts:{weight:W.EditorContrib,primary:E.CtrlCmd|S.Period}})}runEditorCommand(s,e){return md.get(e)?.changePasteType()}});ze(new class extends Vo{constructor(){super({id:"editor.hidePasteWidget",precondition:KK,kbOpts:{weight:W.EditorContrib,primary:S.Escape}})}runEditorCommand(s,e){md.get(e)?.clearWidgets()}});ue(class ope extends Se{static{this.argsSchema={oneOf:[{type:"object",required:["kind"],properties:{kind:{type:"string",description:h(976,`The kind of the paste edit to try pasting with.
If there are multiple edits for this kind, the editor will show a picker. If there are no edits of this kind, the editor will show an error message.`)}}},{type:"object",required:["preferences"],properties:{preferences:{type:"array",description:h(977,`List of preferred paste edit kind to try applying.
The first edit matching the preferences will be applied.`),items:{type:"string"}}}}]}}constructor(){super({id:ZUe,label:I(978,"Paste As..."),precondition:V.writable,metadata:{description:"Paste as",args:[{name:"args",schema:ope.argsSchema}]}})}run(e,t,i){let n;return i&&("kind"in i?n={only:new Ut(i.kind)}:"preferences"in i&&(n={preferences:i.preferences.map(o=>new Ut(o))})),md.get(t)?.pasteAs(n)}});ue(class extends Se{constructor(){super({id:"editor.action.pasteAsText",label:I(979,"Paste as Text"),precondition:V.writable})}run(s,e){return md.get(e)?.pasteAs({providerId:gv.id})}});Lt(tg.ID,tg,_t.BeforeFirstInteraction);pS(QV);ze(new class extends Vo{constructor(){super({id:vde,precondition:jK,kbOpts:{weight:W.EditorContrib,primary:E.CtrlCmd|S.Period}})}runEditorCommand(s,e,t){tg.get(e)?.changeDropType()}});ze(new class extends Vo{constructor(){super({id:"editor.hideDropWidget",precondition:jK,kbOpts:{weight:W.EditorContrib,primary:S.Escape}})}runEditorCommand(s,e,t){tg.get(e)?.clearWidgets()}});class Lc{constructor(e){this._editor=e,this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null,this._startPosition=this._editor.getPosition()}dispose(){this._editor.removeDecorations(this._allDecorations()),this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}reset(){this._decorations=[],this._overviewRulerApproximateDecorations=[],this._findScopeDecorationIds=[],this._rangeHighlightDecorationId=null,this._highlightedDecorationId=null}getCount(){return this._decorations.length}getFindScope(){return this._findScopeDecorationIds[0]?this._editor.getModel().getDecorationRange(this._findScopeDecorationIds[0]):null}getFindScopes(){if(this._findScopeDecorationIds.length){const e=this._findScopeDecorationIds.map(t=>this._editor.getModel().getDecorationRange(t)).filter(t=>!!t);if(e.length)return e}return null}getStartPosition(){return this._startPosition}setStartPosition(e){this._startPosition=e,this.setCurrentFindMatch(null)}_getDecorationIndex(e){const t=this._decorations.indexOf(e);return t>=0?t+1:1}getDecorationRangeAt(e){const t=e<this._decorations.length?this._decorations[e]:null;return t?this._editor.getModel().getDecorationRange(t):null}getCurrentMatchesPosition(e){const t=this._editor.getModel().getDecorationsInRange(e);for(const i of t){const n=i.options;if(n===Lc._FIND_MATCH_DECORATION||n===Lc._CURRENT_FIND_MATCH_DECORATION)return this._getDecorationIndex(i.id)}return 0}setCurrentFindMatch(e){let t=null,i=0;if(e)for(let n=0,o=this._decorations.length;n<o;n++){const r=this._editor.getModel().getDecorationRange(this._decorations[n]);if(e.equalsRange(r)){t=this._decorations[n],i=n+1;break}}return(this._highlightedDecorationId!==null||t!==null)&&this._editor.changeDecorations(n=>{if(this._highlightedDecorationId!==null&&(n.changeDecorationOptions(this._highlightedDecorationId,Lc._FIND_MATCH_DECORATION),this._highlightedDecorationId=null),t!==null&&(this._highlightedDecorationId=t,n.changeDecorationOptions(this._highlightedDecorationId,Lc._CURRENT_FIND_MATCH_DECORATION)),this._rangeHighlightDecorationId!==null&&(n.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),t!==null){let o=this._editor.getModel().getDecorationRange(t);if(o.startLineNumber!==o.endLineNumber&&o.endColumn===1){const r=o.endLineNumber-1,a=this._editor.getModel().getLineMaxColumn(r);o=new P(o.startLineNumber,o.startColumn,r,a)}this._rangeHighlightDecorationId=n.addDecoration(o,Lc._RANGE_HIGHLIGHT_DECORATION)}}),i}set(e,t){this._editor.changeDecorations(i=>{let n=Lc._FIND_MATCH_DECORATION;const o=[];if(e.length>1e3){n=Lc._FIND_MATCH_NO_OVERVIEW_DECORATION;const a=this._editor.getModel().getLineCount(),d=this._editor.getLayoutInfo().height/a,l=Math.max(2,Math.ceil(3/d));let u=e[0].range.startLineNumber,g=e[0].range.endLineNumber;for(let m=1,v=e.length;m<v;m++){const _=e[m].range;g+l>=_.startLineNumber?_.endLineNumber>g&&(g=_.endLineNumber):(o.push({range:new P(u,1,g,1),options:Lc._FIND_MATCH_ONLY_OVERVIEW_DECORATION}),u=_.startLineNumber,g=_.endLineNumber)}o.push({range:new P(u,1,g,1),options:Lc._FIND_MATCH_ONLY_OVERVIEW_DECORATION})}const r=new Array(e.length);for(let a=0,c=e.length;a<c;a++)r[a]={range:e[a].range,options:n};this._decorations=i.deltaDecorations(this._decorations,r),this._overviewRulerApproximateDecorations=i.deltaDecorations(this._overviewRulerApproximateDecorations,o),this._rangeHighlightDecorationId&&(i.removeDecoration(this._rangeHighlightDecorationId),this._rangeHighlightDecorationId=null),this._findScopeDecorationIds.length&&(this._findScopeDecorationIds.forEach(a=>i.removeDecoration(a)),this._findScopeDecorationIds=[]),t?.length&&(this._findScopeDecorationIds=t.map(a=>i.addDecoration(a,Lc._FIND_SCOPE_DECORATION)))})}matchBeforePosition(e){if(this._decorations.length===0)return null;for(let t=this._decorations.length-1;t>=0;t--){const i=this._decorations[t],n=this._editor.getModel().getDecorationRange(i);if(!(!n||n.endLineNumber>e.lineNumber)){if(n.endLineNumber<e.lineNumber)return n;if(!(n.endColumn>e.column))return n}}return this._editor.getModel().getDecorationRange(this._decorations[this._decorations.length-1])}matchAfterPosition(e){if(this._decorations.length===0)return null;for(let t=0,i=this._decorations.length;t<i;t++){const n=this._decorations[t],o=this._editor.getModel().getDecorationRange(n);if(!(!o||o.startLineNumber<e.lineNumber)){if(o.startLineNumber>e.lineNumber)return o;if(!(o.startColumn<e.column))return o}}return this._editor.getModel().getDecorationRange(this._decorations[0])}_allDecorations(){let e=[];return e=e.concat(this._decorations),e=e.concat(this._overviewRulerApproximateDecorations),this._findScopeDecorationIds.length&&e.push(...this._findScopeDecorationIds),this._rangeHighlightDecorationId&&e.push(this._rangeHighlightDecorationId),e}static{this._CURRENT_FIND_MATCH_DECORATION=Zt.register({description:"current-find-match",stickiness:ki.NeverGrowsWhenTypingAtEdges,zIndex:13,className:"currentFindMatch",inlineClassName:"currentFindMatchInline",showIfCollapsed:!0,overviewRuler:{color:ns(vC),position:il.Center},minimap:{color:ns(g8),position:Jm.Inline}})}static{this._FIND_MATCH_DECORATION=Zt.register({description:"find-match",stickiness:ki.NeverGrowsWhenTypingAtEdges,zIndex:10,className:"findMatch",inlineClassName:"findMatchInline",showIfCollapsed:!0,overviewRuler:{color:ns(vC),position:il.Center},minimap:{color:ns(g8),position:Jm.Inline}})}static{this._FIND_MATCH_NO_OVERVIEW_DECORATION=Zt.register({description:"find-match-no-overview",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"findMatch",showIfCollapsed:!0})}static{this._FIND_MATCH_ONLY_OVERVIEW_DECORATION=Zt.register({description:"find-match-only-overview",stickiness:ki.NeverGrowsWhenTypingAtEdges,overviewRuler:{color:ns(vC),position:il.Center}})}static{this._RANGE_HIGHLIGHT_DECORATION=Zt.register({description:"find-range-highlight",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"rangeHighlight",isWholeLine:!0})}static{this._FIND_SCOPE_DECORATION=Zt.register({description:"find-scope",className:"findScope",isWholeLine:!0})}}class JUe{constructor(e,t,i){this._editorSelection=e,this._ranges=t,this._replaceStrings=i,this._trackedEditorSelectionId=null}getEditOperations(e,t){if(this._ranges.length>0){const i=[];for(let r=0;r<this._ranges.length;r++)i.push({range:this._ranges[r],text:this._replaceStrings[r]});i.sort((r,a)=>P.compareRangesUsingStarts(r.range,a.range));const n=[];let o=i[0];for(let r=1;r<i.length;r++)o.range.endLineNumber===i[r].range.startLineNumber&&o.range.endColumn===i[r].range.startColumn?(o.range=o.range.plusRange(i[r].range),o.text=o.text+i[r].text):(n.push(o),o=i[r]);n.push(o);for(const r of n)t.addEditOperation(r.range,r.text)}this._trackedEditorSelectionId=t.trackSelection(this._editorSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._trackedEditorSelectionId)}}function rpe(s,e){if(s&&s[0]!==""){const t=Qte(s,e,"-"),i=Qte(s,e,"_");return t&&!i?Xte(s,e,"-"):!t&&i?Xte(s,e,"_"):s[0].toUpperCase()===s[0]?e.toUpperCase():s[0].toLowerCase()===s[0]?e.toLowerCase():IF(s[0][0])&&e.length>0?e[0].toUpperCase()+e.substr(1):s[0][0].toUpperCase()!==s[0][0]&&e.length>0?e[0].toLowerCase()+e.substr(1):e}else return e}function Qte(s,e,t){return s[0].indexOf(t)!==-1&&e.indexOf(t)!==-1&&s[0].split(t).length===e.split(t).length}function Xte(s,e,t){const i=e.split(t),n=s[0].split(t);let o="";return i.forEach((r,a)=>{o+=rpe([n[a]],r)+t}),o.slice(0,-1)}var ow;(function(s){s[s.StaticValue=0]="StaticValue",s[s.DynamicPieces=1]="DynamicPieces"})(ow||(ow={}));class Zte{constructor(e){this.staticValue=e,this.kind=ow.StaticValue}}class e2e{constructor(e){this.pieces=e,this.kind=ow.DynamicPieces}}class rw{static fromStaticValue(e){return new rw([Tp.staticValue(e)])}get hasReplacementPatterns(){return this._state.kind===ow.DynamicPieces}constructor(e){!e||e.length===0?this._state=new Zte(""):e.length===1&&e[0].staticValue!==null?this._state=new Zte(e[0].staticValue):this._state=new e2e(e)}buildReplaceString(e,t){if(this._state.kind===ow.StaticValue)return t?rpe(e,this._state.staticValue):this._state.staticValue;let i="";for(let n=0,o=this._state.pieces.length;n<o;n++){const r=this._state.pieces[n];if(r.staticValue!==null){i+=r.staticValue;continue}let a=rw._substitute(r.matchIndex,e);if(r.caseOps!==null&&r.caseOps.length>0){const c=[],d=r.caseOps.length;let l=0;for(let u=0,g=a.length;u<g;u++){if(l>=d){c.push(a.slice(u));break}switch(r.caseOps[l]){case"U":c.push(a[u].toUpperCase());break;case"u":c.push(a[u].toUpperCase()),l++;break;case"L":c.push(a[u].toLowerCase());break;case"l":c.push(a[u].toLowerCase()),l++;break;default:c.push(a[u])}}a=c.join("")}i+=a}return i}static _substitute(e,t){if(t===null)return"";if(e===0)return t[0];let i="";for(;e>0;){if(e<t.length)return(t[e]||"")+i;i=String(e%10)+i,e=Math.floor(e/10)}return"$"+i}}class Tp{static staticValue(e){return new Tp(e,-1,null)}static matchIndex(e){return new Tp(null,e,null)}static caseOps(e,t){return new Tp(null,e,t)}constructor(e,t,i){this.staticValue=e,this.matchIndex=t,!i||i.length===0?this.caseOps=null:this.caseOps=i.slice(0)}}class t2e{constructor(e){this._source=e,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=""}emitUnchanged(e){this._emitStatic(this._source.substring(this._lastCharIndex,e)),this._lastCharIndex=e}emitStatic(e,t){this._emitStatic(e),this._lastCharIndex=t}_emitStatic(e){e.length!==0&&(this._currentStaticPiece+=e)}emitMatchIndex(e,t,i){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=Tp.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),this._result[this._resultLen++]=Tp.caseOps(e,i),this._lastCharIndex=t}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=Tp.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),new rw(this._result)}}function i2e(s){if(!s||s.length===0)return new rw(null);const e=[],t=new t2e(s);for(let i=0,n=s.length;i<n;i++){const o=s.charCodeAt(i);if(o===st.Backslash){if(i++,i>=n)break;const r=s.charCodeAt(i);switch(r){case st.Backslash:t.emitUnchanged(i-1),t.emitStatic("\\",i+1);break;case st.n:t.emitUnchanged(i-1),t.emitStatic(`
`,i+1);break;case st.t:t.emitUnchanged(i-1),t.emitStatic("	",i+1);break;case st.u:case st.U:case st.l:case st.L:t.emitUnchanged(i-1),t.emitStatic("",i+1),e.push(String.fromCharCode(r));break}continue}if(o===st.DollarSign){if(i++,i>=n)break;const r=s.charCodeAt(i);if(r===st.DollarSign){t.emitUnchanged(i-1),t.emitStatic("$",i+1);continue}if(r===st.Digit0||r===st.Ampersand){t.emitUnchanged(i-1),t.emitMatchIndex(0,i+1,e),e.length=0;continue}if(st.Digit1<=r&&r<=st.Digit9){let a=r-st.Digit0;if(i+1<n){const c=s.charCodeAt(i+1);if(st.Digit0<=c&&c<=st.Digit9){i++,a=a*10+(c-st.Digit0),t.emitUnchanged(i-2),t.emitMatchIndex(a,i+1,e),e.length=0;continue}}t.emitUnchanged(i-1),t.emitMatchIndex(a,i+1,e),e.length=0;continue}}}return t.finalize()}const kg=new O("findWidgetVisible",!1);kg.toNegated();const D0=new O("findInputFocussed",!1),P5=new O("replaceInputFocussed",!1),dk={primary:E.Alt|S.KeyC,mac:{primary:E.CtrlCmd|E.Alt|S.KeyC}},lk={primary:E.Alt|S.KeyW,mac:{primary:E.CtrlCmd|E.Alt|S.KeyW}},hk={primary:E.Alt|S.KeyR,mac:{primary:E.CtrlCmd|E.Alt|S.KeyR}},uk={primary:E.Alt|S.KeyL,mac:{primary:E.CtrlCmd|E.Alt|S.KeyL}},gk={primary:E.Alt|S.KeyP,mac:{primary:E.CtrlCmd|E.Alt|S.KeyP}},Bi={StartFindAction:"actions.find",StartFindWithSelection:"actions.findWithSelection",StartFindWithArgs:"editor.actions.findWithArgs",NextMatchFindAction:"editor.action.nextMatchFindAction",PreviousMatchFindAction:"editor.action.previousMatchFindAction",GoToMatchFindAction:"editor.action.goToMatchFindAction",NextSelectionMatchFindAction:"editor.action.nextSelectionMatchFindAction",PreviousSelectionMatchFindAction:"editor.action.previousSelectionMatchFindAction",StartFindReplaceAction:"editor.action.startFindReplaceAction",CloseFindWidgetCommand:"closeFindWidget",ToggleCaseSensitiveCommand:"toggleFindCaseSensitive",ToggleWholeWordCommand:"toggleFindWholeWord",ToggleRegexCommand:"toggleFindRegex",ToggleSearchScopeCommand:"toggleFindInSelection",TogglePreserveCaseCommand:"togglePreserveCase",ReplaceOneAction:"editor.action.replaceOne",ReplaceAllAction:"editor.action.replaceAll",SelectAllMatchesAction:"editor.action.selectAllMatches"},hp=19999,n2e=240;class fE{constructor(e,t){this._toDispose=new U,this._editor=e,this._state=t,this._isDisposed=!1,this._startSearchingTimer=new sI,this._decorations=new Lc(e),this._toDispose.add(this._decorations),this._updateDecorationsScheduler=new yn(()=>{if(this._editor.hasModel())return this.research(!1)},100),this._toDispose.add(this._updateDecorationsScheduler),this._toDispose.add(this._editor.onDidChangeCursorPosition(i=>{(i.reason===Ws.Explicit||i.reason===Ws.Undo||i.reason===Ws.Redo)&&this._decorations.setStartPosition(this._editor.getPosition())})),this._ignoreModelContentChanged=!1,this._toDispose.add(this._editor.onDidChangeModelContent(i=>{this._ignoreModelContentChanged||(i.isFlush&&this._decorations.reset(),this._decorations.setStartPosition(this._editor.getPosition()),this._updateDecorationsScheduler.schedule())})),this._toDispose.add(this._state.onFindReplaceStateChange(i=>this._onStateChanged(i))),this.research(!1,this._state.searchScope)}dispose(){this._isDisposed=!0,Xe(this._startSearchingTimer),this._toDispose.dispose()}_onStateChanged(e){this._isDisposed||this._editor.hasModel()&&(e.searchString||e.isReplaceRevealed||e.isRegex||e.wholeWord||e.matchCase||e.searchScope)&&(this._editor.getModel().isTooLargeForSyncing()?(this._startSearchingTimer.cancel(),this._startSearchingTimer.setIfNotSet(()=>{e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor)},n2e)):e.searchScope?this.research(e.moveCursor,this._state.searchScope):this.research(e.moveCursor))}static _getSearchRange(e,t){return t||e.getFullModelRange()}research(e,t){let i=null;typeof t<"u"?t!==null&&(Array.isArray(t)?i=t:i=[t]):i=this._decorations.getFindScopes(),i!==null&&(i=i.map(a=>{if(a.startLineNumber!==a.endLineNumber){let c=a.endLineNumber;return a.endColumn===1&&(c=c-1),new P(a.startLineNumber,1,c,this._editor.getModel().getLineMaxColumn(c))}return a}));const n=this._findMatches(i,!1,hp);this._decorations.set(n,i);const o=this._editor.getSelection();let r=this._decorations.getCurrentMatchesPosition(o);if(r===0&&n.length>0){const a=fse(n.map(c=>c.range),c=>P.compareRangesUsingStarts(c,o)>=0);r=a>0?a-1+1:r}this._state.changeMatchInfo(r,this._decorations.getCount(),void 0),e&&this._editor.getOption(L.find).cursorMoveOnType&&this._moveToNextMatch(this._decorations.getStartPosition())}_hasMatches(){return this._state.matchesCount>0}_cannotFind(){if(!this._hasMatches()){const e=this._decorations.getFindScope();return e&&this._editor.revealRangeInCenterIfOutsideViewport(e,Qi.Smooth),!0}return!1}_setCurrentFindMatch(e){const t=this._decorations.setCurrentFindMatch(e);this._state.changeMatchInfo(t,this._decorations.getCount(),e),this._editor.setSelection(e),this._editor.revealRangeInCenterIfOutsideViewport(e,Qi.Smooth)}_prevSearchPosition(e){const t=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:i,column:n}=e;const o=this._editor.getModel();return t||n===1?(i===1?i=o.getLineCount():i--,n=o.getLineMaxColumn(i)):n--,new we(i,n)}_moveToPrevMatch(e,t=!1){if(!this._state.canNavigateBack()){const l=this._decorations.matchAfterPosition(e);l&&this._setCurrentFindMatch(l);return}if(this._decorations.getCount()<hp){let l=this._decorations.matchBeforePosition(e);l&&l.isEmpty()&&l.getStartPosition().equals(e)&&(e=this._prevSearchPosition(e),l=this._decorations.matchBeforePosition(e)),l&&this._setCurrentFindMatch(l);return}if(this._cannotFind())return;const i=this._decorations.getFindScope(),n=fE._getSearchRange(this._editor.getModel(),i);n.getEndPosition().isBefore(e)&&(e=n.getEndPosition()),e.isBefore(n.getStartPosition())&&(e=n.getEndPosition());const{lineNumber:o,column:r}=e,a=this._editor.getModel();let c=new we(o,r),d=a.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,!1);if(d&&d.range.isEmpty()&&d.range.getStartPosition().equals(c)&&(c=this._prevSearchPosition(c),d=a.findPreviousMatch(this._state.searchString,c,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,!1)),!!d){if(!t&&!n.containsRange(d.range))return this._moveToPrevMatch(d.range.getStartPosition(),!0);this._setCurrentFindMatch(d.range)}}moveToPrevMatch(){this._moveToPrevMatch(this._editor.getSelection().getStartPosition())}_nextSearchPosition(e){const t=this._state.isRegex&&(this._state.searchString.indexOf("^")>=0||this._state.searchString.indexOf("$")>=0);let{lineNumber:i,column:n}=e;const o=this._editor.getModel();return t||n===o.getLineMaxColumn(i)?(i===o.getLineCount()?i=1:i++,n=1):n++,new we(i,n)}_moveToNextMatch(e){if(!this._state.canNavigateForward()){const i=this._decorations.matchBeforePosition(e);i&&this._setCurrentFindMatch(i);return}if(this._decorations.getCount()<hp){let i=this._decorations.matchAfterPosition(e);i&&i.isEmpty()&&i.getStartPosition().equals(e)&&(e=this._nextSearchPosition(e),i=this._decorations.matchAfterPosition(e)),i&&this._setCurrentFindMatch(i);return}const t=this._getNextMatch(e,!1,!0);t&&this._setCurrentFindMatch(t.range)}_getNextMatch(e,t,i,n=!1){if(this._cannotFind())return null;const o=this._decorations.getFindScope(),r=fE._getSearchRange(this._editor.getModel(),o);r.getEndPosition().isBefore(e)&&(e=r.getStartPosition()),e.isBefore(r.getStartPosition())&&(e=r.getStartPosition());const{lineNumber:a,column:c}=e,d=this._editor.getModel();let l=new we(a,c),u=d.findNextMatch(this._state.searchString,l,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,t);return i&&u&&u.range.isEmpty()&&u.range.getStartPosition().equals(l)&&(l=this._nextSearchPosition(l),u=d.findNextMatch(this._state.searchString,l,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,t)),u?!n&&!r.containsRange(u.range)?this._getNextMatch(u.range.getEndPosition(),t,i,!0):u:null}moveToNextMatch(){this._moveToNextMatch(this._editor.getSelection().getEndPosition())}_moveToMatch(e){const t=this._decorations.getDecorationRangeAt(e);t&&this._setCurrentFindMatch(t)}moveToMatch(e){this._moveToMatch(e)}_getReplacePattern(){return this._state.isRegex?i2e(this._state.replaceString):rw.fromStaticValue(this._state.replaceString)}replace(){if(!this._hasMatches())return;const e=this._getReplacePattern(),t=this._editor.getSelection(),i=this._getNextMatch(t.getStartPosition(),!0,!1);if(i)if(t.equalsRange(i.range)){const n=e.buildReplaceString(i.matches,this._state.preserveCase),o=new pI(t,n);this._executeEditorCommand("replace",o),this._decorations.setStartPosition(new we(t.startLineNumber,t.startColumn+n.length)),this.research(!0)}else this._decorations.setStartPosition(this._editor.getPosition()),this._setCurrentFindMatch(i.range)}_findMatches(e,t,i){const n=(e||[null]).map(o=>fE._getSearchRange(this._editor.getModel(),o));return this._editor.getModel().findMatches(this._state.searchString,n,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null,t,i)}replaceAll(){if(!this._hasMatches())return;const e=this._decorations.getFindScopes();e===null&&this._state.matchesCount>=hp?this._largeReplaceAll():this._regularReplaceAll(e),this.research(!1)}_largeReplaceAll(){const t=new Wye(this._state.searchString,this._state.isRegex,this._state.matchCase,this._state.wholeWord?this._editor.getOption(L.wordSeparators):null).parseSearchRequest();if(!t)return;let i=t.regex;if(!i.multiline){let u="mu";i.ignoreCase&&(u+="i"),i.global&&(u+="g"),i=new RegExp(i.source,u)}const n=this._editor.getModel(),o=n.getValue(uy.LF),r=n.getFullModelRange(),a=this._getReplacePattern();let c;const d=this._state.preserveCase;a.hasReplacementPatterns||d?c=o.replace(i,function(){return a.buildReplaceString(arguments,d)}):c=o.replace(i,a.buildReplaceString(null,d));const l=new zse(r,c,this._editor.getSelection());this._executeEditorCommand("replaceAll",l)}_regularReplaceAll(e){const t=this._getReplacePattern(),i=this._findMatches(e,t.hasReplacementPatterns||this._state.preserveCase,Ia.MAX_SAFE_SMALL_INTEGER),n=[];for(let r=0,a=i.length;r<a;r++)n[r]=t.buildReplaceString(i[r].matches,this._state.preserveCase);const o=new JUe(this._editor.getSelection(),i.map(r=>r.range),n);this._executeEditorCommand("replaceAll",o)}selectAllMatches(){if(!this._hasMatches())return;const e=this._decorations.getFindScopes();let i=this._findMatches(e,!1,Ia.MAX_SAFE_SMALL_INTEGER).map(o=>new at(o.range.startLineNumber,o.range.startColumn,o.range.endLineNumber,o.range.endColumn));const n=this._editor.getSelection();for(let o=0,r=i.length;o<r;o++)if(i[o].equalsRange(n)){i=[n].concat(i.slice(0,o)).concat(i.slice(o+1));break}this._editor.setSelections(i)}_executeEditorCommand(e,t){try{this._ignoreModelContentChanged=!0,this._editor.pushUndoStop(),this._editor.executeCommand(e,t),this._editor.pushUndoStop()}finally{this._ignoreModelContentChanged=!1}}}const s2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(s2e);class L5 extends lf{static{this.ID="editor.contrib.findOptionsWidget"}constructor(e,t,i){super(),this._hideSoon=this._register(new yn(()=>this._hide(),2e3)),this._isVisible=!1,this._editor=e,this._state=t,this._keybindingService=i,this._domNode=document.createElement("div"),this._domNode.className="findOptionsWidget",this._domNode.style.display="none",this._domNode.style.top="10px",this._domNode.style.zIndex="12",this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true");const n={inputActiveOptionBorder:vt(Sse),inputActiveOptionForeground:vt(wse),inputActiveOptionBackground:vt(Dz)},o=this._register(Zm());this.caseSensitive=this._register(new Bye({appendTitle:this._keybindingLabelFor(Bi.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase,hoverDelegate:o,...n})),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new Vye({appendTitle:this._keybindingLabelFor(Bi.ToggleWholeWordCommand),isChecked:this._state.wholeWord,hoverDelegate:o,...n})),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new Hye({appendTitle:this._keybindingLabelFor(Bi.ToggleRegexCommand),isChecked:this._state.isRegex,hoverDelegate:o,...n})),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(r=>{let a=!1;r.isRegex&&(this.regex.checked=this._state.isRegex,a=!0),r.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,a=!0),r.matchCase&&(this.caseSensitive.checked=this._state.matchCase,a=!0),!this._state.isRevealed&&a&&this._revealTemporarily()})),this._register(re(this._domNode,pe.MOUSE_LEAVE,r=>this._onMouseLeave())),this._register(re(this._domNode,"mouseover",r=>this._onMouseOver()))}_keybindingLabelFor(e){const t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:""}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return L5.ID}getDomNode(){return this._domNode}getPosition(){return{preference:SI.TOP_RIGHT_CORNER}}highlightFindOptions(){this._revealTemporarily()}_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display="block")}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display="none")}}var Ro;(function(s){s[s.NotSet=0]="NotSet",s[s.True=1]="True",s[s.False=2]="False"})(Ro||(Ro={}));function pk(s,e){return s===Ro.True?!0:s===Ro.False?!1:e}class o2e extends F{get searchString(){return this._searchString}get replaceString(){return this._replaceString}get isRevealed(){return this._isRevealed}get isReplaceRevealed(){return this._isReplaceRevealed}get isRegex(){return pk(this._isRegexOverride,this._isRegex)}get wholeWord(){return pk(this._wholeWordOverride,this._wholeWord)}get matchCase(){return pk(this._matchCaseOverride,this._matchCase)}get preserveCase(){return pk(this._preserveCaseOverride,this._preserveCase)}get actualIsRegex(){return this._isRegex}get actualWholeWord(){return this._wholeWord}get actualMatchCase(){return this._matchCase}get actualPreserveCase(){return this._preserveCase}get searchScope(){return this._searchScope}get matchesPosition(){return this._matchesPosition}get matchesCount(){return this._matchesCount}get currentMatch(){return this._currentMatch}get isSearching(){return this._isSearching}get filters(){return this._filters}constructor(){super(),this._onFindReplaceStateChange=this._register(new M),this.onFindReplaceStateChange=this._onFindReplaceStateChange.event,this._searchString="",this._replaceString="",this._isRevealed=!1,this._isReplaceRevealed=!1,this._isRegex=!1,this._isRegexOverride=Ro.NotSet,this._wholeWord=!1,this._wholeWordOverride=Ro.NotSet,this._matchCase=!1,this._matchCaseOverride=Ro.NotSet,this._preserveCase=!1,this._preserveCaseOverride=Ro.NotSet,this._searchScope=null,this._matchesPosition=0,this._matchesCount=0,this._currentMatch=null,this._loop=!0,this._isSearching=!1,this._filters=null}changeMatchInfo(e,t,i){const n={moveCursor:!1,updateHistory:!1,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let o=!1;t===0&&(e=0),e>t&&(e=t),this._matchesPosition!==e&&(this._matchesPosition=e,n.matchesPosition=!0,o=!0),this._matchesCount!==t&&(this._matchesCount=t,n.matchesCount=!0,o=!0),typeof i<"u"&&(P.equalsRange(this._currentMatch,i)||(this._currentMatch=i,n.currentMatch=!0,o=!0)),o&&this._onFindReplaceStateChange.fire(n)}change(e,t,i=!0){const n={moveCursor:t,updateHistory:i,searchString:!1,replaceString:!1,isRevealed:!1,isReplaceRevealed:!1,isRegex:!1,wholeWord:!1,matchCase:!1,preserveCase:!1,searchScope:!1,matchesPosition:!1,matchesCount:!1,currentMatch:!1,loop:!1,isSearching:!1,filters:!1};let o=!1;const r=this.isRegex,a=this.wholeWord,c=this.matchCase,d=this.preserveCase;typeof e.searchString<"u"&&this._searchString!==e.searchString&&(this._searchString=e.searchString,n.searchString=!0,o=!0),typeof e.replaceString<"u"&&this._replaceString!==e.replaceString&&(this._replaceString=e.replaceString,n.replaceString=!0,o=!0),typeof e.isRevealed<"u"&&this._isRevealed!==e.isRevealed&&(this._isRevealed=e.isRevealed,n.isRevealed=!0,o=!0),typeof e.isReplaceRevealed<"u"&&this._isReplaceRevealed!==e.isReplaceRevealed&&(this._isReplaceRevealed=e.isReplaceRevealed,n.isReplaceRevealed=!0,o=!0),typeof e.isRegex<"u"&&(this._isRegex=e.isRegex),typeof e.wholeWord<"u"&&(this._wholeWord=e.wholeWord),typeof e.matchCase<"u"&&(this._matchCase=e.matchCase),typeof e.preserveCase<"u"&&(this._preserveCase=e.preserveCase),typeof e.searchScope<"u"&&(e.searchScope?.every(l=>this._searchScope?.some(u=>!P.equalsRange(u,l)))||(this._searchScope=e.searchScope,n.searchScope=!0,o=!0)),typeof e.loop<"u"&&this._loop!==e.loop&&(this._loop=e.loop,n.loop=!0,o=!0),typeof e.isSearching<"u"&&this._isSearching!==e.isSearching&&(this._isSearching=e.isSearching,n.isSearching=!0,o=!0),typeof e.filters<"u"&&(this._filters?this._filters.update(e.filters):this._filters=e.filters,n.filters=!0,o=!0),this._isRegexOverride=typeof e.isRegexOverride<"u"?e.isRegexOverride:Ro.NotSet,this._wholeWordOverride=typeof e.wholeWordOverride<"u"?e.wholeWordOverride:Ro.NotSet,this._matchCaseOverride=typeof e.matchCaseOverride<"u"?e.matchCaseOverride:Ro.NotSet,this._preserveCaseOverride=typeof e.preserveCaseOverride<"u"?e.preserveCaseOverride:Ro.NotSet,r!==this.isRegex&&(o=!0,n.isRegex=!0),a!==this.wholeWord&&(o=!0,n.wholeWord=!0),c!==this.matchCase&&(o=!0,n.matchCase=!0),d!==this.preserveCase&&(o=!0,n.preserveCase=!0),o&&this._onFindReplaceStateChange.fire(n)}canNavigateBack(){return this.canNavigateInLoop()||this.matchesPosition!==1}canNavigateForward(){return this.canNavigateInLoop()||this.matchesPosition<this.matchesCount}canNavigateInLoop(){return this._loop||this.matchesCount>=hp}}const r2e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(r2e);const Jte=Pe("find-collapsed",K.chevronRight,h(1018,"Icon to indicate that the editor find widget is collapsed.")),eie=Pe("find-expanded",K.chevronDown,h(1019,"Icon to indicate that the editor find widget is expanded.")),a2e=Pe("find-selection",K.selection,h(1020,"Icon for 'Find in Selection' in the editor find widget.")),c2e=Pe("find-replace",K.replace,h(1021,"Icon for 'Replace' in the editor find widget.")),d2e=Pe("find-replace-all",K.replaceAll,h(1022,"Icon for 'Replace All' in the editor find widget.")),l2e=Pe("find-previous-match",K.arrowUp,h(1023,"Icon for 'Find Previous' in the editor find widget.")),h2e=Pe("find-next-match",K.arrowDown,h(1024,"Icon for 'Find Next' in the editor find widget.")),u2e=h(1025,"Find / Replace"),g2e=h(1026,"Find"),p2e=h(1027,"Find"),f2e=h(1028,"Previous Match"),m2e=h(1029,"Next Match"),v2e=h(1030,"Find in Selection"),_2e=h(1031,"Close"),b2e=h(1032,"Replace"),y2e=h(1033,"Replace"),w2e=h(1034,"Replace"),S2e=h(1035,"Replace All"),C2e=h(1036,"Toggle Replace"),E2e=h(1037,"Only the first {0} results are highlighted, but all find operations work on the entire text.",hp),x2e=h(1038,"{0} of {1}"),tie=h(1039,"No results"),Pl=419,I2e=275,D2e=I2e-54;let NS=69;const k2e=33,iie=Yt?E.WinCtrl:E.CtrlCmd;class pF{constructor(e){this.afterLineNumber=e,this.heightInPx=k2e,this.suppressMouseDown=!1,this.domNode=document.createElement("div"),this.domNode.className="dock-find-viewzone"}}function nie(s,e,t){const i=!!e.match(/\n/);if(t&&i&&t.selectionStart>0){s.stopPropagation();return}}function sie(s,e,t){const i=!!e.match(/\n/);if(t&&i&&t.selectionEnd<t.value.length){s.stopPropagation();return}}class M5 extends lf{static{this.ID="editor.contrib.findWidget"}constructor(e,t,i,n,o,r,a,c,d){super(),this._hoverService=a,this._findWidgetSearchHistory=c,this._replaceWidgetHistory=d,this._cachedHeight=null,this._revealTimeouts=[],this._codeEditor=e,this._controller=t,this._state=i,this._contextViewProvider=n,this._keybindingService=o,this._contextKeyService=r,this._isVisible=!1,this._isReplaceVisible=!1,this._ignoreChangeEvent=!1,this._updateHistoryDelayer=new ju(500),this._register(Ie(()=>this._updateHistoryDelayer.cancel())),this._register(this._state.onFindReplaceStateChange(l=>this._onStateChanged(l))),this._buildDomNode(),this._updateButtons(),this._tryUpdateWidgetWidth(),this._findInput.inputBox.layout(),this._register(this._codeEditor.onDidChangeConfiguration(l=>{if(l.hasChanged(L.readOnly)&&(this._codeEditor.getOption(L.readOnly)&&this._state.change({isReplaceRevealed:!1},!1),this._updateButtons()),l.hasChanged(L.layoutInfo)&&this._tryUpdateWidgetWidth(),l.hasChanged(L.accessibilitySupport)&&this.updateAccessibilitySupport(),l.hasChanged(L.find)){const u=this._codeEditor.getOption(L.find).loop;this._state.change({loop:u},!1);const g=this._codeEditor.getOption(L.find).addExtraSpaceOnTop;g&&!this._viewZone&&(this._viewZone=new pF(0),this._showViewZone()),!g&&this._viewZone&&this._removeViewZone()}})),this.updateAccessibilitySupport(),this._register(this._codeEditor.onDidChangeCursorSelection(()=>{this._isVisible&&this._updateToggleSelectionFindButton()})),this._register(this._codeEditor.onDidFocusEditorWidget(async()=>{if(this._isVisible){const l=await this._controller.getGlobalBufferTerm();l&&l!==this._state.searchString&&(this._state.change({searchString:l},!1),this._findInput.select())}})),this._findInputFocused=D0.bindTo(r),this._findFocusTracker=this._register(Fo(this._findInput.inputBox.inputElement)),this._register(this._findFocusTracker.onDidFocus(()=>{this._findInputFocused.set(!0),this._updateSearchScope()})),this._register(this._findFocusTracker.onDidBlur(()=>{this._findInputFocused.set(!1)})),this._replaceInputFocused=P5.bindTo(r),this._replaceFocusTracker=this._register(Fo(this._replaceInput.inputBox.inputElement)),this._register(this._replaceFocusTracker.onDidFocus(()=>{this._replaceInputFocused.set(!0),this._updateSearchScope()})),this._register(this._replaceFocusTracker.onDidBlur(()=>{this._replaceInputFocused.set(!1)})),this._codeEditor.addOverlayWidget(this),this._codeEditor.getOption(L.find).addExtraSpaceOnTop&&(this._viewZone=new pF(0)),this._register(this._codeEditor.onDidChangeModel(()=>{this._isVisible&&(this._viewZoneId=void 0)})),this._register(this._codeEditor.onDidScrollChange(l=>{if(l.scrollTopChanged){this._layoutViewZone();return}setTimeout(()=>{this._layoutViewZone()},0)}))}getId(){return M5.ID}getDomNode(){return this._domNode}getPosition(){return this._isVisible?{preference:SI.TOP_RIGHT_CORNER}:null}_onStateChanged(e){if(e.searchString){try{this._ignoreChangeEvent=!0,this._findInput.setValue(this._state.searchString)}finally{this._ignoreChangeEvent=!1}this._updateButtons()}if(e.replaceString&&(this._replaceInput.inputBox.value=this._state.replaceString),e.isRevealed&&(this._state.isRevealed?this._reveal():this._hide(!0)),e.isReplaceRevealed&&(this._state.isReplaceRevealed?!this._codeEditor.getOption(L.readOnly)&&!this._isReplaceVisible&&(this._isReplaceVisible=!0,this._replaceInput.width=$a(this._findInput.domNode),this._updateButtons(),this._replaceInput.inputBox.layout()):this._isReplaceVisible&&(this._isReplaceVisible=!1,this._updateButtons())),(e.isRevealed||e.isReplaceRevealed)&&(this._state.isRevealed||this._state.isReplaceRevealed)&&this._tryUpdateHeight()&&this._showViewZone(),e.isRegex&&this._findInput.setRegex(this._state.isRegex),e.wholeWord&&this._findInput.setWholeWords(this._state.wholeWord),e.matchCase&&this._findInput.setCaseSensitive(this._state.matchCase),e.preserveCase&&this._replaceInput.setPreserveCase(this._state.preserveCase),e.searchScope&&(this._state.searchScope?this._toggleSelectionFind.checked=!0:this._toggleSelectionFind.checked=!1,this._updateToggleSelectionFindButton()),e.searchString||e.matchesCount||e.matchesPosition){const t=this._state.searchString.length>0&&this._state.matchesCount===0;this._domNode.classList.toggle("no-results",t),this._updateMatchesCount(),this._updateButtons()}(e.searchString||e.currentMatch)&&this._layoutViewZone(),e.updateHistory&&this._delayedUpdateHistory(),e.loop&&this._updateButtons()}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this)).then(void 0,mt)}_updateHistory(){this._state.searchString&&this._findInput.inputBox.addToHistory(),this._state.replaceString&&this._replaceInput.inputBox.addToHistory()}_updateMatchesCount(){this._matchesCount.style.minWidth=NS+"px",this._state.matchesCount>=hp?this._matchesCount.title=E2e:this._matchesCount.title="",this._matchesCount.firstChild?.remove();let e;if(this._state.matchesCount>0){let t=String(this._state.matchesCount);this._state.matchesCount>=hp&&(t+="+");let i=String(this._state.matchesPosition);i==="0"&&(i="?"),e=Oz(x2e,i,t)}else e=tie;this._matchesCount.appendChild(document.createTextNode(e)),na(this._getAriaLabel(e,this._state.currentMatch,this._state.searchString)),NS=Math.max(NS,this._matchesCount.clientWidth)}_getAriaLabel(e,t,i){if(e===tie)return i===""?h(1040,"{0} found",e):h(1041,"{0} found for '{1}'",e,i);if(t){const n=h(1042,"{0} found for '{1}', at {2}",e,i,t.startLineNumber+":"+t.startColumn),o=this._codeEditor.getModel();return o&&t.startLineNumber<=o.getLineCount()&&t.startLineNumber>=1?`${o.getLineContent(t.startLineNumber)}, ${n}`:n}return h(1043,"{0} found for '{1}'",e,i)}_updateToggleSelectionFindButton(){const e=this._codeEditor.getSelection(),t=e?e.startLineNumber!==e.endLineNumber||e.startColumn!==e.endColumn:!1,i=this._toggleSelectionFind.checked;this._isVisible&&(i||t)?this._toggleSelectionFind.enable():this._toggleSelectionFind.disable()}_updateButtons(){this._findInput.setEnabled(this._isVisible),this._replaceInput.setEnabled(this._isVisible&&this._isReplaceVisible),this._updateToggleSelectionFindButton(),this._closeBtn.setEnabled(this._isVisible);const e=this._state.searchString.length>0,t=!!this._state.matchesCount;this._prevBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateBack()),this._nextBtn.setEnabled(this._isVisible&&e&&t&&this._state.canNavigateForward()),this._replaceBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._replaceAllBtn.setEnabled(this._isVisible&&this._isReplaceVisible&&e),this._domNode.classList.toggle("replaceToggled",this._isReplaceVisible),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible);const i=!this._codeEditor.getOption(L.readOnly);this._toggleReplaceBtn.setEnabled(this._isVisible&&i)}_reveal(){if(this._revealTimeouts.forEach(e=>{clearTimeout(e)}),this._revealTimeouts=[],!this._isVisible){this._isVisible=!0;const e=this._codeEditor.getSelection();switch(this._codeEditor.getOption(L.find).autoFindInSelection){case"always":this._toggleSelectionFind.checked=!0;break;case"never":this._toggleSelectionFind.checked=!1;break;case"multiline":{const i=!!e&&e.startLineNumber!==e.endLineNumber;this._toggleSelectionFind.checked=i;break}}this._tryUpdateWidgetWidth(),this._updateButtons(),this._revealTimeouts.push(setTimeout(()=>{this._domNode.classList.add("visible"),this._domNode.setAttribute("aria-hidden","false")},0)),this._revealTimeouts.push(setTimeout(()=>{this._findInput.validate()},200)),this._codeEditor.layoutOverlayWidget(this);let t=!0;if(this._codeEditor.getOption(L.find).seedSearchStringFromSelection&&e){const i=this._codeEditor.getDomNode();if(i){const n=Bs(i),o=this._codeEditor.getScrolledVisiblePosition(e.getStartPosition()),r=n.left+(o?o.left:0),a=o?o.top:0;if(this._viewZone&&a<this._viewZone.heightInPx){e.endLineNumber>e.startLineNumber&&(t=!1);const c=Uye(this._domNode).left;r>c&&(t=!1);const d=this._codeEditor.getScrolledVisiblePosition(e.getEndPosition());n.left+(d?d.left:0)>c&&(t=!1)}}}this._showViewZone(t)}}_hide(e){this._revealTimeouts.forEach(t=>{clearTimeout(t)}),this._revealTimeouts=[],this._isVisible&&(this._isVisible=!1,this._updateButtons(),this._domNode.classList.remove("visible"),this._domNode.setAttribute("aria-hidden","true"),this._findInput.clearMessage(),e&&this._codeEditor.focus(),this._codeEditor.layoutOverlayWidget(this),this._removeViewZone())}_layoutViewZone(e){if(!this._codeEditor.getOption(L.find).addExtraSpaceOnTop){this._removeViewZone();return}if(!this._isVisible)return;const i=this._viewZone;this._viewZoneId!==void 0||!i||this._codeEditor.changeViewZones(n=>{i.heightInPx=this._getHeight(),this._viewZoneId=n.addZone(i),this._codeEditor.setScrollTop(e||this._codeEditor.getScrollTop()+i.heightInPx)})}_showViewZone(e=!0){if(!this._isVisible||!this._codeEditor.getOption(L.find).addExtraSpaceOnTop)return;this._viewZone===void 0&&(this._viewZone=new pF(0));const i=this._viewZone;this._codeEditor.changeViewZones(n=>{if(this._viewZoneId!==void 0){const o=this._getHeight();if(o===i.heightInPx)return;const r=o-i.heightInPx;i.heightInPx=o,n.layoutZone(this._viewZoneId),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+r);return}else{let o=this._getHeight();if(o-=this._codeEditor.getOption(L.padding).top,o<=0)return;i.heightInPx=o,this._viewZoneId=n.addZone(i),e&&this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()+o)}})}_removeViewZone(){this._codeEditor.changeViewZones(e=>{this._viewZoneId!==void 0&&(e.removeZone(this._viewZoneId),this._viewZoneId=void 0,this._viewZone&&(this._codeEditor.setScrollTop(this._codeEditor.getScrollTop()-this._viewZone.heightInPx),this._viewZone=void 0))})}_tryUpdateWidgetWidth(){if(!this._isVisible||!this._domNode.isConnected)return;const e=this._codeEditor.getLayoutInfo();if(e.contentWidth<=0){this._domNode.classList.add("hiddenEditor");return}else this._domNode.classList.contains("hiddenEditor")&&this._domNode.classList.remove("hiddenEditor");const i=e.width,n=e.minimap.minimapWidth;let o=!1,r=!1,a=!1;if(this._resized&&$a(this._domNode)>Pl){this._domNode.style.maxWidth=`${i-28-n-15}px`,this._replaceInput.width=$a(this._findInput.domNode);return}if(Pl+28+n>=i&&(r=!0),Pl+28+n-NS>=i&&(a=!0),Pl+28+n-NS>=i+50&&(o=!0),this._domNode.classList.toggle("collapsed-find-widget",o),this._domNode.classList.toggle("narrow-find-widget",a),this._domNode.classList.toggle("reduced-find-widget",r),!a&&!o&&(this._domNode.style.maxWidth=`${i-28-n-15}px`),this._findInput.layout({collapsedFindWidget:o,narrowFindWidget:a,reducedFindWidget:r}),this._resized){const c=this._findInput.inputBox.element.clientWidth;c>0&&(this._replaceInput.width=c)}else this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode))}_getHeight(){let e=0;return e+=4,e+=this._findInput.inputBox.height+2,this._isReplaceVisible&&(e+=4,e+=this._replaceInput.inputBox.height+2),e+=4,e}_tryUpdateHeight(){const e=this._getHeight();return this._cachedHeight!==null&&this._cachedHeight===e?!1:(this._cachedHeight=e,this._domNode.style.height=`${e}px`,!0)}focusFindInput(){this._findInput.select(),this._findInput.focus()}focusReplaceInput(){this._replaceInput.select(),this._replaceInput.focus()}highlightFindOptions(){this._findInput.highlightFindOptions()}_updateSearchScope(){if(this._codeEditor.hasModel()&&this._toggleSelectionFind.checked){const e=this._codeEditor.getSelections();e.map(t=>{t.endColumn===1&&t.endLineNumber>t.startLineNumber&&(t=t.setEndPosition(t.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(t.endLineNumber-1)));const i=this._state.currentMatch;return t.startLineNumber!==t.endLineNumber&&!P.equalsRange(t,i)?t:null}).filter(t=>!!t),e.length&&this._state.change({searchScope:e},!0)}}_onFindInputMouseDown(e){e.middleButton&&e.stopPropagation()}_onFindInputKeyDown(e){if(e.equals(iie|S.Enter))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._findInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(S.Tab)){this._isReplaceVisible?this._replaceInput.focus():this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(E.CtrlCmd|S.DownArrow)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(S.UpArrow))return nie(e,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"));if(e.equals(S.DownArrow))return sie(e,this._findInput.getValue(),this._findInput.domNode.querySelector("textarea"))}_onReplaceInputKeyDown(e){if(e.equals(iie|S.Enter))if(this._keybindingService.dispatchEvent(e,e.target)){e.preventDefault();return}else{this._replaceInput.inputBox.insertAtCursor(`
`),e.preventDefault();return}if(e.equals(S.Tab)){this._findInput.focusOnCaseSensitive(),e.preventDefault();return}if(e.equals(E.Shift|S.Tab)){this._findInput.focus(),e.preventDefault();return}if(e.equals(E.CtrlCmd|S.DownArrow)){this._codeEditor.focus(),e.preventDefault();return}if(e.equals(S.UpArrow))return nie(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"));if(e.equals(S.DownArrow))return sie(e,this._replaceInput.inputBox.value,this._replaceInput.inputBox.element.querySelector("textarea"))}getVerticalSashLeft(e){return 0}_keybindingLabelFor(e){const t=this._keybindingService.lookupKeybinding(e);return t?` (${t.getLabel()})`:""}_buildDomNode(){const i=this._codeEditor.getOption(L.find).history,n=this._codeEditor.getOption(L.find).replaceHistory;this._findInput=this._register(new _H(null,this._contextViewProvider,{width:D2e,label:g2e,placeholder:p2e,appendCaseSensitiveLabel:this._keybindingLabelFor(Bi.ToggleCaseSensitiveCommand),appendWholeWordsLabel:this._keybindingLabelFor(Bi.ToggleWholeWordCommand),appendRegexLabel:this._keybindingLabelFor(Bi.ToggleRegexCommand),validation:g=>{if(g.length===0||!this._findInput.getRegex())return null;try{return new RegExp(g,"gu"),null}catch(m){return{content:m.message}}},flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showCommonFindToggles:!0,showHistoryHint:()=>KU(this._keybindingService),inputBoxStyles:JT,toggleStyles:p8,history:i==="workspace"?this._findWidgetSearchHistory:new Set([])},this._contextKeyService)),this._findInput.setRegex(!!this._state.isRegex),this._findInput.setCaseSensitive(!!this._state.matchCase),this._findInput.setWholeWords(!!this._state.wholeWord),this._register(this._findInput.onKeyDown(g=>this._onFindInputKeyDown(g))),this._register(this._findInput.inputBox.onDidChange(()=>{this._ignoreChangeEvent||this._state.change({searchString:this._findInput.getValue()},!0)})),this._register(this._findInput.onDidOptionChange(()=>{this._state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this._findInput.onCaseSensitiveKeyDown(g=>{g.equals(E.Shift|S.Tab)&&this._isReplaceVisible&&(this._replaceInput.focus(),g.preventDefault())})),this._register(this._findInput.onRegexKeyDown(g=>{g.equals(S.Tab)&&this._isReplaceVisible&&(this._replaceInput.focusOnPreserve(),g.preventDefault())})),this._register(this._findInput.inputBox.onDidHeightChange(g=>{this._tryUpdateHeight()&&this._showViewZone()})),fh&&this._register(this._findInput.onMouseDown(g=>this._onFindInputMouseDown(g))),this._matchesCount=document.createElement("div"),this._matchesCount.className="matchesCount",this._updateMatchesCount();const o=this._register(Zm());this._prevBtn=this._register(new D_({label:f2e+this._keybindingLabelFor(Bi.PreviousMatchFindAction),icon:l2e,hoverDelegate:o,onTrigger:()=>{jt(this._codeEditor.getAction(Bi.PreviousMatchFindAction)).run().then(void 0,mt)}},this._hoverService)),this._nextBtn=this._register(new D_({label:m2e+this._keybindingLabelFor(Bi.NextMatchFindAction),icon:h2e,hoverDelegate:o,onTrigger:()=>{jt(this._codeEditor.getAction(Bi.NextMatchFindAction)).run().then(void 0,mt)}},this._hoverService));const r=document.createElement("div");r.className="find-part",r.appendChild(this._findInput.domNode);const a=document.createElement("div");a.className="find-actions",r.appendChild(a),a.appendChild(this._matchesCount),a.appendChild(this._prevBtn.domNode),a.appendChild(this._nextBtn.domNode),this._toggleSelectionFind=this._register(new _ne({icon:a2e,title:v2e+this._keybindingLabelFor(Bi.ToggleSearchScopeCommand),isChecked:!1,hoverDelegate:o,inputActiveOptionBackground:vt(Dz),inputActiveOptionBorder:vt(Sse),inputActiveOptionForeground:vt(wse)})),this._register(this._toggleSelectionFind.onChange(()=>{if(this._toggleSelectionFind.checked){if(this._codeEditor.hasModel()){let g=this._codeEditor.getSelections();g=g.map(m=>(m.endColumn===1&&m.endLineNumber>m.startLineNumber&&(m=m.setEndPosition(m.endLineNumber-1,this._codeEditor.getModel().getLineMaxColumn(m.endLineNumber-1))),m.isEmpty()?null:m)).filter(m=>!!m),g.length&&this._state.change({searchScope:g},!0)}}else this._state.change({searchScope:null},!0)})),a.appendChild(this._toggleSelectionFind.domNode),this._closeBtn=this._register(new D_({label:_2e+this._keybindingLabelFor(Bi.CloseFindWidgetCommand),icon:Cse,hoverDelegate:o,onTrigger:()=>{this._state.change({isRevealed:!1,searchScope:null},!1)},onKeyDown:g=>{g.equals(S.Tab)&&this._isReplaceVisible&&(this._replaceBtn.isEnabled()?this._replaceBtn.focus():this._codeEditor.focus(),g.preventDefault())}},this._hoverService)),this._replaceInput=this._register(new bH(null,void 0,{label:b2e,placeholder:y2e,appendPreserveCaseLabel:this._keybindingLabelFor(Bi.TogglePreserveCaseCommand),history:n==="workspace"?this._replaceWidgetHistory:new Set([]),flexibleHeight:!0,flexibleWidth:!0,flexibleMaxHeight:118,showHistoryHint:()=>KU(this._keybindingService),inputBoxStyles:JT,toggleStyles:p8},this._contextKeyService,!0)),this._replaceInput.setPreserveCase(!!this._state.preserveCase),this._register(this._replaceInput.onKeyDown(g=>this._onReplaceInputKeyDown(g))),this._register(this._replaceInput.inputBox.onDidChange(()=>{this._state.change({replaceString:this._replaceInput.inputBox.value},!1)})),this._register(this._replaceInput.inputBox.onDidHeightChange(g=>{this._isReplaceVisible&&this._tryUpdateHeight()&&this._showViewZone()})),this._register(this._replaceInput.onDidOptionChange(()=>{this._state.change({preserveCase:this._replaceInput.getPreserveCase()},!0)})),this._register(this._replaceInput.onPreserveCaseKeyDown(g=>{g.equals(S.Tab)&&(this._prevBtn.isEnabled()?this._prevBtn.focus():this._nextBtn.isEnabled()?this._nextBtn.focus():this._toggleSelectionFind.enabled?this._toggleSelectionFind.focus():this._closeBtn.isEnabled()&&this._closeBtn.focus(),g.preventDefault())}));const c=this._register(Zm());this._replaceBtn=this._register(new D_({label:w2e+this._keybindingLabelFor(Bi.ReplaceOneAction),icon:c2e,hoverDelegate:c,onTrigger:()=>{this._controller.replace()},onKeyDown:g=>{g.equals(E.Shift|S.Tab)&&(this._closeBtn.focus(),g.preventDefault())}},this._hoverService)),this._replaceAllBtn=this._register(new D_({label:S2e+this._keybindingLabelFor(Bi.ReplaceAllAction),icon:d2e,hoverDelegate:c,onTrigger:()=>{this._controller.replaceAll()}},this._hoverService));const d=document.createElement("div");d.className="replace-part",d.appendChild(this._replaceInput.domNode);const l=document.createElement("div");l.className="replace-actions",d.appendChild(l),l.appendChild(this._replaceBtn.domNode),l.appendChild(this._replaceAllBtn.domNode),this._toggleReplaceBtn=this._register(new D_({label:C2e,className:"codicon toggle left",onTrigger:()=>{this._state.change({isReplaceRevealed:!this._isReplaceVisible},!1),this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode),this._replaceInput.inputBox.layout()),this._showViewZone()}},this._hoverService)),this._toggleReplaceBtn.setExpanded(this._isReplaceVisible),this._domNode=document.createElement("div"),this._domNode.className="editor-widget find-widget",this._domNode.setAttribute("aria-hidden","true"),this._domNode.ariaLabel=u2e,this._domNode.role="dialog",this._domNode.style.width=`${Pl}px`,this._domNode.appendChild(this._toggleReplaceBtn.domNode),this._domNode.appendChild(r),this._domNode.appendChild(this._closeBtn.domNode),this._domNode.appendChild(d),this._resizeSash=this._register(new $_(this._domNode,this,{orientation:St.VERTICAL,size:2})),this._resized=!1;let u=Pl;this._register(this._resizeSash.onDidStart(()=>{u=$a(this._domNode)})),this._register(this._resizeSash.onDidChange(g=>{this._resized=!0;const m=u+g.startX-g.currentX;if(m<Pl)return;const v=parseFloat($ye(this._domNode).maxWidth)||0;m>v||(this._domNode.style.width=`${m}px`,this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode)),this._findInput.inputBox.layout(),this._tryUpdateHeight())})),this._register(this._resizeSash.onDidReset(()=>{const g=$a(this._domNode);if(g<Pl)return;let m=Pl;if(!this._resized||g===Pl){const v=this._codeEditor.getLayoutInfo();m=v.width-28-v.minimap.minimapWidth-15,this._resized=!0}this._domNode.style.width=`${m}px`,this._isReplaceVisible&&(this._replaceInput.width=$a(this._findInput.domNode)),this._findInput.inputBox.layout()}))}updateAccessibilitySupport(){const e=this._codeEditor.getOption(L.accessibilitySupport);this._findInput.setFocusInputOnOptionClick(e!==Ese.Enabled)}getViewState(){let e=!1;return this._viewZone&&this._viewZoneId&&(e=this._viewZone.heightInPx>this._codeEditor.getScrollTop()),{widgetViewZoneVisible:e,scrollTop:this._codeEditor.getScrollTop()}}setViewState(e){e&&e.widgetViewZoneVisible&&this._layoutViewZone(e.scrollTop)}}class D_ extends lf{constructor(e,t){super(),this._opts=e;let i="button";this._opts.className&&(i=i+" "+this._opts.className),this._opts.icon&&(i=i+" "+ke.asClassName(this._opts.icon)),this._domNode=document.createElement("div"),this._domNode.tabIndex=0,this._domNode.className=i,this._domNode.setAttribute("role","button"),this._domNode.setAttribute("aria-label",this._opts.label),this._register(t.setupManagedHover(e.hoverDelegate??Ir("element"),this._domNode,this._opts.label)),this.onclick(this._domNode,n=>{this._opts.onTrigger(),n.preventDefault()}),this.onkeydown(this._domNode,n=>{if(n.equals(S.Space)||n.equals(S.Enter)){this._opts.onTrigger(),n.preventDefault();return}this._opts.onKeyDown?.(n)})}get domNode(){return this._domNode}isEnabled(){return this._domNode.tabIndex>=0}focus(){this._domNode.focus()}setEnabled(e){this._domNode.classList.toggle("disabled",!e),this._domNode.setAttribute("aria-disabled",String(!e)),this._domNode.tabIndex=e?0:-1}setExpanded(e){this._domNode.setAttribute("aria-expanded",String(!!e)),e?(this._domNode.classList.remove(...ke.asClassNameArray(Jte)),this._domNode.classList.add(...ke.asClassNameArray(eie))):(this._domNode.classList.remove(...ke.asClassNameArray(eie)),this._domNode.classList.add(...ke.asClassNameArray(Jte)))}}Fv((s,e)=>{const t=s.getColor(rse);t&&e.addRule(`.monaco-editor .findMatch { border: 1px ${ly(s.type)?"dotted":"solid"} ${t}; box-sizing: border-box; }`);const i=s.getColor(Gye);i&&e.addRule(`.monaco-editor .findScope { border: 1px ${ly(s.type)?"dashed":"solid"} ${i}; }`);const n=s.getColor(tt);n&&e.addRule(`.monaco-editor .find-widget { border: 1px solid ${n}; }`);const o=s.getColor(zye);o&&e.addRule(`.monaco-editor .findMatchInline { color: ${o}; }`);const r=s.getColor(qye);r&&e.addRule(`.monaco-editor .currentFindMatchInline { color: ${r}; }`)});var Hg;let vG=class{static{Hg=this}static{this.FIND_HISTORY_KEY="workbench.find.history"}static{this._instance=null}static getOrCreate(e){return Hg._instance||(Hg._instance=new Hg(e)),Hg._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new M,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){const t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}clear(){this.inMemoryValues.clear(),this.save()}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e;const t=this.storageService.get(Hg.FIND_HISTORY_KEY,he.WORKSPACE);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){const e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(Hg.FIND_HISTORY_KEY,JSON.stringify(e),he.WORKSPACE,gt.USER),this._onDidChangeEmitter.fire(e),t()})}};vG=Hg=f([p(0,it)],vG);var Ug;let _G=class{static{Ug=this}static{this.FIND_HISTORY_KEY="workbench.replace.history"}static{this._instance=null}static getOrCreate(e){return Ug._instance||(Ug._instance=new Ug(e)),Ug._instance}constructor(e){this.storageService=e,this.inMemoryValues=new Set,this._onDidChangeEmitter=new M,this.onDidChange=this._onDidChangeEmitter.event,this.load()}delete(e){const t=this.inMemoryValues.delete(e);return this.save(),t}add(e){return this.inMemoryValues.add(e),this.save(),this}has(e){return this.inMemoryValues.has(e)}clear(){this.inMemoryValues.clear(),this.save()}forEach(e,t){return this.load(),this.inMemoryValues.forEach(e)}replace(e){this.inMemoryValues=new Set(e),this.save()}load(){let e;const t=this.storageService.get(Ug.FIND_HISTORY_KEY,he.WORKSPACE);if(t)try{e=JSON.parse(t)}catch{}this.inMemoryValues=new Set(e||[])}save(){const e=[];return this.inMemoryValues.forEach(t=>e.push(t)),new Promise(t=>{this.storageService.store(Ug.FIND_HISTORY_KEY,JSON.stringify(e),he.WORKSPACE,gt.USER),this._onDidChangeEmitter.fire(e),t()})}};_G=Ug=f([p(0,it)],_G);var bG;const T2e=524288;function yG(s,e="single",t=!1){if(!s.hasModel())return null;const i=s.getSelection();if(e==="single"&&i.startLineNumber===i.endLineNumber||e==="multiple"){if(i.isEmpty()){const n=s.getConfiguredWordAtPosition(i.getStartPosition());if(n&&t===!1)return n.word}else if(s.getModel().getValueLengthInRange(i)<T2e)return s.getModel().getValueInRange(i)}return null}var yd;(function(s){s[s.NoFocusChange=0]="NoFocusChange",s[s.FocusFindInput=1]="FocusFindInput",s[s.FocusReplaceInput=2]="FocusReplaceInput"})(yd||(yd={}));let Mr=class extends F{static{bG=this}static{this.ID="editor.contrib.findController"}get editor(){return this._editor}static get(e){return e.getContribution(bG.ID)}constructor(e,t,i,n,o,r){super(),this._editor=e,this._findWidgetVisible=kg.bindTo(t),this._contextKeyService=t,this._storageService=i,this._clipboardService=n,this._notificationService=o,this._hoverService=r,this._updateHistoryDelayer=new ju(500),this._state=this._register(new o2e),this.loadQueryState(),this._register(this._state.onFindReplaceStateChange(a=>this._onStateChanged(a))),this._model=null,this._register(this._editor.onDidChangeModel(()=>{const a=this._editor.getModel()&&this._state.isRevealed;this.disposeModel(),this._state.change({searchScope:null,matchCase:this._storageService.getBoolean("editor.matchCase",he.WORKSPACE,!1),wholeWord:this._storageService.getBoolean("editor.wholeWord",he.WORKSPACE,!1),isRegex:this._storageService.getBoolean("editor.isRegex",he.WORKSPACE,!1),preserveCase:this._storageService.getBoolean("editor.preserveCase",he.WORKSPACE,!1)},!1),a&&this._start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:yd.NoFocusChange,shouldAnimate:!1,updateSearchScope:!1,loop:this._editor.getOption(L.find).loop})}))}dispose(){this.disposeModel(),super.dispose()}disposeModel(){this._model&&(this._model.dispose(),this._model=null)}_onStateChanged(e){this.saveQueryState(e),e.isRevealed&&(this._state.isRevealed?this._findWidgetVisible.set(!0):(this._findWidgetVisible.reset(),this.disposeModel())),e.searchString&&this.setGlobalBufferTerm(this._state.searchString)}saveQueryState(e){e.isRegex&&this._storageService.store("editor.isRegex",this._state.actualIsRegex,he.WORKSPACE,gt.MACHINE),e.wholeWord&&this._storageService.store("editor.wholeWord",this._state.actualWholeWord,he.WORKSPACE,gt.MACHINE),e.matchCase&&this._storageService.store("editor.matchCase",this._state.actualMatchCase,he.WORKSPACE,gt.MACHINE),e.preserveCase&&this._storageService.store("editor.preserveCase",this._state.actualPreserveCase,he.WORKSPACE,gt.MACHINE)}loadQueryState(){this._state.change({matchCase:this._storageService.getBoolean("editor.matchCase",he.WORKSPACE,this._state.matchCase),wholeWord:this._storageService.getBoolean("editor.wholeWord",he.WORKSPACE,this._state.wholeWord),isRegex:this._storageService.getBoolean("editor.isRegex",he.WORKSPACE,this._state.isRegex),preserveCase:this._storageService.getBoolean("editor.preserveCase",he.WORKSPACE,this._state.preserveCase)},!1)}isFindInputFocused(){return!!D0.getValue(this._contextKeyService)}getState(){return this._state}closeFindWidget(){this._state.change({isRevealed:!1,searchScope:null},!1),this._editor.focus()}toggleCaseSensitive(){this._state.change({matchCase:!this._state.matchCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleWholeWords(){this._state.change({wholeWord:!this._state.wholeWord},!1),this._state.isRevealed||this.highlightFindOptions()}toggleRegex(){this._state.change({isRegex:!this._state.isRegex},!1),this._state.isRevealed||this.highlightFindOptions()}togglePreserveCase(){this._state.change({preserveCase:!this._state.preserveCase},!1),this._state.isRevealed||this.highlightFindOptions()}toggleSearchScope(){if(this._state.searchScope)this._state.change({searchScope:null},!0);else if(this._editor.hasModel()){let e=this._editor.getSelections();e=e.map(t=>(t.endColumn===1&&t.endLineNumber>t.startLineNumber&&(t=t.setEndPosition(t.endLineNumber-1,this._editor.getModel().getLineMaxColumn(t.endLineNumber-1))),t.isEmpty()?null:t)).filter(t=>!!t),e.length&&this._state.change({searchScope:e},!0)}}setSearchString(e){this._state.isRegex&&(e=dy(e)),this._state.change({searchString:e},!1)}highlightFindOptions(e=!1){}async _start(e,t){if(this.disposeModel(),!this._editor.hasModel())return;const i={...t,isRevealed:!0};if(e.seedSearchStringFromSelection==="single"){const n=yG(this._editor,e.seedSearchStringFromSelection,e.seedSearchStringFromNonEmptySelection);n&&(this._state.isRegex?i.searchString=dy(n):i.searchString=n)}else if(e.seedSearchStringFromSelection==="multiple"&&!e.updateSearchScope){const n=yG(this._editor,e.seedSearchStringFromSelection);n&&(i.searchString=n)}if(!i.searchString&&e.seedSearchStringFromGlobalClipboard){const n=await this.getGlobalBufferTerm();if(!this._editor.hasModel())return;n&&(i.searchString=n)}if(e.forceRevealReplace||i.isReplaceRevealed?i.isReplaceRevealed=!0:this._findWidgetVisible.get()||(i.isReplaceRevealed=!1),e.updateSearchScope){const n=this._editor.getSelections();n.some(o=>!o.isEmpty())&&(i.searchScope=n)}i.loop=e.loop,this._state.change(i,!1),this._model||(this._model=new fE(this._editor,this._state))}start(e,t){return this._start(e,t)}moveToNextMatch(){return this._model?(this._model.moveToNextMatch(),!0):!1}moveToPrevMatch(){return this._model?(this._model.moveToPrevMatch(),!0):!1}goToMatch(e){return this._model?(this._model.moveToMatch(e),!0):!1}replace(){return this._model?(this._model.replace(),!0):!1}replaceAll(){return this._model?this._editor.getModel()?.isTooLargeForHeapOperation()?(this._notificationService.warn(h(1003,"The file is too large to perform a replace all operation.")),!1):(this._model.replaceAll(),!0):!1}selectAllMatches(){return this._model?(this._model.selectAllMatches(),this._editor.focus(),!0):!1}async getGlobalBufferTerm(){return this._editor.getOption(L.find).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()?this._clipboardService.readFindText():""}setGlobalBufferTerm(e){this._editor.getOption(L.find).globalFindClipboard&&this._editor.hasModel()&&!this._editor.getModel().isTooLargeForSyncing()&&this._clipboardService.writeFindText(e)}};Mr=bG=f([p(1,fe),p(2,it),p(3,Vs),p(4,Dt),p(5,Ti)],Mr);let wG=class extends Mr{constructor(e,t,i,n,o,r,a,c){super(e,i,r,a,o,c),this._contextViewService=t,this._keybindingService=n,this._widget=null,this._findOptionsWidget=null,this._findWidgetSearchHistory=vG.getOrCreate(r),this._replaceWidgetHistory=_G.getOrCreate(r)}async _start(e,t){this._widget||this._createFindWidget();const i=this._editor.getSelection();let n=!1;switch(this._editor.getOption(L.find).autoFindInSelection){case"always":n=!0;break;case"never":n=!1;break;case"multiline":{n=!!i&&i.startLineNumber!==i.endLineNumber;break}}e.updateSearchScope=e.updateSearchScope||n,await super._start(e,t),this._widget&&(e.shouldFocus===yd.FocusReplaceInput?this._widget.focusReplaceInput():e.shouldFocus===yd.FocusFindInput&&this._widget.focusFindInput())}highlightFindOptions(e=!1){this._widget||this._createFindWidget(),this._state.isRevealed&&!e?this._widget.highlightFindOptions():this._findOptionsWidget.highlightFindOptions()}_createFindWidget(){this._widget=this._register(new M5(this._editor,this,this._state,this._contextViewService,this._keybindingService,this._contextKeyService,this._hoverService,this._findWidgetSearchHistory,this._replaceWidgetHistory)),this._findOptionsWidget=this._register(new L5(this._editor,this._state,this._keybindingService))}saveViewState(){return this._widget?.getViewState()}restoreViewState(e){this._widget?.setViewState(e)}};wG=f([p(1,rf),p(2,fe),p(3,He),p(4,Dt),p(5,it),p(6,Vs),p(7,Ti)],wG);const A2e=xse(new Ise({id:Bi.StartFindAction,label:I(1004,"Find"),precondition:x.or(V.focus,x.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:E.CtrlCmd|S.KeyF,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"3_find",title:h(1005,"&&Find"),order:1}}));A2e.addImplementation(0,(s,e,t)=>{const i=Mr.get(e);return i?i.start({forceRevealReplace:!1,seedSearchStringFromSelection:e.getOption(L.find).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:e.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:e.getOption(L.find).globalFindClipboard,shouldFocus:yd.FocusFindInput,shouldAnimate:!0,updateSearchScope:!1,loop:e.getOption(L.find).loop}):!1});const R2e={description:"Open a new In-Editor Find Widget.",args:[{name:"Open a new In-Editor Find Widget args",schema:{properties:{searchString:{type:"string"},replaceString:{type:"string"},isRegex:{type:"boolean"},matchWholeWord:{type:"boolean"},isCaseSensitive:{type:"boolean"},preserveCase:{type:"boolean"},findInSelection:{type:"boolean"}}}}]};class P2e extends Se{constructor(){super({id:Bi.StartFindWithArgs,label:I(1006,"Find with Arguments"),precondition:void 0,kbOpts:{kbExpr:null,primary:0,weight:W.EditorContrib},metadata:R2e})}async run(e,t,i){const n=Mr.get(t);if(n){const o=i?{searchString:i.searchString,replaceString:i.replaceString,isReplaceRevealed:i.replaceString!==void 0,isRegex:i.isRegex,wholeWord:i.matchWholeWord,matchCase:i.isCaseSensitive,preserveCase:i.preserveCase}:{};await n.start({forceRevealReplace:!1,seedSearchStringFromSelection:n.getState().searchString.length===0&&t.getOption(L.find).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:t.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:yd.FocusFindInput,shouldAnimate:!0,updateSearchScope:i?.findInSelection||!1,loop:t.getOption(L.find).loop},o),n.setGlobalBufferTerm(n.getState().searchString)}}}class L2e extends Se{constructor(){super({id:Bi.StartFindWithSelection,label:I(1007,"Find with Selection"),precondition:void 0,kbOpts:{kbExpr:null,primary:0,mac:{primary:E.CtrlCmd|S.KeyE},weight:W.EditorContrib}})}async run(e,t){const i=Mr.get(t);i&&(await i.start({forceRevealReplace:!1,seedSearchStringFromSelection:"multiple",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:yd.NoFocusChange,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(L.find).loop}),i.setGlobalBufferTerm(i.getState().searchString))}}class ape extends Se{async run(e,t){const i=Mr.get(t);i&&!this._run(i)&&(await i.start({forceRevealReplace:!1,seedSearchStringFromSelection:i.getState().searchString.length===0&&t.getOption(L.find).seedSearchStringFromSelection!=="never"?"single":"none",seedSearchStringFromNonEmptySelection:t.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:!0,shouldFocus:yd.NoFocusChange,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(L.find).loop}),this._run(i))}}class M2e extends ape{constructor(){super({id:Bi.NextMatchFindAction,label:I(1008,"Find Next"),precondition:void 0,kbOpts:[{kbExpr:V.focus,primary:S.F3,mac:{primary:E.CtrlCmd|S.KeyG,secondary:[S.F3]},weight:W.EditorContrib},{kbExpr:x.and(V.focus,D0),primary:S.Enter,weight:W.EditorContrib}]})}_run(e){return e.moveToNextMatch()?(e.editor.pushUndoStop(),!0):!1}}class N2e extends ape{constructor(){super({id:Bi.PreviousMatchFindAction,label:I(1009,"Find Previous"),precondition:void 0,kbOpts:[{kbExpr:V.focus,primary:E.Shift|S.F3,mac:{primary:E.CtrlCmd|E.Shift|S.KeyG,secondary:[E.Shift|S.F3]},weight:W.EditorContrib},{kbExpr:x.and(V.focus,D0),primary:E.Shift|S.Enter,weight:W.EditorContrib}]})}_run(e){return e.moveToPrevMatch()}}class O2e extends Se{constructor(){super({id:Bi.GoToMatchFindAction,label:I(1010,"Go to Match..."),precondition:kg}),this._highlightDecorations=[]}run(e,t,i){const n=Mr.get(t);if(!n)return;const o=n.getState().matchesCount;if(o<1){e.get(Dt).notify({severity:Fe.Warning,message:h(1011,"No matches. Try searching for something else.")});return}const r=e.get(Wt),a=new U,c=a.add(r.createInputBox());c.placeholder=h(1012,"Type a number to go to a specific match (between 1 and {0})",o);const d=u=>{const g=parseInt(u);if(isNaN(g))return;const m=n.getState().matchesCount;if(g>0&&g<=m)return g-1;if(g<0&&g>=-m)return m+g},l=u=>{const g=d(u);if(typeof g=="number"){c.validationMessage=void 0,n.goToMatch(g);const m=n.getState().currentMatch;m&&this.addDecorations(t,m)}else c.validationMessage=h(1013,"Please type a number between 1 and {0}",n.getState().matchesCount),this.clearDecorations(t)};a.add(c.onDidChangeValue(u=>{l(u)})),a.add(c.onDidAccept(()=>{const u=d(c.value);typeof u=="number"?(n.goToMatch(u),c.hide()):c.validationMessage=h(1013,"Please type a number between 1 and {0}",n.getState().matchesCount)})),a.add(c.onDidHide(()=>{this.clearDecorations(t),a.dispose()})),c.show()}clearDecorations(e){e.changeDecorations(t=>{this._highlightDecorations=t.deltaDecorations(this._highlightDecorations,[])})}addDecorations(e,t){e.changeDecorations(i=>{this._highlightDecorations=i.deltaDecorations(this._highlightDecorations,[{range:t,options:{description:"find-match-quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:t,options:{description:"find-match-quick-access-range-highlight-overview",overviewRuler:{color:ns(Dse),position:il.Full}}}])})}}class cpe extends Se{async run(e,t){const i=Mr.get(t);if(!i)return;const n=yG(t,"single",!1);n&&i.setSearchString(n),this._run(i)||(await i.start({forceRevealReplace:!1,seedSearchStringFromSelection:"none",seedSearchStringFromNonEmptySelection:!1,seedSearchStringFromGlobalClipboard:!1,shouldFocus:yd.NoFocusChange,shouldAnimate:!0,updateSearchScope:!1,loop:t.getOption(L.find).loop}),this._run(i))}}class F2e extends cpe{constructor(){super({id:Bi.NextSelectionMatchFindAction,label:I(1014,"Find Next Selection"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|S.F3,weight:W.EditorContrib}})}_run(e){return e.moveToNextMatch()}}class W2e extends cpe{constructor(){super({id:Bi.PreviousSelectionMatchFindAction,label:I(1015,"Find Previous Selection"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|E.Shift|S.F3,weight:W.EditorContrib}})}_run(e){return e.moveToPrevMatch()}}const B2e=xse(new Ise({id:Bi.StartFindReplaceAction,label:I(1016,"Replace"),precondition:x.or(V.focus,x.has("editorIsOpen")),kbOpts:{kbExpr:null,primary:E.CtrlCmd|S.KeyH,mac:{primary:E.CtrlCmd|E.Alt|S.KeyF},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarEditMenu,group:"3_find",title:h(1017,"&&Replace"),order:2}}));B2e.addImplementation(0,(s,e,t)=>{if(!e.hasModel()||e.getOption(L.readOnly))return!1;const i=Mr.get(e);if(!i)return!1;const n=e.getSelection(),o=i.isFindInputFocused(),r=!n.isEmpty()&&n.startLineNumber===n.endLineNumber&&e.getOption(L.find).seedSearchStringFromSelection!=="never"&&!o,a=o||r?yd.FocusReplaceInput:yd.FocusFindInput;return i.start({forceRevealReplace:!0,seedSearchStringFromSelection:r?"single":"none",seedSearchStringFromNonEmptySelection:e.getOption(L.find).seedSearchStringFromSelection==="selection",seedSearchStringFromGlobalClipboard:e.getOption(L.find).seedSearchStringFromSelection!=="never",shouldFocus:a,shouldAnimate:!0,updateSearchScope:!1,loop:e.getOption(L.find).loop})});Lt(Mr.ID,wG,_t.Eager);ue(P2e);ue(L2e);ue(M2e);ue(N2e);ue(O2e);ue(F2e);ue(W2e);const Dl=Vo.bindToContribution(Mr.get);ze(new Dl({id:Bi.CloseFindWidgetCommand,precondition:kg,handler:s=>s.closeFindWidget(),kbOpts:{weight:W.EditorContrib+5,kbExpr:x.and(V.focus,x.not("isComposing")),primary:S.Escape,secondary:[E.Shift|S.Escape]}}));ze(new Dl({id:Bi.ToggleCaseSensitiveCommand,precondition:void 0,handler:s=>s.toggleCaseSensitive(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:dk.primary,mac:dk.mac,win:dk.win,linux:dk.linux}}));ze(new Dl({id:Bi.ToggleWholeWordCommand,precondition:void 0,handler:s=>s.toggleWholeWords(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:lk.primary,mac:lk.mac,win:lk.win,linux:lk.linux}}));ze(new Dl({id:Bi.ToggleRegexCommand,precondition:void 0,handler:s=>s.toggleRegex(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:hk.primary,mac:hk.mac,win:hk.win,linux:hk.linux}}));ze(new Dl({id:Bi.ToggleSearchScopeCommand,precondition:void 0,handler:s=>s.toggleSearchScope(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:uk.primary,mac:uk.mac,win:uk.win,linux:uk.linux}}));ze(new Dl({id:Bi.TogglePreserveCaseCommand,precondition:void 0,handler:s=>s.togglePreserveCase(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:gk.primary,mac:gk.mac,win:gk.win,linux:gk.linux}}));ze(new Dl({id:Bi.ReplaceOneAction,precondition:kg,handler:s=>s.replace(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:E.CtrlCmd|E.Shift|S.Digit1}}));ze(new Dl({id:Bi.ReplaceOneAction,precondition:kg,handler:s=>s.replace(),kbOpts:{weight:W.EditorContrib+5,kbExpr:x.and(V.focus,P5),primary:S.Enter}}));ze(new Dl({id:Bi.ReplaceAllAction,precondition:kg,handler:s=>s.replaceAll(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:E.CtrlCmd|E.Alt|S.Enter}}));ze(new Dl({id:Bi.ReplaceAllAction,precondition:kg,handler:s=>s.replaceAll(),kbOpts:{weight:W.EditorContrib+5,kbExpr:x.and(V.focus,P5),primary:void 0,mac:{primary:E.CtrlCmd|S.Enter}}}));ze(new Dl({id:Bi.SelectAllMatchesAction,precondition:kg,handler:s=>s.selectAllMatches(),kbOpts:{weight:W.EditorContrib+5,kbExpr:V.focus,primary:E.Alt|S.Enter}}));class V2e extends Se{constructor(){super({id:"editor.action.fontZoomIn",label:I(1073,"Increase Editor Font Size"),precondition:void 0})}run(e,t){NE.setZoomLevel(NE.getZoomLevel()+1)}}class H2e extends Se{constructor(){super({id:"editor.action.fontZoomOut",label:I(1074,"Decrease Editor Font Size"),precondition:void 0})}run(e,t){NE.setZoomLevel(NE.getZoomLevel()-1)}}class U2e extends Se{constructor(){super({id:"editor.action.fontZoomReset",label:I(1075,"Reset Editor Font Size"),precondition:void 0})}run(e,t){NE.setZoomLevel(0)}}ue(V2e);ue(H2e);ue(U2e);let aM=class{static{this.ID="editor.contrib.autoFormat"}constructor(e,t,i,n){this._editor=e,this._languageFeaturesService=t,this._workerService=i,this._accessibilitySignalService=n,this._disposables=new U,this._sessionDisposables=new U,this._disposables.add(t.onTypeFormattingEditProvider.onDidChange(this._update,this)),this._disposables.add(e.onDidChangeModel(()=>this._update())),this._disposables.add(e.onDidChangeModelLanguage(()=>this._update())),this._disposables.add(e.onDidChangeConfiguration(o=>{o.hasChanged(L.formatOnType)&&this._update()})),this._update()}dispose(){this._disposables.dispose(),this._sessionDisposables.dispose()}_update(){if(this._sessionDisposables.clear(),!this._editor.getOption(L.formatOnType)||!this._editor.hasModel())return;const e=this._editor.getModel(),[t]=this._languageFeaturesService.onTypeFormattingEditProvider.ordered(e);if(!t||!t.autoFormatTriggerCharacters)return;const i=new jT;for(const n of t.autoFormatTriggerCharacters)i.add(n.charCodeAt(0));this._sessionDisposables.add(this._editor.onDidType(n=>{const o=n.charCodeAt(n.length-1);i.has(o)&&this._trigger(String.fromCharCode(o))}))}_trigger(e){if(!this._editor.hasModel()||this._editor.getSelections().length>1||!this._editor.getSelection().isEmpty())return;const t=this._editor.getModel(),i=this._editor.getPosition(),n=new li,o=this._editor.onDidChangeModelContent(r=>{if(r.isFlush){n.cancel(),o.dispose();return}for(let a=0,c=r.changes.length;a<c;a++)if(r.changes[a].range.endLineNumber<=i.lineNumber){n.cancel(),o.dispose();return}});RSe(this._workerService,this._languageFeaturesService,t,i,e,t.getFormattingOptions(),n.token).then(r=>{n.token.isCancellationRequested||An(r)&&(this._accessibilitySignalService.playSignal(Vp.format,{userGesture:!1}),PSe.execute(this._editor,r,!0))}).finally(()=>{o.dispose()})}};aM=f([p(1,Ne),p(2,vc),p(3,lI)],aM);let cM=class{static{this.ID="editor.contrib.formatOnPaste"}constructor(e,t,i){this.editor=e,this._languageFeaturesService=t,this._instantiationService=i,this._callOnDispose=new U,this._callOnModel=new U,this._callOnDispose.add(e.onDidChangeConfiguration(()=>this._update())),this._callOnDispose.add(e.onDidChangeModel(()=>this._update())),this._callOnDispose.add(e.onDidChangeModelLanguage(()=>this._update())),this._callOnDispose.add(t.documentRangeFormattingEditProvider.onDidChange(this._update,this))}dispose(){this._callOnDispose.dispose(),this._callOnModel.dispose()}_update(){this._callOnModel.clear(),this.editor.getOption(L.formatOnPaste)&&this.editor.hasModel()&&this._languageFeaturesService.documentRangeFormattingEditProvider.has(this.editor.getModel())&&this._callOnModel.add(this.editor.onDidPaste(({range:e})=>this._trigger(e)))}_trigger(e){this.editor.hasModel()&&(this.editor.getSelections().length>1||this._instantiationService.invokeFunction(fN,this.editor,e,xu.Silent,Qc.None,Ce.None,!1).catch(mt))}};cM=f([p(1,Ne),p(2,Z)],cM);class $2e extends Se{constructor(){super({id:"editor.action.formatDocument",label:I(1076,"Format Document"),precondition:x.and(V.notInCompositeEditor,V.writable,V.hasDocumentFormattingProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyF,linux:{primary:E.CtrlCmd|E.Shift|S.KeyI},weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:1.3}})}async run(e,t){if(t.hasModel()){const i=e.get(Z);await e.get(Uu).showWhile(i.invokeFunction(JF,t,xu.Explicit,Qc.None,Ce.None,!0),250)}}}class G2e extends Se{constructor(){super({id:"editor.action.formatSelection",label:I(1077,"Format Selection"),precondition:x.and(V.writable,V.hasDocumentSelectionFormattingProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyF),weight:W.EditorContrib},contextMenuOpts:{when:V.hasNonEmptySelection,group:"1_modification",order:1.31}})}async run(e,t){if(!t.hasModel())return;const i=e.get(Z),n=t.getModel(),o=t.getSelections().map(a=>a.isEmpty()?new P(a.startLineNumber,1,a.startLineNumber,n.getLineMaxColumn(a.startLineNumber)):a);await e.get(Uu).showWhile(i.invokeFunction(fN,t,o,xu.Explicit,Qc.None,Ce.None,!0),250)}}Lt(aM.ID,aM,_t.BeforeFirstInteraction);Lt(cM.ID,cM,_t.BeforeFirstInteraction);ue($2e);ue(G2e);Ee.registerCommand("editor.action.format",async s=>{const e=s.get(Bt).getFocusedCodeEditor();if(!e||!e.hasModel())return;const t=s.get(Ge);e.getSelection().isEmpty()?await t.executeCommand("editor.action.formatDocument"):await t.executeCommand("editor.action.formatSelection")});Ee.registerCommand("_executeDocumentSymbolProvider",async function(s,...e){const[t]=e;yt(R.isUri(t));const i=s.get(TI),o=await s.get(Ci).createModelReference(t);try{return(await i.getOrCreate(o.object.textEditorModel,Ce.None)).getTopLevelSymbols()}finally{o.dispose()}});class N5 extends Se{static{this.ID=yde}constructor(){super({id:N5.ID,label:I(1234,"Show Next Inline Suggestion"),precondition:x.and(V.writable,Ai.inlineSuggestionVisible),kbOpts:{weight:100,primary:E.Alt|S.BracketRight}})}async run(e,t){eo.get(t)?.model.get()?.next()}}class O5 extends Se{static{this.ID=bde}constructor(){super({id:O5.ID,label:I(1235,"Show Previous Inline Suggestion"),precondition:x.and(V.writable,Ai.inlineSuggestionVisible),kbOpts:{weight:100,primary:E.Alt|S.BracketLeft}})}async run(e,t){eo.get(t)?.model.get()?.previous()}}class z2e extends Se{constructor(){super({id:"editor.action.inlineSuggest.trigger",label:I(1236,"Trigger Inline Suggestion"),precondition:V.writable})}async run(e,t){const i=eo.get(t);await Kye(async n=>{await i?.model.get()?.triggerExplicitly(n),i?.playAccessibilitySignal(n)})}}class q2e extends Se{constructor(){super({id:"editor.action.inlineSuggest.triggerInlineEditExplicit",label:I(1237,"Trigger Next Edit Suggestion"),precondition:V.writable})}async run(e,t){const i=e.get(Dt),n=eo.get(t);await n?.model.get()?.triggerExplicitly(void 0,!0),n?.model.get()?.inlineEditAvailable.get()||i.notify({severity:Fe.Info,message:h(1238,"No inline edit is available.")})}}class K2e extends Vo{constructor(){super({id:"editor.action.inlineSuggest.triggerInlineEdit",precondition:V.writable})}async runEditorCommand(e,t,i){await eo.get(t)?.model.get()?.trigger(void 0,{onlyFetchInlineEdits:!0})}}class j2e extends Se{constructor(){super({id:"editor.action.inlineSuggest.acceptNextWord",label:I(1239,"Accept Next Word Of Inline Suggestion"),precondition:x.and(V.writable,Ai.inlineSuggestionVisible),kbOpts:{weight:W.EditorContrib+1,primary:E.CtrlCmd|S.RightArrow,kbExpr:x.and(V.writable,Ai.inlineSuggestionVisible,uI.negate())},menuOpts:[{menuId:N.InlineSuggestionToolbar,title:h(1240,"Accept Word"),group:"primary",order:2}]})}async run(e,t){await eo.get(t)?.model.get()?.acceptNextWord()}}class Y2e extends Se{constructor(){super({id:"editor.action.inlineSuggest.acceptNextLine",label:I(1241,"Accept Next Line Of Inline Suggestion"),precondition:x.and(V.writable,Ai.inlineSuggestionVisible),kbOpts:{weight:W.EditorContrib+1},menuOpts:[{menuId:N.InlineSuggestionToolbar,title:h(1242,"Accept Line"),group:"secondary",order:2}]})}async run(e,t){await eo.get(t)?.model.get()?.acceptNextLine()}}class Q2e extends Se{constructor(){super({id:px,label:I(1243,"Accept Inline Suggestion"),precondition:x.or(Ai.inlineSuggestionVisible,Ai.inlineEditVisible),menuOpts:[{menuId:N.InlineSuggestionToolbar,title:h(1244,"Accept"),group:"primary",order:2},{menuId:N.InlineEditsActions,title:h(1244,"Accept"),group:"primary",order:2}],kbOpts:[{primary:S.Tab,weight:200,kbExpr:x.or(x.and(Ai.inlineSuggestionVisible,V.tabMovesFocus.toNegated(),ut.Visible.toNegated(),V.hoverFocused.toNegated(),Ai.inlineSuggestionHasIndentationLessThanTabSize),x.and(Ai.inlineEditVisible,V.tabMovesFocus.toNegated(),ut.Visible.toNegated(),V.hoverFocused.toNegated(),Ai.tabShouldAcceptInlineEdit))}]})}async run(e,t){const i=eo.getInFocusedEditorOrParent(e);i&&(i.model.get()?.accept(i.editor),i.editor.focus())}}Me.registerKeybindingRule({id:px,weight:202,primary:S.Tab,when:x.and(Ai.inInlineEditsPreviewEditor)});class X2e extends Se{constructor(){super({id:wde,label:I(1245,"Jump to next inline edit"),precondition:Ai.inlineEditVisible,menuOpts:[{menuId:N.InlineEditsActions,title:h(1246,"Jump"),group:"primary",order:1,when:Ai.cursorAtInlineEdit.toNegated()}],kbOpts:{primary:S.Tab,weight:201,kbExpr:x.and(Ai.inlineEditVisible,V.tabMovesFocus.toNegated(),ut.Visible.toNegated(),V.hoverFocused.toNegated(),Ai.tabShouldJumpToInlineEdit)}})}async run(e,t){const i=eo.get(t);i&&i.jump()}}class k0 extends Se{static{this.ID=Sde}constructor(){super({id:k0.ID,label:I(1247,"Hide Inline Suggestion"),precondition:x.or(Ai.inlineSuggestionVisible,Ai.inlineEditVisible),kbOpts:{weight:W.EditorContrib+90,primary:S.Escape},menuOpts:[{menuId:N.InlineEditsActions,title:h(1248,"Reject"),group:"primary",order:3}]})}async run(e,t){const i=eo.getInFocusedEditorOrParent(e);gs(n=>{i?.model.get()?.stop("explicitCancel",n)}),i?.editor.focus()}}class F5 extends Se{static{this.ID=tH}constructor(){super({id:F5.ID,label:I(1249,"Toggle Inline Suggestions Show Collapsed"),precondition:x.true()})}async run(e,t){const i=e.get(ne),n=i.getValue("editor.inlineSuggest.edits.showCollapsed");i.updateValue("editor.inlineSuggest.edits.showCollapsed",!n)}}Me.registerKeybindingRule({id:k0.ID,weight:-1,primary:S.Escape,secondary:[E.Shift|S.Escape],when:x.and(Ai.inInlineEditsPreviewEditor)});class W5 extends X{static{this.ID="editor.action.inlineSuggest.toggleAlwaysShowToolbar"}constructor(){super({id:W5.ID,title:h(1250,"Always Show Toolbar"),f1:!1,precondition:void 0,menu:[{id:N.InlineSuggestionToolbar,group:"secondary",order:10}],toggled:x.equals("config.editor.inlineSuggest.showToolbar","always")})}async run(e){const t=e.get(ne),n=t.getValue("editor.inlineSuggest.showToolbar")==="always"?"onHover":"always";t.updateValue("editor.inlineSuggest.showToolbar",n)}}class Z2e extends Se{constructor(){super({id:"editor.action.inlineSuggest.dev.extractRepro",label:h(1251,"Developer: Extract Inline Suggest State"),alias:"Developer: Inline Suggest Extract Repro",precondition:x.or(Ai.inlineEditVisible,Ai.inlineSuggestionVisible)})}async run(e,t){const i=e.get(Vs),o=eo.get(t)?.model.get();if(!o)return;const r=o.extractReproSample(),c=Ch(JSON.stringify({inlineCompletion:r.inlineCompletion},null,4)).map(l=>"// "+l).join(`
`),d=`${r.documentValue}

// <json>
${c}
// </json>
`;return await i.writeText(d),{reproCase:d}}}class J2e{constructor(e,t,i){this.owner=e,this.range=t,this.controller=i}isValidForHoverAnchor(e){return e.type===tr.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}let SG=class{constructor(e,t,i,n,o,r){this._editor=e,this._languageService=t,this._openerService=i,this.accessibilityService=n,this._instantiationService=o,this._telemetryService=r,this.hoverOrdinal=4}suggestHoverAnchor(e){const t=eo.get(this._editor);if(!t)return null;const i=e.target;if(i.type===xi.CONTENT_VIEW_ZONE){const n=i.detail;if(t.shouldShowHoverAtViewZone(n.viewZoneId))return new YS(1e3,this,P.fromPositions(this._editor.getModel().validatePosition(n.positionBefore||n.position)),e.event.posx,e.event.posy,!1)}if(i.type===xi.CONTENT_EMPTY&&t.shouldShowHoverAt(i.range))return new YS(1e3,this,i.range,e.event.posx,e.event.posy,!1);if(i.type===xi.CONTENT_TEXT&&i.detail.mightBeForeignElement&&t.shouldShowHoverAt(i.range))return new YS(1e3,this,i.range,e.event.posx,e.event.posy,!1);if(i.type===xi.CONTENT_WIDGET&&i.element){const n=Bx.getWarningWidgetContext(i.element);if(n&&t.shouldShowHoverAt(n.range))return new YS(1e3,this,n.range,e.event.posx,e.event.posy,!1)}return null}computeSync(e,t){if(this._editor.getOption(L.inlineSuggest).showToolbar!=="onHover")return[];const i=eo.get(this._editor);return i&&i.shouldShowHoverAt(e.range)?[new J2e(this,e.range,i)]:[]}renderHoverParts(e,t){const i=new U,n=t[0];this._telemetryService.publicLog2("inlineCompletionHover.shown"),this.accessibilityService.isScreenReaderOptimized()&&!this._editor.getOption(L.screenReaderAnnounceInlineSuggestion)&&i.add(this.renderScreenReaderText(e,n));const o=n.controller.model.get(),r=document.createElement("div");e.fragment.appendChild(r),i.add(ka((c,d)=>{const l=d.add(this._instantiationService.createInstance(Gy.hot.read(c),this._editor,!1,Li(null),o.selectedInlineCompletionIndex,o.inlineCompletionsCount,o.activeCommands,o.warning,()=>{e.onContentsChanged()}));r.replaceChildren(l.getDomNode())})),o.triggerExplicitly();const a={hoverPart:n,hoverElement:r,dispose(){i.dispose()}};return new pv([a])}getAccessibleContent(e){return h(1264,"There are inline completions here")}renderScreenReaderText(e,t){const i=new U,n=j,o=n("div.hover-row.markdown-hover"),r=ee(o,n("div.hover-contents",{"aria-live":"assertive"})),a=new Ov({editor:this._editor},this._languageService,this._openerService),c=d=>{const l=h(1265,"Suggestion:"),u=i.add(a.render(new Gi().appendText(l).appendCodeblock("text",d),{asyncRenderCallback:()=>{r.className="hover-contents code-hover-contents",e.onContentsChanged()}}));r.replaceChildren(u.element)};return i.add(fi(d=>{const l=t.controller.model.read(d)?.primaryGhostText.read(d);if(l){const u=this._editor.getModel().getLineContent(l.lineNumber);c(l.renderForScreenReader(u))}else kh(r)})),e.fragment.appendChild(o),i}};SG=f([p(1,vi),p(2,mi),p(3,Nr),p(4,Z),p(5,ai)],SG);class e$e{constructor(){this.type=fc.View,this.priority=95,this.name="inline-completions",this.when=x.or(Ai.inlineSuggestionVisible,Ai.inlineEditVisible)}getProvider(e){const t=e.get(Bt),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)return;const n=eo.get(i)?.model.get();if(n?.state.get())return new t$e(i,n)}}class t$e extends F{constructor(e,t){super(),this._editor=e,this._model=t,this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this.id=oa.InlineCompletions,this.verbositySettingKey="accessibility.verbosity.inlineCompletions",this.options={language:this._editor.getModel()?.getLanguageId()??void 0,type:fc.View}}provideContent(){const e=this._model.state.get();if(!e)throw new Error("Inline completion is visible but state is not available");if(e.kind==="ghostText"){const t=this._model.textModel.getLineContent(e.primaryGhostText.lineNumber),i=e.primaryGhostText.renderForScreenReader(t);if(!i)throw new Error("Inline completion is visible but ghost text is not available");return t+i}else{const t=new fy(this._model.textModel);return uu.fromTextEdit(new hc(e.edits),t).humanReadablePatch(t.getLines())}}provideNextContent(){this._model.next().then(()=>this._onDidChangeContent.fire())}providePreviousContent(){this._model.previous().then(()=>this._onDidChangeContent.fire())}onClose(){this._model.stop(),this._editor.focus()}}var xT;let dM=class extends F{static{xT=this}static{this.ID="editor.contrib.inlineEditsAdapter"}static{this.isFirst=!0}constructor(e,t){super(),this.instantiationService=t,xT.isFirst&&(xT.isFirst=!1,this.instantiationService.createInstance(CG))}};dM=xT=f([p(1,Z)],dM);let CG=class extends F{constructor(e,t){super(),this._languageFeaturesService=e,this._commandService=t;const i=sA("didChangeSignal",this._languageFeaturesService.inlineEditProvider.onDidChange);this._register(ka((n,o)=>{i.read(n),o.add(this._languageFeaturesService.inlineCompletionsProvider.register("*",{async provideInlineCompletions(r,a,c,d){if(!c.includeInlineEdits)return;const l=e.inlineEditProvider.all(r),g=(await Promise.all(l.map(async m=>{const v=await m.provideInlineEdit(r,{triggerKind:jye.Automatic,requestUuid:c.requestUuid},d);if(v)return{result:v,provider:m}}))).filter(m=>!!m);return{edits:g,items:g.map(m=>({range:m.result.range,showRange:m.result.showRange,insertText:m.result.text,command:m.result.accepted,shownCommand:m.result.shown,action:m.result.action,isInlineEdit:!0,edit:m.result})),commands:g.flatMap(m=>m.result.commands??[]),enableForwardStability:!0}},handleRejection:(r,a)=>{a.edit.rejected&&this._commandService.executeCommand(a.edit.rejected.id,...a.edit.rejected.arguments??[])},freeInlineCompletions(r){for(const a of r.edits)a.provider.freeInlineEdit(a.result)},toString(){return"InlineEditsAdapter"}}))}))}};CG=f([p(0,Ne),p(1,Ge)],CG);Lt(dM.ID,dM,_t.Eventually);Lt(eo.ID,jWe(eo.hot),_t.Eventually);ue(z2e);ue(q2e);ze(new K2e);ue(N5);ue(O5);ue(j2e);ue(Y2e);ue(Q2e);ue(F5);ue(k0);ue(X2e);Y(W5);ue(Z2e);d_.register(SG);CD.register(new e$e);const i$e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var aC;Ve(i$e);let $x=class{static{aC=this}static{this.ID="editor.contrib.gotodefinitionatposition"}static{this.MAX_SOURCE_PREVIEW_LINES=8}constructor(e,t,i,n){this.textModelResolverService=t,this.languageService=i,this.languageFeaturesService=n,this.toUnhook=new U,this.toUnhookForKeyboard=new U,this.currentWordAtPosition=null,this.previousPromise=null,this.editor=e,this.linkDecorations=this.editor.createDecorationsCollection();const o=new qN(e);this.toUnhook.add(o),this.toUnhook.add(o.onMouseMoveOrRelevantKeyDown(([r,a])=>{this.startFindDefinitionFromMouse(r,a??void 0)})),this.toUnhook.add(o.onExecute(r=>{this.isEnabled(r)&&this.gotoDefinition(r.target.position,r.hasSideBySideModifier).catch(a=>{mt(a)}).finally(()=>{this.removeLinkDecorations()})})),this.toUnhook.add(o.onCancel(()=>{this.removeLinkDecorations(),this.currentWordAtPosition=null}))}static get(e){return e.getContribution(aC.ID)}async startFindDefinitionFromCursor(e){await this.startFindDefinition(e),this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(()=>{this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear()})),this.toUnhookForKeyboard.add(this.editor.onKeyDown(t=>{t&&(this.currentWordAtPosition=null,this.removeLinkDecorations(),this.toUnhookForKeyboard.clear())}))}startFindDefinitionFromMouse(e,t){if(e.target.type===xi.CONTENT_WIDGET&&this.linkDecorations.length>0)return;if(!this.editor.hasModel()||!this.isEnabled(e,t)){this.currentWordAtPosition=null,this.removeLinkDecorations();return}const i=e.target.position;this.startFindDefinition(i)}async startFindDefinition(e){this.toUnhookForKeyboard.clear();const t=e?this.editor.getModel()?.getWordAtPosition(e):null;if(!t){this.currentWordAtPosition=null,this.removeLinkDecorations();return}if(this.currentWordAtPosition&&this.currentWordAtPosition.startColumn===t.startColumn&&this.currentWordAtPosition.endColumn===t.endColumn&&this.currentWordAtPosition.word===t.word)return;this.currentWordAtPosition=t;const i=new hN(this.editor,fs.Position|fs.Value|fs.Selection|fs.Scroll);this.previousPromise&&(this.previousPromise.cancel(),this.previousPromise=null),this.previousPromise=Tn(r=>this.findDefinition(e,r));let n;try{n=await this.previousPromise}catch(r){mt(r);return}if(!n||!n.length||!i.validate(this.editor)){this.removeLinkDecorations();return}const o=n[0].originSelectionRange?P.lift(n[0].originSelectionRange):new P(e.lineNumber,t.startColumn,e.lineNumber,t.endColumn);if(n.length>1){let r=o;for(const{originSelectionRange:a}of n)a&&(r=P.plusRange(r,a));this.addDecoration(r,new Gi().appendText(h(1135,"Click to show {0} definitions.",n.length)))}else{const r=n[0];return r.uri?this.textModelResolverService.createModelReference(r.uri).then(a=>{if(!a.object||!a.object.textEditorModel){a.dispose();return}const{object:{textEditorModel:c}}=a,{startLineNumber:d}=r.range;if(d<1||d>c.getLineCount()){a.dispose();return}const l=this.getPreviewValue(c,d,r),u=this.languageService.guessLanguageIdByFilepathOrFirstLine(c.uri);this.addDecoration(o,l?new Gi().appendCodeblock(u||"",l):void 0),a.dispose()}):void 0}}getPreviewValue(e,t,i){let n=i.range;return n.endLineNumber-n.startLineNumber>=aC.MAX_SOURCE_PREVIEW_LINES&&(n=this.getPreviewRangeBasedOnIndentation(e,t)),n=e.validateRange(n),this.stripIndentationFromPreviewRange(e,t,n)}stripIndentationFromPreviewRange(e,t,i){let o=e.getLineFirstNonWhitespaceColumn(t);for(let a=t+1;a<i.endLineNumber;a++){const c=e.getLineFirstNonWhitespaceColumn(a);o=Math.min(o,c)}return e.getValueInRange(i).replace(new RegExp(`^\\s{${o-1}}`,"gm"),"").trim()}getPreviewRangeBasedOnIndentation(e,t){const i=e.getLineFirstNonWhitespaceColumn(t),n=Math.min(e.getLineCount(),t+aC.MAX_SOURCE_PREVIEW_LINES);let o=t+1;for(;o<n;o++){const r=e.getLineFirstNonWhitespaceColumn(o);if(i===r)break}return new P(t,1,o+1,1)}addDecoration(e,t){const i={range:e,options:{description:"goto-definition-link",inlineClassName:"goto-definition-link",hoverMessage:t}};this.linkDecorations.set([i])}removeLinkDecorations(){this.linkDecorations.clear()}isEnabled(e,t){return this.editor.hasModel()&&e.isLeftClick&&e.isNoneOrSingleMouseDown&&e.target.type===xi.CONTENT_TEXT&&!(e.target.detail.injectedText?.options instanceof Iz)&&(e.hasTriggerModifier||(t?t.keyCodeIsTriggerKey:!1))&&this.languageFeaturesService.definitionProvider.has(this.editor.getModel())}findDefinition(e,t){const i=this.editor.getModel();return i?RI(this.languageFeaturesService.definitionProvider,i,e,!1,t):Promise.resolve(null)}gotoDefinition(e,t){return this.editor.setPosition(e),this.editor.invokeWithinContext(i=>{const n=!t&&this.editor.getOption(L.definitionLinkOpensInPeek)&&!this.isInPeekEditor(i);return new LI({openToSide:t,openInPeek:n,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(i)})}isInPeekEditor(e){const t=e.get(fe);return Pr.inPeekEditor.getValue(t)}dispose(){this.toUnhook.dispose(),this.toUnhookForKeyboard.dispose()}};$x=aC=f([p(1,Ci),p(2,vi),p(3,Ne)],$x);Lt($x.ID,$x,_t.BeforeFirstInteraction);const n$e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),s$e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(s$e);var EG;(function(s){function e(t){switch(t){case Fe.Ignore:return"severity-ignore "+ke.asClassName(K.info);case Fe.Info:return ke.asClassName(K.info);case Fe.Warning:return ke.asClassName(K.warning);case Fe.Error:return ke.asClassName(K.error);default:return""}}s.className=e})(EG||(EG={}));var xG;Ve(n$e);class o$e{constructor(e,t,i,n,o){this._openerService=n,this._labelService=o,this._lines=0,this._longestLineLength=0,this._relatedDiagnostics=new WeakMap,this._disposables=new U,this._editor=t;const r=document.createElement("div");r.className="descriptioncontainer",this._messageBlock=document.createElement("div"),this._messageBlock.classList.add("message"),this._messageBlock.setAttribute("aria-live","assertive"),this._messageBlock.setAttribute("role","alert"),r.appendChild(this._messageBlock),this._relatedBlock=document.createElement("div"),r.appendChild(this._relatedBlock),this._disposables.add(No(this._relatedBlock,"click",a=>{a.preventDefault();const c=this._relatedDiagnostics.get(a.target);c&&i(c)})),this._scrollable=new Gne(r,{horizontal:cd.Auto,vertical:cd.Auto,useShadows:!1,horizontalScrollbarSize:6,verticalScrollbarSize:6}),e.appendChild(this._scrollable.getDomNode()),this._disposables.add(this._scrollable.onScroll(a=>{r.style.left=`-${a.scrollLeft}px`,r.style.top=`-${a.scrollTop}px`})),this._disposables.add(this._scrollable)}dispose(){Xe(this._disposables)}update(e){const{source:t,message:i,relatedInformation:n,code:o}=e;let r=(t?.length||0)+2;o&&(typeof o=="string"?r+=o.length:r+=o.value.length);const a=Ch(i);this._lines=a.length,this._longestLineLength=0;for(const g of a)this._longestLineLength=Math.max(g.length+r,this._longestLineLength);Xi(this._messageBlock),this._messageBlock.setAttribute("aria-label",this.getAriaLabel(e)),this._editor.applyFontInfo(this._messageBlock);let c=this._messageBlock;for(const g of a)c=document.createElement("div"),c.innerText=g,g===""&&(c.style.height=this._messageBlock.style.lineHeight),this._messageBlock.appendChild(c);if(t||o){const g=document.createElement("span");if(g.classList.add("details"),c.appendChild(g),t){const m=document.createElement("span");m.innerText=t,m.classList.add("source"),g.appendChild(m)}if(o)if(typeof o=="string"){const m=document.createElement("span");m.innerText=`(${o})`,m.classList.add("code"),g.appendChild(m)}else{this._codeLink=j("a.code-link"),this._codeLink.setAttribute("href",`${o.target.toString()}`),this._codeLink.onclick=v=>{this._openerService.open(o.target,{allowCommands:!0}),v.preventDefault(),v.stopPropagation()};const m=ee(this._codeLink,j("span"));m.innerText=o.value,g.appendChild(this._codeLink)}}if(Xi(this._relatedBlock),this._editor.applyFontInfo(this._relatedBlock),An(n)){const g=this._relatedBlock.appendChild(document.createElement("div"));g.style.paddingTop=`${Math.floor(this._editor.getOption(L.lineHeight)*.66)}px`,this._lines+=1;for(const m of n){const v=document.createElement("div"),_=document.createElement("a");_.classList.add("filename"),_.innerText=`${this._labelService.getUriBasenameLabel(m.resource)}(${m.startLineNumber}, ${m.startColumn}): `,_.title=this._labelService.getUriLabel(m.resource),this._relatedDiagnostics.set(_,m);const w=document.createElement("span");w.innerText=m.message,v.appendChild(_),v.appendChild(w),this._lines+=1,g.appendChild(v)}}const d=this._editor.getOption(L.fontInfo),l=Math.ceil(d.typicalFullwidthCharacterWidth*this._longestLineLength*.75),u=d.lineHeight*this._lines;this._scrollable.setScrollDimensions({scrollWidth:l,scrollHeight:u})}layout(e,t){this._scrollable.getDomNode().style.height=`${e}px`,this._scrollable.getDomNode().style.width=`${t}px`,this._scrollable.setScrollDimensions({width:t,height:e})}getHeightInLines(){return Math.min(17,this._lines)}getAriaLabel(e){let t="";switch(e.severity){case Bn.Error:t=h(1086,"Error");break;case Bn.Warning:t=h(1087,"Warning");break;case Bn.Info:t=h(1088,"Info");break;case Bn.Hint:t=h(1089,"Hint");break}let i=h(1090,"{0} at {1}. ",t,e.startLineNumber+":"+e.startColumn);const n=this._editor.getModel();return n&&e.startLineNumber<=n.getLineCount()&&e.startLineNumber>=1&&(i=`${n.getLineContent(e.startLineNumber)}, ${i}`),i}}let Gx=class extends VA{static{xG=this}static{this.TitleMenu=new N("gotoErrorTitleMenu")}constructor(e,t,i,n,o,r,a){super(e,{showArrow:!0,showFrame:!0,isAccessible:!0,frameWidth:1},o),this._themeService=t,this._openerService=i,this._menuService=n,this._contextKeyService=r,this._labelService=a,this._callOnDispose=new U,this._onDidSelectRelatedInformation=new M,this.onDidSelectRelatedInformation=this._onDidSelectRelatedInformation.event,this._severity=Bn.Warning,this._backgroundColor=ye.white,this._applyTheme(t.getColorTheme()),this._callOnDispose.add(t.onDidColorThemeChange(this._applyTheme.bind(this))),this.create()}_applyTheme(e){this._backgroundColor=e.getColor(d$e);let t=IG,i=r$e;this._severity===Bn.Warning?(t=IT,i=a$e):this._severity===Bn.Info&&(t=DG,i=c$e);const n=e.getColor(t),o=e.getColor(i);this.style({arrowColor:n,frameColor:n,headerBackgroundColor:o,primaryHeadingColor:e.getColor(gae),secondaryHeadingColor:e.getColor(pae)})}_applyStyles(){this._parentContainer&&(this._parentContainer.style.backgroundColor=this._backgroundColor?this._backgroundColor.toString():""),super._applyStyles()}dispose(){this._callOnDispose.dispose(),super.dispose()}focus(){this._parentContainer.focus()}_fillHead(e){super._fillHead(e),this._disposables.add(this._actionbarWidget.actionRunner.onWillRun(n=>this.editor.focus()));const t=this._menuService.getMenuActions(xG.TitleMenu,this._contextKeyService),i=nN(t);this._actionbarWidget.push(i,{label:!1,icon:!0,index:0})}_fillTitleIcon(e){this._icon=ee(e,j(""))}_fillBody(e){this._parentContainer=e,e.classList.add("marker-widget"),this._parentContainer.tabIndex=0,this._parentContainer.setAttribute("role","tooltip"),this._container=document.createElement("div"),e.appendChild(this._container),this._message=new o$e(this._container,this.editor,t=>this._onDidSelectRelatedInformation.fire(t),this._openerService,this._labelService),this._disposables.add(this._message)}show(){throw new Error("call showAtMarker")}showAtMarker(e,t,i){this._container.classList.remove("stale"),this._message.update(e),this._severity=e.severity,this._applyTheme(this._themeService.getColorTheme());const n=P.lift(e),o=this.editor.getPosition(),r=o&&n.containsPosition(o)?o:n.getStartPosition();super.show(r,this.computeRequiredHeight());const a=this.editor.getModel();if(a){const c=i>1?h(1091,"{0} of {1} problems",t,i):h(1092,"{0} of {1} problem",t,i);this.setTitle(Qe(a.uri),c)}this._icon.className=`codicon ${EG.className(Bn.toSeverity(this._severity))}`,this.editor.revealPositionNearTop(r,Qi.Smooth),this.editor.focus()}updateMarker(e){this._container.classList.remove("stale"),this._message.update(e)}showStale(){this._container.classList.add("stale"),this._relayout()}_doLayoutBody(e,t){super._doLayoutBody(e,t),this._heightInPixel=e,this._message.layout(e,t),this._container.style.height=`${e}px`}_onWidth(e){this._message.layout(this._heightInPixel,e)}_relayout(){super._relayout(this.computeRequiredHeight())}computeRequiredHeight(){return 3+this._message.getHeightInLines()}};Gx=xG=f([p(1,pt),p(2,mi),p(3,fn),p(4,Z),p(5,fe),p(6,ui)],Gx);const oie=Jz(Bie,Yye),rie=Jz(LT,Qye),aie=Jz(wE,Xye),IG=H("editorMarkerNavigationError.background",{dark:oie,light:oie,hcDark:tt,hcLight:tt},h(1093,"Editor marker navigation widget error color.")),r$e=H("editorMarkerNavigationError.headerBackground",{dark:et(IG,.1),light:et(IG,.1),hcDark:null,hcLight:null},h(1094,"Editor marker navigation widget error heading background.")),IT=H("editorMarkerNavigationWarning.background",{dark:rie,light:rie,hcDark:tt,hcLight:tt},h(1095,"Editor marker navigation widget warning color.")),a$e=H("editorMarkerNavigationWarning.headerBackground",{dark:et(IT,.1),light:et(IT,.1),hcDark:"#0C141F",hcLight:et(IT,.2)},h(1096,"Editor marker navigation widget warning heading background.")),DG=H("editorMarkerNavigationInfo.background",{dark:aie,light:aie,hcDark:tt,hcLight:tt},h(1097,"Editor marker navigation widget info color.")),c$e=H("editorMarkerNavigationInfo.headerBackground",{dark:et(DG,.1),light:et(DG,.1),hcDark:null,hcLight:null},h(1098,"Editor marker navigation widget info heading background.")),d$e=H("editorMarkerNavigation.background",ss,h(1099,"Editor marker navigation widget background."));var cC;let Dv=class{static{cC=this}static{this.ID="editor.contrib.markerController"}static get(e){return e.getContribution(cC.ID)}constructor(e,t,i,n,o){this._markerNavigationService=t,this._contextKeyService=i,this._editorService=n,this._instantiationService=o,this._sessionDispoables=new U,this._editor=e,this._widgetVisible=dpe.bindTo(this._contextKeyService)}dispose(){this._cleanUp(),this._sessionDispoables.dispose()}_cleanUp(){this._widgetVisible.reset(),this._sessionDispoables.clear(),this._widget=void 0,this._model=void 0}_getOrCreateModel(e){if(this._model&&this._model.matches(e))return this._model;let t=!1;return this._model&&(t=!0,this._cleanUp()),this._model=this._markerNavigationService.getMarkerList(e),t&&this._model.move(!0,this._editor.getModel(),this._editor.getPosition()),this._widget=this._instantiationService.createInstance(Gx,this._editor),this._widget.onDidClose(()=>this.close(),this,this._sessionDispoables),this._widgetVisible.set(!0),this._sessionDispoables.add(this._model),this._sessionDispoables.add(this._widget),this._sessionDispoables.add(this._editor.onDidChangeCursorPosition(i=>{(!this._model?.selected||!P.containsPosition(this._model?.selected.marker,i.position))&&this._model?.resetIndex()})),this._sessionDispoables.add(this._model.onDidChange(()=>{if(!this._widget||!this._widget.position||!this._model)return;const i=this._model.find(this._editor.getModel().uri,this._widget.position);i?this._widget.updateMarker(i.marker):this._widget.showStale()})),this._sessionDispoables.add(this._widget.onDidSelectRelatedInformation(i=>{this._editorService.openCodeEditor({resource:i.resource,options:{pinned:!0,revealIfOpened:!0,selection:P.lift(i).collapseToStart()}},this._editor),this.close(!1)})),this._sessionDispoables.add(this._editor.onDidChangeModel(()=>this._cleanUp())),this._model}close(e=!0){this._cleanUp(),e&&this._editor.focus()}showAtMarker(e){if(!this._editor.hasModel())return;const t=this._editor.getModel(),i=this._getOrCreateModel(t.uri);i.resetIndex(),i.move(!0,t,new we(e.startLineNumber,e.startColumn)),i.selected&&this._widget.showAtMarker(i.selected.marker,i.selected.index,i.selected.total)}async navigate(e,t){if(!this._editor.hasModel())return;const i=this._editor.getModel(),n=this._getOrCreateModel(t?void 0:i.uri);if(n.move(e,i,this._editor.getPosition()),!!n.selected)if(n.selected.marker.resource.toString()!==i.uri.toString()){this._cleanUp();const o=await this._editorService.openCodeEditor({resource:n.selected.marker.resource,options:{pinned:!1,revealIfOpened:!0,selectionRevealType:Dm.NearTop,selection:n.selected.marker}},this._editor);o&&(cC.get(o)?.close(),cC.get(o)?.navigate(e,t))}else this._widget.showAtMarker(n.selected.marker,n.selected.index,n.selected.total)}};Dv=cC=f([p(1,sae),p(2,fe),p(3,Bt),p(4,Z)],Dv);class T0 extends Se{constructor(e,t,i){super(i),this._next=e,this._multiFile=t}async run(e,t){t.hasModel()&&await Dv.get(t)?.navigate(this._next,this._multiFile)}}class ey extends T0{static{this.ID="editor.action.marker.next"}static{this.LABEL=I(1078,"Go to Next Problem (Error, Warning, Info)")}constructor(){super(!0,!1,{id:ey.ID,label:ey.LABEL,precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.Alt|S.F8,weight:W.EditorContrib},menuOpts:{menuId:Gx.TitleMenu,title:ey.LABEL.value,icon:Pe("marker-navigation-next",K.arrowDown,h(1079,"Icon for goto next marker.")),group:"navigation",order:1}})}}class mE extends T0{static{this.ID="editor.action.marker.prev"}static{this.LABEL=I(1080,"Go to Previous Problem (Error, Warning, Info)")}constructor(){super(!1,!1,{id:mE.ID,label:mE.LABEL,precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.Shift|E.Alt|S.F8,weight:W.EditorContrib},menuOpts:{menuId:Gx.TitleMenu,title:mE.LABEL.value,icon:Pe("marker-navigation-previous",K.arrowUp,h(1081,"Icon for goto previous marker.")),group:"navigation",order:2}})}}class l$e extends T0{constructor(){super(!0,!0,{id:"editor.action.marker.nextInFiles",label:I(1082,"Go to Next Problem in Files (Error, Warning, Info)"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:S.F8,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarGoMenu,title:h(1083,"Next &&Problem"),group:"6_problem_nav",order:1}})}}class h$e extends T0{constructor(){super(!1,!0,{id:"editor.action.marker.prevInFiles",label:I(1084,"Go to Previous Problem in Files (Error, Warning, Info)"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.Shift|S.F8,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarGoMenu,title:h(1085,"Previous &&Problem"),group:"6_problem_nav",order:2}})}}Lt(Dv.ID,Dv,_t.Lazy);ue(ey);ue(mE);ue(l$e);ue(h$e);const dpe=new O("markersNavigationVisible",!1),u$e=Vo.bindToContribution(Dv.get);ze(new u$e({id:"closeMarkersNavigation",precondition:dpe,handler:s=>s.close(),kbOpts:{weight:W.EditorContrib+50,kbExpr:V.focus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));class g$e extends Se{constructor(){super({id:"editor.action.debugEditorGpuRenderer",label:I(1156,"Developer: Debug Editor GPU Renderer"),precondition:x.true()})}async run(e,t){const i=e.get(Z),o=await e.get(Wt).pick([{label:h(1157,"Log Texture Atlas Stats"),id:"logTextureAtlasStats"},{label:h(1158,"Save Texture Atlas"),id:"saveTextureAtlas"},{label:h(1159,"Draw Glyph"),id:"drawGlyph"}],{canPickMany:!1});if(o)switch(o.id){case"logTextureAtlasStats":i.invokeFunction(r=>{const a=r.get(Re),c=UD.atlas;if(!UD.atlas){a.error("No texture atlas found");return}const d=c.getStats();a.info(["Texture atlas stats",...d].join(`

`))});break;case"saveTextureAtlas":i.invokeFunction(async r=>{const a=r.get(It),c=r.get(je),d=a.getWorkspace().folders;if(d.length>0){const l=UD.atlas,u=[];for(const[g,m]of l.pages.entries())u.push(c.writeFile(R.joinPath(d[0].uri,`textureAtlasPage${g}_actual.png`),Le.wrap(new Uint8Array(await(await m.source.convertToBlob()).arrayBuffer()))),c.writeFile(R.joinPath(d[0].uri,`textureAtlasPage${g}_usage.png`),Le.wrap(new Uint8Array(await(await m.getUsagePreview()).arrayBuffer()))));await Promise.all(u)}});break;case"drawGlyph":i.invokeFunction(async r=>{const a=r.get(ne),c=r.get(je),d=r.get(Wt),u=r.get(It).getWorkspace().folders;if(u.length===0)return;const g=UD.atlas,m=a.getValue("editor.fontFamily"),v=a.getValue("editor.fontSize"),_=new LSe(v,m,Fp().devicePixelRatio);let w=await d.input({prompt:"Enter a character to draw (prefix with 0x for code point))"});if(!w)return;const C=w.match(/0x(?<codePoint>[0-9a-f]+)/i)?.groups?.codePoint;C!==void 0&&(w=String.fromCodePoint(parseInt(C,16)));const k=0,A=g.getGlyph(_,w,k,0,0);if(!A)return;const B=g.pages[A.pageIndex].source.getContext("2d")?.getImageData(A.x,A.y,A.w,A.h);if(!B)return;const q=new OffscreenCanvas(B.width,B.height);MSe(q.getContext("2d")).putImageData(B,0,0);const ie=await q.convertToBlob({type:"image/png"}),oe=R.joinPath(u[0].uri,`glyph_${w}_${k}_${v}px_${m.replaceAll(/[,\\\/\.'\s]/g,"_")}.png`);await c.writeFile(oe,Le.wrap(new Uint8Array(await ie.arrayBuffer())))});break}}}ue(g$e);Ve(DO);var Wd;(function(s){s.NoAutoFocus="noAutoFocus",s.FocusIfVisible="focusIfVisible",s.AutoFocusImmediately="autoFocusImmediately"})(Wd||(Wd={}));class p$e extends Se{constructor(){super({id:_de,label:I(1167,"Show or Focus Hover"),metadata:{description:I(1168,"Show or focus the editor hover which shows documentation, references, and other content for a symbol at the current cursor position."),args:[{name:"args",schema:{type:"object",properties:{focus:{description:"Controls if and when the hover should take focus upon being triggered by this action.",enum:[Wd.NoAutoFocus,Wd.FocusIfVisible,Wd.AutoFocusImmediately],enumDescriptions:[h(1169,"The hover will not automatically take focus."),h(1170,"The hover will take focus only if it is already visible."),h(1171,"The hover will automatically take focus when it appears.")],default:Wd.FocusIfVisible}}}}]},precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyI),weight:W.EditorContrib}})}run(e,t,i){if(!t.hasModel())return;const n=ws.get(t);if(!n)return;const o=i?.focus;let r=Wd.FocusIfVisible;Object.values(Wd).includes(o)?r=o:typeof o=="boolean"&&o&&(r=Wd.AutoFocusImmediately);const a=d=>{const l=t.getPosition(),u=new P(l.lineNumber,l.column,l.lineNumber,l.column);n.showContentHover(u,Ah.Immediate,al.Keyboard,d)},c=t.getOption(L.accessibilitySupport)===Ese.Enabled;n.isHoverVisible?r!==Wd.NoAutoFocus?n.focus():a(c):a(c||r===Wd.AutoFocusImmediately)}}class f$e extends Se{constructor(){super({id:qRe,label:I(1172,"Show Definition Preview Hover"),precondition:void 0,metadata:{description:I(1173,"Show the definition preview hover in the editor.")}})}run(e,t){const i=ws.get(t);if(!i)return;const n=t.getPosition();if(!n)return;const o=new P(n.lineNumber,n.column,n.lineNumber,n.column),r=$x.get(t);if(!r)return;r.startFindDefinitionFromCursor(n).then(()=>{i.showContentHover(o,Ah.Immediate,al.Keyboard,!0)})}}class m$e extends Se{constructor(){super({id:KRe,label:I(1174,"Hide Hover"),alias:"Hide Content Hover",precondition:void 0})}run(e,t){ws.get(t)?.hideContentHover()}}class v$e extends Se{constructor(){super({id:jRe,label:I(1175,"Scroll Up Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.UpArrow,weight:W.EditorContrib},metadata:{description:I(1176,"Scroll up the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.scrollUp()}}class _$e extends Se{constructor(){super({id:YRe,label:I(1177,"Scroll Down Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.DownArrow,weight:W.EditorContrib},metadata:{description:I(1178,"Scroll down the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.scrollDown()}}class b$e extends Se{constructor(){super({id:QRe,label:I(1179,"Scroll Left Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.LeftArrow,weight:W.EditorContrib},metadata:{description:I(1180,"Scroll left the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.scrollLeft()}}class y$e extends Se{constructor(){super({id:XRe,label:I(1181,"Scroll Right Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.RightArrow,weight:W.EditorContrib},metadata:{description:I(1182,"Scroll right the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.scrollRight()}}class w$e extends Se{constructor(){super({id:ZRe,label:I(1183,"Page Up Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.PageUp,secondary:[E.Alt|S.UpArrow],weight:W.EditorContrib},metadata:{description:I(1184,"Page up the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.pageUp()}}class S$e extends Se{constructor(){super({id:JRe,label:I(1185,"Page Down Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.PageDown,secondary:[E.Alt|S.DownArrow],weight:W.EditorContrib},metadata:{description:I(1186,"Page down the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.pageDown()}}class C$e extends Se{constructor(){super({id:ePe,label:I(1187,"Go To Top Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.Home,secondary:[E.CtrlCmd|S.UpArrow],weight:W.EditorContrib},metadata:{description:I(1188,"Go to the top of the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.goToTop()}}class E$e extends Se{constructor(){super({id:tPe,label:I(1189,"Go To Bottom Hover"),precondition:V.hoverFocused,kbOpts:{kbExpr:V.hoverFocused,primary:S.End,secondary:[E.CtrlCmd|S.DownArrow],weight:W.EditorContrib},metadata:{description:I(1190,"Go to the bottom of the editor hover.")}})}run(e,t){const i=ws.get(t);i&&i.goToBottom()}}class x$e extends Se{constructor(){super({id:eS,label:nPe,alias:"Increase Hover Verbosity Level",precondition:V.hoverVisible})}run(e,t,i){const n=ws.get(t);if(!n)return;const o=i?.index!==void 0?i.index:n.focusedHoverPartIndex();n.updateHoverVerbosityLevel(Os.Increase,o,i?.focus)}}class I$e extends Se{constructor(){super({id:tS,label:oPe,alias:"Decrease Hover Verbosity Level",precondition:V.hoverVisible})}run(e,t,i){const n=ws.get(t);if(!n)return;const o=i?.index!==void 0?i.index:n.focusedHoverPartIndex();ws.get(t)?.updateHoverVerbosityLevel(Os.Decrease,o,i?.focus)}}const xc=j;class D$e{constructor(e,t,i){this.owner=e,this.range=t,this.marker=i}isValidForHoverAnchor(e){return e.type===tr.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}const cie={type:jo.Invoke,filter:{include:pi.QuickFix},triggerAction:Lr.QuickFixHover};let kG=class{constructor(e,t,i,n){this._editor=e,this._markerDecorationsService=t,this._openerService=i,this._languageFeaturesService=n,this.hoverOrdinal=1,this.recentMarkerCodeActionsInfo=void 0}computeSync(e,t){if(!this._editor.hasModel()||e.type!==tr.Range&&!e.supportsMarkerHover)return[];const i=this._editor.getModel(),n=e.range.startLineNumber,o=i.getLineMaxColumn(n),r=[];for(const a of t){const c=a.range.startLineNumber===n?a.range.startColumn:1,d=a.range.endLineNumber===n?a.range.endColumn:o,l=this._markerDecorationsService.getMarker(i.uri,a);if(!l)continue;const u=new P(e.range.startLineNumber,c,e.range.startLineNumber,d);r.push(new D$e(this,u,l))}return r}renderHoverParts(e,t){if(!t.length)return new pv([]);const i=[];t.forEach(r=>{const a=this._renderMarkerHover(r);e.fragment.appendChild(a.hoverElement),i.push(a)});const n=t.length===1?t[0]:t.sort((r,a)=>Bn.compare(r.marker.severity,a.marker.severity))[0],o=this._renderMarkerStatusbar(e,n);return new pv(i,o)}getAccessibleContent(e){return e.marker.message}_renderMarkerHover(e){const t=new U,i=xc("div.hover-row"),n=ee(i,xc("div.marker.hover-contents")),{source:o,message:r,code:a,relatedInformation:c}=e.marker;this._editor.applyFontInfo(n);const d=ee(n,xc("span"));if(d.style.whiteSpace="pre-wrap",d.innerText=r,o||a)if(a&&typeof a!="string"){const u=xc("span");if(o){const _=ee(u,xc("span"));_.innerText=o}const g=ee(u,xc("a.code-link"));g.setAttribute("href",a.target.toString(!0)),t.add(re(g,"click",_=>{this._openerService.open(a.target,{allowCommands:!0}),_.preventDefault(),_.stopPropagation()}));const m=ee(g,xc("span"));m.innerText=a.value;const v=ee(n,u);v.style.opacity="0.6",v.style.paddingLeft="6px"}else{const u=ee(n,xc("span"));u.style.opacity="0.6",u.style.paddingLeft="6px",u.innerText=o&&a?`${o}(${a})`:o||`(${a})`}if(An(c))for(const{message:u,resource:g,startLineNumber:m,startColumn:v}of c){const _=ee(n,xc("div"));_.style.marginTop="8px";const w=ee(_,xc("a"));w.innerText=`${Qe(g)}(${m}, ${v}): `,w.style.cursor="pointer",t.add(re(w,"click",k=>{if(k.stopPropagation(),k.preventDefault(),this._openerService){const D={selection:{startLineNumber:m,startColumn:v}};this._openerService.open(g,{fromUserGesture:!0,editorOptions:D}).catch(mt)}}));const C=ee(_,xc("span"));C.innerText=u,this._editor.applyFontInfo(C)}return{hoverPart:e,hoverElement:i,dispose:()=>t.dispose()}}_renderMarkerStatusbar(e,t){const i=new U;if(t.marker.severity===Bn.Error||t.marker.severity===Bn.Warning||t.marker.severity===Bn.Info){const n=Dv.get(this._editor);n&&e.statusBar.addAction({label:h(1200,"View Problem"),commandId:ey.ID,run:()=>{e.hide(),n.showAtMarker(t.marker),this._editor.focus()}})}if(!this._editor.getOption(L.readOnly)){const n=e.statusBar.append(xc("div"));this.recentMarkerCodeActionsInfo&&(f8.makeKey(this.recentMarkerCodeActionsInfo.marker)===f8.makeKey(t.marker)?this.recentMarkerCodeActionsInfo.hasCodeActions||(n.textContent=h(1201,"No quick fixes available")):this.recentMarkerCodeActionsInfo=void 0);const o=this.recentMarkerCodeActionsInfo&&!this.recentMarkerCodeActionsInfo.hasCodeActions?F.None:Lp(()=>n.textContent=h(1202,"Checking for quick fixes..."),200,i);n.textContent||(n.textContent="");const r=this.getCodeActions(t.marker);i.add(Ie(()=>r.cancel())),r.then(a=>{if(o.dispose(),this.recentMarkerCodeActionsInfo={marker:t.marker,hasCodeActions:a.validActions.length>0},!this.recentMarkerCodeActionsInfo.hasCodeActions){a.dispose(),n.textContent=h(1201,"No quick fixes available");return}n.style.display="none";let c=!1;i.add(Ie(()=>{c||a.dispose()})),e.statusBar.addAction({label:h(1203,"Quick Fix..."),commandId:g5,run:l=>{c=!0;const u=Zp.get(this._editor),g=Bs(l);e.hide(),u?.showCodeActions(cie,a,{x:g.left,y:g.top,width:g.width,height:g.height})}});const d=a.validActions.find(l=>l.action.isAI);d&&e.statusBar.addAction({label:d.action.title,commandId:d.action.command?.id??"",run:()=>{Zp.get(this._editor)?.applyCodeAction(d,!1,!1,wu.FromProblemsHover)}})},mt)}return i}getCodeActions(e){return Tn(t=>wm(this._languageFeaturesService.codeActionProvider,this._editor.getModel(),new P(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn),cie,Qc.None,t))}};kG=f([p(1,Zye),p(2,mi),p(3,Ne)],kG);var lM;(function(s){s.increaseVerbosity=h(1163,"- The focused hover part verbosity level can be increased with the Increase Hover Verbosity command.",`<keybinding:${eS}>`),s.decreaseVerbosity=h(1164,"- The focused hover part verbosity level can be decreased with the Decrease Hover Verbosity command.",`<keybinding:${tS}>`)})(lM||(lM={}));class k$e{constructor(){this.type=fc.View,this.priority=95,this.name="hover",this.when=V.hoverFocused}getProvider(e){const t=e.get(Bt),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)throw new Error("No active or focused code editor");const n=ws.get(i);if(!n)return;const o=e.get(He);return e.get(Z).createInstance(A$e,o,i,n)}}class T$e{constructor(){this.priority=100,this.name="hover",this.type=fc.Help,this.when=V.hoverVisible}getProvider(e){const t=e.get(Bt),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)throw new Error("No active or focused code editor");const n=ws.get(i);if(n)return e.get(Z).createInstance(hpe,n)}}class lpe extends F{constructor(e){super(),this._hoverController=e,this.id=oa.Hover,this.verbositySettingKey="accessibility.verbosity.hover",this._onDidChangeContent=this._register(new M),this.onDidChangeContent=this._onDidChangeContent.event,this._focusedHoverPartIndex=-1}onOpen(){this._hoverController&&(this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!0,this._focusedHoverPartIndex=this._hoverController.focusedHoverPartIndex(),this._register(this._hoverController.onHoverContentsChanged(()=>{this._onDidChangeContent.fire()})))}onClose(){this._hoverController&&(this._focusedHoverPartIndex===-1?this._hoverController.focus():this._hoverController.focusHoverPartWithIndex(this._focusedHoverPartIndex),this._focusedHoverPartIndex=-1,this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!1)}provideContentAtIndex(e,t){if(e!==-1){const i=this._hoverController.getAccessibleWidgetContentAtIndex(e);if(i===void 0)return"";const n=[];return t&&n.push(...this._descriptionsOfVerbosityActionsForIndex(e)),n.push(i),n.join(`
`)}else{const i=this._hoverController.getAccessibleWidgetContent();if(i===void 0)return"";const n=[];return n.push(i),n.join(`
`)}}_descriptionsOfVerbosityActionsForIndex(e){const t=[],i=this._descriptionOfVerbosityActionForIndex(Os.Increase,e);i!==void 0&&t.push(i);const n=this._descriptionOfVerbosityActionForIndex(Os.Decrease,e);return n!==void 0&&t.push(n),t}_descriptionOfVerbosityActionForIndex(e,t){if(this._hoverController.doesHoverAtIndexSupportVerbosityAction(t,e))switch(e){case Os.Increase:return lM.increaseVerbosity;case Os.Decrease:return lM.decreaseVerbosity}}}class hpe extends lpe{constructor(e){super(e),this.options={type:fc.Help}}provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class A$e extends lpe{constructor(e,t,i){super(i),this._keybindingService=e,this._editor=t,this.options={type:fc.View},this._initializeOptions(this._editor,i)}provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!1)}get actions(){const e=[];return e.push(this._getActionFor(this._editor,Os.Increase)),e.push(this._getActionFor(this._editor,Os.Decrease)),e}_getActionFor(e,t){let i,n,o;switch(t){case Os.Increase:i=eS,n=iPe,o=K.add;break;case Os.Decrease:i=tS,n=sPe,o=K.remove;break}const r=kde(this._keybindingService,t),a=this._hoverController.doesHoverAtIndexSupportVerbosityAction(this._focusedHoverPartIndex,t);return new Xt(n,r,ke.asClassName(o),a,()=>{e.getAction(i)?.run({index:this._focusedHoverPartIndex,focus:!1})})}_initializeOptions(e,t){const i=this._register(new hpe(t));this.options.language=e.getModel()?.getLanguageId(),this.options.customHelp=()=>i.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class R$e{constructor(){this.type=fc.View,this.priority=90,this.name="extension-hover"}getProvider(e){const i=e.get(rf).getContextViewElement(),n=i?.textContent??void 0,o=e.get(Ti);if(!(i.classList.contains("accessible-view-container")||!n))return new Ige(oa.Hover,{language:"typescript",type:fc.View},()=>n,()=>{o.showAndFocusLastHover()},"accessibility.verbosity.hover")}}Ve(DO);Lt(ws.ID,ws,_t.BeforeFirstInteraction);Lt(qy.ID,qy,_t.BeforeFirstInteraction);ue(p$e);ue(f$e);ue(m$e);ue(v$e);ue(_$e);ue(b$e);ue(y$e);ue(w$e);ue(S$e);ue(C$e);ue(E$e);ue(x$e);ue(I$e);d_.register(fx);d_.register(kG);Fv((s,e)=>{const t=s.getColor(pse);t&&(e.addRule(`.monaco-editor .monaco-hover .hover-row:not(:first-child):not(:empty) { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-top: 1px solid ${t.transparent(.5)}; }`),e.addRule(`.monaco-editor .monaco-hover hr { border-bottom: 0px solid ${t.transparent(.5)}; }`))});CD.register(new k$e);CD.register(new T$e);CD.register(new R$e);function Yr(s,e){let t=0;for(let i=0;i<s.length;i++)s.charAt(i)==="	"?t+=e:t++;return t}function vE(s,e,t){s=s<0?0:s;let i="";if(!t){const n=Math.floor(s/e);s=s%e;for(let o=0;o<n;o++)i+="	"}for(let n=0;n<s;n++)i+=" ";return i}function upe(s,e,t,i){if(s.getLineCount()===1&&s.getLineMaxColumn(1)===1)return[];const n=e.getLanguageConfiguration(s.getLanguageId()).indentRulesSupport;if(!n)return[];const o=new NSe(s,n,e);for(i=Math.min(i,s.getLineCount());t<=i&&o.shouldIgnore(t);)t++;if(t>i-1)return[];const{tabSize:r,indentSize:a,insertSpaces:c}=s.getOptions(),d=(_,w)=>(w=w||1,my.shiftIndent(_,_.length+w,r,a,c)),l=(_,w)=>(w=w||1,my.unshiftIndent(_,_.length+w,r,a,c)),u=[],g=s.getLineContent(t);let m=lo(g),v=m;o.shouldIncrease(t)?(v=d(v),m=d(m)):o.shouldIndentNextLine(t)&&(v=d(v)),t++;for(let _=t;_<=i;_++){if(P$e(s,_))continue;const w=s.getLineContent(_),C=lo(w),k=v;o.shouldDecrease(_,k)&&(v=l(v),m=l(m)),C!==v&&u.push(qi.replaceMove(new at(_,1,_,C.length+1),Jye(v,a,c))),!o.shouldIgnore(_)&&(o.shouldIncrease(_,k)?(m=d(m),v=m):o.shouldIndentNextLine(_,k)?v=d(v):v=m)}return u}function P$e(s,e){return s.tokenization.isCheapToTokenize(e)?s.tokenization.getLineTokens(e).getStandardTokenType(0)===jc.String:!1}class B5 extends Se{static{this.ID="editor.action.indentationToSpaces"}constructor(){super({id:B5.ID,label:I(1206,"Convert Indentation to Spaces"),precondition:V.writable,metadata:{description:I(1207,"Convert the tab indentation to spaces.")}})}run(e,t){const i=t.getModel();if(!i)return;const n=i.getOptions(),o=t.getSelection();if(!o)return;const r=new F$e(o,n.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[r]),t.pushUndoStop(),i.updateOptions({insertSpaces:!0})}}class V5 extends Se{static{this.ID="editor.action.indentationToTabs"}constructor(){super({id:V5.ID,label:I(1208,"Convert Indentation to Tabs"),precondition:V.writable,metadata:{description:I(1209,"Convert the spaces indentation to tabs.")}})}run(e,t){const i=t.getModel();if(!i)return;const n=i.getOptions(),o=t.getSelection();if(!o)return;const r=new W$e(o,n.tabSize);t.pushUndoStop(),t.executeCommands(this.id,[r]),t.pushUndoStop(),i.updateOptions({insertSpaces:!1})}}class H5 extends Se{constructor(e,t,i){super(i),this.insertSpaces=e,this.displaySizeOnly=t}run(e,t){const i=e.get(Wt),n=e.get(ci),o=t.getModel();if(!o)return;const r=n.getCreationOptions(o.getLanguageId(),o.uri,o.isForSimpleWidget),a=o.getOptions(),c=[1,2,3,4,5,6,7,8].map(l=>({id:l.toString(),label:l.toString(),description:l===r.tabSize&&l===a.tabSize?h(1210,"Configured Tab Size"):l===r.tabSize?h(1211,"Default Tab Size"):l===a.tabSize?h(1212,"Current Tab Size"):void 0})),d=Math.min(o.getOptions().tabSize-1,7);setTimeout(()=>{i.pick(c,{placeHolder:h(1213,"Select Tab Size for Current File"),activeItem:c[d]}).then(l=>{if(l&&o&&!o.isDisposed()){const u=parseInt(l.label,10);this.displaySizeOnly?o.updateOptions({tabSize:u}):o.updateOptions({tabSize:u,indentSize:u,insertSpaces:this.insertSpaces})}})},50)}}class U5 extends H5{static{this.ID="editor.action.indentUsingTabs"}constructor(){super(!1,!1,{id:U5.ID,label:I(1214,"Indent Using Tabs"),precondition:void 0,metadata:{description:I(1215,"Use indentation with tabs.")}})}}class $5 extends H5{static{this.ID="editor.action.indentUsingSpaces"}constructor(){super(!0,!1,{id:$5.ID,label:I(1216,"Indent Using Spaces"),precondition:void 0,metadata:{description:I(1217,"Use indentation with spaces.")}})}}class G5 extends H5{static{this.ID="editor.action.changeTabDisplaySize"}constructor(){super(!0,!0,{id:G5.ID,label:I(1218,"Change Tab Display Size"),precondition:void 0,metadata:{description:I(1219,"Change the space size equivalent of the tab.")}})}}class z5 extends Se{static{this.ID="editor.action.detectIndentation"}constructor(){super({id:z5.ID,label:I(1220,"Detect Indentation from Content"),precondition:void 0,metadata:{description:I(1221,"Detect the indentation from content.")}})}run(e,t){const i=e.get(ci),n=t.getModel();if(!n)return;const o=i.getCreationOptions(n.getLanguageId(),n.uri,n.isForSimpleWidget);n.detectIndentation(o.insertSpaces,o.tabSize)}}class L$e extends Se{constructor(){super({id:"editor.action.reindentlines",label:I(1222,"Reindent Lines"),precondition:V.writable,metadata:{description:I(1223,"Reindent the lines of the editor.")}})}run(e,t){const i=e.get(ds),n=t.getModel();if(!n)return;const o=upe(n,i,1,n.getLineCount());o.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,o),t.pushUndoStop())}}class M$e extends Se{constructor(){super({id:"editor.action.reindentselectedlines",label:I(1224,"Reindent Selected Lines"),precondition:V.writable,metadata:{description:I(1225,"Reindent the selected lines of the editor.")}})}run(e,t){const i=e.get(ds),n=t.getModel();if(!n)return;const o=t.getSelections();if(o===null)return;const r=[];for(const a of o){let c=a.startLineNumber,d=a.endLineNumber;if(c!==d&&a.endColumn===1&&d--,c===1){if(c===d)continue}else c--;const l=upe(n,i,c,d);r.push(...l)}r.length>0&&(t.pushUndoStop(),t.executeEdits(this.id,r),t.pushUndoStop())}}class N$e{constructor(e,t){this._initialSelection=t,this._edits=[],this._selectionId=null;for(const i of e)i.range&&typeof i.text=="string"&&this._edits.push(i)}getEditOperations(e,t){for(const n of this._edits)t.addEditOperation(P.lift(n.range),n.text);let i=!1;Array.isArray(this._edits)&&this._edits.length===1&&this._initialSelection.isEmpty()&&(this._edits[0].range.startColumn===this._initialSelection.endColumn&&this._edits[0].range.startLineNumber===this._initialSelection.endLineNumber?(i=!0,this._selectionId=t.trackSelection(this._initialSelection,!0)):this._edits[0].range.endColumn===this._initialSelection.startColumn&&this._edits[0].range.endLineNumber===this._initialSelection.startLineNumber&&(i=!0,this._selectionId=t.trackSelection(this._initialSelection,!1))),i||(this._selectionId=t.trackSelection(this._initialSelection))}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}let hM=class{static{this.ID="editor.contrib.autoIndentOnPaste"}constructor(e,t){this.editor=e,this._languageConfigurationService=t,this.callOnDispose=new U,this.callOnModel=new U,this.callOnDispose.add(e.onDidChangeConfiguration(()=>this.update())),this.callOnDispose.add(e.onDidChangeModel(()=>this.update())),this.callOnDispose.add(e.onDidChangeModelLanguage(()=>this.update()))}update(){this.callOnModel.clear(),!(this.editor.getOption(L.autoIndent)<kse.Full||!this.editor.getOption(L.formatOnPaste))&&this.editor.hasModel()&&this.callOnModel.add(this.editor.onDidPaste(({range:e})=>{this.trigger(e)}))}trigger(e){const t=this.editor.getSelections();if(t===null||t.length>1)return;const i=this.editor.getModel();if(!i||this.rangeContainsOnlyWhitespaceCharacters(i,e)||O$e(i,e)||!i.tokenization.isCheapToTokenize(e.getStartPosition().lineNumber))return;const o=this.editor.getOption(L.autoIndent),{tabSize:r,indentSize:a,insertSpaces:c}=i.getOptions(),d=[],l={shiftIndent:v=>my.shiftIndent(v,v.length+1,r,a,c),unshiftIndent:v=>my.unshiftIndent(v,v.length+1,r,a,c)};let u=e.startLineNumber;for(;u<=e.endLineNumber;){if(this.shouldIgnoreLine(i,u)){u++;continue}break}if(u>e.endLineNumber)return;let g=i.getLineContent(u);if(!/\S/.test(g.substring(0,e.startColumn-1))){const v=yC(o,i,i.getLanguageId(),u,l,this._languageConfigurationService);if(v!==null){const _=lo(g),w=Yr(v,r),C=Yr(_,r);if(w!==C){const k=vE(w,r,c);d.push({range:new P(u,1,u,_.length+1),text:k}),g=k+g.substring(_.length)}else{const k=qse(i,u,this._languageConfigurationService);if(k===0||k===Kse.UNINDENT_MASK)return}}}const m=u;for(;u<e.endLineNumber;){if(!/\S/.test(i.getLineContent(u+1))){u++;continue}break}if(u!==e.endLineNumber){const _=yC(o,{tokenization:{getLineTokens:w=>i.tokenization.getLineTokens(w),getLanguageId:()=>i.getLanguageId(),getLanguageIdAtPosition:(w,C)=>i.getLanguageIdAtPosition(w,C)},getLineContent:w=>w===m?g:i.getLineContent(w)},i.getLanguageId(),u+1,l,this._languageConfigurationService);if(_!==null){const w=Yr(_,r),C=Yr(lo(i.getLineContent(u+1)),r);if(w!==C){const k=w-C;for(let D=u+1;D<=e.endLineNumber;D++){const A=i.getLineContent(D),B=lo(A),Q=Yr(B,r)+k,ie=vE(Q,r,c);ie!==B&&d.push({range:new P(D,1,D,B.length+1),text:ie})}}}}if(d.length>0){this.editor.pushUndoStop();const v=new N$e(d,this.editor.getSelection());this.editor.executeCommand("autoIndentOnPaste",v),this.editor.pushUndoStop()}}rangeContainsOnlyWhitespaceCharacters(e,t){const i=o=>o.trim().length===0;let n=!0;if(t.startLineNumber===t.endLineNumber){const r=e.getLineContent(t.startLineNumber).substring(t.startColumn-1,t.endColumn-1);n=i(r)}else for(let o=t.startLineNumber;o<=t.endLineNumber;o++){const r=e.getLineContent(o);if(o===t.startLineNumber){const a=r.substring(t.startColumn-1);n=i(a)}else if(o===t.endLineNumber){const a=r.substring(0,t.endColumn-1);n=i(a)}else n=e.getLineFirstNonWhitespaceColumn(o)===0;if(!n)break}return n}shouldIgnoreLine(e,t){e.tokenization.forceTokenization(t);const i=e.getLineFirstNonWhitespaceColumn(t);if(i===0)return!0;const n=e.tokenization.getLineTokens(t);if(n.getCount()>0){const o=n.findTokenIndexAtOffset(i);if(o>=0&&n.getStandardTokenType(o)===jc.Comment)return!0}return!1}dispose(){this.callOnDispose.dispose(),this.callOnModel.dispose()}};hM=f([p(1,ds)],hM);function O$e(s,e){const t=i=>ewe(s,i)===jc.String;return t(e.getStartPosition())||t(e.getEndPosition())}function gpe(s,e,t,i){if(s.getLineCount()===1&&s.getLineMaxColumn(1)===1)return;let n="";for(let r=0;r<t;r++)n+=" ";const o=new RegExp(n,"gi");for(let r=1,a=s.getLineCount();r<=a;r++){let c=s.getLineFirstNonWhitespaceColumn(r);if(c===0&&(c=s.getLineMaxColumn(r)),c===1)continue;const d=new P(r,1,r,c),l=s.getValueInRange(d),u=i?l.replace(/\t/ig,n):l.replace(o,"	");e.addEditOperation(d,u)}}class F$e{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),gpe(e,t,this.tabSize,!0)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}}class W$e{constructor(e,t){this.selection=e,this.tabSize=t,this.selectionId=null}getEditOperations(e,t){this.selectionId=t.trackSelection(this.selection),gpe(e,t,this.tabSize,!1)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}}Lt(hM.ID,hM,_t.BeforeFirstInteraction);ue(B5);ue(V5);ue(U5);ue($5);ue(G5);ue(z5);ue(L$e);ue(M$e);Lt(Iy.ID,Iy,_t.AfterFirstRender);d_.register(eP);class B$e{constructor(e,t,i){this._editRange=e,this._originalSelection=t,this._text=i}getEditOperations(e,t){t.addTrackedEditOperation(this._editRange,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return this._originalSelection.isEmpty()?new at(n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn),n.endLineNumber,Math.min(this._originalSelection.positionColumn,n.endColumn)):new at(n.endLineNumber,n.endColumn-this._text.length,n.endLineNumber,n.endColumn)}}const V$e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var DT;Ve(V$e);let aw=class{static{DT=this}static{this.ID="editor.contrib.inPlaceReplaceController"}static get(e){return e.getContribution(DT.ID)}static{this.DECORATION=Zt.register({description:"in-place-replace",className:"valueSetReplacement"})}constructor(e,t){this.editor=e,this.editorWorkerService=t,this.decorations=this.editor.createDecorationsCollection()}dispose(){}run(e,t){this.currentRequest?.cancel();const i=this.editor.getSelection(),n=this.editor.getModel();if(!n||!i)return;let o=i;if(o.startLineNumber!==o.endLineNumber)return;const r=new hN(this.editor,fs.Value|fs.Position),a=n.uri;return this.editorWorkerService.canNavigateValueSet(a)?(this.currentRequest=Tn(c=>this.editorWorkerService.navigateValueSet(a,o,t)),this.currentRequest.then(c=>{if(!c||!c.range||!c.value||!r.validate(this.editor))return;const d=P.lift(c.range);let l=c.range;const u=c.value.length-(o.endColumn-o.startColumn);l={startLineNumber:l.startLineNumber,startColumn:l.startColumn,endLineNumber:l.endLineNumber,endColumn:l.startColumn+c.value.length},u>1&&(o=new at(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn+u-1));const g=new B$e(d,o,c.value);this.editor.pushUndoStop(),this.editor.executeCommand(e,g),this.editor.pushUndoStop(),this.decorations.set([{range:l,options:DT.DECORATION}]),this.decorationRemover?.cancel(),this.decorationRemover=Da(350),this.decorationRemover.then(()=>this.decorations.clear()).catch(mt)}).catch(mt)):Promise.resolve(void 0)}};aw=DT=f([p(1,vc)],aw);class H$e extends Se{constructor(){super({id:"editor.action.inPlaceReplace.up",label:I(1204,"Replace with Previous Value"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Comma,weight:W.EditorContrib}})}run(e,t){const i=aw.get(t);return i?i.run(this.id,!1):Promise.resolve(void 0)}}class U$e extends Se{constructor(){super({id:"editor.action.inPlaceReplace.down",label:I(1205,"Replace with Next Value"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Period,weight:W.EditorContrib}})}run(e,t){const i=aw.get(t);return i?i.run(this.id,!0):Promise.resolve(void 0)}}Lt(aw.ID,aw,_t.Lazy);ue(H$e);ue(U$e);class $$e{constructor(e){this._selection=e,this._selectionId=null}getEditOperations(e,t){const i=G$e(e);i&&t.addEditOperation(i.range,i.text),this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function G$e(s){const e=s.getLineCount(),t=s.getLineContent(e),i=Lb(t)===-1;if(!(!e||i))return qi.insert(new we(e,s.getLineMaxColumn(e)),s.getEOL())}class q5 extends Se{static{this.ID="editor.action.insertFinalNewLine"}constructor(){super({id:q5.ID,label:I(1298,"Insert Final New Line"),precondition:V.writable})}run(e,t,i){const n=t.getSelection();if(n===null)return;const o=new $$e(n);t.pushUndoStop(),t.executeCommands(this.id,[o]),t.pushUndoStop()}}ue(q5);class z$e extends Se{constructor(){super({id:"expandLineSelection",label:I(1299,"Expand Line Selection"),precondition:void 0,kbOpts:{weight:W.EditorCore,kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.KeyL}})}run(e,t,i){if(i=i||{},!t.hasModel())return;const n=t._getViewModel();n.model.pushStackElement(),n.setCursorStates(i.source,Ws.Explicit,oq.expandLineSelection(n,n.getCursorStates())),n.revealAllCursors(i.source,!0)}}ue(z$e);class ppe{constructor(e,t,i){this._selection=e,this._isCopyingDown=t,this._noop=i||!1,this._selectionDirection=twe.LTR,this._selectionId=null,this._startLineNumberDelta=0,this._endLineNumberDelta=0}getEditOperations(e,t){let i=this._selection;this._startLineNumberDelta=0,this._endLineNumberDelta=0,i.startLineNumber<i.endLineNumber&&i.endColumn===1&&(this._endLineNumberDelta=1,i=i.setEndPosition(i.endLineNumber-1,e.getLineMaxColumn(i.endLineNumber-1)));const n=[];for(let r=i.startLineNumber;r<=i.endLineNumber;r++)n.push(e.getLineContent(r));const o=n.join(`
`);o===""&&this._isCopyingDown&&(this._startLineNumberDelta++,this._endLineNumberDelta++),this._noop?t.addEditOperation(new P(i.endLineNumber,e.getLineMaxColumn(i.endLineNumber),i.endLineNumber+1,1),i.endLineNumber===e.getLineCount()?"":`
`):this._isCopyingDown?t.addEditOperation(new P(i.startLineNumber,1,i.startLineNumber,1),o+`
`):t.addEditOperation(new P(i.endLineNumber,e.getLineMaxColumn(i.endLineNumber),i.endLineNumber,e.getLineMaxColumn(i.endLineNumber)),`
`+o),this._selectionId=t.trackSelection(i),this._selectionDirection=this._selection.getDirection()}computeCursorState(e,t){let i=t.getTrackedSelection(this._selectionId);if(this._startLineNumberDelta!==0||this._endLineNumberDelta!==0){let n=i.startLineNumber,o=i.startColumn,r=i.endLineNumber,a=i.endColumn;this._startLineNumberDelta!==0&&(n=n+this._startLineNumberDelta,o=1),this._endLineNumberDelta!==0&&(r=r+this._endLineNumberDelta,a=1),i=at.createWithDirection(n,o,r,a,this._selectionDirection)}return i}}let TG=class{constructor(e,t,i,n){this._languageConfigurationService=n,this._selection=e,this._isMovingDown=t,this._autoIndent=i,this._selectionId=null,this._moveEndLineSelectionShrink=!1}getEditOperations(e,t){const i=()=>e.getLanguageId(),n=(u,g)=>e.getLanguageIdAtPosition(u,g),o=e.getLineCount();if(this._isMovingDown&&this._selection.endLineNumber===o){this._selectionId=t.trackSelection(this._selection);return}if(!this._isMovingDown&&this._selection.startLineNumber===1){this._selectionId=t.trackSelection(this._selection);return}this._moveEndPositionDown=!1;let r=this._selection;r.startLineNumber<r.endLineNumber&&r.endColumn===1&&(this._moveEndPositionDown=!0,r=r.setEndPosition(r.endLineNumber-1,e.getLineMaxColumn(r.endLineNumber-1)));const{tabSize:a,indentSize:c,insertSpaces:d}=e.getOptions(),l=this.buildIndentConverter(a,c,d);if(r.startLineNumber===r.endLineNumber&&e.getLineMaxColumn(r.startLineNumber)===1){const u=r.startLineNumber,g=this._isMovingDown?u+1:u-1;e.getLineMaxColumn(g)===1?t.addEditOperation(new P(1,1,1,1),null):(t.addEditOperation(new P(u,1,u,1),e.getLineContent(g)),t.addEditOperation(new P(g,1,g,e.getLineMaxColumn(g)),null)),r=new at(g,1,g,1)}else{let u,g;if(this._isMovingDown){u=r.endLineNumber+1,g=e.getLineContent(u),t.addEditOperation(new P(u-1,e.getLineMaxColumn(u-1),u,e.getLineMaxColumn(u)),null);let m=g;if(this.shouldAutoIndent(e,r)){const v=this.matchEnterRule(e,l,a,u,r.startLineNumber-1);if(v!==null){const w=lo(e.getLineContent(u)),C=v+Yr(w,a);m=vE(C,a,d)+this.trimStart(g)}else{const w={tokenization:{getLineTokens:k=>k===r.startLineNumber?e.tokenization.getLineTokens(u):e.tokenization.getLineTokens(k),getLanguageId:i,getLanguageIdAtPosition:n},getLineContent:k=>k===r.startLineNumber?e.getLineContent(u):e.getLineContent(k)},C=yC(this._autoIndent,w,e.getLanguageIdAtPosition(u,1),r.startLineNumber,l,this._languageConfigurationService);if(C!==null){const k=lo(e.getLineContent(u)),D=Yr(C,a),A=Yr(k,a);D!==A&&(m=vE(D,a,d)+this.trimStart(g))}}t.addEditOperation(new P(r.startLineNumber,1,r.startLineNumber,1),m+`
`);const _=this.matchEnterRuleMovingDown(e,l,a,r.startLineNumber,u,m);if(_!==null)_!==0&&this.getIndentEditsOfMovingBlock(e,t,r,a,d,_);else{const w={tokenization:{getLineTokens:k=>k===r.startLineNumber?e.tokenization.getLineTokens(u):k>=r.startLineNumber+1&&k<=r.endLineNumber+1?e.tokenization.getLineTokens(k-1):e.tokenization.getLineTokens(k),getLanguageId:i,getLanguageIdAtPosition:n},getLineContent:k=>k===r.startLineNumber?m:k>=r.startLineNumber+1&&k<=r.endLineNumber+1?e.getLineContent(k-1):e.getLineContent(k)},C=yC(this._autoIndent,w,e.getLanguageIdAtPosition(u,1),r.startLineNumber+1,l,this._languageConfigurationService);if(C!==null){const k=lo(e.getLineContent(r.startLineNumber)),D=Yr(C,a),A=Yr(k,a);if(D!==A){const B=D-A;this.getIndentEditsOfMovingBlock(e,t,r,a,d,B)}}}}else t.addEditOperation(new P(r.startLineNumber,1,r.startLineNumber,1),m+`
`)}else if(u=r.startLineNumber-1,g=e.getLineContent(u),t.addEditOperation(new P(u,1,u+1,1),null),t.addEditOperation(new P(r.endLineNumber,e.getLineMaxColumn(r.endLineNumber),r.endLineNumber,e.getLineMaxColumn(r.endLineNumber)),`
`+g),this.shouldAutoIndent(e,r)){const m={tokenization:{getLineTokens:_=>_===u?e.tokenization.getLineTokens(r.startLineNumber):e.tokenization.getLineTokens(_),getLanguageId:i,getLanguageIdAtPosition:n},getLineContent:_=>_===u?e.getLineContent(r.startLineNumber):e.getLineContent(_)},v=this.matchEnterRule(e,l,a,r.startLineNumber,r.startLineNumber-2);if(v!==null)v!==0&&this.getIndentEditsOfMovingBlock(e,t,r,a,d,v);else{const _=yC(this._autoIndent,m,e.getLanguageIdAtPosition(r.startLineNumber,1),u,l,this._languageConfigurationService);if(_!==null){const w=lo(e.getLineContent(r.startLineNumber)),C=Yr(_,a),k=Yr(w,a);if(C!==k){const D=C-k;this.getIndentEditsOfMovingBlock(e,t,r,a,d,D)}}}}}this._selectionId=t.trackSelection(r)}buildIndentConverter(e,t,i){return{shiftIndent:n=>my.shiftIndent(n,n.length+1,e,t,i),unshiftIndent:n=>my.unshiftIndent(n,n.length+1,e,t,i)}}parseEnterResult(e,t,i,n,o){if(o){let r=o.indentation;o.indentAction===$D.None||o.indentAction===$D.Indent?r=o.indentation+o.appendText:o.indentAction===$D.IndentOutdent?r=o.indentation:o.indentAction===$D.Outdent&&(r=t.unshiftIndent(o.indentation)+o.appendText);const a=e.getLineContent(n);if(this.trimStart(a).indexOf(this.trimStart(r))>=0){const c=lo(e.getLineContent(n));let d=lo(r);const l=qse(e,n,this._languageConfigurationService);l!==null&&l&Kse.DECREASE_MASK&&(d=t.unshiftIndent(d));const u=Yr(d,i),g=Yr(c,i);return u-g}}return null}matchEnterRuleMovingDown(e,t,i,n,o,r){if(Lb(r)>=0){const a=e.getLineMaxColumn(o),c=c1(this._autoIndent,e,new P(o,a,o,a),this._languageConfigurationService);return this.parseEnterResult(e,t,i,n,c)}else{let a=n-1;for(;a>=1;){const l=e.getLineContent(a);if(Lb(l)>=0)break;a--}if(a<1||n>e.getLineCount())return null;const c=e.getLineMaxColumn(a),d=c1(this._autoIndent,e,new P(a,c,a,c),this._languageConfigurationService);return this.parseEnterResult(e,t,i,n,d)}}matchEnterRule(e,t,i,n,o,r){let a=o;for(;a>=1;){let l;if(a===o&&r!==void 0?l=r:l=e.getLineContent(a),Lb(l)>=0)break;a--}if(a<1||n>e.getLineCount())return null;const c=e.getLineMaxColumn(a),d=c1(this._autoIndent,e,new P(a,c,a,c),this._languageConfigurationService);return this.parseEnterResult(e,t,i,n,d)}trimStart(e){return e.replace(/^\s+/,"")}shouldAutoIndent(e,t){if(this._autoIndent<kse.Full||!e.tokenization.isCheapToTokenize(t.startLineNumber))return!1;const i=e.getLanguageIdAtPosition(t.startLineNumber,1),n=e.getLanguageIdAtPosition(t.endLineNumber,1);return!(i!==n||this._languageConfigurationService.getLanguageConfiguration(i).indentRulesSupport===null)}getIndentEditsOfMovingBlock(e,t,i,n,o,r){for(let a=i.startLineNumber;a<=i.endLineNumber;a++){const c=e.getLineContent(a),d=lo(c),u=Yr(d,n)+r,g=vE(u,n,o);g!==d&&(t.addEditOperation(new P(a,1,a,d.length+1),g),a===i.endLineNumber&&i.endColumn<=d.length+1&&g===""&&(this._moveEndLineSelectionShrink=!0))}}computeCursorState(e,t){let i=t.getTrackedSelection(this._selectionId);return this._moveEndPositionDown&&(i=i.setEndPosition(i.endLineNumber+1,1)),this._moveEndLineSelectionShrink&&i.startLineNumber<i.endLineNumber&&(i=i.setEndPosition(i.endLineNumber,2)),i}};TG=f([p(3,ds)],TG);class $m{static{this._COLLATOR=null}static getCollator(){return $m._COLLATOR||($m._COLLATOR=new Intl.Collator),$m._COLLATOR}constructor(e,t){this.selection=e,this.descending=t,this.selectionId=null}getEditOperations(e,t){const i=q$e(e,this.selection,this.descending);i&&t.addEditOperation(i.range,i.text),this.selectionId=t.trackSelection(this.selection)}computeCursorState(e,t){return t.getTrackedSelection(this.selectionId)}static canRun(e,t,i){if(e===null)return!1;const n=fpe(e,t,i);if(!n)return!1;for(let o=0,r=n.before.length;o<r;o++)if(n.before[o]!==n.after[o])return!0;return!1}}function fpe(s,e,t){const i=e.startLineNumber;let n=e.endLineNumber;if(e.endColumn===1&&n--,i>=n)return null;const o=[];for(let a=i;a<=n;a++)o.push(s.getLineContent(a));let r=o.slice(0);return r.sort($m.getCollator().compare),t===!0&&(r=r.reverse()),{startLineNumber:i,endLineNumber:n,before:o,after:r}}function q$e(s,e,t){const i=fpe(s,e,t);return i?qi.replace(new P(i.startLineNumber,1,i.endLineNumber,s.getLineMaxColumn(i.endLineNumber)),i.after.join(`
`)):null}class mpe extends Se{constructor(e,t){super(t),this.down=e}run(e,t){if(!t.hasModel())return;const i=t.getSelections().map((r,a)=>({selection:r,index:a,ignore:!1}));i.sort((r,a)=>P.compareRangesUsingStarts(r.selection,a.selection));let n=i[0];for(let r=1;r<i.length;r++){const a=i[r];n.selection.endLineNumber===a.selection.startLineNumber&&(n.index<a.index?a.ignore=!0:(n.ignore=!0,n=a))}const o=[];for(const r of i)o.push(new ppe(r.selection,this.down,r.ignore));t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class K$e extends mpe{constructor(){super(!1,{id:"editor.action.copyLinesUpAction",label:I(1300,"Copy Line Up"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|E.Shift|S.UpArrow,linux:{primary:E.CtrlCmd|E.Alt|E.Shift|S.UpArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1301,"&&Copy Line Up"),order:1}})}}class j$e extends mpe{constructor(){super(!0,{id:"editor.action.copyLinesDownAction",label:I(1302,"Copy Line Down"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|E.Shift|S.DownArrow,linux:{primary:E.CtrlCmd|E.Alt|E.Shift|S.DownArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1303,"Co&&py Line Down"),order:2}})}}class Y$e extends Se{constructor(){super({id:"editor.action.duplicateSelection",label:I(1304,"Duplicate Selection"),precondition:V.writable,menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1305,"&&Duplicate Selection"),order:5}})}run(e,t,i){if(!t.hasModel())return;const n=[],o=t.getSelections(),r=t.getModel();for(const a of o)if(a.isEmpty())n.push(new ppe(a,!0));else{const c=new at(a.endLineNumber,a.endColumn,a.endLineNumber,a.endColumn);n.push(new OSe(c,r.getValueInRange(a)))}t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop()}}class vpe extends Se{constructor(e,t){super(t),this.down=e}run(e,t){const i=e.get(ds),n=[],o=t.getSelections()||[],r=t.getOption(L.autoIndent);for(const a of o)n.push(new TG(a,this.down,r,i));t.pushUndoStop(),t.executeCommands(this.id,n),t.pushUndoStop()}}class Q$e extends vpe{constructor(){super(!1,{id:"editor.action.moveLinesUpAction",label:I(1306,"Move Line Up"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|S.UpArrow,linux:{primary:E.Alt|S.UpArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1307,"Mo&&ve Line Up"),order:3}})}}class X$e extends vpe{constructor(){super(!0,{id:"editor.action.moveLinesDownAction",label:I(1308,"Move Line Down"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Alt|S.DownArrow,linux:{primary:E.Alt|S.DownArrow},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"2_line",title:h(1309,"Move &&Line Down"),order:4}})}}class _pe extends Se{constructor(e,t){super(t),this.descending=e}run(e,t){if(!t.hasModel())return;const i=t.getModel();let n=t.getSelections();n.length===1&&n[0].isEmpty()&&(n=[new at(1,1,i.getLineCount(),i.getLineMaxColumn(i.getLineCount()))]);for(const r of n)if(!$m.canRun(t.getModel(),r,this.descending))return;const o=[];for(let r=0,a=n.length;r<a;r++)o[r]=new $m(n[r],this.descending);t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class Z$e extends _pe{constructor(){super(!1,{id:"editor.action.sortLinesAscending",label:I(1310,"Sort Lines Ascending"),precondition:V.writable})}}class J$e extends _pe{constructor(){super(!0,{id:"editor.action.sortLinesDescending",label:I(1311,"Sort Lines Descending"),precondition:V.writable})}}class e3e extends Se{constructor(){super({id:"editor.action.removeDuplicateLines",label:I(1312,"Delete Duplicate Lines"),precondition:V.writable})}run(e,t){if(!t.hasModel())return;const i=t.getModel();if(i.getLineCount()===1&&i.getLineMaxColumn(1)===1)return;const n=[],o=[];let r=0,a=!0,c=t.getSelections();c.length===1&&c[0].isEmpty()&&(c=[new at(1,1,i.getLineCount(),i.getLineMaxColumn(i.getLineCount()))],a=!1);for(const d of c){const l=new Set,u=[];for(let _=d.startLineNumber;_<=d.endLineNumber;_++){const w=i.getLineContent(_);l.has(w)||(u.push(w),l.add(w))}const g=new at(d.startLineNumber,1,d.endLineNumber,i.getLineMaxColumn(d.endLineNumber)),m=d.startLineNumber-r,v=new at(m,1,m+u.length-1,u[u.length-1].length);n.push(qi.replace(g,u.join(`
`))),o.push(v),r+=d.endLineNumber-d.startLineNumber+1-u.length}t.pushUndoStop(),t.executeEdits(this.id,n,a?o:void 0),t.pushUndoStop()}}class K5 extends Se{static{this.ID="editor.action.trimTrailingWhitespace"}constructor(){super({id:K5.ID,label:I(1313,"Trim Trailing Whitespace"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyX),weight:W.EditorContrib}})}run(e,t,i){let n=[];i.reason==="auto-save"&&(n=(t.getSelections()||[]).map(l=>new we(l.positionLineNumber,l.positionColumn)));const o=t.getSelection();if(o===null)return;const r=e.get(ne),a=t.getModel(),c=r.getValue("files.trimTrailingWhitespaceInRegexAndStrings",{overrideIdentifier:a?.getLanguageId(),resource:a?.uri}),d=new UHe(o,n,c);t.pushUndoStop(),t.executeCommands(this.id,[d]),t.pushUndoStop()}}class t3e extends Se{constructor(){super({id:"editor.action.deleteLines",label:I(1314,"Delete Line"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|E.Shift|S.KeyK,weight:W.EditorContrib}})}run(e,t){if(!t.hasModel())return;const i=this._getLinesToRemove(t),n=t.getModel();if(n.getLineCount()===1&&n.getLineMaxColumn(1)===1)return;let o=0;const r=[],a=[];for(let c=0,d=i.length;c<d;c++){const l=i[c];let u=l.startLineNumber,g=l.endLineNumber,m=1,v=n.getLineMaxColumn(g);g<n.getLineCount()?(g+=1,v=1):u>1&&(u-=1,m=n.getLineMaxColumn(u)),r.push(qi.replace(new at(u,m,g,v),"")),a.push(new at(u-o,l.positionColumn,u-o,l.positionColumn)),o+=l.endLineNumber-l.startLineNumber+1}t.pushUndoStop(),t.executeEdits(this.id,r,a),t.pushUndoStop()}_getLinesToRemove(e){const t=e.getSelections().map(o=>{let r=o.endLineNumber;return o.startLineNumber<o.endLineNumber&&o.endColumn===1&&(r-=1),{startLineNumber:o.startLineNumber,selectionStartColumn:o.selectionStartColumn,endLineNumber:r,positionColumn:o.positionColumn}});t.sort((o,r)=>o.startLineNumber===r.startLineNumber?o.endLineNumber-r.endLineNumber:o.startLineNumber-r.startLineNumber);const i=[];let n=t[0];for(let o=1;o<t.length;o++)n.endLineNumber+1>=t[o].startLineNumber?n.endLineNumber=t[o].endLineNumber:(i.push(n),n=t[o]);return i.push(n),i}}class i3e extends Se{constructor(){super({id:"editor.action.indentLines",label:I(1315,"Indent Line"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.BracketRight,weight:W.EditorContrib}})}run(e,t){const i=t._getViewModel();i&&(t.pushUndoStop(),t.executeCommands(this.id,FSe.indent(i.cursorConfig,t.getModel(),t.getSelections())),t.pushUndoStop())}}class n3e extends Se{constructor(){super({id:"editor.action.outdentLines",label:I(1316,"Outdent Line"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.BracketLeft,weight:W.EditorContrib}})}run(e,t){Ok.Outdent.runEditorCommand(e,t,null)}}class s3e extends Se{constructor(){super({id:"editor.action.insertLineBefore",label:I(1317,"Insert Line Above"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Enter,weight:W.EditorContrib}})}run(e,t){const i=t._getViewModel();i&&(t.pushUndoStop(),t.executeCommands(this.id,jse.lineInsertBefore(i.cursorConfig,t.getModel(),t.getSelections())))}}class o3e extends Se{constructor(){super({id:"editor.action.insertLineAfter",label:I(1318,"Insert Line Below"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.Enter,weight:W.EditorContrib}})}run(e,t){const i=t._getViewModel();i&&(t.pushUndoStop(),t.executeCommands(this.id,jse.lineInsertAfter(i.cursorConfig,t.getModel(),t.getSelections())))}}class bpe extends Se{run(e,t){if(!t.hasModel())return;const i=t.getSelection(),n=this._getRangesToDelete(t),o=[];for(let c=0,d=n.length-1;c<d;c++){const l=n[c],u=n[c+1];P.intersectRanges(l,u)===null?o.push(l):n[c+1]=P.plusRange(l,u)}o.push(n[n.length-1]);const r=this._getEndCursorState(i,o),a=o.map(c=>qi.replace(c,""));t.pushUndoStop(),t.executeEdits(this.id,a,r),t.pushUndoStop()}}class r3e extends bpe{constructor(){super({id:"deleteAllLeft",label:I(1319,"Delete All Left"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.CtrlCmd|S.Backspace},weight:W.EditorContrib}})}_getEndCursorState(e,t){let i=null;const n=[];let o=0;return t.forEach(r=>{let a;if(r.endColumn===1&&o>0){const c=r.startLineNumber-o;a=new at(c,r.startColumn,c,r.startColumn)}else a=new at(r.startLineNumber,r.startColumn,r.startLineNumber,r.startColumn);o+=r.endLineNumber-r.startLineNumber,r.intersectRanges(e)?i=a:n.push(a)}),i&&n.unshift(i),n}_getRangesToDelete(e){const t=e.getSelections();if(t===null)return[];let i=t;const n=e.getModel();return n===null?[]:(i.sort(P.compareRangesUsingStarts),i=i.map(o=>{if(o.isEmpty())if(o.startColumn===1){const r=Math.max(1,o.startLineNumber-1),a=o.startLineNumber===1?1:n.getLineLength(r)+1;return new P(r,a,o.startLineNumber,1)}else return new P(o.startLineNumber,1,o.startLineNumber,o.startColumn);else return new P(o.startLineNumber,1,o.endLineNumber,o.endColumn)}),i)}}class a3e extends bpe{constructor(){super({id:"deleteAllRight",label:I(1320,"Delete All Right"),precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|S.KeyK,secondary:[E.CtrlCmd|S.Delete]},weight:W.EditorContrib}})}_getEndCursorState(e,t){let i=null;const n=[];for(let o=0,r=t.length,a=0;o<r;o++){const c=t[o],d=new at(c.startLineNumber-a,c.startColumn,c.startLineNumber-a,c.startColumn);c.intersectRanges(e)?i=d:n.push(d)}return i&&n.unshift(i),n}_getRangesToDelete(e){const t=e.getModel();if(t===null)return[];const i=e.getSelections();if(i===null)return[];const n=i.map(o=>{if(o.isEmpty()){const r=t.getLineMaxColumn(o.startLineNumber);return o.startColumn===r?new P(o.startLineNumber,o.startColumn,o.startLineNumber+1,1):new P(o.startLineNumber,o.startColumn,o.startLineNumber,r)}return o});return n.sort(P.compareRangesUsingStarts),n}}class c3e extends Se{constructor(){super({id:"editor.action.joinLines",label:I(1321,"Join Lines"),precondition:V.writable,kbOpts:{kbExpr:V.editorTextFocus,primary:0,mac:{primary:E.WinCtrl|S.KeyJ},weight:W.EditorContrib}})}run(e,t){const i=t.getSelections();if(i===null)return;let n=t.getSelection();if(n===null)return;i.sort(P.compareRangesUsingStarts);const o=[],r=i.reduce((g,m)=>g.isEmpty()?g.endLineNumber===m.startLineNumber?(n.equalsSelection(g)&&(n=m),m):m.startLineNumber>g.endLineNumber+1?(o.push(g),m):new at(g.startLineNumber,g.startColumn,m.endLineNumber,m.endColumn):m.startLineNumber>g.endLineNumber?(o.push(g),m):new at(g.startLineNumber,g.startColumn,m.endLineNumber,m.endColumn));o.push(r);const a=t.getModel();if(a===null)return;const c=[],d=[];let l=n,u=0;for(let g=0,m=o.length;g<m;g++){const v=o[g],_=v.startLineNumber,w=1;let C=0,k,D;const A=a.getLineLength(v.endLineNumber)-v.endColumn;if(v.isEmpty()||v.startLineNumber===v.endLineNumber){const Q=v.getStartPosition();Q.lineNumber<a.getLineCount()?(k=_+1,D=a.getLineMaxColumn(k)):(k=Q.lineNumber,D=a.getLineMaxColumn(Q.lineNumber))}else k=v.endLineNumber,D=a.getLineMaxColumn(k);let B=a.getLineContent(_);for(let Q=_+1;Q<=k;Q++){const ie=a.getLineContent(Q),oe=a.getLineFirstNonWhitespaceColumn(Q);if(oe>=1){let be=!0;B===""&&(be=!1),be&&(B.charAt(B.length-1)===" "||B.charAt(B.length-1)==="	")&&(be=!1,B=B.replace(/[\s\uFEFF\xA0]+$/g," "));const me=ie.substr(oe-1);B+=(be?" ":"")+me,be?C=me.length+1:C=me.length}else C=0}const q=new P(_,w,k,D);if(!q.isEmpty()){let Q;v.isEmpty()?(c.push(qi.replace(q,B)),Q=new at(q.startLineNumber-u,B.length-C+1,_-u,B.length-C+1)):v.startLineNumber===v.endLineNumber?(c.push(qi.replace(q,B)),Q=new at(v.startLineNumber-u,v.startColumn,v.endLineNumber-u,v.endColumn)):(c.push(qi.replace(q,B)),Q=new at(v.startLineNumber-u,v.startColumn,v.startLineNumber-u,B.length-A)),P.intersectRanges(q,n)!==null?l=Q:d.push(Q)}u+=q.endLineNumber-q.startLineNumber}d.unshift(l),t.pushUndoStop(),t.executeEdits(this.id,c,d),t.pushUndoStop()}}class d3e extends Se{constructor(){super({id:"editor.action.transpose",label:I(1322,"Transpose Characters around the Cursor"),precondition:V.writable})}run(e,t){const i=t.getSelections();if(i===null)return;const n=t.getModel();if(n===null)return;const o=[];for(let r=0,a=i.length;r<a;r++){const c=i[r];if(!c.isEmpty())continue;const d=c.getStartPosition(),l=n.getLineMaxColumn(d.lineNumber);if(d.column>=l){if(d.lineNumber===n.getLineCount())continue;const u=new P(d.lineNumber,Math.max(1,d.column-1),d.lineNumber+1,1),g=n.getValueInRange(u).split("").reverse().join("");o.push(new pI(new at(d.lineNumber,Math.max(1,d.column-1),d.lineNumber+1,1),g))}else{const u=new P(d.lineNumber,Math.max(1,d.column-1),d.lineNumber,d.column+1),g=n.getValueInRange(u).split("").reverse().join("");o.push(new zse(u,g,new at(d.lineNumber,d.column+1,d.lineNumber,d.column+1)))}}t.pushUndoStop(),t.executeCommands(this.id,o),t.pushUndoStop()}}class m_ extends Se{run(e,t){const i=t.getSelections();if(i===null)return;const n=t.getModel();if(n===null)return;const o=t.getOption(L.wordSeparators),r=[];for(const a of i)if(a.isEmpty()){const c=a.getStartPosition(),d=t.getConfiguredWordAtPosition(c);if(!d)continue;const l=new P(c.lineNumber,d.startColumn,c.lineNumber,d.endColumn),u=n.getValueInRange(l);r.push(qi.replace(l,this._modifyText(u,o)))}else{const c=n.getValueInRange(a);r.push(qi.replace(a,this._modifyText(c,o)))}t.pushUndoStop(),t.executeEdits(this.id,r),t.pushUndoStop()}}class l3e extends m_{constructor(){super({id:"editor.action.transformToUppercase",label:I(1323,"Transform to Uppercase"),precondition:V.writable})}_modifyText(e,t){return e.toLocaleUpperCase()}}class h3e extends m_{constructor(){super({id:"editor.action.transformToLowercase",label:I(1324,"Transform to Lowercase"),precondition:V.writable})}_modifyText(e,t){return e.toLocaleLowerCase()}}class Wu{constructor(e,t){this._pattern=e,this._flags=t,this._actual=null,this._evaluated=!1}get(){if(!this._evaluated){this._evaluated=!0;try{this._actual=new RegExp(this._pattern,this._flags)}catch{}}return this._actual}isSupported(){return this.get()!==null}}class uM extends m_{static{this.titleBoundary=new Wu("(^|[^\\p{L}\\p{N}']|((^|\\P{L})'))\\p{L}","gmu")}constructor(){super({id:"editor.action.transformToTitlecase",label:I(1325,"Transform to Title Case"),precondition:V.writable})}_modifyText(e,t){const i=uM.titleBoundary.get();return i?e.toLocaleLowerCase().replace(i,n=>n.toLocaleUpperCase()):e}}class ty extends m_{static{this.caseBoundary=new Wu("(\\p{Ll})(\\p{Lu})","gmu")}static{this.singleLetters=new Wu("(\\p{Lu}|\\p{N})(\\p{Lu})(\\p{Ll})","gmu")}constructor(){super({id:"editor.action.transformToSnakecase",label:I(1326,"Transform to Snake Case"),precondition:V.writable})}_modifyText(e,t){const i=ty.caseBoundary.get(),n=ty.singleLetters.get();return!i||!n?e:e.replace(i,"$1_$2").replace(n,"$1_$2$3").toLocaleLowerCase()}}class gM extends m_{static{this.wordBoundary=new Wu("[_\\s-]","gm")}constructor(){super({id:"editor.action.transformToCamelcase",label:I(1327,"Transform to Camel Case"),precondition:V.writable})}_modifyText(e,t){const i=gM.wordBoundary.get();if(!i)return e;const n=e.split(i);return n.shift()+n.map(r=>r.substring(0,1).toLocaleUpperCase()+r.substring(1)).join("")}}class zx extends m_{static{this.wordBoundary=new Wu("[_\\s-]","gm")}static{this.wordBoundaryToMaintain=new Wu("(?<=\\.)","gm")}constructor(){super({id:"editor.action.transformToPascalcase",label:I(1328,"Transform to Pascal Case"),precondition:V.writable})}_modifyText(e,t){const i=zx.wordBoundary.get(),n=zx.wordBoundaryToMaintain.get();return!i||!n?e:e.split(n).map(a=>a.split(i)).flat().map(a=>a.substring(0,1).toLocaleUpperCase()+a.substring(1)).join("")}}class iy extends m_{static isSupported(){return[this.caseBoundary,this.singleLetters,this.underscoreBoundary].every(t=>t.isSupported())}static{this.caseBoundary=new Wu("(\\p{Ll})(\\p{Lu})","gmu")}static{this.singleLetters=new Wu("(\\p{Lu}|\\p{N})(\\p{Lu}\\p{Ll})","gmu")}static{this.underscoreBoundary=new Wu("(\\S)(_)(\\S)","gm")}constructor(){super({id:"editor.action.transformToKebabcase",label:I(1329,"Transform to Kebab Case"),precondition:V.writable})}_modifyText(e,t){const i=iy.caseBoundary.get(),n=iy.singleLetters.get(),o=iy.underscoreBoundary.get();return!i||!n||!o?e:e.replace(o,"$1-$3").replace(i,"$1-$2").replace(n,"$1-$2").toLocaleLowerCase()}}ue(K$e);ue(j$e);ue(Y$e);ue(Q$e);ue(X$e);ue(Z$e);ue(J$e);ue(e3e);ue(K5);ue(t3e);ue(i3e);ue(n3e);ue(s3e);ue(o3e);ue(r3e);ue(a3e);ue(c3e);ue(d3e);ue(l3e);ue(h3e);ty.caseBoundary.isSupported()&&ty.singleLetters.isSupported()&&ue(ty);gM.wordBoundary.isSupported()&&ue(gM);zx.wordBoundary.isSupported()&&ue(zx);uM.titleBoundary.isSupported()&&ue(uM);iy.isSupported()&&ue(iy);const u3e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var kT;Ve(u3e);const ype=new O("LinkedEditingInputVisible",!1),g3e="linked-editing-decoration";let cw=class extends F{static{kT=this}static{this.ID="editor.contrib.linkedEditing"}static{this.DECORATION=Zt.register({description:"linked-editing",stickiness:ki.AlwaysGrowsWhenTypingAtEdges,className:g3e})}static get(e){return e.getContribution(kT.ID)}constructor(e,t,i,n,o){super(),this.languageConfigurationService=n,this._syncRangesToken=0,this._localToDispose=this._register(new U),this._editor=e,this._providers=i.linkedEditingRangeProvider,this._enabled=!1,this._visibleContextKey=ype.bindTo(t),this._debounceInformation=o.for(this._providers,"Linked Editing",{max:200}),this._currentDecorations=this._editor.createDecorationsCollection(),this._languageWordPattern=null,this._currentWordPattern=null,this._ignoreChangeEvent=!1,this._localToDispose=this._register(new U),this._rangeUpdateTriggerPromise=null,this._rangeSyncTriggerPromise=null,this._currentRequestCts=null,this._currentRequestPosition=null,this._currentRequestModelVersion=null,this._register(this._editor.onDidChangeModel(()=>this.reinitialize(!0))),this._register(this._editor.onDidChangeConfiguration(r=>{(r.hasChanged(L.linkedEditing)||r.hasChanged(L.renameOnType))&&this.reinitialize(!1)})),this._register(this._providers.onDidChange(()=>this.reinitialize(!1))),this._register(this._editor.onDidChangeModelLanguage(()=>this.reinitialize(!0))),this.reinitialize(!0)}reinitialize(e){const t=this._editor.getModel(),i=t!==null&&(this._editor.getOption(L.linkedEditing)||this._editor.getOption(L.renameOnType))&&this._providers.has(t);if(i===this._enabled&&!e||(this._enabled=i,this.clearRanges(),this._localToDispose.clear(),!i||t===null))return;this._localToDispose.add(T.runAndSubscribe(t.onDidChangeLanguageConfiguration,()=>{this._languageWordPattern=this.languageConfigurationService.getLanguageConfiguration(t.getLanguageId()).getWordDefinition()}));const n=new ju(this._debounceInformation.get(t)),o=()=>{this._rangeUpdateTriggerPromise=n.trigger(()=>this.updateRanges(),this._debounceDuration??this._debounceInformation.get(t))},r=new ju(0),a=c=>{this._rangeSyncTriggerPromise=r.trigger(()=>this._syncRanges(c))};this._localToDispose.add(this._editor.onDidChangeCursorPosition(()=>{o()})),this._localToDispose.add(this._editor.onDidChangeModelContent(c=>{if(!this._ignoreChangeEvent&&this._currentDecorations.length>0){const d=this._currentDecorations.getRange(0);if(d&&c.changes.every(l=>d.intersectRanges(l.range))){a(this._syncRangesToken);return}}o()})),this._localToDispose.add({dispose:()=>{n.dispose(),r.dispose()}}),this.updateRanges()}_syncRanges(e){if(!this._editor.hasModel()||e!==this._syncRangesToken||this._currentDecorations.length===0)return;const t=this._editor.getModel(),i=this._currentDecorations.getRange(0);if(!i||i.startLineNumber!==i.endLineNumber)return this.clearRanges();const n=t.getValueInRange(i);if(this._currentWordPattern){const r=n.match(this._currentWordPattern);if((r?r[0].length:0)!==n.length)return this.clearRanges()}const o=[];for(let r=1,a=this._currentDecorations.length;r<a;r++){const c=this._currentDecorations.getRange(r);if(c)if(c.startLineNumber!==c.endLineNumber)o.push({range:c,text:n});else{let d=t.getValueInRange(c),l=n,u=c.startColumn,g=c.endColumn;const m=sf(d,l);u+=m,d=d.substr(m),l=l.substr(m);const v=Xz(d,l);g-=v,d=d.substr(0,d.length-v),l=l.substr(0,l.length-v),(u!==g||l.length!==0)&&o.push({range:new P(c.startLineNumber,u,c.endLineNumber,g),text:l})}}if(o.length!==0)try{this._editor.popUndoStop(),this._ignoreChangeEvent=!0;const r=this._editor._getViewModel().getPrevEditOperationType();this._editor.executeEdits("linkedEditing",o),this._editor._getViewModel().setPrevEditOperationType(r)}finally{this._ignoreChangeEvent=!1}}dispose(){this.clearRanges(),super.dispose()}clearRanges(){this._visibleContextKey.set(!1),this._currentDecorations.clear(),this._currentRequestCts&&(this._currentRequestCts.cancel(),this._currentRequestCts=null,this._currentRequestPosition=null)}get currentUpdateTriggerPromise(){return this._rangeUpdateTriggerPromise||Promise.resolve()}get currentSyncTriggerPromise(){return this._rangeSyncTriggerPromise||Promise.resolve()}async updateRanges(e=!1){if(!this._editor.hasModel()){this.clearRanges();return}const t=this._editor.getPosition();if(!this._enabled&&!e||this._editor.getSelections().length>1){this.clearRanges();return}const i=this._editor.getModel(),n=i.getVersionId();if(this._currentRequestPosition&&this._currentRequestModelVersion===n){if(t.equals(this._currentRequestPosition))return;if(this._currentDecorations.length>0){const r=this._currentDecorations.getRange(0);if(r&&r.containsPosition(t))return}}this.clearRanges(),this._currentRequestPosition=t,this._currentRequestModelVersion=n;const o=this._currentRequestCts=new li;try{const r=new Xn(!1),a=await wpe(this._providers,i,t,o.token);if(this._debounceInformation.update(i,r.elapsed()),o!==this._currentRequestCts||(this._currentRequestCts=null,n!==i.getVersionId()))return;let c=[];a?.ranges&&(c=a.ranges),this._currentWordPattern=a?.wordPattern||this._languageWordPattern;let d=!1;for(let u=0,g=c.length;u<g;u++)if(P.containsPosition(c[u],t)){if(d=!0,u!==0){const m=c[u];c.splice(u,1),c.unshift(m)}break}if(!d){this.clearRanges();return}const l=c.map(u=>({range:u,options:kT.DECORATION}));this._visibleContextKey.set(!0),this._currentDecorations.set(l),this._syncRangesToken++}catch(r){ys(r)||mt(r),(this._currentRequestCts===o||!this._currentRequestCts)&&this.clearRanges()}}setDebounceDuration(e){this._debounceDuration=e}};cw=kT=f([p(1,fe),p(2,Ne),p(3,ds),p(4,Sd)],cw);class p3e extends Se{constructor(){super({id:"editor.action.linkedEditing",label:I(1330,"Start Linked Editing"),precondition:x.and(V.writable,V.hasRenameProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.F2,weight:W.EditorContrib}})}runCommand(e,t){const i=e.get(Bt),[n,o]=Array.isArray(t)&&t||[void 0,void 0];return R.isUri(n)&&we.isIPosition(o)?i.openCodeEditor({resource:n},i.getActiveCodeEditor()).then(r=>{r&&(r.setPosition(o),r.invokeWithinContext(a=>(this.reportTelemetry(a,r),this.run(a,r))))},mt):super.runCommand(e,t)}run(e,t){const i=cw.get(t);return i?Promise.resolve(i.updateRanges(!0)):Promise.resolve()}}const f3e=Vo.bindToContribution(cw.get);ze(new f3e({id:"cancelLinkedEditingInput",precondition:ype,handler:s=>s.clearRanges(),kbOpts:{kbExpr:V.editorTextFocus,weight:W.EditorContrib+99,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));function wpe(s,e,t,i){const n=s.ordered(e);return eq(n.map(o=>async()=>{try{return await o.provideLinkedEditingRanges(e,t,i)}catch(r){Ln(r);return}}),o=>!!o&&An(o?.ranges))}H("editor.linkedEditingBackground",{dark:ye.fromHex("#f00").transparent(.3),light:ye.fromHex("#f00").transparent(.3),hcDark:ye.fromHex("#f00").transparent(.3),hcLight:ye.white},h(1331,"Background color when the editor auto renames on type."));Or("_executeLinkedEditingProvider",(s,e,t)=>{const{linkedEditingRangeProvider:i}=s.get(Ne);return wpe(i,e,t,Ce.None)});Lt(cw.ID,cw,_t.AfterFirstRender);ue(p3e);class pM extends F{static{this.ID="editor.contrib.longLinesHelper"}static get(e){return e.getContribution(pM.ID)}constructor(e){super(),this._editor=e,this._register(this._editor.onMouseDown(t=>{const i=this._editor.getOption(L.stopRenderingLineAfter);i>=0&&t.target.type===xi.CONTENT_TEXT&&t.target.position.column>=i&&this._editor.updateOptions({stopRenderingLineAfter:-1})}))}}Lt(pM.ID,pM,_t.BeforeFirstInteraction);const m3e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(m3e);const v3e=H("editor.wordHighlightBackground",{dark:"#575757B8",light:"#57575740",hcDark:null,hcLight:null},h(1607,"Background color of a symbol during read-access, like reading a variable. The color must not be opaque so as not to hide underlying decorations."),!0);H("editor.wordHighlightStrongBackground",{dark:"#004972B8",light:"#0e639c40",hcDark:null,hcLight:null},h(1608,"Background color of a symbol during write-access, like writing to a variable. The color must not be opaque so as not to hide underlying decorations."),!0);H("editor.wordHighlightTextBackground",v3e,h(1609,"Background color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0);const _3e=H("editor.wordHighlightBorder",{light:null,dark:null,hcDark:kr,hcLight:kr},h(1610,"Border color of a symbol during read-access, like reading a variable."));H("editor.wordHighlightStrongBorder",{light:null,dark:null,hcDark:kr,hcLight:kr},h(1611,"Border color of a symbol during write-access, like writing to a variable."));H("editor.wordHighlightTextBorder",_3e,h(1612,"Border color of a textual occurrence for a symbol."));const b3e=H("editorOverviewRuler.wordHighlightForeground","#A0A0A0CC",h(1613,"Overview ruler marker color for symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),y3e=H("editorOverviewRuler.wordHighlightStrongForeground","#C0A0C0CC",h(1614,"Overview ruler marker color for write-access symbol highlights. The color must not be opaque so as not to hide underlying decorations."),!0),w3e=H("editorOverviewRuler.wordHighlightTextForeground",Tse,h(1615,"Overview ruler marker color of a textual occurrence for a symbol. The color must not be opaque so as not to hide underlying decorations."),!0),S3e=Zt.register({description:"word-highlight-strong",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"wordHighlightStrong",overviewRuler:{color:ns(y3e),position:il.Center},minimap:{color:ns(aN),position:Jm.Inline}}),C3e=Zt.register({description:"word-highlight-text",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"wordHighlightText",overviewRuler:{color:ns(w3e),position:il.Center},minimap:{color:ns(aN),position:Jm.Inline}}),E3e=Zt.register({description:"selection-highlight-overview",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"selectionHighlight",overviewRuler:{color:ns(Tse),position:il.Center},minimap:{color:ns(aN),position:Jm.Inline}}),x3e=Zt.register({description:"selection-highlight",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"selectionHighlight"}),I3e=Zt.register({description:"word-highlight",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"wordHighlight",overviewRuler:{color:ns(b3e),position:il.Center},minimap:{color:ns(aN),position:Jm.Inline}});function D3e(s){return s===rA.Write?S3e:s===rA.Text?C3e:I3e}function k3e(s){return s?x3e:E3e}Fv((s,e)=>{const t=s.getColor(iwe);t&&e.addRule(`.monaco-editor .selectionHighlight { background-color: ${t.transparent(.5)}; }`)});var AG;function Af(s,e){const t=e.filter(i=>!s.find(n=>n.equals(i)));if(t.length>=1){const i=t.map(o=>`line ${o.viewState.position.lineNumber} column ${o.viewState.position.column}`).join(", "),n=t.length===1?h(1343,"Cursor added: {0}",i):h(1344,"Cursors added: {0}",i);zc(n)}}class T3e extends Se{constructor(){super({id:"editor.action.insertCursorAbove",label:I(1345,"Add Cursor Above"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Alt|S.UpArrow,linux:{primary:E.Shift|E.Alt|S.UpArrow,secondary:[E.CtrlCmd|E.Shift|S.UpArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1346,"&&Add Cursor Above"),order:2}})}run(e,t,i){if(!t.hasModel())return;let n=!0;i&&i.logicalLine===!1&&(n=!1);const o=t._getViewModel();if(o.cursorConfig.readOnly)return;o.model.pushStackElement();const r=o.getCursorStates();o.setCursorStates(i.source,Ws.Explicit,oq.addCursorUp(o,r,n)),o.revealTopMostCursor(i.source),Af(r,o.getCursorStates())}}class A3e extends Se{constructor(){super({id:"editor.action.insertCursorBelow",label:I(1347,"Add Cursor Below"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Alt|S.DownArrow,linux:{primary:E.Shift|E.Alt|S.DownArrow,secondary:[E.CtrlCmd|E.Shift|S.DownArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1348,"A&&dd Cursor Below"),order:3}})}run(e,t,i){if(!t.hasModel())return;let n=!0;i&&i.logicalLine===!1&&(n=!1);const o=t._getViewModel();if(o.cursorConfig.readOnly)return;o.model.pushStackElement();const r=o.getCursorStates();o.setCursorStates(i.source,Ws.Explicit,oq.addCursorDown(o,r,n)),o.revealBottomMostCursor(i.source),Af(r,o.getCursorStates())}}class R3e extends Se{constructor(){super({id:"editor.action.insertCursorAtEndOfEachLineSelected",label:I(1349,"Add Cursors to Line Ends"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.KeyI,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1350,"Add C&&ursors to Line Ends"),order:4}})}getCursorsForSelection(e,t,i){if(!e.isEmpty()){for(let n=e.startLineNumber;n<e.endLineNumber;n++){const o=t.getLineMaxColumn(n);i.push(new at(n,o,n,o))}e.endColumn>1&&i.push(new at(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn))}}run(e,t){if(!t.hasModel())return;const i=t.getModel(),n=t.getSelections(),o=t._getViewModel(),r=o.getCursorStates(),a=[];n.forEach(c=>this.getCursorsForSelection(c,i,a)),a.length>0&&t.setSelections(a),Af(r,o.getCursorStates())}}class P3e extends Se{constructor(){super({id:"editor.action.addCursorsToBottom",label:I(1351,"Add Cursors to Bottom"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const i=t.getSelections(),n=t.getModel().getLineCount(),o=[];for(let c=i[0].startLineNumber;c<=n;c++)o.push(new at(c,i[0].startColumn,c,i[0].endColumn));const r=t._getViewModel(),a=r.getCursorStates();o.length>0&&t.setSelections(o),Af(a,r.getCursorStates())}}class L3e extends Se{constructor(){super({id:"editor.action.addCursorsToTop",label:I(1352,"Add Cursors to Top"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const i=t.getSelections(),n=[];for(let a=i[0].startLineNumber;a>=1;a--)n.push(new at(a,i[0].startColumn,a,i[0].endColumn));const o=t._getViewModel(),r=o.getCursorStates();n.length>0&&t.setSelections(n),Af(r,o.getCursorStates())}}class fk{constructor(e,t,i){this.selections=e,this.revealRange=t,this.revealScrollType=i}}class qx{static create(e,t){if(!e.hasModel())return null;const i=t.getState();if(!e.hasTextFocus()&&i.isRevealed&&i.searchString.length>0)return new qx(e,t,!1,i.searchString,i.wholeWord,i.matchCase,null);let n=!1,o,r;const a=e.getSelections();a.length===1&&a[0].isEmpty()?(n=!0,o=!0,r=!0):(o=i.wholeWord,r=i.matchCase);const c=e.getSelection();let d,l=null;if(c.isEmpty()){const u=e.getConfiguredWordAtPosition(c.getStartPosition());if(!u)return null;d=u.word,l=new at(c.startLineNumber,u.startColumn,c.startLineNumber,u.endColumn)}else d=e.getModel().getValueInRange(c).replace(/\r\n/g,`
`);return new qx(e,t,n,d,o,r,l)}constructor(e,t,i,n,o,r,a){this._editor=e,this.findController=t,this.isDisconnectedFromFindController=i,this.searchText=n,this.wholeWord=o,this.matchCase=r,this.currentMatch=a}addSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const e=this._getNextMatch();if(!e)return null;const t=this._editor.getSelections();return new fk(t.concat(e),e,Qi.Smooth)}moveSelectionToNextFindMatch(){if(!this._editor.hasModel())return null;const e=this._getNextMatch();if(!e)return null;const t=this._editor.getSelections();return new fk(t.slice(0,t.length-1).concat(e),e,Qi.Smooth)}_getNextMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const n=this.currentMatch;return this.currentMatch=null,n}this.findController.highlightFindOptions();const e=this._editor.getSelections(),t=e[e.length-1],i=this._editor.getModel().findNextMatch(this.searchText,t.getEndPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1);return i?new at(i.range.startLineNumber,i.range.startColumn,i.range.endLineNumber,i.range.endColumn):null}addSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const e=this._getPreviousMatch();if(!e)return null;const t=this._editor.getSelections();return new fk(t.concat(e),e,Qi.Smooth)}moveSelectionToPreviousFindMatch(){if(!this._editor.hasModel())return null;const e=this._getPreviousMatch();if(!e)return null;const t=this._editor.getSelections();return new fk(t.slice(0,t.length-1).concat(e),e,Qi.Smooth)}_getPreviousMatch(){if(!this._editor.hasModel())return null;if(this.currentMatch){const n=this.currentMatch;return this.currentMatch=null,n}this.findController.highlightFindOptions();const e=this._editor.getSelections(),t=e[e.length-1],i=this._editor.getModel().findPreviousMatch(this.searchText,t.getStartPosition(),!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1);return i?new at(i.range.startLineNumber,i.range.startColumn,i.range.endLineNumber,i.range.endColumn):null}selectAll(e){if(!this._editor.hasModel())return[];this.findController.highlightFindOptions();const t=this._editor.getModel();return e?t.findMatches(this.searchText,e,!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,Ia.MAX_SAFE_SMALL_INTEGER):t.findMatches(this.searchText,!0,!1,this.matchCase,this.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,Ia.MAX_SAFE_SMALL_INTEGER)}}class dw extends F{static{this.ID="editor.contrib.multiCursorController"}static get(e){return e.getContribution(dw.ID)}constructor(e){super(),this._sessionDispose=this._register(new U),this._editor=e,this._ignoreSelectionChange=!1,this._session=null}dispose(){this._endSession(),super.dispose()}_beginSessionIfNeeded(e){if(!this._session){const t=qx.create(this._editor,e);if(!t)return;this._session=t;const i={searchString:this._session.searchText};this._session.isDisconnectedFromFindController&&(i.wholeWordOverride=Ro.True,i.matchCaseOverride=Ro.True,i.isRegexOverride=Ro.False),e.getState().change(i,!1),this._sessionDispose.add(this._editor.onDidChangeCursorSelection(n=>{this._ignoreSelectionChange||this._endSession()})),this._sessionDispose.add(this._editor.onDidBlurEditorText(()=>{this._endSession()})),this._sessionDispose.add(e.getState().onFindReplaceStateChange(n=>{(n.matchCase||n.wholeWord)&&this._endSession()}))}}_endSession(){if(this._sessionDispose.clear(),this._session&&this._session.isDisconnectedFromFindController){const e={wholeWordOverride:Ro.NotSet,matchCaseOverride:Ro.NotSet,isRegexOverride:Ro.NotSet};this._session.findController.getState().change(e,!1)}this._session=null}_setSelections(e){this._ignoreSelectionChange=!0,this._editor.setSelections(e),this._ignoreSelectionChange=!1}_expandEmptyToWord(e,t){if(!t.isEmpty())return t;const i=this._editor.getConfiguredWordAtPosition(t.getStartPosition());return i?new at(t.startLineNumber,i.startColumn,t.startLineNumber,i.endColumn):t}_applySessionResult(e){e&&(this._setSelections(e.selections),e.revealRange&&this._editor.revealRangeInCenterIfOutsideViewport(e.revealRange,e.revealScrollType))}getSession(e){return this._session}addSelectionToNextFindMatch(e){if(this._editor.hasModel()){if(!this._session){const t=this._editor.getSelections();if(t.length>1){const n=e.getState().matchCase;if(!Spe(this._editor.getModel(),t,n)){const r=this._editor.getModel(),a=[];for(let c=0,d=t.length;c<d;c++)a[c]=this._expandEmptyToWord(r,t[c]);this._editor.setSelections(a);return}}}this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToNextFindMatch())}}addSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.addSelectionToPreviousFindMatch())}moveSelectionToNextFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToNextFindMatch())}moveSelectionToPreviousFindMatch(e){this._beginSessionIfNeeded(e),this._session&&this._applySessionResult(this._session.moveSelectionToPreviousFindMatch())}selectAll(e){if(!this._editor.hasModel())return;let t=null;const i=e.getState();if(i.isRevealed&&i.searchString.length>0&&i.isRegex){const n=this._editor.getModel();i.searchScope?t=n.findMatches(i.searchString,i.searchScope,i.isRegex,i.matchCase,i.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,Ia.MAX_SAFE_SMALL_INTEGER):t=n.findMatches(i.searchString,!0,i.isRegex,i.matchCase,i.wholeWord?this._editor.getOption(L.wordSeparators):null,!1,Ia.MAX_SAFE_SMALL_INTEGER)}else{if(this._beginSessionIfNeeded(e),!this._session)return;t=this._session.selectAll(i.searchScope)}if(t.length>0){const n=this._editor.getSelection();for(let o=0,r=t.length;o<r;o++){const a=t[o];if(a.range.intersectRanges(n)){t[o]=t[0],t[0]=a;break}}this._setSelections(t.map(o=>new at(o.range.startLineNumber,o.range.startColumn,o.range.endLineNumber,o.range.endColumn)))}}selectAllUsingSelections(e){e.length>0&&this._setSelections(e)}}class fS extends Se{run(e,t){const i=dw.get(t);if(!i)return;const n=t._getViewModel();if(n){const o=n.getCursorStates(),r=Mr.get(t);if(r)this._run(i,r);else{const a=e.get(Z).createInstance(Mr,t);this._run(i,a),a.dispose()}Af(o,n.getCursorStates())}}}class M3e extends fS{constructor(){super({id:"editor.action.addSelectionToNextFindMatch",label:I(1353,"Add Selection to Next Find Match"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|S.KeyD,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1354,"Add &&Next Occurrence"),order:5}})}_run(e,t){e.addSelectionToNextFindMatch(t)}}class N3e extends fS{constructor(){super({id:"editor.action.addSelectionToPreviousFindMatch",label:I(1355,"Add Selection to Previous Find Match"),precondition:void 0,menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1356,"Add P&&revious Occurrence"),order:6}})}_run(e,t){e.addSelectionToPreviousFindMatch(t)}}class O3e extends fS{constructor(){super({id:"editor.action.moveSelectionToNextFindMatch",label:I(1357,"Move Last Selection to Next Find Match"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:lt(E.CtrlCmd|S.KeyK,E.CtrlCmd|S.KeyD),weight:W.EditorContrib}})}_run(e,t){e.moveSelectionToNextFindMatch(t)}}class F3e extends fS{constructor(){super({id:"editor.action.moveSelectionToPreviousFindMatch",label:I(1358,"Move Last Selection to Previous Find Match"),precondition:void 0})}_run(e,t){e.moveSelectionToPreviousFindMatch(t)}}class W3e extends fS{constructor(){super({id:"editor.action.selectHighlights",label:I(1359,"Select All Occurrences of Find Match"),precondition:void 0,kbOpts:{kbExpr:V.focus,primary:E.CtrlCmd|E.Shift|S.KeyL,weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"3_multi",title:h(1360,"Select All &&Occurrences"),order:7}})}_run(e,t){e.selectAll(t)}}class B3e extends fS{constructor(){super({id:"editor.action.changeAll",label:I(1361,"Change All Occurrences"),precondition:x.and(V.writable,V.editorTextFocus),kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|S.F2,weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:1.2}})}_run(e,t){e.selectAll(t)}}class V3e{constructor(e,t,i,n,o){this._model=e,this._searchText=t,this._matchCase=i,this._wordSeparators=n,this._cachedFindMatches=null,this._modelVersionId=this._model.getVersionId(),o&&this._model===o._model&&this._searchText===o._searchText&&this._matchCase===o._matchCase&&this._wordSeparators===o._wordSeparators&&this._modelVersionId===o._modelVersionId&&(this._cachedFindMatches=o._cachedFindMatches)}findMatches(){return this._cachedFindMatches===null&&(this._cachedFindMatches=this._model.findMatches(this._searchText,!0,!1,this._matchCase,this._wordSeparators,!1).map(e=>e.range),this._cachedFindMatches.sort(P.compareRangesUsingStarts)),this._cachedFindMatches}}let fM=class extends F{static{AG=this}static{this.ID="editor.contrib.selectionHighlighter"}constructor(e,t){super(),this._languageFeaturesService=t,this.editor=e,this._isEnabled=e.getOption(L.selectionHighlight),this._decorations=e.createDecorationsCollection(),this.updateSoon=this._register(new yn(()=>this._update(),300)),this.state=null,this._register(e.onDidChangeConfiguration(n=>{this._isEnabled=e.getOption(L.selectionHighlight)})),this._register(e.onDidChangeCursorSelection(n=>{this._isEnabled&&(n.selection.isEmpty()?n.reason===Ws.Explicit?(this.state&&this._setState(null),this.updateSoon.schedule()):this._setState(null):this._update())})),this._register(e.onDidChangeModel(n=>{this._setState(null)})),this._register(e.onDidChangeModelContent(n=>{this._isEnabled&&this.updateSoon.schedule()}));const i=Mr.get(e);i&&this._register(i.getState().onFindReplaceStateChange(n=>{this._update()})),this.updateSoon.schedule()}_update(){this._setState(AG._createState(this.state,this._isEnabled,this.editor))}static _createState(e,t,i){if(!t||!i.hasModel())return null;const n=i.getSelection();if(n.startLineNumber!==n.endLineNumber)return null;const o=dw.get(i);if(!o)return null;const r=Mr.get(i);if(!r)return null;let a=o.getSession(r);if(!a){const l=i.getSelections();if(l.length>1){const g=r.getState().matchCase;if(!Spe(i.getModel(),l,g))return null}a=qx.create(i,r)}if(!a||a.currentMatch||/^[ \t]+$/.test(a.searchText)||a.searchText.length>200)return null;const c=r.getState(),d=c.matchCase;if(c.isRevealed){let l=c.searchString;d||(l=l.toLowerCase());let u=a.searchText;if(d||(u=u.toLowerCase()),l===u&&a.matchCase===c.matchCase&&a.wholeWord===c.wholeWord&&!c.isRegex)return null}return new V3e(i.getModel(),a.searchText,a.matchCase,a.wholeWord?i.getOption(L.wordSeparators):null,e)}_setState(e){if(this.state=e,!this.state){this._decorations.clear();return}if(!this.editor.hasModel())return;const t=this.editor.getModel();if(t.isTooLargeForTokenization())return;const i=this.state.findMatches(),n=this.editor.getSelections();n.sort(P.compareRangesUsingStarts);const o=[];for(let d=0,l=0,u=i.length,g=n.length;d<u;){const m=i[d];if(l>=g)o.push(m),d++;else{const v=P.compareRangesUsingStarts(m,n[l]);v<0?((n[l].isEmpty()||!P.areIntersecting(m,n[l]))&&o.push(m),d++):(v>0||d++,l++)}}const r=this.editor.getOption(L.occurrencesHighlight)!=="off",a=this._languageFeaturesService.documentHighlightProvider.has(t)&&r,c=o.map(d=>({range:d,options:k3e(a)}));this._decorations.set(c)}dispose(){this._setState(null),super.dispose()}};fM=AG=f([p(1,Ne)],fM);function Spe(s,e,t){const i=die(s,e[0],!t);for(let n=1,o=e.length;n<o;n++){const r=e[n];if(r.isEmpty())return!1;const a=die(s,r,!t);if(i!==a)return!1}return!0}function die(s,e,t){const i=s.getValueInRange(e);return t?i.toLowerCase():i}class H3e extends Se{constructor(){super({id:"editor.action.focusNextCursor",label:I(1362,"Focus Next Cursor"),metadata:{description:h(1363,"Focuses the next cursor"),args:[]},precondition:void 0})}run(e,t,i){if(!t.hasModel())return;const n=t._getViewModel();if(n.cursorConfig.readOnly)return;n.model.pushStackElement();const o=Array.from(n.getCursorStates()),r=o.shift();r&&(o.push(r),n.setCursorStates(i.source,Ws.Explicit,o),n.revealPrimaryCursor(i.source,!0),Af(o,n.getCursorStates()))}}class U3e extends Se{constructor(){super({id:"editor.action.focusPreviousCursor",label:I(1364,"Focus Previous Cursor"),metadata:{description:h(1365,"Focuses the previous cursor"),args:[]},precondition:void 0})}run(e,t,i){if(!t.hasModel())return;const n=t._getViewModel();if(n.cursorConfig.readOnly)return;n.model.pushStackElement();const o=Array.from(n.getCursorStates()),r=o.pop();r&&(o.unshift(r),n.setCursorStates(i.source,Ws.Explicit,o),n.revealPrimaryCursor(i.source,!0),Af(o,n.getCursorStates()))}}Lt(dw.ID,dw,_t.Lazy);Lt(fM.ID,fM,_t.AfterFirstRender);ue(T3e);ue(A3e);ue(R3e);ue(M3e);ue(N3e);ue(O3e);ue(F3e);ue(W3e);ue(B3e);ue(P3e);ue(L3e);ue(H3e);ue(U3e);const kv={Visible:new O("parameterHintsVisible",!1),MultipleSignatures:new O("parameterHintsMultipleSignatures",!1)};async function Cpe(s,e,t,i,n){const o=s.ordered(e);for(const r of o)try{const a=await r.provideSignatureHelp(e,t,n,i);if(a)return a}catch(a){Ln(a)}}Ee.registerCommand("_executeSignatureHelpProvider",async(s,...e)=>{const[t,i,n]=e;yt(R.isUri(t)),yt(we.isIPosition(i)),yt(typeof n=="string"||!n);const o=s.get(Ne),r=await s.get(Ci).createModelReference(t);try{const a=await Cpe(o.signatureHelpProvider,r.object.textEditorModel,we.lift(i),{triggerKind:gp.Invoke,isRetrigger:!1,triggerCharacter:n},Ce.None);return a?(setTimeout(()=>a.dispose(),0),a.value):void 0}finally{r.dispose()}});var Do;(function(s){let e;(function(n){n[n.Default=0]="Default",n[n.Active=1]="Active",n[n.Pending=2]="Pending"})(e=s.Type||(s.Type={})),s.Default={type:e.Default};class t{constructor(o,r){this.request=o,this.previouslyActiveHints=r,this.type=e.Pending}}s.Pending=t;class i{constructor(o){this.hints=o,this.type=e.Active}}s.Active=i})(Do||(Do={}));class j5 extends F{static{this.DEFAULT_DELAY=120}constructor(e,t,i=j5.DEFAULT_DELAY){super(),this._onChangedHints=this._register(new M),this.onChangedHints=this._onChangedHints.event,this.triggerOnType=!1,this._state=Do.Default,this._pendingTriggers=[],this._lastSignatureHelpResult=this._register(new Pt),this.triggerChars=new jT,this.retriggerChars=new jT,this.triggerId=0,this.editor=e,this.providers=t,this.throttledDelayer=new ju(i),this._register(this.editor.onDidBlurEditorWidget(()=>this.cancel())),this._register(this.editor.onDidChangeConfiguration(()=>this.onEditorConfigurationChange())),this._register(this.editor.onDidChangeModel(n=>this.onModelChanged())),this._register(this.editor.onDidChangeModelLanguage(n=>this.onModelChanged())),this._register(this.editor.onDidChangeCursorSelection(n=>this.onCursorChange(n))),this._register(this.editor.onDidChangeModelContent(n=>this.onModelContentChange())),this._register(this.providers.onDidChange(this.onModelChanged,this)),this._register(this.editor.onDidType(n=>this.onDidType(n))),this.onEditorConfigurationChange(),this.onModelChanged()}get state(){return this._state}set state(e){this._state.type===Do.Type.Pending&&this._state.request.cancel(),this._state=e}cancel(e=!1){this.state=Do.Default,this.throttledDelayer.cancel(),e||this._onChangedHints.fire(void 0)}trigger(e,t){const i=this.editor.getModel();if(!i||!this.providers.has(i))return;const n=++this.triggerId;this._pendingTriggers.push(e),this.throttledDelayer.trigger(()=>this.doTrigger(n),t).catch(mt)}next(){if(this.state.type!==Do.Type.Active)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,i=t%e===e-1,n=this.editor.getOption(L.parameterHints).cycle;if((e<2||i)&&!n){this.cancel();return}this.updateActiveSignature(i&&n?0:t+1)}previous(){if(this.state.type!==Do.Type.Active)return;const e=this.state.hints.signatures.length,t=this.state.hints.activeSignature,i=t===0,n=this.editor.getOption(L.parameterHints).cycle;if((e<2||i)&&!n){this.cancel();return}this.updateActiveSignature(i&&n?e-1:t-1)}updateActiveSignature(e){this.state.type===Do.Type.Active&&(this.state=new Do.Active({...this.state.hints,activeSignature:e}),this._onChangedHints.fire(this.state.hints))}async doTrigger(e){const t=this.state.type===Do.Type.Active||this.state.type===Do.Type.Pending,i=this.getLastActiveHints();if(this.cancel(!0),this._pendingTriggers.length===0)return!1;const n=this._pendingTriggers.reduce($3e);this._pendingTriggers=[];const o={triggerKind:n.triggerKind,triggerCharacter:n.triggerCharacter,isRetrigger:t,activeSignatureHelp:i};if(!this.editor.hasModel())return!1;const r=this.editor.getModel(),a=this.editor.getPosition();this.state=new Do.Pending(Tn(c=>Cpe(this.providers,r,a,o,c)),i);try{const c=await this.state.request;return e!==this.triggerId?(c?.dispose(),!1):!c||!c.value.signatures||c.value.signatures.length===0?(c?.dispose(),this._lastSignatureHelpResult.clear(),this.cancel(),!1):(this.state=new Do.Active(c.value),this._lastSignatureHelpResult.value=c,this._onChangedHints.fire(this.state.hints),!0)}catch(c){return e===this.triggerId&&(this.state=Do.Default),mt(c),!1}}getLastActiveHints(){switch(this.state.type){case Do.Type.Active:return this.state.hints;case Do.Type.Pending:return this.state.previouslyActiveHints;default:return}}get isTriggered(){return this.state.type===Do.Type.Active||this.state.type===Do.Type.Pending||this.throttledDelayer.isTriggered()}onModelChanged(){this.cancel(),this.triggerChars.clear(),this.retriggerChars.clear();const e=this.editor.getModel();if(e)for(const t of this.providers.ordered(e)){for(const i of t.signatureHelpTriggerCharacters||[])if(i.length){const n=i.charCodeAt(0);this.triggerChars.add(n),this.retriggerChars.add(n)}for(const i of t.signatureHelpRetriggerCharacters||[])i.length&&this.retriggerChars.add(i.charCodeAt(0))}}onDidType(e){if(!this.triggerOnType)return;const t=e.length-1,i=e.charCodeAt(t);(this.triggerChars.has(i)||this.isTriggered&&this.retriggerChars.has(i))&&this.trigger({triggerKind:gp.TriggerCharacter,triggerCharacter:e.charAt(t)})}onCursorChange(e){e.source==="mouse"?this.cancel():this.isTriggered&&this.trigger({triggerKind:gp.ContentChange})}onModelContentChange(){this.isTriggered&&this.trigger({triggerKind:gp.ContentChange})}onEditorConfigurationChange(){this.triggerOnType=this.editor.getOption(L.parameterHints).enabled,this.triggerOnType||this.cancel()}dispose(){this.cancel(!0),super.dispose()}}function $3e(s,e){switch(e.triggerKind){case gp.Invoke:return e;case gp.ContentChange:return s;case gp.TriggerCharacter:default:return e}}const G3e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var RG;Ve(G3e);const ga=j,z3e=Pe("parameter-hints-next",K.chevronDown,h(1367,"Icon for show next parameter hint.")),q3e=Pe("parameter-hints-previous",K.chevronUp,h(1368,"Icon for show previous parameter hint."));let PG=class extends F{static{RG=this}static{this.ID="editor.widget.parameterHintsWidget"}constructor(e,t,i,n,o){super(),this.editor=e,this.model=t,this.renderDisposeables=this._register(new U),this.visible=!1,this.announcedLabel=null,this.allowEditorOverflow=!0,this.markdownRenderer=new Ov({editor:e},o,n),this.keyVisible=kv.Visible.bindTo(i),this.keyMultipleSignatures=kv.MultipleSignatures.bindTo(i)}createParameterHintDOMNodes(){const e=ga(".editor-widget.parameter-hints-widget"),t=ee(e,ga(".phwrapper"));t.tabIndex=-1;const i=ee(t,ga(".controls")),n=ee(i,ga(".button"+ke.asCSSSelector(q3e))),o=ee(i,ga(".overloads")),r=ee(i,ga(".button"+ke.asCSSSelector(z3e)));this._register(re(n,"click",g=>{Vi.stop(g),this.previous()})),this._register(re(r,"click",g=>{Vi.stop(g),this.next()}));const a=ga(".body"),c=new oI(a,{alwaysConsumeMouseWheel:!0});this._register(c),t.appendChild(c.getDomNode());const d=ee(a,ga(".signature")),l=ee(a,ga(".docs"));e.style.userSelect="text",this.domNodes={element:e,signature:d,overloads:o,docs:l,scrollbar:c},this.editor.addContentWidget(this),this.hide(),this._register(this.editor.onDidChangeCursorSelection(g=>{this.visible&&this.editor.layoutContentWidget(this)}));const u=()=>{if(!this.domNodes)return;const g=this.editor.getOption(L.fontInfo),m=this.domNodes.element;m.style.fontSize=`${g.fontSize}px`,m.style.lineHeight=`${g.lineHeight/g.fontSize}`,m.style.setProperty("--vscode-parameterHintsWidget-editorFontFamily",g.fontFamily),m.style.setProperty("--vscode-parameterHintsWidget-editorFontFamilyDefault",BM.fontFamily)};u(),this._register(T.chain(this.editor.onDidChangeConfiguration.bind(this.editor),g=>g.filter(m=>m.hasChanged(L.fontInfo)))(u)),this._register(this.editor.onDidLayoutChange(g=>this.updateMaxHeight())),this.updateMaxHeight()}show(){this.visible||(this.domNodes||this.createParameterHintDOMNodes(),this.keyVisible.set(!0),this.visible=!0,setTimeout(()=>{this.domNodes?.element.classList.add("visible")},100),this.editor.layoutContentWidget(this))}hide(){this.renderDisposeables.clear(),this.visible&&(this.keyVisible.reset(),this.visible=!1,this.announcedLabel=null,this.domNodes?.element.classList.remove("visible"),this.editor.layoutContentWidget(this))}getPosition(){return this.visible?{position:this.editor.getPosition(),preference:[Fi.ABOVE,Fi.BELOW]}:null}render(e){if(this.renderDisposeables.clear(),!this.domNodes)return;const t=e.signatures.length>1;this.domNodes.element.classList.toggle("multiple",t),this.keyMultipleSignatures.set(t),this.domNodes.signature.innerText="",this.domNodes.docs.innerText="";const i=e.signatures[e.activeSignature];if(!i)return;const n=ee(this.domNodes.signature,ga(".code")),o=i.parameters.length>0,r=i.activeParameter??e.activeParameter;if(o)this.renderParameters(n,i,r);else{const d=ee(n,ga("span"));d.textContent=i.label}const a=i.parameters[r];if(a?.documentation){const d=ga("span.documentation");if(typeof a.documentation=="string")d.textContent=a.documentation;else{const l=this.renderMarkdownDocs(a.documentation);d.appendChild(l.element)}ee(this.domNodes.docs,ga("p",{},d))}if(i.documentation!==void 0)if(typeof i.documentation=="string")ee(this.domNodes.docs,ga("p",{},i.documentation));else{const d=this.renderMarkdownDocs(i.documentation);ee(this.domNodes.docs,d.element)}const c=this.hasDocs(i,a);if(this.domNodes.signature.classList.toggle("has-docs",c),this.domNodes.docs.classList.toggle("empty",!c),this.domNodes.overloads.textContent=String(e.activeSignature+1).padStart(e.signatures.length.toString().length,"0")+"/"+e.signatures.length,a){let d="";const l=i.parameters[r];Array.isArray(l.label)?d=i.label.substring(l.label[0],l.label[1]):d=l.label,l.documentation&&(d+=typeof l.documentation=="string"?`, ${l.documentation}`:`, ${l.documentation.value}`),i.documentation&&(d+=typeof i.documentation=="string"?`, ${i.documentation}`:`, ${i.documentation.value}`),this.announcedLabel!==d&&(na(h(1369,"{0}, hint",d)),this.announcedLabel=d)}this.editor.layoutContentWidget(this),this.domNodes.scrollbar.scanDomNode()}renderMarkdownDocs(e){const t=this.renderDisposeables.add(this.markdownRenderer.render(e,{asyncRenderCallback:()=>{this.domNodes?.scrollbar.scanDomNode()}}));return t.element.classList.add("markdown-docs"),t}hasDocs(e,t){return!!(t&&typeof t.documentation=="string"&&jt(t.documentation).length>0||t&&typeof t.documentation=="object"&&jt(t.documentation).value.length>0||e.documentation&&typeof e.documentation=="string"&&jt(e.documentation).length>0||e.documentation&&typeof e.documentation=="object"&&jt(e.documentation.value).length>0)}renderParameters(e,t,i){const[n,o]=this.getParameterLabelOffsets(t,i),r=document.createElement("span");r.textContent=t.label.substring(0,n);const a=document.createElement("span");a.textContent=t.label.substring(n,o),a.className="parameter active";const c=document.createElement("span");c.textContent=t.label.substring(o),ee(e,r,a,c)}getParameterLabelOffsets(e,t){const i=e.parameters[t];if(i){if(Array.isArray(i.label))return i.label;if(i.label.length){const n=new RegExp(`(\\W|^)${dy(i.label)}(?=\\W|$)`,"g");n.test(e.label);const o=n.lastIndex-i.label.length;return o>=0?[o,n.lastIndex]:[0,0]}else return[0,0]}else return[0,0]}next(){this.editor.focus(),this.model.next()}previous(){this.editor.focus(),this.model.previous()}getDomNode(){return this.domNodes||this.createParameterHintDOMNodes(),this.domNodes.element}getId(){return RG.ID}updateMaxHeight(){if(!this.domNodes)return;const t=`${Math.max(this.editor.getLayoutInfo().height/4,250)}px`;this.domNodes.element.style.maxHeight=t;const i=this.domNodes.element.getElementsByClassName("phwrapper");i.length&&(i[0].style.maxHeight=t)}};PG=RG=f([p(2,fe),p(3,mi),p(4,vi)],PG);H("editorHoverWidget.highlightForeground",Sne,h(1370,"Foreground color of the active item in the parameter hint."));var LG;let lw=class extends F{static{LG=this}static{this.ID="editor.controller.parameterHints"}static get(e){return e.getContribution(LG.ID)}constructor(e,t,i){super(),this.editor=e,this.model=this._register(new j5(e,i.signatureHelpProvider)),this._register(this.model.onChangedHints(n=>{n?(this.widget.value.show(),this.widget.value.render(n)):this.widget.rawValue?.hide()})),this.widget=new Ih(()=>this._register(t.createInstance(PG,this.editor,this.model)))}cancel(){this.model.cancel()}previous(){this.widget.rawValue?.previous()}next(){this.widget.rawValue?.next()}trigger(e){this.model.trigger(e,0)}};lw=LG=f([p(1,Z),p(2,Ne)],lw);class K3e extends Se{constructor(){super({id:"editor.action.triggerParameterHints",label:I(1366,"Trigger Parameter Hints"),precondition:V.hasSignatureHelpProvider,kbOpts:{kbExpr:V.editorTextFocus,primary:E.CtrlCmd|E.Shift|S.Space,weight:W.EditorContrib}})}run(e,t){lw.get(t)?.trigger({triggerKind:gp.Invoke})}}Lt(lw.ID,lw,_t.BeforeFirstInteraction);ue(K3e);const Y5=W.EditorContrib+75,Q5=Vo.bindToContribution(lw.get);ze(new Q5({id:"closeParameterHints",precondition:kv.Visible,handler:s=>s.cancel(),kbOpts:{weight:Y5,kbExpr:V.focus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));ze(new Q5({id:"showPrevParameterHint",precondition:x.and(kv.Visible,kv.MultipleSignatures),handler:s=>s.previous(),kbOpts:{weight:Y5,kbExpr:V.focus,primary:S.UpArrow,secondary:[E.Alt|S.UpArrow],mac:{primary:S.UpArrow,secondary:[E.Alt|S.UpArrow,E.WinCtrl|S.KeyP]}}}));ze(new Q5({id:"showNextParameterHint",precondition:x.and(kv.Visible,kv.MultipleSignatures),handler:s=>s.next(),kbOpts:{weight:Y5,kbExpr:V.focus,primary:S.DownArrow,secondary:[E.Alt|S.DownArrow],mac:{primary:S.DownArrow,secondary:[E.Alt|S.DownArrow,E.WinCtrl|S.KeyN]}}}));const j3e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Epe{constructor(e){this.instantiationService=e}init(...e){}}function Y3e(s,e){return class extends e{constructor(){super(...arguments),this._autorun=void 0}init(...i){this._autorun=ka((n,o)=>{const r=WSe(s(),n);o.add(this.instantiationService.createInstance(r,...i))})}dispose(){this._autorun?.dispose()}}}let lie=class extends Epe{constructor(e){super(e),this.init()}};lie=f([p(0,Z)],lie);function Q3e(s){return Hse()?Y3e(s,MG):s()}let MG=class extends Epe{constructor(e,t){super(t),this.init(e)}};MG=f([p(1,Z)],MG);Ve(j3e);Lt(Hx.ID,Q3e(()=>Hx),_t.Eager);H("editor.placeholder.foreground",nwe,h(1388,"Foreground color of the placeholder text in the editor."));const X3e=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(X3e);const mS=new O("renameInputVisible",!1,h(1439,"Whether the rename input widget is visible"));let NG=class{constructor(e,t,i,n,o,r){this._editor=e,this._acceptKeybindings=t,this._themeService=i,this._keybindingService=n,this._logService=r,this.allowEditorOverflow=!0,this._disposables=new U,this._visibleContextKey=mS.bindTo(o),this._isEditingRenameCandidate=!1,this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,this._candidates=new Set,this._beforeFirstInputFieldEditSW=new Xn,this._inputWithButton=new Z3e,this._disposables.add(this._inputWithButton),this._editor.addContentWidget(this),this._disposables.add(this._editor.onDidChangeConfiguration(a=>{a.hasChanged(L.fontInfo)&&this._updateFont()})),this._disposables.add(i.onDidColorThemeChange(this._updateStyles,this))}dispose(){this._disposables.dispose(),this._editor.removeContentWidget(this)}getId(){return"__renameInputWidget"}getDomNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="monaco-editor rename-box",this._domNode.appendChild(this._inputWithButton.domNode),this._renameCandidateListView=this._disposables.add(new X5(this._domNode,{fontInfo:this._editor.getOption(L.fontInfo),onFocusChange:e=>{this._inputWithButton.input.value=e,this._isEditingRenameCandidate=!1},onSelectionChange:()=>{this._isEditingRenameCandidate=!1,this.acceptInput(!1)}})),this._disposables.add(this._inputWithButton.onDidInputChange(()=>{this._renameCandidateListView?.focusedCandidate!==void 0&&(this._isEditingRenameCandidate=!0),this._timeBeforeFirstInputFieldEdit??=this._beforeFirstInputFieldEditSW.elapsed(),this._renameCandidateProvidersCts?.token.isCancellationRequested===!1&&this._renameCandidateProvidersCts.cancel(),this._renameCandidateListView?.clearFocus()})),this._label=document.createElement("div"),this._label.className="rename-label",this._domNode.appendChild(this._label),this._updateFont(),this._updateStyles(this._themeService.getColorTheme())),this._domNode}_updateStyles(e){if(!this._domNode)return;const t=e.getColor(Hne),i=e.getColor(oy);this._domNode.style.backgroundColor=String(e.getColor(LM)??""),this._domNode.style.boxShadow=t?` 0 0 8px 2px ${t}`:"",this._domNode.style.border=i?`1px solid ${i}`:"",this._domNode.style.color=String(e.getColor(Ine)??"");const n=e.getColor(Sk);this._inputWithButton.domNode.style.backgroundColor=String(e.getColor(NF)??""),this._inputWithButton.input.style.backgroundColor=String(e.getColor(NF)??""),this._inputWithButton.domNode.style.borderWidth=n?"1px":"0px",this._inputWithButton.domNode.style.borderStyle=n?"solid":"none",this._inputWithButton.domNode.style.borderColor=n?.toString()??"none"}_updateFont(){if(this._domNode===void 0)return;yt(this._label!==void 0,"RenameWidget#_updateFont: _label must not be undefined given _domNode is defined"),this._editor.applyFontInfo(this._inputWithButton.input);const e=this._editor.getOption(L.fontInfo);this._label.style.fontSize=`${this._computeLabelFontSize(e.fontSize)}px`}_computeLabelFontSize(e){return e*.8}getPosition(){if(!this._visible||!this._editor.hasModel()||!this._editor.getDomNode())return null;const e=qu(this.getDomNode().ownerDocument.body),t=Bs(this._editor.getDomNode()),i=this._getTopForPosition();this._nPxAvailableAbove=i+t.top,this._nPxAvailableBelow=e.height-this._nPxAvailableAbove;const n=this._editor.getOption(L.lineHeight),{totalHeight:o}=hw.getLayoutInfo({lineHeight:n}),r=this._nPxAvailableBelow>o*6?[Fi.BELOW,Fi.ABOVE]:[Fi.ABOVE,Fi.BELOW];return{position:this._position,preference:r}}beforeRender(){const[e,t]=this._acceptKeybindings;return this._label.innerText=h(1440,"{0} to Rename, {1} to Preview",this._keybindingService.lookupKeybinding(e)?.getLabel(),this._keybindingService.lookupKeybinding(t)?.getLabel()),this._domNode.style.minWidth="200px",null}afterRender(e){if(e===null){this.cancelInput(!0,"afterRender (because position is null)");return}if(!this._editor.hasModel()||!this._editor.getDomNode())return;yt(this._renameCandidateListView),yt(this._nPxAvailableAbove!==void 0),yt(this._nPxAvailableBelow!==void 0);const t=z_(this._inputWithButton.domNode),i=z_(this._label);let n;e===Fi.BELOW?n=this._nPxAvailableBelow:n=this._nPxAvailableAbove,this._renameCandidateListView.layout({height:n-i-t,width:$a(this._inputWithButton.domNode)})}acceptInput(e){this._trace("invoking acceptInput"),this._currentAcceptInput?.(e)}cancelInput(e,t){this._currentCancelInput?.(e)}focusNextRenameSuggestion(){this._renameCandidateListView?.focusNext()||(this._inputWithButton.input.value=this._currentName)}focusPreviousRenameSuggestion(){this._renameCandidateListView?.focusPrevious()||(this._inputWithButton.input.value=this._currentName)}getInput(e,t,i,n,o){const{start:r,end:a}=this._getSelection(e,t);this._renameCts=o;const c=new U;this._nRenameSuggestionsInvocations=0,this._hadAutomaticRenameSuggestionsInvocation=!1,n===void 0?this._inputWithButton.button.style.display="none":(this._inputWithButton.button.style.display="flex",this._requestRenameCandidatesOnce=n,this._requestRenameCandidates(t,!1),c.add(re(this._inputWithButton.button,"click",()=>this._requestRenameCandidates(t,!0))),c.add(re(this._inputWithButton.button,pe.KEY_DOWN,l=>{const u=new vo(l);(u.equals(S.Enter)||u.equals(S.Space))&&(u.stopPropagation(),u.preventDefault(),this._requestRenameCandidates(t,!0))}))),this._isEditingRenameCandidate=!1,this._domNode.classList.toggle("preview",i),this._position=new we(e.startLineNumber,e.startColumn),this._currentName=t,this._inputWithButton.input.value=t,this._inputWithButton.input.setAttribute("selectionStart",r.toString()),this._inputWithButton.input.setAttribute("selectionEnd",a.toString()),this._inputWithButton.input.size=Math.max((e.endColumn-e.startColumn)*1.1,20),this._beforeFirstInputFieldEditSW.reset(),c.add(Ie(()=>{this._renameCts=void 0,o.dispose(!0)})),c.add(Ie(()=>{this._renameCandidateProvidersCts!==void 0&&(this._renameCandidateProvidersCts.dispose(!0),this._renameCandidateProvidersCts=void 0)})),c.add(Ie(()=>this._candidates.clear()));const d=new aa;return d.p.finally(()=>{c.dispose(),this._hide()}),this._currentCancelInput=l=>(this._trace("invoking _currentCancelInput"),this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView?.clearCandidates(),d.complete(l),!0),this._currentAcceptInput=l=>{this._trace("invoking _currentAcceptInput"),yt(this._renameCandidateListView!==void 0);const u=this._renameCandidateListView.nCandidates;let g,m;const v=this._renameCandidateListView.focusedCandidate;if(v!==void 0?(this._trace("using new name from renameSuggestion"),g=v,m={k:"renameSuggestion"}):(this._trace("using new name from inputField"),g=this._inputWithButton.input.value,m=this._isEditingRenameCandidate?{k:"userEditedRenameSuggestion"}:{k:"inputField"}),g===t||g.trim().length===0){this.cancelInput(!0,"_currentAcceptInput (because newName === value || newName.trim().length === 0)");return}this._currentAcceptInput=void 0,this._currentCancelInput=void 0,this._renameCandidateListView.clearCandidates(),d.complete({newName:g,wantsPreview:i&&l,stats:{source:m,nRenameSuggestions:u,timeBeforeFirstInputFieldEdit:this._timeBeforeFirstInputFieldEdit,nRenameSuggestionsInvocations:this._nRenameSuggestionsInvocations,hadAutomaticRenameSuggestionsInvocation:this._hadAutomaticRenameSuggestionsInvocation}})},c.add(o.token.onCancellationRequested(()=>this.cancelInput(!0,"cts.token.onCancellationRequested"))),c.add(this._editor.onDidBlurEditorWidget(()=>this.cancelInput(!this._domNode?.ownerDocument.hasFocus(),"editor.onDidBlurEditorWidget"))),this._show(),d.p}_requestRenameCandidates(e,t){if(this._requestRenameCandidatesOnce!==void 0&&(this._renameCandidateProvidersCts!==void 0&&this._renameCandidateProvidersCts.dispose(!0),yt(this._renameCts),this._inputWithButton.buttonState!=="stop")){this._renameCandidateProvidersCts=new li;const i=t?QF.Invoke:QF.Automatic,n=this._requestRenameCandidatesOnce(i,this._renameCandidateProvidersCts.token);if(n.length===0){this._inputWithButton.setSparkleButton();return}t||(this._hadAutomaticRenameSuggestionsInvocation=!0),this._nRenameSuggestionsInvocations+=1,this._inputWithButton.setStopButton(),this._updateRenameCandidates(n,e,this._renameCts.token)}}_getSelection(e,t){yt(this._editor.hasModel());const i=this._editor.getSelection();let n=0,o=t.length;return!P.isEmpty(i)&&!P.spansMultipleLines(i)&&P.containsRange(e,i)&&(n=Math.max(0,i.startColumn-e.startColumn),o=Math.min(e.endColumn,i.endColumn)-e.startColumn),{start:n,end:o}}_show(){this._trace("invoking _show"),this._editor.revealLineInCenterIfOutsideViewport(this._position.lineNumber,Qi.Smooth),this._visible=!0,this._visibleContextKey.set(!0),this._editor.layoutContentWidget(this),setTimeout(()=>{this._inputWithButton.input.focus(),this._inputWithButton.input.setSelectionRange(parseInt(this._inputWithButton.input.getAttribute("selectionStart")),parseInt(this._inputWithButton.input.getAttribute("selectionEnd")))},100)}async _updateRenameCandidates(e,t,i){const n=(...d)=>this._trace("_updateRenameCandidates",...d);n("start");const o=await Sh(Promise.allSettled(e),i);if(this._inputWithButton.setSparkleButton(),o===void 0){n("returning early - received updateRenameCandidates results - undefined");return}const r=o.flatMap(d=>d.status==="fulfilled"&&wa(d.value)?d.value:[]);n(`received updateRenameCandidates results - total (unfiltered) ${r.length} candidates.`);const a=iI(r,d=>d.newSymbolName);n(`distinct candidates - ${a.length} candidates.`);const c=a.filter(({newSymbolName:d})=>d.trim().length>0&&d!==this._inputWithButton.input.value&&d!==t&&!this._candidates.has(d));if(n(`valid distinct candidates - ${r.length} candidates.`),c.forEach(d=>this._candidates.add(d.newSymbolName)),c.length<1){n("returning early - no valid distinct candidates");return}n("setting candidates"),this._renameCandidateListView.setCandidates(c),n("asking editor to re-layout"),this._editor.layoutContentWidget(this)}_hide(){this._trace("invoked _hide"),this._visible=!1,this._visibleContextKey.reset(),this._editor.layoutContentWidget(this)}_getTopForPosition(){const e=this._editor.getVisibleRanges();let t;return e.length>0?t=e[0].startLineNumber:(this._logService.warn("RenameWidget#_getTopForPosition: this should not happen - visibleRanges is empty"),t=Math.max(1,this._position.lineNumber-5)),this._editor.getTopForLineNumber(this._position.lineNumber)-this._editor.getTopForLineNumber(t)}_trace(...e){this._logService.trace("RenameWidget",...e)}};NG=f([p(2,pt),p(3,He),p(4,fe),p(5,Re)],NG);class X5{constructor(e,t){this._disposables=new U,this._availableHeight=0,this._minimumWidth=0,this._lineHeight=t.fontInfo.lineHeight,this._typicalHalfwidthCharacterWidth=t.fontInfo.typicalHalfwidthCharacterWidth,this._listContainer=document.createElement("div"),this._listContainer.className="rename-box rename-candidate-list-container",e.appendChild(this._listContainer),this._listWidget=X5._createListWidget(this._listContainer,this._candidateViewHeight,t.fontInfo),this._listWidget.onDidChangeFocus(i=>{i.elements.length===1&&t.onFocusChange(i.elements[0].newSymbolName)},this._disposables),this._listWidget.onDidChangeSelection(i=>{i.elements.length===1&&t.onSelectionChange()},this._disposables),this._disposables.add(this._listWidget.onDidBlur(i=>{this._listWidget.setFocus([])})),this._listWidget.style(Cne({listInactiveFocusForeground:yne,listInactiveFocusBackground:wne}))}dispose(){this._listWidget.dispose(),this._disposables.dispose()}layout({height:e,width:t}){this._availableHeight=e,this._minimumWidth=t}setCandidates(e){this._listWidget.splice(0,0,e);const t=this._pickListHeight(this._listWidget.length),i=this._pickListWidth(e);this._listWidget.layout(t,i),this._listContainer.style.height=`${t}px`,this._listContainer.style.width=`${i}px`,zc(h(1441,"Received {0} rename suggestions",e.length))}clearCandidates(){this._listContainer.style.height="0px",this._listContainer.style.width="0px",this._listWidget.splice(0,this._listWidget.length,[])}get nCandidates(){return this._listWidget.length}get focusedCandidate(){if(this._listWidget.length===0)return;const e=this._listWidget.getSelectedElements()[0];if(e!==void 0)return e.newSymbolName;const t=this._listWidget.getFocusedElements()[0];if(t!==void 0)return t.newSymbolName}focusNext(){if(this._listWidget.length===0)return!1;const e=this._listWidget.getFocus();if(e.length===0)return this._listWidget.focusFirst(),this._listWidget.reveal(0),!0;if(e[0]===this._listWidget.length-1)return this._listWidget.setFocus([]),this._listWidget.reveal(0),!1;{this._listWidget.focusNext();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}}focusPrevious(){if(this._listWidget.length===0)return!1;const e=this._listWidget.getFocus();if(e.length===0){this._listWidget.focusLast();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}else{if(e[0]===0)return this._listWidget.setFocus([]),!1;{this._listWidget.focusPrevious();const t=this._listWidget.getFocus()[0];return this._listWidget.reveal(t),!0}}}clearFocus(){this._listWidget.setFocus([])}get _candidateViewHeight(){const{totalHeight:e}=hw.getLayoutInfo({lineHeight:this._lineHeight});return e}_pickListHeight(e){const t=this._candidateViewHeight*e;return Math.min(t,this._availableHeight,this._candidateViewHeight*7)}_pickListWidth(e){const t=Math.ceil(Math.max(...e.map(n=>n.newSymbolName.length))*this._typicalHalfwidthCharacterWidth);return Math.max(this._minimumWidth,25+t+10)}static _createListWidget(e,t,i){const n=new class{getTemplateId(r){return"candidate"}getHeight(r){return t}},o=new class{constructor(){this.templateId="candidate"}renderTemplate(r){return new hw(r,i)}renderElement(r,a,c){c.populate(r)}disposeTemplate(r){r.dispose()}};return new Rv("NewSymbolNameCandidates",e,n,[o],{keyboardSupport:!1,mouseSupport:!0,multipleSelectionSupport:!1})}}class Z3e{constructor(){this._buttonHoverContent="",this._onDidInputChange=new M,this.onDidInputChange=this._onDidInputChange.event,this._disposables=new U}get domNode(){return this._domNode||(this._domNode=document.createElement("div"),this._domNode.className="rename-input-with-button",this._domNode.style.display="flex",this._domNode.style.flexDirection="row",this._domNode.style.alignItems="center",this._inputNode=document.createElement("input"),this._inputNode.className="rename-input",this._inputNode.type="text",this._inputNode.style.border="none",this._inputNode.setAttribute("aria-label",h(1442,"Rename input. Type new name and press Enter to commit.")),this._domNode.appendChild(this._inputNode),this._buttonNode=document.createElement("div"),this._buttonNode.className="rename-suggestions-button",this._buttonNode.setAttribute("tabindex","0"),this._buttonGenHoverText=h(1443,"Generate new name suggestions"),this._buttonCancelHoverText=h(1444,"Cancel"),this._buttonHoverContent=this._buttonGenHoverText,this._disposables.add(Kz().setupDelayedHover(this._buttonNode,()=>({content:this._buttonHoverContent,appearance:{showPointer:!0,compact:!0}}))),this._domNode.appendChild(this._buttonNode),this._disposables.add(re(this.input,pe.INPUT,()=>this._onDidInputChange.fire())),this._disposables.add(re(this.input,pe.KEY_DOWN,e=>{const t=new vo(e);(t.keyCode===S.LeftArrow||t.keyCode===S.RightArrow)&&this._onDidInputChange.fire()})),this._disposables.add(re(this.input,pe.CLICK,()=>this._onDidInputChange.fire())),this._disposables.add(re(this.input,pe.FOCUS,()=>{this.domNode.style.outlineWidth="1px",this.domNode.style.outlineStyle="solid",this.domNode.style.outlineOffset="-1px",this.domNode.style.outlineColor="var(--vscode-focusBorder)"})),this._disposables.add(re(this.input,pe.BLUR,()=>{this.domNode.style.outline="none"}))),this._domNode}get input(){return yt(this._inputNode),this._inputNode}get button(){return yt(this._buttonNode),this._buttonNode}get buttonState(){return this._buttonState}setSparkleButton(){this._buttonState="sparkle",this._sparkleIcon??=gy(K.sparkle),Xi(this.button),this.button.appendChild(this._sparkleIcon),this.button.setAttribute("aria-label","Generating new name suggestions"),this._buttonHoverContent=this._buttonGenHoverText,this.input.focus()}setStopButton(){this._buttonState="stop",this._stopIcon??=gy(K.stopCircle),Xi(this.button),this.button.appendChild(this._stopIcon),this.button.setAttribute("aria-label","Cancel generating new name suggestions"),this._buttonHoverContent=this._buttonCancelHoverText,this.input.focus()}dispose(){this._disposables.dispose()}}class hw{static{this._PADDING=2}constructor(e,t){this._domNode=document.createElement("div"),this._domNode.className="rename-box rename-candidate",this._domNode.style.display="flex",this._domNode.style.columnGap="5px",this._domNode.style.alignItems="center",this._domNode.style.height=`${t.lineHeight}px`,this._domNode.style.padding=`${hw._PADDING}px`;const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.width=i.style.height=`${t.lineHeight*.8}px`,this._domNode.appendChild(i),this._icon=gy(K.sparkle),this._icon.style.display="none",i.appendChild(this._icon),this._label=document.createElement("div"),use(this._label,t),this._domNode.appendChild(this._label),e.appendChild(this._domNode)}populate(e){this._updateIcon(e),this._updateLabel(e)}_updateIcon(e){const t=!!e.tags?.includes(swe.AIGenerated);this._icon.style.display=t?"inherit":"none"}_updateLabel(e){this._label.innerText=e.newSymbolName}static getLayoutInfo({lineHeight:e}){return{totalHeight:e+hw._PADDING*2}}dispose(){}}var OG;class Z5{constructor(e,t,i){this.model=e,this.position=t,this._providerRenameIdx=0,this._providers=i.ordered(e)}hasProvider(){return this._providers.length>0}async resolveRenameLocation(e){const t=[];for(this._providerRenameIdx=0;this._providerRenameIdx<this._providers.length;this._providerRenameIdx++){const n=this._providers[this._providerRenameIdx];if(!n.resolveRenameLocation)break;const o=await n.resolveRenameLocation(this.model,this.position,e);if(o){if(o.rejectReason){t.push(o.rejectReason);continue}return o}}this._providerRenameIdx=0;const i=this.model.getWordAtPosition(this.position);return i?{range:new P(this.position.lineNumber,i.startColumn,this.position.lineNumber,i.endColumn),text:i.word,rejectReason:t.length>0?t.join(`
`):void 0}:{range:P.fromPositions(this.position),text:"",rejectReason:t.length>0?t.join(`
`):void 0}}async provideRenameEdits(e,t){return this._provideRenameEdits(e,this._providerRenameIdx,[],t)}async _provideRenameEdits(e,t,i,n){const o=this._providers[t];if(!o)return{edits:[],rejectReason:i.join(`
`)};const r=await o.provideRenameEdits(this.model,this.position,e,n);if(r){if(r.rejectReason)return this._provideRenameEdits(e,t+1,i.concat(r.rejectReason),n)}else return this._provideRenameEdits(e,t+1,i.concat(h(1428,"No result.")),n);return r}}async function J3e(s,e,t,i){const n=new Z5(e,t,s),o=await n.resolveRenameLocation(Ce.None);return o?.rejectReason?{edits:[],rejectReason:o.rejectReason}:n.provideRenameEdits(i,Ce.None)}let tf=class{static{OG=this}static{this.ID="editor.contrib.renameController"}static get(e){return e.getContribution(OG.ID)}constructor(e,t,i,n,o,r,a,c){this.editor=e,this._instaService=t,this._notificationService=i,this._bulkEditService=n,this._progressService=o,this._logService=r,this._configService=a,this._languageFeaturesService=c,this._disposableStore=new U,this._cts=new li,this._renameWidget=this._disposableStore.add(this._instaService.createInstance(NG,this.editor,["acceptRenameInput","acceptRenameInputWithPreview"]))}dispose(){this._disposableStore.dispose(),this._cts.dispose(!0)}async run(){const e=this._logService.trace.bind(this._logService,"[rename]");if(this._cts.dispose(!0),this._cts=new li,!this.editor.hasModel()){e("editor has no model");return}const t=this.editor.getPosition(),i=new Z5(this.editor.getModel(),t,this._languageFeaturesService.renameProvider);if(!i.hasProvider()){e("skeleton has no provider");return}const n=new tv(this.editor,fs.Position|fs.Value,void 0,this._cts.token);let o;try{e("resolving rename location");const v=i.resolveRenameLocation(n.token);this._progressService.showWhile(v,250),o=await v,e("resolved rename location")}catch(v){v instanceof fo?e("resolve rename location cancelled",JSON.stringify(v,null,"	")):(e("resolve rename location failed",v instanceof Error?v:JSON.stringify(v,null,"	")),(typeof v=="string"||tc(v))&&Dr.get(this.editor)?.showMessage(v||h(1429,"An unknown error occurred while resolving rename location"),t));return}finally{n.dispose()}if(!o){e("returning early - no loc");return}if(o.rejectReason){e(`returning early - rejected with reason: ${o.rejectReason}`,o.rejectReason),Dr.get(this.editor)?.showMessage(o.rejectReason,t);return}if(n.token.isCancellationRequested){e("returning early - cts1 cancelled");return}const r=new tv(this.editor,fs.Position|fs.Value,o.range,this._cts.token),a=this.editor.getModel(),c=this._languageFeaturesService.newSymbolNamesProvider.all(a),d=await Promise.all(c.map(async v=>[v,await v.supportsAutomaticNewSymbolNamesTriggerKind??!1])),l=(v,_)=>{let w=d.slice();return v===QF.Automatic&&(w=w.filter(([C,k])=>k)),w.map(([C])=>C.provideNewSymbolNames(a,o.range,v,_))};e("creating rename input field and awaiting its result");const u=this._bulkEditService.hasPreviewHandler()&&this._configService.getValue(this.editor.getModel().uri,"editor.rename.enablePreview"),g=await this._renameWidget.getInput(o.range,o.text,u,c.length>0?l:void 0,r);if(e("received response from rename input field"),typeof g=="boolean"){e(`returning early - rename input field response - ${g}`),g&&this.editor.focus(),r.dispose();return}this.editor.focus(),e("requesting rename edits");const m=Sh(i.provideRenameEdits(g.newName,r.token),r.token).then(async v=>{if(!v){e("returning early - no rename edits result");return}if(!this.editor.hasModel()){e("returning early - no model after rename edits are provided");return}if(v.rejectReason){e(`returning early - rejected with reason: ${v.rejectReason}`),this._notificationService.info(v.rejectReason);return}this.editor.setSelection(P.fromPositions(this.editor.getSelection().getPosition())),e("applying edits"),this._bulkEditService.apply(v,{editor:this.editor,showPreview:g.wantsPreview,label:h(1430,"Renaming '{0}' to '{1}'",o?.text,g.newName),code:"undoredo.rename",quotableLabel:h(1431,"Renaming {0} to {1}",o?.text,g.newName),respectAutoSaveConfig:!0}).then(_=>{e("edits applied"),_.ariaSummary&&na(h(1432,"Successfully renamed '{0}' to '{1}'. Summary: {2}",o.text,g.newName,_.ariaSummary))}).catch(_=>{e(`error when applying edits ${JSON.stringify(_,null,"	")}`),this._notificationService.error(h(1433,"Rename failed to apply edits")),this._logService.error(_)})},v=>{e("error when providing rename edits",JSON.stringify(v,null,"	")),this._notificationService.error(h(1434,"Rename failed to compute edits")),this._logService.error(v)}).finally(()=>{r.dispose()});return e("returning rename operation"),this._progressService.showWhile(m,250),m}acceptRenameInput(e){this._renameWidget.acceptInput(e)}cancelRenameInput(){this._renameWidget.cancelInput(!0,"cancelRenameInput command")}focusNextRenameSuggestion(){this._renameWidget.focusNextRenameSuggestion()}focusPreviousRenameSuggestion(){this._renameWidget.focusPreviousRenameSuggestion()}};tf=OG=f([p(1,Z),p(2,Dt),p(3,yw),p(4,Uu),p(5,Re),p(6,ir),p(7,Ne)],tf);class eGe extends Se{constructor(){super({id:"editor.action.rename",label:I(1435,"Rename Symbol"),precondition:x.and(V.writable,V.hasRenameProvider),kbOpts:{kbExpr:V.editorTextFocus,primary:S.F2,weight:W.EditorContrib},contextMenuOpts:{group:"1_modification",order:1.1}})}runCommand(e,t){const i=e.get(Bt),[n,o]=Array.isArray(t)&&t||[void 0,void 0];return R.isUri(n)&&we.isIPosition(o)?i.openCodeEditor({resource:n},i.getActiveCodeEditor()).then(r=>{r&&(r.setPosition(o),r.invokeWithinContext(a=>(this.reportTelemetry(a,r),this.run(a,r))))},mt):super.runCommand(e,t)}run(e,t){const i=e.get(Re),n=tf.get(t);return n?(i.trace("[RenameAction] got controller, running..."),n.run()):(i.trace("[RenameAction] returning early - controller missing"),Promise.resolve())}}Lt(tf.ID,tf,_t.Lazy);ue(eGe);const J5=Vo.bindToContribution(tf.get);ze(new J5({id:"acceptRenameInput",precondition:mS,handler:s=>s.acceptRenameInput(!1),kbOpts:{weight:W.EditorContrib+99,kbExpr:x.and(V.focus,x.not("isComposing")),primary:S.Enter}}));ze(new J5({id:"acceptRenameInputWithPreview",precondition:x.and(mS,x.has("config.editor.rename.enablePreview")),handler:s=>s.acceptRenameInput(!0),kbOpts:{weight:W.EditorContrib+99,kbExpr:x.and(V.focus,x.not("isComposing")),primary:E.CtrlCmd+S.Enter}}));ze(new J5({id:"cancelRenameInput",precondition:mS,handler:s=>s.cancelRenameInput(),kbOpts:{weight:W.EditorContrib+99,kbExpr:V.focus,primary:S.Escape,secondary:[E.Shift|S.Escape]}}));Y(class extends X{constructor(){super({id:"focusNextRenameSuggestion",title:{...I(1436,"Focus Next Rename Suggestion")},precondition:mS,keybinding:[{primary:S.DownArrow,weight:W.EditorContrib+99}]})}run(e){const t=e.get(Bt).getFocusedCodeEditor();if(!t)return;const i=tf.get(t);i&&i.focusNextRenameSuggestion()}});Y(class extends X{constructor(){super({id:"focusPreviousRenameSuggestion",title:{...I(1437,"Focus Previous Rename Suggestion")},precondition:mS,keybinding:[{primary:S.UpArrow,weight:W.EditorContrib+99}]})}run(e){const t=e.get(Bt).getFocusedCodeEditor();if(!t)return;const i=tf.get(t);i&&i.focusPreviousRenameSuggestion()}});Or("_executeDocumentRenameProvider",function(s,e,t,...i){const[n]=i;yt(typeof n=="string");const{renameProvider:o}=s.get(Ne);return J3e(o,e,t,n)});Or("_executePrepareRename",async function(s,e,t){const{renameProvider:i}=s.get(Ne),o=await new Z5(e,t,i).resolveRenameLocation(Ce.None);if(o?.rejectReason)throw new Error(o.rejectReason);return o});Ke.as(Js.Configuration).registerConfiguration({id:"editor",properties:{"editor.rename.enablePreview":{scope:Ht.LANGUAGE_OVERRIDABLE,description:h(1438,"Enable/disable the ability to preview changes before renaming"),default:!0,type:"boolean"}}});let mM=class extends F{static{this.ID="editor.sectionHeaderDetector"}constructor(e,t,i){super(),this.editor=e,this.languageConfigurationService=t,this.editorWorkerService=i,this.decorations=this.editor.createDecorationsCollection(),this.options=this.createOptions(e.getOption(L.minimap)),this.computePromise=null,this.currentOccurrences={},this._register(e.onDidChangeModel(n=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(L.minimap)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(e.onDidChangeModelLanguage(n=>{this.currentOccurrences={},this.options=this.createOptions(e.getOption(L.minimap)),this.stop(),this.computeSectionHeaders.schedule(0)})),this._register(t.onDidChange(n=>{const o=this.editor.getModel()?.getLanguageId();o&&n.affects(o)&&(this.currentOccurrences={},this.options=this.createOptions(e.getOption(L.minimap)),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(e.onDidChangeConfiguration(n=>{this.options&&!n.hasChanged(L.minimap)||(this.options=this.createOptions(e.getOption(L.minimap)),this.updateDecorations([]),this.stop(),this.computeSectionHeaders.schedule(0))})),this._register(this.editor.onDidChangeModelContent(n=>{this.computeSectionHeaders.schedule()})),this._register(e.onDidChangeModelTokens(n=>{this.computeSectionHeaders.isScheduled()||this.computeSectionHeaders.schedule(1e3)})),this.computeSectionHeaders=this._register(new yn(()=>{this.findSectionHeaders()},250)),this.computeSectionHeaders.schedule(0)}createOptions(e){if(!e||!this.editor.hasModel())return;const t=this.editor.getModel().getLanguageId();if(!t)return;const i=this.languageConfigurationService.getLanguageConfiguration(t).comments,n=this.languageConfigurationService.getLanguageConfiguration(t).foldingRules;if(!(!i&&!n?.markers))return{foldingRules:n,markSectionHeaderRegex:e.markSectionHeaderRegex,findMarkSectionHeaders:e.showMarkSectionHeaders,findRegionSectionHeaders:e.showRegionSectionHeaders}}findSectionHeaders(){if(!this.editor.hasModel()||!this.options?.findMarkSectionHeaders&&!this.options?.findRegionSectionHeaders)return;const e=this.editor.getModel();if(e.isDisposed()||e.isTooLargeForSyncing())return;const t=e.getVersionId();this.editorWorkerService.findSectionHeaders(e.uri,this.options).then(i=>{e.isDisposed()||e.getVersionId()!==t||this.updateDecorations(i)})}updateDecorations(e){const t=this.editor.getModel();t&&(e=e.filter(o=>{if(!o.shouldBeInComments)return!0;const r=t.validateRange(o.range),a=t.tokenization.getLineTokens(r.startLineNumber),c=a.findTokenIndexAtOffset(r.startColumn-1),d=a.getStandardTokenType(c);return a.getLanguageId(c)===t.getLanguageId()&&d===jc.Comment}));const i=Object.values(this.currentOccurrences).map(o=>o.decorationId),n=e.map(o=>tGe(o));this.editor.changeDecorations(o=>{const r=o.deltaDecorations(i,n);this.currentOccurrences={};for(let a=0,c=r.length;a<c;a++){const d={sectionHeader:e[a],decorationId:r[a]};this.currentOccurrences[d.decorationId]=d}})}stop(){this.computeSectionHeaders.cancel(),this.computePromise&&(this.computePromise.cancel(),this.computePromise=null)}dispose(){super.dispose(),this.stop(),this.decorations.clear()}};mM=f([p(1,ds),p(2,vc)],mM);function tGe(s){return{range:s.range,options:Zt.createDynamic({description:"section-header",stickiness:ki.GrowsOnlyWhenTypingAfter,collapseOnReplaceEdit:!0,minimap:{color:void 0,position:Jm.Inline,sectionHeaderStyle:s.hasSeparatorLine?m8.Underlined:m8.Normal,sectionHeaderText:s.text}})}}Lt(mM.ID,mM,_t.AfterFirstRender);function A0(s){return s&&!!s.data}function xpe(s){return s&&Array.isArray(s.edits)}class iGe{constructor(e,t,i){this.provider=e,this.tokens=t,this.error=i}}function Ipe(s,e){return s.has(e)}function nGe(s,e){const t=s.orderedGroups(e);return t.length>0?t[0]:[]}async function Dpe(s,e,t,i,n){const o=nGe(s,e),r=await Promise.all(o.map(async a=>{let c,d=null;try{c=await a.provideDocumentSemanticTokens(e,a===t?i:null,n)}catch(l){d=l,c=null}return(!c||!A0(c)&&!xpe(c))&&(c=null),new iGe(a,c,d)}));for(const a of r){if(a.error)throw a.error;if(a.tokens)return a}return r.length>0?r[0]:null}function sGe(s,e){const t=s.orderedGroups(e);return t.length>0?t[0]:null}class oGe{constructor(e,t){this.provider=e,this.tokens=t}}function rGe(s,e){return s.has(e)}function kpe(s,e){const t=s.orderedGroups(e);return t.length>0?t[0]:[]}async function e6(s,e,t,i){const n=kpe(s,e),o=await Promise.all(n.map(async r=>{let a;try{a=await r.provideDocumentRangeSemanticTokens(e,t,i)}catch(c){Ln(c),a=null}return(!a||!A0(a))&&(a=null),new oGe(r,a)}));for(const r of o)if(r.tokens)return r;return o.length>0?o[0]:null}Ee.registerCommand("_provideDocumentSemanticTokensLegend",async(s,...e)=>{const[t]=e;yt(t instanceof R);const i=s.get(ci).getModel(t);if(!i)return;const{documentSemanticTokensProvider:n}=s.get(Ne),o=sGe(n,i);return o?o[0].getLegend():s.get(Ge).executeCommand("_provideDocumentRangeSemanticTokensLegend",t)});Ee.registerCommand("_provideDocumentSemanticTokens",async(s,...e)=>{const[t]=e;yt(t instanceof R);const i=s.get(ci).getModel(t);if(!i)return;const{documentSemanticTokensProvider:n}=s.get(Ne);if(!Ipe(n,i))return s.get(Ge).executeCommand("_provideDocumentRangeSemanticTokens",t,i.getFullModelRange());const o=await Dpe(n,i,null,null,Ce.None);if(!o)return;const{provider:r,tokens:a}=o;if(!a||!A0(a))return;const c=Hce({id:0,type:"full",data:a.data});return a.resultId&&r.releaseDocumentSemanticTokens(a.resultId),c});Ee.registerCommand("_provideDocumentRangeSemanticTokensLegend",async(s,...e)=>{const[t,i]=e;yt(t instanceof R);const n=s.get(ci).getModel(t);if(!n)return;const{documentRangeSemanticTokensProvider:o}=s.get(Ne),r=kpe(o,n);if(r.length===0)return;if(r.length===1)return r[0].getLegend();if(!i||!P.isIRange(i))return console.warn("provideDocumentRangeSemanticTokensLegend might be out-of-sync with provideDocumentRangeSemanticTokens unless a range argument is passed in"),r[0].getLegend();const a=await e6(o,n,P.lift(i),Ce.None);if(a)return a.provider.getLegend()});Ee.registerCommand("_provideDocumentRangeSemanticTokens",async(s,...e)=>{const[t,i]=e;yt(t instanceof R),yt(P.isIRange(i));const n=s.get(ci).getModel(t);if(!n)return;const{documentRangeSemanticTokensProvider:o}=s.get(Ne),r=await e6(o,n,P.lift(i),Ce.None);if(!(!r||!r.tokens))return Hce({id:0,type:"full",data:r.tokens.data})});const t6="editor.semanticHighlighting";function TT(s,e,t){const i=t.getValue(t6,{overrideIdentifier:s.getLanguageId(),resource:s.uri})?.enabled;return typeof i=="boolean"?i:e.getColorTheme().semanticHighlighting}var $g;let FG=class extends F{constructor(e,t,i,n,o,r){super(),this._watchers=new In;const a=l=>{this._watchers.get(l.uri)?.dispose(),this._watchers.set(l.uri,new WG(l,e,i,o,r))},c=(l,u)=>{u.dispose(),this._watchers.delete(l.uri)},d=()=>{for(const l of t.getModels()){const u=this._watchers.get(l.uri);TT(l,i,n)?u||a(l):u&&c(l,u)}};t.getModels().forEach(l=>{TT(l,i,n)&&a(l)}),this._register(t.onModelAdded(l=>{TT(l,i,n)&&a(l)})),this._register(t.onModelRemoved(l=>{const u=this._watchers.get(l.uri);u&&c(l,u)})),this._register(n.onDidChangeConfiguration(l=>{l.affectsConfiguration(t6)&&d()})),this._register(i.onDidColorThemeChange(d))}dispose(){Xe(this._watchers.values()),this._watchers.clear(),super.dispose()}};FG=f([p(0,$N),p(1,ci),p(2,pt),p(3,ne),p(4,Sd),p(5,Ne)],FG);let WG=class extends F{static{$g=this}static{this.REQUEST_MIN_DELAY=300}static{this.REQUEST_MAX_DELAY=2e3}constructor(e,t,i,n,o){super(),this._semanticTokensStylingService=t,this._isDisposed=!1,this._model=e,this._provider=o.documentSemanticTokensProvider,this._debounceInformation=n.for(this._provider,"DocumentSemanticTokens",{min:$g.REQUEST_MIN_DELAY,max:$g.REQUEST_MAX_DELAY}),this._fetchDocumentSemanticTokens=this._register(new yn(()=>this._fetchDocumentSemanticTokensNow(),$g.REQUEST_MIN_DELAY)),this._currentDocumentResponse=null,this._currentDocumentRequestCancellationTokenSource=null,this._documentProvidersChangeListeners=[],this._providersChangedDuringRequest=!1,this._register(this._model.onDidChangeContent(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeAttached(()=>{this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(this._model.onDidChangeLanguage(()=>{this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(0)}));const r=()=>{Xe(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[];for(const a of this._provider.all(e))typeof a.onDidChange=="function"&&this._documentProvidersChangeListeners.push(a.onDidChange(()=>{if(this._currentDocumentRequestCancellationTokenSource){this._providersChangedDuringRequest=!0;return}this._fetchDocumentSemanticTokens.schedule(0)}))};r(),this._register(this._provider.onDidChange(()=>{r(),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._register(i.onDidColorThemeChange(a=>{this._setDocumentSemanticTokens(null,null,null,[]),this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))})),this._fetchDocumentSemanticTokens.schedule(0)}dispose(){this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._currentDocumentRequestCancellationTokenSource&&(this._currentDocumentRequestCancellationTokenSource.cancel(),this._currentDocumentRequestCancellationTokenSource=null),Xe(this._documentProvidersChangeListeners),this._documentProvidersChangeListeners=[],this._setDocumentSemanticTokens(null,null,null,[]),this._isDisposed=!0,super.dispose()}_fetchDocumentSemanticTokensNow(){if(this._currentDocumentRequestCancellationTokenSource)return;if(!Ipe(this._provider,this._model)){this._currentDocumentResponse&&this._model.tokenization.setSemanticTokens(null,!1);return}if(!this._model.isAttachedToEditor())return;const e=new li,t=this._currentDocumentResponse?this._currentDocumentResponse.provider:null,i=this._currentDocumentResponse&&this._currentDocumentResponse.resultId||null,n=Dpe(this._provider,this._model,t,i,e.token);this._currentDocumentRequestCancellationTokenSource=e,this._providersChangedDuringRequest=!1;const o=[],r=this._model.onDidChangeContent(c=>{o.push(c)}),a=new Xn(!1);n.then(c=>{if(this._debounceInformation.update(this._model,a.elapsed()),this._currentDocumentRequestCancellationTokenSource=null,r.dispose(),!c)this._setDocumentSemanticTokens(null,null,null,o);else{const{provider:d,tokens:l}=c,u=this._semanticTokensStylingService.getStyling(d);this._setDocumentSemanticTokens(d,l||null,u,o)}},c=>{c&&(ys(c)||typeof c.message=="string"&&c.message.indexOf("busy")!==-1)||mt(c),this._currentDocumentRequestCancellationTokenSource=null,r.dispose(),(o.length>0||this._providersChangedDuringRequest)&&(this._fetchDocumentSemanticTokens.isScheduled()||this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model)))})}static _copy(e,t,i,n,o){o=Math.min(o,i.length-n,e.length-t);for(let r=0;r<o;r++)i[n+r]=e[t+r]}_setDocumentSemanticTokens(e,t,i,n){const o=this._currentDocumentResponse,r=()=>{(n.length>0||this._providersChangedDuringRequest)&&!this._fetchDocumentSemanticTokens.isScheduled()&&this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model))};if(this._currentDocumentResponse&&(this._currentDocumentResponse.dispose(),this._currentDocumentResponse=null),this._isDisposed){e&&t&&e.releaseDocumentSemanticTokens(t.resultId);return}if(!e||!i){this._model.tokenization.setSemanticTokens(null,!1);return}if(!t){this._model.tokenization.setSemanticTokens(null,!0),r();return}if(xpe(t)){if(!o){this._model.tokenization.setSemanticTokens(null,!0);return}if(t.edits.length===0)t={resultId:t.resultId,data:o.data};else{let a=0;for(const g of t.edits)a+=(g.data?g.data.length:0)-g.deleteCount;const c=o.data,d=new Uint32Array(c.length+a);let l=c.length,u=d.length;for(let g=t.edits.length-1;g>=0;g--){const m=t.edits[g];if(m.start>c.length){i.warnInvalidEditStart(o.resultId,t.resultId,g,m.start,c.length),this._model.tokenization.setSemanticTokens(null,!0);return}const v=l-(m.start+m.deleteCount);v>0&&($g._copy(c,l-v,d,u-v,v),u-=v),m.data&&($g._copy(m.data,0,d,u-m.data.length,m.data.length),u-=m.data.length),l=m.start}l>0&&$g._copy(c,0,d,0,l),t={resultId:t.resultId,data:d}}}if(A0(t)){this._currentDocumentResponse=new aGe(e,t.resultId,t.data);const a=Ase(t,i,this._model.getLanguageId());if(n.length>0)for(const c of n)for(const d of a)for(const l of c.changes)d.applyEdit(l.range,l.text);this._model.tokenization.setSemanticTokens(a,!0)}else this._model.tokenization.setSemanticTokens(null,!0);r()}};WG=$g=f([p(1,$N),p(2,pt),p(3,Sd),p(4,Ne)],WG);class aGe{constructor(e,t,i){this.provider=e,this.resultId=t,this.data=i}dispose(){this.provider.releaseDocumentSemanticTokens(this.resultId)}}pS(FG);var BG;let vM=class extends F{static{BG=this}static{this.ID="editor.contrib.viewportSemanticTokens"}static get(e){return e.getContribution(BG.ID)}constructor(e,t,i,n,o,r){super(),this._semanticTokensStylingService=t,this._themeService=i,this._configurationService=n,this._editor=e,this._provider=r.documentRangeSemanticTokensProvider,this._debounceInformation=o.for(this._provider,"DocumentRangeSemanticTokens",{min:100,max:500}),this._tokenizeViewport=this._register(new yn(()=>this._tokenizeViewportNow(),100)),this._outstandingRequests=[];const a=()=>{this._editor.hasModel()&&this._tokenizeViewport.schedule(this._debounceInformation.get(this._editor.getModel()))};this._register(this._editor.onDidScrollChange(()=>{a()})),this._register(this._editor.onDidChangeModel(()=>{this._cancelAll(),a()})),this._register(this._editor.onDidChangeModelContent(c=>{this._cancelAll(),a()})),this._register(this._provider.onDidChange(()=>{this._cancelAll(),a()})),this._register(this._configurationService.onDidChangeConfiguration(c=>{c.affectsConfiguration(t6)&&(this._cancelAll(),a())})),this._register(this._themeService.onDidColorThemeChange(()=>{this._cancelAll(),a()})),a()}_cancelAll(){for(const e of this._outstandingRequests)e.cancel();this._outstandingRequests=[]}_removeOutstandingRequest(e){for(let t=0,i=this._outstandingRequests.length;t<i;t++)if(this._outstandingRequests[t]===e){this._outstandingRequests.splice(t,1);return}}_tokenizeViewportNow(){if(!this._editor.hasModel())return;const e=this._editor.getModel();if(e.tokenization.hasCompleteSemanticTokens())return;if(!TT(e,this._themeService,this._configurationService)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}if(!rGe(this._provider,e)){e.tokenization.hasSomeSemanticTokens()&&e.tokenization.setSemanticTokens(null,!1);return}const t=this._editor.getVisibleRangesPlusViewportAboveBelow();this._outstandingRequests=this._outstandingRequests.concat(t.map(i=>this._requestRange(e,i)))}_requestRange(e,t){const i=e.getVersionId(),n=Tn(r=>Promise.resolve(e6(this._provider,e,t,r))),o=new Xn(!1);return n.then(r=>{if(this._debounceInformation.update(e,o.elapsed()),!r||!r.tokens||e.isDisposed()||e.getVersionId()!==i)return;const{provider:a,tokens:c}=r,d=this._semanticTokensStylingService.getStyling(a);e.tokenization.setPartialSemanticTokens(t,Ase(c,d,e.getLanguageId()))}).then(()=>this._removeOutstandingRequest(n),()=>this._removeOutstandingRequest(n)),n}};vM=BG=f([p(1,$N),p(2,pt),p(3,ne),p(4,Sd),p(5,Ne)],vM);Lt(vM.ID,vM,_t.AfterFirstRender);class cGe{constructor(e=!0){this.selectSubwords=e}provideSelectionRanges(e,t){const i=[];for(const n of t){const o=[];i.push(o),this.selectSubwords&&this._addInWordRanges(o,e,n),this._addWordRanges(o,e,n),this._addWhitespaceLine(o,e,n),o.push({range:e.getFullModelRange()})}return i}_addInWordRanges(e,t,i){const n=t.getWordAtPosition(i);if(!n)return;const{word:o,startColumn:r}=n,a=i.column-r;let c=a,d=a,l=0;for(;c>=0;c--){const u=o.charCodeAt(c);if(c!==a&&(u===st.Underline||u===st.Dash))break;if(v8(u)&&UT(l))break;l=u}for(c+=1;d<o.length;d++){const u=o.charCodeAt(d);if(UT(u)&&v8(l))break;if(u===st.Underline||u===st.Dash)break;l=u}c<d&&e.push({range:new P(i.lineNumber,r+c,i.lineNumber,r+d)})}_addWordRanges(e,t,i){const n=t.getWordAtPosition(i);n&&e.push({range:new P(i.lineNumber,n.startColumn,i.lineNumber,n.endColumn)})}_addWhitespaceLine(e,t,i){t.getLineLength(i.lineNumber)>0&&t.getLineFirstNonWhitespaceColumn(i.lineNumber)===0&&t.getLineLastNonWhitespaceColumn(i.lineNumber)===0&&e.push({range:new P(i.lineNumber,1,i.lineNumber,t.getLineMaxColumn(i.lineNumber))})}}var VG;class i6{constructor(e,t){this.index=e,this.ranges=t}mov(e){const t=this.index+(e?1:-1);if(t<0||t>=this.ranges.length)return this;const i=new i6(t,this.ranges);return i.ranges[t].equalsRange(this.ranges[this.index])?i.mov(e):i}}let Kx=class{static{VG=this}static{this.ID="editor.contrib.smartSelectController"}static get(e){return e.getContribution(VG.ID)}constructor(e,t){this._editor=e,this._languageFeaturesService=t,this._ignoreSelection=!1}dispose(){this._selectionListener?.dispose()}async run(e){if(!this._editor.hasModel())return;const t=this._editor.getSelections(),i=this._editor.getModel();if(this._state||await Ape(this._languageFeaturesService.selectionRangeProvider,i,t.map(o=>o.getPosition()),this._editor.getOption(L.smartSelect),Ce.None).then(o=>{if(!(!An(o)||o.length!==t.length)&&!(!this._editor.hasModel()||!rs(this._editor.getSelections(),t,(r,a)=>r.equalsSelection(a)))){for(let r=0;r<o.length;r++)o[r]=o[r].filter(a=>a.containsPosition(t[r].getStartPosition())&&a.containsPosition(t[r].getEndPosition())),o[r].unshift(t[r]);this._state=o.map(r=>new i6(0,r)),this._selectionListener?.dispose(),this._selectionListener=this._editor.onDidChangeCursorPosition(()=>{this._ignoreSelection||(this._selectionListener?.dispose(),this._state=void 0)})}}),!this._state)return;this._state=this._state.map(o=>o.mov(e));const n=this._state.map(o=>at.fromPositions(o.ranges[o.index].getStartPosition(),o.ranges[o.index].getEndPosition()));this._ignoreSelection=!0;try{this._editor.setSelections(n)}finally{this._ignoreSelection=!1}}};Kx=VG=f([p(1,Ne)],Kx);class Tpe extends Se{constructor(e,t){super(t),this._forward=e}async run(e,t){const i=Kx.get(t);i&&await i.run(this._forward)}}class dGe extends Tpe{constructor(){super(!0,{id:"editor.action.smartSelect.expand",label:I(1445,"Expand Selection"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.RightArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|E.Shift|S.RightArrow,secondary:[E.WinCtrl|E.Shift|S.RightArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"1_basic",title:h(1446,"&&Expand Selection"),order:2}})}}Ee.registerCommandAlias("editor.action.smartSelect.grow","editor.action.smartSelect.expand");class lGe extends Tpe{constructor(){super(!1,{id:"editor.action.smartSelect.shrink",label:I(1447,"Shrink Selection"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|E.Alt|S.LeftArrow,mac:{primary:E.CtrlCmd|E.WinCtrl|E.Shift|S.LeftArrow,secondary:[E.WinCtrl|E.Shift|S.LeftArrow]},weight:W.EditorContrib},menuOpts:{menuId:N.MenubarSelectionMenu,group:"1_basic",title:h(1448,"&&Shrink Selection"),order:3}})}}Lt(Kx.ID,Kx,_t.Lazy);ue(dGe);ue(lGe);async function Ape(s,e,t,i,n){const o=s.all(e).concat(new cGe(i.selectSubwords));o.length===1&&o.unshift(new Fc);const r=[],a=[];for(const c of o)r.push(Promise.resolve(c.provideSelectionRanges(e,t,n)).then(d=>{if(An(d)&&d.length===t.length)for(let l=0;l<t.length;l++){a[l]||(a[l]=[]);for(const u of d[l])P.isIRange(u.range)&&P.containsPosition(u.range,t[l])&&a[l].push(P.lift(u.range))}},Ln));return await Promise.all(r),a.map(c=>{if(c.length===0)return[];c.sort((g,m)=>we.isBefore(g.getStartPosition(),m.getStartPosition())?1:we.isBefore(m.getStartPosition(),g.getStartPosition())||we.isBefore(g.getEndPosition(),m.getEndPosition())?-1:we.isBefore(m.getEndPosition(),g.getEndPosition())?1:0);const d=[];let l;for(const g of c)(!l||P.containsRange(g,l)&&!P.equalsRange(g,l))&&(d.push(g),l=g);if(!i.selectLeadingAndTrailingWhitespace)return d;const u=[d[0]];for(let g=1;g<d.length;g++){const m=d[g-1],v=d[g];if(v.startLineNumber!==m.startLineNumber||v.endLineNumber!==m.endLineNumber){const _=new P(m.startLineNumber,e.getLineFirstNonWhitespaceColumn(m.startLineNumber),m.endLineNumber,e.getLineLastNonWhitespaceColumn(m.endLineNumber));_.containsRange(m)&&!_.equalsRange(m)&&v.containsRange(_)&&!v.equalsRange(_)&&u.push(_);const w=new P(m.startLineNumber,1,m.endLineNumber,e.getLineMaxColumn(m.endLineNumber));w.containsRange(m)&&!w.equalsRange(_)&&v.containsRange(w)&&!v.equalsRange(w)&&u.push(w)}u.push(v)}return u})}Ee.registerCommand("_executeSelectionRangeProvider",async function(s,...e){const[t,i]=e;yt(R.isUri(t));const n=s.get(Ne).selectionRangeProvider,o=await s.get(Ci).createModelReference(t);try{return Ape(n,o.object.textEditorModel,i,{selectLeadingAndTrailingWhitespace:!0,selectSubwords:!0},Ce.None)}finally{o.dispose()}});class hGe extends Fr{constructor(){super({id:"editor.action.toggleStickyScroll",title:{...I(1491,"Toggle Editor Sticky Scroll"),mnemonicTitle:h(1492,"&&Toggle Editor Sticky Scroll")},metadata:{description:I(1493,"Toggle/enable the editor sticky scroll which shows the nested scopes at the top of the viewport")},category:te.View,toggled:{condition:x.equals("config.editor.stickyScroll.enabled",!0),title:h(1494,"Sticky Scroll"),mnemonicTitle:h(1495,"&&Sticky Scroll")},menu:[{id:N.CommandPalette},{id:N.MenubarAppearanceMenu,group:"4_editor",order:3},{id:N.StickyScrollContext}]})}async runEditorCommand(e,t){const i=e.get(ne),n=!i.getValue("editor.stickyScroll.enabled"),o=bd.get(t)?.isFocused();i.updateValue("editor.stickyScroll.enabled",n),o&&t.focus()}}const R0=W.EditorContrib;class uGe extends Fr{constructor(){super({id:"editor.action.focusStickyScroll",title:{...I(1496,"Focus Editor Sticky Scroll"),mnemonicTitle:h(1497,"&&Focus Editor Sticky Scroll")},precondition:x.and(x.has("config.editor.stickyScroll.enabled"),V.stickyScrollVisible),menu:[{id:N.CommandPalette}]})}runEditorCommand(e,t){bd.get(t)?.focus()}}class gGe extends Fr{constructor(){super({id:"editor.action.selectNextStickyScrollLine",title:I(1498,"Select the next editor sticky scroll line"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:R0,primary:S.DownArrow}})}runEditorCommand(e,t){bd.get(t)?.focusNext()}}class pGe extends Fr{constructor(){super({id:"editor.action.selectPreviousStickyScrollLine",title:I(1499,"Select the previous sticky scroll line"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:R0,primary:S.UpArrow}})}runEditorCommand(e,t){bd.get(t)?.focusPrevious()}}class fGe extends Fr{constructor(){super({id:"editor.action.goToFocusedStickyScrollLine",title:I(1500,"Go to the focused sticky scroll line"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:R0,primary:S.Enter}})}runEditorCommand(e,t){bd.get(t)?.goToFocused()}}class mGe extends Fr{constructor(){super({id:"editor.action.selectEditor",title:I(1501,"Select Editor"),precondition:V.stickyScrollFocused.isEqualTo(!0),keybinding:{weight:R0,primary:S.Escape}})}runEditorCommand(e,t){bd.get(t)?.selectEditor()}}Lt(bd.ID,bd,_t.AfterFirstRender);Y(hGe);Y(uGe);Y(pGe);Y(gGe);Y(fGe);Y(mGe);class vGe{constructor(e,t,i,n,o,r,a){this.range=e,this.insertText=t,this.filterText=i,this.additionalTextEdits=n,this.command=o,this.action=r,this.completion=a}}let HG=class extends Qz{constructor(e,t,i,n,o,r){super(o.disposable),this.model=e,this.line=t,this.word=i,this.completionModel=n,this._suggestMemoryService=r}canBeReused(e,t,i){return this.model===e&&this.line===t&&this.word.word.length>0&&this.word.startColumn===i.startColumn&&this.word.endColumn<i.endColumn&&this.completionModel.getIncompleteProvider().size===0}get items(){const e=[],{items:t}=this.completionModel,i=this._suggestMemoryService.select(this.model,{lineNumber:this.line,column:this.word.endColumn+this.completionModel.lineContext.characterCountDelta},t),n=As.slice(t,i),o=As.slice(t,0,i);let r=5;for(const a of As.concat(n,o)){if(a.score===CE.Default)continue;const c=new P(a.editStart.lineNumber,a.editStart.column,a.editInsertEnd.lineNumber,a.editInsertEnd.column+this.completionModel.lineContext.characterCountDelta),d=a.completion.insertTextRules&&a.completion.insertTextRules&sh.InsertAsSnippet?{snippet:a.completion.insertText}:a.completion.insertText;e.push(new vGe(c,d,a.filterTextLow??a.labelLow,a.completion.additionalTextEdits,a.completion.command,a.completion.action,a)),r-->=0&&a.resolve(Ce.None)}return e}};HG=f([p(5,UN)],HG);let UG=class extends F{constructor(e,t,i,n){super(),this._languageFeatureService=e,this._clipboardService=t,this._suggestMemoryService=i,this._editorService=n,this._store.add(e.inlineCompletionsProvider.register("*",this))}async provideInlineCompletions(e,t,i,n){if(i.selectedSuggestionInfo)return;let o;for(const m of this._editorService.listCodeEditors())if(m.getModel()===e){o=m;break}if(!o)return;const r=o.getOption(L.quickSuggestions);if(gb.isAllOff(r))return;e.tokenization.tokenizeIfCheap(t.lineNumber);const a=e.tokenization.getLineTokens(t.lineNumber),c=a.getStandardTokenType(a.findTokenIndexAtOffset(Math.max(t.column-1-1,0)));if(gb.valueFor(r,c)!=="inline")return;let d=e.getWordAtPosition(t),l;if(d?.word||(l=this._getTriggerCharacterInfo(e,t)),!d?.word&&!l||(d||(d=e.getWordUntilPosition(t)),d.endColumn!==t.column))return;let u;const g=e.getValueInRange(new P(t.lineNumber,1,t.lineNumber,t.column));if(!l&&this._lastResult?.canBeReused(e,t.lineNumber,d)){const m=new VX(g,t.column-this._lastResult.word.endColumn);this._lastResult.completionModel.lineContext=m,this._lastResult.acquire(),u=this._lastResult}else{const m=await e4(this._languageFeatureService.completionProvider,e,t,new iD(void 0,sP.createSuggestFilter(o).itemKind,l?.providers),l&&{triggerKind:ba.TriggerCharacter,triggerCharacter:l.ch},n);let v;m.needsClipboard&&(v=await this._clipboardService.readText());const _=new ip(m.items,t.column,new VX(g,0),ql.None,o.getOption(L.suggest),o.getOption(L.snippetSuggestions),{boostFullMatch:!1,firstMatchCanBeWeak:!1},v);u=new HG(e,t.lineNumber,d,_,m,this._suggestMemoryService)}return this._lastResult=u,u}handleItemDidShow(e,t){t.completion.resolve(Ce.None)}freeInlineCompletions(e){e.release()}_getTriggerCharacterInfo(e,t){const i=e.getValueInRange(P.fromPositions({lineNumber:t.lineNumber,column:t.column-1},t)),n=new Set;for(const o of this._languageFeatureService.completionProvider.all(e))o.triggerCharacters?.includes(i)&&n.add(o);if(n.size!==0)return{providers:n,ch:i}}};UG=f([p(0,Ne),p(1,Vs),p(2,UN),p(3,Bt)],UG);pS(UG);class _Ge extends Se{constructor(){super({id:"editor.action.forceRetokenize",label:I(1576,"Developer: Force Retokenize"),precondition:void 0})}run(e,t){if(!t.hasModel())return;const i=t.getModel();i.tokenization.resetTokenization();const n=new Xn;i.tokenization.forceTokenization(i.getLineCount()),n.stop(),console.log(`tokenization took ${n.elapsed()}`)}}ue(_Ge);const bGe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),yGe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(yGe);const wGe=26;let $G=class extends F{constructor(e,t){super(),this._editor=e,this.instantiationService=t,this.banner=this._register(this.instantiationService.createInstance(GG))}hide(){this._editor.setBanner(null,0),this.banner.clear()}show(e){this.banner.show({...e,onClose:()=>{this.hide(),e.onClose?.()}}),this._editor.setBanner(this.banner.element,wGe)}};$G=f([p(1,Z)],$G);let GG=class extends F{constructor(e){super(),this.instantiationService=e,this.markdownRenderer=this.instantiationService.createInstance(Ov,{}),this.element=j("div.editor-banner"),this.element.tabIndex=0}getAriaLabel(e){if(e.ariaLabel)return e.ariaLabel;if(typeof e.message=="string")return e.message}getBannerMessage(e){if(typeof e=="string"){const t=j("span");return t.innerText=e,t}return this.markdownRenderer.render(e).element}clear(){Xi(this.element)}show(e){Xi(this.element);const t=this.getAriaLabel(e);t&&this.element.setAttribute("aria-label",t);const i=ee(this.element,j("div.icon-container"));i.setAttribute("aria-hidden","true"),e.icon&&i.appendChild(j(`div${ke.asCSSSelector(e.icon)}`));const n=ee(this.element,j("div.message-container"));if(n.setAttribute("aria-hidden","true"),n.appendChild(this.getBannerMessage(e.message)),this.messageActionsContainer=ee(this.element,j("div.message-actions-container")),e.actions)for(const r of e.actions)this._register(this.instantiationService.createInstance(kx,this.messageActionsContainer,{...r,tabIndex:-1},{}));const o=ee(this.element,j("div.action-container"));this.actionBar=this._register(new Ar(o)),this.actionBar.push(this._register(new Xt("banner.close",h(1577,"Close Banner"),ke.asClassName(Cse),!0,()=>{typeof e.onClose=="function"&&e.onClose()})),{icon:!0,label:!1}),this.actionBar.setFocusable(!1)}};GG=f([p(0,Z)],GG);Ve(bGe);const SGe=Pe("extensions-warning-message",K.warning,h(1578,"Icon shown with a warning message in the extensions editor."));let jx=class extends F{static{this.ID="editor.contrib.unicodeHighlighter"}constructor(e,t,i,n){super(),this._editor=e,this._editorWorkerService=t,this._workspaceTrustService=i,this._highlighter=null,this._bannerClosed=!1,this._updateState=o=>{if(o&&o.hasMore){if(this._bannerClosed)return;const r=Math.max(o.ambiguousCharacterCount,o.nonBasicAsciiCharacterCount,o.invisibleCharacterCount);let a;if(o.nonBasicAsciiCharacterCount>=r)a={message:h(1579,"This document contains many non-basic ASCII unicode characters"),command:new kD};else if(o.ambiguousCharacterCount>=r)a={message:h(1580,"This document contains many ambiguous unicode characters"),command:new v_};else if(o.invisibleCharacterCount>=r)a={message:h(1581,"This document contains many invisible unicode characters"),command:new DD};else throw new Error("Unreachable");this._bannerController.show({id:"unicodeHighlightBanner",message:a.message,icon:SGe,actions:[{label:a.command.shortLabel,href:`command:${a.command.desc.id}`}],onClose:()=>{this._bannerClosed=!0}})}else this._bannerController.hide()},this._bannerController=this._register(n.createInstance($G,e)),this._register(this._editor.onDidChangeModel(()=>{this._bannerClosed=!1,this._updateHighlighter()})),this._options=e.getOption(L.unicodeHighlighting),this._register(i.onDidChangeTrust(o=>{this._updateHighlighter()})),this._register(e.onDidChangeConfiguration(o=>{o.hasChanged(L.unicodeHighlighting)&&(this._options=e.getOption(L.unicodeHighlighting),this._updateHighlighter())})),this._updateHighlighter()}dispose(){this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),super.dispose()}_updateHighlighter(){if(this._updateState(null),this._highlighter&&(this._highlighter.dispose(),this._highlighter=null),!this._editor.hasModel())return;const e=CGe(this._workspaceTrustService.isWorkspaceTrusted(),this._options);if([e.nonBasicASCII,e.ambiguousCharacters,e.invisibleCharacters].every(i=>i===!1))return;const t={nonBasicASCII:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments,includeStrings:e.includeStrings,allowedCodePoints:Object.keys(e.allowedCharacters).map(i=>i.codePointAt(0)),allowedLocales:Object.keys(e.allowedLocales).map(i=>i==="_os"?new Intl.NumberFormat().resolvedOptions().locale:i==="_vscode"?gh:i)};this._editorWorkerService.canComputeUnicodeHighlights(this._editor.getModel().uri)?this._highlighter=new zG(this._editor,t,this._updateState,this._editorWorkerService):this._highlighter=new EGe(this._editor,t,this._updateState)}getDecorationInfo(e){return this._highlighter?this._highlighter.getDecorationInfo(e):null}};jx=f([p(1,vc),p(2,Lv),p(3,Z)],jx);function CGe(s,e){return{nonBasicASCII:e.nonBasicASCII===s1?!s:e.nonBasicASCII,ambiguousCharacters:e.ambiguousCharacters,invisibleCharacters:e.invisibleCharacters,includeComments:e.includeComments===s1?!s:e.includeComments,includeStrings:e.includeStrings===s1?!s:e.includeStrings,allowedCharacters:e.allowedCharacters,allowedLocales:e.allowedLocales}}let zG=class extends F{constructor(e,t,i,n){super(),this._editor=e,this._options=t,this._updateState=i,this._editorWorkerService=n,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new yn(()=>this._update(),250)),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const e=this._model.getVersionId();this._editorWorkerService.computedUnicodeHighlights(this._model.uri,this._options).then(t=>{if(this._model.isDisposed()||this._model.getVersionId()!==e)return;this._updateState(t);const i=[];if(!t.hasMore)for(const n of t.ranges)i.push({range:n,options:P0.instance.getDecorationFromOptions(this._options)});this._decorations.set(i)})}getDecorationInfo(e){if(!this._decorations.has(e))return null;const t=this._editor.getModel();if(!Yse(t,e))return null;const i=t.getValueInRange(e.range);return{reason:Ppe(i,this._options),inComment:Xse(t,e),inString:Qse(t,e)}}};zG=f([p(3,vc)],zG);class EGe extends F{constructor(e,t,i){super(),this._editor=e,this._options=t,this._updateState=i,this._model=this._editor.getModel(),this._decorations=this._editor.createDecorationsCollection(),this._updateSoon=this._register(new yn(()=>this._update(),250)),this._register(this._editor.onDidLayoutChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidScrollChange(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeHiddenAreas(()=>{this._updateSoon.schedule()})),this._register(this._editor.onDidChangeModelContent(()=>{this._updateSoon.schedule()})),this._updateSoon.schedule()}dispose(){this._decorations.clear(),super.dispose()}_update(){if(this._model.isDisposed())return;if(!this._model.mightContainNonBasicASCII()){this._decorations.clear();return}const e=this._editor.getVisibleRanges(),t=[],i={ranges:[],ambiguousCharacterCount:0,invisibleCharacterCount:0,nonBasicAsciiCharacterCount:0,hasMore:!1};for(const n of e){const o=Rse.computeUnicodeHighlights(this._model,this._options,n);for(const r of o.ranges)i.ranges.push(r);i.ambiguousCharacterCount+=i.ambiguousCharacterCount,i.invisibleCharacterCount+=i.invisibleCharacterCount,i.nonBasicAsciiCharacterCount+=i.nonBasicAsciiCharacterCount,i.hasMore=i.hasMore||o.hasMore}if(!i.hasMore)for(const n of i.ranges)t.push({range:n,options:P0.instance.getDecorationFromOptions(this._options)});this._updateState(i),this._decorations.set(t)}getDecorationInfo(e){if(!this._decorations.has(e))return null;const t=this._editor.getModel(),i=t.getValueInRange(e.range);return Yse(t,e)?{reason:Ppe(i,this._options),inComment:Xse(t,e),inString:Qse(t,e)}:null}}const Rpe=h(1582,"Configure Unicode Highlight Options");let qG=class{constructor(e,t,i){this._editor=e,this._languageService=t,this._openerService=i,this.hoverOrdinal=5}computeSync(e,t){if(!this._editor.hasModel()||e.type!==tr.Range)return[];const i=this._editor.getModel(),n=this._editor.getContribution(jx.ID);if(!n)return[];const o=[],r=new Set;let a=300;for(const c of t){const d=n.getDecorationInfo(c);if(!d)continue;const u=i.getValueInRange(c.range).codePointAt(0),g=fF(u);let m;switch(d.reason.kind){case pm.Ambiguous:{hse(d.reason.confusableWith)?m=h(1583,"The character {0} could be confused with the ASCII character {1}, which is more common in source code.",g,fF(d.reason.confusableWith.codePointAt(0))):m=h(1584,"The character {0} could be confused with the character {1}, which is more common in source code.",g,fF(d.reason.confusableWith.codePointAt(0)));break}case pm.Invisible:m=h(1585,"The character {0} is invisible.",g);break;case pm.NonBasicAscii:m=h(1586,"The character {0} is not a basic ASCII character.",g);break}if(r.has(m))continue;r.add(m);const v={codePoint:u,reason:d.reason,inComment:d.inComment,inString:d.inString},_=h(1587,"Adjust settings"),w=`command:${L0.ID}?${encodeURIComponent(JSON.stringify(v))}`,C=new Gi("",!0).appendMarkdown(m).appendText(" ").appendLink(w,_,Rpe);o.push(new Kc(this,c.range,[C],!1,a++))}return o}renderHoverParts(e,t){return SPe(e,t,this._editor,this._languageService,this._openerService)}getAccessibleContent(e){return e.contents.map(t=>t.value).join(`
`)}};qG=f([p(1,vi),p(2,mi)],qG);function KG(s){return`U+${s.toString(16).padStart(4,"0")}`}function fF(s){let e=`\`${KG(s)}\``;return Pse.isInvisibleCharacter(s)||(e+=` "${`${xGe(s)}`}"`),e}function xGe(s){return s===st.BackTick?"`` ` ``":"`"+String.fromCodePoint(s)+"`"}function Ppe(s,e){return Rse.computeUnicodeHighlightReason(s,e)}class P0{constructor(){this.map=new Map}static{this.instance=new P0}getDecorationFromOptions(e){return this.getDecoration(!e.includeComments,!e.includeStrings)}getDecoration(e,t){const i=`${e}${t}`;let n=this.map.get(i);return n||(n=Zt.createDynamic({description:"unicode-highlight",stickiness:ki.NeverGrowsWhenTypingAtEdges,className:"unicode-highlight",showIfCollapsed:!0,overviewRuler:null,minimap:null,hideInCommentTokens:e,hideInStringTokens:t}),this.map.set(i,n)),n}}class IGe extends Se{static{this.ID="editor.action.unicodeHighlight.disableHighlightingInComments"}constructor(){super({id:v_.ID,label:I(1588,"Disable highlighting of characters in comments"),precondition:void 0}),this.shortLabel=h(1589,"Disable Highlight In Comments")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(Qu.includeComments,!1,us.USER)}}class DGe extends Se{static{this.ID="editor.action.unicodeHighlight.disableHighlightingInStrings"}constructor(){super({id:v_.ID,label:I(1590,"Disable highlighting of characters in strings"),precondition:void 0}),this.shortLabel=h(1591,"Disable Highlight In Strings")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(Qu.includeStrings,!1,us.USER)}}class v_ extends X{static{this.ID="editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters"}constructor(){super({id:v_.ID,title:I(1592,"Disable highlighting of ambiguous characters"),precondition:void 0,f1:!1}),this.shortLabel=h(1593,"Disable Ambiguous Highlight")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(Qu.ambiguousCharacters,!1,us.USER)}}class DD extends X{static{this.ID="editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters"}constructor(){super({id:DD.ID,title:I(1594,"Disable highlighting of invisible characters"),precondition:void 0,f1:!1}),this.shortLabel=h(1595,"Disable Invisible Highlight")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(Qu.invisibleCharacters,!1,us.USER)}}class kD extends X{static{this.ID="editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters"}constructor(){super({id:kD.ID,title:I(1596,"Disable highlighting of non basic ASCII characters"),precondition:void 0,f1:!1}),this.shortLabel=h(1597,"Disable Non ASCII Highlight")}async run(e,t,i){const n=e?.get(ne);n&&this.runAction(n)}async runAction(e){await e.updateValue(Qu.nonBasicASCII,!1,us.USER)}}class L0 extends X{static{this.ID="editor.action.unicodeHighlight.showExcludeOptions"}constructor(){super({id:L0.ID,title:I(1598,"Show Exclude Options"),precondition:void 0,f1:!1})}async run(e,t){const{codePoint:i,reason:n,inString:o,inComment:r}=t,a=String.fromCodePoint(i),c=e.get(Wt),d=e.get(ne);function l(v){return Pse.isInvisibleCharacter(v)?h(1599,"Exclude {0} (invisible character) from being highlighted",KG(v)):h(1600,"Exclude {0} from being highlighted",`${KG(v)} "${a}"`)}const u=[];if(n.kind===pm.Ambiguous)for(const v of n.notAmbiguousInLocales)u.push({label:h(1601,'Allow unicode characters that are more common in the language "{0}".',v),run:async()=>{TGe(d,[v])}});if(u.push({label:l(i),run:()=>kGe(d,[i])}),r){const v=new IGe;u.push({label:v.label,run:async()=>v.runAction(d)})}else if(o){const v=new DGe;u.push({label:v.label,run:async()=>v.runAction(d)})}function g(v){return typeof v.desc.title=="string"?v.desc.title:v.desc.title.value}if(n.kind===pm.Ambiguous){const v=new v_;u.push({label:g(v),run:async()=>v.runAction(d)})}else if(n.kind===pm.Invisible){const v=new DD;u.push({label:g(v),run:async()=>v.runAction(d)})}else if(n.kind===pm.NonBasicAscii){const v=new kD;u.push({label:g(v),run:async()=>v.runAction(d)})}else AGe(n);const m=await c.pick(u,{title:Rpe});m&&await m.run()}}async function kGe(s,e){const t=s.getValue(Qu.allowedCharacters);let i;typeof t=="object"&&t?i=t:i={};for(const n of e)i[String.fromCodePoint(n)]=!0;await s.updateValue(Qu.allowedCharacters,i,us.USER)}async function TGe(s,e){const t=s.inspect(Qu.allowedLocales).user?.value;let i;typeof t=="object"&&t?i=Object.assign({},t):i={};for(const n of e)i[n]=!0;await s.updateValue(Qu.allowedLocales,i,us.USER)}function AGe(s){throw new Error(`Unexpected value: ${s}`)}Y(v_);Y(DD);Y(kD);Y(L0);Lt(jx.ID,jx,_t.AfterFirstRender);d_.register(qG);const Lpe="ignoreUnusualLineTerminators";function RGe(s,e,t){s.setModelProperty(e.uri,Lpe,t)}function PGe(s,e){return s.getModelProperty(e.uri,Lpe)}let _M=class extends F{static{this.ID="editor.contrib.unusualLineTerminatorsDetector"}constructor(e,t,i){super(),this._editor=e,this._dialogService=t,this._codeEditorService=i,this._isPresentingDialog=!1,this._config=this._editor.getOption(L.unusualLineTerminators),this._register(this._editor.onDidChangeConfiguration(n=>{n.hasChanged(L.unusualLineTerminators)&&(this._config=this._editor.getOption(L.unusualLineTerminators),this._checkForUnusualLineTerminators())})),this._register(this._editor.onDidChangeModel(()=>{this._checkForUnusualLineTerminators()})),this._register(this._editor.onDidChangeModelContent(n=>{n.isUndoing||this._checkForUnusualLineTerminators()})),this._checkForUnusualLineTerminators()}async _checkForUnusualLineTerminators(){if(this._config==="off"||!this._editor.hasModel())return;const e=this._editor.getModel();if(!e.mightContainUnusualLineTerminators()||PGe(this._codeEditorService,e)===!0||this._editor.getOption(L.readOnly))return;if(this._config==="auto"){e.removeUnusualLineTerminators(this._editor.getSelections());return}if(this._isPresentingDialog)return;let i;try{this._isPresentingDialog=!0,i=await this._dialogService.confirm({title:h(1602,"Unusual Line Terminators"),message:h(1603,"Detected unusual line terminators"),detail:h(1604,"The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).\n\nIt is recommended to remove them from the file. This can be configured via `editor.unusualLineTerminators`.",Qe(e.uri)),primaryButton:h(1605,"&&Remove Unusual Line Terminators"),cancelButton:h(1606,"Ignore")})}finally{this._isPresentingDialog=!1}if(!i.confirmed){RGe(this._codeEditorService,e,!0);return}e.removeUnusualLineTerminators(this._editor.getSelections())}};_M=f([p(1,ei),p(2,Bt)],_M);Lt(_M.ID,_M,_t.AfterFirstRender);class hie{constructor(){this.selector={language:"*"}}provideDocumentHighlights(e,t,i){const n=[],o=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});return o?e.isDisposed()?void 0:e.findMatches(o.word,!0,!1,!0,_8,!1).map(a=>({range:a.range,kind:rA.Text})):Promise.resolve(n)}provideMultiDocumentHighlights(e,t,i,n){const o=new In,r=e.getWordAtPosition({lineNumber:t.lineNumber,column:t.column});if(!r)return Promise.resolve(o);for(const a of[e,...i]){if(a.isDisposed())continue;const d=a.findMatches(r.word,!0,!1,!0,_8,!1).map(l=>({range:l.range,kind:rA.Text}));d&&o.set(a.uri,d)}return o}}let jG=class extends F{constructor(e){super(),this._register(e.documentHighlightProvider.register("*",new hie)),this._register(e.multiDocumentHighlightProvider.register("*",new hie))}};jG=f([p(0,Ne)],jG);var ln,YG;const n6=new O("hasWordHighlights",!1);function Mpe(s,e,t,i){const n=s.ordered(e);return eq(n.map(o=>()=>Promise.resolve(o.provideDocumentHighlights(e,t,i)).then(void 0,Ln)),o=>o!=null).then(o=>{if(o){const r=new In;return r.set(e.uri,o),r}return new In})}function LGe(s,e,t,i,n){const o=s.ordered(e);return eq(o.map(r=>()=>{const a=n.filter(c=>Cu(c)).filter(c=>zN(r.selector,c.uri,c.getLanguageId(),!0,void 0,void 0)>0);return Promise.resolve(r.provideMultiDocumentHighlights(e,t,a,i)).then(void 0,Ln)}),r=>r!=null)}class Npe{constructor(e,t,i){this._model=e,this._selection=t,this._wordSeparators=i,this._wordRange=this._getCurrentWordRange(e,t),this._result=null}get result(){return this._result||(this._result=Tn(e=>this._compute(this._model,this._selection,this._wordSeparators,e))),this._result}_getCurrentWordRange(e,t){const i=e.getWordAtPosition(t.getPosition());return i?new P(t.startLineNumber,i.startColumn,t.startLineNumber,i.endColumn):null}isValid(e,t,i){const n=t.startLineNumber,o=t.startColumn,r=t.endColumn,a=this._getCurrentWordRange(e,t);let c=!!(this._wordRange&&this._wordRange.equalsRange(a));for(let d=0,l=i.length;!c&&d<l;d++){const u=i.getRange(d);u&&u.startLineNumber===n&&u.startColumn<=o&&u.endColumn>=r&&(c=!0)}return c}cancel(){this.result.cancel()}}class MGe extends Npe{constructor(e,t,i,n){super(e,t,i),this._providers=n}_compute(e,t,i,n){return Mpe(this._providers,e,t.getPosition(),n).then(o=>o||new In)}}class NGe extends Npe{constructor(e,t,i,n,o){super(e,t,i),this._providers=n,this._otherModels=o}_compute(e,t,i,n){return LGe(this._providers,e,t.getPosition(),n,this._otherModels).then(o=>o||new In)}}function OGe(s,e,t,i){return new MGe(e,t,i,s)}function FGe(s,e,t,i,n){return new NGe(e,t,i,s,n)}Or("_executeDocumentHighlights",async(s,e,t)=>{const i=s.get(Ne);return(await Mpe(i.documentHighlightProvider,e,t,Ce.None))?.get(e.uri)});let QG=class{static{ln=this}static{this.storedDecorationIDs=new In}static{this.query=null}constructor(e,t,i,n,o,r,a,c){this.toUnhook=new U,this.workerRequestTokenId=0,this.workerRequestCompleted=!1,this.workerRequestValue=new In,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=-1,this.runDelayer=this.toUnhook.add(new ju(50)),this.editor=e,this.providers=t,this.multiDocumentProviders=i,this.codeEditorService=r,this.textModelService=o,this.configurationService=a,this.logService=c,this._hasWordHighlights=n6.bindTo(n),this._ignorePositionChangeEvent=!1,this.occurrencesHighlightEnablement=this.editor.getOption(L.occurrencesHighlight),this.occurrencesHighlightDelay=this.configurationService.getValue("editor.occurrencesHighlightDelay"),this.model=this.editor.getModel(),this.toUnhook.add(e.onDidChangeCursorPosition(d=>{this._ignorePositionChangeEvent||this.occurrencesHighlightEnablement!=="off"&&this.runDelayer.trigger(()=>{this._onPositionChanged(d)})})),this.toUnhook.add(e.onDidFocusEditorText(d=>{this.occurrencesHighlightEnablement!=="off"&&(this.workerRequest||this.runDelayer.trigger(()=>{this._run()}))})),this.toUnhook.add(e.onDidChangeModelContent(d=>{RE(this.model.uri,"output")||this._stopAll()})),this.toUnhook.add(e.onDidChangeModel(d=>{!d.newModelUrl&&d.oldModelUrl?this._stopSingular():ln.query&&this._run()})),this.toUnhook.add(e.onDidChangeConfiguration(d=>{const l=this.editor.getOption(L.occurrencesHighlight);if(this.occurrencesHighlightEnablement!==l)switch(this.occurrencesHighlightEnablement=l,l){case"off":this._stopAll();break;case"singleFile":this._stopAll(ln.query?.modelInfo?.modelURI);break;case"multiFile":ln.query&&this._run(!0);break;default:console.warn("Unknown occurrencesHighlight setting value:",l);break}})),this.toUnhook.add(this.configurationService.onDidChangeConfiguration(d=>{if(d.affectsConfiguration("editor.occurrencesHighlightDelay")){const l=a.getValue("editor.occurrencesHighlightDelay");this.occurrencesHighlightDelay!==l&&(this.occurrencesHighlightDelay=l)}})),this.toUnhook.add(e.onDidBlurEditorWidget(()=>{const d=this.codeEditorService.getFocusedCodeEditor();d?d.getModel()?.uri.scheme===ae.vscodeNotebookCell&&this.editor.getModel()?.uri.scheme!==ae.vscodeNotebookCell&&this._stopAll():this._stopAll()})),this.decorations=this.editor.createDecorationsCollection(),this.workerRequestTokenId=0,this.workerRequest=null,this.workerRequestCompleted=!1,this.lastCursorPositionChangeTime=0,this.renderDecorationsTimer=-1,ln.query&&this._run()}hasDecorations(){return this.decorations.length>0}restore(e){this.occurrencesHighlightEnablement!=="off"&&(this.runDelayer.cancel(),this.runDelayer.trigger(()=>{this._run(!1,e)}))}trigger(){this.runDelayer.cancel(),this._run(!1,0)}stop(){this.occurrencesHighlightEnablement!=="off"&&this._stopAll()}_getSortedHighlights(){return this.decorations.getRanges().sort(P.compareRangesUsingStarts)}moveNext(){const e=this._getSortedHighlights(),i=(e.findIndex(o=>o.containsPosition(this.editor.getPosition()))+1)%e.length,n=e[i];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);const o=this._getWord();if(o){const r=this.editor.getModel().getLineContent(n.startLineNumber);na(`${r}, ${i+1} of ${e.length} for '${o.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}moveBack(){const e=this._getSortedHighlights(),i=(e.findIndex(o=>o.containsPosition(this.editor.getPosition()))-1+e.length)%e.length,n=e[i];try{this._ignorePositionChangeEvent=!0,this.editor.setPosition(n.getStartPosition()),this.editor.revealRangeInCenterIfOutsideViewport(n);const o=this._getWord();if(o){const r=this.editor.getModel().getLineContent(n.startLineNumber);na(`${r}, ${i+1} of ${e.length} for '${o.word}'`)}}finally{this._ignorePositionChangeEvent=!1}}_removeSingleDecorations(){if(!this.editor.hasModel())return;const e=ln.storedDecorationIDs.get(this.editor.getModel().uri);e&&(this.editor.removeDecorations(e),ln.storedDecorationIDs.delete(this.editor.getModel().uri),this.decorations.length>0&&(this.decorations.clear(),this._hasWordHighlights.set(!1)))}_removeAllDecorations(e){const t=this.codeEditorService.listCodeEditors(),i=[];for(const n of t){if(!n.hasModel()||At(n.getModel().uri,e))continue;const o=ln.storedDecorationIDs.get(n.getModel().uri);if(!o)continue;n.removeDecorations(o),i.push(n.getModel().uri);const r=nf.get(n);r?.wordHighlighter&&r.wordHighlighter.decorations.length>0&&(r.wordHighlighter.decorations.clear(),r.wordHighlighter.workerRequest=null,r.wordHighlighter._hasWordHighlights.set(!1))}for(const n of i)ln.storedDecorationIDs.delete(n)}_stopSingular(){this._removeSingleDecorations(),this.editor.hasTextFocus()&&(this.editor.getModel()?.uri.scheme!==ae.vscodeNotebookCell&&ln.query?.modelInfo?.modelURI.scheme!==ae.vscodeNotebookCell?(ln.query=null,this._run()):ln.query?.modelInfo&&(ln.query.modelInfo=null)),this.renderDecorationsTimer!==-1&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=-1),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||(this.workerRequestTokenId++,this.workerRequestCompleted=!0)}_stopAll(e){this._removeAllDecorations(e),this.renderDecorationsTimer!==-1&&(clearTimeout(this.renderDecorationsTimer),this.renderDecorationsTimer=-1),this.workerRequest!==null&&(this.workerRequest.cancel(),this.workerRequest=null),this.workerRequestCompleted||(this.workerRequestTokenId++,this.workerRequestCompleted=!0)}_onPositionChanged(e){if(this.occurrencesHighlightEnablement==="off"){this._stopAll();return}if(e.source!=="api"&&e.reason!==Ws.Explicit){this._stopAll();return}this._run()}_getWord(){const e=this.editor.getSelection(),t=e.startLineNumber,i=e.startColumn;return this.model.isDisposed()?null:this.model.getWordAtPosition({lineNumber:t,column:i})}getOtherModelsToHighlight(e){if(!e)return[];if(e.uri.scheme===ae.vscodeNotebookCell){const o=[],r=this.codeEditorService.listCodeEditors();for(const a of r){const c=a.getModel();c&&c!==e&&c.uri.scheme===ae.vscodeNotebookCell&&o.push(c)}return o}const i=[],n=this.codeEditorService.listCodeEditors();for(const o of n){if(!Zu(o))continue;const r=o.getModel();r&&e===r.modified&&i.push(r.modified)}if(i.length)return i;if(this.occurrencesHighlightEnablement==="singleFile")return[];for(const o of n){const r=o.getModel();r&&r!==e&&i.push(r)}return i}async _run(e,t){if(this.editor.hasTextFocus()){const n=this.editor.getSelection();if(!n||n.startLineNumber!==n.endLineNumber){ln.query=null,this._stopAll();return}const o=n.startColumn,r=n.endColumn,a=this._getWord();if(!a||a.startColumn>o||a.endColumn<r){ln.query=null,this._stopAll();return}ln.query={modelInfo:{modelURI:this.model.uri,selection:n}}}else if(!ln.query){this._stopAll();return}if(this.lastCursorPositionChangeTime=new Date().getTime(),At(this.editor.getModel().uri,ln.query.modelInfo?.modelURI)){if(!e){const a=this.decorations.getRanges();for(const c of a)if(c.containsPosition(this.editor.getPosition()))return}this._stopAll(e?this.model.uri:void 0);const n=++this.workerRequestTokenId;this.workerRequestCompleted=!1;const o=this.getOtherModelsToHighlight(this.editor.getModel());if(!ln.query||!ln.query.modelInfo)return;const r=await this.textModelService.createModelReference(ln.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(r.object.textEditorModel,ln.query.modelInfo.selection,o),this.workerRequest?.result.then(a=>{n===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=a||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},mt)}catch(a){this.logService.error("Unexpected error during occurrence request. Log: ",a)}finally{r.dispose()}}else if(this.model.uri.scheme===ae.vscodeNotebookCell){const n=++this.workerRequestTokenId;if(this.workerRequestCompleted=!1,!ln.query||!ln.query.modelInfo)return;const o=await this.textModelService.createModelReference(ln.query.modelInfo.modelURI);try{this.workerRequest=this.computeWithModel(o.object.textEditorModel,ln.query.modelInfo.selection,[this.model]),this.workerRequest?.result.then(r=>{n===this.workerRequestTokenId&&(this.workerRequestCompleted=!0,this.workerRequestValue=r||[],this._beginRenderDecorations(t??this.occurrencesHighlightDelay))},mt)}catch(r){this.logService.error("Unexpected error during occurrence request. Log: ",r)}finally{o.dispose()}}}computeWithModel(e,t,i){return i.length?FGe(this.multiDocumentProviders,e,t,this.editor.getOption(L.wordSeparators),i):OGe(this.providers,e,t,this.editor.getOption(L.wordSeparators))}_beginRenderDecorations(e){const t=new Date().getTime(),i=this.lastCursorPositionChangeTime+e;t>=i?(this.renderDecorationsTimer=-1,this.renderDecorations()):this.renderDecorationsTimer=setTimeout(()=>{this.renderDecorations()},i-t)}renderDecorations(){this.renderDecorationsTimer=-1;const e=this.codeEditorService.listCodeEditors();for(const t of e){const i=nf.get(t);if(!i)continue;const n=[],o=t.getModel()?.uri;if(o&&this.workerRequestValue.has(o)){const r=ln.storedDecorationIDs.get(o),a=this.workerRequestValue.get(o);if(a)for(const d of a)d.range&&n.push({range:d.range,options:D3e(d.kind)});let c=[];t.changeDecorations(d=>{c=d.deltaDecorations(r??[],n)}),ln.storedDecorationIDs=ln.storedDecorationIDs.set(o,c),n.length>0&&(i.wordHighlighter?.decorations.set(n),i.wordHighlighter?._hasWordHighlights.set(!0))}}this.workerRequest=null}dispose(){this._stopSingular(),this.toUnhook.dispose()}};QG=ln=f([p(4,Ci),p(5,Bt),p(6,ne),p(7,Re)],QG);let nf=class extends F{static{YG=this}static{this.ID="editor.contrib.wordHighlighter"}static get(e){return e.getContribution(YG.ID)}constructor(e,t,i,n,o,r,a){super(),this._wordHighlighter=null;const c=()=>{e.hasModel()&&!e.getModel().isTooLargeForTokenization()&&e.getModel().uri.scheme!==ae.accessibleView&&(this._wordHighlighter=new QG(e,i.documentHighlightProvider,i.multiDocumentHighlightProvider,t,o,n,r,a))};this._register(e.onDidChangeModel(d=>{this._wordHighlighter&&(!d.newModelUrl&&d.oldModelUrl?.scheme!==ae.vscodeNotebookCell&&this.wordHighlighter?.stop(),this._wordHighlighter.dispose(),this._wordHighlighter=null),c()})),c()}get wordHighlighter(){return this._wordHighlighter}saveViewState(){return!!(this._wordHighlighter&&this._wordHighlighter.hasDecorations())}moveNext(){this._wordHighlighter?.moveNext()}moveBack(){this._wordHighlighter?.moveBack()}restoreViewState(e){this._wordHighlighter&&e&&this._wordHighlighter.restore(250)}stopHighlighting(){this._wordHighlighter?.stop()}dispose(){this._wordHighlighter&&(this._wordHighlighter.dispose(),this._wordHighlighter=null),super.dispose()}};nf=YG=f([p(1,fe),p(2,Ne),p(3,Bt),p(4,Ci),p(5,ne),p(6,Re)],nf);class Ope extends Se{constructor(e,t){super(t),this._isNext=e}run(e,t){const i=nf.get(t);i&&(this._isNext?i.moveNext():i.moveBack())}}class WGe extends Ope{constructor(){super(!0,{id:"editor.action.wordHighlight.next",label:I(1616,"Go to Next Symbol Highlight"),precondition:n6,kbOpts:{kbExpr:V.editorTextFocus,primary:S.F7,weight:W.EditorContrib}})}}class BGe extends Ope{constructor(){super(!1,{id:"editor.action.wordHighlight.prev",label:I(1617,"Go to Previous Symbol Highlight"),precondition:n6,kbOpts:{kbExpr:V.editorTextFocus,primary:E.Shift|S.F7,weight:W.EditorContrib}})}}class VGe extends Se{constructor(){super({id:"editor.action.wordHighlight.trigger",label:I(1618,"Trigger Symbol Highlight"),precondition:void 0,kbOpts:{kbExpr:V.editorTextFocus,primary:0,weight:W.EditorContrib}})}run(e,t,i){const n=nf.get(t);n&&n.restoreViewState(!0)}}Lt(nf.ID,nf,_t.Eager);ue(WGe);ue(BGe);ue(VGe);pS(jG);class M0 extends Vo{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,i){if(!t.hasModel())return;const n=Vv(t.getOption(L.wordSeparators),t.getOption(L.wordSegmenterLocales)),o=t.getModel(),r=t.getSelections(),a=r.length>1,c=r.map(d=>{const l=new we(d.positionLineNumber,d.positionColumn),u=this._move(n,o,l,this._wordNavigationType,a);return this._moveTo(d,u,this._inSelectionMode)});if(o.pushStackElement(),t._getViewModel().setCursorStates("moveWordCommand",Ws.Explicit,c.map(d=>BSe.fromModelSelection(d))),c.length===1){const d=new we(c[0].positionLineNumber,c[0].positionColumn);t.revealPosition(d,Qi.Smooth)}}_moveTo(e,t,i){return i?new at(e.selectionStartLineNumber,e.selectionStartColumn,t.lineNumber,t.column):new at(t.lineNumber,t.column,t.lineNumber,t.column)}}class Rf extends M0{_move(e,t,i,n,o){return fI.moveWordLeft(e,t,i,n,o)}}class Pf extends M0{_move(e,t,i,n,o){return fI.moveWordRight(e,t,i,n)}}class HGe extends Rf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordStart,id:"cursorWordStartLeft",precondition:void 0})}}class UGe extends Rf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordEnd,id:"cursorWordEndLeft",precondition:void 0})}}class $Ge extends Rf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordStartFast,id:"cursorWordLeft",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(uI,cN)?.negate()),primary:E.CtrlCmd|S.LeftArrow,mac:{primary:E.Alt|S.LeftArrow},weight:W.EditorContrib}})}}class GGe extends Rf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordStart,id:"cursorWordStartLeftSelect",precondition:void 0})}}class zGe extends Rf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordEnd,id:"cursorWordEndLeftSelect",precondition:void 0})}}class qGe extends Rf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordStartFast,id:"cursorWordLeftSelect",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(uI,cN)?.negate()),primary:E.CtrlCmd|E.Shift|S.LeftArrow,mac:{primary:E.Alt|E.Shift|S.LeftArrow},weight:W.EditorContrib}})}}class KGe extends Rf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordAccessibility,id:"cursorWordAccessibilityLeft",precondition:void 0})}_move(e,t,i,n,o){return super._move(Vv(cI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class jGe extends Rf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordAccessibility,id:"cursorWordAccessibilityLeftSelect",precondition:void 0})}_move(e,t,i,n,o){return super._move(Vv(cI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class YGe extends Pf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordStart,id:"cursorWordStartRight",precondition:void 0})}}class QGe extends Pf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordEnd,id:"cursorWordEndRight",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(uI,cN)?.negate()),primary:E.CtrlCmd|S.RightArrow,mac:{primary:E.Alt|S.RightArrow},weight:W.EditorContrib}})}}class XGe extends Pf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordEnd,id:"cursorWordRight",precondition:void 0})}}class ZGe extends Pf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordStart,id:"cursorWordStartRightSelect",precondition:void 0})}}class JGe extends Pf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordEnd,id:"cursorWordEndRightSelect",precondition:void 0,kbOpts:{kbExpr:x.and(V.textInputFocus,x.and(uI,cN)?.negate()),primary:E.CtrlCmd|E.Shift|S.RightArrow,mac:{primary:E.Alt|E.Shift|S.RightArrow},weight:W.EditorContrib}})}}class eze extends Pf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordEnd,id:"cursorWordRightSelect",precondition:void 0})}}class tze extends Pf{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordAccessibility,id:"cursorWordAccessibilityRight",precondition:void 0})}_move(e,t,i,n,o){return super._move(Vv(cI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class ize extends Pf{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordAccessibility,id:"cursorWordAccessibilityRightSelect",precondition:void 0})}_move(e,t,i,n,o){return super._move(Vv(cI.wordSeparators.defaultValue,e.intlSegmenterLocales),t,i,n,o)}}class N0 extends Vo{constructor(e){super(e),this._whitespaceHeuristics=e.whitespaceHeuristics,this._wordNavigationType=e.wordNavigationType}runEditorCommand(e,t,i){const n=e.get(ds);if(!t.hasModel())return;const o=Vv(t.getOption(L.wordSeparators),t.getOption(L.wordSegmenterLocales)),r=t.getModel(),a=t.getSelections(),c=t.getOption(L.autoClosingBrackets),d=t.getOption(L.autoClosingQuotes),l=n.getLanguageConfiguration(r.getLanguageId()).getAutoClosingPairs(),u=t._getViewModel(),g=a.map(m=>{const v=this._delete({wordSeparators:o,model:r,selection:m,whitespaceHeuristics:this._whitespaceHeuristics,autoClosingDelete:t.getOption(L.autoClosingDelete),autoClosingBrackets:c,autoClosingQuotes:d,autoClosingPairs:l,autoClosedCharacters:u.getCursorAutoClosedCharacters()},this._wordNavigationType);return new pI(v,"")});t.pushUndoStop(),t.executeCommands(this.id,g),t.pushUndoStop()}}class s6 extends N0{_delete(e,t){const i=fI.deleteWordLeft(e,t);return i||new P(1,1,1,1)}}class o6 extends N0{_delete(e,t){const i=fI.deleteWordRight(e,t);if(i)return i;const n=e.model.getLineCount(),o=e.model.getLineMaxColumn(n);return new P(n,o,n,o)}}class nze extends s6{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:Nn.WordStart,id:"deleteWordStartLeft",precondition:V.writable})}}class sze extends s6{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:Nn.WordEnd,id:"deleteWordEndLeft",precondition:V.writable})}}class oze extends s6{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:Nn.WordStart,id:"deleteWordLeft",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Backspace,mac:{primary:E.Alt|S.Backspace},weight:W.EditorContrib}})}}class rze extends o6{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:Nn.WordStart,id:"deleteWordStartRight",precondition:V.writable})}}class aze extends o6{constructor(){super({whitespaceHeuristics:!1,wordNavigationType:Nn.WordEnd,id:"deleteWordEndRight",precondition:V.writable})}}class cze extends o6{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:Nn.WordEnd,id:"deleteWordRight",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:E.CtrlCmd|S.Delete,mac:{primary:E.Alt|S.Delete},weight:W.EditorContrib}})}}class dze extends Se{constructor(){super({id:"deleteInsideWord",precondition:V.writable,label:I(1619,"Delete Word")})}run(e,t,i){if(!t.hasModel())return;const n=Vv(t.getOption(L.wordSeparators),t.getOption(L.wordSegmenterLocales)),o=t.getModel(),a=t.getSelections().map(c=>{const d=fI.deleteInsideWord(n,o,c);return new pI(d,"")});t.pushUndoStop(),t.executeCommands(this.id,a),t.pushUndoStop()}}ze(new HGe);ze(new UGe);ze(new $Ge);ze(new GGe);ze(new zGe);ze(new qGe);ze(new YGe);ze(new QGe);ze(new XGe);ze(new ZGe);ze(new JGe);ze(new eze);ze(new KGe);ze(new jGe);ze(new tze);ze(new ize);ze(new nze);ze(new sze);ze(new oze);ze(new rze);ze(new aze);ze(new cze);ue(dze);class lze extends N0{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:Nn.WordStart,id:"deleteWordPartLeft",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.Backspace},weight:W.EditorContrib}})}_delete(e,t){const i=mN.deleteWordPartLeft(e);return i||new P(1,1,1,1)}}class hze extends N0{constructor(){super({whitespaceHeuristics:!0,wordNavigationType:Nn.WordEnd,id:"deleteWordPartRight",precondition:V.writable,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.Delete},weight:W.EditorContrib}})}_delete(e,t){const i=mN.deleteWordPartRight(e);if(i)return i;const n=e.model.getLineCount(),o=e.model.getLineMaxColumn(n);return new P(n,o,n,o)}}class Fpe extends M0{_move(e,t,i,n,o){return mN.moveWordPartLeft(e,t,i,o)}}class uze extends Fpe{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordStart,id:"cursorWordPartLeft",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.LeftArrow},weight:W.EditorContrib}})}}Ee.registerCommandAlias("cursorWordPartStartLeft","cursorWordPartLeft");class gze extends Fpe{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordStart,id:"cursorWordPartLeftSelect",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|E.Shift|S.LeftArrow},weight:W.EditorContrib}})}}Ee.registerCommandAlias("cursorWordPartStartLeftSelect","cursorWordPartLeftSelect");class Wpe extends M0{_move(e,t,i,n,o){return mN.moveWordPartRight(e,t,i)}}class pze extends Wpe{constructor(){super({inSelectionMode:!1,wordNavigationType:Nn.WordEnd,id:"cursorWordPartRight",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|S.RightArrow},weight:W.EditorContrib}})}}class fze extends Wpe{constructor(){super({inSelectionMode:!0,wordNavigationType:Nn.WordEnd,id:"cursorWordPartRightSelect",precondition:void 0,kbOpts:{kbExpr:V.textInputFocus,primary:0,mac:{primary:E.WinCtrl|E.Alt|E.Shift|S.RightArrow},weight:W.EditorContrib}})}}ze(new lze);ze(new hze);ze(new uze);ze(new gze);ze(new pze);ze(new fze);class uie extends F{static{this.ID="editor.contrib.readOnlyMessageController"}constructor(e){super(),this.editor=e,this._register(this.editor.onDidAttemptReadOnlyEdit(()=>this._onDidAttemptReadOnlyEdit()))}_onDidAttemptReadOnlyEdit(){const e=Dr.get(this.editor);if(e&&this.editor.hasModel()){let t=this.editor.getOptions().get(L.readOnlyMessage);t||(this.editor.isSimpleWidget?t=new Gi(h(1426,"Cannot edit in read-only input")):t=new Gi(h(1427,"Cannot edit in read-only editor"))),e.showMessage(t,this.editor.getPosition())}}}Lt(uie.ID,uie,_t.BeforeFirstInteraction);let XG=class extends F{constructor(e,t,i){super(),this._textModel=e,this._languageFeaturesService=t,this._outlineModelService=i,this._currentModel=si(this,void 0);const n=sA("documentSymbolProvider.onDidChange",this._languageFeaturesService.documentSymbolProvider.onDidChange),o=sA("_textModel.onDidChangeContent",T.debounce(r=>this._textModel.onDidChangeContent(r),()=>{},100));this._register(ka(async(r,a)=>{n.read(r),o.read(r);const c=a.add(new HSe),d=await this._outlineModelService.getOrCreate(this._textModel,c.token);a.isDisposed||this._currentModel.set(d,void 0)}))}getBreadcrumbItems(e,t){const i=this._currentModel.read(t);if(!i)return[];const n=i.asListOfDocumentSymbols().filter(o=>e.contains(o.range.startLineNumber)&&!e.contains(o.range.endLineNumber));return n.sort(owe(rd(o=>o.range.endLineNumber-o.range.startLineNumber,fl))),n.map(o=>({name:o.name,kind:o.kind,startLineNumber:o.range.startLineNumber}))}};XG=f([p(1,Ne),p(2,TI)],XG);VSe.setBreadcrumbsSourceFactory((s,e)=>e.createInstance(XG,s));const mze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(mze);class gie extends F{static{this.ID="editor.contrib.iPadShowKeyboard"}constructor(e){super(),this.editor=e,this.widget=null,kE&&(this._register(e.onDidChangeConfiguration(()=>this.update())),this.update())}update(){const e=!this.editor.getOption(L.readOnly);!this.widget&&e?this.widget=new r6(this.editor):this.widget&&!e&&(this.widget.dispose(),this.widget=null)}dispose(){super.dispose(),this.widget&&(this.widget.dispose(),this.widget=null)}}class r6 extends F{static{this.ID="editor.contrib.ShowKeyboardWidget"}constructor(e){super(),this.editor=e,this._domNode=document.createElement("textarea"),this._domNode.className="iPadShowKeyboard",this._register(re(this._domNode,"touchstart",t=>{this.editor.focus()})),this._register(re(this._domNode,"focus",t=>{this.editor.focus()})),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),super.dispose()}getId(){return r6.ID}getDomNode(){return this._domNode}getPosition(){return{preference:SI.BOTTOM_RIGHT_CORNER}}}Lt(gie.ID,gie,_t.Eventually);const Bpe="inQuickOpen",vze=new O(Bpe,!1,h(3525,"Whether keyboard focus is inside the quick open control")),kl=x.has(Bpe),_ze="inFilesPicker",Vpe=x.and(kl,x.has(_ze));function vS(s,e){return t=>{const i=t.get(He),n=t.get(Wt),r={keybindings:i.lookupKeybindings(s)};n.navigate(!!e,r)}}let pie=class extends F{constructor(e,t){super(),this.editorService=e,this.editorGroupsService=t,this._editorViewState=void 0,this.openedTransientEditors=new Set}set(){if(this._editorViewState)return;const e=this.editorService.activeEditorPane;e&&(this._editorViewState={group:e.group,editor:e.input,state:bCe(e.getControl())?.saveViewState()??void 0})}async openTransientEditor(e,t){e.options={...e.options,transient:!0};const i=await this.editorService.openEditor(e,t);return i?.input&&i.input!==this._editorViewState?.editor&&i.group.isTransient(i.input)&&this.openedTransientEditors.add(i.input),i}async restore(){if(this._editorViewState){for(const e of this.openedTransientEditors)if(!e.isDirty())for(const t of this.editorGroupsService.groups)t.isTransient(e)&&await t.closeEditor(e,{preserveFocus:!0});await this._editorViewState.group.openEditor(this._editorViewState.editor,{viewState:this._editorViewState.state,preserveFocus:!0}),this.reset()}}reset(){this._editorViewState=void 0,this.openedTransientEditors.clear()}dispose(){super.dispose(),this.reset()}};pie=f([p(0,de),p(1,xe)],pie);let ZG=class extends rwe{constructor(e,t,i,n,o,r){super(t,n,o,r,e),this.keybindingService=i,this.inQuickInputContext=vze.bindTo(this.contextKeyService),this.registerListeners()}registerListeners(){this._register(this.onShow(()=>this.inQuickInputContext.set(!0))),this._register(this.onHide(()=>this.inQuickInputContext.set(!1)))}createController(){return super.createController(this.layoutService,{ignoreFocusOut:()=>!this.configurationService.getValue("workbench.quickOpen.closeOnFocusLost"),backKeybindingLabel:()=>this.keybindingService.lookupKeybinding("workbench.action.quickInputBack")?.getLabel()||void 0})}};ZG=f([p(0,ne),p(1,Z),p(2,He),p(3,fe),p(4,pt),p(5,af)],ZG);function bze(s){const e=new Map;for(const t of s)e.set(t,(e.get(t)??0)+1);return e}class _E{constructor(){this.chunkCount=0,this.chunkOccurrences=new Map,this.documents=new Map}calculateScores(e,t){const i=this.computeEmbedding(e),n=new Map,o=[];for(const[r,a]of this.documents){if(t.isCancellationRequested)return[];for(const c of a.chunks){const d=this.computeSimilarityScore(c,i,n);d>0&&o.push({key:r,score:d})}}return o}static termFrequencies(e){return bze(_E.splitTerms(e))}static*splitTerms(e){const t=i=>i.toLowerCase();for(const[i]of e.matchAll(/\b\p{Letter}[\p{Letter}\d]{2,}\b/gu)){yield t(i);const n=i.replace(/([a-z])([A-Z])/g,"$1 $2").split(/\s+/g);if(n.length>1)for(const o of n)o.length>2&&/\p{Letter}{3,}/gu.test(o)&&(yield t(o))}}updateDocuments(e){for(const{key:t}of e)this.deleteDocument(t);for(const t of e){const i=[];for(const n of t.textChunks){const o=_E.termFrequencies(n);for(const r of o.keys())this.chunkOccurrences.set(r,(this.chunkOccurrences.get(r)??0)+1);i.push({text:n,tf:o})}this.chunkCount+=i.length,this.documents.set(t.key,{chunks:i})}return this}deleteDocument(e){const t=this.documents.get(e);if(t){this.documents.delete(e),this.chunkCount-=t.chunks.length;for(const i of t.chunks)for(const n of i.tf.keys()){const o=this.chunkOccurrences.get(n);if(typeof o=="number"){const r=o-1;r<=0?this.chunkOccurrences.delete(n):this.chunkOccurrences.set(n,r)}}}}computeSimilarityScore(e,t,i){let n=0;for(const[o,r]of Object.entries(t)){const a=e.tf.get(o);if(!a)continue;let c=i.get(o);typeof c!="number"&&(c=this.computeIdf(o),i.set(o,c));const d=a*c;n+=d*r}return n}computeEmbedding(e){const t=_E.termFrequencies(e);return this.computeTfidf(t)}computeIdf(e){const t=this.chunkOccurrences.get(e)??0;return t>0?Math.log((this.chunkCount+1)/t):0}computeTfidf(e){const t=Object.create(null);for(const[i,n]of e){const o=this.computeIdf(i);o>0&&(t[i]=n*o)}return t}}function yze(s){const e=s.slice(0);e.sort((i,n)=>n.score-i.score);const t=e[0]?.score??0;if(t>0)for(const i of e)i.score/=t;return e}var Yf,_n;let JG=class extends P4{static{Yf=this}static{this.PREFIX=">"}static{this.TFIDF_THRESHOLD=.5}static{this.TFIDF_MAX_RESULTS=5}static{this.WORD_FILTER=aA(Bz,zg,tq)}constructor(e,t,i,n,o,r){super(Yf.PREFIX,e),this.keybindingService=i,this.commandService=n,this.telemetryService=o,this.dialogService=r,this.commandsHistory=this._register(t.createInstance(Yx)),this.options=e}async _getPicks(e,t,i,n){const o=await this.getCommandPicks(i);if(i.isCancellationRequested)return[];const r=_w(()=>{const m=new _E;m.updateDocuments(o.map(_=>({key:_.commandId,textChunks:[this.getTfIdfChunk(_)]})));const v=m.calculateScores(e,i);return yze(v).filter(_=>_.score>Yf.TFIDF_THRESHOLD).slice(0,Yf.TFIDF_MAX_RESULTS)}),a=[];for(const m of o){const v=Yf.WORD_FILTER(e,m.label)??void 0,_=m.commandAlias?Yf.WORD_FILTER(e,m.commandAlias)??void 0:void 0;if(v||_)m.highlights={label:v,detail:this.options.showAlias?_:void 0},a.push(m);else if(e===m.commandId)a.push(m);else if(e.length>=3){const w=r();if(i.isCancellationRequested)return[];const C=w.find(k=>k.key===m.commandId);C&&(m.tfIdfScore=C.score,a.push(m))}}const c=new Map;for(const m of a){const v=c.get(m.label);v?(m.description=m.commandId,v.description=v.commandId):c.set(m.label,m)}a.sort((m,v)=>{if(m.tfIdfScore&&v.tfIdfScore)return m.tfIdfScore===v.tfIdfScore?m.label.localeCompare(v.label):v.tfIdfScore-m.tfIdfScore;if(m.tfIdfScore)return 1;if(v.tfIdfScore)return-1;const _=this.commandsHistory.peek(m.commandId),w=this.commandsHistory.peek(v.commandId);if(_&&w)return _>w?-1:1;if(_)return-1;if(w)return 1;if(this.options.suggestedCommandIds){const C=this.options.suggestedCommandIds.has(m.commandId),k=this.options.suggestedCommandIds.has(v.commandId);if(C&&k)return 0;if(C)return-1;if(k)return 1}return m.label.localeCompare(v.label)});const d=[];let l=!1,u=!0,g=!!this.options.suggestedCommandIds;for(let m=0;m<a.length;m++){const v=a[m];m===0&&this.commandsHistory.peek(v.commandId)&&(d.push({type:"separator",label:h(1937,"recently used")}),l=!0),u&&v.tfIdfScore!==void 0&&(d.push({type:"separator",label:h(1938,"similar commands")}),u=!1),g&&v.tfIdfScore===void 0&&!this.commandsHistory.peek(v.commandId)&&this.options.suggestedCommandIds?.has(v.commandId)&&(d.push({type:"separator",label:h(1939,"commonly used")}),l=!0,g=!1),l&&v.tfIdfScore===void 0&&!this.commandsHistory.peek(v.commandId)&&!this.options.suggestedCommandIds?.has(v.commandId)&&(d.push({type:"separator",label:h(1940,"other commands")}),l=!1),d.push(this.toCommandPick(v,n))}return this.hasAdditionalCommandPicks(e,i)?{picks:d,additionalPicks:(async()=>{const m=await this.getAdditionalCommandPicks(o,a,e,i);if(i.isCancellationRequested)return[];const v=m.map(_=>this.toCommandPick(_,n));return u&&v[0]?.type!=="separator"&&v.unshift({type:"separator",label:h(1938,"similar commands")}),v})()}:d}toCommandPick(e,t){if(e.type==="separator")return e;const i=this.keybindingService.lookupKeybinding(e.commandId),n=i?h(1941,"{0}, {1}",e.label,i.getAriaLabel()):e.label;return{...e,ariaLabel:n,detail:this.options.showAlias&&e.commandAlias!==e.label?e.commandAlias:void 0,keybinding:i,accept:async()=>{this.commandsHistory.push(e.commandId),this.telemetryService.publicLog2("workbenchActionExecuted",{id:e.commandId,from:t?.from??"quick open"});try{e.args?.length?await this.commandService.executeCommand(e.commandId,...e.args):await this.commandService.executeCommand(e.commandId)}catch(o){ys(o)||this.dialogService.error(h(1942,"Command '{0}' resulted in an error",e.label),bo(o))}}}}getTfIdfChunk({label:e,commandAlias:t,commandDescription:i}){let n=e;return t&&t!==e&&(n+=` - ${t}`),i&&i.value!==e&&(n+=` - ${i.value===i.original?i.value:`${i.value} (${i.original})`}`),n}};JG=Yf=f([p(1,Z),p(2,He),p(3,Ge),p(4,ai),p(5,ei)],JG);let Yx=class extends F{static{_n=this}static{this.DEFAULT_COMMANDS_HISTORY_LENGTH=50}static{this.PREF_KEY_CACHE="commandPalette.mru.cache"}static{this.PREF_KEY_COUNTER="commandPalette.mru.counter"}static{this.counter=1}static{this.hasChanges=!1}constructor(e,t,i){super(),this.storageService=e,this.configurationService=t,this.logService=i,this.configuredCommandsHistoryLength=0,this.updateConfiguration(),this.load(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.updateConfiguration(e))),this._register(this.storageService.onWillSaveState(e=>{e.reason===Jx.SHUTDOWN&&this.saveState()}))}updateConfiguration(e){e&&!e.affectsConfiguration("workbench.commandPalette.history")||(this.configuredCommandsHistoryLength=_n.getConfiguredCommandHistoryLength(this.configurationService),_n.cache&&_n.cache.limit!==this.configuredCommandsHistoryLength&&(_n.cache.limit=this.configuredCommandsHistoryLength,_n.hasChanges=!0))}load(){const e=this.storageService.get(_n.PREF_KEY_CACHE,he.PROFILE);let t;if(e)try{t=JSON.parse(e)}catch(n){this.logService.error(`[CommandsHistory] invalid data: ${n}`)}const i=_n.cache=new zm(this.configuredCommandsHistoryLength,1);if(t){let n;t.usesLRU?n=t.entries:n=t.entries.sort((o,r)=>o.value-r.value),n.forEach(o=>i.set(o.key,o.value))}_n.counter=this.storageService.getNumber(_n.PREF_KEY_COUNTER,he.PROFILE,_n.counter)}push(e){_n.cache&&(_n.cache.set(e,_n.counter++),_n.hasChanges=!0)}peek(e){return _n.cache?.peek(e)}saveState(){if(!_n.cache||!_n.hasChanges)return;const e={usesLRU:!0,entries:[]};_n.cache.forEach((t,i)=>e.entries.push({key:i,value:t})),this.storageService.store(_n.PREF_KEY_CACHE,JSON.stringify(e),he.PROFILE,gt.USER),this.storageService.store(_n.PREF_KEY_COUNTER,_n.counter,he.PROFILE,gt.USER),_n.hasChanges=!1}static getConfiguredCommandHistoryLength(e){const i=e.getValue().workbench?.commandPalette?.history;return typeof i=="number"?i:_n.DEFAULT_COMMANDS_HISTORY_LENGTH}static clearHistory(e,t){const i=_n.getConfiguredCommandHistoryLength(e);_n.cache=new zm(i),_n.counter=1,_n.hasChanges=!0}};Yx=_n=f([p(0,it),p(1,ne),p(2,Re)],Yx);class wze extends JG{constructor(e,t,i,n,o,r){super(e,t,i,n,o,r)}getCodeEditorCommandPicks(){const e=this.activeTextEditorControl;if(!e)return[];const t=[];for(const i of e.getSupportedActions()){let n;i.metadata?.description&&(Lse(i.metadata.description)?n=i.metadata.description:n={original:i.metadata.description,value:i.metadata.description}),t.push({commandId:i.id,commandAlias:i.alias,commandDescription:n,label:Mse(i.label)||i.id})}return t}}const Sze="workbench.action.chat.open",Cze="workbench.action.quickchat.toggle";var ez;(function(s){s[s.SymbolInformation=1]="SymbolInformation",s[s.CommandInformation=2]="CommandInformation",s[s.SearchInformation=3]="SearchInformation",s[s.SettingInformation=4]="SettingInformation"})(ez||(ez={}));function Eze(s){const e=[],t=new Map,i=(n,o)=>{if(!t.has(n)&&(t.set(n,!0),!(n[0]==="_"||n.indexOf("vscode.")===0)&&s.get(n)!==!0)){if(!o){const r=Ee.getCommand(n);if(r&&typeof r.metadata=="object"&&An(r.metadata.args))return}e.push(n)}};for(const n of ge.getMenuItems(N.CommandPalette))jie(n)&&i(n.command.id,!0);for(const n of TE.getEditorActions())i(n.id,!0);for(const n of Ee.getCommands().keys())i(n,!1);return e}var kc;const mF="keybinding.entry.template",fie=h(12487,"System"),mie=h(12488,"Extension"),vie=h(12489,"User");function xze(s,e){const t=e?` +when:${e}`:"";return`@command:${s}${t}`}const Ize=aA(Bz,zg,tq),Dze=/@command:\s*([^\+]+)/i,kze=/\+when:\s*(.+)/i,_ie=/@source:\s*(user|default|system|extension)/i,bie=/@ext:\s*((".+")|([^\s]+))/i,Tze=/@keybinding:\s*((\".+\")|(\S+))/i;let yie=kc=class extends Gv{constructor(e,t,i){super(),this.keybindingsService=t,this.extensionService=i,this._keybindingItems=[],this._keybindingItemsSortedByPrecedence=[],this.modifierLabels={ui:dwe.modifierLabels[e],aria:cwe.modifierLabels[e],user:awe.modifierLabels[e]}}fetch(e,t=!1){let i=t?this._keybindingItemsSortedByPrecedence:this._keybindingItems;const n=Dze.exec(e);if(n&&n[1]){const o=n[1].trim();let r=i.filter(a=>a.command===o);if(r.length){const a=kze.exec(e);if(a&&a[1]){const c=a[1].trim();r=this.filterByWhen(r,o,c)}}return r.map(a=>({id:kc.getId(a),keybindingItem:a,templateId:mF}))}if(_ie.test(e))i=this.filterBySource(i,e),e=e.replace(_ie,"");else{const o=bie.exec(e);if(o&&(o[2]||o[3])){const r=o[2]?o[2].substring(1,o[2].length-1):o[3];i=this.filterByExtension(i,r),e=e.replace(bie,"")}else{const r=Tze.exec(e);r&&(r[2]||r[3])&&(e=r[2]||`"${r[3]}"`)}}return e=e.trim(),e?this.filterByText(i,e):i.map(o=>({id:kc.getId(o),keybindingItem:o,templateId:mF}))}filterBySource(e,t){return/@source:\s*default/i.test(t)||/@source:\s*system/i.test(t)?e.filter(i=>i.source===fie):/@source:\s*user/i.test(t)?e.filter(i=>i.source===vie):/@source:\s*extension/i.test(t)?e.filter(i=>!Tt(i.source)||i.source===mie):e}filterByExtension(e,t){return t=t.toLowerCase().trim(),e.filter(i=>!Tt(i.source)&&(vs.equals(i.source.identifier,t)||i.source.displayName?.toLowerCase()===t.toLowerCase()))}filterByText(e,t){const i=t.charAt(0)==='"',n=t.charAt(t.length-1)==='"',o=i&&n;i&&(t=t.substring(1)),n&&(t=t.substring(0,t.length-1)),t=t.trim();const r=[],a=t.split(" "),c=this.splitKeybindingWords(a);for(const d of e){const l=new Aze(this.modifierLabels,d,t,a,c,o);(l.commandIdMatches||l.commandLabelMatches||l.commandDefaultLabelMatches||l.sourceMatches||l.whenMatches||l.keybindingMatches||l.extensionIdMatches||l.extensionLabelMatches)&&r.push({id:kc.getId(d),templateId:mF,commandLabelMatches:l.commandLabelMatches||void 0,commandDefaultLabelMatches:l.commandDefaultLabelMatches||void 0,keybindingItem:d,keybindingMatches:l.keybindingMatches||void 0,commandIdMatches:l.commandIdMatches||void 0,sourceMatches:l.sourceMatches||void 0,whenMatches:l.whenMatches||void 0,extensionIdMatches:l.extensionIdMatches||void 0,extensionLabelMatches:l.extensionLabelMatches||void 0})}return r}filterByWhen(e,t,i){if(e.length===0)return[];const n=e.filter(c=>c.when===i);if(n.length)return n;const o=e[0].commandLabel,r=new b8(void 0,t,null,x.deserialize(i),!1,null,!1),a=new Map([[t,o]]);return[kc.toKeybindingEntry(t,r,a,this.getExtensionsMapping())]}splitKeybindingWords(e){const t=[];for(const i of e)t.push(...$t(i.split("+")));return t}async resolve(e=new Map){const t=this.getExtensionsMapping();this._keybindingItemsSortedByPrecedence=[];const i=new Map;for(const o of this.keybindingsService.getKeybindings())o.command&&(this._keybindingItemsSortedByPrecedence.push(kc.toKeybindingEntry(o.command,o,e,t)),i.set(o.command,!0));const n=this.keybindingsService.getDefaultKeybindings().map(o=>o.command);for(const o of Eze(i)){const r=new b8(void 0,o,null,void 0,n.indexOf(o)===-1,null,!1);this._keybindingItemsSortedByPrecedence.push(kc.toKeybindingEntry(o,r,e,t))}return this._keybindingItemsSortedByPrecedence=iI(this._keybindingItemsSortedByPrecedence,o=>kc.getId(o)),this._keybindingItems=this._keybindingItemsSortedByPrecedence.slice(0).sort((o,r)=>kc.compareKeybindingData(o,r)),super.resolve()}static getId(e){return e.command+(e?.keybinding?.getAriaLabel()??"")+e.when+(Tt(e.source)?e.source:e.source.identifier.value)}getExtensionsMapping(){const e=new Po;for(const t of this.extensionService.extensions)e.set(t.identifier,t);return e}static compareKeybindingData(e,t){return e.keybinding&&!t.keybinding?-1:t.keybinding&&!e.keybinding?1:e.commandLabel&&!t.commandLabel?-1:t.commandLabel&&!e.commandLabel?1:e.commandLabel&&t.commandLabel&&e.commandLabel!==t.commandLabel?e.commandLabel.localeCompare(t.commandLabel):e.command===t.command?e.keybindingItem.isDefault?1:-1:e.command.localeCompare(t.command)}static toKeybindingEntry(e,t,i,n){const o=ge.getCommand(e),r=i.get(e);let a=vie;if(t.isDefault){const c=t.extensionId??(t.resolvedKeybinding?void 0:o?.source?.id);a=c?n.get(c)??mie:fie}return{keybinding:t.resolvedKeybinding,keybindingItem:t,command:e,commandLabel:kc.getCommandLabel(o,r),commandDefaultLabel:kc.getCommandDefaultLabel(o),when:t.when?t.when.serialize():"",source:a}}static getCommandDefaultLabel(e){if(!$T.isDefaultVariant()&&e&&e.title&&e.title.original){const t=e.category?e.category.original:void 0,i=e.title.original;return t?h(12490,"{0}: {1}",t,i):i}return null}static getCommandLabel(e,t){if(e){const i=e.category?typeof e.category=="string"?e.category:e.category.value:void 0,n=typeof e.title=="string"?e.title:e.title.value;return i?h(12490,"{0}: {1}",i,n):n}return t||""}};yie=kc=f([p(1,He),p(2,cn)],yie);class Aze{constructor(e,t,i,n,o,r){this.modifierLabels=e,this.commandIdMatches=null,this.commandLabelMatches=null,this.commandDefaultLabelMatches=null,this.sourceMatches=null,this.whenMatches=null,this.keybindingMatches=null,this.extensionIdMatches=null,this.extensionLabelMatches=null,r||(this.commandIdMatches=this.matches(i,t.command,aA(zg,y8),n),this.commandLabelMatches=t.commandLabel?this.matches(i,t.commandLabel,(a,c)=>zg(a,t.commandLabel,!0),n):null,this.commandDefaultLabelMatches=t.commandDefaultLabel?this.matches(i,t.commandDefaultLabel,(a,c)=>zg(a,t.commandDefaultLabel,!0),n):null,this.whenMatches=t.when?this.matches(null,t.when,aA(zg,y8),n):null,Tt(t.source)?this.sourceMatches=this.matches(i,t.source,(a,c)=>zg(a,t.source,!0),n):this.extensionLabelMatches=t.source.displayName?this.matches(i,t.source.displayName,(a,c)=>zg(a,t.commandLabel,!0),n):null),this.keybindingMatches=t.keybinding?this.matchesKeybinding(t.keybinding,i,o,r):null}matches(e,t,i,n){let o=e?Ize(e,t):null;return o||(o=this.matchesWords(n,t,i)),o&&(o=this.filterAndSort(o)),o}matchesWords(e,t,i){let n=[];for(const o of e){const r=i(o,t);if(r)n=[...n||[],...r];else{n=null;break}}return n}filterAndSort(e){return iI(e,t=>t.start+"."+t.end).filter(t=>!e.some(i=>!(i.start===t.start&&i.end===t.end)&&i.start<=t.start&&i.end>=t.end)).sort((t,i)=>t.start-i.start)}matchesKeybinding(e,t,i,n){const[o,r]=e.getChords(),a=e.getUserSettingsLabel(),c=e.getAriaLabel(),d=e.getLabel();if(a&&OS(t,a)===0||c&&OS(t,c)===0||d&&OS(t,d)===0)return{firstPart:this.createCompleteMatch(o),chordPart:this.createCompleteMatch(r)};const l={};let u={};const g=[],m=[];let v=[],_=!0;for(let w=0;w<i.length;w++){const C=i[w];let k=!1,D=!1;_=_&&!l.keyCode;let A=!u.keyCode;if(_&&(k=this.matchPart(o,l,C,n),l.keyCode)){for(const B of v)m.indexOf(B)===-1&&g.splice(g.indexOf(B),1);u={},v=[],A=!1}A&&(D=this.matchPart(r,u,C,n)),k&&m.push(w),D&&v.push(w),(k||D)&&g.push(w),_=_&&this.isModifier(C)}return g.length!==i.length||n&&(!this.isCompleteMatch(o,l)||!HT(u)&&!this.isCompleteMatch(r,u))?null:this.hasAnyMatch(l)||this.hasAnyMatch(u)?{firstPart:l,chordPart:u}:null}matchPart(e,t,i,n){let o=!1;return this.matchesMetaModifier(e,i)&&(o=!0,t.metaKey=!0),this.matchesCtrlModifier(e,i)&&(o=!0,t.ctrlKey=!0),this.matchesShiftModifier(e,i)&&(o=!0,t.shiftKey=!0),this.matchesAltModifier(e,i)&&(o=!0,t.altKey=!0),this.matchesKeyCode(e,i,n)&&(t.keyCode=!0,o=!0),o}matchesKeyCode(e,t,i){if(!e)return!1;const n=e.keyAriaLabel||"";if(i||n.length===1||t.length===1){if(OS(n,t)===0)return!0}else if(tq(t,n))return!0;return!1}matchesMetaModifier(e,t){return!e||!e.metaKey?!1:this.wordMatchesMetaModifier(t)}matchesCtrlModifier(e,t){return!e||!e.ctrlKey?!1:this.wordMatchesCtrlModifier(t)}matchesShiftModifier(e,t){return!e||!e.shiftKey?!1:this.wordMatchesShiftModifier(t)}matchesAltModifier(e,t){return!e||!e.altKey?!1:this.wordMatchesAltModifier(t)}hasAnyMatch(e){return!!e.altKey||!!e.ctrlKey||!!e.metaKey||!!e.shiftKey||!!e.keyCode}isCompleteMatch(e,t){return e?!(!t.keyCode||e.metaKey&&!t.metaKey||e.altKey&&!t.altKey||e.ctrlKey&&!t.ctrlKey||e.shiftKey&&!t.shiftKey):!0}createCompleteMatch(e){const t={};return e&&(t.keyCode=!0,e.metaKey&&(t.metaKey=!0),e.altKey&&(t.altKey=!0),e.ctrlKey&&(t.ctrlKey=!0),e.shiftKey&&(t.shiftKey=!0)),t}isModifier(e){return!!(this.wordMatchesAltModifier(e)||this.wordMatchesCtrlModifier(e)||this.wordMatchesMetaModifier(e)||this.wordMatchesShiftModifier(e))}wordMatchesAltModifier(e){return!!(oo(this.modifierLabels.ui.altKey,e)||oo(this.modifierLabels.aria.altKey,e)||oo(this.modifierLabels.user.altKey,e)||oo(h(12491,"option"),e))}wordMatchesCtrlModifier(e){return!!(oo(this.modifierLabels.ui.ctrlKey,e)||oo(this.modifierLabels.aria.ctrlKey,e)||oo(this.modifierLabels.user.ctrlKey,e))}wordMatchesMetaModifier(e){return!!(oo(this.modifierLabels.ui.metaKey,e)||oo(this.modifierLabels.aria.metaKey,e)||oo(this.modifierLabels.user.metaKey,e)||oo(h(12492,"meta"),e))}wordMatchesShiftModifier(e){return!!(oo(this.modifierLabels.ui.shiftKey,e)||oo(this.modifierLabels.aria.shiftKey,e)||oo(this.modifierLabels.user.shiftKey,e))}}var AT;let Tv=class extends wze{static{AT=this}static{this.AI_RELATED_INFORMATION_MAX_PICKS=5}static{this.AI_RELATED_INFORMATION_DEBOUNCE=200}get activeTextEditorControl(){return this.editorService.activeTextEditorControl}get defaultFilterValue(){if(this.configuration.preserveInput)return lwe.LAST}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super({showAlias:!$T.isDefaultVariant(),noResultsPick:()=>({label:h(8850,"No matching commands"),commandId:""})},n,o,r,a,c),this.editorService=e,this.menuService=t,this.configurationService=d,this.editorGroupService=l,this.preferencesService=u,this.productService=g,this.aiRelatedInformationService=m,this.chatAgentService=v,this.useAiRelatedInfo=!1,this.extensionRegistrationRace=ese(i.whenInstalledExtensionsRegistered(),800),this._register(d.onDidChangeConfiguration(_=>this.updateOptions(_))),this.updateOptions()}get configuration(){const e=this.configurationService.getValue().workbench.commandPalette;return{preserveInput:e.preserveInput,experimental:e.experimental}}updateOptions(e){if(e&&!e.affectsConfiguration("workbench.commandPalette.experimental"))return;const t=this.configuration,i=t.experimental.suggestCommands&&this.productService.commandPaletteSuggestedCommandIds?.length?new Set(this.productService.commandPaletteSuggestedCommandIds):void 0;this.options.suggestedCommandIds=i,this.useAiRelatedInfo=t.experimental.enableNaturalLanguageSearch}async getCommandPicks(e){return await this.extensionRegistrationRace,e.isCancellationRequested?[]:[...this.getCodeEditorCommandPicks(),...this.getGlobalCommandPicks()].map(t=>({...t,buttons:[{iconClass:ke.asClassName(K.gear),tooltip:h(8851,"Configure Keybinding")}],trigger:()=>(this.preferencesService.openGlobalKeybindingSettings(!1,{query:xze(t.commandId,t.commandWhen)}),yu.CLOSE_PICKER)}))}hasAdditionalCommandPicks(e,t){return!(!this.useAiRelatedInfo||t.isCancellationRequested||e===""||!this.aiRelatedInformationService.isEnabled())}async getAdditionalCommandPicks(e,t,i,n){if(!this.hasAdditionalCommandPicks(i,n))return[];let o;try{await Da(AT.AI_RELATED_INFORMATION_DEBOUNCE,n),o=await this.getRelatedInformationPicks(e,t,i,n)}catch{return[]}(t.length||o.length)&&o.push({type:"separator"});const r=this.chatAgentService.getDefaultAgent($i.Panel);return r&&o.push({label:h(8852,"Ask {0}: {1}",r.fullName,i),commandId:this.configuration.experimental.askChatLocation==="quickChat"?Cze:Sze,args:[i]}),o}async getRelatedInformationPicks(e,t,i,n){const o=await this.aiRelatedInformationService.getRelatedInformation(i,[ez.CommandInformation],n);o.sort((c,d)=>d.weight-c.weight);const r=new Set(t.map(c=>c.commandId)),a=new Array;for(const c of o){if(a.length===AT.AI_RELATED_INFORMATION_MAX_PICKS)break;const d=e.find(l=>l.commandId===c.command&&!r.has(l.commandId));d&&a.push(d)}return a}getGlobalCommandPicks(){const e=[],t=this.editorService.activeEditorPane?.scopedContextKeyService||this.editorGroupService.activeGroup.scopedContextKeyService,n=this.menuService.getMenuActions(N.CommandPalette,t).reduce((o,[,r])=>[...o,...r],[]).filter(o=>o instanceof wr&&o.enabled);for(const o of n){let r=(typeof o.item.title=="string"?o.item.title:o.item.title.value)||o.item.id;const a=typeof o.item.category=="string"?o.item.category:o.item.category?.value;a&&(r=h(8853,"{0}: {1}",a,r));const c=typeof o.item.title!="string"?o.item.title.original:void 0,d=a&&o.item.category&&typeof o.item.category!="string"?o.item.category.original:void 0,l=c&&a?d?`${d}: ${c}`:`${a}: ${c}`:c,u=o.item.metadata?.description,g=u===void 0||Lse(u)?u:{value:u,original:u};e.push({commandId:o.item.id,commandWhen:o.item.precondition?.serialize(),commandAlias:l,label:Mse(r),commandDescription:g})}return e}};Tv=AT=f([p(0,de),p(1,fn),p(2,cn),p(3,Z),p(4,He),p(5,Ge),p(6,ai),p(7,ei),p(8,ne),p(9,xe),p(10,Hv),p(11,Vn),p(12,Bq),p(13,pf)],Tv);class Lf extends X{static{this.ID="workbench.action.showCommands"}constructor(){super({id:Lf.ID,title:I(8854,"Show All Commands"),keybinding:{weight:W.WorkbenchContrib,when:void 0,primary:ZM?void 0:E.CtrlCmd|E.Shift|S.KeyP,secondary:[S.F1]},f1:!0})}async run(e){e.get(Wt).quickAccess.show(Tv.PREFIX)}}class Rze extends X{constructor(){super({id:"workbench.action.clearCommandHistory",title:I(8855,"Clear Command History"),f1:!0})}async run(e){const t=e.get(ne),i=e.get(it),n=e.get(ei);if(Yx.getConfiguredCommandHistoryLength(t)>0){const{confirmed:r}=await n.confirm({type:"warning",message:h(8856,"Do you want to clear the history of recently used commands?"),detail:h(8857,"This action is irreversible!"),primaryButton:h(8858,"&&Clear")});if(!r)return;Yx.clearHistory(t,i)}}}class Hpe{constructor(e){this.options=e,this.rangeHighlightDecorationId=void 0}provide(e,t,i){const n=new U;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;const o=n.add(new Pt);return o.value=this.doProvide(e,t,i),n.add(this.onDidActiveTextEditorControlChange(()=>{o.value=void 0,o.value=this.doProvide(e,t)})),n}doProvide(e,t,i){const n=new U,o=this.activeTextEditorControl;if(o&&this.canProvideWithTextEditor(o)){const r={editor:o},a=mI(o);if(a){let c=o.saveViewState()??void 0;n.add(a.onDidChangeCursorPosition(()=>{c=o.saveViewState()??void 0})),r.restoreViewState=()=>{c&&o===this.activeTextEditorControl&&o.restoreViewState(c)},n.add(_w(t.onCancellationRequested)(()=>r.restoreViewState?.()))}n.add(Ie(()=>this.clearDecorations(o))),n.add(this.provideWithTextEditor(r,e,t,i))}else n.add(this.provideWithoutTextEditor(e,t));return n}canProvideWithTextEditor(e){return!0}gotoLocation({editor:e},t){e.setSelection(t.range,td.JUMP),e.revealRangeInCenter(t.range,Qi.Smooth),t.preserveFocus||e.focus();const i=e.getModel();i&&"getLineContent"in i&&zc(`${i.getLineContent(t.range.startLineNumber)}`)}getModel(e){return Zu(e)?e.getModel()?.modified:e.getModel()}addDecorations(e,t){e.changeDecorations(i=>{const n=[];this.rangeHighlightDecorationId&&(n.push(this.rangeHighlightDecorationId.overviewRulerDecorationId),n.push(this.rangeHighlightDecorationId.rangeHighlightId),this.rangeHighlightDecorationId=void 0);const o=[{range:t,options:{description:"quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:t,options:{description:"quick-access-range-highlight-overview",overviewRuler:{color:ns(Dse),position:il.Full}}}],[r,a]=i.deltaDecorations(n,o);this.rangeHighlightDecorationId={rangeHighlightId:r,overviewRulerDecorationId:a}})}clearDecorations(e){const t=this.rangeHighlightDecorationId;t&&(e.changeDecorations(i=>{i.deltaDecorations([t.overviewRulerDecorationId,t.rangeHighlightId],[])}),this.rangeHighlightDecorationId=void 0)}}class O0 extends Hpe{static{this.PREFIX=":"}constructor(){super({canAcceptInBackground:!0})}provideWithoutTextEditor(e){const t=h(1389,"Open a text editor first to go to a line.");return e.items=[{label:t}],e.ariaLabel=t,F.None}provideWithTextEditor(e,t,i){const n=e.editor,o=new U;o.add(t.onDidAccept(c=>{const[d]=t.selectedItems;if(d){if(!this.isValidLineNumber(n,d.lineNumber))return;this.gotoLocation(e,{range:this.toRange(d.lineNumber,d.column),keyMods:t.keyMods,preserveFocus:c.inBackground}),c.inBackground||t.hide()}}));const r=()=>{const c=this.parsePosition(n,t.value.trim().substr(O0.PREFIX.length)),d=this.getPickLabel(n,c.lineNumber,c.column);if(t.items=[{lineNumber:c.lineNumber,column:c.column,label:d}],t.ariaLabel=d,!this.isValidLineNumber(n,c.lineNumber)){this.clearDecorations(n);return}const l=this.toRange(c.lineNumber,c.column);n.revealRangeInCenter(l,Qi.Smooth),this.addDecorations(n,l)};r(),o.add(t.onDidChangeValue(()=>r()));const a=mI(n);return a&&a.getOptions().get(L.lineNumbers).renderType===hs.Relative&&(a.updateOptions({lineNumbers:"on"}),o.add(Ie(()=>a.updateOptions({lineNumbers:"relative"})))),o}toRange(e=1,t=1){return{startLineNumber:e,startColumn:t,endLineNumber:e,endColumn:t}}parsePosition(e,t){const i=t.split(/,|:|#/).map(o=>parseInt(o,10)).filter(o=>!isNaN(o)),n=this.lineCount(e)+1;return{lineNumber:i[0]>0?i[0]:n+i[0],column:i[1]}}getPickLabel(e,t,i){if(this.isValidLineNumber(e,t))return this.isValidColumn(e,t,i)?h(1390,"Go to line {0} and character {1}.",t,i):h(1391,"Go to line {0}.",t);const n=e.getPosition()||{lineNumber:1,column:1},o=this.lineCount(e);return o>1?h(1392,"Current Line: {0}, Character: {1}. Type a line number between 1 and {2} to navigate to.",n.lineNumber,n.column,o):h(1393,"Current Line: {0}, Character: {1}. Type a line number to navigate to.",n.lineNumber,n.column)}isValidLineNumber(e,t){return!t||typeof t!="number"?!1:t>0&&t<=this.lineCount(e)}isValidColumn(e,t,i){if(!i||typeof i!="number")return!1;const n=this.getModel(e);if(!n)return!1;const o={lineNumber:t,column:i};return n.validatePosition(o).equals(o)}lineCount(e){return this.getModel(e)?.getLineCount()??0}}let bM=class extends O0{constructor(e,t,i){super(),this.editorService=e,this.editorGroupService=t,this.configurationService=i,this.onDidActiveTextEditorControlChange=this.editorService.onDidActiveEditorChange}get configuration(){const e=this.configurationService.getValue().workbench?.editor;return{openEditorPinned:!e?.enablePreviewFromQuickOpen||!e?.enablePreview}}get activeTextEditorControl(){return this.editorService.activeTextEditorControl}gotoLocation(e,t){if((t.keyMods.alt||this.configuration.openEditorPinned&&t.keyMods.ctrlCmd||t.forceSideBySide)&&this.editorService.activeEditor){e.restoreViewState?.();const i={selection:t.range,pinned:t.keyMods.ctrlCmd||this.configuration.openEditorPinned,preserveFocus:t.preserveFocus};this.editorGroupService.sideGroup.openEditor(this.editorService.activeEditor,i)}else super.gotoLocation(e,t)}};bM=f([p(0,de),p(1,xe),p(2,ne)],bM);class F0 extends X{static{this.ID="workbench.action.gotoLine"}constructor(){super({id:F0.ID,title:I(5164,"Go to Line/Column..."),f1:!0,keybinding:{weight:W.WorkbenchContrib,when:null,primary:E.CtrlCmd|S.KeyG,mac:{primary:E.WinCtrl|S.KeyG}}})}async run(e){e.get(Wt).quickAccess.show(bM.PREFIX)}}Y(F0);Ke.as(dN.Quickaccess).registerQuickAccessProvider({ctor:bM,prefix:O0.PREFIX,placeholder:h(5165,"Type the line number and optional column to go to (e.g. 42:5 for line 42 and column 5)."),helpEntries:[{description:h(5166,"Go to Line/Column"),commandId:F0.ID}]});var RT;let Gm=class extends Hpe{static{RT=this}static{this.PREFIX="@"}static{this.SCOPE_PREFIX=":"}static{this.PREFIX_BY_CATEGORY=`${this.PREFIX}${this.SCOPE_PREFIX}`}constructor(e,t,i=Object.create(null)){super(i),this._languageFeaturesService=e,this._outlineModelService=t,this.options=i,this.options.canAcceptInBackground=!0}provideWithoutTextEditor(e){return this.provideLabelPick(e,h(1394,"To go to a symbol, first open a text editor with symbol information.")),F.None}provideWithTextEditor(e,t,i,n){const o=e.editor,r=this.getModel(o);return r?this._languageFeaturesService.documentSymbolProvider.has(r)?this.doProvideWithEditorSymbols(e,r,t,i,n):this.doProvideWithoutEditorSymbols(e,r,t,i):F.None}doProvideWithoutEditorSymbols(e,t,i,n){const o=new U;return this.provideLabelPick(i,h(1395,"The active text editor does not provide symbol information.")),(async()=>!await this.waitForLanguageSymbolRegistry(t,o)||n.isCancellationRequested||o.add(this.doProvideWithEditorSymbols(e,t,i,n)))(),o}provideLabelPick(e,t){e.items=[{label:t,index:0,kind:kt.String}],e.ariaLabel=t}async waitForLanguageSymbolRegistry(e,t){if(this._languageFeaturesService.documentSymbolProvider.has(e))return!0;const i=new aa,n=t.add(this._languageFeaturesService.documentSymbolProvider.onDidChange(()=>{this._languageFeaturesService.documentSymbolProvider.has(e)&&(n.dispose(),i.complete(!0))}));return t.add(Ie(()=>i.complete(!1))),i.p}doProvideWithEditorSymbols(e,t,i,n,o){const r=e.editor,a=new U;a.add(i.onDidAccept(u=>{const[g]=i.selectedItems;g&&g.range&&(this.gotoLocation(e,{range:g.range.selection,keyMods:i.keyMods,preserveFocus:u.inBackground}),o?.handleAccept?.(g,u.inBackground),u.inBackground||i.hide())})),a.add(i.onDidTriggerItemButton(({item:u})=>{u&&u.range&&(this.gotoLocation(e,{range:u.range.selection,keyMods:i.keyMods,forceSideBySide:!0}),i.hide())}));const c=this.getDocumentSymbols(t,n),d=a.add(new Pt),l=async u=>{d?.value?.cancel(),i.busy=!1,d.value=new li,i.busy=!0;try{const g=Cx(i.value.substr(RT.PREFIX.length).trim()),m=await this.doGetSymbolPicks(c,g,void 0,d.value.token,t);if(n.isCancellationRequested)return;if(m.length>0){if(i.items=m,u&&g.original.length===0){const v=GM(m,_=>!!(_.type!=="separator"&&_.range&&P.containsPosition(_.range.decoration,u)));v&&(i.activeItems=[v])}}else g.original.length>0?this.provideLabelPick(i,h(1396,"No matching editor symbols")):this.provideLabelPick(i,h(1397,"No editor symbols"))}finally{n.isCancellationRequested||(i.busy=!1)}};return a.add(i.onDidChangeValue(()=>l(void 0))),l(r.getSelection()?.getPosition()),a.add(i.onDidChangeActive(()=>{const[u]=i.activeItems;u&&u.range&&(r.revealRangeInCenter(u.range.selection,Qi.Smooth),this.addDecorations(r,u.range.decoration))})),a}async doGetSymbolPicks(e,t,i,n,o){const r=await e;if(n.isCancellationRequested)return[];const a=t.original.indexOf(RT.SCOPE_PREFIX)===0,c=a?1:0;let d,l;t.values&&t.values.length>1?(d=LZ(t.values[0]),l=LZ(t.values.slice(1))):d=t;let u;const g=this.options?.openSideBySideDirection?.();g&&(u=[{iconClass:g==="right"?ke.asClassName(K.splitHorizontal):ke.asClassName(K.splitVertical),tooltip:g==="right"?h(1398,"Open to the Side"):h(1399,"Open to the Bottom")}]);const m=[];for(let w=0;w<r.length;w++){const C=r[w],k=Uz(C.name),D=`$(${Rne.toIcon(C.kind).id}) ${k}`,A=D.length-k.length;let B=C.containerName;i?.extraContainerLabel&&(B?B=`${i.extraContainerLabel}  ${B}`:B=i.extraContainerLabel);let q,Q,ie,oe;if(t.original.length>c){let me=!1;if(d!==t&&([q,Q]=$1(D,{...t,values:void 0},c,A),typeof q=="number"&&(me=!0)),typeof q!="number"&&([q,Q]=$1(D,d,c,A),typeof q!="number"))continue;if(!me&&l){if(B&&l.original.length>0&&([ie,oe]=$1(B,l)),typeof ie!="number")continue;typeof q=="number"&&(q+=ie)}}const be=C.tags&&C.tags.indexOf(EF.Deprecated)>=0;m.push({index:w,kind:C.kind,score:q,label:D,ariaLabel:hwe(C.name,C.kind),description:B,highlights:be?void 0:{label:Q,description:oe},range:{selection:P.collapseToStart(C.selectionRange),decoration:C.range},uri:o.uri,symbolName:k,strikethrough:be,buttons:u})}const v=m.sort((w,C)=>a?this.compareByKindAndScore(w,C):this.compareByScore(w,C));let _=[];if(a){let D=function(){C&&typeof w=="number"&&k>0&&(C.label=Oz(_F[w]||vF,k))},w,C,k=0;for(const A of v)w!==A.kind?(D(),w=A.kind,k=1,C={type:"separator"},_.push(C)):k++,_.push(A);D()}else v.length>0&&(_=[{label:h(1400,"symbols ({0})",m.length),type:"separator"},...v]);return _}compareByScore(e,t){if(typeof e.score!="number"&&typeof t.score=="number")return 1;if(typeof e.score=="number"&&typeof t.score!="number")return-1;if(typeof e.score=="number"&&typeof t.score=="number"){if(e.score>t.score)return-1;if(e.score<t.score)return 1}return e.index<t.index?-1:e.index>t.index?1:0}compareByKindAndScore(e,t){const i=_F[e.kind]||vF,n=_F[t.kind]||vF,o=i.localeCompare(n);return o===0?this.compareByScore(e,t):o}async getDocumentSymbols(e,t){const i=await this._outlineModelService.getOrCreate(e,t);return t.isCancellationRequested?[]:i.asListOfDocumentSymbols()}};Gm=RT=f([p(0,Ne),p(1,TI)],Gm);const vF=h(1401,"properties ({0})"),_F={[kt.Method]:h(1402,"methods ({0})"),[kt.Function]:h(1403,"functions ({0})"),[kt.Constructor]:h(1404,"constructors ({0})"),[kt.Variable]:h(1405,"variables ({0})"),[kt.Class]:h(1406,"classes ({0})"),[kt.Struct]:h(1407,"structs ({0})"),[kt.Event]:h(1408,"events ({0})"),[kt.Operator]:h(1409,"operators ({0})"),[kt.Interface]:h(1410,"interfaces ({0})"),[kt.Namespace]:h(1411,"namespaces ({0})"),[kt.Package]:h(1412,"packages ({0})"),[kt.TypeParameter]:h(1413,"type parameters ({0})"),[kt.Module]:h(1414,"modules ({0})"),[kt.Property]:h(1401,"properties ({0})"),[kt.Enum]:h(1415,"enumerations ({0})"),[kt.EnumMember]:h(1416,"enumeration members ({0})"),[kt.String]:h(1417,"strings ({0})"),[kt.File]:h(1418,"files ({0})"),[kt.Array]:h(1419,"arrays ({0})"),[kt.Number]:h(1420,"numbers ({0})"),[kt.Boolean]:h(1421,"booleans ({0})"),[kt.Object]:h(1422,"objects ({0})"),[kt.Key]:h(1423,"keys ({0})"),[kt.Field]:h(1424,"fields ({0})"),[kt.Constant]:h(1425,"constants ({0})")};var tz;let yM=class extends Gm{static{tz=this}constructor(e,t,i,n,o,r){super(n,r,{openSideBySideDirection:()=>this.configuration.openSideBySideDirection}),this.editorService=e,this.editorGroupService=t,this.configurationService=i,this.outlineService=o,this.onDidActiveTextEditorControlChange=this.editorService.onDidActiveEditorChange}get configuration(){const e=this.configurationService.getValue().workbench?.editor;return{openEditorPinned:!e?.enablePreviewFromQuickOpen||!e?.enablePreview,openSideBySideDirection:e?.openSideBySideDirection}}get activeTextEditorControl(){if(!cA(this.editorService.activeEditorPane?.getControl()))return this.editorService.activeTextEditorControl}gotoLocation(e,t){if((t.keyMods.alt||this.configuration.openEditorPinned&&t.keyMods.ctrlCmd||t.forceSideBySide)&&this.editorService.activeEditor){e.restoreViewState?.();const i={selection:t.range,pinned:t.keyMods.ctrlCmd||this.configuration.openEditorPinned,preserveFocus:t.preserveFocus};this.editorGroupService.sideGroup.openEditor(this.editorService.activeEditor,i)}else super.gotoLocation(e,t)}static{this.SYMBOL_PICKS_TIMEOUT=8e3}async getSymbolPicks(e,t,i,n,o){return!await Promise.race([this.waitForLanguageSymbolRegistry(e,n),Da(tz.SYMBOL_PICKS_TIMEOUT)])||o.isCancellationRequested?[]:this.doGetSymbolPicks(this.getDocumentSymbols(e,o),Cx(t),i,o,e)}provideWithoutTextEditor(e){return this.canPickWithOutlineService()?this.doGetOutlinePicks(e):super.provideWithoutTextEditor(e)}canPickWithOutlineService(){return this.editorService.activeEditorPane?this.outlineService.canCreateOutline(this.editorService.activeEditorPane):!1}doGetOutlinePicks(e){const t=this.editorService.activeEditorPane;if(!t)return F.None;const i=new li,n=new U;return n.add(Ie(()=>i.dispose(!0))),e.busy=!0,this.outlineService.createOutline(t,YP.QuickPick,i.token).then(o=>{if(!o)return;if(i.token.isCancellationRequested){o.dispose();return}n.add(o);const r=o.captureViewState();n.add(Ie(()=>{e.selectedItems.length===0&&r.dispose()}));const a=o.config.quickPickDataSource.getQuickPickElements(),c=a.map((u,g)=>({kind:kt.File,index:g,score:0,label:u.label,description:u.description,ariaLabel:u.ariaLabel,iconClasses:u.iconClasses}));n.add(e.onDidAccept(()=>{e.hide();const[u]=e.selectedItems;u&&a[u.index]&&o.reveal(a[u.index].element,{},!1,!1)}));const d=()=>{const u=c.filter(g=>{if(e.value==="@")return g.score=0,g.highlights=void 0,!0;const m=e.value.substring(Gm.PREFIX.length).trim(),v=uwe(g.label),_=Mz(m,m.toLowerCase(),0,v.text,v.text.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return _?(g.score=_[1],g.highlights={label:gwe(m,v)??void 0},!0):!1});if(u.length===0){const g=h(5167,"No matching entries");e.items=[{label:g,index:-1,kind:kt.String}],e.ariaLabel=g}else e.items=u};d(),n.add(e.onDidChangeValue(d));const l=new Pt;n.add(l),n.add(e.onDidChangeActive(()=>{const[u]=e.activeItems;u&&a[u.index]?l.value=o.preview(a[u.index].element):l.clear()}))}).catch(o=>{mt(o),e.hide()}).finally(()=>{e.busy=!1}),n}};yM=tz=f([p(0,de),p(1,xe),p(2,ne),p(3,Ne),p(4,$q),p(5,TI)],yM);class W0 extends X{static{this.ID="workbench.action.gotoSymbol"}constructor(){super({id:W0.ID,title:{...I(5168,"Go to Symbol in Editor..."),mnemonicTitle:h(5169,"Go to &&Symbol in Editor...")},f1:!0,keybinding:{when:x.and(Aa.negate(),ig.negate()),weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Shift|S.KeyO},menu:[{id:N.MenubarGoMenu,group:"4_symbol_nav",order:1}]})}run(e){e.get(Wt).quickAccess.show(yM.PREFIX,{itemActivation:Sw.NONE})}}Y(W0);Ke.as(dN.Quickaccess).registerQuickAccessProvider({ctor:yM,prefix:Gm.PREFIX,contextKey:"inFileSymbolsPicker",placeholder:h(5170,"Type the name of a symbol to go to."),helpEntries:[{description:h(5171,"Go to Symbol in Editor"),prefix:Gm.PREFIX,commandId:W0.ID,commandCenterOrder:40},{description:h(5172,"Go to Symbol in Editor by Category"),prefix:Gm.PREFIX_BY_CATEGORY}]});const Bu={primary:E.CtrlCmd|S.KeyP,secondary:[E.CtrlCmd|S.KeyE],mac:{primary:E.CtrlCmd|S.KeyP,secondary:void 0}};Me.registerCommandAndKeybindingRule({id:"workbench.action.closeQuickOpen",weight:W.WorkbenchContrib,when:kl,primary:S.Escape,secondary:[E.Shift|S.Escape],handler:s=>s.get(Wt).cancel()});Me.registerCommandAndKeybindingRule({id:"workbench.action.acceptSelectedQuickOpenItem",weight:W.WorkbenchContrib,when:kl,primary:0,handler:s=>s.get(Wt).accept()});Me.registerCommandAndKeybindingRule({id:"workbench.action.alternativeAcceptSelectedQuickOpenItem",weight:W.WorkbenchContrib,when:kl,primary:0,handler:s=>s.get(Wt).accept({ctrlCmd:!0,alt:!1})});Me.registerCommandAndKeybindingRule({id:"workbench.action.focusQuickOpen",weight:W.WorkbenchContrib,when:kl,primary:0,handler:s=>{s.get(Wt).focus()}});const wie="workbench.action.quickOpenNavigateNextInFilePicker";Me.registerCommandAndKeybindingRule({id:wie,weight:W.WorkbenchContrib+50,handler:vS(wie,!0),when:Vpe,primary:Bu.primary,secondary:Bu.secondary,mac:Bu.mac});const Sie="workbench.action.quickOpenNavigatePreviousInFilePicker";Me.registerCommandAndKeybindingRule({id:Sie,weight:W.WorkbenchContrib+50,handler:vS(Sie,!1),when:Vpe,primary:Bu.primary|E.Shift,secondary:[Bu.secondary[0]|E.Shift],mac:{primary:Bu.mac.primary|E.Shift,secondary:void 0}});Me.registerCommandAndKeybindingRule({id:"workbench.action.quickPickManyToggle",weight:W.WorkbenchContrib,when:kl,primary:0,handler:s=>{s.get(Wt).toggle()}});Me.registerCommandAndKeybindingRule({id:"workbench.action.quickInputBack",weight:W.WorkbenchContrib+50,when:kl,primary:0,win:{primary:E.Alt|S.LeftArrow},mac:{primary:E.WinCtrl|S.Minus},linux:{primary:E.CtrlCmd|E.Alt|S.Minus},handler:s=>{s.get(Wt).back()}});Y(class extends X{constructor(){super({id:"workbench.action.quickOpen",title:I(2756,"Go to File..."),metadata:{description:"Quick access",args:[{name:"prefix",schema:{type:"string"}}]},keybinding:{weight:W.WorkbenchContrib,primary:Bu.primary,secondary:Bu.secondary,mac:Bu.mac},f1:!0})}run(e,t){e.get(Wt).quickAccess.show(typeof t=="string"?t:void 0,{preserveValue:typeof t=="string"})}});Y(class extends X{constructor(){super({id:"workbench.action.quickOpenWithModes",title:h(2757,"Quick Open"),icon:K.search,menu:{id:N.CommandCenterCenter,order:100}})}run(e){const t=e.get(Wt),i={includeHelp:!0,from:"commandCenter"};t.quickAccess.show(void 0,{preserveValue:!0,providerOptions:i})}});Ee.registerCommand("workbench.action.quickOpenPreviousEditor",async s=>{s.get(Wt).quickAccess.show("",{itemActivation:Sw.SECOND})});class B0 extends X{constructor(e,t,i,n,o){super({id:e,title:t,f1:!0,keybinding:o}),this.id=e,this.next=i,this.quickNavigate=n}async run(e){const t=e.get(He),i=e.get(Wt),n=t.lookupKeybindings(this.id),o=this.quickNavigate?{keybindings:n}:void 0;i.navigate(this.next,o)}}class Pze extends B0{constructor(){super("workbench.action.quickOpenNavigateNext",I(2758,"Navigate Next in Quick Open"),!0,!0)}}class Lze extends B0{constructor(){super("workbench.action.quickOpenNavigatePrevious",I(2759,"Navigate Previous in Quick Open"),!1,!0)}}class Mze extends B0{constructor(){super("workbench.action.quickOpenSelectNext",I(2760,"Select Next in Quick Open"),!0,!1,{weight:W.WorkbenchContrib+50,when:kl,primary:0,mac:{primary:E.WinCtrl|S.KeyN}})}}class Nze extends B0{constructor(){super("workbench.action.quickOpenSelectPrevious",I(2761,"Select Previous in Quick Open"),!1,!1,{weight:W.WorkbenchContrib+50,when:kl,primary:0,mac:{primary:E.WinCtrl|S.KeyP}})}}Y(Mze);Y(Nze);Y(Pze);Y(Lze);var dC;let bE=class{static{dC=this}static{this.PREFIX="?"}constructor(e,t){this.quickInputService=e,this.keybindingService=t,this.registry=Ke.as(dN.Quickaccess)}provide(e){const t=new U;return t.add(e.onDidAccept(()=>{const[i]=e.selectedItems;i&&this.quickInputService.quickAccess.show(i.prefix,{preserveValue:!0})})),t.add(e.onDidChangeValue(i=>{const n=this.registry.getQuickAccessProvider(i.substr(dC.PREFIX.length));n&&n.prefix&&n.prefix!==dC.PREFIX&&this.quickInputService.quickAccess.show(n.prefix,{preserveValue:!0})})),e.items=this.getQuickAccessProviders().filter(i=>i.prefix!==dC.PREFIX),t}getQuickAccessProviders(){return this.registry.getQuickAccessProviders().sort((t,i)=>t.prefix.localeCompare(i.prefix)).flatMap(t=>this.createPicks(t))}createPicks(e){return e.helpEntries.map(t=>{const i=t.prefix||e.prefix,n=i||"";return{prefix:i,label:n,keybinding:t.commandId?this.keybindingService.lookupKeybinding(t.commandId):void 0,ariaLabel:h(1943,"{0}, {1}",n,t.description),description:t.description}})}};bE=dC=f([p(0,Wt),p(1,He)],bE);var iz;let uw=class extends P4{static{iz=this}static{this.PREFIX="view "}constructor(e,t,i,n,o,r,a,c){super(iz.PREFIX,{noResultsPick:{label:h(8871,"No matching views"),containerLabel:""}}),this.viewDescriptorService=e,this.viewsService=t,this.outputService=i,this.terminalService=n,this.terminalGroupService=o,this.debugService=r,this.paneCompositeService=a,this.contextKeyService=c}_getPicks(e){const t=this.doGetViewPickItems().filter(r=>e?(r.highlights={label:ise(e,r.label,!0)??void 0},r.highlights.label||pwe(r.containerLabel,e)):!0),i=new Map;for(const r of t)i.has(r.label)||i.set(r.label,r.containerLabel);const n=[];let o;for(const r of t){if(o!==r.containerLabel){o=r.containerLabel;let a;i.has(o)?a=`${i.get(o)} / ${o}`:a=o,n.push({type:"separator",label:a})}n.push(r)}return n}doGetViewPickItems(){const e=[],t=(r,a)=>{const c=this.viewDescriptorService.getViewContainerModel(a),d=[];for(const l of c.allViewDescriptors)this.contextKeyService.contextMatchesRules(l.when)&&d.push({label:l.name.value,containerLabel:c.title,accept:()=>this.viewsService.openView(l.id,!0)});return d},i=(r,a)=>{const c=this.paneCompositeService.getPaneComposites(r),d=this.paneCompositeService.getVisiblePaneCompositeIds(r);c.sort((l,u)=>{let g=d.findIndex(v=>l.id===v),m=d.findIndex(v=>u.id===v);return g<0&&(g=c.indexOf(l)+d.length),m<0&&(m=c.indexOf(u)+d.length),g-m});for(const l of c)if(this.includeViewContainer(l)){const u=this.viewDescriptorService.getViewContainerById(l.id);u&&e.push({label:this.viewDescriptorService.getViewContainerModel(u).title,containerLabel:a,accept:()=>this.paneCompositeService.openPaneComposite(l.id,r,!0)})}};i(We.Sidebar,h(8872,"Side Bar")),i(We.Panel,h(8873,"Panel")),i(We.AuxiliaryBar,h(8874,"Secondary Side Bar"));const n=r=>{const a=this.paneCompositeService.getPaneComposites(r);for(const c of a){const d=this.viewDescriptorService.getViewContainerById(c.id);d&&e.push(...t(c,d))}};n(We.Sidebar),n(We.Panel),n(We.AuxiliaryBar),this.terminalGroupService.groups.forEach((r,a)=>{r.terminalInstances.forEach((c,d)=>{const l=h(8875,"{0}: {1}",`${a+1}.${d+1}`,c.title);e.push({label:l,containerLabel:h(8876,"Terminal"),accept:async()=>{await this.terminalGroupService.showPanel(!0),this.terminalService.setActiveInstance(c)}})})}),this.debugService.getModel().getSessions(!0).filter(r=>r.hasSeparateRepl()).forEach((r,a)=>{const c=r.name;e.push({label:c,containerLabel:h(8877,"Debug Console"),accept:async()=>{await this.debugService.focusStackFrame(void 0,void 0,r,{explicit:!0}),this.viewsService.isViewVisible(L9)||await this.viewsService.openView(L9,!0)}})});const o=this.outputService.getChannelDescriptors();for(const r of o)e.push({label:r.label,containerLabel:h(8878,"Output"),accept:()=>this.outputService.showChannel(r.id)});return e}includeViewContainer(e){const t=this.viewDescriptorService.getViewContainerById(e.id);return t?.hideIfEmpty?this.viewDescriptorService.getViewContainerModel(t).activeViewDescriptors.length>0:!0}};uw=iz=f([p(0,$s),p(1,io),p(2,BN),p(3,Rw),p(4,Wq),p(5,Mq),p(6,da),p(7,fe)],uw);class TD extends X{static{this.ID="workbench.action.openView"}constructor(){super({id:TD.ID,title:I(8879,"Open View"),category:te.View,f1:!0})}async run(e){e.get(Wt).quickAccess.show(uw.PREFIX)}}class ny extends X{static{this.ID="workbench.action.quickOpenView"}static{this.KEYBINDING={primary:E.CtrlCmd|S.KeyQ,mac:{primary:E.WinCtrl|S.KeyQ},linux:{primary:0}}}constructor(){super({id:ny.ID,title:I(8880,"Quick Open View"),category:te.View,f1:!1,keybinding:{weight:W.WorkbenchContrib,when:void 0,...ny.KEYBINDING}})}async run(e){const t=e.get(He),i=e.get(Wt),n=t.lookupKeybindings(ny.ID);i.quickAccess.show(uw.PREFIX,{quickNavigateConfiguration:{keybindings:n},itemActivation:Sw.FIRST})}}const a6=Ke.as(dN.Quickaccess);a6.registerQuickAccessProvider({ctor:bE,prefix:bE.PREFIX,placeholder:h(8859,"Type '{0}' to get help on the actions you can take from here.",bE.PREFIX),helpEntries:[{description:h(8860,"Show all Quick Access Providers"),commandCenterOrder:70,commandCenterLabel:h(8861,"More")}]});a6.registerQuickAccessProvider({ctor:uw,prefix:uw.PREFIX,contextKey:"inViewsPicker",placeholder:h(8862,"Type the name of a view, output channel or terminal to open."),helpEntries:[{description:h(8863,"Open View"),commandId:TD.ID}]});a6.registerQuickAccessProvider({ctor:Tv,prefix:Tv.PREFIX,contextKey:"inCommandsPicker",placeholder:h(8864,"Type the name of a command to run."),helpEntries:[{description:h(8865,"Show and Run Commands"),commandId:Lf.ID,commandCenterOrder:20}]});ge.appendMenuItem(N.MenubarViewMenu,{group:"1_open",command:{id:Lf.ID,title:h(8866,"&&Command Palette...")},order:1});ge.appendMenuItem(N.MenubarHelpMenu,{group:"1_welcome",command:{id:Lf.ID,title:h(8867,"Show All Commands")},order:2});ge.appendMenuItem(N.MenubarViewMenu,{group:"1_open",command:{id:TD.ID,title:h(8868,"&&Open View...")},order:2});ge.appendMenuItem(N.MenubarGoMenu,{group:"5_infile_nav",command:{id:"workbench.action.gotoLine",title:h(8869,"Go to &&Line/Column...")},order:1});ge.appendMenuItem(N.GlobalActivity,{group:"1_command",command:{id:Lf.ID,title:h(8870,"Command Palette...")},order:1});ge.appendMenuItem(N.EditorContext,{group:"z_commands",when:V.editorSimpleInput.toNegated(),command:{id:Lf.ID,title:h(8870,"Command Palette...")},order:1});Y(Rze);Y(Lf);Y(TD);Y(ny);const Oze="inViewsPicker",Upe=x.and(kl,x.has(Oze)),sy=ny.KEYBINDING,Cie="workbench.action.quickOpenNavigateNextInViewPicker";Me.registerCommandAndKeybindingRule({id:Cie,weight:W.WorkbenchContrib+50,handler:vS(Cie,!0),when:Upe,primary:sy.primary,linux:sy.linux,mac:sy.mac});const Eie="workbench.action.quickOpenNavigatePreviousInViewPicker";Me.registerCommandAndKeybindingRule({id:Eie,weight:W.WorkbenchContrib+50,handler:vS(Eie,!1),when:Upe,primary:sy.primary|E.Shift,linux:sy.linux,mac:{primary:sy.mac.primary|E.Shift}});let wM=class extends F{static{this.ID="workbench.contrib.externalUriResolver"}constructor(e,t){super(),t.options?.resolveExternalUri&&this._register(e.registerExternalUriResolver({resolveExternalUri:async i=>({resolved:await t.options.resolveExternalUri(i),dispose:()=>{}})}))}};wM=f([p(0,mi),p(1,cf)],wM);const Fze="trustedDomains",Wze={type:uC.File,ctime:Date.now(),mtime:Date.now(),size:0},$pe=`// Links matching one or more entries in the list below can be opened without link protection.
// The following examples show what entries can look like:
// - "https://microsoft.com": Matches this specific domain using https
// - "https://microsoft.com:8080": Matches this specific domain on this port using https
// - "https://microsoft.com:*": Matches this specific domain on any port using https
// - "https://microsoft.com/foo": Matches https://microsoft.com/foo and https://microsoft.com/foo/bar,
//   but not https://microsoft.com/foobar or https://microsoft.com/bar
// - "https://*.microsoft.com": Match all domains ending in "microsoft.com" using https
// - "microsoft.com": Match this specific domain using either http or https
// - "*.microsoft.com": Match all domains ending in "microsoft.com" using either http or https
// - "http://192.168.0.1: Matches this specific IP using http
// - "http://192.168.0.*: Matches all IP's with this prefix using http
// - "*": Match all domains using either http or https
//
`,Gpe=`//
// You can use the "Manage Trusted Domains" command to open this file.
// Save this file to apply the trusted domains rules.
`,Bze=`[
	// "https://microsoft.com"
]`;function Vze(s,e,t){let i=$pe;return s.length>0?(i+=`// By default, VS Code trusts "localhost" as well as the following domains:
`,s.forEach(n=>{i+=`// - "${n}"
`})):i+=`// By default, VS Code trusts "localhost".
`,i+=Gpe,i+=t?`
// Currently configuring trust for ${t}
`:"",e.length===0?i+=Bze:i+=JSON.stringify(e,null,2),i}let SM=class{static{this.ID="workbench.contrib.trustedDomainsFileSystemProvider"}constructor(e,t,i){this.fileService=e,this.storageService=t,this.instantiationService=i,this.capabilities=hh.FileReadWrite,this.onDidChangeCapabilities=T.None,this.onDidChangeFile=T.None,this.fileService.registerProvider(Fze,this)}stat(e){return Promise.resolve(Wze)}async readFile(e){let t=this.storageService.get(w8,he.APPLICATION);const i=e.fragment,{defaultTrustedDomains:n,trustedDomains:o}=await this.instantiationService.invokeFunction(fwe);return(!t||t.indexOf($pe)===-1||t.indexOf(Gpe)===-1||t.indexOf(i??"")===-1||[...n,...o].some(a=>!jt(t).includes(a)))&&(t=Vze(n,o,i)),Le.fromString(t).buffer}writeFile(e,t,i){try{const n=Le.wrap(t).toString(),o=Rb(n);this.storageService.store(w8,n,he.APPLICATION,gt.USER),this.storageService.store(mwe,JSON.stringify(o)||"",he.APPLICATION,gt.USER)}catch{}return Promise.resolve()}watch(e,t){return{dispose(){}}}mkdir(e){return Promise.resolve(void 0)}readdir(e){return Promise.resolve(void 0)}delete(e,t){return Promise.resolve(void 0)}rename(e,t,i){return Promise.resolve(void 0)}};SM=f([p(0,je),p(1,it),p(2,Z)],SM);let nz=class{constructor(e,t,i,n,o,r,a,c,d,l,u,g){this._openerService=e,this._storageService=t,this._dialogService=i,this._productService=n,this._quickInputService=o,this._editorService=r,this._clipboardService=a,this._telemetryService=c,this._instantiationService=d,this._configurationService=l,this._workspaceTrustService=u,this._trustedDomainService=g,this._openerService.registerValidator({shouldOpen:(m,v)=>this.validateLink(m,v)})}async validateLink(e,t){if(!RE(e,ae.http)&&!RE(e,ae.https)||t?.fromWorkspace&&this._workspaceTrustService.isWorkspaceTrusted()&&!this._configurationService.getValue("workbench.trustedDomains.promptInTrustedWorkspace"))return!0;const i=e;let n;if(typeof e=="string"?n=R.parse(e):n=e,this._trustedDomainService.isValid(n))return!0;{const{scheme:o,authority:r,path:a,query:c,fragment:d}=n;let l=`${o}://${r}${a}`;const u=`${c?"?"+c:""}${d?"#"+d:""}`,g=Math.max(0,60-l.length),m=Math.min(Math.max(5,g),u.length);m===u.length?l+=u:l+=u.charAt(0)+"..."+u.substring(u.length-m+1);const{result:v}=await this._dialogService.prompt({type:Fe.Info,message:h(11235,"Do you want {0} to open the external website?",this._productService.nameShort),detail:typeof i=="string"?i:l,buttons:[{label:h(11236,"&&Open"),run:()=>!0},{label:h(11237,"&&Copy"),run:()=>(this._clipboardService.writeText(typeof i=="string"?i:n.toString(!0)),!1)},{label:h(11238,"Configure &&Trusted Domains"),run:async()=>{const{trustedDomains:_}=this._instantiationService.invokeFunction(vwe),w=`${o}://${r}`,C=await _we(_,w,n,this._quickInputService,this._storageService,this._editorService);return!!(C.indexOf("*")!==-1||bwe(n,C))}}],cancelButton:{run:()=>!1}});return v}}};nz=f([p(0,mi),p(1,it),p(2,ei),p(3,Vn),p(4,Wt),p(5,de),p(6,Vs),p(7,ai),p(8,Z),p(9,ne),p(10,Lv),p(11,Az)],nz);class Hze extends X{constructor(){super({id:"workbench.action.url.openUrl",title:I(11239,"Open URL"),category:te.Developer,f1:!0})}async run(e){const t=e.get(Wt),i=e.get($M);return t.input({prompt:h(11240,"URL to open")}).then(n=>{if(n){const o=R.parse(n);i.open(o,{originalUrl:n})}})}}Y(Hze);Ee.registerCommand(XF);ge.appendMenuItem(N.CommandPalette,{command:{id:XF.id,title:XF.description.description}});Ke.as(df.Workbench).registerWorkbenchContribution(nz,mc.Restored);rc(SM.ID,SM,ac.BlockRestore);rc(wM.ID,wM,ac.BlockRestore);const Uze=Ke.as(Js.Configuration);Uze.registerConfiguration({...vN,properties:{"workbench.trustedDomains.promptInTrustedWorkspace":{scope:Ht.APPLICATION,type:"boolean",default:!1,description:h(11241,"When enabled, trusted domain prompts will appear when opening links in trusted workspaces.")}}});var Gg,du;(function(s){s.titleSeparator="window.titleSeparator",s.title="window.title"})(du||(du={}));const zpe=(()=>{if(Yt&&ca)return"${activeEditorShort}${separator}${rootName}${separator}${profileName}";const s="${dirty}${activeEditorShort}${separator}${rootName}${separator}${profileName}${separator}${appName}";return Kt?s+"${separator}${remoteName}":s})(),qpe=Yt?"  ":" - ";let xie=class extends F{static{Gg=this}static{this.NLS_USER_IS_ADMIN=bn?h(3502,"[Administrator]"):h(3503,"[Superuser]")}static{this.NLS_EXTENSION_HOST=h(3504,"[Extension Development Host]")}static{this.TITLE_DIRTY=" "}get value(){return this.title??""}get workspaceName(){return this.labelService.getWorkspaceLabel(this.contextService.getWorkspace())}get fileName(){const e=this.editorService.activeEditor;if(!e)return;const t=e.getTitle(Ot.SHORT);return`${e?.isDirty()&&!e.isSaving()?Gg.TITLE_DIRTY:""}${t}`}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(),this.configurationService=i,this.contextKeyService=n,this.environmentService=r,this.contextService=a,this.labelService=c,this.userDataProfileService=d,this.productService=l,this.viewsService=u,this.decorationsService=g,this.accessibilityService=m,this.properties={isPure:!0,isAdmin:!1,prefix:void 0},this.variables=new Map,this.activeEditorListeners=this._register(new U),this.titleUpdater=this._register(new yn(()=>this.doUpdateTitle(),0)),this.onDidChangeEmitter=new M,this.onDidChange=this.onDidChangeEmitter.event,this.titleIncludesFocusedView=!1,this.titleIncludesEditorState=!1,this.editorService=o.createScoped(t,this._store),this.windowId=e.vscodeWindowId,this.checkTitleVariables(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationChanged(e))),this._register(this.editorService.onDidActiveEditorChange(()=>this.onActiveEditorChange())),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.titleUpdater.schedule())),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.titleUpdater.schedule())),this._register(this.contextService.onDidChangeWorkspaceName(()=>this.titleUpdater.schedule())),this._register(this.labelService.onDidChangeFormatters(()=>this.titleUpdater.schedule())),this._register(this.userDataProfileService.onDidChangeCurrentProfile(()=>this.titleUpdater.schedule())),this._register(this.viewsService.onDidChangeFocusedView(()=>{this.titleIncludesFocusedView&&this.titleUpdater.schedule()})),this._register(this.contextKeyService.onDidChangeContext(e=>{e.affectsSome(this.variables)&&this.titleUpdater.schedule()})),this._register(this.accessibilityService.onDidChangeScreenReaderOptimized(()=>this.titleUpdater.schedule()))}onConfigurationChanged(e){const t=e.affectsConfiguration(du.title);t&&this.checkTitleVariables(),(t||e.affectsConfiguration(du.titleSeparator))&&this.titleUpdater.schedule()}checkTitleVariables(){const e=this.configurationService.getValue(du.title);typeof e=="string"&&(this.titleIncludesFocusedView=e.includes("${focusedView}"),this.titleIncludesEditorState=e.includes("${activeEditorState}"))}onActiveEditorChange(){this.activeEditorListeners.clear(),this.titleUpdater.schedule();const e=this.editorService.activeEditor;if(e&&(this.activeEditorListeners.add(e.onDidChangeDirty(()=>this.titleUpdater.schedule())),this.activeEditorListeners.add(e.onDidChangeLabel(()=>this.titleUpdater.schedule()))),this.titleIncludesFocusedView){const t=this.editorService.activeTextEditorControl,i=[];mo(t)?i.push(t):Zu(t)&&i.push(t.getOriginalEditor(),t.getModifiedEditor());for(const n of i)this.activeEditorListeners.add(n.onDidBlurEditorText(()=>this.titleUpdater.schedule())),this.activeEditorListeners.add(n.onDidFocusEditorText(()=>this.titleUpdater.schedule()))}this.titleIncludesEditorState&&this.activeEditorListeners.add(this.decorationsService.onDidChangeDecorations(()=>this.titleUpdater.schedule()))}doUpdateTitle(){const e=this.getFullWindowTitle();if(e!==this.title){let t=e;Uz(t)||(t=this.productService.nameLong);const i=Vz(this.windowId,!0).window;!i.document.title&&Yt&&t===this.productService.nameLong&&(i.document.title=`${this.productService.nameLong} ${Gg.TITLE_DIRTY}`),i.document.title=t,this.title=e,this.onDidChangeEmitter.fire()}}getFullWindowTitle(){const{prefix:e,suffix:t}=this.getTitleDecorations();let i=this.getWindowTitle()||this.productService.nameLong;return e&&(i=`${e} ${i}`),t&&(i=`${i} ${t}`),i.replace(/[^\S ]/g," ")}getTitleDecorations(){let e,t;return this.properties.prefix&&(e=this.properties.prefix),this.environmentService.isExtensionDevelopment&&(e=e?`${Gg.NLS_EXTENSION_HOST} - ${e}`:Gg.NLS_EXTENSION_HOST),this.properties.isAdmin&&(t=Gg.NLS_USER_IS_ADMIN),{prefix:e,suffix:t}}updateProperties(e){const t=typeof e.isAdmin=="boolean"?e.isAdmin:this.properties.isAdmin,i=typeof e.isPure=="boolean"?e.isPure:this.properties.isPure,n=typeof e.prefix=="string"?e.prefix:this.properties.prefix;(t!==this.properties.isAdmin||i!==this.properties.isPure||n!==this.properties.prefix)&&(this.properties.isAdmin=t,this.properties.isPure=i,this.properties.prefix=n,this.titleUpdater.schedule())}registerVariables(e){let t=!1;for(const{name:i,contextKey:n}of e)this.variables.has(n)||(this.variables.set(n,i),t=!0);t&&this.titleUpdater.schedule()}getWindowTitle(){const e=this.editorService.activeEditor,t=this.contextService.getWorkspace();let i;t.configuration?i=t.configuration:t.folders.length&&(i=t.folders[0].uri);const n=Di.getOriginalUri(e,{supportSideBySide:qt.PRIMARY});let o=n?_s(n):void 0;o?.path==="."&&(o=void 0);let r;this.contextService.getWorkbenchState()===Zo.FOLDER?r=t.folders[0]:n&&(r=this.contextService.getWorkspaceFolder(n)??void 0);let a;if(this.environmentService.remoteAuthority&&!Kt)a=this.labelService.getHostLabel(ae.vscodeRemote,this.environmentService.remoteAuthority);else{const me=ywe(t);me&&(a=this.labelService.getHostLabel(me.scheme,me.authority))}const c=e?e.getTitle(Ot.SHORT):"",d=e?e.getTitle(Ot.MEDIUM):c,l=e?e.getTitle(Ot.LONG):d,u=o?Qe(o):"",g=o?this.labelService.getUriLabel(o,{relative:!0}):"",m=o?this.labelService.getUriLabel(o):"",v=this.labelService.getWorkspaceLabel(t),_=this.labelService.getWorkspaceLabel(t,{verbose:ev.SHORT}),w=i?this.labelService.getUriLabel(i):"",C=r?r.name:"",k=r?this.labelService.getUriLabel(r.uri):"",D=e?.isDirty()&&!e.isSaving()?Gg.TITLE_DIRTY:"",A=this.productService.nameLong,B=this.userDataProfileService.currentProfile.isDefault?"":this.userDataProfileService.currentProfile.name,q=this.viewsService.getFocusedViewName(),Q=n?this.decorationsService.getDecoration(n,!1)?.tooltip:void 0,ie={};for(const[me,zt]of this.variables)ie[zt]=this.contextKeyService.getContextKeyValue(me)??"";let oe=this.configurationService.getValue(du.title);typeof oe!="string"&&(oe=zpe),!this.titleIncludesEditorState&&this.accessibilityService.isScreenReaderOptimized()&&this.configurationService.getValue("accessibility.windowTitleOptimized")&&(oe+="${separator}${activeEditorState}");let be=this.configurationService.getValue(du.titleSeparator);return typeof be!="string"&&(be=qpe),wwe(oe,{...ie,activeEditorShort:c,activeEditorLong:l,activeEditorMedium:d,activeFolderShort:u,activeFolderMedium:g,activeFolderLong:m,rootName:v,rootPath:w,rootNameShort:_,folderName:C,folderPath:k,dirty:D,appName:A,remoteName:a,profileName:B,focusedView:q,activeEditorState:Q,separator:{label:be}})}isCustomTitleFormat(){if(this.accessibilityService.isScreenReaderOptimized()||this.titleIncludesEditorState)return!0;const e=this.configurationService.inspect(du.title),t=this.configurationService.inspect(du.titleSeparator);return e.value!==e.defaultValue||t.value!==t.defaultValue}};xie=Gg=f([p(2,ne),p(3,fe),p(4,de),p(5,cf),p(6,It),p(7,ui),p(8,Mh),p(9,Vn),p(10,io),p(11,Pv),p(12,Nr)],xie);var V_;let CM=class extends F{static{V_=this}static{this.SETTING_ID_PATTERNS="workbench.editor.customLabels.patterns"}static{this.SETTING_ID_ENABLED="workbench.editor.customLabels.enabled"}constructor(e,t){super(),this.configurationService=e,this.workspaceContextService=t,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.patterns=[],this.enabled=!0,this.cache=new Swe(1e3),this._templateRegexValidation=/[a-zA-Z0-9]/,this._parsedTemplateExpression=/\$\{(dirname|filename|extname|extname\((?<extnameN>[-+]?\d+)\)|dirname\((?<dirnameN>[-+]?\d+)\))\}/g,this._filenameCaptureExpression=/(?<filename>^\.*[^.]*)/,this.storeEnablementState(),this.storeCustomPatterns(),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration(V_.SETTING_ID_ENABLED)){const t=this.enabled;this.storeEnablementState(),t!==this.enabled&&this.patterns.length>0&&this._onDidChange.fire()}else e.affectsConfiguration(V_.SETTING_ID_PATTERNS)&&(this.cache.clear(),this.storeCustomPatterns(),this._onDidChange.fire())}))}storeEnablementState(){this.enabled=this.configurationService.getValue(V_.SETTING_ID_ENABLED)}storeCustomPatterns(){this.patterns=[];const e=this.configurationService.getValue(V_.SETTING_ID_PATTERNS);for(const t in e){const i=e[t];if(!this._templateRegexValidation.test(i))continue;const n=cy(t),o=Km(t);this.patterns.push({pattern:t,template:i,isAbsolutePath:n,parsedPattern:o})}this.patterns.sort((t,i)=>this.patternWeight(i.pattern)-this.patternWeight(t.pattern))}patternWeight(e){let t=0;for(const i of e.split("/"))i==="**"?t+=1:i==="*"?t+=10:i.includes("*")||i.includes("?")?t+=50:i!==""&&(t+=100);return t}getName(e){if(!this.enabled||this.patterns.length===0)return;const t=e.toString(),i=this.cache.get(t);if(i!==void 0)return i??void 0;const n=this.applyPatterns(e);return this.cache.set(t,n??null),n}applyPatterns(e){const t=this.workspaceContextService.getWorkspaceFolder(e);let i;for(const n of this.patterns){let o;if(t&&!n.isAbsolutePath?(i||(i=Gu(_s(t.uri),e)??e.path),o=i):o=e.path,n.parsedPattern(o))return this.applyTemplate(n.template,e,o)}}applyTemplate(e,t,i){let n;return e.replace(this._parsedTemplateExpression,(o,r,...a)=>{n=n??Cwe(t.path);const{dirnameN:c="0",extnameN:d="0"}=a.pop();if(r==="filename"){const{filename:l}=this._filenameCaptureExpression.exec(n.base)?.groups??{};if(l)return l}else if(r==="extname"){const l=this.getExtnames(n.base);if(l)return l}else if(r.startsWith("extname")){const l=parseInt(d),u=this.getNthExtname(n.base,l);if(u)return u}else if(r.startsWith("dirname")){const l=parseInt(c),u=this.getNthDirname(jM(i),l);if(u)return u}return o})}removeLeadingDot(e){let t=e;for(;t.startsWith(".");)t=t.slice(1);return t}getNthDirname(e,t){e=e.startsWith("/")?e.slice(1):e;const i=e.split("/");return this.getNthFragment(i,t)}getExtnames(e){return this.removeLeadingDot(e).split(".").slice(1).join(".")}getNthExtname(e,t){const i=this.removeLeadingDot(e).split(".");return i.shift(),this.getNthFragment(i,t)}getNthFragment(e,t){const i=e.length;let n;t<0?n=Math.abs(t)-1:n=i-t-1;const o=e[n];if(!(o===void 0||o===""))return o}};CM=V_=f([p(0,ne),p(1,It)],CM);const mk=Ke.as(Js.Configuration);(function(){rc(L8.ID,L8,ac.Eventually),rc(M8.ID,M8,ac.AfterRestored),mk.registerConfiguration({...vN,properties:{"workbench.externalBrowser":{type:"string",markdownDescription:h(3544,"Configure the browser to use for opening http or https links externally. This can either be the name of the browser (`edge`, `chrome`, `firefox`) or an absolute path to the browser's executable. Will use the system default if not set."),included:ca,restricted:!0},"workbench.editor.titleScrollbarSizing":{type:"string",enum:["default","large"],enumDescriptions:[h(3545,"The default size."),h(3546,"Increases the size, so it can be grabbed more easily with the mouse.")],description:h(3547,"Controls the height of the scrollbars used for tabs and breadcrumbs in the editor title area."),default:"default"},[oi.EDITOR_TABS_MODE]:{type:"string",enum:[_o.MULTIPLE,_o.SINGLE,_o.NONE],enumDescriptions:[h(3548,"Each editor is displayed as a tab in the editor title area."),h(3549,"The active editor is displayed as a single large tab in the editor title area."),h(3550,"The editor title area is not displayed.")],description:h(3551,"Controls whether opened editors should show as individual tabs, one single large tab or if the title area should not be shown."),default:"multiple"},[oi.EDITOR_ACTIONS_LOCATION]:{type:"string",enum:[nl.DEFAULT,nl.TITLEBAR,nl.HIDDEN],markdownEnumDescriptions:[h(3552,"Show editor actions in the window title bar when {0} is set to {1}. Otherwise, editor actions are shown in the editor tab bar.","`#workbench.editor.showTabs#`","`none`"),h(3553,"Show editor actions in the window title bar. If {0} is set to {1}, editor actions are hidden.","`#window.customTitleBarVisibility#`","`never`"),h(3554,"Editor actions are not shown.")],markdownDescription:h(3555,"Controls where the editor actions are shown."),default:"default"},"workbench.editor.alwaysShowEditorActions":{type:"boolean",markdownDescription:h(3556,"Controls whether to always show the editor actions, even when the editor group is not active."),default:!1},"workbench.editor.wrapTabs":{type:"boolean",markdownDescription:h(3557,"Controls whether tabs should be wrapped over multiple lines when exceeding available space or whether a scrollbar should appear instead. This value is ignored when {0} is not set to '{1}'.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.scrollToSwitchTabs":{type:"boolean",markdownDescription:h(3558,"Controls whether scrolling over tabs will open them or not. By default tabs will only reveal upon scrolling, but not open. You can press and hold the Shift-key while scrolling to change this behavior for that duration. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.highlightModifiedTabs":{type:"boolean",markdownDescription:h(3559,"Controls whether a top border is drawn on tabs for editors that have unsaved changes. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","multiple"),default:!1},"workbench.editor.decorations.badges":{type:"boolean",markdownDescription:h(3560,"Controls whether editor file decorations should use badges."),default:!0},"workbench.editor.decorations.colors":{type:"boolean",markdownDescription:h(3561,"Controls whether editor file decorations should use colors."),default:!0},[CM.SETTING_ID_ENABLED]:{type:"boolean",markdownDescription:h(3562,"Controls whether the custom workbench editor labels should be applied."),default:!0},[CM.SETTING_ID_PATTERNS]:{type:"object",markdownDescription:(()=>{let t=h(3563,"Controls the rendering of the editor label. Each __Item__ is a pattern that matches a file path. Both relative and absolute file paths are supported. The relative path must include the WORKSPACE_FOLDER (e.g `WORKSPACE_FOLDER/src/**.tsx` or `*/src/**.tsx`). Absolute patterns must start with a `/`. In case multiple patterns match, the longest matching path will be picked. Each __Value__ is the template for the rendered editor when the __Item__ matches. Variables are substituted based on the context:");return t+=`
- `+[h(3564,"`${dirname}`: name of the folder in which the file is located (e.g. `WORKSPACE_FOLDER/folder/file.txt -> folder`)."),h(3565,"`${dirname(N)}`: name of the nth parent folder in which the file is located (e.g. `N=2: WORKSPACE_FOLDER/static/folder/file.txt -> WORKSPACE_FOLDER`). Folders can be picked from the start of the path by using negative numbers (e.g. `N=-1: WORKSPACE_FOLDER/folder/file.txt -> WORKSPACE_FOLDER`). If the __Item__ is an absolute pattern path, the first folder (`N=-1`) refers to the first folder in the absolute path, otherwise it corresponds to the workspace folder."),h(3566,"`${filename}`: name of the file without the file extension (e.g. `WORKSPACE_FOLDER/folder/file.txt -> file`)."),h(3567,"`${extname}`: the file extension (e.g. `WORKSPACE_FOLDER/folder/file.txt -> txt`)."),h(3568,"`${extname(N)}`: the nth extension of the file separated by '.' (e.g. `N=2: WORKSPACE_FOLDER/folder/file.ext1.ext2.ext3 -> ext1`). Extension can be picked from the start of the extension by using negative numbers (e.g. `N=-1: WORKSPACE_FOLDER/folder/file.ext1.ext2.ext3 -> ext2`).")].join(`
- `),t+=`

`+h(3569,'Example: `"**/static/**/*.html": "${filename} - ${dirname} (${extname})"` will render a file `WORKSPACE_FOLDER/static/folder/file.html` as `file - folder (html)`.'),t})(),additionalProperties:{type:["string","null"],markdownDescription:h(3570,"The template which should be rendered when the pattern matches. May include the variables ${dirname}, ${filename} and ${extname}."),minLength:1,pattern:".*[a-zA-Z0-9].*"},default:{}},"workbench.editor.labelFormat":{type:"string",enum:["default","short","medium","long"],enumDescriptions:[h(3571,"Show the name of the file. When tabs are enabled and two files have the same name in one group the distinguishing sections of each file's path are added. When tabs are disabled, the path relative to the workspace folder is shown if the editor is active."),h(3572,"Show the name of the file followed by its directory name."),h(3573,"Show the name of the file followed by its path relative to the workspace folder."),h(3574,"Show the name of the file followed by its absolute path.")],default:"default",description:h(3575,"Controls the format of the label for an editor.")},"workbench.editor.untitled.labelFormat":{type:"string",enum:["content","name"],enumDescriptions:[h(3576,"The name of the untitled file is derived from the contents of its first line unless it has an associated file path. It will fallback to the name in case the line is empty or contains no word characters."),h(3577,"The name of the untitled file is not derived from the contents of the file.")],default:"content",description:h(3578,"Controls the format of the label for an untitled editor.")},"workbench.editor.empty.hint":{type:"string",enum:["text","hidden"],default:"text",markdownDescription:h(3579,"Controls if the empty editor text hint should be visible in the editor.")},"workbench.editor.languageDetection":{type:"boolean",default:!0,description:h(3580,"Controls whether the language in a text editor is automatically detected unless the language has been explicitly set by the language picker. This can also be scoped by language so you can specify which languages you do not want to be switched off of. This is useful for languages like Markdown that often contain other languages that might trick language detection into thinking it's the embedded language and not Markdown."),scope:Ht.LANGUAGE_OVERRIDABLE},"workbench.editor.historyBasedLanguageDetection":{type:"boolean",default:!0,description:h(3581,"Enables use of editor history in language detection. This causes automatic language detection to favor languages that have been recently opened and allows for automatic language detection to operate with smaller inputs.")},"workbench.editor.preferHistoryBasedLanguageDetection":{type:"boolean",default:!1,description:h(3582,"When enabled, a language detection model that takes into account editor history will be given higher precedence.")},"workbench.editor.languageDetectionHints":{type:"object",default:{untitledEditors:!0,notebookEditors:!0},description:h(3583,"When enabled, shows a Status bar Quick Fix when the editor language doesn't match detected content language."),additionalProperties:!1,properties:{untitledEditors:{type:"boolean",description:h(3584,"Show in untitled text editors")},notebookEditors:{type:"boolean",description:h(3585,"Show in notebook editors")}}},"workbench.editor.tabActionLocation":{type:"string",enum:["left","right"],default:"right",markdownDescription:h(3586,"Controls the position of the editor's tabs action buttons (close, unpin). This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.tabActionCloseVisibility":{type:"boolean",default:!0,description:h(3587,"Controls the visibility of the tab close action button.")},"workbench.editor.tabActionUnpinVisibility":{type:"boolean",default:!0,description:h(3588,"Controls the visibility of the tab unpin action button.")},"workbench.editor.tabSizing":{type:"string",enum:["fit","shrink","fixed"],default:"fit",enumDescriptions:[h(3589,"Always keep tabs large enough to show the full editor label."),h(3590,"Allow tabs to get smaller when the available space is not enough to show all tabs at once."),h(3591,"Make all tabs the same size, while allowing them to get smaller when the available space is not enough to show all tabs at once.")],markdownDescription:h(3592,"Controls the size of editor tabs. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.tabSizingFixedMinWidth":{type:"number",default:50,minimum:38,markdownDescription:h(3593,"Controls the minimum width of tabs when {0} size is set to {1}.","`#workbench.editor.tabSizing#`","`fixed`")},"workbench.editor.tabSizingFixedMaxWidth":{type:"number",default:160,minimum:38,markdownDescription:h(3594,"Controls the maximum width of tabs when {0} size is set to {1}.","`#workbench.editor.tabSizing#`","`fixed`")},"window.density.editorTabHeight":{type:"string",enum:["default","compact"],default:"default",markdownDescription:h(3595,"Controls the height of editor tabs. Also applies to the title control bar when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.pinnedTabSizing":{type:"string",enum:["normal","compact","shrink"],default:"normal",enumDescriptions:[h(3596,"A pinned tab inherits the look of non pinned tabs."),h(3597,"A pinned tab will show in a compact form with only icon or first letter of the editor name."),h(3598,"A pinned tab shrinks to a compact fixed size showing parts of the editor name.")],markdownDescription:h(3599,"Controls the size of pinned editor tabs. Pinned tabs are sorted to the beginning of all opened tabs and typically do not close until unpinned. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.pinnedTabsOnSeparateRow":{type:"boolean",default:!1,markdownDescription:h(3600,"When enabled, displays pinned tabs in a separate row above all other tabs. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`")},"workbench.editor.preventPinnedEditorClose":{type:"string",enum:["keyboardAndMouse","keyboard","mouse","never"],default:"keyboardAndMouse",enumDescriptions:[h(3601,"Always prevent closing the pinned editor when using mouse middle click or keyboard."),h(3602,"Prevent closing the pinned editor when using the keyboard."),h(3603,"Prevent closing the pinned editor when using mouse middle click."),h(3604,"Never prevent closing a pinned editor.")],description:h(3605,"Controls whether pinned editors should close when keyboard or middle mouse click is used for closing.")},"workbench.editor.splitSizing":{type:"string",enum:["auto","distribute","split"],default:"auto",enumDescriptions:[h(3606,"Splits the active editor group to equal parts, unless all editor groups are already in equal parts. In that case, splits all the editor groups to equal parts."),h(3607,"Splits all the editor groups to equal parts."),h(3608,"Splits the active editor group to equal parts.")],description:h(3609,"Controls the size of editor groups when splitting them.")},"workbench.editor.splitOnDragAndDrop":{type:"boolean",default:!0,description:h(3610,"Controls if editor groups can be split from drag and drop operations by dropping an editor or file on the edges of the editor area.")},"workbench.editor.dragToOpenWindow":{type:"boolean",default:!0,markdownDescription:h(3611,"Controls if editors can be dragged out of the window to open them in a new window. Press and hold the `Alt` key while dragging to toggle this dynamically.")},"workbench.editor.focusRecentEditorAfterClose":{type:"boolean",description:h(3612,"Controls whether editors are closed in most recently used order or from left to right."),default:!0},"workbench.editor.showIcons":{type:"boolean",description:h(3613,"Controls whether opened editors should show with an icon or not. This requires a file icon theme to be enabled as well."),default:!0},"workbench.editor.enablePreview":{type:"boolean",description:h(3614,"Controls whether preview mode is used when editors open. There is a maximum of one preview mode editor per editor group. This editor displays its filename in italics on its tab or title label and in the Open Editors view. Its contents will be replaced by the next editor opened in preview mode. Making a change in a preview mode editor will persist it, as will a double-click on its label, or the 'Keep Open' option in its label context menu. Opening a file from Explorer with a double-click persists its editor immediately."),default:!0},"workbench.editor.enablePreviewFromQuickOpen":{type:"boolean",markdownDescription:h(3615,"Controls whether editors opened from Quick Open show as preview editors. Preview editors do not stay open, and are reused until explicitly set to be kept open (via double-click or editing). When enabled, hold Ctrl before selection to open an editor as a non-preview. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.enablePreviewFromCodeNavigation":{type:"boolean",markdownDescription:h(3616,"Controls whether editors remain in preview when a code navigation is started from them. Preview editors do not stay open, and are reused until explicitly set to be kept open (via double-click or editing). This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),default:!1},"workbench.editor.closeOnFileDelete":{type:"boolean",description:h(3617,"Controls whether editors showing a file that was opened during the session should close automatically when getting deleted or renamed by some other process. Disabling this will keep the editor open  on such an event. Note that deleting from within the application will always close the editor and that editors with unsaved changes will never close to preserve your data."),default:!1},"workbench.editor.openPositioning":{type:"string",enum:["left","right","first","last"],default:"right",markdownDescription:h(3618,"Controls where editors open. Select {0} or {1} to open editors to the left or right of the currently active one. Select {2} or {3} to open editors independently from the currently active one.","`left`","`right`","`first`","`last`")},"workbench.editor.openSideBySideDirection":{type:"string",enum:["right","down"],default:"right",markdownDescription:h(3619,"Controls the default direction of editors that are opened side by side (for example, from the Explorer). By default, editors will open on the right hand side of the currently active one. If changed to `down`, the editors will open below the currently active one.")},"workbench.editor.closeEmptyGroups":{type:"boolean",description:h(3620,"Controls the behavior of empty editor groups when the last tab in the group is closed. When enabled, empty groups will automatically close. When disabled, empty groups will remain part of the grid."),default:!0},"workbench.editor.revealIfOpen":{type:"boolean",description:h(3621,"Controls whether an editor is revealed in any of the visible groups if opened. If disabled, an editor will prefer to open in the currently active editor group. If enabled, an already opened editor will be revealed instead of opened again in the currently active editor group. Note that there are some cases where this setting is ignored, such as when forcing an editor to open in a specific group or to the side of the currently active group."),default:!1},"workbench.editor.mouseBackForwardToNavigate":{type:"boolean",description:h(3622,"Enables the use of mouse buttons four and five for commands 'Go Back' and 'Go Forward'."),default:!0},"workbench.editor.navigationScope":{type:"string",enum:["default","editorGroup","editor"],default:"default",markdownDescription:h(3623,"Controls the scope of history navigation in editors for commands such as 'Go Back' and 'Go Forward'."),enumDescriptions:[h(3624,"Navigate across all opened editors and editor groups."),h(3625,"Navigate only in editors of the active editor group."),h(3626,"Navigate only in the active editor.")]},"workbench.editor.restoreViewState":{type:"boolean",markdownDescription:h(3627,"Restores the last editor view state (such as scroll position) when re-opening editors after they have been closed. Editor view state is stored per editor group and discarded when a group closes. Use the {0} setting to use the last known view state across all editor groups in case no previous view state was found for a editor group.","`#workbench.editor.sharedViewState#`"),default:!0,scope:Ht.LANGUAGE_OVERRIDABLE},"workbench.editor.sharedViewState":{type:"boolean",description:h(3628,"Preserves the most recent editor view state (such as scroll position) across all editor groups and restores that if no specific editor view state is found for the editor group."),default:!1},"workbench.editor.splitInGroupLayout":{type:"string",enum:["vertical","horizontal"],default:"horizontal",markdownDescription:h(3629,"Controls the layout for when an editor is split in an editor group to be either vertical or horizontal."),enumDescriptions:[h(3630,"Editors are positioned from top to bottom."),h(3631,"Editors are positioned from left to right.")]},"workbench.editor.centeredLayoutAutoResize":{type:"boolean",default:!0,description:h(3632,"Controls if the centered layout should automatically resize to maximum width when more than one group is open. Once only one group is open it will resize back to the original centered width.")},"workbench.editor.centeredLayoutFixedWidth":{type:"boolean",default:!1,description:h(3633,"Controls whether the centered layout tries to maintain constant width when the window is resized.")},"workbench.editor.doubleClickTabToToggleEditorGroupSizes":{type:"string",enum:["maximize","expand","off"],default:"expand",markdownDescription:h(3634,"Controls how the editor group is resized when double clicking on a tab. This value is ignored when {0} is not set to {1}.","`#workbench.editor.showTabs#`","`multiple`"),enumDescriptions:[h(3635,"All other editor groups are hidden and the current editor group is maximized to take up the entire editor area."),h(3636,"The editor group takes as much space as possible by making all other editor groups as small as possible."),h(3637,"No editor group is resized when double clicking on a tab.")]},"workbench.editor.limit.enabled":{type:"boolean",default:!1,description:h(3638,"Controls if the number of opened editors should be limited or not. When enabled, less recently used editors will close to make space for newly opening editors.")},"workbench.editor.limit.value":{type:"number",default:10,exclusiveMinimum:0,markdownDescription:h(3639,"Controls the maximum number of opened editors. Use the {0} setting to control this limit per editor group or across all groups.","`#workbench.editor.limit.perEditorGroup#`")},"workbench.editor.limit.excludeDirty":{type:"boolean",default:!1,description:h(3640,"Controls if the maximum number of opened editors should exclude dirty editors for counting towards the configured limit.")},"workbench.editor.limit.perEditorGroup":{type:"boolean",default:!1,description:h(3641,"Controls if the limit of maximum opened editors should apply per editor group or across all editor groups.")},"workbench.localHistory.enabled":{type:"boolean",default:!0,description:h(3642,"Controls whether local file history is enabled. When enabled, the file contents of an editor that is saved will be stored to a backup location to be able to restore or review the contents later. Changing this setting has no effect on existing local file history entries."),scope:Ht.RESOURCE},"workbench.localHistory.maxFileSize":{type:"number",default:256,minimum:1,description:h(3643,"Controls the maximum size of a file (in KB) to be considered for local file history. Files that are larger will not be added to the local file history. Changing this setting has no effect on existing local file history entries."),scope:Ht.RESOURCE},"workbench.localHistory.maxFileEntries":{type:"number",default:50,minimum:0,description:h(3644,"Controls the maximum number of local file history entries per file. When the number of local file history entries exceeds this number for a file, the oldest entries will be discarded."),scope:Ht.RESOURCE},"workbench.localHistory.exclude":{type:"object",patternProperties:{".*":{type:"boolean"}},markdownDescription:h(3645,"Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) for excluding files from the local file history. Glob patterns are always evaluated relative to the path of the workspace folder unless they are absolute paths. Changing this setting has no effect on existing local file history entries."),scope:Ht.RESOURCE},"workbench.localHistory.mergeWindow":{type:"number",default:10,minimum:1,markdownDescription:h(3646,"Configure an interval in seconds during which the last entry in local file history is replaced with the entry that is being added. This helps reduce the overall number of entries that are added, for example when auto save is enabled. This setting is only applied to entries that have the same source of origin. Changing this setting has no effect on existing local file history entries."),scope:Ht.RESOURCE},"workbench.commandPalette.history":{type:"number",description:h(3647,"Controls the number of recently used commands to keep in history for the command palette. Set to 0 to disable command history."),default:50,minimum:0},"workbench.commandPalette.preserveInput":{type:"boolean",description:h(3648,"Controls whether the last typed input to the command palette should be restored when opening it the next time."),default:!1},"workbench.commandPalette.experimental.suggestCommands":{type:"boolean",tags:["experimental"],description:h(3649,"Controls whether the command palette should have a list of commonly used commands."),default:!1},"workbench.commandPalette.experimental.askChatLocation":{type:"string",tags:["experimental"],description:h(3650,"Controls where the command palette should ask chat questions."),default:"chatView",enum:["chatView","quickChat"],enumDescriptions:[h(3651,"Ask chat questions in the Chat view."),h(3652,"Ask chat questions in Quick Chat.")]},"workbench.commandPalette.experimental.enableNaturalLanguageSearch":{type:"boolean",tags:["experimental"],description:h(3653,"Controls whether the command palette should include similar commands. You must have an extension installed that provides Natural Language support."),default:!0},"workbench.quickOpen.closeOnFocusLost":{type:"boolean",description:h(3654,"Controls whether Quick Open should close automatically once it loses focus."),default:!0},"workbench.quickOpen.preserveInput":{type:"boolean",description:h(3655,"Controls whether the last typed input to Quick Open should be restored when opening it the next time."),default:!1},"workbench.settings.openDefaultSettings":{type:"boolean",description:h(3656,"Controls whether opening settings also opens an editor showing all default settings."),default:!1},"workbench.settings.useSplitJSON":{type:"boolean",markdownDescription:h(3657,"Controls whether to use the split JSON editor when editing settings as JSON."),default:!1},"workbench.settings.openDefaultKeybindings":{type:"boolean",description:h(3658,"Controls whether opening keybinding settings also opens an editor showing all default keybindings."),default:!1},"workbench.sideBar.location":{type:"string",enum:["left","right"],default:"left",description:h(3659,"Controls the location of the primary side bar and activity bar. They can either show on the left or right of the workbench. The secondary side bar will show on the opposite side of the workbench.")},"workbench.panel.showLabels":{type:"boolean",default:!0,description:h(3660,"Controls whether activity items in the panel title are shown as label or icon.")},"workbench.panel.defaultLocation":{type:"string",enum:["left","bottom","top","right"],default:"bottom",description:h(3661,"Controls the default location of the panel (Terminal, Debug Console, Output, Problems) in a new workspace. It can either show at the bottom, top, right, or left of the editor area.")},"workbench.panel.opensMaximized":{type:"string",enum:["always","never","preserve"],default:"preserve",description:h(3662,"Controls whether the panel opens maximized. It can either always open maximized, never open maximized, or open to the last state it was in before being closed."),enumDescriptions:[h(3663,"Always maximize the panel when opening it."),h(3664,"Never maximize the panel when opening it. The panel will open un-maximized."),h(3665,"Open the panel to the state that it was in, before it was closed.")]},"workbench.secondarySideBar.defaultVisibility":{type:"string",enum:["hidden","visibleInWorkspace","visible"],default:"hidden",tags:["onExp"],description:h(3666,"Controls the default visibility of the secondary side bar in workspaces or empty windows opened for the first time."),enumDescriptions:[h(3667,"The secondary side bar is hidden by default."),h(3668,"The secondary side bar is visible by default if a workspace is opened."),h(3669,"The secondary side bar is visible by default.")]},"workbench.secondarySideBar.showLabels":{type:"boolean",default:!0,markdownDescription:h(3670,"Controls whether activity items in the secondary side bar title are shown as label or icon. This setting only has an effect when {0} is not set to {1}.","`#workbench.activityBar.location#`","`top`")},"workbench.statusBar.visible":{type:"boolean",default:!0,description:h(3671,"Controls the visibility of the status bar at the bottom of the workbench.")},[oi.ACTIVITY_BAR_LOCATION]:{type:"string",enum:["default","top","bottom","hidden"],default:"default",markdownDescription:h(3672,"Controls the location of the Activity Bar relative to the Primary and Secondary Side Bars."),enumDescriptions:[h(3673,"Show the Activity Bar on the side of the Primary Side Bar and on top of the Secondary Side Bar."),h(3674,"Show the Activity Bar on top of the Primary and Secondary Side Bars."),h(3675,"Show the Activity Bar at the bottom of the Primary and Secondary Side Bars."),h(3676,"Hide the Activity Bar in the Primary and Secondary Side Bars.")]},"workbench.activityBar.iconClickBehavior":{type:"string",enum:["toggle","focus"],default:"toggle",markdownDescription:h(3677,"Controls the behavior of clicking an Activity Bar icon in the workbench. This value is ignored when {0} is not set to {1}.","`#workbench.activityBar.location#`","`default`"),enumDescriptions:[h(3678,"Hide the Primary Side Bar if the clicked item is already visible."),h(3679,"Focus the Primary Side Bar if the clicked item is already visible.")]},"workbench.view.alwaysShowHeaderActions":{type:"boolean",default:!1,description:h(3680,"Controls the visibility of view header actions. View header actions may either be always visible, or only visible when that view is focused or hovered over.")},"workbench.view.showQuietly":{type:"object",description:h(3681,"If an extension requests a hidden view to be shown, display a clickable status bar indicator instead."),scope:Ht.WINDOW,properties:{"workbench.panel.output":{type:"boolean",description:h(3682,"Output view")}},additionalProperties:!1},"workbench.fontAliasing":{type:"string",enum:["default","antialiased","none","auto"],default:"default",description:h(3683,"Controls font aliasing method in the workbench."),enumDescriptions:[h(3684,"Sub-pixel font smoothing. On most non-retina displays this will give the sharpest text."),h(3685,"Smooth the font on the level of the pixel, as opposed to the subpixel. Can make the font appear lighter overall."),h(3686,"Disables font smoothing. Text will show with jagged sharp edges."),h(3687,"Applies `default` or `antialiased` automatically based on the DPI of displays.")],included:Yt},"workbench.settings.editor":{type:"string",enum:["ui","json"],enumDescriptions:[h(3688,"Use the settings UI editor."),h(3689,"Use the JSON file editor.")],description:h(3690,"Determines which Settings editor to use by default."),default:"ui",scope:Ht.WINDOW},"workbench.settings.showSuggestions":{type:"boolean",default:!1,description:h(3691,"Controls whether setting suggestions are shown below the search bar in the Settings editor."),tags:["experimental"]},"workbench.hover.delay":{type:"number",description:h(3692,"Controls the delay in milliseconds after which the hover is shown for workbench items (ex. some extension provided tree view items). Already visible items may require a refresh before reflecting this setting change."),default:Yt?1500:500,minimum:0},"workbench.reduceMotion":{type:"string",description:h(3693,"Controls whether the workbench should render with fewer animations."),enumDescriptions:[h(3694,"Always render with reduced motion."),h(3695,"Do not render with reduced motion"),h(3696,"Render with reduced motion based on OS configuration.")],default:"auto",tags:["accessibility"],enum:["on","off","auto"]},"workbench.navigationControl.enabled":{type:"boolean",default:!0,markdownDescription:Kt?h(3697,"Controls whether the navigation control in the title bar is shown."):h(3698,"Controls whether the navigation control is shown in the custom title bar. This setting only has an effect when {0} is not set to {1}.","`#window.customTitleBarVisibility#`","`never`")},[oi.LAYOUT_ACTIONS]:{type:"boolean",default:!0,markdownDescription:Kt?h(3699,"Controls whether the layout control in the title bar is shown."):h(3700,"Controls whether the layout control is shown in the custom title bar. This setting only has an effect when {0} is not set to {1}.","`#window.customTitleBarVisibility#`","`never`")},"workbench.layoutControl.type":{type:"string",enum:["menu","toggles","both"],enumDescriptions:[h(3701,"Shows a single button with a dropdown of layout options."),h(3702,"Shows several buttons for toggling the visibility of the panels and side bar."),h(3703,"Shows both the dropdown and toggle buttons.")],default:"both",description:h(3704,"Controls whether the layout control in the custom title bar is displayed as a single menu button or with multiple UI toggles.")},"workbench.tips.enabled":{type:"boolean",default:!0,description:h(3705,"When enabled, will show the watermark tips when no editor is open.")}}});let e=h(3706,"Controls the window title based on the current context such as the opened workspace or active editor. Variables are substituted based on the context:");e+=`
- `+[h(3707,"`${activeEditorShort}`: the file name (e.g. myFile.txt)."),h(3708,"`${activeEditorMedium}`: the path of the file relative to the workspace folder (e.g. myFolder/myFileFolder/myFile.txt)."),h(3709,"`${activeEditorLong}`: the full path of the file (e.g. /Users/Development/myFolder/myFileFolder/myFile.txt)."),h(3710,"`${activeFolderShort}`: the name of the folder the file is contained in (e.g. myFileFolder)."),h(3711,"`${activeFolderMedium}`: the path of the folder the file is contained in, relative to the workspace folder (e.g. myFolder/myFileFolder)."),h(3712,"`${activeFolderLong}`: the full path of the folder the file is contained in (e.g. /Users/Development/myFolder/myFileFolder)."),h(3713,"`${folderName}`: name of the workspace folder the file is contained in (e.g. myFolder)."),h(3714,"`${folderPath}`: file path of the workspace folder the file is contained in (e.g. /Users/Development/myFolder)."),h(3715,"`${rootName}`: name of the workspace with optional remote name and workspace indicator if applicable (e.g. myFolder, myRemoteFolder [SSH] or myWorkspace (Workspace))."),h(3716,"`${rootNameShort}`: shortened name of the workspace without suffixes (e.g. myFolder, myRemoteFolder or myWorkspace)."),h(3717,"`${rootPath}`: file path of the opened workspace or folder (e.g. /Users/Development/myWorkspace)."),h(3718,"`${profileName}`: name of the profile in which the workspace is opened (e.g. Data Science (Profile)). Ignored if default profile is used."),h(3719,"`${appName}`: e.g. VS Code."),h(3720,"`${remoteName}`: e.g. SSH"),h(3721,"`${dirty}`: an indicator for when the active editor has unsaved changes."),h(3722,"`${focusedView}`: the name of the view that is currently focused."),h(3723,"`${activeRepositoryName}`: the name of the active repository (e.g. vscode)."),h(3724,"`${activeRepositoryBranchName}`: the name of the active branch in the active repository (e.g. main)."),h(3725,"`${activeEditorState}`: provides information about the state of the active editor (e.g. modified). This will be appended by default when in screen reader mode with {0} enabled.","`accessibility.windowTitleOptimized`"),h(3726,'`${separator}`: a conditional separator (" - ") that only shows when surrounded by variables with values or static text.')].join(`
- `),mk.registerConfiguration({...yCe,properties:{"window.title":{type:"string",default:zpe,markdownDescription:e},"window.titleSeparator":{type:"string",default:qpe,markdownDescription:h(3727,"Separator used by {0}.","`#window.title#`")},[oi.COMMAND_CENTER]:{type:"boolean",default:!0,markdownDescription:Kt?h(3728,"Show command launcher together with the window title."):h(3729,"Show command launcher together with the window title. This setting only has an effect when {0} is not set to {1}.","`#window.customTitleBarVisibility#`","`never`")},"window.menuBarVisibility":{type:"string",enum:["classic","visible","toggle","hidden","compact"],markdownEnumDescriptions:[h(3730,"Menu is displayed at the top of the window and only hidden in full screen mode."),h(3731,"Menu is always visible at the top of the window even in full screen mode."),Yt?h(3732,"Menu is hidden but can be displayed at the top of the window by executing the `Focus Application Menu` command."):h(3733,"Menu is hidden but can be displayed at the top of the window via the Alt key."),h(3734,"Menu is always hidden."),Kt?h(3735,"Menu is displayed as a compact button in the side bar."):h(3736,"Menu is displayed as a compact button in the side bar. This value is ignored when {0} is {1}.","`#window.titleBarStyle#`","`native`")],default:Kt?"compact":"classic",scope:Ht.APPLICATION,markdownDescription:Yt?h(3737,"Control the visibility of the menu bar. A setting of 'toggle' means that the menu bar is hidden and executing `Focus Application Menu` will show it. A setting of 'compact' will move the menu into the side bar."):h(3738,"Control the visibility of the menu bar. A setting of 'toggle' means that the menu bar is hidden and a single press of the Alt key will show it. A setting of 'compact' will move the menu into the side bar."),included:bn||fh||Kt},"window.enableMenuBarMnemonics":{type:"boolean",default:!0,scope:Ht.APPLICATION,description:h(3739,"Controls whether the main menus can be opened via Alt-key shortcuts. Disabling mnemonics allows to bind these Alt-key shortcuts to editor commands instead."),included:bn||fh},"window.customMenuBarAltFocus":{type:"boolean",default:!0,scope:Ht.APPLICATION,markdownDescription:h(3740,"Controls whether the menu bar will be focused by pressing the Alt-key. This setting has no effect on toggling the menu bar with the Alt-key."),included:bn||fh},"window.openFilesInNewWindow":{type:"string",enum:["on","off","default"],enumDescriptions:[h(3741,"Files will open in a new window."),h(3742,"Files will open in the window with the files' folder open or the last active window."),Yt?h(3743,"Files will open in the window with the files' folder open or the last active window unless opened via the Dock or from Finder."):h(3744,"Files will open in a new window unless picked from within the application (e.g. via the File menu).")],default:"off",scope:Ht.APPLICATION,markdownDescription:Yt?h(3745,"Controls whether files should open in a new window when using a command line or file dialog.\nNote that there can still be cases where this setting is ignored (e.g. when using the `--new-window` or `--reuse-window` command line option)."):h(3746,"Controls whether files should open in a new window when using a command line or file dialog.\nNote that there can still be cases where this setting is ignored (e.g. when using the `--new-window` or `--reuse-window` command line option).")},"window.openFoldersInNewWindow":{type:"string",enum:["on","off","default"],enumDescriptions:[h(3747,"Folders will open in a new window."),h(3748,"Folders will replace the last active window."),h(3749,"Folders will open in a new window unless a folder is picked from within the application (e.g. via the File menu).")],default:"default",scope:Ht.APPLICATION,markdownDescription:h(3750,"Controls whether folders should open in a new window or replace the last active window.\nNote that there can still be cases where this setting is ignored (e.g. when using the `--new-window` or `--reuse-window` command line option).")},"window.confirmBeforeClose":{type:"string",enum:["always","keyboardOnly","never"],enumDescriptions:[Kt?h(3751,"Always try to ask for confirmation. Note that browsers may still decide to close a tab or window without confirmation."):h(3752,"Always ask for confirmation."),Kt?h(3753,"Only ask for confirmation if a keybinding was used to close the window. Note that detection may not be possible in some cases."):h(3754,"Only ask for confirmation if a keybinding was used."),Kt?h(3755,"Never explicitly ask for confirmation unless data loss is imminent."):h(3756,"Never explicitly ask for confirmation.")],default:Kt&&!Ewe()?"keyboardOnly":"never",markdownDescription:Kt?h(3757,"Controls whether to show a confirmation dialog before closing the browser tab or window. Note that even if enabled, browsers may still decide to close a tab or window without confirmation and that this setting is only a hint that may not work in all cases."):h(3758,"Controls whether to show a confirmation dialog before closing a window or quitting the application."),scope:Ht.APPLICATION}}}),rc(N8.ID,N8,ac.Eventually),mk.registerConfiguration({...wCe,properties:{"problems.visibility":{type:"boolean",default:!0,description:h(3759,"Controls whether the problems are visible throughout the editor and workbench.")}}}),mk.registerConfiguration({id:"zenMode",order:9,title:h(3760,"Zen Mode"),type:"object",properties:{"zenMode.fullScreen":{type:"boolean",default:!0,description:h(3761,"Controls whether turning on Zen Mode also puts the workbench into full screen mode.")},"zenMode.centerLayout":{type:"boolean",default:!0,description:h(3762,"Controls whether turning on Zen Mode also centers the layout.")},"zenMode.showTabs":{type:"string",enum:["multiple","single","none"],description:h(3763,"Controls whether turning on Zen Mode should show multiple editor tabs, a single editor tab, or hide the editor title area completely."),enumDescriptions:[h(3764,"Each editor is displayed as a tab in the editor title area."),h(3765,"The active editor is displayed as a single large tab in the editor title area."),h(3766,"The editor title area is not displayed.")],default:"multiple"},"zenMode.hideStatusBar":{type:"boolean",default:!0,description:h(3767,"Controls whether turning on Zen Mode also hides the status bar at the bottom of the workbench.")},"zenMode.hideActivityBar":{type:"boolean",default:!0,description:h(3768,"Controls whether turning on Zen Mode also hides the activity bar either at the left or right of the workbench.")},"zenMode.hideLineNumbers":{type:"boolean",default:!0,description:h(3769,"Controls whether turning on Zen Mode also hides the editor line numbers.")},"zenMode.restore":{type:"boolean",default:!0,description:h(3770,"Controls whether a window should restore to Zen Mode if it was exited in Zen Mode.")},"zenMode.silentNotifications":{type:"boolean",default:!0,description:h(3771,"Controls whether notifications do not disturb mode should be enabled while in Zen Mode. If true, only error notifications will pop out.")}}})})();Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"workbench.activityBar.visible",migrateFn:s=>{const e=[];return s!==void 0&&e.push(["workbench.activityBar.visible",{value:void 0}]),s===!1&&e.push([oi.ACTIVITY_BAR_LOCATION,{value:er.HIDDEN}]),e}}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:oi.ACTIVITY_BAR_LOCATION,migrateFn:s=>{const e=[];return s==="side"&&e.push([oi.ACTIVITY_BAR_LOCATION,{value:er.DEFAULT}]),e}}]);Ke.as(bc.ConfigurationMigration).registerConfigurationMigrations([{key:"workbench.editor.doubleClickTabToToggleEditorGroupSizes",migrateFn:s=>{const e=[];return typeof s=="boolean"&&(s=s?"expand":"off",e.push(["workbench.editor.doubleClickTabToToggleEditorGroupSizes",{value:s}])),e}},{key:oi.EDITOR_TABS_MODE,migrateFn:s=>{const e=[];return typeof s=="boolean"&&(s=s?_o.MULTIPLE:_o.SINGLE,e.push([oi.EDITOR_TABS_MODE,{value:s}])),e}},{key:"workbench.editor.tabCloseButton",migrateFn:s=>{const e=[];return s==="left"||s==="right"?e.push(["workbench.editor.tabActionLocation",{value:s}]):s==="off"&&e.push(["workbench.editor.tabActionCloseVisibility",{value:!1}]),e}},{key:"zenMode.hideTabs",migrateFn:s=>{const e=[["zenMode.hideTabs",{value:void 0}]];return s===!0&&e.push(["zenMode.showTabs",{value:"single"}]),e}}]);let Kpe=()=>!1,jpe=()=>!1;const $ze=Tv.prototype.getCommandPicks;Tv.prototype.getCommandPicks=async function(s){let e=await $ze.call(this,s);return Kpe()||(e=e.map(t=>({...t,buttons:void 0}))),e};let sz=class{constructor(e){this.instantiationService=e,this.workbenchQuickInputService=e.createInstance(ZG)}toggleHover(){return this.activeService.toggleHover()}get activeService(){const e=Qa.get(Bt).getFocusedCodeEditor();return e==null||jpe(e,e instanceof Zse)?this.workbenchQuickInputService:(this.standaloneQuickInputService??(this.standaloneQuickInputService=this.instantiationService.createInstance(xwe)),this.standaloneQuickInputService)}get currentQuickInput(){return this.activeService.currentQuickInput}get quickAccess(){return this.activeService.quickAccess}get backButton(){return this.activeService.backButton}get onShow(){return this.activeService.onShow}get onHide(){return this.activeService.onHide}createQuickWidget(){return this.activeService.createQuickWidget()}pick(e,t={},i=Ce.None){return this.activeService.pick(e,t,i)}input(e,t){return this.activeService.input(e,t)}createQuickPick(e={useSeparators:!1}){return this.activeService.createQuickPick(e)}createInputBox(){return this.activeService.createInputBox()}focus(){return this.activeService.focus()}toggle(){return this.activeService.toggle()}navigate(e,t){return this.activeService.navigate(e,t)}accept(){return this.activeService.accept()}back(){return this.activeService.back()}cancel(){return this.activeService.cancel()}setAlignment(e){return this.activeService.setAlignment(e)}};sz=f([p(0,Z)],sz);function Gze({isKeybindingConfigurationVisible:s,shouldUseGlobalPicker:e}={}){return s!=null&&(Kpe=s),e!=null&&(jpe=e),{[Wt.toString()]:new Sr(sz,[],!0)}}const Iie=/^([^.]+\..+)[:=](.+)$/;class Oe{get remoteAuthority(){return this.options.remoteAuthority}get expectsResolverExtension(){return!!this.options.remoteAuthority?.includes("+")&&!this.options.webSocketFactory}get isBuilt(){return!!this.productService.commit}get logLevel(){const e=this.payload?.get("logLevel");return e?e.split(",").find(t=>!Iie.test(t)):this.options.developmentOptions?.logLevel!==void 0?zF(this.options.developmentOptions?.logLevel):void 0}get extensionLogLevel(){const e=this.payload?.get("logLevel");if(e){const t=[];for(const i of e.split(",")){const n=Iie.exec(i);n&&n[1]&&n[2]&&t.push([n[1],n[2]])}return t.length?t:void 0}return this.options.developmentOptions?.extensionLogLevel!==void 0?this.options.developmentOptions?.extensionLogLevel.map(([t,i])=>[t,zF(i)]):void 0}get profDurationMarkers(){const e=this.payload?.get("profDurationMarkers");if(e){const t=[];for(const i of e.split(","))t.push(i);return t.length===2?t:void 0}}get windowLogsPath(){return this.logsHome}get logFile(){return Ct(this.windowLogsPath,"window.log")}get userRoamingDataHome(){return R.file("/User").with({scheme:ae.vscodeUserData})}get argvResource(){return Ct(this.userRoamingDataHome,"argv.json")}get cacheHome(){return Ct(this.userRoamingDataHome,"caches")}get workspaceStorageHome(){return Ct(this.userRoamingDataHome,"workspaceStorage")}get localHistoryHome(){return Ct(this.userRoamingDataHome,"History")}get stateResource(){return Ct(this.userRoamingDataHome,"State","storage.json")}get userDataSyncHome(){return Ct(this.userRoamingDataHome,"sync",this.workspaceId)}get sync(){}get keyboardLayoutResource(){return Ct(this.userRoamingDataHome,"keyboardLayout.json")}get untitledWorkspacesHome(){return Ct(this.userRoamingDataHome,"Workspaces")}get serviceMachineIdResource(){return Ct(this.userRoamingDataHome,"machineid")}get extHostLogsPath(){return Ct(this.logsHome,"exthost")}get debugExtensionHost(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.params}get isExtensionDevelopment(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.isExtensionDevelopment}get extensionDevelopmentLocationURI(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionDevelopmentLocationURI}get extensionDevelopmentLocationKind(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionDevelopmentKind}get extensionTestsLocationURI(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionTestsLocationURI}get extensionEnabledProposedApi(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.extensionEnabledProposedApi}get debugRenderer(){return this.extensionHostDebugEnvironment||(this.extensionHostDebugEnvironment=this.resolveExtensionHostDebugEnvironment()),this.extensionHostDebugEnvironment.debugRenderer}get enableSmokeTestDriver(){return this.options.developmentOptions?.enableSmokeTestDriver}get disableExtensions(){return this.payload?.get("disableExtensions")==="true"}get enableExtensions(){return this.options.enabledExtensions}get webviewExternalEndpoint(){const e=this.options.webviewEndpoint||this.productService.webviewContentExternalBaseUrlTemplate||"https://{{uuid}}.vscode-cdn.net/{{quality}}/{{commit}}/out/vs/workbench/contrib/webview/browser/pre/",t=this.payload?.get("webviewExternalEndpointCommit");return e.replace("{{commit}}",t??this.productService.commit??"ef65ac1ba57f57f2a3961bfe94aa20481caca4c6").replace("{{quality}}",(t?"insider":this.productService.quality)??"insider")}get extensionTelemetryLogResource(){return Ct(this.logsHome,"extensionTelemetry.log")}get disableTelemetry(){return!1}get verbose(){return this.payload?.get("verbose")==="true"}get logExtensionHostCommunication(){return this.payload?.get("logExtensionHostCommunication")==="true"}get skipReleaseNotes(){return this.payload?.get("skipReleaseNotes")==="true"}get skipWelcome(){return this.payload?.get("skipWelcome")==="true"}get disableWorkspaceTrust(){return!this.options.enableWorkspaceTrust}get profile(){return this.payload?.get("profile")}get editSessionId(){return this.options.editSessionId}constructor(e,t,i,n){if(this.workspaceId=e,this.logsHome=t,this.options=i,this.productService=n,this.extensionHostDebugEnvironment=void 0,i.workspaceProvider&&Array.isArray(i.workspaceProvider.payload))try{this.payload=new Map(i.workspaceProvider.payload)}catch(o){mt(o)}}resolveExtensionHostDebugEnvironment(){const e={params:{port:null,break:!1},debugRenderer:!1,isExtensionDevelopment:!1,extensionDevelopmentLocationURI:void 0,extensionDevelopmentKind:void 0};if(this.payload)for(const[i,n]of this.payload)switch(i){case"extensionDevelopmentPath":e.extensionDevelopmentLocationURI||(e.extensionDevelopmentLocationURI=[]),e.extensionDevelopmentLocationURI.push(R.parse(n)),e.isExtensionDevelopment=!0;break;case"extensionDevelopmentKind":e.extensionDevelopmentKind=[n];break;case"extensionTestsPath":e.extensionTestsLocationURI=R.parse(n);break;case"debugRenderer":e.debugRenderer=n==="true";break;case"debugId":e.params.debugId=n;break;case"inspect-brk-extensions":e.params.port=parseInt(n),e.params.break=!0;break;case"inspect-extensions":e.params.port=parseInt(n);break;case"enableProposedApi":e.extensionEnabledProposedApi=[];break}const t=this.options.developmentOptions;return t&&!e.isExtensionDevelopment&&(t.extensions?.length&&(e.extensionDevelopmentLocationURI=t.extensions.map(i=>R.revive(i)),e.isExtensionDevelopment=!0),t.extensionTestsPath&&(e.extensionTestsLocationURI=R.revive(t.extensionTestsPath))),e}get filesToOpenOrCreate(){if(this.payload){const e=this.payload.get("openFile");if(e){const t=R.parse(e);if(this.payload.has("gotoLineMode")){const i=Nse(t.path);return[{fileUri:t.with({path:i.path}),options:{selection:Ym(i.line)?void 0:{startLineNumber:i.line,startColumn:i.column||1}}}]}return[{fileUri:t}]}}}get filesToDiff(){if(this.payload){const e=this.payload.get("diffFilePrimary"),t=this.payload.get("diffFileSecondary");if(e&&t)return[{fileUri:R.parse(t)},{fileUri:R.parse(e)}]}}get filesToMerge(){if(this.payload){const e=this.payload.get("mergeFile1"),t=this.payload.get("mergeFile2"),i=this.payload.get("mergeFileBase"),n=this.payload.get("mergeFileResult");if(e&&t&&i&&n)return[{fileUri:R.parse(e)},{fileUri:R.parse(t)},{fileUri:R.parse(i)},{fileUri:R.parse(n)}]}}}Oe.__decorator=f([Gt],Oe.prototype,"remoteAuthority",null);Oe.__decorator=f([Gt],Oe.prototype,"expectsResolverExtension",null);Oe.__decorator=f([Gt],Oe.prototype,"isBuilt",null);Oe.__decorator=f([Gt],Oe.prototype,"logLevel",null);Oe.__decorator=f([Gt],Oe.prototype,"windowLogsPath",null);Oe.__decorator=f([Gt],Oe.prototype,"logFile",null);Oe.__decorator=f([Gt],Oe.prototype,"userRoamingDataHome",null);Oe.__decorator=f([Gt],Oe.prototype,"argvResource",null);Oe.__decorator=f([Gt],Oe.prototype,"cacheHome",null);Oe.__decorator=f([Gt],Oe.prototype,"workspaceStorageHome",null);Oe.__decorator=f([Gt],Oe.prototype,"localHistoryHome",null);Oe.__decorator=f([Gt],Oe.prototype,"stateResource",null);Oe.__decorator=f([Gt],Oe.prototype,"userDataSyncHome",null);Oe.__decorator=f([Gt],Oe.prototype,"sync",null);Oe.__decorator=f([Gt],Oe.prototype,"keyboardLayoutResource",null);Oe.__decorator=f([Gt],Oe.prototype,"untitledWorkspacesHome",null);Oe.__decorator=f([Gt],Oe.prototype,"serviceMachineIdResource",null);Oe.__decorator=f([Gt],Oe.prototype,"extHostLogsPath",null);Oe.__decorator=f([Gt],Oe.prototype,"debugExtensionHost",null);Oe.__decorator=f([Gt],Oe.prototype,"isExtensionDevelopment",null);Oe.__decorator=f([Gt],Oe.prototype,"extensionDevelopmentLocationURI",null);Oe.__decorator=f([Gt],Oe.prototype,"extensionDevelopmentLocationKind",null);Oe.__decorator=f([Gt],Oe.prototype,"extensionTestsLocationURI",null);Oe.__decorator=f([Gt],Oe.prototype,"extensionEnabledProposedApi",null);Oe.__decorator=f([Gt],Oe.prototype,"debugRenderer",null);Oe.__decorator=f([Gt],Oe.prototype,"enableSmokeTestDriver",null);Oe.__decorator=f([Gt],Oe.prototype,"disableExtensions",null);Oe.__decorator=f([Gt],Oe.prototype,"enableExtensions",null);Oe.__decorator=f([Gt],Oe.prototype,"webviewExternalEndpoint",null);Oe.__decorator=f([Gt],Oe.prototype,"extensionTelemetryLogResource",null);Oe.__decorator=f([Gt],Oe.prototype,"disableTelemetry",null);Oe.__decorator=f([Gt],Oe.prototype,"verbose",null);Oe.__decorator=f([Gt],Oe.prototype,"logExtensionHostCommunication",null);Oe.__decorator=f([Gt],Oe.prototype,"skipReleaseNotes",null);Oe.__decorator=f([Gt],Oe.prototype,"skipWelcome",null);Oe.__decorator=f([Gt],Oe.prototype,"disableWorkspaceTrust",null);Oe.__decorator=f([Gt],Oe.prototype,"profile",null);Oe.__decorator=f([Gt],Oe.prototype,"editSessionId",null);Oe.__decorator=f([Gt],Oe.prototype,"filesToOpenOrCreate",null);Oe.__decorator=f([Gt],Oe.prototype,"filesToDiff",null);Oe.__decorator=f([Gt],Oe.prototype,"filesToMerge",null);let oz=class extends Oe{constructor(e=Iwe().id,t=Dwe(),i){super(e,kwe,t,i)}};oz=f([p(2,Vn)],oz);function zze(s){return{[Hs.toString()]:new Sr(oz,[void 0,s],!0)}}const qze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(qze);class Kze extends KO{get dimension(){return this._dimension}get contentPosition(){return this._contentPosition}constructor(e,t,i,n,o){super(e,i,n),this.options=t,this.layoutService=o,this._onDidVisibilityChange=this._register(new M),this.onDidVisibilityChange=this._onDidVisibilityChange.event,this._onDidChange=this._register(new M),this._register(o.registerPart(this))}onThemeChange(e){this.parent&&super.onThemeChange(e)}create(e,t){this.parent=e,this.titleArea=this.createTitleArea(e,t),this.contentArea=this.createContentArea(e,t),this.partLayout=new yE(this.options,this.contentArea),this.updateStyles()}getContainer(){return this.parent}createTitleArea(e,t){}getTitleArea(){return this.titleArea}createContentArea(e,t){}getContentArea(){return this.contentArea}setHeaderArea(e){if(this.headerArea)throw new Error("Header already exists");!this.parent||!this.titleArea||(Twe(this.parent,e),e.classList.add("header-or-footer"),e.classList.add("header"),this.headerArea=e,this.partLayout?.setHeaderVisibility(!0),this.relayout())}setFooterArea(e){if(this.footerArea)throw new Error("Footer already exists");!this.parent||!this.titleArea||(this.parent.appendChild(e),e.classList.add("header-or-footer"),e.classList.add("footer"),this.footerArea=e,this.partLayout?.setFooterVisibility(!0),this.relayout())}removeHeaderArea(){this.headerArea&&(this.headerArea.remove(),this.headerArea=void 0,this.partLayout?.setHeaderVisibility(!1),this.relayout())}removeFooterArea(){this.footerArea&&(this.footerArea.remove(),this.footerArea=void 0,this.partLayout?.setFooterVisibility(!1),this.relayout())}relayout(){this.dimension&&this.contentPosition&&this.layout(this.dimension.width,this.dimension.height,this.contentPosition.top,this.contentPosition.left)}layoutContents(e,t){return jt(this.partLayout).layout(e,t)}get onDidChange(){return this._onDidChange.event}layout(e,t,i,n){this._dimension=new Ye(e,t),this._contentPosition={top:i,left:n}}setVisible(e){this._onDidVisibilityChange.fire(e)}}class yE{static{this.HEADER_HEIGHT=35}static{this.TITLE_HEIGHT=35}static{this.Footer_HEIGHT=35}constructor(e,t){this.options=e,this.contentArea=t,this.headerVisible=!1,this.footerVisible=!1}layout(e,t){let i;this.options.hasTitle?i=new Ye(e,Math.min(t,yE.TITLE_HEIGHT)):i=Ye.None;let n;this.headerVisible?n=new Ye(e,Math.min(t,yE.HEADER_HEIGHT)):n=Ye.None;let o;this.footerVisible?o=new Ye(e,Math.min(t,yE.Footer_HEIGHT)):o=Ye.None;let r=e;this.options&&typeof this.options.borderWidth=="function"&&(r-=this.options.borderWidth());const a=new Ye(r,t-i.height-n.height-o.height);return this.contentArea&&Nz(this.contentArea,a.width,a.height),{headerSize:n,titleSize:i,contentSize:a,footerSize:o}}setFooterVisibility(e){this.footerVisible=e}setHeaderVisibility(e){this.headerVisible=e}}class dst extends KO{constructor(){super(...arguments),this._parts=new Set}get parts(){return Array.from(this._parts)}registerPart(e){return this._parts.add(e),Ie(()=>this.unregisterPart(e))}unregisterPart(e){this._parts.delete(e)}getPart(e){return this.getPartByDocument(e.ownerDocument)}getPartByDocument(e){if(this._parts.size>1){for(const t of this._parts)if(t.element?.ownerDocument===e)return t}return this.mainPart}get activePart(){return this.getPartByDocument(qd())}}const jze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Yze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class c6{constructor(e,t){this.descriptorFn=e,this.stylesFn=t}getDescription(){return this.descriptorFn(null)}getColors(e){return this.stylesFn?.(e)}}class rz extends c6{constructor(e,t){super(t,void 0),this.number=e,this.number=e}getDescription(){return this.descriptorFn(this.number)}}class Qze extends c6{constructor(e,t,i){super(t,i),this.icon=e}}class Xze extends c6{constructor(e){super(e,void 0)}}class gw extends Xt{constructor(e){super(e.id,e.name,e.classNames?.join(" "),!0),this.item=e,this._onDidChangeCompositeBarActionItem=this._register(new M),this.onDidChangeCompositeBarActionItem=this._onDidChangeCompositeBarActionItem.event,this._onDidChangeActivity=this._register(new M),this.onDidChangeActivity=this._onDidChangeActivity.event,this._activities=[]}get compositeBarActionItem(){return this.item}set compositeBarActionItem(e){this._label=e.name,this.item=e,this._onDidChangeCompositeBarActionItem.fire(this)}get activities(){return this._activities}set activities(e){this._activities=e,this._onDidChangeActivity.fire(e)}activate(){this.checked||this._setChecked(!0)}deactivate(){this.checked&&this._setChecked(!1)}}let Qx=class extends QM{constructor(e,t,i,n,o,r,a){super(null,e,t),this.badgesEnabled=i,this.themeService=n,this.hoverService=o,this.configurationService=r,this.keybindingService=a,this.badgeDisposable=this._register(new Pt),this.options=t,this._register(this.themeService.onDidColorThemeChange(this.onThemeChange,this)),this._register(e.onDidChangeCompositeBarActionItem(()=>this.update())),this._register(T.filter(a.onDidUpdateKeybindings,()=>this.keybindingLabel!==this.computeKeybindingLabel())(()=>this.updateTitle())),this._register(e.onDidChangeActivity(()=>this.updateActivity()))}get compositeBarActionItem(){return this._action.compositeBarActionItem}updateStyles(){const e=this.themeService.getColorTheme(),t=this.options.colors(e);if(this.label){if(this.options.icon){const i=this._action.checked?t.activeForegroundColor:t.inactiveForegroundColor;this.compositeBarActionItem.iconUrl?(this.label.style.backgroundColor=i?i.toString():"",this.label.style.color=""):(this.label.style.color=i?i.toString():"",this.label.style.backgroundColor="")}else{const i=this._action.checked?t.activeForegroundColor:t.inactiveForegroundColor,n=this._action.checked?t.activeBorderBottomColor:null;this.label.style.color=i?i.toString():"",this.label.style.borderBottomColor=n?n.toString():""}this.container.style.setProperty("--insert-border-color",t.dragAndDropBorder?t.dragAndDropBorder.toString():"")}if(this.badgeContent){const i=this.getActivities()[0]?.badge.getColors(e),n=i?.badgeForeground??t.badgeForeground??e.getColor(zz),o=i?.badgeBackground??t.badgeBackground??e.getColor(eN),r=i?.badgeBorder??e.getColor(tt);this.badgeContent.style.color=n?n.toString():"",this.badgeContent.style.backgroundColor=o?o.toString():"",this.badgeContent.style.borderStyle=r&&!this.options.compact?"solid":"",this.badgeContent.style.borderWidth=r?"1px":"",this.badgeContent.style.borderColor=r?r.toString():""}}render(e){super.render(e),this.container=e,this.options.icon&&this.container.classList.add("icon"),this.options.hasPopup?(this.container.setAttribute("role","button"),this.container.setAttribute("aria-haspopup","true")):this.container.setAttribute("role","tab"),this._register(re(this.container,pe.MOUSE_DOWN,()=>{this.container.classList.add("clicked")})),this._register(re(this.container,pe.MOUSE_UP,()=>{this.mouseUpTimeout&&clearTimeout(this.mouseUpTimeout),this.mouseUpTimeout=setTimeout(()=>{this.container.classList.remove("clicked")},800)})),this._register(this.hoverService.setupDelayedHover(this.container,()=>({content:this.computeTitle(),position:{hoverPosition:this.options.hoverOptions.position()},persistence:{hideOnKeyDown:!0},appearance:{showPointer:!0,compact:!0}}),{groupId:"composite-bar-actions"})),this.label=ee(e,j("a")),this.badge=ee(e,j(".badge")),this.badgeContent=ee(this.badge,j(".badge-content")),ee(e,j(".active-item-indicator")),Qs(this.badge),this.update(),this.updateStyles(),this.updateTitle()}onThemeChange(e){this.updateStyles()}update(){this.updateLabel(),this.updateActivity(),this.updateTitle(),this.updateStyles()}getActivities(){return this._action instanceof gw?this._action.activities:[]}updateActivity(){if(!this.badge||!this.badgeContent||!(this._action instanceof gw))return;const{badges:e,type:t}=this.getVisibleBadges(this.getActivities());this.badgeDisposable.value=new U,Xi(this.badgeContent),Qs(this.badge);const i=this.badgesEnabled(this.compositeBarActionItem.id);if(e.length>0&&i){const n=[];if(this.options.compact&&n.push("compact"),t==="progress")Qo(this.badge),n.push("progress-badge");else if(t==="number"){const o=e.reduce((r,a)=>r+(a instanceof rz?a.number:0),0);if(o>0){let r=o.toString();if(o>999){const a=o/1e3,c=Math.floor(a);r=a>c?`${c}K+`:`${a}K`}this.options.compact&&r.length>=3&&n.push("compact-content"),this.badgeContent.textContent=r,Qo(this.badge)}}else if(t==="icon"){n.push("icon-badge");const o=["icon-overlay",...ke.asClassNameArray(e[0].icon)];this.badgeContent.classList.add(...o),this.badgeDisposable.value.add(Ie(()=>this.badgeContent?.classList.remove(...o))),Qo(this.badge)}n.length&&(this.badge.classList.add(...n),this.badgeDisposable.value.add(Ie(()=>this.badge.classList.remove(...n))))}this.updateTitle(),this.updateStyles()}getVisibleBadges(e){const t=e.filter(o=>o.badge instanceof Xze).map(o=>o.badge);if(t.length>0)return{badges:t,type:"progress"};const i=e.filter(o=>o.badge instanceof Qze).map(o=>o.badge);if(i.length>0)return{badges:i,type:"icon"};const n=e.filter(o=>o.badge instanceof rz).map(o=>o.badge);return n.length>0?{badges:n,type:"number"}:{badges:[],type:void 0}}updateLabel(){this.label.className="action-label",this.compositeBarActionItem.classNames&&this.label.classList.add(...this.compositeBarActionItem.classNames),this.options.icon||(this.label.textContent=this.action.label)}updateTitle(){const e=this.computeTitle();[this.label,this.badge,this.container].forEach(t=>{t&&(t.setAttribute("aria-label",e),t.setAttribute("title",""),t.removeAttribute("title"))})}computeTitle(){this.keybindingLabel=this.computeKeybindingLabel();let e=this.keybindingLabel?h(2866,"{0} ({1})",this.compositeBarActionItem.name,this.keybindingLabel):this.compositeBarActionItem.name;const t=this.getVisibleBadges(this.action.activities).badges;for(const i of t)i.getDescription()&&(e=`${e} - ${i.getDescription()}`);return e}computeKeybindingLabel(){return(this.compositeBarActionItem.keybindingId?this.keybindingService.lookupKeybinding(this.compositeBarActionItem.keybindingId):null)?.getLabel()}dispose(){super.dispose(),this.mouseUpTimeout&&clearTimeout(this.mouseUpTimeout),this.badge.remove()}};Qx=f([p(3,pt),p(4,Ti),p(5,ne),p(6,He)],Qx);class Die extends gw{constructor(e){super({id:"additionalComposites.action",name:h(2867,"Additional Views"),classNames:ke.asClassNameArray(K.more)}),this.showMenu=e}async run(){this.showMenu()}}let az=class extends Qx{constructor(e,t,i,n,o,r,a,c,d,l,u,g){super(e,{icon:!0,colors:r,hasPopup:!0,hoverOptions:a},()=>!0,d,l,u,g),this.getOverflowingComposites=t,this.getActiveCompositeId=i,this.getBadge=n,this.getCompositeOpenAction=o,this.contextMenuService=c}showMenu(){this.contextMenuService.showContextMenu({getAnchor:()=>this.container,getActions:()=>this.getActions(),getCheckedActionsRepresentation:()=>"radio"})}getActions(){return this.getOverflowingComposites().map(e=>{const t=this.getCompositeOpenAction(e.id);t.checked=this.getActiveCompositeId()===t.id;const i=this.getBadge(e.id);let n;return i instanceof rz&&(n=i.number),n?t.label=h(2868,"{0} ({1})",e.name,n):t.label=e.name||"",t})}};az=f([p(7,bi),p(8,pt),p(9,Ti),p(10,ne),p(11,He)],az);let cz=class extends Qx{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_){super(t,e,c.areBadgesEnabled.bind(c),g,m,v,l),this.toggleCompositePinnedAction=i,this.toggleCompositeBadgeAction=n,this.compositeContextMenuActionsProvider=o,this.contextMenuActionsProvider=r,this.dndHandler=a,this.compositeBar=c,this.contextMenuService=d,this.commandService=_}render(e){super.render(e),this.updateChecked(),this.updateEnabled(),this._register(re(this.container,pe.CONTEXT_MENU,i=>{Vi.stop(i,!0),this.showContextMenu(e)}));let t;this._register(Xd.INSTANCE.registerDraggable(this.container,()=>({type:"composite",id:this.compositeBarActionItem.id}),{onDragOver:i=>{const n=i.dragAndDropData.getData().id!==this.compositeBarActionItem.id&&this.dndHandler.onDragOver(i.dragAndDropData,this.compositeBarActionItem.id,i.eventData);GP(i.eventData.dataTransfer,"move",n),t=this.updateFromDragging(e,n,i.eventData)},onDragLeave:i=>{t=this.updateFromDragging(e,!1,i.eventData)},onDragEnd:i=>{t=this.updateFromDragging(e,!1,i.eventData)},onDrop:i=>{Vi.stop(i.eventData,!0),this.dndHandler.drop(i.dragAndDropData,this.compositeBarActionItem.id,i.eventData,t),t=this.updateFromDragging(e,!1,i.eventData)},onDragStart:i=>{i.dragAndDropData.getData().id===this.compositeBarActionItem.id&&(i.eventData.dataTransfer&&(i.eventData.dataTransfer.effectAllowed="move"),this.blur())}})),[this.badge,this.label].forEach(i=>this._register(new jne(i,()=>{this.action.checked||this.action.run()}))),this.updateStyles()}updateFromDragging(e,t,i){const n=e.getBoundingClientRect(),o=i.clientX,r=i.clientY,a=n.bottom-n.top,c=n.right-n.left,d=r<=n.top+a*.4,l=r>n.bottom-a*.4,u=r<=n.top+a*.5,g=o<=n.left+c*.4,m=o>n.right-c*.4,v=o<=n.left+c*.5,_=e.classList,w={vertical:_.contains("top")?"top":_.contains("bottom")?"bottom":void 0,horizontal:_.contains("left")?"left":_.contains("right")?"right":void 0},C=d||u&&!w.vertical||!l&&w.vertical==="top",k=l||!u&&!w.vertical||!d&&w.vertical==="bottom",D=g||v&&!w.horizontal||!m&&w.horizontal==="left",A=m||!v&&!w.horizontal||!g&&w.horizontal==="right";if(e.classList.toggle("top",t&&C),e.classList.toggle("bottom",t&&k),e.classList.toggle("left",t&&D),e.classList.toggle("right",t&&A),!!t)return{verticallyBefore:C,horizontallyBefore:D}}showContextMenu(e){const t=[];this.compositeBarActionItem.keybindingId&&t.push(Awe(this.commandService,this.keybindingService,this.compositeBarActionItem.keybindingId)),t.push(this.toggleCompositePinnedAction,this.toggleCompositeBadgeAction);const i=this.compositeContextMenuActionsProvider(this.compositeBarActionItem.id);i.length&&t.push(...i),this.compositeBar.isPinned(this.compositeBarActionItem.id)?(this.toggleCompositePinnedAction.label=h(2869,"Hide '{0}'",this.compositeBarActionItem.name),this.toggleCompositePinnedAction.checked=!1,this.toggleCompositePinnedAction.enabled=this.compositeBar.getPinnedCompositeIds().length>1):(this.toggleCompositePinnedAction.label=h(2870,"Keep '{0}'",this.compositeBarActionItem.name),this.toggleCompositePinnedAction.enabled=!0),this.compositeBar.areBadgesEnabled(this.compositeBarActionItem.id)?this.toggleCompositeBadgeAction.label=h(2871,"Hide Badge"):this.toggleCompositeBadgeAction.label=h(2872,"Show Badge");const r=this.contextMenuActionsProvider();r.length&&(t.push(new os),t.push(...r));const a=Bs(e),c={x:Math.floor(a.left+a.width/2),y:a.top+a.height};this.contextMenuService.showContextMenu({getAnchor:()=>c,getActions:()=>t,getActionsContext:()=>this.compositeBarActionItem.id})}updateChecked(){this.action.checked?(this.container.classList.add("checked"),this.container.setAttribute("aria-label",this.getTooltip()??this.container.title),this.container.setAttribute("aria-expanded","true"),this.container.setAttribute("aria-selected","true")):(this.container.classList.remove("checked"),this.container.setAttribute("aria-label",this.getTooltip()??this.container.title),this.container.setAttribute("aria-expanded","false"),this.container.setAttribute("aria-selected","false")),this.updateStyles()}updateEnabled(){this.element&&(this.action.enabled?this.element.classList.remove("disabled"):this.element.classList.add("disabled"))}dispose(){super.dispose(),this.label.remove()}};cz=f([p(8,bi),p(9,He),p(10,Z),p(11,pt),p(12,Ti),p(13,ne),p(14,Ge)],cz);class Ype extends Xt{constructor(e,t){super("show.toggleCompositePinned",e?e.name:h(2873,"Toggle View Pinned")),this.activity=e,this.compositeBar=t,this.checked=!!this.activity&&this.compositeBar.isPinned(this.activity.id)}async run(e){const t=this.activity?this.activity.id:e;this.compositeBar.isPinned(t)?this.compositeBar.unpin(t):this.compositeBar.pin(t)}}class Qpe extends Xt{constructor(e,t){super("show.toggleCompositeBadge",e?e.name:h(2874,"Toggle View Badge")),this.compositeBarActionItem=e,this.compositeBar=t,this.checked=!1}async run(e){const t=this.compositeBarActionItem?this.compositeBarActionItem.id:e;this.compositeBar.toggleBadgeEnablement(t)}}class _S extends X{constructor(e,t,i){super(e),this.location=t,this.offset=i}async run(e){const t=e.get(da),i=t.getActivePaneComposite(this.location);if(!i)return;let n;const o=t.getVisiblePaneCompositeIds(this.location);for(let r=0;r<o.length;r++)if(o[r]===i.getId()){n=o[(r+o.length+this.offset)%o.length];break}typeof n<"u"&&await t.openPaneComposite(n,this.location,!0)}}const Zze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(Zze);const Jze=Pe("panel-maximize",K.chevronUp,h(3412,"Icon to maximize a panel.")),eqe=Pe("panel-restore",K.chevronDown,h(3413,"Icon to restore a panel.")),EM=Pe("panel-close",K.close,h(3414,"Icon to close a panel.")),tqe=Pe("panel-layout-icon",K.layoutPanel,h(3415,"Icon to toggle the panel off when it is on.")),iqe=Pe("panel-layout-icon-off",K.layoutPanelOff,h(3416,"Icon to toggle the panel on when it is off."));class pw extends X{static{this.ID="workbench.action.togglePanel"}static{this.LABEL=I(3417,"Toggle Panel Visibility")}constructor(){super({id:pw.ID,title:pw.LABEL,toggled:{condition:EN,title:h(3418,"Hide Panel"),icon:EM,mnemonicTitle:h(3419,"&&Panel")},icon:EM,f1:!0,category:te.View,metadata:{description:h(3420,"Open/Show and Close/Hide Panel")},keybinding:{primary:E.CtrlCmd|S.KeyJ,weight:W.WorkbenchContrib},menu:[{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:5},{id:N.LayoutControlMenuSubmenu,group:"0_workbench_layout",order:4},{id:N.PanelTitle,group:"navigation",order:2}]})}async run(e){const t=e.get(yi);t.setPartHidden(t.isVisible(ot.PANEL_PART),ot.PANEL_PART)}}Y(pw);Y(class extends X{constructor(){super({id:"workbench.action.closePanel",title:I(3418,"Hide Panel"),category:te.View,precondition:EN,f1:!0})}run(s){s.get(yi).setPartHidden(!0,ot.PANEL_PART)}});Y(class extends X{static{this.ID="workbench.action.focusPanel"}static{this.LABEL=h(3421,"Focus into Panel")}constructor(){super({id:"workbench.action.focusPanel",title:I(3421,"Focus into Panel"),category:te.View,f1:!0})}async run(s){const e=s.get(yi),t=s.get(da);e.isVisible(ot.PANEL_PART)||e.setPartHidden(!1,ot.PANEL_PART),t.getActivePaneComposite(We.Panel)?.focus()}});const vk={LEFT:"workbench.action.positionPanelLeft",RIGHT:"workbench.action.positionPanelRight",BOTTOM:"workbench.action.positionPanelBottom",TOP:"workbench.action.positionPanelTop"},_k={LEFT:"workbench.action.alignPanelLeft",RIGHT:"workbench.action.alignPanelRight",CENTER:"workbench.action.alignPanelCenter",JUSTIFY:"workbench.action.alignPanelJustify"};function Xpe(s,e,t,i,n){return{id:s,title:e,shortLabel:t,value:i,when:n}}function bk(s,e,t,i){return Xpe(s,e,t,i,Z_.notEqualsTo(fA(i)))}function yk(s,e,t,i){return Xpe(s,e,t,i,rp.notEqualsTo(i))}const nqe=[bk(vk.TOP,I(3422,"Move Panel To Top"),h(3423,"Top"),oh.TOP),bk(vk.LEFT,I(3424,"Move Panel Left"),h(3425,"Left"),oh.LEFT),bk(vk.RIGHT,I(3426,"Move Panel Right"),h(3427,"Right"),oh.RIGHT),bk(vk.BOTTOM,I(3428,"Move Panel To Bottom"),h(3429,"Bottom"),oh.BOTTOM)],sqe=[yk(_k.LEFT,I(3430,"Set Panel Alignment to Left"),h(3431,"Left"),"left"),yk(_k.RIGHT,I(3432,"Set Panel Alignment to Right"),h(3433,"Right"),"right"),yk(_k.CENTER,I(3434,"Set Panel Alignment to Center"),h(3435,"Center"),"center"),yk(_k.JUSTIFY,I(3436,"Set Panel Alignment to Justify"),h(3437,"Justify"),"justify")];ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.PanelPositionMenu,title:h(3438,"Panel Position"),group:"3_workbench_layout_move",order:4});nqe.forEach((s,e)=>{const{id:t,title:i,shortLabel:n,value:o,when:r}=s;Y(class extends X{constructor(){super({id:t,title:i,category:te.View,f1:!0})}run(a){a.get(yi).setPanelPosition(o===void 0?oh.BOTTOM:o)}}),ge.appendMenuItem(N.PanelPositionMenu,{command:{id:t,title:n,toggled:r.negate()},order:5+e})});ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.PanelAlignmentMenu,title:h(3439,"Align Panel"),group:"3_workbench_layout_move",order:5});sqe.forEach(s=>{const{id:e,title:t,shortLabel:i,value:n,when:o}=s;Y(class extends X{constructor(){super({id:e,title:t,category:te.View,toggled:o.negate(),f1:!0})}run(r){r.get(yi).setPanelAlignment(n===void 0?"center":n)}}),ge.appendMenuItem(N.PanelAlignmentMenu,{command:{id:e,title:i,toggled:o.negate()},order:5})});Y(class extends _S{constructor(){super({id:"workbench.action.previousPanelView",title:I(3440,"Previous Panel View"),category:te.View,f1:!0},We.Panel,-1)}});Y(class extends _S{constructor(){super({id:"workbench.action.nextPanelView",title:I(3441,"Next Panel View"),category:te.View,f1:!0},We.Panel,1)}});Y(class extends X{constructor(){super({id:"workbench.action.toggleMaximizedPanel",title:I(3442,"Toggle Maximized Panel"),tooltip:h(3443,"Maximize Panel Size"),category:te.View,f1:!0,icon:Jze,precondition:x.or(rp.isEqualTo("center"),x.and(Z_.notEqualsTo("bottom"),Z_.notEqualsTo("top"))),toggled:{condition:SCe,icon:eqe,tooltip:h(3444,"Restore Panel Size")},menu:[{id:N.PanelTitle,group:"navigation",order:1,when:x.or(rp.isEqualTo("center"),x.and(Z_.notEqualsTo("bottom"),Z_.notEqualsTo("top")))}]})}run(s){const e=s.get(yi),t=s.get(Dt);if(e.getPanelAlignment()!=="center"&&Doe(e.getPanelPosition())){t.warn(h(3445,"Maximizing the panel is only supported when it is center aligned."));return}e.isVisible(ot.PANEL_PART)?e.toggleMaximizedPanel():(e.setPartHidden(!1,ot.PANEL_PART),e.isPanelMaximized()||e.toggleMaximizedPanel())}});ge.appendMenuItems([{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:pw.ID,title:h(3446,"Toggle Panel"),icon:iqe,toggled:{condition:EN,icon:tqe}},when:x.and(nv.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both"))),order:1}}]);class V0 extends X{constructor(e,t,i){super(i),this.source=e,this.destination=t}run(e,...t){const i=e.get($s),n=e.get(yi),o=e.get(io),r=i.getViewContainersByLocation(this.source),a=i.getViewContainersByLocation(this.destination);if(r.length){const c=o.getVisibleViewContainer(this.source);r.forEach(d=>i.moveViewContainerToLocation(d,this.destination,void 0,this.desc.id)),n.setPartHidden(!1,this.destination===We.Panel?ot.PANEL_PART:ot.AUXILIARYBAR_PART),c&&a.length===0&&o.openViewContainer(c.id,!0)}}}class d6 extends V0{static{this.ID="workbench.action.movePanelToSidePanel"}constructor(){super(We.Panel,We.AuxiliaryBar,{id:d6.ID,title:I(3447,"Move Panel Views To Secondary Side Bar"),category:te.View,f1:!1})}}class l6 extends V0{static{this.ID="workbench.action.movePanelToSecondarySideBar"}constructor(){super(We.Panel,We.AuxiliaryBar,{id:l6.ID,title:I(3447,"Move Panel Views To Secondary Side Bar"),category:te.View,f1:!0})}}Y(d6);Y(l6);class h6 extends V0{static{this.ID="workbench.action.moveSidePanelToPanel"}constructor(){super(We.AuxiliaryBar,We.Panel,{id:h6.ID,title:I(3448,"Move Secondary Side Bar Views To Panel"),category:te.View,f1:!1})}}class u6 extends V0{static{this.ID="workbench.action.moveSecondarySideBarToPanel"}constructor(){super(We.AuxiliaryBar,We.Panel,{id:u6.ID,title:I(3448,"Move Secondary Side Bar Views To Panel"),category:te.View,f1:!0})}}Y(h6);Y(u6);const oqe=Pe("auxiliarybar-right-layout-icon",K.layoutSidebarRight,h(2844,"Icon to toggle the auxiliary bar off in its right position.")),rqe=Pe("auxiliarybar-right-off-layout-icon",K.layoutSidebarRightOff,h(2845,"Icon to toggle the auxiliary bar on in its right position.")),aqe=Pe("auxiliarybar-left-layout-icon",K.layoutSidebarLeft,h(2846,"Icon to toggle the auxiliary bar in its left position.")),cqe=Pe("auxiliarybar-left-off-layout-icon",K.layoutSidebarLeftOff,h(2847,"Icon to toggle the auxiliary bar on in its left position."));class Ap extends X{static{this.ID="workbench.action.toggleAuxiliaryBar"}static{this.LABEL=I(2848,"Toggle Secondary Side Bar Visibility")}constructor(){super({id:Ap.ID,title:Ap.LABEL,toggled:{condition:pp,title:h(2849,"Hide Secondary Side Bar"),icon:EM,mnemonicTitle:h(2850,"Secondary Si&&de Bar")},icon:EM,category:te.View,metadata:{description:h(2851,"Open/Show and Close/Hide Secondary Side Bar")},f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|E.Alt|S.KeyB},menu:[{id:N.LayoutControlMenuSubmenu,group:"0_workbench_layout",order:1},{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:2},{id:N.AuxiliaryBarTitle,group:"navigation",order:2,when:x.equals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.DEFAULT)}]})}async run(e){const t=e.get(yi);t.setPartHidden(t.isVisible(ot.AUXILIARYBAR_PART),ot.AUXILIARYBAR_PART)}}Y(Ap);Y(class extends X{constructor(){super({id:"workbench.action.closeAuxiliaryBar",title:I(2849,"Hide Secondary Side Bar"),category:te.View,precondition:pp,f1:!0})}run(s){s.get(yi).setPartHidden(!0,ot.AUXILIARYBAR_PART)}});Y(class dz extends X{static{this.ID="workbench.action.focusAuxiliaryBar"}static{this.LABEL=I(2852,"Focus into Secondary Side Bar")}constructor(){super({id:dz.ID,title:dz.LABEL,category:te.View,f1:!0})}async run(e){const t=e.get(da),i=e.get(yi);i.isVisible(ot.AUXILIARYBAR_PART)||i.setPartHidden(!1,ot.AUXILIARYBAR_PART),t.getActivePaneComposite(We.AuxiliaryBar)?.focus()}});ge.appendMenuItems([{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:Ap.ID,title:h(2853,"Toggle Secondary Side Bar"),toggled:{condition:pp,icon:aqe},icon:cqe},when:x.and(nv.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","right")),order:0}},{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:Ap.ID,title:h(2853,"Toggle Secondary Side Bar"),toggled:{condition:pp,icon:oqe},icon:rqe},when:x.and(nv.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","left")),order:2}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:Ap.ID,title:I(2854,"Hide Secondary Side Bar")},when:x.and(pp,x.equals("viewContainerLocation",Zc(We.AuxiliaryBar))),order:2}}]);Y(class extends _S{constructor(){super({id:"workbench.action.previousAuxiliaryBarView",title:I(2855,"Previous Secondary Side Bar View"),category:te.View,f1:!0},We.AuxiliaryBar,-1)}});Y(class extends _S{constructor(){super({id:"workbench.action.nextAuxiliaryBarView",title:I(2856,"Next Secondary Side Bar View"),category:te.View,f1:!0},We.AuxiliaryBar,1)}});const dqe=Pe("menuBar",K.layoutMenubar,h(2620,"Represents the menu bar")),lqe=Pe("activity-bar-left",K.layoutActivitybarLeft,h(2621,"Represents the activity bar in the left position")),hqe=Pe("activity-bar-right",K.layoutActivitybarRight,h(2622,"Represents the activity bar in the right position")),xM=Pe("panel-left",K.layoutSidebarLeft,h(2623,"Represents a side bar in the left position")),uqe=Pe("panel-left-off",K.layoutSidebarLeftOff,h(2624,"Represents a side bar in the left position toggled off")),IM=Pe("panel-right",K.layoutSidebarRight,h(2625,"Represents side bar in the right position")),gqe=Pe("panel-right-off",K.layoutSidebarRightOff,h(2626,"Represents side bar in the right position toggled off")),pqe=Pe("panel-bottom",K.layoutPanel,h(2627,"Represents the bottom panel")),fqe=Pe("statusBar",K.layoutStatusbar,h(2628,"Represents the status bar")),mqe=Pe("panel-align-left",K.layoutPanelLeft,h(2629,"Represents the bottom panel alignment set to the left")),vqe=Pe("panel-align-right",K.layoutPanelRight,h(2630,"Represents the bottom panel alignment set to the right")),_qe=Pe("panel-align-center",K.layoutPanelCenter,h(2631,"Represents the bottom panel alignment set to the center")),bqe=Pe("panel-align-justify",K.layoutPanelJustify,h(2632,"Represents the bottom panel alignment set to justified")),yqe=Pe("quickInputAlignmentTop",K.arrowUp,h(2633,"Represents quick input alignment set to the top")),wqe=Pe("quickInputAlignmentCenter",K.circle,h(2634,"Represents quick input alignment set to the center")),Sqe=Pe("fullscreen",K.screenFull,h(2635,"Represents full screen")),Cqe=Pe("centerLayoutIcon",K.layoutCentered,h(2636,"Represents centered layout mode")),Eqe=Pe("zenMode",K.target,h(2637,"Represents zen mode")),xqe="workbench.action.toggleActivityBarVisibility";Y(class extends X{constructor(){super({id:"workbench.action.toggleCenteredLayout",title:{...I(2638,"Toggle Centered Layout"),mnemonicTitle:h(2639,"&&Centered Layout")},precondition:_l.toNegated(),category:te.View,f1:!0,toggled:koe,menu:[{id:N.MenubarAppearanceMenu,group:"1_toggle_view",order:3}]})}run(s){const e=s.get(yi),t=s.get(xe);e.centerMainEditorLayout(!e.isMainEditorLayoutCentered()),t.activeGroup.focus()}});const Zpe="workbench.sideBar.location";class Jpe extends X{constructor(e,t,i){super({id:e,title:t,f1:!1}),this.position=i}async run(e){const t=e.get(yi),i=e.get(ne);if(t.getSideBarPosition()!==this.position)return i.updateValue(Zpe,fA(this.position))}}class H0 extends Jpe{static{this.ID="workbench.action.moveSideBarRight"}constructor(){super(H0.ID,I(2640,"Move Primary Side Bar Right"),oh.RIGHT)}}class U0 extends Jpe{static{this.ID="workbench.action.moveSideBarLeft"}constructor(){super(U0.ID,I(2641,"Move Primary Side Bar Left"),oh.LEFT)}}Y(H0);Y(U0);class ed extends X{static{this.ID="workbench.action.toggleSidebarPosition"}static{this.LABEL=h(2642,"Toggle Primary Side Bar Position")}static getLabel(e){return e.getSideBarPosition()===oh.LEFT?h(2640,"Move Primary Side Bar Right"):h(2641,"Move Primary Side Bar Left")}constructor(){super({id:ed.ID,title:I(2642,"Toggle Primary Side Bar Position"),category:te.View,f1:!0})}run(e){const t=e.get(yi),i=e.get(ne),o=t.getSideBarPosition()===oh.LEFT?"right":"left";return i.updateValue(Zpe,o)}}Y(ed);const efe=Pe("configure-layout-icon",K.layout,h(2643,"Icon represents workbench layout configuration."));ge.appendMenuItem(N.LayoutControlMenu,{submenu:N.LayoutControlMenuSubmenu,title:h(2644,"Configure Layout"),icon:efe,group:"1_workbench_layout",when:x.and(nv.negate(),x.equals("config.workbench.layoutControl.type","menu"))});ge.appendMenuItems([{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:ed.ID,title:h(2645,"Move Primary Side Bar Right")},when:x.and(x.notEquals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",Zc(We.Sidebar))),order:1}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:ed.ID,title:h(2646,"Move Primary Side Bar Left")},when:x.and(x.equals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",Zc(We.Sidebar))),order:1}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:ed.ID,title:h(2647,"Move Secondary Side Bar Left")},when:x.and(x.notEquals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",Zc(We.AuxiliaryBar))),order:1}},{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:ed.ID,title:h(2648,"Move Secondary Side Bar Right")},when:x.and(x.equals("config.workbench.sideBar.location","right"),x.equals("viewContainerLocation",Zc(We.AuxiliaryBar))),order:1}}]);ge.appendMenuItem(N.MenubarAppearanceMenu,{group:"3_workbench_layout_move",command:{id:ed.ID,title:h(2649,"&&Move Primary Side Bar Right")},when:x.notEquals("config.workbench.sideBar.location","right"),order:2});ge.appendMenuItem(N.MenubarAppearanceMenu,{group:"3_workbench_layout_move",command:{id:ed.ID,title:h(2650,"&&Move Primary Side Bar Left")},when:x.equals("config.workbench.sideBar.location","right"),order:2});Y(class extends X{constructor(){super({id:"workbench.action.toggleEditorVisibility",title:{...I(2651,"Toggle Editor Area Visibility"),mnemonicTitle:h(2652,"Show &&Editor Area")},category:te.View,f1:!0,toggled:CCe,precondition:x.and(_l.toNegated(),x.or(rp.isEqualTo("center"),Z_.notEqualsTo("bottom")))})}run(s){s.get(yi).toggleMaximizedPanel()}});ge.appendMenuItem(N.MenubarViewMenu,{group:"2_appearance",title:h(2653,"&&Appearance"),submenu:N.MenubarAppearanceMenu,order:1});class yh extends X{static{this.ID="workbench.action.toggleSidebarVisibility"}static{this.LABEL=h(2654,"Hide Primary Side Bar")}constructor(){super({id:yh.ID,title:I(2655,"Toggle Primary Side Bar Visibility"),toggled:{condition:Tm,title:h(2656,"Primary Side Bar"),mnemonicTitle:h(2657,"&&Primary Side Bar")},metadata:{description:h(2658,"Open/Show and Close/Hide Sidebar")},category:te.View,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyB},menu:[{id:N.LayoutControlMenuSubmenu,group:"0_workbench_layout",order:0},{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:1}]})}run(e){const t=e.get(yi);t.setPartHidden(t.isVisible(ot.SIDEBAR_PART),ot.SIDEBAR_PART)}}Y(yh);ge.appendMenuItems([{id:N.ViewContainerTitleContext,item:{group:"3_workbench_layout_move",command:{id:yh.ID,title:h(2654,"Hide Primary Side Bar")},when:x.and(Tm,x.equals("viewContainerLocation",Zc(We.Sidebar))),order:2}},{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:yh.ID,title:h(2659,"Toggle Primary Side Bar"),icon:uqe,toggled:{condition:Tm,icon:xM}},when:x.and(nv.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","left")),order:0}},{id:N.LayoutControlMenu,item:{group:"2_pane_toggles",command:{id:yh.ID,title:h(2659,"Toggle Primary Side Bar"),icon:gqe,toggled:{condition:Tm,icon:IM}},when:x.and(nv.negate(),x.or(x.equals("config.workbench.layoutControl.type","toggles"),x.equals("config.workbench.layoutControl.type","both")),x.equals("config.workbench.sideBar.location","right")),order:2}}]);class Xx extends X{static{this.ID="workbench.action.toggleStatusbarVisibility"}static{this.statusbarVisibleKey="workbench.statusBar.visible"}constructor(){super({id:Xx.ID,title:{...I(2660,"Toggle Status Bar Visibility"),mnemonicTitle:h(2661,"S&&tatus Bar")},category:te.View,f1:!0,toggled:x.equals("config.workbench.statusBar.visible",!0),menu:[{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:3}]})}run(e){const t=e.get(yi),i=e.get(ne),o=!t.isVisible(ot.STATUSBAR_PART,zi);return i.updateValue(Xx.statusbarVisibleKey,o)}}Y(Xx);class bS extends X{constructor(e,t,i,n,o,r){super({id:n,title:i,category:te.View,precondition:o,metadata:r?{description:r}:void 0,f1:!0}),this.settingName=e,this.value=t}run(e){return e.get(ne).updateValue(this.settingName,this.value)}}class g6 extends bS{static{this.ID="workbench.action.hideEditorTabs"}constructor(){const e=x.and(x.equals(`config.${oi.EDITOR_TABS_MODE}`,_o.NONE).negate(),hd.negate()),t=I(2662,"Hide Editor Tabs");super(oi.EDITOR_TABS_MODE,_o.NONE,t,g6.ID,e,I(2663,"Hide Tab Bar"))}}class p6 extends bS{static{this.ID="workbench.action.zenHideEditorTabs"}constructor(){const e=x.and(x.equals(`config.${vy.SHOW_TABS}`,_o.NONE).negate(),hd),t=I(2664,"Hide Editor Tabs in Zen Mode");super(vy.SHOW_TABS,_o.NONE,t,p6.ID,e,I(2665,"Hide Tab Bar in Zen Mode"))}}class f6 extends bS{static{this.ID="workbench.action.showMultipleEditorTabs"}constructor(){const e=x.and(x.equals(`config.${oi.EDITOR_TABS_MODE}`,_o.MULTIPLE).negate(),hd.negate()),t=I(2666,"Show Multiple Editor Tabs");super(oi.EDITOR_TABS_MODE,_o.MULTIPLE,t,f6.ID,e,I(2667,"Show Tab Bar with multiple tabs"))}}class m6 extends bS{static{this.ID="workbench.action.zenShowMultipleEditorTabs"}constructor(){const e=x.and(x.equals(`config.${vy.SHOW_TABS}`,_o.MULTIPLE).negate(),hd),t=I(2668,"Show Multiple Editor Tabs in Zen Mode");super(vy.SHOW_TABS,_o.MULTIPLE,t,m6.ID,e,I(2669,"Show Tab Bar in Zen Mode"))}}class v6 extends bS{static{this.ID="workbench.action.showEditorTab"}constructor(){const e=x.and(x.equals(`config.${oi.EDITOR_TABS_MODE}`,_o.SINGLE).negate(),hd.negate()),t=I(2670,"Show Single Editor Tab");super(oi.EDITOR_TABS_MODE,_o.SINGLE,t,v6.ID,e,I(2671,"Show Tab Bar with one Tab"))}}class _6 extends bS{static{this.ID="workbench.action.zenShowEditorTab"}constructor(){const e=x.and(x.equals(`config.${vy.SHOW_TABS}`,_o.SINGLE).negate(),hd),t=I(2672,"Show Single Editor Tab in Zen Mode");super(vy.SHOW_TABS,_o.SINGLE,t,_6.ID,e,I(2673,"Show Tab Bar in Zen Mode with one Tab"))}}Y(g6);Y(p6);Y(f6);Y(m6);Y(v6);Y(_6);ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.EditorTabsBarShowTabsSubmenu,title:h(2674,"Tab Bar"),group:"3_workbench_layout_move",order:10,when:hd.negate()});ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.EditorTabsBarShowTabsZenModeSubmenu,title:h(2674,"Tab Bar"),group:"3_workbench_layout_move",order:10,when:hd});class b6 extends X{static{this.ID="workbench.action.editorActionsTitleBar"}constructor(){super({id:b6.ID,title:I(2675,"Move Editor Actions to Title Bar"),category:te.View,precondition:x.equals(`config.${oi.EDITOR_ACTIONS_LOCATION}`,nl.TITLEBAR).negate(),metadata:{description:I(2676,"Move Editor Actions from the tab bar to the title bar")},f1:!0})}run(e){return e.get(ne).updateValue(oi.EDITOR_ACTIONS_LOCATION,nl.TITLEBAR)}}Y(b6);class y6 extends X{static{this.ID="workbench.action.editorActionsDefault"}constructor(){super({id:y6.ID,title:I(2677,"Move Editor Actions to Tab Bar"),category:te.View,precondition:x.and(x.equals(`config.${oi.EDITOR_ACTIONS_LOCATION}`,nl.DEFAULT).negate(),x.equals(`config.${oi.EDITOR_TABS_MODE}`,_o.NONE).negate()),metadata:{description:I(2678,"Move Editor Actions from the title bar to the tab bar")},f1:!0})}run(e){return e.get(ne).updateValue(oi.EDITOR_ACTIONS_LOCATION,nl.DEFAULT)}}Y(y6);class w6 extends X{static{this.ID="workbench.action.hideEditorActions"}constructor(){super({id:w6.ID,title:I(2679,"Hide Editor Actions"),category:te.View,precondition:x.equals(`config.${oi.EDITOR_ACTIONS_LOCATION}`,nl.HIDDEN).negate(),metadata:{description:I(2680,"Hide Editor Actions in the tab and title bar")},f1:!0})}run(e){return e.get(ne).updateValue(oi.EDITOR_ACTIONS_LOCATION,nl.HIDDEN)}}Y(w6);class S6 extends X{static{this.ID="workbench.action.showEditorActions"}constructor(){super({id:S6.ID,title:I(2681,"Show Editor Actions"),category:te.View,precondition:x.equals(`config.${oi.EDITOR_ACTIONS_LOCATION}`,nl.HIDDEN),metadata:{description:I(2682,"Make Editor Actions visible.")},f1:!0})}run(e){return e.get(ne).updateValue(oi.EDITOR_ACTIONS_LOCATION,nl.DEFAULT)}}Y(S6);ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.EditorActionsPositionSubmenu,title:h(2683,"Editor Actions Position"),group:"3_workbench_layout_move",order:11});class C6 extends X{static{this.ID="workbench.action.configureEditorTabs"}constructor(){super({id:C6.ID,title:I(2684,"Configure Tabs"),category:te.View})}run(e){e.get(Hv).openSettings({jsonEditor:!1,query:"workbench.editor tab"})}}Y(C6);class E6 extends X{static{this.ID="workbench.action.configureEditor"}constructor(){super({id:E6.ID,title:I(2685,"Configure Editors"),category:te.View})}run(e){e.get(Hv).openSettings({jsonEditor:!1,query:"workbench.editor"})}}Y(E6);Y(class extends X{constructor(){super({id:"workbench.action.toggleSeparatePinnedEditorTabs",title:I(2686,"Separate Pinned Editor Tabs"),category:te.View,precondition:x.equals(`config.${oi.EDITOR_TABS_MODE}`,_o.MULTIPLE),metadata:{description:I(2687,"Toggle whether pinned editor tabs are shown on a separate row above unpinned tabs.")},f1:!0})}run(s){const e=s.get(ne),i=!e.getValue("workbench.editor.pinnedTabsOnSeparateRow");return e.updateValue("workbench.editor.pinnedTabsOnSeparateRow",i)}});Y(class extends X{constructor(){super({id:"workbench.action.toggleZenMode",title:{...I(2688,"Toggle Zen Mode"),mnemonicTitle:h(2689,"Zen Mode")},precondition:_l.toNegated(),category:te.View,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:lt(E.CtrlCmd|S.KeyK,S.KeyZ)},toggled:hd,menu:[{id:N.MenubarAppearanceMenu,group:"1_toggle_view",order:2}]})}run(s){return s.get(yi).toggleZenMode()}});Me.registerCommandAndKeybindingRule({id:"workbench.action.exitZenMode",weight:W.EditorContrib-1e3,handler(s){const e=s.get(yi),t=s.get(fe);hd.getValue(t)&&e.toggleZenMode()},when:hd,primary:lt(S.Escape,S.Escape)});if(bn||fh||Kt){Y(class extends X{constructor(){super({id:"workbench.action.toggleMenuBar",title:{...I(2690,"Toggle Menu Bar"),mnemonicTitle:h(2691,"Menu &&Bar")},category:te.View,f1:!0,toggled:x.and(Ku.toNegated(),x.notEquals("config.window.menuBarVisibility","hidden"),x.notEquals("config.window.menuBarVisibility","toggle"),x.notEquals("config.window.menuBarVisibility","compact")),menu:[{id:N.MenubarAppearanceMenu,group:"2_workbench_layout",order:0}]})}run(e){return e.get(yi).toggleMenuBar()}});for(const s of[N.TitleBarContext,N.TitleBarTitleContext])ge.appendMenuItem(s,{command:{id:"workbench.action.toggleMenuBar",title:h(2692,"Menu Bar"),toggled:x.and(Ku.toNegated(),x.notEquals("config.window.menuBarVisibility","hidden"),x.notEquals("config.window.menuBarVisibility","toggle"),x.notEquals("config.window.menuBarVisibility","compact"))},when:x.and(_l.toNegated(),x.notEquals(lA.key,QT.NATIVE),Hp.negate()),group:"2_config",order:0})}Y(class extends X{constructor(){super({id:"workbench.action.resetViewLocations",title:I(2693,"Reset View Locations"),category:te.View,f1:!0})}run(s){return s.get($s).reset()}});Y(class extends X{constructor(){super({id:"workbench.action.moveView",title:I(2694,"Move View"),category:te.View,f1:!0})}async run(s){const e=s.get($s),t=s.get(Z),i=s.get(Wt),n=s.get(fe),o=s.get(da),r=ll.getValue(n);let a;r&&e.getViewDescriptorById(r)?.canMoveView&&(a=r);try{if(a=await this.getView(i,e,o,a),!a)return;const c=new tfe;t.invokeFunction(d=>c.run(d,a))}catch{}}getViewItems(s,e){const t=[];return e.getVisiblePaneCompositeIds(We.Sidebar).forEach(r=>{const a=s.getViewContainerById(r),c=s.getViewContainerModel(a);let d=!1;c.visibleViewDescriptors.forEach(l=>{l.canMoveView&&(d||(t.push({type:"separator",label:h(2695,"Side Bar / {0}",c.title)}),d=!0),t.push({id:l.id,label:l.name.value}))})}),e.getPinnedPaneCompositeIds(We.Panel).forEach(r=>{const a=s.getViewContainerById(r),c=s.getViewContainerModel(a);let d=!1;c.visibleViewDescriptors.forEach(l=>{l.canMoveView&&(d||(t.push({type:"separator",label:h(2696,"Panel / {0}",c.title)}),d=!0),t.push({id:l.id,label:l.name.value}))})}),e.getPinnedPaneCompositeIds(We.AuxiliaryBar).forEach(r=>{const a=s.getViewContainerById(r),c=s.getViewContainerModel(a);let d=!1;c.visibleViewDescriptors.forEach(l=>{l.canMoveView&&(d||(t.push({type:"separator",label:h(2697,"Secondary Side Bar / {0}",c.title)}),d=!0),t.push({id:l.id,label:l.name.value}))})}),t}async getView(s,e,t,i){const n=new U,o=n.add(s.createQuickPick({useSeparators:!0}));return o.placeholder=h(2698,"Select a View to Move"),o.items=this.getViewItems(e,t),o.selectedItems=o.items.filter(r=>r.id===i),new Promise((r,a)=>{n.add(o.onDidAccept(()=>{const c=o.selectedItems[0];c.id?r(c.id):a(),o.hide()})),n.add(o.onDidHide(()=>{n.dispose(),a()})),o.show()})}});class tfe extends X{constructor(){super({id:"workbench.action.moveFocusedView",title:I(2699,"Move Focused View"),category:te.View,precondition:ll.notEqualsTo(""),f1:!0})}run(e,t){const i=e.get($s),n=e.get(io),o=e.get(Wt),r=e.get(fe),a=e.get(ei),c=e.get(da),d=t||ll.getValue(r);if(d===void 0||d.trim()===""){a.error(h(2700,"There is no view currently focused."));return}const l=i.getViewDescriptorById(d);if(!l||!l.canMoveView){a.error(h(2701,"The currently focused view is not movable."));return}const u=new U,g=u.add(o.createQuickPick({useSeparators:!0}));g.placeholder=h(2702,"Select a Destination for the View"),g.title=h(2703,"View: Move {0}",l.name.value);const m=[],v=i.getViewContainerByViewId(d),_=i.getViewLocationById(d),w=i.getViewContainerModel(v).allViewDescriptors.length===1;w&&_===We.Panel||m.push({id:"_.panel.newcontainer",label:h(2704,"New Panel Entry")}),w&&_===We.Sidebar||m.push({id:"_.sidebar.newcontainer",label:h(2705,"New Side Bar Entry")}),w&&_===We.AuxiliaryBar||m.push({id:"_.auxiliarybar.newcontainer",label:h(2706,"New Secondary Side Bar Entry")}),m.push({type:"separator",label:h(2707,"Side Bar")});const C=c.getVisiblePaneCompositeIds(We.Sidebar);m.push(...C.filter(A=>A===i.getViewContainerByViewId(d).id?!1:!i.getViewContainerById(A).rejectAddedViews).map(A=>({id:A,label:i.getViewContainerModel(i.getViewContainerById(A)).title}))),m.push({type:"separator",label:h(2708,"Panel")});const k=c.getPinnedPaneCompositeIds(We.Panel);m.push(...k.filter(A=>A===i.getViewContainerByViewId(d).id?!1:!i.getViewContainerById(A).rejectAddedViews).map(A=>({id:A,label:i.getViewContainerModel(i.getViewContainerById(A)).title}))),m.push({type:"separator",label:h(2709,"Secondary Side Bar")});const D=c.getPinnedPaneCompositeIds(We.AuxiliaryBar);m.push(...D.filter(A=>A===i.getViewContainerByViewId(d).id?!1:!i.getViewContainerById(A).rejectAddedViews).map(A=>({id:A,label:i.getViewContainerModel(i.getViewContainerById(A)).title}))),g.items=m,u.add(g.onDidAccept(()=>{const A=g.selectedItems[0];A.id==="_.panel.newcontainer"?(i.moveViewToLocation(l,We.Panel,this.desc.id),n.openView(d,!0)):A.id==="_.sidebar.newcontainer"?(i.moveViewToLocation(l,We.Sidebar,this.desc.id),n.openView(d,!0)):A.id==="_.auxiliarybar.newcontainer"?(i.moveViewToLocation(l,We.AuxiliaryBar,this.desc.id),n.openView(d,!0)):A.id&&(i.moveViewsToContainer([l],i.getViewContainerById(A.id),void 0,this.desc.id),n.openView(d,!0)),g.hide()})),u.add(g.onDidHide(()=>u.dispose())),g.show()}}Y(tfe);Y(class extends X{constructor(){super({id:"workbench.action.resetFocusedViewLocation",title:I(2710,"Reset Focused View Location"),category:te.View,f1:!0,precondition:ll.notEqualsTo("")})}run(s){const e=s.get($s),t=s.get(fe),i=s.get(ei),n=s.get(io),o=ll.getValue(t);let r=null;if(o!==void 0&&o.trim()!==""&&(r=e.getViewDescriptorById(o)),!r){i.error(h(2711,"There is no view currently focused."));return}const a=e.getDefaultContainerById(r.id);!a||a===e.getViewContainerByViewId(r.id)||(e.moveViewsToContainer([r],a,void 0,this.desc.id),n.openView(r.id,!0))}});class Ea extends X{static{this.RESIZE_INCREMENT=60}resizePart(e,t,i,n){let o;if(n===void 0){const r=i.hasFocus(ot.EDITOR_PART),a=i.hasFocus(ot.SIDEBAR_PART),c=i.hasFocus(ot.PANEL_PART),d=i.hasFocus(ot.AUXILIARYBAR_PART);a?o=ot.SIDEBAR_PART:c?o=ot.PANEL_PART:r?o=ot.EDITOR_PART:d&&(o=ot.AUXILIARYBAR_PART)}else o=n;o&&i.resizePart(o,e,t)}}class Iqe extends Ea{constructor(){super({id:"workbench.action.increaseViewSize",title:I(2712,"Increase Current View Size"),f1:!0,precondition:_l.toNegated()})}run(e){this.resizePart(Ea.RESIZE_INCREMENT,Ea.RESIZE_INCREMENT,e.get(yi))}}class Dqe extends Ea{constructor(){super({id:"workbench.action.increaseViewWidth",title:I(2713,"Increase Editor Width"),f1:!0,precondition:_l.toNegated()})}run(e){this.resizePart(Ea.RESIZE_INCREMENT,0,e.get(yi),ot.EDITOR_PART)}}class kqe extends Ea{constructor(){super({id:"workbench.action.increaseViewHeight",title:I(2714,"Increase Editor Height"),f1:!0,precondition:_l.toNegated()})}run(e){this.resizePart(0,Ea.RESIZE_INCREMENT,e.get(yi),ot.EDITOR_PART)}}class Tqe extends Ea{constructor(){super({id:"workbench.action.decreaseViewSize",title:I(2715,"Decrease Current View Size"),f1:!0,precondition:_l.toNegated()})}run(e){this.resizePart(-Ea.RESIZE_INCREMENT,-Ea.RESIZE_INCREMENT,e.get(yi))}}class Aqe extends Ea{constructor(){super({id:"workbench.action.decreaseViewWidth",title:I(2716,"Decrease Editor Width"),f1:!0,precondition:_l.toNegated()})}run(e){this.resizePart(-Ea.RESIZE_INCREMENT,0,e.get(yi),ot.EDITOR_PART)}}class Rqe extends Ea{constructor(){super({id:"workbench.action.decreaseViewHeight",title:I(2717,"Decrease Editor Height"),f1:!0,precondition:_l.toNegated()})}run(e){this.resizePart(0,-Ea.RESIZE_INCREMENT,e.get(yi),ot.EDITOR_PART)}}Y(Iqe);Y(Dqe);Y(kqe);Y(Tqe);Y(Aqe);Y(Rqe);Y(class extends X{constructor(){super({id:"workbench.action.alignQuickInputTop",title:I(2718,"Align Quick Input Top"),f1:!1})}run(e){e.get(Wt).setAlignment("top")}});Y(class extends X{constructor(){super({id:"workbench.action.alignQuickInputCenter",title:I(2719,"Align Quick Input Center"),f1:!1})}run(e){e.get(Wt).setAlignment("center")}});function Pqe(s){return s.iconA!==void 0}const H_=(s,e,t,i)=>({id:s,active:e,label:t,visualIcon:i,activeIcon:K.eye,inactiveIcon:K.eyeClosed,activeAriaLabel:h(2720,"Select to Hide"),inactiveAriaLabel:h(2721,"Select to Show"),useButtons:!0}),tl=(s,e,t,i)=>({id:s,active:e,label:t,visualIcon:i,activeIcon:K.check,activeAriaLabel:h(2722,"Active"),useButtons:!1}),Lqe=x.and(Ku.toNegated(),x.notEquals("config.window.menuBarVisibility","hidden"),x.notEquals("config.window.menuBarVisibility","toggle"),x.notEquals("config.window.menuBarVisibility","compact")),$0=[];(!Yt||!ca)&&$0.push(H_("workbench.action.toggleMenuBar",Lqe,h(2723,"Menu Bar"),dqe));$0.push(H_(xqe,x.notEquals("config.workbench.activityBar.location","hidden"),h(2724,"Activity Bar"),{whenA:x.equals("config.workbench.sideBar.location","left"),iconA:lqe,iconB:hqe}),H_(yh.ID,Tm,h(2725,"Primary Side Bar"),{whenA:x.equals("config.workbench.sideBar.location","left"),iconA:xM,iconB:IM}),H_(Ap.ID,pp,h(2709,"Secondary Side Bar"),{whenA:x.equals("config.workbench.sideBar.location","left"),iconA:IM,iconB:xM}),H_(pw.ID,EN,h(2708,"Panel"),pqe),H_(Xx.ID,x.equals("config.workbench.statusBar.visible",!0),h(2726,"Status Bar"),fqe));const ife=[tl(U0.ID,x.equals("config.workbench.sideBar.location","left"),h(2727,"Left"),xM),tl(H0.ID,x.equals("config.workbench.sideBar.location","right"),h(2728,"Right"),IM)],nfe=[tl("workbench.action.alignPanelLeft",rp.isEqualTo("left"),h(2729,"Left"),mqe),tl("workbench.action.alignPanelRight",rp.isEqualTo("right"),h(2730,"Right"),vqe),tl("workbench.action.alignPanelCenter",rp.isEqualTo("center"),h(2731,"Center"),_qe),tl("workbench.action.alignPanelJustify",rp.isEqualTo("justify"),h(2732,"Justify"),bqe)],sfe=[tl("workbench.action.alignQuickInputTop",S8.isEqualTo("top"),h(2733,"Top"),yqe),tl("workbench.action.alignQuickInputCenter",S8.isEqualTo("center"),h(2734,"Center"),wqe)],ofe=[tl("workbench.action.toggleFullScreen",Hp,h(2735,"Full Screen"),Sqe),tl("workbench.action.toggleZenMode",hd,h(2736,"Zen Mode"),Eqe),tl("workbench.action.toggleCenteredLayout",koe,h(2737,"Centered Layout"),Cqe)],rfe=new Set;for(const{active:s}of[...$0,...ife,...nfe,...sfe,...ofe])for(const e of s.keys())rfe.add(e);Y(class extends X{constructor(){super({id:"workbench.action.customizeLayout",title:I(2738,"Customize Layout..."),f1:!0,icon:efe,menu:[{id:N.LayoutControlMenuSubmenu,group:"z_end"},{id:N.LayoutControlMenu,when:x.and(nv.toNegated(),x.equals("config.workbench.layoutControl.type","both")),group:"1_layout"}]})}getItems(e,t){const i=n=>{const o=n.active.evaluate(e.getContext(null));let r=n.useButtons?n.label:n.label+(o&&n.activeIcon?` $(${n.activeIcon.id})`:!o&&n.inactiveIcon?` $(${n.inactiveIcon.id})`:"");const a=n.label+(o&&n.activeAriaLabel?` (${n.activeAriaLabel})`:!o&&n.inactiveAriaLabel?` (${n.inactiveAriaLabel})`:"");if(n.visualIcon){let d=n.visualIcon;Pqe(d)&&(d=d.whenA.evaluate(e.getContext(null))?d.iconA:d.iconB),r=`$(${d.id}) ${r}`}const c=o?n.activeIcon:n.inactiveIcon;return{type:"item",id:n.id,label:r,ariaLabel:a,keybinding:t.lookupKeybinding(n.id,e),buttons:n.useButtons?[{alwaysVisible:!1,tooltip:a,iconClass:c?ke.asClassName(c):void 0}]:void 0}};return[{type:"separator",label:h(2739,"Visibility")},...$0.map(i),{type:"separator",label:h(2740,"Primary Side Bar Position")},...ife.map(i),{type:"separator",label:h(2741,"Panel Alignment")},...nfe.map(i),{type:"separator",label:h(2742,"Quick Input Position")},...sfe.map(i),{type:"separator",label:h(2743,"Modes")},...ofe.map(i)]}run(e){if(this._currentQuickPick){this._currentQuickPick.hide();return}const t=e.get(ne),i=e.get(fe),n=e.get(Ge),o=e.get(Wt),r=e.get(He),a=new U,c=a.add(o.createQuickPick({useSeparators:!0}));this._currentQuickPick=c,c.items=this.getItems(i,r),c.ignoreFocusOut=!0,c.hideInput=!0,c.title=h(2744,"Customize Layout");const d={alwaysVisible:!0,iconClass:ke.asClassName(K.close),tooltip:h(2745,"Close")},l={alwaysVisible:!0,iconClass:ke.asClassName(K.discard),tooltip:h(2746,"Restore Defaults")};c.buttons=[l,d];let u;a.add(i.onDidChangeContext(g=>{g.affectsSome(rfe)&&(c.items=this.getItems(i,r),u&&(c.activeItems=c.items.filter(m=>m.id===u?.id)),setTimeout(()=>o.focus(),0))})),a.add(c.onDidAccept(g=>{c.selectedItems.length&&(u=c.selectedItems[0],n.executeCommand(u.id))})),a.add(c.onDidTriggerItemButton(g=>{g.item&&(u=g.item,n.executeCommand(u.id))})),a.add(c.onDidTriggerButton(g=>{if(g===d)c.hide();else if(g===l){const m=v=>{const _=t.inspect(v);t.updateValue(v,_.defaultValue)};m("workbench.activityBar.location"),m("workbench.sideBar.location"),m("workbench.statusBar.visible"),m("workbench.panel.defaultLocation"),(!Yt||!ca)&&m("window.menuBarVisibility"),n.executeCommand("workbench.action.alignPanelCenter"),n.executeCommand("workbench.action.alignQuickInputTop")}})),a.add(c.onDidHide(()=>{c.dispose()})),a.add(c.onDispose(()=>{this._currentQuickPick=void 0,a.dispose()})),c.show()}});const Mqe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),Nqe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ve(Nqe);const k_=j;var Is;(function(s){s[s.HIDDEN=0]="HIDDEN",s[s.VISIBLE=1]="VISIBLE",s[s.FOCUSED=2]="FOCUSED",s[s.OPEN=3]="OPEN"})(Is||(Is={}));class ls extends F{static{this.OVERFLOW_INDEX=-1}constructor(e,t,i){super(),this.container=e,this.options=t,this.menuStyle=i,this._mnemonicsInUse=!1,this.openedViaKeyboard=!1,this.awaitingAltRelease=!1,this.ignoreNextMouseUp=!1,this.updatePending=!1,this.numMenusShown=0,this.overflowLayoutScheduled=void 0,this.menuDisposables=this._register(new U),this.container.setAttribute("role","menubar"),this.isCompact&&this.container.classList.add("compact"),this.menus=[],this.mnemonics=new Map,this._focusState=Is.VISIBLE,this._onVisibilityChange=this._register(new M),this._onFocusStateChange=this._register(new M),this.createOverflowMenu(),this.menuUpdater=this._register(new yn(()=>this.update(),200)),this.actionRunner=this.options.actionRunner??this._register(new hg),this._register(this.actionRunner.onWillRun(()=>{this.setUnfocusedState()})),this._register(FT.getInstance().event(this.onModifierKeyToggled,this)),this._register(re(this.container,pe.KEY_DOWN,o=>{const r=new vo(o);let a=!0;const c=o.key?o.key.toLocaleLowerCase():"",d=Yt&&!this.isCompact;if(r.equals(S.LeftArrow)||d&&r.equals(S.Tab|E.Shift))this.focusPrevious();else if(r.equals(S.RightArrow)||d&&r.equals(S.Tab))this.focusNext();else if(r.equals(S.Escape)&&this.isFocused&&!this.isOpen)this.setUnfocusedState();else if(!this.isOpen&&!r.ctrlKey&&this.options.enableMnemonics&&this.mnemonicsInUse&&this.mnemonics.has(c)){const l=this.mnemonics.get(c);this.onMenuTriggered(l,!1)}else a=!1;!this.isCompact&&(r.equals(S.Tab|E.Shift)||r.equals(S.Tab))&&r.preventDefault(),a&&(r.preventDefault(),r.stopPropagation())}));const n=Et(this.container);this._register(re(n,pe.MOUSE_DOWN,()=>{this.isFocused&&this.setUnfocusedState()})),this._register(re(this.container,pe.FOCUS_IN,o=>{const r=o;r.relatedTarget&&(this.container.contains(r.relatedTarget)||(this.focusToReturn=r.relatedTarget))})),this._register(re(this.container,pe.FOCUS_OUT,o=>{const r=o;r.relatedTarget?r.relatedTarget&&!this.container.contains(r.relatedTarget)&&(this.focusToReturn=void 0,this.setUnfocusedState()):this.setUnfocusedState()})),this._register(re(n,pe.KEY_DOWN,o=>{if(!this.options.enableMnemonics||!o.altKey||o.ctrlKey||o.defaultPrevented)return;const r=o.key.toLocaleLowerCase();if(!this.mnemonics.has(r))return;this.mnemonicsInUse=!0,this.updateMnemonicVisibility(!0);const a=this.mnemonics.get(r);this.onMenuTriggered(a,!1)})),this.setUnfocusedState()}push(e){fw(e).forEach(i=>{const n=this.menus.length,o=C8(i.label),r=E8.exec(i.label);if(r){const a=r[1]?r[1]:r[3];this.registerMnemonic(this.menus.length,a)}if(this.isCompact)this.menus.push(i);else{const a=k_("div.menubar-menu-button",{role:"menuitem",tabindex:-1,"aria-label":o,"aria-haspopup":!0}),c=k_("div.menubar-menu-title",{role:"none","aria-hidden":!0});a.appendChild(c),this.container.insertBefore(a,this.overflowMenu.buttonElement),this.updateLabels(c,a,i.label),this._register(re(a,pe.KEY_UP,d=>{const l=new vo(d);let u=!0;(l.equals(S.DownArrow)||l.equals(S.Enter))&&!this.isOpen?(this.focusedMenu={index:n},this.openedViaKeyboard=!0,this.focusState=Is.OPEN):u=!1,u&&(l.preventDefault(),l.stopPropagation())})),this._register(Dh.addTarget(a)),this._register(re(a,Yo.Tap,d=>{this.isOpen&&this.focusedMenu&&this.focusedMenu.holder&&Hu(d.initialTarget,this.focusedMenu.holder)||(this.ignoreNextMouseUp=!1,this.onMenuTriggered(n,!0),d.preventDefault(),d.stopPropagation())})),this._register(re(a,pe.MOUSE_DOWN,d=>{if(!new bs(Et(a),d).leftButton){d.preventDefault();return}this.isOpen?this.ignoreNextMouseUp=!1:(this.ignoreNextMouseUp=!0,this.onMenuTriggered(n,!0)),d.preventDefault(),d.stopPropagation()})),this._register(re(a,pe.MOUSE_UP,d=>{d.defaultPrevented||(this.ignoreNextMouseUp?this.ignoreNextMouseUp=!1:this.isFocused&&this.onMenuTriggered(n,!0))})),this._register(re(a,pe.MOUSE_ENTER,()=>{this.isOpen&&!this.isCurrentMenu(n)?(a.focus(),this.cleanupCustomMenu(),this.showCustomMenu(n,!1)):this.isFocused&&!this.isOpen&&(this.focusedMenu={index:n},a.focus())})),this.menus.push({label:i.label,actions:i.actions,buttonElement:a,titleElement:c})}})}createOverflowMenu(){const e=this.isCompact?h(27,"Application Menu"):h(28,"More"),t=k_("div.menubar-menu-button",{role:"menuitem",tabindex:this.isCompact?0:-1,"aria-label":e,"aria-haspopup":!0}),i=k_("div.menubar-menu-title.toolbar-toggle-more"+ke.asCSSSelector(K.menuBarMore),{role:"none","aria-hidden":!0});t.appendChild(i),this.container.appendChild(t),t.style.visibility="hidden",this._register(re(t,pe.KEY_UP,n=>{const o=new vo(n);let r=!0;const a=[S.Enter];this.isCompact?(a.push(S.Space),this.options.compactMode?.horizontal===Zf.Right?a.push(S.RightArrow):this.options.compactMode?.horizontal===Zf.Left&&a.push(S.LeftArrow)):a.push(S.DownArrow),a.some(c=>o.equals(c))&&!this.isOpen?(this.focusedMenu={index:ls.OVERFLOW_INDEX},this.openedViaKeyboard=!0,this.focusState=Is.OPEN):r=!1,r&&(o.preventDefault(),o.stopPropagation())})),this._register(Dh.addTarget(t)),this._register(re(t,Yo.Tap,n=>{this.isOpen&&this.focusedMenu&&this.focusedMenu.holder&&Hu(n.initialTarget,this.focusedMenu.holder)||(this.ignoreNextMouseUp=!1,this.onMenuTriggered(ls.OVERFLOW_INDEX,!0),n.preventDefault(),n.stopPropagation())})),this._register(re(t,pe.MOUSE_DOWN,n=>{if(!new bs(Et(t),n).leftButton){n.preventDefault();return}this.isOpen?this.ignoreNextMouseUp=!1:(this.ignoreNextMouseUp=!0,this.onMenuTriggered(ls.OVERFLOW_INDEX,!0)),n.preventDefault(),n.stopPropagation()})),this._register(re(t,pe.MOUSE_UP,n=>{n.defaultPrevented||(this.ignoreNextMouseUp?this.ignoreNextMouseUp=!1:this.isFocused&&this.onMenuTriggered(ls.OVERFLOW_INDEX,!0))})),this._register(re(t,pe.MOUSE_ENTER,()=>{this.isOpen&&!this.isCurrentMenu(ls.OVERFLOW_INDEX)?(this.overflowMenu.buttonElement.focus(),this.cleanupCustomMenu(),this.showCustomMenu(ls.OVERFLOW_INDEX,!1)):this.isFocused&&!this.isOpen&&(this.focusedMenu={index:ls.OVERFLOW_INDEX},t.focus())})),this.overflowMenu={buttonElement:t,titleElement:i,label:"More",actions:[]}}updateMenu(e){const t=this.menus.filter(i=>i.label===e.label);t&&t.length&&(t[0].actions=e.actions)}dispose(){super.dispose(),this.menus.forEach(e=>{e.titleElement?.remove(),e.buttonElement?.remove()}),this.overflowMenu.titleElement.remove(),this.overflowMenu.buttonElement.remove(),Xe(this.overflowLayoutScheduled),this.overflowLayoutScheduled=void 0}blur(){this.setUnfocusedState()}getWidth(){if(!this.isCompact&&this.menus){const e=this.menus[0].buttonElement.getBoundingClientRect().left;return(this.hasOverflow?this.overflowMenu.buttonElement.getBoundingClientRect().right:this.menus[this.menus.length-1].buttonElement.getBoundingClientRect().right)-e}return 0}getHeight(){return this.container.clientHeight}toggleFocus(){!this.isFocused&&this.options.visibility!=="hidden"?(this.mnemonicsInUse=!0,this.focusedMenu={index:this.numMenusShown>0?0:ls.OVERFLOW_INDEX},this.focusState=Is.FOCUSED):this.isOpen||this.setUnfocusedState()}updateOverflowAction(){if(!this.menus||!this.menus.length)return;const e="overflow-menu-only";this.container.classList.toggle(e,!1);const t=this.container.offsetWidth;let i=0,n=this.isCompact;const o=this.numMenusShown;this.numMenusShown=0;const r=this.menus.filter(a=>a.buttonElement!==void 0&&a.titleElement!==void 0);for(const a of r){if(!n){const c=a.buttonElement.offsetWidth;i+c>t?n=!0:(i+=c,this.numMenusShown++,this.numMenusShown>o&&(a.buttonElement.style.visibility="visible"))}n&&(a.buttonElement.style.visibility="hidden")}if(this.numMenusShown-1<=r.length/4){for(const a of r)a.buttonElement.style.visibility="hidden";n=!0,this.numMenusShown=0,i=0}if(this.isCompact){this.overflowMenu.actions=[];for(let c=this.numMenusShown;c<this.menus.length;c++)this.overflowMenu.actions.push(new Eh(`menubar.submenu.${this.menus[c].label}`,this.menus[c].label,this.menus[c].actions||[]));const a=this.options.getCompactMenuActions?.();a&&a.length&&(this.overflowMenu.actions.push(new os),this.overflowMenu.actions.push(...a)),this.overflowMenu.buttonElement.style.visibility="visible"}else if(n){for(;i+this.overflowMenu.buttonElement.offsetWidth>t&&this.numMenusShown>0;){this.numMenusShown--;const a=r[this.numMenusShown].buttonElement.offsetWidth;r[this.numMenusShown].buttonElement.style.visibility="hidden",i-=a}this.overflowMenu.actions=[];for(let a=this.numMenusShown;a<r.length;a++)this.overflowMenu.actions.push(new Eh(`menubar.submenu.${r[a].label}`,r[a].label,r[a].actions||[]));this.overflowMenu.buttonElement.nextElementSibling!==r[this.numMenusShown].buttonElement&&(this.overflowMenu.buttonElement.remove(),this.container.insertBefore(this.overflowMenu.buttonElement,r[this.numMenusShown].buttonElement)),this.overflowMenu.buttonElement.style.visibility="visible"}else this.overflowMenu.buttonElement.remove(),this.container.appendChild(this.overflowMenu.buttonElement),this.overflowMenu.buttonElement.style.visibility="hidden";this.container.classList.toggle(e,this.numMenusShown===0)}updateLabels(e,t,i){const n=C8(i);if(this.options.enableMnemonics){const r=jz(i);o1.lastIndex=0;let a=o1.exec(r);for(;a&&a[1];)a=o1.exec(r);const c=d=>d.replace(/&amp;&amp;/g,"&amp;");a?(e.innerText="",e.append(nse(c(r.substr(0,a.index))," "),k_("mnemonic",{"aria-hidden":"true"},a[3]),jm(c(r.substr(a.index+a[0].length))," "))):e.innerText=c(r).trim()}else e.innerText=n.replace(/&&/g,"&");const o=E8.exec(i);if(o){const r=o[1]?o[1]:o[3];this.options.enableMnemonics?t.setAttribute("aria-keyshortcuts","Alt+"+r.toLocaleLowerCase()):t.removeAttribute("aria-keyshortcuts")}}update(e){if(e&&(this.options=e),this.isFocused){this.updatePending=!0;return}this.menus.forEach(t=>{!t.buttonElement||!t.titleElement||this.updateLabels(t.titleElement,t.buttonElement,t.label)}),this.overflowLayoutScheduled||(this.overflowLayoutScheduled=PE(Et(this.container),()=>{this.updateOverflowAction(),this.overflowLayoutScheduled=void 0})),this.setUnfocusedState()}registerMnemonic(e,t){this.mnemonics.set(t.toLocaleLowerCase(),e)}hideMenubar(){this.container.style.display!=="none"&&(this.container.style.display="none",this._onVisibilityChange.fire(!1))}showMenubar(){this.container.style.display!=="flex"&&(this.container.style.display="flex",this._onVisibilityChange.fire(!0),this.updateOverflowAction())}get focusState(){return this._focusState}set focusState(e){if(this._focusState>=Is.FOCUSED&&e<Is.FOCUSED&&this.updatePending&&(this.menuUpdater.schedule(),this.updatePending=!1),e===this._focusState)return;const t=this.isVisible,i=this.isOpen,n=this.isFocused;switch(this._focusState=e,e){case Is.HIDDEN:t&&this.hideMenubar(),i&&this.cleanupCustomMenu(),n&&(this.focusedMenu=void 0,this.focusToReturn&&(this.focusToReturn.focus(),this.focusToReturn=void 0));break;case Is.VISIBLE:t||this.showMenubar(),i&&this.cleanupCustomMenu(),n&&(this.focusedMenu&&(this.focusedMenu.index===ls.OVERFLOW_INDEX?this.overflowMenu.buttonElement.blur():this.menus[this.focusedMenu.index].buttonElement?.blur()),this.focusedMenu=void 0,this.focusToReturn&&(this.focusToReturn.focus(),this.focusToReturn=void 0));break;case Is.FOCUSED:t||this.showMenubar(),i&&this.cleanupCustomMenu(),this.focusedMenu&&(this.focusedMenu.index===0&&this.numMenusShown===0&&(this.focusedMenu.index=ls.OVERFLOW_INDEX),this.focusedMenu.index===ls.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[this.focusedMenu.index].buttonElement?.focus());break;case Is.OPEN:t||this.showMenubar(),this.focusedMenu&&(this.cleanupCustomMenu(),this.showCustomMenu(this.focusedMenu.index,this.openedViaKeyboard));break}this._focusState=e,this._onFocusStateChange.fire(this.focusState>=Is.FOCUSED)}get isVisible(){return this.focusState>=Is.VISIBLE}get isFocused(){return this.focusState>=Is.FOCUSED}get isOpen(){return this.focusState>=Is.OPEN}get hasOverflow(){return this.isCompact||this.numMenusShown<this.menus.length}get isCompact(){return this.options.compactMode!==void 0}setUnfocusedState(){this.options.visibility==="toggle"||this.options.visibility==="hidden"?this.focusState=Is.HIDDEN:this.options.visibility==="classic"&&Ose(zi)?this.focusState=Is.HIDDEN:this.focusState=Is.VISIBLE,this.ignoreNextMouseUp=!1,this.mnemonicsInUse=!1,this.updateMnemonicVisibility(!1)}focusPrevious(){if(!this.focusedMenu||this.numMenusShown===0)return;let e=(this.focusedMenu.index-1+this.numMenusShown)%this.numMenusShown;this.focusedMenu.index===ls.OVERFLOW_INDEX?e=this.numMenusShown-1:this.focusedMenu.index===0&&this.hasOverflow&&(e=ls.OVERFLOW_INDEX),e!==this.focusedMenu.index&&(this.isOpen?(this.cleanupCustomMenu(),this.showCustomMenu(e)):this.isFocused&&(this.focusedMenu.index=e,e===ls.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[e].buttonElement?.focus()))}focusNext(){if(!this.focusedMenu||this.numMenusShown===0)return;let e=(this.focusedMenu.index+1)%this.numMenusShown;this.focusedMenu.index===ls.OVERFLOW_INDEX?e=0:this.focusedMenu.index===this.numMenusShown-1&&(e=ls.OVERFLOW_INDEX),e!==this.focusedMenu.index&&(this.isOpen?(this.cleanupCustomMenu(),this.showCustomMenu(e)):this.isFocused&&(this.focusedMenu.index=e,e===ls.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[e].buttonElement?.focus()))}updateMnemonicVisibility(e){this.menus&&this.menus.forEach(t=>{if(t.titleElement&&t.titleElement.children.length){const i=t.titleElement.children.item(0);i&&(i.style.textDecoration=this.options.alwaysOnMnemonics||e?"underline":"")}})}get mnemonicsInUse(){return this._mnemonicsInUse}set mnemonicsInUse(e){this._mnemonicsInUse=e}get shouldAltKeyFocus(){return Yt?!1:!this.options.disableAltFocus||this.options.visibility==="toggle"}get onVisibilityChange(){return this._onVisibilityChange.event}get onFocusStateChange(){return this._onFocusStateChange.event}onMenuTriggered(e,t){this.isOpen?this.isCurrentMenu(e)?this.setUnfocusedState():(this.cleanupCustomMenu(),this.showCustomMenu(e,this.openedViaKeyboard)):(this.focusedMenu={index:e},this.openedViaKeyboard=!t,this.focusState=Is.OPEN)}onModifierKeyToggled(e){const t=!e.altKey&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey;this.options.visibility!=="hidden"&&(e.event&&this.shouldAltKeyFocus&&Rwe.toEnum(e.event.code)===Pwe.AltLeft&&e.event.preventDefault(),this.isFocused&&e.lastKeyPressed==="alt"&&e.altKey&&(this.setUnfocusedState(),this.mnemonicsInUse=!1,this.awaitingAltRelease=!0),t&&e.lastKeyPressed==="alt"&&e.lastKeyReleased==="alt"&&(this.awaitingAltRelease||(!this.isFocused&&this.shouldAltKeyFocus?(this.mnemonicsInUse=!0,this.focusedMenu={index:this.numMenusShown>0?0:ls.OVERFLOW_INDEX},this.focusState=Is.FOCUSED):this.isOpen||this.setUnfocusedState())),!e.altKey&&e.lastKeyReleased==="alt"&&(this.awaitingAltRelease=!1),this.options.enableMnemonics&&this.menus&&!this.isOpen&&this.updateMnemonicVisibility(!this.awaitingAltRelease&&e.altKey||this.mnemonicsInUse))}isCurrentMenu(e){return this.focusedMenu?this.focusedMenu.index===e:!1}cleanupCustomMenu(){this.focusedMenu&&(this.focusedMenu.index===ls.OVERFLOW_INDEX?this.overflowMenu.buttonElement.focus():this.menus[this.focusedMenu.index].buttonElement?.focus(),this.focusedMenu.holder&&(this.focusedMenu.holder.parentElement?.classList.remove("open"),this.focusedMenu.holder.remove()),this.focusedMenu.widget?.dispose(),this.focusedMenu={index:this.focusedMenu.index}),this.menuDisposables.clear()}showCustomMenu(e,t=!0){const i=e>=this.numMenusShown?ls.OVERFLOW_INDEX:e,n=i===ls.OVERFLOW_INDEX?this.overflowMenu:this.menus[i];if(!n.actions||!n.buttonElement||!n.titleElement)return;const o=k_("div.menubar-menu-items-holder",{title:""});n.buttonElement.classList.add("open");const r=n.titleElement.getBoundingClientRect(),a=Lwe(n.titleElement);if(this.options.compactMode?.horizontal===Zf.Right)o.style.left=`${r.left+this.container.clientWidth}px`;else if(this.options.compactMode?.horizontal===Zf.Left){const l=Et(this.container).innerWidth;o.style.right=`${l-r.left}px`,o.style.left="auto"}else o.style.left=`${r.left*a}px`;this.options.compactMode?.vertical===bC.Above?o.style.top=`${r.top-this.menus.length*30+this.container.clientHeight}px`:this.options.compactMode?.vertical===bC.Below?o.style.top=`${r.top}px`:o.style.top=`${r.bottom*a}px`,n.buttonElement.appendChild(o);const c={getKeyBinding:this.options.getKeybinding,actionRunner:this.actionRunner,enableMnemonics:this.options.alwaysOnMnemonics||this.mnemonicsInUse&&this.options.enableMnemonics,ariaLabel:n.buttonElement.getAttribute("aria-label")??void 0,expandDirection:this.isCompact?this.options.compactMode:{horizontal:Zf.Right,vertical:bC.Below},useEventAsContext:!0},d=this.menuDisposables.add(new Mwe(o,n.actions,c,this.menuStyle));this.menuDisposables.add(d.onDidCancel(()=>{this.focusState=Is.FOCUSED})),i!==e?d.trigger(e-this.numMenusShown):d.focus(t),this.focusedMenu={index:i,holder:o,widget:d}}}function kie(s){return s&&s.hasOwnProperty("folderUri")}function Oqe(s){return s&&s.hasOwnProperty("workspace")}const afe="inRecentFilesPicker";class cfe extends X{constructor(e){super(e),this.removeFromRecentlyOpened={iconClass:ke.asClassName(K.removeClose),tooltip:h(2768,"Remove from Recently Opened")},this.dirtyRecentlyOpenedFolder={iconClass:"dirty-workspace "+ke.asClassName(K.closeDirty),tooltip:h(2769,"Folder With Unsaved Files"),alwaysVisible:!0},this.dirtyRecentlyOpenedWorkspace={...this.dirtyRecentlyOpenedFolder,tooltip:h(2770,"Workspace With Unsaved Files")}}async run(e){const t=e.get(Nh),i=e.get(Wt),n=e.get(It),o=e.get(ui),r=e.get(He),a=e.get(ci),c=e.get(vi),d=e.get(Hn),l=e.get(ei),u=await t.getRecentlyOpened(),g=await t.getDirtyWorkspaces();let m=!1;const v=new In,_=new In;for(const me of g)kie(me)?v.set(me.folderUri,!0):(_.set(me.workspace.configPath,me.workspace),m=!0);const w=new In,C=new In;for(const me of u.workspaces)Wk(me)?w.set(me.folderUri,!0):(C.set(me.workspace.configPath,me.workspace),m=!0);const k=[];for(const me of u.workspaces){const zt=Wk(me)?v.has(me.folderUri):_.has(me.workspace.configPath);k.push(this.toQuickPick(a,c,o,me,zt))}for(const me of g)kie(me)&&!w.has(me.folderUri)?k.push(this.toQuickPick(a,c,o,me,!0)):Oqe(me)&&!C.has(me.workspace.configPath)&&k.push(this.toQuickPick(a,c,o,me,!0));const D=u.files.map(me=>this.toQuickPick(a,c,o,me,!1)),A=u.workspaces[0],B=A&&n.isCurrentWorkspace(nW(A)?A.workspace:A.folderUri);let q;const Q={type:"separator",label:m?h(2771,"folders & workspaces"):h(2772,"folders")},ie={type:"separator",label:h(2773,"files")},oe=[Q,...k,ie,...D],be=await i.pick(oe,{contextKey:afe,activeItem:[...k,...D][B?1:0],placeHolder:Yt?h(2774,"Select to open (hold Cmd-key to force new window or Option-key for same window)"):h(2775,"Select to open (hold Ctrl-key to force new window or Alt-key for same window)"),matchOnDescription:!0,onKeyMods:me=>q=me,quickNavigate:this.isQuickNavigate()?{keybindings:r.lookupKeybindings(this.desc.id)}:void 0,hideInput:this.isQuickNavigate(),onDidTriggerItemButton:async me=>{if(me.button===this.removeFromRecentlyOpened)await t.removeRecentlyOpened([me.item.resource]),me.removeItem();else if(me.button===this.dirtyRecentlyOpenedFolder||me.button===this.dirtyRecentlyOpenedWorkspace){const zt=me.button===this.dirtyRecentlyOpenedWorkspace,{confirmed:ft}=await l.confirm({title:zt?h(2776,"Workspace with Unsaved Files"):h(2777,"Folder with Unsaved Files"),message:zt?h(2778,"Do you want to open the workspace to review the unsaved files?"):h(2779,"Do you want to open the folder to review the unsaved files?"),detail:zt?h(2780,"Workspaces with unsaved files cannot be removed until all unsaved files have been saved or reverted."):h(2781,"Folders with unsaved files cannot be removed until all unsaved files have been saved or reverted.")});ft&&(d.openWindow([me.item.openable],{remoteAuthority:me.item.remoteAuthority||null}),i.cancel())}}});if(be)return d.openWindow([be.openable],{forceNewWindow:q?.ctrlCmd,forceReuseWindow:q?.alt,remoteAuthority:be.remoteAuthority||null})}toQuickPick(e,t,i,n,o){let r,a,c,d,l=!1;Wk(n)?(d=n.folderUri,a=ch(e,t,d,Pi.FOLDER),r={folderUri:d},c=n.label||i.getWorkspaceLabel(d,{verbose:ev.LONG})):nW(n)?(d=n.workspace.configPath,a=ch(e,t,d,Pi.ROOT_FOLDER),r={workspaceUri:d},c=n.label||i.getWorkspaceLabel(n.workspace,{verbose:ev.LONG}),l=!0):(d=n.fileUri,a=ch(e,t,d,Pi.FILE),r={fileUri:d},c=n.label||i.getUriLabel(d,{appendWorkspaceSuffix:!0}));const{name:u,parentPath:g}=Owe(c);return{iconClasses:a,label:u,ariaLabel:o?l?h(2782,"{0}, workspace with unsaved changes",u):h(2783,"{0}, folder with unsaved changes",u):u,description:g,buttons:o?[l?this.dirtyRecentlyOpenedWorkspace:this.dirtyRecentlyOpenedFolder]:[this.removeFromRecentlyOpened],openable:r,resource:d,remoteAuthority:n.remoteAuthority}}}class G0 extends cfe{static{this.ID="workbench.action.openRecent"}constructor(){super({id:G0.ID,title:{...I(2784,"Open Recent..."),mnemonicTitle:h(2785,"&&More...")},category:te.File,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:E.CtrlCmd|S.KeyR,mac:{primary:E.WinCtrl|S.KeyR}},menu:{id:N.MenubarRecentMenu,group:"y_more",order:1}})}isQuickNavigate(){return!1}}class Fqe extends cfe{constructor(){super({id:"workbench.action.quickOpenRecent",title:I(2786,"Quick Open Recent..."),category:te.File,f1:!1})}isQuickNavigate(){return!0}}class Wqe extends X{constructor(){super({id:"workbench.action.toggleFullScreen",title:{...I(2787,"Toggle Full Screen"),mnemonicTitle:h(2788,"&&Full Screen")},category:te.View,f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:S.F11,mac:{primary:E.CtrlCmd|E.WinCtrl|S.KeyF}},precondition:Fwe.toNegated(),toggled:Hp,menu:[{id:N.MenubarAppearanceMenu,group:"1_toggle_view",order:1}]})}run(e){return e.get(Hn).toggleFullScreen(Fp())}}class x6 extends X{static{this.ID="workbench.action.reloadWindow"}constructor(){super({id:x6.ID,title:I(2789,"Reload Window"),category:te.Developer,f1:!0,keybinding:{weight:W.WorkbenchContrib+50,when:Nwe,primary:E.CtrlCmd|S.KeyR}})}async run(e){return e.get(Hn).reload()}}class Bqe extends X{constructor(){super({id:"workbench.action.showAboutDialog",title:{...I(2790,"About"),mnemonicTitle:h(2791,"&&About")},category:te.Help,f1:!0,menu:{id:N.MenubarHelpMenu,group:"z_about",order:1,when:Ku.toNegated()}})}run(e){return e.get(ei).about()}}class Vqe extends X{constructor(){super({id:"workbench.action.newWindow",title:{...I(2792,"New Window"),mnemonicTitle:h(2793,"New &&Window")},f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:Kt?bn?lt(E.CtrlCmd|S.KeyK,E.Shift|S.KeyN):E.CtrlCmd|E.Alt|E.Shift|S.KeyN:E.CtrlCmd|E.Shift|S.KeyN,secondary:Kt?[E.CtrlCmd|E.Shift|S.KeyN]:void 0},menu:{id:N.MenubarFileMenu,group:"1_new",order:3}})}run(e){return e.get(Hn).openWindow({remoteAuthority:null})}}class Hqe extends X{constructor(){super({id:"workbench.action.blur",title:I(2794,"Remove keyboard focus from focused element")})}run(){const e=wh();Ph(e)&&e.blur()}}Y(Vqe);Y(Wqe);Y(Fqe);Y(G0);Y(x6);Y(Bqe);Y(Hqe);const dfe=x.and(kl,x.has(afe)),Tie="workbench.action.quickOpenNavigateNextInRecentFilesPicker";Me.registerCommandAndKeybindingRule({id:Tie,weight:W.WorkbenchContrib+50,handler:vS(Tie,!0),when:dfe,primary:E.CtrlCmd|S.KeyR,mac:{primary:E.WinCtrl|S.KeyR}});const Aie="workbench.action.quickOpenNavigatePreviousInRecentFilesPicker";Me.registerCommandAndKeybindingRule({id:Aie,weight:W.WorkbenchContrib+50,handler:vS(Aie,!1),when:dfe,primary:E.CtrlCmd|E.Shift|S.KeyR,mac:{primary:E.WinCtrl|E.Shift|S.KeyR}});Ee.registerCommand("workbench.action.toggleConfirmBeforeClose",s=>{const e=s.get(ne),t=e.inspect("window.confirmBeforeClose").userValue;return e.updateValue("window.confirmBeforeClose",t==="never"?"keyboardOnly":"never")});ge.appendMenuItem(N.MenubarFileMenu,{group:"z_ConfirmClose",command:{id:"workbench.action.toggleConfirmBeforeClose",title:h(2795,"Confirm Before Close"),toggled:x.notEquals("config.window.confirmBeforeClose","never")},order:1,when:Eu});ge.appendMenuItem(N.MenubarFileMenu,{title:h(2796,"Open &&Recent"),submenu:N.MenubarRecentMenu,group:"2_open",order:4});Ve(Mqe);ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarFileMenu,title:{value:"File",original:"File",mnemonicTitle:h(3467,"&&File")},order:1});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarEditMenu,title:{value:"Edit",original:"Edit",mnemonicTitle:h(3468,"&&Edit")},order:2});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarSelectionMenu,title:{value:"Selection",original:"Selection",mnemonicTitle:h(3469,"&&Selection")},order:3});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarViewMenu,title:{value:"View",original:"View",mnemonicTitle:h(3470,"&&View")},order:4});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarGoMenu,title:{value:"Go",original:"Go",mnemonicTitle:h(3471,"&&Go")},order:5});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarTerminalMenu,title:{value:"Terminal",original:"Terminal",mnemonicTitle:h(3472,"&&Terminal")},order:7});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarHelpMenu,title:{value:"Help",original:"Help",mnemonicTitle:h(3473,"&&Help")},order:8});ge.appendMenuItem(N.MenubarMainMenu,{submenu:N.MenubarPreferencesMenu,title:{value:"Preferences",original:"Preferences",mnemonicTitle:h(3474,"Preferences")},when:Ku,order:9});class DM extends F{static{this.MAX_MENU_RECENT_ENTRIES=10}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(),this.menuService=e,this.workspacesService=t,this.contextKeyService=i,this.keybindingService=n,this.configurationService=o,this.labelService=r,this.updateService=a,this.storageService=c,this.notificationService=d,this.preferencesService=l,this.environmentService=u,this.accessibilityService=g,this.hostService=m,this.commandService=v,this.keys=["window.menuBarVisibility","window.enableMenuBarMnemonics","window.customMenuBarAltFocus","workbench.sideBar.location","window.nativeTabs"],this.menus={},this.topLevelTitles={},this.recentlyOpened={files:[],workspaces:[]},this.mainMenu=this._register(this.menuService.createMenu(N.MenubarMainMenu,this.contextKeyService)),this.mainMenuDisposables=this._register(new U),this.setupMainMenu(),this.menuUpdater=this._register(new yn(()=>this.doUpdateMenubar(!1),200)),this.notifyUserOfCustomMenubarAccessibility()}registerListeners(){this._register(this.hostService.onDidChangeFocus(e=>this.onDidChangeWindowFocus(e))),this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e))),this._register(this.updateService.onStateChange(()=>this.onUpdateStateChange())),this._register(this.workspacesService.onDidChangeRecentlyOpened(()=>{this.onDidChangeRecentlyOpened()})),this._register(this.keybindingService.onDidUpdateKeybindings(()=>this.updateMenubar())),this._register(this.labelService.onDidChangeFormatters(()=>{this.onDidChangeRecentlyOpened()})),this._register(this.mainMenu.onDidChange(()=>{this.setupMainMenu(),this.doUpdateMenubar(!0)}))}setupMainMenu(){this.mainMenuDisposables.clear(),this.menus={},this.topLevelTitles={};const[,e]=this.mainMenu.getActions()[0];for(const t of e)t instanceof xh&&typeof t.item.title!="string"&&(this.menus[t.item.title.original]=this.mainMenuDisposables.add(this.menuService.createMenu(t.item.submenu,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.topLevelTitles[t.item.title.original]=t.item.title.mnemonicTitle??t.item.title.value)}updateMenubar(){this.menuUpdater.schedule()}calculateActionLabel(e){return e.label}onUpdateStateChange(){this.updateMenubar()}onUpdateKeybindings(){this.updateMenubar()}getOpenRecentActions(){if(!this.recentlyOpened)return[];const{workspaces:e,files:t}=this.recentlyOpened,i=[];if(e.length>0){for(let n=0;n<DM.MAX_MENU_RECENT_ENTRIES&&n<e.length;n++)i.push(this.createOpenRecentMenuAction(e[n]));i.push(new os)}if(t.length>0){for(let n=0;n<DM.MAX_MENU_RECENT_ENTRIES&&n<t.length;n++)i.push(this.createOpenRecentMenuAction(t[n]));i.push(new os)}return i}onDidChangeWindowFocus(e){e&&this.onDidChangeRecentlyOpened()}onConfigurationUpdated(e){this.keys.some(t=>e.affectsConfiguration(t))&&this.updateMenubar(),e.affectsConfiguration("editor.accessibilitySupport")&&this.notifyUserOfCustomMenubarAccessibility(),e.affectsConfiguration("window.menuBarVisibility")&&this.onDidChangeRecentlyOpened()}get menubarHidden(){return Yt&&ca?!1:Mb(this.configurationService)==="hidden"}onDidChangeRecentlyOpened(){this.menubarHidden||this.workspacesService.getRecentlyOpened().then(e=>{this.recentlyOpened=e,this.updateMenubar()})}createOpenRecentMenuAction(e){let t,i,n,o;const r=e.remoteAuthority;Wk(e)?(i=e.folderUri,t=e.label||this.labelService.getWorkspaceLabel(i,{verbose:ev.LONG}),n="openRecentFolder",o={folderUri:i}):nW(e)?(i=e.workspace.configPath,t=e.label||this.labelService.getWorkspaceLabel(e.workspace,{verbose:ev.LONG}),n="openRecentWorkspace",o={workspaceUri:i}):(i=e.fileUri,t=e.label||this.labelService.getUriLabel(i,{appendWorkspaceSuffix:!0}),n="openRecentFile",o={fileUri:i});const a=Ri({id:n,label:Wwe(t),run:c=>{const d=c&&(!Yt&&(c.ctrlKey||c.shiftKey)||Yt&&(c.metaKey||c.altKey));return this.hostService.openWindow([o],{forceNewWindow:!!d,remoteAuthority:r||null})}});return Object.assign(a,{uri:i,remoteAuthority:r})}notifyUserOfCustomMenubarAccessibility(){if(Kt||Yt)return;const e=this.storageService.getBoolean("menubar/accessibleMenubarNotified",he.APPLICATION,!1),t=!Bwe(this.configurationService);if(e||t||!this.accessibilityService.isScreenReaderOptimized())return;const i=h(3475,"Accessibility support is enabled for you. For the most accessible experience, we recommend the custom title bar style.");this.notificationService.prompt(Fe.Info,i,[{label:h(3476,"Open Settings"),run:()=>this.preferencesService.openUserSettings({query:Ya.TITLE_BAR_STYLE})}]),this.storageService.store("menubar/accessibleMenubarNotified",!0,he.APPLICATION,gt.USER)}}let wk;function Uqe(){return wk||(wk=new M,Y(class extends X{constructor(){super({id:"workbench.actions.menubar.focus",title:I(3477,"Focus Application Menu"),keybinding:{primary:E.Alt|S.F10,weight:W.WorkbenchContrib,when:Eu},f1:!0})}async run(){wk?.fire()}})),wk}let lz=class extends DM{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_){super(e,t,i,n,o,r,a,c,d,l,u,g,v,_),this.telemetryService=m,this.alwaysOnMnemonics=!1,this.focusInsideMenubar=!1,this.pendingFirstTimeUpdate=!1,this.visible=!0,this.webNavigationMenu=this._register(this.menuService.createMenu(N.MenubarHomeMenu,this.contextKeyService)),this.reinstallDisposables=this._register(new U),this.updateActionsDisposables=this._register(new U),this._onVisibilityChange=this._register(new M),this._onFocusStateChange=this._register(new M),this.actionRunner=this._register(new hg),this.actionRunner.onDidRun(w=>{this.telemetryService.publicLog2("workbenchActionExecuted",{id:w.action.id,from:"menu"})}),this.workspacesService.getRecentlyOpened().then(w=>{this.recentlyOpened=w}),this.registerListeners()}doUpdateMenubar(e){this.focusInsideMenubar||this.setupCustomMenubar(e),e&&(this.pendingFirstTimeUpdate=!0)}getUpdateAction(){switch(this.updateService.state.type){case Gd.Idle:return new Xt("update.check",h(3478,"Check for &&Updates..."),void 0,!0,()=>this.updateService.checkForUpdates(!0));case Gd.CheckingForUpdates:return new Xt("update.checking",h(3479,"Checking for Updates..."),void 0,!1);case Gd.AvailableForDownload:return new Xt("update.downloadNow",h(3480,"D&&ownload Update"),void 0,!0,()=>this.updateService.downloadUpdate());case Gd.Downloading:return new Xt("update.downloading",h(3481,"Downloading Update..."),void 0,!1);case Gd.Downloaded:return Yt?null:new Xt("update.install",h(3482,"Install &&Update..."),void 0,!0,()=>this.updateService.applyUpdate());case Gd.Updating:return new Xt("update.updating",h(3483,"Installing Update..."),void 0,!1);case Gd.Ready:return new Xt("update.restart",h(3484,"Restart to &&Update"),void 0,!0,()=>this.updateService.quitAndInstall());default:return null}}get currentMenubarVisibility(){return Mb(this.configurationService)}get currentDisableMenuBarAltFocus(){const e=this.configurationService.getValue("window.customMenuBarAltFocus");let t=!1;return typeof e=="boolean"&&(t=!e),t}insertActionsBefore(e,t){switch(e.id){case G0.ID:t.push(...this.getOpenRecentActions());break;case"workbench.action.showAboutDialog":if(!Yt&&!Kt){const i=this.getUpdateAction();i&&(i.label=Rg(i.label),t.push(i),t.push(new os))}break}}get currentEnableMenuBarMnemonics(){let e=this.configurationService.getValue("window.enableMenuBarMnemonics");return typeof e!="boolean"&&(e=!0),e&&(!Kt||Ose(zi))}get currentCompactMenuMode(){if(this.currentMenubarVisibility!=="compact")return;const t=this.configurationService.getValue("workbench.sideBar.location")==="right"?Zf.Left:Zf.Right,n=this.configurationService.getValue("workbench.activityBar.location")===er.BOTTOM?bC.Above:bC.Below;return{horizontal:t,vertical:n}}onDidVisibilityChange(e){this.visible=e,this.onDidChangeRecentlyOpened(),this._onVisibilityChange.fire(e)}toActionsArray(e){return rI(e.getActions({shouldForwardArgs:!0}))}setupCustomMenubar(e){if(!this.container)return;e?(this.menubar&&this.reinstallDisposables.clear(),this.menubar=this.reinstallDisposables.add(new ls(this.container,this.getMenuBarOptions(),Vwe)),this.accessibilityService.alwaysUnderlineAccessKeys().then(i=>{this.alwaysOnMnemonics=i,this.menubar?.update(this.getMenuBarOptions())}),this.reinstallDisposables.add(this.menubar.onFocusStateChange(i=>{this._onFocusStateChange.fire(i),i||(this.pendingFirstTimeUpdate?(this.setupCustomMenubar(!0),this.pendingFirstTimeUpdate=!1):this.updateMenubar(),this.focusInsideMenubar=!1)})),this.reinstallDisposables.add(this.menubar.onVisibilityChange(i=>this.onDidVisibilityChange(i))),this.reinstallDisposables.add(re(this.container,pe.FOCUS_IN,()=>{this.focusInsideMenubar=!0})),this.reinstallDisposables.add(re(this.container,pe.FOCUS_OUT,()=>{this.focusInsideMenubar=!1})),this.menubar.isVisible&&this.onDidVisibilityChange(!0)):this.menubar?.update(this.getMenuBarOptions());const t=(i,n,o,r)=>{n.splice(0);for(const a of i)if(this.insertActionsBefore(a,n),a instanceof os)n.push(a);else if(a instanceof xh||a instanceof wr){let c=typeof a.item.title=="string"?a.item.title:a.item.title.mnemonicTitle??a.item.title.value;if(a instanceof xh){const d=[];t(a.actions,d,o,r),d.length>0&&n.push(new Eh(a.id,Rg(c),d))}else{$we(a.item.toggled)&&(c=a.item.toggled.mnemonicTitle??a.item.toggled.title??c);const d=r.add(new Xt(a.id,Rg(c),a.class,a.enabled,()=>this.commandService.executeCommand(a.id)));d.tooltip=a.tooltip,d.checked=a.checked,n.push(d)}}if(o==="File"&&this.currentCompactMenuMode===void 0){const a=this.getWebNavigationActions();a.length&&n.push(...a)}};for(const i of Object.keys(this.topLevelTitles)){const n=this.menus[i];if(e&&n){const r=this.reinstallDisposables.add(new U);if(this.reinstallDisposables.add(n.onDidChange(()=>{if(!this.focusInsideMenubar){const a=[];r.clear(),t(this.toActionsArray(n),a,i,r),this.menubar?.updateMenu({actions:a,label:Rg(this.topLevelTitles[i])})}})),n===this.menus.File){const a=this.reinstallDisposables.add(new U);this.reinstallDisposables.add(this.webNavigationMenu.onDidChange(()=>{if(!this.focusInsideMenubar){const c=[];a.clear(),t(this.toActionsArray(n),c,i,a),this.menubar?.updateMenu({actions:c,label:Rg(this.topLevelTitles[i])})}}))}}const o=[];n&&(this.updateActionsDisposables.clear(),t(this.toActionsArray(n),o,i,this.updateActionsDisposables)),this.menubar&&(e?this.menubar.push({actions:o,label:Rg(this.topLevelTitles[i])}):this.menubar.updateMenu({actions:o,label:Rg(this.topLevelTitles[i])}))}}getWebNavigationActions(){if(!Kt)return[];const e=[];for(const t of this.webNavigationMenu.getActions()){const[,i]=t;for(const n of i)if(n instanceof wr){const o=typeof n.item.title=="string"?n.item.title:n.item.title.mnemonicTitle??n.item.title.value;e.push(new Xt(n.id,Rg(o),n.class,n.enabled,async r=>{this.commandService.executeCommand(n.id,r)}))}e.push(new os)}return e.length&&e.pop(),e}getMenuBarOptions(){return{enableMnemonics:this.currentEnableMenuBarMnemonics,disableAltFocus:this.currentDisableMenuBarAltFocus,visibility:this.currentMenubarVisibility,actionRunner:this.actionRunner,getKeybinding:e=>this.keybindingService.lookupKeybinding(e.id),alwaysOnMnemonics:this.alwaysOnMnemonics,compactMode:this.currentCompactMenuMode,getCompactMenuActions:()=>Kt?this.getWebNavigationActions():[]}}onDidChangeWindowFocus(e){this.visible&&(super.onDidChangeWindowFocus(e),this.container&&(e?this.container.classList.remove("inactive"):(this.container.classList.add("inactive"),this.menubar?.blur())))}onUpdateStateChange(){this.visible&&super.onUpdateStateChange()}onDidChangeRecentlyOpened(){this.visible&&super.onDidChangeRecentlyOpened()}onUpdateKeybindings(){this.visible&&super.onUpdateKeybindings()}registerListeners(){super.registerListeners(),this._register(re(zi,pe.RESIZE,()=>{this.menubar&&!(kE&&Hwe.pointerEvents)&&this.menubar.blur()})),Kt&&(this._register(Uwe(e=>{e===zi.vscodeWindowId&&this.updateMenubar()})),this._register(this.webNavigationMenu.onDidChange(()=>this.updateMenubar())),this._register(Uqe().event(()=>this.menubar?.toggleFocus())))}get onVisibilityChange(){return this._onVisibilityChange.event}get onFocusStateChange(){return this._onFocusStateChange.event}getMenubarItemsDimensions(){return this.menubar?new Ye(this.menubar.getWidth(),this.menubar.getHeight()):new Ye(0,0)}create(e){return this.container=e,this.container&&this.doUpdateMenubar(!0),this.container}layout(e){this.menubar?.update(this.getMenuBarOptions())}toggleFocus(){this.menubar?.toggleFocus()}};lz=f([p(0,fn),p(1,Nh),p(2,fe),p(3,He),p(4,ne),p(5,ui),p(6,ore),p(7,it),p(8,Dt),p(9,Hv),p(10,wn),p(11,Nr),p(12,ai),p(13,Hn),p(14,Ge)],lz);class $qe{constructor(e,t,i,n,o,r){this.viewDescriptorService=e,this.targetContainerLocation=t,this.orientation=i,this.openComposite=n,this.moveComposite=o,this.getItems=r}drop(e,t,i,n){const o=e.getData();if(o.type==="composite"){const r=this.viewDescriptorService.getViewContainerById(o.id),a=this.viewDescriptorService.getViewContainerLocation(r);let c=!1;a===this.targetContainerLocation?t&&(this.moveComposite(o.id,t,n),c=!0):(this.viewDescriptorService.moveViewContainerToLocation(r,this.targetContainerLocation,this.getTargetIndex(t,n),"dnd"),c=!0),c&&this.openComposite(r.id,!0)}if(o.type==="view"){const r=this.viewDescriptorService.getViewDescriptorById(o.id);if(r&&r.canMoveView){this.viewDescriptorService.moveViewToLocation(r,this.targetContainerLocation,"dnd");const a=this.viewDescriptorService.getViewContainerByViewId(r.id);t&&this.moveComposite(a.id,t,n),this.openComposite(a.id,!0).then(c=>{c?.openView(r.id,!0)})}}}onDragEnter(e,t,i){return this.canDrop(e,t)}onDragOver(e,t,i){return this.canDrop(e,t)}getTargetIndex(e,t){if(!e)return;const i=this.getItems(),n=this.orientation===xa.HORIZONTAL?t?.horizontallyBefore:t?.verticallyBefore;return i.filter(o=>o.visible).findIndex(o=>o.id===e)+(n?0:1)}canDrop(e,t){const i=e.getData();if(i.type==="composite"){const n=this.viewDescriptorService.getViewContainerById(i.id);return this.viewDescriptorService.getViewContainerLocation(n)===this.targetContainerLocation?i.id!==t:!0}else{const n=this.viewDescriptorService.getViewDescriptorById(i.id);return!(!n||!n.canMoveView)}}}class Gqe{constructor(e,t,i,n,o){this.compositeBarContainer=e,this.actionBarContainer=t,this.compositeBarModel=i,this.dndHandler=n,this.orientation=o,this.insertDropBefore=void 0}onDragOver(e){const t=this.compositeBarModel.visibleItems;if(!t.length||e.eventData.target&&Hu(e.eventData.target,this.actionBarContainer)){this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!0);return}const i=this.insertAtFront(this.actionBarContainer,e.eventData),n=i?t[0]:t[t.length-1],o=this.dndHandler.onDragOver(e.dragAndDropData,n.id,e.eventData);GP(e.eventData.dataTransfer,"move",o),this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,o,i,!0)}onDragLeave(e){this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!1)}onDragEnd(e){this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!1)}onDrop(e){const t=this.compositeBarModel.visibleItems;let i;t.length&&(i=this.insertAtFront(this.actionBarContainer,e.eventData)?t[0].id:t[t.length-1].id),this.dndHandler.drop(e.dragAndDropData,i,e.eventData,this.insertDropBefore),this.insertDropBefore=this.updateFromDragging(this.compositeBarContainer,!1,!1,!1)}insertAtFront(e,t){const i=e.getBoundingClientRect(),n=t.clientX,o=t.clientY;switch(this.orientation){case xa.HORIZONTAL:return n<i.left;case xa.VERTICAL:return o<i.top}}updateFromDragging(e,t,i,n){if(e.classList.toggle("dragged-over",n),e.classList.toggle("dragged-over-head",t&&i),e.classList.toggle("dragged-over-tail",t&&!i),!!t)return{verticallyBefore:i,horizontallyBefore:i}}}let hz=class extends lf{constructor(e,t,i,n,o){super(),this.options=t,this.instantiationService=i,this.contextMenuService=n,this.viewDescriptorService=o,this._onDidChange=this._register(new M),this.onDidChange=this._onDidChange.event,this.model=new zqe(e,t),this.visibleComposites=[],this.compositeSizeInBar=new Map,this.computeSizes(this.model.visibleItems)}getCompositeBarItems(){return[...this.model.items]}setCompositeBarItems(e){this.model.setItems(e),this.updateCompositeSwitcher(!0)}getPinnedComposites(){return this.model.pinnedItems}getPinnedCompositeIds(){return this.getPinnedComposites().map(e=>e.id)}getVisibleComposites(){return this.model.visibleItems}create(e){const t=e.appendChild(j(".composite-bar"));this.compositeSwitcherBar=this._register(new Ar(t,{actionViewItemProvider:(n,o)=>{if(n instanceof Die)return this.compositeOverflowActionViewItem;const r=this.model.findItem(n.id);return r&&this.instantiationService.createInstance(cz,{...o,draggable:!0,colors:this.options.colors,icon:this.options.icon,hoverOptions:this.options.activityHoverOptions,compact:this.options.compact},n,r.pinnedAction,r.toggleBadgeAction,a=>this.options.getContextMenuActionsForComposite(a),()=>this.getContextMenuActions(),this.options.dndHandler,this)},orientation:this.options.orientation,ariaLabel:h(2865,"Active View Switcher"),ariaRole:"tablist",preventLoopNavigation:this.options.preventLoopNavigation,triggerKeys:{keyDown:!0}})),this._register(re(e,pe.CONTEXT_MENU,n=>this.showContextMenu(Et(e),n))),this._register(Dh.addTarget(e)),this._register(re(e,Yo.Contextmenu,n=>this.showContextMenu(Et(e),n)));const i=new Gqe(e,t,this.model,this.options.dndHandler,this.options.orientation);return this._register(Xd.INSTANCE.registerTarget(e,i)),t}focus(e){this.compositeSwitcherBar?.focus(e)}recomputeSizes(){this.computeSizes(this.model.visibleItems),this.updateCompositeSwitcher()}layout(e){this.dimension=e,!(e.height===0||e.width===0)&&(this.compositeSizeInBar.size===0&&this.computeSizes(this.model.visibleItems),this.updateCompositeSwitcher())}addComposite({id:e,name:t,order:i,requestedIndex:n}){this.model.add(e,t,i,n)&&(this.computeSizes([this.model.findItem(e)]),this.updateCompositeSwitcher())}removeComposite(e){this.isPinned(e)&&this.unpin(e),this.model.remove(e)&&this.updateCompositeSwitcher()}hideComposite(e){this.model.hide(e)&&(this.resetActiveComposite(e),this.updateCompositeSwitcher())}activateComposite(e){const t=this.model.activeItem;this.model.activate(e)&&(this.visibleComposites.indexOf(e)===-1||this.model.activeItem&&!this.model.activeItem.pinned||t&&!t.pinned)&&this.updateCompositeSwitcher()}deactivateComposite(e){const t=this.model.activeItem;this.model.deactivate()&&t&&!t.pinned&&this.updateCompositeSwitcher()}async pin(e,t){this.model.setPinned(e,!0)&&(this.updateCompositeSwitcher(),t&&(await this.options.openComposite(e),this.activateComposite(e)))}unpin(e){this.model.setPinned(e,!1)&&(this.updateCompositeSwitcher(),this.resetActiveComposite(e))}areBadgesEnabled(e){return this.viewDescriptorService.getViewContainerBadgeEnablementState(e)}toggleBadgeEnablement(e){this.viewDescriptorService.setViewContainerBadgeEnablementState(e,!this.areBadgesEnabled(e)),this.updateCompositeSwitcher();const t=this.model.findItem(e);t&&(t.activityAction.activities=t.activityAction.activities)}resetActiveComposite(e){const t=this.options.getDefaultCompositeId();if(!(!this.model.activeItem||this.model.activeItem.id!==e))if(this.deactivateComposite(e),t&&t!==e&&this.isPinned(t))this.options.openComposite(t,!0);else{const i=this.visibleComposites.find(n=>n!==e);i&&this.options.openComposite(i)}}isPinned(e){return this.model.findItem(e)?.pinned}move(e,t,i){if(i!==void 0){const n=this.model.items.findIndex(r=>r.id===e);let o=this.model.items.findIndex(r=>r.id===t);n>=0&&o>=0&&(!i&&n>o&&o++,i&&n<o&&o--,o<this.model.items.length&&o>=0&&o!==n&&this.model.move(this.model.items[n].id,this.model.items[o].id)&&setTimeout(()=>this.updateCompositeSwitcher(),0))}else this.model.move(e,t)&&setTimeout(()=>this.updateCompositeSwitcher(),0)}getAction(e){return this.model.findItem(e)?.activityAction}computeSizes(e){const t=this.options.compositeSize;if(t)e.forEach(i=>this.compositeSizeInBar.set(i.id,t));else{const i=this.compositeSwitcherBar;if(i&&this.dimension&&this.dimension.height!==0&&this.dimension.width!==0){const n=i.viewItems.length;i.push(e.map(o=>o.activityAction)),e.forEach((o,r)=>this.compositeSizeInBar.set(o.id,this.options.orientation===xa.VERTICAL?i.getHeight(n+r):i.getWidth(n+r))),e.forEach(()=>i.pull(i.viewItems.length-1))}}}updateCompositeSwitcher(e){const t=this.compositeSwitcherBar;if(!t||!this.dimension)return;let i=this.model.visibleItems.filter(d=>d.pinned||this.model.activeItem&&this.model.activeItem.id===d.id).map(d=>d.id),n=i.length;const o=i.length;let r=0;const a=this.options.orientation===xa.VERTICAL?this.dimension.height:this.dimension.width;for(let d=0;d<i.length;d++){const l=this.compositeSizeInBar.get(i[d]);if(r+l>a){n=d;break}r+=l}for(o>n&&(i=i.slice(0,n)),this.model.activeItem&&i.every(d=>!!this.model.activeItem&&d!==this.model.activeItem.id)&&(r+=this.compositeSizeInBar.get(this.model.activeItem.id),i.push(this.model.activeItem.id));r>a&&i.length;){const d=i.length>1?i.splice(i.length-2,1)[0]:i.pop();r-=this.compositeSizeInBar.get(d)}for(o>i.length&&(r+=this.options.overflowActionSize);r>a&&i.length;){const d=i.length>1&&i[i.length-1]===this.model.activeItem?.id?i.splice(i.length-2,1)[0]:i.pop();r-=this.compositeSizeInBar.get(d)}o===i.length&&this.compositeOverflowAction&&(t.pull(t.length()-1),this.compositeOverflowAction.dispose(),this.compositeOverflowAction=void 0,this.compositeOverflowActionViewItem?.dispose(),this.compositeOverflowActionViewItem=void 0);const c=[];this.visibleComposites.forEach((d,l)=>{i.includes(d)||c.push(l)}),c.reverse().forEach(d=>{t.pull(d),this.visibleComposites.splice(d,1)}),i.forEach((d,l)=>{const u=this.visibleComposites.indexOf(d);l!==u&&(u!==-1&&(t.pull(u),this.visibleComposites.splice(u,1)),t.push(this.model.findItem(d).activityAction,{label:!0,icon:this.options.icon,index:l}),this.visibleComposites.splice(l,0,d))}),o>i.length&&!this.compositeOverflowAction&&(this.compositeOverflowAction=this._register(this.instantiationService.createInstance(Die,()=>{this.compositeOverflowActionViewItem?.showMenu()})),this.compositeOverflowActionViewItem=this._register(this.instantiationService.createInstance(az,this.compositeOverflowAction,()=>this.getOverflowingComposites(),()=>this.model.activeItem?this.model.activeItem.id:void 0,d=>this.model.findItem(d)?.activity[0]?.badge,this.options.getOnCompositeClickAction,this.options.colors,this.options.activityHoverOptions)),t.push(this.compositeOverflowAction,{label:!1,icon:!0})),e||this._onDidChange.fire()}getOverflowingComposites(){let e=this.model.visibleItems.filter(t=>t.pinned).map(t=>t.id);return this.model.activeItem&&!this.model.activeItem.pinned&&e.push(this.model.activeItem.id),e=e.filter(t=>!this.visibleComposites.includes(t)),this.model.visibleItems.filter(t=>e.includes(t.id)).map(t=>({id:t.id,name:this.getAction(t.id)?.label||t.name}))}showContextMenu(e,t){Vi.stop(t,!0);const i=new bs(e,t);this.contextMenuService.showContextMenu({getAnchor:()=>i,getActions:()=>this.getContextMenuActions(t)})}getContextMenuActions(e){const t=this.model.visibleItems.map(({id:i,name:n,activityAction:o})=>{const r=this.isPinned(i);return Ri({id:i,label:this.getAction(i).label||n||i,checked:r,enabled:o.enabled&&(!r||this.getPinnedCompositeIds().length>1),run:()=>{this.isPinned(i)?this.unpin(i):this.pin(i,!0)}})});return this.options.fillExtraContextMenuActions(t,e),t}};hz=f([p(2,Z),p(3,bi),p(4,$s)],hz);class zqe{get items(){return this._items}constructor(e,t){this._items=[],this.options=t,this.setItems(e)}setItems(e){this._items=[],this._items=e.map(t=>this.createCompositeBarItem(t.id,t.name,t.order,t.pinned,t.visible))}get visibleItems(){return this.items.filter(e=>e.visible)}get pinnedItems(){return this.items.filter(e=>e.visible&&e.pinned)}createCompositeBarItem(e,t,i,n,o){const r=this.options;return{id:e,name:t,pinned:n,order:i,visible:o,activity:[],get activityAction(){return r.getActivityAction(e)},get pinnedAction(){return r.getCompositePinnedAction(e)},get toggleBadgeAction(){return r.getCompositeBadgeAction(e)}}}add(e,t,i,n){const o=this.findItem(e);if(o){let r=!1;return o.name=t,up(i)||(r=o.order!==i,o.order=i),o.visible||(o.visible=!0,r=!0),r}else{const r=this.createCompositeBarItem(e,t,i,!0,!0);if(up(n))if(up(i))this.items.push(r);else{let a=0;for(;a<this.items.length&&typeof this.items[a].order=="number"&&this.items[a].order<i;)a++;this.items.splice(a,0,r)}else{let a=0,c=n;for(;c>0&&a<this.items.length;)this.items[a++].visible&&c--;this.items.splice(a,0,r)}return!0}}remove(e){for(let t=0;t<this.items.length;t++)if(this.items[t].id===e)return this.items.splice(t,1),!0;return!1}hide(e){for(const t of this.items)if(t.id===e)return t.visible?(t.visible=!1,!0):!1;return!1}move(e,t){const i=this.findIndex(e),n=this.findIndex(t);if(i===-1||n===-1)return!1;const o=this.items.splice(i,1)[0];return this.items.splice(n,0,o),o.pinned=!0,!0}setPinned(e,t){for(const i of this.items)if(i.id===e)return i.pinned!==t?(i.pinned=t,!0):!1;return!1}activate(e){if(!this.activeItem||this.activeItem.id!==e){this.activeItem&&this.deactivate();for(const t of this.items)if(t.id===e)return this.activeItem=t,this.activeItem.activityAction.activate(),!0}return!1}deactivate(){return this.activeItem?(this.activeItem.activityAction.deactivate(),this.activeItem=void 0,!0):!1}findItem(e){return this.items.filter(t=>t.id===e)[0]}findIndex(e){for(let t=0;t<this.items.length;t++)if(this.items[t].id===e)return t;return-1}}var uz;let gz=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.options=e,this.part=t,this.paneCompositePart=i,this.instantiationService=n,this.storageService=o,this.extensionService=r,this.viewDescriptorService=a,this.viewService=c,this.contextKeyService=d,this.environmentService=l,this.layoutService=u,this.viewContainerDisposables=this._register(new ti),this.compositeActions=new Map,this.hasExtensionsRegistered=!1,this._cachedViewContainers=void 0,this.location=i.partId===ot.PANEL_PART?We.Panel:i.partId===ot.AUXILIARYBAR_PART?We.AuxiliaryBar:We.Sidebar,this.dndHandler=new $qe(this.viewDescriptorService,this.location,this.options.orientation,async(m,v)=>await this.paneCompositePart.openPaneComposite(m,v)??null,(m,v,_)=>this.compositeBar.move(m,v,this.options.orientation===xa.VERTICAL?_?.verticallyBefore:_?.horizontallyBefore),()=>this.compositeBar.getCompositeBarItems());const g=this.cachedViewContainers.map(m=>({id:m.id,name:m.name,visible:!this.shouldBeHidden(m.id,m),order:m.order,pinned:m.pinned}));this.compositeBar=this.createCompositeBar(g),this.onDidRegisterViewContainers(this.getViewContainers()),this.registerListeners()}createCompositeBar(e){return this._register(this.instantiationService.createInstance(hz,e,{icon:this.options.icon,compact:this.options.compact,orientation:this.options.orientation,activityHoverOptions:this.options.activityHoverOptions,preventLoopNavigation:this.options.preventLoopNavigation,openComposite:async(t,i)=>await this.paneCompositePart.openPaneComposite(t,!i)??null,getActivityAction:t=>this.getCompositeActions(t).activityAction,getCompositePinnedAction:t=>this.getCompositeActions(t).pinnedAction,getCompositeBadgeAction:t=>this.getCompositeActions(t).badgeAction,getOnCompositeClickAction:t=>this.getCompositeActions(t).activityAction,fillExtraContextMenuActions:(t,i)=>this.options.fillExtraContextMenuActions(t,i),getContextMenuActionsForComposite:t=>this.getContextMenuActionsForComposite(t),getDefaultCompositeId:()=>this.viewDescriptorService.getDefaultViewContainer(this.location)?.id,dndHandler:this.dndHandler,compositeSize:this.options.compositeSize,overflowActionSize:this.options.overflowActionSize,colors:t=>this.options.colors(t)}))}getContextMenuActionsForComposite(e){const t=[new os],i=this.viewDescriptorService.getViewContainerById(e),n=this.viewDescriptorService.getDefaultViewContainerLocation(i),o=this.viewDescriptorService.getViewContainerLocation(i),r=[];for(const a of[We.Sidebar,We.AuxiliaryBar,We.Panel])o!==a&&r.push(this.createMoveAction(i,a,n));if(t.push(new Eh("moveToMenu",h(3404,"Move To"),r)),n!==o)t.push(Ri({id:"resetLocationAction",label:h(3405,"Reset Location"),run:()=>{this.viewDescriptorService.moveViewContainerToLocation(i,n,void 0,"resetLocationAction"),this.viewService.openViewContainer(i.id,!0)}}));else{const a=this.viewDescriptorService.getViewContainerModel(i);if(a.allViewDescriptors.length===1){const c=a.allViewDescriptors[0],d=this.viewDescriptorService.getDefaultContainerById(c.id);d!==i&&t.push(Ri({id:"resetLocationAction",label:h(3405,"Reset Location"),run:()=>{this.viewDescriptorService.moveViewsToContainer([c],d,void 0,"resetLocationAction"),this.viewService.openViewContainer(i.id,!0)}}))}}return t}createMoveAction(e,t,i){return Ri({id:`moveViewContainerTo${t}`,label:t===We.Panel?h(3406,"Panel"):t===We.Sidebar?h(3407,"Primary Side Bar"):h(3408,"Secondary Side Bar"),run:()=>{let n;t!==i?n=this.viewDescriptorService.getViewContainersByLocation(t).length:n=void 0,this.viewDescriptorService.moveViewContainerToLocation(e,t,n),this.viewService.openViewContainer(e.id,!0)}})}registerListeners(){this._register(this.viewDescriptorService.onDidChangeViewContainers(({added:e,removed:t})=>this.onDidChangeViewContainers(e,t))),this._register(this.viewDescriptorService.onDidChangeContainerLocation(({viewContainer:e,from:t,to:i})=>this.onDidChangeViewContainerLocation(e,t,i))),this._register(this.paneCompositePart.onDidPaneCompositeOpen(e=>this.onDidChangeViewContainerVisibility(e.getId(),!0))),this._register(this.paneCompositePart.onDidPaneCompositeClose(e=>this.onDidChangeViewContainerVisibility(e.getId(),!1))),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this._store.isDisposed||(this.onDidRegisterExtensions(),this._register(this.compositeBar.onDidChange(()=>{this.updateCompositeBarItemsFromStorage(!0),this.saveCachedViewContainers()})),this._register(this.storageService.onDidChangeValue(he.PROFILE,this.options.pinnedViewContainersKey,this._store)(()=>this.updateCompositeBarItemsFromStorage(!1))))})}onDidChangeViewContainers(e,t){t.filter(({location:i})=>i===this.location).forEach(({container:i})=>this.onDidDeregisterViewContainer(i)),this.onDidRegisterViewContainers(e.filter(({location:i})=>i===this.location).map(({container:i})=>i))}onDidChangeViewContainerLocation(e,t,i){t===this.location&&this.onDidDeregisterViewContainer(e),i===this.location&&this.onDidRegisterViewContainers([e])}onDidChangeViewContainerVisibility(e,t){t?this.onDidViewContainerVisible(e):this.compositeBar.deactivateComposite(e)}onDidRegisterExtensions(){this.hasExtensionsRegistered=!0;for(const{id:e}of this.cachedViewContainers){const t=this.getViewContainer(e);t?this.showOrHideViewContainer(t):this.viewDescriptorService.isViewContainerRemovedPermanently(e)?this.removeComposite(e):this.hideComposite(e)}this.saveCachedViewContainers()}onDidViewContainerVisible(e){const t=this.getViewContainer(e);t&&(this.addComposite(t),this.compositeBar.activateComposite(t.id),this.shouldBeHidden(t)&&this.viewDescriptorService.getViewContainerModel(t).activeViewDescriptors.length===0&&this.hideComposite(t.id))}create(e){return this.compositeBar.create(e)}getCompositeActions(e){let t=this.compositeActions.get(e);if(!t){const i=this.getViewContainer(e);if(i){const n=this.viewDescriptorService.getViewContainerModel(i);t={activityAction:this._register(this.instantiationService.createInstance(kM,this.toCompositeBarActionItemFrom(n),this.part,this.paneCompositePart)),pinnedAction:this._register(new Ype(this.toCompositeBarActionItemFrom(n),this.compositeBar)),badgeAction:this._register(new Qpe(this.toCompositeBarActionItemFrom(n),this.compositeBar))}}else{const n=this.cachedViewContainers.filter(o=>o.id===e)[0];t={activityAction:this._register(this.instantiationService.createInstance(qqe,this.toCompositeBarActionItem(e,n?.name??e,n?.icon,void 0),this.part,this.paneCompositePart)),pinnedAction:this._register(new Rie(e,this.compositeBar)),badgeAction:this._register(new Kqe(e,this.compositeBar))}}this.compositeActions.set(e,t)}return t}onDidRegisterViewContainers(e){for(const t of e){this.addComposite(t),this.cachedViewContainers.filter(({id:a})=>a===t.id)[0]||this.compositeBar.pin(t.id),this.paneCompositePart.getActivePaneComposite()?.getId()===t.id&&this.compositeBar.activateComposite(t.id);const o=this.viewDescriptorService.getViewContainerModel(t);this.updateCompositeBarActionItem(t,o),this.showOrHideViewContainer(t);const r=new U;r.add(o.onDidChangeContainerInfo(()=>this.updateCompositeBarActionItem(t,o))),r.add(o.onDidChangeActiveViewDescriptors(()=>this.showOrHideViewContainer(t))),this.viewContainerDisposables.set(t.id,r)}}onDidDeregisterViewContainer(e){this.viewContainerDisposables.deleteAndDispose(e.id),this.removeComposite(e.id)}updateCompositeBarActionItem(e,t){const i=this.toCompositeBarActionItemFrom(t),{activityAction:n,pinnedAction:o}=this.getCompositeActions(e.id);n.updateCompositeBarActionItem(i),o instanceof Rie&&o.setActivity(i),this.options.recomputeSizes&&this.compositeBar.recomputeSizes(),this.saveCachedViewContainers()}toCompositeBarActionItemFrom(e){return this.toCompositeBarActionItem(e.viewContainer.id,e.title,e.icon,e.keybindingId)}toCompositeBarActionItem(e,t,i,n){let o,r;if(this.options.icon)if(R.isUri(i)){r=i;const a=hy(i),c=new Gwe;c.update(a);const d=`activity-${e.replace(/\./g,"-")}-${c.digest()}`,l=`.monaco-workbench .${this.options.partContainerClass} .monaco-action-bar .action-label.${d}`;o=[d,"uri-icon"],OM(l,`
				mask: ${a} no-repeat 50% 50%;
				mask-size: ${this.options.iconSize}px;
				-webkit-mask: ${a} no-repeat 50% 50%;
				-webkit-mask-size: ${this.options.iconSize}px;
				mask-origin: padding;
				-webkit-mask-origin: padding;
			`)}else ke.isThemeIcon(i)&&(o=ke.asClassNameArray(i));return{id:e,name:t,classNames:o,iconUrl:r,keybindingId:n}}showOrHideViewContainer(e){this.shouldBeHidden(e)?this.hideComposite(e.id):(this.addComposite(e),this.paneCompositePart.getActivePaneComposite()?.getId()===e.id&&this.compositeBar.activateComposite(e.id))}shouldBeHidden(e,t){const i=Tt(e)?this.getViewContainer(e):e,n=Tt(e)?e:e.id;if(i)if(i.hideIfEmpty){if(this.viewService.isViewContainerActive(n))return!1}else return!1;if(!this.hasExtensionsRegistered&&!(this.part===ot.SIDEBAR_PART&&this.environmentService.remoteAuthority&&ca)){if(t=t||this.cachedViewContainers.find(({id:o})=>o===n),!i&&t?.isBuiltin&&t?.visible)return!1;if(t?.views?.length)return t.views.every(({when:o})=>!!o&&!this.contextKeyService.contextMatchesRules(x.deserialize(o)))}return!0}addComposite(e){this.compositeBar.addComposite({id:e.id,name:typeof e.title=="string"?e.title:e.title.value,order:e.order,requestedIndex:e.requestedIndex})}hideComposite(e){this.compositeBar.hideComposite(e);const t=this.compositeActions.get(e);t&&(t.activityAction.dispose(),t.pinnedAction.dispose(),this.compositeActions.delete(e))}removeComposite(e){this.compositeBar.removeComposite(e);const t=this.compositeActions.get(e);t&&(t.activityAction.dispose(),t.pinnedAction.dispose(),this.compositeActions.delete(e))}getPinnedPaneCompositeIds(){const e=this.compositeBar.getPinnedComposites().map(t=>t.id);return this.getViewContainers().filter(t=>this.compositeBar.isPinned(t.id)).sort((t,i)=>e.indexOf(t.id)-e.indexOf(i.id)).map(t=>t.id)}getVisiblePaneCompositeIds(){return this.compositeBar.getVisibleComposites().filter(e=>this.paneCompositePart.getActivePaneComposite()?.getId()===e.id||this.compositeBar.isPinned(e.id)).map(e=>e.id)}getPaneCompositeIds(){return this.compositeBar.getVisibleComposites().map(e=>e.id)}getContextMenuActions(){return this.compositeBar.getContextMenuActions()}focus(e){this.compositeBar.focus(e)}layout(e,t){this.compositeBar.layout(new Ye(e,t))}getViewContainer(e){const t=this.viewDescriptorService.getViewContainerById(e);return t&&this.viewDescriptorService.getViewContainerLocation(t)===this.location?t:void 0}getViewContainers(){return this.viewDescriptorService.getViewContainersByLocation(this.location)}updateCompositeBarItemsFromStorage(e){if(this.pinnedViewContainersValue===this.getStoredPinnedViewContainersValue())return;this._placeholderViewContainersValue=void 0,this._pinnedViewContainersValue=void 0,this._cachedViewContainers=void 0;const t=[],i=this.compositeBar.getCompositeBarItems();for(const n of this.cachedViewContainers)t.push({id:n.id,name:n.name,order:n.order,pinned:n.pinned,visible:n.visible&&!!this.getViewContainer(n.id)});for(const n of this.getViewContainers())if(!t.some(({id:o})=>o===n.id)){const o=i.findIndex(({id:r})=>r===n.id);if(o!==-1){const r=i[o];t.splice(o,0,{id:n.id,name:typeof n.title=="string"?n.title:n.title.value,order:r.order,pinned:r.pinned,visible:r.visible})}else t.push({id:n.id,name:typeof n.title=="string"?n.title:n.title.value,order:n.order,pinned:!0,visible:!this.shouldBeHidden(n)})}if(e)for(const n of i)t.find(({id:r})=>r===n.id)||t.push(n);this.compositeBar.setCompositeBarItems(t)}saveCachedViewContainers(){const e=[],t=this.compositeBar.getCompositeBarItems();for(const i of t){const n=this.getViewContainer(i.id);if(n){const o=this.viewDescriptorService.getViewContainerModel(n),r=[];for(const{when:a}of o.allViewDescriptors)r.push({when:a?a.serialize():void 0});e.push({id:i.id,name:o.title,icon:R.isUri(o.icon)&&this.environmentService.remoteAuthority?void 0:o.icon,views:r,pinned:i.pinned,order:i.order,visible:i.visible,isBuiltin:!n.extensionId})}else e.push({id:i.id,name:i.name,pinned:i.pinned,order:i.order,visible:!1,isBuiltin:!1})}this.storeCachedViewContainersState(e)}get cachedViewContainers(){if(this._cachedViewContainers===void 0){this._cachedViewContainers=this.getPinnedViewContainers();for(const e of this.getPlaceholderViewContainers()){const t=this._cachedViewContainers.find(i=>i.id===e.id);t&&(t.visible=e.visible??t.visible,t.name=e.name,t.icon=e.themeIcon?e.themeIcon:e.iconUrl?R.revive(e.iconUrl):void 0,R.isUri(t.icon)&&this.environmentService.remoteAuthority&&(t.icon=void 0),t.views=e.views,t.isBuiltin=e.isBuiltin)}for(const e of this.getViewContainersWorkspaceState()){const t=this._cachedViewContainers.find(i=>i.id===e.id);t&&(t.visible=e.visible??t.visible)}}return this._cachedViewContainers}storeCachedViewContainersState(e){const t=this.getPinnedViewContainers();this.setPinnedViewContainers(e.map(({id:i,pinned:n,order:o})=>({id:i,pinned:n,visible:!!t.find(({id:r})=>r===i)?.visible,order:o}))),this.setPlaceholderViewContainers(e.map(({id:i,icon:n,name:o,views:r,isBuiltin:a})=>({id:i,iconUrl:R.isUri(n)?n:void 0,themeIcon:ke.isThemeIcon(n)?n:void 0,name:o,isBuiltin:a,views:r}))),this.setViewContainersWorkspaceState(e.map(({id:i,visible:n})=>({id:i,visible:n})))}getPinnedViewContainers(){return JSON.parse(this.pinnedViewContainersValue)}setPinnedViewContainers(e){this.pinnedViewContainersValue=JSON.stringify(e)}get pinnedViewContainersValue(){return this._pinnedViewContainersValue||(this._pinnedViewContainersValue=this.getStoredPinnedViewContainersValue()),this._pinnedViewContainersValue}set pinnedViewContainersValue(e){this.pinnedViewContainersValue!==e&&(this._pinnedViewContainersValue=e,this.setStoredPinnedViewContainersValue(e))}getStoredPinnedViewContainersValue(){return this.storageService.get(this.options.pinnedViewContainersKey,he.PROFILE,"[]")}setStoredPinnedViewContainersValue(e){this.storageService.store(this.options.pinnedViewContainersKey,e,he.PROFILE,gt.USER)}getPlaceholderViewContainers(){return JSON.parse(this.placeholderViewContainersValue)}setPlaceholderViewContainers(e){this.placeholderViewContainersValue=JSON.stringify(e)}get placeholderViewContainersValue(){return this._placeholderViewContainersValue||(this._placeholderViewContainersValue=this.getStoredPlaceholderViewContainersValue()),this._placeholderViewContainersValue}set placeholderViewContainersValue(e){this.placeholderViewContainersValue!==e&&(this._placeholderViewContainersValue=e,this.setStoredPlaceholderViewContainersValue(e))}getStoredPlaceholderViewContainersValue(){return this.storageService.get(this.options.placeholderViewContainersKey,he.PROFILE,"[]")}setStoredPlaceholderViewContainersValue(e){this.storageService.store(this.options.placeholderViewContainersKey,e,he.PROFILE,gt.MACHINE)}getViewContainersWorkspaceState(){return JSON.parse(this.viewContainersWorkspaceStateValue)}setViewContainersWorkspaceState(e){this.viewContainersWorkspaceStateValue=JSON.stringify(e)}get viewContainersWorkspaceStateValue(){return this._viewContainersWorkspaceStateValue||(this._viewContainersWorkspaceStateValue=this.getStoredViewContainersWorkspaceStateValue()),this._viewContainersWorkspaceStateValue}set viewContainersWorkspaceStateValue(e){this.viewContainersWorkspaceStateValue!==e&&(this._viewContainersWorkspaceStateValue=e,this.setStoredViewContainersWorkspaceStateValue(e))}getStoredViewContainersWorkspaceStateValue(){return this.storageService.get(this.options.viewContainersWorkspaceStateKey,he.WORKSPACE,"[]")}setStoredViewContainersWorkspaceStateValue(e){this.storageService.store(this.options.viewContainersWorkspaceStateKey,e,he.WORKSPACE,gt.MACHINE)}};gz=f([p(3,Z),p(4,it),p(5,cn),p(6,$s),p(7,io),p(8,fe),p(9,wn),p(10,yi)],gz);let kM=class extends gw{static{uz=this}static{this.preventDoubleClickDelay=300}constructor(e,t,i,n,o,r){super(e),this.part=t,this.paneCompositePart=i,this.layoutService=n,this.configurationService=o,this.activityService=r,this.lastRun=0,this.updateActivity(),this._register(this.activityService.onDidChangeActivity(a=>{!Tt(a)&&a.id===this.compositeBarActionItem.id&&this.updateActivity()}))}updateCompositeBarActionItem(e){this.compositeBarActionItem=e}updateActivity(){this.activities=this.activityService.getViewContainerActivities(this.compositeBarActionItem.id)}async run(e){if(op(e)&&e.button===2)return;const t=Date.now();if(t>this.lastRun&&t-this.lastRun<uz.preventDoubleClickDelay)return;this.lastRun=t;const i=e&&"preserveFocus"in e?!e.preserveFocus:!0;if(this.part===ot.ACTIVITYBAR_PART){const n=this.layoutService.isVisible(ot.SIDEBAR_PART),o=this.paneCompositePart.getActivePaneComposite(),r=this.configurationService.getValue("workbench.activityBar.iconClickBehavior");if(n&&o?.getId()===this.compositeBarActionItem.id){switch(r){case"focus":this.paneCompositePart.openPaneComposite(this.compositeBarActionItem.id,i);break;case"toggle":default:this.layoutService.setPartHidden(!0,ot.SIDEBAR_PART);break}return}}return await this.paneCompositePart.openPaneComposite(this.compositeBarActionItem.id,i),this.activate()}};kM=uz=f([p(3,yi),p(4,ne),p(5,qv)],kM);class qqe extends kM{}class Rie extends Ype{constructor(e,t){super({id:e,name:e,classNames:void 0},t)}setActivity(e){this.label=e.name}}class Kqe extends Qpe{constructor(e,t){super({id:e,name:e,classNames:void 0},t)}setCompositeBarActionItem(e){this.label=e.name}}const bF=Pe("settings-view-bar-icon",K.settingsGear,h(12855,"Settings icon in the view bar."));var lC;let TM=class extends F{static{lC=this}static{this.ACCOUNTS_ACTION_INDEX=0}static{this.ACCOUNTS_ICON=Pe("accounts-view-bar-icon",K.account,h(3330,"Accounts icon in the view bar."))}constructor(e,t,i,n,o,r,a){super(),this.contextMenuActionsProvider=e,this.colors=t,this.activityHoverOptions=i,this.instantiationService=o,this.storageService=r,this.extensionService=a,this.globalActivityAction=this._register(new Xt(hP)),this.accountAction=this._register(new Xt(uP)),this.element=j("div");const c=()=>({anchorAlignment:n.getValue("workbench.sideBar.location")==="left"?Pb.RIGHT:Pb.LEFT,anchorAxisAlignment:zwe.HORIZONTAL});this.globalActivityActionBar=this._register(new Ar(this.element,{actionViewItemProvider:(d,l)=>{if(d.id===hP)return this.instantiationService.createInstance(RM,this.contextMenuActionsProvider,{...l,colors:this.colors,hoverOptions:this.activityHoverOptions},c);if(d.id===uP)return this.instantiationService.createInstance(Av,this.contextMenuActionsProvider,{...l,colors:this.colors,hoverOptions:this.activityHoverOptions},c,u=>{u.unshift(Ri({id:"hideAccounts",label:h(3331,"Hide Accounts"),run:()=>PM(r,!1)}),new os)});throw new Error(`No view item for action '${d.id}'`)},orientation:xa.VERTICAL,ariaLabel:h(3332,"Manage"),preventLoopNavigation:!0})),this.accountsVisibilityPreference&&this.globalActivityActionBar.push(this.accountAction,{index:lC.ACCOUNTS_ACTION_INDEX}),this.globalActivityActionBar.push(this.globalActivityAction),this.registerListeners()}registerListeners(){this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this._store.isDisposed||this._register(this.storageService.onDidChangeValue(he.PROFILE,Av.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,this._store)(()=>this.toggleAccountsActivity()))})}create(e){e.appendChild(this.element)}focus(){this.globalActivityActionBar.focus(!0)}size(){return this.globalActivityActionBar.viewItems.length}getContextMenuActions(){return[Ri({id:"toggleAccountsVisibility",label:h(3333,"Accounts"),checked:this.accountsVisibilityPreference,run:()=>this.accountsVisibilityPreference=!this.accountsVisibilityPreference})]}toggleAccountsActivity(){this.globalActivityActionBar.length()===2&&this.accountsVisibilityPreference||(this.globalActivityActionBar.length()===2?this.globalActivityActionBar.pull(lC.ACCOUNTS_ACTION_INDEX):this.globalActivityActionBar.push(this.accountAction,{index:lC.ACCOUNTS_ACTION_INDEX}))}get accountsVisibilityPreference(){return pz(this.storageService)}set accountsVisibilityPreference(e){PM(this.storageService,e)}};TM=lC=f([p(3,ne),p(4,Z),p(5,it),p(6,cn)],TM);let AM=class extends Qx{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m){super(t,{draggable:!1,icon:!0,hasPopup:!0,...i},()=>!0,r,a,u,g),this.menuId=e,this.contextMenuActionsProvider=n,this.contextMenuAlignmentOptions=o,this.menuService=c,this.contextMenuService=d,this.contextKeyService=l,this.activityService=m,this.updateItemActivity(),this._register(this.activityService.onDidChangeActivity(v=>{Tt(v)&&v===this.compositeBarActionItem.id&&this.updateItemActivity()}))}updateItemActivity(){this.action.activities=this.activityService.getActivity(this.compositeBarActionItem.id)}render(e){super.render(e),this._register(re(this.container,pe.MOUSE_DOWN,async t=>{Vi.stop(t,!0),t?.button!==2&&this.run()})),this._register(re(this.container,pe.CONTEXT_MENU,async t=>{t.stopPropagation();const i=new U,n=await this.resolveContextMenuActions(i),o=new bs(Et(this.container),t);this.contextMenuService.showContextMenu({getAnchor:()=>o,getActions:()=>n,onHide:()=>i.dispose()})})),this._register(re(this.container,pe.KEY_UP,t=>{const i=new vo(t);(i.equals(S.Enter)||i.equals(S.Space))&&(Vi.stop(t,!0),this.run())})),this._register(re(this.container,Yo.Tap,t=>{Vi.stop(t,!0),this.run()}))}async resolveContextMenuActions(e){return this.contextMenuActionsProvider()}async run(){const e=new U,t=e.add(this.menuService.createMenu(this.menuId,this.contextKeyService)),i=await this.resolveMainMenuActions(t,e),{anchorAlignment:n,anchorAxisAlignment:o}=this.contextMenuAlignmentOptions()??{anchorAlignment:void 0,anchorAxisAlignment:void 0};this.contextMenuService.showContextMenu({getAnchor:()=>this.label,anchorAlignment:n,anchorAxisAlignment:o,getActions:()=>i,onHide:()=>e.dispose(),menuActionOptions:{renderShortTitle:!0}})}async resolveMainMenuActions(e,t){return Xm(e.getActions({renderShortTitle:!0})).secondary}};AM=f([p(5,pt),p(6,Ti),p(7,fn),p(8,bi),p(9,fe),p(10,ne),p(11,He),p(12,qv)],AM);let Av=class extends AM{static{this.ACCOUNTS_VISIBILITY_PREFERENCE_KEY="workbench.activity.showAccounts"}constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D,A){const B=D.createInstance(gw,{id:uP,name:h(3333,"Accounts"),classNames:ke.asClassNameArray(TM.ACCOUNTS_ICON)});super(N.AccountsContext,B,t,e,i,o,a,d,c,l,v,_,k),this.fillContextMenuActions=n,this.lifecycleService=r,this.authenticationService=u,this.productService=m,this.secretStorageService=w,this.logService=C,this.commandService=A,this.groupedAccounts=new Map,this.problematicProviders=new Set,this.initialized=!1,this.sessionFromEmbedder=new Ih(()=>tHe(this.secretStorageService,this.productService)),this._register(B),this.registerListeners(),this.initialize()}registerListeners(){this._register(this.authenticationService.onDidRegisterAuthenticationProvider(async e=>{await this.addAccountsFromProvider(e.id)})),this._register(this.authenticationService.onDidUnregisterAuthenticationProvider(e=>{this.groupedAccounts.delete(e.id),this.problematicProviders.delete(e.id)})),this._register(this.authenticationService.onDidChangeSessions(async e=>{if(e.event.removed)for(const t of e.event.removed)this.removeAccount(e.providerId,t.account);for(const t of[...e.event.changed??[],...e.event.added??[]])try{await this.addOrUpdateAccount(e.providerId,t.account)}catch(i){this.logService.error(i)}}))}async initialize(){if(await this.lifecycleService.when(mc.Restored),this._store.isDisposed)return;const e=this._register(Uie(Et(this.element),async()=>{await this.doInitialize(),e.dispose()}))}async doInitialize(){const e=this.authenticationService.getProviderIds(),t=await Promise.allSettled(e.map(i=>this.addAccountsFromProvider(i)));for(const i of t)i.status==="rejected"&&this.logService.error(i.reason);this.initialized=!0}async resolveMainMenuActions(e,t){await super.resolveMainMenuActions(e,t);const i=this.authenticationService.getProviderIds(),n=e.getActions();let o=[];for(const r of i){if(!this.initialized){const d=t.add(new Xt("noAccountsAvailable",h(3334,"Loading..."),void 0,!1));o.push(d);break}const a=this.authenticationService.getProvider(r).label,c=this.groupedAccounts.get(r);if(!c){if(this.problematicProviders.has(r)){const d=t.add(new Xt("providerUnavailable",h(3335,"{0} is currently unavailable",a),void 0,!1));o.push(d);try{await this.addAccountsFromProvider(r)}catch(l){this.logService.error(l)}}continue}for(const d of c){const u=[Ri({id:`configureSessions${d.label}`,label:h(3336,"Manage Trusted Extensions"),enabled:!0,run:()=>this.commandService.executeCommand("_manageTrustedExtensionsForAccount",{providerId:r,accountLabel:d.label})})];d.canSignOut&&u.push(Ri({id:"signOut",label:h(3337,"Sign Out"),enabled:!0,run:()=>this.commandService.executeCommand("_signOutOfAccount",{providerId:r,accountLabel:d.label})}));const g=new Eh("activitybar.submenu",`${d.label} (${a})`,u);o.push(g)}}return o.length&&n.length&&o.push(new os),n.forEach((r,a)=>{const c=r[1];o=o.concat(c),a!==n.length-1&&o.push(new os)}),o}async resolveContextMenuActions(e){const t=await super.resolveContextMenuActions(e);return this.fillContextMenuActions(t),t}async addOrUpdateAccount(e,t){let i=this.groupedAccounts.get(e);i||(i=[],this.groupedAccounts.set(e,i));const n=await this.sessionFromEmbedder.value;let o=!0;n&&!n.canSignOut&&(await this.authenticationService.getSessions(e)).some(a=>a.id===n.id&&a.account.id===t.id)&&(o=!1);const r=i.find(a=>a.label===t.label);r?o||(r.canSignOut=o):i.push({...t,canSignOut:o})}removeAccount(e,t){const i=this.groupedAccounts.get(e);if(!i)return;const n=i.findIndex(o=>o.id===t.id);n!==-1&&(i.splice(n,1),i.length===0&&this.groupedAccounts.delete(e))}async addAccountsFromProvider(e){try{const t=await this.authenticationService.getSessions(e);this.problematicProviders.delete(e);for(const i of t)try{await this.addOrUpdateAccount(e,i.account)}catch(n){this.logService.error(n)}}catch(t){this.logService.error(t),this.problematicProviders.add(e)}}};Av=f([p(4,pt),p(5,wd),p(6,Ti),p(7,bi),p(8,fn),p(9,fe),p(10,Pw),p(11,wn),p(12,Vn),p(13,ne),p(14,He),p(15,kN),p(16,Re),p(17,qv),p(18,Z),p(19,Ge)],Av);let RM=class extends AM{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){const _=m.createInstance(gw,{id:hP,name:h(3332,"Manage"),classNames:ke.asClassNameArray(n.currentProfile.icon?ke.fromId(n.currentProfile.icon):bF)});super(N.GlobalActivity,_,t,e,i,o,r,a,c,d,l,g,v),this.userDataProfileService=n,this._register(_),this._register(this.userDataProfileService.onDidChangeCurrentProfile(w=>{_.compositeBarActionItem={..._.compositeBarActionItem,classNames:ke.asClassNameArray(n.currentProfile.icon?ke.fromId(n.currentProfile.icon):bF)}}))}render(e){super.render(e),this.profileBadge=ee(e,j(".profile-badge")),this.profileBadgeContent=ee(this.profileBadge,j(".profile-badge-content")),this.updateProfileBadge()}updateProfileBadge(){!this.profileBadge||!this.profileBadgeContent||(Xi(this.profileBadgeContent),Qs(this.profileBadge),!this.userDataProfileService.currentProfile.isDefault&&(this.userDataProfileService.currentProfile.icon&&this.userDataProfileService.currentProfile.icon!==bF.id||this.action.activities.length>0||(Qo(this.profileBadge),this.profileBadgeContent.classList.add("profile-text-overlay"),this.profileBadgeContent.textContent=this.userDataProfileService.currentProfile.name.substring(0,2).toUpperCase())))}updateActivity(){super.updateActivity(),this.updateProfileBadge()}computeTitle(){return this.userDataProfileService.currentProfile.isDefault?super.computeTitle():h(3338,"Manage {0} (Profile)",this.userDataProfileService.currentProfile.name)}};RM=f([p(3,Mh),p(4,pt),p(5,Ti),p(6,fn),p(7,bi),p(8,fe),p(9,ne),p(10,wn),p(11,He),p(12,Z),p(13,qv)],RM);let Pie=class extends Av{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v,_,w,C,k,D){super(()=>lfe(_,!0),{...t,colors:A=>({badgeBackground:A.getColor(Iw),badgeForeground:A.getColor(Dw)}),hoverOptions:e,compact:!0},()=>{},A=>A,i,n,o,r,a,c,d,l,u,g,m,v,w,C,k,D)}};Pie=f([p(2,pt),p(3,wd),p(4,Ti),p(5,bi),p(6,fn),p(7,fe),p(8,Pw),p(9,wn),p(10,Vn),p(11,ne),p(12,He),p(13,kN),p(14,it),p(15,Re),p(16,qv),p(17,Z),p(18,Ge)],Pie);let Lie=class extends RM{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super(()=>lfe(v,!1),{...t,colors:_=>({badgeBackground:_.getColor(Iw),badgeForeground:_.getColor(Dw)}),hoverOptions:e,compact:!0},()=>{},i,n,o,r,a,c,d,l,u,g,m)}};Lie=f([p(2,Mh),p(3,pt),p(4,Ti),p(5,fn),p(6,bi),p(7,fe),p(8,ne),p(9,wn),p(10,He),p(11,Z),p(12,qv),p(13,it)],Lie);function lfe(s,e){const t=[];return e&&t.push(Ri({id:"hideAccounts",label:h(3331,"Hide Accounts"),run:()=>PM(s,!1)}),new os),[...t,Ri({id:"toggle.hideAccounts",label:h(3333,"Accounts"),checked:pz(s),run:()=>PM(s,!pz(s))}),Ri({id:"toggle.hideManage",label:h(3332,"Manage"),checked:!0,enabled:!1,run:()=>{throw new Error('"Manage" can not be hidden')}})]}function pz(s){return s.getBoolean(Av.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,he.PROFILE,!0)}function PM(s,e){s.store(Av.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,e,he.PROFILE,gt.USER)}var U_;Ve(jze);Ve(Yze);let fz=class extends Kze{static{U_=this}static{this.ACTION_HEIGHT=48}static{this.pinnedViewContainersKey="workbench.activity.pinnedViewlets2"}static{this.placeholderViewContainersKey="workbench.activity.placeholderViewlets"}static{this.viewContainersWorkspaceStateKey="workbench.activity.viewletsWorkspaceState"}constructor(e,t,i,n,o){super(ot.ACTIVITYBAR_PART,{hasTitle:!1},n,o,i),this.paneCompositePart=e,this.instantiationService=t,this.minimumWidth=48,this.maximumWidth=48,this.minimumHeight=0,this.maximumHeight=Number.POSITIVE_INFINITY,this.compositeBar=this._register(new Pt)}createCompositeBar(){return this.instantiationService.createInstance(mz,{partContainerClass:"activitybar",pinnedViewContainersKey:U_.pinnedViewContainersKey,placeholderViewContainersKey:U_.placeholderViewContainersKey,viewContainersWorkspaceStateKey:U_.viewContainersWorkspaceStateKey,orientation:xa.VERTICAL,icon:!0,iconSize:24,activityHoverOptions:{position:()=>this.layoutService.getSideBarPosition()===oh.LEFT?PF.RIGHT:PF.LEFT},preventLoopNavigation:!0,recomputeSizes:!1,fillExtraContextMenuActions:(e,t)=>{},compositeSize:52,colors:e=>({activeForegroundColor:e.getColor(rv),inactiveForegroundColor:e.getColor(bxe),activeBorderColor:e.getColor(dre),activeBackground:e.getColor(lre),badgeBackground:e.getColor(Iw),badgeForeground:e.getColor(Dw),dragAndDropBorder:e.getColor(Sxe),activeBackgroundColor:void 0,inactiveBackgroundColor:void 0,activeBorderBottomColor:void 0}),overflowActionSize:U_.ACTION_HEIGHT},ot.ACTIVITYBAR_PART,this.paneCompositePart,!0)}createContentArea(e){return this.element=e,this.content=ee(this.element,j(".content")),this.layoutService.isVisible(ot.ACTIVITYBAR_PART)&&this.show(),this.content}getPinnedPaneCompositeIds(){return this.compositeBar.value?.getPinnedPaneCompositeIds()??[]}getVisiblePaneCompositeIds(){return this.compositeBar.value?.getVisiblePaneCompositeIds()??[]}getPaneCompositeIds(){return this.compositeBar.value?.getPaneCompositeIds()??[]}focus(){this.compositeBar.value?.focus()}updateStyles(){super.updateStyles();const e=jt(this.getContainer()),t=this.getColor(_xe)||"";e.style.backgroundColor=t;const i=this.getColor(yxe)||this.getColor(tt)||"";e.classList.toggle("bordered",!!i),e.style.borderColor=i||""}show(e){this.content&&(this.compositeBar.value||(this.compositeBar.value=this.createCompositeBar(),this.compositeBar.value.create(this.content),this.dimension&&this.layout(this.dimension.width,this.dimension.height)),e&&this.focus())}hide(){this.compositeBar.value&&(this.compositeBar.clear(),this.content&&Xi(this.content))}layout(e,t){if(super.layout(e,t,0,0),!this.compositeBar.value)return;const i=super.layoutContents(e,t).contentSize;this.compositeBar.value.layout(e,i.height)}toJSON(){return{type:ot.ACTIVITYBAR_PART}}};fz=U_=f([p(1,Z),p(2,yi),p(3,pt),p(4,it)],fz);let mz=class extends gz{constructor(e,t,i,n,o,r,a,c,d,l,u,g,m,v){super({...e,fillExtraContextMenuActions:(_,w)=>{e.fillExtraContextMenuActions(_,w),this.fillContextMenuActions(_,w)}},t,i,o,r,a,c,d,l,u,v),this.configurationService=g,this.menuService=m,this.keyboardNavigationDisposables=this._register(new U),n&&(this.globalCompositeBar=this._register(o.createInstance(TM,()=>this.getContextMenuActions(),_=>this.options.colors(_),this.options.activityHoverOptions))),this._register(this.configurationService.onDidChangeConfiguration(_=>{_.affectsConfiguration("window.menuBarVisibility")&&(Mb(this.configurationService)==="compact"?this.installMenubar():this.uninstallMenubar())}))}fillContextMenuActions(e,t){const i=Mb(this.configurationService);(i==="compact"||i==="hidden"||i==="toggle")&&e.unshift(Ri({id:"toggleMenuVisibility",label:h(2825,"Menu"),checked:i==="compact",run:()=>this.configurationService.updateValue("window.menuBarVisibility",i==="compact"?"toggle":"compact")}),new os),i==="compact"&&this.menuBarContainer&&t?.target&&Hu(t.target,this.menuBarContainer)&&e.unshift(Ri({id:"hideCompactMenu",label:h(2826,"Hide Menu"),run:()=>this.configurationService.updateValue("window.menuBarVisibility","toggle")}),new os),this.globalCompositeBar&&(e.push(new os),e.push(...this.globalCompositeBar.getContextMenuActions())),e.push(new os),e.push(...this.getActivityBarContextMenuActions())}uninstallMenubar(){this.menuBar&&(this.menuBar.dispose(),this.menuBar=void 0),this.menuBarContainer&&(this.menuBarContainer.remove(),this.menuBarContainer=void 0)}installMenubar(){if(this.menuBar)return;this.menuBarContainer=j(".menubar"),jt(this.element).prepend(this.menuBarContainer),this.menuBar=this._register(this.instantiationService.createInstance(lz)),this.menuBar.create(this.menuBarContainer)}registerKeyboardNavigationListeners(){this.keyboardNavigationDisposables.clear(),this.menuBarContainer&&this.keyboardNavigationDisposables.add(re(this.menuBarContainer,pe.KEY_DOWN,e=>{const t=new vo(e);(t.equals(S.DownArrow)||t.equals(S.RightArrow))&&this.focus()})),this.compositeBarContainer&&this.keyboardNavigationDisposables.add(re(this.compositeBarContainer,pe.KEY_DOWN,e=>{const t=new vo(e);t.equals(S.DownArrow)||t.equals(S.RightArrow)?this.globalCompositeBar?.focus():(t.equals(S.UpArrow)||t.equals(S.LeftArrow))&&this.menuBar?.toggleFocus()})),this.globalCompositeBar&&this.keyboardNavigationDisposables.add(re(this.globalCompositeBar.element,pe.KEY_DOWN,e=>{const t=new vo(e);(t.equals(S.UpArrow)||t.equals(S.LeftArrow))&&this.focus(this.getVisiblePaneCompositeIds().length-1)}))}create(e){return this.element=e,Mb(this.configurationService)==="compact"&&this.installMenubar(),this.compositeBarContainer=super.create(this.element),this.globalCompositeBar&&this.globalCompositeBar.create(this.element),this.registerKeyboardNavigationListeners(),this.compositeBarContainer}layout(e,t){this.menuBarContainer&&(this.options.orientation===xa.VERTICAL?t-=this.menuBarContainer.clientHeight:e-=this.menuBarContainer.clientWidth),this.globalCompositeBar&&(this.options.orientation===xa.VERTICAL?t-=this.globalCompositeBar.size()*fz.ACTION_HEIGHT:e-=this.globalCompositeBar.element.clientWidth),super.layout(e,t)}getActivityBarContextMenuActions(){const e=this.menuService.getMenuActions(N.ActivityBarPositionMenu,this.contextKeyService,{shouldForwardArgs:!0,renderShortTitle:!0}),t=sse(e).secondary,i=[new Eh("workbench.action.panel.position",h(2827,"Activity Bar Position"),t),Ri({id:ed.ID,label:ed.getLabel(this.layoutService),run:()=>this.instantiationService.invokeFunction(n=>new ed().run(n))})];return this.part===ot.SIDEBAR_PART&&i.push(Ri({id:yh.ID,label:yh.LABEL,run:()=>this.instantiationService.invokeFunction(n=>new yh().run(n))})),i}};mz=f([p(4,Z),p(5,it),p(6,cn),p(7,$s),p(8,io),p(9,fe),p(10,wn),p(11,ne),p(12,fn),p(13,yi)],mz);Y(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.default",title:{...I(2828,"Move Activity Bar to Side"),mnemonicTitle:h(2829,"&&Default")},shortTitle:h(2830,"Default"),category:te.View,toggled:x.equals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.DEFAULT),menu:[{id:N.ActivityBarPositionMenu,order:1},{id:N.CommandPalette,when:x.notEquals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.DEFAULT)}]})}run(s){s.get(ne).updateValue(oi.ACTIVITY_BAR_LOCATION,er.DEFAULT)}});Y(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.top",title:{...I(2831,"Move Activity Bar to Top"),mnemonicTitle:h(2832,"&&Top")},shortTitle:h(2833,"Top"),category:te.View,toggled:x.equals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.TOP),menu:[{id:N.ActivityBarPositionMenu,order:2},{id:N.CommandPalette,when:x.notEquals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.TOP)}]})}run(s){s.get(ne).updateValue(oi.ACTIVITY_BAR_LOCATION,er.TOP)}});Y(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.bottom",title:{...I(2834,"Move Activity Bar to Bottom"),mnemonicTitle:h(2835,"&&Bottom")},shortTitle:h(2836,"Bottom"),category:te.View,toggled:x.equals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.BOTTOM),menu:[{id:N.ActivityBarPositionMenu,order:3},{id:N.CommandPalette,when:x.notEquals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.BOTTOM)}]})}run(s){s.get(ne).updateValue(oi.ACTIVITY_BAR_LOCATION,er.BOTTOM)}});Y(class extends X{constructor(){super({id:"workbench.action.activityBarLocation.hide",title:{...I(2837,"Hide Activity Bar"),mnemonicTitle:h(2838,"&&Hidden")},shortTitle:h(2839,"Hidden"),category:te.View,toggled:x.equals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.HIDDEN),menu:[{id:N.ActivityBarPositionMenu,order:4},{id:N.CommandPalette,when:x.notEquals(`config.${oi.ACTIVITY_BAR_LOCATION}`,er.HIDDEN)}]})}run(s){s.get(ne).updateValue(oi.ACTIVITY_BAR_LOCATION,er.HIDDEN)}});ge.appendMenuItem(N.MenubarAppearanceMenu,{submenu:N.ActivityBarPositionMenu,title:h(2840,"Activity Bar Position"),group:"3_workbench_layout_move",order:2});ge.appendMenuItem(N.ViewContainerTitleContext,{submenu:N.ActivityBarPositionMenu,title:h(2840,"Activity Bar Position"),when:x.or(x.equals("viewContainerLocation",Zc(We.Sidebar)),x.equals("viewContainerLocation",Zc(We.AuxiliaryBar))),group:"3_workbench_layout_move",order:1});Y(class extends _S{constructor(){super({id:"workbench.action.previousSideBarView",title:I(2841,"Previous Primary Side Bar View"),category:te.View,f1:!0},We.Sidebar,-1)}});Y(class extends _S{constructor(){super({id:"workbench.action.nextSideBarView",title:I(2842,"Next Primary Side Bar View"),category:te.View,f1:!0},We.Sidebar,1)}});Y(class extends X{constructor(){super({id:"workbench.action.focusActivityBar",title:I(2843,"Focus Activity Bar"),category:te.View,f1:!0})}async run(e){e.get(yi).focusPart(ot.ACTIVITYBAR_PART)}});Fv((s,e)=>{const t=s.getColor(dre);t&&e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .active-item-indicator:before {
				border-left-color: ${t};
			}
		`);const i=s.getColor(wxe);i&&e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:focus::before {
				visibility: hidden;
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:focus .active-item-indicator:before {
				visibility: visible;
				border-left-color: ${i};
			}
		`);const n=s.getColor(lre);n&&e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .active-item-indicator {
				z-index: 0;
				background-color: ${n};
			}
		`);const o=s.getColor(kr);if(o)e.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item .action-label::before{
				padding: 6px;
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.active .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.active:hover .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:hover .action-label::before {
				outline: 1px solid ${o};
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:hover .action-label::before {
				outline: 1px dashed ${o};
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:focus .active-item-indicator:before {
				border-left-color: ${o};
			}
		`);else{const r=s.getColor(PT);r&&e.addRule(`
				.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:focus .active-item-indicator::before {
						border-left-color: ${r};
					}
				`)}});class hfe extends F{constructor(e=qwe()){super(),this.mainContainer=e,this.setSize=b,this.onDidChangeMainEditorCenteredLayout=T.None,this.whenActiveContainerStylesLoaded=Promise.resolve(),this._onDidLayoutContainer=this._register(new M),this.onDidLayoutContainer=this._onDidLayoutContainer.event,this._onDidAddContainer=this._register(new M),this.onDidAddContainer=this._onDidAddContainer.event,this._onDidRemoveContainer=this._register(new M),this.onDidRemoveContainer=this._onDidRemoveContainer.event,this._onDidLayoutMainContainer=this._register(new M),this.onDidLayoutMainContainer=this._onDidLayoutMainContainer.event,this._onDidLayoutActiveContainer=this._register(new M),this.onDidLayoutActiveContainer=this._onDidLayoutActiveContainer.event,this._onDidChangeActiveContainer=this._register(new M),this.onDidChangeActiveContainer=this._onDidChangeActiveContainer.event,this.mainContainerOffset={top:0,quickPickTop:0},this.activeContainerOffset={top:0,quickPickTop:0},this.onDidChangeFullscreen=T.None,this.onDidChangeZenMode=T.None,this.onDidChangeWindowMaximized=T.None,this.onDidChangeCenteredLayout=T.None,this._onDidChangePanelPosition=this._register(new M),this.onDidChangePanelPosition=this._onDidChangePanelPosition.event,this._onDidChangeSideBarPosition=this._register(new M),this.onDidChangeSideBarPosition=this._onDidChangeSideBarPosition.event,this.onDidChangePanelAlignment=T.None,this.onDidChangeNotificationsVisibility=T.None,this.openedDefaultEditors=!1,this.whenRestored=Promise.resolve(),this.parts=new Map,this.hiddenParts=new Set,this._onDidChangePartVisibility=new M,this.onDidChangePartVisibility=this._onDidChangePartVisibility.event,this.offset={top:0,quickPickTop:0},this._onDidLayout=new M,this.onDidLayout=this._onDidLayout.event,window.addEventListener("resize",()=>this.layout()),this.layout();const i=$t(["monaco-workbench",bn?"windows":fh?"linux":"mac","web",Kwe?"chromium":jwe?"firefox":Ywe?"safari":void 0]);e.classList.add(...i)}getSize(e){return this.getPart(e)?.dimension??{height:0,width:0}}whenContainerStylesLoaded(){}hasMainWindowBorder(){return!1}getMainWindowBorderRadius(){}isMainEditorLayoutCentered(){return!1}centerMainEditorLayout(){}get activeContainer(){return this.getContainerFromDocument(qd())}get containers(){const e=[];for(const{window:t}of YF())e.push(this.getContainerFromDocument(t.document));return e}getContainerFromDocument(e){return e===this.mainContainer.ownerDocument?this.mainContainer:e.body.getElementsByClassName("monaco-workbench")[0]}init(e){this.editorGroupService=e.get(xe),this.paneCompositeService=e.get(da),this.statusBarService=e.get(AN),this.viewDescriptorService=e.get($s),this.configurationService=e.get(ne),this.auxiliaryWindowService=e.get(Yre),this.hostService=e.get(Hn),this._register(this.configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(oi.ACTIVITY_BAR_LOCATION)&&this.setPartHidden(this.isActivityBarHidden(),ot.ACTIVITYBAR_PART),t.affectsConfiguration("workbench.statusBar.visible")&&this.setPartHidden(!this.configurationService.getValue("workbench.statusBar.visible"),ot.STATUSBAR_PART),t.affectsConfiguration("workbench.sideBar.location")&&this.setSideBarPosition(GD(this.configurationService.getValue("workbench.sideBar.location")??"left")),t.affectsConfiguration("workbench.panel.defaultLocation")&&this.setPanelPosition(GD(this.configurationService.getValue("workbench.panel.defaultLocation")??"bottom"))})),this.setPartHidden(this.isActivityBarHidden(),ot.ACTIVITYBAR_PART),this.setPartHidden(!this.configurationService.getValue("workbench.statusBar.visible"),ot.STATUSBAR_PART),this.sideBarPosition=GD(this.configurationService.getValue("workbench.sideBar.location")??"left"),this.panelPosition=GD(this.configurationService.getValue("workbench.panel.defaultLocation")??"bottom"),this._register(this.hostService.onDidChangeActiveWindow(()=>this.onActiveWindowChanged())),this._register(this.auxiliaryWindowService.onDidOpenAuxiliaryWindow(({window:t,disposables:i})=>{this._onDidAddContainer.fire({container:t.container,disposables:new U}),i.add(t.onDidLayout(n=>this.handleContainerDidLayout(t.container,n))),i.add(Ie(()=>this._onDidRemoveContainer.fire(t.container)))}))}handleContainerDidLayout(e,t){e===this.mainContainer&&this._onDidLayoutMainContainer.fire(t),Qwe(e)&&this._onDidLayoutActiveContainer.fire(t)}getActiveContainerId(){const e=this.activeContainer;return Et(e).vscodeWindowId}onActiveWindowChanged(){const e=this.getActiveContainerId();this.activeContainerId!==e&&(this.activeContainerId=e,this._onDidChangeActiveContainer.fire())}isActivityBarHidden(){const e=this.configurationService.getValue("workbench.activityBar.visible");return e!==void 0?!e:this.configurationService.getValue(oi.ACTIVITY_BAR_LOCATION)!==er.DEFAULT}focusPart(e){switch(e){case ot.EDITOR_PART:this.editorGroupService.activeGroup.focus();break;case ot.PANEL_PART:{this.paneCompositeService.getActivePaneComposite(We.Panel)?.focus();break}case ot.SIDEBAR_PART:{this.paneCompositeService.getActivePaneComposite(We.Sidebar)?.focus();break}case ot.ACTIVITYBAR_PART:this.getPart(ot.ACTIVITYBAR_PART).focus();break;case ot.STATUSBAR_PART:this.statusBarService.focus();break;default:this.getContainer(e)?.focus()}}getDimension(e){return this.getPart(e)?.dimension}toggleMaximizedPanel(){}toggleMenuBar(){let e=Mb(this.configurationService);typeof e!="string"&&(e="classic");let t;e==="visible"||e==="classic"?t=Xwe(this.configurationService)==="native"?"toggle":"compact":t="classic",this.configurationService.updateValue("window.menuBarVisibility",t)}setPanelPosition(e){this.panelPosition=e,this.getPart(ot.PANEL_PART)?.updateStyles(),this._onDidChangePanelPosition.fire(fA(e))}getPanelAlignment(){return"left"}setPanelAlignment(){}toggleZenMode(){}isEditorLayoutCentered(){return!1}centerEditorLayout(){}resizePart(){}isWindowMaximized(){return!1}updateWindowMaximizedState(){}getVisibleNeighborPart(){}getMaximumEditorDimensions(){return new Ye(1/0,1/0)}isPanelMaximized(){return!1}getPanelPosition(){return this.panelPosition}hasFocus(e){const t=document.activeElement;if(t==null)return!1;const i=this.getContainer(e);return i!=null&&Zwe(t,i)}getContainer(e){return typeof e=="string"?this.parts.get(e)==null?void 0:this.getPart(e)?.getContainer():e.document===this.mainContainer.ownerDocument?this.mainContainer:e.document.body.getElementsByClassName("monaco-workbench")[0]}getPart(e){return this.parts.get(e)}hasViews(e){const t=this.viewDescriptorService.getViewContainerById(e);if(t==null)return!1;const i=this.viewDescriptorService.getViewContainerModel(t);return i==null?!1:i.activeViewDescriptors.length>=1}setPartHidden(e,t){e?this.hiddenParts.add(t):this.hiddenParts.delete(t),this._onDidChangePartVisibility.fire();const i={[ot.SIDEBAR_PART]:We.Sidebar,[ot.AUXILIARYBAR_PART]:We.AuxiliaryBar,[ot.PANEL_PART]:We.Panel}[t];if(i!=null){const n=this.paneCompositeService.getActivePaneComposite(i);if(n!=null&&e)this.paneCompositeService.hideActivePaneComposite(i);else if(n==null&&!e){let o=this.paneCompositeService.getLastActivePaneCompositeId(i);(o==null||!this.hasViews(o))&&(o=this.viewDescriptorService.getViewContainersByLocation(i).find(r=>this.hasViews(r.id))?.id),o!=null&&this.paneCompositeService.openPaneComposite(o,i,!0)}}this.getPart(t)?.setVisible(!e)}isVisible(e){return!this.hiddenParts.has(e)}getSideBarPosition(){return this.sideBarPosition}setSideBarPosition(e){this.sideBarPosition=e;const t=this.getPart(ot.ACTIVITYBAR_PART),i=this.getPart(ot.SIDEBAR_PART),n=this.getPart(ot.AUXILIARYBAR_PART);t?.updateStyles(),i?.updateStyles(),n?.updateStyles(),this._onDidChangeSideBarPosition.fire(fA(e))}registerPart(e){const t=e.getId();return this.parts.set(t,e),Ie(()=>this.parts.delete(t))}isRestored(){return!0}get mainContainerDimension(){return this._mainContainerDimension}get activeContainerDimension(){const e=this.activeContainer;return e===this.mainContainer?this.mainContainerDimension:qu(e)}layout(){this._mainContainerDimension=qu(window.document.body),this._onDidLayout.fire(this._mainContainerDimension)}get hasContainer(){return!0}focus(){const e=this.activeContainer;if(e===this.mainContainer){const t=Qa.get(Bt).getFocusedCodeEditor();t instanceof Zse?t.focus():this.focusPart(ot.EDITOR_PART)}else this.editorGroupService.getPart(e).activeGroup.focus()}}ECe(s=>{const e=s.get(af);e instanceof hfe&&e.init(s)});function jqe(s){return{[af.toString()]:new Sr(hfe,[s],!0)}}var Mc;(function(s){s[s.Unknown=1]="Unknown",s[s.Keyboard=2]="Keyboard",s[s.Api=3]="Api"})(Mc||(Mc={}));let cg=class extends F{constructor(e,t,i,n,o,r,a,c,d,l,u){super(),this.layoutService=e,this.configurationService=t,this.fileService=i,this.labelService=n,this.environmentService=o,this.instantiationService=r,this.lifecycleService=a,this.logService=c,this.dialogService=d,this.contextService=l,this.userDataProfilesService=u,this.shutdownReason=Mc.Unknown,o.options?.workspaceProvider?this.workspaceProvider=o.options.workspaceProvider:this.workspaceProvider=new class{constructor(){this.workspace=void 0,this.trusted=void 0}async open(){return!0}},this.registerListeners()}registerListeners(){this._register(this.lifecycleService.onBeforeShutdown(e=>this.onBeforeShutdown(e))),this._register(FT.getInstance().event(()=>this.updateShutdownReasonFromEvent()))}onBeforeShutdown(e){switch(this.shutdownReason){case Mc.Unknown:case Mc.Keyboard:{const t=this.configurationService.getValue("window.confirmBeforeClose");(t==="always"||t==="keyboardOnly"&&this.shutdownReason===Mc.Keyboard)&&e.veto(!0,"veto.confirmBeforeClose");break}}this.shutdownReason=Mc.Unknown}updateShutdownReasonFromEvent(){this.shutdownReason!==Mc.Api&&(FT.getInstance().isModifierPressed?this.shutdownReason=Mc.Keyboard:this.shutdownReason=Mc.Unknown)}get onDidChangeFocus(){const e=this._register(new M);return this._register(T.runAndSubscribe(km,({window:t,disposables:i})=>{const n=i.add(Fo(t)),o=i.add(new Ko(t.document,"visibilitychange"));T.any(T.map(n.onDidFocus,()=>this.hasFocus,i),T.map(n.onDidBlur,()=>this.hasFocus,i),T.map(o.event,()=>this.hasFocus,i),T.map(this.onDidChangeActiveWindow,()=>this.hasFocus,i))(r=>e.fire(r),void 0,i)},{window:zi,disposables:this._store})),T.latch(e.event,void 0,this._store)}get hasFocus(){return qd().hasFocus()}async hadLastFocus(){return!0}async focus(e){e.focus()}get onDidChangeActiveWindow(){const e=this._register(new M);return this._register(T.runAndSubscribe(km,({window:t,disposables:i})=>{const n=x8(t),o=i.add(Fo(t));i.add(o.onDidFocus(()=>e.fire(n))),Jwe(t)&&i.add(eSe(t,()=>{const r=t.document.hasFocus();return r&&e.fire(n),r},100,20))},{window:zi,disposables:this._store})),T.latch(e.event,void 0,this._store)}get onDidChangeFullScreen(){const e=this._register(new M);return this._register(T.runAndSubscribe(km,({window:t,disposables:i})=>{const n=x8(t),o=kE&&t.visualViewport?t.visualViewport:t,r=()=>{const a=sSe(t);return a!==null&&!a.guess};for(const a of[pe.FULLSCREEN_CHANGE,pe.WK_FULLSCREEN_CHANGE])i.add(re(t.document,a,()=>e.fire({windowId:n,fullscreen:r()})));i.add(tSe(o,pe.RESIZE,()=>e.fire({windowId:n,fullscreen:r()}),void 0,Yt?2e3:800))},{window:zi,disposables:this._store})),e.event}openWindow(e,t){return Array.isArray(e)?this.doOpenWindow(e,t):this.doOpenEmptyWindow(e)}async doOpenWindow(e,t){const i=this.preservePayload(!1,t),n=[],o=[],r=[];for(const a of e)a.label=a.label||this.getRecentLabel(a),r1(a)?t?.addMode?o.push({uri:a.folderUri}):t?.removeMode?r.push(a.folderUri):this.doOpen({folderUri:a.folderUri},{reuse:this.shouldReuse(t,!1),payload:i}):HF(a)?this.doOpen({workspaceUri:a.workspaceUri},{reuse:this.shouldReuse(t,!1),payload:i}):iSe(a)&&n.push(a);(o.length>0||r.length>0)&&this.withServices(async a=>{const c=a.get(uc);o.length>0&&await c.addFolders(o),r.length>0&&await c.removeFolders(r)}),n.length>0&&this.withServices(async a=>{const c=a.get(de);if(t?.mergeMode&&n.length===4){const l=$t(await l1(n,this.fileService,this.logService));if(l.length!==4||!Ql(l[0])||!Ql(l[1])||!Ql(l[2])||!Ql(l[3]))return;if(this.shouldReuse(t,!0))c.openEditor({input1:{resource:l[0].resource},input2:{resource:l[1].resource},base:{resource:l[2].resource},result:{resource:l[3].resource},options:{pinned:!0}});else{const u=new Map;u.set("mergeFile1",l[0].resource.toString()),u.set("mergeFile2",l[1].resource.toString()),u.set("mergeFileBase",l[2].resource.toString()),u.set("mergeFileResult",l[3].resource.toString()),this.doOpen(void 0,{payload:Array.from(u.entries())})}}else if(t?.diffMode&&n.length===2){const l=$t(await l1(n,this.fileService,this.logService));if(l.length!==2||!Ql(l[0])||!Ql(l[1]))return;if(this.shouldReuse(t,!0))c.openEditor({original:{resource:l[0].resource},modified:{resource:l[1].resource},options:{pinned:!0}});else{const u=new Map;u.set("diffFileSecondary",l[0].resource.toString()),u.set("diffFilePrimary",l[1].resource.toString()),this.doOpen(void 0,{payload:Array.from(u.entries())})}}else for(const l of n)if(this.shouldReuse(t,!0)){let u=[];if(t?.gotoLineMode){const g=Nse(l.fileUri.path);u=[{fileUri:l.fileUri.with({path:g.path}),options:{selection:Ym(g.line)?void 0:{startLineNumber:g.line,startColumn:g.column||1}}}]}else u=[l];c.openEditors($t(await l1(u,this.fileService,this.logService)),void 0,{validateTrust:!0})}else{const u=new Map;u.set("openFile",l.fileUri.toString()),t?.gotoLineMode&&u.set("gotoLineMode","true"),this.doOpen(void 0,{payload:Array.from(u.entries())})}const d=t?.waitMarkerFileURI;d&&(async()=>(await this.instantiationService.invokeFunction(l=>BNe(l,n.map(u=>u.fileUri))),await this.fileService.del(d)))()})}withServices(e){this.instantiationService.invokeFunction(t=>e(t))}preservePayload(e,t){const i=new Array;!e&&this.environmentService.extensionDevelopmentLocationURI&&(i.push(["extensionDevelopmentPath",this.environmentService.extensionDevelopmentLocationURI.toString()]),this.environmentService.debugExtensionHost.debugId&&i.push(["debugId",this.environmentService.debugExtensionHost.debugId]),this.environmentService.debugExtensionHost.port&&i.push(["inspect-brk-extensions",String(this.environmentService.debugExtensionHost.port)]));const n=t?.forceProfile?this.userDataProfilesService.profiles.find(o=>o.name===t?.forceProfile):void 0;return n&&!n.isDefault&&i.push(["profile",n.name]),i.length?i:void 0}getRecentLabel(e){return r1(e)?this.labelService.getWorkspaceLabel(e.folderUri,{verbose:ev.LONG}):HF(e)?this.labelService.getWorkspaceLabel(nSe(e.workspaceUri),{verbose:ev.LONG}):this.labelService.getUriLabel(e.fileUri,{appendWorkspaceSuffix:!0})}shouldReuse(e=Object.create(null),t){if(e.waitMarkerFileURI)return!0;const i=this.configurationService.getValue("window"),n=t?i?.openFilesInNewWindow||"off":i?.openFoldersInNewWindow||"default";let o=(e.preferNewWindow||!!e.forceNewWindow)&&!e.forceReuseWindow;return!e.forceNewWindow&&!e.forceReuseWindow&&(n==="on"||n==="off")&&(o=n==="on"),!o}async doOpenEmptyWindow(e){return this.doOpen(void 0,{reuse:e?.forceReuseWindow,payload:this.preservePayload(!0,e)})}async doOpen(e,t){if(e&&r1(e)&&e.folderUri.scheme===ae.file&&qM(this.contextService.getWorkspace())){this.withServices(async n=>{await n.get(uc).updateFolders(0,this.contextService.getWorkspace().folders.length,[{uri:e.folderUri}])});return}if(t?.reuse&&await this.handleExpectedShutdown(Ib.LOAD),!await this.workspaceProvider.open(e,t)){const{confirmed:n}=await this.dialogService.confirm({type:Fe.Warning,message:h(12408,"The browser interrupted the opening of a new tab or window. Press 'Open' to open it anyway."),primaryButton:h(12409,"&&Open")});n&&await this.workspaceProvider.open(e,t)}}async toggleFullScreen(e){const t=this.layoutService.getContainer(e);if(e.document.fullscreen!==void 0)if(e.document.fullscreen)try{return await e.document.exitFullscreen()}catch{this.logService.warn("toggleFullScreen(): exitFullscreen failed")}else try{return await t.requestFullscreen()}catch{this.logService.warn("toggleFullScreen(): requestFullscreen failed")}if(e.document.webkitIsFullScreen!==void 0)try{e.document.webkitIsFullScreen?e.document.webkitExitFullscreen():t.webkitRequestFullscreen()}catch{this.logService.warn("toggleFullScreen(): requestFullscreen/exitFullscreen failed")}}async moveTop(e){}async getCursorScreenPoint(){}async restart(){this.reload()}async reload(){await this.handleExpectedShutdown(Ib.RELOAD),zi.location.reload()}async close(){await this.handleExpectedShutdown(Ib.CLOSE),zi.close()}async withExpectedShutdown(e){const t=this.shutdownReason;try{return this.shutdownReason=Mc.Api,await e()}finally{this.shutdownReason=t}}async handleExpectedShutdown(e){return this.shutdownReason=Mc.Api,this.lifecycleService.withExpectedShutdown(e)}async getScreenshot(){const e=new U,t=document.createElement("video");e.add(Ie(()=>t.remove()));let i;try{i=await navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}),t.srcObject=i,t.play(),await Promise.all([new Promise(c=>e.add(re(t,"loadedmetadata",()=>c()))),new Promise(c=>e.add(re(t,"canplaythrough",()=>c())))]);const n=document.createElement("canvas");n.width=t.videoWidth,n.height=t.videoHeight;const o=n.getContext("2d");if(!o)return;o.drawImage(t,0,0,n.width,n.height);const r=await new Promise(c=>n.toBlob(d=>c(d),"image/jpeg",.95));if(!r)throw new Error("Failed to create blob from canvas");const a=await r.bytes();return Le.wrap(a)}catch(n){console.error("Error taking screenshot:",n);return}finally{if(e.dispose(),i)for(const n of i.getTracks())n.stop()}}async getElementData(){}async getBrowserId(){}async getNativeWindowHandle(e){}};cg.__decorator=f([Gt],cg.prototype,"onDidChangeFocus",null);cg.__decorator=f([Gt],cg.prototype,"onDidChangeActiveWindow",null);cg.__decorator=f([Gt],cg.prototype,"onDidChangeFullScreen",null);cg=f([p(0,af),p(1,ne),p(2,je),p(3,ui),p(4,cf),p(5,Z),p(6,wd),p(7,Re),p(8,ei),p(9,It),p(10,Uv)],cg);class Yqe extends F{constructor(){super(),this._onDidSchemeChangeEvent=this._register(new M),this.registerListeners()}registerListeners(){I8(zi,"(prefers-color-scheme: dark)",()=>{this._onDidSchemeChangeEvent.fire()}),I8(zi,"(forced-colors: active)",()=>{this._onDidSchemeChangeEvent.fire()})}get onDidChangeColorScheme(){return this._onDidSchemeChangeEvent.event}get dark(){return zi.matchMedia("(prefers-color-scheme: light)").matches?!1:!!zi.matchMedia("(prefers-color-scheme: dark)").matches}get highContrast(){return!!zi.matchMedia("(forced-colors: active)").matches}}function Qqe(){return{[Hn.toString()]:new Sr(cg,[],!0),[eae.toString()]:new Sr(Yqe,[],!0)}}if(window.monacoVscodeApiBuildId!=null&&window.monacoVscodeApiBuildId!=="1.100.3-02a8a23b-6340-4b94-ae7b-d6a8042935e8")throw new Error(`Another version of monaco-vscode-api has already been loaded. Trying to load 1.100.3-02a8a23b-6340-4b94-ae7b-d6a8042935e8, ${window.monacoVscodeApiBuildId} is already loaded`);window.monacoVscodeApiBuildId="1.100.3-02a8a23b-6340-4b94-ae7b-d6a8042935e8";async function Rst(s,e=document.body,t={},i){DCe(),oSe(e),rSe(e,t,i);const n=Vu({_serviceBrand:void 0,...zo},t.productConfiguration),o=Qa.initialize({[Vn.toString()]:n,...jqe(),...zze(),...vHe(),...kCe(),...Gze(),...Qqe(),...aSe(),...s});await TCe(o)}async function Pst(s){return await dA(),Qa.get(s)}function Lst(s){if(xCe.isOpen())return Qa.get(Z).invokeFunction(s);const e=new U,t=e.add(ICe.event(()=>{t.dispose(),e.add(Qa.get(Z).invokeFunction(s))}));return e}export{Vd as $,ta as A,My as B,I7 as C,gW as D,U9 as E,W7 as F,Xl as G,BY as H,xke as I,J_ as J,pY as K,sv as L,qe as M,VS as N,NB as O,rn as P,o7 as Q,ms as R,pW as S,M5e as T,yy as U,gY as V,Jke as W,$8e as X,lR as Y,MY as Z,aTe as _,kke as a,L7 as a$,dQ as a0,cQ as a1,sTe as a2,e7e as a3,z8 as a4,TW as a5,AW as a6,DA as a7,XCe as a8,y7 as a9,ATe as aA,Hk as aB,mr as aC,rKe as aD,ACe as aE,RCe as aF,Toe as aG,Oi as aH,Lo as aI,ZB as aJ,tR as aK,JB as aL,YY as aM,jY as aN,Hl as aO,d9 as aP,F8e as aQ,rY as aR,W8e as aS,oEe as aT,$B as aU,uQ as aV,t7e as aW,D7 as aX,k7 as aY,T7 as aZ,K7 as a_,_7 as aa,Dce as ab,Nd as ac,$o as ad,s5e as ae,Y4e as af,n5e as ag,i5e as ah,t5e as ai,e5e as aj,J4e as ak,Z4e as al,X4e as am,Q4e as an,j4e as ao,WK as ap,Mce as aq,eQ as ar,Md as as,Uc as at,RA as au,uo as av,rh as aw,i7e as ax,r9 as ay,Z7 as az,N5e as b,gV as b$,mTe as b0,fTe as b1,a4e as b2,v4e as b3,m4e as b4,A7 as b5,R7 as b6,P7 as b7,B9 as b8,$p as b9,fY as bA,TY as bB,I4e as bC,Uce as bD,q7 as bE,t7 as bF,IY as bG,DY as bH,c7 as bI,RY as bJ,IA as bK,AY as bL,kY as bM,OY as bN,CY as bO,SY as bP,FY as bQ,bY as bR,wW as bS,Th as bT,Y8 as bU,K8 as bV,as as bW,UY as bX,tAe as bY,oQ as bZ,sQ as b_,uTe as ba,J8e as bb,z8e as bc,j8e as bd,Z8e as be,Y8e as bf,X8e as bg,bp as bh,O5e as bi,Q8e as bj,TC as bk,ax as bl,hv as bm,Xc as bn,_Q as bo,U8e as bp,LQ as bq,AR as br,A8e as bs,aR as bt,Jd as bu,yY as bv,CW as bw,oR as bx,vY as by,_Y as bz,R4e as c,hY as c$,$i as c0,C5e as c1,mV as c2,pV as c3,fV as c4,w5e as c5,nQ as c6,S5e as c7,tV as c8,Yj as c9,vR as cA,Goe as cB,iV as cC,Qoe as cD,nV as cE,Uoe as cF,mR as cG,iQ as cH,Up as cI,lV as cJ,z7 as cK,OK as cL,V7 as cM,$7 as cN,G7 as cO,gAe as cP,hAe as cQ,DV as cR,IV as cS,uY as cT,Ga as cU,LY as cV,by as cW,a7 as cX,F7 as cY,vA as cZ,O7 as c_,_9 as ca,aQ as cb,rQ as cc,E5e as cd,Zoe as ce,gEe as cf,$oe as cg,Koe as ch,lEe as ci,hEe as cj,Xoe as ck,uEe as cl,h5e as cm,Yoe as cn,tQ as co,oV as cp,zoe as cq,_R as cr,sV as cs,hV as ct,dV as cu,uV as cv,yR as cw,rV as cx,bR as cy,joe as cz,Tc as d,n9 as d$,xA as d0,SW as d1,mY as d2,zp as d3,wY as d4,EY as d5,QY as d6,k4e as d7,D4e as d8,Hce as d9,o7e as dA,fQ as dB,sb as dC,lY as dD,j8 as dE,Nc as dF,fR as dG,uR as dH,gR as dI,pR as dJ,_q as dK,eKe as dL,t9 as dM,K8e as dN,mm as dO,HY as dP,$Y as dQ,zY as dR,Voe as dS,d7e as dT,nEe as dU,LR as dV,qY as dW,GY as dX,s9 as dY,VY as dZ,TA as d_,xY as da,cb as db,xo as dc,jB as dd,YB as de,BE as df,M7 as dg,mQ as dh,lQ as di,hQ as dj,T9 as dk,XB as dl,PY as dm,Fy as dn,PW as dp,FC as dq,LW as dr,mh as ds,ff as dt,vre as du,bl as dv,ud as dw,kw as dx,Aw as dy,qQ as dz,H8e as e,$W as e$,NY as e0,Y7 as e1,Q7 as e2,X7 as e3,x7 as e4,s7 as e5,FKe as e6,EA as e7,r7 as e8,J7 as e9,vEe as eA,mEe as eB,m9 as eC,pEe as eD,Bl as eE,b9 as eF,qoe as eG,KW as eH,k9 as eI,DC as eJ,tb as eK,D9 as eL,I9 as eM,E9 as eN,v9 as eO,ob as eP,p9 as eQ,g9 as eR,h9 as eS,cEe as eT,aEe as eU,rEe as eV,u1 as eW,RW as eX,LC as eY,AA as eZ,q4e as e_,e9 as ea,ZY as eb,kA as ec,S7 as ed,RC as ee,wAe as ef,w7 as eg,vQ as eh,Ze as ei,x9 as ej,R5e as ek,P5e as el,w9 as em,$9 as en,T5e as eo,N7 as ep,C4e as eq,Ju as er,C9 as es,x5e as et,k5e as eu,S9 as ev,_Ee as ew,bq as ex,y9 as ey,GW as ez,V8e as f,MW as f$,c9 as f0,V4e as f1,H4e as f2,F4e as f3,fW as f4,i9 as f5,N4e as f6,M4e as f7,iEe as f8,UW as f9,UKe as fA,f7 as fB,v7 as fC,m7 as fD,yA as fE,hn as fF,X8 as fG,J8 as fH,Z8 as fI,b7 as fJ,Boe as fK,PC as fL,j7 as fM,AC as fN,u9 as fO,Q8 as fP,q8 as fQ,_W as fR,vW as fS,n7 as fT,i7 as fU,qg as fV,B7 as fW,l9 as fX,FW as fY,OW as fZ,NW as f_,sEe as fa,tEe as fb,nb as fc,o9 as fd,a9 as fe,l7 as ff,oKe as fg,e7 as fh,EW as fi,xW as fj,n4e as fk,C7 as fl,E7 as fm,CA as fn,Wl as fo,Wb as fp,kC as fq,u7 as fr,KKe as fs,p7 as ft,qKe as fu,h7 as fv,zKe as fw,g7 as fx,$Ke as fy,GKe as fz,Pst as g,fz as g$,DW as g0,yW as g1,bA as g2,bW as g3,eb as g4,_A as g5,mW as g6,ib as g7,T4e as g8,O9 as g9,BN as gA,jxe as gB,te as gC,uce as gD,zze as gE,Ni as gF,Sq as gG,qV as gH,Uq as gI,jX as gJ,lU as gK,Rst as gL,vHe as gM,W7e as gN,B7e as gO,Ft as gP,cP as gQ,UIe as gR,t6 as gS,XS as gT,eae as gU,HN as gV,yq as gW,CI as gX,Gze as gY,$s as gZ,We as g_,IC as ga,SA as gb,bt as gc,IW as gd,U7 as ge,H7 as gf,kW as gg,wA as gh,MC as gi,QCe as gj,YCe as gk,fEe as gl,o5e as gm,f9 as gn,$8 as go,VE as gp,WY as gq,sDe as gr,zN as gs,TS as gt,Jtt as gu,O7e as gv,F7e as gw,Iie as gx,R8e as gy,Ike as gz,Xr as h,kx as h$,M3 as h0,Yi as h1,qR as h2,Qd as h3,qD as h4,p6e as h5,m6e as h6,Fxe as h7,ov as h8,AN as h9,QEe as hA,pre as hB,ah as hC,g6e as hD,pz as hE,aje as hF,cje as hG,YEe as hH,U5e as hI,V5e as hJ,H5e as hK,P0e as hL,B5e as hM,Du as hN,J5e as hO,Xx as hP,j5e as hQ,Y5e as hR,mp as hS,K5e as hT,Z5e as hU,mxe as hV,X5e as hW,Q5e as hX,Tq as hY,Sy as hZ,sB as h_,f6e as ha,Yre as hb,GIe as hc,yIe as hd,v6e as he,_6e as hf,Kze as hg,go as hh,fc as hi,Fh as hj,Ige as hk,oa as hl,CD as hm,dst as hn,xie as ho,lz as hp,hP as hq,Lie as hr,uP as hs,Pie as ht,Mu as hu,yOe as hv,lue as hw,Av as hx,u6e as hy,gj as hz,rt as i,IIe as i$,eYe as i0,ONe as i1,jZ as i2,KVe as i3,tYe as i4,y0e as i5,w0e as i6,qP as i7,Xd as i8,GP as i9,qE as iA,o6e as iB,pw as iC,Zze as iD,Ru as iE,Ac as iF,lu as iG,UK as iH,To as iI,ho as iJ,z5e as iK,G5e as iL,q5e as iM,Aq as iN,g0e as iO,$P as iP,Rr as iQ,w6e as iR,y6e as iS,tL as iT,oue as iU,cre as iV,$5e as iW,ed as iX,Ap as iY,Eze as iZ,TEe as i_,gz as ia,RN as ib,uj as ic,l6e as id,h6e as ie,Dq as ig,ure as ih,kq as ii,mz as ij,i6e as ik,Dw as il,Iw as im,t6e as io,GE as ip,e6e as iq,xqe as ir,qv as is,n6e as it,hre as iu,zE as iv,c6e as iw,a6e as ix,r6e as iy,s6e as iz,Xke as j,Bue as j$,vH as j0,KU as j1,ZXe as j2,cs as j3,l7e as j4,h7e as j5,qp as j6,vAe as j7,kV as j8,Zc as j9,get as jA,ON as jB,Xze as jC,u7e as jD,qAe as jE,sp as jF,fd as jG,Hb as jH,SX as jI,Tx as jJ,vd as jK,ol as jL,_L as jM,YJ as jN,VA as jO,fae as jP,pae as jQ,gae as jR,uae as jS,pd as jT,mDe as jU,aae as jV,U6e as jW,Pr as jX,Fue as jY,bL as jZ,QJ as j_,btt as ja,io as jb,QQ as jc,ks as jd,a7e as je,c7e as jf,qZ as jg,xce as jh,G8e as ji,pc as jj,So as jk,Yb as jl,mf as jm,AIe as jn,o2e as jo,_H as jp,D_ as jq,l2e as jr,h2e as js,x2e as jt,tie as ju,uet as jv,pet as jw,Wh as jx,TN as jy,het as jz,B8e as k,Jje as k$,bIe as k0,C1 as k1,XQ as k2,I0e as k3,rz as k4,BZ as k5,VZ as k6,ag as k7,lde as k8,JI as k9,Tj as kA,Dj as kB,ku as kC,qre as kD,wL as kE,ZC as kF,Aee as kG,oFe as kH,L5e as kI,xU as kJ,aB as kK,hU as kL,wZ as kM,jP as kN,FU as kO,xp as kP,P9e as kQ,$5 as kR,U5 as kS,G5 as kT,z5 as kU,B5 as kV,V5 as kW,K5 as kX,iae as kY,$Ie as kZ,Kb as k_,VN as ka,Aj as kb,Ha as kc,I6e as kd,Kr as ke,NIe as kf,d6e as kg,vu as kh,Yd as ki,Rj as kj,jE as kk,YE as kl,OIe as km,Rm as kn,Sre as ko,$r as kp,Rw as kq,Mq as kr,jg as ks,E6e as kt,D6e as ku,MIe as kv,kj as kw,k6e as kx,T6e as ky,WIe as kz,eV as l,$Qe as l$,rYe as l0,Ute as l1,kl as l2,$he as l3,Xy as l4,Ghe as l5,CU as l6,zhe as l7,xx as l8,Bhe as l9,TYe as lA,AYe as lB,sQe as lC,oQe as lD,rQe as lE,aQe as lF,iQe as lG,nQe as lH,PQe as lI,LQe as lJ,jYe as lK,YYe as lL,QYe as lM,XYe as lN,ZYe as lO,JYe as lP,eQe as lQ,tQe as lR,MQe as lS,NQe as lT,VQe as lU,HQe as lV,WQe as lW,BQe as lX,OQe as lY,FQe as lZ,UQe as l_,Vhe as la,cQe as lb,dQe as lc,lQe as ld,hQe as le,uQe as lf,gQe as lg,DQe as lh,kQe as li,TQe as lj,AQe as lk,Hhe as ll,Uhe as lm,Dx as ln,zYe as lo,GYe as lp,qYe as lq,KYe as lr,$Ye as ls,Ohe as lt,CYe as lu,EYe as lv,xYe as lw,IYe as lx,DYe as ly,kYe as lz,Wn as m,f6 as m$,jQe as m0,YQe as m1,qQe as m2,KQe as m3,GQe as m4,zQe as m5,RYe as m6,PYe as m7,LYe as m8,NYe as m9,Zhe as mA,eXe as mB,tXe as mC,CQe as mD,EQe as mE,xQe as mF,IQe as mG,qU as mH,iXe as mI,nXe as mJ,sXe as mK,oXe as mL,rXe as mM,aXe as mN,vS as mO,cYe as mP,JNe as mQ,jO as mR,YNe as mS,kU as mT,TU as mU,AU as mV,RU as mW,_Oe as mX,ZNe as mY,mOe as mZ,vOe as m_,MYe as ma,OYe as mb,FYe as mc,WYe as md,BYe as me,QQe as mf,XQe as mg,ZQe as mh,JQe as mi,pQe as mj,fQe as mk,mQe as ml,vQe as mm,_Qe as mn,bQe as mo,yQe as mp,wQe as mq,SQe as mr,RQe as ms,qhe as mt,Khe as mu,jhe as mv,Yhe as mw,Qhe as mx,Xhe as my,Jhe as mz,Oy as n,cJe as n$,v6 as n0,g6 as n1,m6 as n2,_6 as n3,p6 as n4,y6 as n5,b6 as n6,w6 as n7,C6 as n8,cS as n9,FZ as nA,pr as nB,DI as nC,Fm as nD,Lq as nE,RJ as nF,Uue as nG,dWe as nH,lWe as nI,Xs as nJ,OA as nK,cp as nL,iJe as nM,Ux as nN,nJe as nO,fFe as nP,ym as nQ,Wi as nR,ro as nS,Nu as nT,eJe as nU,uFe as nV,gFe as nW,sJe as nX,ew as nY,oJe as nZ,dJe as n_,hhe as na,KNe as nb,che as nc,dhe as nd,uhe as ne,QNe as nf,iOe as ng,N4 as nh,nOe as ni,oOe as nj,pOe as nk,fOe as nl,MZ as nm,eOe as nn,XNe as no,phe as np,E6 as nq,HNe as nr,jNe as ns,lhe as nt,aOe as nu,cOe as nv,ghe as nw,rOe as nx,OZ as ny,NZ as nz,zke as o,lJe as o0,hJe as o1,uJe as o2,fJe as o3,pJe as o4,gJe as o5,NJ as o6,_Fe as o7,f$ as o8,XL as o9,QL as oa,wJe as ob,FJ as oc,zn as od,IUe as oe,DUe as of,lF as og,zy as oh,BU as oi,Zi as oj,zZ as ok,mRe as ol,pg as om,CM as on,PJ as oo,Bh as op,SXe as oq,cB as or,ede as os,Vt as ot,P6e as ou,R6e as ov,Hd as ow,Mn as p,Py as q,q8e as r,dY as s,jCe as t,rR as u,dEe as v,Lst as w,XY as x,U4e as y,KY as z};

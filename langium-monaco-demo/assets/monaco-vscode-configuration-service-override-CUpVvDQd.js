const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./iconv-lite-umd-C_009vke.js","./react-DaXNwOpS.js","./index-R5Ow2ahL.js","./jschardet-Bv4XK43a.js"])))=>i.map(i=>d[i]);
import{E as H,c as z,l as c,R as W,I as vt,a as Ar,t as de,D,U as K,S as k,b as Me,d as rs,e as Uo,i as Mo,F as V,f as fn,g as p,h as he,j as Ye,k as ee,m as ht,n as Tr,_ as x,o as u,p as xr,q as te,r as Be,s as Ve,C as Ut,u as Pr,v as wt,V as _,w as gn,x as re,y as ii,z as L,A as Lr,B as ct,G as pt,H as Nr,J as ri,K as Bo,L as Pe,M as Ai,N as si,O as ss,P as nt,Q as Vo,T as Wr,W as xe,X as E,Y as O,Z as C,$ as ve,a0 as ie,a1 as Go,a2 as Yi,a3 as oe,a4 as Ur,a5 as v,a6 as _e,a7 as Ke,a8 as Ko,a9 as b,aa as y,ab as pn,ac as Fe,ad as Ho,ae as Le,af as zo,ag as Te,ah as we,ai as zt,aj as ji,ak as $o,al as ns,am as ut,an as A,ao as it,ap as T,aq as os,ar as vn,as,at as Ti,au as Yo,av as jo,aw as $e,ax as xi,ay as Pi,az as wn,aA as $t,aB as Li,aC as qo,aD as Xo,aE as cs,aF as me,aG as Sn,aH as Jo,aI as Qo,aJ as Ee,aK as Cn,aL as Ni,aM as Zo,aN as ea,aO as ni,aP as Ge,aQ as P,aR as ta,aS as j,aT as oi,aU as ia,aV as Ce,aW as En,aX as ra,aY as sa,aZ as qe,a_ as ls,a$ as na,b0 as Ie,b1 as ds,b2 as Mr,b3 as oa,b4 as yn,b5 as Br,b6 as aa,b7 as ca,b8 as St,b9 as Vr,ba as Ct,bb as Gr,bc as yi,bd as la,be as qi,bf as da,bg as mn,bh as Rn,bi as Mt,bj as mi,bk as _n,bl as ha,bm as Dt,bn as ua,bo as fa,bp as Bt,bq as Kr,br as ke,bs as Z,bt as Dn,bu as hs,bv as bn,bw as ga,bx as us,by as fs,bz as gs,bA as xt,bB as Ae,bC as Hr,bD as zr,bE as Fn,bF as On,bG as kt,bH as ps,bI as pa,bJ as In,bK as va,bL as wa,bM as U,bN as Pt,bO as kn,bP as vs,bQ as An,bR as Tn,bS as $,bT as Sa,bU as Ca,bV as Ea,bW as ya,bX as xn,bY as ma,bZ as Pn,b_ as Ra,b$ as _a,c0 as ws,c1 as Da,c2 as ft,c3 as ba,c4 as Fa,c5 as Oa,c6 as Ia,c7 as ka,c8 as Aa,c9 as Ta,ca as xa,cb as Pa,cc as La,cd as Na,ce as Wa,cf as Ss,cg as Ua,ch as Ma,ci as Ba,cj as Va,ck as Ga,cl as Ka,cm as Ha,cn as za,co as $a,cp as Ya,cq as ja,cr as Yt,cs as qa,ct as Xi,cu as Xa,cv as Ja,cw as Qa,cx as Za,cy as ec,cz as je,cA as $r,cB as Vt,cC as tc,cD as ic,cE as rc,cF as sc,cG as nc,cH as oc,cI as ae,cJ as Lt,cK as Ln,cL as Nn,cM as Cs,cN as ac,cO as cc,cP as lc,cQ as Wn,cR as dc,cS as hc,cT as Es,cU as uc,cV as fc,cW as Un,cX as Mn,cY as Bn,cZ as Ji,c_ as At,c$ as gc,d0 as pc,d1 as Wi,d2 as vc,d3 as Vn,d4 as wc,d5 as Sc,d6 as Gn,d7 as Ri,d8 as Cc,d9 as Ec,da as yc,db as mc,dc as Rc,dd as _c,de as Kn,df as Dc,dg as Re,dh as bc,di as ai,dj as Xe,dk as Hn,dl as B,dm as Fc,dn as Oc,dp as _i,dq as Ic,dr as ys,ds as kc,dt as zn,du as Ac,dv as Tc,dw as $n,dx as Yn,dy as ms,dz as jn,dA as xc,dB as Pc,dC as Lc,dD as Nc,dE as Et,dF as rt,dG as Rs,dH as yt,dI as Wc,dJ as ue,dK as Uc,dL as Mc,dM as Bc,dN as Vc,dO as Qi,dP as _s,dQ as qn,dR as Ui,dS as Gc,dT as Kc,dU as Hc,dV as zc,dW as st,dX as Ds,dY as $c,dZ as Yc,d_ as jc,d$ as qc,e0 as bs,e1 as Yr,e2 as Xn,e3 as Xc,e4 as Jc,e5 as Fs,e6 as Os,e7 as Qc,e8 as Zc,e9 as el,ea as tl,eb as il,ec as rl,ed as sl}from"./monaco-vscode-base-service-override-DWrDktfJ.js";import"./monaco-vscode-api-CfKh107e.js";class nl{constructor(){this.onDidChange=H.None,this.policyDefinitions={}}async updatePolicyDefinitions(){return{}}getPolicyValue(){}serialize(){}}const Di=z("IUserDataProfilesService"),Jn=z("workspacesService"),ol=z("WorkbenchAssignmentService"),al=z("configurationResolverService"),Qn={EditorPane:"workbench.contributions.editors",EditorFactory:"workbench.contributions.editor.inputFactories"},cl={id:"default",displayName:c(3877,"Text Editor"),providerDisplayName:c(3878,"Built-in")},qh="workbench.editor.sidebysideEditor",Xh="workbench.editors.textDiffEditor",Jh="workbench.editors.binaryResourceDiffEditor";var Is;(function(s){s[s.PROGRAMMATIC=1]="PROGRAMMATIC",s[s.USER=2]="USER",s[s.EDIT=3]="EDIT",s[s.NAVIGATION=4]="NAVIGATION",s[s.JUMP=5]="JUMP"})(Is||(Is={}));var ks;(function(s){s[s.IDENTICAL=1]="IDENTICAL",s[s.SIMILAR=2]="SIMILAR",s[s.DIFFERENT=3]="DIFFERENT"})(ks||(ks={}));function Qh(s){const e=s;return!!e&&typeof e.getSelection=="function"&&!!e.onDidChangeSelection}function Zh(s,e,t){for(const i of t.visibleEditorPanes)if(i.group.id===e&&s.matches(i.input))return i.getViewState()}function eu(s){if(q(s))return!1;const e=s;return K.isUri(e?.resource)}function jt(s){if(q(s))return!1;const e=s;return e?.original!==void 0&&e.modified!==void 0}function As(s){if(q(s))return!1;const e=s;return!e||e.resources&&!Array.isArray(e.resources)?!1:!!e.resources||!!e.multiDiffSource}function Mi(s){if(q(s)||jt(s))return!1;const e=s;return e?.primary!==void 0&&e.secondary!==void 0}function tu(s){if(q(s))return!1;const e=s;return e?e.resource===void 0||e.resource.scheme===k.untitled||e.forceUntitled===!0:!1}function Kt(s){if(q(s))return!1;const e=s;return K.isUri(e?.base?.resource)&&K.isUri(e?.input1?.resource)&&K.isUri(e?.input2?.resource)&&K.isUri(e?.result?.resource)}var Zi;(function(s){s[s.SHORT=0]="SHORT",s[s.MEDIUM=1]="MEDIUM",s[s.LONG=2]="LONG"})(Zi||(Zi={}));var ne;(function(s){s[s.EXPLICIT=1]="EXPLICIT",s[s.AUTO=2]="AUTO",s[s.FOCUS_CHANGE=3]="FOCUS_CHANGE",s[s.WINDOW_CHANGE=4]="WINDOW_CHANGE"})(ne||(ne={}));class ll{constructor(){this.mapIdToSaveSource=new Map}registerSource(e,t){let i=this.mapIdToSaveSource.get(e);return i||(i={source:e,label:t},this.mapIdToSaveSource.set(e,i)),i.source}getSourceLabel(e){return this.mapIdToSaveSource.get(e)?.label??e}}const er=new ll;var lt;(function(s){s[s.None=0]="None",s[s.Readonly=2]="Readonly",s[s.Untitled=4]="Untitled",s[s.Singleton=8]="Singleton",s[s.RequiresTrust=16]="RequiresTrust",s[s.CanSplitInGroup=32]="CanSplitInGroup",s[s.ForceDescription=64]="ForceDescription",s[s.CanDropIntoEditor=128]="CanDropIntoEditor",s[s.MultipleEditors=256]="MultipleEditors",s[s.Scratchpad=512]="Scratchpad"})(lt||(lt={}));class Zn extends D{}function q(s){return s instanceof Zn}function dl(s){const e=s;return K.isUri(e?.preferredResource)}function hl(s){const e=s;return q(e?.primary)&&q(e?.secondary)}function ul(s){const e=s;return q(e?.modified)&&q(e?.original)}function iu(s,e,t,i,r){return wl(i,[rs({id:"workbench.action.openLargeFile",label:c(3879,"Open Anyway"),run:()=>{const n={...t,limits:{size:Number.MAX_VALUE}};s.openEditor(e,n)}}),rs({id:"workbench.action.configureEditorLargeFileConfirmation",label:c(3880,"Configure Limit"),run:()=>r.openUserSettings({query:"workbench.editorLargeFileConfirmation"})})],{forceMessage:!0,forceSeverity:Me.Warning})}function fl(s){return q(s?.editor)}function ru(s){const e=s;return fl(s)&&e?.group!==void 0}function su(s){const e=s;return typeof e?.groupId=="number"&&q(e.editor)}function nu(s){return typeof s?.groupId=="number"}var Ts;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.REPLACE=1]="REPLACE",s[s.MOVE=2]="MOVE",s[s.UNPIN=3]="UNPIN"})(Ts||(Ts={}));var xs;(function(s){s[s.GROUP_ACTIVE=0]="GROUP_ACTIVE",s[s.GROUP_INDEX=1]="GROUP_INDEX",s[s.GROUP_LABEL=2]="GROUP_LABEL",s[s.GROUP_LOCKED=3]="GROUP_LOCKED",s[s.EDITORS_SELECTION=4]="EDITORS_SELECTION",s[s.EDITOR_OPEN=5]="EDITOR_OPEN",s[s.EDITOR_CLOSE=6]="EDITOR_CLOSE",s[s.EDITOR_MOVE=7]="EDITOR_MOVE",s[s.EDITOR_ACTIVE=8]="EDITOR_ACTIVE",s[s.EDITOR_LABEL=9]="EDITOR_LABEL",s[s.EDITOR_CAPABILITIES=10]="EDITOR_CAPABILITIES",s[s.EDITOR_PIN=11]="EDITOR_PIN",s[s.EDITOR_TRANSIENT=12]="EDITOR_TRANSIENT",s[s.EDITOR_STICKY=13]="EDITOR_STICKY",s[s.EDITOR_DIRTY=14]="EDITOR_DIRTY",s[s.EDITOR_WILL_DISPOSE=15]="EDITOR_WILL_DISPOSE"})(xs||(xs={}));var le;(function(s){s[s.PRIMARY=1]="PRIMARY",s[s.SECONDARY=2]="SECONDARY",s[s.BOTH=3]="BOTH",s[s.ANY=4]="ANY"})(le||(le={}));class gl{getOriginalUri(e,t){if(!e)return;if(Kt(e))return Je.getOriginalUri(e.result,t);if(t?.supportSideBySide){const{primary:r,secondary:n}=this.getSideEditors(e);if(r&&n){if(t?.supportSideBySide===le.BOTH)return{primary:this.getOriginalUri(r,{filterByScheme:t.filterByScheme}),secondary:this.getOriginalUri(n,{filterByScheme:t.filterByScheme})};if(t?.supportSideBySide===le.ANY)return this.getOriginalUri(r,{filterByScheme:t.filterByScheme})??this.getOriginalUri(n,{filterByScheme:t.filterByScheme});e=t.supportSideBySide===le.PRIMARY?r:n}}if(jt(e)||As(e)||Mi(e)||Kt(e))return;const i=dl(e)?e.preferredResource:e.resource;return!i||!t||!t.filterByScheme?i:this.filterUri(i,t.filterByScheme)}getSideEditors(e){return hl(e)||Mi(e)?{primary:e.primary,secondary:e.secondary}:ul(e)||jt(e)?{primary:e.modified,secondary:e.original}:{primary:void 0,secondary:void 0}}getCanonicalUri(e,t){if(!e)return;if(Kt(e))return Je.getCanonicalUri(e.result,t);if(t?.supportSideBySide){const{primary:r,secondary:n}=this.getSideEditors(e);if(r&&n){if(t?.supportSideBySide===le.BOTH)return{primary:this.getCanonicalUri(r,{filterByScheme:t.filterByScheme}),secondary:this.getCanonicalUri(n,{filterByScheme:t.filterByScheme})};if(t?.supportSideBySide===le.ANY)return this.getCanonicalUri(r,{filterByScheme:t.filterByScheme})??this.getCanonicalUri(n,{filterByScheme:t.filterByScheme});e=t.supportSideBySide===le.PRIMARY?r:n}}if(jt(e)||As(e)||Mi(e)||Kt(e))return;const i=e.resource;return!i||!t||!t.filterByScheme?i:this.filterUri(i,t.filterByScheme)}filterUri(e,t){if(Array.isArray(t)){if(t.some(i=>e.scheme===i))return e}else if(t===e.scheme)return e}}var dt;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.KEYBOARD=1]="KEYBOARD",s[s.MOUSE=2]="MOUSE"})(dt||(dt={}));function ou(s,e,t,i){if(!s.isSticky(e))return!1;switch(i.preventPinnedEditorClose){case"keyboardAndMouse":return t===dt.MOUSE||t===dt.KEYBOARD;case"mouse":return t===dt.MOUSE;case"keyboard":return t===dt.KEYBOARD}return!1}const Je=new gl;var Ps;(function(s){s[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT"})(Ps||(Ps={}));class pl{constructor(){this.editorSerializerConstructors=new Map,this.editorSerializerInstances=new Map}start(e){const t=this.instantiationService=e.get(vt);for(const[i,r]of this.editorSerializerConstructors)this.createEditorSerializer(i,r,t);this.editorSerializerConstructors.clear()}createEditorSerializer(e,t,i){const r=i.createInstance(t);this.editorSerializerInstances.set(e,r)}registerFileEditorFactory(e){if(this.fileEditorFactory)throw new Error("Can only register one file editor factory.");this.fileEditorFactory=e}getFileEditorFactory(){return Ar(this.fileEditorFactory)}registerEditorSerializer(e,t){if(this.editorSerializerConstructors.has(e)||this.editorSerializerInstances.has(e))throw new Error(`A editor serializer with type ID '${e}' was already registered.`);return this.instantiationService?this.createEditorSerializer(e,t,this.instantiationService):this.editorSerializerConstructors.set(e,t),de(()=>{this.editorSerializerConstructors.delete(e),this.editorSerializerInstances.delete(e)})}getEditorSerializer(e){return this.editorSerializerInstances.get(typeof e=="string"?e:e.typeId)}}W.add(Qn.EditorFactory,new pl);async function au(s,e,t){return!s||!s.length?[]:await Promise.all(s.map(async i=>{const r=K.revive(i.fileUri);if(!r){t.info("Cannot resolve the path because it is not valid.",i);return}if(!await e.canHandleResource(r)){t.info("Cannot resolve the path because it cannot be handled",i);return}let o=i.exists,a=i.type;if(typeof o!="boolean"||typeof a!="number")try{a=(await e.stat(r)).isDirectory?V.Directory:V.Unknown,o=!0}catch(d){t.error(d),o=!1}if(!o&&i.openOnlyIfExists){t.info("Cannot resolve the path because it does not exist",i);return}if(a===V.Directory){t.info("Cannot resolve the path because it is a directory",i);return}const l={...i.options,pinned:!0};return o?{resource:r,options:l}:{resource:r,options:l,forceUntitled:!0}}))}var Ls;(function(s){s[s.MOST_RECENTLY_ACTIVE=0]="MOST_RECENTLY_ACTIVE",s[s.SEQUENTIAL=1]="SEQUENTIAL"})(Ls||(Ls={}));function vl(s){const e=s;if(!e)return!1;const t=e;if(t.modified)return vl(t.modified);const i=e;return!!(i.contributionsState&&i.viewState&&Array.isArray(i.cursorState))}function cu(s){return Mo(s)}function wl(s,e,t){const i=Uo(s,e);return i.forceMessage=t?.forceMessage,i.forceSeverity=t?.forceSeverity,i.allowDialog=t?.allowDialog,i}var Nt;(function(s){s[s.UP=0]="UP",s[s.DOWN=1]="DOWN",s[s.LEFT=2]="LEFT",s[s.RIGHT=3]="RIGHT"})(Nt||(Nt={}));var Ns;(function(s){s[s.HORIZONTAL=0]="HORIZONTAL",s[s.VERTICAL=1]="VERTICAL"})(Ns||(Ns={}));var Ws;(function(s){s[s.FIRST=0]="FIRST",s[s.LAST=1]="LAST",s[s.NEXT=2]="NEXT",s[s.PREVIOUS=3]="PREVIOUS"})(Ws||(Ws={}));var Us;(function(s){s[s.MAXIMIZE=0]="MAXIMIZE",s[s.EXPAND=1]="EXPAND",s[s.EVEN=2]="EVEN"})(Us||(Us={}));var Ms;(function(s){s[s.COPY_EDITORS=0]="COPY_EDITORS",s[s.MOVE_EDITORS=1]="MOVE_EDITORS"})(Ms||(Ms={}));function lu(s){const e=s;return q(e?.editor)&&q(e?.replacement)}var Bs;(function(s){s[s.CREATION_TIME=0]="CREATION_TIME",s[s.MOST_RECENTLY_ACTIVE=1]="MOST_RECENTLY_ACTIVE",s[s.GRID_APPEARANCE=2]="GRID_APPEARANCE"})(Bs||(Bs={}));var Vs;(function(s){s[s.NEW_EDITOR=1]="NEW_EDITOR",s[s.MOVE_EDITOR=2]="MOVE_EDITOR",s[s.COPY_EDITOR=3]="COPY_EDITOR"})(Vs||(Vs={}));function du(s){const e=s;return!!e&&typeof e.id=="number"&&Array.isArray(e.editors)}function Sl(s){return s.getValue("workbench.editor.openSideBySideDirection")==="down"?Nt.DOWN:Nt.RIGHT}const Cl=z("editorGroupsService"),bi=z("extensionService"),jr=z("elevatedFileService"),qr=z("hostService"),Xr=z("ILanguageDetectionService"),El=z("paneCompositePartService"),yl=z("preferencesService"),eo=z("untitledTextEditorService"),Jr=z("IUserDataProfileService"),hu=z("IUserDataProfileManagementService"),uu=z("IUserDataProfileImportExportService"),to=z("workingCopyBackupService"),ml=z("workspaceEditingService");function Rl(){throw new Error("unsupported")}function _l(s){let e=null;return(...t)=>(e==null&&(e=s(...t)),e)}function Dl(s){return new Proxy(s,{construct:_l((e,t)=>Reflect.construct(s,t))})}async function bl(s){await new Promise(e=>setTimeout(e,s))}function fu(s,e,t){let i=Promise.resolve(),r=null;return async n=>{r==null?(r=n,i=i.then(async()=>await bl(t)).then(async()=>{const o=r;r=null,await s(o)})):r=e(r,n),await i}}var Gs;(function(s){s[s.EXACT=0]="EXACT",s[s.ABOVE=1]="ABOVE",s[s.BELOW=2]="BELOW"})(Gs||(Gs={}));var Ks;(function(s){s[s.TOP_RIGHT_CORNER=0]="TOP_RIGHT_CORNER",s[s.BOTTOM_RIGHT_CORNER=1]="BOTTOM_RIGHT_CORNER",s[s.TOP_CENTER=2]="TOP_CENTER"})(Ks||(Ks={}));var Hs;(function(s){s[s.UNKNOWN=0]="UNKNOWN",s[s.TEXTAREA=1]="TEXTAREA",s[s.GUTTER_GLYPH_MARGIN=2]="GUTTER_GLYPH_MARGIN",s[s.GUTTER_LINE_NUMBERS=3]="GUTTER_LINE_NUMBERS",s[s.GUTTER_LINE_DECORATIONS=4]="GUTTER_LINE_DECORATIONS",s[s.GUTTER_VIEW_ZONE=5]="GUTTER_VIEW_ZONE",s[s.CONTENT_TEXT=6]="CONTENT_TEXT",s[s.CONTENT_EMPTY=7]="CONTENT_EMPTY",s[s.CONTENT_VIEW_ZONE=8]="CONTENT_VIEW_ZONE",s[s.CONTENT_WIDGET=9]="CONTENT_WIDGET",s[s.OVERVIEW_RULER=10]="OVERVIEW_RULER",s[s.SCROLLBAR=11]="SCROLLBAR",s[s.OVERLAY_WIDGET=12]="OVERLAY_WIDGET",s[s.OUTSIDE_EDITOR=13]="OUTSIDE_EDITOR"})(Hs||(Hs={}));var zs;(function(s){s[s.Idle=0]="Idle",s[s.ComputingDiff=1]="ComputingDiff",s[s.DiffComputed=2]="DiffComputed"})(zs||(zs={}));function gt(s){return s&&typeof s.getEditorType=="function"?s.getEditorType()===fn.ICodeEditor:!1}function Qr(s){return s&&typeof s.getEditorType=="function"?s.getEditorType()===fn.IDiffEditor:!1}function Fl(s){return!!s&&typeof s=="object"&&typeof s.onDidChangeActiveEditor=="function"}function gu(s){return gt(s)?s:Qr(s)?s.getModifiedEditor():Fl(s)&&gt(s.activeCodeEditor)?s.activeCodeEditor:null}function pu(s){return gt(s)||Qr(s)?s:null}var fe;const Ol=new p("workbenchState",void 0,{type:"string",description:c(3806,"The kind of workspace opened in the window, either 'empty' (no workspace), 'folder' (single folder) or 'workspace' (multi-root workspace)")}),Il=new p("workspaceFolderCount",0,c(3807,"The number of root folders in the workspace")),kl=new p("openFolderWorkspaceSupport",!0,!0),Al=new p("enterMultiRootWorkspaceSupport",!0,!0),Tl=new p("emptyWorkspaceSupport",!0,!0),xl=new p("dirtyWorkingCopies",!1,c(3808,"Whether there are any working copies with unsaved changes")),Pl=new p("remoteName","",c(3809,"The name of the remote the window is connected to or an empty string if not connected to any remote")),Ll=new p("virtualWorkspace","",c(3810,"The scheme of the current workspace is from a virtual file system or an empty string.")),io=new p("temporaryWorkspace",!1,c(3811,"The scheme of the current workspace is from a temporary file system.")),Nl=new p("hasWebFileSystemAccess",!1,!0),Wl=new p("embedderIdentifier",void 0,c(3812,"The identifier of the embedder according to the product service, if one is defined")),Ul=new p("isSandboxWorkspace",!1,!0),Ml=new p("isFullscreen",!1,c(3813,"Whether the main window is in fullscreen mode")),Bl=new p("isAuxiliaryWindowFocusedContext",!1,c(3814,"Whether an auxiliary window is focused")),vu=new p("isAuxiliaryWindow",!1,c(3815,"Window is an auxiliary window")),wu=new p("activeEditorIsDirty",!1,c(3816,"Whether the active editor has unsaved changes")),Su=new p("activeEditorIsNotPreview",!1,c(3817,"Whether the active editor is not in preview mode")),Cu=new p("activeEditorIsFirstInGroup",!1,c(3818,"Whether the active editor is the first one in its group")),Eu=new p("activeEditorIsLastInGroup",!1,c(3819,"Whether the active editor is the last one in its group")),yu=new p("activeEditorIsPinned",!1,c(3820,"Whether the active editor is pinned")),mu=new p("activeEditorIsReadonly",!1,c(3821,"Whether the active editor is read-only")),Ru=new p("activeCompareEditorCanSwap",!1,c(3822,"Whether the active compare editor can swap sides")),_u=new p("activeEditorCanToggleReadonly",!0,c(3823,"Whether the active editor can toggle between being read-only or writeable")),Du=new p("activeEditorCanRevert",!1,c(3824,"Whether the active editor can revert")),bu=new p("activeEditorCanSplitInGroup",!0),Vl=new p("activeEditor",null,{type:"string",description:c(3825,"The identifier of the active editor")}),Fu=new p("activeEditorAvailableEditorIds","",c(3826,"The available editor identifiers that are usable for the active editor")),Ou=new p("textCompareEditorVisible",!1,c(3827,"Whether a text compare editor is visible")),Iu=new p("textCompareEditorActive",!1,c(3828,"Whether a text compare editor is active")),ku=new p("sideBySideEditorActive",!1,c(3829,"Whether a side by side editor is active")),Au=new p("groupEditorsCount",0,c(3830,"The number of opened editor groups")),Gl=new p("activeEditorGroupEmpty",!1,c(3831,"Whether the active editor group is empty")),Kl=new p("activeEditorGroupIndex",0,c(3832,"The index of the active editor group")),Hl=new p("activeEditorGroupLast",!1,c(3833,"Whether the active editor group is the last group")),zl=new p("activeEditorGroupLocked",!1,c(3834,"Whether the active editor group is locked")),$l=new p("multipleEditorGroups",!1,c(3835,"Whether there are multiple editor groups opened")),Tu=new p("multipleEditorsSelectedInGroup",!1,c(3836,"Whether multiple editors have been selected in an editor group")),xu=new p("twoEditorsSelectedInGroup",!1,c(3837,"Whether exactly two editors have been selected in an editor group")),Pu=new p("SelectedEditorsInGroupFileOrUntitledResourceContextKey",!0,c(3838,"Whether all selected editors in a group have a file or untitled resource associated")),Lu=new p("editorPartMultipleEditorGroups",!1,c(3839,"Whether there are multiple editor groups opened in an editor part")),Nu=new p("editorPartMaximizedEditorGroup",!1,c(3840,"Editor Part has a maximized group")),Yl=new p("editorIsOpen",!1,c(3841,"Whether an editor is open")),jl=new p("inZenMode",!1,c(3842,"Whether Zen mode is enabled")),ql=new p("isCenteredLayout",!1,c(3843,"Whether centered layout is enabled for the main editor")),Xl=new p("splitEditorsVertically",!1,c(3844,"Whether editors split vertically")),Jl=new p("mainEditorAreaVisible",!0,c(3845,"Whether the editor area in the main window is visible")),Ql=new p("editorTabsVisible",!0,c(3846,"Whether editor tabs are visible")),Zl=new p("sideBarVisible",!1,c(3847,"Whether the sidebar is visible")),Wu=new p("sideBarFocus",!1,c(3848,"Whether the sidebar has keyboard focus")),Uu=new p("activeViewlet","",c(3849,"The identifier of the active viewlet")),Mu=new p("statusBarFocused",!1,c(3850,"Whether the status bar has keyboard focus")),ed=new p("titleBarStyle","custom",c(3851,"Style of the window title bar")),td=new p("titleBarVisible",!1,c(3852,"Whether the title bar is visible")),Bu=new p("isCompactTitleBar",!1,c(3853,"Title bar is in compact mode")),Vu=new p("bannerFocused",!1,c(3854,"Whether the banner has keyboard focus")),Gu=new p("notificationFocus",!0,c(3855,"Whether a notification has keyboard focus")),Ku=new p("notificationCenterVisible",!1,c(3856,"Whether the notifications center is visible")),Hu=new p("notificationToastsVisible",!1,c(3857,"Whether a notification toast is visible")),zu=new p("activeAuxiliary","",c(3858,"The identifier of the active auxiliary panel")),$u=new p("auxiliaryBarFocus",!1,c(3859,"Whether the auxiliary bar has keyboard focus")),id=new p("auxiliaryBarVisible",!1,c(3860,"Whether the auxiliary bar is visible")),Yu=new p("activePanel","",c(3861,"The identifier of the active panel")),ju=new p("panelFocus",!1,c(3862,"Whether the panel has keyboard focus")),rd=new p("panelPosition","bottom",c(3863,"The position of the panel, always 'bottom'")),sd=new p("panelAlignment","center",c(3864,"The alignment of the panel, either 'center', 'left', 'right' or 'justify'")),nd=new p("panelVisible",!1,c(3865,"Whether the panel is visible")),od=new p("panelMaximized",!1,c(3866,"Whether the panel is maximized")),qu=new p("focusedView","",c(3867,"The identifier of the view that has keyboard focus"));function Xu(s){return`view.${s}.visible`}let tr=class{static{fe=this}static{this.Scheme=new p("resourceScheme",void 0,{type:"string",description:c(3868,"The scheme of the resource")})}static{this.Filename=new p("resourceFilename",void 0,{type:"string",description:c(3869,"The file name of the resource")})}static{this.Dirname=new p("resourceDirname",void 0,{type:"string",description:c(3870,"The folder name the resource is contained in")})}static{this.Path=new p("resourcePath",void 0,{type:"string",description:c(3871,"The full path of the resource")})}static{this.LangId=new p("resourceLangId",void 0,{type:"string",description:c(3872,"The language identifier of the resource")})}static{this.Resource=new p("resource",void 0,{type:"URI",description:c(3873,"The full value of the resource including scheme and path")})}static{this.Extension=new p("resourceExtname",void 0,{type:"string",description:c(3874,"The extension name of the resource")})}static{this.HasResource=new p("resourceSet",void 0,{type:"boolean",description:c(3875,"Whether a resource is present or not")})}static{this.IsFileSystemResource=new p("isFileSystemResource",void 0,{type:"boolean",description:c(3876,"Whether the resource is backed by a file system provider")})}constructor(e,t,i,r){this._contextKeyService=e,this._fileService=t,this._languageService=i,this._modelService=r,this._disposables=new he,this._schemeKey=fe.Scheme.bindTo(this._contextKeyService),this._filenameKey=fe.Filename.bindTo(this._contextKeyService),this._dirnameKey=fe.Dirname.bindTo(this._contextKeyService),this._pathKey=fe.Path.bindTo(this._contextKeyService),this._langIdKey=fe.LangId.bindTo(this._contextKeyService),this._resourceKey=fe.Resource.bindTo(this._contextKeyService),this._extensionKey=fe.Extension.bindTo(this._contextKeyService),this._hasResource=fe.HasResource.bindTo(this._contextKeyService),this._isFileSystemResource=fe.IsFileSystemResource.bindTo(this._contextKeyService),this._disposables.add(t.onDidChangeFileSystemProviderRegistrations(()=>{const n=this.get();this._isFileSystemResource.set(!!(n&&t.hasProvider(n)))})),this._disposables.add(r.onModelAdded(n=>{Ye(n.uri,this.get())&&this._setLangId()})),this._disposables.add(r.onModelLanguageChanged(n=>{Ye(n.model.uri,this.get())&&this._setLangId()}))}dispose(){this._disposables.dispose()}_setLangId(){const e=this.get();if(!e){this._langIdKey.set(null);return}const t=this._modelService.getModel(e)?.getLanguageId()??this._languageService.guessLanguageIdByFilepathOrFirstLine(e);this._langIdKey.set(t)}set(e){e=e??void 0,!Ye(this._value,e)&&(this._value=e,this._contextKeyService.bufferChangeEvents(()=>{this._resourceKey.set(e?e.toString():null),this._schemeKey.set(e?e.scheme:null),this._filenameKey.set(e?ee(e):null),this._dirnameKey.set(e?this.uriToPath(ht(e)):null),this._pathKey.set(e?this.uriToPath(e):null),this._setLangId(),this._extensionKey.set(e?Tr(e):null),this._hasResource.set(!!e),this._isFileSystemResource.set(e?this._fileService.hasProvider(e):!1)}))}uriToPath(e){return e.scheme===k.file?e.fsPath:e.path}reset(){this._value=void 0,this._contextKeyService.bufferChangeEvents(()=>{this._resourceKey.reset(),this._schemeKey.reset(),this._filenameKey.reset(),this._dirnameKey.reset(),this._pathKey.reset(),this._langIdKey.reset(),this._extensionKey.reset(),this._hasResource.reset(),this._isFileSystemResource.reset()})}get(){return this._value}};tr=fe=x([u(0,xr),u(1,te),u(2,Be),u(3,Ve)],tr);function Qu(s,e,t){if(!e){s.set("");return}const i=e.resource;if(i?.scheme===k.untitled&&e.editorId!==cl.id)s.set("");else{const r=i?t.getEditors(i).map(n=>n.id):[];s.set(r.join(","))}}const ad="modulepreload",cd=function(s,e){return new URL(s,e).href},$s={},Fi=function(e,t,i){let r=Promise.resolve();if(t&&t.length>0){let d=function(f){return Promise.all(f.map(h=>Promise.resolve(h).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");r=d(t.map(f=>{if(f=cd(f,i),f in $s)return;$s[f]=!0;const h=f.endsWith(".css"),g=h?'[rel="stylesheet"]':"";if(!!i)for(let m=o.length-1;m>=0;m--){const N=o[m];if(N.href===f&&(!h||N.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${g}`))return;const w=document.createElement("link");if(w.rel=h?"stylesheet":ad,h||(w.as="script"),w.crossOrigin="",w.href=f,l&&w.setAttribute("nonce",l),document.head.appendChild(w),h)return new Promise((m,N)=>{w.addEventListener("load",m),w.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${f}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},G="utf8",Oe="utf8bom",Qe="utf16be",Ze="utf16le",qt=[254,255],ir=[255,254],bt=[239,187,191],ld=512,dd=512,hd=512*8,ud=512*128;var ci;(function(s){s[s.STREAM_IS_BINARY=1]="STREAM_IS_BINARY"})(ci||(ci={}));class fd extends Error{constructor(e,t){super(e),this.decodeStreamErrorKind=t}}class Zr{static async create(e){let t;if(e!==G)t=(await Fi(()=>import("./iconv-lite-umd-C_009vke.js").then(r=>r.i),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default??r)).getDecoder(es(e));else{const i=new TextDecoder;t={write(r){return i.decode(r,{stream:!0})},end(){return i.decode()}}}return new Zr(t)}constructor(e){this.iconvLiteDecoder=e}write(e){return this.iconvLiteDecoder.write(e)}end(){return this.iconvLiteDecoder.end()}}function gd(s,e){const t=e.minBytesRequiredForDetection??e.guessEncoding?hd:dd;return new Promise((i,r)=>{const n=wt(h=>h.join("")),o=[];let a=0,l;const d=new Ut,f=async()=>{try{const h=await _d({buffer:_.concat(o),bytesRead:a},e.guessEncoding,e.candidateGuessEncodings);if(h.seemsBinary&&e.acceptTextOnly)throw new fd("Stream is binary but only text is accepted for decoding",ci.STREAM_IS_BINARY);h.encoding=await e.overwriteEncoding(h.encoding),l=await Zr.create(h.encoding);const g=l.write(_.concat(o).buffer);n.write(g),o.length=0,a=0,i({stream:n,detected:h})}catch(h){d.cancel(),n.destroy(),r(h)}};Pr(s,{onData:async h=>{l?n.write(l.write(h.buffer)):(o.push(h),a+=h.byteLength,a>=t&&(s.pause(),await f(),setTimeout(()=>s.resume())))},onError:h=>n.error(h),onEnd:async()=>{l||await f(),n.end(l?.end())}},d.token)})}async function pd(s,e,t){const r=(await Fi(()=>import("./iconv-lite-umd-C_009vke.js").then(a=>a.i),__vite__mapDeps([0,1]),import.meta.url).then(a=>a.default??a)).getEncoder(es(e),t);let n=!1,o=!1;return{read(){if(o)return null;const a=s.read();if(typeof a!="string"){if(o=!0,!n&&t?.addBOM)switch(e){case G:case Oe:return _.wrap(Uint8Array.from(bt));case Qe:return _.wrap(Uint8Array.from(qt));case Ze:return _.wrap(Uint8Array.from(ir))}const l=r.end();return l&&l.length>0?(n=!0,_.wrap(l)):null}return n=!0,_.wrap(r.write(a))}}}async function vd(s){return(await Fi(()=>import("./iconv-lite-umd-C_009vke.js").then(t=>t.i),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.default??t)).encodingExists(es(s))}function es(s){return s===Oe||s===null?G:s}function wd(s,e){if(!s||e<qt.length)return null;const t=s.readUInt8(0),i=s.readUInt8(1);if(t===qt[0]&&i===qt[1])return Qe;if(t===ir[0]&&i===ir[1])return Ze;if(e<bt.length)return null;const r=s.readUInt8(2);return t===bt[0]&&i===bt[1]&&r===bt[2]?Oe:null}const Sd=["ascii","utf-16","utf-32"];async function Cd(s,e){const t=await Fi(()=>import("./index-R5Ow2ahL.js").then(a=>a.i),__vite__mapDeps([2,1,3]),import.meta.url).then(a=>a.default??a),i=s.slice(0,ud),r=Rd(i.buffer);e&&(e=gn(e.map(a=>md(a))),e.length===0&&(e=void 0));let n;try{n=t.detect(r,e?{detectEncodings:e}:void 0)}catch{return null}if(!n||!n.encoding)return null;const o=n.encoding.toLowerCase();return 0<=Sd.indexOf(o)?null:yd(n.encoding)}const Ed={ibm866:"cp866",big5:"cp950"};function ro(s){return s.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}function yd(s){const e=ro(s);return Ed[e]||e}function md(s){const e=ro(s),t=Xt[e];return t?t.guessableName:void 0}function Rd(s){let e="";for(let t=0;t<s.length;t++)e+=String.fromCharCode(s[t]);return e}function _d({buffer:s,bytesRead:e},t,i){let r=wd(s,e),n=!1;if(r!==Qe&&r!==Ze&&s){let o=!0,a=!0,l=!1;for(let d=0;d<e&&d<ld;d++){const f=d%2===1,h=s.readUInt8(d)===0;if(h&&(l=!0),o&&(f&&!h||!f&&h)&&(o=!1),a&&(f&&h||!f&&!h)&&(a=!1),h&&!o&&!a)break}l&&(o?r=Ze:a?r=Qe:n=!0)}return t&&!n&&!r&&s?Cd(s.slice(0,e),i).then(o=>({seemsBinary:!1,encoding:o})):{seemsBinary:n,encoding:r}}const Ne={utf8:{labelLong:"UTF-8",labelShort:"UTF-8",order:1,alias:"utf8bom",guessableName:"UTF-8"},utf8bom:{labelLong:"UTF-8 with BOM",labelShort:"UTF-8 with BOM",encodeOnly:!0,order:2,alias:"utf8"},utf16le:{labelLong:"UTF-16 LE",labelShort:"UTF-16 LE",order:3,guessableName:"UTF-16LE"},utf16be:{labelLong:"UTF-16 BE",labelShort:"UTF-16 BE",order:4,guessableName:"UTF-16BE"},windows1252:{labelLong:"Western (Windows 1252)",labelShort:"Windows 1252",order:5,guessableName:"windows-1252"},iso88591:{labelLong:"Western (ISO 8859-1)",labelShort:"ISO 8859-1",order:6},iso88593:{labelLong:"Western (ISO 8859-3)",labelShort:"ISO 8859-3",order:7},iso885915:{labelLong:"Western (ISO 8859-15)",labelShort:"ISO 8859-15",order:8},macroman:{labelLong:"Western (Mac Roman)",labelShort:"Mac Roman",order:9},cp437:{labelLong:"DOS (CP 437)",labelShort:"CP437",order:10},windows1256:{labelLong:"Arabic (Windows 1256)",labelShort:"Windows 1256",order:11},iso88596:{labelLong:"Arabic (ISO 8859-6)",labelShort:"ISO 8859-6",order:12},windows1257:{labelLong:"Baltic (Windows 1257)",labelShort:"Windows 1257",order:13},iso88594:{labelLong:"Baltic (ISO 8859-4)",labelShort:"ISO 8859-4",order:14},iso885914:{labelLong:"Celtic (ISO 8859-14)",labelShort:"ISO 8859-14",order:15},windows1250:{labelLong:"Central European (Windows 1250)",labelShort:"Windows 1250",order:16,guessableName:"windows-1250"},iso88592:{labelLong:"Central European (ISO 8859-2)",labelShort:"ISO 8859-2",order:17,guessableName:"ISO-8859-2"},cp852:{labelLong:"Central European (CP 852)",labelShort:"CP 852",order:18},windows1251:{labelLong:"Cyrillic (Windows 1251)",labelShort:"Windows 1251",order:19,guessableName:"windows-1251"},cp866:{labelLong:"Cyrillic (CP 866)",labelShort:"CP 866",order:20,guessableName:"IBM866"},cp1125:{labelLong:"Cyrillic (CP 1125)",labelShort:"CP 1125",order:21,guessableName:"IBM1125"},iso88595:{labelLong:"Cyrillic (ISO 8859-5)",labelShort:"ISO 8859-5",order:22,guessableName:"ISO-8859-5"},koi8r:{labelLong:"Cyrillic (KOI8-R)",labelShort:"KOI8-R",order:23,guessableName:"KOI8-R"},koi8u:{labelLong:"Cyrillic (KOI8-U)",labelShort:"KOI8-U",order:24},iso885913:{labelLong:"Estonian (ISO 8859-13)",labelShort:"ISO 8859-13",order:25},windows1253:{labelLong:"Greek (Windows 1253)",labelShort:"Windows 1253",order:26,guessableName:"windows-1253"},iso88597:{labelLong:"Greek (ISO 8859-7)",labelShort:"ISO 8859-7",order:27,guessableName:"ISO-8859-7"},windows1255:{labelLong:"Hebrew (Windows 1255)",labelShort:"Windows 1255",order:28,guessableName:"windows-1255"},iso88598:{labelLong:"Hebrew (ISO 8859-8)",labelShort:"ISO 8859-8",order:29,guessableName:"ISO-8859-8"},iso885910:{labelLong:"Nordic (ISO 8859-10)",labelShort:"ISO 8859-10",order:30},iso885916:{labelLong:"Romanian (ISO 8859-16)",labelShort:"ISO 8859-16",order:31},windows1254:{labelLong:"Turkish (Windows 1254)",labelShort:"Windows 1254",order:32},iso88599:{labelLong:"Turkish (ISO 8859-9)",labelShort:"ISO 8859-9",order:33},windows1258:{labelLong:"Vietnamese (Windows 1258)",labelShort:"Windows 1258",order:34},gbk:{labelLong:"Simplified Chinese (GBK)",labelShort:"GBK",order:35},gb18030:{labelLong:"Simplified Chinese (GB18030)",labelShort:"GB18030",order:36},cp950:{labelLong:"Traditional Chinese (Big5)",labelShort:"Big5",order:37,guessableName:"Big5"},big5hkscs:{labelLong:"Traditional Chinese (Big5-HKSCS)",labelShort:"Big5-HKSCS",order:38},shiftjis:{labelLong:"Japanese (Shift JIS)",labelShort:"Shift JIS",order:39,guessableName:"SHIFT_JIS"},eucjp:{labelLong:"Japanese (EUC-JP)",labelShort:"EUC-JP",order:40,guessableName:"EUC-JP"},euckr:{labelLong:"Korean (EUC-KR)",labelShort:"EUC-KR",order:41,guessableName:"EUC-KR"},windows874:{labelLong:"Thai (Windows 874)",labelShort:"Windows 874",order:42},iso885911:{labelLong:"Latin/Thai (ISO 8859-11)",labelShort:"ISO 8859-11",order:43},koi8ru:{labelLong:"Cyrillic (KOI8-RU)",labelShort:"KOI8-RU",order:44},koi8t:{labelLong:"Tajik (KOI8-T)",labelShort:"KOI8-T",order:45},gb2312:{labelLong:"Simplified Chinese (GB 2312)",labelShort:"GB 2312",order:46,guessableName:"GB2312"},cp865:{labelLong:"Nordic DOS (CP 865)",labelShort:"CP 865",order:47},cp850:{labelLong:"Western European DOS (CP 850)",labelShort:"CP 850",order:48}},Xt=(()=>{const s={};for(const e in Ne)Ne[e].guessableName&&(s[e]=Ne[e]);return s})();var li;(function(s){s[s.FILE_IS_BINARY=0]="FILE_IS_BINARY"})(li||(li={}));class Dd extends re{static isTextFileOperationError(e){return e instanceof Error&&!ii(e.textFileOperationResult)}constructor(e,t,i){super(e,L.FILE_OTHER_ERROR),this.textFileOperationResult=t,this.options=i}}var J;(function(s){s[s.SAVED=0]="SAVED",s[s.DIRTY=1]="DIRTY",s[s.PENDING_SAVE=2]="PENDING_SAVE",s[s.CONFLICT=3]="CONFLICT",s[s.ORPHAN=4]="ORPHAN",s[s.ERROR=5]="ERROR"})(J||(J={}));var rr;(function(s){s[s.EDITOR=1]="EDITOR",s[s.REFERENCE=2]="REFERENCE",s[s.OTHER=3]="OTHER"})(rr||(rr={}));var sr;(function(s){s[s.Encode=0]="Encode",s[s.Decode=1]="Decode"})(sr||(sr={}));function bd(s){let e=!1;return{read(){return e?null:(e=!0,s)}}}function Fd(s){if(!(typeof s>"u"))return typeof s=="string"?_.fromString(s):{read:()=>{const e=s.read();return typeof e=="string"?_.fromString(e):null}}}var F;(function(s){s.Unknown="unknown",s.Env="env",s.Config="config",s.Command="command",s.Input="input",s.ExtensionInstallFolder="extensionInstallFolder",s.WorkspaceFolder="workspaceFolder",s.Cwd="cwd",s.WorkspaceFolderBasename="workspaceFolderBasename",s.UserHome="userHome",s.LineNumber="lineNumber",s.ColumnNumber="columnNumber",s.SelectedText="selectedText",s.File="file",s.FileWorkspaceFolder="fileWorkspaceFolder",s.FileWorkspaceFolderBasename="fileWorkspaceFolderBasename",s.RelativeFile="relativeFile",s.RelativeFileDirname="relativeFileDirname",s.FileDirname="fileDirname",s.FileExtname="fileExtname",s.FileBasename="fileBasename",s.FileBasenameNoExtension="fileBasenameNoExtension",s.FileDirnameBasename="fileDirnameBasename",s.ExecPath="execPath",s.ExecInstallFolder="execInstallFolder",s.PathSeparator="pathSeparator",s.PathSeparatorAlias="/"})(F||(F={}));const Od=Object.values(F).filter(s=>typeof s=="string");class M extends Lr{constructor(e,t){super(t),this.variable=e}}class et{static{this.VARIABLE_LHS="${"}constructor(e){this.locations=new Map,this.newReplacementNotifiers=new Set,typeof e=="string"?(this.stringRoot=!0,this.root={value:e}):(this.stringRoot=!1,this.root=structuredClone(e))}static parse(e){if(e instanceof et)return e;const t=new et(e);return t.applyPlatformSpecificKeys(),t.parseObject(t.root),t}applyPlatformSpecificKeys(){const e=this.root,t=pt?"windows":Nr?"osx":ri?"linux":void 0;t&&e&&typeof e=="object"&&e.hasOwnProperty(t)&&Object.keys(e[t]).forEach(i=>e[i]=e[t][i]),delete e.windows,delete e.osx,delete e.linux}parseVariable(e,t){if(e[t]!=="$"||e[t+1]!=="{")return;let i=t+2,r=1;for(;i<e.length;){if(e[i]==="{")r++;else if(e[i]==="}"&&(r--,r===0))break;i++}if(r!==0)return;const n=e.slice(t,i+1),o=e.substring(t+2,i),a=o.indexOf(":");return a===-1?{replacement:{id:n,name:o,inner:o},end:i}:{replacement:{id:n,inner:o,name:o.slice(0,a),arg:o.slice(a+1)},end:i}}parseObject(e){if(!(typeof e!="object"||e===null)){if(Array.isArray(e)){for(let t=0;t<e.length;t++){const i=e[t];typeof i=="string"?this.parseString(e,t,i):this.parseObject(i)}return}for(const[t,i]of Object.entries(e))this.parseString(e,t,t,!0),typeof i=="string"?this.parseString(e,t,i):this.parseObject(i)}}parseString(e,t,i,r,n){let o=0;for(;o<i.length;){const a=i.indexOf("${",o);if(a===-1)break;const l=this.parseVariable(i,a);if(l){if(o=l.end+1,n?.includes(l.replacement.id))continue;const d=this.locations.get(l.replacement.id)||{locations:[],replacement:l.replacement},f={object:e,propertyName:t,replaceKeyName:r};d.locations.push(f),this.locations.set(l.replacement.id,d),d.resolved?this._resolveAtLocation(l.replacement,f,d.resolved,n):this.newReplacementNotifiers.forEach(h=>h(l.replacement))}else o=a+2}}*unresolved(){const e=new Map,t=i=>{e.set(i.id,i)};for(const i of this.locations.values())i.resolved===void 0&&e.set(i.replacement.id,i.replacement);for(this.newReplacementNotifiers.add(t);;){const i=ct.first(e);if(!i)break;const[r,n]=i;yield n,e.delete(r)}this.newReplacementNotifiers.delete(t)}resolved(){return ct.map(ct.filter(this.locations.values(),e=>!!e.resolved),e=>[e.replacement,e.resolved])}resolve(e,t){typeof t!="object"&&(t={value:String(t)});const i=this.locations.get(e.id);if(i&&(i.resolved=t,t.value!==void 0))for(const r of i.locations||ct.empty())this._resolveAtLocation(e,r,t)}_resolveAtLocation(e,{replaceKeyName:t,propertyName:i,object:r},n,o=[]){if(n.value!==void 0){if(o.push(e.id),t&&typeof i=="string"){const a=r[i],l=i.replaceAll(e.id,n.value);delete r[i],r[l]=a,this._renameKeyInLocations(r,i,l),this.parseString(r,l,n.value,!0,o)}else r[i]=r[i].replaceAll(e.id,n.value),this.parseString(r,i,n.value,!1,o);o.pop()}}_renameKeyInLocations(e,t,i){for(const r of this.locations.values())for(const n of r.locations)n.object===e&&n.propertyName===t&&(n.propertyName=i)}toObject(){return this.stringRoot?this.root.value:this.root}}class Id{constructor(e,t,i,r){this._contributedVariables=new Map,this.resolvableVariables=new Set(Od),this._context=e,this._labelService=t,this._userHomePromise=i,r&&(this._envVariablesPromise=r.then(n=>this.prepareEnv(n)))}prepareEnv(e){if(pt){const t=Object.create(null);return Object.keys(e).forEach(i=>{t[i.toLowerCase()]=e[i]}),t}return e}async resolveWithEnvironment(e,t,i){const r=et.parse(i);for(const n of r.unresolved()){const o=await this.evaluateSingleVariable(n,t?.uri,e);o!==void 0&&r.resolve(n,String(o))}return r.toObject()}async resolveAsync(e,t){const i=et.parse(t);for(const r of i.unresolved()){const n=await this.evaluateSingleVariable(r,e?.uri);n!==void 0&&i.resolve(r,String(n))}return i.toObject()}resolveWithInteractionReplace(e,t){throw new Error("resolveWithInteractionReplace not implemented.")}resolveWithInteraction(e,t){throw new Error("resolveWithInteraction not implemented.")}contributeVariable(e,t){if(this._contributedVariables.has(e))throw new Error("Variable "+e+" is contributed twice.");this.resolvableVariables.add(e),this._contributedVariables.set(e,t)}fsPath(e){return this._labelService?this._labelService.getUriLabel(e,{noPrefix:!0}):e.fsPath}async evaluateSingleVariable(e,t,i,r){const n={env:i!==void 0?this.prepareEnv(i):await this._envVariablesPromise,userHome:i!==void 0?void 0:await this._userHomePromise},{name:o,arg:a}=e,l=h=>{const g=this._context.getFilePath();if(g)return nt(g);throw new M(h,c(12402,"Variable {0} can not be resolved. Please open an editor.",e.id))},d=h=>{const g=l(h);if(this._context.getWorkspaceFolderPathForFile){const S=this._context.getWorkspaceFolderPathForFile();if(S)return nt(S)}throw new M(h,c(12403,"Variable {0}: can not find workspace folder of '{1}'.",e.id,Pe(g)))},f=h=>{if(a){const g=this._context.getFolderUri(a);if(g)return g;throw new M(h,c(12404,"Variable {0} can not be resolved. No such folder '{1}'.",h,a))}if(t)return t;throw this._context.getWorkspaceFolderCount()>1?new M(h,c(12405,"Variable {0} can not be resolved in a multi folder workspace. Scope this variable using ':' and a workspace folder name.",h)):new M(h,c(12406,"Variable {0} can not be resolved. Please open a folder.",h))};switch(o){case"env":if(a){if(n.env){const h=n.env[pt?a.toLowerCase():a];if(xe(h))return h}return""}throw new M(F.Env,c(12407,"Variable {0} can not be resolved because no environment variable name is given.",e.id));case"config":if(a){const h=this._context.getConfigurationValue(t,a);if(ii(h))throw new M(F.Config,c(12408,"Variable {0} can not be resolved because setting '{1}' not found.",e.id,a));if(Wr(h))throw new M(F.Config,c(12409,"Variable {0} can not be resolved because '{1}' is a structured value.",e.id,a));return h}throw new M(F.Config,c(12410,"Variable {0} can not be resolved because no settings name is given.",e.id));case"command":return this.resolveFromMap(F.Command,e.id,a,r,"command");case"input":return this.resolveFromMap(F.Input,e.id,a,r,"input");case"extensionInstallFolder":if(a){const h=await this._context.getExtension(a);if(!h)throw new M(F.ExtensionInstallFolder,c(12411,"Variable {0} can not be resolved because the extension {1} is not installed.",e.id,a));return this.fsPath(h.extensionLocation)}throw new M(F.ExtensionInstallFolder,c(12412,"Variable {0} can not be resolved because no extension name is given.",e.id));default:switch(o){case"workspaceRoot":case"workspaceFolder":{const h=f(F.WorkspaceFolder);return h?nt(this.fsPath(h)):void 0}case"cwd":{if(!t&&!a)return Vo();const h=f(F.Cwd);return h?nt(this.fsPath(h)):void 0}case"workspaceRootFolderName":case"workspaceFolderBasename":{const h=f(F.WorkspaceFolderBasename);return h?nt(Pe(this.fsPath(h))):void 0}case"userHome":if(n.userHome)return n.userHome;throw new M(F.UserHome,c(12413,"Variable {0} can not be resolved. UserHome path is not defined",e.id));case"lineNumber":{const h=this._context.getLineNumber();if(h)return h;throw new M(F.LineNumber,c(12414,"Variable {0} can not be resolved. Make sure to have a line selected in the active editor.",e.id))}case"columnNumber":{const h=this._context.getColumnNumber();if(h)return h;throw new Error(c(12415,"Variable {0} can not be resolved. Make sure to have a column selected in the active editor.",e.id))}case"selectedText":{const h=this._context.getSelectedText();if(h)return h;throw new M(F.SelectedText,c(12416,"Variable {0} can not be resolved. Make sure to have some text selected in the active editor.",e.id))}case"file":return l(F.File);case"fileWorkspaceFolder":return d(F.FileWorkspaceFolder);case"fileWorkspaceFolderBasename":return Pe(d(F.FileWorkspaceFolderBasename));case"relativeFile":return t||a?ss(this.fsPath(f(F.RelativeFile)),l(F.RelativeFile)):l(F.RelativeFile);case"relativeFileDirname":{const h=Ai(l(F.RelativeFileDirname));if(t||a){const g=ss(this.fsPath(f(F.RelativeFileDirname)),h);return g.length===0?".":g}return h}case"fileDirname":return Ai(l(F.FileDirname));case"fileExtname":return si(l(F.FileExtname));case"fileBasename":return Pe(l(F.FileBasename));case"fileBasenameNoExtension":{const h=Pe(l(F.FileBasenameNoExtension));return h.slice(0,h.length-si(h).length)}case"fileDirnameBasename":return Pe(Ai(l(F.FileDirnameBasename)));case"execPath":{const h=this._context.getExecPath();return h||e.id}case"execInstallFolder":{const h=this._context.getAppRoot();return h||e.id}case"pathSeparator":case"/":return Bo;default:try{return this.resolveFromMap(F.Unknown,e.id,a,r,void 0)}catch{return e.id}}}}resolveFromMap(e,t,i,r,n){if(i&&r){const o=n===void 0?r[i]:r[n+":"+i];if(typeof o=="string")return o;throw new M(e,c(12417,"Variable {0} can not be resolved because the command has no value.",t))}return t}}const kd=Object.freeze({id:"workbench",order:7,title:c(3797,"Workbench"),type:"object"}),Ad=Object.freeze({id:"security",scope:E.APPLICATION,title:c(3798,"Security"),type:"object",order:7}),Zu=Object.freeze({id:"problems",title:c(3799,"Problems"),type:"object",order:101}),Td=Object.freeze({id:"window",order:8,title:c(3800,"Window"),type:"object"}),xd={ConfigurationMigration:"base.contributions.configuration.migration"};class Pd{constructor(){this.migrations=[],this._onDidRegisterConfigurationMigrations=new v,this.onDidRegisterConfigurationMigration=this._onDidRegisterConfigurationMigrations.event}registerConfigurationMigrations(e){this.migrations.push(...e)}}const Jt=new Pd;W.add(xd.ConfigurationMigration,Jt);let Ys=class extends D{static{this.ID="workbench.contrib.configurationMigration"}constructor(e,t){super(),this.configurationService=e,this.workspaceService=t,this._register(this.workspaceService.onDidChangeWorkspaceFolders(async i=>{for(const r of i.added)await this.migrateConfigurationsForFolder(r,Jt.migrations)})),this.migrateConfigurations(Jt.migrations),this._register(Jt.onDidRegisterConfigurationMigration(i=>this.migrateConfigurations(i)))}async migrateConfigurations(e){await this.migrateConfigurationsForFolder(void 0,e);for(const t of this.workspaceService.getWorkspace().folders)await this.migrateConfigurationsForFolder(t,e)}async migrateConfigurationsForFolder(e,t){await Promise.all([t.map(i=>this.migrateConfigurationsForFolderAndOverride(i,e?.uri))])}async migrateConfigurationsForFolderAndOverride(e,t){const i=this.configurationService.inspect(e.key,{resource:t}),r=this.workspaceService.getWorkbenchState()===O.WORKSPACE?[["user",C.USER],["userLocal",C.USER_LOCAL],["userRemote",C.USER_REMOTE],["workspace",C.WORKSPACE],["workspaceFolder",C.WORKSPACE_FOLDER]]:[["user",C.USER],["userLocal",C.USER_LOCAL],["userRemote",C.USER_REMOTE],["workspace",C.WORKSPACE]];for(const[n,o]of r){const a=i[n];if(!a)continue;const l=[];if(a.value!==void 0){const d=await this.runMigration(e,n,a.value,t,void 0);for(const f of d??[])l.push([f,[]])}for(const{identifiers:d,value:f}of a.overrides??[])if(f!==void 0){const h=await this.runMigration(e,n,f,t,d);for(const g of h??[])l.push([g,d])}l.length&&await Promise.allSettled(l.map(async([[d,f],h])=>this.configurationService.updateValue(d,f.value,{resource:t,overrideIdentifiers:h},o)))}}async runMigration(e,t,i,r,n){const o=l=>{const f=this.configurationService.inspect(l,{resource:r})[t];if(f)return n?f.overrides?.find(({identifiers:h})=>_e(h,n))?.value:f.value},a=await e.migrateFn(i,o);return Array.isArray(a)?a:[[e.key,a]]}};Ys=x([u(0,ve),u(1,ie)],Ys);let js=class extends D{static{this.ID="workbench.contrib.dynamicWorkbenchSecurityConfiguration"}constructor(e){super(),this.remoteAgentService=e,this._ready=new Go,this.ready=this._ready.p,this.create()}async create(){try{await this.doCreate()}finally{this._ready.complete()}}async doCreate(){if(!pt&&(await this.remoteAgentService.getEnvironment())?.os!==Yi.Windows)return;W.as(oe.Configuration).registerConfiguration({...Ad,properties:{"security.allowedUNCHosts":{type:"array",items:{type:"string",pattern:"^[^\\\\]+$",patternErrorMessage:c(3801,"UNC host names must not contain backslashes.")},default:[],markdownDescription:c(3802,"A set of UNC host names (without leading or trailing backslash, for example `192.168.0.1` or `my-server`) to allow without user confirmation. If a UNC host is being accessed that is not allowed via this setting or has not been acknowledged via user confirmation, an error will occur and the operation stopped. A restart is required when changing this setting. Find out more about this setting at https://aka.ms/vscode-windows-unc."),scope:E.APPLICATION_MACHINE},"security.restrictUNCAccess":{type:"boolean",default:!0,markdownDescription:c(3803,"If enabled, only allows access to UNC host names that are allowed by the `#security.allowedUNCHosts#` setting or after user confirmation. Find out more about this setting at https://aka.ms/vscode-windows-unc."),scope:E.APPLICATION_MACHINE}}})}};js=x([u(0,Ur)],js);const mt="window.newWindowProfile";let qs=class extends D{static{this.ID="workbench.contrib.dynamicWindowConfiguration"}constructor(e,t){super(),this.userDataProfilesService=e,this.configurationService=t,this.registerNewWindowProfileConfiguration(),this._register(this.userDataProfilesService.onDidChangeProfiles(i=>this.registerNewWindowProfileConfiguration())),this.setNewWindowProfile(),this.checkAndResetNewWindowProfileConfig(),this._register(t.onDidChangeConfiguration(i=>{i.source!==C.DEFAULT&&i.affectsConfiguration(mt)&&this.setNewWindowProfile()})),this._register(this.userDataProfilesService.onDidChangeProfiles(()=>this.checkAndResetNewWindowProfileConfig()))}registerNewWindowProfileConfiguration(){const e=W.as(oe.Configuration),t={...Td,properties:{[mt]:{type:["string","null"],default:null,enum:[...this.userDataProfilesService.profiles.map(i=>i.name),null],enumItemLabels:[...this.userDataProfilesService.profiles.map(i=>""),c(3804,"Active Window")],description:c(3805,"Specifies the profile to use when opening a new window. If a profile name is provided, the new window will use that profile. If no profile name is provided, the new window will use the profile of the active window or the Default profile if no active window exists."),scope:E.APPLICATION}}};this.configurationNode?e.updateConfigurations({add:[t],remove:[this.configurationNode]}):e.registerConfiguration(t),this.configurationNode=t}setNewWindowProfile(){const e=this.configurationService.getValue(mt);this.newWindowProfile=e?this.userDataProfilesService.profiles.find(t=>t.name===e):void 0}checkAndResetNewWindowProfileConfig(){const e=this.configurationService.getValue(mt);if(!e)return;const t=this.newWindowProfile?this.userDataProfilesService.profiles.find(i=>i.id===this.newWindowProfile.id):void 0;e!==t?.name&&this.configurationService.updateValue(mt,t?.name)}};qs=x([u(0,Di),u(1,ve)],qs);var di;(function(s){s.ExtensionFeaturesRegistry="workbench.registry.extensionFeatures"})(di||(di={}));class Ld{constructor(){this.extensionFeatures=new Map}registerExtensionFeature(e){if(this.extensionFeatures.has(e.id))throw new Error(`Extension feature with id '${e.id}' already exists`);return this.extensionFeatures.set(e.id,e),{dispose:()=>this.extensionFeatures.delete(e.id)}}getExtensionFeature(e){return this.extensionFeatures.get(e)}getExtensionFeatures(){return Array.from(this.extensionFeatures.values())}}W.add(di.ExtensionFeaturesRegistry,new Ld);async function Nd(s,e,t,i,r,n){let o;try{await Wd(s,e,t,i,r,n)}catch(a){o=a}finally{o&&r.errorTransformer&&(o=r.errorTransformer(o)),typeof o<"u"&&t.error(o),t.end()}}async function Wd(s,e,t,i,r,n){Bi(n);const o=await s.open(e,{create:!1});try{Bi(n);let a=0,l=0,d=r&&typeof r.length=="number"?r.length:void 0,f=_.alloc(Math.min(r.bufferSize,typeof d=="number"?d:r.bufferSize)),h=r&&typeof r.position=="number"?r.position:0,g=0;do l=await s.read(o,h,f.buffer,g,f.byteLength-g),h+=l,g+=l,a+=l,typeof d=="number"&&(d-=l),g===f.byteLength&&(await t.write(i(f)),f=_.alloc(Math.min(r.bufferSize,typeof d=="number"?d:r.bufferSize)),g=0);while(l>0&&(typeof d!="number"||d>0)&&Bi(n)&&Ud(a,r));if(g>0){let S=g;typeof d=="number"&&(S=Math.min(g,d)),t.write(i(f.slice(0,S)))}}catch(a){throw Ke(a)}finally{await s.close(o)}}function Bi(s){if(s.isCancellationRequested)throw Ko();return!0}function Ud(s,e){if(typeof e?.limits?.size=="number"&&s>e.limits.size)throw b(c(1889,"File is too large to open"),y.FileTooLarge);return!0}var nr;function so(s){return s.scheme===k.file?s.fsPath:s.toString(!0)}async function no(s,e,t){const i=[];for(;!s.isEqual(t,s.dirname(t));)try{if(((await e.stat(t)).type&V.Directory)===0)throw new Error(c(1857,"Unable to create folder '{0}' that already exists but is not a directory",so(t)));break}catch(r){if(ji(r)!==y.FileNotFound)throw r;i.push(s.basename(t)),t=s.dirname(t)}for(let r=i.length-1;r>=0;r--){t=s.joinPath(t,i[r]);try{await e.mkdir(t)}catch(n){if(ji(n)!==y.FileExists)throw n}}}let or=class extends D{static{nr=this}constructor(e){super(),this.logService=e,this.BUFFER_SIZE=256*1024,this._onDidChangeFileSystemProviderRegistrations=this._register(new v),this.onDidChangeFileSystemProviderRegistrations=this._onDidChangeFileSystemProviderRegistrations.event,this._onWillActivateFileSystemProvider=this._register(new v),this.onWillActivateFileSystemProvider=this._onWillActivateFileSystemProvider.event,this._onDidChangeFileSystemProviderCapabilities=this._register(new v),this.onDidChangeFileSystemProviderCapabilities=this._onDidChangeFileSystemProviderCapabilities.event,this.provider=new Map,this._onDidRunOperation=this._register(new v),this.onDidRunOperation=this._onDidRunOperation.event,this.internalOnDidFilesChange=this._register(new v),this._onDidUncorrelatedFilesChange=this._register(new v),this.onDidFilesChange=this._onDidUncorrelatedFilesChange.event,this._onDidWatchError=this._register(new v),this.onDidWatchError=this._onDidWatchError.event,this.activeWatchers=new Map,this.writeQueue=this._register(new pn)}registerProvider(e,t){if(this.provider.has(e))throw new Error(`A filesystem provider for the scheme '${e}' is already registered.`);Fe(`code/registerFilesystem/${e}`);const i=new he;return this.provider.set(e,t),this._onDidChangeFileSystemProviderRegistrations.fire({added:!0,scheme:e,provider:t}),i.add(t.onDidChangeFile(r=>{const n=new Ho(r,!this.isPathCaseSensitive(t));this.internalOnDidFilesChange.fire(n),n.hasCorrelation()||this._onDidUncorrelatedFilesChange.fire(n)})),typeof t.onDidWatchError=="function"&&i.add(t.onDidWatchError(r=>this._onDidWatchError.fire(new Error(r)))),i.add(t.onDidChangeCapabilities(()=>this._onDidChangeFileSystemProviderCapabilities.fire({provider:t,scheme:e}))),de(()=>{this._onDidChangeFileSystemProviderRegistrations.fire({added:!1,scheme:e,provider:t}),this.provider.delete(e),Ee(i)})}getProvider(e){return this.provider.get(e)}async activateProvider(e){const t=[];this._onWillActivateFileSystemProvider.fire({scheme:e,join(i){t.push(i)}}),!this.provider.has(e)&&await Le.settled(t)}async canHandleResource(e){return await this.activateProvider(e.scheme),this.hasProvider(e)}hasProvider(e){return this.provider.has(e.scheme)}hasCapability(e,t){const i=this.provider.get(e.scheme);return!!(i&&i.capabilities&t)}listCapabilities(){return ct.map(this.provider,([e,t])=>({scheme:e,capabilities:t.capabilities}))}async withProvider(e){if(!zo(e))throw new re(c(1858,"Unable to resolve filesystem provider with relative file path '{0}'",this.resourceForError(e)),L.FILE_INVALID_PATH);await this.activateProvider(e.scheme);const t=this.provider.get(e.scheme);if(!t){const i=new Lr;throw i.message=c(1859,"ENOPRO: No file system provider found for resource '{0}'",e.toString()),i}return t}async withReadProvider(e){const t=await this.withProvider(e);if(Te(t)||we(t)||zt(t))return t;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite, FileReadStream nor FileOpenReadWriteClose capability which is needed for the read operation.`)}async withWriteProvider(e){const t=await this.withProvider(e);if(Te(t)||we(t))return t;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite nor FileOpenReadWriteClose capability which is needed for the write operation.`)}async resolve(e,t){try{return await this.doResolveFile(e,t)}catch(i){throw ji(i)===y.FileNotFound?new re(c(1860,"Unable to resolve nonexistent file '{0}'",this.resourceForError(e)),L.FILE_NOT_FOUND):Ke(i)}}async doResolveFile(e,t){const i=await this.withProvider(e),r=this.isPathCaseSensitive(i),n=t?.resolveTo,o=t?.resolveSingleChildDescendants,a=t?.resolveMetadata,l=await i.stat(e);let d;return this.toFileStat(i,e,l,void 0,!!a,(f,h)=>(d||(d=$o.forUris(()=>!r),d.set(e,!0),n&&d.fill(!0,n)),d.get(f.resource)||d.findSuperstr(f.resource.with({query:null,fragment:null}))?!0:f.isDirectory&&o?h===1:!1))}async toFileStat(e,t,i,r,n,o){const{providerExtUri:a}=this.getExtUri(e),l={resource:t,name:a.basename(t),isFile:(i.type&V.File)!==0,isDirectory:(i.type&V.Directory)!==0,isSymbolicLink:(i.type&V.SymbolicLink)!==0,mtime:i.mtime,ctime:i.ctime,size:i.size,readonly:!!((i.permissions??0)&ut.Readonly)||!!(e.capabilities&A.Readonly),locked:!!((i.permissions??0)&ut.Locked),etag:ns({mtime:i.mtime,size:i.size}),children:void 0};if(l.isDirectory&&o(l,r)){try{const d=await e.readdir(t),f=await Le.settled(d.map(async([h,g])=>{try{const S=a.joinPath(t,h),w=n?await e.stat(S):{type:g};return await this.toFileStat(e,S,w,d.length,n,o)}catch(S){return this.logService.trace(S),null}}));l.children=gn(f)}catch(d){this.logService.trace(d),l.children=[]}return l}return l}async resolveAll(e){return Le.settled(e.map(async t=>{try{return{stat:await this.doResolveFile(t.resource,t.options),success:!0}}catch(i){return this.logService.trace(i),{stat:void 0,success:!1}}}))}async stat(e){const t=await this.withProvider(e),i=await t.stat(e);return this.toFileStat(t,e,i,void 0,!0,()=>!1)}async exists(e){const t=await this.withProvider(e);try{return!!await t.stat(e)}catch{return!1}}async canCreateFile(e,t){try{await this.doValidateCreateFile(e,t)}catch(i){return i}return!0}async doValidateCreateFile(e,t){if(!t?.overwrite&&await this.exists(e))throw new re(c(1861,"Unable to create file '{0}' that already exists when overwrite flag is not set",this.resourceForError(e)),L.FILE_MODIFIED_SINCE,t)}async createFile(e,t=_.fromString(""),i){await this.doValidateCreateFile(e,i);const r=await this.writeFile(e,t);return this._onDidRunOperation.fire(new it(e,T.CREATE,r)),r}async writeFile(e,t,i){const r=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),{providerExtUri:n}=this.getExtUri(r);let o=i;if(os(r)&&!o?.atomic){const a=r.enforceAtomicWriteFile?.(e);a&&(o={...i,atomic:a})}try{let{stat:a,buffer:l}=await this.validateWriteFile(r,e,t,o);a||await this.mkdirp(r,n.dirname(e)),l||(l=await this.peekBufferForWriting(r,t)),!Te(r)||we(r)&&l instanceof _||we(r)&&os(r)&&o?.atomic?await this.doWriteUnbuffered(r,e,o,l):await this.doWriteBuffered(r,e,o,l instanceof _?vn(l):l),this._onDidRunOperation.fire(new it(e,T.WRITE))}catch(a){throw new re(c(1862,"Unable to write file '{0}' ({1})",this.resourceForError(e),Ke(a).toString()),as(a),o)}return this.resolve(e,{resolveMetadata:!0})}async peekBufferForWriting(e,t){let i;if(we(e)&&!(t instanceof _))if(Ti(t)){const r=await Yo(t,3);r.ended?i=_.concat(r.buffer):i=r}else i=jo(t,r=>_.concat(r),3);else i=t;return i}async validateWriteFile(e,t,i,r){const n=!!r?.unlock;if(n&&!(e.capabilities&A.FileWriteUnlock))throw new Error(c(1863,"Unable to unlock file '{0}' because provider does not support it.",this.resourceForError(t)));if(!!r?.atomic){if(!(e.capabilities&A.FileAtomicWrite))throw new Error(c(1864,"Unable to atomically write file '{0}' because provider does not support it.",this.resourceForError(t)));if(!(e.capabilities&A.FileReadWrite))throw new Error(c(1865,"Unable to atomically write file '{0}' because provider does not support unbuffered writes.",this.resourceForError(t)));if(n)throw new Error(c(1866,"Unable to unlock file '{0}' because atomic write is enabled.",this.resourceForError(t)))}let a;try{a=await e.stat(t)}catch{return Object.create(null)}if((a.type&V.Directory)!==0)throw new re(c(1867,"Unable to write file '{0}' that is actually a directory",this.resourceForError(t)),L.FILE_IS_DIRECTORY,r);this.throwIfFileIsReadonly(t,a);let l;if(typeof r?.mtime=="number"&&typeof r.etag=="string"&&r.etag!==$e&&typeof a.mtime=="number"&&typeof a.size=="number"&&r.mtime<a.mtime&&r.etag!==ns({mtime:r.mtime,size:a.size})){if(l=await this.peekBufferForWriting(e,i),l instanceof _&&l.byteLength===a.size)try{const{value:d}=await this.readFile(t,{limits:{size:a.size}});if(l.equals(d))return{stat:a,buffer:l}}catch{}throw new re(c(1868,"File Modified Since"),L.FILE_MODIFIED_SINCE,r)}return{stat:a,buffer:l}}async readFile(e,t,i){const r=await this.withReadProvider(e);return t?.atomic?this.doReadFileAtomic(r,e,t,i):this.doReadFile(r,e,t,i)}async doReadFileAtomic(e,t,i,r){return new Promise((n,o)=>{this.writeQueue.queueFor(t,async()=>{try{const a=await this.doReadFile(e,t,i,r);n(a)}catch(a){o(a)}},this.getExtUri(e).providerExtUri)})}async doReadFile(e,t,i,r){const n=await this.doReadFileStream(e,t,{...i,preferUnbuffered:!0},r);return{...n,value:await xi(n.value)}}async readFileStream(e,t,i){const r=await this.withReadProvider(e);return this.doReadFileStream(r,e,t,i)}async doReadFileStream(e,t,i,r){const n=new Ut(r);let o=i;Pi(e)&&e.enforceAtomicReadFile?.(t)&&(o={...i,atomic:!0});const a=this.validateReadFile(t,o).then(d=>d,d=>{throw n.dispose(!0),d});let l;try{return typeof o?.etag=="string"&&o.etag!==$e&&await a,o?.atomic&&Pi(e)||!(Te(e)||zt(e))||we(e)&&o?.preferUnbuffered?l=this.readFileUnbuffered(e,t,o):zt(e)?l=this.readFileStreamed(e,t,n.token,o):l=this.readFileBuffered(e,t,n.token,o),l.on("end",()=>n.dispose()),l.on("error",()=>n.dispose()),{...await a,value:l}}catch(d){throw l&&await wn(l),this.restoreReadError(d,t,o)}}restoreReadError(e,t,i){const r=c(1869,"Unable to read file '{0}' ({1})",this.resourceForError(t),Ke(e).toString());return e instanceof $t?new $t(r,e.stat,i):e instanceof Li?new Li(r,e.fileOperationResult,e.size,e.options):new re(r,as(e),i)}readFileStreamed(e,t,i,r=Object.create(null)){const n=e.readFileStream(t,r,i);return qo(n,{data:o=>o instanceof _?o:_.wrap(o),error:o=>this.restoreReadError(o,t,r)},o=>_.concat(o))}readFileBuffered(e,t,i,r=Object.create(null)){const n=Xo();return Nd(e,t,n,o=>o,{...r,bufferSize:this.BUFFER_SIZE,errorTransformer:o=>this.restoreReadError(o,t,r)},i),n}readFileUnbuffered(e,t,i){const r=wt(n=>_.concat(n));return(async()=>{try{let n;i?.atomic&&Pi(e)?n=await e.readFile(t,{atomic:!0}):n=await e.readFile(t),typeof i?.position=="number"&&(n=n.slice(i.position)),typeof i?.length=="number"&&(n=n.slice(0,i.length)),this.validateReadFileLimits(t,n.byteLength,i),r.end(_.wrap(n))}catch(n){r.error(n),r.end()}})(),r}async validateReadFile(e,t){const i=await this.resolve(e,{resolveMetadata:!0});if(i.isDirectory)throw new re(c(1870,"Unable to read file '{0}' that is actually a directory",this.resourceForError(e)),L.FILE_IS_DIRECTORY,t);if(typeof t?.etag=="string"&&t.etag!==$e&&t.etag===i.etag)throw new $t(c(1871,"File not modified since"),i,t);return this.validateReadFileLimits(e,i.size,t),i}validateReadFileLimits(e,t,i){if(typeof i?.limits?.size=="number"&&t>i.limits.size)throw new Li(c(1872,"Unable to read file '{0}' that is too large to open",this.resourceForError(e)),L.FILE_TOO_LARGE,t,i)}async canMove(e,t,i){return this.doCanMoveCopy(e,t,"move",i)}async canCopy(e,t,i){return this.doCanMoveCopy(e,t,"copy",i)}async doCanMoveCopy(e,t,i,r){if(e.toString()!==t.toString())try{const n=i==="move"?this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e):await this.withReadProvider(e),o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t);await this.doValidateMoveCopy(n,e,o,t,i,r)}catch(n){return n}return!0}async move(e,t,i){const r=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),n=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t),o=await this.doMoveCopy(r,e,n,t,"move",!!i),a=await this.resolve(t,{resolveMetadata:!0});return this._onDidRunOperation.fire(new it(e,o==="move"?T.MOVE:T.COPY,a)),a}async copy(e,t,i){const r=await this.withReadProvider(e),n=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t),o=await this.doMoveCopy(r,e,n,t,"copy",!!i),a=await this.resolve(t,{resolveMetadata:!0});return this._onDidRunOperation.fire(new it(e,o==="copy"?T.COPY:T.MOVE,a)),a}async doMoveCopy(e,t,i,r,n,o){if(t.toString()===r.toString())return n;const{exists:a,isSameResourceWithDifferentPathCase:l}=await this.doValidateMoveCopy(e,t,i,r,n,o);if(a&&!l&&o&&await this.del(r,{recursive:!0}),await this.mkdirp(i,this.getExtUri(i).providerExtUri.dirname(r)),n==="copy"){if(e===i&&cs(e))await e.copy(t,r,{overwrite:o});else{const d=await this.resolve(t);d.isDirectory?await this.doCopyFolder(e,d,i,r):await this.doCopyFile(e,t,i,r)}return n}else return e===i?(await e.rename(t,r,{overwrite:o}),n):(await this.doMoveCopy(e,t,i,r,"copy",o),await this.del(t,{recursive:!0}),"copy")}async doCopyFile(e,t,i,r){if(Te(e)&&Te(i))return this.doPipeBuffered(e,t,i,r);if(Te(e)&&we(i))return this.doPipeBufferedToUnbuffered(e,t,i,r);if(we(e)&&Te(i))return this.doPipeUnbufferedToBuffered(e,t,i,r);if(we(e)&&we(i))return this.doPipeUnbuffered(e,t,i,r)}async doCopyFolder(e,t,i,r){await i.mkdir(r),Array.isArray(t.children)&&await Le.settled(t.children.map(async n=>{const o=this.getExtUri(i).providerExtUri.joinPath(r,n.name);return n.isDirectory?this.doCopyFolder(e,await this.resolve(n.resource),i,o):this.doCopyFile(e,n.resource,i,o)}))}async doValidateMoveCopy(e,t,i,r,n,o){let a=!1;if(e===i){const{providerExtUri:d,isPathCaseSensitive:f}=this.getExtUri(e);if(f||(a=d.isEqual(t,r)),a&&n==="copy")throw new Error(c(1873,"Unable to copy when source '{0}' is same as target '{1}' with different path case on a case insensitive file system",this.resourceForError(t),this.resourceForError(r)));if(!a&&d.isEqualOrParent(r,t))throw new Error(c(1874,"Unable to move/copy when source '{0}' is parent of target '{1}'.",this.resourceForError(t),this.resourceForError(r)))}const l=await this.exists(r);if(l&&!a){if(!o)throw new re(c(1875,"Unable to move/copy '{0}' because target '{1}' already exists at destination.",this.resourceForError(t),this.resourceForError(r)),L.FILE_MOVE_CONFLICT);if(e===i){const{providerExtUri:d}=this.getExtUri(e);if(d.isEqualOrParent(t,r))throw new Error(c(1876,"Unable to move/copy '{0}' into '{1}' since a file would replace the folder it is contained in.",this.resourceForError(t),this.resourceForError(r)))}}return{exists:l,isSameResourceWithDifferentPathCase:a}}getExtUri(e){const t=this.isPathCaseSensitive(e);return{providerExtUri:t?me:Sn,isPathCaseSensitive:t}}isPathCaseSensitive(e){return!!(e.capabilities&A.PathCaseSensitive)}async createFolder(e){const t=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e);await this.mkdirp(t,e);const i=await this.resolve(e,{resolveMetadata:!0});return this._onDidRunOperation.fire(new it(e,T.CREATE,i)),i}async mkdirp(e,t){const{providerExtUri:i}=this.getExtUri(e);return no(i,e,t)}async canDelete(e,t){try{await this.doValidateDelete(e,t)}catch(i){return i}return!0}async doValidateDelete(e,t){const i=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e),r=!!t?.useTrash;if(r&&!(i.capabilities&A.Trash))throw new Error(c(1877,"Unable to delete file '{0}' via trash because provider does not support it.",this.resourceForError(e)));const n=t?.atomic;if(n&&!(i.capabilities&A.FileAtomicDelete))throw new Error(c(1878,"Unable to delete file '{0}' atomically because provider does not support it.",this.resourceForError(e)));if(r&&n)throw new Error(c(1879,"Unable to atomically delete file '{0}' because using trash is enabled.",this.resourceForError(e)));let o;try{o=await i.stat(e)}catch{}if(o)this.throwIfFileIsReadonly(e,o);else throw new re(c(1880,"Unable to delete nonexistent file '{0}'",this.resourceForError(e)),L.FILE_NOT_FOUND);if(!!!t?.recursive){const l=await this.resolve(e);if(l.isDirectory&&Array.isArray(l.children)&&l.children.length>0)throw new Error(c(1881,"Unable to delete non-empty folder '{0}'.",this.resourceForError(e)))}return i}async del(e,t){const i=await this.doValidateDelete(e,t);let r=t;if(Jo(i)&&!r?.atomic){const l=i.enforceAtomicDelete?.(e);l&&(r={...t,atomic:l})}const n=!!r?.useTrash,o=!!r?.recursive,a=r?.atomic??!1;await i.delete(e,{recursive:o,useTrash:n,atomic:a}),this._onDidRunOperation.fire(new it(e,T.DELETE))}async cloneFile(e,t){const i=await this.withProvider(e),r=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(t),t);if(!(i===r&&this.getExtUri(i).providerExtUri.isEqual(e,t)))return i===r&&Qo(i)?i.cloneFile(e,t):(await this.mkdirp(r,this.getExtUri(r).providerExtUri.dirname(t)),i===r&&cs(i)?this.writeQueue.queueFor(e,()=>i.copy(e,t,{overwrite:!0}),this.getExtUri(i).providerExtUri):this.writeQueue.queueFor(e,()=>this.doCopyFile(i,e,r,t),this.getExtUri(i).providerExtUri))}static{this.WATCHER_CORRELATION_IDS=0}createWatcher(e,t){return this.watch(e,{...t,correlationId:nr.WATCHER_CORRELATION_IDS++})}watch(e,t={recursive:!1,excludes:[]}){const i=new he;let r=!1,n=()=>{r=!0};i.add(de(()=>n())),(async()=>{try{const a=await this.doWatch(e,t);r?Ee(a):n=()=>Ee(a)}catch(a){this.logService.error(a)}})();const o=t.correlationId;if(typeof o=="number"){const a=i.add(new v);return i.add(this.internalOnDidFilesChange.event(d=>{d.correlates(o)&&a.fire(d)})),{onDidChange:a.event,dispose:()=>i.dispose()}}return i}async doWatch(e,t){const i=await this.withProvider(e),r=Cn([this.getExtUri(i).providerExtUri.getComparisonKey(e),t]);let n=this.activeWatchers.get(r);return n||(n={count:0,disposable:i.watch(e,t)},this.activeWatchers.set(r,n)),n.count+=1,de(()=>{n&&(n.count--,n.count===0&&(Ee(n.disposable),this.activeWatchers.delete(r)))})}dispose(){super.dispose();for(const[,e]of this.activeWatchers)Ee(e.disposable);this.activeWatchers.clear()}async doWriteBuffered(e,t,i,r){return this.writeQueue.queueFor(t,async()=>{const n=await e.open(t,{create:!0,unlock:i?.unlock??!1});try{Ti(r)||Ni(r)?await this.doWriteStreamBufferedQueued(e,n,r):await this.doWriteReadableBufferedQueued(e,n,r)}catch(o){throw Ke(o)}finally{await e.close(n)}},this.getExtUri(e).providerExtUri)}async doWriteStreamBufferedQueued(e,t,i){let r=0,n;if(Ni(i)){if(i.buffer.length>0){const o=_.concat(i.buffer);await this.doWriteBuffer(e,t,o,o.byteLength,r,0),r+=o.byteLength}if(i.ended)return;n=i.stream}else n=i;return new Promise((o,a)=>{Pr(n,{onData:async l=>{n.pause();try{await this.doWriteBuffer(e,t,l,l.byteLength,r,0)}catch(d){return a(d)}r+=l.byteLength,setTimeout(()=>n.resume())},onError:l=>a(l),onEnd:()=>o()})})}async doWriteReadableBufferedQueued(e,t,i){let r=0,n;for(;(n=i.read())!==null;)await this.doWriteBuffer(e,t,n,n.byteLength,r,0),r+=n.byteLength}async doWriteBuffer(e,t,i,r,n,o){let a=0;for(;a<r;){const l=await e.write(t,n+a,i.buffer,o+a,r-a);a+=l}}async doWriteUnbuffered(e,t,i,r){return this.writeQueue.queueFor(t,()=>this.doWriteUnbufferedQueued(e,t,i,r),this.getExtUri(e).providerExtUri)}async doWriteUnbufferedQueued(e,t,i,r){let n;r instanceof _?n=r:Ti(r)?n=await xi(r):Ni(r)?n=await Zo(r):n=ea(r),await e.writeFile(t,n.buffer,{create:!0,overwrite:!0,unlock:i?.unlock??!1,atomic:i?.atomic??!1})}async doPipeBuffered(e,t,i,r){return this.writeQueue.queueFor(r,()=>this.doPipeBufferedQueued(e,t,i,r),this.getExtUri(i).providerExtUri)}async doPipeBufferedQueued(e,t,i,r){let n,o;try{n=await e.open(t,{create:!1}),o=await i.open(r,{create:!0,unlock:!1});const a=_.alloc(this.BUFFER_SIZE);let l=0,d=0,f=0;do f=await e.read(n,l,a.buffer,d,a.byteLength-d),await this.doWriteBuffer(i,o,a,f,l,d),l+=f,d+=f,d===a.byteLength&&(d=0);while(f>0)}catch(a){throw Ke(a)}finally{await Le.settled([typeof n=="number"?e.close(n):Promise.resolve(),typeof o=="number"?i.close(o):Promise.resolve()])}}async doPipeUnbuffered(e,t,i,r){return this.writeQueue.queueFor(r,()=>this.doPipeUnbufferedQueued(e,t,i,r),this.getExtUri(i).providerExtUri)}async doPipeUnbufferedQueued(e,t,i,r){return i.writeFile(r,await e.readFile(t),{create:!0,overwrite:!0,unlock:!1,atomic:!1})}async doPipeUnbufferedToBuffered(e,t,i,r){return this.writeQueue.queueFor(r,()=>this.doPipeUnbufferedToBufferedQueued(e,t,i,r),this.getExtUri(i).providerExtUri)}async doPipeUnbufferedToBufferedQueued(e,t,i,r){const n=await i.open(r,{create:!0,unlock:!1});try{const o=await e.readFile(t);await this.doWriteBuffer(i,n,_.wrap(o),o.byteLength,0,0)}catch(o){throw Ke(o)}finally{await i.close(n)}}async doPipeBufferedToUnbuffered(e,t,i,r){const n=await xi(this.readFileBuffered(e,t,ni.None));await this.doWriteUnbuffered(i,r,void 0,n)}throwIfFileSystemIsReadonly(e,t){if(e.capabilities&A.Readonly)throw new re(c(1882,"Unable to modify read-only file '{0}'",this.resourceForError(t)),L.FILE_PERMISSION_DENIED);return e}throwIfFileIsReadonly(e,t){if((t.permissions??0)&ut.Readonly)throw new re(c(1882,"Unable to modify read-only file '{0}'",this.resourceForError(e)),L.FILE_PERMISSION_DENIED)}resourceForError(e){return so(e)}};or=nr=x([u(0,Ge)],or);class Xs{constructor(e){this.type=V.File,this.ctime=Date.now(),this.mtime=Date.now(),this.size=0,this.name=e}}class Rt{constructor(e){this.type=V.Directory,this.ctime=Date.now(),this.mtime=Date.now(),this.size=0,this.name=e,this.entries=new Map}}class hi extends D{constructor(){super(...arguments),this.memoryFdCounter=0,this.fdMemory=new Map,this._onDidChangeCapabilities=this._register(new v),this.onDidChangeCapabilities=this._onDidChangeCapabilities.event,this._capabilities=A.FileReadWrite|A.PathCaseSensitive,this.root=new Rt(""),this._onDidChangeFile=this._register(new v),this.onDidChangeFile=this._onDidChangeFile.event,this._bufferedChanges=[]}get capabilities(){return this._capabilities}setReadOnly(e){const t=!!(this._capabilities&A.Readonly);e!==t&&(this._capabilities=e?A.Readonly|A.PathCaseSensitive|A.FileReadWrite:A.FileReadWrite|A.PathCaseSensitive,this._onDidChangeCapabilities.fire())}async stat(e){return this._lookup(e,!1)}async readdir(e){const t=this._lookupAsDirectory(e,!1),i=[];return t.entries.forEach((r,n)=>i.push([n,r.type])),i}async readFile(e){const t=this._lookupAsFile(e,!1).data;if(t)return t;throw b("file not found",y.FileNotFound)}readFileStream(e){const t=this._lookupAsFile(e,!1).data,i=wt(r=>_.concat(r.map(n=>_.wrap(n))).buffer);return i.end(t),i}async writeFile(e,t,i){const r=ee(e),n=this._lookupParentDirectory(e);let o=n.entries.get(r);if(o instanceof Rt)throw b("file is directory",y.FileIsADirectory);if(!o&&!i.create)throw b("file not found",y.FileNotFound);if(o&&i.create&&!i.overwrite)throw b("file exists already",y.FileExists);o||(o=new Xs(r),n.entries.set(r,o),this._fireSoon({type:P.ADDED,resource:e})),o.mtime=Date.now(),o.size=t.byteLength,o.data=t,this._fireSoon({type:P.UPDATED,resource:e})}open(e,t){const i=this._lookupAsFile(e,!1).data;if(i){const r=this.memoryFdCounter++;return this.fdMemory.set(r,i),Promise.resolve(r)}throw b("file not found",y.FileNotFound)}close(e){return this.fdMemory.delete(e),Promise.resolve()}read(e,t,i,r,n){const o=this.fdMemory.get(e);if(!o)throw b("No file with that descriptor open",y.Unavailable);const a=_.wrap(o).slice(t,t+n);return i.set(a.buffer,r),Promise.resolve(a.byteLength)}write(e,t,i,r,n){const o=this.fdMemory.get(e);if(!o)throw b("No file with that descriptor open",y.Unavailable);const a=_.wrap(i).slice(r,r+n);return o.set(a.buffer,t),Promise.resolve(a.byteLength)}async rename(e,t,i){if(!i.overwrite&&this._lookup(t,!0))throw b("file exists already",y.FileExists);const r=this._lookup(e,!1),n=this._lookupParentDirectory(e),o=this._lookupParentDirectory(t),a=ee(t);n.entries.delete(r.name),r.name=a,o.entries.set(a,r),this._fireSoon({type:P.DELETED,resource:e},{type:P.ADDED,resource:t})}async delete(e,t){const i=ht(e),r=ee(e),n=this._lookupAsDirectory(i,!1);n.entries.has(r)&&(n.entries.delete(r),n.mtime=Date.now(),n.size-=1,this._fireSoon({type:P.UPDATED,resource:i},{resource:e,type:P.DELETED}))}async mkdir(e){if(this._lookup(e,!0))throw b("file exists already",y.FileExists);const t=ee(e),i=ht(e),r=this._lookupAsDirectory(i,!1),n=new Rt(t);r.entries.set(n.name,n),r.mtime=Date.now(),r.size+=1,this._fireSoon({type:P.UPDATED,resource:i},{type:P.ADDED,resource:e})}_lookup(e,t){const i=e.path.split("/");let r=this.root;for(const n of i){if(!n)continue;let o;if(r instanceof Rt&&(o=r.entries.get(n)),!o){if(t)return;throw b("file not found",y.FileNotFound)}r=o}return r}_lookupAsDirectory(e,t){const i=this._lookup(e,t);if(i instanceof Rt)return i;throw b("file not a directory",y.FileNotADirectory)}_lookupAsFile(e,t){const i=this._lookup(e,t);if(i instanceof Xs)return i;throw b("file is a directory",y.FileIsADirectory)}_lookupParentDirectory(e){const t=ht(e);return this._lookupAsDirectory(t,!1)}watch(e,t){return D.None}_fireSoon(...e){this._bufferedChanges.push(...e),this._fireSoonHandle&&clearTimeout(this._fireSoonHandle),this._fireSoonHandle=setTimeout(()=>{this._onDidChangeFile.fire(this._bufferedChanges),this._bufferedChanges.length=0},5)}dispose(){super.dispose(),this.fdMemory.clear()}}var We;(function(s){function e(n){return typeof n?.showDirectoryPicker=="function"}s.supported=e;function t(n){const o=n;return o?typeof o.kind=="string"&&typeof o.queryPermission=="function"&&typeof o.requestPermission=="function":!1}s.isFileSystemHandle=t;function i(n){return n.kind==="file"}s.isFileSystemFileHandle=i;function r(n){return n.kind==="directory"}s.isFileSystemDirectoryHandle=r})(We||(We={}));var ar;(function(s){function e(t){return typeof t?.FileSystemObserver=="function"}s.supported=e})(ar||(ar={}));class nf extends D{get capabilities(){return this._capabilities||(this._capabilities=A.FileReadWrite|A.FileReadStream,ri&&(this._capabilities|=A.PathCaseSensitive)),this._capabilities}constructor(e,t,i){super(),this.indexedDB=e,this.store=t,this.logService=i,this.onDidChangeCapabilities=H.None,this.extUri=ri?me:Sn,this._onDidChangeFileEmitter=this._register(new v),this.onDidChangeFile=this._onDidChangeFileEmitter.event,this._files=new Map,this._directories=new Map}async stat(e){try{const t=await this.getHandle(e);if(!t)throw this.createFileSystemProviderError(e,"No such file or directory, stat",y.FileNotFound);if(We.isFileSystemFileHandle(t)){const i=await t.getFile();return{type:V.File,mtime:i.lastModified,ctime:0,size:i.size}}return{type:V.Directory,mtime:0,ctime:0,size:0}}catch(t){throw this.toFileSystemProviderError(t)}}async readdir(e){try{const t=await this.getDirectoryHandle(e);if(!t)throw this.createFileSystemProviderError(e,"No such file or directory, readdir",y.FileNotFound);const i=[];for await(const[r,n]of t)i.push([r,We.isFileSystemFileHandle(n)?V.File:V.Directory]);return i}catch(t){throw this.toFileSystemProviderError(t)}}readFileStream(e,t,i){const r=wt(n=>_.concat(n.map(o=>_.wrap(o))).buffer,{highWaterMark:10});return(async()=>{try{const n=await this.getFileHandle(e);if(!n)throw this.createFileSystemProviderError(e,"No such file or directory, readFile",y.FileNotFound);const o=await n.getFile();if(typeof t.length=="number"||typeof t.position=="number"){let a=new Uint8Array(await o.arrayBuffer());typeof t?.position=="number"&&(a=a.slice(t.position)),typeof t?.length=="number"&&(a=a.slice(0,t.length)),r.end(a)}else{const a=o.stream().getReader();let l=await a.read();for(;!l.done&&!(i.isCancellationRequested||(await r.write(l.value),i.isCancellationRequested));)l=await a.read();r.end(void 0)}}catch(n){r.error(this.toFileSystemProviderError(n)),r.end()}})(),r}async readFile(e){try{const t=await this.getFileHandle(e);if(!t)throw this.createFileSystemProviderError(e,"No such file or directory, readFile",y.FileNotFound);const i=await t.getFile();return new Uint8Array(await i.arrayBuffer())}catch(t){throw this.toFileSystemProviderError(t)}}async writeFile(e,t,i){try{let r=await this.getFileHandle(e);if(!i.create||!i.overwrite){if(r){if(!i.overwrite)throw this.createFileSystemProviderError(e,"File already exists, writeFile",y.FileExists)}else if(!i.create)throw this.createFileSystemProviderError(e,"No such file, writeFile",y.FileNotFound)}if(!r){const o=await this.getDirectoryHandle(this.extUri.dirname(e));if(!o)throw this.createFileSystemProviderError(e,"No such parent directory, writeFile",y.FileNotFound);if(r=await o.getFileHandle(this.extUri.basename(e),{create:!0}),!r)throw this.createFileSystemProviderError(e,"Unable to create file , writeFile",y.Unknown)}const n=await r.createWritable();await n.write(t),await n.close()}catch(r){throw this.toFileSystemProviderError(r)}}async mkdir(e){try{const t=await this.getDirectoryHandle(this.extUri.dirname(e));if(!t)throw this.createFileSystemProviderError(e,"No such parent directory, mkdir",y.FileNotFound);await t.getDirectoryHandle(this.extUri.basename(e),{create:!0})}catch(t){throw this.toFileSystemProviderError(t)}}async delete(e,t){try{const i=await this.getDirectoryHandle(this.extUri.dirname(e));if(!i)throw this.createFileSystemProviderError(e,"No such parent directory, delete",y.FileNotFound);return i.removeEntry(this.extUri.basename(e),{recursive:t.recursive})}catch(i){throw this.toFileSystemProviderError(i)}}async rename(e,t,i){try{if(this.extUri.isEqual(e,t))return;const r=await this.getFileHandle(e);if(r){const n=await r.getFile(),o=new Uint8Array(await n.arrayBuffer());await this.writeFile(t,o,{create:!0,overwrite:i.overwrite,unlock:!1,atomic:!1}),await this.delete(e,{recursive:!1,useTrash:!1,atomic:!1})}else throw this.createFileSystemProviderError(e,c(1849,"Rename is only supported for files."),y.Unavailable)}catch(r){throw this.toFileSystemProviderError(r)}}watch(e,t){const i=new he;return this.doWatch(e,t,i).catch(r=>this.logService.error(`[File Watcher ('FileSystemObserver')] Error: ${r} (${e})`)),i}async doWatch(e,t,i){if(!ar.supported(globalThis))return;const r=await this.getHandle(e);if(!r||i.isDisposed)return;const n=new globalThis.FileSystemObserver(o=>{if(i.isDisposed)return;const a=[];for(const l of o)switch(this.logService.getLevel()===ta.Trace&&this.logService.trace(`[File Watcher ('FileSystemObserver')] [${l.type}] ${j(e,...l.relativePathComponents)}`),l.type){case"appeared":a.push({resource:j(e,...l.relativePathComponents),type:P.ADDED});break;case"disappeared":a.push({resource:j(e,...l.relativePathComponents),type:P.DELETED});break;case"modified":a.push({resource:j(e,...l.relativePathComponents),type:P.UPDATED});break;case"errored":this.logService.trace(`[File Watcher ('FileSystemObserver')] errored, disposing observer (${e})`),i.dispose()}a.length&&this._onDidChangeFileEmitter.fire(a)});try{await n.observe(r,t.recursive?{recursive:!0}:void 0)}finally{i.isDisposed?n.disconnect():i.add(de(()=>n.disconnect()))}}registerFileHandle(e){return this.registerHandle(e,this._files)}registerDirectoryHandle(e){return this.registerHandle(e,this._directories)}get directories(){return this._directories.values()}async registerHandle(e,t){let i=`/${e.name}`;if(t.has(i)&&!await t.get(i)?.isSameEntry(e)){const r=si(e.name),n=Pe(e.name,r);let o=1;do i=`/${n}-${o++}${r}`;while(t.has(i)&&!await t.get(i)?.isSameEntry(e))}t.set(i,e);try{await this.indexedDB?.runInTransaction(this.store,"readwrite",r=>r.put(e,i))}catch(r){this.logService.error(r)}return K.from({scheme:k.file,path:i})}async getHandle(e){let t=await this.doGetHandle(e);if(!t){const i=await this.getDirectoryHandle(this.extUri.dirname(e));if(i){const r=me.basename(e);try{t=await i.getFileHandle(r)}catch{try{t=await i.getDirectoryHandle(r)}catch{}}}}return t}async getFileHandle(e){const t=await this.doGetHandle(e);if(t instanceof FileSystemFileHandle)return t;const i=await this.getDirectoryHandle(this.extUri.dirname(e));try{return await i?.getFileHandle(me.basename(e))}catch{return}}async getDirectoryHandle(e){const t=await this.doGetHandle(e);if(t instanceof FileSystemDirectoryHandle)return t;const i=this.extUri.dirname(e);if(this.extUri.isEqual(i,e))return;const r=await this.getDirectoryHandle(i);try{return await r?.getDirectoryHandle(me.basename(e))}catch{return}}async doGetHandle(e){if(this.extUri.dirname(e).path!=="/")return;const t=e.path.replace(/\/$/,""),i=this._files.get(t)??this._directories.get(t);if(i)return i;const r=await this.indexedDB?.runInTransaction(this.store,"readonly",n=>n.get(t));if(We.isFileSystemHandle(r)){let n=await r.queryPermission()==="granted";try{n||(n=await r.requestPermission()==="granted")}catch(o){this.logService.error(o)}if(n)return We.isFileSystemFileHandle(r)?this._files.set(t,r):We.isFileSystemDirectoryHandle(r)&&this._directories.set(t,r),r}throw this.createFileSystemProviderError(e,"No file system handle registered",y.Unavailable)}toFileSystemProviderError(e){if(e instanceof oi)return e;let t=y.Unknown;return e.name==="NotAllowedError"&&(e=new Error(c(1850,"Insufficient permissions. Please retry and allow the operation.")),t=y.Unavailable),b(e,t)}createFileSystemProviderError(e,t,i){return b(new Error(`${t} (${ia(e.path)})`),i)}}class of extends D{constructor(e){if(super(),this.channelName=e,this._onDidReceiveData=this._register(new v),this.onDidReceiveData=this._onDidReceiveData.event,"BroadcastChannel"in Ce)try{this.broadcastChannel=new BroadcastChannel(e);const t=i=>{this._onDidReceiveData.fire(i.data)};this.broadcastChannel.addEventListener("message",t),this._register(de(()=>{this.broadcastChannel&&(this.broadcastChannel.removeEventListener("message",t),this.broadcastChannel.close())}))}catch(t){console.warn("Error while creating broadcast channel. Falling back to localStorage.",En(t))}this.broadcastChannel||(this.channelName=`BroadcastDataChannel.${e}`,this.createBroadcastChannel())}createBroadcastChannel(){const e=t=>{t.key===this.channelName&&t.newValue&&this._onDidReceiveData.fire(JSON.parse(t.newValue))};Ce.addEventListener("storage",e),this._register(de(()=>Ce.removeEventListener("storage",e)))}postData(e){this.broadcastChannel?this.broadcastChannel.postMessage(e):(localStorage.removeItem(this.channelName),localStorage.setItem(this.channelName,JSON.stringify(e)))}}b(c(1851,"File does not exist"),y.FileNotFound);b(c(1852,"File is Directory"),y.FileIsADirectory);b(c(1853,"File is not a directory"),y.FileNotADirectory);b(c(1854,"Directory is not empty"),y.Unknown);b(c(1855,"File exceeds available storage quota"),y.FileExceedsStorageQuota);class Md extends ra{constructor(e=sa){super(),this.buffer=[],this._logger=void 0,this._logLevelDisposable=this._register(new qe),this.setLevel(e)}set logger(e){this._logger=e,this.setLevel(e.getLevel()),this._logLevelDisposable.value=e.onDidChangeLogLevel(this.setLevel,this);for(const{level:t,message:i}of this.buffer)ls(e,t,i);this.buffer=[]}log(e,t){this._logger?ls(this._logger,e,t):this.getLevel()<=e&&this.buffer.push({level:e,message:t})}dispose(){this._logger?.dispose(),super.dispose()}flush(){this._logger?.flush()}}class Bd extends D{constructor(){super(...arguments),this._onWillDispose=this._register(new v),this.onWillDispose=this._onWillDispose.event,this.resolved=!1}async resolve(){this.resolved=!0}isResolved(){return this.resolved}isDisposed(){return this._store.isDisposed}dispose(){this._onWillDispose.fire(),super.dispose()}}const Js="languageDetection",af="automaticlanguagedetection.likelywrong";var cr;let Wt=class extends Bd{static{cr=this}static{this.AUTO_DETECT_LANGUAGE_THROTTLE_DELAY=600}constructor(e,t,i,r,n){super(),this.modelService=e,this.languageService=t,this.languageDetectionService=i,this.accessibilityService=r,this.textEditorModelHandle=void 0,this.modelDisposeListener=this._register(new qe),this.autoDetectLanguageThrottler=this._register(new na(cr.AUTO_DETECT_LANGUAGE_THROTTLE_DELAY)),this._blockLanguageChangeListener=!1,this._languageChangeSource=void 0,n&&this.handleExistingModel(n)}handleExistingModel(e){const t=this.modelService.getModel(e);if(!t)throw new Error(`Document with resource ${e.toString(!0)} does not exist`);this.textEditorModelHandle=e,this.registerModelDisposeListener(t)}registerModelDisposeListener(e){this.modelDisposeListener.value=e.onWillDispose(()=>{this.textEditorModelHandle=void 0,this.dispose()})}get textEditorModel(){return this.textEditorModelHandle?this.modelService.getModel(this.textEditorModelHandle):null}isReadonly(){return!0}get languageChangeSource(){return this._languageChangeSource}get hasLanguageSetExplicitly(){return typeof this._languageChangeSource=="string"}setLanguageId(e,t){this._languageChangeSource="user",this.setLanguageIdInternal(e,t)}setLanguageIdInternal(e,t){if(this.isResolved()&&!(!e||e===this.textEditorModel.getLanguageId())){this._blockLanguageChangeListener=!0;try{this.textEditorModel.setLanguage(this.languageService.createById(e),t)}finally{this._blockLanguageChangeListener=!1}}}installModelListeners(e){const t=this._register(e.onDidChangeLanguage(i=>{i.source===Js||this._blockLanguageChangeListener||(this._languageChangeSource="api",t.dispose())}))}getLanguageId(){return this.textEditorModel?.getLanguageId()}autoDetectLanguage(){return this.autoDetectLanguageThrottler.trigger(()=>this.doAutoDetectLanguage())}async doAutoDetectLanguage(){if(this.hasLanguageSetExplicitly||!this.textEditorModelHandle||!this.languageDetectionService.isEnabledForLanguage(this.getLanguageId()??Ie))return;const e=await this.languageDetectionService.detectLanguage(this.textEditorModelHandle),t=this.getLanguageId();if(e&&e!==t&&!this.isDisposed()){this.setLanguageIdInternal(e,Js);const i=this.languageService.getLanguageName(e);this.accessibilityService.alert(c(3883,"Language {0} was automatically detected and set as the language mode.",i??e))}}createTextEditorModel(e,t,i){const r=this.getFirstLineText(e),n=this.getOrCreateLanguage(t,this.languageService,i,r);return this.doCreateTextEditorModel(e,n,t)}doCreateTextEditorModel(e,t,i){let r=i&&this.modelService.getModel(i);return r?this.updateTextEditorModel(e,t.languageId):(r=this.modelService.createModel(e,t,i),this.createdEditorModel=!0,this.registerModelDisposeListener(r)),this.textEditorModelHandle=r.uri,r}getFirstLineText(e){const t=e;return typeof t.getFirstLineText=="function"?t.getFirstLineText(ds.FIRST_LINE_DETECTION_LENGTH_LIMIT):e.getLineContent(1).substr(0,ds.FIRST_LINE_DETECTION_LENGTH_LIMIT)}getOrCreateLanguage(e,t,i,r){return!i||i===Ie?t.createByFilepathOrFirstLine(e??null,r):t.createById(i)}updateTextEditorModel(e,t){this.isResolved()&&(e&&this.modelService.updateModel(this.textEditorModel,e),t&&t!==Ie&&this.textEditorModel.getLanguageId()!==t&&this.textEditorModel.setLanguage(this.languageService.createById(t)))}createSnapshot(){return this.textEditorModel?this.textEditorModel.createSnapshot(!0):null}isResolved(){return!!this.textEditorModelHandle}dispose(){this.modelDisposeListener.dispose(),this.textEditorModelHandle&&this.createdEditorModel&&this.modelService.destroyModel(this.textEditorModelHandle),this.textEditorModelHandle=void 0,this.createdEditorModel=!1,super.dispose()}};Wt=cr=x([u(0,Ve),u(1,Be),u(2,Xr),u(3,Mr)],Wt);var ui;(function(s){s[s.None=0]="None",s[s.Untitled=2]="Untitled",s[s.Scratchpad=4]="Scratchpad"})(ui||(ui={}));const oo="";var ot;let lr=class extends Wt{static{ot=this}static{this.FIRST_LINE_NAME_MAX_LENGTH=40}static{this.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH=this.FIRST_LINE_NAME_MAX_LENGTH*10}static{this.ACTIVE_EDITOR_LANGUAGE_ID="${activeEditorLanguage}"}get name(){return this.configuredLabelFormat==="content"&&!this.hasAssociatedFilePath&&this.cachedModelFirstLineWords?this.cachedModelFirstLineWords:this.labelService.getUriBasenameLabel(this.resource)}constructor(e,t,i,r,n,o,a,l,d,f,h,g,S,w,m){super(a,o,w,m),this.resource=e,this.hasAssociatedFilePath=t,this.initialValue=i,this.preferredLanguageId=r,this.preferredEncoding=n,this.workingCopyBackupService=l,this.textResourceConfigurationService=d,this.workingCopyService=f,this.textFileService=h,this.labelService=g,this.editorService=S,this._onDidChangeContent=this._register(new v),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidChangeName=this._register(new v),this.onDidChangeName=this._onDidChangeName.event,this._onDidChangeDirty=this._register(new v),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeEncoding=this._register(new v),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this._onDidSave=this._register(new v),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new v),this.onDidRevert=this._onDidRevert.event,this.typeId=oo,this.capabilities=ui.Untitled,this.configuredLabelFormat="content",this.cachedModelFirstLineWords=void 0,this.ignoreDirtyOnModelContentChange=!1,this.dirty=this.hasAssociatedFilePath||!!this.initialValue,this._register(this.workingCopyService.registerWorkingCopy(this)),r&&this.setLanguageId(r),this.onConfigurationChange(void 0,!1),this.registerListeners()}registerListeners(){this._register(this.textResourceConfigurationService.onDidChangeConfiguration(e=>this.onConfigurationChange(e,!0)))}onConfigurationChange(e,t){if(!e||e.affectsConfiguration(this.resource,"files.encoding")){const i=this.textResourceConfigurationService.getValue(this.resource,"files.encoding");this.configuredEncoding!==i&&typeof i=="string"&&(this.configuredEncoding=i,t&&!this.preferredEncoding&&this._onDidChangeEncoding.fire())}if(!e||e.affectsConfiguration(this.resource,"workbench.editor.untitled.labelFormat")){const i=this.textResourceConfigurationService.getValue(this.resource,"workbench.editor.untitled.labelFormat");this.configuredLabelFormat!==i&&(i==="content"||i==="name")&&(this.configuredLabelFormat=i,t&&this._onDidChangeName.fire())}}setLanguageId(e,t){const i=e===ot.ACTIVE_EDITOR_LANGUAGE_ID?this.editorService.activeTextEditorLanguageId:e;this.preferredLanguageId=i,i&&super.setLanguageId(i,t)}getLanguageId(){return this.textEditorModel?this.textEditorModel.getLanguageId():this.preferredLanguageId}getEncoding(){return this.preferredEncoding||this.configuredEncoding}async setEncoding(e){const t=this.getEncoding();this.preferredEncoding=e,t!==this.preferredEncoding&&this._onDidChangeEncoding.fire()}isDirty(){return this.dirty}isModified(){return this.isDirty()}setDirty(e){this.dirty!==e&&(this.dirty=e,this._onDidChangeDirty.fire())}async save(e){const t=await this.textFileService.save(this.resource,e);return t&&this._onDidSave.fire({reason:e?.reason,source:e?.source}),!!t}async revert(){this.ignoreDirtyOnModelContentChange=!0;try{this.updateTextEditorModel(oa(""))}finally{this.ignoreDirtyOnModelContentChange=!1}this.setDirty(!1),this._onDidRevert.fire()}async backup(e){let t;return this.isResolved()?t=await this.textFileService.getEncodedReadable(this.resource,this.createSnapshot()??void 0,{encoding:G}):typeof this.initialValue=="string"&&(t=vn(_.fromString(this.initialValue))),{content:t}}async resolve(){let e=!1,t=!1;if(this.textEditorModel)this.updateTextEditorModel(void 0,this.preferredLanguageId);else{let r;const n=await this.workingCopyBackupService.resolve(this);n?(r=n.value,t=!0):r=yn(_.fromString(this.initialValue||""));const o=await Br(await this.textFileService.getDecodedStream(this.resource,r,{encoding:G}));this.createTextEditorModel(o,this.resource,this.preferredLanguageId),e=!0}const i=Ar(this.textEditorModel);return this.installModelListeners(i),e&&((t||this.initialValue)&&this.updateNameFromFirstLine(i),this.setDirty(this.hasAssociatedFilePath||!!t||!!this.initialValue),(t||this.initialValue)&&this._onDidChangeContent.fire()),super.resolve()}installModelListeners(e){this._register(e.onDidChangeContent(t=>this.onModelContentChanged(e,t))),this._register(e.onDidChangeLanguage(()=>this.onConfigurationChange(void 0,!0))),super.installModelListeners(e)}onModelContentChanged(e,t){this.ignoreDirtyOnModelContentChange||(!this.hasAssociatedFilePath&&e.getLineCount()===1&&e.getLineLength(1)===0?this.setDirty(!1):this.setDirty(!0)),t.changes.some(i=>(i.range.startLineNumber===1||i.range.endLineNumber===1)&&i.range.startColumn<=ot.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH)&&this.updateNameFromFirstLine(e),this._onDidChangeContent.fire(),this.autoDetectLanguage()}updateNameFromFirstLine(e){if(this.hasAssociatedFilePath)return;let t,i=e.getValueInRange({startLineNumber:1,endLineNumber:1,startColumn:1,endColumn:ot.FIRST_LINE_NAME_CANDIDATE_MAX_LENGTH+1}).trim().replace(/\s+/g," ").replace(/\u202E/g,"");i=i.substr(0,aa(i,ot.FIRST_LINE_NAME_MAX_LENGTH)[0]),i&&ca().exec(i)&&(t=i),t!==this.cachedModelFirstLineWords&&(this.cachedModelFirstLineWords=t,this._onDidChangeName.fire())}isReadonly(){return!1}};lr=ot=x([u(5,Be),u(6,Ve),u(7,to),u(8,St),u(9,Vr),u(10,Ct),u(11,Gr),u(12,yi),u(13,Xr),u(14,Mr)],lr);var Ft;let dr=class extends Wt{static{Ft=this}static{this.TEXTFILE_SAVE_ENCODING_SOURCE=er.registerSource("textFileEncoding.source",c(12885,"File Encoding Changed"))}static{this.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD=500}constructor(e,t,i,r,n,o,a,l,d,f,h,g,S,w,m,N,De){super(n,r,S,w),this.resource=e,this.preferredEncoding=t,this.preferredLanguageId=i,this.fileService=o,this.textFileService=a,this.workingCopyBackupService=l,this.logService=d,this.workingCopyService=f,this.filesConfigurationService=h,this.labelService=g,this.pathService=m,this.extensionService=N,this.progressService=De,this._onDidChangeContent=this._register(new v),this.onDidChangeContent=this._onDidChangeContent.event,this._onDidResolve=this._register(new v),this.onDidResolve=this._onDidResolve.event,this._onDidChangeDirty=this._register(new v),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidSaveError=this._register(new v),this.onDidSaveError=this._onDidSaveError.event,this._onDidSave=this._register(new v),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new v),this.onDidRevert=this._onDidRevert.event,this._onDidChangeEncoding=this._register(new v),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this._onDidChangeOrphaned=this._register(new v),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this._onDidChangeReadonly=this._register(new v),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this.typeId=oo,this.capabilities=ui.None,this.versionId=0,this.ignoreDirtyOnModelContentChange=!1,this.ignoreSaveFromSaveParticipants=!1,this.lastModelContentChangeFromUndoRedo=void 0,this.saveSequentializer=new la,this.dirty=!1,this.inConflictMode=!1,this.inOrphanMode=!1,this.inErrorMode=!1,this.hasEncodingSetExplicitly=!1,this.name=Pe(this.labelService.getUriLabel(this.resource)),this.resourceHasExtension=!!me.extname(this.resource),this._register(this.workingCopyService.registerWorkingCopy(this)),this.registerListeners()}registerListeners(){this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e))),this._register(this.filesConfigurationService.onDidChangeFilesAssociation(()=>this.onDidChangeFilesAssociation())),this._register(this.filesConfigurationService.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))}async onDidFilesChange(e){let t=!1,i;if(this.inOrphanMode?e.contains(this.resource,P.ADDED)&&(i=!1,t=!0):e.contains(this.resource,P.DELETED)&&(i=!0,t=!0),t&&this.inOrphanMode!==i){let r=!1;i&&(await qi(100,ni.None),this.isDisposed()?r=!0:r=!await this.fileService.exists(this.resource)),this.inOrphanMode!==r&&!this.isDisposed()&&this.setOrphaned(r)}}setOrphaned(e){this.inOrphanMode!==e&&(this.inOrphanMode=e,this._onDidChangeOrphaned.fire())}onDidChangeFilesAssociation(){if(!this.isResolved())return;const e=this.getFirstLineText(this.textEditorModel),t=this.getOrCreateLanguage(this.resource,this.languageService,this.preferredLanguageId,e);this.textEditorModel.setLanguage(t)}setLanguageId(e,t){super.setLanguageId(e,t),this.preferredLanguageId=e}async backup(e){let t;this.lastResolvedFileStat&&(t={mtime:this.lastResolvedFileStat.mtime,ctime:this.lastResolvedFileStat.ctime,size:this.lastResolvedFileStat.size,etag:this.lastResolvedFileStat.etag,orphaned:this.inOrphanMode});const i=await this.textFileService.getEncodedReadable(this.resource,this.createSnapshot()??void 0,{encoding:G});return{meta:t,content:i}}async revert(e){if(!this.isResolved())return;const t=this.dirty,i=this.doSetDirty(!1);if(!e?.soft)try{await this.forceResolveFromFile()}catch(n){if(n.fileOperationResult!==L.FILE_NOT_FOUND)throw i(),n}this._onDidRevert.fire(),t&&this._onDidChangeDirty.fire()}async resolve(e){if(this.trace("resolve() - enter"),Fe("code/willResolveTextFileEditorModel"),this.isDisposed()){this.trace("resolve() - exit - without resolving because model is disposed");return}if(!e?.contents&&(this.dirty||this.saveSequentializer.isRunning())){this.trace("resolve() - exit - without resolving because model is dirty or being saved");return}await this.doResolve(e),Fe("code/didResolveTextFileEditorModel")}async doResolve(e){if(e?.contents)return this.resolveFromBuffer(e.contents,e);if(!(!this.isResolved()&&await this.resolveFromBackup(e)))return this.resolveFromFile(e)}async resolveFromBuffer(e,t){this.trace("resolveFromBuffer()");let i,r,n,o;try{const l=await this.fileService.stat(this.resource);i=l.mtime,r=l.ctime,n=l.size,o=l.etag,this.setOrphaned(!1)}catch(l){i=Date.now(),r=Date.now(),n=0,o=$e,this.setOrphaned(l.fileOperationResult===L.FILE_NOT_FOUND)}const a=await this.textFileService.encoding.getPreferredWriteEncoding(this.resource,this.preferredEncoding);this.resolveFromContent({resource:this.resource,name:this.name,mtime:i,ctime:r,size:n,etag:o,value:e,encoding:a.encoding,readonly:!1,locked:!1},!0,t)}async resolveFromBackup(e){const t=await this.workingCopyBackupService.resolve(this);let i=G;return t&&(i=(await this.textFileService.encoding.getPreferredWriteEncoding(this.resource,this.preferredEncoding)).encoding),!this.isResolved()?t?(await this.doResolveFromBackup(t,i,e),!0):!1:(this.trace("resolveFromBackup() - exit - without resolving because previously new model got created meanwhile"),!0)}async doResolveFromBackup(e,t,i){this.trace("doResolveFromBackup()"),this.resolveFromContent({resource:this.resource,name:this.name,mtime:e.meta?e.meta.mtime:Date.now(),ctime:e.meta?e.meta.ctime:Date.now(),size:e.meta?e.meta.size:0,etag:e.meta?e.meta.etag:$e,value:await Br(await this.textFileService.getDecodedStream(this.resource,e.value,{encoding:G})),encoding:t,readonly:!1,locked:!1},!0,i),e.meta?.orphaned&&this.setOrphaned(!0)}async resolveFromFile(e){this.trace("resolveFromFile()");const t=e?.forceReadFromFile,i=this.isResolved()||e?.allowBinary;let r;t?r=$e:this.lastResolvedFileStat&&(r=this.lastResolvedFileStat.etag);const n=this.versionId;try{const o=await this.textFileService.readStream(this.resource,{acceptTextOnly:!i,etag:r,encoding:this.preferredEncoding,limits:e?.limits});if(this.setOrphaned(!1),n!==this.versionId){this.trace("resolveFromFile() - exit - without resolving because model content changed");return}return this.resolveFromContent(o,!1,e)}catch(o){const a=o.fileOperationResult;if(this.setOrphaned(a===L.FILE_NOT_FOUND),this.isResolved()&&a===L.FILE_NOT_MODIFIED_SINCE){o instanceof $t&&this.updateLastResolvedFileStat(o.stat);return}if(this.isResolved()&&a===L.FILE_NOT_FOUND&&!t)return;throw o}}resolveFromContent(e,t,i){if(this.trace("resolveFromContent() - enter"),this.isDisposed()){this.trace("resolveFromContent() - exit - because model is disposed");return}this.updateLastResolvedFileStat({resource:this.resource,name:e.name,mtime:e.mtime,ctime:e.ctime,size:e.size,etag:e.etag,readonly:e.readonly,locked:e.locked,isFile:!0,isDirectory:!1,isSymbolicLink:!1,children:void 0});const r=this.contentEncoding;this.contentEncoding=e.encoding,this.preferredEncoding?this.updatePreferredEncoding(this.contentEncoding):r!==this.contentEncoding&&this._onDidChangeEncoding.fire(),this.textEditorModel?this.textEditorModel.editWithReason(new da({source:"reloadFromDisk"}),()=>{this.doUpdateTextModel(e.value)}):this.doCreateTextModel(e.resource,e.value),this.setDirty(!!t),this._onDidResolve.fire(i?.reason??rr.OTHER)}doCreateTextModel(e,t){this.trace("doCreateTextModel()");const i=this.createTextEditorModel(t,e,this.preferredLanguageId);this.installModelListeners(i),this.autoDetectLanguage()}doUpdateTextModel(e){this.trace("doUpdateTextModel()"),this.ignoreDirtyOnModelContentChange=!0;try{this.updateTextEditorModel(e,this.preferredLanguageId)}finally{this.ignoreDirtyOnModelContentChange=!1}}installModelListeners(e){this._register(e.onDidChangeContent(t=>this.onModelContentChanged(e,t.isUndoing||t.isRedoing))),this._register(e.onDidChangeLanguage(()=>this.onMaybeShouldChangeEncoding())),super.installModelListeners(e)}onModelContentChanged(e,t){if(this.trace("onModelContentChanged() - enter"),this.versionId++,this.trace(`onModelContentChanged() - new versionId ${this.versionId}`),t&&(this.lastModelContentChangeFromUndoRedo=Date.now()),!this.ignoreDirtyOnModelContentChange&&!this.isReadonly())if(e.getAlternativeVersionId()===this.bufferSavedVersionId){this.trace("onModelContentChanged() - model content changed back to last saved version");const i=this.dirty;this.setDirty(!1),i&&this._onDidRevert.fire()}else this.trace("onModelContentChanged() - model content changed and marked as dirty"),this.setDirty(!0);this._onDidChangeContent.fire(),this.autoDetectLanguage()}async autoDetectLanguage(){await this.extensionService?.whenInstalledExtensionsRegistered();const e=this.getLanguageId();if(this.resource.scheme===this.pathService.defaultUriScheme&&(!e||e===Ie)&&!this.resourceHasExtension)return super.autoDetectLanguage()}async forceResolveFromFile(){this.isDisposed()||await this.textFileService.files.resolve(this.resource,{reload:{async:!1},forceReadFromFile:!0})}isDirty(){return this.dirty}isModified(){return this.isDirty()}setDirty(e){if(!this.isResolved())return;const t=this.dirty;this.doSetDirty(e),e!==t&&this._onDidChangeDirty.fire()}doSetDirty(e){const t=this.dirty,i=this.inConflictMode,r=this.inErrorMode,n=this.bufferSavedVersionId;return e?this.dirty=!0:(this.dirty=!1,this.inConflictMode=!1,this.inErrorMode=!1,this.updateSavedVersionId()),()=>{this.dirty=t,this.inConflictMode=i,this.inErrorMode=r,this.bufferSavedVersionId=n}}async save(e=Object.create(null)){return this.isResolved()?this.isReadonly()?(this.trace("save() - ignoring request for readonly resource"),!1):(this.hasState(J.CONFLICT)||this.hasState(J.ERROR))&&(e.reason===ne.AUTO||e.reason===ne.FOCUS_CHANGE||e.reason===ne.WINDOW_CHANGE)?(this.trace("save() - ignoring auto save request for model that is in conflict or error"),!1):(this.trace("save() - enter"),await this.doSave(e),this.trace("save() - exit"),this.hasState(J.SAVED)):!1}async doSave(e){typeof e.reason!="number"&&(e.reason=ne.EXPLICIT);const t=this.versionId;if(this.trace(`doSave(${t}) - enter with versionId ${t}`),this.ignoreSaveFromSaveParticipants){this.trace(`doSave(${t}) - exit - refusing to save() recursively from save participant`);return}if(this.saveSequentializer.isRunning(t))return this.trace(`doSave(${t}) - exit - found a running save for versionId ${t}`),this.saveSequentializer.running;if(!e.force&&!this.dirty){this.trace(`doSave(${t}) - exit - because not dirty and/or versionId is different (this.isDirty: ${this.dirty}, this.versionId: ${this.versionId})`);return}if(this.saveSequentializer.isRunning())return this.trace(`doSave(${t}) - exit - because busy saving`),this.saveSequentializer.cancelRunning(),this.saveSequentializer.queue(()=>this.doSave(e));this.isResolved()&&this.textEditorModel.pushStackElement();const i=new Ut;return this.progressService.withProgress({title:c(12886,"Saving '{0}'",this.name),location:mn.Window,cancellable:!0,delay:this.isDirty()?3e3:5e3},r=>this.doSaveSequential(t,e,r,i),()=>{i.cancel()}).finally(()=>{i.dispose()})}doSaveSequential(e,t,i,r){return this.saveSequentializer.run(e,(async()=>{if(this.isResolved()&&!t.skipSaveParticipants)try{if(t.reason===ne.AUTO&&typeof this.lastModelContentChangeFromUndoRedo=="number"){const a=Date.now()-this.lastModelContentChangeFromUndoRedo;a<Ft.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD&&await qi(Ft.UNDO_REDO_SAVE_PARTICIPANTS_AUTO_SAVE_THROTTLE_THRESHOLD-a)}if(!r.token.isCancellationRequested){this.ignoreSaveFromSaveParticipants=!0;try{await this.textFileService.files.runSaveParticipants(this,{reason:t.reason??ne.EXPLICIT,savedFrom:t.from},i,r.token)}catch(a){Rn(a)&&!r.token.isCancellationRequested&&r.cancel()}finally{this.ignoreSaveFromSaveParticipants=!1}}}catch(a){this.logService.error(`[text file model] runSaveParticipants(${e}) - resulted in an error: ${a.toString()}`,this.resource.toString())}if(r.token.isCancellationRequested||(r.dispose(),this.isDisposed())||!this.isResolved())return;e=this.versionId,this.inErrorMode=!1,i.report({message:c(12887,"Writing into file...")}),this.trace(`doSave(${e}) - before write()`);const n=Ar(this.lastResolvedFileStat),o=this;return this.saveSequentializer.run(e,(async()=>{try{const a=await this.textFileService.write(n.resource,o.createSnapshot(),{mtime:n.mtime,encoding:this.getEncoding(),etag:t.ignoreModifiedSince||!this.filesConfigurationService.preventSaveConflicts(n.resource,o.getLanguageId())?$e:n.etag,unlock:t.writeUnlock,writeElevated:t.writeElevated});this.handleSaveSuccess(a,e,t)}catch(a){this.handleSaveError(a,e,t)}})())})(),()=>r.cancel())}handleSaveSuccess(e,t,i){this.updateLastResolvedFileStat(e),t===this.versionId?(this.trace(`handleSaveSuccess(${t}) - setting dirty to false because versionId did not change`),this.setDirty(!1)):this.trace(`handleSaveSuccess(${t}) - not setting dirty to false because versionId did change meanwhile`),this.setOrphaned(!1),this._onDidSave.fire({reason:i.reason,stat:e,source:i.source})}handleSaveError(e,t,i){if((i.ignoreErrorHandler?this.logService.trace:this.logService.error).apply(this.logService,[`[text file model] handleSaveError(${t}) - exit - resulted in a save error: ${e.toString()}`,this.resource.toString()]),i.ignoreErrorHandler)throw e;this.setDirty(!0),this.inErrorMode=!0,e.fileOperationResult===L.FILE_MODIFIED_SINCE&&(this.inConflictMode=!0),this.textFileService.files.saveErrorHandler.onSaveError(e,this,i),this._onDidSaveError.fire()}updateSavedVersionId(){this.isResolved()&&(this.bufferSavedVersionId=this.textEditorModel.getAlternativeVersionId())}updateLastResolvedFileStat(e){const t=this.isReadonly();this.lastResolvedFileStat?this.lastResolvedFileStat.mtime<=e.mtime?this.lastResolvedFileStat=e:this.lastResolvedFileStat={...this.lastResolvedFileStat,readonly:e.readonly,locked:e.locked}:this.lastResolvedFileStat=e,this.isReadonly()!==t&&this._onDidChangeReadonly.fire()}hasState(e){switch(e){case J.CONFLICT:return this.inConflictMode;case J.DIRTY:return this.dirty;case J.ERROR:return this.inErrorMode;case J.ORPHAN:return this.inOrphanMode;case J.PENDING_SAVE:return this.saveSequentializer.isRunning();case J.SAVED:return!this.dirty}}async joinState(e){return this.saveSequentializer.running}getLanguageId(){return this.textEditorModel?this.textEditorModel.getLanguageId():this.preferredLanguageId}async onMaybeShouldChangeEncoding(){if(this.hasEncodingSetExplicitly){this.trace("onMaybeShouldChangeEncoding() - ignoring because encoding was set explicitly");return}if(this.contentEncoding===Oe||this.contentEncoding===Qe||this.contentEncoding===Ze){this.trace("onMaybeShouldChangeEncoding() - ignoring because content encoding has a BOM");return}const{encoding:e}=await this.textFileService.encoding.getPreferredReadEncoding(this.resource);if(typeof e!="string"||!this.isNewEncoding(e)){this.trace(`onMaybeShouldChangeEncoding() - ignoring because preferred encoding ${e} is not new`);return}if(this.isDirty()){this.trace("onMaybeShouldChangeEncoding() - ignoring because model is dirty");return}return this.logService.info(`Adjusting encoding based on configured language override to '${e}' for ${this.resource.toString(!0)}.`),this.forceResolveFromFile()}setEncoding(e,t){return this.hasEncodingSetExplicitly=!0,this.setEncodingInternal(e,t)}async setEncodingInternal(e,t){if(t===sr.Encode)this.updatePreferredEncoding(e),this.isDirty()||(this.versionId++,this.setDirty(!0)),this.inConflictMode||await this.save({source:Ft.TEXTFILE_SAVE_ENCODING_SOURCE});else{if(!this.isNewEncoding(e))return;this.isDirty()&&!this.inConflictMode&&await this.save(),this.updatePreferredEncoding(e),await this.forceResolveFromFile()}}updatePreferredEncoding(e){this.isNewEncoding(e)&&(this.preferredEncoding=e,this._onDidChangeEncoding.fire())}isNewEncoding(e){return!(this.preferredEncoding===e||!this.preferredEncoding&&this.contentEncoding===e)}getEncoding(){return this.preferredEncoding||this.contentEncoding}trace(e){this.logService.trace(`[text file model] ${e}`,this.resource.toString())}isResolved(){return!!this.textEditorModel}isReadonly(){return this.filesConfigurationService.isReadonly(this.resource,this.lastResolvedFileStat)}dispose(){this.trace("dispose()"),this.inConflictMode=!1,this.inOrphanMode=!1,this.inErrorMode=!1,super.dispose()}};dr=Ft=x([u(3,Be),u(4,Ve),u(5,te),u(6,Ct),u(7,to),u(8,Ge),u(9,Vr),u(10,Mt),u(11,Gr),u(12,Xr),u(13,Mr),u(14,mi),u(15,bi),u(16,_n)],dr);let hr=class extends D{constructor(e,t){super(),this.logService=e,this.progressService=t,this.saveParticipants=new ha}addSaveParticipant(e){const t=this.saveParticipants.push(e);return de(()=>t())}async participate(e,t,i,r){const n=new Ut(r);e.textEditorModel?.pushStackElement(),i.report({message:c(12889,"Running Code Actions and Formatters...")});let o=!1;if(await this.progressService.withProgress({priority:Dt.URGENT,location:mn.Notification,cancellable:c(12890,"Skip"),delay:e.isDirty()?5e3:3e3},async a=>{const l=Array.from(this.saveParticipants).sort((d,f)=>{const h=d.ordinal??0,g=f.ordinal??0;return h-g});for(const d of l){if(n.token.isCancellationRequested||!e.textEditorModel)break;try{const f=d.participate(e,t,a,n.token);await ua(f,n.token)}catch(f){Rn(f)?n.token.isCancellationRequested||(n.cancel(),o=!0):this.logService.error(f)}}},()=>{n.cancel()}),e.textEditorModel?.pushStackElement(),n.dispose(),o)throw new fa}dispose(){this.saveParticipants.clear(),super.dispose()}};hr=x([u(0,Ge),u(1,_n)],hr);let ur=class extends D{get models(){return[...this.mapResourceToModel.values()]}constructor(e,t,i,r,n){super(),this.instantiationService=e,this.fileService=t,this.notificationService=i,this.workingCopyFileService=r,this.uriIdentityService=n,this._onDidCreate=this._register(new v({leakWarningThreshold:500})),this.onDidCreate=this._onDidCreate.event,this._onDidResolve=this._register(new v),this.onDidResolve=this._onDidResolve.event,this._onDidRemove=this._register(new v),this.onDidRemove=this._onDidRemove.event,this._onDidChangeDirty=this._register(new v),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeReadonly=this._register(new v),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this._onDidChangeOrphaned=this._register(new v),this.onDidChangeOrphaned=this._onDidChangeOrphaned.event,this._onDidSaveError=this._register(new v),this.onDidSaveError=this._onDidSaveError.event,this._onDidSave=this._register(new v),this.onDidSave=this._onDidSave.event,this._onDidRevert=this._register(new v),this.onDidRevert=this._onDidRevert.event,this._onDidChangeEncoding=this._register(new v),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this.mapResourceToModel=new Z,this.mapResourceToModelListeners=new Z,this.mapResourceToDisposeListener=new Z,this.mapResourceToPendingModelResolvers=new Z,this.modelResolveQueue=this._register(new pn),this.saveErrorHandler=(()=>{const o=this.notificationService;return{onSaveError(a,l){o.error(c(12888,"Failed to save '{0}': {1}",l.name,Dn(a,!1)))}}})(),this.mapCorrelationIdToModelsToRestore=new Map,this.saveParticipants=this._register(this.instantiationService.createInstance(hr)),this.registerListeners()}registerListeners(){this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e))),this._register(this.fileService.onDidChangeFileSystemProviderCapabilities(e=>this.onDidChangeFileSystemProviderCapabilities(e))),this._register(this.fileService.onDidChangeFileSystemProviderRegistrations(e=>this.onDidChangeFileSystemProviderRegistrations(e))),this._register(this.workingCopyFileService.onWillRunWorkingCopyFileOperation(e=>this.onWillRunWorkingCopyFileOperation(e))),this._register(this.workingCopyFileService.onDidFailWorkingCopyFileOperation(e=>this.onDidFailWorkingCopyFileOperation(e))),this._register(this.workingCopyFileService.onDidRunWorkingCopyFileOperation(e=>this.onDidRunWorkingCopyFileOperation(e)))}onDidFilesChange(e){for(const t of this.models)t.isDirty()||e.contains(t.resource,P.UPDATED,P.ADDED)&&this.queueModelReload(t)}onDidChangeFileSystemProviderCapabilities(e){this.queueModelReloads(e.scheme)}onDidChangeFileSystemProviderRegistrations(e){e.added&&this.queueModelReloads(e.scheme)}queueModelReloads(e){for(const t of this.models)t.isDirty()||e===t.resource.scheme&&this.queueModelReload(t)}queueModelReload(e){this.modelResolveQueue.queueSize(e.resource)<=1&&this.modelResolveQueue.queueFor(e.resource,async()=>{try{await this.reload(e)}catch(i){hs(i)}})}onWillRunWorkingCopyFileOperation(e){if(e.operation===T.MOVE||e.operation===T.COPY){const t=[];for(const{source:i,target:r}of e.files)if(i){if(this.uriIdentityService.extUri.isEqual(i,r))continue;const n=[];for(const o of this.models)this.uriIdentityService.extUri.isEqualOrParent(o.resource,i)&&n.push(o);for(const o of n){const a=o.resource;let l;this.uriIdentityService.extUri.isEqual(a,i)?l=r:l=j(r,a.path.substr(i.path.length+1));const d=o.getLanguageId();t.push({source:a,target:l,language:d?{id:d,explicit:o.languageChangeSource==="user"}:void 0,encoding:o.getEncoding(),snapshot:o.isDirty()?o.createSnapshot():void 0})}}this.mapCorrelationIdToModelsToRestore.set(e.correlationId,t)}}onDidFailWorkingCopyFileOperation(e){if(e.operation===T.MOVE||e.operation===T.COPY){const t=this.mapCorrelationIdToModelsToRestore.get(e.correlationId);t&&(this.mapCorrelationIdToModelsToRestore.delete(e.correlationId),t.forEach(i=>{i.snapshot&&this.get(i.source)?.setDirty(!0)}))}}onDidRunWorkingCopyFileOperation(e){switch(e.operation){case T.CREATE:e.waitUntil((async()=>{for(const{target:t}of e.files){const i=this.get(t);i&&!i.isDisposed()&&await i.revert()}})());break;case T.MOVE:case T.COPY:e.waitUntil((async()=>{const t=this.mapCorrelationIdToModelsToRestore.get(e.correlationId);t&&(this.mapCorrelationIdToModelsToRestore.delete(e.correlationId),await Le.settled(t.map(async i=>{const r=this.uriIdentityService.asCanonicalUri(i.target),n=await this.resolve(r,{reload:{async:!1},contents:i.snapshot?bn(i.snapshot):void 0,encoding:i.encoding});i.language?.id&&i.language.id!==Ie&&(i.language.explicit?n.setLanguageId(i.language.id):n.getLanguageId()===Ie&&Tr(r)!==ga&&n.updateTextEditorModel(void 0,i.language.id))})))})());break}}get(e){return this.mapResourceToModel.get(e)}has(e){return this.mapResourceToModel.has(e)}async reload(e){await this.joinPendingResolves(e.resource),!(e.isDirty()||e.isDisposed()||!this.has(e.resource))&&await this.doResolve(e,{reload:{async:!1}})}async resolve(e,t){const i=this.joinPendingResolves(e);return i&&await i,this.doResolve(e,t)}async doResolve(e,t){let i,r;K.isUri(e)?(r=e,i=this.get(r)):(r=e.resource,i=e);let n,o=!1;if(i)t?.contents?n=i.resolve(t):t?.reload?t.reload.async?(n=Promise.resolve(),(async()=>{try{await i.resolve(t)}catch(a){i.isDisposed()||hs(a)}})()):n=i.resolve(t):n=Promise.resolve();else{o=!0;const a=i=this.instantiationService.createInstance(dr,r,t?t.encoding:void 0,t?t.languageId:void 0);n=i.resolve(t),this.registerModel(a)}this.mapResourceToPendingModelResolvers.set(r,n),this.add(r,i),o&&(this._onDidCreate.fire(i),i.isDirty()&&this._onDidChangeDirty.fire(i));try{await n}catch(a){throw o&&i.dispose(),a}finally{this.mapResourceToPendingModelResolvers.delete(r)}return t?.languageId&&i.setLanguageId(t.languageId),o&&i.isDirty()&&this._onDidChangeDirty.fire(i),i}joinPendingResolves(e){if(this.mapResourceToPendingModelResolvers.get(e))return this.doJoinPendingResolves(e)}async doJoinPendingResolves(e){let t;for(;this.mapResourceToPendingModelResolvers.has(e);){const i=this.mapResourceToPendingModelResolvers.get(e);if(i===t)return;t=i;try{await i}catch{}}}registerModel(e){const t=new he;t.add(e.onDidResolve(i=>this._onDidResolve.fire({model:e,reason:i}))),t.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire(e))),t.add(e.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire(e))),t.add(e.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire(e))),t.add(e.onDidSaveError(()=>this._onDidSaveError.fire(e))),t.add(e.onDidSave(i=>this._onDidSave.fire({model:e,...i}))),t.add(e.onDidRevert(()=>this._onDidRevert.fire(e))),t.add(e.onDidChangeEncoding(()=>this._onDidChangeEncoding.fire(e))),this.mapResourceToModelListeners.set(e.resource,t)}add(e,t){if(this.mapResourceToModel.get(e)===t)return;this.mapResourceToDisposeListener.get(e)?.dispose(),this.mapResourceToModel.set(e,t),this.mapResourceToDisposeListener.set(e,t.onWillDispose(()=>this.remove(e)))}remove(e){const t=this.mapResourceToModel.delete(e),i=this.mapResourceToDisposeListener.get(e);i&&(Ee(i),this.mapResourceToDisposeListener.delete(e));const r=this.mapResourceToModelListeners.get(e);r&&(Ee(r),this.mapResourceToModelListeners.delete(e)),t&&this._onDidRemove.fire(e)}addSaveParticipant(e){return this.saveParticipants.addSaveParticipant(e)}runSaveParticipants(e,t,i,r){return this.saveParticipants.participate(e,t,i,r)}canDispose(e){return e.isDisposed()||!this.mapResourceToPendingModelResolvers.has(e.resource)&&!e.isDirty()?!0:this.doCanDispose(e)}async doCanDispose(e){const t=this.joinPendingResolves(e.resource);return t?(await t,this.canDispose(e)):e.isDirty()?(await H.toPromise(e.onDidChangeDirty),this.canDispose(e)):!0}dispose(){super.dispose(),this.mapResourceToModel.clear(),this.mapResourceToPendingModelResolvers.clear(),Ee(this.mapResourceToDisposeListener.values()),this.mapResourceToDisposeListener.clear(),Ee(this.mapResourceToModelListeners.values()),this.mapResourceToModelListeners.clear()}};ur=x([u(0,vt),u(1,te),u(2,Bt),u(3,Kr),u(4,ke)],ur);var Qt;let fr=class extends D{static{Qt=this}static{this.TEXTFILE_SAVE_CREATE_SOURCE=er.registerSource("textFileCreate.source",c(12872,"File Created"))}static{this.TEXTFILE_SAVE_REPLACE_SOURCE=er.registerSource("textFileOverwrite.source",c(12873,"File Replaced"))}constructor(e,t,i,r,n,o,a,l,d,f,h,g,S,w,m,N,De,tt){super(),this.fileService=e,this.lifecycleService=i,this.instantiationService=r,this.modelService=n,this.environmentService=o,this.dialogService=a,this.fileDialogService=l,this.textResourceConfigurationService=d,this.filesConfigurationService=f,this.codeEditorService=h,this.pathService=g,this.workingCopyFileService=S,this.uriIdentityService=w,this.languageService=m,this.logService=N,this.elevatedFileService=De,this.decorationsService=tt,this.files=this._register(this.instantiationService.createInstance(ur)),this.untitled=t,this.provideDecorations()}provideDecorations(){const e=this._register(new class extends D{constructor(t){super(),this.files=t,this.label=c(12874,"Text File Model Decorations"),this._onDidChange=this._register(new v),this.onDidChange=this._onDidChange.event,this.registerListeners()}registerListeners(){this._register(this.files.onDidResolve(({model:t})=>{(t.isReadonly()||t.hasState(J.ORPHAN))&&this._onDidChange.fire([t.resource])})),this._register(this.files.onDidRemove(t=>this._onDidChange.fire([t]))),this._register(this.files.onDidChangeReadonly(t=>this._onDidChange.fire([t.resource]))),this._register(this.files.onDidChangeOrphaned(t=>this._onDidChange.fire([t.resource])))}provideDecorations(t){const i=this.files.get(t);if(!i||i.isDisposed())return;const r=i.isReadonly(),n=i.hasState(J.ORPHAN);if(r&&n)return{color:fs,letter:us.lockSmall,strikethrough:!0,tooltip:c(12875,"Deleted, Read-only")};if(r)return{letter:us.lockSmall,tooltip:c(12876,"Read-only")};if(n)return{color:fs,strikethrough:!0,tooltip:c(12877,"Deleted")}}}(this.files));this._register(this.decorationsService.registerDecorationsProvider(e))}get encoding(){return this._encoding||(this._encoding=this._register(this.instantiationService.createInstance(gr))),this._encoding}async read(e,t){const[i,r]=await this.doRead(e,{...t,preferUnbuffered:!0});return{...i,encoding:r.detected.encoding||G,value:await wn(r.stream,n=>n.join(""))}}async readStream(e,t){const[i,r]=await this.doRead(e,t);return{...i,encoding:r.detected.encoding||G,value:await Br(r.stream)}}async doRead(e,t){const i=new Ut;let r;if(t?.preferUnbuffered){const n=await this.fileService.readFile(e,t,i.token);r={...n,value:yn(n.value)}}else r=await this.fileService.readFileStream(e,t,i.token);try{const n=await this.doGetDecodedStream(e,r.value,t);return[r,n]}catch(n){throw i.dispose(!0),n.decodeStreamErrorKind===ci.STREAM_IS_BINARY?new Dd(c(12878,"File seems to be binary and cannot be opened as text"),li.FILE_IS_BINARY,t):n}}async create(e,t){const i=await Promise.all(e.map(async r=>{const n=await this.getEncodedReadable(r.resource,r.value);return{resource:r.resource,contents:n,overwrite:r.options?.overwrite}}));return this.workingCopyFileService.create(i,ni.None,t)}async write(e,t,i){const r=await this.getEncodedReadable(e,t,i);return i?.writeElevated&&this.elevatedFileService.isSupported(e)?this.elevatedFileService.writeFileElevated(e,r,i):this.fileService.writeFile(e,r,i)}async getEncodedReadable(e,t,i){const{encoding:r,addBOM:n}=await this.encoding.getWriteEncoding(e,i);if(r===G&&!n)return typeof t>"u"?void 0:Fd(t);t=t||"";const o=typeof t=="string"?bd(t):t;return pd(o,r,{addBOM:n})}async getDecodedStream(e,t,i){return(await this.doGetDecodedStream(e,t,i)).stream}doGetDecodedStream(e,t,i){return gd(t,{acceptTextOnly:i?.acceptTextOnly??!1,guessEncoding:i?.autoGuessEncoding||this.textResourceConfigurationService.getValue(e,"files.autoGuessEncoding"),candidateGuessEncodings:i?.candidateGuessEncodings||this.textResourceConfigurationService.getValue(e,"files.candidateGuessEncodings"),overwriteEncoding:async r=>this.validateDetectedEncoding(e,r??void 0,i)})}getEncoding(e){return(e.scheme===k.untitled?this.untitled.get(e):this.files.get(e))?.getEncoding()??this.encoding.getUnvalidatedEncodingForResource(e)}async resolveDecoding(e,t){return{preferredEncoding:(await this.encoding.getPreferredReadEncoding(e,t,void 0)).encoding,guessEncoding:t?.autoGuessEncoding||this.textResourceConfigurationService.getValue(e,"files.autoGuessEncoding"),candidateGuessEncodings:t?.candidateGuessEncodings||this.textResourceConfigurationService.getValue(e,"files.candidateGuessEncodings")}}async validateDetectedEncoding(e,t,i){const{encoding:r}=await this.encoding.getPreferredReadEncoding(e,i,t);return r}resolveEncoding(e,t){return this.encoding.getWriteEncoding(e,t)}async save(e,t){if(e.scheme===k.untitled){const i=this.untitled.get(e);if(i){let r;if(i.hasAssociatedFilePath?r=await this.suggestSavePath(e):r=await this.fileDialogService.pickFileToSave(await this.suggestSavePath(e),t?.availableFileSystems),r)return this.saveAs(e,r,t)}}else{const i=this.files.get(e);if(i)return await i.save(t)?e:void 0}}async saveAs(e,t,i){if(t||(t=await this.fileDialogService.pickFileToSave(await this.suggestSavePath(i?.suggestedTarget??e),i?.availableFileSystems)),!!t){if(this.filesConfigurationService.isReadonly(t))if(await this.confirmMakeWriteable(t))this.filesConfigurationService.updateReadonly(t,!1);else return;return Ye(e,t)?this.save(e,{...i,force:!0}):this.fileService.hasProvider(e)&&this.uriIdentityService.extUri.isEqual(e,t)&&await this.fileService.exists(e)?(await this.workingCopyFileService.move([{file:{source:e,target:t}}],ni.None),await this.save(e,i)||await this.save(t,i),t):this.doSaveAs(e,t,i)}}async doSaveAs(e,t,i){let r=!1;const n=this.files.get(e);if(n?.isResolved())r=await this.doSaveAsTextFile(n,e,t,i);else if(this.fileService.hasProvider(e))await this.fileService.copy(e,t,!0),r=!0;else{const o=this.modelService.getModel(e);o&&(r=await this.doSaveAsTextFile(o,e,t,i))}if(r){try{await this.revert(e)}catch(o){this.logService.error(o)}return e.scheme===k.untitled&&this.untitled.notifyDidSave(e,t),t}}async doSaveAsTextFile(e,t,i,r){let n;const o=e;typeof o.getEncoding=="function"&&(n=o.getEncoding());let a=!1,l=this.files.get(i);if(l?.isResolved())a=!0;else{a=await this.fileService.exists(i),a||await this.create([{resource:i,value:""}]);try{l=await this.files.resolve(i,{encoding:n})}catch(g){if(a&&(g.textFileOperationResult===li.FILE_IS_BINARY||g.fileOperationResult===L.FILE_TOO_LARGE))return await this.fileService.del(i),this.doSaveAsTextFile(e,t,i,r);throw g}}let d;if(e instanceof lr&&e.hasAssociatedFilePath&&a&&this.uriIdentityService.extUri.isEqual(i,gs(e.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme))?d=await this.confirmOverwrite(i):d=!0,!d)return!1;let f;e instanceof Wt?e.isResolved()&&(f=e.textEditorModel??void 0):f=e;let h;if(l.isResolved()&&(h=l.textEditorModel),f&&h){l.updatePreferredEncoding(n),this.modelService.updateModel(h,bn(f.createSnapshot()));const g=f.getLanguageId(),S=h.getLanguageId();g!==Ie&&S===Ie&&h.setLanguage(g);const w=this.codeEditorService.getTransientModelProperties(f);if(w)for(const[m,N]of w)this.codeEditorService.setTransientModelProperty(h,m,N)}return r?.source||(r={...r,source:a?Qt.TEXTFILE_SAVE_REPLACE_SOURCE:Qt.TEXTFILE_SAVE_CREATE_SOURCE}),l.save({...r,from:t})}async confirmOverwrite(e){const{confirmed:t}=await this.dialogService.confirm({type:"warning",message:c(12879,"'{0}' already exists. Do you want to replace it?",ee(e)),detail:c(12880,"A file or folder with the name '{0}' already exists in the folder '{1}'. Replacing it will overwrite its current contents.",ee(e),ee(ht(e))),primaryButton:c(12881,"&&Replace")});return t}async confirmMakeWriteable(e){const{confirmed:t}=await this.dialogService.confirm({type:"warning",message:c(12882,"'{0}' is marked as read-only. Do you want to save anyway?",ee(e)),detail:c(12883,"Paths can be configured as read-only via settings."),primaryButton:c(12884,"&&Save Anyway")});return t}async suggestSavePath(e){if(this.fileService.hasProvider(e))return e;const t=this.environmentService.remoteAuthority,i=await this.fileDialogService.defaultFilePath();let r;if(e.scheme===k.untitled){const n=this.untitled.get(e);if(n){if(n.hasAssociatedFilePath)return gs(e,t,this.pathService.defaultUriScheme);let o;await this.pathService.hasValidBasename(j(i,n.name),n.name)?o=n.name:o=ee(e);const a=n.getLanguageId();a&&a!==Ie?r=this.suggestFilename(a,o):r=o}}return r||(r=ee(e)),j(i,r)}suggestFilename(e,t){if(!this.languageService.getLanguageName(e))return t;const r=si(t),n=this.languageService.getExtensions(e);if(n.includes(r))return t;const o=n.at(0);if(o)return r?`${t.substring(0,t.indexOf(r))}${o}`:`${t}${o}`;const a=this.languageService.getFilenames(e);return a.includes(t)?t:a.at(0)??t}async revert(e,t){if(e.scheme===k.untitled){const i=this.untitled.get(e);if(i)return i.revert(t)}else{const i=this.files.get(e);if(i&&(i.isDirty()||t?.force))return i.revert(t)}}isDirty(e){const t=e.scheme===k.untitled?this.untitled.get(e):this.files.get(e);return t?t.isDirty():!1}};fr=Qt=x([u(0,te),u(1,eo),u(2,xt),u(3,vt),u(4,Ve),u(5,Ae),u(6,Hr),u(7,zr),u(8,St),u(9,Mt),u(10,Fn),u(11,mi),u(12,Kr),u(13,ke),u(14,Be),u(15,Ge),u(16,jr),u(17,On)],fr);let gr=class extends D{get encodingOverrides(){return this._encodingOverrides}set encodingOverrides(e){this._encodingOverrides=e}constructor(e,t,i,r){super(),this.textResourceConfigurationService=e,this.environmentService=t,this.contextService=i,this.uriIdentityService=r,this._encodingOverrides=this.getDefaultEncodingOverrides(),this.registerListeners()}registerListeners(){this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.encodingOverrides=this.getDefaultEncodingOverrides()))}getDefaultEncodingOverrides(){const e=[];return e.push({parent:this.environmentService.userRoamingDataHome,encoding:G}),e.push({extension:kt,encoding:G}),e.push({parent:this.environmentService.untitledWorkspacesHome,encoding:G}),this.contextService.getWorkspace().folders.forEach(t=>{e.push({parent:j(t.uri,".vscode"),encoding:G})}),e}async getWriteEncoding(e,t){const{encoding:i,hasBOM:r}=await this.getPreferredWriteEncoding(e,t?t.encoding:void 0);return{encoding:i,addBOM:r}}async getPreferredWriteEncoding(e,t){const i=await this.getValidatedEncodingForResource(e,t);return{encoding:i,hasBOM:i===Qe||i===Ze||i===Oe}}async getPreferredReadEncoding(e,t,i){let r;t?.encoding?i===Oe&&t.encoding===G?r=Oe:r=t.encoding:typeof i=="string"?r=i:this.textResourceConfigurationService.getValue(e,"files.encoding")===Oe&&(r=G);const n=await this.getValidatedEncodingForResource(e,r);return{encoding:n,hasBOM:n===Qe||n===Ze||n===Oe}}getUnvalidatedEncodingForResource(e,t){let i;const r=this.getEncodingOverride(e);return r?i=r:t?i=t:i=this.textResourceConfigurationService.getValue(e,"files.encoding"),i||G}async getValidatedEncodingForResource(e,t){let i=this.getUnvalidatedEncodingForResource(e,t);return i!==G&&!await vd(i)&&(i=G),i}getEncodingOverride(e){if(e&&this.encodingOverrides?.length){for(const t of this.encodingOverrides)if(t.parent&&this.uriIdentityService.extUri.isEqualOrParent(e,t.parent)||t.extension&&Tr(e)===`.${t.extension}`)return t.encoding}}};gr=x([u(0,St),u(1,Ae),u(2,ie),u(3,ke)],gr);let pr=class extends fr{constructor(e,t,i,r,n,o,a,l,d,f,h,g,S,w,m,N,De,tt){super(e,t,i,r,n,o,a,l,d,f,h,g,S,w,m,De,N,tt),this.registerListeners()}registerListeners(){this._register(this.lifecycleService.onBeforeShutdown(e=>e.veto(this.onBeforeShutdown(),"veto.textFiles")))}onBeforeShutdown(){return!!this.files.models.some(e=>e.hasState(J.PENDING_SAVE))}};pr=x([u(0,te),u(1,eo),u(2,xt),u(3,vt),u(4,Ve),u(5,Ae),u(6,Hr),u(7,zr),u(8,St),u(9,Mt),u(10,Fn),u(11,mi),u(12,Kr),u(13,ke),u(14,Be),u(15,jr),u(16,Ge),u(17,On)],pr);var Se;let vr=class extends D{static{Se=this}static{this.NO_FOLDER=null}constructor(e,t,i,r){super(),this.getExpression=e,this.shouldUpdate=t,this.contextService=i,this.configurationService=r,this._onExpressionChange=this._register(new v),this.onExpressionChange=this._onExpressionChange.event,this.mapFolderToParsedExpression=new Map,this.mapFolderToConfiguredExpression=new Map,this.updateExpressions(!1),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{this.shouldUpdate(e)&&this.updateExpressions(!0)})),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.updateExpressions(!0)))}updateExpressions(e){let t=!1;for(const o of this.contextService.getWorkspace().folders){const a=o.uri.toString(),l=this.doGetExpression(o.uri),d=this.mapFolderToConfiguredExpression.get(a);l?(!d||!_e(d.expression,l.expression))&&(t=!0,this.mapFolderToParsedExpression.set(a,ps(l.expression)),this.mapFolderToConfiguredExpression.set(a,l)):d&&(t=!0,this.mapFolderToParsedExpression.delete(a),this.mapFolderToConfiguredExpression.delete(a))}const i=new pa(this.contextService.getWorkspace().folders.map(o=>o.uri));for(const[o]of this.mapFolderToConfiguredExpression)o!==Se.NO_FOLDER&&(i.has(K.parse(o))||(this.mapFolderToParsedExpression.delete(o),this.mapFolderToConfiguredExpression.delete(o),t=!0));const r=this.doGetExpression(void 0),n=this.mapFolderToConfiguredExpression.get(Se.NO_FOLDER);r?(!n||!_e(n.expression,r.expression))&&(t=!0,this.mapFolderToParsedExpression.set(Se.NO_FOLDER,ps(r.expression)),this.mapFolderToConfiguredExpression.set(Se.NO_FOLDER,r)):n&&(t=!0,this.mapFolderToParsedExpression.delete(Se.NO_FOLDER),this.mapFolderToConfiguredExpression.delete(Se.NO_FOLDER)),e&&t&&this._onExpressionChange.fire()}doGetExpression(e){const t=this.getExpression(e);if(!t)return;const i=Object.keys(t);if(i.length===0)return;let r=!1;const n=Object.create(null);for(const o of i){r||(r=In(o));let a=o;const l=va(a,!0);if(l){const d=l.toLowerCase();l!==l.toLowerCase()&&(a=`${d}${a.substring(1)}`)}n[a]=t[o]}return{expression:n,hasAbsolutePath:r}}matches(e,t){if(this.mapFolderToParsedExpression.size===0)return!1;const i=this.contextService.getWorkspaceFolder(e);let r,n;if(i&&this.mapFolderToParsedExpression.has(i.uri.toString())?(r=this.mapFolderToParsedExpression.get(i.uri.toString()),n=this.mapFolderToConfiguredExpression.get(i.uri.toString())):(r=this.mapFolderToParsedExpression.get(Se.NO_FOLDER),n=this.mapFolderToConfiguredExpression.get(Se.NO_FOLDER)),!r)return!1;let o;return i?o=wa(i.uri,e):o=this.uriToPath(e),typeof o=="string"&&r(o,void 0,t)?!0:o!==this.uriToPath(e)&&n?.hasAbsolutePath?!!r(this.uriToPath(e),void 0,t):!1}uriToPath(e){return e.scheme===k.file?e.fsPath:e.path}};vr=Se=x([u(2,ie),u(3,ve)],vr);class Vd extends Zn{constructor(){super(...arguments),this._onDidChangeDirty=this._register(new v),this._onDidChangeLabel=this._register(new v),this._onDidChangeCapabilities=this._register(new v),this._onWillDispose=this._register(new v),this.onDidChangeDirty=this._onDidChangeDirty.event,this.onDidChangeLabel=this._onDidChangeLabel.event,this.onDidChangeCapabilities=this._onDidChangeCapabilities.event,this.onWillDispose=this._onWillDispose.event}get editorId(){}get capabilities(){return lt.Readonly}hasCapability(e){return e===lt.None?this.capabilities===lt.None:(this.capabilities&e)!==0}isReadonly(){return this.hasCapability(lt.Readonly)}getName(){return`Editor ${this.typeId}`}getDescription(e){}getTitle(e){return this.getName()}getLabelExtraClasses(){return[]}getAriaLabel(){return this.getTitle(Zi.SHORT)}getIcon(){}getTelemetryDescriptor(){return{typeId:this.typeId}}isDirty(){return!1}isModified(){return this.isDirty()}isSaving(){return!1}async resolve(){return null}async save(e,t){return this}async saveAs(e,t){return this}async revert(e,t){}async rename(e,t){}copy(){return this}canMove(e,t){return!0}matches(e){if(q(e))return this===e;const t=e.options?.override;return this.editorId!==t&&t!==void 0&&this.editorId!==void 0?!1:Ye(this.resource,Je.getCanonicalUri(e))}prefersEditorPane(e){return e.at(0)}toUntyped(e){}isDisposed(){return this._store.isDisposed}dispose(){this.isDisposed()||this._onWillDispose.fire(),super.dispose()}}var ge;const Gd=new p("autoSaveAfterShortDelayContext",!1,!0);var X;(function(s){s[s.OFF=0]="OFF",s[s.AFTER_SHORT_DELAY=1]="AFTER_SHORT_DELAY",s[s.AFTER_LONG_DELAY=2]="AFTER_LONG_DELAY",s[s.ON_FOCUS_CHANGE=3]="ON_FOCUS_CHANGE",s[s.ON_WINDOW_CHANGE=4]="ON_WINDOW_CHANGE"})(X||(X={}));var He;(function(s){s[s.SETTINGS=1]="SETTINGS",s[s.OUT_OF_WORKSPACE=2]="OUT_OF_WORKSPACE",s[s.ERRORS=3]="ERRORS",s[s.DISABLED=4]="DISABLED"})(He||(He={}));let wr=class extends D{static{ge=this}static{this.DEFAULT_AUTO_SAVE_MODE=Pt?U.AFTER_DELAY:U.OFF}static{this.DEFAULT_AUTO_SAVE_DELAY=1e3}static{this.READONLY_MESSAGES={providerReadonly:{value:c(12674,"Editor is read-only because the file system of the file is read-only."),isTrusted:!0},sessionReadonly:{value:c(12675,"Editor is read-only because the file was set read-only in this session. [Click here](command:{0}) to set writeable.","workbench.action.files.setActiveEditorWriteableInSession"),isTrusted:!0},configuredReadonly:{value:c(12676,"Editor is read-only because the file was set read-only via settings. [Click here](command:{0}) to configure or [toggle for this session](command:{1}).",`workbench.action.openSettings?${encodeURIComponent('["files.readonly"]')}`,"workbench.action.files.toggleActiveEditorReadonlyInSession"),isTrusted:!0},fileLocked:{value:c(12677,"Editor is read-only because of file permissions. [Click here](command:{0}) to set writeable anyway.","workbench.action.files.setActiveEditorWriteableInSession"),isTrusted:!0},fileReadonly:{value:c(12678,"Editor is read-only because the file is read-only."),isTrusted:!0}}}constructor(e,t,i,r,n,o,a,l){super(),this.configurationService=t,this.contextService=i,this.environmentService=r,this.uriIdentityService=n,this.fileService=o,this.markerService=a,this.textResourceConfigurationService=l,this._onDidChangeAutoSaveConfiguration=this._register(new v),this.onDidChangeAutoSaveConfiguration=this._onDidChangeAutoSaveConfiguration.event,this._onDidChangeAutoSaveDisabled=this._register(new v),this.onDidChangeAutoSaveDisabled=this._onDidChangeAutoSaveDisabled.event,this._onDidChangeFilesAssociation=this._register(new v),this.onDidChangeFilesAssociation=this._onDidChangeFilesAssociation.event,this._onDidChangeReadonly=this._register(new v),this.onDidChangeReadonly=this._onDidChangeReadonly.event,this.autoSaveConfigurationCache=new kn(1e3),this.autoSaveAfterShortDelayOverrides=new Z,this.autoSaveDisabledOverrides=new Z,this.readonlyIncludeMatcher=this._register(new vs(()=>this.createReadonlyMatcher(An))),this.readonlyExcludeMatcher=this._register(new vs(()=>this.createReadonlyMatcher(Tn))),this.sessionReadonlyOverrides=new Z(f=>this.uriIdentityService.extUri.getComparisonKey(f)),this.autoSaveAfterShortDelayContext=Gd.bindTo(e);const d=t.getValue();this.currentGlobalAutoSaveConfiguration=this.computeAutoSaveConfiguration(void 0,d.files),this.currentFilesAssociationConfiguration=d?.files?.associations,this.currentHotExitConfiguration=d?.files?.hotExit||$.ON_EXIT,this.onFilesConfigurationChange(d,!1),this.registerListeners()}createReadonlyMatcher(e){const t=this._register(new vr(i=>this.configurationService.getValue(e,{resource:i}),i=>i.affectsConfiguration(e),this.contextService,this.configurationService));return this._register(t.onExpressionChange(()=>this._onDidChangeReadonly.fire())),t}isReadonly(e,t){const i=this.fileService.getProvider(e.scheme);if(i&&Sa(i))return i.readOnlyMessage??ge.READONLY_MESSAGES.providerReadonly;const r=this.sessionReadonlyOverrides.get(e);return typeof r=="boolean"?r===!0?ge.READONLY_MESSAGES.sessionReadonly:!1:this.uriIdentityService.extUri.isEqualOrParent(e,this.environmentService.userRoamingDataHome)||this.uriIdentityService.extUri.isEqual(e,this.contextService.getWorkspace().configuration??void 0)?!1:this.readonlyIncludeMatcher.value.matches(e)?this.readonlyExcludeMatcher.value.matches(e)?!1:ge.READONLY_MESSAGES.configuredReadonly:this.configuredReadonlyFromPermissions&&t?.locked?ge.READONLY_MESSAGES.fileLocked:t?.readonly?ge.READONLY_MESSAGES.fileReadonly:!1}async updateReadonly(e,t){if(t==="toggle"){let i;try{i=await this.fileService.resolve(e,{resolveMetadata:!0})}catch{}t=!this.isReadonly(e,i)}t==="reset"?this.sessionReadonlyOverrides.delete(e):this.sessionReadonlyOverrides.set(e,t),this._onDidChangeReadonly.fire()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("files")&&this.onFilesConfigurationChange(this.configurationService.getValue(),!0)}))}onFilesConfigurationChange(e,t){this.currentGlobalAutoSaveConfiguration=this.computeAutoSaveConfiguration(void 0,e.files),this.autoSaveConfigurationCache.clear(),this.autoSaveAfterShortDelayContext.set(this.getAutoSaveMode(void 0).mode===X.AFTER_SHORT_DELAY),t&&this._onDidChangeAutoSaveConfiguration.fire();const i=e?.files?.associations;_e(this.currentFilesAssociationConfiguration,i)||(this.currentFilesAssociationConfiguration=i,t&&this._onDidChangeFilesAssociation.fire());const r=e?.files?.hotExit;r===$.OFF||r===$.ON_EXIT_AND_WINDOW_CLOSE?this.currentHotExitConfiguration=r:this.currentHotExitConfiguration=$.ON_EXIT;const n=!!e?.files?.readonlyFromPermissions;n!==!!this.configuredReadonlyFromPermissions&&(this.configuredReadonlyFromPermissions=n,t&&this._onDidChangeReadonly.fire())}getAutoSaveConfiguration(e){const t=this.toResource(e);if(t){let i=this.autoSaveConfigurationCache.get(t);return i||(i=this.computeAutoSaveConfiguration(t,this.textResourceConfigurationService.getValue(t,"files")),this.autoSaveConfigurationCache.set(t,i)),i}return this.currentGlobalAutoSaveConfiguration}computeAutoSaveConfiguration(e,t){let i,r,n,o,a,l;switch(t?.autoSave??ge.DEFAULT_AUTO_SAVE_MODE){case U.AFTER_DELAY:{i="afterDelay",r=typeof t?.autoSaveDelay=="number"&&t.autoSaveDelay>=0?t.autoSaveDelay:ge.DEFAULT_AUTO_SAVE_DELAY,l=r<=ge.DEFAULT_AUTO_SAVE_DELAY;break}case U.ON_FOCUS_CHANGE:i="onFocusChange";break;case U.ON_WINDOW_CHANGE:i="onWindowChange";break}return t?.autoSaveWorkspaceFilesOnly===!0&&(n=!0,e&&!this.contextService.isInsideWorkspace(e)&&(a=!0,l=void 0)),t?.autoSaveWhenNoErrors===!0&&(o=!0,l=void 0),{autoSave:i,autoSaveDelay:r,autoSaveWorkspaceFilesOnly:n,autoSaveWhenNoErrors:o,isOutOfWorkspace:a,isShortAutoSaveDelay:l}}toResource(e){return e instanceof Vd?Je.getOriginalUri(e,{supportSideBySide:le.PRIMARY}):e}hasShortAutoSaveDelay(e){const t=this.toResource(e);return t&&this.autoSaveAfterShortDelayOverrides.has(t)?!0:this.getAutoSaveConfiguration(t).isShortAutoSaveDelay?!t||!this.autoSaveDisabledOverrides.has(t):!1}getAutoSaveMode(e,t){const i=this.toResource(e);if(i&&this.autoSaveAfterShortDelayOverrides.has(i))return{mode:X.AFTER_SHORT_DELAY};if(i&&this.autoSaveDisabledOverrides.has(i))return{mode:X.OFF,reason:He.DISABLED};const r=this.getAutoSaveConfiguration(i);if(typeof r.autoSave>"u")return{mode:X.OFF,reason:He.SETTINGS};if(typeof t=="number"&&(r.autoSave==="afterDelay"&&t!==ne.AUTO||r.autoSave==="onFocusChange"&&t!==ne.FOCUS_CHANGE&&t!==ne.WINDOW_CHANGE||r.autoSave==="onWindowChange"&&t!==ne.WINDOW_CHANGE))return{mode:X.OFF,reason:He.SETTINGS};if(i){if(r.autoSaveWorkspaceFilesOnly&&r.isOutOfWorkspace)return{mode:X.OFF,reason:He.OUT_OF_WORKSPACE};if(r.autoSaveWhenNoErrors&&this.markerService.read({resource:i,take:1,severities:Ca.Error}).length>0)return{mode:X.OFF,reason:He.ERRORS}}switch(r.autoSave){case"afterDelay":return typeof r.autoSaveDelay=="number"&&r.autoSaveDelay<=ge.DEFAULT_AUTO_SAVE_DELAY?{mode:r.autoSaveWhenNoErrors?X.AFTER_LONG_DELAY:X.AFTER_SHORT_DELAY}:{mode:X.AFTER_LONG_DELAY};case"onFocusChange":return{mode:X.ON_FOCUS_CHANGE};case"onWindowChange":return{mode:X.ON_WINDOW_CHANGE}}}async toggleAutoSave(){const e=this.configurationService.getValue("files.autoSave");let t;return[U.AFTER_DELAY,U.ON_FOCUS_CHANGE,U.ON_WINDOW_CHANGE].some(i=>i===e)?t=U.OFF:t=U.AFTER_DELAY,this.configurationService.updateValue("files.autoSave",t)}enableAutoSaveAfterShortDelay(e){const t=this.toResource(e);if(!t)return D.None;const i=this.autoSaveAfterShortDelayOverrides.get(t)??0;return this.autoSaveAfterShortDelayOverrides.set(t,i+1),de(()=>{const r=this.autoSaveAfterShortDelayOverrides.get(t)??0;r<=1?this.autoSaveAfterShortDelayOverrides.delete(t):this.autoSaveAfterShortDelayOverrides.set(t,r-1)})}disableAutoSave(e){const t=this.toResource(e);if(!t)return D.None;const i=this.autoSaveDisabledOverrides.get(t)??0;return this.autoSaveDisabledOverrides.set(t,i+1),i===0&&this._onDidChangeAutoSaveDisabled.fire(t),de(()=>{const r=this.autoSaveDisabledOverrides.get(t)??0;r<=1?(this.autoSaveDisabledOverrides.delete(t),this._onDidChangeAutoSaveDisabled.fire(t)):this.autoSaveDisabledOverrides.set(t,r-1)})}get isHotExitEnabled(){return this.contextService.getWorkspace().transient?!1:this.currentHotExitConfiguration!==$.OFF}get hotExitConfiguration(){return this.currentHotExitConfiguration}preventSaveConflicts(e,t){return this.configurationService.getValue("files.saveConflictResolution",{resource:e,overrideIdentifier:t})!=="overwriteFileOnDisk"}};wr=ge=x([u(0,xr),u(1,ve),u(2,ie),u(3,Ea),u(4,ke),u(5,te),u(6,ya),u(7,St)],wr);class Kd{isSupported(e){return!1}async writeFileElevated(e,t,i){throw new Error("Unsupported")}}const ao=xn(ma);var ce;(function(s){s.TITLEBAR_PART="workbench.parts.titlebar",s.BANNER_PART="workbench.parts.banner",s.ACTIVITYBAR_PART="workbench.parts.activitybar",s.SIDEBAR_PART="workbench.parts.sidebar",s.PANEL_PART="workbench.parts.panel",s.AUXILIARYBAR_PART="workbench.parts.auxiliarybar",s.EDITOR_PART="workbench.parts.editor",s.STATUSBAR_PART="workbench.parts.statusbar"})(ce||(ce={}));var Qs;(function(s){s.SHOW_TABS="zenMode.showTabs",s.HIDE_LINENUMBERS="zenMode.hideLineNumbers",s.HIDE_STATUSBAR="zenMode.hideStatusBar",s.HIDE_ACTIVITYBAR="zenMode.hideActivityBar",s.CENTER_LAYOUT="zenMode.centerLayout",s.FULLSCREEN="zenMode.fullScreen",s.RESTORE="zenMode.restore",s.SILENT_NOTIFICATIONS="zenMode.silentNotifications"})(Qs||(Qs={}));var ze;(function(s){s.ACTIVITY_BAR_LOCATION="workbench.activityBar.location",s.EDITOR_TABS_MODE="workbench.editor.showTabs",s.EDITOR_ACTIONS_LOCATION="workbench.editor.editorActionsLocation",s.COMMAND_CENTER="window.commandCenter",s.LAYOUT_ACTIONS="workbench.layoutControl.enabled"})(ze||(ze={}));var fi;(function(s){s.DEFAULT="default",s.TOP="top",s.BOTTOM="bottom",s.HIDDEN="hidden"})(fi||(fi={}));var Sr;(function(s){s.MULTIPLE="multiple",s.SINGLE="single",s.NONE="none"})(Sr||(Sr={}));var gi;(function(s){s.DEFAULT="default",s.TITLEBAR="titleBar",s.HIDDEN="hidden"})(gi||(gi={}));var Y;(function(s){s[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.BOTTOM=2]="BOTTOM",s[s.TOP=3]="TOP"})(Y||(Y={}));function Sf(s){return s===Y.BOTTOM||s===Y.TOP}var pe;(function(s){s[s.ALWAYS=0]="ALWAYS",s[s.NEVER=1]="NEVER",s[s.REMEMBER_LAST=2]="REMEMBER_LAST"})(pe||(pe={}));function Ot(s){switch(s){case Y.LEFT:return"left";case Y.RIGHT:return"right";case Y.BOTTOM:return"bottom";case Y.TOP:return"top";default:return"bottom"}}const Hd={[Ot(Y.LEFT)]:Y.LEFT,[Ot(Y.RIGHT)]:Y.RIGHT,[Ot(Y.BOTTOM)]:Y.BOTTOM,[Ot(Y.TOP)]:Y.TOP};function Cf(s){return Hd[s]}function Vi(s){switch(s){case pe.ALWAYS:return"always";case pe.NEVER:return"never";case pe.REMEMBER_LAST:return"preserve";default:return"preserve"}}const zd={[Vi(pe.ALWAYS)]:pe.ALWAYS,[Vi(pe.NEVER)]:pe.NEVER,[Vi(pe.REMEMBER_LAST)]:pe.REMEMBER_LAST};function Ef(s){return zd[s]}function yf(s){return s===ce.EDITOR_PART||s===ce.STATUSBAR_PART||s===ce.TITLEBAR_PART}function mf(s,e,t){const i=Pn(e),r=Ra(s);if(!Pt){const o=s.getValue(_a.CUSTOM_TITLE_BAR_VISIBILITY);if(o===ws.NEVER&&r||o===ws.WINDOWED&&i)return!1}if(!$d(s))return!0;if(r&&Da(s))return!1;if(Nr&&ft)return!i;if(ft&&!i||ba()&&!i)return!0;switch(Fa(e)?"hidden":Oa(s)){case"classic":return!i||!!t;case"compact":case"hidden":return!1;case"toggle":return!!t;case"visible":return!0;default:return Pt?!1:!i||!!t}}function $d(s){if(s.getValue(ze.COMMAND_CENTER))return!1;const e=s.getValue(ze.ACTIVITY_BAR_LOCATION);if(e===fi.TOP||e===fi.BOTTOM)return!1;const t=s.getValue(ze.EDITOR_ACTIONS_LOCATION),i=s.getValue(ze.EDITOR_TABS_MODE);return!(t===gi.TITLEBAR||t===gi.DEFAULT&&i===Sr.NONE||s.getValue(ze.LAYOUT_ACTIONS))}let Cr=class extends D{constructor(e,t,i,r,n,o,a,l,d,f){super(),this.contextKeyService=e,this.contextService=t,this.configurationService=i,this.environmentService=r,this.productService=n,this.editorGroupService=o,this.editorService=a,this.layoutService=l,this.paneCompositeService=d,this.workingCopyService=f,ka.bindTo(this.contextKeyService),Aa.bindTo(this.contextKeyService),Ta.bindTo(this.contextKeyService),xa.bindTo(this.contextKeyService),Pa.bindTo(this.contextKeyService),La.bindTo(this.contextKeyService),Na.bindTo(this.contextKeyService),Pl.bindTo(this.contextKeyService).set(Wa(this.environmentService.remoteAuthority)||""),this.virtualWorkspaceContext=Ll.bindTo(this.contextKeyService),this.temporaryWorkspaceContext=io.bindTo(this.contextKeyService),this.updateWorkspaceContextKeys(),Nl.bindTo(this.contextKeyService).set(We.supported(Ce));const h=!this.environmentService.isBuilt||this.environmentService.isExtensionDevelopment;Ss.bindTo(this.contextKeyService).set(h),Ua(Ss.key,h),Ma.bindTo(this.contextKeyService).set(this.productService.quality||""),Wl.bindTo(this.contextKeyService).set(n.embedderIdentifier),this.activeEditorGroupEmpty=Gl.bindTo(this.contextKeyService),this.activeEditorGroupIndex=Kl.bindTo(this.contextKeyService),this.activeEditorGroupLast=Hl.bindTo(this.contextKeyService),this.activeEditorGroupLocked=zl.bindTo(this.contextKeyService),this.multipleEditorGroupsContext=$l.bindTo(this.contextKeyService),this.editorsVisibleContext=Yl.bindTo(this.contextKeyService),this.dirtyWorkingCopiesContext=xl.bindTo(this.contextKeyService),this.dirtyWorkingCopiesContext.set(this.workingCopyService.hasDirty),this.inputFocusedContext=Ba.bindTo(this.contextKeyService),this.workbenchStateContext=Ol.bindTo(this.contextKeyService),this.updateWorkbenchStateContextKey(),this.workspaceFolderCountContext=Il.bindTo(this.contextKeyService),this.updateWorkspaceFolderCountContextKey(),this.openFolderWorkspaceSupportContext=kl.bindTo(this.contextKeyService),this.openFolderWorkspaceSupportContext.set(ft||typeof this.environmentService.remoteAuthority=="string"),this.emptyWorkspaceSupportContext=Tl.bindTo(this.contextKeyService),this.emptyWorkspaceSupportContext.set(ft||typeof this.environmentService.remoteAuthority=="string"),this.enterMultiRootWorkspaceSupportContext=Al.bindTo(this.contextKeyService),this.enterMultiRootWorkspaceSupportContext.set(ft||typeof this.environmentService.remoteAuthority=="string"),this.splitEditorsVerticallyContext=Xl.bindTo(this.contextKeyService),this.updateSplitEditorsVerticallyContext(),this.isMainWindowFullscreenContext=Ml.bindTo(this.contextKeyService),this.isAuxiliaryWindowFocusedContext=Bl.bindTo(this.contextKeyService),this.inZenModeContext=jl.bindTo(this.contextKeyService),this.isMainEditorCenteredLayoutContext=ql.bindTo(this.contextKeyService),this.mainEditorAreaVisibleContext=Jl.bindTo(this.contextKeyService),this.editorTabsVisibleContext=Ql.bindTo(this.contextKeyService),this.sideBarVisibleContext=Zl.bindTo(this.contextKeyService),this.titleAreaVisibleContext=td.bindTo(this.contextKeyService),this.titleBarStyleContext=ed.bindTo(this.contextKeyService),this.updateTitleBarContextKeys(),this.panelPositionContext=rd.bindTo(this.contextKeyService),this.panelPositionContext.set(Ot(this.layoutService.getPanelPosition())),this.panelVisibleContext=nd.bindTo(this.contextKeyService),this.panelVisibleContext.set(this.layoutService.isVisible(ce.PANEL_PART)),this.panelMaximizedContext=od.bindTo(this.contextKeyService),this.panelMaximizedContext.set(this.layoutService.isPanelMaximized()),this.panelAlignmentContext=sd.bindTo(this.contextKeyService),this.panelAlignmentContext.set(this.layoutService.getPanelAlignment()),this.auxiliaryBarVisibleContext=id.bindTo(this.contextKeyService),this.auxiliaryBarVisibleContext.set(this.layoutService.isVisible(ce.AUXILIARYBAR_PART)),Ul.bindTo(this.contextKeyService),this.registerListeners()}registerListeners(){this.editorGroupService.whenReady.then(()=>{this.updateEditorAreaContextKeys(),this.updateActiveEditorGroupContextKeys(),this.updateVisiblePanesContextKeys()}),this._register(this.editorService.onDidActiveEditorChange(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorService.onDidVisibleEditorsChange(()=>this.updateVisiblePanesContextKeys())),this._register(this.editorGroupService.onDidAddGroup(()=>this.updateEditorGroupsContextKeys())),this._register(this.editorGroupService.onDidRemoveGroup(()=>this.updateEditorGroupsContextKeys())),this._register(this.editorGroupService.onDidChangeGroupIndex(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorGroupService.onDidChangeGroupLocked(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorGroupService.onDidChangeEditorPartOptions(()=>this.updateEditorAreaContextKeys())),this._register(H.runAndSubscribe(Va,({window:e,disposables:t})=>t.add(Ga(e,Ka.FOCUS_IN,()=>this.updateInputContextKeys(e.document,t),!0)),{window:Ce,disposables:this._store})),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.updateWorkbenchStateContextKey())),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>{this.updateWorkspaceFolderCountContextKey(),this.updateWorkspaceContextKeys()})),this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("workbench.editor.openSideBySideDirection")&&this.updateSplitEditorsVerticallyContext()})),this._register(this.layoutService.onDidChangeZenMode(e=>this.inZenModeContext.set(e))),this._register(this.layoutService.onDidChangeActiveContainer(()=>this.isAuxiliaryWindowFocusedContext.set(this.layoutService.activeContainer!==this.layoutService.mainContainer))),this._register(Ha(e=>{e===Ce.vscodeWindowId&&this.isMainWindowFullscreenContext.set(Pn(Ce))})),this._register(this.layoutService.onDidChangeMainEditorCenteredLayout(e=>this.isMainEditorCenteredLayoutContext.set(e))),this._register(this.layoutService.onDidChangePanelPosition(e=>this.panelPositionContext.set(e))),this._register(this.layoutService.onDidChangePanelAlignment(e=>this.panelAlignmentContext.set(e))),this._register(this.paneCompositeService.onDidPaneCompositeClose(()=>this.updateSideBarContextKeys())),this._register(this.paneCompositeService.onDidPaneCompositeOpen(()=>this.updateSideBarContextKeys())),this._register(this.layoutService.onDidChangePartVisibility(()=>{this.mainEditorAreaVisibleContext.set(this.layoutService.isVisible(ce.EDITOR_PART,Ce)),this.panelVisibleContext.set(this.layoutService.isVisible(ce.PANEL_PART)),this.panelMaximizedContext.set(this.layoutService.isPanelMaximized()),this.auxiliaryBarVisibleContext.set(this.layoutService.isVisible(ce.AUXILIARYBAR_PART)),this.updateTitleBarContextKeys()})),this._register(this.workingCopyService.onDidChangeDirty(e=>this.dirtyWorkingCopiesContext.set(e.isDirty()||this.workingCopyService.hasDirty)))}updateVisiblePanesContextKeys(){this.editorService.visibleEditorPanes.length>0?this.editorsVisibleContext.set(!0):this.editorsVisibleContext.reset()}updateActiveEditorGroupContextKeys(){this.editorService.activeEditor?this.activeEditorGroupEmpty.reset():this.activeEditorGroupEmpty.set(!0);const e=this.editorGroupService.activeGroup;this.activeEditorGroupIndex.set(e.index+1),this.activeEditorGroupLocked.set(e.isLocked),this.updateEditorGroupsContextKeys()}updateEditorGroupsContextKeys(){const e=this.editorGroupService.count;e>1?this.multipleEditorGroupsContext.set(!0):this.multipleEditorGroupsContext.reset();const t=this.editorGroupService.activeGroup;this.activeEditorGroupLast.set(t.index===e-1)}updateEditorAreaContextKeys(){this.editorTabsVisibleContext.set(this.editorGroupService.partOptions.showTabs==="multiple")}updateInputContextKeys(e,t){function i(){return!!e.activeElement&&qa(e.activeElement)}const r=i();if(this.inputFocusedContext.set(r),r){const n=t.add(za(e.activeElement));H.once(n.onDidBlur)(()=>{$a().document===e&&this.inputFocusedContext.set(i()),n.dispose()},void 0,t)}}updateWorkbenchStateContextKey(){this.workbenchStateContext.set(this.getWorkbenchStateString())}updateWorkspaceFolderCountContextKey(){this.workspaceFolderCountContext.set(this.contextService.getWorkspace().folders.length)}updateSplitEditorsVerticallyContext(){const e=Sl(this.configurationService);this.splitEditorsVerticallyContext.set(e===Nt.DOWN)}getWorkbenchStateString(){switch(this.contextService.getWorkbenchState()){case O.EMPTY:return"empty";case O.FOLDER:return"folder";case O.WORKSPACE:return"workspace"}}updateSideBarContextKeys(){this.sideBarVisibleContext.set(this.layoutService.isVisible(ce.SIDEBAR_PART))}updateTitleBarContextKeys(){this.titleAreaVisibleContext.set(this.layoutService.isVisible(ce.TITLEBAR_PART,Ce)),this.titleBarStyleContext.set(Ya(this.configurationService))}updateWorkspaceContextKeys(){this.virtualWorkspaceContext.set(ja(this.contextService.getWorkspace())||""),this.temporaryWorkspaceContext.set(Yt(this.contextService.getWorkspace()))}};Cr=x([u(0,xr),u(1,ie),u(2,ve),u(3,Ae),u(4,Ia),u(5,Cl),u(6,yi),u(7,ao),u(8,El),u(9,Vr)],Cr);const co=new v,_f=co.event,lo=new v,Yd=lo.event,ho=new Xi,jd=new v,uo=[],fo=[],go=[];function po(s){uo.push(s)}function Df(s){fo.push(s)}function bf(s){go.push(s)}async function Ff(s){await s.invokeFunction(async e=>{await Promise.all(uo.map(t=>t(e)))}),await s.invokeFunction(async e=>{Ja((t,i)=>s.createInstance(Qa,t,{instantHover:i},{})),Za(e.get(ec))}),await s.invokeFunction(async e=>{const t=e.get(xt);await Promise.all(fo.map(i=>i(e))),t.phase=je.Ready}),await s.invokeFunction(async e=>{await Promise.all(go.map(t=>t(e)))}),ho.open(),jd.fire(),s.invokeFunction(async e=>{const t=e.get(xt);W.as($r.Workbench).start(e),W.as(Qn.EditorFactory).start(e),Yd(r=>{r.get(vt).createInstance(Cr)}),co.fire(e),lo.fire(e),await Promise.race([e.get(ao).whenRestored,qi(2e3)]),t.phase=je.Restored,new Vt(()=>{tc(window,()=>{t.phase=je.Eventually},2500)},2500).schedule()})}let vo=!1;Xa.withServices(()=>(vo=!0,D.None));async function Of(){await ho.wait()}function qd(){if(vo)throw new Error("Services are already initialized")}const wo=W.as(oe.Configuration),Xd=ft?{type:"string",scope:E.APPLICATION,enum:[$.OFF,$.ON_EXIT,$.ON_EXIT_AND_WINDOW_CLOSE],default:$.ON_EXIT,markdownEnumDescriptions:[c(7163,"Disable hot exit. A prompt will show when attempting to close a window with editors that have unsaved changes."),c(7164,"Hot exit will be triggered when the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu). All windows without folders opened will be restored upon next launch. A list of previously opened windows with unsaved files can be accessed via `File > Open Recent > More...`"),c(7165,"Hot exit will be triggered when the last window is closed on Windows/Linux or when the `workbench.action.quit` command is triggered (command palette, keybinding, menu), and also for any window with a folder opened regardless of whether it's the last window. All windows without folders opened will be restored upon next launch. A list of previously opened windows with unsaved files can be accessed via `File > Open Recent > More...`")],markdownDescription:c(7166,"[Hot Exit](https://aka.ms/vscode-hot-exit) controls whether unsaved files are remembered between sessions, allowing the save prompt when exiting the editor to be skipped.",$.ON_EXIT,$.ON_EXIT_AND_WINDOW_CLOSE)}:{type:"string",scope:E.APPLICATION,enum:[$.OFF,$.ON_EXIT_AND_WINDOW_CLOSE],default:$.ON_EXIT_AND_WINDOW_CLOSE,markdownEnumDescriptions:[c(7163,"Disable hot exit. A prompt will show when attempting to close a window with editors that have unsaved changes."),c(7167,"Hot exit will be triggered when the browser quits or the window or tab is closed.")],markdownDescription:c(7166,"[Hot Exit](https://aka.ms/vscode-hot-exit) controls whether unsaved files are remembered between sessions, allowing the save prompt when exiting the editor to be skipped.",$.ON_EXIT,$.ON_EXIT_AND_WINDOW_CLOSE)};wo.registerConfiguration({id:"files",order:9,title:c(7168,"Files"),type:"object",properties:{[sc]:{type:"object",markdownDescription:c(7169,"Configure [glob patterns](https://aka.ms/vscode-glob-patterns) for excluding files and folders. For example, the File Explorer decides which files and folders to show or hide based on this setting. Refer to the `#search.exclude#` setting to define search-specific excludes. Refer to the `#explorer.excludeGitIgnore#` setting for ignoring files based on your `.gitignore`."),default:{"**/.git":!0,"**/.svn":!0,"**/.hg":!0,"**/.DS_Store":!0,"**/Thumbs.db":!0,...Pt?{"**/*.crswap":!0}:void 0},scope:E.RESOURCE,additionalProperties:{anyOf:[{type:"boolean",enum:[!0,!1],enumDescriptions:[c(7170,"Enable the pattern."),c(7171,"Disable the pattern.")],description:c(7172,"The glob pattern to match file paths against. Set to true or false to enable or disable the pattern.")},{type:"object",properties:{when:{type:"string",pattern:"\\w*\\$\\(basename\\)\\w*",default:"$(basename).ext",markdownDescription:c(7173,"Additional check on the siblings of a matching file. Use \\$(basename) as variable for the matching file name.")}}}]}},[rc]:{type:"object",markdownDescription:c(7174,'Configure [glob patterns](https://aka.ms/vscode-glob-patterns) of file associations to languages (for example `"*.extension": "html"`). Patterns will match on the absolute path of a file if they contain a path separator and will match on the name of the file otherwise. These have precedence over the default associations of the languages installed.'),additionalProperties:{type:"string"}},"files.encoding":{type:"string",enum:Object.keys(Ne),default:"utf8",description:c(7175,"The default character set encoding to use when reading and writing files. This setting can also be configured per language."),scope:E.LANGUAGE_OVERRIDABLE,enumDescriptions:Object.keys(Ne).map(s=>Ne[s].labelLong),enumItemLabels:Object.keys(Ne).map(s=>Ne[s].labelLong)},"files.autoGuessEncoding":{type:"boolean",default:!1,markdownDescription:c(7176,"When enabled, the editor will attempt to guess the character set encoding when opening files. This setting can also be configured per language. Note, this setting is not respected by text search. Only {0} is respected.","`#files.encoding#`"),scope:E.LANGUAGE_OVERRIDABLE},"files.candidateGuessEncodings":{type:"array",items:{type:"string",enum:Object.keys(Xt),enumDescriptions:Object.keys(Xt).map(s=>Xt[s].labelLong)},default:[],markdownDescription:c(7177,"List of character set encodings that the editor should attempt to guess in the order they are listed. In case it cannot be determined, {0} is respected","`#files.encoding#`"),scope:E.LANGUAGE_OVERRIDABLE},"files.eol":{type:"string",enum:[`
`,`\r
`,"auto"],enumDescriptions:[c(7178,"LF"),c(7179,"CRLF"),c(7180,"Uses operating system specific end of line character.")],default:"auto",description:c(7181,"The default end of line character."),scope:E.LANGUAGE_OVERRIDABLE},"files.enableTrash":{type:"boolean",default:!0,description:c(7182,"Moves files/folders to the OS trash (recycle bin on Windows) when deleting. Disabling this will delete files/folders permanently.")},"files.trimTrailingWhitespace":{type:"boolean",default:!1,description:c(7183,"When enabled, will trim trailing whitespace when saving a file."),scope:E.LANGUAGE_OVERRIDABLE},"files.trimTrailingWhitespaceInRegexAndStrings":{type:"boolean",default:!0,description:c(7184,"When enabled, trailing whitespace will be removed from multiline strings and regexes will be removed on save or when executing 'editor.action.trimTrailingWhitespace'. This can cause whitespace to not be trimmed from lines when there isn't up-to-date token information."),scope:E.LANGUAGE_OVERRIDABLE},"files.insertFinalNewline":{type:"boolean",default:!1,description:c(7185,"When enabled, insert a final new line at the end of the file when saving it."),scope:E.LANGUAGE_OVERRIDABLE},"files.trimFinalNewlines":{type:"boolean",default:!1,description:c(7186,"When enabled, will trim all new lines after the final new line at the end of the file when saving it."),scope:E.LANGUAGE_OVERRIDABLE},"files.autoSave":{type:"string",enum:[U.OFF,U.AFTER_DELAY,U.ON_FOCUS_CHANGE,U.ON_WINDOW_CHANGE],markdownEnumDescriptions:[c(7187,"An editor with changes is never automatically saved."),c(7188,"An editor with changes is automatically saved after the configured `#files.autoSaveDelay#`."),c(7189,"An editor with changes is automatically saved when the editor loses focus."),c(7190,"An editor with changes is automatically saved when the window loses focus.")],default:Pt?U.AFTER_DELAY:U.OFF,markdownDescription:c(7191,"Controls [auto save](https://code.visualstudio.com/docs/editor/codebasics#_save-auto-save) of editors that have unsaved changes.",U.OFF,U.AFTER_DELAY,U.ON_FOCUS_CHANGE,U.ON_WINDOW_CHANGE,U.AFTER_DELAY),scope:E.LANGUAGE_OVERRIDABLE},"files.autoSaveDelay":{type:"number",default:1e3,minimum:0,markdownDescription:c(7192,"Controls the delay in milliseconds after which an editor with unsaved changes is saved automatically. Only applies when `#files.autoSave#` is set to `{0}`.",U.AFTER_DELAY),scope:E.LANGUAGE_OVERRIDABLE},"files.autoSaveWorkspaceFilesOnly":{type:"boolean",default:!1,markdownDescription:c(7193,"When enabled, will limit [auto save](https://code.visualstudio.com/docs/editor/codebasics#_save-auto-save) of editors to files that are inside the opened workspace. Only applies when {0} is enabled.","`#files.autoSave#`"),scope:E.LANGUAGE_OVERRIDABLE},"files.autoSaveWhenNoErrors":{type:"boolean",default:!1,markdownDescription:c(7194,"When enabled, will limit [auto save](https://code.visualstudio.com/docs/editor/codebasics#_save-auto-save) of editors to files that have no errors reported in them at the time the auto save is triggered. Only applies when {0} is enabled.","`#files.autoSave#`"),scope:E.LANGUAGE_OVERRIDABLE},"files.watcherExclude":{type:"object",patternProperties:{".*":{type:"boolean"}},default:{"**/.git/objects/**":!0,"**/.git/subtree-cache/**":!0,"**/.hg/store/**":!0},markdownDescription:c(7195,"Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) to exclude from file watching. Paths can either be relative to the watched folder or absolute. Glob patterns are matched relative from the watched folder. When you experience the file watcher process consuming a lot of CPU, make sure to exclude large folders that are of less interest (such as build output folders)."),scope:E.RESOURCE},"files.watcherInclude":{type:"array",items:{type:"string"},default:[],description:c(7196,"Configure extra paths to watch for changes inside the workspace. By default, all workspace folders will be watched recursively, except for folders that are symbolic links. You can explicitly add absolute or relative paths to support watching folders that are symbolic links. Relative paths will be resolved to an absolute path using the currently opened workspace."),scope:E.RESOURCE},"files.hotExit":Xd,"files.defaultLanguage":{type:"string",markdownDescription:c(7197,"The default language identifier that is assigned to new files. If configured to `${activeEditorLanguage}`, will use the language identifier of the currently active text editor if any.")},[An]:{type:"object",patternProperties:{".*":{type:"boolean"}},default:{},markdownDescription:c(7198,"Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) to mark as read-only. Glob patterns are always evaluated relative to the path of the workspace folder unless they are absolute paths. You can exclude matching paths via the `#files.readonlyExclude#` setting. Files from readonly file system providers will always be read-only independent of this setting."),scope:E.RESOURCE},[Tn]:{type:"object",patternProperties:{".*":{type:"boolean"}},default:{},markdownDescription:c(7199,"Configure paths or [glob patterns](https://aka.ms/vscode-glob-patterns) to exclude from being marked as read-only if they match as a result of the `#files.readonlyInclude#` setting. Glob patterns are always evaluated relative to the path of the workspace folder unless they are absolute paths. Files from readonly file system providers will always be read-only independent of this setting."),scope:E.RESOURCE},[ic]:{type:"boolean",markdownDescription:c(7200,"Marks files as read-only when their file permissions indicate as such. This can be overridden via `#files.readonlyInclude#` and `#files.readonlyExclude#` settings."),default:!1},"files.restoreUndoStack":{type:"boolean",description:c(7201,"Restore the undo stack when a file is reopened."),default:!0},"files.saveConflictResolution":{type:"string",enum:["askUser","overwriteFileOnDisk"],enumDescriptions:[c(7202,"Will refuse to save and ask for resolving the save conflict manually."),c(7203,"Will resolve the save conflict by overwriting the file on disk with the changes in the editor.")],description:c(7204,"A save conflict can occur when a file is saved to disk that was changed by another program in the meantime. To prevent data loss, the user is asked to compare the changes in the editor with the version on disk. This setting should only be changed if you frequently encounter save conflict errors and may result in data loss if used without caution."),default:"askUser",scope:E.LANGUAGE_OVERRIDABLE},"files.dialog.defaultPath":{type:"string",pattern:"^((\\/|\\\\\\\\|[a-zA-Z]:\\\\).*)?$",patternErrorMessage:c(7205,"Default path for file dialogs must be an absolute path (e.g. C:\\\\myFolder or /myFolder)."),description:c(7206,"Default path for file dialogs, overriding user's home path. Only used in the absence of a context-specific path, such as most recently opened file or folder."),scope:E.MACHINE},"files.simpleDialog.enable":{type:"boolean",description:c(7207,"Enables the simple file dialog for opening and saving files and folders. The simple file dialog replaces the system file dialog when enabled."),default:!1},"files.participants.timeout":{type:"number",default:6e4,markdownDescription:c(7208,"Timeout in milliseconds after which file participants for create, rename, and delete are cancelled. Use `0` to disable participants.")}}});wo.registerConfiguration({...nc,properties:{"editor.formatOnSave":{type:"boolean",markdownDescription:c(7209,"Format a file on save. A formatter must be available and the editor must not be shutting down. When {0} is set to `afterDelay`, the file will only be formatted when saved explicitly.","`#files.autoSave#`"),scope:E.LANGUAGE_OVERRIDABLE},"editor.formatOnSaveMode":{type:"string",default:"file",enum:["file","modifications","modificationsIfAvailable"],enumDescriptions:[c(7210,"Format the whole file."),c(7211,"Format modifications (requires source control)."),c(7212,"Will attempt to format modifications only (requires source control). If source control can't be used, then the whole file will be formatted.")],markdownDescription:c(7213,"Controls if format on save formats the whole file or only modifications. Only applies when `#editor.formatOnSave#` is enabled."),scope:E.LANGUAGE_OVERRIDABLE}}});class _t{constructor(){this.type=V.Directory,this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._onDidDelete=new v,this.onDidDelete=this._onDidDelete.event,this.ctime=Date.now(),this.mtime=Date.now(),this.type=V.Directory,this.entries=new Map}async stats(){return{ctime:this.ctime,mtime:this.mtime,size:0,type:V.Directory}}delete(){this._onDidDelete.fire()}addChild(e,t){this.entries.set(e,t),this._onDidChange.fire();const i={dispose:()=>{this.deleteChild(e)}};return t.onDidDelete(()=>{i.dispose()}),i}deleteChild(e){return this.entries.delete(e)?(this.mtime=Date.now(),this._onDidChange.fire(),this.entries.size===0&&this.delete(),!0):!1}getChildren(e){return this.entries.get(e)}read(){return Array.from(this.entries.entries()).map(([e,t])=>[e,t.type])}}class So{constructor(e,t){this.uri=e,this.readonly=t,this.type=V.File,this._onDidChange=new v,this.onDidChange=this._onDidChange.event,this._onDidDelete=new v,this.onDidDelete=this._onDidDelete.event,this.ctime=Date.now(),this.mtime=Date.now(),this.onDidChange(()=>{this.mtime=Date.now()})}async stats(){return{ctime:this.ctime,mtime:this.mtime,size:await this.getSize(),type:V.File,permissions:this.readonly?ut.Readonly:void 0}}async delete(){if(this.readonly)throw b("Not allowed",y.FileWriteLocked);this._onDidDelete.fire()}}class If extends So{constructor(e,t,i){super(e,!0),this.url=t,this.metadata=i}async fetch(){const e=await fetch(this.url,{headers:this.metadata?.mimeType!=null?{Accept:this.metadata.mimeType}:{}});if(e.status!==200)throw new Error(e.statusText);return e}async getSize(){return this.metadata?.size??0}async read(){const e=await this.fetch();return new Uint8Array(await e.arrayBuffer())}async readStream(){return(await this.fetch()).body}write(){throw b("Not allowed",y.FileWriteLocked)}async delete(){throw b("Not allowed",y.FileWriteLocked)}}const Jd=new TextEncoder;function Qd(s){return s instanceof Uint8Array?s:Jd.encode(s)}class Zd extends D{constructor(e){super(),this.memoryFdCounter=0,this.fdMemory=new Map,this.onDidChangeCapabilities=H.None,this._onDidChangeFile=new v,this.onDidChangeFile=this._onDidChangeFile.event,this._bufferedChanges=[],this.rootByAuthority=new Map,this.capabilities=A.FileReadWrite|A.PathCaseSensitive|A.FileReadStream,e&&(this.capabilities|=A.Readonly)}async open(e){const t=await this.readFile(e),i=this.memoryFdCounter++;return this.fdMemory.set(i,t),i}async close(e){this.fdMemory.delete(e)}async read(e,t,i,r,n){const o=this.fdMemory.get(e);if(o==null)throw b("No file with that descriptor open",y.Unavailable);const a=_.wrap(o).slice(t,t+n);return i.set(a.buffer,r),a.byteLength}write(e,t,i,r,n){const o=this.fdMemory.get(e);if(o==null)throw b("No file with that descriptor open",y.Unavailable);const a=_.wrap(i).slice(r,r+n);return o.set(a.buffer,t),Promise.resolve(a.byteLength)}_lookupRoot(e){const t=e.toLowerCase();let i=this.rootByAuthority.get(t);return i==null&&(i=new _t,this.rootByAuthority.set(t,i)),i}_lookup(e,t){const i=e.path.split("/");let n=this._lookupRoot(e.authority);for(const o of i){if(o.length===0)continue;let a;if(n instanceof _t&&(a=n.getChildren(o)),a==null){if(t)return;throw b("file not found",y.FileNotFound)}n=a}return n}_lookupAsDirectory(e,t){const i=this._lookup(e,t);if(i instanceof _t)return i;throw b("file not a directory",y.FileNotADirectory)}_lookupAsFile(e,t){const i=this._lookup(e,t);if(i!=null&&i.type===V.File)return i;throw b("file is a directory",y.FileIsADirectory)}registerFile(e){const t=e.uri.path.split("/");let i=this._lookupRoot(e.uri.authority),r=e.uri.with({path:"/"});for(const a of t.slice(0,-1)){if(a==="")continue;r=me.joinPath(r,a);let l=i.getChildren(a);if(l==null&&(l=this.mkdirSync(r)),!(l instanceof _t))throw new Error(`file '${r.toString()}' is not a directory`);i=l}const n=t[t.length-1];if(i.getChildren(n)!=null)throw new Error(`file '${me.joinPath(r,n).toString()}/' already exists`);const o=new he;return o.add(de(()=>{this._fireSoon({resource:e.uri,type:P.DELETED})})),o.add(e.onDidDelete(()=>{o.dispose()})),o.add(e.onDidChange(()=>{this._fireSoon({resource:e.uri,type:P.UPDATED})})),o.add(i.addChild(n,e)),this._fireSoon({resource:e.uri,type:P.ADDED}),o}async stat(e){return await this._lookup(e,!1).stats()}readdirSync(e){return this._lookupAsDirectory(e,!1).read()}async readdir(e){return this.readdirSync(e)}async readFile(e){return await this._lookupAsFile(e,!1).read()}readFileStream(e,t,i){const r=this._lookupAsFile(e,!1),n=wt(o=>_.concat(o.map(a=>_.wrap(a))).buffer,{highWaterMark:10});return(async()=>{try{if(r.readStream==null||typeof t.length=="number"||typeof t.position=="number"){let o=await r.read();(typeof t.position=="number"||typeof t.length=="number")&&(o=o.slice(t.position??0,t.length)),n.end(o)}else{const o=(await r.readStream()).getReader();let a=await o.read();for(;!a.done&&!(i.isCancellationRequested||(await n.write(a.value),i.isCancellationRequested));)a=await o.read();n.end(void 0)}}catch(o){n.error(b(o,y.Unknown)),n.end()}})(),n}watch(){return D.None}async writeFile(e,t,i){const r=this._lookup(e,!0);if(r!=null&&!(r instanceof So))throw b("file is directory",y.FileIsADirectory);if(r==null)throw b("file not found",y.FileNotFound);if(!i.overwrite)throw b("file exists already",y.FileExists);await r.write(t)}async rename(){throw b("Not allowed",y.NoPermissions)}mkdirSync(e){if(this._lookup(e,!0)!=null)throw b("file exists already",y.FileExists);const t=ee(e),i=ht(e),r=this._lookupAsDirectory(i,!1),n=new _t,o=new he;return o.add(n.onDidDelete(()=>{o.dispose(),this._fireSoon({resource:e,type:P.DELETED})})),o.add(n.onDidChange(()=>{this._fireSoon({resource:e,type:P.UPDATED})})),r.addChild(t,n),this._fireSoon({type:P.ADDED,resource:e}),n}async mkdir(){throw b("Can' create a directory",y.NoPermissions)}deleteSync(e){const t=this._lookup(e,!0);if(t==null)throw b("Not found",y.FileNotFound);if(t.type===V.Directory)throw b("Can't delete a directory",y.NoPermissions);t.delete()}async delete(e){this.deleteSync(e)}_fireSoon(...e){this._bufferedChanges.push(...e),this._fireSoonHandle!=null&&(clearTimeout(this._fireSoonHandle),this._fireSoonHandle=void 0),this._fireSoonHandle=window.setTimeout(()=>{this._onDidChangeFile.fire(this._bufferedChanges),this._bufferedChanges.length=0},5)}}function Zs(s){return s.status==="fulfilled"}class Co{constructor(){this.providers=[],this.onDidChangeCapabilities=H.None,this._onDidChangeFile=new v,this.onDidChangeFile=this._onDidChangeFile.event,this._onDidChangeOverlays=new v,this.onDidChangeOverlays=this._onDidChangeOverlays.event,this.capabilities=A.FileReadWrite|A.PathCaseSensitive|A.FileReadStream}register(e,t){const i={priority:e,provider:t};this.providers.push(i),this.providers.sort((n,o)=>o.priority-n.priority);const r=new he;return r.add(t.onDidChangeFile(n=>{this._onDidChangeFile.fire(n)})),r.add({dispose:()=>{const n=this.providers.indexOf(i);n>=0&&(this.providers.splice(n,1),this._onDidChangeOverlays.fire())}}),this._onDidChangeOverlays.fire(),r}get delegates(){return this.providers.map(({provider:e})=>e)}async readFromDelegates(e,t){if(this.delegates.length===0)throw b("No delegate",y.Unavailable);let i;for(const r of this.delegates){if(t!=null&&t.isCancellationRequested)throw new Error("Cancelled");try{return await e(r)}catch(n){if(i??(i=n),n instanceof oi&&[y.NoPermissions,y.FileNotFound,y.Unavailable].includes(n.code))continue;throw n}}throw i}async writeToDelegates(e,t){if(this.delegates.length===0)throw b("No delegate",y.Unavailable);for(const i of this.delegates)if(!((i.capabilities&A.Readonly)>0)){try{await no(me,i,me.dirname(e))}catch{}try{return await t(i)}catch(r){if(r instanceof oi&&[y.NoPermissions,y.FileNotFound,y.Unavailable].includes(r.code))continue;throw r}}throw b("Not allowed",y.NoPermissions)}async stat(e){return await this.readFromDelegates(async t=>{const i=await t.stat(e),r=(t.capabilities&A.Readonly)>0;return{...i,permissions:i.permissions??(r?ut.Readonly:void 0)}})}async readFile(e){return await this.readFromDelegates(t=>t.readFile(e))}readFileStream(e,t,i){const r=wt(n=>_.concat(n.map(o=>_.wrap(o))).buffer);return this.readFromDelegates(async n=>{if(zt(n)){const o=n.readFileStream(e,t,i);await new Promise((a,l)=>{let d=!1;Pr(o,{onData(f){d=!0,r.write(f)},onEnd(){r.end(),a()},onError(f){d?r.error(f):l(f)}},i)})}else{let o=await this.readFile(e);return(typeof t.position=="number"||typeof t.length=="number")&&(o=o.slice(t.position??0,t.length)),r.end(o)}},i).catch(n=>{r.error(n)}),r}async readdir(e){const t=await Promise.allSettled(this.delegates.map(async i=>await i.readdir(e)));if(!t.some(Zs))throw t[0].reason;return Object.entries(Object.fromEntries(t.filter(Zs).map(i=>i.value).flat()))}watch(e,t){const i=new he;for(const r of this.delegates)i.add(r.watch(e,t));return i}async writeFile(e,t,i){await this.writeToDelegates(e,async r=>{let n;try{n=await r.stat(e)}catch{}if(n!=null&&((n.permissions??0)&ut.Readonly)>0)throw b("Not allowed",y.NoPermissions);return await r.writeFile(e,t,i)})}async mkdir(e){await this.writeToDelegates(e,t=>t.mkdir(e))}async delete(e,t){await this.writeToDelegates(e,i=>i.delete(e,t))}async rename(e,t,i){await this.writeToDelegates(t,r=>r.rename(e,t,i))}}const Eo=new Co;Eo.register(0,new hi);const yo=new Zd(!0),mo=new hi;mo.mkdir(K.from({scheme:k.vscodeUserData,path:"/User/"}));var Er;(function(s){s.extensionFile="extension-file"})(Er||(Er={}));const Ro={[Er.extensionFile]:yo,[oc.scheme]:new hi,[k.vscodeUserData]:mo,[k.tmp]:new hi,[k.file]:Eo};class _o extends or{constructor(e){super(e);for(const[t,i]of Object.entries(Ro)){let r=this.registerProvider(t,i);i instanceof Co&&i.onDidChangeOverlays(()=>{r.dispose(),r=this.registerProvider(t,i)})}}}_o.$di$dependencies=[];const Do=new Md;po(async s=>{Do.logger=s.get(Ge)});function eh(){return{[te.toString()]:new ae(_o,[Do],!0),[Ct.toString()]:new ae(pr,[],!0),[Mt.toString()]:new ae(wr,[],!0),[jr.toString()]:new ae(Kd,[],!0)}}function kf(s){return yo.registerFile(s)}async function th(s,e,t){qd();const i=Ro[s.scheme];if(i==null||i.writeFile==null)throw new Error(`${s.scheme} provider doesn't exist or doesn't support writing files`);try{await i.stat(s);return}catch(r){(!(r instanceof oi)||r.code!==y.FileNotFound)&&console.error("Unable to check if file exists",r)}await i.writeFile(s,Qd(e),{atomic:!1,create:!0,overwrite:!1,unlock:!1,...t})}var ih={nameShort:"Code - OSS",nameLong:"Code - OSS",applicationName:"code-oss",dataFolderName:".vscode-oss",win32MutexName:"vscodeoss",licenseName:"MIT",licenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverLicenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverGreeting:[],serverLicense:[],serverLicensePrompt:"",serverApplicationName:"code-server-oss",serverDataFolderName:".vscode-server-oss",tunnelApplicationName:"code-tunnel-oss",win32DirName:"Microsoft Code OSS",win32NameVersion:"Microsoft Code OSS",win32RegValueName:"CodeOSS",win32x64AppId:"{{D77B7E06-80BA-4137-BCF4-654B95CCEBC5}",win32arm64AppId:"{{D1ACE434-89C5-48D1-88D3-E2991DF85475}",win32x64UserAppId:"{{CC6B787D-37A0-49E8-AE24-8559A032BE0C}",win32arm64UserAppId:"{{3AEBF0C8-F733-4AD4-BADE-FDB816D53D7B}",win32AppUserModelId:"Microsoft.CodeOSS",win32ShellNameShort:"C&ode - OSS",win32TunnelServiceMutex:"vscodeoss-tunnelservice",win32TunnelMutex:"vscodeoss-tunnel",darwinBundleIdentifier:"com.visualstudio.code.oss",darwinProfileUUID:"47827DD9-4734-49A0-AF80-7E19B11495CC",darwinProfilePayloadUUID:"CF808BE7-53F3-46C6-A7E2-7EDB98A5E959",linuxIconName:"code-oss",licenseFileName:"LICENSE.txt",reportIssueUrl:"https://github.com/microsoft/vscode/issues/new",nodejsRepository:"https://nodejs.org",urlProtocol:"code-oss",webviewContentExternalBaseUrlTemplate:"https://{{uuid}}.vscode-cdn.net/insider/ef65ac1ba57f57f2a3961bfe94aa20481caca4c6/out/vs/workbench/contrib/webview/browser/pre/",builtInExtensions:[{name:"ms-vscode.js-debug-companion",version:"1.1.3",sha256:"7380a890787452f14b2db7835dfa94de538caf358ebc263f9d46dd68ac52de93",repo:"https://github.com/microsoft/vscode-js-debug-companion",metadata:{id:"99cb0b7f-7354-4278-b8da-6cc79972169d",publisherId:{publisherId:"5f5636e7-69ed-4afe-b5d6-8d231fb3d3ee",publisherName:"ms-vscode",displayName:"Microsoft",flags:"verified"},publisherDisplayName:"Microsoft"}},{name:"ms-vscode.js-debug",version:"1.100.1",sha256:"8c2218df3422d45b95e96d9d28cdc4aa4426a2799aaaedd862d3f60ecab03844",repo:"https://github.com/microsoft/vscode-js-debug",metadata:{id:"25629058-ddac-4e17-abba-74678e126c5d",publisherId:{publisherId:"5f5636e7-69ed-4afe-b5d6-8d231fb3d3ee",publisherName:"ms-vscode",displayName:"Microsoft",flags:"verified"},publisherDisplayName:"Microsoft"}},{name:"ms-vscode.vscode-js-profile-table",version:"1.0.10",sha256:"7361748ddf9fd09d8a2ed1f2a2d7376a2cf9aae708692820b799708385c38e08",repo:"https://github.com/microsoft/vscode-js-profile-visualizer",metadata:{id:"7e52b41b-71ad-457b-ab7e-0620f1fc4feb",publisherId:{publisherId:"5f5636e7-69ed-4afe-b5d6-8d231fb3d3ee",publisherName:"ms-vscode",displayName:"Microsoft",flags:"verified"},publisherDisplayName:"Microsoft"}}]},rh={...ih,quality:"stable",version:"1.101.1",commit:"18e3a1ec544e6907be1e944a94c496e302073435",date:"2025-06-24T16:25:55.101Z",...globalThis._VSCODE_PRODUCT_JSON??{}},It;const Af="workbench.view.explorer",Tf="workbench.explorer.fileView";new p("explorerViewletVisible",!0,{type:"boolean",description:c(7314,"True when the EXPLORER viewlet is visible.")});const bo=new p("foldersViewVisible",!0,{type:"boolean",description:c(7315,"True when the FOLDERS view (the file tree within the explorer view container) is visible.")}),xf=new p("explorerResourceIsFolder",!1,{type:"boolean",description:c(7316,"True when the focused item in the EXPLORER is a folder.")}),sh=new p("explorerResourceReadonly",!1,{type:"boolean",description:c(7317,"True when the focused item in the EXPLORER is read-only.")}),Pf=sh.toNegated(),Lf=new p("explorerResourceParentReadonly",!1,{type:"boolean",description:c(7318,"True when the focused item in the EXPLORER's parent is read-only.")}),Nf=new p("explorerResourceAvailableEditorIds",""),Wf=new p("explorerResourceIsRoot",!1,{type:"boolean",description:c(7319,"True when the focused item in the EXPLORER is a root folder.")}),Uf=new p("explorerResourceCut",!1,{type:"boolean",description:c(7320,"True when an item in the EXPLORER has been cut for cut and paste.")}),Mf=new p("explorerResourceMoveableToTrash",!1,{type:"boolean",description:c(7321,"True when the focused item in the EXPLORER can be moved to trash.")}),nh=new p("filesExplorerFocus",!0,{type:"boolean",description:c(7322,"True when the focus is inside the EXPLORER view.")}),Bf=new p("openEditorsFocus",!0,{type:"boolean",description:c(7323,"True when the focus is inside the OPEN EDITORS view.")}),oh=new p("explorerViewletFocus",!0,{type:"boolean",description:c(7324,"True when the focus is inside the EXPLORER viewlet.")}),Vf=new p("explorerFindProviderActive",!1,{type:"boolean",description:c(7325,"True when the explorer tree is using the explorer find provider.")}),Gf=new p("explorerViewletCompressedFocus",!0,{type:"boolean",description:c(7326,"True when the focused item in the EXPLORER view is a compact item.")}),Kf=new p("explorerViewletCompressedFirstFocus",!0,{type:"boolean",description:c(7327,"True when the focus is inside a compact item's first part in the EXPLORER view.")}),Hf=new p("explorerViewletCompressedLastFocus",!0,{type:"boolean",description:c(7328,"True when the focus is inside a compact item's last part in the EXPLORER view.")}),zf=new p("viewHasSomeCollapsibleItem",!1,{type:"boolean",description:c(7329,"True when a workspace in the EXPLORER view has some collapsible root child.")}),$f=Lt.and(bo,nh,Lt.not(Ln)),Yf=Lt.and(bo,oh,Lt.not(Ln)),ah="workbench.editors.files.textFileEditor",jf="workbench.editors.files.fileEditorInput",qf="workbench.editors.files.binaryFileEditor",Xf="code-text-binary";var en;(function(s){s.Default="default",s.Mixed="mixed",s.FilesFirst="filesFirst",s.Type="type",s.Modified="modified",s.FoldersNestsFiles="foldersNestsFiles"})(en||(en={}));var tn;(function(s){s.Verbose="verbose",s.Default="default",s.Light="light"})(tn||(tn={}));var rn;(function(s){s.Default="default",s.Upper="upper",s.Lower="lower",s.Unicode="unicode"})(rn||(rn={}));let sn=It=class extends D{constructor(e,t,i,r){super(),this.textFileService=e,this.fileService=t,this.languageService=i,this.modelService=r,this.fileWatcherDisposable=this._register(new qe)}static async open(e,t,i,r,n){await r.openEditor({original:{resource:It.resourceToTextFile(t,e)},modified:{resource:e},label:i,options:n})}static resourceToTextFile(e,t){return t.with({scheme:e,query:JSON.stringify({scheme:t.scheme,query:t.query})})}static textFileToResource(e){const{scheme:t,query:i}=JSON.parse(e.query);return e.with({scheme:t,query:i})}async provideTextContent(e){if(!e.query)return null;const t=It.textFileToResource(e),i=await this.resolveEditorModel(e);if(!this.fileWatcherDisposable.value){const r=new he;this.fileWatcherDisposable.value=r,r.add(this.fileService.onDidFilesChange(n=>{n.contains(t,P.UPDATED)&&this.resolveEditorModel(e,!1)})),i&&r.add(H.once(i.onWillDispose)(()=>this.fileWatcherDisposable.clear()))}return i}async resolveEditorModel(e,t=!0){const i=It.textFileToResource(e),r=await this.textFileService.readStream(i);let n=this.modelService.getModel(e);if(n)this.modelService.updateModel(n,r.value);else if(t){const o=this.modelService.getModel(i);let a;o?a=this.languageService.createById(o.getLanguageId()):a=this.languageService.createByFilepathOrFirstLine(i),n=this.modelService.createModel(r.value,a,e)}return n}};sn=It=x([u(0,Ct),u(1,te),u(2,Be),u(3,Ve)],sn);class Fo{static{this.COUNTER=0}constructor(e,t){this._editor=e,this._group=t,this.id=Fo.COUNTER++}get editor(){return this._editor}get group(){return this._group}get groupId(){return this._group.id}getId(){return`openeditor:${this.groupId}:${this.id}`}isPreview(){return!this._group.isPinned(this.editor)}isSticky(){return this._group.isSticky(this.editor)}getResource(){return Je.getOriginalUri(this.editor,{supportSideBySide:le.PRIMARY})}}function ch(s){return s.hasOwnProperty("workspace")}function Zt(s){return s.hasOwnProperty("folderUri")}function lh(s){return s.hasOwnProperty("fileUri")}function Oo(s){return pi(s)||Io(s)}function pi(s){const e=s;return typeof e?.path=="string"&&(!e.name||typeof e.name=="string")}function Io(s){const e=s;return typeof e?.uri=="string"&&(!e.name||typeof e.name=="string")}function ts(s,e,t,i,r){if(s.scheme!==i.scheme)return{name:t,uri:s.toString(!0)};let n=e?void 0:r.relativePath(i,s);if(n!==void 0)n.length===0?n=".":pt&&(n=nn(n));else if(s.scheme===k.file)n=s.fsPath,pt&&(n=nn(n));else if(r.isEqualAuthority(s.authority,i.authority))n=s.path;else return{name:t,uri:s.toString(!0)};return{name:t,path:n}}function nn(s){return s=nt(s),dc(s)||(s=hc(s)),s}function Gi(s,e,t){const i=[],r=new Set,n=t.dirname(e);for(const o of s){let a;if(pi(o))o.path&&(a=t.resolvePath(n,o.path));else if(Io(o))try{a=K.parse(o.uri),a.path[0]!==Es.sep&&(a=a.with({path:Es.sep+a.path}))}catch(l){console.warn(l)}if(a){const l=t.getComparisonKey(a);if(!r.has(l)){r.add(l);const d=o.name||t.basenameOrAuthority(a);i.push(new uc({uri:a,name:d,index:i.length},o))}}}return i}function on(s,e,t,i,r){const n=dh(e,s),o=r.dirname(e),a=r.dirname(i),l=[];for(const g of n.folders){const S=pi(g)?r.resolvePath(o,g.path):K.parse(g.uri);let w;t?w=!1:w=!pi(g)||In(g.path),l.push(ts(S,w,g.name,a,r))}const d={insertSpaces:!1,tabSize:4,eol:ri||Nr?`
`:`\r
`},f=Nn(s,["folders"],l,d);let h=Cs(s,f);return ac(n.remoteAuthority,cc(i))&&(h=Cs(h,lc(h,["remoteAuthority"],d))),h}function dh(s,e){const t=Wn(e);if(t&&Array.isArray(t.folders))t.folders=t.folders.filter(i=>Oo(i));else throw new Error(`${s} looks like an invalid workspace file.`);return t}function hh(s){return s.workspace&&typeof s.workspace=="object"&&typeof s.workspace.id=="string"&&typeof s.workspace.configPath=="string"}function uh(s){return typeof s.folderUri=="string"}function fh(s){return typeof s.fileUri=="string"}function gh(s,e){const t={workspaces:[],files:[]};if(s){const i=function(n,o){for(let a=0;a<n.length;a++)try{o(n[a],a)}catch(l){e.warn(`Error restoring recent entry ${JSON.stringify(n[a])}: ${l.toString()}. Skip entry.`)}},r=s;Array.isArray(r.entries)&&i(r.entries,n=>{const o=n.label,a=n.remoteAuthority;hh(n)?t.workspaces.push({label:o,remoteAuthority:a,workspace:{id:n.workspace.id,configPath:K.parse(n.workspace.configPath)}}):uh(n)?t.workspaces.push({label:o,remoteAuthority:a,folderUri:K.parse(n.folderUri)}):fh(n)&&t.files.push({label:o,remoteAuthority:a,fileUri:K.parse(n.fileUri)})})}return t}function ph(s){const e={entries:[]},t=(i,r)=>i&&i!==r.fsPath&&i!==r.path;for(const i of s.workspaces)Zt(i)?e.entries.push({folderUri:i.folderUri.toString(),label:t(i.label,i.folderUri)?i.label:void 0,remoteAuthority:i.remoteAuthority}):e.entries.push({workspace:{id:i.workspace.id,configPath:i.workspace.configPath.toString()},label:t(i.label,i.workspace.configPath)?i.label:void 0,remoteAuthority:i.remoteAuthority});for(const i of s.files)e.entries.push({fileUri:i.fileUri.toString(),label:t(i.label,i.fileUri)?i.label:void 0,remoteAuthority:i.remoteAuthority});return e}let yr=class extends D{constructor(e,t,i){super(),this.configurationService=e,this.modelService=t,this.languageService=i,this._onDidChangeConfiguration=this._register(new v),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._register(this.configurationService.onDidChangeConfiguration(r=>this._onDidChangeConfiguration.fire(this.toResourceConfigurationChangeEvent(r))))}getValue(e,t,i){return typeof i=="string"?this._getValue(e,fc.isIPosition(t)?t:null,i):this._getValue(e,null,typeof t=="string"?t:void 0)}updateValue(e,t,i,r){const n=e?this.getLanguage(e,null):null,o=this.configurationService.inspect(t,{resource:e,overrideIdentifier:n});r===void 0&&(r=this.deriveConfigurationTarget(o,n));const a=n&&o.overrideIdentifiers?.includes(n)?n:void 0;return this.configurationService.updateValue(t,i,{resource:e,overrideIdentifier:a},r)}deriveConfigurationTarget(e,t){if(t){if(e.memory?.override!==void 0)return C.MEMORY;if(e.workspaceFolder?.override!==void 0)return C.WORKSPACE_FOLDER;if(e.workspace?.override!==void 0)return C.WORKSPACE;if(e.userRemote?.override!==void 0)return C.USER_REMOTE;if(e.userLocal?.override!==void 0)return C.USER_LOCAL}return e.memory?.value!==void 0?C.MEMORY:e.workspaceFolder?.value!==void 0?C.WORKSPACE_FOLDER:e.workspace?.value!==void 0?C.WORKSPACE:e.userRemote?.value!==void 0?C.USER_REMOTE:C.USER_LOCAL}_getValue(e,t,i){const r=e?this.getLanguage(e,t):void 0;return typeof i>"u"?this.configurationService.getValue({resource:e,overrideIdentifier:r}):this.configurationService.getValue(i,{resource:e,overrideIdentifier:r})}inspect(e,t,i){const r=e?this.getLanguage(e,t):void 0;return this.configurationService.inspect(i,{resource:e,overrideIdentifier:r})}getLanguage(e,t){const i=this.modelService.getModel(e);return i?t?i.getLanguageIdAtPosition(t.lineNumber,t.column):i.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e)}toResourceConfigurationChangeEvent(e){return{affectedKeys:e.affectedKeys,affectsConfiguration:(t,i)=>{const r=t?this.getLanguage(t,null):void 0;return e.affectsConfiguration(i,{resource:t,overrideIdentifier:r})?!0:r?e.affectedKeys.has(`[${r}]`):!1}}}};yr=x([u(0,ve),u(1,Ve),u(2,Be)],yr);const Gt=".vscode",vi="settings",vh=`${Gt}/${vi}.json`,wh="vscode://schemas/settings/default",Sh="vscode://schemas/settings/user",Ch="vscode://schemas/settings/profile",Eh="vscode://schemas/settings/machine",ko="vscode://schemas/settings/workspace",yh="vscode://schemas/settings/folder",mh="vscode://schemas/launch",Rh="vscode://schemas/tasks",_h="vscode://schemas/mcp",wi=[E.APPLICATION,E.APPLICATION_MACHINE],Dh=[E.MACHINE,E.WINDOW,E.RESOURCE,E.LANGUAGE_OVERRIDABLE,E.MACHINE_OVERRIDABLE],Ao=[E.WINDOW,E.RESOURCE,E.LANGUAGE_OVERRIDABLE],bh=[E.APPLICATION,...Ao],Ki=[E.MACHINE,E.APPLICATION_MACHINE,E.WINDOW,E.RESOURCE,E.LANGUAGE_OVERRIDABLE,E.MACHINE_OVERRIDABLE],ei=[E.WINDOW,E.RESOURCE,E.LANGUAGE_OVERRIDABLE,E.MACHINE_OVERRIDABLE],To=[E.RESOURCE,E.LANGUAGE_OVERRIDABLE,E.MACHINE_OVERRIDABLE],Q="tasks",Ue="launch",ye="mcp",Oi=Object.create(null);Oi[Q]=`${Gt}/${Q}.json`;Oi[Ue]=`${Gt}/${Ue}.json`;Oi[ye]=`${Gt}/${ye}.json`;const is=Object.create(null);is[Q]=`${Q}.json`;is[ye]=`${ye}.json`;const Fh=`{
	"version": "2.0.0",
	"tasks": []
}`,be="workbench.settings.applyToAllProfiles",Oh=W.as(Un.JSONContribution),ti=W.as(oe.Configuration),an={type:"object",defaultSnippets:[{body:{title:"",properties:{}}}],properties:{title:{description:c(2526,"A title for the current category of settings. This label will be rendered in the Settings editor as a subheading. If the title is the same as the extension display name, then the category will be grouped under the main extension heading."),type:"string"},order:{description:c(2527,"When specified, gives the order of this category of settings relative to other categories."),type:"integer"},properties:{description:c(2528,"Description of the configuration properties."),type:"object",propertyNames:{pattern:"\\S+",patternErrorMessage:c(2529,"Property should not be empty.")},additionalProperties:{anyOf:[{title:c(2530,"Schema of the configuration property."),$ref:"http://json-schema.org/draft-07/schema#"},{type:"object",properties:{scope:{type:"string",enum:["application","machine","window","resource","language-overridable","machine-overridable"],default:"window",enumDescriptions:[c(2531,"Configuration that can be configured only in the user settings."),c(2532,"Configuration that can be configured only in the user settings or only in the remote settings."),c(2533,"Configuration that can be configured in the user, remote or workspace settings."),c(2534,"Configuration that can be configured in the user, remote, workspace or folder settings."),c(2535,"Resource configuration that can be configured in language specific settings."),c(2536,"Machine configuration that can be configured also in workspace or folder settings.")],markdownDescription:c(2537,"Scope in which the configuration is applicable. Available scopes are `application`, `machine`, `window`, `resource`, and `machine-overridable`.")},enumDescriptions:{type:"array",items:{type:"string"},description:c(2538,"Descriptions for enum values")},markdownEnumDescriptions:{type:"array",items:{type:"string"},description:c(2539,"Descriptions for enum values in the markdown format.")},enumItemLabels:{type:"array",items:{type:"string"},markdownDescription:c(2540,"Labels for enum values to be displayed in the Settings editor. When specified, the {0} values still show after the labels, but less prominently.","`enum`")},markdownDescription:{type:"string",description:c(2541,"The description in the markdown format.")},deprecationMessage:{type:"string",description:c(2542,"If set, the property is marked as deprecated and the given message is shown as an explanation.")},markdownDeprecationMessage:{type:"string",description:c(2543,"If set, the property is marked as deprecated and the given message is shown as an explanation in the markdown format.")},editPresentation:{type:"string",enum:["singlelineText","multilineText"],enumDescriptions:[c(2544,"The value will be shown in an inputbox."),c(2545,"The value will be shown in a textarea.")],default:"singlelineText",description:c(2546,"When specified, controls the presentation format of the string setting.")},order:{type:"integer",description:c(2547,"When specified, gives the order of this setting relative to other settings within the same category. Settings with an order property will be placed before settings without this property set.")},ignoreSync:{type:"boolean",description:c(2548,"When enabled, Settings Sync will not sync the user value of this configuration by default.")},tags:{type:"array",items:{type:"string"},markdownDescription:c(2549,"A list of categories under which to place the setting. The category can then be searched up in the Settings editor. For example, specifying the `experimental` tag allows one to find the setting by searching `@tag:experimental`.")}}}]}}}};let se;const xo=Mn.registerExtensionPoint({extensionPoint:"configurationDefaults",jsonSchema:{$ref:Bn},canHandleResolver:!0});xo.setHandler((s,{added:e,removed:t})=>{se&&ti.deltaConfiguration(se);const i=se={};if(queueMicrotask(()=>{se===i&&(ti.deltaConfiguration(se),se=void 0)}),t.length){const r=t.map(n=>({overrides:Ji(n.value),source:{id:n.description.identifier.value,displayName:n.description.displayName}}));se.removedDefaults=r}if(e.length){const r=ti.getConfigurationProperties(),n=[E.MACHINE_OVERRIDABLE,E.WINDOW,E.RESOURCE,E.LANGUAGE_OVERRIDABLE],o=e.map(a=>{const l=Ji(a.value);for(const d of Object.keys(l)){const f=r[d];if(f?.disallowConfigurationDefault){a.collector.warn(c(2550,"Cannot register configuration defaults for '{0}'. This setting does not allow contributing configuration defaults.",d)),delete l[d];continue}if(!At.test(d)&&f?.scope&&!n.includes(f.scope)){a.collector.warn(c(2551,"Cannot register configuration defaults for '{0}'. Only defaults for machine-overridable, window, resource and language overridable scoped settings are supported.",d)),delete l[d];continue}}return{overrides:l,source:{id:a.description.identifier.value,displayName:a.description.displayName}}});se.addedDefaults=o}});const Ih=Mn.registerExtensionPoint({extensionPoint:"configuration",deps:[xo],jsonSchema:{description:c(2552,"Contributes configuration settings."),oneOf:[an,{type:"array",items:an}]},canHandleResolver:!0}),Hi=new gc;Ih.setHandler((s,{added:e,removed:t})=>{if(se??={},t.length){const o=[];for(const a of t)o.push(...Hi.get(a.description.identifier)||[]),Hi.delete(a.description.identifier);se.removedConfigurations=o}const i=new Set;function r(o,a){const l=Ji(o);return l.title&&typeof l.title!="string"&&a.collector.error(c(2553,"'configuration.title' must be a string")),n(l,a),l.id=o.id||a.description.identifier.value,l.extensionInfo={id:a.description.identifier.value,displayName:a.description.displayName},l.restrictedProperties=a.description.capabilities?.untrustedWorkspaces?.supported==="limited"?a.description.capabilities?.untrustedWorkspaces.restrictedConfigurations:void 0,l.title=l.title||a.description.displayName||a.description.identifier.value,l}function n(o,a){const l=o.properties,d=rh.extensionConfigurationPolicy;if(l){typeof l!="object"&&(a.collector.error(c(2554,"'configuration.properties' must be an object")),o.properties={});for(const h in l){const g=l[h],S=wc(h,g);if(S){delete l[h],a.collector.warn(S);continue}if(i.has(h)){delete l[h],a.collector.warn(c(2555,"Cannot register '{0}'. This property is already registered.",h));continue}if(!Wr(g)){delete l[h],a.collector.error(c(2556,"configuration.properties property '{0}' must be an object",h));continue}d?.[h]&&(g.policy=d?.[h]),i.add(h),g.scope=g.scope?Sc(g.scope.toString()):E.WINDOW}}const f=o.allOf;if(f){a.collector.error(c(2557,"'configuration.allOf' is deprecated and should no longer be used. Instead, pass multiple configuration sections as an array to the 'configuration' contribution point."));for(const h of f)n(h,a)}}if(e.length){const o=[];for(const a of e){const l=[],d=a.value;Array.isArray(d)?d.forEach(f=>l.push(r(f,a))):l.push(r(d,a)),Hi.set(a.description.identifier,l),o.push(...l)}se.addedConfigurations=o}ti.deltaConfiguration(se),se=void 0});Oh.registerSchema("vscode://schemas/workspaceConfig",{allowComments:!0,allowTrailingCommas:!0,default:{folders:[{path:""}],settings:{}},required:["folders"],properties:{folders:{minItems:0,uniqueItems:!0,description:c(2558,"List of folders to be loaded in the workspace."),items:{type:"object",defaultSnippets:[{body:{path:"$1"}}],oneOf:[{properties:{path:{type:"string",description:c(2559,"A file path. e.g. `/root/folderA` or `./folderA` for a relative path that will be resolved against the location of the workspace file.")},name:{type:"string",description:c(2560,"An optional name for the folder. ")}},required:["path"]},{properties:{uri:{type:"string",description:c(2561,"URI of the folder")},name:{type:"string",description:c(2560,"An optional name for the folder. ")}},required:["uri"]}]}},settings:{type:"object",default:{},description:c(2562,"Workspace settings"),$ref:ko},launch:{type:"object",default:{configurations:[],compounds:[]},description:c(2563,"Workspace launch configurations"),$ref:mh},tasks:{type:"object",default:{version:"2.0.0",tasks:[]},description:c(2564,"Workspace task configurations"),$ref:Rh},mcp:{type:"object",default:{inputs:[],servers:{"mcp-server-time":{command:"uvx",args:["mcp_server_time","--local-timezone=America/Los_Angeles"]}}},description:c(2565,"Model Context Protocol server configurations"),$ref:_h},extensions:{type:"object",default:{},description:c(2566,"Workspace extensions"),$ref:"vscode://schemas/extensions"},remoteAuthority:{type:"string",doNotSuggest:!0,description:c(2567,"The remote server where the workspace is located.")},transient:{type:"boolean",doNotSuggest:!0,description:c(2568,"A transient workspace will disappear when restarting or reloading.")}},errorMessage:c(2569,"Unknown workspace configuration property")});class kh extends D{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.configuration}render(e){const t=e.contributes?.configuration?Array.isArray(e.contributes.configuration)?e.contributes.configuration:[e.contributes.configuration]:[],i=pc(t),r=i?Object.keys(i):[],n=[c(2570,"ID"),c(2571,"Description"),c(2572,"Default")],o=r.sort((a,l)=>a.localeCompare(l)).map(a=>[new Wi().appendMarkdown(`\`${a}\``),i[a].markdownDescription?new Wi(i[a].markdownDescription,!1):i[a].description??"",new Wi().appendCodeblock("json",JSON.stringify(Vn(i[a].default)?vc(i[a].type):i[a].default,null,2))]);return{data:{headers:n,rows:o},dispose:()=>{}}}}W.as(di.ExtensionFeaturesRegistry).registerExtensionFeature({id:"configuration",label:c(2573,"Settings"),access:{canToggle:!1},renderer:new ae(kh)});let mr=class extends D{constructor(e,t,i,r,n,o){super(),this.contextService=e,this.notificationService=t,this.fileService=i,this.quickInputService=r,this.hostService=n,this.storageService=o,this.findWorkspaces()}async findWorkspaces(){const e=this.contextService.getWorkspace().folders[0];if(!e||this.contextService.getWorkbenchState()!==O.FOLDER||_c(this.contextService.getWorkspace()))return;const t=(await this.fileService.resolve(e.uri)).children?.map(i=>i.name);if(Array.isArray(t)){const i=t.filter(Kn);i.length>0&&this.doHandleWorkspaceFiles(e.uri,i)}}doHandleWorkspaceFiles(e,t){const i={id:"workspaces.dontPromptToOpen",scope:Dc.WORKSPACE,isSecondary:!0};if(t.length===1){const r=t[0];this.notificationService.prompt(Me.Info,c(12175,"This folder contains a workspace file '{0}'. Do you want to open it? [Learn more]({1}) about workspace files.",r,"https://go.microsoft.com/fwlink/?linkid=2025315"),[{label:c(12176,"Open Workspace"),run:()=>this.hostService.openWindow([{workspaceUri:j(e,r)}])}],{neverShowAgain:i,priority:this.storageService.isNew(Re.WORKSPACE)?Dt.OPTIONAL:Dt.SILENT})}else t.length>1&&this.notificationService.prompt(Me.Info,c(12177,"This folder contains multiple workspace files. Do you want to open one? [Learn more]({0}) about workspace files.","https://go.microsoft.com/fwlink/?linkid=2025315"),[{label:c(12178,"Select Workspace"),run:()=>{this.quickInputService.pick(t.map(r=>({label:r})),{placeHolder:c(12179,"Select a workspace to open")}).then(r=>{r&&this.hostService.openWindow([{workspaceUri:j(e,r.label)}])})}}],{neverShowAgain:i,priority:this.storageService.isNew(Re.WORKSPACE)?Dt.OPTIONAL:Dt.SILENT})}};mr=x([u(0,ie),u(1,Bt),u(2,te),u(3,Gn),u(4,qr),u(5,Ri)],mr);W.as($r.Workbench).registerWorkbenchContribution(mr,je.Eventually);Cc(class extends Ec{constructor(){super({id:"workbench.action.openWorkspaceFromEditor",title:mc(12176,"Open Workspace"),f1:!1,menu:{id:yc.EditorContent,when:Lt.and(tr.Extension.isEqualTo(Rc),Vl.isEqualTo(ah),io.toNegated())}})}async run(s,e){const t=s.get(qr),i=s.get(ie),r=s.get(Bt);if(i.getWorkbenchState()===O.WORKSPACE){const n=i.getWorkspace().configuration;if(n&&Ye(n,e)){r.info(c(12180,"This workspace is already open."));return}}return t.openWindow([{workspaceUri:e}])}});class Si extends Xe{constructor(e,t){super(e,t),this._folders=[],this._transient=!1,this._settingsModelParser=new Xe(e,t),this._launchModel=B.createEmptyModel(t),this._tasksModel=B.createEmptyModel(t)}get folders(){return this._folders}get transient(){return this._transient}get settingsModel(){return this._settingsModelParser.configurationModel}get launchModel(){return this._launchModel}get tasksModel(){return this._tasksModel}reparseWorkspaceSettings(e){this._settingsModelParser.reparse(e)}getRestrictedWorkspaceSettings(){return this._settingsModelParser.restrictedConfigurations}doParseRaw(e,t){return this._folders=e.folders||[],this._transient=Fc(e.transient)&&e.transient,this._settingsModelParser.parseRaw(e.settings,t),this._launchModel=this.createConfigurationModelFrom(e,"launch"),this._tasksModel=this.createConfigurationModelFrom(e,"tasks"),super.doParseRaw(e,t)}createConfigurationModelFrom(e,t){const i=e[t];if(i){const r=Hn(i,a=>console.error(`Conflict in settings file ${this._name}: ${a}`)),n=Object.create(null);n[t]=r;const o=Object.keys(i).map(a=>`${t}.${a}`);return new B(n,o,[],void 0,this.logService)}return B.createEmptyModel(this.logService)}}class Po extends Xe{constructor(e,t,i){super(e,i),this.scope=t}doParseRaw(e,t){const i=Hn(e,o=>console.error(`Conflict in settings file ${this._name}: ${o}`)),r=Object.create(null);r[this.scope]=i;const n=Object.keys(e).map(o=>`${this.scope}.${o}`);return{contents:r,keys:n,overrides:[]}}}class cn extends bc{constructor(e,t,i,r,n,o,a,l,d,f,h){super(e,t,i,r,n,o,a,l,d,h),this._workspace=f}getValue(e,t={}){return super.getValue(e,t,this._workspace)}inspect(e,t={}){return super.inspect(e,t,this._workspace)}keys(){return super.keys(this._workspace)}compareAndDeleteFolderConfiguration(e){return this._workspace&&this._workspace.folders.length>0&&this._workspace.folders[0].uri.toString()===e.toString()?{keys:[],overrides:[]}:super.compareAndDeleteFolderConfiguration(e)}compare(e){const t=(o,a,l)=>{const d=[];return d.push(...a.filter(f=>o.indexOf(f)===-1)),d.push(...o.filter(f=>a.indexOf(f)===-1)),d.push(...o.filter(f=>a.indexOf(f)===-1?!1:_e(this.getValue(f,{overrideIdentifier:l}),e.getValue(f,{overrideIdentifier:l}))?this._workspace&&this._workspace.folders.some(h=>!_e(this.getValue(f,{resource:h.uri,overrideIdentifier:l}),e.getValue(f,{resource:h.uri,overrideIdentifier:l}))):!0)),d},i=t(this.allKeys(),e.allKeys()),r=[],n=ai([...this.allOverrideIdentifiers(),...e.allOverrideIdentifiers()]);for(const o of n){const a=t(this.getAllKeysForOverrideIdentifier(o),e.getAllKeysForOverrideIdentifier(o),o);a.length&&r.push([o,a])}return{keys:i,overrides:r}}}const Lo=xn(ve);var I;(function(s){s[s.ERROR_UNKNOWN_KEY=0]="ERROR_UNKNOWN_KEY",s[s.ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION=1]="ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION",s[s.ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE=2]="ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE",s[s.ERROR_INVALID_FOLDER_CONFIGURATION=3]="ERROR_INVALID_FOLDER_CONFIGURATION",s[s.ERROR_INVALID_USER_TARGET=4]="ERROR_INVALID_USER_TARGET",s[s.ERROR_INVALID_WORKSPACE_TARGET=5]="ERROR_INVALID_WORKSPACE_TARGET",s[s.ERROR_INVALID_FOLDER_TARGET=6]="ERROR_INVALID_FOLDER_TARGET",s[s.ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION=7]="ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION",s[s.ERROR_NO_WORKSPACE_OPENED=8]="ERROR_NO_WORKSPACE_OPENED",s[s.ERROR_CONFIGURATION_FILE_DIRTY=9]="ERROR_CONFIGURATION_FILE_DIRTY",s[s.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE=10]="ERROR_CONFIGURATION_FILE_MODIFIED_SINCE",s[s.ERROR_INVALID_CONFIGURATION=11]="ERROR_INVALID_CONFIGURATION",s[s.ERROR_POLICY_CONFIGURATION=12]="ERROR_POLICY_CONFIGURATION",s[s.ERROR_INTERNAL=13]="ERROR_INTERNAL"})(I||(I={}));class ln extends Lr{constructor(e,t){super(e),this.code=t}}var R;(function(s){s[s.USER_LOCAL=1]="USER_LOCAL",s[s.USER_REMOTE=2]="USER_REMOTE",s[s.WORKSPACE=3]="WORKSPACE",s[s.WORKSPACE_FOLDER=4]="WORKSPACE_FOLDER"})(R||(R={}));let Rr=class{constructor(e,t,i,r,n,o,a,l,d,f,h,g,S){this.remoteSettingsResource=e,this.configurationService=t,this.contextService=i,this.userDataProfileService=r,this.userDataProfilesService=n,this.fileService=o,this.textModelResolverService=a,this.textFileService=l,this.notificationService=d,this.preferencesService=f,this.editorService=h,this.uriIdentityService=g,this.filesConfigurationService=S,this.queue=new _i}async writeConfiguration(e,t,i={}){const r=this.getConfigurationEditOperation(e,t,i.scopes||{});return this.queue.queue(async()=>{try{await this.doWriteConfiguration(r,i)}catch(n){if(i.donotNotifyError)throw n;await this.onError(n,r,i.scopes)}})}async doWriteConfiguration(e,t){await this.validate(e.target,e,!t.handleDirtyFile,t.scopes||{});const i=e.resource,r=await this.resolveModelReference(i);try{const n=this.getFormattingOptions(r.object.textEditorModel);await this.updateConfiguration(e,r.object.textEditorModel,n,t)}finally{r.dispose()}}async updateConfiguration(e,t,i,r){if(this.hasParseErrors(t.getValue(),e))throw this.toConfigurationEditingError(I.ERROR_INVALID_CONFIGURATION,e.target,e);if(this.textFileService.isDirty(t.uri)&&r.handleDirtyFile)switch(r.handleDirtyFile){case"save":await this.save(t,e);break;case"revert":await this.textFileService.revert(t.uri);break}const n=this.getEdits(e,t.getValue(),i)[0];if(n){let o;try{o=this.filesConfigurationService.enableAutoSaveAfterShortDelay(t.uri),this.applyEditsToBuffer(n,t)&&await this.save(t,e)}finally{o?.dispose()}}}async save(e,t){try{await this.textFileService.save(e.uri,{ignoreErrorHandler:!0})}catch(i){throw i.fileOperationResult===L.FILE_MODIFIED_SINCE?this.toConfigurationEditingError(I.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE,t.target,t):new ln(c(12337,"Error while writing to {0}. {1}",this.stringifyTarget(t.target),i.message),I.ERROR_INTERNAL)}}applyEditsToBuffer(e,t){const i=t.getPositionAt(e.offset),r=t.getPositionAt(e.offset+e.length),n=new Ic(i.lineNumber,i.column,r.lineNumber,r.column),o=t.getValueInRange(n);if(e.content!==o){const a=o?ys.replace(n,e.content):ys.insert(i,e.content);return t.pushEditOperations([new kc(i.lineNumber,i.column,i.lineNumber,i.column)],[a],()=>[]),!0}return!1}getEdits({value:e,jsonPath:t},i,r){return t.length?Nn(i,t,e,r):[{content:JSON.stringify(e,null,r.insertSpaces&&r.tabSize?" ".repeat(r.tabSize):"	"),length:i.length,offset:0}]}getFormattingOptions(e){const{insertSpaces:t,tabSize:i}=e.getOptions(),r=e.getEOL();return{insertSpaces:t,tabSize:i,eol:r}}async onError(e,t,i){switch(e.code){case I.ERROR_INVALID_CONFIGURATION:this.onInvalidConfigurationError(e,t);break;case I.ERROR_CONFIGURATION_FILE_DIRTY:this.onConfigurationFileDirtyError(e,t,i);break;case I.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE:return this.doWriteConfiguration(t,{scopes:i,handleDirtyFile:"revert"});default:this.notificationService.error(e.message)}}onInvalidConfigurationError(e,t){const i=t.workspaceStandAloneConfigurationKey===Q?c(12338,"Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===Ue?c(12339,"Open Launch Configuration"):t.workspaceStandAloneConfigurationKey===ye?c(12340,"Open MCP Configuration"):null;i?this.notificationService.prompt(Me.Error,e.message,[{label:i,run:()=>this.openFile(t.resource)}]):this.notificationService.prompt(Me.Error,e.message,[{label:c(12341,"Open Settings"),run:()=>this.openSettings(t)}])}onConfigurationFileDirtyError(e,t,i){const r=t.workspaceStandAloneConfigurationKey===Q?c(12338,"Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===Ue?c(12339,"Open Launch Configuration"):null;r?this.notificationService.prompt(Me.Error,e.message,[{label:c(12342,"Save and Retry"),run:()=>{const n=t.key?`${t.workspaceStandAloneConfigurationKey}.${t.key}`:t.workspaceStandAloneConfigurationKey;this.writeConfiguration(t.target,{key:n,value:t.value},{handleDirtyFile:"save",scopes:i})}},{label:r,run:()=>this.openFile(t.resource)}]):this.notificationService.prompt(Me.Error,e.message,[{label:c(12342,"Save and Retry"),run:()=>this.writeConfiguration(t.target,{key:t.key,value:t.value},{handleDirtyFile:"save",scopes:i})},{label:c(12341,"Open Settings"),run:()=>this.openSettings(t)}])}openSettings(e){const t={jsonEditor:!0};switch(e.target){case R.USER_LOCAL:this.preferencesService.openUserSettings(t);break;case R.USER_REMOTE:this.preferencesService.openRemoteSettings(t);break;case R.WORKSPACE:this.preferencesService.openWorkspaceSettings(t);break;case R.WORKSPACE_FOLDER:if(e.resource){const i=this.contextService.getWorkspaceFolder(e.resource);i&&this.preferencesService.openFolderSettings({folderUri:i.uri,jsonEditor:!0})}break}}openFile(e){this.editorService.openEditor({resource:e,options:{pinned:!0}})}toConfigurationEditingError(e,t,i){const r=this.toErrorMessage(e,t,i);return new ln(r,e)}toErrorMessage(e,t,i){switch(e){case I.ERROR_POLICY_CONFIGURATION:return c(12343,"Unable to write {0} because it is configured in system policy.",i.key);case I.ERROR_UNKNOWN_KEY:return c(12344,"Unable to write to {0} because {1} is not a registered configuration.",this.stringifyTarget(t),i.key);case I.ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION:return c(12345,"Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case I.ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE:return c(12346,"Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case I.ERROR_INVALID_FOLDER_CONFIGURATION:return c(12347,"Unable to write to Folder Settings because {0} does not support the folder resource scope.",i.key);case I.ERROR_INVALID_USER_TARGET:return c(12348,"Unable to write to User Settings because {0} does not support for global scope.",i.key);case I.ERROR_INVALID_WORKSPACE_TARGET:return c(12349,"Unable to write to Workspace Settings because {0} does not support for workspace scope in a multi folder workspace.",i.key);case I.ERROR_INVALID_FOLDER_TARGET:return c(12350,"Unable to write to Folder Settings because no resource is provided.");case I.ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION:return c(12351,"Unable to write to Language Settings because {0} is not a resource language setting.",i.key);case I.ERROR_NO_WORKSPACE_OPENED:return c(12352,"Unable to write to {0} because no workspace is opened. Please open a workspace first and try again.",this.stringifyTarget(t));case I.ERROR_INVALID_CONFIGURATION:{if(i.workspaceStandAloneConfigurationKey===Q)return c(12353,"Unable to write into the tasks configuration file. Please open it to correct errors/warnings in it and try again.");if(i.workspaceStandAloneConfigurationKey===Ue)return c(12354,"Unable to write into the launch configuration file. Please open it to correct errors/warnings in it and try again.");if(i.workspaceStandAloneConfigurationKey===ye)return c(12355,"Unable to write into the MCP configuration file. Please open it to correct errors/warnings in it and try again.");switch(t){case R.USER_LOCAL:return c(12356,"Unable to write into user settings. Please open the user settings to correct errors/warnings in it and try again.");case R.USER_REMOTE:return c(12357,"Unable to write into remote user settings. Please open the remote user settings to correct errors/warnings in it and try again.");case R.WORKSPACE:return c(12358,"Unable to write into workspace settings. Please open the workspace settings to correct errors/warnings in the file and try again.");case R.WORKSPACE_FOLDER:{let r="<<unknown>>";if(i.resource){const n=this.contextService.getWorkspaceFolder(i.resource);n&&(r=n.name)}return c(12359,"Unable to write into folder settings. Please open the '{0}' folder settings to correct errors/warnings in it and try again.",r)}default:return""}}case I.ERROR_CONFIGURATION_FILE_DIRTY:{if(i.workspaceStandAloneConfigurationKey===Q)return c(12360,"Unable to write into tasks configuration file because the file has unsaved changes. Please save it first and then try again.");if(i.workspaceStandAloneConfigurationKey===Ue)return c(12361,"Unable to write into launch configuration file because the file has unsaved changes. Please save it first and then try again.");if(i.workspaceStandAloneConfigurationKey===ye)return c(12362,"Unable to write into MCP configuration file because the file has unsaved changes. Please save it first and then try again.");switch(t){case R.USER_LOCAL:return c(12363,"Unable to write into user settings because the file has unsaved changes. Please save the user settings file first and then try again.");case R.USER_REMOTE:return c(12364,"Unable to write into remote user settings because the file has unsaved changes. Please save the remote user settings file first and then try again.");case R.WORKSPACE:return c(12365,"Unable to write into workspace settings because the file has unsaved changes. Please save the workspace settings file first and then try again.");case R.WORKSPACE_FOLDER:{let r="<<unknown>>";if(i.resource){const n=this.contextService.getWorkspaceFolder(i.resource);n&&(r=n.name)}return c(12366,"Unable to write into folder settings because the file has unsaved changes. Please save the '{0}' folder settings file first and then try again.",r)}default:return""}}case I.ERROR_CONFIGURATION_FILE_MODIFIED_SINCE:if(i.workspaceStandAloneConfigurationKey===Q)return c(12367,"Unable to write into tasks configuration file because the content of the file is newer.");if(i.workspaceStandAloneConfigurationKey===Ue)return c(12368,"Unable to write into launch configuration file because the content of the file is newer.");if(i.workspaceStandAloneConfigurationKey===ye)return c(12369,"Unable to write into MCP configuration file because the content of the file is newer.");switch(t){case R.USER_LOCAL:return c(12370,"Unable to write into user settings because the content of the file is newer.");case R.USER_REMOTE:return c(12371,"Unable to write into remote user settings because the content of the file is newer.");case R.WORKSPACE:return c(12372,"Unable to write into workspace settings because the content of the file is newer.");case R.WORKSPACE_FOLDER:return c(12373,"Unable to write into folder settings because the content of the file is newer.")}case I.ERROR_INTERNAL:return c(12374,"Unable to write to {0} because of an internal error.",this.stringifyTarget(t))}}stringifyTarget(e){switch(e){case R.USER_LOCAL:return c(12375,"User Settings");case R.USER_REMOTE:return c(12376,"Remote User Settings");case R.WORKSPACE:return c(12377,"Workspace Settings");case R.WORKSPACE_FOLDER:return c(12378,"Folder Settings");default:return""}}defaultResourceValue(e){const t=this.uriIdentityService.extUri.basename(e);switch(t.substr(0,t.length-this.uriIdentityService.extUri.extname(e).length)){case Q:return Fh;default:return"{}"}}async resolveModelReference(e){return await this.fileService.exists(e)||await this.textFileService.write(e,this.defaultResourceValue(e),{encoding:"utf8"}),this.textModelResolverService.createModelReference(e)}hasParseErrors(e,t){if(t.workspaceStandAloneConfigurationKey&&!t.key)return!1;const i=[];return Wn(e,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0}async validate(e,t,i,r){if(this.configurationService.inspect(t.key).policyValue!==void 0)throw this.toConfigurationEditingError(I.ERROR_POLICY_CONFIGURATION,e,t);const o=W.as(oe.Configuration).getConfigurationProperties()[t.key]?.scope;if(!t.workspaceStandAloneConfigurationKey&&this.configurationService.keys().default.indexOf(t.key)<0&&!At.test(t.key)&&t.value!==void 0)throw this.toConfigurationEditingError(I.ERROR_UNKNOWN_KEY,e,t);if(t.workspaceStandAloneConfigurationKey&&t.workspaceStandAloneConfigurationKey!==Q&&t.workspaceStandAloneConfigurationKey!==ye&&(e===R.USER_LOCAL||e===R.USER_REMOTE))throw this.toConfigurationEditingError(I.ERROR_INVALID_USER_TARGET,e,t);if((e===R.WORKSPACE||e===R.WORKSPACE_FOLDER)&&this.contextService.getWorkbenchState()===O.EMPTY)throw this.toConfigurationEditingError(I.ERROR_NO_WORKSPACE_OPENED,e,t);if(e===R.WORKSPACE&&!t.workspaceStandAloneConfigurationKey&&!At.test(t.key)){if(o&&wi.includes(o))throw this.toConfigurationEditingError(I.ERROR_INVALID_WORKSPACE_CONFIGURATION_APPLICATION,e,t);if(o===E.MACHINE)throw this.toConfigurationEditingError(I.ERROR_INVALID_WORKSPACE_CONFIGURATION_MACHINE,e,t)}if(e===R.WORKSPACE_FOLDER){if(!t.resource)throw this.toConfigurationEditingError(I.ERROR_INVALID_FOLDER_TARGET,e,t);if(!t.workspaceStandAloneConfigurationKey&&!At.test(t.key)&&o!==void 0&&!To.includes(o))throw this.toConfigurationEditingError(I.ERROR_INVALID_FOLDER_CONFIGURATION,e,t)}if(r.overrideIdentifiers?.length&&o!==E.LANGUAGE_OVERRIDABLE)throw this.toConfigurationEditingError(I.ERROR_INVALID_RESOURCE_LANGUAGE_CONFIGURATION,e,t);if(!t.resource)throw this.toConfigurationEditingError(I.ERROR_INVALID_FOLDER_TARGET,e,t);if(i&&this.textFileService.isDirty(t.resource))throw this.toConfigurationEditingError(I.ERROR_CONFIGURATION_FILE_DIRTY,e,t)}getConfigurationEditOperation(e,t,i){if(t.key){const d=e===R.USER_LOCAL?is:Oi,f=Object.keys(d);for(const h of f){const g=this.getConfigurationFileResource(e,h,d[h],i.resource,void 0),S=this.isWorkspaceConfigurationResource(g)||g?.fsPath===this.userDataProfileService.currentProfile.settingsResource.fsPath;if(t.key===h){const m=S?[h]:[];return{key:m[m.length-1],jsonPath:m,value:t.value,resource:g??void 0,workspaceStandAloneConfigurationKey:h,target:e}}const w=`${h}.`;if(t.key.indexOf(w)===0){const m=S?[h,t.key.substr(w.length)]:[t.key.substr(w.length)];return{key:m[m.length-1],jsonPath:m,value:t.value,resource:g??void 0,workspaceStandAloneConfigurationKey:h,target:e}}}}const r=t.key,o=W.as(oe.Configuration).getConfigurationProperties()[r]?.scope;let a=i.overrideIdentifiers?.length?[zn(i.overrideIdentifiers),r]:[r];if(e===R.USER_LOCAL||e===R.USER_REMOTE)return{key:r,jsonPath:a,value:t.value,resource:this.getConfigurationFileResource(e,r,"",null,o)??void 0,target:e};const l=this.getConfigurationFileResource(e,r,vh,i.resource,o);return this.isWorkspaceConfigurationResource(l)&&(a=["settings",...a]),{key:r,jsonPath:a,value:t.value,resource:l??void 0,target:e}}isWorkspaceConfigurationResource(e){const t=this.contextService.getWorkspace();return!!(t.configuration&&e&&t.configuration.fsPath===e.fsPath)}getConfigurationFileResource(e,t,i,r,n){if(e===R.USER_LOCAL)return t===Q?this.userDataProfileService.currentProfile.tasksResource:!this.userDataProfileService.currentProfile.isDefault&&this.configurationService.isSettingAppliedForAllProfiles(t)?this.userDataProfilesService.defaultProfile.settingsResource:this.userDataProfileService.currentProfile.settingsResource;if(e===R.USER_REMOTE)return this.remoteSettingsResource;const o=this.contextService.getWorkbenchState();if(o!==O.EMPTY){const a=this.contextService.getWorkspace();if(e===R.WORKSPACE){if(o===O.WORKSPACE)return a.configuration??null;if(o===O.FOLDER)return a.folders[0].toResource(i)}if(e===R.WORKSPACE_FOLDER&&r){const l=this.contextService.getWorkspaceFolder(r);if(l)return l.toResource(i)}}return null}};Rr=x([u(1,Lo),u(2,ie),u(3,Jr),u(4,Di),u(5,te),u(6,Oc),u(7,Ct),u(8,Bt),u(9,yl),u(10,yi),u(11,ke),u(12,Mt)],Rr);class Tt extends Ac{static{this.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY="DefaultOverridesCacheExists"}constructor(e,t,i){super(i),this.configurationCache=e,this.configurationRegistry=W.as(oe.Configuration),this.cachedConfigurationDefaultsOverrides={},this.cacheKey={type:"defaults",key:"configurationDefaultsOverrides"},this.updateCache=!1,t.options?.configurationDefaults&&this.configurationRegistry.registerDefaultConfigurations([{overrides:t.options.configurationDefaults}])}getConfigurationDefaultOverrides(){return this.cachedConfigurationDefaultsOverrides}async initialize(){return await this.initializeCachedConfigurationDefaultsOverrides(),super.initialize()}reload(){return this.updateCache=!0,this.cachedConfigurationDefaultsOverrides={},this.updateCachedConfigurationDefaultsOverrides(),super.reload()}hasCachedConfigurationDefaultsOverrides(){return!Tc(this.cachedConfigurationDefaultsOverrides)}initializeCachedConfigurationDefaultsOverrides(){return this.initiaizeCachedConfigurationDefaultsOverridesPromise||(this.initiaizeCachedConfigurationDefaultsOverridesPromise=(async()=>{try{if(localStorage.getItem(Tt.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY)){const e=await this.configurationCache.read(this.cacheKey);e&&(this.cachedConfigurationDefaultsOverrides=JSON.parse(e))}}catch{}this.cachedConfigurationDefaultsOverrides=Wr(this.cachedConfigurationDefaultsOverrides)?this.cachedConfigurationDefaultsOverrides:{}})()),this.initiaizeCachedConfigurationDefaultsOverridesPromise}onDidUpdateConfiguration(e,t){super.onDidUpdateConfiguration(e,t),t&&this.updateCachedConfigurationDefaultsOverrides()}async updateCachedConfigurationDefaultsOverrides(){if(!this.updateCache)return;const e={},t=this.configurationRegistry.getConfigurationDefaultsOverrides();for(const[i,r]of t)!At.test(i)&&r.value!==void 0&&(e[i]=r.value);try{Object.keys(e).length?(localStorage.setItem(Tt.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY,"yes"),await this.configurationCache.write(this.cacheKey,JSON.stringify(e))):(localStorage.removeItem(Tt.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY),await this.configurationCache.remove(this.cacheKey))}catch{}}}class Ah extends $n{constructor(e,t,i,r){super(e.defaultProfile.settingsResource,{scopes:wi,skipUnregistered:!0},i.extUri,t,r),this._onDidChangeConfiguration=this._register(new v),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._register(this.onDidChange(()=>this.reloadConfigurationScheduler.schedule())),this.reloadConfigurationScheduler=this._register(new Vt(()=>this.loadConfiguration().then(n=>this._onDidChangeConfiguration.fire(n)),50))}async initialize(){return this.loadConfiguration()}async loadConfiguration(){const e=await super.loadConfiguration(),t=e.getValue(be),i=Array.isArray(t)?t:[];return this.parseOptions.include||i.length?this.reparse({...this.parseOptions,include:i}):e}}class Th extends D{get hasTasksLoaded(){return this.userConfiguration.value instanceof Ci}constructor(e,t,i,r,n,o){super(),this.settingsResource=e,this.tasksResource=t,this.configurationParseOptions=i,this.fileService=r,this.uriIdentityService=n,this.logService=o,this._onDidChangeConfiguration=this._register(new v),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.userConfiguration=this._register(new qe),this.userConfigurationChangeDisposable=this._register(new qe),this.userConfiguration.value=new $n(e,this.configurationParseOptions,n.extUri,this.fileService,o),this.userConfigurationChangeDisposable.value=this.userConfiguration.value.onDidChange(()=>this.reloadConfigurationScheduler.schedule()),this.reloadConfigurationScheduler=this._register(new Vt(()=>this.userConfiguration.value.loadConfiguration().then(a=>this._onDidChangeConfiguration.fire(a)),50))}async reset(e,t,i){return this.settingsResource=e,this.tasksResource=t,this.configurationParseOptions=i,this.doReset()}async doReset(e){const t=this.uriIdentityService.extUri.dirname(this.settingsResource),i=this.tasksResource?[[Q,this.tasksResource]]:[],r=new Ci(t.toString(),this.settingsResource,i,this.configurationParseOptions,this.fileService,this.uriIdentityService,this.logService),n=await r.loadConfiguration(e);return this.userConfiguration.value=r,this.userConfigurationChangeDisposable.value&&(this.userConfigurationChangeDisposable.value=this.userConfiguration.value.onDidChange(()=>this.reloadConfigurationScheduler.schedule())),n}async initialize(){return this.userConfiguration.value.loadConfiguration()}async reload(e){return this.hasTasksLoaded?this.userConfiguration.value.loadConfiguration():this.doReset(e)}reparse(e){return this.configurationParseOptions={...this.configurationParseOptions,...e},this.userConfiguration.value.reparse(this.configurationParseOptions)}getRestrictedSettings(){return this.userConfiguration.value.getRestrictedSettings()}}class Ci extends D{constructor(e,t,i,r,n,o,a){super(),this.settingsResource=t,this.standAloneConfigurationResources=i,this.fileService=n,this.uriIdentityService=o,this.logService=a,this._onDidChange=this._register(new v),this.onDidChange=this._onDidChange.event,this.allResources=[this.settingsResource,...this.standAloneConfigurationResources.map(([,l])=>l)],this._register(ms(...this.allResources.map(l=>ms(this.fileService.watch(o.extUri.dirname(l)),this.fileService.watch(l))))),this._folderSettingsModelParser=new Xe(e,a),this._folderSettingsParseOptions=r,this._standAloneConfigurations=[],this._cache=B.createEmptyModel(this.logService),this._register(H.debounce(H.any(H.filter(this.fileService.onDidFilesChange,l=>this.handleFileChangesEvent(l)),H.filter(this.fileService.onDidRunOperation,l=>this.handleFileOperationEvent(l))),()=>{},100)(()=>this._onDidChange.fire()))}async resolveContents(e){const t=async n=>Promise.all(n.map(async o=>{try{return(await this.fileService.readFile(o,{atomic:!0})).value.toString()}catch(a){this.logService.trace(`Error while resolving configuration file '${o.toString()}': ${En(a)}`),a.fileOperationResult!==L.FILE_NOT_FOUND&&a.fileOperationResult!==L.FILE_NOT_DIRECTORY&&this.logService.error(a)}return"{}"})),[[i],r]=await Promise.all([e?Promise.resolve([void 0]):t([this.settingsResource]),t(this.standAloneConfigurationResources.map(([,n])=>n))]);return[i,r.map((n,o)=>[this.standAloneConfigurationResources[o][0],n])]}async loadConfiguration(e){const[t,i]=await this.resolveContents(!!e);this._standAloneConfigurations=[],this._folderSettingsModelParser.parse("",this._folderSettingsParseOptions),t!==void 0&&this._folderSettingsModelParser.parse(t,this._folderSettingsParseOptions);for(let r=0;r<i.length;r++){const n=i[r][1];if(n!==void 0){const o=new Po(this.standAloneConfigurationResources[r][1].toString(),this.standAloneConfigurationResources[r][0],this.logService);o.parse(n),this._standAloneConfigurations.push(o.configurationModel)}}return this.consolidate(e),this._cache}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){const t=this._folderSettingsModelParser.configurationModel.contents;return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),_e(t,this._folderSettingsModelParser.configurationModel.contents)||this.consolidate(),this._cache}consolidate(e){this._cache=(e??this._folderSettingsModelParser.configurationModel).merge(...this._standAloneConfigurations)}handleFileChangesEvent(e){return!!(this.allResources.some(t=>e.contains(t))||this.allResources.some(t=>e.contains(this.uriIdentityService.extUri.dirname(t),P.DELETED)))}handleFileOperationEvent(e){return!!((e.isOperation(T.CREATE)||e.isOperation(T.COPY)||e.isOperation(T.DELETE)||e.isOperation(T.WRITE))&&this.allResources.some(t=>this.uriIdentityService.extUri.isEqual(e.resource,t))||e.isOperation(T.DELETE)&&this.allResources.some(t=>this.uriIdentityService.extUri.isEqual(e.resource,this.uriIdentityService.extUri.dirname(t))))}}class xh extends D{constructor(e,t,i,r,n,o){super(),this._userConfigurationInitializationPromise=null,this._onDidChangeConfiguration=this._register(new v),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onDidInitialize=this._register(new v),this.onDidInitialize=this._onDidInitialize.event,this._fileService=i,this._userConfiguration=this._cachedConfiguration=new Ph(e,t,{scopes:Ki},o),n.getEnvironment().then(async a=>{if(a){const l=this._register(new zi(a.settingsPath,{scopes:Ki},this._fileService,r,o));this._register(l.onDidChangeConfiguration(f=>this.onDidUserConfigurationChange(f))),this._userConfigurationInitializationPromise=l.initialize();const d=await this._userConfigurationInitializationPromise;this._userConfiguration.dispose(),this._userConfiguration=l,this.onDidUserConfigurationChange(d),this._onDidInitialize.fire(d)}})}async initialize(){if(this._userConfiguration instanceof zi)return this._userConfiguration.initialize();let e=await this._userConfiguration.initialize();return this._userConfigurationInitializationPromise&&(e=await this._userConfigurationInitializationPromise,this._userConfigurationInitializationPromise=null),e}reload(){return this._userConfiguration.reload()}reparse(){return this._userConfiguration.reparse({scopes:Ki})}getRestrictedSettings(){return this._userConfiguration.getRestrictedSettings()}onDidUserConfigurationChange(e){this.updateCache(),this._onDidChangeConfiguration.fire(e)}async updateCache(){if(this._userConfiguration instanceof zi){let e;try{e=await this._userConfiguration.resolveContent()}catch(t){if(t.fileOperationResult!==L.FILE_NOT_FOUND)return}await this._cachedConfiguration.updateConfiguration(e)}}}class zi extends D{constructor(e,t,i,r,n){super(),this.configurationResource=e,this.fileService=i,this.uriIdentityService=r,this.logService=n,this._onDidChangeConfiguration=this._register(new v),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.fileWatcherDisposable=this._register(new qe),this.directoryWatcherDisposable=this._register(new qe),this.parser=new Xe(this.configurationResource.toString(),n),this.parseOptions=t,this._register(i.onDidFilesChange(o=>this.handleFileChangesEvent(o))),this._register(i.onDidRunOperation(o=>this.handleFileOperationEvent(o))),this.reloadConfigurationScheduler=this._register(new Vt(()=>this.reload().then(o=>this._onDidChangeConfiguration.fire(o)),50)),this._register(de(()=>{this.stopWatchingResource(),this.stopWatchingDirectory()}))}watchResource(){this.fileWatcherDisposable.value=this.fileService.watch(this.configurationResource)}stopWatchingResource(){this.fileWatcherDisposable.value=void 0}watchDirectory(){const e=this.uriIdentityService.extUri.dirname(this.configurationResource);this.directoryWatcherDisposable.value=this.fileService.watch(e)}stopWatchingDirectory(){this.directoryWatcherDisposable.value=void 0}async initialize(){const e=await this.fileService.exists(this.configurationResource);return this.onResourceExists(e),this.reload()}async resolveContent(){return(await this.fileService.readFile(this.configurationResource,{atomic:!0})).value.toString()}async reload(){try{const e=await this.resolveContent();return this.parser.parse(e,this.parseOptions),this.parser.configurationModel}catch{return B.createEmptyModel(this.logService)}}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.parser.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}handleFileChangesEvent(e){let t=!1;e.contains(this.configurationResource,P.ADDED)?(t=!0,this.onResourceExists(!0)):e.contains(this.configurationResource,P.DELETED)?(t=!0,this.onResourceExists(!1)):e.contains(this.configurationResource,P.UPDATED)&&(t=!0),t&&this.reloadConfigurationScheduler.schedule()}handleFileOperationEvent(e){(e.isOperation(T.CREATE)||e.isOperation(T.COPY)||e.isOperation(T.DELETE)||e.isOperation(T.WRITE))&&this.uriIdentityService.extUri.isEqual(e.resource,this.configurationResource)&&this.reloadConfigurationScheduler.schedule()}onResourceExists(e){e?(this.stopWatchingDirectory(),this.watchResource()):(this.stopWatchingResource(),this.watchDirectory())}}class Ph extends D{constructor(e,t,i,r){super(),this.configurationCache=t,this._onDidChange=this._register(new v),this.onDidChange=this._onDidChange.event,this.key={type:"user",key:e},this.parser=new Xe("CachedRemoteUserConfiguration",r),this.parseOptions=i,this.configurationModel=B.createEmptyModel(r)}getConfigurationModel(){return this.configurationModel}initialize(){return this.reload()}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.configurationModel=this.parser.configurationModel,this.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}async reload(){try{const e=await this.configurationCache.read(this.key),t=JSON.parse(e);t.content&&(this.parser.parse(t.content,this.parseOptions),this.configurationModel=this.parser.configurationModel)}catch{}return this.configurationModel}async updateConfiguration(e){return e?this.configurationCache.write(this.key,JSON.stringify({content:e})):this.configurationCache.remove(this.key)}}class Lh extends D{get initialized(){return this._initialized}constructor(e,t,i,r){super(),this.configurationCache=e,this.fileService=t,this.uriIdentityService=i,this.logService=r,this._workspaceConfigurationDisposables=this._register(new he),this._workspaceIdentifier=null,this._isWorkspaceTrusted=!1,this._onDidUpdateConfiguration=this._register(new v),this.onDidUpdateConfiguration=this._onDidUpdateConfiguration.event,this._initialized=!1,this.fileService=t,this._workspaceConfiguration=this._cachedConfiguration=new Nh(e,r)}async initialize(e,t){this._workspaceIdentifier=e,this._isWorkspaceTrusted=t,this._initialized||(this.configurationCache.needsCaching(this._workspaceIdentifier.configPath)?(this._workspaceConfiguration=this._cachedConfiguration,this.waitAndInitialize(this._workspaceIdentifier)):this.doInitialize(new Ht(this.fileService,this.uriIdentityService,this.logService))),await this.reload()}async reload(){this._workspaceIdentifier&&await this._workspaceConfiguration.load(this._workspaceIdentifier,{scopes:ei,skipRestricted:this.isUntrusted()})}getFolders(){return this._workspaceConfiguration.getFolders()}setFolders(e,t){return this._workspaceIdentifier?t.write(this._workspaceIdentifier.configPath,[{path:["folders"],value:e}],!0).then(()=>this.reload()):Promise.resolve()}isTransient(){return this._workspaceConfiguration.isTransient()}getConfiguration(){return this._workspaceConfiguration.getWorkspaceSettings()}updateWorkspaceTrust(e){return this._isWorkspaceTrusted=e,this.reparseWorkspaceSettings()}reparseWorkspaceSettings(){return this._workspaceConfiguration.reparseWorkspaceSettings({scopes:ei,skipRestricted:this.isUntrusted()}),this.getConfiguration()}getRestrictedSettings(){return this._workspaceConfiguration.getRestrictedSettings()}async waitAndInitialize(e){if(await Yn(e.configPath,this.fileService),!(this._workspaceConfiguration instanceof Ht)){const t=this._register(new Ht(this.fileService,this.uriIdentityService,this.logService));await t.load(e,{scopes:ei,skipRestricted:this.isUntrusted()}),this.doInitialize(t),this.onDidWorkspaceConfigurationChange(!1,!0)}}doInitialize(e){this._workspaceConfigurationDisposables.clear(),this._workspaceConfiguration=this._workspaceConfigurationDisposables.add(e),this._workspaceConfigurationDisposables.add(this._workspaceConfiguration.onDidChange(t=>this.onDidWorkspaceConfigurationChange(!0,!1))),this._initialized=!0}isUntrusted(){return!this._isWorkspaceTrusted}async onDidWorkspaceConfigurationChange(e,t){e&&await this.reload(),this.updateCache(),this._onDidUpdateConfiguration.fire(t)}async updateCache(){if(this._workspaceIdentifier&&this.configurationCache.needsCaching(this._workspaceIdentifier.configPath)&&this._workspaceConfiguration instanceof Ht){const e=await this._workspaceConfiguration.resolveContent(this._workspaceIdentifier);await this._cachedConfiguration.updateWorkspace(this._workspaceIdentifier,e)}}}class Ht extends D{constructor(e,t,i){super(),this.fileService=e,this.logService=i,this._workspaceIdentifier=null,this._onDidChange=this._register(new v),this.onDidChange=this._onDidChange.event,this.workspaceConfigurationModelParser=new Si("",i),this.workspaceSettings=B.createEmptyModel(i),this._register(H.any(H.filter(this.fileService.onDidFilesChange,r=>!!this._workspaceIdentifier&&r.contains(this._workspaceIdentifier.configPath)),H.filter(this.fileService.onDidRunOperation,r=>!!this._workspaceIdentifier&&(r.isOperation(T.CREATE)||r.isOperation(T.COPY)||r.isOperation(T.DELETE)||r.isOperation(T.WRITE))&&t.extUri.isEqual(r.resource,this._workspaceIdentifier.configPath)))(()=>this.reloadConfigurationScheduler.schedule())),this.reloadConfigurationScheduler=this._register(new Vt(()=>this._onDidChange.fire(),50)),this.workspaceConfigWatcher=this._register(this.watchWorkspaceConfigurationFile())}get workspaceIdentifier(){return this._workspaceIdentifier}async resolveContent(e){return(await this.fileService.readFile(e.configPath,{atomic:!0})).value.toString()}async load(e,t){(!this._workspaceIdentifier||this._workspaceIdentifier.id!==e.id)&&(this._workspaceIdentifier=e,this.workspaceConfigurationModelParser=new Si(this._workspaceIdentifier.id,this.logService),Ee(this.workspaceConfigWatcher),this.workspaceConfigWatcher=this._register(this.watchWorkspaceConfigurationFile()));let i="";try{i=await this.resolveContent(this._workspaceIdentifier)}catch(r){await this.fileService.exists(this._workspaceIdentifier.configPath)&&this.logService.error(r)}this.workspaceConfigurationModelParser.parse(i,t),this.consolidate()}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}watchWorkspaceConfigurationFile(){return this._workspaceIdentifier?this.fileService.watch(this._workspaceIdentifier.configPath):D.None}}class Nh{constructor(e,t){this.configurationCache=e,this.logService=t,this.onDidChange=H.None,this.workspaceConfigurationModelParser=new Si("",t),this.workspaceSettings=B.createEmptyModel(t)}async load(e,t){try{const i=this.getKey(e),r=await this.configurationCache.read(i),n=JSON.parse(r);n.content&&(this.workspaceConfigurationModelParser=new Si(i.key,this.logService),this.workspaceConfigurationModelParser.parse(n.content,t),this.consolidate())}catch{}}get workspaceIdentifier(){return null}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}async updateWorkspace(e,t){try{const i=this.getKey(e);t?await this.configurationCache.write(i,JSON.stringify({content:t})):await this.configurationCache.remove(i)}catch{}}getKey(e){return{type:"workspaces",key:e.id}}}class Wh{constructor(e,t,i,r,n){this.configurationCache=r,this.logService=n,this.onDidChange=H.None,this.key={type:"folder",key:Cn(j(e,t).toString()).toString(16)},this._folderSettingsModelParser=new Xe("CachedFolderConfiguration",n),this._folderSettingsParseOptions=i,this._standAloneConfigurations=[],this.configurationModel=B.createEmptyModel(n)}async loadConfiguration(){try{const e=await this.configurationCache.read(this.key),{content:t}=JSON.parse(e.toString());if(t)for(const i of Object.keys(t))if(i===vi)this._folderSettingsModelParser.parse(t[i],this._folderSettingsParseOptions);else{const r=new Po(i,i,this.logService);r.parse(t[i]),this._standAloneConfigurations.push(r.configurationModel)}this.consolidate()}catch{}return this.configurationModel}async updateConfiguration(e,t){const i={};e&&(i[vi]=e),t.forEach(([r,n])=>{n&&(i[r]=n)}),Object.keys(i).length?await this.configurationCache.write(this.key,JSON.stringify({content:i})):await this.configurationCache.remove(this.key)}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),this.consolidate(),this.configurationModel}consolidate(){this.configurationModel=this._folderSettingsModelParser.configurationModel.merge(...this._standAloneConfigurations)}getUnsupportedKeys(){return[]}}class Uh extends D{constructor(e,t,i,r,n,o,a,l,d){super(),this.workspaceFolder=t,this.workbenchState=r,this.workspaceTrusted=n,this.configurationCache=d,this._onDidChange=this._register(new v),this.onDidChange=this._onDidChange.event,this.scopes=O.WORKSPACE===this.workbenchState?To:ei,this.configurationFolder=a.extUri.joinPath(t.uri,i),this.cachedFolderConfiguration=new Wh(t.uri,i,{scopes:this.scopes,skipRestricted:this.isUntrusted()},d,l),e&&this.configurationCache.needsCaching(t.uri)?(this.folderConfiguration=this.cachedFolderConfiguration,Yn(t.uri,o).then(()=>{this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(o,a,l)),this._register(this.folderConfiguration.onDidChange(f=>this.onDidFolderConfigurationChange())),this.onDidFolderConfigurationChange()})):(this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(o,a,l)),this._register(this.folderConfiguration.onDidChange(f=>this.onDidFolderConfigurationChange())))}loadConfiguration(){return this.folderConfiguration.loadConfiguration()}updateWorkspaceTrust(e){return this.workspaceTrusted=e,this.reparse()}reparse(){const e=this.folderConfiguration.reparse({scopes:this.scopes,skipRestricted:this.isUntrusted()});return this.updateCache(),e}getRestrictedSettings(){return this.folderConfiguration.getRestrictedSettings()}isUntrusted(){return!this.workspaceTrusted}onDidFolderConfigurationChange(){this.updateCache(),this._onDidChange.fire()}createFileServiceBasedConfiguration(e,t,i){const r=t.extUri.joinPath(this.configurationFolder,`${vi}.json`),n=[Q,Ue,ye].map(o=>[o,t.extUri.joinPath(this.configurationFolder,`${o}.json`)]);return new Ci(this.configurationFolder.toString(),r,n,{scopes:this.scopes,skipRestricted:this.isUntrusted()},e,t,i)}async updateCache(){if(this.configurationCache.needsCaching(this.configurationFolder)&&this.folderConfiguration instanceof Ci){const[e,t]=await this.folderConfiguration.resolveContents();this.cachedFolderConfiguration.updateConfiguration(e,t)}}}function dn(s,e){return s.isDefault||s.useDefaultFlags?.settings?e?bh:void 0:e?Ao:Dh}class $i extends qc{constructor(){super(...arguments),this.initialized=!1}}class Mh extends D{get restrictedSettings(){return this._restrictedSettings}constructor({remoteAuthority:e,configurationCache:t},i,r,n,o,a,l,d,f){if(super(),this.userDataProfileService=r,this.userDataProfilesService=n,this.fileService=o,this.remoteAgentService=a,this.uriIdentityService=l,this.logService=d,this.initialized=!1,this.applicationConfiguration=null,this.remoteUserConfiguration=null,this._onDidChangeConfiguration=this._register(new v),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeWorkspaceFolders=this._register(new v),this.onWillChangeWorkspaceFolders=this._onWillChangeWorkspaceFolders.event,this._onDidChangeWorkspaceFolders=this._register(new v),this.onDidChangeWorkspaceFolders=this._onDidChangeWorkspaceFolders.event,this._onDidChangeWorkspaceName=this._register(new v),this.onDidChangeWorkspaceName=this._onDidChangeWorkspaceName.event,this._onDidChangeWorkbenchState=this._register(new v),this.onDidChangeWorkbenchState=this._onDidChangeWorkbenchState.event,this.isWorkspaceTrusted=!0,this._restrictedSettings={default:[]},this._onDidChangeRestrictedSettings=this._register(new v),this.onDidChangeRestrictedSettings=this._onDidChangeRestrictedSettings.event,this.configurationRegistry=W.as(oe.Configuration),this.initRemoteUserConfigurationBarrier=new Xi,this.completeWorkspaceBarrier=new Xi,this.defaultConfiguration=this._register(new Tt(t,i,d)),this.policyConfiguration=f instanceof nl?new Bc:this._register(new Vc(this.defaultConfiguration,f,d)),this.configurationCache=t,this._configuration=new cn(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,B.createEmptyModel(d),B.createEmptyModel(d),B.createEmptyModel(d),B.createEmptyModel(d),new Z,B.createEmptyModel(d),new Z,this.workspace,d),this.applicationConfigurationDisposables=this._register(new he),this.createApplicationConfiguration(),this.localUserConfiguration=this._register(new Th(r.currentProfile.settingsResource,r.currentProfile.tasksResource,{scopes:dn(r.currentProfile,!!e)},o,l,d)),this.cachedFolderConfigs=new Z,this._register(this.localUserConfiguration.onDidChangeConfiguration(h=>this.onLocalUserConfigurationChanged(h))),e){const h=this.remoteUserConfiguration=this._register(new xh(e,t,o,l,a,d));this._register(h.onDidInitialize(g=>{this._register(h.onDidChangeConfiguration(S=>this.onRemoteUserConfigurationChanged(S))),this.onRemoteUserConfigurationChanged(g),this.initRemoteUserConfigurationBarrier.open()}))}else this.initRemoteUserConfigurationBarrier.open();this.workspaceConfiguration=this._register(new Lh(t,o,l,d)),this._register(this.workspaceConfiguration.onDidUpdateConfiguration(h=>{this.onWorkspaceConfigurationChanged(h).then(()=>{this.workspace.initialized=this.workspaceConfiguration.initialized,this.checkAndMarkWorkspaceComplete(h)})})),this._register(this.defaultConfiguration.onDidChangeConfiguration(({properties:h,defaults:g})=>this.onDefaultConfigurationChanged(g,h))),this._register(this.policyConfiguration.onDidChangeConfiguration(h=>this.onPolicyConfigurationChanged(h))),this._register(r.onDidChangeCurrentProfile(h=>this.onUserDataProfileChanged(h))),this.workspaceEditingQueue=new _i}createApplicationConfiguration(){this.applicationConfigurationDisposables.clear(),this.userDataProfileService.currentProfile.isDefault||this.userDataProfileService.currentProfile.useDefaultFlags?.settings?this.applicationConfiguration=null:(this.applicationConfiguration=this.applicationConfigurationDisposables.add(this._register(new Ah(this.userDataProfilesService,this.fileService,this.uriIdentityService,this.logService))),this.applicationConfigurationDisposables.add(this.applicationConfiguration.onDidChangeConfiguration(e=>this.onApplicationConfigurationChanged(e))))}async getCompleteWorkspace(){return await this.completeWorkspaceBarrier.wait(),this.getWorkspace()}getWorkspace(){return this.workspace}getWorkbenchState(){return this.workspace.configuration?O.WORKSPACE:this.workspace.folders.length===1?O.FOLDER:O.EMPTY}getWorkspaceFolder(e){return this.workspace.getFolder(e)}addFolders(e,t){return this.updateFolders(e,[],t)}removeFolders(e){return this.updateFolders([],e)}async updateFolders(e,t,i){return this.workspaceEditingQueue.queue(()=>this.doUpdateFolders(e,t,i))}isInsideWorkspace(e){return!!this.getWorkspaceFolder(e)}isCurrentWorkspace(e){switch(this.getWorkbenchState()){case O.FOLDER:{let t;return K.isUri(e)?t=e:_s(e)&&(t=e.uri),K.isUri(t)&&this.uriIdentityService.extUri.isEqual(t,this.workspace.folders[0].uri)}case O.WORKSPACE:return Qi(e)&&this.workspace.id===e.id}return!1}async doUpdateFolders(e,t,i){if(this.getWorkbenchState()!==O.WORKSPACE||e.length+t.length===0)return Promise.resolve(void 0);let r=!1,n=this.getWorkspace().folders,o=n.map(a=>a.raw).filter((a,l)=>Oo(a)?!this.contains(t,n[l].uri):!0);if(r=n.length!==o.length,e.length){const a=this.getWorkspace().configuration,l=this.uriIdentityService.extUri.dirname(a);n=Gi(o,a,this.uriIdentityService.extUri);const d=n.map(h=>h.uri),f=[];for(const h of e){const g=h.uri;if(!this.contains(d,g)){try{if(!(await this.fileService.stat(g)).isDirectory)continue}catch{}f.push(ts(g,!1,h.name,l,this.uriIdentityService.extUri))}}f.length>0&&(r=!0,typeof i=="number"&&i>=0&&i<o.length?(o=o.slice(0),o.splice(i,0,...f)):o=[...o,...f])}return r?this.setFolders(o):Promise.resolve(void 0)}async setFolders(e){if(!this.instantiationService)throw new Error("Cannot update workspace folders because workspace service is not yet ready to accept writes.");return await this.instantiationService.invokeFunction(t=>this.workspaceConfiguration.setFolders(e,t.get(qn))),this.onWorkspaceConfigurationChanged(!1)}contains(e,t){return e.some(i=>this.uriIdentityService.extUri.isEqual(i,t))}getConfigurationData(){return this._configuration.toData()}getValue(e,t){const i=typeof e=="string"?e:void 0,r=Ui(e)?e:Ui(t)?t:void 0;return this._configuration.getValue(i,r)}async updateValue(e,t,i,r,n){const o=Gc(i)?i:Ui(i)?{resource:i.resource,overrideIdentifiers:i.overrideIdentifier?[i.overrideIdentifier]:void 0}:void 0,a=o?r:i,l=a?[a]:[];if(o?.overrideIdentifiers&&(o.overrideIdentifiers=ai(o.overrideIdentifiers),o.overrideIdentifiers=o.overrideIdentifiers.length?o.overrideIdentifiers:void 0),!l.length){if(o?.overrideIdentifiers&&o.overrideIdentifiers.length>1)throw new Error("Configuration Target is required while updating the value for multiple override identifiers");const d=this.inspect(e,{resource:o?.resource,overrideIdentifier:o?.overrideIdentifiers?o.overrideIdentifiers[0]:void 0});l.push(...this.deriveConfigurationTargets(e,t,d)),_e(t,d.defaultValue)&&l.length===1&&(l[0]===C.USER||l[0]===C.USER_LOCAL)&&(t=void 0)}await Le.settled(l.map(d=>this.writeConfigurationValue(e,t,d,o,n)))}async reloadConfiguration(e){if(e===void 0){this.reloadDefaultConfiguration();const t=await this.reloadApplicationConfiguration(!0),{local:i,remote:r}=await this.reloadUserConfiguration();await this.reloadWorkspaceConfiguration(),await this.loadConfiguration(t,i,r,!0);return}if(Kc(e)){await this.reloadWorkspaceFolderConfiguration(e);return}switch(e){case C.DEFAULT:this.reloadDefaultConfiguration();return;case C.USER:{const{local:t,remote:i}=await this.reloadUserConfiguration();await this.loadConfiguration(this._configuration.applicationConfiguration,t,i,!0);return}case C.USER_LOCAL:await this.reloadLocalUserConfiguration();return;case C.USER_REMOTE:await this.reloadRemoteUserConfiguration();return;case C.WORKSPACE:case C.WORKSPACE_FOLDER:await this.reloadWorkspaceConfiguration();return}}hasCachedConfigurationDefaultsOverrides(){return this.defaultConfiguration.hasCachedConfigurationDefaultsOverrides()}inspect(e,t){return this._configuration.inspect(e,t)}keys(){return this._configuration.keys()}async whenRemoteConfigurationLoaded(){await this.initRemoteUserConfigurationBarrier.wait()}async initialize(e){Fe("code/willInitWorkspaceService");const t=this.initialized;this.initialized=!1;const i=await this.createWorkspace(e);await this.updateWorkspaceAndInitializeConfiguration(i,t),this.checkAndMarkWorkspaceComplete(!1),Fe("code/didInitWorkspaceService")}updateWorkspaceTrust(e){if(this.isWorkspaceTrusted!==e){this.isWorkspaceTrusted=e;const t=this._configuration.toData(),i=[];for(const n of this.workspace.folders){const o=this.cachedFolderConfigs.get(n.uri);let a;o&&(a=o.updateWorkspaceTrust(this.isWorkspaceTrusted),this._configuration.updateFolderConfiguration(n.uri,a)),i.push(a)}this.getWorkbenchState()===O.FOLDER?i[0]&&this._configuration.updateWorkspaceConfiguration(i[0]):this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.updateWorkspaceTrust(this.isWorkspaceTrusted)),this.updateRestrictedSettings();let r=[];this.restrictedSettings.userLocal&&r.push(...this.restrictedSettings.userLocal),this.restrictedSettings.userRemote&&r.push(...this.restrictedSettings.userRemote),this.restrictedSettings.workspace&&r.push(...this.restrictedSettings.workspace),this.restrictedSettings.workspaceFolder?.forEach(n=>r.push(...n)),r=ai(r),r.length&&this.triggerConfigurationChange({keys:r,overrides:[]},{data:t,workspace:this.workspace},C.WORKSPACE)}}acquireInstantiationService(e){this.instantiationService=e}isSettingAppliedForAllProfiles(e){const t=this.configurationRegistry.getConfigurationProperties()[e]?.scope;if(t&&wi.includes(t))return!0;const i=this.getValue(be)??[];return Array.isArray(i)&&i.includes(e)}async createWorkspace(e){return Qi(e)?this.createMultiFolderWorkspace(e):_s(e)?this.createSingleFolderWorkspace(e):this.createEmptyWorkspace(e)}async createMultiFolderWorkspace(e){await this.workspaceConfiguration.initialize({id:e.id,configPath:e.configPath},this.isWorkspaceTrusted);const t=e.configPath,i=Gi(this.workspaceConfiguration.getFolders(),t,this.uriIdentityService.extUri),r=e.id,n=new $i(r,i,this.workspaceConfiguration.isTransient(),t,o=>this.uriIdentityService.extUri.ignorePathCasing(o));return n.initialized=this.workspaceConfiguration.initialized,n}createSingleFolderWorkspace(e){const t=new $i(e.id,[Hc(e.uri)],!1,null,i=>this.uriIdentityService.extUri.ignorePathCasing(i));return t.initialized=!0,t}createEmptyWorkspace(e){const t=new $i(e.id,[],!1,null,i=>this.uriIdentityService.extUri.ignorePathCasing(i));return t.initialized=!0,Promise.resolve(t)}checkAndMarkWorkspaceComplete(e){!this.completeWorkspaceBarrier.isOpen()&&this.workspace.initialized&&(this.completeWorkspaceBarrier.open(),this.validateWorkspaceFoldersAndReload(e))}async updateWorkspaceAndInitializeConfiguration(e,t){const i=!!this.workspace;let r,n,o=[];if(i?(r=this.getWorkbenchState(),n=this.workspace.configuration?this.workspace.configuration.fsPath:void 0,o=this.workspace.folders,this.workspace.update(e)):this.workspace=e,await this.initializeConfiguration(t),i){const a=this.getWorkbenchState();r&&a!==r&&this._onDidChangeWorkbenchState.fire(a);const l=this.workspace.configuration?this.workspace.configuration.fsPath:void 0;(n&&l!==n||a!==r)&&this._onDidChangeWorkspaceName.fire();const d=this.compareFolders(o,this.workspace.folders);d&&(d.added.length||d.removed.length||d.changed.length)&&(await this.handleWillChangeWorkspaceFolders(d,!1),this._onDidChangeWorkspaceFolders.fire(d))}this.localUserConfiguration.hasTasksLoaded||this._register(zc(Ce,()=>this.reloadLocalUserConfiguration(!1,this._configuration.localUserConfiguration)))}compareFolders(e,t){const i={added:[],removed:[],changed:[]};i.added=t.filter(r=>!e.some(n=>r.uri.toString()===n.uri.toString()));for(let r=0;r<e.length;r++){const n=e[r];let o=0;for(o=0;o<t.length&&n.uri.toString()!==t[o].uri.toString();o++);o<t.length?(r!==o||n.name!==t[o].name)&&i.changed.push(n):i.removed.push(n)}return i}async initializeConfiguration(e){await this.defaultConfiguration.initialize();const t=this.policyConfiguration.initialize(),i=this.applicationConfiguration?this.applicationConfiguration.initialize():Promise.resolve(B.createEmptyModel(this.logService)),r=async()=>{Fe("code/willInitUserConfiguration");const l=await Promise.all([this.localUserConfiguration.initialize(),this.remoteUserConfiguration?this.remoteUserConfiguration.initialize():Promise.resolve(B.createEmptyModel(this.logService))]);if(this.applicationConfiguration){const d=await i;l[0]=this.localUserConfiguration.reparse({exclude:d.getValue(be)})}return Fe("code/didInitUserConfiguration"),l},[,n,[o,a]]=await Promise.all([t,i,r()]);Fe("code/willInitWorkspaceConfiguration"),await this.loadConfiguration(n,o,a,e),Fe("code/didInitWorkspaceConfiguration")}reloadDefaultConfiguration(){this.onDefaultConfigurationChanged(this.defaultConfiguration.reload())}async reloadApplicationConfiguration(e){if(!this.applicationConfiguration)return B.createEmptyModel(this.logService);const t=await this.applicationConfiguration.loadConfiguration();return e||this.onApplicationConfigurationChanged(t),t}async reloadUserConfiguration(){const[e,t]=await Promise.all([this.reloadLocalUserConfiguration(!0),this.reloadRemoteUserConfiguration(!0)]);return{local:e,remote:t}}async reloadLocalUserConfiguration(e,t){const i=await this.localUserConfiguration.reload(t);return e||this.onLocalUserConfigurationChanged(i),i}async reloadRemoteUserConfiguration(e){if(this.remoteUserConfiguration){const t=await this.remoteUserConfiguration.reload();return e||this.onRemoteUserConfigurationChanged(t),t}return B.createEmptyModel(this.logService)}async reloadWorkspaceConfiguration(){const e=this.getWorkbenchState();if(e===O.FOLDER)return this.onWorkspaceFolderConfigurationChanged(this.workspace.folders[0]);if(e===O.WORKSPACE)return this.workspaceConfiguration.reload().then(()=>this.onWorkspaceConfigurationChanged(!1))}reloadWorkspaceFolderConfiguration(e){return this.onWorkspaceFolderConfigurationChanged(e)}async loadConfiguration(e,t,i,r){this.cachedFolderConfigs=new Z;const n=this.workspace.folders,o=await this.loadFolderConfigurations(n),a=this.getWorkspaceConfigurationModel(o),l=new Z;o.forEach((f,h)=>l.set(n[h].uri,f));const d=this._configuration;if(this._configuration=new cn(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,e,t,i,a,l,B.createEmptyModel(this.logService),new Z,this.workspace,this.logService),this.initialized=!0,r){const f=this._configuration.compare(d);this.triggerConfigurationChange(f,{data:d.toData(),workspace:this.workspace},C.WORKSPACE)}this.updateRestrictedSettings()}getWorkspaceConfigurationModel(e){switch(this.getWorkbenchState()){case O.FOLDER:return e[0];case O.WORKSPACE:return this.workspaceConfiguration.getConfiguration();default:return B.createEmptyModel(this.logService)}}onUserDataProfileChanged(e){e.join((async()=>{const t=[];t.push(this.localUserConfiguration.reset(e.profile.settingsResource,e.profile.tasksResource,{scopes:dn(e.profile,!!this.remoteUserConfiguration)})),(e.previous.isDefault!==e.profile.isDefault||!!e.previous.useDefaultFlags?.settings!=!!e.profile.useDefaultFlags?.settings)&&(this.createApplicationConfiguration(),this.applicationConfiguration&&t.push(this.reloadApplicationConfiguration(!0)));let[i,r]=await Promise.all(t);r=r??this._configuration.applicationConfiguration,this.applicationConfiguration&&(i=this.localUserConfiguration.reparse({exclude:r.getValue(be)})),await this.loadConfiguration(r,i,this._configuration.remoteUserConfiguration,!0)})())}onDefaultConfigurationChanged(e,t){if(this.workspace){const i=this._configuration.toData(),r=this._configuration.compareAndUpdateDefaultConfiguration(e,t);if(this.applicationConfiguration&&this._configuration.updateApplicationConfiguration(this.applicationConfiguration.reparse()),this.remoteUserConfiguration&&(this._configuration.updateLocalUserConfiguration(this.localUserConfiguration.reparse()),this._configuration.updateRemoteUserConfiguration(this.remoteUserConfiguration.reparse())),this.getWorkbenchState()===O.FOLDER){const n=this.cachedFolderConfigs.get(this.workspace.folders[0].uri);n&&(this._configuration.updateWorkspaceConfiguration(n.reparse()),this._configuration.updateFolderConfiguration(this.workspace.folders[0].uri,n.reparse()))}else{this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.reparseWorkspaceSettings());for(const n of this.workspace.folders){const o=this.cachedFolderConfigs.get(n.uri);o&&this._configuration.updateFolderConfiguration(n.uri,o.reparse())}}this.triggerConfigurationChange(r,{data:i,workspace:this.workspace},C.DEFAULT),this.updateRestrictedSettings()}}onPolicyConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdatePolicyConfiguration(e);this.triggerConfigurationChange(i,t,C.DEFAULT)}onApplicationConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.applicationConfiguration.getValue(be)??[],r=this._configuration.compareAndUpdateApplicationConfiguration(e),n=this.getValue(be)??[],o=this.configurationRegistry.getConfigurationProperties(),a=[];for(const l of r.keys){const d=o[l]?.scope;if(d&&wi.includes(d)){if(a.push(l),l===be){for(const f of i)n.includes(f)||a.push(f);for(const f of n)i.includes(f)||a.push(f)}}else n.includes(l)&&a.push(l)}r.keys=a,r.keys.includes(be)&&this._configuration.updateLocalUserConfiguration(this.localUserConfiguration.reparse({exclude:n})),this.triggerConfigurationChange(r,t,C.USER)}onLocalUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateLocalUserConfiguration(e);this.triggerConfigurationChange(i,t,C.USER)}onRemoteUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateRemoteUserConfiguration(e);this.triggerConfigurationChange(i,t,C.USER)}async onWorkspaceConfigurationChanged(e){if(this.workspace&&this.workspace.configuration){let t=Gi(this.workspaceConfiguration.getFolders(),this.workspace.configuration,this.uriIdentityService.extUri);if(this.workspace.initialized){const{added:i,removed:r,changed:n}=this.compareFolders(this.workspace.folders,t);i.length||r.length||n.length?t=await this.toValidWorkspaceFolders(t):t=this.workspace.folders}await this.updateWorkspaceConfiguration(t,this.workspaceConfiguration.getConfiguration(),e)}}updateRestrictedSettings(){const e=[],t=this.configurationRegistry.getConfigurationProperties(),i=Object.keys(t).filter(w=>t[w].restricted).sort((w,m)=>w.localeCompare(m)),r=st(i,this._restrictedSettings.default,(w,m)=>w.localeCompare(m));e.push(...r.added,...r.removed);const n=(this.applicationConfiguration?.getRestrictedSettings()||[]).sort((w,m)=>w.localeCompare(m)),o=st(n,this._restrictedSettings.application||[],(w,m)=>w.localeCompare(m));e.push(...o.added,...o.removed);const a=this.localUserConfiguration.getRestrictedSettings().sort((w,m)=>w.localeCompare(m)),l=st(a,this._restrictedSettings.userLocal||[],(w,m)=>w.localeCompare(m));e.push(...l.added,...l.removed);const d=(this.remoteUserConfiguration?.getRestrictedSettings()||[]).sort((w,m)=>w.localeCompare(m)),f=st(d,this._restrictedSettings.userRemote||[],(w,m)=>w.localeCompare(m));e.push(...f.added,...f.removed);const h=new Z;for(const w of this.workspace.folders){const N=(this.cachedFolderConfigs.get(w.uri)?.getRestrictedSettings()||[]).sort((Ii,ki)=>Ii.localeCompare(ki));N.length&&h.set(w.uri,N);const De=this._restrictedSettings.workspaceFolder?.get(w.uri)||[],tt=st(N,De,(Ii,ki)=>Ii.localeCompare(ki));e.push(...tt.added,...tt.removed)}const g=this.getWorkbenchState()===O.WORKSPACE?this.workspaceConfiguration.getRestrictedSettings().sort((w,m)=>w.localeCompare(m)):this.workspace.folders[0]?h.get(this.workspace.folders[0].uri)||[]:[],S=st(g,this._restrictedSettings.workspace||[],(w,m)=>w.localeCompare(m));e.push(...S.added,...S.removed),e.length&&(this._restrictedSettings={default:i,application:n.length?n:void 0,userLocal:a.length?a:void 0,userRemote:d.length?d:void 0,workspace:g.length?g:void 0,workspaceFolder:h.size?h:void 0},this._onDidChangeRestrictedSettings.fire(this.restrictedSettings))}async updateWorkspaceConfiguration(e,t,i){const r={data:this._configuration.toData(),workspace:this.workspace},n=this._configuration.compareAndUpdateWorkspaceConfiguration(t),o=this.compareFolders(this.workspace.folders,e);if(o.added.length||o.removed.length||o.changed.length){this.workspace.folders=e;const a=await this.onFoldersChanged();await this.handleWillChangeWorkspaceFolders(o,i),this.triggerConfigurationChange(a,r,C.WORKSPACE_FOLDER),this._onDidChangeWorkspaceFolders.fire(o)}else this.triggerConfigurationChange(n,r,C.WORKSPACE);this.updateRestrictedSettings()}async handleWillChangeWorkspaceFolders(e,t){const i=[];this._onWillChangeWorkspaceFolders.fire({join(r){i.push(r)},changes:e,fromCache:t});try{await Le.settled(i)}catch{}}async onWorkspaceFolderConfigurationChanged(e){const[t]=await this.loadFolderConfigurations([e]),i={data:this._configuration.toData(),workspace:this.workspace},r=this._configuration.compareAndUpdateFolderConfiguration(e.uri,t);if(this.getWorkbenchState()===O.FOLDER){const n=this._configuration.compareAndUpdateWorkspaceConfiguration(t);this.triggerConfigurationChange(Ds(r,n),i,C.WORKSPACE)}else this.triggerConfigurationChange(r,i,C.WORKSPACE_FOLDER);this.updateRestrictedSettings()}async onFoldersChanged(){const e=[];for(const i of this.cachedFolderConfigs.keys())this.workspace.folders.filter(r=>r.uri.toString()===i.toString())[0]||(this.cachedFolderConfigs.get(i).dispose(),this.cachedFolderConfigs.delete(i),e.push(this._configuration.compareAndDeleteFolderConfiguration(i)));const t=this.workspace.folders.filter(i=>!this.cachedFolderConfigs.has(i.uri));return t.length&&(await this.loadFolderConfigurations(t)).forEach((r,n)=>{e.push(this._configuration.compareAndUpdateFolderConfiguration(t[n].uri,r))}),Ds(...e)}loadFolderConfigurations(e){return Promise.all([...e.map(t=>{let i=this.cachedFolderConfigs.get(t.uri);return i||(i=new Uh(!this.initialized,t,Gt,this.getWorkbenchState(),this.isWorkspaceTrusted,this.fileService,this.uriIdentityService,this.logService,this.configurationCache),this._register(i.onDidChange(()=>this.onWorkspaceFolderConfigurationChanged(t))),this.cachedFolderConfigs.set(t.uri,this._register(i))),i.loadConfiguration()})])}async validateWorkspaceFoldersAndReload(e){const t=await this.toValidWorkspaceFolders(this.workspace.folders),{removed:i}=this.compareFolders(this.workspace.folders,t);i.length&&await this.updateWorkspaceConfiguration(t,this.workspaceConfiguration.getConfiguration(),e)}async toValidWorkspaceFolders(e){const t=[];for(const i of e){try{if(!(await this.fileService.stat(i.uri)).isDirectory)continue}catch(r){this.logService.warn(`Ignoring the error while validating workspace folder ${i.uri.toString()} - ${Dn(r)}`)}t.push(i)}return t}async writeConfigurationValue(e,t,i,r,n){if(!this.instantiationService)throw new Error("Cannot write configuration because the configuration service is not yet ready to accept writes.");if(i===C.DEFAULT)throw new Error("Invalid configuration target");if(i===C.MEMORY){const a={data:this._configuration.toData(),workspace:this.workspace};this._configuration.updateValue(e,t,r),this.triggerConfigurationChange({keys:r?.overrideIdentifiers?.length?[zn(r.overrideIdentifiers),e]:[e],overrides:r?.overrideIdentifiers?.length?r.overrideIdentifiers.map(l=>[l,[e]]):[]},a,i);return}const o=this.toEditableConfigurationTarget(i,e);if(!o)throw new Error("Invalid configuration target");if(o===R.USER_REMOTE&&!this.remoteUserConfiguration)throw new Error("Invalid configuration target");if(r?.overrideIdentifiers?.length&&r.overrideIdentifiers.length>1){const a=this.getConfigurationModelForEditableConfigurationTarget(o,r.resource);if(a){const l=r.overrideIdentifiers.sort(),d=a.overrides.find(f=>$c([...f.identifiers].sort(),l));d&&(r.overrideIdentifiers=d.identifiers)}}switch(this.configurationEditing=this.configurationEditing??this.createConfigurationEditingService(this.instantiationService),await(await this.configurationEditing).writeConfiguration(o,{key:e,value:t},{scopes:r,...n}),o){case R.USER_LOCAL:this.applicationConfiguration&&this.isSettingAppliedForAllProfiles(e)?await this.reloadApplicationConfiguration():await this.reloadLocalUserConfiguration();return;case R.USER_REMOTE:return this.reloadRemoteUserConfiguration().then(()=>{});case R.WORKSPACE:return this.reloadWorkspaceConfiguration();case R.WORKSPACE_FOLDER:{const a=r&&r.resource?this.workspace.getFolder(r.resource):null;if(a)return this.reloadWorkspaceFolderConfiguration(a)}}}async createConfigurationEditingService(e){const t=(await this.remoteAgentService.getEnvironment())?.settingsPath??null;return e.createInstance(Rr,t)}getConfigurationModelForEditableConfigurationTarget(e,t){switch(e){case R.USER_LOCAL:return this._configuration.localUserConfiguration;case R.USER_REMOTE:return this._configuration.remoteUserConfiguration;case R.WORKSPACE:return this._configuration.workspaceConfiguration;case R.WORKSPACE_FOLDER:return t?this._configuration.folderConfigurations.get(t):void 0}}getConfigurationModel(e,t){switch(e){case C.USER_LOCAL:return this._configuration.localUserConfiguration;case C.USER_REMOTE:return this._configuration.remoteUserConfiguration;case C.WORKSPACE:return this._configuration.workspaceConfiguration;case C.WORKSPACE_FOLDER:return t?this._configuration.folderConfigurations.get(t):void 0;default:return}}deriveConfigurationTargets(e,t,i){if(_e(t,i.value))return[];const r=[];return i.workspaceFolderValue!==void 0&&r.push(C.WORKSPACE_FOLDER),i.workspaceValue!==void 0&&r.push(C.WORKSPACE),i.userRemoteValue!==void 0&&r.push(C.USER_REMOTE),i.userLocalValue!==void 0&&r.push(C.USER_LOCAL),i.applicationValue!==void 0&&r.push(C.APPLICATION),t===void 0?r:[r[0]||C.USER]}triggerConfigurationChange(e,t,i){if(e.keys.length){i!==C.DEFAULT&&this.logService.debug(`Configuration keys changed in ${Yc(i)} target`,...e.keys);const r=new jc(e,t,this._configuration,this.workspace,this.logService);r.source=i,this._onDidChangeConfiguration.fire(r)}}toEditableConfigurationTarget(e,t){if(e===C.APPLICATION)return R.USER_LOCAL;if(e===C.USER){if(this.remoteUserConfiguration){const i=this.configurationRegistry.getConfigurationProperties()[t]?.scope;if(i===E.MACHINE||i===E.MACHINE_OVERRIDABLE||i===E.APPLICATION_MACHINE||this.inspect(t).userRemoteValue!==void 0)return R.USER_REMOTE}return R.USER_LOCAL}return e===C.USER_LOCAL?R.USER_LOCAL:e===C.USER_REMOTE?R.USER_REMOTE:e===C.WORKSPACE?R.WORKSPACE:e===C.WORKSPACE_FOLDER?R.WORKSPACE_FOLDER:null}}let _r=class extends D{constructor(e,t,i,r,n){super(),this.workspaceContextService=e,this.environmentService=t,this.workspaceTrustManagementService=i,r.whenInstalledExtensionsRegistered().then(()=>{this.registerConfigurationSchemas();const o=W.as(oe.Configuration),a=this._register(new Lc(50));this._register(H.any(o.onDidUpdateConfiguration,o.onDidSchemaChange,i.onDidChangeTrust)(()=>a.trigger(()=>this.registerConfigurationSchemas(),n.phase===je.Eventually?void 0:2500)))})}registerConfigurationSchemas(){const e={properties:ue.properties,patternProperties:ue.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},t=this.environmentService.remoteAuthority?{properties:Object.assign({},Nc.properties,Et.properties,rt.properties),patternProperties:ue.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}:e,i={properties:Object.assign({},Rs.properties,yt.properties,Et.properties,rt.properties),patternProperties:ue.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},r={properties:Object.assign({},Wc.properties,Rs.properties,yt.properties,Et.properties,rt.properties),patternProperties:ue.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},n={properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust(yt.properties),this.checkAndFilterPropertiesRequiringTrust(Et.properties),this.checkAndFilterPropertiesRequiringTrust(rt.properties)),patternProperties:ue.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},o={properties:Object.keys(ue.properties).reduce((d,f)=>(d[f]=Object.assign({deprecationMessage:void 0},ue.properties[f]),d),{}),patternProperties:Object.keys(ue.patternProperties).reduce((d,f)=>(d[f]=Object.assign({deprecationMessage:void 0},ue.patternProperties[f]),d),{}),additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},a=O.WORKSPACE===this.workspaceContextService.getWorkbenchState()?{properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust(yt.properties),this.checkAndFilterPropertiesRequiringTrust(rt.properties)),patternProperties:ue.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}:n,l={type:"object",description:c(12335,"Contribute defaults for configurations"),properties:Object.assign({},this.filterDefaultOverridableProperties(yt.properties),this.filterDefaultOverridableProperties(Et.properties),this.filterDefaultOverridableProperties(rt.properties)),patternProperties:{[Mc]:{type:"object",default:{},$ref:Uc}},additionalProperties:!1};this.registerSchemas({defaultSettingsSchema:o,userSettingsSchema:t,profileSettingsSchema:i,machineSettingsSchema:r,workspaceSettingsSchema:n,folderSettingsSchema:a,configDefaultsSchema:l})}registerSchemas(e){const t=W.as(Un.JSONContribution);t.registerSchema(wh,e.defaultSettingsSchema),t.registerSchema(Sh,e.userSettingsSchema),t.registerSchema(Ch,e.profileSettingsSchema),t.registerSchema(Eh,e.machineSettingsSchema),t.registerSchema(ko,e.workspaceSettingsSchema),t.registerSchema(yh,e.folderSettingsSchema),t.registerSchema(Bn,e.configDefaultsSchema)}checkAndFilterPropertiesRequiringTrust(e){if(this.workspaceTrustManagementService.isWorkspaceTrusted())return e;const t={};return Object.entries(e).forEach(([i,r])=>{r.restricted||(t[i]=r)}),t}filterDefaultOverridableProperties(e){const t={};return Object.entries(e).forEach(([i,r])=>{r.disallowConfigurationDefault||(t[i]=r)}),t}};_r=x([u(0,ie),u(1,Ae),u(2,jn),u(3,bi),u(4,xt)],_r);let Dr=class extends D{constructor(e,t){super(),e.hasCachedConfigurationDefaultsOverrides()&&t.whenInstalledExtensionsRegistered().then(()=>e.reloadConfiguration(C.DEFAULT))}};Dr=x([u(0,ve),u(1,bi)],Dr);let Ei=class extends D{static{this.ID="workbench.contrib.updateExperimentalSettingsDefaults"}constructor(e){super(),this.workbenchAssignmentService=e,this.processedExperimentalSettings=new Set,this.configurationRegistry=W.as(oe.Configuration),this.processExperimentalSettings(Object.keys(this.configurationRegistry.getConfigurationProperties())),this._register(this.configurationRegistry.onDidUpdateConfiguration(({properties:t})=>this.processExperimentalSettings(t)))}async processExperimentalSettings(e){const t={},i=this.configurationRegistry.getConfigurationProperties();for(const r of e){const n=i[r],o=n?.tags;if(!(!o||!o.some(a=>a.toLowerCase()==="onexp"))&&!this.processedExperimentalSettings.has(r)){this.processedExperimentalSettings.add(r);try{const a=await this.workbenchAssignmentService.getTreatment(`config.${r}`);!Vn(a)&&!_e(a,n.default)&&(t[r]=a)}catch{}}}Object.keys(t).length&&this.configurationRegistry.registerDefaultConfigurations([{overrides:t}])}};Ei=x([u(0,ol)],Ei);const No=W.as($r.Workbench);No.registerWorkbenchContribution(_r,je.Restored);No.registerWorkbenchContribution(Dr,je.Eventually);xc(Ei.ID,Ei,Pc.BlockRestore);const Bh=W.as(oe.Configuration);Bh.registerConfiguration({...kd,properties:{[be]:{type:"array",description:c(12336,"Configure settings to be applied for all profiles."),default:[],scope:E.APPLICATION,additionalProperties:!0,uniqueItems:!0}}});class Vh{constructor(e,t,i){this.donotCacheResourcesWithSchemes=e,this.fileService=i,this.cachedConfigurations=new Map,this.cacheHome=t.cacheHome}needsCaching(e){return!this.donotCacheResourcesWithSchemes.includes(e.scheme)}read(e){return this.getCachedConfiguration(e).read()}write(e,t){return this.getCachedConfiguration(e).save(t)}remove(e){return this.getCachedConfiguration(e).remove()}getCachedConfiguration({type:e,key:t}){const i=`${e}:${t}`;let r=this.cachedConfigurations.get(i);return r||(r=new Gh({type:e,key:t},this.cacheHome,this.fileService),this.cachedConfigurations.set(i,r)),r}}class Gh{constructor({type:e,key:t},i,r){this.fileService=r,this.cachedConfigurationFolderResource=j(i,"CachedConfigurations",e,t),this.cachedConfigurationFileResource=j(this.cachedConfigurationFolderResource,e==="workspaces"?"workspace.json":"configuration.json"),this.queue=new _i}async read(){try{return(await this.fileService.readFile(this.cachedConfigurationFileResource)).value.toString()}catch{return""}}async save(e){await this.createCachedFolder()&&await this.queue.queue(async()=>{await this.fileService.writeFile(this.cachedConfigurationFileResource,_.fromString(e))})}async remove(){try{await this.queue.queue(()=>this.fileService.del(this.cachedConfigurationFolderResource,{recursive:!0,useTrash:!1}))}catch(e){if(e.fileOperationResult!==L.FILE_NOT_FOUND)throw e}}async createCachedFolder(){if(await this.fileService.exists(this.cachedConfigurationFolderResource))return!0;try{return await this.fileService.createFolder(this.cachedConfigurationFolderResource),!0}catch{return!1}}}let br=class{constructor(e,t,i,r){this.configurationService=e,this.environmentService=i,this.storageService=r,this.remoteEnvironment=null,t.getEnvironment().then(n=>this.remoteEnvironment=n)}getEOL(e,t){const i=this.configurationService.getValue("files.eol",{overrideIdentifier:t,resource:e});if(i&&typeof i=="string"&&i!=="auto")return i;const r=this.getOS(e);return r===Yi.Linux||r===Yi.Macintosh?`
`:`\r
`}getOS(e){let t=bs;const i=this.environmentService.remoteAuthority;if(i&&e&&e.scheme!==k.file){const r=`resource.authority.os.${i}`;t=this.remoteEnvironment?this.remoteEnvironment.os:this.storageService.getNumber(r,Re.WORKSPACE,bs),this.storageService.store(r,t,Re.WORKSPACE,Yr.MACHINE)}return t}};br=x([u(0,ve),u(1,Ur),u(2,Ae),u(3,Ri)],br);let Fr=class extends D{constructor(e,t,i,r,n,o,a,l,d,f,h,g,S,w,m,N){super(),this.jsonEditingService=e,this.contextService=t,this.configurationService=i,this.notificationService=r,this.commandService=n,this.fileService=o,this.textFileService=a,this.workspacesService=l,this.environmentService=d,this.fileDialogService=f,this.dialogService=h,this.hostService=g,this.uriIdentityService=S,this.workspaceTrustManagementService=w,this.userDataProfilesService=m,this.userDataProfileService=N}async pickNewWorkspacePath(){const e=[k.file];this.environmentService.remoteAuthority&&e.unshift(k.vscodeRemote);let t=await this.fileDialogService.showSaveDialog({saveLabel:c(13230,"Save"),title:c(13231,"Save Workspace"),filters:Xc,defaultUri:j(await this.fileDialogService.defaultWorkspacePath(),this.getNewWorkspaceName()),availableFileSystems:e});if(t)return Kn(t)||(t=t.with({path:`${t.path}.${kt}`})),t}getNewWorkspaceName(){const e=this.getCurrentWorkspaceIdentifier()?.configPath;if(e&&Jc(e,this.environmentService))return ee(e);const t=this.contextService.getWorkspace().folders.at(0);return t?`${ee(t.uri)}.${kt}`:`workspace.${kt}`}async updateFolders(e,t,i,r){const n=this.contextService.getWorkspace().folders;let o=[];typeof t=="number"&&(o=n.slice(e,e+t).map(f=>f.uri));let a=[];Array.isArray(i)&&(a=i.map(f=>({uri:Fs(f.uri),name:f.name})));const l=o.length>0,d=a.length>0;if(!(!d&&!l))return d&&!l?this.doAddFolders(a,e,r):l&&!d?this.removeFolders(o):this.includesSingleFolderWorkspace(o)?this.createAndEnterWorkspace(a):this.contextService.getWorkbenchState()!==O.WORKSPACE?this.doAddFolders(a,e,r):this.doUpdateFolders(a,o,e,r)}async doUpdateFolders(e,t,i,r=!1){try{await this.contextService.updateFolders(e,t,i)}catch(n){if(r)throw n;this.handleWorkspaceConfigurationEditingError(n)}}addFolders(e,t=!1){const i=e.map(r=>({uri:Fs(r.uri),name:r.name}));return this.doAddFolders(i,void 0,t)}async doAddFolders(e,t,i=!1){const r=this.contextService.getWorkbenchState();if(r!==O.WORKSPACE){let n=this.contextService.getWorkspace().folders.map(o=>({uri:o.uri}));return n.splice(typeof t=="number"?t:n.length,0,...e),n=ai(n,o=>this.uriIdentityService.extUri.getComparisonKey(o.uri)),r===O.EMPTY&&n.length===0||r===O.FOLDER&&n.length===1?void 0:this.createAndEnterWorkspace(n)}try{await this.contextService.addFolders(e,t)}catch(n){if(i)throw n;this.handleWorkspaceConfigurationEditingError(n)}}async removeFolders(e,t=!1){if(this.includesSingleFolderWorkspace(e))return this.createAndEnterWorkspace([]);try{await this.contextService.removeFolders(e)}catch(i){if(t)throw i;this.handleWorkspaceConfigurationEditingError(i)}}includesSingleFolderWorkspace(e){if(this.contextService.getWorkbenchState()===O.FOLDER){const t=this.contextService.getWorkspace().folders[0];return e.some(i=>this.uriIdentityService.extUri.isEqual(i,t.uri))}return!1}async createAndEnterWorkspace(e,t){if(t&&!await this.isValidTargetWorkspacePath(t))return;const i=this.environmentService.remoteAuthority,r=await this.workspacesService.createUntitledWorkspace(e,i);if(t)try{await this.saveWorkspaceAs(r,t)}finally{await this.workspacesService.deleteUntitledWorkspace(r)}else t=r.configPath,this.userDataProfileService.currentProfile.isDefault||await this.userDataProfilesService.setProfileForWorkspace(r,this.userDataProfileService.currentProfile);return this.enterWorkspace(t)}async saveAndEnterWorkspace(e){const t=this.getCurrentWorkspaceIdentifier();if(t){if(Ye(t.configPath,e))return this.saveWorkspace(t);if(await this.isValidTargetWorkspacePath(e))return await this.saveWorkspaceAs(t,e),this.enterWorkspace(e)}}async isValidTargetWorkspacePath(e){return!0}async saveWorkspaceAs(e,t){const i=e.configPath;if(!Os(t,this.environmentService)&&!this.userDataProfileService.currentProfile.isDefault){const l=await this.workspacesService.getWorkspaceIdentifier(t);await this.userDataProfilesService.setProfileForWorkspace(l,this.userDataProfileService.currentProfile)}if(this.uriIdentityService.extUri.isEqual(i,t))return;const n=Os(i,this.environmentService),o=await this.fileService.readFile(i),a=on(o.value.toString(),i,n,t,this.uriIdentityService.extUri);await this.textFileService.create([{resource:t,value:a,options:{overwrite:!0}}]),await this.trustWorkspaceConfiguration(t)}async saveWorkspace(e){const t=e.configPath,i=this.textFileService.files.get(t);if(i){await i.save({force:!0,reason:ne.EXPLICIT});return}if(await this.fileService.exists(t))return;const o=on(JSON.stringify({folders:[]},null,"	"),t,!1,t,this.uriIdentityService.extUri);await this.textFileService.create([{resource:t,value:o}])}handleWorkspaceConfigurationEditingError(e){switch(e.code){case Qc.ERROR_INVALID_FILE:this.onInvalidWorkspaceConfigurationFileError();break;default:this.notificationService.error(e.message)}}onInvalidWorkspaceConfigurationFileError(){const e=c(13232,"Unable to write into workspace configuration file. Please open the file to correct errors/warnings in it and try again.");this.askToOpenWorkspaceConfigurationFile(e)}askToOpenWorkspaceConfigurationFile(e){this.notificationService.prompt(Me.Error,e,[{label:c(13233,"Open Workspace Configuration"),run:()=>this.commandService.executeCommand("workbench.action.openWorkspaceConfigFile")}])}async doEnterWorkspace(e){if(this.environmentService.extensionTestsLocationURI)throw new Error("Entering a new workspace is not possible in tests.");const t=await this.workspacesService.getWorkspaceIdentifier(e);return this.contextService.getWorkbenchState()===O.FOLDER&&await this.migrateWorkspaceSettings(t),await this.configurationService.initialize(t),this.workspacesService.enterWorkspace(e)}migrateWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e,t=>t.scope===E.WINDOW)}copyWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e)}doCopyWorkspaceSettings(e,t){const i=W.as(oe.Configuration).getConfigurationProperties(),r={};for(const n of this.configurationService.keys().workspace)if(i[n]){if(t&&!t(i[n]))continue;r[n]=this.configurationService.inspect(n).workspaceValue}return this.jsonEditingService.write(e.configPath,[{path:["settings"],value:r}],!0)}async trustWorkspaceConfiguration(e){this.contextService.getWorkbenchState()!==O.EMPTY&&this.workspaceTrustManagementService.isWorkspaceTrusted()&&await this.workspaceTrustManagementService.setUrisTrust([e],!0)}getCurrentWorkspaceIdentifier(){const e=Zc(this.contextService.getWorkspace());if(Qi(e))return e}};Fr=x([u(0,qn),u(1,ie),u(2,Lo),u(3,Bt),u(4,Xn),u(5,te),u(6,Ct),u(7,Jn),u(8,Ae),u(9,zr),u(10,Hr),u(11,qr),u(12,ke),u(13,jn),u(14,Di),u(15,Jr)],Fr);var at;let Or=class extends D{static{at=this}static{this.RECENTLY_OPENED_KEY="recently.opened"}constructor(e,t,i,r,n,o){super(),this.storageService=e,this.contextService=t,this.logService=i,this.fileService=r,this.environmentService=n,this.uriIdentityService=o,this._onRecentlyOpenedChange=this._register(new v),this.onDidChangeRecentlyOpened=this._onRecentlyOpenedChange.event,this.addWorkspaceToRecentlyOpened(),this.registerListeners()}registerListeners(){this._register(this.storageService.onDidChangeValue(Re.APPLICATION,at.RECENTLY_OPENED_KEY,this._store)(()=>this._onRecentlyOpenedChange.fire())),this._register(this.contextService.onDidChangeWorkspaceFolders(e=>this.onDidChangeWorkspaceFolders(e)))}onDidChangeWorkspaceFolders(e){if(Yt(this.contextService.getWorkspace()))for(const t of e.added)this.addRecentlyOpened([{folderUri:t.uri}])}addWorkspaceToRecentlyOpened(){const e=this.contextService.getWorkspace(),t=this.environmentService.remoteAuthority;switch(this.contextService.getWorkbenchState()){case O.FOLDER:this.addRecentlyOpened([{folderUri:e.folders[0].uri,remoteAuthority:t}]);break;case O.WORKSPACE:this.addRecentlyOpened([{workspace:{id:e.id,configPath:e.configuration},remoteAuthority:t}]);break}}async getRecentlyOpened(){const e=this.storageService.get(at.RECENTLY_OPENED_KEY,Re.APPLICATION);if(e){const t=gh(JSON.parse(e),this.logService);return t.workspaces=t.workspaces.filter(i=>!(Zt(i)&&i.folderUri.scheme===k.file&&!Yt(this.contextService.getWorkspace())||ch(i)&&Yt(i.workspace.configPath))),t}return{workspaces:[],files:[]}}async addRecentlyOpened(e){const t=await this.getRecentlyOpened();for(const i of e)lh(i)?(this.doRemoveRecentlyOpened(t,[i.fileUri]),t.files.unshift(i)):Zt(i)?(this.doRemoveRecentlyOpened(t,[i.folderUri]),t.workspaces.unshift(i)):(this.doRemoveRecentlyOpened(t,[i.workspace.configPath]),t.workspaces.unshift(i));return this.saveRecentlyOpened(t)}async removeRecentlyOpened(e){const t=await this.getRecentlyOpened();return this.doRemoveRecentlyOpened(t,e),this.saveRecentlyOpened(t)}doRemoveRecentlyOpened(e,t){e.files=e.files.filter(i=>!t.some(r=>r.toString()===i.fileUri.toString())),e.workspaces=e.workspaces.filter(i=>!t.some(r=>r.toString()===(Zt(i)?i.folderUri.toString():i.workspace.configPath.toString())))}async saveRecentlyOpened(e){return this.storageService.store(at.RECENTLY_OPENED_KEY,JSON.stringify(ph(e)),Re.APPLICATION,Yr.USER)}async clearRecentlyOpened(){this.storageService.remove(at.RECENTLY_OPENED_KEY,Re.APPLICATION)}async enterWorkspace(e){return{workspace:await this.getWorkspaceIdentifier(e)}}async createUntitledWorkspace(e,t){const i=(Date.now()+Math.round(Math.random()*1e3)).toString(),r=j(this.environmentService.untitledWorkspacesHome,`Untitled-${i}.${kt}`),n=[];if(e)for(const a of e)n.push(ts(a.uri,!0,a.name,this.environmentService.untitledWorkspacesHome,this.uriIdentityService.extUri));const o={folders:n,remoteAuthority:t};return await this.fileService.writeFile(r,_.fromString(JSON.stringify(o,null,"	"))),this.getWorkspaceIdentifier(r)}async deleteUntitledWorkspace(e){try{await this.fileService.del(e.configPath)}catch(t){if(t.fileOperationResult!==L.FILE_NOT_FOUND)throw t}}async getWorkspaceIdentifier(e){return el(e)}async getDirtyWorkspaces(){return[]}};Or=at=x([u(0,Ri),u(1,ie),u(2,Ge),u(3,te),u(4,Ae),u(5,ke)],Or);const hn="configResolveInputLru",Kh=5;class Hh extends Id{static{this.INPUT_OR_COMMAND_VARIABLES_PATTERN=/\${((input|command):(.*?))}/g}constructor(e,t,i,r,n,o,a,l,d,f,h){super({getFolderUri:g=>{const S=o.getWorkspace().folders.filter(w=>w.name===g).pop();return S?S.uri:void 0},getWorkspaceFolderCount:()=>o.getWorkspace().folders.length,getConfigurationValue:(g,S)=>r.getValue(S,g?{resource:g}:{}),getAppRoot:()=>e.getAppRoot(),getExecPath:()=>e.getExecPath(),getFilePath:()=>{const g=Je.getOriginalUri(i.activeEditor,{supportSideBySide:le.PRIMARY,filterByScheme:[k.file,k.vscodeUserData,this.pathService.defaultUriScheme]});if(g)return this.labelService.getUriLabel(g,{noPrefix:!0})},getWorkspaceFolderPathForFile:()=>{const g=Je.getOriginalUri(i.activeEditor,{supportSideBySide:le.PRIMARY,filterByScheme:[k.file,k.vscodeUserData,this.pathService.defaultUriScheme]});if(!g)return;const S=o.getWorkspaceFolder(g);if(S)return this.labelService.getUriLabel(S.uri,{noPrefix:!0})},getSelectedText:()=>{const g=i.activeTextEditorControl;let S=null;if(gt(g))S=g;else if(Qr(g)){const N=g.getOriginalEditor(),De=g.getModifiedEditor();S=N.hasWidgetFocus()?N:De}const w=S?.getModel(),m=S?.getSelection();if(w&&m)return w.getValueInRange(m)},getLineNumber:()=>{const g=i.activeTextEditorControl;if(gt(g)){const S=g.getSelection();if(S){const w=S.positionLineNumber;return String(w)}}},getColumnNumber:()=>{const g=i.activeTextEditorControl;if(gt(g)){const S=g.getSelection();if(S){const w=S.positionColumn;return String(w)}}},getExtension:g=>f.getExtension(g)},l,d.userHome().then(g=>g.path),t),this.configurationService=r,this.commandService=n,this.quickInputService=a,this.labelService=l,this.pathService=d,this.storageService=h,this.userInputAccessQueue=new _i,this.resolvableVariables.add("command"),this.resolvableVariables.add("input")}async resolveWithInteractionReplace(e,t,i,r,n){const o=et.parse(t);return await this.resolveWithInteraction(e,o,i,r,n),o.toObject()}async resolveWithInteraction(e,t,i,r,n){const o=et.parse(t);for(const a of o.unresolved()){let l;if(a.name==="command"){const d=(r?r[a.arg]:void 0)||a.arg,f=await this.commandService.executeCommand(d,o.toObject());if(!ii(f)){if(typeof f!="string")throw new M(F.Command,c(12380,"Cannot substitute command variable '{0}' because command did not return a result of type string.",d));l={value:f}}}else if(a.name==="input")l=await this.showUserInput(i,a.arg,await this.resolveInputs(e,i,n),r);else if(this._contributedVariables.has(a.inner))l={value:await this._contributedVariables.get(a.inner)()};else{const d=await this.evaluateSingleVariable(a,e?.uri);if(d===void 0)continue;l=typeof d=="string"?{value:d}:d}if(l===void 0)return;o.resolve(a,l)}return new Map(ct.map(o.resolved(),([a,l])=>[a.inner,l.value]))}async resolveInputs(e,t,i){if(!t)return;let r;const n=e?{resource:e.uri}:{},o=this.configurationService.inspect(t,n);if(o)switch(i){case C.MEMORY:r=o.memoryValue?.inputs;break;case C.DEFAULT:r=o.defaultValue?.inputs;break;case C.USER:r=o.userValue?.inputs;break;case C.USER_LOCAL:r=o.userLocalValue?.inputs;break;case C.USER_REMOTE:r=o.userRemoteValue?.inputs;break;case C.APPLICATION:r=o.applicationValue?.inputs;break;case C.WORKSPACE:r=o.workspaceValue?.inputs;break;case C.WORKSPACE_FOLDER:default:r=o.workspaceFolderValue?.inputs;break}return r??=this.configurationService.getValue(t,n)?.inputs,r}readInputLru(){const e=this.storageService.get(hn,Re.WORKSPACE),t=new kn(Kh);try{e&&t.fromJSON(JSON.parse(e))}catch{}return t}storeInputLru(e){this.storageService.store(hn,JSON.stringify(e.toJSON()),Re.WORKSPACE,Yr.MACHINE)}async showUserInput(e,t,i,r){if(!i)throw new M(F.Input,c(12381,"Variable '{0}' must be defined in an '{1}' section of the debug or task configuration.",t,"inputs"));const n=i.filter(o=>o.id===t).pop();if(n){const o=f=>{throw new M(F.Input,c(12382,"Input variable '{0}' is of type '{1}' and must include '{2}'.",t,n.type,f))},a=this.readInputLru(),l=`${e}.${t}`,d=a.get(l);switch(n.type){case"promptString":{xe(n.description)||o("description");const f={prompt:n.description,ignoreFocusLost:!0,value:r?.[`input:${t}`]??d??n.default};return n.password&&(f.password=n.password),this.userInputAccessQueue.queue(()=>this.quickInputService.input(f)).then(h=>(typeof h=="string"&&this.storeInputLru(a.set(l,h)),h!==void 0?{value:h,input:n}:void 0))}case"pickString":{if(xe(n.description)||o("description"),Array.isArray(n.options))for(const g of n.options)!xe(g)&&!xe(g.value)&&o("value");else o("options");const f=new Array;for(const g of n.options){const S=xe(g)?g:g.value,w=xe(g)?void 0:g.label,m={label:w?`${w}: ${S}`:S,value:S},N=r?.[`input:${t}`]??d??n.default;S===n.default?(m.description=c(12383,"(Default)"),f.unshift(m)):S===N?f.unshift(m):f.push(m)}const h={placeHolder:n.description,matchOnDetail:!0,ignoreFocusLost:!0};return this.userInputAccessQueue.queue(()=>this.quickInputService.pick(f,h,void 0)).then(g=>{if(g){const S=g.value;return this.storeInputLru(a.set(l,S)),{value:S,input:n}}})}case"command":return xe(n.command)||o("command"),this.userInputAccessQueue.queue(()=>this.commandService.executeCommand(n.command,n.args)).then(f=>{if(typeof f=="string"||ii(f))return{value:f,input:n};throw new M(F.Input,c(12384,"Cannot substitute input variable '{0}' because command '{1}' did not return a result of type string.",t,n.command))});default:throw new M(F.Input,c(12385,"Input variable '{0}' can only be of type 'promptString', 'pickString', or 'command'.",t))}}throw new M(F.Input,c(12386,"Undefined input variable '{0}' encountered. Remove or define '{0}' to continue.",t))}}let Ir=class extends Hh{constructor(e,t,i,r,n,o,a,l,d){super({getAppRoot:()=>{},getExecPath:()=>{}},Promise.resolve(Object.create(null)),e,t,i,r,n,o,a,l,d)}};Ir=x([u(0,yi),u(1,ve),u(2,Xn),u(3,ie),u(4,Gn),u(5,Gr),u(6,mi),u(7,bi),u(8,Ri)],Ir);const zh=K.from({scheme:k.vscodeUserData,path:"/User/settings.json"});async function cg(s,e,t=zh){await th(t,s,e)}W.as(oe.Configuration);let kr=class extends Mh{constructor(e,t,i,r,n,o,a,l){const d=new Vh([k.file,k.vscodeUserData,k.tmp],e,r);super({configurationCache:d},e,t,i,r,n,o,a,l)}};kr=x([u(0,Ae),u(1,Jr),u(2,Di),u(3,te),u(4,Ur),u(5,ke),u(6,Ge),u(7,tl)],kr);class $h extends Fr{constructor(){super(...arguments),this.enterWorkspace=Rl}}let Wo;po(async s=>{const e=s.get(ie);e.acquireInstantiationService(s.get(vt));const t=Wo??rl();if(K.isUri(t)){const i=t.with({path:"/workspace.code-workspace"});try{const r=s.get(te);await r.createFolder(t),await r.writeFile(i,_.fromString(JSON.stringify({folders:[{path:t.path}]})))}catch{}await e.initialize({id:sl(),configPath:i})}else await e.initialize(t)});const un=Dl(kr);function dg(s){return Wo=s,{...eh(),[ve.toString()]:new ae(un,[],!0),[ie.toString()]:new ae(un,[],!0),[St.toString()]:new ae(yr,[],!0),[ml.toString()]:new ae($h,[],!0),[Jn.toString()]:new ae(Or,[],!0),[il.toString()]:new ae(br,[],!0),[al.toString()]:new ae(Ir,[],!0)}}export{Wt as $,Er as A,Of as B,Gs as C,cl as D,di as E,kf as F,Ns as G,If as H,bi as I,Vd as J,lt as K,eu as L,Hs as M,nl as N,Ks as O,nf as P,xd as Q,tr as R,ne as S,rh as T,ze as U,Zi as V,We as W,Bu as X,ed as Y,Ml as Z,td as _,du as a,ao as a$,Zh as a0,tu as a1,Ls as a2,Bs as a3,Je as a4,le as a5,jt as a6,As as a7,Mi as a8,Kt as a9,yu as aA,bu as aB,ku as aC,en as aD,Tf as aE,tn as aF,Vl as aG,Af as aH,Tl as aI,_u as aJ,jf as aK,J as aL,qf as aM,ah as aN,rr as aO,sn as aP,Fo as aQ,kl as aR,Ol as aS,Al as aT,Il as aU,X as aV,Us as aW,Nu as aX,Lu as aY,Zl as aZ,id as a_,q as aa,ul as ab,Qn as ac,qh as ad,Qh as ae,ks as af,Ts as ag,Is as ah,Bd as ai,Jh as aj,Xh as ak,iu as al,li as am,Sl as an,Ou as ao,Iu as ap,Ru as aq,nu as ar,su as as,Ws as at,Nt as au,Gl as av,$l as aw,Ps as ax,ru as ay,zl as az,vl as b,od as b$,ce as b0,Fu as b1,Bl as b2,Ms as b3,of as b4,xs as b5,cu as b6,Su as b7,Cu as b8,Eu as b9,Ul as bA,Nl as bB,bo as bC,Wu as bD,Vf as bE,Lf as bF,sh as bG,zf as bH,nh as bI,sr as bJ,wl as bK,er as bL,oo as bM,qu as bN,Sf as bO,et as bP,pu as bQ,Ys as bR,js as bS,gi as bT,Sr as bU,Td as bV,qs as bW,Zu as bX,fi as bY,nd as bZ,Y as b_,Qu as ba,ou as bb,dt as bc,wu as bd,Au as be,Tu as bf,xu as bg,Pu as bh,mu as bi,Du as bj,Bf as bk,oh as bl,ui as bm,Yf as bn,$f as bo,xf as bp,Gf as bq,Kf as br,Hf as bs,Wf as bt,Pf as bu,Mf as bv,Uf as bw,Gd as bx,xl as by,Nf as bz,Qr as c,sd as c0,rd as c1,vu as c2,Ot as c3,ql as c4,Jl as c5,jl as c6,Qs as c7,Zt as c8,ch as c9,Ef as cA,pe as cB,Mu as cC,Vu as cD,_f as cE,Uu as cF,Yu as cG,ju as cH,zu as cI,$u as cJ,fl as cK,vr as cL,hl as cM,Xu as cN,Lo as cO,af as cP,Ne as cQ,Ql as cR,Xf as cS,lu as cT,He as cU,Yd as ca,Cf as cb,au as cc,ho as cd,jd as ce,qd as cf,eh as cg,Ff as ch,gd as ci,G as cj,pd as ck,bd as cl,Id as cm,bf as cn,Md as co,dr as cp,lr as cq,cg as cr,dg as cs,Fi as ct,Df as cu,Ku as cv,Gu as cw,Hu as cx,mf as cy,yf as cz,Fl as d,El as e,Cl as f,gu as g,qr as h,gt as i,Xr as j,Jr as k,yl as l,Di as m,al as n,ml as o,eo as p,to as q,jr as r,Jn as s,ol as t,uu as u,hu as v,Rl as w,Pl as x,kd as y,fu as z};

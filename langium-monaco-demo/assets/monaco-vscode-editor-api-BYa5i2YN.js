import{ed as ki,ee as V,c as ya,dh as vf,ef as bf,eg as Sf,eh as oi,ei as Sl,bt as vt,ej as Br,ek as yf,_ as ge,o as P,$ as Gi,r as At,D as U,a5 as Z,b0 as xa,el as Eo,t as ke,em as xf,b7 as Nf,en as Ef,eo as nt,ep as If,eq as Lu,er as Kt,es as Io,et as Ne,eu as Td,E as mi,ev as Rf,ew as st,ex as v,ey as Vt,ez as Ir,eA as xc,H as Fi,eB as Na,b2 as ji,eC as Df,eD as Xi,eE as vu,eF as hn,eG as Nc,cX as Ro,eH as cr,dX as Do,eI as bu,eJ as To,eK as Tf,eL as Su,ci as Y,cj as mt,eM as Xn,eN as yu,eO as zn,cz as Ei,eP as Mf,h as Ot,eQ as Af,eR as Of,eS as Jt,eT as Pf,eU as yl,dp as N,eV as Ii,l as O,eW as zi,eX as Qo,eY as Jo,eZ as Yn,e_ as fe,e$ as fo,c0 as kf,J as Ea,f0 as We,cT as I,f1 as Mo,f2 as Ie,f3 as Wf,dr as le,f4 as Wn,f5 as Vf,f6 as Md,f7 as Ff,f8 as xu,f9 as Hf,fa as et,fb as hr,fc as ur,fd as ls,fe as Ao,T as js,W as Qn,d1 as pi,dl as Nu,ff as Oo,fg as Jn,fh as mn,fi as Ad,fj as $e,fk as q,fl as k,fm as M,fn as T,fo as Bf,fp as K,fq as zf,cH as Zt,fr as Uf,fs as Gf,ft as qe,fu as Ia,bD as zt,fv as zr,cq as jf,fw as Kf,fx as $f,fy as Zf,fz as qf,fA as Xf,fB as Ec,G as Ra,fC as xl,fD as Nl,aP as er,aZ as Ms,fE as Ur,a2 as Ic,fF as jt,fG as Yf,fH as Qf,fI as Jf,aV as tr,fJ as Eu,fK as em,fL as tm,fM as Od,fN as Hi,fO as ir,fP as Fe,fQ as Ee,fR as im,fS as Ks,fT as nm,fU as Rc,fV as El,fW as Iu,fX as nr,fY as As,fZ as sm,f_ as om,f$ as rm,g0 as am,g1 as lm,g2 as dm,g3 as cm,g4 as hm,g5 as um,g6 as gm,g7 as fm,g8 as mm,g9 as pm,ga as _m,gb as Cm,gc as wm,gd as Lm,ge as vm,gf as Os,gg as bm,gh as Sm,gi as ym,gj as xm,gk as Nm,gl as Em,gm as Im,gn as Rm,go as Dm,gp as Tm,gq as Mm,gr as Am,gs as Om,gt as Ya,gu as Il,gv as fs,gw as Pm,gx as km,gy as Ye,gz as Ui,gA as Ru,gB as Rl,gC as Wm,bN as Vm,gD as Fm,gE as Hm,gF as Bm,gG as co,gH as zm,gI as Dc,gJ as Ti,gK as Rr,gL as Um,gM as _i,gN as Gm,gO as Du,gP as Tu,gQ as Mu,gR as jm,gS as Km,b6 as $m,gT as ei,gU as Tc,gV as Zm,gW as qm,gX as di,gY as Xm,gZ as Ym,g_ as Qm,g$ as Jm,h0 as ep,h1 as Qa,h2 as Dl,cm as De,h3 as Da,aR as tp,h4 as sr,h5 as Wt,I as Me,aJ as Po,h6 as ip,bk as Pd,h7 as bs,h8 as np,h9 as sp,b as Au,ha as J,hb as Dr,bo as is,hc as ce,hd as Ct,he as wi,d$ as op,hf as rp,hg as Mc,hh as ms,hi as Ac,hj as Oc,hk as Ou,hl as Pu,hm as ap,hn as lp,cl as Pc,ho as dp,hp as Gr,a as ku,hq as Un,hr as Ps,hs as cp,dU as gr,ht as hp,hu as Oe,hv as up,hw as Gn,hx as gp,hy as fp,hz as Zi,hA as Wu,hB as mp,hC as pp,hD as Tl,hE as Vu,hF as jr,hG as _p,hH as Pe,hI as kc,hJ as Ja,hK as Cp,hL as wp,hM as Lp,d9 as an,hN as $s,p as ot,hO as Tr,hP as vp,f as kd,aK as Fu,e1 as Zs,hQ as Ce,S as Wc,hR as bp,hS as io,hT as Sp,hU as yp,hV as xp,hW as Np,hX as Ep,hY as Re,hZ as el,h_ as fr,h$ as Vc,i0 as Mr,i1 as Wd,i2 as z,i3 as Kr,i4 as Vd,i5 as ii,g as Hu,C as Ta,i6 as Ip,i7 as Fc,i8 as $r,i9 as qt,ia as Ss,ib as Bu,ic as Rp,id as Dp,ie as Fd,ig as Hc,ih as ut,bw as It,ii as Tp,ij as Hd,ik as Ma,il as Aa,im as tl,io as Ar,B as zu,ip as Bc,iq as il,ir as Mp,d as Or,is as Uu,it as Ap,iu as Op,iv as Pp,iw as kp,ix as Wp,iy as Oa,iz as Ci,iA as He,iB as Ml,iC as Al,iD as Ki,iE as qs,iF as or,iG as Gu,iH as Vp,iI as ys,iJ as ju,iK as Ve,iL as Fp,iM as mo,iN as $i,bn as zc,iO as mr,iP as Uc,iQ as Bd,iR as Gc,iS as zd,iT as Hp,iU as Bp,iV as zp,iW as Ku,iX as Up,iY as Ud,iZ as ae,i_ as Gp,i$ as Gd,j0 as jp,j1 as Kp,j2 as $p,j3 as Zp,j4 as qp,j5 as Xp,j6 as Yp,j7 as Qp,j8 as Jp,j9 as e_,ja as t_,jb as i_,jc,jd as n_,je as at,jf as ds,jg as Kc,jh as s_,ji as o_,jj as r_,jk as a_,jl as bi,jm as l_,cu as $u,jn as d_,c$ as c_,jo as h_,jp as u_,jq as Ol,jr as Zu,js as qu,s as Di,jt as g_,ju as f_,jv as m_,jw as $c,jx as Zc,jy as p_,jz as __,jA as C_,jB as w_,jC as Xu,jD as Pa,dB as L_,jE as v_,jF as b_,jG as ns,jH as rt,jI as S_,jJ as Gt,da as tt,jK as pn,U as Xs,jL as qc,aO as ka,jM as y_,jN as x_,jO as Yu,jP as N_,jQ as Pl,jR as kl,jS as Qu,jT as E_,jU as jd,jV as I_,cw as Ju,jW as vi,jX as R_,jY as rr,ct as D_,cv as T_,jZ as eg,j_ as M_,j$ as Zr,k0 as A_,k1 as O_,k2 as P_,k3 as ho,k4 as k_,k5 as W_,k6 as V_,k7 as F_,k8 as H_,k9 as B_,ka as z_,kb as U_,kc as G_,kd as j_,ke as K_,kf as $_,kg as Z_,kh as q_,ki as X_,kj as Y_,kk as Q_,kl as J_,km as eC,kn as tC,ko as iC,kp as nC,kq as sC,kr as oC,ks as rC,kt as aC,ku as lC,kv as dC,kw as cC,cs as B,kx as hC,bV as ar,ky as uC,kz as gC,kA as fC,kB as mC,kC as pC,kD as _C,kE as CC,kF as wC,kG as LC,kH as vC,kI as bC,kJ as SC,kK as yC,kL as xC,kM as NC,kN as EC,kO as IC,kP as RC,kQ as DC,kR as TC,kS as tg,dq as Xc,kT as xs,dm as Wa,kU as lr,kV as ig,kW as MC,kX as AC,kY as OC,kZ as PC,b8 as ng,k_ as sg,V as kC,d5 as WC,cG as Yc,k$ as VC,q as FC}from"./monaco-vscode-base-service-override-BYqBQsid.js";import{M as ee,C as bn,O as Cn,i as ks,R as HC}from"./monaco-vscode-configuration-service-override-DGcvGpAH.js";import{g as og,w as rg}from"./monaco-vscode-api-DkhVdw0_.js";var Ke;(function(a){a[a.None=0]="None",a[a.Indent=1]="Indent",a[a.IndentOutdent=2]="IndentOutdent",a[a.Outdent=3]="Outdent"})(Ke||(Ke={}));class nl{constructor(e){if(this._neutralCharacter=null,this._neutralCharacterSearched=!1,this.open=e.open,this.close=e.close,this._inString=!0,this._inComment=!0,this._inRegEx=!0,Array.isArray(e.notIn))for(let t=0,i=e.notIn.length;t<i;t++)switch(e.notIn[t]){case"string":this._inString=!1;break;case"comment":this._inComment=!1;break;case"regex":this._inRegEx=!1;break}}isOK(e){switch(e){case ki.Other:return!0;case ki.Comment:return this._inComment;case ki.String:return this._inString;case ki.RegEx:return this._inRegEx}}shouldAutoClose(e,t){if(e.getTokenCount()===0)return!0;const i=e.findTokenIndexAtOffset(t-2),n=e.getStandardTokenType(i);return this.isOK(n)}_findNeutralCharacterInRange(e,t){for(let i=e;i<=t;i++){const n=String.fromCharCode(i);if(!this.open.includes(n)&&!this.close.includes(n))return n}return null}findNeutralCharacter(){return this._neutralCharacterSearched||(this._neutralCharacterSearched=!0,this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(V.Digit0,V.Digit9)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(V.a,V.z)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(V.A,V.Z))),this._neutralCharacter}}class BC{constructor(e){this.autoClosingPairsOpenByStart=new Map,this.autoClosingPairsOpenByEnd=new Map,this.autoClosingPairsCloseByStart=new Map,this.autoClosingPairsCloseByEnd=new Map,this.autoClosingPairsCloseSingleChar=new Map;for(const t of e)no(this.autoClosingPairsOpenByStart,t.open.charAt(0),t),no(this.autoClosingPairsOpenByEnd,t.open.charAt(t.open.length-1),t),no(this.autoClosingPairsCloseByStart,t.close.charAt(0),t),no(this.autoClosingPairsCloseByEnd,t.close.charAt(t.close.length-1),t),t.close.length===1&&t.open.length===1&&no(this.autoClosingPairsCloseSingleChar,t.close,t)}}function no(a,e,t){a.has(e)?a.get(e).push(t):a.set(e,[t])}const zC=ya("IActionViewItemService");class qr{static{this.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES=`;:.,=}])> 
	`}static{this.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS=`'"\`;:.,=}])> 
	`}static{this.DEFAULT_AUTOCLOSE_BEFORE_WHITESPACE=` 
	`}constructor(e){if(e.autoClosingPairs?this._autoClosingPairs=e.autoClosingPairs.map(t=>new nl(t)):e.brackets?this._autoClosingPairs=e.brackets.map(t=>new nl({open:t[0],close:t[1]})):this._autoClosingPairs=[],e.__electricCharacterSupport&&e.__electricCharacterSupport.docComment){const t=e.__electricCharacterSupport.docComment;this._autoClosingPairs.push(new nl({open:t.open,close:t.close||""}))}this._autoCloseBeforeForQuotes=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:qr.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES,this._autoCloseBeforeForBrackets=typeof e.autoCloseBefore=="string"?e.autoCloseBefore:qr.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS,this._surroundingPairs=e.surroundingPairs||this._autoClosingPairs}getAutoClosingPairs(){return this._autoClosingPairs}getAutoCloseBeforeSet(e){return e?this._autoCloseBeforeForQuotes:this._autoCloseBeforeForBrackets}getSurroundingPairs(){return this._surroundingPairs}}class UC{constructor(e){this._richEditBrackets=e}getElectricCharacters(){const e=[];if(this._richEditBrackets)for(const t of this._richEditBrackets.brackets)for(const i of t.close){const n=i.charAt(i.length-1);e.push(n)}return vf(e)}onElectricCharacter(e,t,i){if(!this._richEditBrackets||this._richEditBrackets.brackets.length===0)return null;const n=t.findTokenIndexAtOffset(i-1);if(bf(t.getStandardTokenType(n)))return null;const s=this._richEditBrackets.reversedRegex,o=t.getLineContent().substring(0,i-1)+e,r=Sf.findPrevBracketInRange(s,1,o,0,o.length);if(!r)return null;const l=o.substring(r.startColumn-1,r.endColumn-1).toLowerCase();if(this._richEditBrackets.textIsOpenBracket[l])return null;const c=t.getActualLineContentBefore(r.startColumn-1);return/^\s*$/.test(c)?{matchOpenBracket:l}:null}}var Wi;(function(a){a[a.INCREASE_MASK=1]="INCREASE_MASK",a[a.DECREASE_MASK=2]="DECREASE_MASK",a[a.INDENT_NEXTLINE_MASK=4]="INDENT_NEXTLINE_MASK",a[a.UNINDENT_MASK=8]="UNINDENT_MASK"})(Wi||(Wi={}));function pr(a){return a.global&&(a.lastIndex=0),!0}class GC{constructor(e){this._indentationRules=e}shouldIncrease(e){return!!(this._indentationRules&&this._indentationRules.increaseIndentPattern&&pr(this._indentationRules.increaseIndentPattern)&&this._indentationRules.increaseIndentPattern.test(e))}shouldDecrease(e){return!!(this._indentationRules&&this._indentationRules.decreaseIndentPattern&&pr(this._indentationRules.decreaseIndentPattern)&&this._indentationRules.decreaseIndentPattern.test(e))}shouldIndentNextLine(e){return!!(this._indentationRules&&this._indentationRules.indentNextLinePattern&&pr(this._indentationRules.indentNextLinePattern)&&this._indentationRules.indentNextLinePattern.test(e))}shouldIgnore(e){return!!(this._indentationRules&&this._indentationRules.unIndentedLinePattern&&pr(this._indentationRules.unIndentedLinePattern)&&this._indentationRules.unIndentedLinePattern.test(e))}getIndentMetadata(e){let t=0;return this.shouldIncrease(e)&&(t+=Wi.INCREASE_MASK),this.shouldDecrease(e)&&(t+=Wi.DECREASE_MASK),this.shouldIndentNextLine(e)&&(t+=Wi.INDENT_NEXTLINE_MASK),this.shouldIgnore(e)&&(t+=Wi.UNINDENT_MASK),t}}class ps{constructor(e){e=e||{},e.brackets=e.brackets||[["(",")"],["{","}"],["[","]"]],this._brackets=[],e.brackets.forEach(t=>{const i=ps._createOpenBracketRegExp(t[0]),n=ps._createCloseBracketRegExp(t[1]);i&&n&&this._brackets.push({open:t[0],openRegExp:i,close:t[1],closeRegExp:n})}),this._regExpRules=e.onEnterRules||[]}onEnter(e,t,i,n){if(e>=oi.Advanced)for(let s=0,o=this._regExpRules.length;s<o;s++){const r=this._regExpRules[s];if([{reg:r.beforeText,text:i},{reg:r.afterText,text:n},{reg:r.previousLineText,text:t}].every(d=>d.reg?(d.reg.lastIndex=0,d.reg.test(d.text)):!0))return r.action}if(e>=oi.Brackets&&i.length>0&&n.length>0)for(let s=0,o=this._brackets.length;s<o;s++){const r=this._brackets[s];if(r.openRegExp.test(i)&&r.closeRegExp.test(n))return{indentAction:Ke.IndentOutdent}}if(e>=oi.Brackets&&i.length>0){for(let s=0,o=this._brackets.length;s<o;s++)if(this._brackets[s].openRegExp.test(i))return{indentAction:Ke.Indent}}return null}static _createOpenBracketRegExp(e){let t=Sl(e);return/\B/.test(t.charAt(0))||(t="\\b"+t),t+="\\s*$",ps._safeRegExp(t)}static _createCloseBracketRegExp(e){let t=Sl(e);return/\B/.test(t.charAt(t.length-1))||(t=t+"\\b"),t="^\\s*"+t,ps._safeRegExp(t)}static _safeRegExp(e){try{return new RegExp(e)}catch(t){return vt(t),null}}}class jC{constructor(e,t){this.languageId=e;const i=t.brackets?Qc(t.brackets):[],n=new Br(r=>{const l=new Set;return{info:new KC(this,r,l),closing:l}}),s=new Br(r=>{const l=new Set,d=new Set;return{info:new $C(this,r,l,d),opening:l,openingColorized:d}});for(const[r,l]of i){const d=n.get(r),c=s.get(l);d.closing.add(c.info),c.opening.add(d.info)}const o=t.colorizedBracketPairs?Qc(t.colorizedBracketPairs):i.filter(r=>!(r[0]==="<"&&r[1]===">"));for(const[r,l]of o){const d=n.get(r),c=s.get(l);d.closing.add(c.info),c.openingColorized.add(d.info),c.opening.add(d.info)}this._openingBrackets=new Map([...n.cachedValues].map(([r,l])=>[r,l.info])),this._closingBrackets=new Map([...s.cachedValues].map(([r,l])=>[r,l.info]))}get openingBrackets(){return[...this._openingBrackets.values()]}get closingBrackets(){return[...this._closingBrackets.values()]}getOpeningBracketInfo(e){return this._openingBrackets.get(e)}getClosingBracketInfo(e){return this._closingBrackets.get(e)}getBracketInfo(e){return this.getOpeningBracketInfo(e)||this.getClosingBracketInfo(e)}getBracketRegExp(e){const t=Array.from([...this._openingBrackets.keys(),...this._closingBrackets.keys()]);return yf(t,e)}}function Qc(a){return a.filter(([e,t])=>e!==""&&t!=="")}class ag{constructor(e,t){this.config=e,this.bracketText=t}get languageId(){return this.config.languageId}}class KC extends ag{constructor(e,t,i){super(e,t),this.openedBrackets=i,this.isOpeningBracket=!0}}class $C extends ag{constructor(e,t,i,n){super(e,t),this.openingBrackets=i,this.openingColorizedBrackets=n,this.isOpeningBracket=!1}closes(e){return e.config!==this.config?!1:this.openingBrackets.has(e)}closesColorized(e){return e.config!==this.config?!1:this.openingColorizedBrackets.has(e)}getOpeningBrackets(){return[...this.openingBrackets]}}class sl{constructor(e){this.languageId=e}affects(e){return this.languageId?this.languageId===e:!0}}let Jc=class extends U{constructor(e,t){super(),this.configurationService=e,this.languageService=t,this._registry=this._register(new YC),this.onDidChangeEmitter=this._register(new Z),this.onDidChange=this.onDidChangeEmitter.event,this.configurations=new Map;const i=new Set(Object.values(Wl));this._register(this.configurationService.onDidChangeConfiguration(n=>{const s=n.change.keys.some(r=>i.has(r)),o=n.change.overrides.filter(([r,l])=>l.some(d=>i.has(d))).map(([r])=>r);if(s)this.configurations.clear(),this.onDidChangeEmitter.fire(new sl(void 0));else for(const r of o)this.languageService.isRegisteredLanguageId(r)&&(this.configurations.delete(r),this.onDidChangeEmitter.fire(new sl(r)))})),this._register(this._registry.onDidChange(n=>{this.configurations.delete(n.languageId),this.onDidChangeEmitter.fire(new sl(n.languageId))}))}register(e,t,i){return this._registry.register(e,t,i)}getLanguageConfiguration(e){let t=this.configurations.get(e);return t||(t=ZC(e,this._registry,this.configurationService,this.languageService),this.configurations.set(e,t)),t}};Jc=ge([P(0,Gi),P(1,At)],Jc);function ZC(a,e,t,i){let n=e.getLanguageConfiguration(a);if(!n){if(!i.isRegisteredLanguageId(a))return new Ns(a,{});n=new Ns(a,{})}const s=qC(n.languageId,t),o=dg([n.underlyingConfig,s]);return new Ns(n.languageId,o)}const Wl={brackets:"editor.language.brackets",colorizedBracketPairs:"editor.language.colorizedBracketPairs"};function qC(a,e){const t=e.getValue(Wl.brackets,{overrideIdentifier:a}),i=e.getValue(Wl.colorizedBracketPairs,{overrideIdentifier:a});return{brackets:eh(t),colorizedBracketPairs:eh(i)}}function eh(a){if(Array.isArray(a))return a.map(e=>{if(!(!Array.isArray(e)||e.length!==2))return[e[0],e[1]]}).filter(e=>!!e)}function lg(a,e,t){const i=a.getLineContent(e);let n=nt(i);return n.length>t-1&&(n=n.substring(0,t-1)),n}class XC{constructor(e){this.languageId=e,this._resolved=null,this._entries=[],this._order=0,this._resolved=null}register(e,t){const i=new th(e,t,++this._order);return this._entries.push(i),this._resolved=null,Eo(ke(()=>{for(let n=0;n<this._entries.length;n++)if(this._entries[n]===i){this._entries.splice(n,1),this._resolved=null;break}}))}getResolvedConfiguration(){if(!this._resolved){const e=this._resolve();e&&(this._resolved=new Ns(this.languageId,e))}return this._resolved}_resolve(){return this._entries.length===0?null:(this._entries.sort(th.cmp),dg(this._entries.map(e=>e.configuration)))}}function dg(a){let e={comments:void 0,brackets:void 0,wordPattern:void 0,indentationRules:void 0,onEnterRules:void 0,autoClosingPairs:void 0,surroundingPairs:void 0,autoCloseBefore:void 0,folding:void 0,colorizedBracketPairs:void 0,__electricCharacterSupport:void 0};for(const t of a)e={comments:t.comments||e.comments,brackets:t.brackets||e.brackets,wordPattern:t.wordPattern||e.wordPattern,indentationRules:t.indentationRules||e.indentationRules,onEnterRules:t.onEnterRules||e.onEnterRules,autoClosingPairs:t.autoClosingPairs||e.autoClosingPairs,surroundingPairs:t.surroundingPairs||e.surroundingPairs,autoCloseBefore:t.autoCloseBefore||e.autoCloseBefore,folding:t.folding||e.folding,colorizedBracketPairs:t.colorizedBracketPairs||e.colorizedBracketPairs,__electricCharacterSupport:t.__electricCharacterSupport||e.__electricCharacterSupport};return e}class th{constructor(e,t,i){this.configuration=e,this.priority=t,this.order=i}static cmp(e,t){return e.priority===t.priority?e.order-t.order:e.priority-t.priority}}class ih{constructor(e){this.languageId=e}}class YC extends U{constructor(){super(),this._entries=new Map,this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._register(this.register(xa,{brackets:[["(",")"],["[","]"],["{","}"]],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],colorizedBracketPairs:[],folding:{offSide:!0}},0))}register(e,t,i=0){let n=this._entries.get(e);n||(n=new XC(e),this._entries.set(e,n));const s=n.register(t,i);return this._onDidChange.fire(new ih(e)),Eo(ke(()=>{s.dispose(),this._onDidChange.fire(new ih(e))}))}getLanguageConfiguration(e){return this._entries.get(e)?.getResolvedConfiguration()||null}}class Ns{constructor(e,t){this.languageId=e,this.underlyingConfig=t,this._brackets=null,this._electricCharacter=null,this._onEnterSupport=this.underlyingConfig.brackets||this.underlyingConfig.indentationRules||this.underlyingConfig.onEnterRules?new ps(this.underlyingConfig):null,this.comments=Ns._handleComments(this.underlyingConfig),this.characterPair=new qr(this.underlyingConfig),this.wordDefinition=this.underlyingConfig.wordPattern||xf,this.indentationRules=this.underlyingConfig.indentationRules,this.underlyingConfig.indentationRules?this.indentRulesSupport=new GC(this.underlyingConfig.indentationRules):this.indentRulesSupport=null,this.foldingRules=this.underlyingConfig.folding||{},this.bracketsNew=new jC(e,this.underlyingConfig)}getWordDefinition(){return Nf(this.wordDefinition)}get brackets(){return!this._brackets&&this.underlyingConfig.brackets&&(this._brackets=new Ef(this.languageId,this.underlyingConfig.brackets)),this._brackets}get electricCharacter(){return this._electricCharacter||(this._electricCharacter=new UC(this.brackets)),this._electricCharacter}onEnter(e,t,i,n){return this._onEnterSupport?this._onEnterSupport.onEnter(e,t,i,n):null}getAutoClosingPairs(){return new BC(this.characterPair.getAutoClosingPairs())}getAutoCloseBeforeSet(e){return this.characterPair.getAutoCloseBeforeSet(e)}getSurroundingPairs(){return this.characterPair.getSurroundingPairs()}static _handleComments(e){const t=e.comments;if(!t)return null;const i={};if(t.lineComment&&(i.lineCommentToken=t.lineComment),t.blockComment){const[n,s]=t.blockComment;i.blockCommentStartToken=n,i.blockCommentEndToken=s}return i}}const QC=ya("ILanguageFeatureDebounceService"),JC=ya("diffProviderFactoryService"),cg=ya("IEditorCancelService");let Xr=class{static{this.ID="editor.contrib.markerDecorations"}constructor(e,t){}dispose(){}};Xr=ge([P(1,If)],Xr);Lu(Xr.ID,Xr,Kt.Eager);const ew=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class hg extends U{constructor(e,t){super(),this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._referenceDomElement=e,this._width=-1,this._height=-1,this._resizeObserver=null,this.measureReferenceDomElement(!1,t)}dispose(){this.stopObserving(),super.dispose()}getWidth(){return this._width}getHeight(){return this._height}startObserving(){if(!this._resizeObserver&&this._referenceDomElement){let e=null;const t=()=>{e?this.observe({width:e.width,height:e.height}):this.observe()};let i=!1,n=!1;const s=()=>{if(i&&!n)try{i=!1,n=!0,t()}finally{Io(Ne(this._referenceDomElement),()=>{n=!1,s()})}};this._resizeObserver=new ResizeObserver(o=>{o&&o[0]&&o[0].contentRect?e={width:o[0].contentRect.width,height:o[0].contentRect.height}:e=null,i=!0,s()}),this._resizeObserver.observe(this._referenceDomElement)}}stopObserving(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}observe(e){this.measureReferenceDomElement(!0,e)}measureReferenceDomElement(e,t){let i=0,n=0;t?(i=t.width,n=t.height):this._referenceDomElement&&(i=this._referenceDomElement.clientWidth,n=this._referenceDomElement.clientHeight),i=Math.max(5,i),n=Math.max(5,n),(this._width!==i||this._height!==n)&&(this._width=i,this._height=n,e&&this._onDidChange.fire())}}class tw extends U{constructor(e){super(),this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._listener=()=>this._handleChange(e,!0),this._mediaQueryList=null,this._handleChange(e,!1)}_handleChange(e,t){this._mediaQueryList?.removeEventListener("change",this._listener),this._mediaQueryList=e.matchMedia(`(resolution: ${e.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener("change",this._listener),t&&this._onDidChange.fire()}}class iw extends U{get value(){return this._value}constructor(e){super(),this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._value=this._getPixelRatio(e);const t=this._register(new tw(e));this._register(t.onDidChange(()=>{this._value=this._getPixelRatio(e),this._onDidChange.fire(this._value)}))}_getPixelRatio(e){const t=document.createElement("canvas").getContext("2d"),i=e.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return i/n}}class nw{constructor(){this.mapWindowIdToPixelRatioMonitor=new Map}_getOrCreatePixelRatioMonitor(e){const t=Td(e);let i=this.mapWindowIdToPixelRatioMonitor.get(t);return i||(i=Eo(new iw(e)),this.mapWindowIdToPixelRatioMonitor.set(t,i),Eo(mi.once(Rf)(({vscodeWindowId:n})=>{n===t&&(i?.dispose(),this.mapWindowIdToPixelRatioMonitor.delete(t))}))),i}getInstance(e){return this._getOrCreatePixelRatioMonitor(e)}}const Yr=new nw;var Ae;(function(a){a[a.Regular=0]="Regular",a[a.Italic=1]="Italic",a[a.Bold=2]="Bold"})(Ae||(Ae={}));class sw{constructor(e,t){this.chr=e,this.type=t,this.width=0}fulfill(e){this.width=e}}class Kd{constructor(e,t){this._bareFontInfo=e,this._requests=t,this._container=null,this._testElements=null}read(e){this._createDomElements(),e.document.body.appendChild(this._container),this._readFromDomElements(),this._container?.remove(),this._container=null,this._testElements=null}_createDomElements(){const e=document.createElement("div");e.style.position="absolute",e.style.top="-50000px",e.style.width="50000px";const t=document.createElement("div");st(t,this._bareFontInfo),e.appendChild(t);const i=document.createElement("div");st(i,this._bareFontInfo),i.style.fontWeight="bold",e.appendChild(i);const n=document.createElement("div");st(n,this._bareFontInfo),n.style.fontStyle="italic",e.appendChild(n);const s=[];for(const o of this._requests){let r;o.type===Ae.Regular&&(r=t),o.type===Ae.Bold&&(r=i),o.type===Ae.Italic&&(r=n),r.appendChild(document.createElement("br"));const l=document.createElement("span");Kd._render(l,o),r.appendChild(l),s.push(l)}this._container=e,this._testElements=s}static _render(e,t){if(t.chr===" "){let i=" ";for(let n=0;n<8;n++)i+=i;e.innerText=i}else{let i=t.chr;for(let n=0;n<8;n++)i+=i;e.textContent=i}}_readFromDomElements(){for(let e=0,t=this._requests.length;e<t;e++){const i=this._requests[e],n=this._testElements[e];i.fulfill(n.offsetWidth/256)}}}function ow(a,e,t){new Kd(e,t).read(a)}const Yi=new class{constructor(){this._zoomLevel=0,this._onDidChangeZoomLevel=new Z,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event}getZoomLevel(){return this._zoomLevel}setZoomLevel(a){a=Math.min(Math.max(-5,a),20),this._zoomLevel!==a&&(this._zoomLevel=a,this._onDidChangeZoomLevel.fire(this._zoomLevel))}},rw=Fi?1.5:1.35,ol=8;class en{static createFromValidatedSettings(e,t,i){const n=e.get(v.fontFamily),s=e.get(v.fontWeight),o=e.get(v.fontSize),r=e.get(v.fontLigatures),l=e.get(v.fontVariations),d=e.get(v.lineHeight),c=e.get(v.letterSpacing);return en._create(n,s,o,r,l,d,c,t,i)}static createFromRawSettings(e,t,i=!1){const n=Vt.fontFamily.validate(e.fontFamily),s=Vt.fontWeight.validate(e.fontWeight),o=Vt.fontSize.validate(e.fontSize),r=Vt.fontLigatures2.validate(e.fontLigatures),l=Vt.fontVariations.validate(e.fontVariations),d=Vt.lineHeight.validate(e.lineHeight),c=Vt.letterSpacing.validate(e.letterSpacing);return en._create(n,s,o,r,l,d,c,t,i)}static _create(e,t,i,n,s,o,r,l,d){o===0?o=rw*i:o<ol&&(o=o*i),o=Math.round(o),o<ol&&(o=ol);const c=1+(d?0:Yi.getZoomLevel()*.1);return i*=c,o*=c,s===xc.TRANSLATE&&(t==="normal"||t==="bold"?s=xc.OFF:(s=`'wght' ${parseInt(t,10)}`,t="normal")),new en({pixelRatio:l,fontFamily:e,fontWeight:t,fontSize:i,fontFeatureSettings:n,fontVariationSettings:s,lineHeight:o,letterSpacing:r})}constructor(e){this._bareFontInfoBrand=void 0,this.pixelRatio=e.pixelRatio,this.fontFamily=String(e.fontFamily),this.fontWeight=String(e.fontWeight),this.fontSize=e.fontSize,this.fontFeatureSettings=e.fontFeatureSettings,this.fontVariationSettings=e.fontVariationSettings,this.lineHeight=e.lineHeight|0,this.letterSpacing=e.letterSpacing}getId(){return`${this.pixelRatio}-${this.fontFamily}-${this.fontWeight}-${this.fontSize}-${this.fontFeatureSettings}-${this.fontVariationSettings}-${this.lineHeight}-${this.letterSpacing}`}getMassagedFontFamily(){const e=Ir.fontFamily,t=en._wrapInQuotes(this.fontFamily);return e&&this.fontFamily!==e?`${t}, ${e}`:t}static _wrapInQuotes(e){return/[,"']/.test(e)?e:/[+ ]/.test(e)?`"${e}"`:e}}const ug=2;class Pr extends en{constructor(e,t){super(e),this._editorStylingBrand=void 0,this.version=ug,this.isTrusted=t,this.isMonospace=e.isMonospace,this.typicalHalfwidthCharacterWidth=e.typicalHalfwidthCharacterWidth,this.typicalFullwidthCharacterWidth=e.typicalFullwidthCharacterWidth,this.canUseHalfwidthRightwardsArrow=e.canUseHalfwidthRightwardsArrow,this.spaceWidth=e.spaceWidth,this.middotWidth=e.middotWidth,this.wsmiddotWidth=e.wsmiddotWidth,this.maxDigitWidth=e.maxDigitWidth}equals(e){return this.fontFamily===e.fontFamily&&this.fontWeight===e.fontWeight&&this.fontSize===e.fontSize&&this.fontFeatureSettings===e.fontFeatureSettings&&this.fontVariationSettings===e.fontVariationSettings&&this.lineHeight===e.lineHeight&&this.letterSpacing===e.letterSpacing&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.typicalFullwidthCharacterWidth===e.typicalFullwidthCharacterWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.maxDigitWidth===e.maxDigitWidth}}class aw extends U{constructor(){super(...arguments),this._cache=new Map,this._evictUntrustedReadingsTimeout=-1,this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event}dispose(){this._evictUntrustedReadingsTimeout!==-1&&(clearTimeout(this._evictUntrustedReadingsTimeout),this._evictUntrustedReadingsTimeout=-1),super.dispose()}clearAllFontInfos(){this._cache.clear(),this._onDidChange.fire()}_ensureCache(e){const t=Td(e);let i=this._cache.get(t);return i||(i=new lw,this._cache.set(t,i)),i}_writeToCache(e,t,i){this._ensureCache(e).put(t,i),!i.isTrusted&&this._evictUntrustedReadingsTimeout===-1&&(this._evictUntrustedReadingsTimeout=e.setTimeout(()=>{this._evictUntrustedReadingsTimeout=-1,this._evictUntrustedReadings(e)},5e3))}_evictUntrustedReadings(e){const t=this._ensureCache(e),i=t.getValues();let n=!1;for(const s of i)s.isTrusted||(n=!0,t.remove(s));n&&this._onDidChange.fire()}serializeFontInfo(e){return this._ensureCache(e).getValues().filter(i=>i.isTrusted)}restoreFontInfo(e,t){for(const i of t){if(i.version!==ug)continue;const n=new Pr(i,!1);this._writeToCache(e,n,n)}}readFontInfo(e,t){const i=this._ensureCache(e);if(!i.has(t)){let n=this._actualReadFontInfo(e,t);(n.typicalHalfwidthCharacterWidth<=2||n.typicalFullwidthCharacterWidth<=2||n.spaceWidth<=2||n.maxDigitWidth<=2)&&(n=new Pr({pixelRatio:Yr.getInstance(e).value,fontFamily:n.fontFamily,fontWeight:n.fontWeight,fontSize:n.fontSize,fontFeatureSettings:n.fontFeatureSettings,fontVariationSettings:n.fontVariationSettings,lineHeight:n.lineHeight,letterSpacing:n.letterSpacing,isMonospace:n.isMonospace,typicalHalfwidthCharacterWidth:Math.max(n.typicalHalfwidthCharacterWidth,5),typicalFullwidthCharacterWidth:Math.max(n.typicalFullwidthCharacterWidth,5),canUseHalfwidthRightwardsArrow:n.canUseHalfwidthRightwardsArrow,spaceWidth:Math.max(n.spaceWidth,5),middotWidth:Math.max(n.middotWidth,5),wsmiddotWidth:Math.max(n.wsmiddotWidth,5),maxDigitWidth:Math.max(n.maxDigitWidth,5)},!1)),this._writeToCache(e,t,n)}return i.get(t)}_createRequest(e,t,i,n){const s=new sw(e,t);return i.push(s),n?.push(s),s}_actualReadFontInfo(e,t){const i=[],n=[],s=this._createRequest("n",Ae.Regular,i,n),o=this._createRequest("ｍ",Ae.Regular,i,null),r=this._createRequest(" ",Ae.Regular,i,n),l=this._createRequest("0",Ae.Regular,i,n),d=this._createRequest("1",Ae.Regular,i,n),c=this._createRequest("2",Ae.Regular,i,n),h=this._createRequest("3",Ae.Regular,i,n),u=this._createRequest("4",Ae.Regular,i,n),g=this._createRequest("5",Ae.Regular,i,n),f=this._createRequest("6",Ae.Regular,i,n),m=this._createRequest("7",Ae.Regular,i,n),_=this._createRequest("8",Ae.Regular,i,n),L=this._createRequest("9",Ae.Regular,i,n),w=this._createRequest("→",Ae.Regular,i,n),p=this._createRequest("￫",Ae.Regular,i,null),C=this._createRequest("·",Ae.Regular,i,n),b=this._createRequest("⸱",Ae.Regular,i,null),S="|/-_ilm%";for(let D=0,A=S.length;D<A;D++)this._createRequest(S.charAt(D),Ae.Regular,i,n),this._createRequest(S.charAt(D),Ae.Italic,i,n),this._createRequest(S.charAt(D),Ae.Bold,i,n);ow(e,t,i);const y=Math.max(l.width,d.width,c.width,h.width,u.width,g.width,f.width,m.width,_.width,L.width);let E=t.fontFeatureSettings===Na.OFF;const x=n[0].width;for(let D=1,A=n.length;E&&D<A;D++){const W=x-n[D].width;if(W<-.001||W>.001){E=!1;break}}let R=!0;return E&&p.width!==x&&(R=!1),p.width>w.width&&(R=!1),new Pr({pixelRatio:Yr.getInstance(e).value,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontSize:t.fontSize,fontFeatureSettings:t.fontFeatureSettings,fontVariationSettings:t.fontVariationSettings,lineHeight:t.lineHeight,letterSpacing:t.letterSpacing,isMonospace:E,typicalHalfwidthCharacterWidth:s.width,typicalFullwidthCharacterWidth:o.width,canUseHalfwidthRightwardsArrow:R,spaceWidth:r.width,middotWidth:C.width,wsmiddotWidth:b.width,maxDigitWidth:y},!0)}}class lw{constructor(){this._keys=Object.create(null),this._values=Object.create(null)}has(e){const t=e.getId();return!!this._values[t]}get(e){const t=e.getId();return this._values[t]}put(e,t){const i=e.getId();this._keys[i]=e,this._values[i]=t}remove(e){const t=e.getId();delete this._keys[t],delete this._values[t]}getValues(){return Object.keys(this._keys).map(e=>this._values[e])}}const Vl=new aw;class jn{static{this.items=[]}constructor(e,t){this.key=e,this.migrate=t}apply(e){const t=jn._read(e,this.key),i=s=>jn._read(e,s),n=(s,o)=>jn._write(e,s,o);this.migrate(t,i,n)}static _read(e,t){if(typeof e>"u")return;const i=t.indexOf(".");if(i>=0){const n=t.substring(0,i);return this._read(e[n],t.substring(i+1))}return e[t]}static _write(e,t,i){const n=t.indexOf(".");if(n>=0){const s=t.substring(0,n);e[s]=e[s]||{},this._write(e[s],t.substring(n+1),i);return}e[t]=i}}function ri(a,e){jn.items.push(new jn(a,e))}function Rt(a,e){ri(a,(t,i,n)=>{if(typeof t<"u"){for(const[s,o]of e)if(t===s){n(a,o);return}}})}function dw(a){jn.items.forEach(e=>e.apply(a))}Rt("wordWrap",[[!0,"on"],[!1,"off"]]);Rt("lineNumbers",[[!0,"on"],[!1,"off"]]);Rt("cursorBlinking",[["visible","solid"]]);Rt("renderWhitespace",[[!0,"boundary"],[!1,"none"]]);Rt("renderLineHighlight",[[!0,"line"],[!1,"none"]]);Rt("acceptSuggestionOnEnter",[[!0,"on"],[!1,"off"]]);Rt("tabCompletion",[[!1,"off"],[!0,"onlySnippets"]]);Rt("hover",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);Rt("parameterHints",[[!0,{enabled:!0}],[!1,{enabled:!1}]]);Rt("autoIndent",[[!1,"advanced"],[!0,"full"]]);Rt("matchBrackets",[[!0,"always"],[!1,"never"]]);Rt("renderFinalNewline",[[!0,"on"],[!1,"off"]]);Rt("cursorSmoothCaretAnimation",[[!0,"on"],[!1,"off"]]);Rt("occurrencesHighlight",[[!0,"singleFile"],[!1,"off"]]);Rt("wordBasedSuggestions",[[!0,"matchingDocuments"],[!1,"off"]]);Rt("defaultColorDecorators",[[!0,"auto"],[!1,"never"]]);ri("autoClosingBrackets",(a,e,t)=>{a===!1&&(t("autoClosingBrackets","never"),typeof e("autoClosingQuotes")>"u"&&t("autoClosingQuotes","never"),typeof e("autoSurround")>"u"&&t("autoSurround","never"))});ri("renderIndentGuides",(a,e,t)=>{typeof a<"u"&&(t("renderIndentGuides",void 0),typeof e("guides.indentation")>"u"&&t("guides.indentation",!!a))});ri("highlightActiveIndentGuide",(a,e,t)=>{typeof a<"u"&&(t("highlightActiveIndentGuide",void 0),typeof e("guides.highlightActiveIndentation")>"u"&&t("guides.highlightActiveIndentation",!!a))});const cw={method:"showMethods",function:"showFunctions",constructor:"showConstructors",deprecated:"showDeprecated",field:"showFields",variable:"showVariables",class:"showClasses",struct:"showStructs",interface:"showInterfaces",module:"showModules",property:"showProperties",event:"showEvents",operator:"showOperators",unit:"showUnits",value:"showValues",constant:"showConstants",enum:"showEnums",enumMember:"showEnumMembers",keyword:"showKeywords",text:"showWords",color:"showColors",file:"showFiles",reference:"showReferences",folder:"showFolders",typeParameter:"showTypeParameters",snippet:"showSnippets"};ri("suggest.filteredTypes",(a,e,t)=>{if(a&&typeof a=="object"){for(const i of Object.entries(cw))a[i[0]]===!1&&typeof e(`suggest.${i[1]}`)>"u"&&t(`suggest.${i[1]}`,!1);t("suggest.filteredTypes",void 0)}});ri("quickSuggestions",(a,e,t)=>{if(typeof a=="boolean"){const i=a?"on":"off";t("quickSuggestions",{comments:i,strings:i,other:i})}});ri("experimental.stickyScroll.enabled",(a,e,t)=>{typeof a=="boolean"&&(t("experimental.stickyScroll.enabled",void 0),typeof e("stickyScroll.enabled")>"u"&&t("stickyScroll.enabled",a))});ri("experimental.stickyScroll.maxLineCount",(a,e,t)=>{typeof a=="number"&&(t("experimental.stickyScroll.maxLineCount",void 0),typeof e("stickyScroll.maxLineCount")>"u"&&t("stickyScroll.maxLineCount",a))});ri("codeActionsOnSave",(a,e,t)=>{if(a&&typeof a=="object"){let i=!1;const n={};for(const s of Object.entries(a))typeof s[1]=="boolean"?(i=!0,n[s[0]]=s[1]?"explicit":"never"):n[s[0]]=s[1];i&&t("codeActionsOnSave",n)}});ri("codeActionWidget.includeNearbyQuickfixes",(a,e,t)=>{typeof a=="boolean"&&(t("codeActionWidget.includeNearbyQuickfixes",void 0),typeof e("codeActionWidget.includeNearbyQuickFixes")>"u"&&t("codeActionWidget.includeNearbyQuickFixes",a))});ri("lightbulb.enabled",(a,e,t)=>{typeof a=="boolean"&&t("lightbulb.enabled",a?void 0:"off")});ri("inlineSuggest.edits.codeShifting",(a,e,t)=>{typeof a=="boolean"&&(t("inlineSuggest.edits.codeShifting",void 0),t("inlineSuggest.edits.allowCodeShifting",a?"always":"never"))});class hw{constructor(){this._tabFocus=!1,this._onDidChangeTabFocus=new Z,this.onDidChangeTabFocus=this._onDidChangeTabFocus.event}getTabFocusMode(){return this._tabFocus}setTabFocusMode(e){this._tabFocus=e,this._onDidChangeTabFocus.fire(this._tabFocus)}}const Qr=new hw;class uw{constructor(){this._inputMode="insert",this._onDidChangeInputMode=new Z,this.onDidChangeInputMode=this._onDidChangeInputMode.event}getInputMode(){return this._inputMode}setInputMode(e){this._inputMode=e,this._onDidChangeInputMode.fire(this._inputMode)}}const Fl=new uw;let Hl=class extends U{constructor(e,t,i,n,s,o){super(),this._accessibilityService=o,this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._onDidChangeFast=this._register(new Z),this.onDidChangeFast=this._onDidChangeFast.event,this._isDominatedByLongLines=!1,this._viewLineCount=1,this._lineNumbersDigitCount=1,this._reservedHeight=0,this._glyphMarginDecorationLaneCount=1,this._computeOptionsMemory=new Df,this.isSimpleWidget=e,this.contextMenuId=t,this.isStandaloneEditor=i,this._containerObserver=this._register(new hg(s,n.dimension)),this._targetWindowId=Ne(s).vscodeWindowId,this._rawOptions=nh(n),this._validatedOptions=Oi.validateOptions(this._rawOptions),this.options=this._computeOptions(),this.options.get(v.automaticLayout)&&this._containerObserver.startObserving(),this._register(Yi.onDidChangeZoomLevel(()=>this._recomputeOptions())),this._register(Qr.onDidChangeTabFocus(()=>this._recomputeOptions())),this._register(this._containerObserver.onDidChange(()=>this._recomputeOptions())),this._register(Vl.onDidChange(()=>this._recomputeOptions())),this._register(Yr.getInstance(Ne(s)).onDidChange(()=>this._recomputeOptions())),this._register(this._accessibilityService.onDidChangeScreenReaderOptimized(()=>this._recomputeOptions())),this._register(Fl.onDidChangeInputMode(()=>this._recomputeOptions()))}_recomputeOptions(){const e=this._computeOptions(),t=Oi.checkEquals(this.options,e);t!==null&&(this.options=e,this._onDidChangeFast.fire(t),this._onDidChange.fire(t))}_computeOptions(){const e=this._readEnvConfiguration(),t=en.createFromValidatedSettings(this._validatedOptions,e.pixelRatio,this.isSimpleWidget),i=this._readFontInfo(t),n={memory:this._computeOptionsMemory,outerWidth:e.outerWidth,outerHeight:e.outerHeight-this._reservedHeight,fontInfo:i,extraEditorClassName:e.extraEditorClassName,isDominatedByLongLines:this._isDominatedByLongLines,viewLineCount:this._viewLineCount,lineNumbersDigitCount:this._lineNumbersDigitCount,emptySelectionClipboard:e.emptySelectionClipboard,pixelRatio:e.pixelRatio,tabFocusMode:Qr.getTabFocusMode(),inputMode:Fl.getInputMode(),accessibilitySupport:e.accessibilitySupport,glyphMarginDecorationLaneCount:this._glyphMarginDecorationLaneCount,editContextSupported:e.editContextSupported};return Oi.computeOptions(this._validatedOptions,n)}_readEnvConfiguration(){return{extraEditorClassName:fw(this.isStandaloneEditor),outerWidth:this._containerObserver.getWidth(),outerHeight:this._containerObserver.getHeight(),emptySelectionClipboard:vu||hn,pixelRatio:Yr.getInstance(Nc(this._targetWindowId,!0).window).value,editContextSupported:typeof globalThis.EditContext=="function",accessibilitySupport:this._accessibilityService.isScreenReaderOptimized()?Xi.Enabled:this._accessibilityService.getAccessibilitySupport()}}_readFontInfo(e){return Vl.readFontInfo(Nc(this._targetWindowId,!0).window,e)}getRawOptions(){return this._rawOptions}updateOptions(e){const t=nh(e);Oi.applyUpdate(this._rawOptions,t)&&(this._validatedOptions=Oi.validateOptions(this._rawOptions),this._recomputeOptions())}observeContainer(e){this._containerObserver.observe(e)}setIsDominatedByLongLines(e){this._isDominatedByLongLines!==e&&(this._isDominatedByLongLines=e,this._recomputeOptions())}setModelLineCount(e){const t=gw(e);this._lineNumbersDigitCount!==t&&(this._lineNumbersDigitCount=t,this._recomputeOptions())}setViewLineCount(e){this._viewLineCount!==e&&(this._viewLineCount=e,this._recomputeOptions())}setReservedHeight(e){this._reservedHeight!==e&&(this._reservedHeight=e,this._recomputeOptions())}setGlyphMarginDecorationLaneCount(e){this._glyphMarginDecorationLaneCount!==e&&(this._glyphMarginDecorationLaneCount=e,this._recomputeOptions())}};Hl=ge([P(5,ji)],Hl);function gw(a){let e=0;for(;a;)a=Math.floor(a/10),e++;return e||1}function fw(a){let e="";return!To&&!Tf&&(e+="no-user-select "),To&&(e+="no-minimap-shadow ",e+="enable-user-select "),Fi&&(e+="mac "),a&&(e+="standalone "),e}class mw{constructor(){this._values=[]}_read(e){return this._values[e]}get(e){return this._values[e]}_write(e,t){this._values[e]=t}}class pw{constructor(){this._values=[]}_read(e){if(e>=this._values.length)throw new Error("Cannot read uninitialized value");return this._values[e]}get(e){return this._read(e)}_write(e,t){this._values[e]=t}}class Oi{static validateOptions(e){const t=new mw;for(const i of cr){const n=i.name==="_never_"?void 0:e[i.name];t._write(i.id,i.validate(n))}return t}static computeOptions(e,t){const i=new pw;for(const n of cr)i._write(n.id,n.compute(t,i,e._read(n.id)));return i}static _deepEquals(e,t){if(typeof e!="object"||typeof t!="object"||!e||!t)return e===t;if(Array.isArray(e)||Array.isArray(t))return Array.isArray(e)&&Array.isArray(t)?Do(e,t):!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!Oi._deepEquals(e[i],t[i]))return!1;return!0}static checkEquals(e,t){const i=[];let n=!1;for(const s of cr){const o=!Oi._deepEquals(e._read(s.id),t._read(s.id));i[s.id]=o,o&&(n=!0)}return n?new bu(i):null}static applyUpdate(e,t){let i=!1;for(const n of cr)if(t.hasOwnProperty(n.name)){const s=n.applyUpdate(e[n.name],t[n.name]);e[n.name]=s.newValue,i=i||s.didChange}return i}}function nh(a){const e=Ro(a);return dw(e),e}var tn;(function(a){const e={total:0,min:Number.MAX_VALUE,max:0},t={...e},i={...e},n={...e};let s=0,o;(function(E){E[E.Before=0]="Before",E[E.InProgress=1]="InProgress",E[E.Finished=2]="Finished"})(o||(o={}));const r={keydown:o.Before,input:o.Before,render:o.Before};function l(){w(),performance.mark("inputlatency/start"),performance.mark("keydown/start"),r.keydown=o.InProgress,queueMicrotask(d)}a.onKeyDown=l;function d(){r.keydown===o.InProgress&&(performance.mark("keydown/end"),r.keydown=o.Finished)}function c(){performance.mark("input/start"),r.input=o.InProgress,L()}a.onBeforeInput=c;function h(){r.input===o.Before&&c(),queueMicrotask(u)}a.onInput=h;function u(){r.input===o.InProgress&&(performance.mark("input/end"),r.input=o.Finished)}function g(){w()}a.onKeyUp=g;function f(){w()}a.onSelectionChange=f;function m(){r.keydown===o.Finished&&r.input===o.Finished&&r.render===o.Before&&(performance.mark("render/start"),r.render=o.InProgress,queueMicrotask(_),L())}a.onRenderStart=m;function _(){r.render===o.InProgress&&(performance.mark("render/end"),r.render=o.Finished)}function L(){setTimeout(w)}function w(){r.keydown===o.Finished&&r.input===o.Finished&&r.render===o.Finished&&(performance.mark("inputlatency/end"),performance.measure("keydown","keydown/start","keydown/end"),performance.measure("input","input/start","input/end"),performance.measure("render","render/start","render/end"),performance.measure("inputlatency","inputlatency/start","inputlatency/end"),p("keydown",e),p("input",t),p("render",i),p("inputlatency",n),s++,C())}function p(E,x){const R=performance.getEntriesByName(E)[0].duration;x.total+=R,x.min=Math.min(x.min,R),x.max=Math.max(x.max,R)}function C(){performance.clearMarks("keydown/start"),performance.clearMarks("keydown/end"),performance.clearMarks("input/start"),performance.clearMarks("input/end"),performance.clearMarks("render/start"),performance.clearMarks("render/end"),performance.clearMarks("inputlatency/start"),performance.clearMarks("inputlatency/end"),performance.clearMeasures("keydown"),performance.clearMeasures("input"),performance.clearMeasures("render"),performance.clearMeasures("inputlatency"),r.keydown=o.Before,r.input=o.Before,r.render=o.Before}function b(){if(s===0)return;const E={keydown:S(e),input:S(t),render:S(i),total:S(n),sampleCount:s};return y(e),y(t),y(i),y(n),s=0,E}a.getAndClearMeasurements=b;function S(E){return{average:E.total/s,max:E.max,min:E.min}}function y(E){E.total=0,E.min=Number.MAX_VALUE,E.max=0}})(tn||(tn={}));class Va{constructor(e,t){this.x=e,this.y=t,this._pageCoordinatesBrand=void 0}toClientCoordinates(e){return new gg(this.x-e.scrollX,this.y-e.scrollY)}}class gg{constructor(e,t){this.clientX=e,this.clientY=t,this._clientCoordinatesBrand=void 0}toPageCoordinates(e){return new Va(this.clientX+e.scrollX,this.clientY+e.scrollY)}}class _w{constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n,this._editorPagePositionBrand=void 0}}class Cw{constructor(e,t){this.x=e,this.y=t,this._positionRelativeToEditorBrand=void 0}}function $d(a){const e=Xn(a);return new _w(e.left,e.top,e.width,e.height)}function Zd(a,e,t){const i=e.width/a.offsetWidth,n=e.height/a.offsetHeight,s=(t.x-e.x)/i,o=(t.y-e.y)/n;return new Cw(s,o)}class un extends Su{constructor(e,t,i){super(Ne(i),e),this._editorMouseEventBrand=void 0,this.isFromPointerCapture=t,this.pos=new Va(this.posx,this.posy),this.editorPos=$d(i),this.relativePos=Zd(i,this.editorPos,this.pos)}}class ww{constructor(e){this._editorViewDomNode=e}_create(e){return new un(e,!1,this._editorViewDomNode)}onContextMenu(e,t){return Y(e,mt.CONTEXT_MENU,i=>{t(this._create(i))})}onMouseUp(e,t){return Y(e,mt.MOUSE_UP,i=>{t(this._create(i))})}onMouseDown(e,t){return Y(e,mt.MOUSE_DOWN,i=>{t(this._create(i))})}onPointerDown(e,t){return Y(e,mt.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onMouseLeave(e,t){return Y(e,mt.MOUSE_LEAVE,i=>{t(this._create(i))})}onMouseMove(e,t){return Y(e,mt.MOUSE_MOVE,i=>t(this._create(i)))}}class Lw{constructor(e){this._editorViewDomNode=e}_create(e){return new un(e,!1,this._editorViewDomNode)}onPointerUp(e,t){return Y(e,"pointerup",i=>{t(this._create(i))})}onPointerDown(e,t){return Y(e,mt.POINTER_DOWN,i=>{t(this._create(i),i.pointerId)})}onPointerLeave(e,t){return Y(e,mt.POINTER_LEAVE,i=>{t(this._create(i))})}onPointerMove(e,t){return Y(e,"pointermove",i=>t(this._create(i)))}}class vw extends U{constructor(e){super(),this._editorViewDomNode=e,this._globalPointerMoveMonitor=this._register(new yu),this._keydownListener=null}startMonitoring(e,t,i,n,s){this._keydownListener=zn(e.ownerDocument,"keydown",o=>{o.toKeyCodeChord().isModifierKey()||this._globalPointerMoveMonitor.stopMonitoring(!0,o.browserEvent)},!0),this._globalPointerMoveMonitor.startMonitoring(e,t,i,o=>{n(new un(o,!0,this._editorViewDomNode))},o=>{this._keydownListener.dispose(),s(o)})}stopMonitoring(){this._globalPointerMoveMonitor.stopMonitoring(!0)}}class fg{static{this._idPool=0}constructor(e){this._editor=e,this._instanceId=++fg._idPool,this._counter=0,this._rules=new Map,this._garbageCollectionScheduler=new Ei(()=>this.garbageCollect(),1e3)}createClassNameRef(e){const t=this.getOrCreateRule(e);return t.increaseRefCount(),{className:t.className,dispose:()=>{t.decreaseRefCount(),this._garbageCollectionScheduler.schedule()}}}getOrCreateRule(e){const t=this.computeUniqueKey(e);let i=this._rules.get(t);if(!i){const n=this._counter++;i=new bw(t,`dyn-rule-${this._instanceId}-${n}`,Mf(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,e),this._rules.set(t,i)}return i}computeUniqueKey(e){return JSON.stringify(e)}garbageCollect(){for(const e of this._rules.values())e.hasReferences()||(this._rules.delete(e.key),e.dispose())}}class bw{constructor(e,t,i,n){this.key=e,this.className=t,this.properties=n,this._referenceCount=0,this._styleElementDisposables=new Ot,this._styleElement=Af(i,void 0,this._styleElementDisposables),this._styleElement.textContent=this.getCssText(this.className,this.properties)}getCssText(e,t){let i=`.${e} {`;for(const n in t){const s=t[n];let o;typeof s=="object"?o=Of(s.id):o=s;const r=Sw(n);i+=`
	${r}: ${o};`}return i+=`
}`,i}dispose(){this._styleElementDisposables.dispose(),this._styleElement=void 0}increaseRefCount(){this._referenceCount++}decreaseRefCount(){this._referenceCount--}hasReferences(){return this._referenceCount>0}}function Sw(a){return a.replace(/(^[A-Z])/,([e])=>e.toLowerCase()).replace(/([A-Z])/g,([e])=>`-${e.toLowerCase()}`)}var ue;(function(a){a[a.ViewCompositionStart=0]="ViewCompositionStart",a[a.ViewCompositionEnd=1]="ViewCompositionEnd",a[a.ViewConfigurationChanged=2]="ViewConfigurationChanged",a[a.ViewCursorStateChanged=3]="ViewCursorStateChanged",a[a.ViewDecorationsChanged=4]="ViewDecorationsChanged",a[a.ViewFlushed=5]="ViewFlushed",a[a.ViewFocusChanged=6]="ViewFocusChanged",a[a.ViewLanguageConfigurationChanged=7]="ViewLanguageConfigurationChanged",a[a.ViewLineMappingChanged=8]="ViewLineMappingChanged",a[a.ViewLinesChanged=9]="ViewLinesChanged",a[a.ViewLinesDeleted=10]="ViewLinesDeleted",a[a.ViewLinesInserted=11]="ViewLinesInserted",a[a.ViewRevealRangeRequest=12]="ViewRevealRangeRequest",a[a.ViewScrollChanged=13]="ViewScrollChanged",a[a.ViewThemeChanged=14]="ViewThemeChanged",a[a.ViewTokensChanged=15]="ViewTokensChanged",a[a.ViewTokensColorsChanged=16]="ViewTokensColorsChanged",a[a.ViewZonesChanged=17]="ViewZonesChanged"})(ue||(ue={}));class yw{constructor(){this.type=ue.ViewCompositionStart}}class xw{constructor(){this.type=ue.ViewCompositionEnd}}class Nw{constructor(e){this.type=ue.ViewConfigurationChanged,this._source=e}hasChanged(e){return this._source.hasChanged(e)}}class Ew{constructor(e,t,i){this.selections=e,this.modelSelections=t,this.reason=i,this.type=ue.ViewCursorStateChanged}}class wn{constructor(e){this.type=ue.ViewDecorationsChanged,e?(this.affectsMinimap=e.affectsMinimap,this.affectsOverviewRuler=e.affectsOverviewRuler,this.affectsGlyphMargin=e.affectsGlyphMargin,this.affectsLineNumber=e.affectsLineNumber):(this.affectsMinimap=!0,this.affectsOverviewRuler=!0,this.affectsGlyphMargin=!0,this.affectsLineNumber=!0)}}class _r{constructor(){this.type=ue.ViewFlushed}}class Iw{constructor(e){this.type=ue.ViewFocusChanged,this.isFocused=e}}class Rw{constructor(){this.type=ue.ViewLanguageConfigurationChanged}}class Cr{constructor(){this.type=ue.ViewLineMappingChanged}}class mg{constructor(e,t){this.fromLineNumber=e,this.count=t,this.type=ue.ViewLinesChanged}}class Bl{constructor(e,t){this.type=ue.ViewLinesDeleted,this.fromLineNumber=e,this.toLineNumber=t}}class zl{constructor(e,t){this.type=ue.ViewLinesInserted,this.fromLineNumber=e,this.toLineNumber=t}}var de;(function(a){a[a.Simple=0]="Simple",a[a.Center=1]="Center",a[a.CenterIfOutsideViewport=2]="CenterIfOutsideViewport",a[a.Top=3]="Top",a[a.Bottom=4]="Bottom",a[a.NearTop=5]="NearTop",a[a.NearTopIfOutsideViewport=6]="NearTopIfOutsideViewport"})(de||(de={}));class po{constructor(e,t,i,n,s,o,r){this.source=e,this.minimalReveal=t,this.range=i,this.selections=n,this.verticalType=s,this.revealHorizontal=o,this.scrollType=r,this.type=ue.ViewRevealRangeRequest}}class Dw{constructor(e){this.type=ue.ViewScrollChanged,this.scrollWidth=e.scrollWidth,this.scrollLeft=e.scrollLeft,this.scrollHeight=e.scrollHeight,this.scrollTop=e.scrollTop,this.scrollWidthChanged=e.scrollWidthChanged,this.scrollLeftChanged=e.scrollLeftChanged,this.scrollHeightChanged=e.scrollHeightChanged,this.scrollTopChanged=e.scrollTopChanged}}class Tw{constructor(e){this.theme=e,this.type=ue.ViewThemeChanged}}class Mw{constructor(e){this.type=ue.ViewTokensChanged,this.ranges=e}}class Aw{constructor(){this.type=ue.ViewTokensColorsChanged}}let Ow=class{constructor(){this.type=ue.ViewZonesChanged}};class ss extends U{constructor(){super(),this._shouldRender=!0}shouldRender(){return this._shouldRender}forceShouldRender(){this._shouldRender=!0}setShouldRender(){this._shouldRender=!0}onDidRender(){this._shouldRender=!1}onCompositionStart(e){return!1}onCompositionEnd(e){return!1}onConfigurationChanged(e){return!1}onCursorStateChanged(e){return!1}onDecorationsChanged(e){return!1}onFlushed(e){return!1}onFocusChanged(e){return!1}onLanguageConfigurationChanged(e){return!1}onLineMappingChanged(e){return!1}onLinesChanged(e){return!1}onLinesDeleted(e){return!1}onLinesInserted(e){return!1}onRevealRangeRequest(e){return!1}onScrollChanged(e){return!1}onThemeChanged(e){return!1}onTokensChanged(e){return!1}onTokensColorsChanged(e){return!1}onZonesChanged(e){return!1}handleEvents(e){let t=!1;for(let i=0,n=e.length;i<n;i++){const s=e[i];switch(s.type){case ue.ViewCompositionStart:this.onCompositionStart(s)&&(t=!0);break;case ue.ViewCompositionEnd:this.onCompositionEnd(s)&&(t=!0);break;case ue.ViewConfigurationChanged:this.onConfigurationChanged(s)&&(t=!0);break;case ue.ViewCursorStateChanged:this.onCursorStateChanged(s)&&(t=!0);break;case ue.ViewDecorationsChanged:this.onDecorationsChanged(s)&&(t=!0);break;case ue.ViewFlushed:this.onFlushed(s)&&(t=!0);break;case ue.ViewFocusChanged:this.onFocusChanged(s)&&(t=!0);break;case ue.ViewLanguageConfigurationChanged:this.onLanguageConfigurationChanged(s)&&(t=!0);break;case ue.ViewLineMappingChanged:this.onLineMappingChanged(s)&&(t=!0);break;case ue.ViewLinesChanged:this.onLinesChanged(s)&&(t=!0);break;case ue.ViewLinesDeleted:this.onLinesDeleted(s)&&(t=!0);break;case ue.ViewLinesInserted:this.onLinesInserted(s)&&(t=!0);break;case ue.ViewRevealRangeRequest:this.onRevealRangeRequest(s)&&(t=!0);break;case ue.ViewScrollChanged:this.onScrollChanged(s)&&(t=!0);break;case ue.ViewTokensChanged:this.onTokensChanged(s)&&(t=!0);break;case ue.ViewThemeChanged:this.onThemeChanged(s)&&(t=!0);break;case ue.ViewTokensColorsChanged:this.onTokensColorsChanged(s)&&(t=!0);break;case ue.ViewZonesChanged:this.onZonesChanged(s)&&(t=!0);break;default:console.info("View received unknown event: "),console.info(s)}}t&&(this._shouldRender=!0)}}class St extends ss{constructor(e){super(),this._context=e,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}}var xe;(function(a){a[a.None=0]="None",a[a.ContentWidgets=1]="ContentWidgets",a[a.OverflowingContentWidgets=2]="OverflowingContentWidgets",a[a.OverflowGuard=3]="OverflowGuard",a[a.OverlayWidgets=4]="OverlayWidgets",a[a.OverflowingOverlayWidgets=5]="OverflowingOverlayWidgets",a[a.ScrollableElement=6]="ScrollableElement",a[a.TextArea=7]="TextArea",a[a.ViewLines=8]="ViewLines",a[a.Minimap=9]="Minimap",a[a.ViewLinesGpu=10]="ViewLinesGpu"})(xe||(xe={}));class Li{static write(e,t){e.setAttribute("data-mprt",String(t))}static read(e){const t=e.getAttribute("data-mprt");return t===null?xe.None:parseInt(t,10)}static collect(e,t){const i=[];let n=0;for(;e&&e!==e.ownerDocument.body&&e!==t;)e.nodeType===e.ELEMENT_NODE&&(i[n++]=this.read(e)),e=e.parentElement;const s=new Uint8Array(n);for(let o=0;o<n;o++)s[o]=i[n-o-1];return s}}class Pw{constructor(e,t){this._restrictedRenderingContextBrand=void 0,this._viewLayout=e,this.viewportData=t,this.scrollWidth=this._viewLayout.getScrollWidth(),this.scrollHeight=this._viewLayout.getScrollHeight(),this.visibleRange=this.viewportData.visibleRange,this.bigNumbersDelta=this.viewportData.bigNumbersDelta;const i=this._viewLayout.getCurrentViewport();this.scrollTop=i.top,this.scrollLeft=i.left,this.viewportWidth=i.width,this.viewportHeight=i.height}getScrolledTopFromAbsoluteTop(e){return e-this.scrollTop}getVerticalOffsetForLineNumber(e,t){return this._viewLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t){return this._viewLayout.getVerticalOffsetAfterLineNumber(e,t)}getLineHeightForLineNumber(e){return this._viewLayout.getLineHeightForLineNumber(e)}getDecorationsInViewport(){return this.viewportData.getDecorationsInViewport()}}class kw extends Pw{constructor(e,t,i,n){super(e,t),this._renderingContextBrand=void 0,this._viewLines=i,this._viewLinesGpu=n}linesVisibleRangesForRange(e,t){const i=this._viewLines.linesVisibleRangesForRange(e,t);if(!this._viewLinesGpu)return i??null;const n=this._viewLinesGpu.linesVisibleRangesForRange(e,t);return i?n?i.concat(n).sort((s,o)=>s.lineNumber-o.lineNumber):i:n}visibleRangeForPosition(e){return this._viewLines.visibleRangeForPosition(e)??this._viewLinesGpu?.visibleRangeForPosition(e)??null}}class pg{static firstLine(e){if(!e)return null;let t=null;for(const i of e)(!t||i.lineNumber<t.lineNumber)&&(t=i);return t}static lastLine(e){if(!e)return null;let t=null;for(const i of e)(!t||i.lineNumber>t.lineNumber)&&(t=i);return t}constructor(e,t,i,n){this.outsideRenderedLine=e,this.lineNumber=t,this.ranges=i,this.continuesOnNextLine=n}}class dr{static from(e){const t=new Array(e.length);for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=new dr(s.left,s.width)}return t}constructor(e,t){this._horizontalRangeBrand=void 0,this.left=Math.round(e),this.width=Math.round(t)}toString(){return`[${this.left},${this.width}]`}}class ln{constructor(e,t){this._floatHorizontalRangeBrand=void 0,this.left=e,this.width=t}toString(){return`[${this.left},${this.width}]`}static compare(e,t){return e.left-t.left}}class _g{constructor(e,t){this.outsideRenderedLine=e,this.originalLeft=t,this.left=Math.round(this.originalLeft)}}class Ul{constructor(e,t){this.outsideRenderedLine=e,this.ranges=t}}class kr{static _createRange(){return this._handyReadyRange||(this._handyReadyRange=document.createRange()),this._handyReadyRange}static _detachRange(e,t){e.selectNodeContents(t)}static _readClientRects(e,t,i,n,s){const o=this._createRange();try{return o.setStart(e,t),o.setEnd(i,n),o.getClientRects()}catch{return null}finally{this._detachRange(o,s)}}static _mergeAdjacentRanges(e){if(e.length===1)return e;e.sort(ln.compare);const t=[];let i=0,n=e[0];for(let s=1,o=e.length;s<o;s++){const r=e[s];n.left+n.width+.9>=r.left?n.width=Math.max(n.width,r.left+r.width-n.left):(t[i++]=n,n=r)}return t[i++]=n,t}static _createHorizontalRangesFromClientRects(e,t,i){if(!e||e.length===0)return null;const n=[];for(let s=0,o=e.length;s<o;s++){const r=e[s];n[s]=new ln(Math.max(0,(r.left-t)/i),r.width/i)}return this._mergeAdjacentRanges(n)}static readHorizontalRanges(e,t,i,n,s,o){const l=e.children.length-1;if(0>l)return null;if(t=Math.min(l,Math.max(0,t)),n=Math.min(l,Math.max(0,n)),t===n&&i===s&&i===0&&!e.children[t].firstChild){const u=e.children[t].getClientRects();return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(u,o.clientRectDeltaLeft,o.clientRectScale)}t!==n&&n>0&&s===0&&(n--,s=Jt.MAX_SAFE_SMALL_INTEGER);let d=e.children[t].firstChild,c=e.children[n].firstChild;if((!d||!c)&&(!d&&i===0&&t>0&&(d=e.children[t-1].firstChild,i=Jt.MAX_SAFE_SMALL_INTEGER),!c&&s===0&&n>0&&(c=e.children[n-1].firstChild,s=Jt.MAX_SAFE_SMALL_INTEGER)),!d||!c)return null;i=Math.min(d.textContent.length,Math.max(0,i)),s=Math.min(c.textContent.length,Math.max(0,s));const h=this._readClientRects(d,i,c,s,o.endNode);return o.markDidDomLayout(),this._createHorizontalRangesFromClientRects(h,o.clientRectDeltaLeft,o.clientRectScale)}}var xi;(function(a){a[a.IS_WHITESPACE=1]="IS_WHITESPACE",a[a.PSEUDO_BEFORE=2]="PSEUDO_BEFORE",a[a.PSEUDO_AFTER=4]="PSEUDO_AFTER",a[a.IS_WHITESPACE_MASK=1]="IS_WHITESPACE_MASK",a[a.PSEUDO_BEFORE_MASK=2]="PSEUDO_BEFORE_MASK",a[a.PSEUDO_AFTER_MASK=4]="PSEUDO_AFTER_MASK"})(xi||(xi={}));class je{constructor(e,t,i,n){this.endIndex=e,this.type=t,this.metadata=i,this.containsRTL=n,this._linePartBrand=void 0}isWhitespace(){return!!(this.metadata&xi.IS_WHITESPACE_MASK)}isPseudoAfter(){return!!(this.metadata&xi.PSEUDO_AFTER_MASK)}}class sh{constructor(e,t,i,n){this._viewportBrand=void 0,this.top=e|0,this.left=t|0,this.width=i|0,this.height=n|0}}class Ww{constructor(e,t){this.tabSize=e,this.data=t}}class qd{constructor(e,t,i,n,s,o,r){this._viewLineDataBrand=void 0,this.content=e,this.continuesWithWrappedLine=t,this.minColumn=i,this.maxColumn=n,this.startVisibleColumn=s,this.tokens=o,this.inlineDecorations=r}}class Ut{constructor(e,t,i,n,s,o,r,l,d,c){this.minColumn=e,this.maxColumn=t,this.content=i,this.continuesWithWrappedLine=n,this.isBasicASCII=Ut.isBasicASCII(i,o),this.containsRTL=Ut.containsRTL(i,this.isBasicASCII,s),this.tokens=r,this.inlineDecorations=l,this.tabSize=d,this.startVisibleColumn=c}static isBasicASCII(e,t){return t?Pf(e):!0}static containsRTL(e,t,i){return!t&&i?yl(e):!1}}var Be;(function(a){a[a.Regular=0]="Regular",a[a.Before=1]="Before",a[a.After=2]="After",a[a.RegularAffectingLetterSpacing=3]="RegularAffectingLetterSpacing"})(Be||(Be={}));class _o{constructor(e,t,i){this.range=e,this.inlineClassName=t,this.type=i}}class Vw{constructor(e,t,i,n){this.startOffset=e,this.endOffset=t,this.inlineClassName=i,this.inlineClassNameAffectsLetterSpacing=n}toInlineDecoration(e){return new _o(new N(e,this.startOffset+1,e,this.endOffset+1),this.inlineClassName,this.inlineClassNameAffectsLetterSpacing?Be.RegularAffectingLetterSpacing:Be.Regular)}}class Cg{constructor(e,t){this._viewModelDecorationBrand=void 0,this.range=e,this.options=t}}class ko{constructor(e,t,i){this.color=e,this.zIndex=t,this.data=i}static compareByRenderingProps(e,t){return e.zIndex===t.zIndex?e.color<t.color?-1:e.color>t.color?1:0:e.zIndex-t.zIndex}static equals(e,t){return e.color===t.color&&e.zIndex===t.zIndex&&Do(e.data,t.data)}static equalsArr(e,t){return Do(e,t,ko.equals)}}class ni{constructor(e,t,i,n){this.startColumn=e,this.endColumn=t,this.className=i,this.type=n,this._lineDecorationBrand=void 0}static _equals(e,t){return e.startColumn===t.startColumn&&e.endColumn===t.endColumn&&e.className===t.className&&e.type===t.type}static equalsArr(e,t){const i=e.length,n=t.length;if(i!==n)return!1;for(let s=0;s<i;s++)if(!ni._equals(e[s],t[s]))return!1;return!0}static extractWrapped(e,t,i){if(e.length===0)return e;const n=t+1,s=i+1,o=i-t,r=[];let l=0;for(const d of e)d.endColumn<=n||d.startColumn>=s||(r[l++]=new ni(Math.max(1,d.startColumn-n+1),Math.min(o+1,d.endColumn-n+1),d.className,d.type));return r}static filter(e,t,i,n){if(e.length===0)return[];const s=[];let o=0;for(let r=0,l=e.length;r<l;r++){const d=e[r],c=d.range;if(c.endLineNumber<t||c.startLineNumber>t||c.isEmpty()&&(d.type===Be.Regular||d.type===Be.RegularAffectingLetterSpacing))continue;const h=c.startLineNumber===t?c.startColumn:i,u=c.endLineNumber===t?c.endColumn:n;s[o++]=new ni(h,u,d.inlineClassName,d.type)}return s}static _typeCompare(e,t){const i=[2,0,1,3];return i[e]-i[t]}static compare(e,t){if(e.startColumn!==t.startColumn)return e.startColumn-t.startColumn;if(e.endColumn!==t.endColumn)return e.endColumn-t.endColumn;const i=ni._typeCompare(e.type,t.type);return i!==0?i:e.className!==t.className?e.className<t.className?-1:1:0}}class oh{constructor(e,t,i,n){this.startOffset=e,this.endOffset=t,this.className=i,this.metadata=n}}class Jr{constructor(){this.stopOffsets=[],this.classNames=[],this.metadata=[],this.count=0}static _metadata(e){let t=0;for(let i=0,n=e.length;i<n;i++)t|=e[i];return t}consumeLowerThan(e,t,i){for(;this.count>0&&this.stopOffsets[0]<e;){let n=0;for(;n+1<this.count&&this.stopOffsets[n]===this.stopOffsets[n+1];)n++;i.push(new oh(t,this.stopOffsets[n],this.classNames.join(" "),Jr._metadata(this.metadata))),t=this.stopOffsets[n]+1,this.stopOffsets.splice(0,n+1),this.classNames.splice(0,n+1),this.metadata.splice(0,n+1),this.count-=n+1}return this.count>0&&t<e&&(i.push(new oh(t,e-1,this.classNames.join(" "),Jr._metadata(this.metadata))),t=e),t}insert(e,t,i){if(this.count===0||this.stopOffsets[this.count-1]<=e)this.stopOffsets.push(e),this.classNames.push(t),this.metadata.push(i);else for(let n=0;n<this.count;n++)if(this.stopOffsets[n]>=e){this.stopOffsets.splice(n,0,e),this.classNames.splice(n,0,t),this.metadata.splice(n,0,i);break}this.count++}}class Fw{static normalize(e,t){if(t.length===0)return[];const i=[],n=new Jr;let s=0;for(let o=0,r=t.length;o<r;o++){const l=t[o];let d=l.startColumn,c=l.endColumn;const h=l.className,u=l.type===Be.Before?xi.PSEUDO_BEFORE:l.type===Be.After?xi.PSEUDO_AFTER:0;if(d>1){const m=e.charCodeAt(d-2);Ii(m)&&d--}if(c>1){const m=e.charCodeAt(c-2);Ii(m)&&c--}const g=d-1,f=c-2;s=n.consumeLowerThan(g,s,i),n.count===0&&(s=g),n.insert(f,h,u)}return n.consumeLowerThan(Jt.MAX_SAFE_SMALL_INTEGER,s,i),i}}var Ht;(function(a){a[a.None=0]="None",a[a.Boundary=1]="Boundary",a[a.Selection=2]="Selection",a[a.Trailing=3]="Trailing",a[a.All=4]="All"})(Ht||(Ht={}));class wg{constructor(e,t){this.startOffset=e,this.endOffset=t}equals(e){return this.startOffset===e.startOffset&&this.endOffset===e.endOffset}}class Ys{constructor(e,t,i,n,s,o,r,l,d,c,h,u,g,f,m,_,L,w,p){this.useMonospaceOptimizations=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=i,this.continuesWithWrappedLine=n,this.isBasicASCII=s,this.containsRTL=o,this.fauxIndentLength=r,this.lineTokens=l,this.lineDecorations=d.sort(ni.compare),this.tabSize=c,this.startVisibleColumn=h,this.spaceWidth=u,this.stopRenderingLineAfter=m,this.renderWhitespace=_==="all"?Ht.All:_==="boundary"?Ht.Boundary:_==="selection"?Ht.Selection:_==="trailing"?Ht.Trailing:Ht.None,this.renderControlCharacters=L,this.fontLigatures=w,this.selectionsOnLine=p&&p.sort((S,y)=>S.startOffset<y.startOffset?-1:1);const C=Math.abs(f-u),b=Math.abs(g-u);C<b?(this.renderSpaceWidth=f,this.renderSpaceCharCode=11825):(this.renderSpaceWidth=g,this.renderSpaceCharCode=183)}sameSelection(e){if(this.selectionsOnLine===null)return e===null;if(e===null||e.length!==this.selectionsOnLine.length)return!1;for(let t=0;t<this.selectionsOnLine.length;t++)if(!this.selectionsOnLine[t].equals(e[t]))return!1;return!0}equals(e){return this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineContent===e.lineContent&&this.continuesWithWrappedLine===e.continuesWithWrappedLine&&this.isBasicASCII===e.isBasicASCII&&this.containsRTL===e.containsRTL&&this.fauxIndentLength===e.fauxIndentLength&&this.tabSize===e.tabSize&&this.startVisibleColumn===e.startVisibleColumn&&this.spaceWidth===e.spaceWidth&&this.renderSpaceWidth===e.renderSpaceWidth&&this.renderSpaceCharCode===e.renderSpaceCharCode&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.fontLigatures===e.fontLigatures&&ni.equalsArr(this.lineDecorations,e.lineDecorations)&&this.lineTokens.equals(e.lineTokens)&&this.sameSelection(e.selectionsOnLine)}}var Si;(function(a){a[a.PART_INDEX_MASK=4294901760]="PART_INDEX_MASK",a[a.CHAR_INDEX_MASK=65535]="CHAR_INDEX_MASK",a[a.CHAR_INDEX_OFFSET=0]="CHAR_INDEX_OFFSET",a[a.PART_INDEX_OFFSET=16]="PART_INDEX_OFFSET"})(Si||(Si={}));class Lg{constructor(e,t){this.partIndex=e,this.charIndex=t}}class Yt{static getPartIndex(e){return(e&Si.PART_INDEX_MASK)>>>Si.PART_INDEX_OFFSET}static getCharIndex(e){return(e&Si.CHAR_INDEX_MASK)>>>Si.CHAR_INDEX_OFFSET}constructor(e,t){this.length=e,this._data=new Uint32Array(this.length),this._horizontalOffset=new Uint32Array(this.length)}setColumnInfo(e,t,i,n){const s=(t<<Si.PART_INDEX_OFFSET|i<<Si.CHAR_INDEX_OFFSET)>>>0;this._data[e-1]=s,this._horizontalOffset[e-1]=n}getHorizontalOffset(e){return this._horizontalOffset.length===0?0:this._horizontalOffset[e-1]}charOffsetToPartData(e){return this.length===0?0:e<0?this._data[0]:e>=this.length?this._data[this.length-1]:this._data[e]}getDomPosition(e){const t=this.charOffsetToPartData(e-1),i=Yt.getPartIndex(t),n=Yt.getCharIndex(t);return new Lg(i,n)}getColumn(e,t){return this.partDataToCharOffset(e.partIndex,t,e.charIndex)+1}partDataToCharOffset(e,t,i){if(this.length===0)return 0;const n=(e<<Si.PART_INDEX_OFFSET|i<<Si.CHAR_INDEX_OFFSET)>>>0;let s=0,o=this.length-1;for(;s+1<o;){const m=s+o>>>1,_=this._data[m];if(_===n)return m;_>n?o=m:s=m}if(s===o)return s;const r=this._data[s],l=this._data[o];if(r===n)return s;if(l===n)return o;const d=Yt.getPartIndex(r),c=Yt.getCharIndex(r),h=Yt.getPartIndex(l);let u;d!==h?u=t:u=Yt.getCharIndex(l);const g=i-c,f=u-i;return g<=f?s:o}inflate(){const e=[];for(let t=0;t<this.length;t++){const i=this._data[t],n=Yt.getPartIndex(i),s=Yt.getCharIndex(i),o=this._horizontalOffset[t];e.push([n,s,o])}return e}}var Et;(function(a){a[a.None=0]="None",a[a.Before=1]="Before",a[a.After=2]="After"})(Et||(Et={}));class Gl{constructor(e,t,i){this._renderLineOutputBrand=void 0,this.characterMapping=e,this.containsRTL=t,this.containsForeignElements=i}}function Xd(a,e){if(a.lineContent.length===0){if(a.lineDecorations.length>0){e.appendString("<span>");let t=0,i=0,n=Et.None;for(const o of a.lineDecorations)(o.type===Be.Before||o.type===Be.After)&&(e.appendString('<span class="'),e.appendString(o.className),e.appendString('"></span>'),o.type===Be.Before&&(n|=Et.Before,t++),o.type===Be.After&&(n|=Et.After,i++));e.appendString("</span>");const s=new Yt(1,t+i);return s.setColumnInfo(1,t,0,0),new Gl(s,!1,n)}return e.appendString("<span><span></span></span>"),new Gl(new Yt(0,0),!1,Et.None)}return Zw(zw(a),e)}class Hw{constructor(e,t,i,n){this.characterMapping=e,this.html=t,this.containsRTL=i,this.containsForeignElements=n}}function Fa(a){const e=new Jo(1e4),t=Xd(a,e);return new Hw(t.characterMapping,e.build(),t.containsRTL,t.containsForeignElements)}class Bw{constructor(e,t,i,n,s,o,r,l,d,c,h,u,g,f,m,_){this.fontIsMonospace=e,this.canUseHalfwidthRightwardsArrow=t,this.lineContent=i,this.len=n,this.isOverflowing=s,this.overflowingCharCount=o,this.parts=r,this.containsForeignElements=l,this.fauxIndentLength=d,this.tabSize=c,this.startVisibleColumn=h,this.containsRTL=u,this.spaceWidth=g,this.renderSpaceCharCode=f,this.renderWhitespace=m,this.renderControlCharacters=_}}function zw(a){const e=a.lineContent;let t,i,n;a.stopRenderingLineAfter!==-1&&a.stopRenderingLineAfter<e.length?(t=!0,i=e.length-a.stopRenderingLineAfter,n=a.stopRenderingLineAfter):(t=!1,i=0,n=e.length);let s=Uw(e,a.containsRTL,a.lineTokens,a.fauxIndentLength,n);a.renderControlCharacters&&!a.isBasicASCII&&(s=jw(e,s)),(a.renderWhitespace===Ht.All||a.renderWhitespace===Ht.Boundary||a.renderWhitespace===Ht.Selection&&a.selectionsOnLine||a.renderWhitespace===Ht.Trailing&&!a.continuesWithWrappedLine)&&(s=Kw(a,e,n,s));let o=Et.None;if(a.lineDecorations.length>0){for(let r=0,l=a.lineDecorations.length;r<l;r++){const d=a.lineDecorations[r];d.type===Be.RegularAffectingLetterSpacing||d.type===Be.Before?o|=Et.Before:d.type===Be.After&&(o|=Et.After)}s=$w(e,n,s,a.lineDecorations)}return a.containsRTL||(s=Gw(e,s,!a.isBasicASCII||a.fontLigatures)),new Bw(a.useMonospaceOptimizations,a.canUseHalfwidthRightwardsArrow,e,n,t,i,s,o,a.fauxIndentLength,a.tabSize,a.startVisibleColumn,a.containsRTL,a.spaceWidth,a.renderSpaceCharCode,a.renderWhitespace,a.renderControlCharacters)}function Uw(a,e,t,i,n){const s=[];let o=0;i>0&&(s[o++]=new je(i,"",0,!1));let r=i;for(let l=0,d=t.getCount();l<d;l++){const c=t.getEndOffset(l);if(c<=i)continue;const h=t.getClassName(l);if(c>=n){const g=e?yl(a.substring(r,n)):!1;s[o++]=new je(n,h,0,g);break}const u=e?yl(a.substring(r,c)):!1;s[o++]=new je(c,h,0,u),r=c}return s}var Nn;(function(a){a[a.LongToken=50]="LongToken"})(Nn||(Nn={}));function Gw(a,e,t){let i=0;const n=[];let s=0;if(t)for(let o=0,r=e.length;o<r;o++){const l=e[o],d=l.endIndex;if(i+Nn.LongToken<d){const c=l.type,h=l.metadata,u=l.containsRTL;let g=-1,f=i;for(let m=i;m<d;m++)a.charCodeAt(m)===V.Space&&(g=m),g!==-1&&m-f>=Nn.LongToken&&(n[s++]=new je(g+1,c,h,u),f=g+1,g=-1);f!==d&&(n[s++]=new je(d,c,h,u))}else n[s++]=l;i=d}else for(let o=0,r=e.length;o<r;o++){const l=e[o],d=l.endIndex,c=d-i;if(c>Nn.LongToken){const h=l.type,u=l.metadata,g=l.containsRTL,f=Math.ceil(c/Nn.LongToken);for(let m=1;m<f;m++){const _=i+m*Nn.LongToken;n[s++]=new je(_,h,u,g)}n[s++]=new je(d,h,u,g)}else n[s++]=l;i=d}return n}function vg(a){return a<32?a!==V.Tab:a===127||a>=8234&&a<=8238||a>=8294&&a<=8297||a>=8206&&a<=8207||a===1564}function jw(a,e){const t=[];let i=new je(0,"",0,!1),n=0;for(const s of e){const o=s.endIndex;for(;n<o;n++){const r=a.charCodeAt(n);vg(r)&&(n>i.endIndex&&(i=new je(n,s.type,s.metadata,s.containsRTL),t.push(i)),i=new je(n+1,"mtkcontrol",s.metadata,!1),t.push(i))}n>i.endIndex&&(i=new je(o,s.type,s.metadata,s.containsRTL),t.push(i))}return t}function Kw(a,e,t,i){const n=a.continuesWithWrappedLine,s=a.fauxIndentLength,o=a.tabSize,r=a.startVisibleColumn,l=a.useMonospaceOptimizations,d=a.selectionsOnLine,c=a.renderWhitespace===Ht.Boundary,h=a.renderWhitespace===Ht.Trailing,u=a.renderSpaceWidth!==a.spaceWidth,g=[];let f=0,m=0,_=i[m].type,L=i[m].containsRTL,w=i[m].endIndex;const p=i.length;let C=!1,b=zi(e),S;b===-1?(C=!0,b=t,S=t):S=Qo(e);let y=!1,E=0,x=d&&d[E],R=r%o;for(let A=s;A<t;A++){const W=e.charCodeAt(A);x&&A>=x.endOffset&&(E++,x=d&&d[E]);let H;if(A<b||A>S)H=!0;else if(W===V.Tab)H=!0;else if(W===V.Space)if(c)if(y)H=!0;else{const G=A+1<t?e.charCodeAt(A+1):V.Null;H=G===V.Space||G===V.Tab}else H=!0;else H=!1;if(H&&d&&(H=!!x&&x.startOffset<=A&&x.endOffset>A),H&&h&&(H=C||A>S),H&&L&&A>=b&&A<=S&&(H=!1),y){if(!H||!l&&R>=o){if(u){const G=f>0?g[f-1].endIndex:s;for(let oe=G+1;oe<=A;oe++)g[f++]=new je(oe,"mtkw",xi.IS_WHITESPACE,!1)}else g[f++]=new je(A,"mtkw",xi.IS_WHITESPACE,!1);R=R%o}}else(A===w||H&&A>s)&&(g[f++]=new je(A,_,0,L),R=R%o);for(W===V.Tab?R=o:Yn(W)?R+=2:R++,y=H;A===w&&(m++,m<p);)_=i[m].type,L=i[m].containsRTL,w=i[m].endIndex}let D=!1;if(y)if(n&&c){const A=t>0?e.charCodeAt(t-1):V.Null,W=t>1?e.charCodeAt(t-2):V.Null;A===V.Space&&W!==V.Space&&W!==V.Tab||(D=!0)}else D=!0;if(D)if(u){const A=f>0?g[f-1].endIndex:s;for(let W=A+1;W<=t;W++)g[f++]=new je(W,"mtkw",xi.IS_WHITESPACE,!1)}else g[f++]=new je(t,"mtkw",xi.IS_WHITESPACE,!1);else g[f++]=new je(t,_,0,L);return g}function $w(a,e,t,i){i.sort(ni.compare);const n=Fw.normalize(a,i),s=n.length;let o=0;const r=[];let l=0,d=0;for(let h=0,u=t.length;h<u;h++){const g=t[h],f=g.endIndex,m=g.type,_=g.metadata,L=g.containsRTL;for(;o<s&&n[o].startOffset<f;){const w=n[o];if(w.startOffset>d&&(d=w.startOffset,r[l++]=new je(d,m,_,L)),w.endOffset+1<=f)d=w.endOffset+1,r[l++]=new je(d,m+" "+w.className,_|w.metadata,L),o++;else{d=f,r[l++]=new je(d,m+" "+w.className,_|w.metadata,L);break}}f>d&&(d=f,r[l++]=new je(d,m,_,L))}const c=t[t.length-1].endIndex;if(o<s&&n[o].startOffset===c)for(;o<s&&n[o].startOffset===c;){const h=n[o];r[l++]=new je(d,h.className,h.metadata,!1),o++}return r}function Zw(a,e){const t=a.fontIsMonospace,i=a.canUseHalfwidthRightwardsArrow,n=a.containsForeignElements,s=a.lineContent,o=a.len,r=a.isOverflowing,l=a.overflowingCharCount,d=a.parts,c=a.fauxIndentLength,h=a.tabSize,u=a.startVisibleColumn,g=a.containsRTL,f=a.spaceWidth,m=a.renderSpaceCharCode,_=a.renderWhitespace,L=a.renderControlCharacters,w=new Yt(o+1,d.length);let p=!1,C=0,b=u,S=0,y=0,E=0;g?e.appendString('<span dir="ltr">'):e.appendString("<span>");for(let x=0,R=d.length;x<R;x++){const D=d[x],A=D.endIndex,W=D.type,H=D.containsRTL,G=_!==Ht.None&&D.isWhitespace(),oe=G&&!t&&(W==="mtkw"||!n),X=C===A&&D.isPseudoAfter();if(S=0,e.appendString("<span "),H&&e.appendString('style="unicode-bidi:isolate" '),e.appendString('class="'),e.appendString(oe?"mtkz":W),e.appendASCIICharCode(V.DoubleQuote),G){let te=0;{let F=C,Q=b;for(;F<A;F++){const Pt=(s.charCodeAt(F)===V.Tab?h-Q%h:1)|0;te+=Pt,F>=c&&(Q+=Pt)}}for(oe&&(e.appendString(' style="width:'),e.appendString(String(f*te)),e.appendString('px"')),e.appendASCIICharCode(V.GreaterThan);C<A;C++){w.setColumnInfo(C+1,x-E,S,y),E=0;const F=s.charCodeAt(C);let Q,ve;if(F===V.Tab){Q=h-b%h|0,ve=Q,!i||ve>1?e.appendCharCode(8594):e.appendCharCode(65515);for(let Pt=2;Pt<=ve;Pt++)e.appendCharCode(160)}else Q=2,ve=1,e.appendCharCode(m),e.appendCharCode(8204);S+=Q,y+=ve,C>=c&&(b+=ve)}}else for(e.appendASCIICharCode(V.GreaterThan);C<A;C++){w.setColumnInfo(C+1,x-E,S,y),E=0;const te=s.charCodeAt(C);let F=1,Q=1;switch(te){case V.Tab:F=h-b%h,Q=F;for(let ve=1;ve<=F;ve++)e.appendCharCode(160);break;case V.Space:e.appendCharCode(160);break;case V.LessThan:e.appendString("&lt;");break;case V.GreaterThan:e.appendString("&gt;");break;case V.Ampersand:e.appendString("&amp;");break;case V.Null:L?e.appendCharCode(9216):e.appendString("&#00;");break;case V.UTF8_BOM:case V.LINE_SEPARATOR:case V.PARAGRAPH_SEPARATOR:case V.NEXT_LINE:e.appendCharCode(65533);break;default:Yn(te)&&Q++,L&&te<32?e.appendCharCode(9216+te):L&&te===127?e.appendCharCode(9249):L&&vg(te)?(e.appendString("[U+"),e.appendString(qw(te)),e.appendString("]"),F=8,Q=F):e.appendCharCode(te)}S+=F,y+=Q,C>=c&&(b+=Q)}X?E++:E=0,C>=o&&!p&&D.isPseudoAfter()&&(p=!0,w.setColumnInfo(C+1,x,S,y)),e.appendString("</span>")}return p||w.setColumnInfo(o+1,d.length-1,S,y),r&&(e.appendString('<span class="mtkoverflow">'),e.appendString(O(867,"Show more ({0})",Xw(l))),e.appendString("</span>")),e.appendString("</span>"),new Gl(w,g,n)}function qw(a){return a.toString(16).toUpperCase().padStart(4,"0")}function Xw(a){return a<1024?O(868,"{0} chars",a):a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/1024/1024).toFixed(1)} MB`}const Yw=function(){return kf?!0:!(Ea||hn||To)}();let Es=!0;class Pi{static{this.CLASS_NAME="view-line"}constructor(e,t){this._viewGpuContext=e,this._options=t,this._isMaybeInvalid=!0,this._renderedViewLine=null}getDomNode(){return this._renderedViewLine&&this._renderedViewLine.domNode?this._renderedViewLine.domNode.domNode:null}setDomNode(e){if(this._renderedViewLine)this._renderedViewLine.domNode=fe(e);else throw new Error("I have no rendered view line to set the dom node to...")}onContentChanged(){this._isMaybeInvalid=!0}onTokensChanged(){this._isMaybeInvalid=!0}onDecorationsChanged(){this._isMaybeInvalid=!0}onOptionsChanged(e){this._isMaybeInvalid=!0,this._options=e}onSelectionChanged(){return fo(this._options.themeType)||this._options.renderWhitespace==="selection"?(this._isMaybeInvalid=!0,!0):!1}renderLine(e,t,i,n,s){if(this._options.useGpu&&this._viewGpuContext?.canRender(this._options,n,e))return this._renderedViewLine?.domNode?.domNode.remove(),this._renderedViewLine=null,!1;if(this._isMaybeInvalid===!1)return!1;this._isMaybeInvalid=!1;const o=n.getViewLineRenderingData(e),r=this._options,l=ni.filter(o.inlineDecorations,e,o.minColumn,o.maxColumn);let d=null;if(fo(r.themeType)||this._options.renderWhitespace==="selection"){const g=n.selections;for(const f of g){if(f.endLineNumber<e||f.startLineNumber>e)continue;const m=f.startLineNumber===e?f.startColumn:o.minColumn,_=f.endLineNumber===e?f.endColumn:o.maxColumn;m<_&&(fo(r.themeType)&&l.push(new ni(m,_,"inline-selected-text",Be.Regular)),this._options.renderWhitespace==="selection"&&(d||(d=[]),d.push(new wg(m-1,_-1))))}}const c=new Ys(r.useMonospaceOptimizations,r.canUseHalfwidthRightwardsArrow,o.content,o.continuesWithWrappedLine,o.isBasicASCII,o.containsRTL,o.minColumn-1,o.tokens,l,o.tabSize,o.startVisibleColumn,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,r.stopRenderingLineAfter,r.renderWhitespace,r.renderControlCharacters,r.fontLigatures!==Na.OFF,d);if(this._renderedViewLine&&this._renderedViewLine.input.equals(c))return!1;s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString("px;line-height:"),s.appendString(String(i)),s.appendString('px;" class="'),s.appendString(Pi.CLASS_NAME),s.appendString('">');const h=Xd(c,s);s.appendString("</div>");let u=null;return Es&&Yw&&o.isBasicASCII&&r.useMonospaceOptimizations&&h.containsForeignElements===Et.None&&(u=new wr(this._renderedViewLine?this._renderedViewLine.domNode:null,c,h.characterMapping)),u||(u=Sg(this._renderedViewLine?this._renderedViewLine.domNode:null,c,h.characterMapping,h.containsRTL,h.containsForeignElements)),this._renderedViewLine=u,!0}layoutLine(e,t,i){this._renderedViewLine&&this._renderedViewLine.domNode&&(this._renderedViewLine.domNode.setTop(t),this._renderedViewLine.domNode.setHeight(i),this._renderedViewLine.domNode.setLineHeight(i))}getWidth(e){return this._renderedViewLine?this._renderedViewLine.getWidth(e):0}getWidthIsFast(){return this._renderedViewLine?this._renderedViewLine.getWidthIsFast():!0}needsMonospaceFontCheck(){return this._renderedViewLine?this._renderedViewLine instanceof wr:!1}monospaceAssumptionsAreValid(){return this._renderedViewLine&&this._renderedViewLine instanceof wr?this._renderedViewLine.monospaceAssumptionsAreValid():Es}onMonospaceAssumptionsInvalidated(){this._renderedViewLine&&this._renderedViewLine instanceof wr&&(this._renderedViewLine=this._renderedViewLine.toSlowRenderedLine())}getVisibleRangesForRange(e,t,i,n){if(!this._renderedViewLine)return null;t=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,t)),i=Math.min(this._renderedViewLine.input.lineContent.length+1,Math.max(1,i));const s=this._renderedViewLine.input.stopRenderingLineAfter;if(s!==-1&&t>s+1&&i>s+1)return new Ul(!0,[new ln(this.getWidth(n),0)]);s!==-1&&t>s+1&&(t=s+1),s!==-1&&i>s+1&&(i=s+1);const o=this._renderedViewLine.getVisibleRangesForRange(e,t,i,n);return o&&o.length>0?new Ul(!1,o):null}getColumnOfNodeOffset(e,t){return this._renderedViewLine?this._renderedViewLine.getColumnOfNodeOffset(e,t):1}}var Ai;(function(a){a[a.MaxMonospaceDistance=300]="MaxMonospaceDistance"})(Ai||(Ai={}));class wr{constructor(e,t,i){this._cachedWidth=-1,this.domNode=e,this.input=t;const n=Math.floor(t.lineContent.length/Ai.MaxMonospaceDistance);if(n>0){this._keyColumnPixelOffsetCache=new Float32Array(n);for(let s=0;s<n;s++)this._keyColumnPixelOffsetCache[s]=-1}else this._keyColumnPixelOffsetCache=null;this._characterMapping=i,this._charWidth=t.spaceWidth}getWidth(e){if(!this.domNode||this.input.lineContent.length<Ai.MaxMonospaceDistance){const t=this._characterMapping.getHorizontalOffset(this._characterMapping.length);return Math.round(this._charWidth*t)}return this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e?.markDidDomLayout()),this._cachedWidth}getWidthIsFast(){return this.input.lineContent.length<Ai.MaxMonospaceDistance||this._cachedWidth!==-1}monospaceAssumptionsAreValid(){if(!this.domNode)return Es;if(this.input.lineContent.length<Ai.MaxMonospaceDistance){const e=this.getWidth(null),t=this.domNode.domNode.firstChild.offsetWidth;Math.abs(e-t)>=2&&(console.warn("monospace assumptions have been violated, therefore disabling monospace optimizations!"),Es=!1)}return Es}toSlowRenderedLine(){return Sg(this.domNode,this.input,this._characterMapping,!1,Et.None)}getVisibleRangesForRange(e,t,i,n){const s=this._getColumnPixelOffset(e,t,n),o=this._getColumnPixelOffset(e,i,n);return[new ln(s,o-s)]}_getColumnPixelOffset(e,t,i){if(t<=Ai.MaxMonospaceDistance){const d=this._characterMapping.getHorizontalOffset(t);return this._charWidth*d}const n=Math.floor((t-1)/Ai.MaxMonospaceDistance)-1,s=(n+1)*Ai.MaxMonospaceDistance+1;let o=-1;if(this._keyColumnPixelOffsetCache&&(o=this._keyColumnPixelOffsetCache[n],o===-1&&(o=this._actualReadPixelOffset(e,s,i),this._keyColumnPixelOffsetCache[n]=o)),o===-1){const d=this._characterMapping.getHorizontalOffset(t);return this._charWidth*d}const r=this._characterMapping.getHorizontalOffset(s),l=this._characterMapping.getHorizontalOffset(t);return o+this._charWidth*(l-r)}_getReadingTarget(e){return e.domNode.firstChild}_actualReadPixelOffset(e,t,i){if(!this.domNode)return-1;const n=this._characterMapping.getDomPosition(t),s=kr.readHorizontalRanges(this._getReadingTarget(this.domNode),n.partIndex,n.charIndex,n.partIndex,n.charIndex,i);return!s||s.length===0?-1:s[0].left}getColumnOfNodeOffset(e,t){return yg(this._characterMapping,e,t)}}class bg{constructor(e,t,i,n,s){if(this.domNode=e,this.input=t,this._characterMapping=i,this._isWhitespaceOnly=/^\s*$/.test(t.lineContent),this._containsForeignElements=s,this._cachedWidth=-1,this._pixelOffsetCache=null,!n||this._characterMapping.length===0){this._pixelOffsetCache=new Float32Array(Math.max(2,this._characterMapping.length+1));for(let o=0,r=this._characterMapping.length;o<=r;o++)this._pixelOffsetCache[o]=-1}}_getReadingTarget(e){return e.domNode.firstChild}getWidth(e){return this.domNode?(this._cachedWidth===-1&&(this._cachedWidth=this._getReadingTarget(this.domNode).offsetWidth,e?.markDidDomLayout()),this._cachedWidth):0}getWidthIsFast(){return this._cachedWidth!==-1}getVisibleRangesForRange(e,t,i,n){if(!this.domNode)return null;if(this._pixelOffsetCache!==null){const s=this._readPixelOffset(this.domNode,e,t,n);if(s===-1)return null;const o=this._readPixelOffset(this.domNode,e,i,n);return o===-1?null:[new ln(s,o-s)]}return this._readVisibleRangesForRange(this.domNode,e,t,i,n)}_readVisibleRangesForRange(e,t,i,n,s){if(i===n){const o=this._readPixelOffset(e,t,i,s);return o===-1?null:[new ln(o,0)]}else return this._readRawVisibleRangesForRange(e,i,n,s)}_readPixelOffset(e,t,i,n){if(this._characterMapping.length===0){if(this._containsForeignElements===Et.None||this._containsForeignElements===Et.After)return 0;if(this._containsForeignElements===Et.Before)return this.getWidth(n);const s=this._getReadingTarget(e);return s.firstChild?(n.markDidDomLayout(),s.firstChild.offsetWidth):0}if(this._pixelOffsetCache!==null){const s=this._pixelOffsetCache[i];if(s!==-1)return s;const o=this._actualReadPixelOffset(e,t,i,n);return this._pixelOffsetCache[i]=o,o}return this._actualReadPixelOffset(e,t,i,n)}_actualReadPixelOffset(e,t,i,n){if(this._characterMapping.length===0){const l=kr.readHorizontalRanges(this._getReadingTarget(e),0,0,0,0,n);return!l||l.length===0?-1:l[0].left}if(i===this._characterMapping.length&&this._isWhitespaceOnly&&this._containsForeignElements===Et.None)return this.getWidth(n);const s=this._characterMapping.getDomPosition(i),o=kr.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,s.partIndex,s.charIndex,n);if(!o||o.length===0)return-1;const r=o[0].left;if(this.input.isBasicASCII){const l=this._characterMapping.getHorizontalOffset(i),d=Math.round(this.input.spaceWidth*l);if(Math.abs(d-r)<=1)return d}return r}_readRawVisibleRangesForRange(e,t,i,n){if(t===1&&i===this._characterMapping.length)return[new ln(0,this.getWidth(n))];const s=this._characterMapping.getDomPosition(t),o=this._characterMapping.getDomPosition(i);return kr.readHorizontalRanges(this._getReadingTarget(e),s.partIndex,s.charIndex,o.partIndex,o.charIndex,n)}getColumnOfNodeOffset(e,t){return yg(this._characterMapping,e,t)}}class Qw extends bg{_readVisibleRangesForRange(e,t,i,n,s){const o=super._readVisibleRangesForRange(e,t,i,n,s);if(!o||o.length===0||i===n||i===1&&n===this._characterMapping.length)return o;if(!this.input.containsRTL){const r=this._readPixelOffset(e,t,n,s);if(r!==-1){const l=o[o.length-1];l.left<r&&(l.width=r-l.left)}}return o}}const Sg=function(){return vu?Jw:eL}();function Jw(a,e,t,i,n){return new Qw(a,e,t,i,n)}function eL(a,e,t,i,n){return new bg(a,e,t,i,n)}function yg(a,e,t){const i=e.textContent.length;let n=-1;for(;e;)e=e.previousSibling,n++;return a.getColumn(new Lg(n,t),i)}var dn;(function(a){a[a.Left=0]="Left",a[a.Right=1]="Right",a[a.Nearest=2]="Nearest"})(dn||(dn={}));class Wo{static whitespaceVisibleColumn(e,t,i){const n=e.length;let s=0,o=-1,r=-1;for(let l=0;l<n;l++){if(l===t)return[o,r,s];switch(s%i===0&&(o=l,r=s),e.charCodeAt(l)){case V.Space:s+=1;break;case V.Tab:s=We.nextRenderTabStop(s,i);break;default:return[-1,-1,-1]}}return t===n?[o,r,s]:[-1,-1,-1]}static atomicPosition(e,t,i,n){const s=e.length,[o,r,l]=Wo.whitespaceVisibleColumn(e,t,i);if(l===-1)return-1;let d;switch(n){case dn.Left:d=!0;break;case dn.Right:d=!1;break;case dn.Nearest:if(l%i===0)return t;d=l%i<=i/2;break}if(d){if(o===-1)return-1;let u=r;for(let g=o;g<s;++g){if(u===r+i)return o;switch(e.charCodeAt(g)){case V.Space:u+=1;break;case V.Tab:u=We.nextRenderTabStop(u,i);break;default:return-1}}return u===r+i?o:-1}const c=We.nextRenderTabStop(l,i);let h=l;for(let u=t;u<s;u++){if(h===c)return u;switch(e.charCodeAt(u)){case V.Space:h+=1;break;case V.Tab:h=We.nextRenderTabStop(h,i);break;default:return-1}}return h===c?s:-1}}var Kn;(function(a){a[a.Unknown=0]="Unknown",a[a.Content=1]="Content"})(Kn||(Kn={}));class qi{constructor(e=null){this.hitTarget=e,this.type=Kn.Unknown}}class xg{get hitTarget(){return this.spanNode}constructor(e,t,i){this.position=e,this.spanNode=t,this.injectedText=i,this.type=Kn.Content}}var En;(function(a){function e(t,i,n){const s=t.getPositionFromDOMInfo(i,n);return s?new xg(s,i,null):new qi(i)}a.createFromDOMInfo=e})(En||(En={}));class tL{constructor(e,t){this.lastViewCursorsRenderData=e,this.lastTextareaPosition=t}}class ht{static _deduceRage(e,t=null){return!t&&e?new N(e.lineNumber,e.column,e.lineNumber,e.column):t??null}static createUnknown(e,t,i){return{type:ee.UNKNOWN,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createTextarea(e,t){return{type:ee.TEXTAREA,element:e,mouseColumn:t,position:null,range:null}}static createMargin(e,t,i,n,s,o){return{type:e,element:t,mouseColumn:i,position:n,range:s,detail:o}}static createViewZone(e,t,i,n,s){return{type:e,element:t,mouseColumn:i,position:n,range:this._deduceRage(n),detail:s}}static createContentText(e,t,i,n,s){return{type:ee.CONTENT_TEXT,element:e,mouseColumn:t,position:i,range:this._deduceRage(i,n),detail:s}}static createContentEmpty(e,t,i,n){return{type:ee.CONTENT_EMPTY,element:e,mouseColumn:t,position:i,range:this._deduceRage(i),detail:n}}static createContentWidget(e,t,i){return{type:ee.CONTENT_WIDGET,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createScrollbar(e,t,i){return{type:ee.SCROLLBAR,element:e,mouseColumn:t,position:i,range:this._deduceRage(i)}}static createOverlayWidget(e,t,i){return{type:ee.OVERLAY_WIDGET,element:e,mouseColumn:t,position:null,range:null,detail:i}}static createOutsideEditor(e,t,i,n){return{type:ee.OUTSIDE_EDITOR,element:null,mouseColumn:e,position:t,range:this._deduceRage(t),outsidePosition:i,outsideDistance:n}}static _typeToString(e){return e===ee.TEXTAREA?"TEXTAREA":e===ee.GUTTER_GLYPH_MARGIN?"GUTTER_GLYPH_MARGIN":e===ee.GUTTER_LINE_NUMBERS?"GUTTER_LINE_NUMBERS":e===ee.GUTTER_LINE_DECORATIONS?"GUTTER_LINE_DECORATIONS":e===ee.GUTTER_VIEW_ZONE?"GUTTER_VIEW_ZONE":e===ee.CONTENT_TEXT?"CONTENT_TEXT":e===ee.CONTENT_EMPTY?"CONTENT_EMPTY":e===ee.CONTENT_VIEW_ZONE?"CONTENT_VIEW_ZONE":e===ee.CONTENT_WIDGET?"CONTENT_WIDGET":e===ee.OVERVIEW_RULER?"OVERVIEW_RULER":e===ee.SCROLLBAR?"SCROLLBAR":e===ee.OVERLAY_WIDGET?"OVERLAY_WIDGET":"UNKNOWN"}static toString(e){return this._typeToString(e.type)+": "+e.position+" - "+e.range+" - "+JSON.stringify(e.detail)}}class pt{static isTextArea(e){return e.length===2&&e[0]===xe.OverflowGuard&&e[1]===xe.TextArea}static isChildOfViewLines(e){return e.length>=4&&e[0]===xe.OverflowGuard&&e[3]===xe.ViewLines}static isStrictChildOfViewLines(e){return e.length>4&&e[0]===xe.OverflowGuard&&e[3]===xe.ViewLines}static isChildOfScrollableElement(e){return e.length>=2&&e[0]===xe.OverflowGuard&&e[1]===xe.ScrollableElement}static isChildOfMinimap(e){return e.length>=2&&e[0]===xe.OverflowGuard&&e[1]===xe.Minimap}static isChildOfContentWidgets(e){return e.length>=4&&e[0]===xe.OverflowGuard&&e[3]===xe.ContentWidgets}static isChildOfOverflowGuard(e){return e.length>=1&&e[0]===xe.OverflowGuard}static isChildOfOverflowingContentWidgets(e){return e.length>=1&&e[0]===xe.OverflowingContentWidgets}static isChildOfOverlayWidgets(e){return e.length>=2&&e[0]===xe.OverflowGuard&&e[1]===xe.OverlayWidgets}static isChildOfOverflowingOverlayWidgets(e){return e.length>=1&&e[0]===xe.OverflowingOverlayWidgets}}class Ws{constructor(e,t,i){this.viewModel=e.viewModel;const n=e.configuration.options;this.layoutInfo=n.get(v.layoutInfo),this.viewDomNode=t.viewDomNode,this.viewLinesGpu=t.viewLinesGpu,this.lineHeight=n.get(v.lineHeight),this.stickyTabStops=n.get(v.stickyTabStops),this.typicalHalfwidthCharacterWidth=n.get(v.fontInfo).typicalHalfwidthCharacterWidth,this.lastRenderData=i,this._context=e,this._viewHelper=t}getZoneAtCoord(e){return Ws.getZoneAtCoord(this._context,e)}static getZoneAtCoord(e,t){const i=e.viewLayout.getWhitespaceAtVerticalOffset(t);if(i){const n=i.verticalOffset+i.height/2,s=e.viewModel.getLineCount();let o=null,r,l=null;return i.afterLineNumber!==s&&(l=new I(i.afterLineNumber+1,1)),i.afterLineNumber>0&&(o=new I(i.afterLineNumber,e.viewModel.getLineMaxColumn(i.afterLineNumber))),l===null?r=o:o===null?r=l:t<n?r=o:r=l,{viewZoneId:i.id,afterLineNumber:i.afterLineNumber,positionBefore:o,positionAfter:l,position:r}}return null}getFullLineRangeAtCoord(e){if(this._context.viewLayout.isAfterLines(e)){const n=this._context.viewModel.getLineCount(),s=this._context.viewModel.getLineMaxColumn(n);return{range:new N(n,s,n,s),isAfterLines:!0}}const t=this._context.viewLayout.getLineNumberAtVerticalOffset(e),i=this._context.viewModel.getLineMaxColumn(t);return{range:new N(t,1,t,i),isAfterLines:!1}}getLineNumberAtVerticalOffset(e){return this._context.viewLayout.getLineNumberAtVerticalOffset(e)}isAfterLines(e){return this._context.viewLayout.isAfterLines(e)}isInTopPadding(e){return this._context.viewLayout.isInTopPadding(e)}isInBottomPadding(e){return this._context.viewLayout.isInBottomPadding(e)}getVerticalOffsetForLineNumber(e){return this._context.viewLayout.getVerticalOffsetForLineNumber(e)}findAttribute(e,t){return Ws._findAttribute(e,t,this._viewHelper.viewDomNode)}static _findAttribute(e,t,i){for(;e&&e!==e.ownerDocument.body;){if(e.hasAttribute&&e.hasAttribute(t))return e.getAttribute(t);if(e===i)return null;e=e.parentNode}return null}getLineWidth(e){return this._viewHelper.getLineWidth(e)}visibleRangeForPosition(e,t){return this._viewHelper.visibleRangeForPosition(e,t)}getPositionFromDOMInfo(e,t){return this._viewHelper.getPositionFromDOMInfo(e,t)}getCurrentScrollTop(){return this._context.viewLayout.getCurrentScrollTop()}getCurrentScrollLeft(){return this._context.viewLayout.getCurrentScrollLeft()}}class iL{constructor(e,t,i,n){this.editorPos=t,this.pos=i,this.relativePos=n,this.mouseVerticalOffset=Math.max(0,e.getCurrentScrollTop()+this.relativePos.y),this.mouseContentHorizontalOffset=e.getCurrentScrollLeft()+this.relativePos.x-e.layoutInfo.contentLeft,this.isInMarginArea=this.relativePos.x<e.layoutInfo.contentLeft&&this.relativePos.x>=e.layoutInfo.glyphMarginLeft,this.isInContentArea=!this.isInMarginArea,this.mouseColumn=Math.max(0,ct._getMouseColumn(this.mouseContentHorizontalOffset,e.typicalHalfwidthCharacterWidth))}}class nL extends iL{get target(){return this._useHitTestTarget?this.hitTestResult.value.hitTarget:this._eventTarget}get targetPath(){return this._targetPathCacheElement!==this.target&&(this._targetPathCacheElement=this.target,this._targetPathCacheValue=Li.collect(this.target,this._ctx.viewDomNode)),this._targetPathCacheValue}constructor(e,t,i,n,s){super(e,t,i,n),this.hitTestResult=new Wf(()=>ct.doHitTest(this._ctx,this)),this._targetPathCacheElement=null,this._targetPathCacheValue=new Uint8Array(0),this._ctx=e,this._eventTarget=s;const o=!!this._eventTarget;this._useHitTestTarget=!o}toString(){return`pos(${this.pos.x},${this.pos.y}), editorPos(${this.editorPos.x},${this.editorPos.y}), relativePos(${this.relativePos.x},${this.relativePos.y}), mouseVerticalOffset: ${this.mouseVerticalOffset}, mouseContentHorizontalOffset: ${this.mouseContentHorizontalOffset}
	target: ${this.target?this.target.outerHTML:null}`}get wouldBenefitFromHitTestTargetSwitch(){return!this._useHitTestTarget&&this.hitTestResult.value.hitTarget!==null&&this.target!==this.hitTestResult.value.hitTarget}switchToHitTestTarget(){this._useHitTestTarget=!0}_getMouseColumn(e=null){return e&&e.column<this._ctx.viewModel.getLineMaxColumn(e.lineNumber)?We.visibleColumnFromColumn(this._ctx.viewModel.getLineContent(e.lineNumber),e.column,this._ctx.viewModel.model.getOptions().tabSize)+1:this.mouseColumn}fulfillUnknown(e=null){return ht.createUnknown(this.target,this._getMouseColumn(e),e)}fulfillTextarea(){return ht.createTextarea(this.target,this._getMouseColumn())}fulfillMargin(e,t,i,n){return ht.createMargin(e,this.target,this._getMouseColumn(t),t,i,n)}fulfillViewZone(e,t,i){return ht.createViewZone(e,this.target,this._getMouseColumn(t),t,i)}fulfillContentText(e,t,i){return ht.createContentText(this.target,this._getMouseColumn(e),e,t,i)}fulfillContentEmpty(e,t){return ht.createContentEmpty(this.target,this._getMouseColumn(e),e,t)}fulfillContentWidget(e){return ht.createContentWidget(this.target,this._getMouseColumn(),e)}fulfillScrollbar(e){return ht.createScrollbar(this.target,this._getMouseColumn(e),e)}fulfillOverlayWidget(e){return ht.createOverlayWidget(this.target,this._getMouseColumn(),e)}}const rh={isAfterLines:!0};function so(a){return{isAfterLines:!1,horizontalDistanceToText:a}}class ct{constructor(e,t){this._context=e,this._viewHelper=t}mouseTargetIsWidget(e){const t=e.target,i=Li.collect(t,this._viewHelper.viewDomNode);return!!(pt.isChildOfContentWidgets(i)||pt.isChildOfOverflowingContentWidgets(i)||pt.isChildOfOverlayWidgets(i)||pt.isChildOfOverflowingOverlayWidgets(i))}createMouseTarget(e,t,i,n,s){const o=new Ws(this._context,this._viewHelper,e),r=new nL(o,t,i,n,s);try{const l=ct._createMouseTarget(o,r);if(l.type===ee.CONTENT_TEXT&&o.stickyTabStops&&l.position!==null){const d=ct._snapToSoftTabBoundary(l.position,o.viewModel),c=N.fromPositions(d,d).plusRange(l.range);return r.fulfillContentText(d,c,l.detail)}return l}catch{return r.fulfillUnknown()}}static _createMouseTarget(e,t){if(t.target===null)return t.fulfillUnknown();const i=t;let n=null;return!pt.isChildOfOverflowGuard(t.targetPath)&&!pt.isChildOfOverflowingContentWidgets(t.targetPath)&&!pt.isChildOfOverflowingOverlayWidgets(t.targetPath)&&(n=n||t.fulfillUnknown()),n=n||ct._hitTestContentWidget(e,i),n=n||ct._hitTestOverlayWidget(e,i),n=n||ct._hitTestMinimap(e,i),n=n||ct._hitTestScrollbarSlider(e,i),n=n||ct._hitTestViewZone(e,i),n=n||ct._hitTestMargin(e,i),n=n||ct._hitTestViewCursor(e,i),n=n||ct._hitTestTextArea(e,i),n=n||ct._hitTestViewLines(e,i),n=n||ct._hitTestScrollbar(e,i),n||t.fulfillUnknown()}static _hitTestContentWidget(e,t){if(pt.isChildOfContentWidgets(t.targetPath)||pt.isChildOfOverflowingContentWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillContentWidget(i):t.fulfillUnknown()}return null}static _hitTestOverlayWidget(e,t){if(pt.isChildOfOverlayWidgets(t.targetPath)||pt.isChildOfOverflowingOverlayWidgets(t.targetPath)){const i=e.findAttribute(t.target,"widgetId");return i?t.fulfillOverlayWidget(i):t.fulfillUnknown()}return null}static _hitTestViewCursor(e,t){if(t.target){const i=e.lastRenderData.lastViewCursorsRenderData;for(const n of i)if(t.target===n.domNode)return t.fulfillContentText(n.position,null,{mightBeForeignElement:!1,injectedText:null})}if(t.isInContentArea){const i=e.lastRenderData.lastViewCursorsRenderData,n=t.mouseContentHorizontalOffset,s=t.mouseVerticalOffset;for(const o of i){if(n<o.contentLeft||n>o.contentLeft+o.width)continue;const r=e.getVerticalOffsetForLineNumber(o.position.lineNumber);if(r<=s&&s<=r+o.height)return t.fulfillContentText(o.position,null,{mightBeForeignElement:!1,injectedText:null})}}return null}static _hitTestViewZone(e,t){const i=e.getZoneAtCoord(t.mouseVerticalOffset);if(i){const n=t.isInContentArea?ee.CONTENT_VIEW_ZONE:ee.GUTTER_VIEW_ZONE;return t.fulfillViewZone(n,i.position,i)}return null}static _hitTestTextArea(e,t){return pt.isTextArea(t.targetPath)?e.lastRenderData.lastTextareaPosition?t.fulfillContentText(e.lastRenderData.lastTextareaPosition,null,{mightBeForeignElement:!1,injectedText:null}):t.fulfillTextarea():null}static _hitTestMargin(e,t){if(t.isInMarginArea){const i=e.getFullLineRangeAtCoord(t.mouseVerticalOffset),n=i.range.getStartPosition();let s=Math.abs(t.relativePos.x);const o={isAfterLines:i.isAfterLines,glyphMarginLeft:e.layoutInfo.glyphMarginLeft,glyphMarginWidth:e.layoutInfo.glyphMarginWidth,lineNumbersWidth:e.layoutInfo.lineNumbersWidth,offsetX:s};if(s-=e.layoutInfo.glyphMarginLeft,s<=e.layoutInfo.glyphMarginWidth){const r=e.viewModel.coordinatesConverter.convertViewPositionToModelPosition(i.range.getStartPosition()),l=e.viewModel.glyphLanes.getLanesAtLine(r.lineNumber);return o.glyphMarginLane=l[Math.floor(s/e.lineHeight)],t.fulfillMargin(ee.GUTTER_GLYPH_MARGIN,n,i.range,o)}return s-=e.layoutInfo.glyphMarginWidth,s<=e.layoutInfo.lineNumbersWidth?t.fulfillMargin(ee.GUTTER_LINE_NUMBERS,n,i.range,o):(s-=e.layoutInfo.lineNumbersWidth,t.fulfillMargin(ee.GUTTER_LINE_DECORATIONS,n,i.range,o))}return null}static _hitTestViewLines(e,t){if(!pt.isChildOfViewLines(t.targetPath))return null;if(e.isInTopPadding(t.mouseVerticalOffset))return t.fulfillContentEmpty(new I(1,1),rh);if(e.isAfterLines(t.mouseVerticalOffset)||e.isInBottomPadding(t.mouseVerticalOffset)){const n=e.viewModel.getLineCount(),s=e.viewModel.getLineMaxColumn(n);return t.fulfillContentEmpty(new I(n,s),rh)}if(pt.isStrictChildOfViewLines(t.targetPath)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset);if(e.viewModel.getLineLength(n)===0){const o=e.getLineWidth(n),r=so(t.mouseContentHorizontalOffset-o);return t.fulfillContentEmpty(new I(n,1),r)}const s=e.getLineWidth(n);if(t.mouseContentHorizontalOffset>=s){const o=so(t.mouseContentHorizontalOffset-s),r=new I(n,e.viewModel.getLineMaxColumn(n));return t.fulfillContentEmpty(r,o)}}else if(e.viewLinesGpu){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset);if(e.viewModel.getLineLength(n)===0){const r=e.getLineWidth(n),l=so(t.mouseContentHorizontalOffset-r);return t.fulfillContentEmpty(new I(n,1),l)}const s=e.getLineWidth(n);if(t.mouseContentHorizontalOffset>=s){const r=so(t.mouseContentHorizontalOffset-s),l=new I(n,e.viewModel.getLineMaxColumn(n));return t.fulfillContentEmpty(l,r)}const o=e.viewLinesGpu.getPositionAtCoordinate(n,t.mouseContentHorizontalOffset);if(o){const r={injectedText:null,mightBeForeignElement:!1};return t.fulfillContentText(o,N.fromPositions(o,o),r)}}const i=t.hitTestResult.value;return i.type===Kn.Content?ct.createMouseTargetFromHitTestPosition(e,t,i.spanNode,i.position,i.injectedText):t.wouldBenefitFromHitTestTargetSwitch?(t.switchToHitTestTarget(),this._createMouseTarget(e,t)):t.fulfillUnknown()}static _hitTestMinimap(e,t){if(pt.isChildOfMinimap(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new I(i,n))}return null}static _hitTestScrollbarSlider(e,t){if(pt.isChildOfScrollableElement(t.targetPath)&&t.target&&t.target.nodeType===1){const i=t.target.className;if(i&&/\b(slider|scrollbar)\b/.test(i)){const n=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),s=e.viewModel.getLineMaxColumn(n);return t.fulfillScrollbar(new I(n,s))}}return null}static _hitTestScrollbar(e,t){if(pt.isChildOfScrollableElement(t.targetPath)){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.viewModel.getLineMaxColumn(i);return t.fulfillScrollbar(new I(i,n))}return null}getMouseColumn(e){const t=this._context.configuration.options,i=t.get(v.layoutInfo),n=this._context.viewLayout.getCurrentScrollLeft()+e.x-i.contentLeft;return ct._getMouseColumn(n,t.get(v.fontInfo).typicalHalfwidthCharacterWidth)}static _getMouseColumn(e,t){return e<0?1:Math.round(e/t)+1}static createMouseTargetFromHitTestPosition(e,t,i,n,s){const o=n.lineNumber,r=n.column,l=e.getLineWidth(o);if(t.mouseContentHorizontalOffset>l){const L=so(t.mouseContentHorizontalOffset-l);return t.fulfillContentEmpty(n,L)}const d=e.visibleRangeForPosition(o,r);if(!d)return t.fulfillUnknown(n);const c=d.left;if(Math.abs(t.mouseContentHorizontalOffset-c)<1)return t.fulfillContentText(n,null,{mightBeForeignElement:!!s,injectedText:s});const h=[];if(h.push({offset:d.left,column:r}),r>1){const L=e.visibleRangeForPosition(o,r-1);L&&h.push({offset:L.left,column:r-1})}const u=e.viewModel.getLineMaxColumn(o);if(r<u){const L=e.visibleRangeForPosition(o,r+1);L&&h.push({offset:L.left,column:r+1})}h.sort((L,w)=>L.offset-w.offset);const g=t.pos.toClientCoordinates(Ne(e.viewDomNode)),f=i.getBoundingClientRect(),m=f.left<=g.clientX&&g.clientX<=f.right;let _=null;for(let L=1;L<h.length;L++){const w=h[L-1],p=h[L];if(w.offset<=t.mouseContentHorizontalOffset&&t.mouseContentHorizontalOffset<=p.offset){_=new N(o,w.column,o,p.column);const C=Math.abs(w.offset-t.mouseContentHorizontalOffset),b=Math.abs(p.offset-t.mouseContentHorizontalOffset);n=C<b?new I(o,w.column):new I(o,p.column);break}}return t.fulfillContentText(n,_,{mightBeForeignElement:!m||!!s,injectedText:s})}static _doHitTestWithCaretRangeFromPoint(e,t){const i=e.getLineNumberAtVerticalOffset(t.mouseVerticalOffset),n=e.getVerticalOffsetForLineNumber(i),s=n+e.lineHeight;if(!(i===e.viewModel.getLineCount()&&t.mouseVerticalOffset>s)){const r=Math.floor((n+s)/2);let l=t.pos.y+(r-t.mouseVerticalOffset);l<=t.editorPos.y&&(l=t.editorPos.y+1),l>=t.editorPos.y+t.editorPos.height&&(l=t.editorPos.y+t.editorPos.height-1);const d=new Va(t.pos.x,l),c=this._actualDoHitTestWithCaretRangeFromPoint(e,d.toClientCoordinates(Ne(e.viewDomNode)));if(c.type===Kn.Content)return c}return this._actualDoHitTestWithCaretRangeFromPoint(e,t.pos.toClientCoordinates(Ne(e.viewDomNode)))}static _actualDoHitTestWithCaretRangeFromPoint(e,t){const i=Mo(e.viewDomNode);let n;if(i?typeof i.caretRangeFromPoint>"u"?n=sL(i,t.clientX,t.clientY):n=i.caretRangeFromPoint(t.clientX,t.clientY):n=e.viewDomNode.ownerDocument.caretRangeFromPoint(t.clientX,t.clientY),!n||!n.startContainer)return new qi;const s=n.startContainer;if(s.nodeType===s.TEXT_NODE){const o=s.parentNode,r=o?o.parentNode:null,l=r?r.parentNode:null;return(l&&l.nodeType===l.ELEMENT_NODE?l.className:null)===Pi.CLASS_NAME?En.createFromDOMInfo(e,o,n.startOffset):new qi(s.parentNode)}else if(s.nodeType===s.ELEMENT_NODE){const o=s.parentNode,r=o?o.parentNode:null;return(r&&r.nodeType===r.ELEMENT_NODE?r.className:null)===Pi.CLASS_NAME?En.createFromDOMInfo(e,s,s.textContent.length):new qi(s)}return new qi}static _doHitTestWithCaretPositionFromPoint(e,t){const i=e.viewDomNode.ownerDocument.caretPositionFromPoint(t.clientX,t.clientY);if(i.offsetNode.nodeType===i.offsetNode.TEXT_NODE){const n=i.offsetNode.parentNode,s=n?n.parentNode:null,o=s?s.parentNode:null;return(o&&o.nodeType===o.ELEMENT_NODE?o.className:null)===Pi.CLASS_NAME?En.createFromDOMInfo(e,i.offsetNode.parentNode,i.offset):new qi(i.offsetNode.parentNode)}if(i.offsetNode.nodeType===i.offsetNode.ELEMENT_NODE){const n=i.offsetNode.parentNode,s=n&&n.nodeType===n.ELEMENT_NODE?n.className:null,o=n?n.parentNode:null,r=o&&o.nodeType===o.ELEMENT_NODE?o.className:null;if(s===Pi.CLASS_NAME){const l=i.offsetNode.childNodes[Math.min(i.offset,i.offsetNode.childNodes.length-1)];if(l)return En.createFromDOMInfo(e,l,0)}else if(r===Pi.CLASS_NAME)return En.createFromDOMInfo(e,i.offsetNode,0)}return new qi(i.offsetNode)}static _snapToSoftTabBoundary(e,t){const i=t.getLineContent(e.lineNumber),{tabSize:n}=t.model.getOptions(),s=Wo.atomicPosition(i,e.column-1,n,dn.Nearest);return s!==-1?new I(e.lineNumber,s+1):e}static doHitTest(e,t){let i=new qi;if(typeof e.viewDomNode.ownerDocument.caretRangeFromPoint=="function"?i=this._doHitTestWithCaretRangeFromPoint(e,t):e.viewDomNode.ownerDocument.caretPositionFromPoint&&(i=this._doHitTestWithCaretPositionFromPoint(e,t.pos.toClientCoordinates(Ne(e.viewDomNode)))),i.type===Kn.Content){const n=e.viewModel.getInjectedTextAt(i.position),s=e.viewModel.normalizePosition(i.position,Ie.None);(n||!s.equals(i.position))&&(i=new xg(s,i.spanNode,n))}return i}}function sL(a,e,t){const i=document.createRange();let n=a.elementFromPoint(e,t);if(n!==null){for(;n&&n.firstChild&&n.firstChild.nodeType!==n.firstChild.TEXT_NODE&&n.lastChild&&n.lastChild.firstChild;)n=n.lastChild;const s=n.getBoundingClientRect(),o=Ne(n),r=o.getComputedStyle(n,null).getPropertyValue("font-style"),l=o.getComputedStyle(n,null).getPropertyValue("font-variant"),d=o.getComputedStyle(n,null).getPropertyValue("font-weight"),c=o.getComputedStyle(n,null).getPropertyValue("font-size"),h=o.getComputedStyle(n,null).getPropertyValue("line-height"),u=o.getComputedStyle(n,null).getPropertyValue("font-family"),g=`${r} ${l} ${d} ${c}/${h} ${u}`,f=n.innerText;let m=s.left,_=0,L;if(e>s.left+s.width)_=f.length;else{const w=_s.getInstance();for(let p=0;p<f.length+1;p++){if(L=w.getCharWidth(f.charAt(p),g)/2,m+=L,e<m){_=p;break}m+=L}}i.setStart(n.firstChild??n,_),i.setEnd(n.firstChild??n,_)}return i}class _s{static{this._INSTANCE=null}static getInstance(){return _s._INSTANCE||(_s._INSTANCE=new _s),_s._INSTANCE}constructor(){this._cache={},this._canvas=document.createElement("canvas")}getCharWidth(e,t){const i=e+t;if(this._cache[i])return this._cache[i];const n=this._canvas.getContext("2d");n.font=t;const o=n.measureText(e).width;return this._cache[i]=o,o}}var we;(function(a){a[a.Other=0]="Other",a[a.DeletingLeft=2]="DeletingLeft",a[a.DeletingRight=3]="DeletingRight",a[a.TypingOther=4]="TypingOther",a[a.TypingFirstSpace=5]="TypingFirstSpace",a[a.TypingConsecutiveSpace=6]="TypingConsecutiveSpace"})(we||(we={}));const oL=()=>!0,rL=()=>!1,aL=a=>a===" "||a==="	";class cs{static shouldRecreate(e){return e.hasChanged(v.layoutInfo)||e.hasChanged(v.wordSeparators)||e.hasChanged(v.emptySelectionClipboard)||e.hasChanged(v.multiCursorMergeOverlapping)||e.hasChanged(v.multiCursorPaste)||e.hasChanged(v.multiCursorLimit)||e.hasChanged(v.autoClosingBrackets)||e.hasChanged(v.autoClosingComments)||e.hasChanged(v.autoClosingQuotes)||e.hasChanged(v.autoClosingDelete)||e.hasChanged(v.autoClosingOvertype)||e.hasChanged(v.autoSurround)||e.hasChanged(v.useTabStops)||e.hasChanged(v.fontInfo)||e.hasChanged(v.readOnly)||e.hasChanged(v.wordSegmenterLocales)||e.hasChanged(v.overtypeOnPaste)}constructor(e,t,i,n){this.languageConfigurationService=n,this._cursorMoveConfigurationBrand=void 0,this._languageId=e;const s=i.options,o=s.get(v.layoutInfo),r=s.get(v.fontInfo);this.readOnly=s.get(v.readOnly),this.tabSize=t.tabSize,this.indentSize=t.indentSize,this.insertSpaces=t.insertSpaces,this.stickyTabStops=s.get(v.stickyTabStops),this.lineHeight=r.lineHeight,this.typicalHalfwidthCharacterWidth=r.typicalHalfwidthCharacterWidth,this.pageSize=Math.max(1,Math.floor(o.height/this.lineHeight)-2),this.useTabStops=s.get(v.useTabStops),this.wordSeparators=s.get(v.wordSeparators),this.emptySelectionClipboard=s.get(v.emptySelectionClipboard),this.copyWithSyntaxHighlighting=s.get(v.copyWithSyntaxHighlighting),this.multiCursorMergeOverlapping=s.get(v.multiCursorMergeOverlapping),this.multiCursorPaste=s.get(v.multiCursorPaste),this.multiCursorLimit=s.get(v.multiCursorLimit),this.autoClosingBrackets=s.get(v.autoClosingBrackets),this.autoClosingComments=s.get(v.autoClosingComments),this.autoClosingQuotes=s.get(v.autoClosingQuotes),this.autoClosingDelete=s.get(v.autoClosingDelete),this.autoClosingOvertype=s.get(v.autoClosingOvertype),this.autoSurround=s.get(v.autoSurround),this.autoIndent=s.get(v.autoIndent),this.wordSegmenterLocales=s.get(v.wordSegmenterLocales),this.overtypeOnPaste=s.get(v.overtypeOnPaste),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(e,this.autoClosingQuotes,!0),comment:this._getShouldAutoClose(e,this.autoClosingComments,!1),bracket:this._getShouldAutoClose(e,this.autoClosingBrackets,!1)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(e).getAutoClosingPairs();const l=this.languageConfigurationService.getLanguageConfiguration(e).getSurroundingPairs();if(l)for(const c of l)this.surroundingPairs[c.open]=c.close;const d=this.languageConfigurationService.getLanguageConfiguration(e).comments;this.blockCommentStartToken=d?.blockCommentStartToken??null}get electricChars(){if(!this._electricChars){this._electricChars={};const e=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter?.getElectricCharacters();if(e)for(const t of e)this._electricChars[t]=!0}return this._electricChars}get inputMode(){return Fl.getInputMode()}onElectricCharacter(e,t,i){const n=Wn(t,i-1),s=this.languageConfigurationService.getLanguageConfiguration(n.languageId).electricCharacter;return s?s.onElectricCharacter(e,n,i-n.firstCharOffset):null}normalizeIndentation(e){return Vf(e,this.indentSize,this.insertSpaces)}_getShouldAutoClose(e,t,i){switch(t){case"beforeWhitespace":return aL;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(e,i);case"always":return oL;case"never":return rL}}_getLanguageDefinedShouldAutoClose(e,t){const i=this.languageConfigurationService.getLanguageConfiguration(e).getAutoCloseBeforeSet(t);return n=>i.indexOf(n)!==-1}visibleColumnFromColumn(e,t){return We.visibleColumnFromColumn(e.getLineContent(t.lineNumber),t.column,this.tabSize)}columnFromVisibleColumn(e,t,i){const n=We.columnFromVisibleColumn(e.getLineContent(t),i,this.tabSize),s=e.getLineMinColumn(t);if(n<s)return s;const o=e.getLineMaxColumn(t);return n>o?o:n}}class ie{static fromModelState(e){return new lL(e)}static fromViewState(e){return new dL(e)}static fromModelSelection(e){const t=le.liftSelection(e),i=new Qe(N.fromPositions(t.getSelectionStart()),wt.Simple,0,t.getPosition(),0);return ie.fromModelState(i)}static fromModelSelections(e){const t=[];for(let i=0,n=e.length;i<n;i++)t[i]=this.fromModelSelection(e[i]);return t}constructor(e,t){this._cursorStateBrand=void 0,this.modelState=e,this.viewState=t}equals(e){return this.viewState.equals(e.viewState)&&this.modelState.equals(e.modelState)}}class lL{constructor(e){this.modelState=e,this.viewState=null}}class dL{constructor(e){this.modelState=null,this.viewState=e}}var wt;(function(a){a[a.Simple=0]="Simple",a[a.Word=1]="Word",a[a.Line=2]="Line"})(wt||(wt={}));class Qe{constructor(e,t,i,n,s){this.selectionStart=e,this.selectionStartKind=t,this.selectionStartLeftoverVisibleColumns=i,this.position=n,this.leftoverVisibleColumns=s,this._singleCursorStateBrand=void 0,this.selection=Qe._computeSelection(this.selectionStart,this.position)}equals(e){return this.selectionStartLeftoverVisibleColumns===e.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===e.leftoverVisibleColumns&&this.selectionStartKind===e.selectionStartKind&&this.position.equals(e.position)&&this.selectionStart.equalsRange(e.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(e,t,i,n){return e?new Qe(this.selectionStart,this.selectionStartKind,this.selectionStartLeftoverVisibleColumns,new I(t,i),n):new Qe(new N(t,i,t,i),wt.Simple,n,new I(t,i),n)}static _computeSelection(e,t){return e.isEmpty()||!t.isBeforeOrEqual(e.getStartPosition())?le.fromPositions(e.getStartPosition(),t):le.fromPositions(e.getEndPosition(),t)}}class bt{constructor(e,t,i){this._editOperationResultBrand=void 0,this.type=e,this.commands=t,this.shouldPushStackElementBefore=i.shouldPushStackElementBefore,this.shouldPushStackElementAfter=i.shouldPushStackElementAfter}}function gn(a){return a==="'"||a==='"'||a==="`"}class In{static columnSelect(e,t,i,n,s,o){const r=Math.abs(s-i)+1,l=i>s,d=n>o,c=n<o,h=[];for(let u=0;u<r;u++){const g=i+(l?-u:u),f=e.columnFromVisibleColumn(t,g,n),m=e.columnFromVisibleColumn(t,g,o),_=e.visibleColumnFromColumn(t,new I(g,f)),L=e.visibleColumnFromColumn(t,new I(g,m));c&&(_>o||L<n)||d&&(L>n||_<o)||h.push(new Qe(new N(g,f,g,f),wt.Simple,0,new I(g,m),0))}if(h.length===0)for(let u=0;u<r;u++){const g=i+(l?-u:u),f=t.getLineMaxColumn(g);h.push(new Qe(new N(g,f,g,f),wt.Simple,0,new I(g,f),0))}return{viewStates:h,reversed:l,fromLineNumber:i,fromVisualColumn:n,toLineNumber:s,toVisualColumn:o}}static columnSelectLeft(e,t,i){let n=i.toViewVisualColumn;return n>0&&n--,In.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,i.toViewLineNumber,n)}static columnSelectRight(e,t,i){let n=0;const s=Math.min(i.fromViewLineNumber,i.toViewLineNumber),o=Math.max(i.fromViewLineNumber,i.toViewLineNumber);for(let l=s;l<=o;l++){const d=t.getLineMaxColumn(l),c=e.visibleColumnFromColumn(t,new I(l,d));n=Math.max(n,c)}let r=i.toViewVisualColumn;return r<n&&r++,this.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,i.toViewLineNumber,r)}static columnSelectUp(e,t,i,n){const s=n?e.pageSize:1,o=Math.max(1,i.toViewLineNumber-s);return this.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,o,i.toViewVisualColumn)}static columnSelectDown(e,t,i,n){const s=n?e.pageSize:1,o=Math.min(t.getLineCount(),i.toViewLineNumber+s);return this.columnSelect(e,t,i.fromViewLineNumber,i.fromViewVisualColumn,o,i.toViewVisualColumn)}}class Mt{constructor(e,t,i=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=i}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return le.fromPositions(n.getEndPosition())}}class jl{constructor(e,t,i=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=i}getEditOperations(e,t){const i=this._range.getStartPosition(),n=this._range.getEndPosition(),s=n.lineNumber,o=this._text.length+(this._range.isEmpty()?0:-1);let r=Ng(e,n,o);r.lineNumber>s&&(r=new I(s,e.getLineMaxColumn(s)));const l=N.fromPositions(i,r);t.addTrackedEditOperation(l,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return le.fromPositions(n.getEndPosition())}}class TE{constructor(e,t){this._range=e,this._text=t}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return le.fromRange(n,Md.LTR)}}class Wr{constructor(e,t,i=!1){this._range=e,this._text=t,this.insertsAutoWhitespace=i}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return le.fromPositions(n.getStartPosition())}}class ea{constructor(e,t,i,n,s=!1){this._range=e,this._text=t,this._columnDeltaOffset=n,this._lineNumberDeltaOffset=i,this.insertsAutoWhitespace=s}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return le.fromPositions(n.getEndPosition().delta(this._lineNumberDeltaOffset,this._columnDeltaOffset))}}class cL{constructor(e){this._range=e}getEditOperations(e,t){const i=e.getValueInRange(this._range),n=this._range.getEndPosition(),s=n.lineNumber;let o=Ng(e,n,i.length);o.lineNumber>s&&(o=new I(s,e.getLineMaxColumn(s)));const r=N.fromPositions(n,o);t.addTrackedEditOperation(r,"")}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return le.fromPositions(n.getEndPosition())}}class hL{constructor(e,t,i,n=!1){this._range=e,this._text=t,this._initialSelection=i,this._forceMoveMarkers=n,this._selectionId=null}getEditOperations(e,t){t.addTrackedEditOperation(this._range,this._text,this._forceMoveMarkers),this._selectionId=t.trackSelection(this._initialSelection)}computeCursorState(e,t){return t.getTrackedSelection(this._selectionId)}}function Ng(a,e,t){if(t<0)throw new Error("Unexpected negative delta");const i=a.getLineCount();let n=new I(i,a.getLineMaxColumn(i));for(let s=e.lineNumber;s<=i;s++)if(s===e.lineNumber){const o=t-a.getLineMaxColumn(e.lineNumber)+e.column;if(o<=0){n=new I(e.lineNumber,e.column+t);break}t=o}else{const o=t-a.getLineMaxColumn(s);if(o<=0){n=new I(s,t);break}t=o}return n}class rl{constructor(e,t,i){this._cursorPositionBrand=void 0,this.lineNumber=e,this.column=t,this.leftoverVisibleColumns=i}}class pe{static leftPosition(e,t){if(t.column>e.getLineMinColumn(t.lineNumber))return t.delta(void 0,-Ff(e.getLineContent(t.lineNumber),t.column-1));if(t.lineNumber>1){const i=t.lineNumber-1;return new I(i,e.getLineMaxColumn(i))}else return t}static leftPositionAtomicSoftTabs(e,t,i){if(t.column<=e.getLineIndentColumn(t.lineNumber)){const n=e.getLineMinColumn(t.lineNumber),s=e.getLineContent(t.lineNumber),o=Wo.atomicPosition(s,t.column-1,i,dn.Left);if(o!==-1&&o+1>=n)return new I(t.lineNumber,o+1)}return this.leftPosition(e,t)}static left(e,t,i){const n=e.stickyTabStops?pe.leftPositionAtomicSoftTabs(t,i,e.tabSize):pe.leftPosition(t,i);return new rl(n.lineNumber,n.column,0)}static moveLeft(e,t,i,n,s){let o,r;if(i.hasSelection()&&!n)o=i.selection.startLineNumber,r=i.selection.startColumn;else{const l=i.position.delta(void 0,-(s-1)),d=t.normalizePosition(pe.clipPositionColumn(l,t),Ie.Left),c=pe.left(e,t,d);o=c.lineNumber,r=c.column}return i.move(n,o,r,0)}static clipPositionColumn(e,t){return new I(e.lineNumber,pe.clipRange(e.column,t.getLineMinColumn(e.lineNumber),t.getLineMaxColumn(e.lineNumber)))}static clipRange(e,t,i){return e<t?t:e>i?i:e}static rightPosition(e,t,i){return i<e.getLineMaxColumn(t)?i=i+xu(e.getLineContent(t),i-1):t<e.getLineCount()&&(t=t+1,i=e.getLineMinColumn(t)),new I(t,i)}static rightPositionAtomicSoftTabs(e,t,i,n,s){if(i<e.getLineIndentColumn(t)){const o=e.getLineContent(t),r=Wo.atomicPosition(o,i-1,n,dn.Right);if(r!==-1)return new I(t,r+1)}return this.rightPosition(e,t,i)}static right(e,t,i){const n=e.stickyTabStops?pe.rightPositionAtomicSoftTabs(t,i.lineNumber,i.column,e.tabSize,e.indentSize):pe.rightPosition(t,i.lineNumber,i.column);return new rl(n.lineNumber,n.column,0)}static moveRight(e,t,i,n,s){let o,r;if(i.hasSelection()&&!n)o=i.selection.endLineNumber,r=i.selection.endColumn;else{const l=i.position.delta(void 0,s-1),d=t.normalizePosition(pe.clipPositionColumn(l,t),Ie.Right),c=pe.right(e,t,d);o=c.lineNumber,r=c.column}return i.move(n,o,r,0)}static vertical(e,t,i,n,s,o,r,l){const d=We.visibleColumnFromColumn(t.getLineContent(i),n,e.tabSize)+s,c=t.getLineCount(),h=i===1&&n===1,u=i===c&&n===t.getLineMaxColumn(i),g=o<i?h:u;if(i=o,i<1?(i=1,r?n=t.getLineMinColumn(i):n=Math.min(t.getLineMaxColumn(i),n)):i>c?(i=c,r?n=t.getLineMaxColumn(i):n=Math.min(t.getLineMaxColumn(i),n)):n=e.columnFromVisibleColumn(t,i,d),g?s=0:s=d-We.visibleColumnFromColumn(t.getLineContent(i),n,e.tabSize),l!==void 0){const f=new I(i,n),m=t.normalizePosition(f,l);s=s+(n-m.column),i=m.lineNumber,n=m.column}return new rl(i,n,s)}static down(e,t,i,n,s,o,r){return this.vertical(e,t,i,n,s,i+o,r,Ie.RightOfInjectedText)}static moveDown(e,t,i,n,s){let o,r;i.hasSelection()&&!n?(o=i.selection.endLineNumber,r=i.selection.endColumn):(o=i.position.lineNumber,r=i.position.column);let l=0,d;do if(d=pe.down(e,t,o+l,r,i.leftoverVisibleColumns,s,!0),t.normalizePosition(new I(d.lineNumber,d.column),Ie.None).lineNumber>o)break;while(l++<10&&o+l<t.getLineCount());return i.move(n,d.lineNumber,d.column,d.leftoverVisibleColumns)}static translateDown(e,t,i){const n=i.selection,s=pe.down(e,t,n.selectionStartLineNumber,n.selectionStartColumn,i.selectionStartLeftoverVisibleColumns,1,!1),o=pe.down(e,t,n.positionLineNumber,n.positionColumn,i.leftoverVisibleColumns,1,!1);return new Qe(new N(s.lineNumber,s.column,s.lineNumber,s.column),wt.Simple,s.leftoverVisibleColumns,new I(o.lineNumber,o.column),o.leftoverVisibleColumns)}static up(e,t,i,n,s,o,r){return this.vertical(e,t,i,n,s,i-o,r,Ie.LeftOfInjectedText)}static moveUp(e,t,i,n,s){let o,r;i.hasSelection()&&!n?(o=i.selection.startLineNumber,r=i.selection.startColumn):(o=i.position.lineNumber,r=i.position.column);const l=pe.up(e,t,o,r,i.leftoverVisibleColumns,s,!0);return i.move(n,l.lineNumber,l.column,l.leftoverVisibleColumns)}static translateUp(e,t,i){const n=i.selection,s=pe.up(e,t,n.selectionStartLineNumber,n.selectionStartColumn,i.selectionStartLeftoverVisibleColumns,1,!1),o=pe.up(e,t,n.positionLineNumber,n.positionColumn,i.leftoverVisibleColumns,1,!1);return new Qe(new N(s.lineNumber,s.column,s.lineNumber,s.column),wt.Simple,s.leftoverVisibleColumns,new I(o.lineNumber,o.column),o.leftoverVisibleColumns)}static _isBlankLine(e,t){return e.getLineFirstNonWhitespaceColumn(t)===0}static moveToPrevBlankLine(e,t,i,n){let s=i.position.lineNumber;for(;s>1&&this._isBlankLine(t,s);)s--;for(;s>1&&!this._isBlankLine(t,s);)s--;return i.move(n,s,t.getLineMinColumn(s),0)}static moveToNextBlankLine(e,t,i,n){const s=t.getLineCount();let o=i.position.lineNumber;for(;o<s&&this._isBlankLine(t,o);)o++;for(;o<s&&!this._isBlankLine(t,o);)o++;return i.move(n,o,t.getLineMinColumn(o),0)}static moveToBeginningOfLine(e,t,i,n){const s=i.position.lineNumber,o=t.getLineMinColumn(s),r=t.getLineFirstNonWhitespaceColumn(s)||o;let l;return i.position.column===r?l=o:l=r,i.move(n,s,l,0)}static moveToEndOfLine(e,t,i,n,s){const o=i.position.lineNumber,r=t.getLineMaxColumn(o);return i.move(n,o,r,s?Jt.MAX_SAFE_SMALL_INTEGER-r:0)}static moveToBeginningOfBuffer(e,t,i,n){return i.move(n,1,1,0)}static moveToEndOfBuffer(e,t,i,n){const s=t.getLineCount(),o=t.getLineMaxColumn(s);return i.move(n,s,o,0)}}class es{static deleteRight(e,t,i,n){const s=[];let o=e!==we.DeletingRight;for(let r=0,l=n.length;r<l;r++){const d=n[r];let c=d;if(c.isEmpty()){const h=d.getPosition(),u=pe.right(t,i,h);c=new N(u.lineNumber,u.column,h.lineNumber,h.column)}if(c.isEmpty()){s[r]=null;continue}c.startLineNumber!==c.endLineNumber&&(o=!0),s[r]=new Mt(c,"")}return[o,s]}static isAutoClosingPairDelete(e,t,i,n,s,o,r){if(t==="never"&&i==="never"||e==="never")return!1;for(let l=0,d=o.length;l<d;l++){const c=o[l],h=c.getPosition();if(!c.isEmpty())return!1;const u=s.getLineContent(h.lineNumber);if(h.column<2||h.column>=u.length+1)return!1;const g=u.charAt(h.column-2),f=n.get(g);if(!f)return!1;if(gn(g)){if(i==="never")return!1}else if(t==="never")return!1;const m=u.charAt(h.column-1);let _=!1;for(const L of f)L.open===g&&L.close===m&&(_=!0);if(!_)return!1;if(e==="auto"){let L=!1;for(let w=0,p=r.length;w<p;w++){const C=r[w];if(h.lineNumber===C.startLineNumber&&h.column===C.startColumn){L=!0;break}}if(!L)return!1}}return!0}static _runAutoClosingPairDelete(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++){const r=i[s].getPosition(),l=new N(r.lineNumber,r.column-1,r.lineNumber,r.column+1);n[s]=new Mt(l,"")}return[!0,n]}static deleteLeft(e,t,i,n,s){if(this.isAutoClosingPairDelete(t.autoClosingDelete,t.autoClosingBrackets,t.autoClosingQuotes,t.autoClosingPairs.autoClosingPairsOpenByEnd,i,n,s))return this._runAutoClosingPairDelete(t,i,n);const o=[];let r=e!==we.DeletingLeft;for(let l=0,d=n.length;l<d;l++){const c=es.getDeleteRange(n[l],i,t);if(c.isEmpty()){o[l]=null;continue}c.startLineNumber!==c.endLineNumber&&(r=!0),o[l]=new Mt(c,"")}return[r,o]}static getDeleteRange(e,t,i){if(!e.isEmpty())return e;const n=e.getPosition();if(i.useTabStops&&n.column>1){const s=t.getLineContent(n.lineNumber),o=zi(s),r=o===-1?s.length+1:o+1;if(n.column<=r){const l=i.visibleColumnFromColumn(t,n),d=We.prevIndentTabStop(l,i.indentSize),c=i.columnFromVisibleColumn(t,n.lineNumber,d);return new N(n.lineNumber,c,n.lineNumber,n.column)}}return N.fromPositions(es.getPositionAfterDeleteLeft(n,t),n)}static getPositionAfterDeleteLeft(e,t){if(e.column>1){const i=Hf(e.column-1,t.getLineContent(e.lineNumber));return e.with(void 0,i+1)}else if(e.lineNumber>1){const i=e.lineNumber-1;return new I(i,t.getLineMaxColumn(i))}else return e}static cut(e,t,i){const n=[];let s=null;i.sort((o,r)=>I.compare(o.getStartPosition(),r.getEndPosition()));for(let o=0,r=i.length;o<r;o++){const l=i[o];if(l.isEmpty())if(e.emptySelectionClipboard){const d=l.getPosition();let c,h,u,g;d.lineNumber<t.getLineCount()?(c=d.lineNumber,h=1,u=d.lineNumber+1,g=1):d.lineNumber>1&&s?.endLineNumber!==d.lineNumber?(c=d.lineNumber-1,h=t.getLineMaxColumn(d.lineNumber-1),u=d.lineNumber,g=t.getLineMaxColumn(d.lineNumber)):(c=d.lineNumber,h=1,u=d.lineNumber,g=t.getLineMaxColumn(d.lineNumber));const f=new N(c,h,u,g);s=f,f.isEmpty()?n[o]=null:n[o]=new Mt(f,"")}else n[o]=null;else n[o]=new Mt(l,"")}return new bt(we.Other,n,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}var he;(function(a){a[a.NotSet=0]="NotSet",a[a.ContentFlush=1]="ContentFlush",a[a.RecoverFromMarkers=2]="RecoverFromMarkers",a[a.Explicit=3]="Explicit",a[a.Paste=4]="Paste",a[a.Undo=5]="Undo",a[a.Redo=6]="Redo"})(he||(he={}));var Se;(function(a){a[a.None=0]="None",a[a.Regular=1]="Regular",a[a.Separator=2]="Separator"})(Se||(Se={}));var _t;(function(a){a[a.WordStart=0]="WordStart",a[a.WordStartFast=1]="WordStartFast",a[a.WordEnd=2]="WordEnd",a[a.WordAccessibility=3]="WordAccessibility"})(_t||(_t={}));class me{static _createWord(e,t,i,n,s){return{start:n,end:s,wordType:t,nextCharClass:i}}static _createIntlWord(e,t){return{start:e.index,end:e.index+e.segment.length,wordType:Se.Regular,nextCharClass:t}}static _findPreviousWordOnLine(e,t,i){const n=t.getLineContent(i.lineNumber);return this._doFindPreviousWordOnLine(n,e,i)}static _doFindPreviousWordOnLine(e,t,i){let n=Se.None;const s=t.findPrevIntlWordBeforeOrAtOffset(e,i.column-2);for(let o=i.column-2;o>=0;o--){const r=e.charCodeAt(o),l=t.get(r);if(s&&o===s.index)return this._createIntlWord(s,l);if(l===et.Regular){if(n===Se.Separator)return this._createWord(e,n,l,o+1,this._findEndOfWord(e,t,n,o+1));n=Se.Regular}else if(l===et.WordSeparator){if(n===Se.Regular)return this._createWord(e,n,l,o+1,this._findEndOfWord(e,t,n,o+1));n=Se.Separator}else if(l===et.Whitespace&&n!==Se.None)return this._createWord(e,n,l,o+1,this._findEndOfWord(e,t,n,o+1))}return n!==Se.None?this._createWord(e,n,et.Whitespace,0,this._findEndOfWord(e,t,n,0)):null}static _findEndOfWord(e,t,i,n){const s=t.findNextIntlWordAtOrAfterOffset(e,n),o=e.length;for(let r=n;r<o;r++){const l=e.charCodeAt(r),d=t.get(l);if(s&&r===s.index+s.segment.length||d===et.Whitespace||i===Se.Regular&&d===et.WordSeparator||i===Se.Separator&&d===et.Regular)return r}return o}static _findNextWordOnLine(e,t,i){const n=t.getLineContent(i.lineNumber);return this._doFindNextWordOnLine(n,e,i)}static _doFindNextWordOnLine(e,t,i){let n=Se.None;const s=e.length,o=t.findNextIntlWordAtOrAfterOffset(e,i.column-1);for(let r=i.column-1;r<s;r++){const l=e.charCodeAt(r),d=t.get(l);if(o&&r===o.index)return this._createIntlWord(o,d);if(d===et.Regular){if(n===Se.Separator)return this._createWord(e,n,d,this._findStartOfWord(e,t,n,r-1),r);n=Se.Regular}else if(d===et.WordSeparator){if(n===Se.Regular)return this._createWord(e,n,d,this._findStartOfWord(e,t,n,r-1),r);n=Se.Separator}else if(d===et.Whitespace&&n!==Se.None)return this._createWord(e,n,d,this._findStartOfWord(e,t,n,r-1),r)}return n!==Se.None?this._createWord(e,n,et.Whitespace,this._findStartOfWord(e,t,n,s-1),s):null}static _findStartOfWord(e,t,i,n){const s=t.findPrevIntlWordBeforeOrAtOffset(e,n);for(let o=n;o>=0;o--){const r=e.charCodeAt(o),l=t.get(r);if(s&&o===s.index)return o;if(l===et.Whitespace||i===Se.Regular&&l===et.WordSeparator||i===Se.Separator&&l===et.Regular)return o+1}return 0}static moveWordLeft(e,t,i,n,s){let o=i.lineNumber,r=i.column;r===1&&o>1&&(o=o-1,r=t.getLineMaxColumn(o));let l=me._findPreviousWordOnLine(e,t,new I(o,r));if(n===_t.WordStart)return new I(o,l?l.start+1:1);if(n===_t.WordStartFast)return!s&&l&&l.wordType===Se.Separator&&l.end-l.start===1&&l.nextCharClass===et.Regular&&(l=me._findPreviousWordOnLine(e,t,new I(o,l.start+1))),new I(o,l?l.start+1:1);if(n===_t.WordAccessibility){for(;l&&l.wordType===Se.Separator;)l=me._findPreviousWordOnLine(e,t,new I(o,l.start+1));return new I(o,l?l.start+1:1)}return l&&r<=l.end+1&&(l=me._findPreviousWordOnLine(e,t,new I(o,l.start+1))),new I(o,l?l.end+1:1)}static _moveWordPartLeft(e,t){const i=t.lineNumber,n=e.getLineMaxColumn(i);if(t.column===1)return i>1?new I(i-1,e.getLineMaxColumn(i-1)):t;const s=e.getLineContent(i);for(let o=t.column-1;o>1;o--){const r=s.charCodeAt(o-2),l=s.charCodeAt(o-1);if(r===V.Underline&&l!==V.Underline)return new I(i,o);if(r===V.Dash&&l!==V.Dash)return new I(i,o);if((hr(r)||ur(r))&&ls(l))return new I(i,o);if(ls(r)&&ls(l)&&o+1<n){const d=s.charCodeAt(o);if(hr(d)||ur(d))return new I(i,o)}}return new I(i,1)}static moveWordRight(e,t,i,n){let s=i.lineNumber,o=i.column,r=!1;o===t.getLineMaxColumn(s)&&s<t.getLineCount()&&(r=!0,s=s+1,o=1);let l=me._findNextWordOnLine(e,t,new I(s,o));if(n===_t.WordEnd)l&&l.wordType===Se.Separator&&l.end-l.start===1&&l.nextCharClass===et.Regular&&(l=me._findNextWordOnLine(e,t,new I(s,l.end+1))),l?o=l.end+1:o=t.getLineMaxColumn(s);else if(n===_t.WordAccessibility){for(r&&(o=0);l&&(l.wordType===Se.Separator||l.start+1<=o);)l=me._findNextWordOnLine(e,t,new I(s,l.end+1));l?o=l.start+1:o=t.getLineMaxColumn(s)}else l&&!r&&o>=l.start+1&&(l=me._findNextWordOnLine(e,t,new I(s,l.end+1))),l?o=l.start+1:o=t.getLineMaxColumn(s);return new I(s,o)}static _moveWordPartRight(e,t){const i=t.lineNumber,n=e.getLineMaxColumn(i);if(t.column===n)return i<e.getLineCount()?new I(i+1,1):t;const s=e.getLineContent(i);for(let o=t.column+1;o<n;o++){const r=s.charCodeAt(o-2),l=s.charCodeAt(o-1);if(r!==V.Underline&&l===V.Underline)return new I(i,o);if(r!==V.Dash&&l===V.Dash)return new I(i,o);if((hr(r)||ur(r))&&ls(l))return new I(i,o);if(ls(r)&&ls(l)&&o+1<n){const d=s.charCodeAt(o);if(hr(d)||ur(d))return new I(i,o)}}return new I(i,n)}static _deleteWordLeftWhitespace(e,t){const i=e.getLineContent(t.lineNumber),n=t.column-2,s=Qo(i,n);return s+1<n?new N(t.lineNumber,s+2,t.lineNumber,t.column):null}static deleteWordLeft(e,t){const i=e.wordSeparators,n=e.model,s=e.selection,o=e.whitespaceHeuristics;if(!s.isEmpty())return s;if(es.isAutoClosingPairDelete(e.autoClosingDelete,e.autoClosingBrackets,e.autoClosingQuotes,e.autoClosingPairs.autoClosingPairsOpenByEnd,e.model,[e.selection],e.autoClosedCharacters)){const h=e.selection.getPosition();return new N(h.lineNumber,h.column-1,h.lineNumber,h.column+1)}const r=new I(s.positionLineNumber,s.positionColumn);let l=r.lineNumber,d=r.column;if(l===1&&d===1)return null;if(o){const h=this._deleteWordLeftWhitespace(n,r);if(h)return h}let c=me._findPreviousWordOnLine(i,n,r);return t===_t.WordStart?c?d=c.start+1:d>1?d=1:(l--,d=n.getLineMaxColumn(l)):(c&&d<=c.end+1&&(c=me._findPreviousWordOnLine(i,n,new I(l,c.start+1))),c?d=c.end+1:d>1?d=1:(l--,d=n.getLineMaxColumn(l))),new N(l,d,r.lineNumber,r.column)}static deleteInsideWord(e,t,i){if(!i.isEmpty())return i;const n=new I(i.positionLineNumber,i.positionColumn),s=this._deleteInsideWordWhitespace(t,n);return s||this._deleteInsideWordDetermineDeleteRange(e,t,n)}static _charAtIsWhitespace(e,t){const i=e.charCodeAt(t);return i===V.Space||i===V.Tab}static _deleteInsideWordWhitespace(e,t){const i=e.getLineContent(t.lineNumber),n=i.length;if(n===0)return null;let s=Math.max(t.column-2,0);if(!this._charAtIsWhitespace(i,s))return null;let o=Math.min(t.column-1,n-1);if(!this._charAtIsWhitespace(i,o))return null;for(;s>0&&this._charAtIsWhitespace(i,s-1);)s--;for(;o+1<n&&this._charAtIsWhitespace(i,o+1);)o++;return new N(t.lineNumber,s+1,t.lineNumber,o+2)}static _deleteInsideWordDetermineDeleteRange(e,t,i){const n=t.getLineContent(i.lineNumber),s=n.length;if(s===0)return i.lineNumber>1?new N(i.lineNumber-1,t.getLineMaxColumn(i.lineNumber-1),i.lineNumber,1):i.lineNumber<t.getLineCount()?new N(i.lineNumber,1,i.lineNumber+1,1):new N(i.lineNumber,1,i.lineNumber,1);const o=h=>h.start+1<=i.column&&i.column<=h.end+1,r=(h,u)=>(h=Math.min(h,i.column),u=Math.max(u,i.column),new N(i.lineNumber,h,i.lineNumber,u)),l=h=>{let u=h.start+1,g=h.end+1,f=!1;for(;g-1<s&&this._charAtIsWhitespace(n,g-1);)f=!0,g++;if(!f)for(;u>1&&this._charAtIsWhitespace(n,u-2);)u--;return r(u,g)},d=me._findPreviousWordOnLine(e,t,i);if(d&&o(d))return l(d);const c=me._findNextWordOnLine(e,t,i);return c&&o(c)?l(c):d&&c?r(d.end+1,c.start+1):d?r(d.start+1,d.end+1):c?r(c.start+1,c.end+1):r(1,s+1)}static _deleteWordPartLeft(e,t){if(!t.isEmpty())return t;const i=t.getPosition(),n=me._moveWordPartLeft(e,i);return new N(i.lineNumber,i.column,n.lineNumber,n.column)}static _findFirstNonWhitespaceChar(e,t){const i=e.length;for(let n=t;n<i;n++){const s=e.charAt(n);if(s!==" "&&s!=="	")return n}return i}static _deleteWordRightWhitespace(e,t){const i=e.getLineContent(t.lineNumber),n=t.column-1,s=this._findFirstNonWhitespaceChar(i,n);return n+1<s?new N(t.lineNumber,t.column,t.lineNumber,s+1):null}static deleteWordRight(e,t){const i=e.wordSeparators,n=e.model,s=e.selection,o=e.whitespaceHeuristics;if(!s.isEmpty())return s;const r=new I(s.positionLineNumber,s.positionColumn);let l=r.lineNumber,d=r.column;const c=n.getLineCount(),h=n.getLineMaxColumn(l);if(l===c&&d===h)return null;if(o){const g=this._deleteWordRightWhitespace(n,r);if(g)return g}let u=me._findNextWordOnLine(i,n,r);return t===_t.WordEnd?u?d=u.end+1:d<h||l===c?d=h:(l++,u=me._findNextWordOnLine(i,n,new I(l,1)),u?d=u.start+1:d=n.getLineMaxColumn(l)):(u&&d>=u.start+1&&(u=me._findNextWordOnLine(i,n,new I(l,u.end+1))),u?d=u.start+1:d<h||l===c?d=h:(l++,u=me._findNextWordOnLine(i,n,new I(l,1)),u?d=u.start+1:d=n.getLineMaxColumn(l))),new N(l,d,r.lineNumber,r.column)}static _deleteWordPartRight(e,t){if(!t.isEmpty())return t;const i=t.getPosition(),n=me._moveWordPartRight(e,i);return new N(i.lineNumber,i.column,n.lineNumber,n.column)}static _createWordAtPosition(e,t,i){const n=new N(t,i.start+1,t,i.end+1);return{word:e.getValueInRange(n),startColumn:n.startColumn,endColumn:n.endColumn}}static getWordAtPosition(e,t,i,n){const s=Ao(t,i),o=me._findPreviousWordOnLine(s,e,n);if(o&&o.wordType===Se.Regular&&o.start<=n.column-1&&n.column-1<=o.end)return me._createWordAtPosition(e,n.lineNumber,o);const r=me._findNextWordOnLine(s,e,n);return r&&r.wordType===Se.Regular&&r.start<=n.column-1&&n.column-1<=r.end?me._createWordAtPosition(e,n.lineNumber,r):null}static word(e,t,i,n,s){const o=Ao(e.wordSeparators,e.wordSegmenterLocales),r=me._findPreviousWordOnLine(o,t,s),l=me._findNextWordOnLine(o,t,s);if(!n){let g,f;return r&&r.wordType===Se.Regular&&r.start<=s.column-1&&s.column-1<=r.end?(g=r.start+1,f=r.end+1):l&&l.wordType===Se.Regular&&l.start<=s.column-1&&s.column-1<=l.end?(g=l.start+1,f=l.end+1):(r?g=r.end+1:g=1,l?f=l.start+1:f=t.getLineMaxColumn(s.lineNumber)),new Qe(new N(s.lineNumber,g,s.lineNumber,f),wt.Word,0,new I(s.lineNumber,f),0)}let d,c;r&&r.wordType===Se.Regular&&r.start<s.column-1&&s.column-1<r.end?(d=r.start+1,c=r.end+1):l&&l.wordType===Se.Regular&&l.start<s.column-1&&s.column-1<l.end?(d=l.start+1,c=l.end+1):(d=s.column,c=s.column);const h=s.lineNumber;let u;if(i.selectionStart.containsPosition(s))u=i.selectionStart.endColumn;else if(s.isBeforeOrEqual(i.selectionStart.getStartPosition())){u=d;const g=new I(h,u);i.selectionStart.containsPosition(g)&&(u=i.selectionStart.endColumn)}else{u=c;const g=new I(h,u);i.selectionStart.containsPosition(g)&&(u=i.selectionStart.startColumn)}return i.move(!0,h,u,0)}}class ME extends me{static deleteWordPartLeft(e){const t=Lr([me.deleteWordLeft(e,_t.WordStart),me.deleteWordLeft(e,_t.WordEnd),me._deleteWordPartLeft(e.model,e.selection)]);return t.sort(N.compareRangesUsingEnds),t[2]}static deleteWordPartRight(e){const t=Lr([me.deleteWordRight(e,_t.WordStart),me.deleteWordRight(e,_t.WordEnd),me._deleteWordPartRight(e.model,e.selection)]);return t.sort(N.compareRangesUsingStarts),t[0]}static moveWordPartLeft(e,t,i,n){const s=Lr([me.moveWordLeft(e,t,i,_t.WordStart,n),me.moveWordLeft(e,t,i,_t.WordEnd,n),me._moveWordPartLeft(t,i)]);return s.sort(I.compare),s[2]}static moveWordPartRight(e,t,i){const n=Lr([me.moveWordRight(e,t,i,_t.WordStart),me.moveWordRight(e,t,i,_t.WordEnd),me._moveWordPartRight(t,i)]);return n.sort(I.compare),n[0]}}function Lr(a){return a.filter(e=>!!e)}class lt{static addCursorDown(e,t,i){const n=[];let s=0;for(let o=0,r=t.length;o<r;o++){const l=t[o];n[s++]=new ie(l.modelState,l.viewState),i?n[s++]=ie.fromModelState(pe.translateDown(e.cursorConfig,e.model,l.modelState)):n[s++]=ie.fromViewState(pe.translateDown(e.cursorConfig,e,l.viewState))}return n}static addCursorUp(e,t,i){const n=[];let s=0;for(let o=0,r=t.length;o<r;o++){const l=t[o];n[s++]=new ie(l.modelState,l.viewState),i?n[s++]=ie.fromModelState(pe.translateUp(e.cursorConfig,e.model,l.modelState)):n[s++]=ie.fromViewState(pe.translateUp(e.cursorConfig,e,l.viewState))}return n}static moveToBeginningOfLine(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s];n[s]=this._moveToLineStart(e,r,i)}return n}static _moveToLineStart(e,t,i){const n=t.viewState.position.column,s=t.modelState.position.column,o=n===s,r=t.viewState.position.lineNumber,l=e.getLineFirstNonWhitespaceColumn(r);return!o&&!(n===l)?this._moveToLineStartByView(e,t,i):this._moveToLineStartByModel(e,t,i)}static _moveToLineStartByView(e,t,i){return ie.fromViewState(pe.moveToBeginningOfLine(e.cursorConfig,e,t.viewState,i))}static _moveToLineStartByModel(e,t,i){return ie.fromModelState(pe.moveToBeginningOfLine(e.cursorConfig,e.model,t.modelState,i))}static moveToEndOfLine(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=this._moveToLineEnd(e,l,i,n)}return s}static _moveToLineEnd(e,t,i,n){const s=t.viewState.position,o=e.getLineMaxColumn(s.lineNumber),r=s.column===o,l=t.modelState.position,d=e.model.getLineMaxColumn(l.lineNumber),c=o-s.column===d-l.column;return r||c?this._moveToLineEndByModel(e,t,i,n):this._moveToLineEndByView(e,t,i,n)}static _moveToLineEndByView(e,t,i,n){return ie.fromViewState(pe.moveToEndOfLine(e.cursorConfig,e,t.viewState,i,n))}static _moveToLineEndByModel(e,t,i,n){return ie.fromModelState(pe.moveToEndOfLine(e.cursorConfig,e.model,t.modelState,i,n))}static expandLineSelection(e,t){const i=[];for(let n=0,s=t.length;n<s;n++){const o=t[n],r=o.modelState.selection.startLineNumber,l=e.model.getLineCount();let d=o.modelState.selection.endLineNumber,c;d===l?c=e.model.getLineMaxColumn(l):(d++,c=1),i[n]=ie.fromModelState(new Qe(new N(r,1,r,1),wt.Simple,0,new I(d,c),0))}return i}static moveToBeginningOfBuffer(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s];n[s]=ie.fromModelState(pe.moveToBeginningOfBuffer(e.cursorConfig,e.model,r.modelState,i))}return n}static moveToEndOfBuffer(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s];n[s]=ie.fromModelState(pe.moveToEndOfBuffer(e.cursorConfig,e.model,r.modelState,i))}return n}static selectAll(e,t){const i=e.model.getLineCount(),n=e.model.getLineMaxColumn(i);return ie.fromModelState(new Qe(new N(1,1,1,1),wt.Simple,0,new I(i,n),0))}static line(e,t,i,n,s){const o=e.model.validatePosition(n),r=s?e.coordinatesConverter.validateViewPosition(new I(s.lineNumber,s.column),o):e.coordinatesConverter.convertModelPositionToViewPosition(o);if(!i){const d=e.model.getLineCount();let c=o.lineNumber+1,h=1;return c>d&&(c=d,h=e.model.getLineMaxColumn(c)),ie.fromModelState(new Qe(new N(o.lineNumber,1,c,h),wt.Line,0,new I(c,h),0))}const l=t.modelState.selectionStart.getStartPosition().lineNumber;if(o.lineNumber<l)return ie.fromViewState(t.viewState.move(!0,r.lineNumber,1,0));if(o.lineNumber>l){const d=e.getLineCount();let c=r.lineNumber+1,h=1;return c>d&&(c=d,h=e.getLineMaxColumn(c)),ie.fromViewState(t.viewState.move(!0,c,h,0))}else{const d=t.modelState.selectionStart.getEndPosition();return ie.fromModelState(t.modelState.move(!0,d.lineNumber,d.column,0))}}static word(e,t,i,n){const s=e.model.validatePosition(n);return ie.fromModelState(me.word(e.cursorConfig,e.model,t.modelState,i,s))}static cancelSelection(e,t){if(!t.modelState.hasSelection())return new ie(t.modelState,t.viewState);const i=t.viewState.position.lineNumber,n=t.viewState.position.column;return ie.fromViewState(new Qe(new N(i,n,i,n),wt.Simple,0,new I(i,n),0))}static moveTo(e,t,i,n,s){if(i){if(t.modelState.selectionStartKind===wt.Word)return this.word(e,t,i,n);if(t.modelState.selectionStartKind===wt.Line)return this.line(e,t,i,n,s)}const o=e.model.validatePosition(n),r=s?e.coordinatesConverter.validateViewPosition(new I(s.lineNumber,s.column),o):e.coordinatesConverter.convertModelPositionToViewPosition(o);return ie.fromViewState(t.viewState.move(i,r.lineNumber,r.column,0))}static simpleMove(e,t,i,n,s,o){switch(i){case $.Direction.Left:return o===$.Unit.HalfLine?this._moveHalfLineLeft(e,t,n):this._moveLeft(e,t,n,s);case $.Direction.Right:return o===$.Unit.HalfLine?this._moveHalfLineRight(e,t,n):this._moveRight(e,t,n,s);case $.Direction.Up:return o===$.Unit.WrappedLine?this._moveUpByViewLines(e,t,n,s):this._moveUpByModelLines(e,t,n,s);case $.Direction.Down:return o===$.Unit.WrappedLine?this._moveDownByViewLines(e,t,n,s):this._moveDownByModelLines(e,t,n,s);case $.Direction.PrevBlankLine:return o===$.Unit.WrappedLine?t.map(r=>ie.fromViewState(pe.moveToPrevBlankLine(e.cursorConfig,e,r.viewState,n))):t.map(r=>ie.fromModelState(pe.moveToPrevBlankLine(e.cursorConfig,e.model,r.modelState,n)));case $.Direction.NextBlankLine:return o===$.Unit.WrappedLine?t.map(r=>ie.fromViewState(pe.moveToNextBlankLine(e.cursorConfig,e,r.viewState,n))):t.map(r=>ie.fromModelState(pe.moveToNextBlankLine(e.cursorConfig,e.model,r.modelState,n)));case $.Direction.WrappedLineStart:return this._moveToViewMinColumn(e,t,n);case $.Direction.WrappedLineFirstNonWhitespaceCharacter:return this._moveToViewFirstNonWhitespaceColumn(e,t,n);case $.Direction.WrappedLineColumnCenter:return this._moveToViewCenterColumn(e,t,n);case $.Direction.WrappedLineEnd:return this._moveToViewMaxColumn(e,t,n);case $.Direction.WrappedLineLastNonWhitespaceCharacter:return this._moveToViewLastNonWhitespaceColumn(e,t,n);default:return null}}static viewportMove(e,t,i,n,s){const o=e.getCompletelyVisibleViewRange(),r=e.coordinatesConverter.convertViewRangeToModelRange(o);switch(i){case $.Direction.ViewPortTop:{const l=this._firstLineNumberInRange(e.model,r,s),d=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],n,l,d)]}case $.Direction.ViewPortBottom:{const l=this._lastLineNumberInRange(e.model,r,s),d=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],n,l,d)]}case $.Direction.ViewPortCenter:{const l=Math.round((r.startLineNumber+r.endLineNumber)/2),d=e.model.getLineFirstNonWhitespaceColumn(l);return[this._moveToModelPosition(e,t[0],n,l,d)]}case $.Direction.ViewPortIfOutside:{const l=[];for(let d=0,c=t.length;d<c;d++){const h=t[d];l[d]=this.findPositionInViewportIfOutside(e,h,o,n)}return l}default:return null}}static findPositionInViewportIfOutside(e,t,i,n){const s=t.viewState.position.lineNumber;if(i.startLineNumber<=s&&s<=i.endLineNumber-1)return new ie(t.modelState,t.viewState);{let o;s>i.endLineNumber-1?o=i.endLineNumber-1:s<i.startLineNumber?o=i.startLineNumber:o=s;const r=pe.vertical(e.cursorConfig,e,s,t.viewState.position.column,t.viewState.leftoverVisibleColumns,o,!1);return ie.fromViewState(t.viewState.move(n,r.lineNumber,r.column,r.leftoverVisibleColumns))}}static _firstLineNumberInRange(e,t,i){let n=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(n)&&n++,Math.min(t.endLineNumber,n+i-1)}static _lastLineNumberInRange(e,t,i){let n=t.startLineNumber;return t.startColumn!==e.getLineMinColumn(n)&&n++,Math.max(n,t.endLineNumber-i+1)}static _moveLeft(e,t,i,n){return t.map(s=>ie.fromViewState(pe.moveLeft(e.cursorConfig,e,s.viewState,i,n)))}static _moveHalfLineLeft(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,d=Math.round(e.getLineLength(l)/2);n[s]=ie.fromViewState(pe.moveLeft(e.cursorConfig,e,r.viewState,i,d))}return n}static _moveRight(e,t,i,n){return t.map(s=>ie.fromViewState(pe.moveRight(e.cursorConfig,e,s.viewState,i,n)))}static _moveHalfLineRight(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,d=Math.round(e.getLineLength(l)/2);n[s]=ie.fromViewState(pe.moveRight(e.cursorConfig,e,r.viewState,i,d))}return n}static _moveDownByViewLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=ie.fromViewState(pe.moveDown(e.cursorConfig,e,l.viewState,i,n))}return s}static _moveDownByModelLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=ie.fromModelState(pe.moveDown(e.cursorConfig,e.model,l.modelState,i,n))}return s}static _moveUpByViewLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=ie.fromViewState(pe.moveUp(e.cursorConfig,e,l.viewState,i,n))}return s}static _moveUpByModelLines(e,t,i,n){const s=[];for(let o=0,r=t.length;o<r;o++){const l=t[o];s[o]=ie.fromModelState(pe.moveUp(e.cursorConfig,e.model,l.modelState,i,n))}return s}static _moveToViewPosition(e,t,i,n,s){return ie.fromViewState(t.viewState.move(i,n,s,0))}static _moveToModelPosition(e,t,i,n,s){return ie.fromModelState(t.modelState.move(i,n,s,0))}static _moveToViewMinColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,d=e.getLineMinColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,d)}return n}static _moveToViewFirstNonWhitespaceColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,d=e.getLineFirstNonWhitespaceColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,d)}return n}static _moveToViewCenterColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,d=Math.round((e.getLineMaxColumn(l)+e.getLineMinColumn(l))/2);n[s]=this._moveToViewPosition(e,r,i,l,d)}return n}static _moveToViewMaxColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,d=e.getLineMaxColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,d)}return n}static _moveToViewLastNonWhitespaceColumn(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.viewState.position.lineNumber,d=e.getLineLastNonWhitespaceColumn(l);n[s]=this._moveToViewPosition(e,r,i,l,d)}return n}}var $;(function(a){const e=function(s){if(!js(s))return!1;const o=s;return!(!Qn(o.to)||!pi(o.select)&&!Nu(o.select)||!pi(o.by)&&!Qn(o.by)||!pi(o.value)&&!Oo(o.value))};a.metadata={description:"Move cursor to a logical position in the view",args:[{name:"Cursor move argument object",description:`Property-value pairs that can be passed through this argument:
					* 'to': A mandatory logical position value providing where to move the cursor.
						\`\`\`
						'left', 'right', 'up', 'down', 'prevBlankLine', 'nextBlankLine',
						'wrappedLineStart', 'wrappedLineEnd', 'wrappedLineColumnCenter'
						'wrappedLineFirstNonWhitespaceCharacter', 'wrappedLineLastNonWhitespaceCharacter'
						'viewPortTop', 'viewPortCenter', 'viewPortBottom', 'viewPortIfOutside'
						\`\`\`
					* 'by': Unit to move. Default is computed based on 'to' value.
						\`\`\`
						'line', 'wrappedLine', 'character', 'halfLine'
						\`\`\`
					* 'value': Number of units to move. Default is '1'.
					* 'select': If 'true' makes the selection. Default is 'false'.
				`,constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["left","right","up","down","prevBlankLine","nextBlankLine","wrappedLineStart","wrappedLineEnd","wrappedLineColumnCenter","wrappedLineFirstNonWhitespaceCharacter","wrappedLineLastNonWhitespaceCharacter","viewPortTop","viewPortCenter","viewPortBottom","viewPortIfOutside"]},by:{type:"string",enum:["line","wrappedLine","character","halfLine"]},value:{type:"number",default:1},select:{type:"boolean",default:!1}}}}]},a.RawDirection={Left:"left",Right:"right",Up:"up",Down:"down",PrevBlankLine:"prevBlankLine",NextBlankLine:"nextBlankLine",WrappedLineStart:"wrappedLineStart",WrappedLineFirstNonWhitespaceCharacter:"wrappedLineFirstNonWhitespaceCharacter",WrappedLineColumnCenter:"wrappedLineColumnCenter",WrappedLineEnd:"wrappedLineEnd",WrappedLineLastNonWhitespaceCharacter:"wrappedLineLastNonWhitespaceCharacter",ViewPortTop:"viewPortTop",ViewPortCenter:"viewPortCenter",ViewPortBottom:"viewPortBottom",ViewPortIfOutside:"viewPortIfOutside"},a.RawUnit={Line:"line",WrappedLine:"wrappedLine",Character:"character",HalfLine:"halfLine"};function t(s){if(!s.to)return null;let o;switch(s.to){case a.RawDirection.Left:o=i.Left;break;case a.RawDirection.Right:o=i.Right;break;case a.RawDirection.Up:o=i.Up;break;case a.RawDirection.Down:o=i.Down;break;case a.RawDirection.PrevBlankLine:o=i.PrevBlankLine;break;case a.RawDirection.NextBlankLine:o=i.NextBlankLine;break;case a.RawDirection.WrappedLineStart:o=i.WrappedLineStart;break;case a.RawDirection.WrappedLineFirstNonWhitespaceCharacter:o=i.WrappedLineFirstNonWhitespaceCharacter;break;case a.RawDirection.WrappedLineColumnCenter:o=i.WrappedLineColumnCenter;break;case a.RawDirection.WrappedLineEnd:o=i.WrappedLineEnd;break;case a.RawDirection.WrappedLineLastNonWhitespaceCharacter:o=i.WrappedLineLastNonWhitespaceCharacter;break;case a.RawDirection.ViewPortTop:o=i.ViewPortTop;break;case a.RawDirection.ViewPortBottom:o=i.ViewPortBottom;break;case a.RawDirection.ViewPortCenter:o=i.ViewPortCenter;break;case a.RawDirection.ViewPortIfOutside:o=i.ViewPortIfOutside;break;default:return null}let r=n.None;switch(s.by){case a.RawUnit.Line:r=n.Line;break;case a.RawUnit.WrappedLine:r=n.WrappedLine;break;case a.RawUnit.Character:r=n.Character;break;case a.RawUnit.HalfLine:r=n.HalfLine;break}return{direction:o,unit:r,select:!!s.select,value:s.value||1}}a.parse=t;let i;(function(s){s[s.Left=0]="Left",s[s.Right=1]="Right",s[s.Up=2]="Up",s[s.Down=3]="Down",s[s.PrevBlankLine=4]="PrevBlankLine",s[s.NextBlankLine=5]="NextBlankLine",s[s.WrappedLineStart=6]="WrappedLineStart",s[s.WrappedLineFirstNonWhitespaceCharacter=7]="WrappedLineFirstNonWhitespaceCharacter",s[s.WrappedLineColumnCenter=8]="WrappedLineColumnCenter",s[s.WrappedLineEnd=9]="WrappedLineEnd",s[s.WrappedLineLastNonWhitespaceCharacter=10]="WrappedLineLastNonWhitespaceCharacter",s[s.ViewPortTop=11]="ViewPortTop",s[s.ViewPortCenter=12]="ViewPortCenter",s[s.ViewPortBottom=13]="ViewPortBottom",s[s.ViewPortIfOutside=14]="ViewPortIfOutside"})(i=a.Direction||(a.Direction={}));let n;(function(s){s[s.None=0]="None",s[s.Line=1]="Line",s[s.WrappedLine=2]="WrappedLine",s[s.Character=3]="Character",s[s.HalfLine=4]="HalfLine"})(n=a.Unit||(a.Unit={}))})($||($={}));class Eg{constructor(e,t,i){this._indentRulesSupport=t,this._indentationLineProcessor=new Ig(e,i)}shouldIncrease(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIncrease(i)}shouldDecrease(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldDecrease(i)}shouldIgnore(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIgnore(i)}shouldIndentNextLine(e,t){const i=this._indentationLineProcessor.getProcessedLine(e,t);return this._indentRulesSupport.shouldIndentNextLine(i)}}class Yd{constructor(e,t){this.model=e,this.indentationLineProcessor=new Ig(e,t)}getProcessedTokenContextAroundRange(e){const t=this._getProcessedTokensBeforeRange(e),i=this._getProcessedTokensAfterRange(e),n=this._getProcessedPreviousLineTokens(e);return{beforeRangeProcessedTokens:t,afterRangeProcessedTokens:i,previousLineProcessedTokens:n}}_getProcessedTokensBeforeRange(e){this.model.tokenization.forceTokenization(e.startLineNumber);const t=this.model.tokenization.getLineTokens(e.startLineNumber),i=Wn(t,e.startColumn-1);let n;if(Qd(this.model,e.getStartPosition())){const o=e.startColumn-1-i.firstCharOffset,r=i.firstCharOffset,l=r+o;n=t.sliceAndInflate(r,l,0)}else{const o=e.startColumn-1;n=t.sliceAndInflate(0,o,0)}return this.indentationLineProcessor.getProcessedTokens(n)}_getProcessedTokensAfterRange(e){const t=e.isEmpty()?e.getStartPosition():e.getEndPosition();this.model.tokenization.forceTokenization(t.lineNumber);const i=this.model.tokenization.getLineTokens(t.lineNumber),n=Wn(i,t.column-1),s=t.column-1-n.firstCharOffset,o=n.firstCharOffset+s,r=n.firstCharOffset+n.getLineLength(),l=i.sliceAndInflate(o,r,0);return this.indentationLineProcessor.getProcessedTokens(l)}_getProcessedPreviousLineTokens(e){const t=g=>{this.model.tokenization.forceTokenization(g);const f=this.model.tokenization.getLineTokens(g),m=this.model.getLineMaxColumn(g)-1;return Wn(f,m)};this.model.tokenization.forceTokenization(e.startLineNumber);const i=this.model.tokenization.getLineTokens(e.startLineNumber),n=Wn(i,e.startColumn-1),s=Jn.createEmpty("",n.languageIdCodec),o=e.startLineNumber-1;if(o===0||!(n.firstCharOffset===0))return s;const d=t(o);if(!(n.languageId===d.languageId))return s;const h=d.toIViewLineTokens();return this.indentationLineProcessor.getProcessedTokens(h)}}class Ig{constructor(e,t){this.model=e,this.languageConfigurationService=t}getProcessedLine(e,t){const i=(o,r)=>{const l=nt(o);return r+o.substring(l.length)};this.model.tokenization.forceTokenization?.(e);const n=this.model.tokenization.getLineTokens(e);let s=this.getProcessedTokens(n).getLineContent();return t!==void 0&&(s=i(s,t)),s}getProcessedTokens(e){const t=l=>l===ki.String||l===ki.RegEx||l===ki.Comment,i=e.getLanguageId(0),s=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew.getBracketRegExp({global:!0}),o=[];return e.forEach(l=>{const d=e.getStandardTokenType(l);let c=e.getTokenText(l);t(d)&&(c=c.replace(s,""));const h=e.getMetadata(l);o.push({text:c,metadata:h})}),Jn.createFromTextAndMetadata(o,e.languageIdCodec)}}function Qd(a,e){a.tokenization.forceTokenization(e.lineNumber);const t=a.tokenization.getLineTokens(e.lineNumber),i=Wn(t,e.column-1),n=i.firstCharOffset===0,s=t.getLanguageId(0)===i.languageId;return!n&&!s}function Jd(a,e,t,i){e.tokenization.forceTokenization(t.startLineNumber);const n=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),s=i.getLanguageConfiguration(n);if(!s)return null;const r=new Yd(e,i).getProcessedTokenContextAroundRange(t),l=r.previousLineProcessedTokens.getLineContent(),d=r.beforeRangeProcessedTokens.getLineContent(),c=r.afterRangeProcessedTokens.getLineContent(),h=s.onEnter(a,l,d,c);if(!h)return null;const u=h.indentAction;let g=h.appendText;const f=h.removeText||0;g?u===Ke.Indent&&(g="	"+g):u===Ke.Indent||u===Ke.IndentOutdent?g="	":g="";let m=lg(e,t.startLineNumber,t.startColumn);return f&&(m=m.substring(0,m.length-f)),{indentAction:u,appendText:g,removeText:f,indentation:m}}var Vr;const al=Object.create(null);function Ln(a,e){if(e<=0)return"";al[a]||(al[a]=["",a]);const t=al[a];for(let i=t.length;i<=e;i++)t[i]=t[i-1]+a;return t[e]}let ts=Vr=class{static unshiftIndent(e,t,i,n,s){const o=We.visibleColumnFromColumn(e,t,i);if(s){const r=Ln(" ",n),d=We.prevIndentTabStop(o,n)/n;return Ln(r,d)}else{const r="	",d=We.prevRenderTabStop(o,i)/i;return Ln(r,d)}}static shiftIndent(e,t,i,n,s){const o=We.visibleColumnFromColumn(e,t,i);if(s){const r=Ln(" ",n),d=We.nextIndentTabStop(o,n)/n;return Ln(r,d)}else{const r="	",d=We.nextRenderTabStop(o,i)/i;return Ln(r,d)}}constructor(e,t,i){this._languageConfigurationService=i,this._opts=t,this._selection=e,this._selectionId=null,this._useLastEditRangeForCursorEndPosition=!1,this._selectionStartColumnStaysPut=!1}_addEditOperation(e,t,i){this._useLastEditRangeForCursorEndPosition?e.addTrackedEditOperation(t,i):e.addEditOperation(t,i)}getEditOperations(e,t){const i=this._selection.startLineNumber;let n=this._selection.endLineNumber;this._selection.endColumn===1&&i!==n&&(n=n-1);const{tabSize:s,indentSize:o,insertSpaces:r}=this._opts,l=i===n;if(this._opts.useTabStops){this._selection.isEmpty()&&/^\s*$/.test(e.getLineContent(i))&&(this._useLastEditRangeForCursorEndPosition=!0);let d=0,c=0;for(let h=i;h<=n;h++,d=c){c=0;const u=e.getLineContent(h);let g=zi(u);if(this._opts.isUnshift&&(u.length===0||g===0)||!l&&!this._opts.isUnshift&&u.length===0)continue;if(g===-1&&(g=u.length),h>1&&We.visibleColumnFromColumn(u,g+1,s)%o!==0&&e.tokenization.isCheapToTokenize(h-1)){const _=Jd(this._opts.autoIndent,e,new N(h-1,e.getLineMaxColumn(h-1),h-1,e.getLineMaxColumn(h-1)),this._languageConfigurationService);if(_){if(c=d,_.appendText)for(let L=0,w=_.appendText.length;L<w&&c<o&&_.appendText.charCodeAt(L)===V.Space;L++)c++;_.removeText&&(c=Math.max(0,c-_.removeText));for(let L=0;L<c&&!(g===0||u.charCodeAt(g-1)!==V.Space);L++)g--}}if(this._opts.isUnshift&&g===0)continue;let f;this._opts.isUnshift?f=Vr.unshiftIndent(u,g+1,s,o,r):f=Vr.shiftIndent(u,g+1,s,o,r),this._addEditOperation(t,new N(h,1,h,g+1),f),h===i&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn<=g+1)}}else{!this._opts.isUnshift&&this._selection.isEmpty()&&e.getLineLength(i)===0&&(this._useLastEditRangeForCursorEndPosition=!0);const d=r?Ln(" ",o):"	";for(let c=i;c<=n;c++){const h=e.getLineContent(c);let u=zi(h);if(!(this._opts.isUnshift&&(h.length===0||u===0))&&!(!l&&!this._opts.isUnshift&&h.length===0)&&(u===-1&&(u=h.length),!(this._opts.isUnshift&&u===0)))if(this._opts.isUnshift){u=Math.min(u,o);for(let g=0;g<u;g++)if(h.charCodeAt(g)===V.Tab){u=g+1;break}this._addEditOperation(t,new N(c,1,c,u+1),"")}else this._addEditOperation(t,new N(c,1,c,1),d),c===i&&!this._selection.isEmpty()&&(this._selectionStartColumnStaysPut=this._selection.startColumn===1)}}this._selectionId=t.trackSelection(this._selection)}computeCursorState(e,t){if(this._useLastEditRangeForCursorEndPosition){const n=t.getInverseEditOperations()[0];return new le(n.range.endLineNumber,n.range.endColumn,n.range.endLineNumber,n.range.endColumn)}const i=t.getTrackedSelection(this._selectionId);if(this._selectionStartColumnStaysPut){const n=this._selection.startColumn;return i.startColumn<=n?i:i.getDirection()===Md.LTR?new le(i.startLineNumber,n,i.endLineNumber,i.endColumn):new le(i.endLineNumber,i.endColumn,i.startLineNumber,n)}return i}};ts=Vr=ge([P(2,mn)],ts);class uL{constructor(e,t,i){this._range=e,this._charBeforeSelection=t,this._charAfterSelection=i}getEditOperations(e,t){t.addTrackedEditOperation(new N(this._range.startLineNumber,this._range.startColumn,this._range.startLineNumber,this._range.startColumn),this._charBeforeSelection),t.addTrackedEditOperation(new N(this._range.endLineNumber,this._range.endColumn,this._range.endLineNumber,this._range.endColumn),this._charAfterSelection)}computeCursorState(e,t){const i=t.getInverseEditOperations(),n=i[0].range,s=i[1].range;return new le(n.endLineNumber,n.endColumn,s.endLineNumber,s.endColumn-this._charAfterSelection.length)}}class gL{constructor(e,t,i){this._position=e,this._text=t,this._charAfter=i}getEditOperations(e,t){t.addTrackedEditOperation(new N(this._position.lineNumber,this._position.column,this._position.lineNumber,this._position.column),this._text+this._charAfter)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return new le(n.endLineNumber,n.startColumn,n.endLineNumber,n.endColumn-this._charAfter.length)}}function fL(a,e,t){const i=a.tokenization.getLanguageIdAtPosition(e,0);if(e>1){let n,s=-1;for(n=e-1;n>=1;n--){if(a.tokenization.getLanguageIdAtPosition(n,0)!==i)return s;const o=a.getLineContent(n);if(t.shouldIgnore(n)||/^\s+$/.test(o)||o===""){s=n;continue}return n}}return-1}function Vo(a,e,t,i=!0,n){if(a<oi.Full)return null;const s=n.getLanguageConfiguration(e.tokenization.getLanguageId()).indentRulesSupport;if(!s)return null;const o=new Eg(e,s,n);if(t<=1)return{indentation:"",action:null};for(let l=t-1;l>0&&e.getLineContent(l)==="";l--)if(l===1)return{indentation:"",action:null};const r=fL(e,t,o);if(r<0)return null;if(r<1)return{indentation:"",action:null};if(o.shouldIncrease(r)||o.shouldIndentNextLine(r)){const l=e.getLineContent(r);return{indentation:nt(l),action:Ke.Indent,line:r}}else if(o.shouldDecrease(r)){const l=e.getLineContent(r);return{indentation:nt(l),action:null,line:r}}else{if(r===1)return{indentation:nt(e.getLineContent(r)),action:null,line:r};const l=r-1,d=s.getIndentMetadata(e.getLineContent(l));if(!(d&(Wi.INCREASE_MASK|Wi.DECREASE_MASK))&&d&Wi.INDENT_NEXTLINE_MASK){let c=0;for(let h=l-1;h>0;h--)if(!o.shouldIndentNextLine(h)){c=h;break}return{indentation:nt(e.getLineContent(c+1)),action:null,line:c+1}}if(i)return{indentation:nt(e.getLineContent(r)),action:null,line:r};for(let c=r;c>0;c--){if(o.shouldIncrease(c))return{indentation:nt(e.getLineContent(c)),action:Ke.Indent,line:c};if(o.shouldIndentNextLine(c)){let h=0;for(let u=c-1;u>0;u--)if(!o.shouldIndentNextLine(c)){h=u;break}return{indentation:nt(e.getLineContent(h+1)),action:null,line:h+1}}else if(o.shouldDecrease(c))return{indentation:nt(e.getLineContent(c)),action:null,line:c}}return{indentation:nt(e.getLineContent(1)),action:null,line:1}}}function OE(a,e,t,i,n,s){if(a<oi.Full)return null;const o=s.getLanguageConfiguration(t);if(!o)return null;const r=s.getLanguageConfiguration(t).indentRulesSupport;if(!r)return null;const l=new Eg(e,r,s),d=Vo(a,e,i,void 0,s);if(d){const c=d.line;if(c!==void 0){let h=!0;for(let u=c;u<i-1;u++)if(!/^\s*$/.test(e.getLineContent(u))){h=!1;break}if(h){const u=o.onEnter(a,"",e.getLineContent(c),"");if(u){let g=nt(e.getLineContent(c));return u.removeText&&(g=g.substring(0,g.length-u.removeText)),u.indentAction===Ke.Indent||u.indentAction===Ke.IndentOutdent?g=n.shiftIndent(g):u.indentAction===Ke.Outdent&&(g=n.unshiftIndent(g)),l.shouldDecrease(i)&&(g=n.unshiftIndent(g)),u.appendText&&(g+=u.appendText),nt(g)}}}return l.shouldDecrease(i)?d.action===Ke.Indent?d.indentation:n.unshiftIndent(d.indentation):d.action===Ke.Indent?n.shiftIndent(d.indentation):d.indentation}return null}function mL(a,e,t,i,n){if(a<oi.Full)return null;const s=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),o=n.getLanguageConfiguration(s).indentRulesSupport;if(!o)return null;e.tokenization.forceTokenization(t.startLineNumber);const l=new Yd(e,n).getProcessedTokenContextAroundRange(t),d=l.afterRangeProcessedTokens,c=l.beforeRangeProcessedTokens,h=nt(c.getLineContent()),u=_L(e,t.startLineNumber,c),g=Qd(e,t.getStartPosition()),f=e.getLineContent(t.startLineNumber),m=nt(f),_=Vo(a,u,t.startLineNumber+1,void 0,n);if(!_){const w=g?m:h;return{beforeEnter:w,afterEnter:w}}let L=g?m:_.indentation;return _.action===Ke.Indent&&(L=i.shiftIndent(L)),o.shouldDecrease(d.getLineContent())&&(L=i.unshiftIndent(L)),{beforeEnter:g?m:h,afterEnter:L}}function pL(a,e,t,i,n,s){const o=a.autoIndent;if(o<oi.Full||Qd(e,t.getStartPosition()))return null;const l=e.getLanguageIdAtPosition(t.startLineNumber,t.startColumn),d=s.getLanguageConfiguration(l).indentRulesSupport;if(!d)return null;const h=new Yd(e,s).getProcessedTokenContextAroundRange(t),u=h.beforeRangeProcessedTokens.getLineContent(),g=h.afterRangeProcessedTokens.getLineContent(),f=u+g,m=u+i+g;if(!d.shouldDecrease(f)&&d.shouldDecrease(m)){const L=Vo(o,e,t.startLineNumber,!1,s);if(!L)return null;let w=L.indentation;return L.action!==Ke.Indent&&(w=n.unshiftIndent(w)),w}const _=t.startLineNumber-1;if(_>0){const L=e.getLineContent(_);if(d.shouldIndentNextLine(L)&&d.shouldIncrease(m)){const p=Vo(o,e,t.startLineNumber,!1,s)?.indentation;if(p!==void 0){const C=e.getLineContent(t.startLineNumber),b=nt(C),y=n.shiftIndent(p)===b,E=/^\s*$/.test(f),x=a.autoClosingPairs.autoClosingPairsOpenByEnd.get(i),D=x&&x.length>0&&E;if(y&&D)return p}}}return null}function PE(a,e,t){const i=t.getLanguageConfiguration(a.getLanguageId()).indentRulesSupport;return!i||e<1||e>a.getLineCount()?null:i.getIndentMetadata(a.getLineContent(e))}function _L(a,e,t){return{tokenization:{getLineTokens:n=>n===e?t:a.tokenization.getLineTokens(n),getLanguageId:()=>a.getLanguageId(),getLanguageIdAtPosition:(n,s)=>a.getLanguageIdAtPosition(n,s)},getLineContent:n=>n===e?t.getLineContent():a.getLineContent(n)}}class CL{static getEdits(e,t,i,n,s){if(!s&&this._isAutoIndentType(e,t,i)){const o=[];for(const l of i){const d=this._findActualIndentationForSelection(e,t,l,n);if(d===null)return;o.push({selection:l,indentation:d})}const r=Kl.getAutoClosingPairClose(e,t,i,n,!1);return this._getIndentationAndAutoClosingPairEdits(e,t,o,n,r)}}static _isAutoIndentType(e,t,i){if(e.autoIndent<oi.Full)return!1;for(let n=0,s=i.length;n<s;n++)if(!t.tokenization.isCheapToTokenize(i[n].getEndPosition().lineNumber))return!1;return!0}static _findActualIndentationForSelection(e,t,i,n){const s=pL(e,t,i,n,{shiftIndent:r=>Ba(e,r),unshiftIndent:r=>Fo(e,r)},e.languageConfigurationService);if(s===null)return null;const o=lg(t,i.startLineNumber,i.startColumn);return s===e.normalizeIndentation(o)?null:s}static _getIndentationAndAutoClosingPairEdits(e,t,i,n,s){const o=i.map(({selection:l,indentation:d})=>{if(s!==null){const c=this._getEditFromIndentationAndSelection(e,t,d,l,n,!1);return new RL(c,l,n,s)}else{const c=this._getEditFromIndentationAndSelection(e,t,d,l,n,!0);return Sn(c.range,c.text,!1)}}),r={shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1};return new bt(we.TypingOther,o,r)}static _getEditFromIndentationAndSelection(e,t,i,n,s,o=!0){const r=n.startLineNumber,l=t.getLineFirstNonWhitespaceColumn(r);let d=e.normalizeIndentation(i);if(l!==0){const h=t.getLineContent(r);d+=h.substring(l-1,n.startColumn-1)}return d+=o?s:"",{range:new N(r,1,n.endLineNumber,n.endColumn),text:d}}}class wL{static getEdits(e,t,i,n,s,o){if(Dg(t,i,n,s,o))return this._runAutoClosingOvertype(e,n,o)}static _runAutoClosingOvertype(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const l=t[s].getPosition(),d=new N(l.lineNumber,l.column,l.lineNumber,l.column+1);n[s]=new Mt(d,i)}return new bt(we.TypingOther,n,{shouldPushStackElementBefore:Ha(e,we.TypingOther),shouldPushStackElementAfter:!1})}}class LL{static getEdits(e,t,i,n,s){if(Dg(e,t,i,n,s)){const o=i.map(r=>new Mt(new N(r.positionLineNumber,r.positionColumn,r.positionLineNumber,r.positionColumn+1),"",!1));return new bt(we.TypingOther,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}}class Kl{static getEdits(e,t,i,n,s,o){if(!o){const r=this.getAutoClosingPairClose(e,t,i,n,s);if(r!==null)return this._runAutoClosingOpenCharType(i,n,s,r)}}static _runAutoClosingOpenCharType(e,t,i,n){const s=[];for(let o=0,r=e.length;o<r;o++){const l=e[o];s[o]=new IL(l,t,!i,n)}return new bt(we.TypingOther,s,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}static getAutoClosingPairClose(e,t,i,n,s){for(const f of i)if(!f.isEmpty())return null;const o=i.map(f=>{const m=f.getPosition();return s?{lineNumber:m.lineNumber,beforeColumn:m.column-n.length,afterColumn:m.column}:{lineNumber:m.lineNumber,beforeColumn:m.column,afterColumn:m.column}}),r=this._findAutoClosingPairOpen(e,t,o.map(f=>new I(f.lineNumber,f.beforeColumn)),n);if(!r)return null;let l,d;if(gn(n)?(l=e.autoClosingQuotes,d=e.shouldAutoCloseBefore.quote):(e.blockCommentStartToken?r.open.includes(e.blockCommentStartToken):!1)?(l=e.autoClosingComments,d=e.shouldAutoCloseBefore.comment):(l=e.autoClosingBrackets,d=e.shouldAutoCloseBefore.bracket),l==="never")return null;const h=this._findContainedAutoClosingPair(e,r),u=h?h.close:"";let g=!0;for(const f of o){const{lineNumber:m,beforeColumn:_,afterColumn:L}=f,w=t.getLineContent(m),p=w.substring(0,_-1),C=w.substring(L-1);if(C.startsWith(u)||(g=!1),C.length>0){const E=C.charAt(0);if(!this._isBeforeClosingBrace(e,C)&&!d(E))return null}if(r.open.length===1&&(n==="'"||n==='"')&&l!=="always"){const E=Ao(e.wordSeparators,[]);if(p.length>0){const x=p.charCodeAt(p.length-1);if(E.get(x)===et.Regular)return null}}if(!t.tokenization.isCheapToTokenize(m))return null;t.tokenization.forceTokenization(m);const b=t.tokenization.getLineTokens(m),S=Wn(b,_-1);if(!r.shouldAutoClose(S,_-S.firstCharOffset))return null;const y=r.findNeutralCharacter();if(y){const E=t.tokenization.getTokenTypeIfInsertingCharacter(m,_,y);if(!r.isOK(E))return null}}return g?r.close.substring(0,r.close.length-u.length):r.close}static _findContainedAutoClosingPair(e,t){if(t.open.length<=1)return null;const i=t.close.charAt(t.close.length-1),n=e.autoClosingPairs.autoClosingPairsCloseByEnd.get(i)||[];let s=null;for(const o of n)o.open!==t.open&&t.open.includes(o.open)&&t.close.endsWith(o.close)&&(!s||o.open.length>s.open.length)&&(s=o);return s}static _findAutoClosingPairOpen(e,t,i,n){const s=e.autoClosingPairs.autoClosingPairsOpenByEnd.get(n);if(!s)return null;let o=null;for(const r of s)if(o===null||r.open.length>o.open.length){let l=!0;for(const d of i)if(t.getValueInRange(new N(d.lineNumber,d.column-r.open.length+1,d.lineNumber,d.column))+n!==r.open){l=!1;break}l&&(o=r)}return o}static _isBeforeClosingBrace(e,t){const i=t.charAt(0),n=e.autoClosingPairs.autoClosingPairsOpenByStart.get(i)||[],s=e.autoClosingPairs.autoClosingPairsCloseByStart.get(i)||[],o=n.some(l=>t.startsWith(l.open)),r=s.some(l=>t.startsWith(l.close));return!o&&r}}class ah{static getEdits(e,t){if(!(e.inputMode==="overtype"))return null;const n=t.map(s=>new cL(s.insertedTextRange));return new bt(we.TypingOther,n,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}class vL{static getEdits(e,t,i,n,s){if(!s&&this._isSurroundSelectionType(e,t,i,n))return this._runSurroundSelectionType(e,i,n)}static _runSurroundSelectionType(e,t,i){const n=[];for(let s=0,o=t.length;s<o;s++){const r=t[s],l=e.surroundingPairs[i];n[s]=new uL(r,i,l)}return new bt(we.Other,n,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _isSurroundSelectionType(e,t,i,n){if(!Tg(e,n)||!e.surroundingPairs.hasOwnProperty(n))return!1;const s=gn(n);for(const o of i){if(o.isEmpty())return!1;let r=!0;for(let l=o.startLineNumber;l<=o.endLineNumber;l++){const d=t.getLineContent(l),c=l===o.startLineNumber?o.startColumn-1:0,h=l===o.endLineNumber?o.endColumn-1:d.length,u=d.substring(c,h);if(/[^ \t]/.test(u)){r=!1;break}}if(r)return!1;if(s&&o.startLineNumber===o.endLineNumber&&o.startColumn+1===o.endColumn){const l=t.getValueInRange(o);if(gn(l))return!1}}return!0}}class bL{static getEdits(e,t,i,n,s,o){if(!o&&this._isTypeInterceptorElectricChar(t,i,n)){const r=this._typeInterceptorElectricChar(e,t,i,n[0],s);if(r)return r}}static _isTypeInterceptorElectricChar(e,t,i){return!!(i.length===1&&t.tokenization.isCheapToTokenize(i[0].getEndPosition().lineNumber))}static _typeInterceptorElectricChar(e,t,i,n,s){if(!t.electricChars.hasOwnProperty(s)||!n.isEmpty())return null;const o=n.getPosition();i.tokenization.forceTokenization(o.lineNumber);const r=i.tokenization.getLineTokens(o.lineNumber);let l;try{l=t.onElectricCharacter(s,r,o.column)}catch(d){return vt(d),null}if(!l)return null;if(l.matchOpenBracket){const d=(r.getLineContent()+s).lastIndexOf(l.matchOpenBracket)+1,c=i.bracketPairs.findMatchingBracketUp(l.matchOpenBracket,{lineNumber:o.lineNumber,column:d},500);if(c){if(c.startLineNumber===o.lineNumber)return null;const h=i.getLineContent(c.startLineNumber),u=nt(h),g=t.normalizeIndentation(u),f=i.getLineContent(o.lineNumber),m=i.getLineFirstNonWhitespaceColumn(o.lineNumber)||o.column,_=f.substring(m-1,o.column-1),L=g+_+s,w=new N(o.lineNumber,1,o.lineNumber,o.column),p=new Mt(w,L);return new bt(tc(L,e),[p],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!0})}}return null}}class SL{static getEdits(e,t,i,n,s){const o=[];for(let l=0,d=i.length;l<d;l++){const c=e.inputMode==="overtype"&&!s?jl:Mt;o[l]=new c(i[l],n)}const r=tc(n,t);return new bt(r,o,{shouldPushStackElementBefore:Ha(t,r),shouldPushStackElementAfter:!1})}}class Rg{static getEdits(e,t,i,n,s){if(!s&&n===`
`){const o=[];for(let r=0,l=i.length;r<l;r++)o[r]=this._enter(e,t,!1,i[r]);return new bt(we.TypingOther,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}}static _enter(e,t,i,n){if(e.autoIndent===oi.None)return Sn(n,`
`,i);if(!t.tokenization.isCheapToTokenize(n.getStartPosition().lineNumber)||e.autoIndent===oi.Keep){const l=t.getLineContent(n.startLineNumber),d=nt(l).substring(0,n.startColumn-1);return Sn(n,`
`+e.normalizeIndentation(d),i)}const s=Jd(e.autoIndent,t,n,e.languageConfigurationService);if(s){if(s.indentAction===Ke.None)return Sn(n,`
`+e.normalizeIndentation(s.indentation+s.appendText),i);if(s.indentAction===Ke.Indent)return Sn(n,`
`+e.normalizeIndentation(s.indentation+s.appendText),i);if(s.indentAction===Ke.IndentOutdent){const l=e.normalizeIndentation(s.indentation),d=e.normalizeIndentation(s.indentation+s.appendText),c=`
`+d+`
`+l;return i?new Wr(n,c,!0):new ea(n,c,-1,d.length-l.length,!0)}else if(s.indentAction===Ke.Outdent){const l=Fo(e,s.indentation);return Sn(n,`
`+e.normalizeIndentation(l+s.appendText),i)}}const o=t.getLineContent(n.startLineNumber),r=nt(o).substring(0,n.startColumn-1);if(e.autoIndent>=oi.Full){const l=mL(e.autoIndent,t,n,{unshiftIndent:d=>Fo(e,d),shiftIndent:d=>Ba(e,d),normalizeIndentation:d=>e.normalizeIndentation(d)},e.languageConfigurationService);if(l){let d=e.visibleColumnFromColumn(t,n.getEndPosition());const c=n.endColumn,h=t.getLineContent(n.endLineNumber),u=zi(h);if(u>=0?n=n.setEndPosition(n.endLineNumber,Math.max(n.endColumn,u+1)):n=n.setEndPosition(n.endLineNumber,t.getLineMaxColumn(n.endLineNumber)),i)return new Wr(n,`
`+e.normalizeIndentation(l.afterEnter),!0);{let g=0;return c<=u+1&&(e.insertSpaces||(d=Math.ceil(d/e.indentSize)),g=Math.min(d+1-e.normalizeIndentation(l.afterEnter).length-1,0)),new ea(n,`
`+e.normalizeIndentation(l.afterEnter),0,g,!0)}}}return Sn(n,`
`+e.normalizeIndentation(r),i)}static lineInsertBefore(e,t,i){if(t===null||i===null)return[];const n=[];for(let s=0,o=i.length;s<o;s++){let r=i[s].positionLineNumber;if(r===1)n[s]=new Wr(new N(1,1,1,1),`
`);else{r--;const l=t.getLineMaxColumn(r);n[s]=this._enter(e,t,!1,new N(r,l,r,l))}}return n}static lineInsertAfter(e,t,i){if(t===null||i===null)return[];const n=[];for(let s=0,o=i.length;s<o;s++){const r=i[s].positionLineNumber,l=t.getLineMaxColumn(r);n[s]=this._enter(e,t,!1,new N(r,l,r,l))}return n}static lineBreakInsert(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++)n[s]=this._enter(e,t,!0,i[s]);return n}}class yL{static getEdits(e,t,i,n,s,o){const r=this._distributePasteToCursors(e,i,n,s,o);return r?(i=i.sort(N.compareRangesUsingStarts),this._distributedPaste(e,t,i,r)):this._simplePaste(e,t,i,n,s)}static _distributePasteToCursors(e,t,i,n,s){if(n||t.length===1)return null;if(s&&s.length===t.length)return s;if(e.multiCursorPaste==="spread"){i.charCodeAt(i.length-1)===V.LineFeed&&(i=i.substring(0,i.length-1)),i.charCodeAt(i.length-1)===V.CarriageReturn&&(i=i.substring(0,i.length-1));const o=Ad(i);if(o.length===t.length)return o}return null}static _distributedPaste(e,t,i,n){const s=[];for(let o=0,r=i.length;o<r;o++){const d=e.overtypeOnPaste&&e.inputMode==="overtype"?jl:Mt;s[o]=new d(i[o],n[o])}return new bt(we.Other,s,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}static _simplePaste(e,t,i,n,s){const o=[];for(let r=0,l=i.length;r<l;r++){const d=i[r],c=d.getPosition();if(s&&!d.isEmpty()&&(s=!1),s&&n.indexOf(`
`)!==n.length-1&&(s=!1),s){const h=new N(c.lineNumber,1,c.lineNumber,1);o[r]=new hL(h,n,d,!0)}else{const u=e.overtypeOnPaste&&e.inputMode==="overtype"?jl:Mt;o[r]=new u(d,n)}}return new bt(we.Other,o,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!0})}}class xL{static getEdits(e,t,i,n,s,o,r,l){const d=n.map(c=>this._compositionType(i,c,s,o,r,l));return new bt(we.TypingOther,d,{shouldPushStackElementBefore:Ha(e,we.TypingOther),shouldPushStackElementAfter:!1})}static _compositionType(e,t,i,n,s,o){if(!t.isEmpty())return null;const r=t.getPosition(),l=Math.max(1,r.column-n),d=Math.min(e.getLineMaxColumn(r.lineNumber),r.column+s),c=new N(r.lineNumber,l,r.lineNumber,d);return new ea(c,i,0,o)}}class NL{static getEdits(e,t,i){const n=[];for(let o=0,r=t.length;o<r;o++)n[o]=new Mt(t[o],i);const s=tc(i,e);return new bt(s,n,{shouldPushStackElementBefore:Ha(e,s),shouldPushStackElementAfter:!1})}}class EL{static getCommands(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++){const r=i[s];if(r.isEmpty()){const l=t.getLineContent(r.startLineNumber);if(/^\s*$/.test(l)&&t.tokenization.isCheapToTokenize(r.startLineNumber)){let d=this._goodIndentForLine(e,t,r.startLineNumber);d=d||"	";const c=e.normalizeIndentation(d);if(!l.startsWith(c)){n[s]=new Mt(new N(r.startLineNumber,1,r.startLineNumber,l.length+1),c,!0);continue}}n[s]=this._replaceJumpToNextIndent(e,t,r,!0)}else{if(r.startLineNumber===r.endLineNumber){const l=t.getLineMaxColumn(r.startLineNumber);if(r.startColumn!==1||r.endColumn!==l){n[s]=this._replaceJumpToNextIndent(e,t,r,!1);continue}}n[s]=new ts(r,{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService)}}return n}static _goodIndentForLine(e,t,i){let n=null,s="";const o=Vo(e.autoIndent,t,i,!1,e.languageConfigurationService);if(o)n=o.action,s=o.indentation;else if(i>1){let r;for(r=i-1;r>=1;r--){const c=t.getLineContent(r);if(Qo(c)>=0)break}if(r<1)return null;const l=t.getLineMaxColumn(r),d=Jd(e.autoIndent,t,new N(r,l,r,l),e.languageConfigurationService);d&&(s=d.indentation+d.appendText)}return n&&(n===Ke.Indent&&(s=Ba(e,s)),n===Ke.Outdent&&(s=Fo(e,s)),s=e.normalizeIndentation(s)),s||null}static _replaceJumpToNextIndent(e,t,i,n){let s="";const o=i.getStartPosition();if(e.insertSpaces){const r=e.visibleColumnFromColumn(t,o),l=e.indentSize,d=l-r%l;for(let c=0;c<d;c++)s+=" "}else s="	";return new Mt(i,s,n)}}class ec extends ea{constructor(e,t,i,n,s,o){super(e,t,i,n),this._openCharacter=s,this._closeCharacter=o,this.closeCharacterRange=null,this.enclosingRange=null}_computeCursorStateWithRange(e,t,i){return this.closeCharacterRange=new N(t.startLineNumber,t.endColumn-this._closeCharacter.length,t.endLineNumber,t.endColumn),this.enclosingRange=new N(t.startLineNumber,t.endColumn-this._openCharacter.length-this._closeCharacter.length,t.endLineNumber,t.endColumn),super.computeCursorState(e,i)}}class IL extends ec{constructor(e,t,i,n){const s=(i?t:"")+n,o=0,r=-n.length;super(e,s,o,r,t,n)}computeCursorState(e,t){const n=t.getInverseEditOperations()[0].range;return this._computeCursorStateWithRange(e,n,t)}}class RL extends ec{constructor(e,t,i,n){const s=i+n,o=0,r=i.length;super(t,s,o,r,i,n),this._autoIndentationEdit=e,this._autoClosingEdit={range:t,text:s}}getEditOperations(e,t){t.addTrackedEditOperation(this._autoIndentationEdit.range,this._autoIndentationEdit.text),t.addTrackedEditOperation(this._autoClosingEdit.range,this._autoClosingEdit.text)}computeCursorState(e,t){const i=t.getInverseEditOperations();if(i.length!==2)throw new Error("There should be two inverse edit operations!");const n=i[0].range,s=i[1].range,o=n.plusRange(s);return this._computeCursorStateWithRange(e,o,t)}}function tc(a,e){return a===" "?e===we.TypingFirstSpace||e===we.TypingConsecutiveSpace?we.TypingConsecutiveSpace:we.TypingFirstSpace:we.TypingOther}function Ha(a,e){return dh(a)&&!dh(e)?!0:a===we.TypingFirstSpace?!1:lh(a)!==lh(e)}function lh(a){return a===we.TypingConsecutiveSpace||a===we.TypingFirstSpace?"space":a}function dh(a){return a===we.TypingOther||a===we.TypingFirstSpace||a===we.TypingConsecutiveSpace}function Dg(a,e,t,i,n){if(a.autoClosingOvertype==="never"||!a.autoClosingPairs.autoClosingPairsCloseSingleChar.has(n))return!1;for(let s=0,o=t.length;s<o;s++){const r=t[s];if(!r.isEmpty())return!1;const l=r.getPosition(),d=e.getLineContent(l.lineNumber);if(d.charAt(l.column-1)!==n)return!1;const h=gn(n);if((l.column>2?d.charCodeAt(l.column-2):V.Null)===V.Backslash&&h)return!1;if(a.autoClosingOvertype==="auto"){let g=!1;for(let f=0,m=i.length;f<m;f++){const _=i[f];if(l.lineNumber===_.startLineNumber&&l.column===_.startColumn){g=!0;break}}if(!g)return!1}}return!0}function Sn(a,e,t){return t?new Wr(a,e,!0):new Mt(a,e,!0)}function Ba(a,e,t){return t=t||1,ts.shiftIndent(e,e.length+t,a.tabSize,a.indentSize,a.insertSpaces)}function Fo(a,e,t){return t=t||1,ts.unshiftIndent(e,e.length+t,a.tabSize,a.indentSize,a.insertSpaces)}function Tg(a,e){return gn(e)?a.autoSurround==="quotes"||a.autoSurround==="languageDefined":a.autoSurround==="brackets"||a.autoSurround==="languageDefined"}class Rn{static indent(e,t,i){if(t===null||i===null)return[];const n=[];for(let s=0,o=i.length;s<o;s++)n[s]=new ts(i[s],{isUnshift:!1,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return n}static outdent(e,t,i){const n=[];for(let s=0,o=i.length;s<o;s++)n[s]=new ts(i[s],{isUnshift:!0,tabSize:e.tabSize,indentSize:e.indentSize,insertSpaces:e.insertSpaces,useTabStops:e.useTabStops,autoIndent:e.autoIndent},e.languageConfigurationService);return n}static shiftIndent(e,t,i){return Ba(e,t,i)}static unshiftIndent(e,t,i){return Fo(e,t,i)}static paste(e,t,i,n,s,o){return yL.getEdits(e,t,i,n,s,o)}static tab(e,t,i){return EL.getCommands(e,t,i)}static compositionType(e,t,i,n,s,o,r,l){return xL.getEdits(e,t,i,n,s,o,r,l)}static compositionEndWithInterceptors(e,t,i,n,s,o){if(!n)return null;let r=null;for(const u of n)if(r===null)r=u.insertedText;else if(r!==u.insertedText)return null;if(!r||r.length!==1)return ah.getEdits(t,n);const l=r;let d=!1;for(const u of n)if(u.deletedText.length!==0){d=!0;break}if(d){if(!Tg(t,l)||!t.surroundingPairs.hasOwnProperty(l))return null;const u=gn(l);for(const m of n)if(m.deletedSelectionStart!==0||m.deletedSelectionEnd!==m.deletedText.length||/^[ \t]+$/.test(m.deletedText)||u&&gn(m.deletedText))return null;const g=[];for(const m of s){if(!m.isEmpty())return null;g.push(m.getPosition())}if(g.length!==n.length)return null;const f=[];for(let m=0,_=g.length;m<_;m++)f.push(new gL(g[m],n[m].deletedText,t.surroundingPairs[l]));return new bt(we.TypingOther,f,{shouldPushStackElementBefore:!0,shouldPushStackElementAfter:!1})}const c=LL.getEdits(t,i,s,o,l);if(c!==void 0)return c;const h=Kl.getEdits(t,i,s,l,!0,!1);return h!==void 0?h:ah.getEdits(t,n)}static typeWithInterceptors(e,t,i,n,s,o,r){const l=Rg.getEdits(i,n,s,r,e);if(l!==void 0)return l;const d=CL.getEdits(i,n,s,r,e);if(d!==void 0)return d;const c=wL.getEdits(t,i,n,s,o,r);if(c!==void 0)return c;const h=Kl.getEdits(i,n,s,r,!1,e);if(h!==void 0)return h;const u=vL.getEdits(i,n,s,r,e);if(u!==void 0)return u;const g=bL.getEdits(t,i,n,s,r,e);return g!==void 0?g:SL.getEdits(i,t,s,r,e)}static typeWithoutInterceptors(e,t,i,n,s){return NL.getEdits(e,n,s)}}class DL{constructor(e,t,i,n,s,o,r){this.deletedText=e,this.deletedSelectionStart=t,this.deletedSelectionEnd=i,this.insertedText=n,this.insertedSelectionStart=s,this.insertedSelectionEnd=o,this.insertedTextRange=r}}const re=$e.EditorCore;class ye extends Ia{runEditorCommand(e,t,i){const n=t._getViewModel();n&&this.runCoreEditorCommand(n,i||{})}}var _e;(function(a){const e=function(s){if(!js(s))return!1;const o=s;return!(!Qn(o.to)||!pi(o.by)&&!Qn(o.by)||!pi(o.value)&&!Oo(o.value)||!pi(o.revealCursor)&&!Nu(o.revealCursor))};a.metadata={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'to': A mandatory direction value.\n						```\n						'up', 'down'\n						```\n					* 'by': Unit to move. Default is computed based on 'to' value.\n						```\n						'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n						```\n					* 'value': Number of units to move. Default is '1'.\n					* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n				",constraint:e,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},a.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},a.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"};function t(s){let o;switch(s.to){case a.RawDirection.Up:o=i.Up;break;case a.RawDirection.Right:o=i.Right;break;case a.RawDirection.Down:o=i.Down;break;case a.RawDirection.Left:o=i.Left;break;default:return null}let r;switch(s.by){case a.RawUnit.Line:r=n.Line;break;case a.RawUnit.WrappedLine:r=n.WrappedLine;break;case a.RawUnit.Page:r=n.Page;break;case a.RawUnit.HalfPage:r=n.HalfPage;break;case a.RawUnit.Editor:r=n.Editor;break;case a.RawUnit.Column:r=n.Column;break;default:r=n.WrappedLine}const l=Math.floor(s.value||1),d=!!s.revealCursor;return{direction:o,unit:r,value:l,revealCursor:d,select:!!s.select}}a.parse=t;let i;(function(s){s[s.Up=1]="Up",s[s.Right=2]="Right",s[s.Down=3]="Down",s[s.Left=4]="Left"})(i=a.Direction||(a.Direction={}));let n;(function(s){s[s.Line=1]="Line",s[s.WrappedLine=2]="WrappedLine",s[s.Page=3]="Page",s[s.HalfPage=4]="HalfPage",s[s.Editor=5]="Editor",s[s.Column=6]="Column"})(n=a.Unit||(a.Unit={}))})(_e||(_e={}));var Cs;(function(a){const e=function(t){if(!js(t))return!1;const i=t;return!(!Oo(i.lineNumber)&&!Qn(i.lineNumber)||!pi(i.at)&&!Qn(i.at))};a.metadata={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'lineNumber': A mandatory line number value.\n					* 'at': Logical position at which line has to be revealed.\n						```\n						'top', 'center', 'bottom'\n						```\n				",constraint:e,schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},a.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}})(Cs||(Cs={}));class $l{constructor(e){e.addImplementation(1e4,"code-editor",(t,i)=>{const n=t.get(zt).getFocusedCodeEditor();return n&&n.hasTextFocus()?this._runEditorCommand(t,n,i):!1}),e.addImplementation(1e3,"generic-dom-input-textarea",(t,i)=>{const n=zr();return n&&jf(n)?(this.runDOMCommand(n),!0):!1}),e.addImplementation(0,"generic-dom",(t,i)=>{const n=t.get(zt).getActiveCodeEditor();return n?(n.focus(),this._runEditorCommand(t,n,i)):!1})}_runEditorCommand(e,t,i){const n=this.runEditorCommand(e,t,i);return n||!0}}var Ri;(function(a){a[a.Regular=0]="Regular",a[a.Minimal=1]="Minimal",a[a.None=2]="None"})(Ri||(Ri={}));var Ue;(function(a){class e extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){if(!C.position)return;p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,[lt.moveTo(p,p.getPrimaryCursorState(),this._inSelectionMode,C.position,C.viewPosition)])&&C.revealType!==Ri.None&&p.revealAllCursors(C.source,!0,!0)}}a.MoveTo=q(new e({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),a.MoveToSelect=q(new e({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class t extends ye{runCoreEditorCommand(p,C){p.model.pushStackElement();const b=this._getColumnSelectResult(p,p.getPrimaryCursorState(),p.getCursorColumnSelectData(),C);b!==null&&(p.setCursorStates(C.source,he.Explicit,b.viewStates.map(S=>ie.fromViewState(S))),p.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:b.fromLineNumber,fromViewVisualColumn:b.fromVisualColumn,toViewLineNumber:b.toLineNumber,toViewVisualColumn:b.toVisualColumn}),b.reversed?p.revealTopMostCursor(C.source):p.revealBottomMostCursor(C.source))}}a.ColumnSelect=q(new class extends t{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(w,p,C,b){if(typeof b.position>"u"||typeof b.viewPosition>"u"||typeof b.mouseColumn>"u")return null;const S=w.model.validatePosition(b.position),y=w.coordinatesConverter.validateViewPosition(new I(b.viewPosition.lineNumber,b.viewPosition.column),S),E=b.doColumnSelect?C.fromViewLineNumber:y.lineNumber,x=b.doColumnSelect?C.fromViewVisualColumn:b.mouseColumn-1;return In.columnSelect(w.cursorConfig,w,E,x,y.lineNumber,b.mouseColumn-1)}}),a.CursorColumnSelectLeft=q(new class extends t{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|M.Alt|T.LeftArrow,linux:{primary:0}}})}_getColumnSelectResult(w,p,C,b){return In.columnSelectLeft(w.cursorConfig,w,C)}}),a.CursorColumnSelectRight=q(new class extends t{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|M.Alt|T.RightArrow,linux:{primary:0}}})}_getColumnSelectResult(w,p,C,b){return In.columnSelectRight(w.cursorConfig,w,C)}});class i extends t{constructor(p){super(p),this._isPaged=p.isPaged}_getColumnSelectResult(p,C,b,S){return In.columnSelectUp(p.cursorConfig,p,b,this._isPaged)}}a.CursorColumnSelectUp=q(new i({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|M.Alt|T.UpArrow,linux:{primary:0}}})),a.CursorColumnSelectPageUp=q(new i({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|M.Alt|T.PageUp,linux:{primary:0}}}));class n extends t{constructor(p){super(p),this._isPaged=p.isPaged}_getColumnSelectResult(p,C,b,S){return In.columnSelectDown(p.cursorConfig,p,b,this._isPaged)}}a.CursorColumnSelectDown=q(new n({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|M.Alt|T.DownArrow,linux:{primary:0}}})),a.CursorColumnSelectPageDown=q(new n({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|M.Alt|T.PageDown,linux:{primary:0}}}));class s extends ye{constructor(){super({id:"cursorMove",precondition:void 0,metadata:$.metadata})}runCoreEditorCommand(p,C){const b=$.parse(C);b&&this._runCursorMove(p,C.source,b)}_runCursorMove(p,C,b){p.model.pushStackElement(),p.setCursorStates(C,he.Explicit,s._move(p,p.getCursorStates(),b)),p.revealAllCursors(C,!0)}static _move(p,C,b){const S=b.select,y=b.value;switch(b.direction){case $.Direction.Left:case $.Direction.Right:case $.Direction.Up:case $.Direction.Down:case $.Direction.PrevBlankLine:case $.Direction.NextBlankLine:case $.Direction.WrappedLineStart:case $.Direction.WrappedLineFirstNonWhitespaceCharacter:case $.Direction.WrappedLineColumnCenter:case $.Direction.WrappedLineEnd:case $.Direction.WrappedLineLastNonWhitespaceCharacter:return lt.simpleMove(p,C,b.direction,S,y,b.unit);case $.Direction.ViewPortTop:case $.Direction.ViewPortBottom:case $.Direction.ViewPortCenter:case $.Direction.ViewPortIfOutside:return lt.viewportMove(p,C,b.direction,S,y);default:return null}}}a.CursorMoveImpl=s,a.CursorMove=q(new s);let o;(function(w){w[w.PAGE_SIZE_MARKER=-1]="PAGE_SIZE_MARKER"})(o||(o={}));class r extends ye{constructor(p){super(p),this._staticArgs=p.args}runCoreEditorCommand(p,C){let b=this._staticArgs;this._staticArgs.value===o.PAGE_SIZE_MARKER&&(b={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:C.pageSize||p.cursorConfig.pageSize}),p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,lt.simpleMove(p,p.getCursorStates(),b.direction,b.select,b.value,b.unit)),p.revealAllCursors(C.source,!0)}}a.CursorLeft=q(new r({args:{direction:$.Direction.Left,unit:$.Unit.None,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.LeftArrow,mac:{primary:T.LeftArrow,secondary:[M.WinCtrl|T.KeyB]}}})),a.CursorLeftSelect=q(new r({args:{direction:$.Direction.Left,unit:$.Unit.None,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.LeftArrow}})),a.CursorRight=q(new r({args:{direction:$.Direction.Right,unit:$.Unit.None,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.RightArrow,mac:{primary:T.RightArrow,secondary:[M.WinCtrl|T.KeyF]}}})),a.CursorRightSelect=q(new r({args:{direction:$.Direction.Right,unit:$.Unit.None,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.RightArrow}})),a.CursorUp=q(new r({args:{direction:$.Direction.Up,unit:$.Unit.WrappedLine,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.UpArrow,mac:{primary:T.UpArrow,secondary:[M.WinCtrl|T.KeyP]}}})),a.CursorUpSelect=q(new r({args:{direction:$.Direction.Up,unit:$.Unit.WrappedLine,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.UpArrow,secondary:[M.CtrlCmd|M.Shift|T.UpArrow],mac:{primary:M.Shift|T.UpArrow},linux:{primary:M.Shift|T.UpArrow}}})),a.CursorPageUp=q(new r({args:{direction:$.Direction.Up,unit:$.Unit.WrappedLine,select:!1,value:o.PAGE_SIZE_MARKER},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.PageUp}})),a.CursorPageUpSelect=q(new r({args:{direction:$.Direction.Up,unit:$.Unit.WrappedLine,select:!0,value:o.PAGE_SIZE_MARKER},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.PageUp}})),a.CursorDown=q(new r({args:{direction:$.Direction.Down,unit:$.Unit.WrappedLine,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.DownArrow,mac:{primary:T.DownArrow,secondary:[M.WinCtrl|T.KeyN]}}})),a.CursorDownSelect=q(new r({args:{direction:$.Direction.Down,unit:$.Unit.WrappedLine,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.DownArrow,secondary:[M.CtrlCmd|M.Shift|T.DownArrow],mac:{primary:M.Shift|T.DownArrow},linux:{primary:M.Shift|T.DownArrow}}})),a.CursorPageDown=q(new r({args:{direction:$.Direction.Down,unit:$.Unit.WrappedLine,select:!1,value:o.PAGE_SIZE_MARKER},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.PageDown}})),a.CursorPageDownSelect=q(new r({args:{direction:$.Direction.Down,unit:$.Unit.WrappedLine,select:!0,value:o.PAGE_SIZE_MARKER},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.PageDown}})),a.CreateCursor=q(new class extends ye{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(w,p){if(!p.position)return;let C;p.wholeLine?C=lt.line(w,w.getPrimaryCursorState(),!1,p.position,p.viewPosition):C=lt.moveTo(w,w.getPrimaryCursorState(),!1,p.position,p.viewPosition);const b=w.getCursorStates();if(b.length>1){const S=C.modelState?C.modelState.position:null,y=C.viewState?C.viewState.position:null;for(let E=0,x=b.length;E<x;E++){const R=b[E];if(!(S&&!R.modelState.selection.containsPosition(S))&&!(y&&!R.viewState.selection.containsPosition(y))){b.splice(E,1),w.model.pushStackElement(),w.setCursorStates(p.source,he.Explicit,b);return}}}b.push(C),w.model.pushStackElement(),w.setCursorStates(p.source,he.Explicit,b)}}),a.LastCursorMoveToSelect=q(new class extends ye{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(w,p){if(!p.position)return;const C=w.getLastAddedCursorIndex(),b=w.getCursorStates(),S=b.slice(0);S[C]=lt.moveTo(w,b[C],!0,p.position,p.viewPosition),w.model.pushStackElement(),w.setCursorStates(p.source,he.Explicit,S)}});class l extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,lt.moveToBeginningOfLine(p,p.getCursorStates(),this._inSelectionMode)),p.revealAllCursors(C.source,!0)}}a.CursorHome=q(new l({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.Home,mac:{primary:T.Home,secondary:[M.CtrlCmd|T.LeftArrow]}}})),a.CursorHomeSelect=q(new l({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.Home,mac:{primary:M.Shift|T.Home,secondary:[M.CtrlCmd|M.Shift|T.LeftArrow]}}}));class d extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,this._exec(p.getCursorStates())),p.revealAllCursors(C.source,!0)}_exec(p){const C=[];for(let b=0,S=p.length;b<S;b++){const y=p[b],E=y.modelState.position.lineNumber;C[b]=ie.fromModelState(y.modelState.move(this._inSelectionMode,E,1,0))}return C}}a.CursorLineStart=q(new d({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:0,mac:{primary:M.WinCtrl|T.KeyA}}})),a.CursorLineStartSelect=q(new d({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:0,mac:{primary:M.WinCtrl|M.Shift|T.KeyA}}}));class c extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,lt.moveToEndOfLine(p,p.getCursorStates(),this._inSelectionMode,C.sticky||!1)),p.revealAllCursors(C.source,!0)}}a.CursorEnd=q(new c({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:re,kbExpr:k.textInputFocus,primary:T.End,mac:{primary:T.End,secondary:[M.CtrlCmd|T.RightArrow]}},metadata:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:O(136,"Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),a.CursorEndSelect=q(new c({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:re,kbExpr:k.textInputFocus,primary:M.Shift|T.End,mac:{primary:M.Shift|T.End,secondary:[M.CtrlCmd|M.Shift|T.RightArrow]}},metadata:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:O(136,"Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class h extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,this._exec(p,p.getCursorStates())),p.revealAllCursors(C.source,!0)}_exec(p,C){const b=[];for(let S=0,y=C.length;S<y;S++){const E=C[S],x=E.modelState.position.lineNumber,R=p.model.getLineMaxColumn(x);b[S]=ie.fromModelState(E.modelState.move(this._inSelectionMode,x,R,0))}return b}}a.CursorLineEnd=q(new h({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:0,mac:{primary:M.WinCtrl|T.KeyE}}})),a.CursorLineEndSelect=q(new h({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:0,mac:{primary:M.WinCtrl|M.Shift|T.KeyE}}}));class u extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,lt.moveToBeginningOfBuffer(p,p.getCursorStates(),this._inSelectionMode)),p.revealAllCursors(C.source,!0)}}a.CursorTop=q(new u({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|T.Home,mac:{primary:M.CtrlCmd|T.UpArrow}}})),a.CursorTopSelect=q(new u({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|T.Home,mac:{primary:M.CtrlCmd|M.Shift|T.UpArrow}}}));class g extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,lt.moveToEndOfBuffer(p,p.getCursorStates(),this._inSelectionMode)),p.revealAllCursors(C.source,!0)}}a.CursorBottom=q(new g({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|T.End,mac:{primary:M.CtrlCmd|T.DownArrow}}})),a.CursorBottomSelect=q(new g({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|M.Shift|T.End,mac:{primary:M.CtrlCmd|M.Shift|T.DownArrow}}}));class f extends ye{constructor(){super({id:"editorScroll",precondition:void 0,metadata:_e.metadata})}determineScrollMethod(p){const C=[_e.Unit.Column],b=[_e.Unit.Line,_e.Unit.WrappedLine,_e.Unit.Page,_e.Unit.HalfPage,_e.Unit.Editor,_e.Unit.Column],S=[_e.Direction.Left,_e.Direction.Right],y=[_e.Direction.Up,_e.Direction.Down];return C.includes(p.unit)&&S.includes(p.direction)?this._runHorizontalEditorScroll.bind(this):b.includes(p.unit)&&y.includes(p.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(p,C){const b=_e.parse(C);if(!b)return;const S=this.determineScrollMethod(b);S&&S(p,C.source,b)}_runVerticalEditorScroll(p,C,b){const S=this._computeDesiredScrollTop(p,b);if(b.revealCursor){const y=p.getCompletelyVisibleViewRangeAtScrollTop(S);p.setCursorStates(C,he.Explicit,[lt.findPositionInViewportIfOutside(p,p.getPrimaryCursorState(),y,b.select)])}p.viewLayout.setScrollPosition({scrollTop:S},K.Smooth)}_computeDesiredScrollTop(p,C){if(C.unit===_e.Unit.Line){const y=p.viewLayout.getFutureViewport(),E=p.getCompletelyVisibleViewRangeAtScrollTop(y.top),x=p.coordinatesConverter.convertViewRangeToModelRange(E);let R;C.direction===_e.Direction.Up?R=Math.max(1,x.startLineNumber-C.value):R=Math.min(p.model.getLineCount(),x.startLineNumber+C.value);const D=p.coordinatesConverter.convertModelPositionToViewPosition(new I(R,1));return p.viewLayout.getVerticalOffsetForLineNumber(D.lineNumber)}if(C.unit===_e.Unit.Editor){let y=0;return C.direction===_e.Direction.Down&&(y=p.model.getLineCount()-p.cursorConfig.pageSize),p.viewLayout.getVerticalOffsetForLineNumber(y)}let b;C.unit===_e.Unit.Page?b=p.cursorConfig.pageSize*C.value:C.unit===_e.Unit.HalfPage?b=Math.round(p.cursorConfig.pageSize/2)*C.value:b=C.value;const S=(C.direction===_e.Direction.Up?-1:1)*b;return p.viewLayout.getCurrentScrollTop()+S*p.cursorConfig.lineHeight}_runHorizontalEditorScroll(p,C,b){const S=this._computeDesiredScrollLeft(p,b);p.viewLayout.setScrollPosition({scrollLeft:S},K.Smooth)}_computeDesiredScrollLeft(p,C){const b=(C.direction===_e.Direction.Left?-1:1)*C.value;return p.viewLayout.getCurrentScrollLeft()+b*p.cursorConfig.typicalHalfwidthCharacterWidth}}a.EditorScrollImpl=f,a.EditorScroll=q(new f),a.ScrollLineUp=q(new class extends ye{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|T.UpArrow,mac:{primary:M.WinCtrl|T.PageUp}}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Up,by:_e.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollPageUp=q(new class extends ye{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|T.PageUp,win:{primary:M.Alt|T.PageUp},linux:{primary:M.Alt|T.PageUp}}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Up,by:_e.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollEditorTop=q(new class extends ye{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Up,by:_e.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollLineDown=q(new class extends ye{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|T.DownArrow,mac:{primary:M.WinCtrl|T.PageDown}}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Down,by:_e.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollPageDown=q(new class extends ye{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:M.CtrlCmd|T.PageDown,win:{primary:M.Alt|T.PageDown},linux:{primary:M.Alt|T.PageDown}}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Down,by:_e.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollEditorBottom=q(new class extends ye{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Down,by:_e.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollLeft=q(new class extends ye{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Left,by:_e.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:p.source})}}),a.ScrollRight=q(new class extends ye{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus}})}runCoreEditorCommand(w,p){a.EditorScroll.runCoreEditorCommand(w,{to:_e.RawDirection.Right,by:_e.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:p.source})}});class m extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){C.position&&(p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,[lt.word(p,p.getPrimaryCursorState(),this._inSelectionMode,C.position)]),C.revealType!==Ri.None&&p.revealAllCursors(C.source,!0,!0))}}a.WordSelect=q(new m({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),a.WordSelectDrag=q(new m({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),a.LastCursorWordSelect=q(new class extends ye{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(w,p){if(!p.position)return;const C=w.getLastAddedCursorIndex(),b=w.getCursorStates(),S=b.slice(0),y=b[C];S[C]=lt.word(w,y,y.modelState.hasSelection(),p.position),w.model.pushStackElement(),w.setCursorStates(p.source,he.Explicit,S)}});class _ extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){C.position&&(p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,[lt.line(p,p.getPrimaryCursorState(),this._inSelectionMode,C.position,C.viewPosition)]),C.revealType!==Ri.None&&p.revealAllCursors(C.source,!1,!0))}}a.LineSelect=q(new _({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),a.LineSelectDrag=q(new _({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class L extends ye{constructor(p){super(p),this._inSelectionMode=p.inSelectionMode}runCoreEditorCommand(p,C){if(!C.position)return;const b=p.getLastAddedCursorIndex(),S=p.getCursorStates(),y=S.slice(0);y[b]=lt.line(p,S[b],this._inSelectionMode,C.position,C.viewPosition),p.model.pushStackElement(),p.setCursorStates(C.source,he.Explicit,y)}}a.LastCursorLineSelect=q(new L({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),a.LastCursorLineSelectDrag=q(new L({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),a.CancelSelection=q(new class extends ye{constructor(){super({id:"cancelSelection",precondition:k.hasNonEmptySelection,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.Escape,secondary:[M.Shift|T.Escape]}})}runCoreEditorCommand(w,p){w.model.pushStackElement(),w.setCursorStates(p.source,he.Explicit,[lt.cancelSelection(w,w.getPrimaryCursorState())]),w.revealAllCursors(p.source,!0)}}),a.RemoveSecondaryCursors=q(new class extends ye{constructor(){super({id:"removeSecondaryCursors",precondition:k.hasMultipleSelections,kbOpts:{weight:re+1,kbExpr:k.textInputFocus,primary:T.Escape,secondary:[M.Shift|T.Escape]}})}runCoreEditorCommand(w,p){w.model.pushStackElement(),w.setCursorStates(p.source,he.Explicit,[w.getPrimaryCursorState()]),w.revealAllCursors(p.source,!0),Bf(O(137,"Removed secondary cursors"))}}),a.RevealLine=q(new class extends ye{constructor(){super({id:"revealLine",precondition:void 0,metadata:Cs.metadata})}runCoreEditorCommand(w,p){const C=p,b=C.lineNumber||0;let S=typeof b=="number"?b+1:parseInt(b)+1;S<1&&(S=1);const y=w.model.getLineCount();S>y&&(S=y);const E=new N(S,1,S,w.model.getLineMaxColumn(S));let x=de.Simple;if(C.at)switch(C.at){case Cs.RawAtArgument.Top:x=de.Top;break;case Cs.RawAtArgument.Center:x=de.Center;break;case Cs.RawAtArgument.Bottom:x=de.Bottom;break}const R=w.coordinatesConverter.convertModelRangeToViewRange(E);w.revealRange(p.source,!1,R,x,K.Smooth)}}),a.SelectAll=new class extends $l{constructor(){super(zf)}runDOMCommand(w){hn&&(w.focus(),w.select()),w.ownerDocument.execCommand("selectAll")}runEditorCommand(w,p,C){const b=p._getViewModel();b&&this.runCoreEditorCommand(b,C)}runCoreEditorCommand(w,p){w.model.pushStackElement(),w.setCursorStates("keyboard",he.Explicit,[lt.selectAll(w,w.getPrimaryCursorState())])}},a.SetSelection=q(new class extends ye{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(w,p){p.selection&&(w.model.pushStackElement(),w.setCursorStates(p.source,he.Explicit,[ie.fromModelSelection(p.selection)]))}})})(Ue||(Ue={}));const TL=Zt.and(k.textInputFocus,k.columnSelection);function Qs(a,e){Kf.registerKeybindingRule({id:a,primary:e,when:TL,weight:re+1})}Qs(Ue.CursorColumnSelectLeft.id,M.Shift|T.LeftArrow);Qs(Ue.CursorColumnSelectRight.id,M.Shift|T.RightArrow);Qs(Ue.CursorColumnSelectUp.id,M.Shift|T.UpArrow);Qs(Ue.CursorColumnSelectPageUp.id,M.Shift|T.PageUp);Qs(Ue.CursorColumnSelectDown.id,M.Shift|T.DownArrow);Qs(Ue.CursorColumnSelectPageDown.id,M.Shift|T.PageDown);function ch(a){return a.register(),a}var hh;(function(a){class e extends Ia{runEditorCommand(i,n,s){const o=n._getViewModel();o&&this.runCoreEditingCommand(n,o,s||{})}}a.CoreEditingCommand=e,a.LineBreakInsert=q(new class extends e{constructor(){super({id:"lineBreakInsert",precondition:k.writable,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:0,mac:{primary:M.WinCtrl|T.KeyO}}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Rg.lineBreakInsert(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection)))}}),a.Outdent=q(new class extends e{constructor(){super({id:"outdent",precondition:k.writable,kbOpts:{weight:re,kbExpr:Zt.and(k.editorTextFocus,k.tabDoesNotMoveFocus),primary:M.Shift|T.Tab}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Rn.outdent(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),a.Tab=q(new class extends e{constructor(){super({id:"tab",precondition:k.writable,kbOpts:{weight:re,kbExpr:Zt.and(k.editorTextFocus,k.tabDoesNotMoveFocus),primary:T.Tab}})}runCoreEditingCommand(t,i,n){t.pushUndoStop(),t.executeCommands(this.id,Rn.tab(i.cursorConfig,i.model,i.getCursorStates().map(s=>s.modelState.selection))),t.pushUndoStop()}}),a.DeleteLeft=q(new class extends e{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.Backspace,secondary:[M.Shift|T.Backspace],mac:{primary:T.Backspace,secondary:[M.Shift|T.Backspace,M.WinCtrl|T.KeyH,M.WinCtrl|T.Backspace]}}})}runCoreEditingCommand(t,i,n){const[s,o]=es.deleteLeft(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection),i.getCursorAutoClosedCharacters());s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(we.DeletingLeft)}}),a.DeleteRight=q(new class extends e{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:re,kbExpr:k.textInputFocus,primary:T.Delete,mac:{primary:T.Delete,secondary:[M.WinCtrl|T.KeyD,M.WinCtrl|T.Delete]}}})}runCoreEditingCommand(t,i,n){const[s,o]=es.deleteRight(i.getPrevEditOperationType(),i.cursorConfig,i.model,i.getCursorStates().map(r=>r.modelState.selection));s&&t.pushUndoStop(),t.executeCommands(this.id,o),i.setPrevEditOperationType(we.DeletingRight)}}),a.Undo=new class extends $l{constructor(){super(Uf)}runDOMCommand(t){t.ownerDocument.execCommand("undo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(v.readOnly)===!0))return i.getModel().undo()}},a.Redo=new class extends $l{constructor(){super(Gf)}runDOMCommand(t){t.ownerDocument.execCommand("redo")}runEditorCommand(t,i,n){if(!(!i.hasModel()||i.getOption(v.readOnly)===!0))return i.getModel().redo()}}})(hh||(hh={}));class uh extends $f{constructor(e,t,i){super({id:e,precondition:void 0,metadata:i}),this._handlerId=t}runCommand(e,t){const i=e.get(zt).getFocusedCodeEditor();i&&i.trigger("keyboard",this._handlerId,t)}}function os(a,e){ch(new uh("default:"+a,a)),ch(new uh(a,a,e))}os(qe.Type,{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]});os(qe.ReplacePreviousChar);os(qe.CompositionType);os(qe.CompositionStart);os(qe.CompositionEnd);os(qe.Paste);os(qe.Cut);class ic extends ss{constructor(e,t,i){super(),this._mouseLeaveMonitor=null,this._context=e,this.viewController=t,this.viewHelper=i,this.mouseTargetFactory=new ct(this._context,i),this._mouseDownOperation=this._register(new ML(this._context,this.viewController,this.viewHelper,this.mouseTargetFactory,(o,r)=>this._createMouseTarget(o,r),o=>this._getMouseColumn(o))),this.lastMouseLeaveTime=-1,this._height=this._context.configuration.options.get(v.layoutInfo).height;const n=new ww(this.viewHelper.viewDomNode);this._register(n.onContextMenu(this.viewHelper.viewDomNode,o=>this._onContextMenu(o,!0))),this._register(n.onMouseMove(this.viewHelper.viewDomNode,o=>{this._onMouseMove(o),this._mouseLeaveMonitor||(this._mouseLeaveMonitor=Y(this.viewHelper.viewDomNode.getRootNode(),"mousemove",r=>{this.viewHelper.viewDomNode.contains(r.target)||this._onMouseLeave(new un(r,!1,this.viewHelper.viewDomNode))}))})),this._register(n.onMouseUp(this.viewHelper.viewDomNode,o=>this._onMouseUp(o))),this._register(n.onMouseLeave(this.viewHelper.viewDomNode,o=>this._onMouseLeave(o)));let s=0;this._register(n.onPointerDown(this.viewHelper.viewDomNode,(o,r)=>{s=r})),this._register(Y(this.viewHelper.viewDomNode,mt.POINTER_UP,o=>{this._mouseDownOperation.onPointerUp()})),this._register(n.onMouseDown(this.viewHelper.viewDomNode,o=>this._onMouseDown(o,s))),this._setupMouseWheelZoomListener(),this._context.addEventHandler(this)}_setupMouseWheelZoomListener(){const e=qf.INSTANCE;let t=0,i=Yi.getZoomLevel(),n=!1,s=0;const o=l=>{if(this.viewController.emitMouseWheel(l),!this._context.configuration.options.get(v.mouseWheelZoom))return;const d=new Zf(l);if(e.acceptStandardWheelEvent(d),e.isPhysicalMouseWheel()){if(r(l)){const c=Yi.getZoomLevel(),h=d.deltaY>0?1:-1;Yi.setZoomLevel(c+h),d.preventDefault(),d.stopPropagation()}}else Date.now()-t>50&&(i=Yi.getZoomLevel(),n=r(l),s=0),t=Date.now(),s+=d.deltaY,n&&(Yi.setZoomLevel(i+s/5),d.preventDefault(),d.stopPropagation())};this._register(Y(this.viewHelper.viewDomNode,mt.MOUSE_WHEEL,o,{capture:!0,passive:!1}));function r(l){return Fi?(l.metaKey||l.ctrlKey)&&!l.shiftKey&&!l.altKey:l.ctrlKey&&!l.metaKey&&!l.shiftKey&&!l.altKey}}dispose(){this._context.removeEventHandler(this),this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),super.dispose()}onConfigurationChanged(e){if(e.hasChanged(v.layoutInfo)){const t=this._context.configuration.options.get(v.layoutInfo).height;this._height!==t&&(this._height=t,this._mouseDownOperation.onHeightChanged())}return!1}onCursorStateChanged(e){return this._mouseDownOperation.onCursorStateChanged(e),!1}onFocusChanged(e){return!1}getTargetAtClientPoint(e,t){const n=new gg(e,t).toPageCoordinates(Ne(this.viewHelper.viewDomNode)),s=$d(this.viewHelper.viewDomNode);if(n.y<s.y||n.y>s.y+s.height||n.x<s.x||n.x>s.x+s.width)return null;const o=Zd(this.viewHelper.viewDomNode,s,n);return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),s,n,o,null)}_createMouseTarget(e,t){let i=e.target;if(!this.viewHelper.viewDomNode.contains(i)){const n=Mo(this.viewHelper.viewDomNode);n&&(i=n.elementsFromPoint(e.posx,e.posy).find(s=>this.viewHelper.viewDomNode.contains(s)))}return this.mouseTargetFactory.createMouseTarget(this.viewHelper.getLastRenderData(),e.editorPos,e.pos,e.relativePos,t?i:null)}_getMouseColumn(e){return this.mouseTargetFactory.getMouseColumn(e.relativePos)}_onContextMenu(e,t){this.viewController.emitContextMenu({event:e,target:this._createMouseTarget(e,t)})}_onMouseMove(e){this.mouseTargetFactory.mouseTargetIsWidget(e)||e.preventDefault(),!(this._mouseDownOperation.isActive()||e.timestamp<this.lastMouseLeaveTime)&&this.viewController.emitMouseMove({event:e,target:this._createMouseTarget(e,!0)})}_onMouseLeave(e){this._mouseLeaveMonitor&&(this._mouseLeaveMonitor.dispose(),this._mouseLeaveMonitor=null),this.lastMouseLeaveTime=new Date().getTime(),this.viewController.emitMouseLeave({event:e,target:null})}_onMouseUp(e){this.viewController.emitMouseUp({event:e,target:this._createMouseTarget(e,!0)})}_onMouseDown(e,t){const i=this._createMouseTarget(e,!0),n=i.type===ee.CONTENT_TEXT||i.type===ee.CONTENT_EMPTY,s=i.type===ee.GUTTER_GLYPH_MARGIN||i.type===ee.GUTTER_LINE_NUMBERS||i.type===ee.GUTTER_LINE_DECORATIONS,o=i.type===ee.GUTTER_LINE_NUMBERS,r=this._context.configuration.options.get(v.selectOnLineNumbers),l=i.type===ee.CONTENT_VIEW_ZONE||i.type===ee.GUTTER_VIEW_ZONE,d=i.type===ee.CONTENT_WIDGET;let c=e.leftButton||e.middleButton;Fi&&e.leftButton&&e.ctrlKey&&(c=!1);const h=()=>{e.preventDefault(),this.viewHelper.focusTextArea()};if(c&&(n||o&&r))h(),this._mouseDownOperation.start(i.type,e,t);else if(s)e.preventDefault();else if(l){const u=i.detail;c&&this.viewHelper.shouldSuppressMouseDownOnViewZone(u.viewZoneId)&&(h(),this._mouseDownOperation.start(i.type,e,t),e.preventDefault())}else d&&this.viewHelper.shouldSuppressMouseDownOnWidget(i.detail)&&(h(),e.preventDefault());this.viewController.emitMouseDown({event:e,target:i})}_onMouseWheel(e){this.viewController.emitMouseWheel(e)}}class ML extends U{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewController=t,this._viewHelper=i,this._mouseTargetFactory=n,this._createMouseTarget=s,this._getMouseColumn=o,this._mouseMoveMonitor=this._register(new vw(this._viewHelper.viewDomNode)),this._topBottomDragScrolling=this._register(new AL(this._context,this._viewHelper,this._mouseTargetFactory,(r,l,d)=>this._dispatchMouse(r,l,d))),this._mouseState=new nc,this._currentSelection=new le(1,1,1,1),this._isActive=!1,this._lastMouseEvent=null}dispose(){super.dispose()}isActive(){return this._isActive}_onMouseDownThenMove(e){this._lastMouseEvent=e,this._mouseState.setModifiers(e);const t=this._findMousePosition(e,!1);t&&(this._mouseState.isDragAndDrop?this._viewController.emitMouseDrag({event:e,target:t}):t.type===ee.OUTSIDE_EDITOR&&(t.outsidePosition==="above"||t.outsidePosition==="below")?this._topBottomDragScrolling.start(t,e):(this._topBottomDragScrolling.stop(),this._dispatchMouse(t,!0,Ri.Minimal)))}start(e,t,i){this._lastMouseEvent=t,this._mouseState.setStartedOnLineNumbers(e===ee.GUTTER_LINE_NUMBERS),this._mouseState.setStartButtons(t),this._mouseState.setModifiers(t);const n=this._findMousePosition(t,!0);if(!n||!n.position)return;this._mouseState.trySetCount(t.detail,n.position),t.detail=this._mouseState.count;const s=this._context.configuration.options;if(!s.get(v.readOnly)&&s.get(v.dragAndDrop)&&!s.get(v.columnSelection)&&!this._mouseState.altKey&&t.detail<2&&!this._isActive&&!this._currentSelection.isEmpty()&&n.type===ee.CONTENT_TEXT&&n.position&&this._currentSelection.containsPosition(n.position)){this._mouseState.isDragAndDrop=!0,this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),o=>{const r=this._findMousePosition(this._lastMouseEvent,!1);Xf(o)?this._viewController.emitMouseDropCanceled():this._viewController.emitMouseDrop({event:this._lastMouseEvent,target:r?this._createMouseTarget(this._lastMouseEvent,!0):null}),this._stop()});return}this._mouseState.isDragAndDrop=!1,this._dispatchMouse(n,t.shiftKey,Ri.Minimal),this._isActive||(this._isActive=!0,this._mouseMoveMonitor.startMonitoring(this._viewHelper.viewLinesDomNode,i,t.buttons,o=>this._onMouseDownThenMove(o),()=>this._stop()))}_stop(){this._isActive=!1,this._topBottomDragScrolling.stop()}onHeightChanged(){this._mouseMoveMonitor.stopMonitoring()}onPointerUp(){this._mouseMoveMonitor.stopMonitoring()}onCursorStateChanged(e){this._currentSelection=e.selections[0]}_getPositionOutsideEditor(e){const t=e.editorPos,i=this._context.viewModel,n=this._context.viewLayout,s=this._getMouseColumn(e);if(e.posy<t.y){const r=t.y-e.posy,l=Math.max(n.getCurrentScrollTop()-r,0),d=Ws.getZoneAtCoord(this._context,l);if(d){const h=this._helpPositionJumpOverViewZone(d);if(h)return ht.createOutsideEditor(s,h,"above",r)}const c=n.getLineNumberAtVerticalOffset(l);return ht.createOutsideEditor(s,new I(c,1),"above",r)}if(e.posy>t.y+t.height){const r=e.posy-t.y-t.height,l=n.getCurrentScrollTop()+e.relativePos.y,d=Ws.getZoneAtCoord(this._context,l);if(d){const h=this._helpPositionJumpOverViewZone(d);if(h)return ht.createOutsideEditor(s,h,"below",r)}const c=n.getLineNumberAtVerticalOffset(l);return ht.createOutsideEditor(s,new I(c,i.getLineMaxColumn(c)),"below",r)}const o=n.getLineNumberAtVerticalOffset(n.getCurrentScrollTop()+e.relativePos.y);if(e.posx<t.x){const r=t.x-e.posx;return ht.createOutsideEditor(s,new I(o,1),"left",r)}if(e.posx>t.x+t.width){const r=e.posx-t.x-t.width;return ht.createOutsideEditor(s,new I(o,i.getLineMaxColumn(o)),"right",r)}return null}_findMousePosition(e,t){const i=this._getPositionOutsideEditor(e);if(i)return i;const n=this._createMouseTarget(e,t);if(!n.position)return null;if(n.type===ee.CONTENT_VIEW_ZONE||n.type===ee.GUTTER_VIEW_ZONE){const o=this._helpPositionJumpOverViewZone(n.detail);if(o)return ht.createViewZone(n.type,n.element,n.mouseColumn,o,n.detail)}return n}_helpPositionJumpOverViewZone(e){const t=new I(this._currentSelection.selectionStartLineNumber,this._currentSelection.selectionStartColumn),i=e.positionBefore,n=e.positionAfter;return i&&n?i.isBefore(t)?i:n:null}_dispatchMouse(e,t,i){e.position&&this._viewController.dispatchMouse({position:e.position,mouseColumn:e.mouseColumn,startedOnLineNumbers:this._mouseState.startedOnLineNumbers,revealType:i,inSelectionMode:t,mouseDownCount:this._mouseState.count,altKey:this._mouseState.altKey,ctrlKey:this._mouseState.ctrlKey,metaKey:this._mouseState.metaKey,shiftKey:this._mouseState.shiftKey,leftButton:this._mouseState.leftButton,middleButton:this._mouseState.middleButton,onInjectedText:e.type===ee.CONTENT_TEXT&&e.detail.injectedText!==null})}}class AL extends U{constructor(e,t,i,n){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._operation=null}dispose(){super.dispose(),this.stop()}start(e,t){this._operation?this._operation.setPosition(e,t):this._operation=new OL(this._context,this._viewHelper,this._mouseTargetFactory,this._dispatchMouse,e,t)}stop(){this._operation&&(this._operation.dispose(),this._operation=null)}}class OL extends U{constructor(e,t,i,n,s,o){super(),this._context=e,this._viewHelper=t,this._mouseTargetFactory=i,this._dispatchMouse=n,this._position=s,this._mouseEvent=o,this._lastTime=Date.now(),this._animationFrameDisposable=Io(Ne(o.browserEvent),()=>this._execute())}dispose(){this._animationFrameDisposable.dispose(),super.dispose()}setPosition(e,t){this._position=e,this._mouseEvent=t}_tick(){const e=Date.now(),t=e-this._lastTime;return this._lastTime=e,t}_getScrollSpeed(){const e=this._context.configuration.options.get(v.lineHeight),t=this._context.configuration.options.get(v.layoutInfo).height/e,i=this._position.outsideDistance/e;return i<=1.5?Math.max(30,t*(1+i)):i<=3?Math.max(60,t*(2+i)):Math.max(200,t*(7+i))}_execute(){const e=this._context.configuration.options.get(v.lineHeight),t=this._getScrollSpeed(),i=this._tick(),n=t*(i/1e3)*e,s=this._position.outsidePosition==="above"?-n:n;this._context.viewModel.viewLayout.deltaScrollNow(0,s),this._viewHelper.renderNow();const o=this._context.viewLayout.getLinesViewportData(),r=this._position.outsidePosition==="above"?o.startLineNumber:o.endLineNumber;let l;{const d=$d(this._viewHelper.viewDomNode),c=this._context.configuration.options.get(v.layoutInfo).horizontalScrollbarHeight,h=new Va(this._mouseEvent.pos.x,d.y+d.height-c-.1),u=Zd(this._viewHelper.viewDomNode,d,h);l=this._mouseTargetFactory.createMouseTarget(this._viewHelper.getLastRenderData(),d,h,u,null)}(!l.position||l.position.lineNumber!==r)&&(this._position.outsidePosition==="above"?l=ht.createOutsideEditor(this._position.mouseColumn,new I(r,1),"above",this._position.outsideDistance):l=ht.createOutsideEditor(this._position.mouseColumn,new I(r,this._context.viewModel.getLineMaxColumn(r)),"below",this._position.outsideDistance)),this._dispatchMouse(l,!0,Ri.None),this._animationFrameDisposable=Io(Ne(l.element),()=>this._execute())}}class nc{static{this.CLEAR_MOUSE_DOWN_COUNT_TIME=400}get altKey(){return this._altKey}get ctrlKey(){return this._ctrlKey}get metaKey(){return this._metaKey}get shiftKey(){return this._shiftKey}get leftButton(){return this._leftButton}get middleButton(){return this._middleButton}get startedOnLineNumbers(){return this._startedOnLineNumbers}constructor(){this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._leftButton=!1,this._middleButton=!1,this._startedOnLineNumbers=!1,this._lastMouseDownPosition=null,this._lastMouseDownPositionEqualCount=0,this._lastMouseDownCount=0,this._lastSetMouseDownCountTime=0,this.isDragAndDrop=!1}get count(){return this._lastMouseDownCount}setModifiers(e){this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey}setStartButtons(e){this._leftButton=e.leftButton,this._middleButton=e.middleButton}setStartedOnLineNumbers(e){this._startedOnLineNumbers=e}trySetCount(e,t){const i=new Date().getTime();i-this._lastSetMouseDownCountTime>nc.CLEAR_MOUSE_DOWN_COUNT_TIME&&(e=1),this._lastSetMouseDownCountTime=i,e>this._lastMouseDownCount+1&&(e=this._lastMouseDownCount+1),this._lastMouseDownPosition&&this._lastMouseDownPosition.equals(t)?this._lastMouseDownPositionEqualCount++:this._lastMouseDownPositionEqualCount=1,this._lastMouseDownPosition=t,this._lastMouseDownCount=Math.min(e,this._lastMouseDownPositionEqualCount)}}function Mg(a,e,t,i){const n=a.getPlainTextToCopy(e,t,Ra),s=a.model.getEOL(),o=t&&e.length===1&&e[0].isEmpty(),r=Array.isArray(n)?n:null,l=Array.isArray(n)?n.join(s):n;let d,c=null;if(PL.forceCopyWithSyntaxHighlighting||i&&l.length<65536){const u=a.getRichTextToCopy(e,t);u&&(d=u.html,c=u.mode)}return{isFromEmptySelection:o,multicursorText:r,text:l,html:d,mode:c}}class Vs{static{this.INSTANCE=new Vs}constructor(){this._lastState=null}set(e,t){this._lastState={lastCopiedValue:e,data:t}}get(e){return this._lastState&&this._lastState.lastCopiedValue===e?this._lastState.data:(this._lastState=null,null)}}const PL={forceCopyWithSyntaxHighlighting:!1},ta={getTextData(a){const e=a.getData(Ec.text);let t=null;const i=a.getData("vscode-editor-data");if(typeof i=="string")try{t=JSON.parse(i),t.version!==1&&(t=null)}catch{}return e.length===0&&t===null&&a.files.length>0?[Array.prototype.slice.call(a.files,0).map(s=>s.name).join(`
`),null]:[e,t]},setTextData(a,e,t,i){a.setData(Ec.text,e),typeof t=="string"&&a.setData("text/html",t),a.setData("vscode-editor-data",JSON.stringify(i))}};class Ge{static{this.EMPTY=new Ge("",0,0,null,void 0)}constructor(e,t,i,n,s){this.value=e,this.selectionStart=t,this.selectionEnd=i,this.selection=n,this.newlineCountBeforeSelection=s}toString(){return`[ <${this.value}>, selectionStart: ${this.selectionStart}, selectionEnd: ${this.selectionEnd}]`}static readFromTextArea(e,t){const i=e.getValue(),n=e.getSelectionStart(),s=e.getSelectionEnd();let o;if(t){const r=i.substring(0,n),l=t.value.substring(0,t.selectionStart);r===l&&(o=t.newlineCountBeforeSelection)}return new Ge(i,n,s,null,o)}collapseSelection(){return this.selectionStart===this.value.length?this:new Ge(this.value,this.value.length,this.value.length,null,void 0)}isWrittenToTextArea(e,t){const i=this.value===e.getValue();return t?this.selectionStart===e.getSelectionStart()&&this.selectionEnd===e.getSelectionEnd()&&i:i}writeToTextArea(e,t,i){t.setValue(e,this.value),i&&t.setSelectionRange(e,this.selectionStart,this.selectionEnd)}deduceEditorPosition(e){if(e<=this.selectionStart){const n=this.value.substring(e,this.selectionStart);return this._finishDeduceEditorPosition(this.selection?.getStartPosition()??null,n,-1)}if(e>=this.selectionEnd){const n=this.value.substring(this.selectionEnd,e);return this._finishDeduceEditorPosition(this.selection?.getEndPosition()??null,n,1)}const t=this.value.substring(this.selectionStart,e);if(t.indexOf("…")===-1)return this._finishDeduceEditorPosition(this.selection?.getStartPosition()??null,t,1);const i=this.value.substring(e,this.selectionEnd);return this._finishDeduceEditorPosition(this.selection?.getEndPosition()??null,i,-1)}_finishDeduceEditorPosition(e,t,i){let n=0,s=-1;for(;(s=t.indexOf(`
`,s+1))!==-1;)n++;return[e,i*t.length,n]}static deduceInput(e,t,i){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};const n=Math.min(xl(e.value,t.value),e.selectionStart,t.selectionStart),s=Math.min(Nl(e.value,t.value),e.value.length-e.selectionEnd,t.value.length-t.selectionEnd);e.value.substring(n,e.value.length-s);const o=t.value.substring(n,t.value.length-s),r=e.selectionStart-n,l=e.selectionEnd-n,d=t.selectionStart-n,c=t.selectionEnd-n;if(d===c){const u=e.selectionStart-n;return{text:o,replacePrevCharCnt:u,replaceNextCharCnt:0,positionDelta:0}}const h=l-r;return{text:o,replacePrevCharCnt:h,replaceNextCharCnt:0,positionDelta:0}}static deduceAndroidCompositionInput(e,t){if(!e)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0};if(e.value===t.value)return{text:"",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:t.selectionEnd-e.selectionEnd};const i=Math.min(xl(e.value,t.value),e.selectionEnd),n=Math.min(Nl(e.value,t.value),e.value.length-e.selectionEnd),s=e.value.substring(i,e.value.length-n),o=t.value.substring(i,t.value.length-n),r=e.selectionEnd-i,l=t.selectionEnd-i;return{text:o,replacePrevCharCnt:r,replaceNextCharCnt:s.length-r,positionDelta:l-o.length}}static fromScreenReaderContentState(e){return new Ge(e.value,e.selectionStart,e.selectionEnd,e.selection,e.newlineCountBeforeSelection)}}var ia;(function(a){a.Tap="-monaco-textarea-synthetic-tap"})(ia||(ia={}));class kL{constructor(){this._lastTypeTextLength=0}handleCompositionUpdate(e){e=e||"";const t={text:e,replacePrevCharCnt:this._lastTypeTextLength,replaceNextCharCnt:0,positionDelta:0};return this._lastTypeTextLength=e.length,t}}let Zl=class extends U{get textAreaState(){return this._textAreaState}constructor(e,t,i,n,s,o){super(),this._host=e,this._textArea=t,this._OS=i,this._browser=n,this._accessibilityService=s,this._logService=o,this._onFocus=this._register(new Z),this.onFocus=this._onFocus.event,this._onBlur=this._register(new Z),this.onBlur=this._onBlur.event,this._onKeyDown=this._register(new Z),this.onKeyDown=this._onKeyDown.event,this._onKeyUp=this._register(new Z),this.onKeyUp=this._onKeyUp.event,this._onCut=this._register(new Z),this.onCut=this._onCut.event,this._onPaste=this._register(new Z),this.onPaste=this._onPaste.event,this._onType=this._register(new Z),this.onType=this._onType.event,this._onCompositionStart=this._register(new Z),this.onCompositionStart=this._onCompositionStart.event,this._onCompositionUpdate=this._register(new Z),this.onCompositionUpdate=this._onCompositionUpdate.event,this._onCompositionEnd=this._register(new Z),this.onCompositionEnd=this._onCompositionEnd.event,this._onSelectionChangeRequest=this._register(new Z),this.onSelectionChangeRequest=this._onSelectionChangeRequest.event,this._asyncFocusGainWriteScreenReaderContent=this._register(new Ms),this._asyncTriggerCut=this._register(new Ei(()=>this._onCut.fire(),0)),this._textAreaState=Ge.EMPTY,this._selectionChangeListener=null,this._accessibilityService.isScreenReaderOptimized()&&this.writeNativeTextAreaContent("ctor"),this._register(mi.runAndSubscribe(this._accessibilityService.onDidChangeScreenReaderOptimized,()=>{this._accessibilityService.isScreenReaderOptimized()&&!this._asyncFocusGainWriteScreenReaderContent.value?this._asyncFocusGainWriteScreenReaderContent.value=this._register(new Ei(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)):this._asyncFocusGainWriteScreenReaderContent.clear()})),this._hasFocus=!1,this._currentComposition=null;let r=null;this._register(this._textArea.onKeyDown(l=>{const d=new Ur(l);(d.keyCode===T.KEY_IN_COMPOSITION||this._currentComposition&&d.keyCode===T.Backspace)&&d.stopPropagation(),d.equals(T.Escape)&&d.preventDefault(),r=d,this._onKeyDown.fire(d)})),this._register(this._textArea.onKeyUp(l=>{const d=new Ur(l);this._onKeyUp.fire(d)})),this._register(this._textArea.onCompositionStart(l=>{const d=new kL;if(this._currentComposition){this._currentComposition=d;return}if(this._currentComposition=d,this._OS===Ic.Macintosh&&r&&r.equals(T.KEY_IN_COMPOSITION)&&this._textAreaState.selectionStart===this._textAreaState.selectionEnd&&this._textAreaState.selectionStart>0&&this._textAreaState.value.substr(this._textAreaState.selectionStart-1,1)===l.data&&(r.code==="ArrowRight"||r.code==="ArrowLeft")){d.handleCompositionUpdate("x"),this._onCompositionStart.fire({data:l.data});return}if(this._browser.isAndroid){this._onCompositionStart.fire({data:l.data});return}this._onCompositionStart.fire({data:l.data})})),this._register(this._textArea.onCompositionUpdate(l=>{const d=this._currentComposition;if(!d)return;if(this._browser.isAndroid){const h=Ge.readFromTextArea(this._textArea,this._textAreaState),u=Ge.deduceAndroidCompositionInput(this._textAreaState,h);this._textAreaState=h,this._onType.fire(u),this._onCompositionUpdate.fire(l);return}const c=d.handleCompositionUpdate(l.data);this._textAreaState=Ge.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(c),this._onCompositionUpdate.fire(l)})),this._register(this._textArea.onCompositionEnd(l=>{const d=this._currentComposition;if(!d)return;if(this._currentComposition=null,this._browser.isAndroid){const h=Ge.readFromTextArea(this._textArea,this._textAreaState),u=Ge.deduceAndroidCompositionInput(this._textAreaState,h);this._textAreaState=h,this._onType.fire(u),this._onCompositionEnd.fire();return}const c=d.handleCompositionUpdate(l.data);this._textAreaState=Ge.readFromTextArea(this._textArea,this._textAreaState),this._onType.fire(c),this._onCompositionEnd.fire()})),this._register(this._textArea.onInput(l=>{if(this._textArea.setIgnoreSelectionChangeTime("received input event"),this._currentComposition)return;const d=Ge.readFromTextArea(this._textArea,this._textAreaState),c=Ge.deduceInput(this._textAreaState,d,this._OS===Ic.Macintosh);c.replacePrevCharCnt===0&&c.text.length===1&&(Ii(c.text.charCodeAt(0))||c.text.charCodeAt(0)===127)||(this._textAreaState=d,(c.text!==""||c.replacePrevCharCnt!==0||c.replaceNextCharCnt!==0||c.positionDelta!==0)&&this._onType.fire(c))})),this._register(this._textArea.onCut(l=>{this._textArea.setIgnoreSelectionChangeTime("received cut event"),this._ensureClipboardGetsEditorSelection(l),this._asyncTriggerCut.schedule()})),this._register(this._textArea.onCopy(l=>{this._ensureClipboardGetsEditorSelection(l)})),this._register(this._textArea.onPaste(l=>{if(this._textArea.setIgnoreSelectionChangeTime("received paste event"),l.preventDefault(),!l.clipboardData)return;let[d,c]=ta.getTextData(l.clipboardData);d&&(c=c||Vs.INSTANCE.get(d),this._onPaste.fire({text:d,metadata:c}))})),this._register(this._textArea.onFocus(()=>{const l=this._hasFocus;this._setHasFocus(!0),this._accessibilityService.isScreenReaderOptimized()&&this._browser.isSafari&&!l&&this._hasFocus&&(this._asyncFocusGainWriteScreenReaderContent.value||(this._asyncFocusGainWriteScreenReaderContent.value=new Ei(()=>this.writeNativeTextAreaContent("asyncFocusGain"),0)),this._asyncFocusGainWriteScreenReaderContent.value.schedule())})),this._register(this._textArea.onBlur(()=>{this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("blurWithoutCompositionEnd"),this._onCompositionEnd.fire()),this._setHasFocus(!1)})),this._register(this._textArea.onSyntheticTap(()=>{this._browser.isAndroid&&this._currentComposition&&(this._currentComposition=null,this.writeNativeTextAreaContent("tapWithoutCompositionEnd"),this._onCompositionEnd.fire())}))}_initializeFromTest(){this._hasFocus=!0,this._textAreaState=Ge.readFromTextArea(this._textArea,null)}_installSelectionChangeListener(){let e=0;return Y(this._textArea.ownerDocument,"selectionchange",t=>{if(tn.onSelectionChange(),!this._hasFocus||this._currentComposition||!this._browser.isChrome)return;const i=Date.now(),n=i-e;if(e=i,n<5)return;const s=i-this._textArea.getIgnoreSelectionChangeTime();if(this._textArea.resetSelectionChangeTime(),s<100||!this._textAreaState.selection)return;const o=this._textArea.getValue();if(this._textAreaState.value!==o)return;const r=this._textArea.getSelectionStart(),l=this._textArea.getSelectionEnd();if(this._textAreaState.selectionStart===r&&this._textAreaState.selectionEnd===l)return;const d=this._textAreaState.deduceEditorPosition(r),c=this._host.deduceModelPosition(d[0],d[1],d[2]),h=this._textAreaState.deduceEditorPosition(l),u=this._host.deduceModelPosition(h[0],h[1],h[2]),g=new le(c.lineNumber,c.column,u.lineNumber,u.column);this._onSelectionChangeRequest.fire(g)})}dispose(){super.dispose(),this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null)}focusTextArea(){this._setHasFocus(!0),this.refreshFocusState()}isFocused(){return this._hasFocus}refreshFocusState(){this._setHasFocus(this._textArea.hasFocus())}_setHasFocus(e){this._hasFocus!==e&&(this._hasFocus=e,this._selectionChangeListener&&(this._selectionChangeListener.dispose(),this._selectionChangeListener=null),this._hasFocus&&(this._selectionChangeListener=this._installSelectionChangeListener()),this._hasFocus&&this.writeNativeTextAreaContent("focusgain"),this._hasFocus?this._onFocus.fire():this._onBlur.fire())}_setAndWriteTextAreaState(e,t){this._hasFocus||(t=t.collapseSelection()),t.isWrittenToTextArea(this._textArea,this._hasFocus)||this._logService.trace(`writeTextAreaState(reason: ${e})`),t.writeToTextArea(e,this._textArea,this._hasFocus),this._textAreaState=t}writeNativeTextAreaContent(e){!this._accessibilityService.isScreenReaderOptimized()&&e==="render"||this._currentComposition||this._setAndWriteTextAreaState(e,this._host.getScreenReaderContent())}_ensureClipboardGetsEditorSelection(e){const t=this._host.getDataToCopy(),i={version:1,isFromEmptySelection:t.isFromEmptySelection,multicursorText:t.multicursorText,mode:t.mode};Vs.INSTANCE.set(this._browser.isFirefox?t.text.replace(/\r\n/g,`
`):t.text,i),e.preventDefault(),e.clipboardData&&ta.setTextData(e.clipboardData,t.text,t.html,i)}};Zl=ge([P(4,ji),P(5,er)],Zl);class WL extends U{get ownerDocument(){return this._actual.ownerDocument}constructor(e){super(),this._actual=e,this._onSyntheticTap=this._register(new Z),this.onSyntheticTap=this._onSyntheticTap.event,this._ignoreSelectionChangeTime=0,this.onKeyDown=this._register(new jt(this._actual,"keydown")).event,this.onKeyPress=this._register(new jt(this._actual,"keypress")).event,this.onKeyUp=this._register(new jt(this._actual,"keyup")).event,this.onCompositionStart=this._register(new jt(this._actual,"compositionstart")).event,this.onCompositionUpdate=this._register(new jt(this._actual,"compositionupdate")).event,this.onCompositionEnd=this._register(new jt(this._actual,"compositionend")).event,this.onBeforeInput=this._register(new jt(this._actual,"beforeinput")).event,this.onInput=this._register(new jt(this._actual,"input")).event,this.onCut=this._register(new jt(this._actual,"cut")).event,this.onCopy=this._register(new jt(this._actual,"copy")).event,this.onPaste=this._register(new jt(this._actual,"paste")).event,this.onFocus=this._register(new jt(this._actual,"focus")).event,this.onBlur=this._register(new jt(this._actual,"blur")).event,this._register(this.onKeyDown(()=>tn.onKeyDown())),this._register(this.onBeforeInput(()=>tn.onBeforeInput())),this._register(this.onInput(()=>tn.onInput())),this._register(this.onKeyUp(()=>tn.onKeyUp())),this._register(Y(this._actual,ia.Tap,()=>this._onSyntheticTap.fire()))}hasFocus(){const e=Mo(this._actual);return e?e.activeElement===this._actual:this._actual.isConnected?zr()===this._actual:!1}setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}getIgnoreSelectionChangeTime(){return this._ignoreSelectionChangeTime}resetSelectionChangeTime(){this._ignoreSelectionChangeTime=0}getValue(){return this._actual.value}setValue(e,t){const i=this._actual;i.value!==t&&(this.setIgnoreSelectionChangeTime("setValue"),i.value=t)}getSelectionStart(){return this._actual.selectionDirection==="backward"?this._actual.selectionEnd:this._actual.selectionStart}getSelectionEnd(){return this._actual.selectionDirection==="backward"?this._actual.selectionStart:this._actual.selectionEnd}setSelectionRange(e,t,i){const n=this._actual;let s=null;const o=Mo(n);o?s=o.activeElement:s=zr();const r=Ne(s),l=s===n,d=n.selectionStart,c=n.selectionEnd;if(l&&d===t&&c===i){hn&&r.parent!==r&&n.focus();return}if(l){this.setIgnoreSelectionChangeTime("setSelectionRange"),n.setSelectionRange(t,i),hn&&r.parent!==r&&n.focus();return}try{const h=Yf(n);this.setIgnoreSelectionChangeTime("setSelectionRange"),n.focus(),n.setSelectionRange(t,i),Qf(n,h)}catch{}}}class VL extends ic{constructor(e,t,i){super(e,t,i),this._register(Od.addTarget(this.viewHelper.linesContentDomNode)),this._register(Y(this.viewHelper.linesContentDomNode,Hi.Tap,s=>this.onTap(s))),this._register(Y(this.viewHelper.linesContentDomNode,Hi.Change,s=>this.onChange(s))),this._register(Y(this.viewHelper.linesContentDomNode,Hi.Contextmenu,s=>this._onContextMenu(new un(s,!1,this.viewHelper.viewDomNode),!1))),this._lastPointerType="mouse",this._register(Y(this.viewHelper.linesContentDomNode,"pointerdown",s=>{const o=s.pointerType;if(o==="mouse"){this._lastPointerType="mouse";return}else o==="touch"?this._lastPointerType="touch":this._lastPointerType="pen"}));const n=new Lw(this.viewHelper.viewDomNode);this._register(n.onPointerMove(this.viewHelper.viewDomNode,s=>this._onMouseMove(s))),this._register(n.onPointerUp(this.viewHelper.viewDomNode,s=>this._onMouseUp(s))),this._register(n.onPointerLeave(this.viewHelper.viewDomNode,s=>this._onMouseLeave(s))),this._register(n.onPointerDown(this.viewHelper.viewDomNode,(s,o)=>this._onMouseDown(s,o)))}onTap(e){!e.initialTarget||!this.viewHelper.linesContentDomNode.contains(e.initialTarget)||(e.preventDefault(),this.viewHelper.focusTextArea(),this._dispatchGesture(e,!1))}onChange(e){this._lastPointerType==="touch"&&this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY),this._lastPointerType==="pen"&&this._dispatchGesture(e,!0)}_dispatchGesture(e,t){const i=this._createMouseTarget(new un(e,!1,this.viewHelper.viewDomNode),!1);i.position&&this.viewController.dispatchMouse({position:i.position,mouseColumn:i.position.column,startedOnLineNumbers:!1,revealType:Ri.Minimal,mouseDownCount:e.tapCount,inSelectionMode:t,altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,leftButton:!1,middleButton:!1,onInjectedText:i.type===ee.CONTENT_TEXT&&i.detail.injectedText!==null})}_onMouseDown(e,t){e.browserEvent.pointerType!=="touch"&&super._onMouseDown(e,t)}}class FL extends ic{constructor(e,t,i){super(e,t,i),this._register(Od.addTarget(this.viewHelper.linesContentDomNode)),this._register(Y(this.viewHelper.linesContentDomNode,Hi.Tap,n=>this.onTap(n))),this._register(Y(this.viewHelper.linesContentDomNode,Hi.Change,n=>this.onChange(n))),this._register(Y(this.viewHelper.linesContentDomNode,Hi.Contextmenu,n=>this._onContextMenu(new un(n,!1,this.viewHelper.viewDomNode),!1)))}onTap(e){e.preventDefault(),this.viewHelper.focusTextArea();const t=this._createMouseTarget(new un(e,!1,this.viewHelper.viewDomNode),!1);if(t.position){const i=document.createEvent("CustomEvent");i.initEvent(ia.Tap,!1,!0),this.viewHelper.dispatchTextAreaEvent(i),this.viewController.moveTo(t.position,Ri.Minimal)}}onChange(e){this._context.viewModel.viewLayout.deltaScrollNow(-e.translationX,-e.translationY)}}class HL extends U{constructor(e,t,i){super(),(Eu||em&&tm)&&Jf.pointerEvents?this.handler=this._register(new VL(e,t,i)):tr.TouchEvent?this.handler=this._register(new FL(e,t,i)):this.handler=this._register(new ic(e,t,i))}getTargetAtClientPoint(e,t){return this.handler.getTargetAtClientPoint(e,t)}}class BL{constructor(e,t,i,n){this.configuration=e,this.viewModel=t,this.userInputEvents=i,this.commandDelegate=n}paste(e,t,i,n){this.commandDelegate.paste(e,t,i,n)}type(e){this.commandDelegate.type(e)}compositionType(e,t,i,n){this.commandDelegate.compositionType(e,t,i,n)}compositionStart(){this.commandDelegate.startComposition()}compositionEnd(){this.commandDelegate.endComposition()}cut(){this.commandDelegate.cut()}setSelection(e){Ue.SetSelection.runCoreEditorCommand(this.viewModel,{source:"keyboard",selection:e})}_validateViewColumn(e){const t=this.viewModel.getLineMinColumn(e.lineNumber);return e.column<t?new I(e.lineNumber,t):e}_hasMulticursorModifier(e){switch(this.configuration.options.get(v.multiCursorModifier)){case"altKey":return e.altKey;case"ctrlKey":return e.ctrlKey;case"metaKey":return e.metaKey;default:return!1}}_hasNonMulticursorModifier(e){switch(this.configuration.options.get(v.multiCursorModifier)){case"altKey":return e.ctrlKey||e.metaKey;case"ctrlKey":return e.altKey||e.metaKey;case"metaKey":return e.ctrlKey||e.altKey;default:return!1}}dispatchMouse(e){const t=this.configuration.options,i=Ea&&t.get(v.selectionClipboard),n=t.get(v.columnSelection);e.middleButton&&!i?this._columnSelect(e.position,e.mouseColumn,e.inSelectionMode):e.startedOnLineNumbers?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelect(e.position,e.revealType):this._createCursor(e.position,!0):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount>=4?this._selectAll():e.mouseDownCount===3?this._hasMulticursorModifier(e)?e.inSelectionMode?this._lastCursorLineSelectDrag(e.position,e.revealType):this._lastCursorLineSelect(e.position,e.revealType):e.inSelectionMode?this._lineSelectDrag(e.position,e.revealType):this._lineSelect(e.position,e.revealType):e.mouseDownCount===2?e.onInjectedText||(this._hasMulticursorModifier(e)?this._lastCursorWordSelect(e.position,e.revealType):e.inSelectionMode?this._wordSelectDrag(e.position,e.revealType):this._wordSelect(e.position,e.revealType)):this._hasMulticursorModifier(e)?this._hasNonMulticursorModifier(e)||(e.shiftKey?this._columnSelect(e.position,e.mouseColumn,!0):e.inSelectionMode?this._lastCursorMoveToSelect(e.position,e.revealType):this._createCursor(e.position,!1)):e.inSelectionMode?e.altKey?this._columnSelect(e.position,e.mouseColumn,!0):n?this._columnSelect(e.position,e.mouseColumn,!0):this._moveToSelect(e.position,e.revealType):this.moveTo(e.position,e.revealType)}_usualArgs(e,t){return e=this._validateViewColumn(e),{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,revealType:t}}moveTo(e,t){Ue.MoveTo.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_moveToSelect(e,t){Ue.MoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_columnSelect(e,t,i){e=this._validateViewColumn(e),Ue.ColumnSelect.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,mouseColumn:t,doColumnSelect:i})}_createCursor(e,t){e=this._validateViewColumn(e),Ue.CreateCursor.runCoreEditorCommand(this.viewModel,{source:"mouse",position:this._convertViewToModelPosition(e),viewPosition:e,wholeLine:t})}_lastCursorMoveToSelect(e,t){Ue.LastCursorMoveToSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelect(e,t){Ue.WordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_wordSelectDrag(e,t){Ue.WordSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorWordSelect(e,t){Ue.LastCursorWordSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelect(e,t){Ue.LineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lineSelectDrag(e,t){Ue.LineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelect(e,t){Ue.LastCursorLineSelect.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_lastCursorLineSelectDrag(e,t){Ue.LastCursorLineSelectDrag.runCoreEditorCommand(this.viewModel,this._usualArgs(e,t))}_selectAll(){Ue.SelectAll.runCoreEditorCommand(this.viewModel,{source:"mouse"})}_convertViewToModelPosition(e){return this.viewModel.coordinatesConverter.convertViewPositionToModelPosition(e)}emitKeyDown(e){this.userInputEvents.emitKeyDown(e)}emitKeyUp(e){this.userInputEvents.emitKeyUp(e)}emitContextMenu(e){this.userInputEvents.emitContextMenu(e)}emitMouseMove(e){this.userInputEvents.emitMouseMove(e)}emitMouseLeave(e){this.userInputEvents.emitMouseLeave(e)}emitMouseUp(e){this.userInputEvents.emitMouseUp(e)}emitMouseDown(e){this.userInputEvents.emitMouseDown(e)}emitMouseDrag(e){this.userInputEvents.emitMouseDrag(e)}emitMouseDrop(e){this.userInputEvents.emitMouseDrop(e)}emitMouseDropCanceled(){this.userInputEvents.emitMouseDropCanceled()}emitMouseWheel(e){this.userInputEvents.emitMouseWheel(e)}}class Ag{constructor(e){this._lineFactory=e,this._set(1,[])}flush(){this._set(1,[])}_set(e,t){this._lines=t,this._rendLineNumberStart=e}_get(){return{rendLineNumberStart:this._rendLineNumberStart,lines:this._lines}}getStartLineNumber(){return this._rendLineNumberStart}getEndLineNumber(){return this._rendLineNumberStart+this._lines.length-1}getCount(){return this._lines.length}getLine(e){const t=e-this._rendLineNumberStart;if(t<0||t>=this._lines.length)throw new Fe("Illegal value for lineNumber");return this._lines[t]}onLinesDeleted(e,t){if(this.getCount()===0)return null;const i=this.getStartLineNumber(),n=this.getEndLineNumber();if(t<i){const l=t-e+1;return this._rendLineNumberStart-=l,null}if(e>n)return null;let s=0,o=0;for(let l=i;l<=n;l++){const d=l-this._rendLineNumberStart;e<=l&&l<=t&&(o===0?(s=d,o=1):o++)}if(e<i){let l=0;t<i?l=t-e+1:l=i-e,this._rendLineNumberStart-=l}return this._lines.splice(s,o)}onLinesChanged(e,t){const i=e+t-1;if(this.getCount()===0)return!1;const n=this.getStartLineNumber(),s=this.getEndLineNumber();let o=!1;for(let r=e;r<=i;r++)r>=n&&r<=s&&(this._lines[r-this._rendLineNumberStart].onContentChanged(),o=!0);return o}onLinesInserted(e,t){if(this.getCount()===0)return null;const i=t-e+1,n=this.getStartLineNumber(),s=this.getEndLineNumber();if(e<=n)return this._rendLineNumberStart+=i,null;if(e>s)return null;if(i+e>s)return this._lines.splice(e-this._rendLineNumberStart,s-e+1);const o=[];for(let h=0;h<i;h++)o[h]=this._lineFactory.createLine();const r=e-this._rendLineNumberStart,l=this._lines.slice(0,r),d=this._lines.slice(r,this._lines.length-i),c=this._lines.slice(this._lines.length-i,this._lines.length);return this._lines=l.concat(o).concat(d),c}onTokensChanged(e){if(this.getCount()===0)return!1;const t=this.getStartLineNumber(),i=this.getEndLineNumber();let n=!1;for(let s=0,o=e.length;s<o;s++){const r=e[s];if(r.toLineNumber<t||r.fromLineNumber>i)continue;const l=Math.max(t,r.fromLineNumber),d=Math.min(i,r.toLineNumber);for(let c=l;c<=d;c++){const h=c-this._rendLineNumberStart;this._lines[h].onTokensChanged(),n=!0}}return n}}class Og{constructor(e,t){this._viewContext=e,this._lineFactory=t,this.domNode=this._createDomNode(),this._linesCollection=new Ag(this._lineFactory)}_createDomNode(){const e=fe(document.createElement("div"));return e.setClassName("view-layer"),e.setPosition("absolute"),e.domNode.setAttribute("role","presentation"),e.domNode.setAttribute("aria-hidden","true"),e}onConfigurationChanged(e){return!!e.hasChanged(v.layoutInfo)}onFlushed(e,t){if(t){const i=this._linesCollection.getStartLineNumber(),n=this._linesCollection.getEndLineNumber();for(let s=i;s<=n;s++)this._linesCollection.getLine(s).getDomNode()?.remove()}return this._linesCollection.flush(),!0}onLinesChanged(e){return this._linesCollection.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){const t=this._linesCollection.onLinesDeleted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++)t[i].getDomNode()?.remove();return!0}onLinesInserted(e){const t=this._linesCollection.onLinesInserted(e.fromLineNumber,e.toLineNumber);if(t)for(let i=0,n=t.length;i<n;i++)t[i].getDomNode()?.remove();return!0}onScrollChanged(e){return e.scrollTopChanged}onTokensChanged(e){return this._linesCollection.onTokensChanged(e.ranges)}onZonesChanged(e){return!0}getStartLineNumber(){return this._linesCollection.getStartLineNumber()}getEndLineNumber(){return this._linesCollection.getEndLineNumber()}getVisibleLine(e){return this._linesCollection.getLine(e)}renderLines(e){const t=this._linesCollection._get(),i=new Dn(this.domNode.domNode,this._lineFactory,e,this._viewContext),n={rendLineNumberStart:t.rendLineNumberStart,lines:t.lines,linesLength:t.lines.length},s=i.render(n,e.startLineNumber,e.endLineNumber,e.relativeVerticalOffset);this._linesCollection._set(s.rendLineNumberStart,s.lines)}}class Dn{static{this._ttPolicy=ir("editorViewLayer",{createHTML:e=>e})}constructor(e,t,i,n){this._domNode=e,this._lineFactory=t,this._viewportData=i,this._viewContext=n}render(e,t,i,n){const s={rendLineNumberStart:e.rendLineNumberStart,lines:e.lines.slice(0),linesLength:e.linesLength};if(s.rendLineNumberStart+s.linesLength-1<t||i<s.rendLineNumberStart){s.rendLineNumberStart=t,s.linesLength=i-t+1,s.lines=[];for(let o=t;o<=i;o++)s.lines[o-t]=this._lineFactory.createLine();return this._finishRendering(s,!0,n),s}if(this._renderUntouchedLines(s,Math.max(t-s.rendLineNumberStart,0),Math.min(i-s.rendLineNumberStart,s.linesLength-1),n,t),s.rendLineNumberStart>t){const o=t,r=Math.min(i,s.rendLineNumberStart-1);o<=r&&(this._insertLinesBefore(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart<t){const o=Math.min(s.linesLength,t-s.rendLineNumberStart);o>0&&(this._removeLinesBefore(s,o),s.linesLength-=o)}if(s.rendLineNumberStart=t,s.rendLineNumberStart+s.linesLength-1<i){const o=s.rendLineNumberStart+s.linesLength,r=i;o<=r&&(this._insertLinesAfter(s,o,r,n,t),s.linesLength+=r-o+1)}else if(s.rendLineNumberStart+s.linesLength-1>i){const o=Math.max(0,i-s.rendLineNumberStart+1),l=s.linesLength-1-o+1;l>0&&(this._removeLinesAfter(s,l),s.linesLength-=l)}return this._finishRendering(s,!1,n),s}_renderUntouchedLines(e,t,i,n,s){const o=e.rendLineNumberStart,r=e.lines;for(let l=t;l<=i;l++){const d=o+l;r[l].layoutLine(d,n[d-s],this._lineHeightForLineNumber(d))}}_insertLinesBefore(e,t,i,n,s){const o=[];let r=0;for(let l=t;l<=i;l++)o[r++]=this._lineFactory.createLine();e.lines=o.concat(e.lines)}_removeLinesBefore(e,t){for(let i=0;i<t;i++)e.lines[i].getDomNode()?.remove();e.lines.splice(0,t)}_insertLinesAfter(e,t,i,n,s){const o=[];let r=0;for(let l=t;l<=i;l++)o[r++]=this._lineFactory.createLine();e.lines=e.lines.concat(o)}_removeLinesAfter(e,t){const i=e.linesLength-t;for(let n=0;n<t;n++)e.lines[i+n].getDomNode()?.remove();e.lines.splice(i,t)}_finishRenderingNewLines(e,t,i,n){Dn._ttPolicy&&(i=Dn._ttPolicy.createHTML(i));const s=this._domNode.lastChild;t||!s?this._domNode.innerHTML=i:s.insertAdjacentHTML("afterend",i);let o=this._domNode.lastChild;for(let r=e.linesLength-1;r>=0;r--){const l=e.lines[r];n[r]&&(l.setDomNode(o),o=o.previousSibling)}}_finishRenderingInvalidLines(e,t,i){const n=document.createElement("div");Dn._ttPolicy&&(t=Dn._ttPolicy.createHTML(t)),n.innerHTML=t;for(let s=0;s<e.linesLength;s++){const o=e.lines[s];if(i[s]){const r=n.firstChild,l=o.getDomNode();l.parentNode.replaceChild(r,l),o.setDomNode(r)}}}static{this._sb=new Jo(1e5)}_finishRendering(e,t,i){const n=Dn._sb,s=e.linesLength,o=e.lines,r=e.rendLineNumberStart,l=[];{n.reset();let d=!1;for(let c=0;c<s;c++){const h=o[c];if(l[c]=!1,h.getDomNode())continue;const g=c+r;h.renderLine(g,i[c],this._lineHeightForLineNumber(g),this._viewportData,n)&&(l[c]=!0,d=!0)}d&&this._finishRenderingNewLines(e,t,n.build(),l)}{n.reset();let d=!1;const c=[];for(let h=0;h<s;h++){const u=o[h];if(c[h]=!1,l[h])continue;const g=h+r;u.renderLine(g,i[h],this._lineHeightForLineNumber(g),this._viewportData,n)&&(c[h]=!0,d=!0)}d&&this._finishRenderingInvalidLines(e,n.build(),c)}}_lineHeightForLineNumber(e){return this._viewContext.viewLayout.getLineHeightForLineNumber(e)}}class Pg extends St{constructor(e){super(e),this._dynamicOverlays=[],this._isFocused=!1,this._visibleLines=new Og(this._context,{createLine:()=>new zL(this._dynamicOverlays)}),this.domNode=this._visibleLines.domNode;const i=this._context.configuration.options.get(v.fontInfo);st(this.domNode,i),this.domNode.setClassName("view-overlays")}shouldRender(){if(super.shouldRender())return!0;for(let e=0,t=this._dynamicOverlays.length;e<t;e++)if(this._dynamicOverlays[e].shouldRender())return!0;return!1}dispose(){super.dispose();for(let e=0,t=this._dynamicOverlays.length;e<t;e++)this._dynamicOverlays[e].dispose();this._dynamicOverlays=[]}getDomNode(){return this.domNode}addDynamicOverlay(e){this._dynamicOverlays.push(e)}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e);const i=this._context.configuration.options.get(v.fontInfo);return st(this.domNode,i),!0}onFlushed(e){return this._visibleLines.onFlushed(e)}onFocusChanged(e){return this._isFocused=e.isFocused,!0}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onScrollChanged(e){return this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._visibleLines.onZonesChanged(e)}prepareRender(e){const t=this._dynamicOverlays.filter(i=>i.shouldRender());for(let i=0,n=t.length;i<n;i++){const s=t[i];s.prepareRender(e),s.onDidRender()}}render(e){this._viewOverlaysRender(e),this.domNode.toggleClassName("focused",this._isFocused)}_viewOverlaysRender(e){this._visibleLines.renderLines(e.viewportData)}}class zL{constructor(e){this._dynamicOverlays=e,this._domNode=null,this._renderedContent=null}getDomNode(){return this._domNode?this._domNode.domNode:null}setDomNode(e){this._domNode=fe(e)}onContentChanged(){}onTokensChanged(){}renderLine(e,t,i,n,s){let o="";for(let r=0,l=this._dynamicOverlays.length;r<l;r++){const d=this._dynamicOverlays[r];o+=d.render(n.startLineNumber,e)}return this._renderedContent===o?!1:(this._renderedContent=o,s.appendString('<div style="top:'),s.appendString(String(t)),s.appendString("px;height:"),s.appendString(String(i)),s.appendString("px;line-height:"),s.appendString(String(i)),s.appendString('px;">'),s.appendString(o),s.appendString("</div>"),!0)}layoutLine(e,t,i){this._domNode&&(this._domNode.setTop(t),this._domNode.setHeight(i),this._domNode.setLineHeight(i))}}class UL extends Pg{constructor(e){super(e);const i=this._context.configuration.options.get(v.layoutInfo);this._contentWidth=i.contentWidth,this.domNode.setHeight(0)}onConfigurationChanged(e){const i=this._context.configuration.options.get(v.layoutInfo);return this._contentWidth=i.contentWidth,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollWidthChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e),this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth))}}class GL extends Pg{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(v.layoutInfo);this._contentLeft=i.contentLeft,this.domNode.setClassName("margin-view-overlays"),this.domNode.setWidth(1),st(this.domNode,t.get(v.fontInfo))}onConfigurationChanged(e){const t=this._context.configuration.options;st(this.domNode,t.get(v.fontInfo));const i=t.get(v.layoutInfo);return this._contentLeft=i.contentLeft,super.onConfigurationChanged(e)||!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollHeightChanged}_viewOverlaysRender(e){super._viewOverlaysRender(e);const t=Math.min(e.scrollHeight,1e6);this.domNode.setHeight(t),this.domNode.setWidth(this._contentLeft)}}class za{constructor(e){this.onKeyDown=null,this.onKeyUp=null,this.onContextMenu=null,this.onMouseMove=null,this.onMouseLeave=null,this.onMouseDown=null,this.onMouseUp=null,this.onMouseDrag=null,this.onMouseDrop=null,this.onMouseDropCanceled=null,this.onMouseWheel=null,this._coordinatesConverter=e}emitKeyDown(e){this.onKeyDown?.(e)}emitKeyUp(e){this.onKeyUp?.(e)}emitContextMenu(e){this.onContextMenu?.(this._convertViewToModelMouseEvent(e))}emitMouseMove(e){this.onMouseMove?.(this._convertViewToModelMouseEvent(e))}emitMouseLeave(e){this.onMouseLeave?.(this._convertViewToModelMouseEvent(e))}emitMouseDown(e){this.onMouseDown?.(this._convertViewToModelMouseEvent(e))}emitMouseUp(e){this.onMouseUp?.(this._convertViewToModelMouseEvent(e))}emitMouseDrag(e){this.onMouseDrag?.(this._convertViewToModelMouseEvent(e))}emitMouseDrop(e){this.onMouseDrop?.(this._convertViewToModelMouseEvent(e))}emitMouseDropCanceled(){this.onMouseDropCanceled?.()}emitMouseWheel(e){this.onMouseWheel?.(e)}_convertViewToModelMouseEvent(e){return e.target?{event:e.event,target:this._convertViewToModelMouseTarget(e.target)}:e}_convertViewToModelMouseTarget(e){return za.convertViewToModelMouseTarget(e,this._coordinatesConverter)}static convertViewToModelMouseTarget(e,t){const i={...e};return i.position&&(i.position=t.convertViewPositionToModelPosition(i.position)),i.range&&(i.range=t.convertViewRangeToModelRange(i.range)),(i.type===ee.GUTTER_VIEW_ZONE||i.type===ee.CONTENT_VIEW_ZONE)&&(i.detail=this.convertViewToModelViewZoneData(i.detail,t)),i}static convertViewToModelViewZoneData(e,t){return{viewZoneId:e.viewZoneId,positionBefore:e.positionBefore?t.convertViewPositionToModelPosition(e.positionBefore):e.positionBefore,positionAfter:e.positionAfter?t.convertViewPositionToModelPosition(e.positionAfter):e.positionAfter,position:t.convertViewPositionToModelPosition(e.position),afterLineNumber:t.convertViewPositionToModelPosition(new I(e.afterLineNumber,1)).lineNumber}}}const jL=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(jL);class KL extends St{constructor(e){super(e),this.blocks=[],this.contentWidth=-1,this.contentLeft=0,this.domNode=fe(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("blockDecorations-container"),this.update()}update(){let e=!1;const i=this._context.configuration.options.get(v.layoutInfo),n=i.contentWidth-i.verticalScrollbarWidth;this.contentWidth!==n&&(this.contentWidth=n,e=!0);const s=i.contentLeft;return this.contentLeft!==s&&(this.contentLeft=s,e=!0),e}dispose(){super.dispose()}onConfigurationChanged(e){return this.update()}onScrollChanged(e){return e.scrollTopChanged||e.scrollLeftChanged}onDecorationsChanged(e){return!0}onZonesChanged(e){return!0}prepareRender(e){}render(e){let t=0;const i=e.getDecorationsInViewport();for(const n of i){if(!n.options.blockClassName)continue;let s=this.blocks[t];s||(s=this.blocks[t]=fe(document.createElement("div")),this.domNode.appendChild(s));let o,r;n.options.blockIsAfterEnd?(o=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!1),r=e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0)):(o=e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!0),r=n.range.isEmpty()&&!n.options.blockDoesNotCollapse?e.getVerticalOffsetForLineNumber(n.range.startLineNumber,!1):e.getVerticalOffsetAfterLineNumber(n.range.endLineNumber,!0));const[l,d,c,h]=n.options.blockPadding??[0,0,0,0];s.setClassName("blockDecorations-block "+n.options.blockClassName),s.setLeft(this.contentLeft-h),s.setWidth(this.contentWidth+h+d),s.setTop(o-e.scrollTop-l),s.setHeight(r-o+l+c),t++}for(let n=t;n<this.blocks.length;n++)this.blocks[n].domNode.remove();this.blocks.length=t}}class $L extends St{constructor(e,t){super(e),this._viewDomNode=t,this._widgets={},this.domNode=fe(document.createElement("div")),Li.write(this.domNode,xe.ContentWidgets),this.domNode.setClassName("contentWidgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this.overflowingContentWidgetsDomNode=fe(document.createElement("div")),Li.write(this.overflowingContentWidgetsDomNode,xe.OverflowingContentWidgets),this.overflowingContentWidgetsDomNode.setClassName("overflowingContentWidgets")}dispose(){super.dispose(),this._widgets={}}onConfigurationChanged(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onConfigurationChanged(e);return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLineMappingChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesChanged(e){return this._updateAnchorsViewPositions(),!0}onLinesDeleted(e){return this._updateAnchorsViewPositions(),!0}onLinesInserted(e){return this._updateAnchorsViewPositions(),!0}onScrollChanged(e){return!0}onZonesChanged(e){return!0}_updateAnchorsViewPositions(){const e=Object.keys(this._widgets);for(const t of e)this._widgets[t].updateAnchorViewPosition()}addWidget(e){const t=new ZL(this._context,this._viewDomNode,e);this._widgets[t.id]=t,t.allowEditorOverflow?this.overflowingContentWidgetsDomNode.appendChild(t.domNode):this.domNode.appendChild(t.domNode),this.setShouldRender()}setWidgetPosition(e,t,i,n,s){this._widgets[e.getId()].setPosition(t,i,n,s),this.setShouldRender()}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const i=this._widgets[t];delete this._widgets[t];const n=i.domNode.domNode;n.remove(),n.removeAttribute("monaco-visible-content-widget"),this.setShouldRender()}}shouldSuppressMouseDownOnWidget(e){return this._widgets.hasOwnProperty(e)?this._widgets[e].suppressMouseDown:!1}onBeforeRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].onBeforeRender(e)}prepareRender(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].prepareRender(e)}render(e){const t=Object.keys(this._widgets);for(const i of t)this._widgets[i].render(e)}}class ZL{constructor(e,t,i){this._primaryAnchor=new oo(null,null),this._secondaryAnchor=new oo(null,null),this._context=e,this._viewDomNode=t,this._actual=i,this.domNode=fe(this._actual.getDomNode()),this.id=this._actual.getId(),this.allowEditorOverflow=this._actual.allowEditorOverflow||!1,this.suppressMouseDown=this._actual.suppressMouseDown||!1;const n=this._context.configuration.options,s=n.get(v.layoutInfo);this._fixedOverflowWidgets=n.get(v.fixedOverflowWidgets),this._contentWidth=s.contentWidth,this._contentLeft=s.contentLeft,this._affinity=null,this._preference=[],this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1,this._maxWidth=this._getMaxWidth(),this._isVisible=!1,this._renderData=null,this.domNode.setPosition(this._fixedOverflowWidgets&&this.allowEditorOverflow?"fixed":"absolute"),this.domNode.setDisplay("none"),this.domNode.setVisibility("hidden"),this.domNode.setAttribute("widgetId",this.id),this.domNode.setMaxWidth(this._maxWidth)}onConfigurationChanged(e){const t=this._context.configuration.options;if(e.hasChanged(v.layoutInfo)){const i=t.get(v.layoutInfo);this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._maxWidth=this._getMaxWidth()}}updateAnchorViewPosition(){this._setPosition(this._affinity,this._primaryAnchor.modelPosition,this._secondaryAnchor.modelPosition)}_setPosition(e,t,i){this._affinity=e,this._primaryAnchor=n(t,this._context.viewModel,this._affinity),this._secondaryAnchor=n(i,this._context.viewModel,this._affinity);function n(s,o,r){if(!s)return new oo(null,null);const l=o.model.validatePosition(s);if(o.coordinatesConverter.modelPositionIsVisible(l)){const d=o.coordinatesConverter.convertModelPositionToViewPosition(l,r??void 0);return new oo(s,d)}return new oo(s,null)}}_getMaxWidth(){const e=this.domNode.domNode.ownerDocument,t=e.defaultView;return this.allowEditorOverflow?t?.innerWidth||e.documentElement.offsetWidth||e.body.offsetWidth:this._contentWidth}setPosition(e,t,i,n){this._setPosition(n,e,t),this._preference=i,this._primaryAnchor.viewPosition&&this._preference&&this._preference.length>0?this.domNode.setDisplay("block"):this.domNode.setDisplay("none"),this._cachedDomNodeOffsetWidth=-1,this._cachedDomNodeOffsetHeight=-1}_layoutBoxInViewport(e,t,i,n){const s=e.top,o=s,r=e.top+e.height,l=n.viewportHeight-r,d=s-i,c=o>=i,h=r,u=l>=i;let g=e.left;return g+t>n.scrollLeft+n.viewportWidth&&(g=n.scrollLeft+n.viewportWidth-t),g<n.scrollLeft&&(g=n.scrollLeft),{fitsAbove:c,aboveTop:d,fitsBelow:u,belowTop:h,left:g}}_layoutHorizontalSegmentInPage(e,t,i,n){const r=Math.max(15,t.left-n),l=Math.min(t.left+t.width+n,e.width-15),c=this._viewDomNode.domNode.ownerDocument.defaultView;let h=t.left+i-(c?.scrollX??0);if(h+n>l){const u=h-(l-n);h-=u,i-=u}if(h<r){const u=h-r;h-=u,i-=u}return[i,h]}_layoutBoxInPage(e,t,i,n){const s=e.top-i,o=e.top+e.height,r=Xn(this._viewDomNode.domNode),l=this._viewDomNode.domNode.ownerDocument,d=l.defaultView,c=r.top+s-(d?.scrollY??0),h=r.top+o-(d?.scrollY??0),u=im(l.body),[g,f]=this._layoutHorizontalSegmentInPage(u,r,e.left-n.scrollLeft+this._contentLeft,t),m=22,_=22,L=c>=m,w=h+i<=u.height-_;return this._fixedOverflowWidgets?{fitsAbove:L,aboveTop:Math.max(c,m),fitsBelow:w,belowTop:h,left:f}:{fitsAbove:L,aboveTop:s,fitsBelow:w,belowTop:o,left:g}}_prepareRenderWidgetAtExactPositionOverflowing(e){return new ro(e.top,e.left+this._contentLeft)}_getAnchorsCoordinates(e){const t=s(this._primaryAnchor.viewPosition,this._affinity),i=this._secondaryAnchor.viewPosition?.lineNumber===this._primaryAnchor.viewPosition?.lineNumber?this._secondaryAnchor.viewPosition:null,n=s(i,this._affinity);return{primary:t,secondary:n};function s(o,r){if(!o)return null;const l=e.visibleRangeForPosition(o);if(!l)return null;const d=o.column===1&&r===Ie.LeftOfInjectedText?0:l.left,c=e.getVerticalOffsetForLineNumber(o.lineNumber)-e.scrollTop,h=e.getLineHeightForLineNumber(o.lineNumber);return new gh(c,d,h)}}_reduceAnchorCoordinates(e,t,i){if(!t)return e;const n=this._context.configuration.options.get(v.fontInfo);let s=t.left;return s<e.left?s=Math.max(s,e.left-i+n.typicalFullwidthCharacterWidth):s=Math.min(s,e.left+i-n.typicalFullwidthCharacterWidth),new gh(e.top,s,e.height)}_prepareRenderWidget(e){if(!this._preference||this._preference.length===0)return null;const{primary:t,secondary:i}=this._getAnchorsCoordinates(e);if(!t)return{kind:"offViewport",preserveFocus:this.domNode.domNode.contains(this.domNode.domNode.ownerDocument.activeElement)};if(this._cachedDomNodeOffsetWidth===-1||this._cachedDomNodeOffsetHeight===-1){let o=null;if(typeof this._actual.beforeRender=="function"&&(o=ll(this._actual.beforeRender,this._actual)),o)this._cachedDomNodeOffsetWidth=o.width,this._cachedDomNodeOffsetHeight=o.height;else{const l=this.domNode.domNode.getBoundingClientRect();this._cachedDomNodeOffsetWidth=Math.round(l.width),this._cachedDomNodeOffsetHeight=Math.round(l.height)}}const n=this._reduceAnchorCoordinates(t,i,this._cachedDomNodeOffsetWidth);let s;this.allowEditorOverflow?s=this._layoutBoxInPage(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e):s=this._layoutBoxInViewport(n,this._cachedDomNodeOffsetWidth,this._cachedDomNodeOffsetHeight,e);for(let o=1;o<=2;o++)for(const r of this._preference)if(r===bn.ABOVE){if(!s)return null;if(o===2||s.fitsAbove)return{kind:"inViewport",coordinate:new ro(s.aboveTop,s.left),position:bn.ABOVE}}else if(r===bn.BELOW){if(!s)return null;if(o===2||s.fitsBelow)return{kind:"inViewport",coordinate:new ro(s.belowTop,s.left),position:bn.BELOW}}else return this.allowEditorOverflow?{kind:"inViewport",coordinate:this._prepareRenderWidgetAtExactPositionOverflowing(new ro(n.top,n.left)),position:bn.EXACT}:{kind:"inViewport",coordinate:new ro(n.top,n.left),position:bn.EXACT};return null}onBeforeRender(e){!this._primaryAnchor.viewPosition||!this._preference||this._primaryAnchor.viewPosition.lineNumber<e.startLineNumber||this._primaryAnchor.viewPosition.lineNumber>e.endLineNumber||this.domNode.setMaxWidth(this._maxWidth)}prepareRender(e){this._renderData=this._prepareRenderWidget(e)}render(e){if(!this._renderData||this._renderData.kind==="offViewport"){this._isVisible&&(this.domNode.removeAttribute("monaco-visible-content-widget"),this._isVisible=!1,this._renderData?.kind==="offViewport"&&this._renderData.preserveFocus?this.domNode.setTop(-1e3):this.domNode.setVisibility("hidden")),typeof this._actual.afterRender=="function"&&ll(this._actual.afterRender,this._actual,null,null);return}this.allowEditorOverflow?(this.domNode.setTop(this._renderData.coordinate.top),this.domNode.setLeft(this._renderData.coordinate.left)):(this.domNode.setTop(this._renderData.coordinate.top+e.scrollTop-e.bigNumbersDelta),this.domNode.setLeft(this._renderData.coordinate.left)),this._isVisible||(this.domNode.setVisibility("inherit"),this.domNode.setAttribute("monaco-visible-content-widget","true"),this._isVisible=!0),typeof this._actual.afterRender=="function"&&ll(this._actual.afterRender,this._actual,this._renderData.position,this._renderData.coordinate)}}class oo{constructor(e,t){this.modelPosition=e,this.viewPosition=t}}class ro{constructor(e,t){this.top=e,this.left=t,this._coordinateBrand=void 0}}class gh{constructor(e,t,i){this.top=e,this.left=t,this.height=i,this._anchorCoordinateBrand=void 0}}function ll(a,e,...t){try{return a.call(e,...t)}catch{return null}}const qL=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class _n extends ss{}Ee(qL);class kg extends _n{constructor(e){super(),this._context=e;const t=this._context.configuration.options,i=t.get(v.layoutInfo);this._renderLineHighlight=t.get(v.renderLineHighlight),this._renderLineHighlightOnlyWhenFocus=t.get(v.renderLineHighlightOnlyWhenFocus),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._selectionIsEmpty=!0,this._focused=!1,this._cursorLineNumbers=[1],this._selections=[new le(1,1,1,1)],this._renderData=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}_readFromSelections(){let e=!1;const t=new Set;for(const s of this._selections)t.add(s.positionLineNumber);const i=Array.from(t);i.sort((s,o)=>s-o),Do(this._cursorLineNumbers,i)||(this._cursorLineNumbers=i,e=!0);const n=this._selections.every(s=>s.isEmpty());return this._selectionIsEmpty!==n&&(this._selectionIsEmpty=n,e=!0),e}onThemeChanged(e){return this._readFromSelections()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(v.layoutInfo);return this._renderLineHighlight=t.get(v.renderLineHighlight),this._renderLineHighlightOnlyWhenFocus=t.get(v.renderLineHighlightOnlyWhenFocus),this._wordWrap=i.isViewportWrapping,this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,!0}onCursorStateChanged(e){return this._selections=e.selections,this._readFromSelections()}onFlushed(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollWidthChanged||e.scrollTopChanged}onZonesChanged(e){return!0}onFocusChanged(e){return this._renderLineHighlightOnlyWhenFocus?(this._focused=e.isFocused,!0):!1}prepareRender(e){if(!this._shouldRenderThis()){this._renderData=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=[];for(let o=t;o<=i;o++){const r=o-t;n[r]=""}if(this._wordWrap){const o=this._renderOne(e,!1);for(const r of this._cursorLineNumbers){const l=this._context.viewModel.coordinatesConverter,d=l.convertViewPositionToModelPosition(new I(r,1)).lineNumber,c=l.convertModelPositionToViewPosition(new I(d,1)).lineNumber,h=l.convertModelPositionToViewPosition(new I(d,this._context.viewModel.model.getLineMaxColumn(d))).lineNumber,u=Math.max(c,t),g=Math.min(h,i);for(let f=u;f<=g;f++){const m=f-t;n[m]=o}}}const s=this._renderOne(e,!0);for(const o of this._cursorLineNumbers){if(o<t||o>i)continue;const r=o-t;n[r]=s}this._renderData=n}render(e,t){if(!this._renderData)return"";const i=t-e;return i>=this._renderData.length?"":this._renderData[i]}_shouldRenderInMargin(){return(this._renderLineHighlight==="gutter"||this._renderLineHighlight==="all")&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}_shouldRenderInContent(){return(this._renderLineHighlight==="line"||this._renderLineHighlight==="all")&&this._selectionIsEmpty&&(!this._renderLineHighlightOnlyWhenFocus||this._focused)}}class XL extends kg{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-both":"")+(t?" current-line-exact":"")}" style="width:${Math.max(e.scrollWidth,this._contentWidth)}px;"></div>`}_shouldRenderThis(){return this._shouldRenderInContent()}_shouldRenderOther(){return this._shouldRenderInMargin()}}class YL extends kg{_renderOne(e,t){return`<div class="${"current-line"+(this._shouldRenderInMargin()?" current-line-margin":"")+(this._shouldRenderOther()?" current-line-margin-both":"")+(this._shouldRenderInMargin()&&t?" current-line-exact-margin":"")}" style="width:${this._contentLeft}px"></div>`}_shouldRenderThis(){return!0}_shouldRenderOther(){return this._shouldRenderInContent()}}Ks((a,e)=>{const t=a.getColor(nm);if(t&&(e.addRule(`.monaco-editor .view-overlays .current-line { background-color: ${t}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-margin { background-color: ${t}; border: none; }`)),!t||t.isTransparent()||a.defines(Rc)){const i=a.getColor(Rc);i&&(e.addRule(`.monaco-editor .view-overlays .current-line-exact { border: 2px solid ${i}; }`),e.addRule(`.monaco-editor .margin-view-overlays .current-line-exact-margin { border: 2px solid ${i}; }`),fo(a.type)&&(e.addRule(".monaco-editor .view-overlays .current-line-exact { border-width: 1px; }"),e.addRule(".monaco-editor .margin-view-overlays .current-line-exact-margin { border-width: 1px; }")))}});const QL=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(QL);class JL extends _n{constructor(e){super(),this._context=e;const t=this._context.configuration.options;this._typicalHalfwidthCharacterWidth=t.get(v.fontInfo).typicalHalfwidthCharacterWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._typicalHalfwidthCharacterWidth=t.get(v.fontInfo).typicalHalfwidthCharacterWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}prepareRender(e){const t=e.getDecorationsInViewport();let i=[],n=0;for(let l=0,d=t.length;l<d;l++){const c=t[l];c.options.className&&(i[n++]=c)}i=i.sort((l,d)=>{if(l.options.zIndex<d.options.zIndex)return-1;if(l.options.zIndex>d.options.zIndex)return 1;const c=l.options.className,h=d.options.className;return c<h?-1:c>h?1:N.compareRangesUsingStarts(l.range,d.range)});const s=e.visibleRange.startLineNumber,o=e.visibleRange.endLineNumber,r=[];for(let l=s;l<=o;l++){const d=l-s;r[d]=""}this._renderWholeLineDecorations(e,i,r),this._renderNormalDecorations(e,i,r),this._renderResult=r}_renderWholeLineDecorations(e,t,i){const n=e.visibleRange.startLineNumber,s=e.visibleRange.endLineNumber;for(let o=0,r=t.length;o<r;o++){const l=t[o];if(!l.options.isWholeLine)continue;const d='<div class="cdr '+l.options.className+'" style="left:0;width:100%;"></div>',c=Math.max(l.range.startLineNumber,n),h=Math.min(l.range.endLineNumber,s);for(let u=c;u<=h;u++){const g=u-n;i[g]+=d}}}_renderNormalDecorations(e,t,i){const n=e.visibleRange.startLineNumber;let s=null,o=!1,r=null,l=!1;for(let d=0,c=t.length;d<c;d++){const h=t[d];if(h.options.isWholeLine)continue;const u=h.options.className,g=!!h.options.showIfCollapsed;let f=h.range;if(g&&f.endColumn===1&&f.endLineNumber!==f.startLineNumber&&(f=new N(f.startLineNumber,f.startColumn,f.endLineNumber-1,this._context.viewModel.getLineMaxColumn(f.endLineNumber-1))),s===u&&o===g&&N.areIntersectingOrTouching(r,f)){r=N.plusRange(r,f);continue}s!==null&&this._renderNormalDecoration(e,r,s,l,o,n,i),s=u,o=g,r=f,l=h.options.shouldFillLineOnLineBreak??!1}s!==null&&this._renderNormalDecoration(e,r,s,l,o,n,i)}_renderNormalDecoration(e,t,i,n,s,o,r){const l=e.linesVisibleRangesForRange(t,i==="findMatch");if(l)for(let d=0,c=l.length;d<c;d++){const h=l[d];if(h.outsideRenderedLine)continue;const u=h.lineNumber-o;if(s&&h.ranges.length===1){const g=h.ranges[0];if(g.width<this._typicalHalfwidthCharacterWidth){const f=Math.round(g.left+g.width/2),m=Math.max(0,Math.round(f-this._typicalHalfwidthCharacterWidth/2));h.ranges[0]=new dr(m,this._typicalHalfwidthCharacterWidth)}}for(let g=0,f=h.ranges.length;g<f;g++){const m=n&&h.continuesOnNextLine&&f===1,_=h.ranges[g],L='<div class="cdr '+i+'" style="left:'+String(_.left)+"px;width:"+(m?"100%;":String(_.width)+"px;")+'"></div>';r[u]+=L}}}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class ev extends St{constructor(e,t,i,n){super(e);const s=this._context.configuration.options,o=s.get(v.scrollbar),r=s.get(v.mouseWheelScrollSensitivity),l=s.get(v.fastScrollSensitivity),d=s.get(v.scrollPredominantAxis),c={listenOnDomNode:i.domNode,className:"editor-scrollable "+El(e.theme.type),useShadows:!1,lazyRender:!0,vertical:o.vertical,horizontal:o.horizontal,verticalHasArrows:o.verticalHasArrows,horizontalHasArrows:o.horizontalHasArrows,verticalScrollbarSize:o.verticalScrollbarSize,verticalSliderSize:o.verticalSliderSize,horizontalScrollbarSize:o.horizontalScrollbarSize,horizontalSliderSize:o.horizontalSliderSize,handleMouseWheel:o.handleMouseWheel,alwaysConsumeMouseWheel:o.alwaysConsumeMouseWheel,arrowSize:o.arrowSize,mouseWheelScrollSensitivity:r,fastScrollSensitivity:l,scrollPredominantAxis:d,scrollByPage:o.scrollByPage};this.scrollbar=this._register(new Iu(t.domNode,c,this._context.viewLayout.getScrollable())),Li.write(this.scrollbar.getDomNode(),xe.ScrollableElement),this.scrollbarDomNode=fe(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const h=(u,g,f)=>{const m={};{const _=u.scrollTop;_&&(m.scrollTop=this._context.viewLayout.getCurrentScrollTop()+_,u.scrollTop=0)}if(f){const _=u.scrollLeft;_&&(m.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+_,u.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(m,K.Immediate)};this._register(Y(i.domNode,"scroll",u=>h(i.domNode,!0,!0))),this._register(Y(t.domNode,"scroll",u=>h(t.domNode,!0,!1))),this._register(Y(n.domNode,"scroll",u=>h(n.domNode,!0,!1))),this._register(Y(this.scrollbarDomNode.domNode,"scroll",u=>h(this.scrollbarDomNode.domNode,!0,!1)))}dispose(){super.dispose()}_setLayout(){const e=this._context.configuration.options,t=e.get(v.layoutInfo);this.scrollbarDomNode.setLeft(t.contentLeft),e.get(v.minimap).side==="right"?this.scrollbarDomNode.setWidth(t.contentWidth+t.minimap.minimapWidth):this.scrollbarDomNode.setWidth(t.contentWidth),this.scrollbarDomNode.setHeight(t.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarPointerDown(e){this.scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this.scrollbar.delegateScrollFromMouseWheelEvent(e)}onConfigurationChanged(e){if(e.hasChanged(v.scrollbar)||e.hasChanged(v.mouseWheelScrollSensitivity)||e.hasChanged(v.fastScrollSensitivity)){const t=this._context.configuration.options,i=t.get(v.scrollbar),n=t.get(v.mouseWheelScrollSensitivity),s=t.get(v.fastScrollSensitivity),o=t.get(v.scrollPredominantAxis),r={vertical:i.vertical,horizontal:i.horizontal,verticalScrollbarSize:i.verticalScrollbarSize,horizontalScrollbarSize:i.horizontalScrollbarSize,scrollByPage:i.scrollByPage,handleMouseWheel:i.handleMouseWheel,mouseWheelScrollSensitivity:n,fastScrollSensitivity:s,scrollPredominantAxis:o};this.scrollbar.updateOptions(r)}return e.hasChanged(v.layoutInfo)&&this._setLayout(),!0}onScrollChanged(e){return!0}onThemeChanged(e){return this.scrollbar.updateClassName("editor-scrollable "+El(this._context.theme.type)),!0}prepareRender(e){}render(e){this.scrollbar.renderNow()}}const tv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(tv);class ql{constructor(e,t,i,n,s){this.startLineNumber=e,this.endLineNumber=t,this.className=i,this.tooltip=n,this._decorationToRenderBrand=void 0,this.zIndex=s??0}}class iv{constructor(e,t,i){this.className=e,this.zIndex=t,this.tooltip=i}}class nv{constructor(){this.decorations=[]}add(e){this.decorations.push(e)}getDecorations(){return this.decorations}}class Wg extends _n{_render(e,t,i){const n=[];for(let r=e;r<=t;r++){const l=r-e;n[l]=new nv}if(i.length===0)return n;i.sort((r,l)=>r.className===l.className?r.startLineNumber===l.startLineNumber?r.endLineNumber-l.endLineNumber:r.startLineNumber-l.startLineNumber:r.className<l.className?-1:1);let s=null,o=0;for(let r=0,l=i.length;r<l;r++){const d=i[r],c=d.className,h=d.zIndex;let u=Math.max(d.startLineNumber,e)-e;const g=Math.min(d.endLineNumber,t)-e;s===c?(u=Math.max(o+1,u),o=Math.max(o,g)):(s=c,o=g);for(let f=u;f<=o;f++)n[f].add(new iv(c,h,d.tooltip))}return n}}class sv extends St{constructor(e){super(e),this._widgets={},this._context=e;const t=this._context.configuration.options,i=t.get(v.layoutInfo);this.domNode=fe(document.createElement("div")),this.domNode.setClassName("glyph-margin-widgets"),this.domNode.setPosition("absolute"),this.domNode.setTop(0),this._lineHeight=t.get(v.lineHeight),this._glyphMargin=t.get(v.glyphMargin),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,this._managedDomNodes=[],this._decorationGlyphsToRender=[]}dispose(){this._managedDomNodes=[],this._decorationGlyphsToRender=[],this._widgets={},super.dispose()}getWidgets(){return Object.values(this._widgets)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(v.layoutInfo);return this._lineHeight=t.get(v.lineHeight),this._glyphMargin=t.get(v.glyphMargin),this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._glyphMarginDecorationLaneCount=i.glyphMarginDecorationLaneCount,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}addWidget(e){const t=fe(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:e.getPosition(),domNode:t,renderInfo:null},t.setPosition("absolute"),t.setDisplay("none"),t.setAttribute("widgetId",e.getId()),this.domNode.appendChild(t),this.setShouldRender()}setWidgetPosition(e,t){const i=this._widgets[e.getId()];return i.preference.lane===t.lane&&i.preference.zIndex===t.zIndex&&N.equalsRange(i.preference.range,t.range)?!1:(i.preference=t,this.setShouldRender(),!0)}removeWidget(e){const t=e.getId();if(this._widgets[t]){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender()}}_collectDecorationBasedGlyphRenderRequest(e,t){const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=e.getDecorationsInViewport();for(const o of s){const r=o.options.glyphMarginClassName;if(!r)continue;const l=Math.max(o.range.startLineNumber,i),d=Math.min(o.range.endLineNumber,n),c=o.options.glyphMargin?.position??nr.Center,h=o.options.zIndex??0;for(let u=l;u<=d;u++){const g=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(u,0)),f=this._context.viewModel.glyphLanes.getLanesAtLine(g.lineNumber).indexOf(c);t.push(new ov(u,f,h,r))}}}_collectWidgetBasedGlyphRenderRequest(e,t){const i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(const s of Object.values(this._widgets)){const o=s.preference.range,{startLineNumber:r,endLineNumber:l}=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(N.lift(o));if(!r||!l||l<i||r>n)continue;const d=Math.max(r,i),c=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(d,0)),h=this._context.viewModel.glyphLanes.getLanesAtLine(c.lineNumber).indexOf(s.preference.lane);t.push(new rv(d,h,s.preference.zIndex,s))}}_collectSortedGlyphRenderRequests(e){const t=[];return this._collectDecorationBasedGlyphRenderRequest(e,t),this._collectWidgetBasedGlyphRenderRequest(e,t),t.sort((i,n)=>i.lineNumber===n.lineNumber?i.laneIndex===n.laneIndex?i.zIndex===n.zIndex?n.type===i.type?i.type===$n.Decoration&&n.type===$n.Decoration?i.className<n.className?-1:1:0:n.type-i.type:n.zIndex-i.zIndex:i.laneIndex-n.laneIndex:i.lineNumber-n.lineNumber),t}prepareRender(e){if(!this._glyphMargin){this._decorationGlyphsToRender=[];return}for(const n of Object.values(this._widgets))n.renderInfo=null;const t=new As(this._collectSortedGlyphRenderRequests(e)),i=[];for(;t.length>0;){const n=t.peek();if(!n)break;const s=t.takeWhile(r=>r.lineNumber===n.lineNumber&&r.laneIndex===n.laneIndex);if(!s||s.length===0)break;const o=s[0];if(o.type===$n.Decoration){const r=[];for(const l of s){if(l.zIndex!==o.zIndex||l.type!==o.type)break;(r.length===0||r[r.length-1]!==l.className)&&r.push(l.className)}i.push(o.accept(r.join(" ")))}else o.widget.renderInfo={lineNumber:o.lineNumber,laneIndex:o.laneIndex}}this._decorationGlyphsToRender=i}render(e){if(!this._glyphMargin){for(const i of Object.values(this._widgets))i.domNode.setDisplay("none");for(;this._managedDomNodes.length>0;)this._managedDomNodes.pop()?.domNode.remove();return}const t=Math.round(this._glyphMarginWidth/this._glyphMarginDecorationLaneCount);for(const i of Object.values(this._widgets))if(!i.renderInfo)i.domNode.setDisplay("none");else{const n=e.viewportData.relativeVerticalOffset[i.renderInfo.lineNumber-e.viewportData.startLineNumber],s=this._glyphMarginLeft+i.renderInfo.laneIndex*this._lineHeight;i.domNode.setDisplay("block"),i.domNode.setTop(n),i.domNode.setLeft(s),i.domNode.setWidth(t),i.domNode.setHeight(this._lineHeight)}for(let i=0;i<this._decorationGlyphsToRender.length;i++){const n=this._decorationGlyphsToRender[i],s=n.lineNumber,o=e.viewportData.relativeVerticalOffset[s-e.viewportData.startLineNumber],r=this._glyphMarginLeft+n.laneIndex*this._lineHeight;let l;i<this._managedDomNodes.length?l=this._managedDomNodes[i]:(l=fe(document.createElement("div")),this._managedDomNodes.push(l),this.domNode.appendChild(l));const d=this._context.viewLayout.getLineHeightForLineNumber(s);l.setClassName("cgmr codicon "+n.combinedClassName),l.setPosition("absolute"),l.setTop(o),l.setLeft(r),l.setWidth(t),l.setHeight(d)}for(;this._managedDomNodes.length>this._decorationGlyphsToRender.length;)this._managedDomNodes.pop()?.domNode.remove()}}var $n;(function(a){a[a.Decoration=0]="Decoration",a[a.Widget=1]="Widget"})($n||($n={}));class ov{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.className=n,this.type=$n.Decoration}accept(e){return new av(this.lineNumber,this.laneIndex,e)}}class rv{constructor(e,t,i,n){this.lineNumber=e,this.laneIndex=t,this.zIndex=i,this.widget=n,this.type=$n.Widget}}class av{constructor(e,t,i){this.lineNumber=e,this.laneIndex=t,this.combinedClassName=i}}const lv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(lv);class dv extends _n{constructor(e){super(),this._context=e,this._primaryPosition=null;const t=this._context.configuration.options,i=t.get(v.wrappingInfo),n=t.get(v.fontInfo);this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(v.guides),this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(v.wrappingInfo),n=t.get(v.fontInfo);return this._spaceWidth=n.spaceWidth,this._maxIndentLeft=i.wrappingColumn===-1?-1:i.wrappingColumn*n.typicalHalfwidthCharacterWidth,this._bracketPairGuideOptions=t.get(v.guides),!0}onCursorStateChanged(e){const i=e.selections[0].getPosition();return this._primaryPosition?.equals(i)?!1:(this._primaryPosition=i,!0)}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onLanguageConfigurationChanged(e){return!0}prepareRender(e){if(!this._bracketPairGuideOptions.indentation&&this._bracketPairGuideOptions.bracketPairs===!1){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=e.scrollWidth,s=this._primaryPosition,o=this.getGuidesByLine(t,Math.min(i+1,this._context.viewModel.getLineCount()),s),r=[];for(let l=t;l<=i;l++){const d=l-t,c=o[d];let h="";const u=e.visibleRangeForPosition(new I(l,1))?.left??0;for(const g of c){const f=g.column===-1?u+(g.visibleColumn-1)*this._spaceWidth:e.visibleRangeForPosition(new I(l,g.column)).left;if(f>n||this._maxIndentLeft>0&&f>this._maxIndentLeft)break;const m=g.horizontalLine?g.horizontalLine.top?"horizontal-top":"horizontal-bottom":"vertical",_=g.horizontalLine?(e.visibleRangeForPosition(new I(l,g.horizontalLine.endColumn))?.left??f+this._spaceWidth)-f:this._spaceWidth;h+=`<div class="core-guide ${g.className} ${m}" style="left:${f}px;width:${_}px"></div>`}r[d]=h}this._renderResult=r}getGuidesByLine(e,t,i){const n=this._bracketPairGuideOptions.bracketPairs!==!1?this._context.viewModel.getBracketGuidesInRangeByLine(e,t,i,{highlightActive:this._bracketPairGuideOptions.highlightActiveBracketPair,horizontalGuides:this._bracketPairGuideOptions.bracketPairsHorizontal===!0?Ya.Enabled:this._bracketPairGuideOptions.bracketPairsHorizontal==="active"?Ya.EnabledForActive:Ya.Disabled,includeInactive:this._bracketPairGuideOptions.bracketPairs===!0}):null,s=this._bracketPairGuideOptions.indentation?this._context.viewModel.getLinesIndentGuides(e,t):null;let o=0,r=0,l=0;if(this._bracketPairGuideOptions.highlightActiveIndentation!==!1&&i){const h=this._context.viewModel.getActiveIndentGuide(i.lineNumber,e,t);o=h.startLineNumber,r=h.endLineNumber,l=h.indent}const{indentSize:d}=this._context.viewModel.model.getOptions(),c=[];for(let h=e;h<=t;h++){const u=new Array;c.push(u);const g=n?n[h-e]:[],f=new As(g),m=s?s[h-e]:0;for(let _=1;_<=m;_++){const L=(_-1)*d+1,w=(this._bracketPairGuideOptions.highlightActiveIndentation==="always"||g.length===0)&&o<=h&&h<=r&&_===l;u.push(...f.takeWhile(C=>C.visibleColumn<L)||[]);const p=f.peek();(!p||p.visibleColumn!==L||p.horizontalLine)&&u.push(new Il(L,-1,`core-guide-indent lvl-${(_-1)%30}`+(w?" indent-active":""),null,-1,-1))}u.push(...f.takeWhile(_=>!0)||[])}return c}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}function hs(a){if(!(a&&a.isTransparent()))return a}Ks((a,e)=>{const t=[{bracketColor:rm,guideColor:om,guideColorActive:sm},{bracketColor:dm,guideColor:lm,guideColorActive:am},{bracketColor:um,guideColor:hm,guideColorActive:cm},{bracketColor:mm,guideColor:fm,guideColorActive:gm},{bracketColor:Cm,guideColor:_m,guideColorActive:pm},{bracketColor:vm,guideColor:Lm,guideColorActive:wm}],i=new Om,n=[{indentColor:Sm,indentColorActive:bm},{indentColor:xm,indentColorActive:ym},{indentColor:Em,indentColorActive:Nm},{indentColor:Rm,indentColorActive:Im},{indentColor:Tm,indentColorActive:Dm},{indentColor:Am,indentColorActive:Mm}],s=t.map(r=>{const l=a.getColor(r.bracketColor),d=a.getColor(r.guideColor),c=a.getColor(r.guideColorActive),h=hs(hs(d)??l?.transparent(.3)),u=hs(hs(c)??l);if(!(!h||!u))return{guideColor:h,guideColorActive:u}}).filter(Os),o=n.map(r=>{const l=a.getColor(r.indentColor),d=a.getColor(r.indentColorActive),c=hs(l),h=hs(d);if(!(!c||!h))return{indentColor:c,indentColorActive:h}}).filter(Os);if(s.length>0){for(let r=0;r<30;r++){const l=s[r%s.length];e.addRule(`.monaco-editor .${i.getInlineClassNameOfLevel(r).replace(/ /g,".")} { --guide-color: ${l.guideColor}; --guide-color-active: ${l.guideColorActive}; }`)}e.addRule(".monaco-editor .vertical { box-shadow: 1px 0 0 0 var(--guide-color) inset; }"),e.addRule(".monaco-editor .horizontal-top { border-top: 1px solid var(--guide-color); }"),e.addRule(".monaco-editor .horizontal-bottom { border-bottom: 1px solid var(--guide-color); }"),e.addRule(`.monaco-editor .vertical.${i.activeClassName} { box-shadow: 1px 0 0 0 var(--guide-color-active) inset; }`),e.addRule(`.monaco-editor .horizontal-top.${i.activeClassName} { border-top: 1px solid var(--guide-color-active); }`),e.addRule(`.monaco-editor .horizontal-bottom.${i.activeClassName} { border-bottom: 1px solid var(--guide-color-active); }`)}if(o.length>0){for(let r=0;r<30;r++){const l=o[r%o.length];e.addRule(`.monaco-editor .lines-content .core-guide-indent.lvl-${r} { --indent-color: ${l.indentColor}; --indent-color-active: ${l.indentColorActive}; }`)}e.addRule(".monaco-editor .lines-content .core-guide-indent { box-shadow: 1px 0 0 0 var(--indent-color) inset; }"),e.addRule(".monaco-editor .lines-content .core-guide-indent.indent-active { box-shadow: 1px 0 0 0 var(--indent-color-active) inset; }")}});const cv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(cv);class Ua extends _n{static{this.CLASS_NAME="line-numbers"}constructor(e){super(),this._context=e,this._readConfig(),this._lastCursorModelPosition=new I(1,1),this._renderResult=null,this._activeLineNumber=1,this._context.addEventHandler(this)}_readConfig(){const e=this._context.configuration.options;this._lineHeight=e.get(v.lineHeight);const t=e.get(v.lineNumbers);this._renderLineNumbers=t.renderType,this._renderCustomLineNumbers=t.renderFn,this._renderFinalNewline=e.get(v.renderFinalNewline);const i=e.get(v.layoutInfo);this._lineNumbersLeft=i.lineNumbersLeft,this._lineNumbersWidth=i.lineNumbersWidth}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return this._readConfig(),!0}onCursorStateChanged(e){const t=e.selections[0].getPosition();this._lastCursorModelPosition=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(t);let i=!1;return this._activeLineNumber!==t.lineNumber&&(this._activeLineNumber=t.lineNumber,i=!0),(this._renderLineNumbers===fs.Relative||this._renderLineNumbers===fs.Interval)&&(i=!0),i}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onDecorationsChanged(e){return e.affectsLineNumber}_getLineRenderLineNumber(e){const t=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(e,1));if(t.column!==1)return"";const i=t.lineNumber;if(this._renderCustomLineNumbers)return this._renderCustomLineNumbers(i);if(this._renderLineNumbers===fs.Relative){const n=Math.abs(this._lastCursorModelPosition.lineNumber-i);return n===0?'<span class="relative-current-line-number">'+i+"</span>":String(n)}if(this._renderLineNumbers===fs.Interval){if(this._lastCursorModelPosition.lineNumber===i||i%10===0)return String(i);const n=this._context.viewModel.getLineCount();return i===n?String(i):""}return String(i)}prepareRender(e){if(this._renderLineNumbers===fs.Off){this._renderResult=null;return}const t=Ea?this._lineHeight%2===0?" lh-even":" lh-odd":"",i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,s=this._context.viewModel.getDecorationsInViewport(e.visibleRange).filter(d=>!!d.options.lineNumberClassName);s.sort((d,c)=>N.compareRangesUsingEnds(d.range,c.range));let o=0;const r=this._context.viewModel.getLineCount(),l=[];for(let d=i;d<=n;d++){const c=d-i;let h=this._getLineRenderLineNumber(d),u="";for(;o<s.length&&s[o].range.endLineNumber<d;)o++;for(let g=o;g<s.length;g++){const{range:f,options:m}=s[g];f.startLineNumber<=d&&(u+=" "+m.lineNumberClassName)}if(!h&&!u){l[c]="";continue}d===r&&this._context.viewModel.getLineLength(d)===0&&(this._renderFinalNewline==="off"&&(h=""),this._renderFinalNewline==="dimmed"&&(u+=" dimmed-line-number")),d===this._activeLineNumber&&(u+=" active-line-number"),l[c]=`<div class="${Ua.CLASS_NAME}${t}${u}" style="left:${this._lineNumbersLeft}px;width:${this._lineNumbersWidth}px;">${h}</div>`}this._renderResult=l}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}Ks((a,e)=>{const t=a.getColor(Pm),i=a.getColor(km);i?e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${i}; }`):t&&e.addRule(`.monaco-editor .line-numbers.dimmed-line-number { color: ${t.transparent(.4)}; }`)});const hv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(hv);const Is="monaco-mouse-cursor-text",uv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class dl{get didDomLayout(){return this._didDomLayout}readClientRect(){if(!this._clientRectRead){this._clientRectRead=!0;const e=this._domNode.getBoundingClientRect();this.markDidDomLayout(),this._clientRectDeltaLeft=e.left,this._clientRectScale=e.width/this._domNode.offsetWidth}}get clientRectDeltaLeft(){return this._clientRectRead||this.readClientRect(),this._clientRectDeltaLeft}get clientRectScale(){return this._clientRectRead||this.readClientRect(),this._clientRectScale}constructor(e,t){this._domNode=e,this.endNode=t,this._didDomLayout=!1,this._clientRectDeltaLeft=0,this._clientRectScale=1,this._clientRectRead=!1}markDidDomLayout(){this._didDomLayout=!0}}class na{constructor(e,t){this.themeType=t;const i=e.options,n=i.get(v.fontInfo);i.get(v.experimentalWhitespaceRendering)==="off"?this.renderWhitespace=i.get(v.renderWhitespace):this.renderWhitespace="none",this.renderControlCharacters=i.get(v.renderControlCharacters),this.spaceWidth=n.spaceWidth,this.middotWidth=n.middotWidth,this.wsmiddotWidth=n.wsmiddotWidth,this.useMonospaceOptimizations=n.isMonospace&&!i.get(v.disableMonospaceOptimizations),this.canUseHalfwidthRightwardsArrow=n.canUseHalfwidthRightwardsArrow,this.lineHeight=i.get(v.lineHeight),this.stopRenderingLineAfter=i.get(v.stopRenderingLineAfter),this.fontLigatures=i.get(v.fontLigatures),this.useGpu=i.get(v.experimentalGpuAcceleration)==="on"}equals(e){return this.themeType===e.themeType&&this.renderWhitespace===e.renderWhitespace&&this.renderControlCharacters===e.renderControlCharacters&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.useMonospaceOptimizations===e.useMonospaceOptimizations&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter&&this.fontLigatures===e.fontLigatures&&this.useGpu===e.useGpu}}Ee(uv);class gv{constructor(){this._currentVisibleRange=new N(1,1,1,1)}getCurrentVisibleRange(){return this._currentVisibleRange}setCurrentVisibleRange(e){this._currentVisibleRange=e}}class fv{constructor(e,t,i,n,s,o,r){this.minimalReveal=e,this.lineNumber=t,this.startColumn=i,this.endColumn=n,this.startScrollTop=s,this.stopScrollTop=o,this.scrollType=r,this.type="range",this.minLineNumber=t,this.maxLineNumber=t}}class mv{constructor(e,t,i,n,s){this.minimalReveal=e,this.selections=t,this.startScrollTop=i,this.stopScrollTop=n,this.scrollType=s,this.type="selections";let o=t[0].startLineNumber,r=t[0].endLineNumber;for(let l=1,d=t.length;l<d;l++){const c=t[l];o=Math.min(o,c.startLineNumber),r=Math.max(r,c.endLineNumber)}this.minLineNumber=o,this.maxLineNumber=r}}class sc extends St{static{this.HORIZONTAL_EXTRA_PX=30}constructor(e,t,i){super(e);const n=this._context.configuration,s=this._context.configuration.options,o=s.get(v.fontInfo),r=s.get(v.wrappingInfo);this._lineHeight=s.get(v.lineHeight),this._typicalHalfwidthCharacterWidth=o.typicalHalfwidthCharacterWidth,this._isViewportWrapping=r.isViewportWrapping,this._revealHorizontalRightPadding=s.get(v.revealHorizontalRightPadding),this._cursorSurroundingLines=s.get(v.cursorSurroundingLines),this._cursorSurroundingLinesStyle=s.get(v.cursorSurroundingLinesStyle),this._canUseLayerHinting=!s.get(v.disableLayerHinting),this._viewLineOptions=new na(n,this._context.theme.type),this._linesContent=i,this._textRangeRestingSpot=document.createElement("div"),this._visibleLines=new Og(this._context,{createLine:()=>new Pi(t,this._viewLineOptions)}),this.domNode=this._visibleLines.domNode,Li.write(this.domNode,xe.ViewLines),this.domNode.setClassName(`view-lines ${Is}`),st(this.domNode,o),this._maxLineWidth=0,this._asyncUpdateLineWidths=new Ei(()=>{this._updateLineWidthsSlow()},200),this._asyncCheckMonospaceFontAssumptions=new Ei(()=>{this._checkMonospaceFontAssumptions()},2e3),this._lastRenderedData=new gv,this._horizontalRevealRequest=null,this._stickyScrollEnabled=s.get(v.stickyScroll).enabled,this._maxNumberStickyLines=s.get(v.stickyScroll).maxLineCount}dispose(){this._asyncUpdateLineWidths.dispose(),this._asyncCheckMonospaceFontAssumptions.dispose(),super.dispose()}getDomNode(){return this.domNode}onConfigurationChanged(e){this._visibleLines.onConfigurationChanged(e),e.hasChanged(v.wrappingInfo)&&(this._maxLineWidth=0);const t=this._context.configuration.options,i=t.get(v.fontInfo),n=t.get(v.wrappingInfo);return this._lineHeight=t.get(v.lineHeight),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._isViewportWrapping=n.isViewportWrapping,this._revealHorizontalRightPadding=t.get(v.revealHorizontalRightPadding),this._cursorSurroundingLines=t.get(v.cursorSurroundingLines),this._cursorSurroundingLinesStyle=t.get(v.cursorSurroundingLinesStyle),this._canUseLayerHinting=!t.get(v.disableLayerHinting),this._stickyScrollEnabled=t.get(v.stickyScroll).enabled,this._maxNumberStickyLines=t.get(v.stickyScroll).maxLineCount,st(this.domNode,i),this._onOptionsMaybeChanged(),e.hasChanged(v.layoutInfo)&&(this._maxLineWidth=0),!0}_onOptionsMaybeChanged(){const e=this._context.configuration,t=new na(e,this._context.theme.type);if(!this._viewLineOptions.equals(t)){this._viewLineOptions=t;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onOptionsChanged(this._viewLineOptions);return!0}return!1}onCursorStateChanged(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=!1;for(let s=t;s<=i;s++)n=this._visibleLines.getVisibleLine(s).onSelectionChanged()||n;return n}onDecorationsChanged(e){{const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++)this._visibleLines.getVisibleLine(n).onDecorationsChanged()}return!0}onFlushed(e){const t=this._visibleLines.onFlushed(e,this._viewLineOptions.useGpu);return this._maxLineWidth=0,t}onLinesChanged(e){return this._visibleLines.onLinesChanged(e)}onLinesDeleted(e){return this._visibleLines.onLinesDeleted(e)}onLinesInserted(e){return this._visibleLines.onLinesInserted(e)}onRevealRangeRequest(e){const t=this._computeScrollTopToRevealRange(this._context.viewLayout.getFutureViewport(),e.source,e.minimalReveal,e.range,e.selections,e.verticalType);if(t===-1)return!1;let i=this._context.viewLayout.validateScrollPosition({scrollTop:t});e.revealHorizontal?e.range&&e.range.startLineNumber!==e.range.endLineNumber?i={scrollTop:i.scrollTop,scrollLeft:0}:e.range?this._horizontalRevealRequest=new fv(e.minimalReveal,e.range.startLineNumber,e.range.startColumn,e.range.endColumn,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType):e.selections&&e.selections.length>0&&(this._horizontalRevealRequest=new mv(e.minimalReveal,e.selections,this._context.viewLayout.getCurrentScrollTop(),i.scrollTop,e.scrollType)):this._horizontalRevealRequest=null;const s=Math.abs(this._context.viewLayout.getCurrentScrollTop()-i.scrollTop)<=this._lineHeight?K.Immediate:e.scrollType;return this._context.viewModel.viewLayout.setScrollPosition(i,s),!0}onScrollChanged(e){if(this._horizontalRevealRequest&&e.scrollLeftChanged&&(this._horizontalRevealRequest=null),this._horizontalRevealRequest&&e.scrollTopChanged){const t=Math.min(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop),i=Math.max(this._horizontalRevealRequest.startScrollTop,this._horizontalRevealRequest.stopScrollTop);(e.scrollTop<t||e.scrollTop>i)&&(this._horizontalRevealRequest=null)}return this.domNode.setWidth(e.scrollWidth),this._visibleLines.onScrollChanged(e)||!0}onTokensChanged(e){return this._visibleLines.onTokensChanged(e)}onZonesChanged(e){return this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth),this._visibleLines.onZonesChanged(e)}onThemeChanged(e){return this._onOptionsMaybeChanged()}getPositionFromDOMInfo(e,t){const i=this._getViewLineDomNode(e);if(i===null)return null;const n=this._getLineNumberFor(i);if(n===-1||n<1||n>this._context.viewModel.getLineCount())return null;if(this._context.viewModel.getLineMaxColumn(n)===1)return new I(n,1);const s=this._visibleLines.getStartLineNumber(),o=this._visibleLines.getEndLineNumber();if(n<s||n>o)return null;let r=this._visibleLines.getVisibleLine(n).getColumnOfNodeOffset(e,t);const l=this._context.viewModel.getLineMinColumn(n);return r<l&&(r=l),new I(n,r)}_getViewLineDomNode(e){for(;e&&e.nodeType===1;){if(e.className===Pi.CLASS_NAME)return e;e=e.parentElement}return null}_getLineNumberFor(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();for(let n=t;n<=i;n++){const s=this._visibleLines.getVisibleLine(n);if(e===s.getDomNode())return n}return-1}getLineWidth(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();if(e<t||e>i)return-1;const n=new dl(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getWidth(n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}linesVisibleRangesForRange(e,t){if(this.shouldRender())return null;const i=e.endLineNumber,n=N.intersectRanges(e,this._lastRenderedData.getCurrentVisibleRange());if(!n)return null;const s=[];let o=0;const r=new dl(this.domNode.domNode,this._textRangeRestingSpot);let l=0;t&&(l=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(n.startLineNumber,1)).lineNumber);const d=this._visibleLines.getStartLineNumber(),c=this._visibleLines.getEndLineNumber();for(let h=n.startLineNumber;h<=n.endLineNumber;h++){if(h<d||h>c)continue;const u=h===n.startLineNumber?n.startColumn:1,g=h!==i,f=g?this._context.viewModel.getLineMaxColumn(h):n.endColumn,m=this._visibleLines.getVisibleLine(h).getVisibleRangesForRange(h,u,f,r);if(m){if(t&&h<i){const _=l;l=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(h+1,1)).lineNumber,_!==l&&(m.ranges[m.ranges.length-1].width+=this._typicalHalfwidthCharacterWidth)}s[o++]=new pg(m.outsideRenderedLine,h,dr.from(m.ranges),g)}}return this._updateLineWidthsSlowIfDomDidLayout(r),o===0?null:s}_visibleRangesForLineRange(e,t,i){if(this.shouldRender()||e<this._visibleLines.getStartLineNumber()||e>this._visibleLines.getEndLineNumber())return null;const n=new dl(this.domNode.domNode,this._textRangeRestingSpot),s=this._visibleLines.getVisibleLine(e).getVisibleRangesForRange(e,t,i,n);return this._updateLineWidthsSlowIfDomDidLayout(n),s}visibleRangeForPosition(e){const t=this._visibleRangesForLineRange(e.lineNumber,e.column,e.column);return t?new _g(t.outsideRenderedLine,t.ranges[0].left):null}updateLineWidths(){this._updateLineWidths(!1)}_updateLineWidthsFast(){return this._updateLineWidths(!0)}_updateLineWidthsSlow(){this._updateLineWidths(!1)}_updateLineWidthsSlowIfDomDidLayout(e){e.didDomLayout&&(this._asyncUpdateLineWidths.isScheduled()||(this._asyncUpdateLineWidths.cancel(),this._updateLineWidthsSlow()))}_updateLineWidths(e){const t=this._visibleLines.getStartLineNumber(),i=this._visibleLines.getEndLineNumber();let n=1,s=!0;for(let o=t;o<=i;o++){const r=this._visibleLines.getVisibleLine(o);if(e&&!r.getWidthIsFast()){s=!1;continue}n=Math.max(n,r.getWidth(null))}return s&&t===1&&i===this._context.viewModel.getLineCount()&&(this._maxLineWidth=0),this._ensureMaxLineWidth(n),s}_checkMonospaceFontAssumptions(){let e=-1,t=-1;const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++){const o=this._visibleLines.getVisibleLine(s);if(o.needsMonospaceFontCheck()){const r=o.getWidth(null);r>t&&(t=r,e=s)}}if(e!==-1&&!this._visibleLines.getVisibleLine(e).monospaceAssumptionsAreValid())for(let s=i;s<=n;s++)this._visibleLines.getVisibleLine(s).onMonospaceAssumptionsInvalidated()}prepareRender(){throw new Error("Not supported")}render(){throw new Error("Not supported")}renderText(e){if(this._visibleLines.renderLines(e),this._lastRenderedData.setCurrentVisibleRange(e.visibleRange),this.domNode.setWidth(this._context.viewLayout.getScrollWidth()),this.domNode.setHeight(Math.min(this._context.viewLayout.getScrollHeight(),1e6)),this._horizontalRevealRequest){const i=this._horizontalRevealRequest;if(e.startLineNumber<=i.minLineNumber&&i.maxLineNumber<=e.endLineNumber){this._horizontalRevealRequest=null,this.onDidRender();const n=this._computeScrollLeftToReveal(i);n&&(this._isViewportWrapping||this._ensureMaxLineWidth(n.maxHorizontalOffset),this._context.viewModel.viewLayout.setScrollPosition({scrollLeft:n.scrollLeft},i.scrollType))}}if(this._updateLineWidthsFast()?this._asyncUpdateLineWidths.cancel():this._asyncUpdateLineWidths.schedule(),Ea&&!this._asyncCheckMonospaceFontAssumptions.isScheduled()){const i=this._visibleLines.getStartLineNumber(),n=this._visibleLines.getEndLineNumber();for(let s=i;s<=n;s++)if(this._visibleLines.getVisibleLine(s).needsMonospaceFontCheck()){this._asyncCheckMonospaceFontAssumptions.schedule();break}}this._linesContent.setLayerHinting(this._canUseLayerHinting),this._linesContent.setContain("strict");const t=this._context.viewLayout.getCurrentScrollTop()-e.bigNumbersDelta;this._linesContent.setTop(-t),this._linesContent.setLeft(-this._context.viewLayout.getCurrentScrollLeft())}_ensureMaxLineWidth(e){const t=Math.ceil(e);this._maxLineWidth<t&&(this._maxLineWidth=t,this._context.viewModel.viewLayout.setMaxLineWidth(this._maxLineWidth))}_computeScrollTopToRevealRange(e,t,i,n,s,o){const r=e.top,l=e.height,d=r+l;let c,h,u;if(s&&s.length>0){let L=s[0].startLineNumber,w=s[0].endLineNumber;for(let p=1,C=s.length;p<C;p++){const b=s[p];L=Math.min(L,b.startLineNumber),w=Math.max(w,b.endLineNumber)}c=!1,h=this._context.viewLayout.getVerticalOffsetForLineNumber(L),u=this._context.viewLayout.getVerticalOffsetForLineNumber(w)+this._lineHeight}else if(n)c=!0,h=this._context.viewLayout.getVerticalOffsetForLineNumber(n.startLineNumber),u=this._context.viewLayout.getVerticalOffsetForLineNumber(n.endLineNumber)+this._lineHeight;else return-1;const g=(t==="mouse"||i)&&this._cursorSurroundingLinesStyle==="default";let f=0,m=0;if(g)i||(f=this._lineHeight);else{const L=l/this._lineHeight,w=Math.max(this._cursorSurroundingLines,this._stickyScrollEnabled?this._maxNumberStickyLines:0),p=Math.min(L/2,w);f=p*this._lineHeight,m=Math.max(0,p-1)*this._lineHeight}i||(o===de.Simple||o===de.Bottom)&&(m+=this._lineHeight),h-=f,u+=m;let _;if(u-h>l){if(!c)return-1;_=h}else if(o===de.NearTop||o===de.NearTopIfOutsideViewport)if(o===de.NearTopIfOutsideViewport&&r<=h&&u<=d)_=r;else{const L=Math.max(5*this._lineHeight,l*.2),w=h-L,p=u-l;_=Math.max(p,w)}else if(o===de.Center||o===de.CenterIfOutsideViewport)if(o===de.CenterIfOutsideViewport&&r<=h&&u<=d)_=r;else{const L=(h+u)/2;_=Math.max(0,L-l/2)}else _=this._computeMinimumScrolling(r,d,h,u,o===de.Top,o===de.Bottom);return _}_computeScrollLeftToReveal(e){const t=this._context.viewLayout.getCurrentViewport(),i=this._context.configuration.options.get(v.layoutInfo),n=t.left,s=n+t.width-i.verticalScrollbarWidth;let o=Jt.MAX_SAFE_SMALL_INTEGER,r=0;if(e.type==="range"){const d=this._visibleRangesForLineRange(e.lineNumber,e.startColumn,e.endColumn);if(!d)return null;for(const c of d.ranges)o=Math.min(o,Math.round(c.left)),r=Math.max(r,Math.round(c.left+c.width))}else for(const d of e.selections){if(d.startLineNumber!==d.endLineNumber)return null;const c=this._visibleRangesForLineRange(d.startLineNumber,d.startColumn,d.endColumn);if(!c)return null;for(const h of c.ranges)o=Math.min(o,Math.round(h.left)),r=Math.max(r,Math.round(h.left+h.width))}return e.minimalReveal||(o=Math.max(0,o-sc.HORIZONTAL_EXTRA_PX),r+=this._revealHorizontalRightPadding),e.type==="selections"&&r-o>t.width?null:{scrollLeft:this._computeMinimumScrolling(n,s,o,r),maxHorizontalOffset:r}}_computeMinimumScrolling(e,t,i,n,s,o){e=e|0,t=t|0,i=i|0,n=n|0,s=!!s,o=!!o;const r=t-e;if(n-i<r){if(s)return i;if(o)return Math.max(0,n-r);if(i<e)return i;if(n>t)return Math.max(0,n-r)}else return i;return e}}const pv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(pv);class _v extends Wg{constructor(e){super(),this._context=e;const i=this._context.configuration.options.get(v.layoutInfo);this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const i=this._context.configuration.options.get(v.layoutInfo);return this._decorationsLeft=i.decorationsLeft,this._decorationsWidth=i.decorationsWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.options.linesDecorationsClassName,d=r.options.zIndex;l&&(i[n++]=new ql(r.range.startLineNumber,r.range.endLineNumber,l,r.options.linesDecorationsTooltip??null,d));const c=r.options.firstLineDecorationClassName;c&&(i[n++]=new ql(r.range.startLineNumber,r.range.startLineNumber,c,r.options.linesDecorationsTooltip??null,d))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=this._decorationsLeft.toString(),o=this._decorationsWidth.toString(),r='" style="left:'+s+"px;width:"+o+'px;"></div>',l=[];for(let d=t;d<=i;d++){const c=d-t,h=n[c].getDecorations();let u="";for(const g of h){let f='<div class="cldr '+g.className;g.tooltip!==null&&(f+='" title="'+g.tooltip),f+=r,u+=f}l[c]=u}this._renderResult=l}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}const Cv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(Cv);class Ho extends St{static{this.CLASS_NAME="glyph-margin"}static{this.OUTER_CLASS_NAME="margin"}constructor(e){super(e);const t=this._context.configuration.options,i=t.get(v.layoutInfo);this._canUseLayerHinting=!t.get(v.disableLayerHinting),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,this._domNode=fe(document.createElement("div")),this._domNode.setClassName(Ho.OUTER_CLASS_NAME),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._glyphMarginBackgroundDomNode=fe(document.createElement("div")),this._glyphMarginBackgroundDomNode.setClassName(Ho.CLASS_NAME),this._domNode.appendChild(this._glyphMarginBackgroundDomNode)}dispose(){super.dispose()}getDomNode(){return this._domNode}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(v.layoutInfo);return this._canUseLayerHinting=!t.get(v.disableLayerHinting),this._contentLeft=i.contentLeft,this._glyphMarginLeft=i.glyphMarginLeft,this._glyphMarginWidth=i.glyphMarginWidth,!0}onScrollChanged(e){return super.onScrollChanged(e)||e.scrollTopChanged}prepareRender(e){}render(e){this._domNode.setLayerHinting(this._canUseLayerHinting),this._domNode.setContain("strict");const t=e.scrollTop-e.bigNumbersDelta;this._domNode.setTop(-t);const i=Math.min(e.scrollHeight,1e6);this._domNode.setHeight(i),this._domNode.setWidth(this._contentLeft),this._glyphMarginBackgroundDomNode.setLeft(this._glyphMarginLeft),this._glyphMarginBackgroundDomNode.setWidth(this._glyphMarginWidth),this._glyphMarginBackgroundDomNode.setHeight(i)}}const wv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(wv);class Lv extends Wg{constructor(e){super(),this._context=e,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),i=[];let n=0;for(let s=0,o=t.length;s<o;s++){const r=t[s],l=r.options.marginClassName,d=r.options.zIndex;l&&(i[n++]=new ql(r.range.startLineNumber,r.range.endLineNumber,l,null,d))}return i}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=this._render(t,i,this._getDecorations(e)),s=[];for(let o=t;o<=i;o++){const r=o-t,l=n[r].getDecorations();let d="";for(const c of l)d+='<div class="cmdr '+c.className+'" style=""></div>';s[r]=d}this._renderResult=s}render(e,t){return this._renderResult?this._renderResult[t-e]:""}}const vv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Xt{static{this.Empty=new Xt(0,0,0,0)}constructor(e,t,i,n){this._rgba8Brand=void 0,this.r=Xt._clamp(e),this.g=Xt._clamp(t),this.b=Xt._clamp(i),this.a=Xt._clamp(n)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}static _clamp(e){return e<0?0:e>255?255:e|0}}var ne;(function(a){a[a.START_CH_CODE=32]="START_CH_CODE",a[a.END_CH_CODE=126]="END_CH_CODE",a[a.UNKNOWN_CODE=65533]="UNKNOWN_CODE",a[a.CHAR_COUNT=96]="CHAR_COUNT",a[a.SAMPLED_CHAR_HEIGHT=16]="SAMPLED_CHAR_HEIGHT",a[a.SAMPLED_CHAR_WIDTH=10]="SAMPLED_CHAR_WIDTH",a[a.BASE_CHAR_HEIGHT=2]="BASE_CHAR_HEIGHT",a[a.BASE_CHAR_WIDTH=1]="BASE_CHAR_WIDTH",a[a.RGBA_CHANNELS_CNT=4]="RGBA_CHANNELS_CNT",a[a.RGBA_SAMPLED_ROW_WIDTH=3840]="RGBA_SAMPLED_ROW_WIDTH"})(ne||(ne={}));const bv=(()=>{const a=[];for(let e=ne.START_CH_CODE;e<=ne.END_CH_CODE;e++)a.push(e);return a.push(ne.UNKNOWN_CODE),a})(),Sv=(a,e)=>(a-=ne.START_CH_CODE,a<0||a>ne.CHAR_COUNT?e<=2?(a+ne.CHAR_COUNT)%ne.CHAR_COUNT:ne.CHAR_COUNT-1:a);class Ga extends U{static{this._INSTANCE=null}static getInstance(){return this._INSTANCE||(this._INSTANCE=Eo(new Ga)),this._INSTANCE}constructor(){super(),this._onDidChange=new Z,this.onDidChange=this._onDidChange.event,this._updateColorMap(),this._register(Ye.onDidChange(e=>{e.changedColorMap&&this._updateColorMap()}))}_updateColorMap(){const e=Ye.getColorMap();if(!e){this._colors=[Xt.Empty],this._backgroundIsLight=!0;return}this._colors=[Xt.Empty];for(let i=1;i<e.length;i++){const n=e[i].rgba;this._colors[i]=new Xt(n.r,n.g,n.b,Math.round(n.a*255))}const t=e[Ui.DefaultBackground].getRelativeLuminance();this._backgroundIsLight=t>=.5,this._onDidChange.fire(void 0)}getColor(e){return(e<1||e>=this._colors.length)&&(e=Ui.DefaultBackground),this._colors[e]}backgroundIsLight(){return this._backgroundIsLight}}class Bo{constructor(e,t){this.scale=t,this._minimapCharRendererBrand=void 0,this.charDataNormal=Bo.soften(e,12/15),this.charDataLight=Bo.soften(e,50/60)}static soften(e,t){const i=new Uint8ClampedArray(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=Ru(e[n]*t);return i}renderChar(e,t,i,n,s,o,r,l,d,c,h){const u=ne.BASE_CHAR_WIDTH*this.scale,g=ne.BASE_CHAR_HEIGHT*this.scale,f=h?1:g;if(t+u>e.width||i+f>e.height){console.warn("bad render request outside image data");return}const m=c?this.charDataLight:this.charDataNormal,_=Sv(n,d),L=e.width*ne.RGBA_CHANNELS_CNT,w=r.r,p=r.g,C=r.b,b=s.r-w,S=s.g-p,y=s.b-C,E=Math.max(o,l),x=e.data;let R=_*u*g,D=i*L+t*ne.RGBA_CHANNELS_CNT;for(let A=0;A<f;A++){let W=D;for(let H=0;H<u;H++){const G=m[R++]/255*(o/255);x[W++]=w+b*G,x[W++]=p+S*G,x[W++]=C+y*G,x[W++]=E}D+=L}}blockRenderChar(e,t,i,n,s,o,r,l){const d=ne.BASE_CHAR_WIDTH*this.scale,c=ne.BASE_CHAR_HEIGHT*this.scale,h=l?1:c;if(t+d>e.width||i+h>e.height){console.warn("bad render request outside image data");return}const u=e.width*ne.RGBA_CHANNELS_CNT,g=.5*(s/255),f=o.r,m=o.g,_=o.b,L=n.r-f,w=n.g-m,p=n.b-_,C=f+L*g,b=m+w*g,S=_+p*g,y=Math.max(s,r),E=e.data;let x=i*u+t*ne.RGBA_CHANNELS_CNT;for(let R=0;R<h;R++){let D=x;for(let A=0;A<d;A++)E[D++]=C,E[D++]=b,E[D++]=S,E[D++]=y;x+=u}}}const fh={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},mh=a=>{const e=new Uint8ClampedArray(a.length/2);for(let t=0;t<a.length;t+=2)e[t>>1]=fh[a[t]]<<4|fh[a[t+1]]&15;return e},ph={1:Rl(()=>mh("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792")),2:Rl(()=>mh("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126"))};class Co{static create(e,t){if(this.lastCreated&&e===this.lastCreated.scale&&t===this.lastFontFamily)return this.lastCreated;let i;return ph[e]?i=new Bo(ph[e](),e):i=Co.createFromSampleData(Co.createSampleData(t).data,e),this.lastFontFamily=t,this.lastCreated=i,i}static createSampleData(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.style.height=`${ne.SAMPLED_CHAR_HEIGHT}px`,t.height=ne.SAMPLED_CHAR_HEIGHT,t.width=ne.CHAR_COUNT*ne.SAMPLED_CHAR_WIDTH,t.style.width=ne.CHAR_COUNT*ne.SAMPLED_CHAR_WIDTH+"px",i.fillStyle="#ffffff",i.font=`bold ${ne.SAMPLED_CHAR_HEIGHT}px ${e}`,i.textBaseline="middle";let n=0;for(const s of bv)i.fillText(String.fromCharCode(s),n,ne.SAMPLED_CHAR_HEIGHT/2),n+=ne.SAMPLED_CHAR_WIDTH;return i.getImageData(0,0,ne.CHAR_COUNT*ne.SAMPLED_CHAR_WIDTH,ne.SAMPLED_CHAR_HEIGHT)}static createFromSampleData(e,t){const i=ne.SAMPLED_CHAR_HEIGHT*ne.SAMPLED_CHAR_WIDTH*ne.RGBA_CHANNELS_CNT*ne.CHAR_COUNT;if(e.length!==i)throw new Error("Unexpected source in MinimapCharRenderer");const n=Co._downsample(e,t);return new Bo(n,t)}static _downsampleChar(e,t,i,n,s){const o=ne.BASE_CHAR_WIDTH*s,r=ne.BASE_CHAR_HEIGHT*s;let l=n,d=0;for(let c=0;c<r;c++){const h=c/r*ne.SAMPLED_CHAR_HEIGHT,u=(c+1)/r*ne.SAMPLED_CHAR_HEIGHT;for(let g=0;g<o;g++){const f=g/o*ne.SAMPLED_CHAR_WIDTH,m=(g+1)/o*ne.SAMPLED_CHAR_WIDTH;let _=0,L=0;for(let p=h;p<u;p++){const C=t+Math.floor(p)*ne.RGBA_SAMPLED_ROW_WIDTH,b=1-(p-Math.floor(p));for(let S=f;S<m;S++){const y=1-(S-Math.floor(S)),E=C+Math.floor(S)*ne.RGBA_CHANNELS_CNT,x=y*b;L+=x,_+=e[E]*e[E+3]/255*x}}const w=_/L;d=Math.max(d,w),i[l++]=Ru(w)}}return d}static _downsample(e,t){const i=ne.BASE_CHAR_HEIGHT*t*ne.BASE_CHAR_WIDTH*t,n=i*ne.CHAR_COUNT,s=new Uint8ClampedArray(n);let o=0,r=0,l=0;for(let d=0;d<ne.CHAR_COUNT;d++)l=Math.max(l,this._downsampleChar(e,r,s,o,t)),o+=i,r+=ne.SAMPLED_CHAR_WIDTH*ne.RGBA_CHANNELS_CNT;if(l>0){const d=255/l;for(let c=0;c<n;c++)s[c]*=d}return s}}const yv=Ra?'"Segoe WPC", "Segoe UI", sans-serif':Fi?"-apple-system, BlinkMacSystemFont, sans-serif":'system-ui, "Ubuntu", "Droid Sans", sans-serif',xv=async()=>{try{return[...await tr.queryLocalFonts()].map(i=>i.family)}catch(a){return console.error(`Failed to query fonts: ${a}`),[]}},WE=async()=>Wm?(await xv()).map(t=>({body:`${t}`})):[];Ee(vv);const Nv=140,Ev=2;class Rs{constructor(e,t,i){const n=e.options,s=n.get(v.pixelRatio),o=n.get(v.layoutInfo),r=o.minimap,l=n.get(v.fontInfo),d=n.get(v.minimap);this.renderMinimap=r.renderMinimap,this.size=d.size,this.minimapHeightIsEditorHeight=r.minimapHeightIsEditorHeight,this.scrollBeyondLastLine=n.get(v.scrollBeyondLastLine),this.paddingTop=n.get(v.padding).top,this.paddingBottom=n.get(v.padding).bottom,this.showSlider=d.showSlider,this.autohide=d.autohide,this.pixelRatio=s,this.typicalHalfwidthCharacterWidth=l.typicalHalfwidthCharacterWidth,this.lineHeight=n.get(v.lineHeight),this.minimapLeft=r.minimapLeft,this.minimapWidth=r.minimapWidth,this.minimapHeight=o.height,this.canvasInnerWidth=r.minimapCanvasInnerWidth,this.canvasInnerHeight=r.minimapCanvasInnerHeight,this.canvasOuterWidth=r.minimapCanvasOuterWidth,this.canvasOuterHeight=r.minimapCanvasOuterHeight,this.isSampling=r.minimapIsSampling,this.editorHeight=o.height,this.fontScale=r.minimapScale,this.minimapLineHeight=r.minimapLineHeight,this.minimapCharWidth=ne.BASE_CHAR_WIDTH*this.fontScale,this.sectionHeaderFontFamily=yv,this.sectionHeaderFontSize=d.sectionHeaderFontSize*s,this.sectionHeaderLetterSpacing=d.sectionHeaderLetterSpacing,this.sectionHeaderFontColor=Rs._getSectionHeaderColor(t,i.getColor(Ui.DefaultForeground)),this.charRenderer=Rl(()=>Co.create(this.fontScale,l.fontFamily)),this.defaultBackgroundColor=i.getColor(Ui.DefaultBackground),this.backgroundColor=Rs._getMinimapBackground(t,this.defaultBackgroundColor),this.foregroundAlpha=Rs._getMinimapForegroundOpacity(t)}static _getMinimapBackground(e,t){const i=e.getColor(Fm);return i?new Xt(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}static _getMinimapForegroundOpacity(e){const t=e.getColor(Hm);return t?Xt._clamp(Math.round(255*t.rgba.a)):255}static _getSectionHeaderColor(e,t){const i=e.getColor(Bm);return i?new Xt(i.rgba.r,i.rgba.g,i.rgba.b,Math.round(255*i.rgba.a)):t}equals(e){return this.renderMinimap===e.renderMinimap&&this.size===e.size&&this.minimapHeightIsEditorHeight===e.minimapHeightIsEditorHeight&&this.scrollBeyondLastLine===e.scrollBeyondLastLine&&this.paddingTop===e.paddingTop&&this.paddingBottom===e.paddingBottom&&this.showSlider===e.showSlider&&this.autohide===e.autohide&&this.pixelRatio===e.pixelRatio&&this.typicalHalfwidthCharacterWidth===e.typicalHalfwidthCharacterWidth&&this.lineHeight===e.lineHeight&&this.minimapLeft===e.minimapLeft&&this.minimapWidth===e.minimapWidth&&this.minimapHeight===e.minimapHeight&&this.canvasInnerWidth===e.canvasInnerWidth&&this.canvasInnerHeight===e.canvasInnerHeight&&this.canvasOuterWidth===e.canvasOuterWidth&&this.canvasOuterHeight===e.canvasOuterHeight&&this.isSampling===e.isSampling&&this.editorHeight===e.editorHeight&&this.fontScale===e.fontScale&&this.minimapLineHeight===e.minimapLineHeight&&this.minimapCharWidth===e.minimapCharWidth&&this.sectionHeaderFontSize===e.sectionHeaderFontSize&&this.sectionHeaderLetterSpacing===e.sectionHeaderLetterSpacing&&this.defaultBackgroundColor&&this.defaultBackgroundColor.equals(e.defaultBackgroundColor)&&this.backgroundColor&&this.backgroundColor.equals(e.backgroundColor)&&this.foregroundAlpha===e.foregroundAlpha}}class wo{constructor(e,t,i,n,s,o,r,l,d){this.scrollTop=e,this.scrollHeight=t,this.sliderNeeded=i,this._computedSliderRatio=n,this.sliderTop=s,this.sliderHeight=o,this.topPaddingLineCount=r,this.startLineNumber=l,this.endLineNumber=d}getDesiredScrollTopFromDelta(e){return Math.round(this.scrollTop+e/this._computedSliderRatio)}getDesiredScrollTopFromTouchLocation(e){return Math.round((e-this.sliderHeight/2)/this._computedSliderRatio)}intersectWithViewport(e){const t=Math.max(this.startLineNumber,e.startLineNumber),i=Math.min(this.endLineNumber,e.endLineNumber);return t>i?null:[t,i]}getYForLineNumber(e,t){return+(e-this.startLineNumber+this.topPaddingLineCount)*t}static create(e,t,i,n,s,o,r,l,d,c,h){const u=e.pixelRatio,g=e.minimapLineHeight,f=Math.floor(e.canvasInnerHeight/g),m=e.lineHeight;if(e.minimapHeightIsEditorHeight){let S=l*e.lineHeight+e.paddingTop+e.paddingBottom;e.scrollBeyondLastLine&&(S+=Math.max(0,s-e.lineHeight-e.paddingBottom));const y=Math.max(1,Math.floor(s*s/S)),E=Math.max(0,e.minimapHeight-y),x=E/(c-s),R=d*x,D=E>0,A=Math.floor(e.canvasInnerHeight/e.minimapLineHeight),W=Math.floor(e.paddingTop/e.lineHeight);return new wo(d,c,D,x,R,y,W,1,Math.min(r,A))}let _;if(o&&i!==r){const S=i-t+1;_=Math.floor(S*g/u)}else{const S=s/m;_=Math.floor(S*g/u)}const L=Math.floor(e.paddingTop/m);let w=Math.floor(e.paddingBottom/m);if(e.scrollBeyondLastLine){const S=s/m;w=Math.max(w,S-1)}let p;if(w>0){const S=s/m;p=(L+r+w-S-1)*g/u}else p=Math.max(0,(L+r)*g/u-_);p=Math.min(e.minimapHeight-_,p);const C=p/(c-s),b=d*C;if(f>=L+r+w){const S=p>0;return new wo(d,c,S,C,b,_,L,1,r)}else{let S;t>1?S=t+L:S=Math.max(1,d/m);let y,E=Math.max(1,Math.floor(S-b*u/g));E<L?(y=L-E+1,E=1):(y=0,E=Math.max(1,E-L)),h&&h.scrollHeight===c&&(h.scrollTop>d&&(E=Math.min(E,h.startLineNumber),y=Math.max(y,h.topPaddingLineCount)),h.scrollTop<d&&(E=Math.max(E,h.startLineNumber),y=Math.min(y,h.topPaddingLineCount)));const x=Math.min(r,E-y+f-1),R=(d-n)/m;let D;return d>=e.paddingTop?D=(t-E+y+R)*g/u:D=d/e.paddingTop*(y+R)*g/u,new wo(d,c,!0,C,D,_,y,E,x)}}}class ja{static{this.INVALID=new ja(-1)}constructor(e){this.dy=e}onContentChanged(){this.dy=-1}onTokensChanged(){this.dy=-1}}class _h{constructor(e,t,i){this.renderedLayout=e,this._imageData=t,this._renderedLines=new Ag({createLine:()=>ja.INVALID}),this._renderedLines._set(e.startLineNumber,i)}linesEquals(e){if(!this.scrollEquals(e))return!1;const i=this._renderedLines._get().lines;for(let n=0,s=i.length;n<s;n++)if(i[n].dy===-1)return!1;return!0}scrollEquals(e){return this.renderedLayout.startLineNumber===e.startLineNumber&&this.renderedLayout.endLineNumber===e.endLineNumber}_get(){const e=this._renderedLines._get();return{imageData:this._imageData,rendLineNumberStart:e.rendLineNumberStart,lines:e.lines}}onLinesChanged(e,t){return this._renderedLines.onLinesChanged(e,t)}onLinesDeleted(e,t){this._renderedLines.onLinesDeleted(e,t)}onLinesInserted(e,t){this._renderedLines.onLinesInserted(e,t)}onTokensChanged(e){return this._renderedLines.onTokensChanged(e)}}class oc{constructor(e,t,i,n){this._backgroundFillData=oc._createBackgroundFillData(t,i,n),this._buffers=[e.createImageData(t,i),e.createImageData(t,i)],this._lastUsedBuffer=0}getBuffer(){this._lastUsedBuffer=1-this._lastUsedBuffer;const e=this._buffers[this._lastUsedBuffer];return e.data.set(this._backgroundFillData),e}static _createBackgroundFillData(e,t,i){const n=i.r,s=i.g,o=i.b,r=i.a,l=new Uint8ClampedArray(e*t*4);let d=0;for(let c=0;c<t;c++)for(let h=0;h<e;h++)l[d]=n,l[d+1]=s,l[d+2]=o,l[d+3]=r,d+=4;return l}}class zo{static compute(e,t,i){if(e.renderMinimap===co.None||!e.isSampling)return[null,[]];const{minimapLineCount:n}=zm.computeContainedMinimapLineCount({viewLineCount:t,scrollBeyondLastLine:e.scrollBeyondLastLine,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,height:e.editorHeight,lineHeight:e.lineHeight,pixelRatio:e.pixelRatio}),s=t/n,o=s/2;if(!i||i.minimapLines.length===0){const _=[];if(_[0]=1,n>1){for(let L=0,w=n-1;L<w;L++)_[L]=Math.round(L*s+o);_[n-1]=t}return[new zo(s,_),[]]}const r=i.minimapLines,l=r.length,d=[];let c=0,h=0,u=1;const g=10;let f=[],m=null;for(let _=0;_<n;_++){const L=Math.max(u,Math.round(_*s)),w=Math.max(L,Math.round((_+1)*s));for(;c<l&&r[c]<L;){if(f.length<g){const C=c+1+h;m&&m.type==="deleted"&&m._oldIndex===c-1?m.deleteToLineNumber++:(m={type:"deleted",_oldIndex:c,deleteFromLineNumber:C,deleteToLineNumber:C},f.push(m)),h--}c++}let p;if(c<l&&r[c]<=w)p=r[c],c++;else if(_===0?p=1:_+1===n?p=t:p=Math.round(_*s+o),f.length<g){const C=c+1+h;m&&m.type==="inserted"&&m._i===_-1?m.insertToLineNumber++:(m={type:"inserted",_i:_,insertFromLineNumber:C,insertToLineNumber:C},f.push(m)),h++}d[_]=p,u=p}if(f.length<g)for(;c<l;){const _=c+1+h;m&&m.type==="deleted"&&m._oldIndex===c-1?m.deleteToLineNumber++:(m={type:"deleted",_oldIndex:c,deleteFromLineNumber:_,deleteToLineNumber:_},f.push(m)),h--,c++}else f=[{type:"flush"}];return[new zo(s,d),f]}constructor(e,t){this.samplingRatio=e,this.minimapLines=t}modelLineToMinimapLine(e){return Math.min(this.minimapLines.length,Math.max(1,Math.round(e/this.samplingRatio)))}modelLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e)-1;for(;i>0&&this.minimapLines[i-1]>=e;)i--;let n=this.modelLineToMinimapLine(t)-1;for(;n+1<this.minimapLines.length&&this.minimapLines[n+1]<=t;)n++;if(i===n){const s=this.minimapLines[i];if(s<e||s>t)return null}return[i+1,n+1]}decorationLineRangeToMinimapLineRange(e,t){let i=this.modelLineToMinimapLine(e),n=this.modelLineToMinimapLine(t);return e!==t&&n===i&&(n===this.minimapLines.length?i>1&&i--:n++),[i,n]}onLinesDeleted(e){const t=e.toLineNumber-e.fromLineNumber+1;let i=this.minimapLines.length,n=0;for(let s=this.minimapLines.length-1;s>=0&&!(this.minimapLines[s]<e.fromLineNumber);s--)this.minimapLines[s]<=e.toLineNumber?(this.minimapLines[s]=Math.max(1,e.fromLineNumber-1),i=Math.min(i,s),n=Math.max(n,s)):this.minimapLines[s]-=t;return[i,n]}onLinesInserted(e){const t=e.toLineNumber-e.fromLineNumber+1;for(let i=this.minimapLines.length-1;i>=0&&!(this.minimapLines[i]<e.fromLineNumber);i--)this.minimapLines[i]+=t}}class Iv extends St{constructor(e){super(e),this._sectionHeaderCache=new Vm(10,1.5),this.tokensColorTracker=Ga.getInstance(),this._selections=[],this._minimapSelections=null,this.options=new Rs(this._context.configuration,this._context.theme,this.tokensColorTracker);const[t]=zo.compute(this.options,this._context.viewModel.getLineCount(),null);this._samplingState=t,this._shouldCheckSampling=!1,this._actual=new ws(e.theme,this)}dispose(){this._actual.dispose(),super.dispose()}getDomNode(){return this._actual.getDomNode()}_onOptionsMaybeChanged(){const e=new Rs(this._context.configuration,this._context.theme,this.tokensColorTracker);return this.options.equals(e)?!1:(this.options=e,this._recreateLineSampling(),this._actual.onDidChangeOptions(),!0)}onConfigurationChanged(e){return this._onOptionsMaybeChanged()}onCursorStateChanged(e){return this._selections=e.selections,this._minimapSelections=null,this._actual.onSelectionChanged()}onDecorationsChanged(e){return e.affectsMinimap?this._actual.onDecorationsChanged():!1}onFlushed(e){return this._samplingState&&(this._shouldCheckSampling=!0),this._actual.onFlushed()}onLinesChanged(e){if(this._samplingState){const t=this._samplingState.modelLineRangeToMinimapLineRange(e.fromLineNumber,e.fromLineNumber+e.count-1);return t?this._actual.onLinesChanged(t[0],t[1]-t[0]+1):!1}else return this._actual.onLinesChanged(e.fromLineNumber,e.count)}onLinesDeleted(e){if(this._samplingState){const[t,i]=this._samplingState.onLinesDeleted(e);return t<=i&&this._actual.onLinesChanged(t+1,i-t+1),this._shouldCheckSampling=!0,!0}else return this._actual.onLinesDeleted(e.fromLineNumber,e.toLineNumber)}onLinesInserted(e){return this._samplingState?(this._samplingState.onLinesInserted(e),this._shouldCheckSampling=!0,!0):this._actual.onLinesInserted(e.fromLineNumber,e.toLineNumber)}onScrollChanged(e){return this._actual.onScrollChanged()}onThemeChanged(e){return this._actual.onThemeChanged(),this._onOptionsMaybeChanged(),!0}onTokensChanged(e){if(this._samplingState){const t=[];for(const i of e.ranges){const n=this._samplingState.modelLineRangeToMinimapLineRange(i.fromLineNumber,i.toLineNumber);n&&t.push({fromLineNumber:n[0],toLineNumber:n[1]})}return t.length?this._actual.onTokensChanged(t):!1}else return this._actual.onTokensChanged(e.ranges)}onTokensColorsChanged(e){return this._onOptionsMaybeChanged(),this._actual.onTokensColorsChanged()}onZonesChanged(e){return this._actual.onZonesChanged()}prepareRender(e){this._shouldCheckSampling&&(this._shouldCheckSampling=!1,this._recreateLineSampling())}render(e){let t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber;this._samplingState&&(t=this._samplingState.modelLineToMinimapLine(t),i=this._samplingState.modelLineToMinimapLine(i));const n={viewportContainsWhitespaceGaps:e.viewportData.whitespaceViewportData.length>0,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,viewportStartLineNumber:t,viewportEndLineNumber:i,viewportStartLineNumberVerticalOffset:e.getVerticalOffsetForLineNumber(t),scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight};this._actual.render(n)}_recreateLineSampling(){this._minimapSelections=null;const e=!!this._samplingState,[t,i]=zo.compute(this.options,this._context.viewModel.getLineCount(),this._samplingState);if(this._samplingState=t,e&&this._samplingState)for(const n of i)switch(n.type){case"deleted":this._actual.onLinesDeleted(n.deleteFromLineNumber,n.deleteToLineNumber);break;case"inserted":this._actual.onLinesInserted(n.insertFromLineNumber,n.insertToLineNumber);break;case"flush":this._actual.onFlushed();break}}getLineCount(){return this._samplingState?this._samplingState.minimapLines.length:this._context.viewModel.getLineCount()}getRealLineCount(){return this._context.viewModel.getLineCount()}getLineContent(e){return this._samplingState?this._context.viewModel.getLineContent(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineContent(e)}getLineMaxColumn(e){return this._samplingState?this._context.viewModel.getLineMaxColumn(this._samplingState.minimapLines[e-1]):this._context.viewModel.getLineMaxColumn(e)}getMinimapLinesRenderingData(e,t,i){if(this._samplingState){const n=[];for(let s=0,o=t-e+1;s<o;s++)i[s]?n[s]=this._context.viewModel.getViewLineData(this._samplingState.minimapLines[e+s-1]):n[s]=null;return n}return this._context.viewModel.getMinimapLinesRenderingData(e,t,i).data}getSelections(){if(this._minimapSelections===null)if(this._samplingState){this._minimapSelections=[];for(const e of this._selections){const[t,i]=this._samplingState.decorationLineRangeToMinimapLineRange(e.startLineNumber,e.endLineNumber);this._minimapSelections.push(new le(t,e.startColumn,i,e.endColumn))}}else this._minimapSelections=this._selections;return this._minimapSelections}getMinimapDecorationsInViewport(e,t){return this._getMinimapDecorationsInViewport(e,t).filter(i=>!i.options.minimap?.sectionHeaderStyle)}getSectionHeaderDecorationsInViewport(e,t){const i=this.options.sectionHeaderFontSize/this.options.minimapLineHeight;return e=Math.floor(Math.max(1,e-i)),this._getMinimapDecorationsInViewport(e,t).filter(n=>!!n.options.minimap?.sectionHeaderStyle)}_getMinimapDecorationsInViewport(e,t){let i;if(this._samplingState){const s=this._samplingState.minimapLines[e-1],o=this._samplingState.minimapLines[t-1];i=new N(s,1,o,this._context.viewModel.getLineMaxColumn(o))}else i=new N(e,1,t,this._context.viewModel.getLineMaxColumn(t));const n=this._context.viewModel.getMinimapDecorationsInRange(i);if(this._samplingState){const s=[];for(const o of n){if(!o.options.minimap)continue;const r=o.range,l=this._samplingState.modelLineToMinimapLine(r.startLineNumber),d=this._samplingState.modelLineToMinimapLine(r.endLineNumber);s.push(new Cg(new N(l,r.startColumn,d,r.endColumn),o.options))}return s}return n}getSectionHeaderText(e,t){const i=e.options.minimap?.sectionHeaderText;if(!i)return null;const n=this._sectionHeaderCache.get(i);if(n)return n;const s=t(i);return this._sectionHeaderCache.set(i,s),s}getOptions(){return this._context.viewModel.model.getOptions()}revealLineNumber(e){this._samplingState&&(e=this._samplingState.minimapLines[e-1]),this._context.viewModel.revealRange("mouse",!1,new N(e,1,e,1),de.Center,K.Smooth)}setScrollTop(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e},K.Immediate)}}class ws extends U{constructor(e,t){super(),this._renderDecorations=!1,this._gestureInProgress=!1,this._theme=e,this._model=t,this._lastRenderData=null,this._buffers=null,this._selectionColor=this._theme.getColor(Dc),this._domNode=fe(document.createElement("div")),Li.write(this._domNode,xe.Minimap),this._domNode.setClassName(this._getMinimapDomNodeClassName()),this._domNode.setPosition("absolute"),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._shadow=fe(document.createElement("div")),this._shadow.setClassName("minimap-shadow-hidden"),this._domNode.appendChild(this._shadow),this._canvas=fe(document.createElement("canvas")),this._canvas.setPosition("absolute"),this._canvas.setLeft(0),this._domNode.appendChild(this._canvas),this._decorationsCanvas=fe(document.createElement("canvas")),this._decorationsCanvas.setPosition("absolute"),this._decorationsCanvas.setClassName("minimap-decorations-layer"),this._decorationsCanvas.setLeft(0),this._domNode.appendChild(this._decorationsCanvas),this._slider=fe(document.createElement("div")),this._slider.setPosition("absolute"),this._slider.setClassName("minimap-slider"),this._slider.setLayerHinting(!0),this._slider.setContain("strict"),this._domNode.appendChild(this._slider),this._sliderHorizontal=fe(document.createElement("div")),this._sliderHorizontal.setPosition("absolute"),this._sliderHorizontal.setClassName("minimap-slider-horizontal"),this._slider.appendChild(this._sliderHorizontal),this._applyLayout(),this._pointerDownListener=zn(this._domNode.domNode,mt.POINTER_DOWN,i=>{if(i.preventDefault(),this._model.options.renderMinimap===co.None||!this._lastRenderData)return;if(this._model.options.size!=="proportional"){if(i.button===0&&this._lastRenderData){const d=Xn(this._slider.domNode),c=d.top+d.height/2;this._startSliderDragging(i,c,this._lastRenderData.renderedLayout)}return}const s=this._model.options.minimapLineHeight,o=this._model.options.canvasInnerHeight/this._model.options.canvasOuterHeight*i.offsetY;let l=Math.floor(o/s)+this._lastRenderData.renderedLayout.startLineNumber-this._lastRenderData.renderedLayout.topPaddingLineCount;l=Math.min(l,this._model.getLineCount()),this._model.revealLineNumber(l)}),this._sliderPointerMoveMonitor=new yu,this._sliderPointerDownListener=zn(this._slider.domNode,mt.POINTER_DOWN,i=>{i.preventDefault(),i.stopPropagation(),i.button===0&&this._lastRenderData&&this._startSliderDragging(i,i.pageY,this._lastRenderData.renderedLayout)}),this._gestureDisposable=Od.addTarget(this._domNode.domNode),this._sliderTouchStartListener=Y(this._domNode.domNode,Hi.Start,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&(this._slider.toggleClassName("active",!0),this._gestureInProgress=!0,this.scrollDueToTouchEvent(i))},{passive:!1}),this._sliderTouchMoveListener=Y(this._domNode.domNode,Hi.Change,i=>{i.preventDefault(),i.stopPropagation(),this._lastRenderData&&this._gestureInProgress&&this.scrollDueToTouchEvent(i)},{passive:!1}),this._sliderTouchEndListener=zn(this._domNode.domNode,Hi.End,i=>{i.preventDefault(),i.stopPropagation(),this._gestureInProgress=!1,this._slider.toggleClassName("active",!1)})}_startSliderDragging(e,t,i){if(!e.target||!(e.target instanceof Element))return;const n=e.pageX;this._slider.toggleClassName("active",!0);const s=(o,r)=>{const l=Xn(this._domNode.domNode),d=Math.min(Math.abs(r-n),Math.abs(r-l.left),Math.abs(r-l.left-l.width));if(Ra&&d>Nv){this._model.setScrollTop(i.scrollTop);return}const c=o-t;this._model.setScrollTop(i.getDesiredScrollTopFromDelta(c))};e.pageY!==t&&s(e.pageY,n),this._sliderPointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,o=>s(o.pageY,o.pageX),()=>{this._slider.toggleClassName("active",!1)})}scrollDueToTouchEvent(e){const t=this._domNode.domNode.getBoundingClientRect().top,i=this._lastRenderData.renderedLayout.getDesiredScrollTopFromTouchLocation(e.pageY-t);this._model.setScrollTop(i)}dispose(){this._pointerDownListener.dispose(),this._sliderPointerMoveMonitor.dispose(),this._sliderPointerDownListener.dispose(),this._gestureDisposable.dispose(),this._sliderTouchStartListener.dispose(),this._sliderTouchMoveListener.dispose(),this._sliderTouchEndListener.dispose(),super.dispose()}_getMinimapDomNodeClassName(){const e=["minimap"];return this._model.options.showSlider==="always"?e.push("slider-always"):e.push("slider-mouseover"),this._model.options.autohide&&e.push("autohide"),e.join(" ")}getDomNode(){return this._domNode}_applyLayout(){this._domNode.setLeft(this._model.options.minimapLeft),this._domNode.setWidth(this._model.options.minimapWidth),this._domNode.setHeight(this._model.options.minimapHeight),this._shadow.setHeight(this._model.options.minimapHeight),this._canvas.setWidth(this._model.options.canvasOuterWidth),this._canvas.setHeight(this._model.options.canvasOuterHeight),this._canvas.domNode.width=this._model.options.canvasInnerWidth,this._canvas.domNode.height=this._model.options.canvasInnerHeight,this._decorationsCanvas.setWidth(this._model.options.canvasOuterWidth),this._decorationsCanvas.setHeight(this._model.options.canvasOuterHeight),this._decorationsCanvas.domNode.width=this._model.options.canvasInnerWidth,this._decorationsCanvas.domNode.height=this._model.options.canvasInnerHeight,this._slider.setWidth(this._model.options.minimapWidth)}_getBuffer(){return this._buffers||this._model.options.canvasInnerWidth>0&&this._model.options.canvasInnerHeight>0&&(this._buffers=new oc(this._canvas.domNode.getContext("2d"),this._model.options.canvasInnerWidth,this._model.options.canvasInnerHeight,this._model.options.backgroundColor)),this._buffers?this._buffers.getBuffer():null}onDidChangeOptions(){this._lastRenderData=null,this._buffers=null,this._applyLayout(),this._domNode.setClassName(this._getMinimapDomNodeClassName())}onSelectionChanged(){return this._renderDecorations=!0,!0}onDecorationsChanged(){return this._renderDecorations=!0,!0}onFlushed(){return this._lastRenderData=null,!0}onLinesChanged(e,t){return this._lastRenderData?this._lastRenderData.onLinesChanged(e,t):!1}onLinesDeleted(e,t){return this._lastRenderData?.onLinesDeleted(e,t),!0}onLinesInserted(e,t){return this._lastRenderData?.onLinesInserted(e,t),!0}onScrollChanged(){return this._renderDecorations=!0,!0}onThemeChanged(){return this._selectionColor=this._theme.getColor(Dc),this._renderDecorations=!0,!0}onTokensChanged(e){return this._lastRenderData?this._lastRenderData.onTokensChanged(e):!1}onTokensColorsChanged(){return this._lastRenderData=null,this._buffers=null,!0}onZonesChanged(){return this._lastRenderData=null,!0}render(e){if(this._model.options.renderMinimap===co.None){this._shadow.setClassName("minimap-shadow-hidden"),this._sliderHorizontal.setWidth(0),this._sliderHorizontal.setHeight(0);return}e.scrollLeft+e.viewportWidth>=e.scrollWidth?this._shadow.setClassName("minimap-shadow-hidden"):this._shadow.setClassName("minimap-shadow-visible");const i=wo.create(this._model.options,e.viewportStartLineNumber,e.viewportEndLineNumber,e.viewportStartLineNumberVerticalOffset,e.viewportHeight,e.viewportContainsWhitespaceGaps,this._model.getLineCount(),this._model.getRealLineCount(),e.scrollTop,e.scrollHeight,this._lastRenderData?this._lastRenderData.renderedLayout:null);this._slider.setDisplay(i.sliderNeeded?"block":"none"),this._slider.setTop(i.sliderTop),this._slider.setHeight(i.sliderHeight),this._sliderHorizontal.setLeft(0),this._sliderHorizontal.setWidth(this._model.options.minimapWidth),this._sliderHorizontal.setTop(0),this._sliderHorizontal.setHeight(i.sliderHeight),this.renderDecorations(i),this._lastRenderData=this.renderLines(i)}renderDecorations(e){if(this._renderDecorations){this._renderDecorations=!1;const t=this._model.getSelections();t.sort(N.compareRangesUsingStarts);const i=this._model.getMinimapDecorationsInViewport(e.startLineNumber,e.endLineNumber);i.sort((u,g)=>(u.options.zIndex||0)-(g.options.zIndex||0));const{canvasInnerWidth:n,canvasInnerHeight:s}=this._model.options,o=this._model.options.minimapLineHeight,r=this._model.options.minimapCharWidth,l=this._model.getOptions().tabSize,d=this._decorationsCanvas.domNode.getContext("2d");d.clearRect(0,0,n,s);const c=new Ch(e.startLineNumber,e.endLineNumber,!1);this._renderSelectionLineHighlights(d,t,c,e,o),this._renderDecorationsLineHighlights(d,i,c,e,o);const h=new Ch(e.startLineNumber,e.endLineNumber,null);this._renderSelectionsHighlights(d,t,h,e,o,l,r,n),this._renderDecorationsHighlights(d,i,h,e,o,l,r,n),this._renderSectionHeaders(e)}}_renderSelectionLineHighlights(e,t,i,n,s){if(!this._selectionColor||this._selectionColor.isTransparent())return;e.fillStyle=this._selectionColor.transparent(.5).toString();let o=0,r=0;for(const l of t){const d=n.intersectWithViewport(l);if(!d)continue;const[c,h]=d;for(let f=c;f<=h;f++)i.set(f,!0);const u=n.getYForLineNumber(c,s),g=n.getYForLineNumber(h,s);r>=u||(r>o&&e.fillRect(Ti,o,e.canvas.width,r-o),o=u),r=g}r>o&&e.fillRect(Ti,o,e.canvas.width,r-o)}_renderDecorationsLineHighlights(e,t,i,n,s){const o=new Map;for(let r=t.length-1;r>=0;r--){const l=t[r],d=l.options.minimap;if(!d||d.position!==Rr.Inline)continue;const c=n.intersectWithViewport(l.range);if(!c)continue;const[h,u]=c,g=d.getColor(this._theme.value);if(!g||g.isTransparent())continue;let f=o.get(g.toString());f||(f=g.transparent(.5).toString(),o.set(g.toString(),f)),e.fillStyle=f;for(let m=h;m<=u;m++){if(i.has(m))continue;i.set(m,!0);const _=n.getYForLineNumber(h,s);e.fillRect(Ti,_,e.canvas.width,s)}}}_renderSelectionsHighlights(e,t,i,n,s,o,r,l){if(!(!this._selectionColor||this._selectionColor.isTransparent()))for(const d of t){const c=n.intersectWithViewport(d);if(!c)continue;const[h,u]=c;for(let g=h;g<=u;g++)this.renderDecorationOnLine(e,i,d,this._selectionColor,n,g,s,s,o,r,l)}}_renderDecorationsHighlights(e,t,i,n,s,o,r,l){for(const d of t){const c=d.options.minimap;if(!c)continue;const h=n.intersectWithViewport(d.range);if(!h)continue;const[u,g]=h,f=c.getColor(this._theme.value);if(!(!f||f.isTransparent()))for(let m=u;m<=g;m++)switch(c.position){case Rr.Inline:this.renderDecorationOnLine(e,i,d.range,f,n,m,s,s,o,r,l);continue;case Rr.Gutter:{const _=n.getYForLineNumber(m,s);this.renderDecoration(e,f,2,_,Ev,s);continue}}}}renderDecorationOnLine(e,t,i,n,s,o,r,l,d,c,h){const u=s.getYForLineNumber(o,l);if(u+r<0||u>this._model.options.canvasInnerHeight)return;const{startLineNumber:g,endLineNumber:f}=i,m=g===o?i.startColumn:1,_=f===o?i.endColumn:this._model.getLineMaxColumn(o),L=this.getXOffsetForPosition(t,o,m,d,c,h),w=this.getXOffsetForPosition(t,o,_,d,c,h);this.renderDecoration(e,n,L,u,w-L,r)}getXOffsetForPosition(e,t,i,n,s,o){if(i===1)return Ti;if((i-1)*s>=o)return o;let l=e.get(t);if(!l){const d=this._model.getLineContent(t);l=[Ti];let c=Ti;for(let h=1;h<d.length+1;h++){const u=d.charCodeAt(h-1),g=u===V.Tab?n*s:Yn(u)?2*s:s,f=c+g;if(f>=o){l[h]=o;break}l[h]=f,c=f}e.set(t,l)}return i-1<l.length?l[i-1]:o}renderDecoration(e,t,i,n,s,o){e.fillStyle=t&&t.toString()||"",e.fillRect(i,n,s,o)}_renderSectionHeaders(e){const t=this._model.options.minimapLineHeight,i=this._model.options.sectionHeaderFontSize,n=this._model.options.sectionHeaderLetterSpacing,s=i*1.5,{canvasInnerWidth:o}=this._model.options,r=this._model.options.backgroundColor,l=`rgb(${r.r} ${r.g} ${r.b} / .7)`,d=this._model.options.sectionHeaderFontColor,c=`rgb(${d.r} ${d.g} ${d.b})`,h=c,u=this._decorationsCanvas.domNode.getContext("2d");u.letterSpacing=n+"px",u.font="500 "+i+"px "+this._model.options.sectionHeaderFontFamily,u.strokeStyle=h,u.lineWidth=.2;const g=this._model.getSectionHeaderDecorationsInViewport(e.startLineNumber,e.endLineNumber);g.sort((m,_)=>m.range.startLineNumber-_.range.startLineNumber);const f=ws._fitSectionHeader.bind(null,u,o-Ti);for(const m of g){const _=e.getYForLineNumber(m.range.startLineNumber,t)+i,L=_-i,w=L+2,p=this._model.getSectionHeaderText(m,f);ws._renderSectionLabel(u,p,m.options.minimap?.sectionHeaderStyle===Um.Underlined,l,c,o,L,s,_,w)}}static _fitSectionHeader(e,t,i){if(!i)return i;const n="…",s=e.measureText(i).width,o=e.measureText(n).width;if(s<=t||s<=o)return i;const r=i.length,l=s/i.length,d=Math.floor((t-o)/l)-1;let c=Math.ceil(d/2);for(;c>0&&/\s/.test(i[c-1]);)--c;return i.substring(0,c)+n+i.substring(r-(d-c))}static _renderSectionLabel(e,t,i,n,s,o,r,l,d,c){t&&(e.fillStyle=n,e.fillRect(0,r,o,l),e.fillStyle=s,e.fillText(t,Ti,d)),i&&(e.beginPath(),e.moveTo(0,c),e.lineTo(o,c),e.closePath(),e.stroke())}renderLines(e){const t=e.startLineNumber,i=e.endLineNumber,n=this._model.options.minimapLineHeight;if(this._lastRenderData&&this._lastRenderData.linesEquals(e)){const G=this._lastRenderData._get();return new _h(e,G.imageData,G.lines)}const s=this._getBuffer();if(!s)return null;const[o,r,l]=ws._renderUntouchedLines(s,e.topPaddingLineCount,t,i,n,this._lastRenderData),d=this._model.getMinimapLinesRenderingData(t,i,l),c=this._model.getOptions().tabSize,h=this._model.options.defaultBackgroundColor,u=this._model.options.backgroundColor,g=this._model.options.foregroundAlpha,f=this._model.tokensColorTracker,m=f.backgroundIsLight(),_=this._model.options.renderMinimap,L=this._model.options.charRenderer(),w=this._model.options.fontScale,p=this._model.options.minimapCharWidth,b=(_===co.Text?ne.BASE_CHAR_HEIGHT:ne.BASE_CHAR_HEIGHT+1)*w,S=n>b?Math.floor((n-b)/2):0,y=u.a/255,E=new Xt(Math.round((u.r-h.r)*y+h.r),Math.round((u.g-h.g)*y+h.g),Math.round((u.b-h.b)*y+h.b),255);let x=e.topPaddingLineCount*n;const R=[];for(let G=0,oe=i-t+1;G<oe;G++)l[G]&&ws._renderLine(s,E,u.a,m,_,p,f,g,L,x,S,c,d[G],w,n),R[G]=new ja(x),x+=n;const D=o===-1?0:o,W=(r===-1?s.height:r)-D;return this._canvas.domNode.getContext("2d").putImageData(s,0,0,0,D,s.width,W),new _h(e,s,R)}static _renderUntouchedLines(e,t,i,n,s,o){const r=[];if(!o){for(let x=0,R=n-i+1;x<R;x++)r[x]=!0;return[-1,-1,r]}const l=o._get(),d=l.imageData.data,c=l.rendLineNumberStart,h=l.lines,u=h.length,g=e.width,f=e.data,m=(n-i+1)*s*g*4;let _=-1,L=-1,w=-1,p=-1,C=-1,b=-1,S=t*s;for(let x=i;x<=n;x++){const R=x-i,D=x-c,A=D>=0&&D<u?h[D].dy:-1;if(A===-1){r[R]=!0,S+=s;continue}const W=A*g*4,H=(A+s)*g*4,G=S*g*4,oe=(S+s)*g*4;p===W&&b===G?(p=H,b=oe):(w!==-1&&(f.set(d.subarray(w,p),C),_===-1&&w===0&&w===C&&(_=p),L===-1&&p===m&&w===C&&(L=w)),w=W,p=H,C=G,b=oe),r[R]=!1,S+=s}w!==-1&&(f.set(d.subarray(w,p),C),_===-1&&w===0&&w===C&&(_=p),L===-1&&p===m&&w===C&&(L=w));const y=_===-1?-1:_/(g*4),E=L===-1?-1:L/(g*4);return[y,E,r]}static _renderLine(e,t,i,n,s,o,r,l,d,c,h,u,g,f,m){const _=g.content,L=g.tokens,w=e.width-o,p=m===1;let C=Ti,b=0,S=0;for(let y=0,E=L.getCount();y<E;y++){const x=L.getEndOffset(y),R=L.getForeground(y),D=r.getColor(R);for(;b<x;b++){if(C>w)return;const A=_.charCodeAt(b);if(A===V.Tab){const W=u-(b+S)%u;S+=W-1,C+=W*o}else if(A===V.Space)C+=o;else{const W=Yn(A)?2:1;for(let H=0;H<W;H++)if(s===co.Blocks?d.blockRenderChar(e,C,c+h,D,l,t,i,p):d.renderChar(e,C,c+h,A,D,l,t,i,f,n,p),C+=o,C>w)return}}}}}class Ch{constructor(e,t,i){this._startLineNumber=e,this._endLineNumber=t,this._defaultValue=i,this._values=[];for(let n=0,s=this._endLineNumber-this._startLineNumber+1;n<s;n++)this._values[n]=i}has(e){return this.get(e)!==this._defaultValue}set(e,t){e<this._startLineNumber||e>this._endLineNumber||(this._values[e-this._startLineNumber]=t)}get(e){return e<this._startLineNumber||e>this._endLineNumber?this._defaultValue:this._values[e-this._startLineNumber]}}const Rv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(Rv);class Dv extends St{constructor(e,t){super(e),this._viewDomNode=t;const n=this._context.configuration.options.get(v.layoutInfo);this._widgets={},this._verticalScrollbarWidth=n.verticalScrollbarWidth,this._minimapWidth=n.minimap.minimapWidth,this._horizontalScrollbarHeight=n.horizontalScrollbarHeight,this._editorHeight=n.height,this._editorWidth=n.width,this._viewDomNodeRect={top:0,left:0,width:0,height:0},this._domNode=fe(document.createElement("div")),Li.write(this._domNode,xe.OverlayWidgets),this._domNode.setClassName("overlayWidgets"),this.overflowingOverlayWidgetsDomNode=fe(document.createElement("div")),Li.write(this.overflowingOverlayWidgetsDomNode,xe.OverflowingOverlayWidgets),this.overflowingOverlayWidgetsDomNode.setClassName("overflowingOverlayWidgets")}dispose(){super.dispose(),this._widgets={}}getDomNode(){return this._domNode}onConfigurationChanged(e){const i=this._context.configuration.options.get(v.layoutInfo);return this._verticalScrollbarWidth=i.verticalScrollbarWidth,this._minimapWidth=i.minimap.minimapWidth,this._horizontalScrollbarHeight=i.horizontalScrollbarHeight,this._editorHeight=i.height,this._editorWidth=i.width,!0}addWidget(e){const t=fe(e.getDomNode());this._widgets[e.getId()]={widget:e,preference:null,domNode:t},t.setPosition("absolute"),t.setAttribute("widgetId",e.getId()),e.allowEditorOverflow?this.overflowingOverlayWidgetsDomNode.appendChild(t):this._domNode.appendChild(t),this.setShouldRender(),this._updateMaxMinWidth()}setWidgetPosition(e,t){const i=this._widgets[e.getId()],n=t?t.preference:null,s=t?.stackOridinal;return i.preference===n&&i.stack===s?(this._updateMaxMinWidth(),!1):(i.preference=n,i.stack=s,this.setShouldRender(),this._updateMaxMinWidth(),!0)}removeWidget(e){const t=e.getId();if(this._widgets.hasOwnProperty(t)){const n=this._widgets[t].domNode.domNode;delete this._widgets[t],n.remove(),this.setShouldRender(),this._updateMaxMinWidth()}}_updateMaxMinWidth(){let e=0;const t=Object.keys(this._widgets);for(let i=0,n=t.length;i<n;i++){const s=t[i],r=this._widgets[s].widget.getMinContentWidthInPx?.();typeof r<"u"&&(e=Math.max(e,r))}this._context.viewLayout.setOverlayWidgetsMinWidth(e)}_renderWidget(e,t){const i=e.domNode;if(e.preference===null){i.setTop("");return}const n=2*this._verticalScrollbarWidth+this._minimapWidth;if(e.preference===Cn.TOP_RIGHT_CORNER||e.preference===Cn.BOTTOM_RIGHT_CORNER){if(e.preference===Cn.BOTTOM_RIGHT_CORNER){const s=i.domNode.clientHeight;i.setTop(this._editorHeight-s-2*this._horizontalScrollbarHeight)}else i.setTop(0);e.stack!==void 0?(i.setTop(t[e.preference]),t[e.preference]+=i.domNode.clientWidth):i.setRight(n)}else if(e.preference===Cn.TOP_CENTER)i.domNode.style.right="50%",e.stack!==void 0?(i.setTop(t[Cn.TOP_CENTER]),t[Cn.TOP_CENTER]+=i.domNode.clientHeight):i.setTop(0);else{const{top:s,left:o}=e.preference;if(this._context.configuration.options.get(v.fixedOverflowWidgets)&&e.widget.allowEditorOverflow){const l=this._viewDomNodeRect;i.setTop(s+l.top),i.setLeft(o+l.left),i.setPosition("fixed")}else i.setTop(s),i.setLeft(o),i.setPosition("absolute")}}prepareRender(e){this._viewDomNodeRect=Xn(this._viewDomNode.domNode)}render(e){this._domNode.setWidth(this._editorWidth);const t=Object.keys(this._widgets),i=Array.from({length:Cn.TOP_CENTER+1},()=>0);t.sort((n,s)=>(this._widgets[n].stack||0)-(this._widgets[s].stack||0));for(let n=0,s=t.length;n<s;n++){const o=t[n];this._renderWidget(this._widgets[o],i)}}}class Tv{constructor(e,t){const i=e.options;this.lineHeight=i.get(v.lineHeight),this.pixelRatio=i.get(v.pixelRatio),this.overviewRulerLanes=i.get(v.overviewRulerLanes),this.renderBorder=i.get(v.overviewRulerBorder);const n=t.getColor(Gm);this.borderColor=n?n.toString():null,this.hideCursor=i.get(v.hideCursorInOverviewRuler);const s=t.getColor(Du);this.cursorColorSingle=s?s.transparent(.7).toString():null;const o=t.getColor(Tu);this.cursorColorPrimary=o?o.transparent(.7).toString():null;const r=t.getColor(Mu);this.cursorColorSecondary=r?r.transparent(.7).toString():null,this.themeType=t.type;const l=i.get(v.minimap),d=l.enabled,c=l.side,h=t.getColor(jm),u=Ye.getDefaultBackground();h?this.backgroundColor=h:d&&c==="right"?this.backgroundColor=u:this.backgroundColor=null;const f=i.get(v.layoutInfo).overviewRuler;this.top=f.top,this.right=f.right,this.domWidth=f.width,this.domHeight=f.height,this.overviewRulerLanes===0?(this.canvasWidth=0,this.canvasHeight=0):(this.canvasWidth=this.domWidth*this.pixelRatio|0,this.canvasHeight=this.domHeight*this.pixelRatio|0);const[m,_]=this._initLanes(1,this.canvasWidth,this.overviewRulerLanes);this.x=m,this.w=_}_initLanes(e,t,i){const n=t-e;if(i>=3){const s=Math.floor(n/3),o=Math.floor(n/3),r=n-s-o,l=e,d=l+s,c=l+s+r;return[[0,l,d,l,c,l,d,l],[0,s,r,s+r,o,s+r+o,r+o,s+r+o]]}else if(i===2){const s=Math.floor(n/2),o=n-s,r=e,l=r+s;return[[0,r,r,r,l,r,r,r],[0,s,s,s,o,s+o,s+o,s+o]]}else{const s=e,o=n;return[[0,s,s,s,s,s,s,s],[0,o,o,o,o,o,o,o]]}}equals(e){return this.lineHeight===e.lineHeight&&this.pixelRatio===e.pixelRatio&&this.overviewRulerLanes===e.overviewRulerLanes&&this.renderBorder===e.renderBorder&&this.borderColor===e.borderColor&&this.hideCursor===e.hideCursor&&this.cursorColorSingle===e.cursorColorSingle&&this.cursorColorPrimary===e.cursorColorPrimary&&this.cursorColorSecondary===e.cursorColorSecondary&&this.themeType===e.themeType&&_i.equals(this.backgroundColor,e.backgroundColor)&&this.top===e.top&&this.right===e.right&&this.domWidth===e.domWidth&&this.domHeight===e.domHeight&&this.canvasWidth===e.canvasWidth&&this.canvasHeight===e.canvasHeight}}var Xl;(function(a){a[a.MIN_DECORATION_HEIGHT=6]="MIN_DECORATION_HEIGHT"})(Xl||(Xl={}));var sa;(function(a){a[a.Left=1]="Left",a[a.Center=2]="Center",a[a.Right=4]="Right",a[a.Full=7]="Full"})(sa||(sa={}));var hi;(function(a){a[a.NotNeeded=0]="NotNeeded",a[a.Maybe=1]="Maybe",a[a.Needed=2]="Needed"})(hi||(hi={}));class Mv extends St{constructor(e){super(e),this._actualShouldRender=hi.NotNeeded,this._renderedDecorations=[],this._renderedCursorPositions=[],this._domNode=fe(document.createElement("canvas")),this._domNode.setClassName("decorationsOverviewRuler"),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._domNode.setAttribute("aria-hidden","true"),this._updateSettings(!1),this._tokensColorTrackerListener=Ye.onDidChange(t=>{t.changedColorMap&&this._updateSettings(!0)}),this._cursorPositions=[{position:new I(1,1),color:this._settings.cursorColorSingle}]}dispose(){super.dispose(),this._tokensColorTrackerListener.dispose()}_updateSettings(e){const t=new Tv(this._context.configuration,this._context.theme);return this._settings&&this._settings.equals(t)?!1:(this._settings=t,this._domNode.setTop(this._settings.top),this._domNode.setRight(this._settings.right),this._domNode.setWidth(this._settings.domWidth),this._domNode.setHeight(this._settings.domHeight),this._domNode.domNode.width=this._settings.canvasWidth,this._domNode.domNode.height=this._settings.canvasHeight,e&&this._render(),!0)}_markRenderingIsNeeded(){return this._actualShouldRender=hi.Needed,!0}_markRenderingIsMaybeNeeded(){return this._actualShouldRender=hi.Maybe,!0}onConfigurationChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}onCursorStateChanged(e){this._cursorPositions=[];for(let t=0,i=e.selections.length;t<i;t++){let n=this._settings.cursorColorSingle;i>1&&(n=t===0?this._settings.cursorColorPrimary:this._settings.cursorColorSecondary),this._cursorPositions.push({position:e.selections[t].getPosition(),color:n})}return this._cursorPositions.sort((t,i)=>I.compare(t.position,i.position)),this._markRenderingIsMaybeNeeded()}onDecorationsChanged(e){return e.affectsOverviewRuler?this._markRenderingIsMaybeNeeded():!1}onFlushed(e){return this._markRenderingIsNeeded()}onScrollChanged(e){return e.scrollHeightChanged?this._markRenderingIsNeeded():!1}onZonesChanged(e){return this._markRenderingIsNeeded()}onThemeChanged(e){return this._updateSettings(!1)?this._markRenderingIsNeeded():!1}getDomNode(){return this._domNode.domNode}prepareRender(e){}render(e){this._render(),this._actualShouldRender=hi.NotNeeded}_render(){const e=this._settings.backgroundColor;if(this._settings.overviewRulerLanes===0){this._domNode.setBackgroundColor(e?_i.Format.CSS.formatHexA(e):""),this._domNode.setDisplay("none");return}const t=this._context.viewModel.getAllOverviewRulerDecorations(this._context.theme);if(t.sort(ko.compareByRenderingProps),this._actualShouldRender===hi.Maybe&&!ko.equalsArr(this._renderedDecorations,t)&&(this._actualShouldRender=hi.Needed),this._actualShouldRender===hi.Maybe&&!Do(this._renderedCursorPositions,this._cursorPositions,(f,m)=>f.position.lineNumber===m.position.lineNumber&&f.color===m.color)&&(this._actualShouldRender=hi.Needed),this._actualShouldRender===hi.Maybe)return;this._renderedDecorations=t,this._renderedCursorPositions=this._cursorPositions,this._domNode.setDisplay("block");const i=this._settings.canvasWidth,n=this._settings.canvasHeight,s=this._settings.lineHeight,o=this._context.viewLayout,r=this._context.viewLayout.getScrollHeight(),l=n/r,d=Xl.MIN_DECORATION_HEIGHT*this._settings.pixelRatio|0,c=d/2|0,h=this._domNode.domNode.getContext("2d");e?e.isOpaque()?(h.fillStyle=_i.Format.CSS.formatHexA(e),h.fillRect(0,0,i,n)):(h.clearRect(0,0,i,n),h.fillStyle=_i.Format.CSS.formatHexA(e),h.fillRect(0,0,i,n)):h.clearRect(0,0,i,n);const u=this._settings.x,g=this._settings.w;for(const f of t){const m=f.color,_=f.data;h.fillStyle=m;let L=0,w=0,p=0;for(let C=0,b=_.length/3;C<b;C++){const S=_[3*C],y=_[3*C+1],E=_[3*C+2];let x=o.getVerticalOffsetForLineNumber(y)*l|0,R=(o.getVerticalOffsetForLineNumber(E)+s)*l|0;if(R-x<d){let A=(x+R)/2|0;A<c?A=c:A+c>n&&(A=n-c),x=A-c,R=A+c}x>p+1||S!==L?(C!==0&&h.fillRect(u[L],w,g[L],p-w),L=S,w=x,p=R):R>p&&(p=R)}h.fillRect(u[L],w,g[L],p-w)}if(!this._settings.hideCursor){const f=2*this._settings.pixelRatio|0,m=f/2|0,_=this._settings.x[sa.Full],L=this._settings.w[sa.Full];let w=-100,p=-100,C=null;for(let b=0,S=this._cursorPositions.length;b<S;b++){const y=this._cursorPositions[b].color;if(!y)continue;const E=this._cursorPositions[b].position;let x=o.getVerticalOffsetForLineNumber(E.lineNumber)*l|0;x<m?x=m:x+m>n&&(x=n-m);const R=x-m,D=R+f;R>p+1||y!==C?(b!==0&&C&&h.fillRect(_,w,L,p-w),w=R,p=D):D>p&&(p=D),C=y,h.fillStyle=y}C&&h.fillRect(_,w,L,p-w)}this._settings.renderBorder&&this._settings.borderColor&&this._settings.overviewRulerLanes>0&&(h.beginPath(),h.lineWidth=1,h.strokeStyle=this._settings.borderColor,h.moveTo(0,0),h.lineTo(0,n),h.moveTo(1,0),h.lineTo(i,0),h.stroke())}}var Yl;(function(a){a[a.MINIMUM_HEIGHT=4]="MINIMUM_HEIGHT"})(Yl||(Yl={}));class wh{constructor(e,t,i){this._colorZoneBrand=void 0,this.from=e|0,this.to=t|0,this.colorId=i|0}static compare(e,t){return e.colorId===t.colorId?e.from===t.from?e.to-t.to:e.from-t.from:e.colorId-t.colorId}}class Vg{constructor(e,t,i,n){this._overviewRulerZoneBrand=void 0,this.startLineNumber=e,this.endLineNumber=t,this.heightInLines=i,this.color=n,this._colorZone=null}static compare(e,t){return e.color===t.color?e.startLineNumber===t.startLineNumber?e.heightInLines===t.heightInLines?e.endLineNumber-t.endLineNumber:e.heightInLines-t.heightInLines:e.startLineNumber-t.startLineNumber:e.color<t.color?-1:1}setColorZone(e){this._colorZone=e}getColorZones(){return this._colorZone}}class Av{constructor(e){this._getVerticalOffsetForLine=e,this._zones=[],this._colorZonesInvalid=!1,this._lineHeight=0,this._domWidth=0,this._domHeight=0,this._outerHeight=0,this._pixelRatio=1,this._lastAssignedId=0,this._color2Id=Object.create(null),this._id2Color=[]}getId2Color(){return this._id2Color}setZones(e){this._zones=e,this._zones.sort(Vg.compare)}setLineHeight(e){return this._lineHeight===e?!1:(this._lineHeight=e,this._colorZonesInvalid=!0,!0)}setPixelRatio(e){this._pixelRatio=e,this._colorZonesInvalid=!0}getDOMWidth(){return this._domWidth}getCanvasWidth(){return this._domWidth*this._pixelRatio}setDOMWidth(e){return this._domWidth===e?!1:(this._domWidth=e,this._colorZonesInvalid=!0,!0)}getDOMHeight(){return this._domHeight}getCanvasHeight(){return this._domHeight*this._pixelRatio}setDOMHeight(e){return this._domHeight===e?!1:(this._domHeight=e,this._colorZonesInvalid=!0,!0)}getOuterHeight(){return this._outerHeight}setOuterHeight(e){return this._outerHeight===e?!1:(this._outerHeight=e,this._colorZonesInvalid=!0,!0)}resolveColorZones(){const e=this._colorZonesInvalid,t=Math.floor(this._lineHeight),i=Math.floor(this.getCanvasHeight()),n=Math.floor(this._outerHeight),s=i/n,o=Math.floor(Yl.MINIMUM_HEIGHT*this._pixelRatio/2),r=[];for(let l=0,d=this._zones.length;l<d;l++){const c=this._zones[l];if(!e){const C=c.getColorZones();if(C){r.push(C);continue}}const h=this._getVerticalOffsetForLine(c.startLineNumber),u=c.heightInLines===0?this._getVerticalOffsetForLine(c.endLineNumber)+t:h+c.heightInLines*t,g=Math.floor(s*h),f=Math.floor(s*u);let m=Math.floor((g+f)/2),_=f-m;_<o&&(_=o),m-_<0&&(m=_),m+_>i&&(m=i-_);const L=c.color;let w=this._color2Id[L];w||(w=++this._lastAssignedId,this._color2Id[L]=w,this._id2Color[w]=L);const p=new wh(m-_,m+_,w);c.setColorZone(p),r.push(p)}return this._colorZonesInvalid=!1,r.sort(wh.compare),r}}class Ov extends ss{constructor(e,t){super(),this._context=e;const i=this._context.configuration.options;this._domNode=fe(document.createElement("canvas")),this._domNode.setClassName(t),this._domNode.setPosition("absolute"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),this._zoneManager=new Av(n=>this._context.viewLayout.getVerticalOffsetForLineNumber(n)),this._zoneManager.setDOMWidth(0),this._zoneManager.setDOMHeight(0),this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight()),this._zoneManager.setLineHeight(i.get(v.lineHeight)),this._zoneManager.setPixelRatio(i.get(v.pixelRatio)),this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return e.hasChanged(v.lineHeight)&&(this._zoneManager.setLineHeight(t.get(v.lineHeight)),this._render()),e.hasChanged(v.pixelRatio)&&(this._zoneManager.setPixelRatio(t.get(v.pixelRatio)),this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render()),!0}onFlushed(e){return this._render(),!0}onScrollChanged(e){return e.scrollHeightChanged&&(this._zoneManager.setOuterHeight(e.scrollHeight),this._render()),!0}onZonesChanged(e){return this._render(),!0}getDomNode(){return this._domNode.domNode}setLayout(e){this._domNode.setTop(e.top),this._domNode.setRight(e.right);let t=!1;t=this._zoneManager.setDOMWidth(e.width)||t,t=this._zoneManager.setDOMHeight(e.height)||t,t&&(this._domNode.setWidth(this._zoneManager.getDOMWidth()),this._domNode.setHeight(this._zoneManager.getDOMHeight()),this._domNode.domNode.width=this._zoneManager.getCanvasWidth(),this._domNode.domNode.height=this._zoneManager.getCanvasHeight(),this._render())}setZones(e){this._zoneManager.setZones(e),this._render()}_render(){if(this._zoneManager.getOuterHeight()===0)return!1;const e=this._zoneManager.getCanvasWidth(),t=this._zoneManager.getCanvasHeight(),i=this._zoneManager.resolveColorZones(),n=this._zoneManager.getId2Color(),s=this._domNode.domNode.getContext("2d");return s.clearRect(0,0,e,t),i.length>0&&this._renderOneLane(s,i,n,e),!0}_renderOneLane(e,t,i,n){let s=0,o=0,r=0;for(const l of t){const d=l.colorId,c=l.from,h=l.to;d!==s?(e.fillRect(0,o,n,r-o),s=d,e.fillStyle=i[s],o=c,r=h):r>=c?r=Math.max(r,h):(e.fillRect(0,o,n,r-o),o=c,r=h)}e.fillRect(0,o,n,r-o)}}const Pv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(Pv);class kv extends St{constructor(e){super(e),this.domNode=fe(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("view-rulers"),this._renderedRulers=[];const t=this._context.configuration.options;this._rulers=t.get(v.rulers),this._typicalHalfwidthCharacterWidth=t.get(v.fontInfo).typicalHalfwidthCharacterWidth}dispose(){super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._rulers=t.get(v.rulers),this._typicalHalfwidthCharacterWidth=t.get(v.fontInfo).typicalHalfwidthCharacterWidth,!0}onScrollChanged(e){return e.scrollHeightChanged}prepareRender(e){}_ensureRulersCount(){const e=this._renderedRulers.length,t=this._rulers.length;if(e===t)return;if(e<t){const{tabSize:n}=this._context.viewModel.model.getOptions(),s=n;let o=t-e;for(;o>0;){const r=fe(document.createElement("div"));r.setClassName("view-ruler"),r.setWidth(s),this.domNode.appendChild(r),this._renderedRulers.push(r),o--}return}let i=e-t;for(;i>0;){const n=this._renderedRulers.pop();this.domNode.removeChild(n),i--}}render(e){this._ensureRulersCount();for(let t=0,i=this._rulers.length;t<i;t++){const n=this._renderedRulers[t],s=this._rulers[t];n.setBoxShadow(s.color?`1px 0 0 0 ${s.color} inset`:""),n.setHeight(Math.min(e.scrollHeight,1e6)),n.setLeft(s.column*this._typicalHalfwidthCharacterWidth)}}}const Wv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(Wv);class Vv extends St{constructor(e){super(e),this._scrollTop=0,this._width=0,this._updateWidth(),this._shouldShow=!1;const i=this._context.configuration.options.get(v.scrollbar);this._useShadows=i.useShadows,this._domNode=fe(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true")}dispose(){super.dispose()}_updateShouldShow(){const e=this._useShadows&&this._scrollTop>0;return this._shouldShow!==e?(this._shouldShow=e,!0):!1}getDomNode(){return this._domNode}_updateWidth(){const t=this._context.configuration.options.get(v.layoutInfo);t.minimap.renderMinimap===0||t.minimap.minimapWidth>0&&t.minimap.minimapLeft===0?this._width=t.width:this._width=t.width-t.verticalScrollbarWidth}onConfigurationChanged(e){const i=this._context.configuration.options.get(v.scrollbar);return this._useShadows=i.useShadows,this._updateWidth(),this._updateShouldShow(),!0}onScrollChanged(e){return this._scrollTop=e.scrollTop,this._updateShouldShow()}prepareRender(e){}render(e){this._domNode.setWidth(this._width),this._domNode.setClassName(this._shouldShow?"scroll-decoration":"")}}const Fv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(Fv);var Te;(function(a){a[a.EXTERN=0]="EXTERN",a[a.INTERN=1]="INTERN",a[a.FLAT=2]="FLAT"})(Te||(Te={}));class Hv{constructor(e){this.left=e.left,this.width=e.width,this.startStyle=null,this.endStyle=null}}class Bv{constructor(e,t){this.lineNumber=e,this.ranges=t}}function zv(a){return new Hv(a)}function Uv(a){return new Bv(a.lineNumber,a.ranges.map(zv))}class Ze extends _n{static{this.SELECTION_CLASS_NAME="selected-text"}static{this.SELECTION_TOP_LEFT="top-left-radius"}static{this.SELECTION_BOTTOM_LEFT="bottom-left-radius"}static{this.SELECTION_TOP_RIGHT="top-right-radius"}static{this.SELECTION_BOTTOM_RIGHT="bottom-right-radius"}static{this.EDITOR_BACKGROUND_CLASS_NAME="monaco-editor-background"}static{this.ROUNDED_PIECE_WIDTH=10}constructor(e){super(),this._previousFrameVisibleRangesWithStyle=[],this._context=e;const t=this._context.configuration.options;this._roundedSelection=t.get(v.roundedSelection),this._typicalHalfwidthCharacterWidth=t.get(v.fontInfo).typicalHalfwidthCharacterWidth,this._selections=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options;return this._roundedSelection=t.get(v.roundedSelection),this._typicalHalfwidthCharacterWidth=t.get(v.fontInfo).typicalHalfwidthCharacterWidth,!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_visibleRangesHaveGaps(e){for(let t=0,i=e.length;t<i;t++)if(e[t].ranges.length>1)return!0;return!1}_enrichVisibleRangesWithStyle(e,t,i){const n=this._typicalHalfwidthCharacterWidth/4;let s=null,o=null;if(i&&i.length>0&&t.length>0){const r=t[0].lineNumber;if(r===e.startLineNumber)for(let d=0;!s&&d<i.length;d++)i[d].lineNumber===r&&(s=i[d].ranges[0]);const l=t[t.length-1].lineNumber;if(l===e.endLineNumber)for(let d=i.length-1;!o&&d>=0;d--)i[d].lineNumber===l&&(o=i[d].ranges[0]);s&&!s.startStyle&&(s=null),o&&!o.startStyle&&(o=null)}for(let r=0,l=t.length;r<l;r++){const d=t[r].ranges[0],c=d.left,h=d.left+d.width,u={top:Te.EXTERN,bottom:Te.EXTERN},g={top:Te.EXTERN,bottom:Te.EXTERN};if(r>0){const f=t[r-1].ranges[0].left,m=t[r-1].ranges[0].left+t[r-1].ranges[0].width;vr(c-f)<n?u.top=Te.FLAT:c>f&&(u.top=Te.INTERN),vr(h-m)<n?g.top=Te.FLAT:f<h&&h<m&&(g.top=Te.INTERN)}else s&&(u.top=s.startStyle.top,g.top=s.endStyle.top);if(r+1<l){const f=t[r+1].ranges[0].left,m=t[r+1].ranges[0].left+t[r+1].ranges[0].width;vr(c-f)<n?u.bottom=Te.FLAT:f<c&&c<m&&(u.bottom=Te.INTERN),vr(h-m)<n?g.bottom=Te.FLAT:h<m&&(g.bottom=Te.INTERN)}else o&&(u.bottom=o.startStyle.bottom,g.bottom=o.endStyle.bottom);d.startStyle=u,d.endStyle=g}}_getVisibleRangesWithStyle(e,t,i){const s=(t.linesVisibleRangesForRange(e,!0)||[]).map(Uv);return!this._visibleRangesHaveGaps(s)&&this._roundedSelection&&this._enrichVisibleRangesWithStyle(t.visibleRange,s,i),s}_createSelectionPiece(e,t,i,n,s){return'<div class="cslr '+i+'" style="top:'+e.toString()+"px;bottom:"+t.toString()+"px;left:"+n.toString()+"px;width:"+s.toString()+'px;"></div>'}_actualRenderOneSelection(e,t,i,n){if(n.length===0)return;const s=!!n[0].ranges[0].startStyle,o=n[0].lineNumber,r=n[n.length-1].lineNumber;for(let l=0,d=n.length;l<d;l++){const c=n[l],h=c.lineNumber,u=h-t,g=i&&h===o?1:0,f=i&&h!==o&&h===r?1:0;let m="",_="";for(let L=0,w=c.ranges.length;L<w;L++){const p=c.ranges[L];if(s){const b=p.startStyle,S=p.endStyle;if(b.top===Te.INTERN||b.bottom===Te.INTERN){m+=this._createSelectionPiece(g,f,Ze.SELECTION_CLASS_NAME,p.left-Ze.ROUNDED_PIECE_WIDTH,Ze.ROUNDED_PIECE_WIDTH);let y=Ze.EDITOR_BACKGROUND_CLASS_NAME;b.top===Te.INTERN&&(y+=" "+Ze.SELECTION_TOP_RIGHT),b.bottom===Te.INTERN&&(y+=" "+Ze.SELECTION_BOTTOM_RIGHT),m+=this._createSelectionPiece(g,f,y,p.left-Ze.ROUNDED_PIECE_WIDTH,Ze.ROUNDED_PIECE_WIDTH)}if(S.top===Te.INTERN||S.bottom===Te.INTERN){m+=this._createSelectionPiece(g,f,Ze.SELECTION_CLASS_NAME,p.left+p.width,Ze.ROUNDED_PIECE_WIDTH);let y=Ze.EDITOR_BACKGROUND_CLASS_NAME;S.top===Te.INTERN&&(y+=" "+Ze.SELECTION_TOP_LEFT),S.bottom===Te.INTERN&&(y+=" "+Ze.SELECTION_BOTTOM_LEFT),m+=this._createSelectionPiece(g,f,y,p.left+p.width,Ze.ROUNDED_PIECE_WIDTH)}}let C=Ze.SELECTION_CLASS_NAME;if(s){const b=p.startStyle,S=p.endStyle;b.top===Te.EXTERN&&(C+=" "+Ze.SELECTION_TOP_LEFT),b.bottom===Te.EXTERN&&(C+=" "+Ze.SELECTION_BOTTOM_LEFT),S.top===Te.EXTERN&&(C+=" "+Ze.SELECTION_TOP_RIGHT),S.bottom===Te.EXTERN&&(C+=" "+Ze.SELECTION_BOTTOM_RIGHT)}_+=this._createSelectionPiece(g,f,C,p.left,p.width)}e[u][0]+=m,e[u][1]+=_}}prepareRender(e){const t=[],i=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber;for(let o=i;o<=n;o++){const r=o-i;t[r]=["",""]}const s=[];for(let o=0,r=this._selections.length;o<r;o++){const l=this._selections[o];if(l.isEmpty()){s[o]=null;continue}const d=this._getVisibleRangesWithStyle(l,e,this._previousFrameVisibleRangesWithStyle[o]);s[o]=d,this._actualRenderOneSelection(t,i,this._selections.length>1,d)}this._previousFrameVisibleRangesWithStyle=s,this._renderResult=t.map(([o,r])=>o+r)}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}Ks((a,e)=>{const t=a.getColor(Km);t&&!t.isTransparent()&&e.addRule(`.monaco-editor .view-line span.inline-selected-text { color: ${t}; }`)});function vr(a){return a<0?-a:a}const Gv=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Lh{constructor(e,t,i,n,s,o,r){this.top=e,this.left=t,this.paddingLeft=i,this.width=n,this.height=s,this.textContent=o,this.textContentClassName=r}}var Vi;(function(a){a[a.Single=0]="Single",a[a.MultiPrimary=1]="MultiPrimary",a[a.MultiSecondary=2]="MultiSecondary"})(Vi||(Vi={}));class vh{constructor(e,t){this._context=e;const i=this._context.configuration.options,n=i.get(v.fontInfo);this._cursorStyle=i.get(v.effectiveCursorStyle),this._typicalHalfwidthCharacterWidth=n.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(i.get(v.cursorWidth),this._typicalHalfwidthCharacterWidth),this._isVisible=!0,this._domNode=fe(document.createElement("div")),this._domNode.setClassName(`cursor ${Is}`),this._domNode.setHeight(this._context.viewLayout.getLineHeightForLineNumber(1)),this._domNode.setTop(0),this._domNode.setLeft(0),st(this._domNode,n),this._domNode.setDisplay("none"),this._position=new I(1,1),this._pluralityClass="",this.setPlurality(t),this._lastRenderedContent="",this._renderData=null}getDomNode(){return this._domNode}getPosition(){return this._position}setPlurality(e){switch(e){default:case Vi.Single:this._pluralityClass="";break;case Vi.MultiPrimary:this._pluralityClass="cursor-primary";break;case Vi.MultiSecondary:this._pluralityClass="cursor-secondary";break}}show(){this._isVisible||(this._domNode.setVisibility("inherit"),this._isVisible=!0)}hide(){this._isVisible&&(this._domNode.setVisibility("hidden"),this._isVisible=!1)}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(v.fontInfo);return this._cursorStyle=t.get(v.effectiveCursorStyle),this._typicalHalfwidthCharacterWidth=i.typicalHalfwidthCharacterWidth,this._lineCursorWidth=Math.min(t.get(v.cursorWidth),this._typicalHalfwidthCharacterWidth),st(this._domNode,i),!0}onCursorPositionChanged(e,t){return t?this._domNode.domNode.style.transitionProperty="none":this._domNode.domNode.style.transitionProperty="",this._position=e,!0}_getGraphemeAwarePosition(){const{lineNumber:e,column:t}=this._position,i=this._context.viewModel.getLineContent(e),[n,s]=$m(i,t-1);return[new I(e,n+1),i.substring(n,s)]}_prepareRender(e){let t="",i="";const[n,s]=this._getGraphemeAwarePosition();if(this._cursorStyle===ei.Line||this._cursorStyle===ei.LineThin){const g=e.visibleRangeForPosition(n);if(!g||g.outsideRenderedLine)return null;const f=Ne(this._domNode.domNode);let m;this._cursorStyle===ei.Line?(m=Tc(f,this._lineCursorWidth>0?this._lineCursorWidth:2),m>2&&(t=s,i=this._getTokenClassName(n))):m=Tc(f,1);let _=g.left,L=0;m>=2&&_>=1&&(L=1,_-=L);const w=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta,p=this._context.viewLayout.getLineHeightForLineNumber(n.lineNumber);return new Lh(w,_,L,m,p,t,i)}const o=e.linesVisibleRangesForRange(new N(n.lineNumber,n.column,n.lineNumber,n.column+s.length),!1);if(!o||o.length===0)return null;const r=o[0];if(r.outsideRenderedLine||r.ranges.length===0)return null;const l=r.ranges[0],d=s==="	"?this._typicalHalfwidthCharacterWidth:l.width<1?this._typicalHalfwidthCharacterWidth:l.width;this._cursorStyle===ei.Block&&(t=s,i=this._getTokenClassName(n));let c=e.getVerticalOffsetForLineNumber(n.lineNumber)-e.bigNumbersDelta;const h=this._context.viewLayout.getLineHeightForLineNumber(n.lineNumber);let u=h;return(this._cursorStyle===ei.Underline||this._cursorStyle===ei.UnderlineThin)&&(c+=h-2,u=2),new Lh(c,l.left,0,d,u,t,i)}_getTokenClassName(e){const t=this._context.viewModel.getViewLineData(e.lineNumber),i=t.tokens.findTokenIndexAtOffset(e.column-1);return t.tokens.getClassName(i)}prepareRender(e){this._renderData=this._prepareRender(e)}render(e){return this._renderData?(this._lastRenderedContent!==this._renderData.textContent&&(this._lastRenderedContent=this._renderData.textContent,this._domNode.domNode.textContent=this._lastRenderedContent),this._domNode.setClassName(`cursor ${this._pluralityClass} ${Is} ${this._renderData.textContentClassName}`),this._domNode.setDisplay("block"),this._domNode.setTop(this._renderData.top),this._domNode.setLeft(this._renderData.left),this._domNode.setPaddingLeft(this._renderData.paddingLeft),this._domNode.setWidth(this._renderData.width),this._domNode.setLineHeight(this._renderData.height),this._domNode.setHeight(this._renderData.height),{domNode:this._domNode.domNode,position:this._position,contentLeft:this._renderData.left,height:this._renderData.height,width:2}):(this._domNode.setDisplay("none"),null)}}Ee(Gv);class oa extends St{static{this.BLINK_INTERVAL=500}constructor(e){super(e);const t=this._context.configuration.options;this._readOnly=t.get(v.readOnly),this._cursorBlinking=t.get(v.cursorBlinking),this._cursorStyle=t.get(v.effectiveCursorStyle),this._cursorSmoothCaretAnimation=t.get(v.cursorSmoothCaretAnimation),this._experimentalEditContextEnabled=t.get(v.effectiveExperimentalEditContextEnabled),this._selectionIsEmpty=!0,this._isComposingInput=!1,this._isVisible=!1,this._primaryCursor=new vh(this._context,Vi.Single),this._secondaryCursors=[],this._renderData=[],this._domNode=fe(document.createElement("div")),this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true"),this._updateDomClassName(),this._domNode.appendChild(this._primaryCursor.getDomNode()),this._startCursorBlinkAnimation=new Zm,this._cursorFlatBlinkInterval=new qm,this._blinkingEnabled=!1,this._editorHasFocus=!1,this._updateBlinking()}dispose(){super.dispose(),this._startCursorBlinkAnimation.dispose(),this._cursorFlatBlinkInterval.dispose()}getDomNode(){return this._domNode}onCompositionStart(e){return this._isComposingInput=!0,this._updateBlinking(),!0}onCompositionEnd(e){return this._isComposingInput=!1,this._updateBlinking(),!0}onConfigurationChanged(e){const t=this._context.configuration.options;this._readOnly=t.get(v.readOnly),this._cursorBlinking=t.get(v.cursorBlinking),this._cursorStyle=t.get(v.effectiveCursorStyle),this._cursorSmoothCaretAnimation=t.get(v.cursorSmoothCaretAnimation),this._experimentalEditContextEnabled=t.get(v.effectiveExperimentalEditContextEnabled),this._updateBlinking(),this._updateDomClassName(),this._primaryCursor.onConfigurationChanged(e);for(let i=0,n=this._secondaryCursors.length;i<n;i++)this._secondaryCursors[i].onConfigurationChanged(e);return!0}_onCursorPositionChanged(e,t,i){const n=this._secondaryCursors.length!==t.length||this._cursorSmoothCaretAnimation==="explicit"&&i!==he.Explicit;if(this._primaryCursor.setPlurality(t.length?Vi.MultiPrimary:Vi.Single),this._primaryCursor.onCursorPositionChanged(e,n),this._updateBlinking(),this._secondaryCursors.length<t.length){const s=t.length-this._secondaryCursors.length;for(let o=0;o<s;o++){const r=new vh(this._context,Vi.MultiSecondary);this._domNode.domNode.insertBefore(r.getDomNode().domNode,this._primaryCursor.getDomNode().domNode.nextSibling),this._secondaryCursors.push(r)}}else if(this._secondaryCursors.length>t.length){const s=this._secondaryCursors.length-t.length;for(let o=0;o<s;o++)this._domNode.removeChild(this._secondaryCursors[0].getDomNode()),this._secondaryCursors.splice(0,1)}for(let s=0;s<t.length;s++)this._secondaryCursors[s].onCursorPositionChanged(t[s],n)}onCursorStateChanged(e){const t=[];for(let n=0,s=e.selections.length;n<s;n++)t[n]=e.selections[n].getPosition();this._onCursorPositionChanged(t[0],t.slice(1),e.reason);const i=e.selections[0].isEmpty();return this._selectionIsEmpty!==i&&(this._selectionIsEmpty=i,this._updateDomClassName()),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onFocusChanged(e){return this._editorHasFocus=e.isFocused,this._updateBlinking(),!1}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return!0}onTokensChanged(e){const t=i=>{for(let n=0,s=e.ranges.length;n<s;n++)if(e.ranges[n].fromLineNumber<=i.lineNumber&&i.lineNumber<=e.ranges[n].toLineNumber)return!0;return!1};if(t(this._primaryCursor.getPosition()))return!0;for(const i of this._secondaryCursors)if(t(i.getPosition()))return!0;return!1}onZonesChanged(e){return!0}_getCursorBlinking(){return this._isComposingInput&&!this._experimentalEditContextEnabled?di.Hidden:this._editorHasFocus?this._readOnly?di.Solid:this._cursorBlinking:di.Hidden}_updateBlinking(){this._startCursorBlinkAnimation.cancel(),this._cursorFlatBlinkInterval.cancel();const e=this._getCursorBlinking(),t=e===di.Hidden,i=e===di.Solid;t?this._hide():this._show(),this._blinkingEnabled=!1,this._updateDomClassName(),!t&&!i&&(e===di.Blink?this._cursorFlatBlinkInterval.cancelAndSet(()=>{this._isVisible?this._hide():this._show()},oa.BLINK_INTERVAL,Ne(this._domNode.domNode)):this._startCursorBlinkAnimation.setIfNotSet(()=>{this._blinkingEnabled=!0,this._updateDomClassName()},oa.BLINK_INTERVAL))}_updateDomClassName(){this._domNode.setClassName(this._getClassName())}_getClassName(){let e="cursors-layer";switch(this._selectionIsEmpty||(e+=" has-selection"),this._cursorStyle){case ei.Line:e+=" cursor-line-style";break;case ei.Block:e+=" cursor-block-style";break;case ei.Underline:e+=" cursor-underline-style";break;case ei.LineThin:e+=" cursor-line-thin-style";break;case ei.BlockOutline:e+=" cursor-block-outline-style";break;case ei.UnderlineThin:e+=" cursor-underline-thin-style";break;default:e+=" cursor-line-style"}if(this._blinkingEnabled)switch(this._getCursorBlinking()){case di.Blink:e+=" cursor-blink";break;case di.Smooth:e+=" cursor-smooth";break;case di.Phase:e+=" cursor-phase";break;case di.Expand:e+=" cursor-expand";break;case di.Solid:e+=" cursor-solid";break;default:e+=" cursor-solid"}else e+=" cursor-solid";return(this._cursorSmoothCaretAnimation==="on"||this._cursorSmoothCaretAnimation==="explicit")&&(e+=" cursor-smooth-caret-animation"),e}_show(){this._primaryCursor.show();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].show();this._isVisible=!0}_hide(){this._primaryCursor.hide();for(let e=0,t=this._secondaryCursors.length;e<t;e++)this._secondaryCursors[e].hide();this._isVisible=!1}prepareRender(e){this._primaryCursor.prepareRender(e);for(let t=0,i=this._secondaryCursors.length;t<i;t++)this._secondaryCursors[t].prepareRender(e)}render(e){const t=[];let i=0;const n=this._primaryCursor.render(e);n&&(t[i++]=n);for(let s=0,o=this._secondaryCursors.length;s<o;s++){const r=this._secondaryCursors[s].render(e);r&&(t[i++]=r)}this._renderData=t}getLastRenderData(){return this._renderData}}Ks((a,e)=>{const t=[{class:".cursor",foreground:Du,background:Xm},{class:".cursor-primary",foreground:Tu,background:Ym},{class:".cursor-secondary",foreground:Mu,background:Qm}];for(const i of t){const n=a.getColor(i.foreground);if(n){let s=a.getColor(i.background);s||(s=n.opposite()),e.addRule(`.monaco-editor .cursors-layer ${i.class} { background-color: ${n}; border-color: ${n}; color: ${s}; }`),fo(a.type)&&e.addRule(`.monaco-editor .cursors-layer.has-selection ${i.class} { border-left: 1px solid ${s}; border-right: 1px solid ${s}; }`)}}});const cl=()=>{throw new Error("Invalid change accessor")};class jv extends St{constructor(e){super(e);const t=this._context.configuration.options,i=t.get(v.layoutInfo);this._lineHeight=t.get(v.lineHeight),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,this.domNode=fe(document.createElement("div")),this.domNode.setClassName("view-zones"),this.domNode.setPosition("absolute"),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.marginDomNode=fe(document.createElement("div")),this.marginDomNode.setClassName("margin-view-zones"),this.marginDomNode.setPosition("absolute"),this.marginDomNode.setAttribute("role","presentation"),this.marginDomNode.setAttribute("aria-hidden","true"),this._zones={}}dispose(){super.dispose(),this._zones={}}_recomputeWhitespacesProps(){const e=this._context.viewLayout.getWhitespaces(),t=new Map;for(const n of e)t.set(n.id,n);let i=!1;return this._context.viewModel.changeWhitespace(n=>{const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const l=s[o],d=this._zones[l],c=this._computeWhitespaceProps(d.delegate);d.isInHiddenArea=c.isInHiddenArea;const h=t.get(l);h&&(h.afterLineNumber!==c.afterViewLineNumber||h.height!==c.heightInPx)&&(n.changeOneWhitespace(l,c.afterViewLineNumber,c.heightInPx),this._safeCallOnComputedHeight(d.delegate,c.heightInPx),i=!0)}}),i}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(v.layoutInfo);return this._lineHeight=t.get(v.lineHeight),this._contentWidth=i.contentWidth,this._contentLeft=i.contentLeft,e.hasChanged(v.lineHeight)&&this._recomputeWhitespacesProps(),!0}onLineMappingChanged(e){return this._recomputeWhitespacesProps()}onLinesDeleted(e){return!0}onScrollChanged(e){return e.scrollTopChanged||e.scrollWidthChanged}onZonesChanged(e){return!0}onLinesInserted(e){return!0}_getZoneOrdinal(e){return e.ordinal??e.afterColumn??1e4}_computeWhitespaceProps(e){if(e.afterLineNumber===0)return{isInHiddenArea:!1,afterViewLineNumber:0,heightInPx:this._heightInPixels(e),minWidthInPx:this._minWidthInPixels(e)};let t;if(typeof e.afterColumn<"u")t=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:e.afterColumn});else{const o=this._context.viewModel.model.validatePosition({lineNumber:e.afterLineNumber,column:1}).lineNumber;t=new I(o,this._context.viewModel.model.getLineMaxColumn(o))}let i;t.column===this._context.viewModel.model.getLineMaxColumn(t.lineNumber)?i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber+1,column:1}):i=this._context.viewModel.model.validatePosition({lineNumber:t.lineNumber,column:t.column+1});const n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t,e.afterColumnAffinity,!0),s=e.showInHiddenAreas||this._context.viewModel.coordinatesConverter.modelPositionIsVisible(i);return{isInHiddenArea:!s,afterViewLineNumber:n.lineNumber,heightInPx:s?this._heightInPixels(e):0,minWidthInPx:this._minWidthInPixels(e)}}changeViewZones(e){let t=!1;return this._context.viewModel.changeWhitespace(i=>{const n={addZone:s=>(t=!0,this._addZone(i,s)),removeZone:s=>{s&&(t=this._removeZone(i,s)||t)},layoutZone:s=>{s&&(t=this._layoutZone(i,s)||t)}};Kv(e,n),n.addZone=cl,n.removeZone=cl,n.layoutZone=cl}),t}_addZone(e,t){const i=this._computeWhitespaceProps(t),s={whitespaceId:e.insertWhitespace(i.afterViewLineNumber,this._getZoneOrdinal(t),i.heightInPx,i.minWidthInPx),delegate:t,isInHiddenArea:i.isInHiddenArea,isVisible:!1,domNode:fe(t.domNode),marginDomNode:t.marginDomNode?fe(t.marginDomNode):null};return this._safeCallOnComputedHeight(s.delegate,i.heightInPx),s.domNode.setPosition("absolute"),s.domNode.domNode.style.width="100%",s.domNode.setDisplay("none"),s.domNode.setAttribute("monaco-view-zone",s.whitespaceId),this.domNode.appendChild(s.domNode),s.marginDomNode&&(s.marginDomNode.setPosition("absolute"),s.marginDomNode.domNode.style.width="100%",s.marginDomNode.setDisplay("none"),s.marginDomNode.setAttribute("monaco-view-zone",s.whitespaceId),this.marginDomNode.appendChild(s.marginDomNode)),this._zones[s.whitespaceId]=s,this.setShouldRender(),s.whitespaceId}_removeZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t];return delete this._zones[t],e.removeWhitespace(i.whitespaceId),i.domNode.removeAttribute("monaco-visible-view-zone"),i.domNode.removeAttribute("monaco-view-zone"),i.domNode.domNode.remove(),i.marginDomNode&&(i.marginDomNode.removeAttribute("monaco-visible-view-zone"),i.marginDomNode.removeAttribute("monaco-view-zone"),i.marginDomNode.domNode.remove()),this.setShouldRender(),!0}return!1}_layoutZone(e,t){if(this._zones.hasOwnProperty(t)){const i=this._zones[t],n=this._computeWhitespaceProps(i.delegate);return i.isInHiddenArea=n.isInHiddenArea,e.changeOneWhitespace(i.whitespaceId,n.afterViewLineNumber,n.heightInPx),this._safeCallOnComputedHeight(i.delegate,n.heightInPx),this.setShouldRender(),!0}return!1}shouldSuppressMouseDownOnViewZone(e){return this._zones.hasOwnProperty(e)?!!this._zones[e].delegate.suppressMouseDown:!1}_heightInPixels(e){return typeof e.heightInPx=="number"?e.heightInPx:typeof e.heightInLines=="number"?this._lineHeight*e.heightInLines:this._lineHeight}_minWidthInPixels(e){return typeof e.minWidthInPx=="number"?e.minWidthInPx:0}_safeCallOnComputedHeight(e,t){if(typeof e.onComputedHeight=="function")try{e.onComputedHeight(t)}catch(i){vt(i)}}_safeCallOnDomNodeTop(e,t){if(typeof e.onDomNodeTop=="function")try{e.onDomNodeTop(t)}catch(i){vt(i)}}prepareRender(e){}render(e){const t=e.viewportData.whitespaceViewportData,i={};let n=!1;for(const o of t)this._zones[o.id].isInHiddenArea||(i[o.id]=o,n=!0);const s=Object.keys(this._zones);for(let o=0,r=s.length;o<r;o++){const l=s[o],d=this._zones[l];let c=0,h=0,u="none";i.hasOwnProperty(l)?(c=i[l].verticalOffset-e.bigNumbersDelta,h=i[l].height,u="block",d.isVisible||(d.domNode.setAttribute("monaco-visible-view-zone","true"),d.isVisible=!0),this._safeCallOnDomNodeTop(d.delegate,e.getScrolledTopFromAbsoluteTop(i[l].verticalOffset))):(d.isVisible&&(d.domNode.removeAttribute("monaco-visible-view-zone"),d.isVisible=!1),this._safeCallOnDomNodeTop(d.delegate,e.getScrolledTopFromAbsoluteTop(-1e6))),d.domNode.setTop(c),d.domNode.setHeight(h),d.domNode.setDisplay(u),d.marginDomNode&&(d.marginDomNode.setTop(c),d.marginDomNode.setHeight(h),d.marginDomNode.setDisplay(u))}n&&(this.domNode.setWidth(Math.max(e.scrollWidth,this._contentWidth)),this.marginDomNode.setWidth(this._contentLeft))}}function Kv(a,e){try{return a(e)}catch(t){vt(t)}}const $v=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee($v);class Zv extends _n{constructor(e){super(),this._context=e,this._options=new bh(this._context.configuration),this._selection=[],this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=new bh(this._context.configuration);return this._options.equals(t)?e.hasChanged(v.layoutInfo):(this._options=t,!0)}onCursorStateChanged(e){return this._selection=e.selections,this._options.renderWhitespace==="selection"}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}prepareRender(e){if(this._options.renderWhitespace==="none"){this._renderResult=null;return}const t=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber-t+1,s=new Array(n);for(let r=0;r<n;r++)s[r]=!0;const o=this._context.viewModel.getMinimapLinesRenderingData(e.viewportData.startLineNumber,e.viewportData.endLineNumber,s);this._renderResult=[];for(let r=e.viewportData.startLineNumber;r<=e.viewportData.endLineNumber;r++){const l=r-e.viewportData.startLineNumber,d=o.data[l];let c=null;if(this._options.renderWhitespace==="selection"){const h=this._selection;for(const u of h){if(u.endLineNumber<r||u.startLineNumber>r)continue;const g=u.startLineNumber===r?u.startColumn:d.minColumn,f=u.endLineNumber===r?u.endColumn:d.maxColumn;g<f&&(c||(c=[]),c.push(new wg(g-1,f-1)))}}this._renderResult[l]=this._applyRenderWhitespace(e,r,c,d)}}_applyRenderWhitespace(e,t,i,n){if(this._options.renderWhitespace==="selection"&&!i||this._options.renderWhitespace==="trailing"&&n.continuesWithWrappedLine)return"";const s=this._context.theme.getColor(Jm),o=this._options.renderWithSVG,r=n.content,l=this._options.stopRenderingLineAfter===-1?r.length:Math.min(this._options.stopRenderingLineAfter,r.length),d=n.continuesWithWrappedLine,c=n.minColumn-1,h=this._options.renderWhitespace==="boundary",u=this._options.renderWhitespace==="trailing",g=e.getLineHeightForLineNumber(t),f=this._options.middotWidth,m=this._options.wsmiddotWidth,_=this._options.spaceWidth,L=Math.abs(m-_),w=Math.abs(f-_),p=L<w?11825:183,C=this._options.canUseHalfwidthRightwardsArrow;let b="",S=!1,y=zi(r),E;y===-1?(S=!0,y=l,E=l):E=Qo(r);let x=0,R=i&&i[x],D=0;for(let A=c;A<l;A++){const W=r.charCodeAt(A);if(R&&A>=R.endOffset&&(x++,R=i&&i[x]),W!==V.Tab&&W!==V.Space||u&&!S&&A<=E)continue;if(h&&A>=y&&A<=E&&W===V.Space){const G=A-1>=0?r.charCodeAt(A-1):V.Null,oe=A+1<l?r.charCodeAt(A+1):V.Null;if(G!==V.Space&&oe!==V.Space)continue}if(h&&d&&A===l-1){const G=A-1>=0?r.charCodeAt(A-1):V.Null;if(W===V.Space&&G!==V.Space&&G!==V.Tab)continue}if(i&&(!R||R.startOffset>A||R.endOffset<=A))continue;const H=e.visibleRangeForPosition(new I(t,A+1));H&&(o?(D=Math.max(D,H.left),W===V.Tab?b+=this._renderArrow(g,_,H.left):b+=`<circle cx="${(H.left+_/2).toFixed(2)}" cy="${(g/2).toFixed(2)}" r="${(_/7).toFixed(2)}" />`):W===V.Tab?b+=`<div class="mwh" style="left:${H.left}px;height:${g}px;">${C?"￫":"→"}</div>`:b+=`<div class="mwh" style="left:${H.left}px;height:${g}px;">${String.fromCharCode(p)}</div>`)}return o?(D=Math.round(D+_),`<svg style="bottom:0;position:absolute;width:${D}px;height:${g}px" viewBox="0 0 ${D} ${g}" xmlns="http://www.w3.org/2000/svg" fill="${s}">`+b+"</svg>"):b}_renderArrow(e,t,i){const n=t/7,s=t,o=e/2,r=i,l={x:0,y:n/2},d={x:100/125*s,y:l.y},c={x:d.x-.2*d.x,y:d.y+.2*d.x},h={x:c.x+.1*d.x,y:c.y+.1*d.x},u={x:h.x+.35*d.x,y:h.y-.35*d.x},g={x:u.x,y:-u.y},f={x:h.x,y:-h.y},m={x:c.x,y:-c.y},_={x:d.x,y:-d.y},L={x:l.x,y:-l.y};return`<path d="M ${[l,d,c,h,u,g,f,m,_,L].map(C=>`${(r+C.x).toFixed(2)} ${(o+C.y).toFixed(2)}`).join(" L ")}" />`}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}class bh{constructor(e){const t=e.options,i=t.get(v.fontInfo),n=t.get(v.experimentalWhitespaceRendering);n==="off"?(this.renderWhitespace="none",this.renderWithSVG=!1):n==="svg"?(this.renderWhitespace=t.get(v.renderWhitespace),this.renderWithSVG=!0):(this.renderWhitespace=t.get(v.renderWhitespace),this.renderWithSVG=!1),this.spaceWidth=i.spaceWidth,this.middotWidth=i.middotWidth,this.wsmiddotWidth=i.wsmiddotWidth,this.canUseHalfwidthRightwardsArrow=i.canUseHalfwidthRightwardsArrow,this.lineHeight=t.get(v.lineHeight),this.stopRenderingLineAfter=t.get(v.stopRenderingLineAfter)}equals(e){return this.renderWhitespace===e.renderWhitespace&&this.renderWithSVG===e.renderWithSVG&&this.spaceWidth===e.spaceWidth&&this.middotWidth===e.middotWidth&&this.wsmiddotWidth===e.wsmiddotWidth&&this.canUseHalfwidthRightwardsArrow===e.canUseHalfwidthRightwardsArrow&&this.lineHeight===e.lineHeight&&this.stopRenderingLineAfter===e.stopRenderingLineAfter}}class qv{constructor(e,t,i,n){this.selections=e,this.startLineNumber=t.startLineNumber|0,this.endLineNumber=t.endLineNumber|0,this.relativeVerticalOffset=t.relativeVerticalOffset,this.bigNumbersDelta=t.bigNumbersDelta|0,this.lineHeight=t.lineHeight|0,this.whitespaceViewportData=i,this._model=n,this.visibleRange=new N(t.startLineNumber,this._model.getLineMinColumn(t.startLineNumber),t.endLineNumber,this._model.getLineMaxColumn(t.endLineNumber))}getViewLineRenderingData(e){return this._model.getViewportViewLineRenderingData(this.visibleRange,e)}getDecorationsInViewport(){return this._model.getDecorationsInViewport(this.visibleRange)}}class Xv{get type(){return this._theme.type}get value(){return this._theme}constructor(e){this._theme=e}update(e){this._theme=e}getColor(e){return this._theme.getColor(e)}}class Yv{constructor(e,t,i){this.configuration=e,this.theme=new Xv(t),this.viewModel=i,this.viewLayout=i.viewLayout}addEventHandler(e){this.viewModel.addViewEventHandler(e)}removeEventHandler(e){this.viewModel.removeViewEventHandler(e)}}const Zn=new Float32Array([1,0,1,1,0,1,0,0,0,1,1,0]);function Fs(a){if(!a)throw new Error(`Value "${a}" cannot be null`);return a}function Fg(a,e,t){let i=new e.ResizeObserver(n=>{const s=n.find(l=>l.target===a);if(!s)return;if(!("devicePixelContentBoxSize"in s)){i?.disconnect(),i=void 0;return}const o=s.devicePixelContentBoxSize[0].inlineSize,r=s.devicePixelContentBoxSize[0].blockSize;o>0&&r>0&&t(o,r)});try{i.observe(a,{box:["device-pixel-content-box"]})}catch{throw i.disconnect(),i=void 0,new Fe("Could not observe device pixel dimensions")}return ke(()=>i?.disconnect())}let Qv=0;class Uo extends U{get cacheKey(){return`${this.fontFamily}_${this.fontSize}px`}constructor(e,t,i){super(),this.fontSize=e,this.fontFamily=t,this.devicePixelRatio=i,this.id=Qv++,this._workGlyph={source:null,boundingBox:{left:0,bottom:0,right:0,top:0},originOffset:{x:0,y:0},fontBoundingBoxAscent:0,fontBoundingBoxDescent:0},this._workGlyphConfig={chars:void 0,tokenMetadata:0,decorationStyleSetId:0},this._antiAliasing=Fi?"greyscale":"subpixel";const n=Math.ceil(this.fontSize*i);this._canvas=new OffscreenCanvas(n*3,n*3),this._ctx=Fs(this._canvas.getContext("2d",{willReadFrequently:!0,alpha:this._antiAliasing==="greyscale"})),this._ctx.textBaseline="top",this._ctx.fillStyle="#FFFFFF",this._ctx.font=`${n}px ${this.fontFamily}`,this._textMetrics=this._ctx.measureText("A")}rasterizeGlyph(e,t,i,n){return e===""?{source:this._canvas,boundingBox:{top:0,left:0,bottom:-1,right:-1},originOffset:{x:0,y:0},fontBoundingBoxAscent:0,fontBoundingBoxDescent:0}:this._workGlyphConfig.chars===e&&this._workGlyphConfig.tokenMetadata===t&&this._workGlyphConfig.decorationStyleSetId===i?this._workGlyph:(this._workGlyphConfig.chars=e,this._workGlyphConfig.tokenMetadata=t,this._workGlyphConfig.decorationStyleSetId=i,this._rasterizeGlyph(e,t,i,n))}_rasterizeGlyph(e,t,i,n){const s=Math.ceil(this.fontSize*this.devicePixelRatio),o=s*3;this._canvas.width!==o&&(this._canvas.width=o,this._canvas.height=o),this._ctx.save();const r=(t&15)/10,l=Qa.getBackground(t),d=n[l],c=si.decorationStyleCache.getStyleSet(i);this._antiAliasing==="subpixel"?(this._ctx.fillStyle=d,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height)):this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);const h=new Jo(200),u=Qa.getFontStyle(t);u&Dl.Italic&&h.appendString("italic "),c?.bold!==void 0?c.bold&&h.appendString("bold "):u&Dl.Bold&&h.appendString("bold "),h.appendString(`${s}px ${this.fontFamily}`),this._ctx.font=h.build();const g=s,f=s;c?.color!==void 0?this._ctx.fillStyle=`#${c.color.toString(16).padStart(8,"0")}`:this._ctx.fillStyle=n[Qa.getForeground(t)],this._ctx.textBaseline="top",c?.opacity!==void 0&&(this._ctx.globalAlpha=c.opacity),this._ctx.fillText(e,g+r,f),this._ctx.restore();const m=this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height);if(this._antiAliasing==="subpixel"){const _=parseInt(d.substring(1,3),16),L=parseInt(d.substring(3,5),16),w=parseInt(d.substring(5,7),16);this._clearColor(m,_,L,w),this._ctx.putImageData(m,0,0)}return this._findGlyphBoundingBox(m,this._workGlyph.boundingBox),this._workGlyph.source=this._canvas,this._workGlyph.originOffset.x=this._workGlyph.boundingBox.left-g,this._workGlyph.originOffset.y=this._workGlyph.boundingBox.top-f,this._workGlyph.fontBoundingBoxAscent=this._textMetrics.fontBoundingBoxAscent,this._workGlyph.fontBoundingBoxDescent=this._textMetrics.fontBoundingBoxDescent,this._workGlyph}_clearColor(e,t,i,n){for(let s=0;s<e.data.length;s+=4)e.data[s]===t&&e.data[s+1]===i&&e.data[s+2]===n&&(e.data[s+3]=0)}_findGlyphBoundingBox(e,t){const i=this._canvas.height,n=this._canvas.width;let s=!1;for(let o=0;o<i;o++){for(let r=0;r<n;r++){const l=o*n*4+r*4+3;if(e.data[l]!==0){t.top=o,s=!0;break}}if(s)break}t.left=0,s=!1;for(let o=0;o<n;o++){for(let r=0;r<i;r++){const l=r*n*4+o*4+3;if(e.data[l]!==0){t.left=o,s=!0;break}}if(s)break}t.right=n,s=!1;for(let o=n-1;o>=t.left;o--){for(let r=0;r<i;r++){const l=r*n*4+o*4+3;if(e.data[l]!==0){t.right=o,s=!0;break}}if(s)break}t.bottom=t.top,s=!1;for(let o=i-1;o>=0;o--){for(let r=0;r<n;r++){const l=o*n*4+r*4+3;if(e.data[l]!==0){t.bottom=o,s=!0;break}}if(s)break}}getTextMetrics(e){return this._ctx.measureText(e)}}Uo.__decorator=ge([ep],Uo.prototype,"cacheKey",null);class Hg extends U{constructor(){super(),this._tasks=[],this._i=0,this._register(ke(()=>this.clear()))}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let t=0,i=0,n=e.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(t=Date.now(),this._tasks[this._i]()||this._i++,t=Math.max(1,Date.now()-t),i=Math.max(t,i),s=e.timeRemaining(),i*1.5>s){n-t<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(n-t))}ms`),this._start();return}n=s}this.clear()}}class Jv extends Hg{_requestCallback(e){return De().setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){De().clearTimeout(e)}_createDeadline(e){const t=Date.now()+e;return{timeRemaining:()=>Math.max(0,t-Date.now())}}}class eb extends Hg{_requestCallback(e){return De().requestIdleCallback(e)}_cancelCallback(e){De().cancelIdleCallback(e)}}const tb="requestIdleCallback"in De()?eb:Jv;var Ni;(function(a){a.Unused="#808080",a.Used="#4040FF",a.Wasted="#FF0000",a.Restricted="#FF000088"})(Ni||(Ni={}));class ib{constructor(e,t){this._canvas=e,this._textureIndex=t,this._currentRow={x:0,y:0,h:0},this._allocatedGlyphs=new Set,this._nextIndex=0,this._ctx=Fs(this._canvas.getContext("2d",{willReadFrequently:!0}))}allocate(e){const t=e.boundingBox.right-e.boundingBox.left+1,i=e.boundingBox.bottom-e.boundingBox.top+1;if(t>this._canvas.width||i>this._canvas.height)throw new Fe("Glyph is too large for the atlas page");if(e.boundingBox.right-e.boundingBox.left+1>this._canvas.width-this._currentRow.x&&(this._currentRow.x=0,this._currentRow.y+=this._currentRow.h,this._currentRow.h=1),this._currentRow.y+e.boundingBox.bottom-e.boundingBox.top+1>this._canvas.height)return;this._ctx.drawImage(e.source,e.boundingBox.left,e.boundingBox.top,t,i,this._currentRow.x,this._currentRow.y,t,i);const n={pageIndex:this._textureIndex,glyphIndex:this._nextIndex++,x:this._currentRow.x,y:this._currentRow.y,w:t,h:i,originOffsetX:e.originOffset.x,originOffsetY:e.originOffset.y,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent};return this._currentRow.x+=t,this._currentRow.h=Math.max(this._currentRow.h,i),this._allocatedGlyphs.add(n),n}getUsagePreview(){const e=this._canvas.width,t=this._canvas.height,i=new OffscreenCanvas(e,t),n=Fs(i.getContext("2d"));n.fillStyle=Ni.Unused,n.fillRect(0,0,e,t);const s=new Map,o=new Map;for(const r of this._allocatedGlyphs)s.set(r.y,Math.max(s.get(r.y)??0,r.h)),o.set(r.y,Math.max(o.get(r.y)??0,r.x+r.w));for(const r of this._allocatedGlyphs)n.fillStyle=Ni.Used,n.fillRect(r.x,r.y,r.w,r.h),n.fillStyle=Ni.Wasted,n.fillRect(r.x,r.y+r.h,r.w,s.get(r.y)-r.h);for(const[r,l]of o.entries())r!==this._currentRow.y&&(n.fillStyle=Ni.Wasted,n.fillRect(l,r,e-l,s.get(r)));return i.convertToBlob()}getStats(){const e=this._canvas.width,t=this._canvas.height;let i=0,n=0;const s=e*t,o=new Map,r=new Map;for(const l of this._allocatedGlyphs)o.set(l.y,Math.max(o.get(l.y)??0,l.h)),r.set(l.y,Math.max(r.get(l.y)??0,l.x+l.w));for(const l of this._allocatedGlyphs)i+=l.w*l.h,n+=l.w*(o.get(l.y)-l.h);for(const[l,d]of r.entries())l!==this._currentRow.y&&(n+=(e-d)*o.get(l));return[`page${this._textureIndex}:`,`     Total: ${s} (${e}x${t})`,`      Used: ${i} (${(i/s*100).toPrecision(2)}%)`,`    Wasted: ${n} (${(n/s*100).toPrecision(2)}%)`,`Efficiency: ${(i/(i+n)*100).toPrecision(2)}%`].join(`
`)}}class nb{constructor(e,t,i){this._canvas=e,this._textureIndex=t,this._slabs=[],this._activeSlabsByDims=new Da,this._unusedRects=[],this._openRegionsByHeight=new Map,this._openRegionsByWidth=new Map,this._allocatedGlyphs=new Set,this._nextIndex=0,this._ctx=Fs(this._canvas.getContext("2d",{willReadFrequently:!0})),this._slabW=Math.min(i?.slabW??64<<Math.max(Math.floor(De().devicePixelRatio)-1,0),this._canvas.width),this._slabH=Math.min(i?.slabH??this._slabW,this._canvas.height),this._slabsPerRow=Math.floor(this._canvas.width/this._slabW),this._slabsPerColumn=Math.floor(this._canvas.height/this._slabH)}allocate(e){const t=e.boundingBox.right-e.boundingBox.left+1,i=e.boundingBox.bottom-e.boundingBox.top+1;if(t>this._canvas.width||i>this._canvas.height)throw new Fe("Glyph is too large for the atlas page");if(t>this._slabW||i>this._slabH){if(this._allocatedGlyphs.size>0)return;let d=this._canvas.width;for(;t<d/2&&i<d/2;)d/=2;this._slabW=d,this._slabH=d,this._slabsPerRow=Math.floor(this._canvas.width/this._slabW),this._slabsPerColumn=Math.floor(this._canvas.height/this._slabH)}const n={w:t,h:i};let s=this._activeSlabsByDims.get(n.w,n.h);if(s){const d=Math.floor(this._slabW/s.entryW)*Math.floor(this._slabH/s.entryH);s.count>=d&&(s=void 0)}let o,r;if(!s)if(t<i){const d=this._openRegionsByWidth.get(t);if(d?.length)for(let c=d.length-1;c>=0;c--){const h=d[c];if(h.w>=t&&h.h>=i){o=h.x,r=h.y,t<h.w&&this._unusedRects.push({x:h.x+t,y:h.y,w:h.w-t,h:i}),h.y+=i,h.h-=i,h.h===0&&(c===d.length-1?d.pop():this._unusedRects.splice(c,1));break}}}else{const d=this._openRegionsByHeight.get(i);if(d?.length)for(let c=d.length-1;c>=0;c--){const h=d[c];if(h.w>=t&&h.h>=i){o=h.x,r=h.y,i<h.h&&this._unusedRects.push({x:h.x,y:h.y+i,w:t,h:h.h-i}),h.x+=t,h.w-=t,h.h===0&&(c===d.length-1?d.pop():this._unusedRects.splice(c,1));break}}}if(o===void 0||r===void 0){if(!s){if(this._slabs.length>=this._slabsPerRow*this._slabsPerColumn)return;s={x:Math.floor(this._slabs.length%this._slabsPerRow)*this._slabW,y:Math.floor(this._slabs.length/this._slabsPerRow)*this._slabH,entryW:n.w,entryH:n.h,count:0};const c=this._slabW%s.entryW,h=this._slabH%s.entryH;c&&Sh(this._openRegionsByWidth,c,{x:s.x+this._slabW-c,w:c,y:s.y,h:this._slabH-(h??0)}),h&&Sh(this._openRegionsByHeight,h,{x:s.x,w:this._slabW,y:s.y+this._slabH-h,h}),this._slabs.push(s),this._activeSlabsByDims.set(s,n.w,n.h)}const d=Math.floor(this._slabW/s.entryW);o=s.x+Math.floor(s.count%d)*s.entryW,r=s.y+Math.floor(s.count/d)*s.entryH,s.count++}this._ctx.drawImage(e.source,e.boundingBox.left,e.boundingBox.top,t,i,o,r,t,i);const l={pageIndex:this._textureIndex,glyphIndex:this._nextIndex++,x:o,y:r,w:t,h:i,originOffsetX:e.originOffset.x,originOffsetY:e.originOffset.y,fontBoundingBoxAscent:e.fontBoundingBoxAscent,fontBoundingBoxDescent:e.fontBoundingBoxDescent};return this._allocatedGlyphs.add(l),l}getUsagePreview(){const e=this._canvas.width,t=this._canvas.height,i=new OffscreenCanvas(e,t),n=Fs(i.getContext("2d"));n.fillStyle=Ni.Unused,n.fillRect(0,0,e,t);const s=64<<Math.floor(De().devicePixelRatio)-1;for(const r of this._slabs){let l=0,d=0;for(let c=0;c<r.count;c++)l+r.entryW>s&&(l=0,d+=r.entryH),n.fillStyle=Ni.Wasted,n.fillRect(r.x+l,r.y+d,r.entryW,r.entryH),l+=r.entryW}for(const r of this._allocatedGlyphs)n.fillStyle=Ni.Used,n.fillRect(r.x,r.y,r.w,r.h);const o=Array.from(this._openRegionsByWidth.values()).flat().concat(Array.from(this._openRegionsByHeight.values()).flat());for(const r of o)n.fillStyle=Ni.Restricted,n.fillRect(r.x,r.y,r.w,r.h);return n.globalAlpha=.5,n.drawImage(this._canvas,0,0),n.globalAlpha=1,i.convertToBlob()}getStats(){const e=this._canvas.width,t=this._canvas.height;let i=0,n=0,s=0,o=0,r=0;const l=e*t,d=64<<Math.floor(De().devicePixelRatio)-1,c=d;for(const f of this._slabs){for(let w=0;w<f.count;w++)i+=f.entryW*f.entryH;const m=Math.floor(d/f.entryW),_=Math.floor(c/f.entryH),L=f.entryW*m*f.entryH*_;s+=d*c-L}for(const f of this._allocatedGlyphs)n+=f.w*f.h;const h=Array.from(this._openRegionsByWidth.values()).flat().concat(Array.from(this._openRegionsByHeight.values()).flat());for(const f of h)r+=f.w*f.h;const u=s-r;o=i-(n-u);const g=n/(n+o+r);return[`page[${this._textureIndex}]:`,`     Total: ${l}px (${e}x${t})`,`      Used: ${n}px (${(n/l*100).toFixed(2)}%)`,`    Wasted: ${o}px (${(o/l*100).toFixed(2)}%)`,`Restricted: ${r}px (${(r/l*100).toFixed(2)}%) (hard to allocate)`,`Efficiency: ${g===1?"100":(g*100).toFixed(2)}%`,`     Slabs: ${this._slabs.length} of ${Math.floor(this._canvas.width/d)*Math.floor(this._canvas.height/c)}`].join(`
`)}}function Sh(a,e,t){let i=a.get(e);i||(i=[],a.set(e,i)),i.push(t)}var Ql;let fi=class extends U{static{Ql=this}get version(){return this._version}static{this.maximumGlyphCount=5e3}get usedArea(){return this._usedArea}get source(){return this._canvas}get glyphs(){return this._glyphInOrderSet.values()}constructor(e,t,i,n,s){switch(super(),this._logService=n,this._version=0,this._usedArea={left:0,top:0,right:0,bottom:0},this._glyphMap=new Da,this._glyphInOrderSet=new Set,this._canvas=new OffscreenCanvas(t,t),this._colorMap=s.getColorTheme().tokenColorMap,i){case"shelf":this._allocator=new ib(this._canvas,e);break;case"slab":this._allocator=new nb(this._canvas,e);break;default:this._allocator=i(this._canvas,e);break}this._register(ke(()=>{this._canvas.width=1,this._canvas.height=1}))}getGlyph(e,t,i,n){return this._glyphMap.get(t,i,n,e.cacheKey)??this._createGlyph(e,t,i,n)}_createGlyph(e,t,i,n){if(this._glyphInOrderSet.size>=Ql.maximumGlyphCount)return;const s=e.rasterizeGlyph(t,i,n,this._colorMap),o=this._allocator.allocate(s);if(o!==void 0)return this._glyphMap.set(o,t,i,n,e.cacheKey),this._glyphInOrderSet.add(o),this._version++,this._usedArea.right=Math.max(this._usedArea.right,o.x+o.w-1),this._usedArea.bottom=Math.max(this._usedArea.bottom,o.y+o.h-1),this._logService.getLevel()===tp.Trace&&this._logService.trace("New glyph",{chars:t,tokenMetadata:i,decorationStyleSetId:n,rasterizedGlyph:s,glyph:o}),o}getUsagePreview(){return this._allocator.getUsagePreview()}getStats(){return this._allocator.getStats()}};fi=Ql=ge([P(3,er),P(4,sr)],fi);var Fr;let nn=class extends U{static{Fr=this}static{this.maximumPageCount=16}get pages(){return this._pages}constructor(e,t,i,n){super(),this._maxTextureSize=e,this._themeService=i,this._instantiationService=n,this._warmUpTask=this._register(new Ms),this._warmedUpRasterizers=new Set,this._pages=[],this._glyphPageIndex=new Da,this._onDidDeleteGlyphs=this._register(new Z),this.onDidDeleteGlyphs=this._onDidDeleteGlyphs.event,this._allocatorType=t?.allocatorType??"slab",this._register(mi.runAndSubscribe(this._themeService.onDidColorThemeChange,()=>{this._colorMap&&this.clear(),this._colorMap=this._themeService.getColorTheme().tokenColorMap}));const s=Math.max(1,Math.floor(De().devicePixelRatio));this.pageSize=Math.min(1024*s,this._maxTextureSize),this._initFirstPage(),this._register(ke(()=>Po(this._pages)))}_initFirstPage(){const e=this._instantiationService.createInstance(fi,0,this.pageSize,this._allocatorType);this._pages.push(e);const t=new Uo(1,"",1);e.getGlyph(t,"",0,0),t.dispose()}clear(){for(const e of this._pages)e.dispose();this._pages.length=0,this._glyphPageIndex.clear(),this._warmedUpRasterizers.clear(),this._warmUpTask.clear(),this._initFirstPage(),this._onDidDeleteGlyphs.fire()}getGlyph(e,t,i,n,s){return i&=~(Wt.LANGUAGEID_MASK|Wt.TOKEN_TYPE_MASK|Wt.BALANCED_BRACKETS_MASK),i|=Math.floor(s%1*10),this._warmedUpRasterizers.has(e.id)||(this._warmUpAtlas(e),this._warmedUpRasterizers.add(e.id)),this._tryGetGlyph(this._glyphPageIndex.get(t,i,n,e.cacheKey)??0,e,t,i,n)}_tryGetGlyph(e,t,i,n,s){return this._glyphPageIndex.set(e,i,n,s,t.cacheKey),this._pages[e].getGlyph(t,i,n,s)??(e+1<this._pages.length?this._tryGetGlyph(e+1,t,i,n,s):void 0)??this._getGlyphFromNewPage(t,i,n,s)}_getGlyphFromNewPage(e,t,i,n){if(this._pages.length>=Fr.maximumPageCount)throw new Error(`Attempt to create a texture atlas page past the limit ${Fr.maximumPageCount}`);return this._pages.push(this._instantiationService.createInstance(fi,this._pages.length,this.pageSize,this._allocatorType)),this._glyphPageIndex.set(this._pages.length-1,t,i,n,e.cacheKey),this._pages[this._pages.length-1].getGlyph(e,t,i,n)}getUsagePreview(){return Promise.all(this._pages.map(e=>e.getUsagePreview()))}getStats(){return this._pages.map(e=>e.getStats())}_warmUpAtlas(e){const t=this._colorMap;if(!t)throw new Fe("Cannot warm atlas without color map");this._warmUpTask.value?.clear();const i=this._warmUpTask.value=new tb;for(let n=V.A;n<=V.Z;n++)for(const s of t.keys())i.enqueue(()=>{for(let o=0;o<1;o+=.1)this.getGlyph(e,String.fromCharCode(n),s<<Wt.FOREGROUND_OFFSET&Wt.FOREGROUND_MASK,0,o)});for(let n=V.a;n<=V.z;n++)for(const s of t.keys())i.enqueue(()=>{for(let o=0;o<1;o+=.1)this.getGlyph(e,String.fromCharCode(n),s<<Wt.FOREGROUND_OFFSET&Wt.FOREGROUND_MASK,0,o)});for(let n=V.ExclamationMark;n<=V.Tilde;n++)for(const s of t.keys())i.enqueue(()=>{for(let o=0;o<1;o+=.1)this.getGlyph(e,String.fromCharCode(n),s<<Wt.FOREGROUND_OFFSET&Wt.FOREGROUND_MASK,0,o)})}};nn=Fr=ge([P(2,sr),P(3,Me)],nn);var Nt;(function(a){async function e(n){try{if(!navigator.gpu)throw new Error("This browser does not support WebGPU");const s=await navigator.gpu.requestAdapter();if(!s)throw new Error("This browser supports WebGPU but it appears to be disabled");return hl(await s.requestDevice())}catch(s){throw n&&n(s.message),s}}a.requestDevice=e;function t(n,s,o){const r=n.createBuffer(s);return o&&n.queue.writeBuffer(r,0,ip(o)?o():o),hl(r)}a.createBuffer=t;function i(n,s){return hl(n.createTexture(s))}a.createTexture=i})(Nt||(Nt={}));function hl(a){return{object:a,dispose:()=>a.destroy()}}class sb{get dataOffset(){return this._startIndex}get dirtySize(){if(!(this._startIndex===void 0||this._endIndex===void 0))return this._endIndex-this._startIndex+1}get isDirty(){return this._startIndex!==void 0}flag(e,t=1){return this._flag(e),t>1&&this._flag(e+t-1),e}_flag(e){(this._startIndex===void 0||e<this._startIndex)&&(this._startIndex=e),(this._endIndex===void 0||e>this._endIndex)&&(this._endIndex=e)}clear(){this._startIndex=void 0,this._endIndex=void 0}}function ob(a,e){return new rb(a,e)}class rb extends U{get bufferUsedSize(){return this.viewUsedSize*Float32Array.BYTES_PER_ELEMENT}get viewUsedSize(){return this._entries.size*this._entrySize}get entryCount(){return this._entries.size}get dirtyTracker(){return this._dirtyTracker}constructor(e,t){super(),this.propertySpecs=e,this.capacity=t,this._dirtyTracker=new sb,this._propertySpecsMap=new Map,this._entries=new Pd,this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._onDidChangeBuffer=this._register(new Z),this.onDidChangeBuffer=this._onDidChangeBuffer.event,this.view=new Float32Array(t*e.length),this.buffer=this.view.buffer,this._entrySize=e.length;for(let i=0;i<e.length;i++){const n={offset:i,...e[i]};this._propertySpecsMap.set(n.name,n)}this._register(ke(()=>Po(this._entries)))}createEntry(e){this._entries.size===this.capacity&&(this._expandBuffer(),this._onDidChangeBuffer.fire());const t=new ab(this.view,this._propertySpecsMap,this._dirtyTracker,this._entries.size,e),i=this._entries.push(t),n=[];return n.push(mi.forward(t.onDidChange,this._onDidChange)),n.push(t.onWillDispose(()=>{const s=t.i;i(),this.view.set(this.view.subarray(s*this._entrySize+2,this._entries.size*this._entrySize+2),s*this._entrySize);for(const o of this._entries)o.i>s&&o.i--;this._dirtyTracker.flag(s,(this._entries.size-s)*this._entrySize),Po(n)})),t}_expandBuffer(){this.capacity*=2;const e=new Float32Array(this.capacity*this._entrySize);e.set(this.view),this.view=e,this.buffer=this.view.buffer}}class ab extends U{constructor(e,t,i,n,s){super(),this._view=e,this._propertySpecsMap=t,this._dirtyTracker=i,this.i=n,this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._onWillDispose=this._register(new Z),this.onWillDispose=this._onWillDispose.event;for(const o of this._propertySpecsMap.values())this._view[this.i*this._propertySpecsMap.size+o.offset]=s[o.name];this._dirtyTracker.flag(this.i*this._propertySpecsMap.size,this._propertySpecsMap.size)}dispose(){this._onWillDispose.fire(),super.dispose()}set(e,t){const i=this.i*this._propertySpecsMap.size+this._propertySpecsMap.get(e).offset;this._view[this._dirtyTracker.flag(i)]=t,this._onDidChange.fire()}get(e){return this._view[this.i*this._propertySpecsMap.size+this._propertySpecsMap.get(e).offset]}setRaw(e){if(e.length!==this._propertySpecsMap.size)throw new Error(`Data length ${e.length} does not match the number of properties in the collection (${this._propertySpecsMap.size})`);this._view.set(e,this.i*this._propertySpecsMap.size),this._dirtyTracker.flag(this.i*this._propertySpecsMap.size,this._propertySpecsMap.size)}}var cn;(function(a){a[a.Shapes=0]="Shapes",a[a.LayoutInfoUniform=1]="LayoutInfoUniform",a[a.ScrollOffset=2]="ScrollOffset"})(cn||(cn={}));const lb=`

struct Vertex {
	@location(0) position: vec2f,
};

struct LayoutInfo {
	canvasDims: vec2f,
	viewportOffset: vec2f,
	viewportDims: vec2f,
}

struct ScrollOffset {
	offset: vec2f,
}

struct Shape {
	position: vec2f,
	size: vec2f,
	color: vec4f,
};

struct VSOutput {
	@builtin(position) position: vec4f,
	@location(1)       color:    vec4f,
};

// Uniforms
@group(0) @binding(${cn.LayoutInfoUniform}) var<uniform>       layoutInfo:      LayoutInfo;

// Storage buffers
@group(0) @binding(${cn.Shapes})            var<storage, read> shapes:          array<Shape>;
@group(0) @binding(${cn.ScrollOffset})      var<uniform>       scrollOffset:    ScrollOffset;

@vertex fn vs(
	vert: Vertex,
	@builtin(instance_index) instanceIndex: u32,
	@builtin(vertex_index) vertexIndex : u32
) -> VSOutput {
	let shape = shapes[instanceIndex];

	var vsOut: VSOutput;
	vsOut.position = vec4f(
		(
			// Top left corner
			vec2f(-1,  1) +
			// Convert pixel position to clipspace
			vec2f( 2, -2) / layoutInfo.canvasDims *
			// Shape position and size
			(layoutInfo.viewportOffset - scrollOffset.offset + shape.position + vert.position * shape.size)
		),
		0.0,
		1.0
	);
	vsOut.color = shape.color;
	return vsOut;
}

@fragment fn fs(vsOut: VSOutput) -> @location(0) vec4f {
	return vsOut.color;
}
`;class db extends ss{constructor(e,t,i,n,s,o){super(),this._context=e,this._contentLeft=t,this._devicePixelRatio=i,this._canvas=n,this._ctx=s,this._shapeBindBuffer=this._register(new Ms),this._initialized=!1,this._shapeCollection=this._register(ob([{name:"x"},{name:"y"},{name:"width"},{name:"height"},{name:"red"},{name:"green"},{name:"blue"},{name:"alpha"}],32)),this._context.addEventHandler(this),this._initWebgpu(o)}async _initWebgpu(e){if(this._device=await e,this._store.isDisposed)return;const t=navigator.gpu.getPreferredCanvasFormat();this._ctx.configure({device:this._device,format:t,alphaMode:"premultiplied"}),this._renderPassColorAttachment={view:null,loadOp:"load",storeOp:"store"},this._renderPassDescriptor={label:"Monaco rectangle renderer render pass",colorAttachments:[this._renderPassColorAttachment]};let i;{let r;(function(c){c[c.FloatsPerEntry=6]="FloatsPerEntry",c[c.BytesPerEntry=24]="BytesPerEntry",c[c.Offset_CanvasWidth____=0]="Offset_CanvasWidth____",c[c.Offset_CanvasHeight___=1]="Offset_CanvasHeight___",c[c.Offset_ViewportOffsetX=2]="Offset_ViewportOffsetX",c[c.Offset_ViewportOffsetY=3]="Offset_ViewportOffsetY",c[c.Offset_ViewportWidth__=4]="Offset_ViewportWidth__",c[c.Offset_ViewportHeight_=5]="Offset_ViewportHeight_"})(r||(r={}));const l=new Float32Array(r.FloatsPerEntry),d=(c=this._canvas.width,h=this._canvas.height)=>(l[r.Offset_CanvasWidth____]=c,l[r.Offset_CanvasHeight___]=h,l[r.Offset_ViewportOffsetX]=Math.ceil(this._context.configuration.options.get(v.layoutInfo).contentLeft*De().devicePixelRatio),l[r.Offset_ViewportOffsetY]=0,l[r.Offset_ViewportWidth__]=l[r.Offset_CanvasWidth____]-l[r.Offset_ViewportOffsetX],l[r.Offset_ViewportHeight_]=l[r.Offset_CanvasHeight___]-l[r.Offset_ViewportOffsetY],l);i=this._register(Nt.createBuffer(this._device,{label:"Monaco rectangle renderer uniform buffer",size:r.BytesPerEntry,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},()=>d())).object,this._register(Fg(this._canvas,De(),(c,h)=>{this._device.queue.writeBuffer(i,0,d(c,h))}))}const n=2;this._scrollOffsetBindBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco rectangle renderer scroll offset buffer",size:n*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})).object,this._scrollOffsetValueBuffer=new Float32Array(n);const s=()=>Nt.createBuffer(this._device,{label:"Monaco rectangle renderer shape buffer",size:this._shapeCollection.buffer.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});this._shapeBindBuffer.value=s(),this._register(mi.runAndSubscribe(this._shapeCollection.onDidChangeBuffer,()=>{this._shapeBindBuffer.value=s(),this._pipeline&&this._updateBindGroup(this._pipeline,i)})),this._vertexBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco rectangle renderer vertex buffer",size:Zn.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST},Zn)).object;const o=this._device.createShaderModule({label:"Monaco rectangle renderer shader module",code:lb});this._pipeline=this._device.createRenderPipeline({label:"Monaco rectangle renderer render pipeline",layout:"auto",vertex:{module:o,buffers:[{arrayStride:2*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:o,targets:[{format:t,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]}}),this._updateBindGroup(this._pipeline,i),this._initialized=!0}_updateBindGroup(e,t){this._bindGroup=this._device.createBindGroup({label:"Monaco rectangle renderer bind group",layout:e.getBindGroupLayout(0),entries:[{binding:cn.Shapes,resource:{buffer:this._shapeBindBuffer.value.object}},{binding:cn.LayoutInfoUniform,resource:{buffer:t}},{binding:cn.ScrollOffset,resource:{buffer:this._scrollOffsetBindBuffer}}]})}register(e,t,i,n,s,o,r,l){return this._shapeCollection.createEntry({x:e,y:t,width:i,height:n,red:s,green:o,blue:r,alpha:l})}onScrollChanged(e){if(this._device){const t=De().devicePixelRatio;this._scrollOffsetValueBuffer[0]=this._context.viewLayout.getCurrentScrollLeft()*t,this._scrollOffsetValueBuffer[1]=this._context.viewLayout.getCurrentScrollTop()*t,this._device.queue.writeBuffer(this._scrollOffsetBindBuffer,0,this._scrollOffsetValueBuffer)}return!0}_update(){if(!this._device)return;const e=this._shapeCollection;e.dirtyTracker.isDirty&&(this._device.queue.writeBuffer(this._shapeBindBuffer.value.object,0,e.buffer,e.dirtyTracker.dataOffset,e.dirtyTracker.dirtySize*e.view.BYTES_PER_ELEMENT),e.dirtyTracker.clear())}draw(e){if(!this._initialized)return;this._update();const t=this._device.createCommandEncoder({label:"Monaco rectangle renderer command encoder"});this._renderPassColorAttachment.view=this._ctx.getCurrentTexture().createView();const i=t.beginRenderPass(this._renderPassDescriptor);i.setPipeline(this._pipeline),i.setVertexBuffer(0,this._vertexBuffer),i.setBindGroup(0,this._bindGroup);const n=Math.ceil(this._contentLeft.get()*this._devicePixelRatio.get());i.setScissorRect(n,0,this._canvas.width-n,this._canvas.height),i.draw(Zn.length/2,this._shapeCollection.entryCount),i.end();const s=t.finish();this._device.queue.submit([s])}}const cb=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(cb);class hb extends U{constructor(){super(),this._ruleCache=new Map,this._container=bs("div.monaco-decoration-css-rule-extractor"),this._dummyElement=bs("span"),this._container.appendChild(this._dummyElement),this._register(ke(()=>this._container.remove()))}getStyleRules(e,t){const i=this._ruleCache.get(t);if(i)return i;this._dummyElement.className=t,e.appendChild(this._container);const n=this._getStyleRules(t);return this._ruleCache.set(t,n),e.removeChild(this._container),n}_getStyleRules(e){const t=[],n=[...np().styleSheets];for(let s=0;s<n.length;s++){const o=n[s];for(const r of o.cssRules)if(r instanceof CSSImportRule)r.styleSheet&&n.push(r.styleSheet);else if(r instanceof CSSStyleRule){const l=`.${e}`,d=r.selectorText.indexOf(l);if(d!==-1){const c=d+l.length;(r.selectorText.length===c||r.selectorText.substring(c,c+1).match(/[ :]/))&&t.push(r)}}}return t}}class ub{constructor(){this._nextId=1,this._cacheById=new Map,this._cacheByStyle=new Da}getOrCreateEntry(e,t,i){if(e===void 0&&t===void 0&&i===void 0)return 0;const n=this._cacheByStyle.get(e??0,t?1:0,i===void 0?"":i.toFixed(2));if(n)return n.id;const s=this._nextId++,o={id:s,color:e,bold:t,opacity:i};return this._cacheById.set(s,o),this._cacheByStyle.set(o,e??0,t?1:0,i===void 0?"":i.toFixed(2)),s}getStyleSet(e){if(e!==0)return this._cacheById.get(e)}}function ra(a,e){return a.isBasicASCII&&e.useMonospaceOptimizations?new gb(a):new fb(a)}class gb{constructor(e){this._content=e.content}getSegmentAtIndex(e){return this._content[e]}getSegmentData(e){}}class fb{constructor(e){this._segments=[];const t=e.content,i=sp.Segmenter(void 0,{granularity:"grapheme"}),n=Array.from(i.segment(t));let s=0;for(let o=0;o<t.length;o++){const r=n[s];if(!r)break;if(r.index!==o){this._segments.push(void 0);continue}s++,this._segments.push(r)}}getSegmentAtIndex(e){return this._segments[e]?.segment}getSegmentData(e){return this._segments[e]}}var ft;(function(a){a[a.GlyphInfo=0]="GlyphInfo",a[a.Cells=1]="Cells",a[a.TextureSampler=2]="TextureSampler",a[a.Texture=3]="Texture",a[a.LayoutInfoUniform=4]="LayoutInfoUniform",a[a.AtlasDimensionsUniform=5]="AtlasDimensionsUniform",a[a.ScrollOffset=6]="ScrollOffset"})(ft||(ft={}));class Bg extends ss{get glyphRasterizer(){return this._glyphRasterizer.value}constructor(e,t,i,n){super(),this._context=e,this._viewGpuContext=t,this._device=i,this._glyphRasterizer=n,this._context.addEventHandler(this)}}const zg=`
struct GlyphInfo {
	position: vec2f,
	size: vec2f,
	origin: vec2f,
};

struct Vertex {
	@location(0) position: vec2f,
};

struct Cell {
	position: vec2f,
	unused1: vec2f,
	glyphIndex: f32,
	textureIndex: f32
};

struct LayoutInfo {
	canvasDims: vec2f,
	viewportOffset: vec2f,
	viewportDims: vec2f,
}

struct ScrollOffset {
	offset: vec2f
}

struct VSOutput {
	@builtin(position) position:   vec4f,
	@location(1)       layerIndex: f32,
	@location(0)       texcoord:   vec2f,
};

// Uniforms
@group(0) @binding(${ft.LayoutInfoUniform})       var<uniform>       layoutInfo:      LayoutInfo;
@group(0) @binding(${ft.AtlasDimensionsUniform})  var<uniform>       atlasDims:       vec2f;
@group(0) @binding(${ft.ScrollOffset})            var<uniform>       scrollOffset:    ScrollOffset;

// Storage buffers
@group(0) @binding(${ft.GlyphInfo})               var<storage, read> glyphInfo:       array<array<GlyphInfo, ${fi.maximumGlyphCount}>, ${nn.maximumPageCount}>;
@group(0) @binding(${ft.Cells})                   var<storage, read> cells:           array<Cell>;

@vertex fn vs(
	vert: Vertex,
	@builtin(instance_index) instanceIndex: u32,
	@builtin(vertex_index) vertexIndex : u32
) -> VSOutput {
	let cell = cells[instanceIndex];
	var glyph = glyphInfo[u32(cell.textureIndex)][u32(cell.glyphIndex)];

	var vsOut: VSOutput;
	// Multiple vert.position by 2,-2 to get it into clipspace which ranged from -1 to 1
	vsOut.position = vec4f(
		// Make everything relative to top left instead of center
		vec2f(-1, 1) +
		((vert.position * vec2f(2, -2)) / layoutInfo.canvasDims) * glyph.size +
		((cell.position * vec2f(2, -2)) / layoutInfo.canvasDims) +
		((glyph.origin * vec2f(2, -2)) / layoutInfo.canvasDims) +
		(((layoutInfo.viewportOffset - scrollOffset.offset * vec2(1, -1)) * 2) / layoutInfo.canvasDims),
		0.0,
		1.0
	);

	vsOut.layerIndex = cell.textureIndex;
	// Textures are flipped from natural direction on the y-axis, so flip it back
	vsOut.texcoord = vert.position;
	vsOut.texcoord = (
		// Glyph offset (0-1)
		(glyph.position / atlasDims) +
		// Glyph coordinate (0-1)
		(vsOut.texcoord * (glyph.size / atlasDims))
	);

	return vsOut;
}

@group(0) @binding(${ft.TextureSampler}) var ourSampler: sampler;
@group(0) @binding(${ft.Texture})        var ourTexture: texture_2d_array<f32>;

@fragment fn fs(vsOut: VSOutput) -> @location(0) vec4f {
	return textureSample(ourTexture, ourSampler, vsOut.texcoord, u32(vsOut.layerIndex));
}
`;var ui;(function(a){a[a.IndicesPerCell=6]="IndicesPerCell",a[a.CellBindBufferCapacityIncrement=32]="CellBindBufferCapacityIncrement",a[a.CellBindBufferInitialCapacity=63]="CellBindBufferInitialCapacity"})(ui||(ui={}));var Tn;(function(a){a[a.FloatsPerEntry=6]="FloatsPerEntry",a[a.BytesPerEntry=24]="BytesPerEntry",a[a.Offset_X=0]="Offset_X",a[a.Offset_Y=1]="Offset_Y",a[a.Offset_Unused1=2]="Offset_Unused1",a[a.Offset_Unused2=3]="Offset_Unused2",a[a.GlyphIndex=4]="GlyphIndex",a[a.TextureIndex=5]="TextureIndex"})(Tn||(Tn={}));class yi extends Bg{static{this.maxSupportedColumns=2e3}get bindGroupEntries(){return[{binding:ft.Cells,resource:{buffer:this._cellBindBuffer}},{binding:ft.ScrollOffset,resource:{buffer:this._scrollOffsetBindBuffer}}]}constructor(e,t,i,n){super(e,t,i,n),this.type="viewport",this.wgsl=zg,this._cellBindBufferLineCapacity=ui.CellBindBufferInitialCapacity,this._activeDoubleBufferIndex=0,this._visibleObjectCount=0,this._scrollInitialized=!1,this._onDidChangeBindGroupEntries=this._register(new Z),this.onDidChangeBindGroupEntries=this._onDidChangeBindGroupEntries.event,this._rebuildCellBuffer(this._cellBindBufferLineCapacity);const s=2;this._scrollOffsetBindBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco scroll offset buffer",size:s*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})).object,this._scrollOffsetValueBuffer=new Float32Array(s)}_rebuildCellBuffer(e){this._cellBindBuffer?.destroy();const t=(Math.floor(e/ui.CellBindBufferCapacityIncrement)+1)*ui.CellBindBufferCapacityIncrement,i=t*yi.maxSupportedColumns*ui.IndicesPerCell*Float32Array.BYTES_PER_ELEMENT;this._cellBindBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco full file cell buffer",size:i,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})).object,this._cellValueBuffers=[new ArrayBuffer(i),new ArrayBuffer(i)],this._cellBindBufferLineCapacity=t,this._onDidChangeBindGroupEntries.fire()}onConfigurationChanged(e){return!0}onDecorationsChanged(e){return!0}onTokensChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onLinesChanged(e){return!0}onScrollChanged(e){const t=De().devicePixelRatio;return this._scrollOffsetValueBuffer[0]=(e?.scrollLeft??this._context.viewLayout.getCurrentScrollLeft())*t,this._scrollOffsetValueBuffer[1]=(e?.scrollTop??this._context.viewLayout.getCurrentScrollTop())*t,this._device.queue.writeBuffer(this._scrollOffsetBindBuffer,0,this._scrollOffsetValueBuffer),!0}onThemeChanged(e){return!0}onLineMappingChanged(e){return!0}onZonesChanged(e){return!0}reset(){for(const e of[0,1]){const t=new Float32Array(this._cellValueBuffers[e]);t.fill(0,0,t.length),this._device.queue.writeBuffer(this._cellBindBuffer,0,t.buffer,0,t.byteLength)}}update(e,t){let i="",n,s=0,o=0,r=0,l=0,d=0,c=0,h,u=0,g=0,f=0,m=0,_,L,w,p,C,b=0,S=0,y;const E=De().devicePixelRatio;let x;this._scrollInitialized||(this.onScrollChanged(),this._scrollInitialized=!0),this._cellBindBufferLineCapacity<e.endLineNumber-e.startLineNumber+1&&this._rebuildCellBuffer(e.endLineNumber-e.startLineNumber+1);const R=new Float32Array(this._cellValueBuffers[this._activeDoubleBufferIndex]);R.fill(0);const D=yi.maxSupportedColumns*ui.IndicesPerCell;for(o=e.startLineNumber;o<=e.endLineNumber;o++)if(this._viewGpuContext.canRender(t,e,o)){p=e.getViewLineRenderingData(o),c=0,x=ra(p,t),s=t.spaceWidth*E,l=0,y=p.tokens,g=p.minColumn-1,f=0;for(let W=0,H=y.getCount();W<H;W++)if(f=y.getEndOffset(W),!(f<=g)){for(m=y.getMetadata(W),r=g;r<f&&!(r>yi.maxSupportedColumns);r++){if(n=x.getSegmentAtIndex(r),n===void 0)continue;i=n,p.isBasicASCII&&t.useMonospaceOptimizations||(s=this.glyphRasterizer.getTextMetrics(i).width),L=void 0,_=void 0,w=void 0;for(C of p.inlineDecorations){if(o<C.range.startLineNumber||o>C.range.endLineNumber||o===C.range.startLineNumber&&r<C.range.startColumn-1||o===C.range.endLineNumber&&r>=C.range.endColumn-1)continue;const oe=si.decorationCssRuleExtractor.getStyleRules(this._viewGpuContext.canvas.domNode,C.inlineClassName);for(const X of oe)for(const te of X.style){const F=X.styleMap.get(te)?.toString()??"";switch(te){case"color":{const Q=_i.Format.CSS.parse(F);if(!Q)throw new Fe("Invalid color format "+F);L=Q.toNumber32Bit();break}case"font-weight":{mb(F)>=400?_=!0:_=!1;break}case"opacity":{w=pb(F);break}default:throw new Fe("Unexpected inline decoration style")}}}if(i===" "||i==="	"){if(u=((o-1)*yi.maxSupportedColumns+r)*ui.IndicesPerCell,R.fill(0,u,u+Tn.FloatsPerEntry),i==="	"){const oe=r+c;c=We.nextRenderTabStop(r+c,p.tabSize),l+=s*(c-oe),c-=r+1}else l+=s;continue}const G=si.decorationStyleCache.getOrCreateEntry(L,_,w);h=this._viewGpuContext.atlas.getGlyph(this.glyphRasterizer,i,m,G,l),d=Math.round(e.relativeVerticalOffset[o-e.startLineNumber]*E+Math.floor((e.lineHeight*E-(h.fontBoundingBoxAscent+h.fontBoundingBoxDescent))/2)+h.fontBoundingBoxAscent),u=((o-e.startLineNumber)*yi.maxSupportedColumns+r)*ui.IndicesPerCell,R[u+Tn.Offset_X]=Math.floor(l),R[u+Tn.Offset_Y]=d,R[u+Tn.GlyphIndex]=h.glyphIndex,R[u+Tn.TextureIndex]=h.pageIndex,l+=s}g=f}b=((o-e.startLineNumber)*yi.maxSupportedColumns+f)*ui.IndicesPerCell,S=(o-e.startLineNumber)*yi.maxSupportedColumns*ui.IndicesPerCell,R.fill(0,b,S)}const A=(e.endLineNumber-e.startLineNumber+1)*D;return this._device.queue.writeBuffer(this._cellBindBuffer,0,R.buffer,0,(e.endLineNumber-e.startLineNumber)*D*Float32Array.BYTES_PER_ELEMENT),this._activeDoubleBufferIndex=this._activeDoubleBufferIndex?0:1,this._visibleObjectCount=A,A}draw(e,t){if(this._visibleObjectCount<=0)throw new Fe("Attempt to draw 0 objects");e.draw(Zn.length/2,this._visibleObjectCount)}}function mb(a){switch(a){case"lighter":case"normal":return 400;case"bolder":case"bold":return 700}return parseInt(a)}function pb(a){return a.endsWith("%")?parseFloat(a.substring(0,a.length-1))/100:a.match(/^\d+(?:\.\d*)/)?parseFloat(a):1}var xt;let si=class extends U{static{xt=this}static{this._decorationCssRuleExtractor=new hb}static get decorationCssRuleExtractor(){return xt._decorationCssRuleExtractor}static{this._decorationStyleCache=new ub}static get decorationStyleCache(){return xt._decorationStyleCache}static get atlas(){if(!xt._atlas)throw new Fe("Cannot call ViewGpuContext.textureAtlas before device is resolved");return xt._atlas}get atlas(){return xt.atlas}constructor(e,t,i,n){super(),this._instantiationService=t,this._notificationService=i,this.configurationService=n,this.maxGpuCols=yi.maxSupportedColumns,this.canvas=fe(document.createElement("canvas")),this.canvas.setClassName("editorCanvas"),this._register(mi.runAndSubscribe(n.onDidChangeConfiguration,l=>{if(!l||l.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")){const d=n.getValue("editor").scrollbar?.verticalScrollbarSize??14;this.canvas.domNode.style.boxSizing="border-box",this.canvas.domNode.style.paddingRight=`${d}px`}})),this.ctx=Fs(this.canvas.domNode.getContext("webgpu")),xt.device||(xt.device=Nt.requestDevice(l=>{const d=[{label:O(144,"Use DOM-based rendering"),run:()=>this.configurationService.updateValue("editor.experimentalGpuAcceleration","off")}];this._notificationService.prompt(Au.Warning,l,d)}).then(l=>(xt.deviceSync=l.object,xt._atlas||(xt._atlas=this._instantiationService.createInstance(nn,l.object.limits.maxTextureDimension2D,void 0)),l.object)));const s=J(this,De().devicePixelRatio);this._register(Y(De(),"resize",()=>{s.set(De().devicePixelRatio,void 0)})),this.devicePixelRatio=s,this._register(Dr(this.devicePixelRatio,()=>xt.atlas?.clear()));const o=J(this,{width:this.canvas.domNode.width,height:this.canvas.domNode.height});this._register(Fg(this.canvas.domNode,De(),(l,d)=>{this.canvas.domNode.width=l,this.canvas.domNode.height=d,o.set({width:l,height:d},void 0)})),this.canvasDevicePixelDimensions=o;const r=J(this,0);this._register(this.configurationService.onDidChangeConfiguration(l=>{r.set(e.configuration.options.get(v.layoutInfo).contentLeft,void 0)})),this.contentLeft=r,this.rectangleRenderer=this._instantiationService.createInstance(db,e,this.contentLeft,this.devicePixelRatio,this.canvas.domNode,this.ctx,xt.device)}canRender(e,t,i){const n=t.getViewLineRenderingData(i);if(n.containsRTL||n.maxColumn>this.maxGpuCols)return!1;if(n.inlineDecorations.length>0){let s=!0;for(const o of n.inlineDecorations){if(o.type!==Be.Regular){s=!1;break}const r=xt._decorationCssRuleExtractor.getStyleRules(this.canvas.domNode,o.inlineClassName);if(s&&=r.every(l=>{if(l.selectorText.includes(":"))return!1;for(const d of l.style)if(!yh(d))return!1;return!0}),!s)break}return s}return!0}canRenderDetailed(e,t,i){const n=t.getViewLineRenderingData(i),s=[];if(n.containsRTL&&s.push("containsRTL"),n.maxColumn>this.maxGpuCols&&s.push("maxColumn > maxGpuCols"),n.inlineDecorations.length>0){let o=!0;const r=[],l=[],d=[];for(const c of n.inlineDecorations){if(c.type!==Be.Regular){r.push(c.type),o=!1;continue}const h=xt._decorationCssRuleExtractor.getStyleRules(this.canvas.domNode,c.inlineClassName);o&&=h.every(u=>{if(u.selectorText.includes(":"))return l.push(u.selectorText),!1;for(const g of u.style)if(!yh(g))return d.push(`${g}: ${u.style[g]}`),!1;return!0})}r.length>0&&s.push(`inlineDecorations with unsupported types (${r.map(c=>`\`${c}\``).join(", ")})`),d.length>0&&s.push(`inlineDecorations with unsupported CSS rules (${d.map(c=>`\`${c}\``).join(", ")})`),l.length>0&&s.push(`inlineDecorations with unsupported CSS selectors (${l.map(c=>`\`${c}\``).join(", ")})`)}return s}};si=xt=ge([P(1,Me),P(2,is),P(3,Gi)],si);const _b=["color","font-weight","opacity"];function yh(a,e){return!!_b.includes(a)}var $t;(function(a){a[a.IndicesPerCell=6]="IndicesPerCell"})($t||($t={}));var Mn;(function(a){a[a.FloatsPerEntry=6]="FloatsPerEntry",a[a.BytesPerEntry=24]="BytesPerEntry",a[a.Offset_X=0]="Offset_X",a[a.Offset_Y=1]="Offset_Y",a[a.Offset_Unused1=2]="Offset_Unused1",a[a.Offset_Unused2=3]="Offset_Unused2",a[a.GlyphIndex=4]="GlyphIndex",a[a.TextureIndex=5]="TextureIndex"})(Mn||(Mn={}));class ze extends Bg{static{this.maxSupportedLines=3e3}static{this.maxSupportedColumns=200}get bindGroupEntries(){return[{binding:ft.Cells,resource:{buffer:this._cellBindBuffer}},{binding:ft.ScrollOffset,resource:{buffer:this._scrollOffsetBindBuffer}}]}constructor(e,t,i,n){super(e,t,i,n),this.type="fullfile",this.wgsl=zg,this._activeDoubleBufferIndex=0,this._upToDateLines=[new Set,new Set],this._visibleObjectCount=0,this._finalRenderedLine=0,this._scrollInitialized=!1,this._queuedBufferUpdates=[[],[]];const s=ze.maxSupportedLines*ze.maxSupportedColumns*$t.IndicesPerCell*Float32Array.BYTES_PER_ELEMENT;this._cellBindBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco full file cell buffer",size:s,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})).object,this._cellValueBuffers=[new ArrayBuffer(s),new ArrayBuffer(s)];const o=2;this._scrollOffsetBindBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco scroll offset buffer",size:o*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})).object,this._scrollOffsetValueBuffer=new Float32Array(o)}onConfigurationChanged(e){return this._invalidateAllLines(),this._queueBufferUpdate(e),!0}onDecorationsChanged(e){return this._invalidateAllLines(),!0}onTokensChanged(e){for(const t of e.ranges)this._invalidateLineRange(t.fromLineNumber,t.toLineNumber);return!0}onLinesDeleted(e){return this._invalidateLinesFrom(e.fromLineNumber),this._queueBufferUpdate(e),!0}onLinesInserted(e){return this._invalidateLinesFrom(e.fromLineNumber),!0}onLinesChanged(e){return this._invalidateLineRange(e.fromLineNumber,e.fromLineNumber+e.count),!0}onScrollChanged(e){const t=De().devicePixelRatio;return this._scrollOffsetValueBuffer[0]=(e?.scrollLeft??this._context.viewLayout.getCurrentScrollLeft())*t,this._scrollOffsetValueBuffer[1]=(e?.scrollTop??this._context.viewLayout.getCurrentScrollTop())*t,this._device.queue.writeBuffer(this._scrollOffsetBindBuffer,0,this._scrollOffsetValueBuffer),!0}onThemeChanged(e){return this._invalidateAllLines(),!0}onLineMappingChanged(e){return this._invalidateAllLines(),this._queueBufferUpdate(e),!0}onZonesChanged(e){return this._invalidateAllLines(),this._queueBufferUpdate(e),!0}_invalidateAllLines(){this._upToDateLines[0].clear(),this._upToDateLines[1].clear()}_invalidateLinesFrom(e){for(const t of[0,1]){const i=this._upToDateLines[t];for(const n of i)n>=e&&i.delete(n)}}_invalidateLineRange(e,t){for(let i=e;i<=t;i++)this._upToDateLines[0].delete(i),this._upToDateLines[1].delete(i)}reset(){this._invalidateAllLines();for(const e of[0,1]){const t=new Float32Array(this._cellValueBuffers[e]);t.fill(0,0,t.length),this._device.queue.writeBuffer(this._cellBindBuffer,0,t.buffer,0,t.byteLength)}this._finalRenderedLine=0}update(e,t){let i="",n,s=0,o=0,r=0,l=0,d=0,c=0,h,u=0,g=0,f=0,m=0,_,L,w,p,C,b=0,S=0,y;const E=De().devicePixelRatio;let x;this._scrollInitialized||(this.onScrollChanged(),this._scrollInitialized=!0);const R=new Float32Array(this._cellValueBuffers[this._activeDoubleBufferIndex]),D=ze.maxSupportedColumns*$t.IndicesPerCell,A=this._upToDateLines[this._activeDoubleBufferIndex];let W=3e3,H=0;const G=this._queuedBufferUpdates[this._activeDoubleBufferIndex];for(;G.length;){const X=G.shift();switch(X.type){case ue.ViewConfigurationChanged:case ue.ViewLineMappingChanged:case ue.ViewZonesChanged:{R.fill(0),W=1,H=Math.max(H,this._finalRenderedLine),this._finalRenderedLine=0;break}case ue.ViewLinesDeleted:{const te=(X.fromLineNumber-1)*ze.maxSupportedColumns*$t.IndicesPerCell,F=X.toLineNumber*ze.maxSupportedColumns*$t.IndicesPerCell,Q=(this._finalRenderedLine-(X.toLineNumber-X.fromLineNumber+1))*ze.maxSupportedColumns*$t.IndicesPerCell;R.set(R.subarray(F),te),R.fill(0,Q),W=Math.min(W,X.fromLineNumber),H=Math.max(H,this._finalRenderedLine),this._finalRenderedLine-=X.toLineNumber-X.fromLineNumber+1;break}}}for(o=e.startLineNumber;o<=e.endLineNumber;o++){if(!this._viewGpuContext.canRender(t,e,o)){b=(o-1)*ze.maxSupportedColumns*$t.IndicesPerCell,S=o*ze.maxSupportedColumns*$t.IndicesPerCell,R.fill(0,b,S),W=Math.min(W,o),H=Math.max(H,o);continue}if(!A.has(o)){W=Math.min(W,o),H=Math.max(H,o),p=e.getViewLineRenderingData(o),c=0,x=ra(p,t),s=t.spaceWidth*E,l=0,y=p.tokens,g=p.minColumn-1,f=0;for(let X=0,te=y.getCount();X<te;X++)if(f=y.getEndOffset(X),!(f<=g)){for(m=y.getMetadata(X),r=g;r<f&&!(r>ze.maxSupportedColumns);r++){if(n=x.getSegmentAtIndex(r),n===void 0)continue;i=n,p.isBasicASCII&&t.useMonospaceOptimizations||(s=this.glyphRasterizer.getTextMetrics(i).width),L=void 0,_=void 0,w=void 0;for(C of p.inlineDecorations){if(o<C.range.startLineNumber||o>C.range.endLineNumber||o===C.range.startLineNumber&&r<C.range.startColumn-1||o===C.range.endLineNumber&&r>=C.range.endColumn-1)continue;const Q=si.decorationCssRuleExtractor.getStyleRules(this._viewGpuContext.canvas.domNode,C.inlineClassName);for(const ve of Q)for(const Pt of ve.style){const ai=ve.styleMap.get(Pt)?.toString()??"";switch(Pt){case"color":{const li=_i.Format.CSS.parse(ai);if(!li)throw new Fe("Invalid color format "+ai);L=li.toNumber32Bit();break}case"font-weight":{Cb(ai)>=400?_=!0:_=!1;break}case"opacity":{w=wb(ai);break}default:throw new Fe("Unexpected inline decoration style")}}}if(i===" "||i==="	"){if(u=((o-1)*ze.maxSupportedColumns+r)*$t.IndicesPerCell,R.fill(0,u,u+Mn.FloatsPerEntry),i==="	"){const Q=r+c;c=We.nextRenderTabStop(r+c,p.tabSize),l+=s*(c-Q),c-=r+1}else l+=s;continue}const F=si.decorationStyleCache.getOrCreateEntry(L,_,w);h=this._viewGpuContext.atlas.getGlyph(this.glyphRasterizer,i,m,F,l),d=Math.round(e.relativeVerticalOffset[o-e.startLineNumber]*E+Math.floor((e.lineHeight*E-(h.fontBoundingBoxAscent+h.fontBoundingBoxDescent))/2)+h.fontBoundingBoxAscent),u=((o-1)*ze.maxSupportedColumns+r)*$t.IndicesPerCell,R[u+Mn.Offset_X]=Math.floor(l),R[u+Mn.Offset_Y]=d,R[u+Mn.GlyphIndex]=h.glyphIndex,R[u+Mn.TextureIndex]=h.pageIndex,l+=s}g=f}b=((o-1)*ze.maxSupportedColumns+f)*$t.IndicesPerCell,S=o*ze.maxSupportedColumns*$t.IndicesPerCell,R.fill(0,b,S),A.add(o)}}const oe=(e.endLineNumber-e.startLineNumber+1)*D;return W=Math.min(W,ze.maxSupportedLines),H=Math.min(H,ze.maxSupportedLines),W<=H&&this._device.queue.writeBuffer(this._cellBindBuffer,(W-1)*D*Float32Array.BYTES_PER_ELEMENT,R.buffer,(W-1)*D*Float32Array.BYTES_PER_ELEMENT,(H-W+1)*D*Float32Array.BYTES_PER_ELEMENT),this._finalRenderedLine=Math.max(this._finalRenderedLine,H),this._activeDoubleBufferIndex=this._activeDoubleBufferIndex?0:1,this._visibleObjectCount=oe,oe}draw(e,t){if(this._visibleObjectCount<=0)throw new Fe("Attempt to draw 0 objects");e.draw(Zn.length/2,this._visibleObjectCount,void 0,(t.startLineNumber-1)*ze.maxSupportedColumns)}_queueBufferUpdate(e){this._queuedBufferUpdates[0].push(e),this._queuedBufferUpdates[1].push(e)}}function Cb(a){switch(a){case"lighter":case"normal":return 400;case"bolder":case"bold":return 700}return parseInt(a)}function wb(a){return a.endsWith("%")?parseFloat(a.substring(0,a.length-1))/100:a.match(/^\d+(?:\.\d*)/)?parseFloat(a):1}var Tt;(function(a){a[a.FloatsPerEntry=6]="FloatsPerEntry",a[a.BytesPerEntry=24]="BytesPerEntry",a[a.Offset_TexturePosition=0]="Offset_TexturePosition",a[a.Offset_TextureSize=2]="Offset_TextureSize",a[a.Offset_OriginPosition=4]="Offset_OriginPosition"})(Tt||(Tt={}));let Jl=class extends St{constructor(e,t,i,n){super(e),this._viewGpuContext=t,this._instantiationService=i,this._logService=n,this._atlasGpuTextureVersions=[],this._initialized=!1,this._glyphRasterizer=this._register(new Ms),this._renderStrategy=this._register(new Ms),this.canvas=this._viewGpuContext.canvas.domNode,this._register(ce(s=>{this._viewGpuContext.canvasDevicePixelDimensions.read(s);const o=this._lastViewportData;o&&setTimeout(()=>{o===this._lastViewportData&&this.renderText(o)})})),this.initWebgpu()}async initWebgpu(){if(this._device=si.deviceSync||await si.device,this._store.isDisposed)return;const e=si.atlas;this._register(e.onDidDeleteGlyphs(()=>{this._atlasGpuTextureVersions.length=0,this._atlasGpuTextureVersions[0]=0,this._atlasGpuTextureVersions[1]=0,this._renderStrategy.value.reset()}));const t=navigator.gpu.getPreferredCanvasFormat();this._viewGpuContext.ctx.configure({device:this._device,format:t,alphaMode:"premultiplied"}),this._renderPassColorAttachment={view:null,loadOp:"load",storeOp:"store"},this._renderPassDescriptor={label:"Monaco render pass",colorAttachments:[this._renderPassColorAttachment]};let i;{let l;(function(h){h[h.FloatsPerEntry=6]="FloatsPerEntry",h[h.BytesPerEntry=24]="BytesPerEntry",h[h.Offset_CanvasWidth____=0]="Offset_CanvasWidth____",h[h.Offset_CanvasHeight___=1]="Offset_CanvasHeight___",h[h.Offset_ViewportOffsetX=2]="Offset_ViewportOffsetX",h[h.Offset_ViewportOffsetY=3]="Offset_ViewportOffsetY",h[h.Offset_ViewportWidth__=4]="Offset_ViewportWidth__",h[h.Offset_ViewportHeight_=5]="Offset_ViewportHeight_"})(l||(l={}));const d=new Float32Array(l.FloatsPerEntry),c=(h=this.canvas.width,u=this.canvas.height)=>(d[l.Offset_CanvasWidth____]=h,d[l.Offset_CanvasHeight___]=u,d[l.Offset_ViewportOffsetX]=Math.ceil(this._context.configuration.options.get(v.layoutInfo).contentLeft*De().devicePixelRatio),d[l.Offset_ViewportOffsetY]=0,d[l.Offset_ViewportWidth__]=d[l.Offset_CanvasWidth____]-d[l.Offset_ViewportOffsetX],d[l.Offset_ViewportHeight_]=d[l.Offset_CanvasHeight___]-d[l.Offset_ViewportOffsetY],d);i=this._register(Nt.createBuffer(this._device,{label:"Monaco uniform buffer",size:l.BytesPerEntry,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},()=>c())).object,this._register(Dr(this._viewGpuContext.canvasDevicePixelDimensions,({width:h,height:u})=>{this._device.queue.writeBuffer(i,0,c(h,u))})),this._register(Dr(this._viewGpuContext.contentLeft,()=>{this._device.queue.writeBuffer(i,0,c())}))}let n;{let l;(function(d){d[d.FloatsPerEntry=2]="FloatsPerEntry",d[d.BytesPerEntry=8]="BytesPerEntry",d[d.Offset_Width_=0]="Offset_Width_",d[d.Offset_Height=1]="Offset_Height"})(l||(l={})),n=this._register(Nt.createBuffer(this._device,{label:"Monaco atlas info uniform buffer",size:l.BytesPerEntry,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},()=>{const d=new Float32Array(l.FloatsPerEntry);return d[l.Offset_Width_]=e.pageSize,d[l.Offset_Height]=e.pageSize,d})).object}const s=this._context.configuration.options.get(v.fontFamily),o=this._context.configuration.options.get(v.fontSize);this._glyphRasterizer.value=this._register(new Uo(o,s,this._viewGpuContext.devicePixelRatio.get())),this._register(Dr(this._viewGpuContext.devicePixelRatio,()=>{this._refreshGlyphRasterizer()})),this._renderStrategy.value=this._instantiationService.createInstance(ze,this._context,this._viewGpuContext,this._device,this._glyphRasterizer),this._glyphStorageBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco glyph storage buffer",size:nn.maximumPageCount*(fi.maximumGlyphCount*Tt.BytesPerEntry),usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST})).object,this._atlasGpuTextureVersions[0]=0,this._atlasGpuTextureVersions[1]=0,this._atlasGpuTexture=this._register(Nt.createTexture(this._device,{label:"Monaco atlas texture",format:"rgba8unorm",size:{width:e.pageSize,height:e.pageSize,depthOrArrayLayers:nn.maximumPageCount},dimension:"2d",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT})).object,this._updateAtlasStorageBufferAndTexture(),this._vertexBuffer=this._register(Nt.createBuffer(this._device,{label:"Monaco vertex buffer",size:Zn.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST},Zn)).object;const r=this._device.createShaderModule({label:"Monaco shader module",code:this._renderStrategy.value.wgsl});if(this._pipeline=this._device.createRenderPipeline({label:"Monaco render pipeline",layout:"auto",vertex:{module:r,buffers:[{arrayStride:2*Float32Array.BYTES_PER_ELEMENT,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]}]},fragment:{module:r,targets:[{format:t,blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}}}]}}),this._rebuildBindGroup=()=>{this._bindGroup=this._device.createBindGroup({label:"Monaco bind group",layout:this._pipeline.getBindGroupLayout(0),entries:[{binding:ft.GlyphInfo,resource:{buffer:this._glyphStorageBuffer}},{binding:ft.TextureSampler,resource:this._device.createSampler({label:"Monaco atlas sampler",magFilter:"nearest",minFilter:"nearest"})},{binding:ft.Texture,resource:this._atlasGpuTexture.createView()},{binding:ft.LayoutInfoUniform,resource:{buffer:i}},{binding:ft.AtlasDimensionsUniform,resource:{buffer:n}},...this._renderStrategy.value.bindGroupEntries]})},this._rebuildBindGroup(),this._initialized=!0,this._initViewportData){for(const l of this._initViewportData)this.renderText(l);this._initViewportData=void 0}}_refreshRenderStrategy(e){if(this._renderStrategy.value?.type==="viewport"||e.endLineNumber<ze.maxSupportedLines&&this._viewportMaxColumn(e)<ze.maxSupportedColumns)return;this._logService.trace(`File is larger than ${ze.maxSupportedLines} lines or ${ze.maxSupportedColumns} columns, switching to viewport render strategy`);const t=this._instantiationService.createInstance(yi,this._context,this._viewGpuContext,this._device,this._glyphRasterizer);this._renderStrategy.value=t,this._register(t.onDidChangeBindGroupEntries(()=>this._rebuildBindGroup?.())),this._rebuildBindGroup?.()}_viewportMaxColumn(e){let t=0,i;for(let n=e.startLineNumber;n<=e.endLineNumber;n++)i=e.getViewLineRenderingData(n),t=Math.max(t,i.maxColumn);return t}_updateAtlasStorageBufferAndTexture(){for(const[e,t]of si.atlas.pages.entries()){if(e>=nn.maximumPageCount){console.log(`Attempt to upload atlas page [${e}], only ${nn.maximumPageCount} are supported currently`);continue}if(t.version===this._atlasGpuTextureVersions[e])continue;this._logService.trace("Updating atlas page[",e,"] from version ",this._atlasGpuTextureVersions[e]," to version ",t.version);const i=Tt.FloatsPerEntry*fi.maximumGlyphCount,n=new Float32Array(i);let s=0;for(const o of t.glyphs)n[s+Tt.Offset_TexturePosition]=o.x,n[s+Tt.Offset_TexturePosition+1]=o.y,n[s+Tt.Offset_TextureSize]=o.w,n[s+Tt.Offset_TextureSize+1]=o.h,n[s+Tt.Offset_OriginPosition]=o.originOffsetX,n[s+Tt.Offset_OriginPosition+1]=o.originOffsetY,s+=Tt.FloatsPerEntry;if(s/Tt.FloatsPerEntry>fi.maximumGlyphCount)throw new Error(`Attempting to write more glyphs (${s/Tt.FloatsPerEntry}) than the GPUBuffer can hold (${fi.maximumGlyphCount})`);this._device.queue.writeBuffer(this._glyphStorageBuffer,e*Tt.FloatsPerEntry*fi.maximumGlyphCount*Float32Array.BYTES_PER_ELEMENT,n,0,Tt.FloatsPerEntry*fi.maximumGlyphCount),t.usedArea.right-t.usedArea.left>0&&t.usedArea.bottom-t.usedArea.top>0&&this._device.queue.copyExternalImageToTexture({source:t.source},{texture:this._atlasGpuTexture,origin:{x:t.usedArea.left,y:t.usedArea.top,z:e}},{width:t.usedArea.right-t.usedArea.left+1,height:t.usedArea.bottom-t.usedArea.top+1}),this._atlasGpuTextureVersions[e]=t.version}}prepareRender(e){throw new Fe("Should not be called")}render(e){throw new Fe("Should not be called")}onConfigurationChanged(e){return this._refreshGlyphRasterizer(),!0}onCursorStateChanged(e){return!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onLineMappingChanged(e){return!0}onRevealRangeRequest(e){return!0}onScrollChanged(e){return!0}onThemeChanged(e){return!0}onZonesChanged(e){return!0}_refreshGlyphRasterizer(){const e=this._glyphRasterizer.value;if(!e)return;const t=this._context.configuration.options.get(v.fontFamily),i=this._context.configuration.options.get(v.fontSize),n=this._viewGpuContext.devicePixelRatio.get();(e.fontFamily!==t||e.fontSize!==i||e.devicePixelRatio!==n)&&(this._glyphRasterizer.value=new Uo(i,t,n))}renderText(e){if(this._initialized)return this._refreshRenderStrategy(e),this._renderText(e);this._initViewportData=this._initViewportData??[],this._initViewportData.push(e)}_renderText(e){this._viewGpuContext.rectangleRenderer.draw(e);const t=new na(this._context.configuration,this._context.theme.type);this._renderStrategy.value.update(e,t),this._updateAtlasStorageBufferAndTexture();const i=this._device.createCommandEncoder({label:"Monaco command encoder"});this._renderPassColorAttachment.view=this._viewGpuContext.ctx.getCurrentTexture().createView({label:"Monaco canvas texture view"});const n=i.beginRenderPass(this._renderPassDescriptor);n.setPipeline(this._pipeline),n.setVertexBuffer(0,this._vertexBuffer);const s=Math.ceil(this._viewGpuContext.contentLeft.get()*this._viewGpuContext.devicePixelRatio.get());n.setScissorRect(s,0,this.canvas.width-s,this.canvas.height),n.setBindGroup(0,this._bindGroup),this._renderStrategy.value.draw(n,e),n.end();const o=i.finish();this._device.queue.submit([o]),this._lastViewportData=e,this._lastViewLineOptions=t}linesVisibleRangesForRange(e,t){if(!this._lastViewportData)return null;const i=e.endLineNumber,n=N.intersectRanges(e,this._lastViewportData.visibleRange);if(!n)return null;const s=this._lastViewportData.startLineNumber,o=this._lastViewportData.endLineNumber,r=this._lastViewportData,l=this._lastViewLineOptions;if(!r||!l)return null;const d=[];let c=0;t&&(c=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(n.startLineNumber,1)).lineNumber);for(let h=n.startLineNumber;h<=n.endLineNumber;h++){if(h<s||h>o)continue;const u=h===n.startLineNumber?n.startColumn:1,g=h!==i,f=g?this._context.viewModel.getLineMaxColumn(h):n.endColumn,m=this._visibleRangesForLineRange(h,u,f);if(m){if(t&&h<i){const _=c;c=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(h+1,1)).lineNumber,_!==c&&(m.ranges[m.ranges.length-1].width+=l.spaceWidth)}d.push(new pg(m.outsideRenderedLine,h,dr.from(m.ranges),g))}}return d.length===0?null:d}_visibleRangesForLineRange(e,t,i){if(this.shouldRender())return null;const n=this._lastViewportData,s=this._lastViewLineOptions;if(!n||!s||e<n.startLineNumber||e>n.endLineNumber)return null;const o=n.getViewLineRenderingData(e),r=o.content;let l;o.isBasicASCII&&s.useMonospaceOptimizations||(l=ra(o,s));let d="",c=0,h=0;for(let m=0;m<t-1;m++){if(o.isBasicASCII&&s.useMonospaceOptimizations)d=r.charAt(m);else{if(d=l.getSegmentAtIndex(m),d===void 0)continue;h+=this._renderStrategy.value.glyphRasterizer.getTextMetrics(d).width/De().devicePixelRatio-s.spaceWidth}d==="	"?c=We.nextRenderTabStop(c,o.tabSize):c++}let u=c,g=0;for(let m=t-1;m<i-1;m++){if(o.isBasicASCII&&s.useMonospaceOptimizations)d=r.charAt(m);else{if(d=l.getSegmentAtIndex(m),d===void 0)continue;g+=this._renderStrategy.value.glyphRasterizer.getTextMetrics(d).width/De().devicePixelRatio-s.spaceWidth}d==="	"?u=We.nextRenderTabStop(u,o.tabSize):u++}return new Ul(!1,[new ln(c*s.spaceWidth+h,(u-c)*s.spaceWidth+g)])}visibleRangeForPosition(e){const t=this._visibleRangesForLineRange(e.lineNumber,e.column,e.column);return t?new _g(t.outsideRenderedLine,t.ranges[0].left):null}getLineWidth(e){if(!this._lastViewportData||!this._lastViewLineOptions||!this._viewGpuContext.canRender(this._lastViewLineOptions,this._lastViewportData,e))return;const t=this._lastViewportData.getViewLineRenderingData(e),n=this._visibleRangesForLineRange(e,1,t.maxColumn)?.ranges.at(-1);if(n)return n.width}getPositionAtCoordinate(e,t){if(!this._lastViewportData||!this._lastViewLineOptions||!this._viewGpuContext.canRender(this._lastViewLineOptions,this._lastViewportData,e))return;const i=this._lastViewportData.getViewLineRenderingData(e),n=i.content,s=De().devicePixelRatio,o=t*s,r=this._lastViewLineOptions.spaceWidth*s,l=ra(i,this._lastViewLineOptions);let d=0,c=0,h=0,u=0;for(let g=0;g<n.length;g++){const f=l.getSegmentAtIndex(g);if(f===void 0){u++;continue}if(f==="	"){const m=g+h;h=We.nextRenderTabStop(g+h,i.tabSize),c=r*(h-m),h-=g+1}else i.isBasicASCII&&this._lastViewLineOptions.useMonospaceOptimizations?c=r:c=this._renderStrategy.value.glyphRasterizer.getTextMetrics(f).width;if(o<d+c/2)break;d+=c,u++}return new I(e,u+1)}};Jl=ge([P(2,Me),P(3,er)],Jl);const Lb=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class Ug extends St{}class Vn{static _getPageOfLine(e,t){return Math.floor((e-1)/t)}static _getRangeForPage(e,t){const i=e*t,n=i+1,s=i+t;return new N(n,1,s+1,1)}static fromEditorSelection(e,t,i,n){const o=Vn._getPageOfLine(t.startLineNumber,i),r=Vn._getRangeForPage(o,i),l=Vn._getPageOfLine(t.endLineNumber,i),d=Vn._getRangeForPage(l,i);let c=r.intersectRanges(new N(1,1,t.startLineNumber,t.startColumn));if(n&&e.getValueLengthInRange(c,Ct.LF)>500){const L=e.modifyPosition(c.getEndPosition(),-500);c=N.fromPositions(L,c.getEndPosition())}const h=e.getValueInRange(c,Ct.LF),u=e.getLineCount(),g=e.getLineMaxColumn(u);let f=d.intersectRanges(new N(t.endLineNumber,t.endColumn,u,g));if(n&&e.getValueLengthInRange(f,Ct.LF)>500){const L=e.modifyPosition(f.getStartPosition(),500);f=N.fromPositions(f.getStartPosition(),L)}const m=e.getValueInRange(f,Ct.LF);let _;if(o===l||o+1===l)_=e.getValueInRange(t,Ct.LF);else{const L=r.intersectRanges(t),w=d.intersectRanges(t);_=e.getValueInRange(L,Ct.LF)+"…"+e.getValueInRange(w,Ct.LF)}return n&&_.length>2*500&&(_=_.substring(0,500)+"…"+_.substring(_.length-500,_.length)),{value:h+_+m,selection:t,selectionStart:h.length,selectionEnd:h.length+_.length,startPositionWithinEditor:c.getStartPosition(),newlineCountBeforeSelection:c.endLineNumber-c.startLineNumber}}}function ed(a,e){if(a.get(v.accessibilitySupport)===Xi.Disabled){const i=e.lookupKeybinding("editor.action.toggleScreenReaderAccessibilityMode")?.getAriaLabel(),n=e.lookupKeybinding("workbench.action.showCommands")?.getAriaLabel(),s=e.lookupKeybinding("workbench.action.openGlobalKeybindings")?.getAriaLabel(),o=O(131,"The editor is not accessible at this time.");return i?O(132,"{0} To enable screen reader optimized mode, use {1}",o,i):n?O(133,"{0} To enable screen reader optimized mode, open the quick pick with {1} and run the command Toggle Screen Reader Accessibility Mode, which is currently not triggerable via keyboard.",o,n):s?O(134,"{0} Please assign a keybinding for the command Toggle Screen Reader Accessibility Mode by accessing the keybindings editor with {1} and run it.",o,s):o}return a.get(v.ariaLabel)}function xh(a){let e=0,t=-1;do{if(t=a.indexOf(`
`,t+1),t===-1)break;e++}while(!0);return e}Ee(Lb);class vb{constructor(e,t,i,n,s){this._context=e,this.modelLineNumber=t,this.distanceToModelLineStart=i,this.widthOfHiddenLineTextBefore=n,this.distanceToModelLineEnd=s,this._visibleTextAreaBrand=void 0,this.startPosition=null,this.endPosition=null,this.visibleTextareaStart=null,this.visibleTextareaEnd=null,this._previousPresentation=null}prepareRender(e){const t=new I(this.modelLineNumber,this.distanceToModelLineStart+1),i=new I(this.modelLineNumber,this._context.viewModel.model.getLineMaxColumn(this.modelLineNumber)-this.distanceToModelLineEnd);this.startPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(t),this.endPosition=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i),this.startPosition.lineNumber===this.endPosition.lineNumber?(this.visibleTextareaStart=e.visibleRangeForPosition(this.startPosition),this.visibleTextareaEnd=e.visibleRangeForPosition(this.endPosition)):(this.visibleTextareaStart=null,this.visibleTextareaEnd=null)}definePresentation(e){return this._previousPresentation||(e?this._previousPresentation=e:this._previousPresentation={foreground:Ui.DefaultForeground,italic:!1,bold:!1,underline:!1,strikethrough:!1}),this._previousPresentation}}const ul=hn;let td=class extends Ug{constructor(e,t,i,n,s,o){super(e),this._keybindingService=s,this._instantiationService=o,this._primaryCursorPosition=new I(1,1),this._primaryCursorVisibleRange=null,this._viewController=i,this._visibleRangeProvider=n,this._scrollLeft=0,this._scrollTop=0;const r=this._context.configuration.options,l=r.get(v.layoutInfo);this._setAccessibilityOptions(r),this._contentLeft=l.contentLeft,this._contentWidth=l.contentWidth,this._contentHeight=l.height,this._fontInfo=r.get(v.fontInfo),this._emptySelectionClipboard=r.get(v.emptySelectionClipboard),this._copyWithSyntaxHighlighting=r.get(v.copyWithSyntaxHighlighting),this._visibleTextArea=null,this._selections=[new le(1,1,1,1)],this._modelSelections=[new le(1,1,1,1)],this._lastRenderPosition=null,this.textArea=fe(document.createElement("textarea")),Li.write(this.textArea,xe.TextArea),this.textArea.setClassName(`inputarea ${Is}`),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:d}=this._context.viewModel.model.getOptions();this.textArea.domNode.style.tabSize=`${d*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("autocorrect","off"),this.textArea.setAttribute("autocapitalize","off"),this.textArea.setAttribute("autocomplete","off"),this.textArea.setAttribute("spellcheck","false"),this.textArea.setAttribute("aria-label",ed(r,this._keybindingService)),this.textArea.setAttribute("aria-required",r.get(v.ariaRequired)?"true":"false"),this.textArea.setAttribute("tabindex",String(r.get(v.tabIndex))),this.textArea.setAttribute("role","textbox"),this.textArea.setAttribute("aria-roledescription",O(135,"editor")),this.textArea.setAttribute("aria-multiline","true"),this.textArea.setAttribute("aria-autocomplete",r.get(v.readOnly)?"none":"both"),this._ensureReadOnlyAttribute(),this.textAreaCover=fe(document.createElement("div")),this.textAreaCover.setPosition("absolute"),t.appendChild(this.textArea),t.appendChild(this.textAreaCover);const c={getLineCount:()=>this._context.viewModel.getLineCount(),getLineMaxColumn:g=>this._context.viewModel.getLineMaxColumn(g),getValueInRange:(g,f)=>this._context.viewModel.getValueInRange(g,f),getValueLengthInRange:(g,f)=>this._context.viewModel.getValueLengthInRange(g,f),modifyPosition:(g,f)=>this._context.viewModel.modifyPosition(g,f)},h={getDataToCopy:()=>Mg(this._context.viewModel,this._modelSelections,this._emptySelectionClipboard,this._copyWithSyntaxHighlighting),getScreenReaderContent:()=>{if(this._accessibilitySupport===Xi.Disabled){const f=this._selections[0];if(Fi&&f.isEmpty()){const _=f.getStartPosition();let L=this._getWordBeforePosition(_);if(L.length===0&&(L=this._getCharacterBeforePosition(_)),L.length>0)return new Ge(L,L.length,L.length,N.fromPositions(_),0)}if(Fi&&!f.isEmpty()&&c.getValueLengthInRange(f,Ct.TextDefined)<500){const _=c.getValueInRange(f,Ct.TextDefined);return new Ge(_,0,_.length,f,0)}if(To&&!f.isEmpty()){const _="vscode-placeholder";return new Ge(_,0,_.length,null,void 0)}return Ge.EMPTY}if(Mc){const f=this._selections[0];if(f.isEmpty()){const m=f.getStartPosition(),[_,L]=this._getAndroidWordAtPosition(m);if(_.length>0)return new Ge(_,L,L,N.fromPositions(m),0)}return Ge.EMPTY}const g=Vn.fromEditorSelection(c,this._selections[0],this._accessibilityPageSize,this._accessibilitySupport===Xi.Unknown);return Ge.fromScreenReaderContentState(g)},deduceModelPosition:(g,f,m)=>this._context.viewModel.deduceModelPositionRelativeToViewPosition(g,f,m)},u=this._register(new WL(this.textArea.domNode));this._textAreaInput=this._register(this._instantiationService.createInstance(Zl,h,u,op,{isAndroid:Mc,isChrome:rp,isFirefox:hn,isSafari:To})),this._register(this._textAreaInput.onKeyDown(g=>{this._viewController.emitKeyDown(g)})),this._register(this._textAreaInput.onKeyUp(g=>{this._viewController.emitKeyUp(g)})),this._register(this._textAreaInput.onPaste(g=>{let f=!1,m=null,_=null;g.metadata&&(f=this._emptySelectionClipboard&&!!g.metadata.isFromEmptySelection,m=typeof g.metadata.multicursorText<"u"?g.metadata.multicursorText:null,_=g.metadata.mode),this._viewController.paste(g.text,f,m,_)})),this._register(this._textAreaInput.onCut(()=>{this._viewController.cut()})),this._register(this._textAreaInput.onType(g=>{g.replacePrevCharCnt||g.replaceNextCharCnt||g.positionDelta?this._viewController.compositionType(g.text,g.replacePrevCharCnt,g.replaceNextCharCnt,g.positionDelta):this._viewController.type(g.text)})),this._register(this._textAreaInput.onSelectionChangeRequest(g=>{this._viewController.setSelection(g)})),this._register(this._textAreaInput.onCompositionStart(g=>{const f=this.textArea.domNode,m=this._modelSelections[0],{distanceToModelLineStart:_,widthOfHiddenTextBefore:L}=(()=>{const p=f.value.substring(0,Math.min(f.selectionStart,f.selectionEnd)),C=p.lastIndexOf(`
`),b=p.substring(C+1),S=b.lastIndexOf("	"),y=b.length-S-1,E=m.getStartPosition(),x=Math.min(E.column-1,y),R=E.column-1-x,D=b.substring(0,b.length-x),{tabSize:A}=this._context.viewModel.model.getOptions(),W=bb(this.textArea.domNode.ownerDocument,D,this._fontInfo,A);return{distanceToModelLineStart:R,widthOfHiddenTextBefore:W}})(),{distanceToModelLineEnd:w}=(()=>{const p=f.value.substring(Math.max(f.selectionStart,f.selectionEnd)),C=p.indexOf(`
`),b=C===-1?p:p.substring(0,C),S=b.indexOf("	"),y=S===-1?b.length:b.length-S-1,E=m.getEndPosition(),x=Math.min(this._context.viewModel.model.getLineMaxColumn(E.lineNumber)-E.column,y);return{distanceToModelLineEnd:this._context.viewModel.model.getLineMaxColumn(E.lineNumber)-E.column-x}})();this._context.viewModel.revealRange("keyboard",!0,N.fromPositions(this._selections[0].getStartPosition()),de.Simple,K.Immediate),this._visibleTextArea=new vb(this._context,m.startLineNumber,_,L,w),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render(),this.textArea.setClassName(`inputarea ${Is} ime-input`),this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(this._textAreaInput.onCompositionUpdate(g=>{this._visibleTextArea&&(this._visibleTextArea.prepareRender(this._visibleRangeProvider),this._render())})),this._register(this._textAreaInput.onCompositionEnd(()=>{this._visibleTextArea=null,this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off"),this._render(),this.textArea.setClassName(`inputarea ${Is}`),this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()})),this._register(this._textAreaInput.onFocus(()=>{this._context.viewModel.setHasFocus(!0)})),this._register(this._textAreaInput.onBlur(()=>{this._context.viewModel.setHasFocus(!1)})),this._register(ms.onDidChange(()=>{this._ensureReadOnlyAttribute()}))}get domNode(){return this.textArea}writeScreenReaderContent(e){this._textAreaInput.writeNativeTextAreaContent(e)}getTextAreaDomNode(){return this.textArea.domNode}dispose(){super.dispose(),this.textArea.domNode.remove(),this.textAreaCover.domNode.remove()}_getAndroidWordAtPosition(e){const t='`~!@#$%^&*()-=+[{]}\\|;:",.<>/?',i=this._context.viewModel.getLineContent(e.lineNumber),n=Ao(t,[]);let s=!0,o=e.column,r=!0,l=e.column,d=0;for(;d<50&&(s||r);){if(s&&o<=1&&(s=!1),s){const c=i.charCodeAt(o-2);n.get(c)!==et.Regular?s=!1:o--}if(r&&l>i.length&&(r=!1),r){const c=i.charCodeAt(l-1);n.get(c)!==et.Regular?r=!1:l++}d++}return[i.substring(o-1,l-1),e.column-o]}_getWordBeforePosition(e){const t=this._context.viewModel.getLineContent(e.lineNumber),i=Ao(this._context.configuration.options.get(v.wordSeparators),[]);let n=e.column,s=0;for(;n>1;){const o=t.charCodeAt(n-2);if(i.get(o)!==et.Regular||s>50)return t.substring(n-1,e.column-1);s++,n--}return t.substring(0,e.column-1)}_getCharacterBeforePosition(e){if(e.column>1){const i=this._context.viewModel.getLineContent(e.lineNumber).charAt(e.column-2);if(!Ii(i.charCodeAt(0)))return i}return""}_setAccessibilityOptions(e){this._accessibilitySupport=e.get(v.accessibilitySupport);const t=e.get(v.accessibilityPageSize);this._accessibilitySupport===Xi.Enabled&&t===Vt.accessibilityPageSize.defaultValue?this._accessibilityPageSize=500:this._accessibilityPageSize=t;const n=e.get(v.layoutInfo).wrappingColumn;if(n!==-1&&this._accessibilitySupport!==Xi.Disabled){const s=e.get(v.fontInfo);this._textAreaWrapping=!0,this._textAreaWidth=Math.round(n*s.typicalHalfwidthCharacterWidth)}else this._textAreaWrapping=!1,this._textAreaWidth=ul?0:1}onConfigurationChanged(e){const t=this._context.configuration.options,i=t.get(v.layoutInfo);this._setAccessibilityOptions(t),this._contentLeft=i.contentLeft,this._contentWidth=i.contentWidth,this._contentHeight=i.height,this._fontInfo=t.get(v.fontInfo),this._emptySelectionClipboard=t.get(v.emptySelectionClipboard),this._copyWithSyntaxHighlighting=t.get(v.copyWithSyntaxHighlighting),this.textArea.setAttribute("wrap",this._textAreaWrapping&&!this._visibleTextArea?"on":"off");const{tabSize:n}=this._context.viewModel.model.getOptions();return this.textArea.domNode.style.tabSize=`${n*this._fontInfo.spaceWidth}px`,this.textArea.setAttribute("aria-label",ed(t,this._keybindingService)),this.textArea.setAttribute("aria-required",t.get(v.ariaRequired)?"true":"false"),this.textArea.setAttribute("tabindex",String(t.get(v.tabIndex))),(e.hasChanged(v.domReadOnly)||e.hasChanged(v.readOnly))&&this._ensureReadOnlyAttribute(),e.hasChanged(v.accessibilitySupport)&&this._textAreaInput.writeNativeTextAreaContent("strategy changed"),!0}onCursorStateChanged(e){return this._selections=e.selections.slice(0),this._modelSelections=e.modelSelections.slice(0),this._textAreaInput.writeNativeTextAreaContent("selection changed"),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return this._scrollLeft=e.scrollLeft,this._scrollTop=e.scrollTop,!0}onZonesChanged(e){return!0}isFocused(){return this._textAreaInput.isFocused()}focus(){this._textAreaInput.focusTextArea()}refreshFocusState(){this._textAreaInput.refreshFocusState()}getLastRenderData(){return this._lastRenderPosition}setAriaOptions(e){e.activeDescendant?(this.textArea.setAttribute("aria-haspopup","true"),this.textArea.setAttribute("aria-autocomplete","list"),this.textArea.setAttribute("aria-activedescendant",e.activeDescendant)):(this.textArea.setAttribute("aria-haspopup","false"),this.textArea.setAttribute("aria-autocomplete","both"),this.textArea.removeAttribute("aria-activedescendant")),e.role&&this.textArea.setAttribute("role",e.role)}_ensureReadOnlyAttribute(){const e=this._context.configuration.options;!ms.enabled||e.get(v.domReadOnly)&&e.get(v.readOnly)?this.textArea.setAttribute("readonly","true"):this.textArea.removeAttribute("readonly")}prepareRender(e){this._primaryCursorPosition=new I(this._selections[0].positionLineNumber,this._selections[0].positionColumn),this._primaryCursorVisibleRange=e.visibleRangeForPosition(this._primaryCursorPosition),this._visibleTextArea?.prepareRender(e)}render(e){this._textAreaInput.writeNativeTextAreaContent("render"),this._render()}_render(){if(this._visibleTextArea){const i=this._visibleTextArea.visibleTextareaStart,n=this._visibleTextArea.visibleTextareaEnd,s=this._visibleTextArea.startPosition,o=this._visibleTextArea.endPosition;if(s&&o&&i&&n&&n.left>=this._scrollLeft&&i.left<=this._scrollLeft+this._contentWidth){const r=this._context.viewLayout.getVerticalOffsetForLineNumber(this._primaryCursorPosition.lineNumber)-this._scrollTop,l=xh(this.textArea.domNode.value.substr(0,this.textArea.domNode.selectionStart));let d=this._visibleTextArea.widthOfHiddenLineTextBefore,c=this._contentLeft+i.left-this._scrollLeft,h=n.left-i.left+1;if(c<this._contentLeft){const p=this._contentLeft-c;c+=p,d+=p,h-=p}h>this._contentWidth&&(h=this._contentWidth);const u=this._context.viewModel.coordinatesConverter.convertViewPositionToModelPosition(new I(s.lineNumber,1)),g=this._context.viewLayout.getLineHeightForLineNumber(u.lineNumber),f=this._context.viewModel.getViewLineData(s.lineNumber),m=f.tokens.findTokenIndexAtOffset(s.column-1),_=f.tokens.findTokenIndexAtOffset(o.column-1),L=m===_,w=this._visibleTextArea.definePresentation(L?f.tokens.getPresentation(m):null);this.textArea.domNode.scrollTop=l*g,this.textArea.domNode.scrollLeft=d,this._doRender({lastRenderPosition:null,top:r,left:c,width:h,height:g,useCover:!1,color:(Ye.getColorMap()||[])[w.foreground],italic:w.italic,bold:w.bold,underline:w.underline,strikethrough:w.strikethrough})}return}if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const e=this._contentLeft+this._primaryCursorVisibleRange.left-this._scrollLeft;if(e<this._contentLeft||e>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const t=this._context.viewLayout.getVerticalOffsetForLineNumber(this._selections[0].positionLineNumber)-this._scrollTop;if(t<0||t>this._contentHeight){this._renderAtTopLeft();return}if(Fi||this._accessibilitySupport===Xi.Enabled){const i=this._primaryCursorPosition.lineNumber,n=this._context.viewLayout.getLineHeightForLineNumber(i);this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:n,useCover:!1}),this.textArea.domNode.scrollLeft=this._primaryCursorVisibleRange.left;const s=this._textAreaInput.textAreaState.newlineCountBeforeSelection??xh(this.textArea.domNode.value.substring(0,this.textArea.domNode.selectionStart));this.textArea.domNode.scrollTop=s*n;return}this._doRender({lastRenderPosition:this._primaryCursorPosition,top:t,left:this._textAreaWrapping?this._contentLeft:e,width:this._textAreaWidth,height:ul?0:1,useCover:!1})}_renderAtTopLeft(){this._doRender({lastRenderPosition:null,top:0,left:0,width:this._textAreaWidth,height:ul?0:1,useCover:!0})}_doRender(e){this._lastRenderPosition=e.lastRenderPosition;const t=this.textArea,i=this.textAreaCover;st(t,this._fontInfo),t.setTop(e.top),t.setLeft(e.left),t.setWidth(e.width),t.setHeight(e.height),t.setLineHeight(e.height),t.setColor(e.color?_i.Format.CSS.formatHex(e.color):""),t.setFontStyle(e.italic?"italic":""),e.bold&&t.setFontWeight("bold"),t.setTextDecoration(`${e.underline?" underline":""}${e.strikethrough?" line-through":""}`),i.setTop(e.useCover?e.top:0),i.setLeft(e.useCover?e.left:0),i.setWidth(e.useCover?e.width:0),i.setHeight(e.useCover?e.height:0);const n=this._context.configuration.options;n.get(v.glyphMargin)?i.setClassName("monaco-editor-background textAreaCover "+Ho.OUTER_CLASS_NAME):n.get(v.lineNumbers).renderType!==fs.Off?i.setClassName("monaco-editor-background textAreaCover "+Ua.CLASS_NAME):i.setClassName("monaco-editor-background textAreaCover")}};td=ge([P(4,wi),P(5,Me)],td);function bb(a,e,t,i){if(e.length===0)return 0;const n=a.createElement("div");n.style.position="absolute",n.style.top="-50000px",n.style.width="50000px";const s=a.createElement("span");st(s,t),s.style.whiteSpace="pre",s.style.tabSize=`${i*t.spaceWidth}px`,s.append(e),n.appendChild(s),a.body.appendChild(n);const o=s.offsetWidth;return n.remove(),o}const Sb=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class yb extends U{constructor(e,t){super(),this._domNode=e,this._onFocusChange=t,this._isFocused=!1,this._isPaused=!1,this._register(Y(this._domNode,"focus",()=>{this._isPaused||this.refreshFocusState()})),this._register(Y(this._domNode,"blur",()=>{this._isPaused||this._handleFocusedChanged(!1)}))}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this.refreshFocusState()}_handleFocusedChanged(e){this._isFocused!==e&&(this._isFocused=e,this._onFocusChange(this._isFocused))}focus(){this._domNode.focus(),this.refreshFocusState()}refreshFocusState(){const e=Mo(this._domNode),t=e?e.activeElement:zr(),i=this._domNode===t;this._handleFocusedChanged(i)}get isFocused(){return this._isFocused}}function ao(a,e,t,i){return a.addEventListener(e,t,i),{dispose(){a.removeEventListener(e,t)}}}let id=class{constructor(e,t,i,n){this._domNode=e,this._context=t,this._keybindingService=i,this._accessibilityService=n,this._contentLeft=1,this._contentWidth=1,this._contentHeight=1,this._divWidth=1,this._accessibilityPageSize=1,this._ignoreSelectionChangeTime=0,this._primarySelection=new le(1,1,1,1),this._primaryCursorVisibleRange=null,this._updateConfigurationSettings(),this._updateDomAttributes()}setIgnoreSelectionChangeTime(e){this._ignoreSelectionChangeTime=Date.now()}getIgnoreSelectionChangeTime(){return this._ignoreSelectionChangeTime}resetSelectionChangeTime(){this._ignoreSelectionChangeTime=0}onConfigurationChanged(e){this._updateConfigurationSettings(),this._updateDomAttributes(),e.hasChanged(v.accessibilitySupport)&&this.writeScreenReaderContent()}_updateConfigurationSettings(){const e=this._context.configuration.options,t=e.get(v.layoutInfo),i=t.wrappingColumn;this._contentLeft=t.contentLeft,this._contentWidth=t.contentWidth,this._contentHeight=t.height,this._fontInfo=e.get(v.fontInfo),this._accessibilityPageSize=e.get(v.accessibilityPageSize),this._divWidth=Math.round(i*this._fontInfo.typicalHalfwidthCharacterWidth)}_updateDomAttributes(){const e=this._context.configuration.options;this._domNode.domNode.setAttribute("role","textbox"),this._domNode.domNode.setAttribute("aria-required",e.get(v.ariaRequired)?"true":"false"),this._domNode.domNode.setAttribute("aria-multiline","true"),this._domNode.domNode.setAttribute("aria-autocomplete",e.get(v.readOnly)?"none":"both"),this._domNode.domNode.setAttribute("aria-roledescription",O(130,"editor")),this._domNode.domNode.setAttribute("aria-label",ed(e,this._keybindingService));const t=this._context.viewModel.model.getOptions().tabSize,i=e.get(v.fontInfo).spaceWidth;this._domNode.domNode.style.tabSize=`${t*i}px`;const n=e.get(v.wordWrapOverride2),s=n!=="inherit"?n:e.get(v.wordWrap);this._domNode.domNode.style.textWrap=s==="off"?"nowrap":"wrap"}onCursorStateChanged(e){this._primarySelection=e.selections[0]??new le(1,1,1,1)}prepareRender(e){this.writeScreenReaderContent(),this._primaryCursorVisibleRange=e.visibleRangeForPosition(this._primarySelection.getPosition())}render(e){if(!this._screenReaderContentState)return;if(!this._primaryCursorVisibleRange){this._renderAtTopLeft();return}const t=this._context.viewLayout.getCurrentScrollLeft(),i=this._contentLeft+this._primaryCursorVisibleRange.left-t;if(i<this._contentLeft||i>this._contentLeft+this._contentWidth){this._renderAtTopLeft();return}const n=this._context.viewLayout.getCurrentScrollTop(),s=this._primarySelection.positionLineNumber,o=this._context.viewLayout.getVerticalOffsetForLineNumber(s)-n;if(o<0||o>this._contentHeight){this._renderAtTopLeft();return}const r=this._context.viewLayout.getLineHeightForLineNumber(s),d=(s-this._screenReaderContentState.startPositionWithinEditor.lineNumber)*r;this._doRender(d,o,this._contentLeft,this._divWidth,r)}_renderAtTopLeft(){this._doRender(0,0,0,this._contentWidth,1)}_doRender(e,t,i,n,s){st(this._domNode,this._fontInfo),this._domNode.setTop(t),this._domNode.setLeft(i),this._domNode.setWidth(n),this._domNode.setHeight(s),this._domNode.setLineHeight(s),this._domNode.domNode.scrollTop=e}setAriaOptions(e){e.activeDescendant?(this._domNode.setAttribute("aria-haspopup","true"),this._domNode.setAttribute("aria-autocomplete","list"),this._domNode.setAttribute("aria-activedescendant",e.activeDescendant)):(this._domNode.setAttribute("aria-haspopup","false"),this._domNode.setAttribute("aria-autocomplete","both"),this._domNode.removeAttribute("aria-activedescendant")),e.role&&this._domNode.setAttribute("role",e.role)}writeScreenReaderContent(){const e=De().document.activeElement;if(!e||e!==this._domNode.domNode)return;if(this._accessibilityService.isScreenReaderOptimized()){this._screenReaderContentState=this._getScreenReaderContentState();const i=this._context.viewModel.model.getPositionAt(1/0);let n=this._screenReaderContentState.value;i.column===1&&this._primarySelection.getEndPosition().equals(i)&&(n+=`
`),this._domNode.domNode.textContent!==n&&(this.setIgnoreSelectionChangeTime("setValue"),this._domNode.domNode.textContent=n),this._setSelectionOfScreenReaderContent(this._screenReaderContentState.selectionStart,this._screenReaderContentState.selectionEnd)}else this._screenReaderContentState=void 0,this.setIgnoreSelectionChangeTime("setValue"),this._domNode.domNode.textContent=""}get screenReaderContentState(){return this._screenReaderContentState}_getScreenReaderContentState(){const e={getLineCount:()=>this._context.viewModel.getLineCount(),getLineMaxColumn:t=>this._context.viewModel.getLineMaxColumn(t),getValueInRange:(t,i)=>this._context.viewModel.getValueInRange(t,i),getValueLengthInRange:(t,i)=>this._context.viewModel.getValueLengthInRange(t,i),modifyPosition:(t,i)=>this._context.viewModel.modifyPosition(t,i)};return Vn.fromEditorSelection(e,this._primarySelection,this._accessibilityPageSize,this._accessibilityService.getAccessibilitySupport()===Xi.Unknown)}_setSelectionOfScreenReaderContent(e,t){const n=De().document.getSelection();if(!n)return;const s=this._domNode.domNode.firstChild;if(!s)return;const o=new globalThis.Range;o.setStart(s,e),o.setEnd(s,t),this.setIgnoreSelectionChangeTime("setRange"),n.removeAllRanges(),n.addRange(o)}};id=ge([P(2,wi),P(3,ji)],id);var nd;(function(a){function e(t,i){return new t.EditContext(i)}a.create=e})(nd||(nd={}));class xb{constructor(){this._nativeEditContextMapping=new Map}register(e,t){return this._nativeEditContextMapping.set(e,t),{dispose:()=>{this._nativeEditContextMapping.delete(e)}}}get(e){return this._nativeEditContextMapping.get(e)}}const Nb=new xb;Ee(Sb);var Lo;(function(a){a.NONE="edit-context-composition-none",a.SECONDARY="edit-context-composition-secondary",a.PRIMARY="edit-context-composition-primary"})(Lo||(Lo={}));let aa=class extends Ug{constructor(e,t,i,n,s,o,r){super(t),this._viewController=n,this._visibleRangeProvider=s,this._accessibilityService=r,this._editContextPrimarySelection=new le(1,1,1,1),this._decorations=[],this._primarySelection=new le(1,1,1,1),this._targetWindowId=-1,this._scrollTop=0,this._scrollLeft=0,this.domNode=new Ac(document.createElement("div")),this.domNode.setClassName("native-edit-context"),this._imeTextArea=new Ac(document.createElement("textarea")),this._imeTextArea.setClassName("ime-text-area"),this._imeTextArea.setAttribute("readonly","true"),this._imeTextArea.setAttribute("tabindex","-1"),this.domNode.setAttribute("autocorrect","off"),this.domNode.setAttribute("autocapitalize","off"),this.domNode.setAttribute("autocomplete","off"),this.domNode.setAttribute("spellcheck","false"),this._updateDomAttributes(),i.appendChild(this.domNode),i.appendChild(this._imeTextArea),this._parent=i.domNode,this._selectionChangeListener=this._register(new Ms),this._focusTracker=this._register(new yb(this.domNode.domNode,h=>{h?(this._selectionChangeListener.value=this._setSelectionChangeListener(this._viewController),this._screenReaderSupport.setIgnoreSelectionChangeTime("onFocus")):this._selectionChangeListener.value=void 0,this._context.viewModel.setHasFocus(h)}));const l=Ne(this.domNode.domNode);this._editContext=nd.create(l),this.setEditContextOnDomNode(),this._screenReaderSupport=o.createInstance(id,this.domNode,t),this._register(Y(this.domNode.domNode,"copy",h=>this._ensureClipboardGetsEditorSelection(h))),this._register(Y(this.domNode.domNode,"cut",h=>{this._screenReaderSupport.setIgnoreSelectionChangeTime("onCut"),this._ensureClipboardGetsEditorSelection(h),this._viewController.cut()})),this._register(Y(this.domNode.domNode,"keyup",h=>this._onKeyUp(h))),this._register(Y(this.domNode.domNode,"keydown",async h=>this._onKeyDown(h))),this._register(Y(this._imeTextArea.domNode,"keyup",h=>this._onKeyUp(h))),this._register(Y(this._imeTextArea.domNode,"keydown",async h=>this._onKeyDown(h))),this._register(Y(this.domNode.domNode,"beforeinput",async h=>{(h.inputType==="insertParagraph"||h.inputType==="insertLineBreak")&&this._onType(this._viewController,{text:`
`,replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0})})),this._register(Y(this.domNode.domNode,"paste",h=>{if(h.preventDefault(),!h.clipboardData)return;let[u,g]=ta.getTextData(h.clipboardData);if(!u)return;g=g||Vs.INSTANCE.get(u);let f=!1,m=null,_=null;g&&(f=this._context.configuration.options.get(v.emptySelectionClipboard)&&!!g.isFromEmptySelection,m=typeof g.multicursorText<"u"?g.multicursorText:null,_=g.mode),this._viewController.paste(u,f,m,_)})),this._register(ao(this._editContext,"textformatupdate",h=>this._handleTextFormatUpdate(h))),this._register(ao(this._editContext,"characterboundsupdate",h=>this._updateCharacterBounds(h)));let d;this._register(ao(this._editContext,"textupdate",h=>{const u=h.text;if(u.length===1){const g=u.charCodeAt(0);if(Ii(g)){d=u;return}if(Pu(g)&&d){const f={text:d+u,selectionEnd:h.selectionEnd,selectionStart:h.selectionStart,updateRangeStart:h.updateRangeStart-1,updateRangeEnd:h.updateRangeEnd-1};d=void 0,this._emitTypeEvent(this._viewController,f);return}}this._emitTypeEvent(this._viewController,h)})),this._register(ao(this._editContext,"compositionstart",h=>{this._viewController.compositionStart(),this._context.viewModel.onCompositionStart()})),this._register(ao(this._editContext,"compositionend",h=>{this._viewController.compositionEnd(),this._context.viewModel.onCompositionEnd()}));let c=!1;this._register(ms.onDidChange(()=>{ms.enabled&&c&&(this.domNode.focus(),this._focusTracker.resume(),c=!1),!ms.enabled&&this.isFocused()&&(this._focusTracker.pause(),this._imeTextArea.focus(),c=!0)})),this._register(Nb.register(e,this))}dispose(){this.domNode.domNode.blur(),this.domNode.domNode.remove(),this._imeTextArea.domNode.remove(),super.dispose()}setAriaOptions(e){this._screenReaderSupport.setAriaOptions(e)}getLastRenderData(){return this._primarySelection.getPosition()}prepareRender(e){this._screenReaderSupport.prepareRender(e),this._updateEditContext(),this._updateSelectionAndControlBounds(e)}render(e){this._screenReaderSupport.render(e)}onCursorStateChanged(e){return this._primarySelection=e.modelSelections[0]??new le(1,1,1,1),this._screenReaderSupport.onCursorStateChanged(e),this._updateEditContext(),!0}onConfigurationChanged(e){return this._screenReaderSupport.onConfigurationChanged(e),this._updateDomAttributes(),!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return this._scrollLeft=e.scrollLeft,this._scrollTop=e.scrollTop,!0}onZonesChanged(e){return!0}onWillPaste(){this._onWillPaste()}_onWillPaste(){this._screenReaderSupport.setIgnoreSelectionChangeTime("onWillPaste")}writeScreenReaderContent(){this._screenReaderSupport.writeScreenReaderContent()}isFocused(){return this._focusTracker.isFocused}focus(){this._focusTracker.focus(),this.refreshFocusState()}refreshFocusState(){this._focusTracker.refreshFocusState()}setEditContextOnDomNode(){const e=Ne(this.domNode.domNode),t=Td(e);this._targetWindowId!==t&&(this.domNode.domNode.editContext=this._editContext,this._targetWindowId=t)}_onKeyUp(e){this._viewController.emitKeyUp(new Ur(e))}_onKeyDown(e){const t=new Ur(e);t.keyCode===T.KEY_IN_COMPOSITION&&t.stopPropagation(),this._viewController.emitKeyDown(t)}_updateDomAttributes(){const e=this._context.configuration.options;this.domNode.domNode.setAttribute("tabindex",String(e.get(v.tabIndex)))}_updateEditContext(){const e=this._getNewEditContextState();e&&(this._editContext.updateText(0,Number.MAX_SAFE_INTEGER,e.text??" "),this._editContext.updateSelection(e.selectionStartOffset,e.selectionEndOffset),this._editContextPrimarySelection=e.editContextPrimarySelection)}_emitTypeEvent(e,t){if(!this._editContext||!this._editContextPrimarySelection.equalsSelection(this._primarySelection))return;const i=this._context.viewModel.model,n=this._editContextStartPosition(),s=i.getOffsetAt(n),o=i.getOffsetAt(this._primarySelection.getEndPosition()),r=i.getOffsetAt(this._primarySelection.getStartPosition()),l=o-s,d=r-s;let c=0,h=0;t.updateRangeEnd>l&&(c=t.updateRangeEnd-l),t.updateRangeStart<d&&(h=d-t.updateRangeStart);let u="";d<t.updateRangeStart&&(u+=this._editContext.text.substring(d,t.updateRangeStart)),u+=t.text,l>t.updateRangeEnd&&(u+=this._editContext.text.substring(t.updateRangeEnd,l));let g=0;t.selectionStart===t.selectionEnd&&d===l&&(g=t.selectionStart-(t.updateRangeStart+t.text.length));const f={text:u,replacePrevCharCnt:h,replaceNextCharCnt:c,positionDelta:g};this._onType(e,f),this._updateEditContext()}_onType(e,t){t.replacePrevCharCnt||t.replaceNextCharCnt||t.positionDelta?e.compositionType(t.text,t.replacePrevCharCnt,t.replaceNextCharCnt,t.positionDelta):e.type(t.text)}_getNewEditContextState(){const e=this._primarySelection,t=this._context.viewModel.model;if(!t.isValidRange(e))return;const i=e.startLineNumber,n=e.endLineNumber,s=t.getLineMaxColumn(n),o=new N(i,1,n,s),r=t.getValueInRange(o,Ct.TextDefined),l=e.startColumn-1,d=r.length+e.endColumn-s;return{text:r,selectionStartOffset:l,selectionEndOffset:d,editContextPrimarySelection:e}}_editContextStartPosition(){return new I(this._editContextPrimarySelection.startLineNumber,1)}_handleTextFormatUpdate(e){if(!this._editContext)return;const t=e.getTextFormats(),i=this._editContextStartPosition(),n=[];t.forEach(s=>{const o=this._context.viewModel.model,r=o.getOffsetAt(i),l=o.getPositionAt(r+s.rangeStart),d=o.getPositionAt(r+s.rangeEnd),c=N.fromPositions(l,d),h=s.underlineThickness.toLowerCase();let u=Lo.NONE;switch(h){case"thin":u=Lo.SECONDARY;break;case"thick":u=Lo.PRIMARY;break}n.push({range:c,options:{description:"textFormatDecoration",inlineClassName:u}})}),this._decorations=this._context.viewModel.model.deltaDecorations(this._decorations,n)}_updateSelectionAndControlBounds(e){if(!this._parent)return;const i=this._context.configuration.options.get(v.layoutInfo).contentLeft,n=this._parent.getBoundingClientRect(),s=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(this._primarySelection),o=this._context.viewLayout.getVerticalOffsetForLineNumber(s.startLineNumber),r=n.top+o-this._scrollTop,d=this._context.viewLayout.getVerticalOffsetAfterLineNumber(s.endLineNumber)-o;let c=n.left+i-this._scrollLeft,h;if(this._primarySelection.isEmpty()){const g=e.visibleRangeForPosition(s.getStartPosition());g&&(c+=g.left),h=0}else h=n.width-i;const u=new DOMRect(c,r,h,d);this._editContext.updateSelectionBounds(u),this._editContext.updateControlBounds(u)}_updateCharacterBounds(e){if(!this._parent)return;const t=this._context.configuration.options,i=t.get(v.fontInfo).typicalHalfwidthCharacterWidth,n=t.get(v.layoutInfo).contentLeft,s=this._parent.getBoundingClientRect(),o=[],r=new Oc(this._editContext.text);for(let l=e.rangeStart;l<e.rangeEnd;l++){const d=r.getPosition(l),c=this._editContextPrimarySelection.startLineNumber-1,h=new I(c+d.lineNumber,d.column),u=h.delta(0,1),g=N.fromPositions(h,u),f=this._context.viewModel.coordinatesConverter.convertModelRangeToViewRange(g),m=this._visibleRangeProvider.linesVisibleRangesForRange(f,!0)??[],_=f.startLineNumber,L=this._context.viewLayout.getVerticalOffsetForLineNumber(_),w=s.top+L-this._scrollTop;let p=0,C=i;if(m.length>0)for(const S of m[0].ranges){p=S.left,C=S.width;break}const b=this._context.viewLayout.getLineHeightForLineNumber(_);o.push(new DOMRect(s.left+n+p-this._scrollLeft,w,C,b))}this._editContext.updateCharacterBounds(e.rangeStart,o)}_ensureClipboardGetsEditorSelection(e){const t=this._context.configuration.options,i=t.get(v.emptySelectionClipboard),n=t.get(v.copyWithSyntaxHighlighting),s=this._context.viewModel.getCursorStates().map(l=>l.modelState.selection),o=Mg(this._context.viewModel,s,i,n),r={version:1,isFromEmptySelection:o.isFromEmptySelection,multicursorText:o.multicursorText,mode:o.mode};Vs.INSTANCE.set(hn?o.text.replace(/\r\n/g,`
`):o.text,r),e.preventDefault(),e.clipboardData&&ta.setTextData(e.clipboardData,o.text,o.html,r)}_setSelectionChangeListener(e){let t=0;return Y(this.domNode.domNode.ownerDocument,"selectionchange",()=>{const i=this._accessibilityService.isScreenReaderOptimized();if(!this.isFocused()||!i||!ms.enabled)return;const n=this._screenReaderSupport.screenReaderContentState;if(!n)return;const s=Date.now(),o=s-t;if(t=s,o<5)return;const r=s-this._screenReaderSupport.getIgnoreSelectionChangeTime();if(this._screenReaderSupport.resetSelectionChangeTime(),r<100)return;const d=De().document.getSelection();if(!d||d.rangeCount===0)return;const h=d.getRangeAt(0),u=this._context.viewModel,g=u.model,m=u.coordinatesConverter.convertViewPositionToModelPosition(n.startPositionWithinEditor),_=g.getOffsetAt(m);let L=h.startOffset+_,w=h.endOffset+_;if(g.getEndOfLineSequence()===Ou.CRLF){const y=n.value,E=new Oc(y),x=E.getPosition(h.startOffset),R=E.getPosition(h.endOffset);L+=x.lineNumber-1,w+=R.lineNumber-1}const C=g.getPositionAt(L),b=g.getPositionAt(w),S=le.fromPositions(C,b);e.setSelection(S)})}};aa=ge([P(5,Me),P(6,ji)],aa);class Eb extends St{constructor(e,t){super(e),this._viewGpuContext=t,this._gpuShapes=[],this._register(ce(i=>this._updateEntries(i)))}onConfigurationChanged(e){return this._updateEntries(void 0),!0}prepareRender(e){}render(e){}_updateEntries(e){const t=this._context.configuration.options,i=t.get(v.rulers),n=t.get(v.fontInfo).typicalHalfwidthCharacterWidth,s=this._viewGpuContext.devicePixelRatio.read(e);for(let o=0,r=i.length;o<r;o++){const l=i[o],d=this._gpuShapes[o],c=l.color?_i.fromHex(l.color):this._context.theme.getColor(ap)??_i.white,h=[l.column*n*s,0,Math.max(1,Math.ceil(s)),Number.MAX_SAFE_INTEGER,c.rgba.r/255,c.rgba.g/255,c.rgba.b/255,c.rgba.a];d?d.setRaw(h):this._gpuShapes[o]=this._viewGpuContext.rectangleRenderer.register(...h)}for(;this._gpuShapes.length>i.length;)this._gpuShapes.splice(-1,1)[0].dispose()}}const Ib=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(Ib);class rc extends _n{static{this.CLASS_NAME="gpu-mark"}constructor(e,t){super(),this._viewGpuContext=t,this._context=e,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){return!0}onCursorStateChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}onDecorationsChanged(e){return!0}prepareRender(e){const t=e.visibleRange.startLineNumber,i=e.visibleRange.endLineNumber,n=e.viewportData,s=new na(this._context.configuration,this._context.theme.type),o=[];for(let r=t;r<=i;r++){const l=r-t,d=this._viewGpuContext.canRenderDetailed(s,n,r);o[l]=d.length?`<div class="${rc.CLASS_NAME}" title="Cannot render on GPU: ${d.join(", ")}"></div>`:""}this._renderResult=o}render(e,t){if(!this._renderResult)return"";const i=t-e;return i<0||i>=this._renderResult.length?"":this._renderResult[i]}}let sd=class extends ss{constructor(e,t,i,n,s,o,r,l,d){super(),this._instantiationService=d,this._shouldRecomputeGlyphMarginLanes=!1,this._ownerID=t,this._widgetFocusTracker=this._register(new Rb(e,l)),this._register(this._widgetFocusTracker.onChange(()=>{this._context.viewModel.setHasWidgetFocus(this._widgetFocusTracker.hasFocus())})),this._selections=[new le(1,1,1,1)],this._renderAnimationFrame=null,this._overflowGuardContainer=fe(document.createElement("div")),Li.write(this._overflowGuardContainer,xe.OverflowGuard),this._overflowGuardContainer.setClassName("overflow-guard"),this._viewController=new BL(n,o,r,i),this._context=new Yv(n,s,o),this._context.addEventHandler(this),this._viewParts=[],this._experimentalEditContextEnabled=this._context.configuration.options.get(v.effectiveExperimentalEditContextEnabled),this._accessibilitySupport=this._context.configuration.options.get(v.accessibilitySupport),this._editContext=this._instantiateEditContext(),this._viewParts.push(this._editContext),this._linesContent=fe(document.createElement("div")),this._linesContent.setClassName("lines-content monaco-editor-background"),this._linesContent.setPosition("absolute"),this.domNode=fe(document.createElement("div")),this.domNode.setClassName(this._getEditorClassName()),this.domNode.setAttribute("role","code"),this._context.configuration.options.get(v.experimentalGpuAcceleration)==="on"&&(this._viewGpuContext=this._instantiationService.createInstance(si,this._context)),this._scrollbar=new ev(this._context,this._linesContent,this.domNode,this._overflowGuardContainer),this._viewParts.push(this._scrollbar),this._viewLines=new sc(this._context,this._viewGpuContext,this._linesContent),this._viewGpuContext&&(this._viewLinesGpu=this._instantiationService.createInstance(Jl,this._context,this._viewGpuContext)),this._viewZones=new jv(this._context),this._viewParts.push(this._viewZones);const c=new Mv(this._context);this._viewParts.push(c);const h=new Vv(this._context);this._viewParts.push(h);const u=new UL(this._context);this._viewParts.push(u),u.addDynamicOverlay(new XL(this._context)),u.addDynamicOverlay(new Ze(this._context)),u.addDynamicOverlay(new dv(this._context)),u.addDynamicOverlay(new JL(this._context)),u.addDynamicOverlay(new Zv(this._context));const g=new GL(this._context);this._viewParts.push(g),g.addDynamicOverlay(new YL(this._context)),g.addDynamicOverlay(new Lv(this._context)),g.addDynamicOverlay(new _v(this._context)),g.addDynamicOverlay(new Ua(this._context)),this._viewGpuContext&&g.addDynamicOverlay(new rc(this._context,this._viewGpuContext)),this._glyphMarginWidgets=new sv(this._context),this._viewParts.push(this._glyphMarginWidgets);const f=new Ho(this._context);f.getDomNode().appendChild(this._viewZones.marginDomNode),f.getDomNode().appendChild(g.getDomNode()),f.getDomNode().appendChild(this._glyphMarginWidgets.domNode),this._viewParts.push(f),this._contentWidgets=new $L(this._context,this.domNode),this._viewParts.push(this._contentWidgets),this._viewCursors=new oa(this._context),this._viewParts.push(this._viewCursors),this._overlayWidgets=new Dv(this._context,this.domNode),this._viewParts.push(this._overlayWidgets);const m=this._viewGpuContext?new Eb(this._context,this._viewGpuContext):new kv(this._context);this._viewParts.push(m);const _=new KL(this._context);this._viewParts.push(_);const L=new Iv(this._context);if(this._viewParts.push(L),c){const w=this._scrollbar.getOverviewRulerLayoutInfo();w.parent.insertBefore(c.getDomNode(),w.insertBefore)}this._linesContent.appendChild(u.getDomNode()),"domNode"in m&&this._linesContent.appendChild(m.domNode),this._linesContent.appendChild(this._viewZones.domNode),this._linesContent.appendChild(this._viewLines.getDomNode()),this._linesContent.appendChild(this._contentWidgets.domNode),this._linesContent.appendChild(this._viewCursors.getDomNode()),this._overflowGuardContainer.appendChild(f.getDomNode()),this._overflowGuardContainer.appendChild(this._scrollbar.getDomNode()),this._viewGpuContext&&this._overflowGuardContainer.appendChild(this._viewGpuContext.canvas),this._overflowGuardContainer.appendChild(h.getDomNode()),this._overflowGuardContainer.appendChild(this._overlayWidgets.getDomNode()),this._overflowGuardContainer.appendChild(L.getDomNode()),this._overflowGuardContainer.appendChild(_.domNode),this.domNode.appendChild(this._overflowGuardContainer),l?(l.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode.domNode),l.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode.domNode)):(this.domNode.appendChild(this._contentWidgets.overflowingContentWidgetsDomNode),this.domNode.appendChild(this._overlayWidgets.overflowingOverlayWidgetsDomNode)),this._applyLayout(),this._pointerHandler=this._register(new HL(this._context,this._viewController,this._createPointerHandlerHelper()))}_instantiateEditContext(){return this._context.configuration.options.get(v.effectiveExperimentalEditContextEnabled)?this._instantiationService.createInstance(aa,this._ownerID,this._context,this._overflowGuardContainer,this._viewController,this._createTextAreaHandlerHelper()):this._instantiationService.createInstance(td,this._context,this._overflowGuardContainer,this._viewController,this._createTextAreaHandlerHelper())}_updateEditContext(){const e=this._context.configuration.options.get(v.effectiveExperimentalEditContextEnabled),t=this._context.configuration.options.get(v.accessibilitySupport);if(this._experimentalEditContextEnabled===e&&this._accessibilitySupport===t)return;this._experimentalEditContextEnabled=e,this._accessibilitySupport=t;const i=this._editContext.isFocused(),n=this._viewParts.indexOf(this._editContext);this._editContext.dispose(),this._editContext=this._instantiateEditContext(),i&&this._editContext.focus(),n!==-1&&this._viewParts.splice(n,1,this._editContext)}_computeGlyphMarginLanes(){const e=this._context.viewModel.model,t=this._context.viewModel.glyphLanes;let i=[],n=0;i=i.concat(e.getAllMarginDecorations().map(s=>{const o=s.options.glyphMargin?.position??nr.Center;return n=Math.max(n,s.range.endLineNumber),{range:s.range,lane:o,persist:s.options.glyphMargin?.persistLane}})),i=i.concat(this._glyphMarginWidgets.getWidgets().map(s=>{const o=e.validateRange(s.preference.range);return n=Math.max(n,o.endLineNumber),{range:o,lane:s.preference.lane}})),i.sort((s,o)=>N.compareRangesUsingStarts(s.range,o.range)),t.reset(n);for(const s of i)t.push(s.lane,s.range,s.persist);return t}_createPointerHandlerHelper(){return{viewDomNode:this.domNode.domNode,linesContentDomNode:this._linesContent.domNode,viewLinesDomNode:this._viewLines.getDomNode().domNode,viewLinesGpu:this._viewLinesGpu,focusTextArea:()=>{this.focus()},dispatchTextAreaEvent:e=>{this._editContext.domNode.domNode.dispatchEvent(e)},getLastRenderData:()=>{const e=this._viewCursors.getLastRenderData()||[],t=this._editContext.getLastRenderData();return new tL(e,t)},renderNow:()=>{this.render(!0,!1)},shouldSuppressMouseDownOnViewZone:e=>this._viewZones.shouldSuppressMouseDownOnViewZone(e),shouldSuppressMouseDownOnWidget:e=>this._contentWidgets.shouldSuppressMouseDownOnWidget(e),getPositionFromDOMInfo:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.getPositionFromDOMInfo(e,t)),visibleRangeForPosition:(e,t)=>{this._flushAccumulatedAndRenderNow();const i=new I(e,t);return this._viewLines.visibleRangeForPosition(i)??this._viewLinesGpu?.visibleRangeForPosition(i)??null},getLineWidth:e=>{if(this._flushAccumulatedAndRenderNow(),this._viewLinesGpu){const t=this._viewLinesGpu.getLineWidth(e);if(t!==void 0)return t}return this._viewLines.getLineWidth(e)}}}_createTextAreaHandlerHelper(){return{visibleRangeForPosition:e=>(this._flushAccumulatedAndRenderNow(),this._viewLines.visibleRangeForPosition(e)),linesVisibleRangesForRange:(e,t)=>(this._flushAccumulatedAndRenderNow(),this._viewLines.linesVisibleRangesForRange(e,t))}}_applyLayout(){const t=this._context.configuration.options.get(v.layoutInfo);this.domNode.setWidth(t.width),this.domNode.setHeight(t.height),this._overflowGuardContainer.setWidth(t.width),this._overflowGuardContainer.setHeight(t.height),this._linesContent.setWidth(16777216),this._linesContent.setHeight(16777216)}_getEditorClassName(){const e=this._editContext.isFocused()?" focused":"";return this._context.configuration.options.get(v.editorClassName)+" "+El(this._context.theme.type)+e}handleEvents(e){super.handleEvents(e),this._scheduleRender()}onConfigurationChanged(e){return this.domNode.setClassName(this._getEditorClassName()),this._updateEditContext(),this._applyLayout(),!1}onCursorStateChanged(e){return this._selections=e.selections,!1}onDecorationsChanged(e){return e.affectsGlyphMargin&&(this._shouldRecomputeGlyphMarginLanes=!0),!1}onFocusChanged(e){return this.domNode.setClassName(this._getEditorClassName()),!1}onThemeChanged(e){return this._context.theme.update(e.theme),this.domNode.setClassName(this._getEditorClassName()),!1}dispose(){this._renderAnimationFrame!==null&&(this._renderAnimationFrame.dispose(),this._renderAnimationFrame=null),this._contentWidgets.overflowingContentWidgetsDomNode.domNode.remove(),this._overlayWidgets.overflowingOverlayWidgetsDomNode.domNode.remove(),this._context.removeEventHandler(this),this._viewGpuContext?.dispose(),this._viewLines.dispose(),this._viewLinesGpu?.dispose();for(const e of this._viewParts)e.dispose();super.dispose()}_scheduleRender(){if(this._store.isDisposed)throw new Fe;if(this._renderAnimationFrame===null){this._editContext instanceof aa&&this._editContext.setEditContextOnDomNode();const e=this._createCoordinatedRendering();this._renderAnimationFrame=ac.INSTANCE.scheduleCoordinatedRendering({window:Ne(this.domNode?.domNode),prepareRenderText:()=>{if(this._store.isDisposed)throw new Fe;try{return e.prepareRenderText()}finally{this._renderAnimationFrame=null}},renderText:()=>{if(this._store.isDisposed)throw new Fe;return e.renderText()},prepareRender:(t,i)=>{if(this._store.isDisposed)throw new Fe;return e.prepareRender(t,i)},render:(t,i)=>{if(this._store.isDisposed)throw new Fe;return e.render(t,i)}})}}_flushAccumulatedAndRenderNow(){const e=this._createCoordinatedRendering();sn(()=>e.prepareRenderText());const t=sn(()=>e.renderText());if(t){const[i,n]=t;sn(()=>e.prepareRender(i,n)),sn(()=>e.render(i,n))}}_getViewPartsToRender(){const e=[];let t=0;for(const i of this._viewParts)i.shouldRender()&&(e[t++]=i);return e}_createCoordinatedRendering(){return{prepareRenderText:()=>{if(this._shouldRecomputeGlyphMarginLanes){this._shouldRecomputeGlyphMarginLanes=!1;const e=this._computeGlyphMarginLanes();this._context.configuration.setGlyphMarginDecorationLaneCount(e.requiredLanes)}tn.onRenderStart()},renderText:()=>{if(!this.domNode.domNode.isConnected)return null;let e=this._getViewPartsToRender();if(!this._viewLines.shouldRender()&&e.length===0)return null;const t=this._context.viewLayout.getLinesViewportData();this._context.viewModel.setViewport(t.startLineNumber,t.endLineNumber,t.centeredLineNumber);const i=new qv(this._selections,t,this._context.viewLayout.getWhitespaceViewportData(),this._context.viewModel);return this._contentWidgets.shouldRender()&&this._contentWidgets.onBeforeRender(i),this._viewLines.shouldRender()&&(this._viewLines.renderText(i),this._viewLines.onDidRender(),e=this._getViewPartsToRender()),this._viewLinesGpu?.shouldRender()&&(this._viewLinesGpu.renderText(i),this._viewLinesGpu.onDidRender()),[e,new kw(this._context.viewLayout,i,this._viewLines,this._viewLinesGpu)]},prepareRender:(e,t)=>{for(const i of e)i.prepareRender(t)},render:(e,t)=>{for(const i of e)i.render(t),i.onDidRender()}}}delegateVerticalScrollbarPointerDown(e){this._scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this._scrollbar.delegateScrollFromMouseWheelEvent(e)}restoreState(e){this._context.viewModel.viewLayout.setScrollPosition({scrollTop:e.scrollTop,scrollLeft:e.scrollLeft},K.Immediate),this._context.viewModel.visibleLinesStabilized()}getOffsetForColumn(e,t){const i=this._context.viewModel.model.validatePosition({lineNumber:e,column:t}),n=this._context.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i);this._flushAccumulatedAndRenderNow();const s=this._viewLines.visibleRangeForPosition(new I(n.lineNumber,n.column));return s?s.left:-1}getTargetAtClientPoint(e,t){const i=this._pointerHandler.getTargetAtClientPoint(e,t);return i?za.convertViewToModelMouseTarget(i,this._context.viewModel.coordinatesConverter):null}createOverviewRuler(e){return new Ov(this._context,e)}change(e){this._viewZones.changeViewZones(e),this._scheduleRender()}render(e,t){if(t){this._viewLines.forceShouldRender();for(const i of this._viewParts)i.forceShouldRender()}e?this._flushAccumulatedAndRenderNow():this._scheduleRender()}writeScreenReaderContent(e){this._editContext.writeScreenReaderContent(e)}focus(){this._editContext.focus()}isFocused(){return this._editContext.isFocused()}isWidgetFocused(){return this._widgetFocusTracker.hasFocus()}refreshFocusState(){this._editContext.refreshFocusState(),this._widgetFocusTracker.refreshState()}setAriaOptions(e){this._editContext.setAriaOptions(e)}addContentWidget(e){this._contentWidgets.addWidget(e.widget),this.layoutContentWidget(e),this._scheduleRender()}layoutContentWidget(e){this._contentWidgets.setWidgetPosition(e.widget,e.position?.position??null,e.position?.secondaryPosition??null,e.position?.preference??null,e.position?.positionAffinity??null),this._scheduleRender()}removeContentWidget(e){this._contentWidgets.removeWidget(e.widget),this._scheduleRender()}addOverlayWidget(e){this._overlayWidgets.addWidget(e.widget),this.layoutOverlayWidget(e),this._scheduleRender()}layoutOverlayWidget(e){this._overlayWidgets.setWidgetPosition(e.widget,e.position)&&this._scheduleRender()}removeOverlayWidget(e){this._overlayWidgets.removeWidget(e.widget),this._scheduleRender()}addGlyphMarginWidget(e){this._glyphMarginWidgets.addWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}layoutGlyphMarginWidget(e){const t=e.position;this._glyphMarginWidgets.setWidgetPosition(e.widget,t)&&(this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender())}removeGlyphMarginWidget(e){this._glyphMarginWidgets.removeWidget(e.widget),this._shouldRecomputeGlyphMarginLanes=!0,this._scheduleRender()}};sd=ge([P(8,Me)],sd);function sn(a){try{return a()}catch(e){return vt(e),null}}class ac{static{this.INSTANCE=new ac}constructor(){this._coordinatedRenderings=[],this._animationFrameRunners=new Map}scheduleCoordinatedRendering(e){return this._coordinatedRenderings.push(e),this._scheduleRender(e.window),{dispose:()=>{const t=this._coordinatedRenderings.indexOf(e);if(t!==-1&&(this._coordinatedRenderings.splice(t,1),this._coordinatedRenderings.length===0)){for(const[i,n]of this._animationFrameRunners)n.dispose();this._animationFrameRunners.clear()}}}}_scheduleRender(e){if(!this._animationFrameRunners.has(e)){const t=()=>{this._animationFrameRunners.delete(e),this._onRenderScheduled()};this._animationFrameRunners.set(e,lp(e,t,100))}}_onRenderScheduled(){const e=this._coordinatedRenderings.slice(0);this._coordinatedRenderings=[];for(const i of e)sn(()=>i.prepareRenderText());const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];t[i]=sn(()=>s.renderText())}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,l]=o;sn(()=>s.prepareRender(r,l))}for(let i=0,n=e.length;i<n;i++){const s=e[i],o=t[i];if(!o)continue;const[r,l]=o;sn(()=>s.render(r,l))}}}class Rb extends U{constructor(e,t){super(),this._onChange=this._register(new Z),this.onChange=this._onChange.event,this._hadFocus=void 0,this._hasDomElementFocus=!1,this._domFocusTracker=this._register(Pc(e)),this._overflowWidgetsDomNodeHasFocus=!1,this._register(this._domFocusTracker.onDidFocus(()=>{this._hasDomElementFocus=!0,this._update()})),this._register(this._domFocusTracker.onDidBlur(()=>{this._hasDomElementFocus=!1,this._update()})),t&&(this._overflowWidgetsDomNode=this._register(Pc(t)),this._register(this._overflowWidgetsDomNode.onDidFocus(()=>{this._overflowWidgetsDomNodeHasFocus=!0,this._update()})),this._register(this._overflowWidgetsDomNode.onDidBlur(()=>{this._overflowWidgetsDomNodeHasFocus=!1,this._update()})))}_update(){const e=this._hasDomElementFocus||this._overflowWidgetsDomNodeHasFocus;this._hadFocus!==e&&(this._hadFocus=e,this._onChange.fire(void 0))}hasFocus(){return this._hadFocus??!1}refreshState(){this._domFocusTracker.refreshState(),this._overflowWidgetsDomNode?.refreshState?.()}}class vo{constructor(e,t,i,n,s){this.injectionOffsets=e,this.injectionOptions=t,this.breakOffsets=i,this.breakOffsetsVisibleColumn=n,this.wrappedTextIndentLength=s}getOutputLineCount(){return this.breakOffsets.length}getMinOutputOffset(e){return e>0?this.wrappedTextIndentLength:0}getLineLength(e){const t=e>0?this.breakOffsets[e-1]:0;let n=this.breakOffsets[e]-t;return e>0&&(n+=this.wrappedTextIndentLength),n}getMaxOutputOffset(e){return this.getLineLength(e)}translateToInputOffset(e,t){e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength));let n=e===0?t:this.breakOffsets[e-1]+t;if(this.injectionOffsets!==null)for(let s=0;s<this.injectionOffsets.length&&n>this.injectionOffsets[s];s++)n<this.injectionOffsets[s]+this.injectionOptions[s].content.length?n=this.injectionOffsets[s]:n-=this.injectionOptions[s].content.length;return n}translateToOutputPosition(e,t=Ie.None){let i=e;if(this.injectionOffsets!==null)for(let n=0;n<this.injectionOffsets.length&&!(e<this.injectionOffsets[n]||t!==Ie.Right&&e===this.injectionOffsets[n]);n++)i+=this.injectionOptions[n].content.length;return this.offsetInInputWithInjectionsToOutputPosition(i,t)}offsetInInputWithInjectionsToOutputPosition(e,t=Ie.None){let i=0,n=this.breakOffsets.length-1,s=0,o=0;for(;i<=n;){s=i+(n-i)/2|0;const l=this.breakOffsets[s];if(o=s>0?this.breakOffsets[s-1]:0,t===Ie.Left)if(e<=o)n=s-1;else if(e>l)i=s+1;else break;else if(e<o)n=s-1;else if(e>=l)i=s+1;else break}let r=e-o;return s>0&&(r+=this.wrappedTextIndentLength),new br(s,r)}normalizeOutputPosition(e,t,i){if(this.injectionOffsets!==null){const n=this.outputPositionToOffsetInInputWithInjections(e,t),s=this.normalizeOffsetInInputWithInjectionsAroundInjections(n,i);if(s!==n)return this.offsetInInputWithInjectionsToOutputPosition(s,i)}if(i===Ie.Left){if(e>0&&t===this.getMinOutputOffset(e))return new br(e-1,this.getMaxOutputOffset(e-1))}else if(i===Ie.Right){const n=this.getOutputLineCount()-1;if(e<n&&t===this.getMaxOutputOffset(e))return new br(e+1,this.getMinOutputOffset(e+1))}return new br(e,t)}outputPositionToOffsetInInputWithInjections(e,t){return e>0&&(t=Math.max(0,t-this.wrappedTextIndentLength)),(e>0?this.breakOffsets[e-1]:0)+t}normalizeOffsetInInputWithInjectionsAroundInjections(e,t){const i=this.getInjectedTextAtOffset(e);if(!i)return e;if(t===Ie.None){if(e===i.offsetInInputWithInjections+i.length&&Nh(this.injectionOptions[i.injectedTextIndex].cursorStops))return i.offsetInInputWithInjections+i.length;{let n=i.offsetInInputWithInjections;if(Eh(this.injectionOptions[i.injectedTextIndex].cursorStops))return n;let s=i.injectedTextIndex-1;for(;s>=0&&this.injectionOffsets[s]===this.injectionOffsets[i.injectedTextIndex]&&!(Nh(this.injectionOptions[s].cursorStops)||(n-=this.injectionOptions[s].content.length,Eh(this.injectionOptions[s].cursorStops)));)s--;return n}}else if(t===Ie.Right||t===Ie.RightOfInjectedText){let n=i.offsetInInputWithInjections+i.length,s=i.injectedTextIndex;for(;s+1<this.injectionOffsets.length&&this.injectionOffsets[s+1]===this.injectionOffsets[s];)n+=this.injectionOptions[s+1].content.length,s++;return n}else if(t===Ie.Left||t===Ie.LeftOfInjectedText){let n=i.offsetInInputWithInjections,s=i.injectedTextIndex;for(;s-1>=0&&this.injectionOffsets[s-1]===this.injectionOffsets[s];)n-=this.injectionOptions[s-1].content.length,s--;return n}dp()}getInjectedText(e,t){const i=this.outputPositionToOffsetInInputWithInjections(e,t),n=this.getInjectedTextAtOffset(i);return n?{options:this.injectionOptions[n.injectedTextIndex]}:null}getInjectedTextAtOffset(e){const t=this.injectionOffsets,i=this.injectionOptions;if(t!==null){let n=0;for(let s=0;s<t.length;s++){const o=i[s].content.length,r=t[s]+n,l=t[s]+n+o;if(r>e)break;if(e<=l)return{injectedTextIndex:s,offsetInInputWithInjections:r,length:o};n+=o}}}}function Nh(a){return a==null?!0:a===Gr.Right||a===Gr.Both}function Eh(a){return a==null?!0:a===Gr.Left||a===Gr.Both}class br{constructor(e,t){this.outputLineIndex=e,this.outputOffset=t}toString(){return`${this.outputLineIndex}:${this.outputOffset}`}toPosition(e){return new I(e+this.outputLineIndex,this.outputOffset+1)}}const Db=ir("domLineBreaksComputer",{createHTML:a=>a});class lc{static create(e){return new lc(new WeakRef(e))}constructor(e){this.targetWindow=e}createLineBreaksComputer(e,t,i,n,s){const o=[],r=[];return{addRequest:(l,d,c)=>{o.push(l),r.push(d)},finalize:()=>Tb(ku(this.targetWindow.deref()),o,e,t,i,n,s,r)}}}function Tb(a,e,t,i,n,s,o,r){function l(x){const R=r[x];if(R){const D=Ps.applyInjectedText(e[x],R),A=R.map(H=>H.options),W=R.map(H=>H.column-1);return new vo(W,A,[D.length],[],0)}else return null}if(n===-1){const x=[];for(let R=0,D=e.length;R<D;R++)x[R]=l(R);return x}const d=Math.round(n*t.typicalHalfwidthCharacterWidth),c=s===Un.DeepIndent?2:s===Un.Indent?1:0,h=Math.round(i*c),u=Math.ceil(t.spaceWidth*h),g=document.createElement("div");st(g,t);const f=new Jo(1e4),m=[],_=[],L=[],w=[],p=[];for(let x=0;x<e.length;x++){const R=Ps.applyInjectedText(e[x],r[x]);let D=0,A=0,W=d;if(s!==Un.None)if(D=zi(R),D===-1)D=0;else{for(let X=0;X<D;X++){const te=R.charCodeAt(X)===V.Tab?i-A%i:1;A+=te}const oe=Math.ceil(t.spaceWidth*A);oe+t.typicalFullwidthCharacterWidth>d?(D=0,A=0):W=d-oe}const H=R.substr(D),G=Mb(H,A,i,W,f,u);m[x]=D,_[x]=A,L[x]=H,w[x]=G[0],p[x]=G[1]}const C=f.build(),b=Db?.createHTML(C)??C;g.innerHTML=b,g.style.position="absolute",g.style.top="10000",o==="keepAll"?(g.style.wordBreak="keep-all",g.style.overflowWrap="anywhere"):(g.style.wordBreak="inherit",g.style.overflowWrap="break-word"),a.document.body.appendChild(g);const S=document.createRange(),y=Array.prototype.slice.call(g.children,0),E=[];for(let x=0;x<e.length;x++){const R=y[x],D=Ab(S,R,L[x],w[x]);if(D===null){E[x]=l(x);continue}const A=m[x],W=_[x]+h,H=p[x],G=[];for(let F=0,Q=D.length;F<Q;F++)G[F]=H[D[F]];if(A!==0)for(let F=0,Q=D.length;F<Q;F++)D[F]+=A;let oe,X;const te=r[x];te?(oe=te.map(F=>F.options),X=te.map(F=>F.column-1)):(oe=null,X=null),E[x]=new vo(X,oe,D,G,W)}return g.remove(),E}var Fn;(function(a){a[a.SPAN_MODULO_LIMIT=16384]="SPAN_MODULO_LIMIT"})(Fn||(Fn={}));function Mb(a,e,t,i,n,s){if(s!==0){const u=String(s);n.appendString('<div style="text-indent: -'),n.appendString(u),n.appendString("px; padding-left: "),n.appendString(u),n.appendString("px; box-sizing: border-box; width:")}else n.appendString('<div style="width:');n.appendString(String(i)),n.appendString('px;">');const o=a.length;let r=e,l=0;const d=[],c=[];let h=0<o?a.charCodeAt(0):V.Null;n.appendString("<span>");for(let u=0;u<o;u++){u!==0&&u%Fn.SPAN_MODULO_LIMIT===0&&n.appendString("</span><span>"),d[u]=l,c[u]=r;const g=h;h=u+1<o?a.charCodeAt(u+1):V.Null;let f=1,m=1;switch(g){case V.Tab:f=t-r%t,m=f;for(let _=1;_<=f;_++)_<f?n.appendCharCode(160):n.appendASCIICharCode(V.Space);break;case V.Space:h===V.Space?n.appendCharCode(160):n.appendASCIICharCode(V.Space);break;case V.LessThan:n.appendString("&lt;");break;case V.GreaterThan:n.appendString("&gt;");break;case V.Ampersand:n.appendString("&amp;");break;case V.Null:n.appendString("&#00;");break;case V.UTF8_BOM:case V.LINE_SEPARATOR:case V.PARAGRAPH_SEPARATOR:case V.NEXT_LINE:n.appendCharCode(65533);break;default:Yn(g)&&m++,g<32?n.appendCharCode(9216+g):n.appendCharCode(g)}l+=f,r+=m}return n.appendString("</span>"),d[a.length]=l,c[a.length]=r,n.appendString("</div>"),[d,c]}function Ab(a,e,t,i){if(t.length<=1)return null;const n=Array.prototype.slice.call(e.children,0),s=[];try{od(a,n,i,0,null,t.length-1,null,s)}catch(o){return console.log(o),null}return s.length===0?null:(s.push(t.length),s)}function od(a,e,t,i,n,s,o,r){if(i===s||(n=n||gl(a,e,t[i],t[i+1]),o=o||gl(a,e,t[s],t[s+1]),Math.abs(n[0].top-o[0].top)<=.1))return;if(i+1===s){r.push(s);return}const l=i+(s-i)/2|0,d=gl(a,e,t[l],t[l+1]);od(a,e,t,i,n,l,d,r),od(a,e,t,l,d,s,o,r)}function gl(a,e,t,i){return a.setStart(e[t/Fn.SPAN_MODULO_LIMIT|0].firstChild,t%Fn.SPAN_MODULO_LIMIT),a.setEnd(e[i/Fn.SPAN_MODULO_LIMIT|0].firstChild,i%Fn.SPAN_MODULO_LIMIT),a.getClientRects()}class Ob extends U{constructor(){super(),this._editor=null,this._instantiationService=null,this._instances=this._register(new cp),this._pending=new Map,this._finishedInstantiation=[],this._finishedInstantiation[Kt.Eager]=!1,this._finishedInstantiation[Kt.AfterFirstRender]=!1,this._finishedInstantiation[Kt.BeforeFirstInteraction]=!1,this._finishedInstantiation[Kt.Eventually]=!1}initialize(e,t,i){this._editor=e,this._instantiationService=i;for(const n of t){if(this._pending.has(n.id)){vt(new Error(`Cannot have two contributions with the same id ${n.id}`));continue}this._pending.set(n.id,n)}this._instantiateSome(Kt.Eager),this._register(gr(Ne(this._editor.getDomNode()),()=>{this._instantiateSome(Kt.AfterFirstRender)})),this._register(gr(Ne(this._editor.getDomNode()),()=>{this._instantiateSome(Kt.BeforeFirstInteraction)})),this._register(gr(Ne(this._editor.getDomNode()),()=>{this._instantiateSome(Kt.Eventually)},5e3))}saveViewState(){const e={};for(const[t,i]of this._instances)typeof i.saveViewState=="function"&&(e[t]=i.saveViewState());return e}restoreViewState(e){for(const[t,i]of this._instances)typeof i.restoreViewState=="function"&&i.restoreViewState(e[t])}get(e){return this._instantiateById(e),this._instances.get(e)||null}set(e,t){this._instances.set(e,t)}onBeforeInteractionEvent(){this._instantiateSome(Kt.BeforeFirstInteraction)}onAfterModelAttached(){return gr(Ne(this._editor?.getDomNode()),()=>{this._instantiateSome(Kt.AfterFirstRender)},50)}_instantiateSome(e){if(this._finishedInstantiation[e])return;this._finishedInstantiation[e]=!0;const t=this._findPendingContributionsByInstantiation(e);for(const i of t)this._instantiateById(i.id)}_findPendingContributionsByInstantiation(e){const t=[];for(const[,i]of this._pending)i.instantiation===e&&t.push(i);return t}_instantiateById(e){const t=this._pending.get(e);if(t){if(this._pending.delete(e),!this._instantiationService||!this._editor)throw new Error("Cannot instantiate contributions before being initialized!");try{const i=this._instantiationService.createInstance(t.ctor,this._editor);this._instances.set(t.id,i),typeof i.restoreViewState=="function"&&t.instantiation!==Kt.Eager&&console.warn(`Editor contribution '${t.id}' should be eager instantiated because it uses saveViewState / restoreViewState.`)}catch(i){vt(i)}}}}class Gg{constructor(e,t,i,n,s,o,r){this.id=e,this.label=t,this.alias=i,this.metadata=n,this._precondition=s,this._run=o,this._contextKeyService=r}isSupported(){return this._contextKeyService.contextMatchesRules(this._precondition)}run(e){return this.isSupported()?this._run(e):Promise.resolve(void 0)}}class dc{static create(e){return new dc(e.get(v.wordWrapBreakBeforeCharacters),e.get(v.wordWrapBreakAfterCharacters))}constructor(e,t){this.classifier=new Pb(e,t)}createLineBreaksComputer(e,t,i,n,s){const o=[],r=[],l=[];return{addRequest:(d,c,h)=>{o.push(d),r.push(c),l.push(h)},finalize:()=>{const d=e.typicalFullwidthCharacterWidth/e.typicalHalfwidthCharacterWidth,c=[];for(let h=0,u=o.length;h<u;h++){const g=r[h],f=l[h];f&&!f.injectionOptions&&!g?c[h]=kb(this.classifier,f,o[h],t,i,d,n,s):c[h]=Wb(this.classifier,o[h],g,t,i,d,n,s)}return rd.length=0,ad.length=0,c}}}}var gt;(function(a){a[a.NONE=0]="NONE",a[a.BREAK_BEFORE=1]="BREAK_BEFORE",a[a.BREAK_AFTER=2]="BREAK_AFTER",a[a.BREAK_IDEOGRAPHIC=3]="BREAK_IDEOGRAPHIC"})(gt||(gt={}));class Pb extends hp{constructor(e,t){super(gt.NONE);for(let i=0;i<e.length;i++)this.set(e.charCodeAt(i),gt.BREAK_BEFORE);for(let i=0;i<t.length;i++)this.set(t.charCodeAt(i),gt.BREAK_AFTER)}get(e){return e>=0&&e<256?this._asciiMap[e]:e>=12352&&e<=12543||e>=13312&&e<=19903||e>=19968&&e<=40959?gt.BREAK_IDEOGRAPHIC:this._map.get(e)||this._defaultValue}}let rd=[],ad=[];function kb(a,e,t,i,n,s,o,r){if(n===-1)return null;const l=t.length;if(l<=1)return null;const d=r==="keepAll",c=e.breakOffsets,h=e.breakOffsetsVisibleColumn,u=jg(t,i,n,s,o),g=n-u,f=rd,m=ad;let _=0,L=0,w=0,p=n;const C=c.length;let b=0;if(b>=0){let S=Math.abs(h[b]-p);for(;b+1<C;){const y=Math.abs(h[b+1]-p);if(y>=S)break;S=y,b++}}for(;b<C;){let S=b<0?0:c[b],y=b<0?0:h[b];L>S&&(S=L,y=w);let E=0,x=0,R=0,D=0;if(y<=p){let W=y,H=S===0?V.Null:t.charCodeAt(S-1),G=S===0?gt.NONE:a.get(H),oe=!0;for(let X=S;X<l;X++){const te=X,F=t.charCodeAt(X);let Q,ve;if(Ii(F)?(X++,Q=gt.NONE,ve=2):(Q=a.get(F),ve=bo(F,W,i,s)),te>L&&ld(H,G,F,Q,d)&&(E=te,x=W),W+=ve,W>p){te>L?(R=te,D=W-ve):(R=X+1,D=W),W-x>g&&(E=0),oe=!1;break}H=F,G=Q}if(oe){_>0&&(f[_]=c[c.length-1],m[_]=h[c.length-1],_++);break}}if(E===0){let W=y,H=t.charCodeAt(S),G=a.get(H),oe=!1;for(let X=S-1;X>=L;X--){const te=X+1,F=t.charCodeAt(X);if(F===V.Tab){oe=!0;break}let Q,ve;if(Pu(F)?(X--,Q=gt.NONE,ve=2):(Q=a.get(F),ve=Yn(F)?s:1),W<=p){if(R===0&&(R=te,D=W),W<=p-g)break;if(ld(F,Q,H,G,d)){E=te,x=W;break}}W-=ve,H=F,G=Q}if(E!==0){const X=g-(D-x);if(X<=i){const te=t.charCodeAt(R);let F;Ii(te)?F=2:F=bo(te,D,i,s),X-F<0&&(E=0)}}if(oe){b--;continue}}if(E===0&&(E=R,x=D),E<=L){const W=t.charCodeAt(L);Ii(W)?(E=L+2,x=w+2):(E=L+1,x=w+bo(W,w,i,s))}for(L=E,f[_]=E,w=x,m[_]=x,_++,p=x+g;b<0||b<C&&h[b]<x;)b++;let A=Math.abs(h[b]-p);for(;b+1<C;){const W=Math.abs(h[b+1]-p);if(W>=A)break;A=W,b++}}return _===0?null:(f.length=_,m.length=_,rd=e.breakOffsets,ad=e.breakOffsetsVisibleColumn,e.breakOffsets=f,e.breakOffsetsVisibleColumn=m,e.wrappedTextIndentLength=u,e)}function Wb(a,e,t,i,n,s,o,r){const l=Ps.applyInjectedText(e,t);let d,c;if(t&&t.length>0?(d=t.map(x=>x.options),c=t.map(x=>x.column-1)):(d=null,c=null),n===-1)return d?new vo(c,d,[l.length],[],0):null;const h=l.length;if(h<=1)return d?new vo(c,d,[l.length],[],0):null;const u=r==="keepAll",g=jg(l,i,n,s,o),f=n-g,m=[],_=[];let L=0,w=0,p=0,C=n,b=l.charCodeAt(0),S=a.get(b),y=bo(b,0,i,s),E=1;Ii(b)&&(y+=1,b=l.charCodeAt(1),S=a.get(b),E++);for(let x=E;x<h;x++){const R=x,D=l.charCodeAt(x);let A,W;Ii(D)?(x++,A=gt.NONE,W=2):(A=a.get(D),W=bo(D,y,i,s)),ld(b,S,D,A,u)&&(w=R,p=y),y+=W,y>C&&((w===0||y-p>f)&&(w=R,p=y-W),m[L]=w,_[L]=p,L++,C=p+f,w=0),b=D,S=A}return L===0&&(!t||t.length===0)?null:(m[L]=h,_[L]=y,new vo(c,d,m,_,g))}function bo(a,e,t,i){return a===V.Tab?t-e%t:Yn(a)||a<32?i:1}function Ih(a,e){return e-a%e}function ld(a,e,t,i,n){return t!==V.Space&&(e===gt.BREAK_AFTER&&i!==gt.BREAK_AFTER||e!==gt.BREAK_BEFORE&&i===gt.BREAK_BEFORE||!n&&e===gt.BREAK_IDEOGRAPHIC&&i!==gt.BREAK_AFTER||!n&&i===gt.BREAK_IDEOGRAPHIC&&e!==gt.BREAK_BEFORE)}function jg(a,e,t,i,n){let s=0;if(n!==Un.None){const o=zi(a);if(o!==-1){for(let l=0;l<o;l++){const d=a.charCodeAt(l)===V.Tab?Ih(s,e):1;s+=d}const r=n===Un.DeepIndent?2:n===Un.Indent?1:0;for(let l=0;l<r;l++){const d=Ih(s,e);s+=d}s+i>t&&(s=0)}}return s}class la{constructor(e){this._selTrackedRange=null,this._trackSelection=!0,this._setState(e,new Qe(new N(1,1,1,1),wt.Simple,0,new I(1,1),0),new Qe(new N(1,1,1,1),wt.Simple,0,new I(1,1),0))}dispose(e){this._removeTrackedRange(e)}startTrackingSelection(e){this._trackSelection=!0,this._updateTrackedRange(e)}stopTrackingSelection(e){this._trackSelection=!1,this._removeTrackedRange(e)}_updateTrackedRange(e){this._trackSelection&&(this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,this.modelState.selection,Oe.AlwaysGrowsWhenTypingAtEdges))}_removeTrackedRange(e){this._selTrackedRange=e.model._setTrackedRange(this._selTrackedRange,null,Oe.AlwaysGrowsWhenTypingAtEdges)}asCursorState(){return new ie(this.modelState,this.viewState)}readSelectionFromMarkers(e){const t=e.model._getTrackedRange(this._selTrackedRange);return this.modelState.selection.isEmpty()&&!t.isEmpty()?le.fromRange(t.collapseToEnd(),this.modelState.selection.getDirection()):le.fromRange(t,this.modelState.selection.getDirection())}ensureValidState(e){this._setState(e,this.modelState,this.viewState)}setState(e,t,i){this._setState(e,t,i)}static _validatePositionWithCache(e,t,i,n){return t.equals(i)?n:e.normalizePosition(t,Ie.None)}static _validateViewState(e,t){const i=t.position,n=t.selectionStart.getStartPosition(),s=t.selectionStart.getEndPosition(),o=e.normalizePosition(i,Ie.None),r=this._validatePositionWithCache(e,n,i,o),l=this._validatePositionWithCache(e,s,n,r);return i.equals(o)&&n.equals(r)&&s.equals(l)?t:new Qe(N.fromPositions(r,l),t.selectionStartKind,t.selectionStartLeftoverVisibleColumns+n.column-r.column,o,t.leftoverVisibleColumns+i.column-o.column)}_setState(e,t,i){if(i&&(i=la._validateViewState(e.viewModel,i)),t){const n=e.model.validateRange(t.selectionStart),s=t.selectionStart.equalsRange(n)?t.selectionStartLeftoverVisibleColumns:0,o=e.model.validatePosition(t.position),r=t.position.equals(o)?t.leftoverVisibleColumns:0;t=new Qe(n,t.selectionStartKind,s,o,r)}else{if(!i)return;const n=e.model.validateRange(e.coordinatesConverter.convertViewRangeToModelRange(i.selectionStart)),s=e.model.validatePosition(e.coordinatesConverter.convertViewPositionToModelPosition(i.position));t=new Qe(n,i.selectionStartKind,i.selectionStartLeftoverVisibleColumns,s,i.leftoverVisibleColumns)}if(i){const n=e.coordinatesConverter.validateViewRange(i.selectionStart,t.selectionStart),s=e.coordinatesConverter.validateViewPosition(i.position,t.position);i=new Qe(n,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,s,t.leftoverVisibleColumns)}else{const n=e.coordinatesConverter.convertModelPositionToViewPosition(new I(t.selectionStart.startLineNumber,t.selectionStart.startColumn)),s=e.coordinatesConverter.convertModelPositionToViewPosition(new I(t.selectionStart.endLineNumber,t.selectionStart.endColumn)),o=new N(n.lineNumber,n.column,s.lineNumber,s.column),r=e.coordinatesConverter.convertModelPositionToViewPosition(t.position);i=new Qe(o,t.selectionStartKind,t.selectionStartLeftoverVisibleColumns,r,t.leftoverVisibleColumns)}this.modelState=t,this.viewState=i,this._updateTrackedRange(e)}}class Rh{constructor(e){this.context=e,this.cursors=[new la(e)],this.lastAddedCursorIndex=0}dispose(){for(const e of this.cursors)e.dispose(this.context)}startTrackingSelections(){for(const e of this.cursors)e.startTrackingSelection(this.context)}stopTrackingSelections(){for(const e of this.cursors)e.stopTrackingSelection(this.context)}updateContext(e){this.context=e}ensureValidState(){for(const e of this.cursors)e.ensureValidState(this.context)}readSelectionFromMarkers(){return this.cursors.map(e=>e.readSelectionFromMarkers(this.context))}getAll(){return this.cursors.map(e=>e.asCursorState())}getViewPositions(){return this.cursors.map(e=>e.viewState.position)}getTopMostViewPosition(){return up(this.cursors,Gn(e=>e.viewState.position,I.compare)).viewState.position}getBottomMostViewPosition(){return gp(this.cursors,Gn(e=>e.viewState.position,I.compare)).viewState.position}getSelections(){return this.cursors.map(e=>e.modelState.selection)}getViewSelections(){return this.cursors.map(e=>e.viewState.selection)}setSelections(e){this.setStates(ie.fromModelSelections(e))}getPrimaryCursor(){return this.cursors[0].asCursorState()}setStates(e){e!==null&&(this.cursors[0].setState(this.context,e[0].modelState,e[0].viewState),this._setSecondaryStates(e.slice(1)))}_setSecondaryStates(e){const t=this.cursors.length-1,i=e.length;if(t<i){const n=i-t;for(let s=0;s<n;s++)this._addSecondaryCursor()}else if(t>i){const n=t-i;for(let s=0;s<n;s++)this._removeSecondaryCursor(this.cursors.length-2)}for(let n=0;n<i;n++)this.cursors[n+1].setState(this.context,e[n].modelState,e[n].viewState)}killSecondaryCursors(){this._setSecondaryStates([])}_addSecondaryCursor(){this.cursors.push(new la(this.context)),this.lastAddedCursorIndex=this.cursors.length-1}getLastAddedCursorIndex(){return this.cursors.length===1||this.lastAddedCursorIndex===0?0:this.lastAddedCursorIndex}_removeSecondaryCursor(e){this.lastAddedCursorIndex>=e+1&&this.lastAddedCursorIndex--,this.cursors[e+1].dispose(this.context),this.cursors.splice(e+1,1)}normalize(){if(this.cursors.length===1)return;const e=this.cursors.slice(0),t=[];for(let i=0,n=e.length;i<n;i++)t.push({index:i,selection:e[i].modelState.selection});t.sort(Gn(i=>i.selection,N.compareRangesUsingStarts));for(let i=0;i<t.length-1;i++){const n=t[i],s=t[i+1],o=n.selection,r=s.selection;if(!this.context.cursorConfig.multiCursorMergeOverlapping)continue;let l;if(r.isEmpty()||o.isEmpty()?l=r.getStartPosition().isBeforeOrEqual(o.getEndPosition()):l=r.getStartPosition().isBefore(o.getEndPosition()),l){const d=n.index<s.index?i:i+1,c=n.index<s.index?i+1:i,h=t[c].index,u=t[d].index,g=t[c].selection,f=t[d].selection;if(!g.equalsSelection(f)){const m=g.plusRange(f),_=g.selectionStartLineNumber===g.startLineNumber&&g.selectionStartColumn===g.startColumn,L=f.selectionStartLineNumber===f.startLineNumber&&f.selectionStartColumn===f.startColumn;let w;h===this.lastAddedCursorIndex?(w=_,this.lastAddedCursorIndex=u):w=L;let p;w?p=new le(m.startLineNumber,m.startColumn,m.endLineNumber,m.endColumn):p=new le(m.endLineNumber,m.endColumn,m.startLineNumber,m.startColumn),t[d].selection=p;const C=ie.fromModelSelection(p);e[u].setState(this.context,C.modelState,C.viewState)}for(const m of t)m.index>h&&m.index--;e.splice(h,1),t.splice(c,1),this._removeSecondaryCursor(h-1),i--}}}}class Dh{constructor(e,t,i,n){this._cursorContextBrand=void 0,this.model=e,this.viewModel=t,this.coordinatesConverter=i,this.cursorConfig=n}}class Vb extends U{constructor(){super(),this._onEvent=this._register(new Z),this.onEvent=this._onEvent.event,this._eventHandlers=[],this._viewEventQueue=null,this._isConsumingViewEventQueue=!1,this._collector=null,this._collectorCnt=0,this._outgoingEvents=[]}emitOutgoingEvent(e){this._addOutgoingEvent(e),this._emitOutgoingEvents()}_addOutgoingEvent(e){for(let t=0,i=this._outgoingEvents.length;t<i;t++){const n=this._outgoingEvents[t].kind===e.kind?this._outgoingEvents[t].attemptToMerge(e):null;if(n){this._outgoingEvents[t]=n;return}}this._outgoingEvents.push(e)}_emitOutgoingEvents(){for(;this._outgoingEvents.length>0;){if(this._collector||this._isConsumingViewEventQueue)return;const e=this._outgoingEvents.shift();e.isNoOp()||this._onEvent.fire(e)}}addViewEventHandler(e){for(let t=0,i=this._eventHandlers.length;t<i;t++)this._eventHandlers[t]===e&&console.warn("Detected duplicate listener in ViewEventDispatcher",e);this._eventHandlers.push(e)}removeViewEventHandler(e){for(let t=0;t<this._eventHandlers.length;t++)if(this._eventHandlers[t]===e){this._eventHandlers.splice(t,1);break}}beginEmitViewEvents(){return this._collectorCnt++,this._collectorCnt===1&&(this._collector=new Fb),this._collector}endEmitViewEvents(){if(this._collectorCnt--,this._collectorCnt===0){const e=this._collector.outgoingEvents,t=this._collector.viewEvents;this._collector=null;for(const i of e)this._addOutgoingEvent(i);t.length>0&&this._emitMany(t)}this._emitOutgoingEvents()}emitSingleViewEvent(e){try{this.beginEmitViewEvents().emitViewEvent(e)}finally{this.endEmitViewEvents()}}_emitMany(e){this._viewEventQueue?this._viewEventQueue=this._viewEventQueue.concat(e):this._viewEventQueue=e,this._isConsumingViewEventQueue||this._consumeViewEventQueue()}_consumeViewEventQueue(){try{this._isConsumingViewEventQueue=!0,this._doConsumeQueue()}finally{this._isConsumingViewEventQueue=!1}}_doConsumeQueue(){for(;this._viewEventQueue;){const e=this._viewEventQueue;this._viewEventQueue=null;const t=this._eventHandlers.slice(0);for(const i of t)i.handleEvents(e)}}}class Fb{constructor(){this.viewEvents=[],this.outgoingEvents=[]}emitViewEvent(e){this.viewEvents.push(e)}emitOutgoingEvent(e){this.outgoingEvents.push(e)}}var be;(function(a){a[a.ContentSizeChanged=0]="ContentSizeChanged",a[a.FocusChanged=1]="FocusChanged",a[a.WidgetFocusChanged=2]="WidgetFocusChanged",a[a.ScrollChanged=3]="ScrollChanged",a[a.ViewZonesChanged=4]="ViewZonesChanged",a[a.HiddenAreasChanged=5]="HiddenAreasChanged",a[a.ReadOnlyEditAttempt=6]="ReadOnlyEditAttempt",a[a.CursorStateChanged=7]="CursorStateChanged",a[a.ModelDecorationsChanged=8]="ModelDecorationsChanged",a[a.ModelLanguageChanged=9]="ModelLanguageChanged",a[a.ModelLanguageConfigurationChanged=10]="ModelLanguageConfigurationChanged",a[a.ModelContentChanged=11]="ModelContentChanged",a[a.ModelOptionsChanged=12]="ModelOptionsChanged",a[a.ModelTokensChanged=13]="ModelTokensChanged",a[a.ModelLineHeightChanged=14]="ModelLineHeightChanged"})(be||(be={}));class cc{constructor(e,t,i,n){this.kind=be.ContentSizeChanged,this._oldContentWidth=e,this._oldContentHeight=t,this.contentWidth=i,this.contentHeight=n,this.contentWidthChanged=this._oldContentWidth!==this.contentWidth,this.contentHeightChanged=this._oldContentHeight!==this.contentHeight}isNoOp(){return!this.contentWidthChanged&&!this.contentHeightChanged}attemptToMerge(e){return e.kind!==this.kind?null:new cc(this._oldContentWidth,this._oldContentHeight,e.contentWidth,e.contentHeight)}}class Ka{constructor(e,t){this.kind=be.FocusChanged,this.oldHasFocus=e,this.hasFocus=t}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(e){return e.kind!==this.kind?null:new Ka(this.oldHasFocus,e.hasFocus)}}class Hb{constructor(e,t){this.kind=be.WidgetFocusChanged,this.oldHasFocus=e,this.hasFocus=t}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(e){return e.kind!==this.kind?null:new Ka(this.oldHasFocus,e.hasFocus)}}class hc{constructor(e,t,i,n,s,o,r,l){this.kind=be.ScrollChanged,this._oldScrollWidth=e,this._oldScrollLeft=t,this._oldScrollHeight=i,this._oldScrollTop=n,this.scrollWidth=s,this.scrollLeft=o,this.scrollHeight=r,this.scrollTop=l,this.scrollWidthChanged=this._oldScrollWidth!==this.scrollWidth,this.scrollLeftChanged=this._oldScrollLeft!==this.scrollLeft,this.scrollHeightChanged=this._oldScrollHeight!==this.scrollHeight,this.scrollTopChanged=this._oldScrollTop!==this.scrollTop}isNoOp(){return!this.scrollWidthChanged&&!this.scrollLeftChanged&&!this.scrollHeightChanged&&!this.scrollTopChanged}attemptToMerge(e){return e.kind!==this.kind?null:new hc(this._oldScrollWidth,this._oldScrollLeft,this._oldScrollHeight,this._oldScrollTop,e.scrollWidth,e.scrollLeft,e.scrollHeight,e.scrollTop)}}class Bb{constructor(){this.kind=be.ViewZonesChanged}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class zb{constructor(){this.kind=be.HiddenAreasChanged}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class da{constructor(e,t,i,n,s,o,r){this.kind=be.CursorStateChanged,this.oldSelections=e,this.selections=t,this.oldModelVersionId=i,this.modelVersionId=n,this.source=s,this.reason=o,this.reachedMaxCursorCount=r}static _selectionsAreEqual(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const i=e.length,n=t.length;if(i!==n)return!1;for(let s=0;s<i;s++)if(!e[s].equalsSelection(t[s]))return!1;return!0}isNoOp(){return da._selectionsAreEqual(this.oldSelections,this.selections)&&this.oldModelVersionId===this.modelVersionId}attemptToMerge(e){return e.kind!==this.kind?null:new da(this.oldSelections,e.selections,this.oldModelVersionId,e.modelVersionId,e.source,e.reason,this.reachedMaxCursorCount||e.reachedMaxCursorCount)}}class Ub{constructor(){this.kind=be.ReadOnlyEditAttempt}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class Gb{constructor(e){this.event=e,this.kind=be.ModelDecorationsChanged}isNoOp(){return!1}attemptToMerge(e){return null}}class jb{constructor(e){this.event=e,this.kind=be.ModelLanguageChanged}isNoOp(){return!1}attemptToMerge(e){return null}}class Kb{constructor(e){this.event=e,this.kind=be.ModelLanguageConfigurationChanged}isNoOp(){return!1}attemptToMerge(e){return null}}class $b{constructor(e){this.event=e,this.kind=be.ModelContentChanged}isNoOp(){return!1}attemptToMerge(e){return null}}class Zb{constructor(e){this.event=e,this.kind=be.ModelOptionsChanged}isNoOp(){return!1}attemptToMerge(e){return null}}class qb{constructor(e){this.event=e,this.kind=be.ModelTokensChanged}isNoOp(){return!1}attemptToMerge(e){return null}}class Xb{constructor(e){this.event=e,this.kind=be.ModelLineHeightChanged}isNoOp(){return!1}attemptToMerge(e){return null}}class Yb extends U{constructor(e,t,i,n){super(),this._model=e,this._knownModelVersionId=this._model.getVersionId(),this._viewModel=t,this._coordinatesConverter=i,this.context=new Dh(this._model,this._viewModel,this._coordinatesConverter,n),this._cursors=new Rh(this.context),this._hasFocus=!1,this._isHandling=!1,this._compositionState=null,this._columnSelectData=null,this._autoClosedActions=[],this._prevEditOperationType=we.Other}dispose(){this._cursors.dispose(),this._autoClosedActions=Po(this._autoClosedActions),super.dispose()}updateConfiguration(e){this.context=new Dh(this._model,this._viewModel,this._coordinatesConverter,e),this._cursors.updateContext(this.context)}onLineMappingChanged(e){this._knownModelVersionId===this._model.getVersionId()&&this.setStates(e,"viewModel",he.NotSet,this.getCursorStates())}setHasFocus(e){this._hasFocus=e}_validateAutoClosedActions(){if(this._autoClosedActions.length>0){const e=this._cursors.getSelections();for(let t=0;t<this._autoClosedActions.length;t++){const i=this._autoClosedActions[t];i.isValid(e)||(i.dispose(),this._autoClosedActions.splice(t,1),t--)}}}getPrimaryCursorState(){return this._cursors.getPrimaryCursor()}getLastAddedCursorIndex(){return this._cursors.getLastAddedCursorIndex()}getCursorStates(){return this._cursors.getAll()}setStates(e,t,i,n){let s=!1;const o=this.context.cursorConfig.multiCursorLimit;n!==null&&n.length>o&&(n=n.slice(0,o),s=!0);const r=So.from(this._model,this);return this._cursors.setStates(n),this._cursors.normalize(),this._columnSelectData=null,this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,t,i,r,s)}setCursorColumnSelectData(e){this._columnSelectData=e}revealAll(e,t,i,n,s,o){const r=this._cursors.getViewPositions();let l=null,d=null;r.length>1?d=this._cursors.getViewSelections():l=N.fromPositions(r[0],r[0]),e.emitViewEvent(new po(t,i,l,d,n,s,o))}revealPrimary(e,t,i,n,s,o){const l=[this._cursors.getPrimaryCursor().viewState.selection];e.emitViewEvent(new po(t,i,null,l,n,s,o))}saveState(){const e=[],t=this._cursors.getSelections();for(let i=0,n=t.length;i<n;i++){const s=t[i];e.push({inSelectionMode:!s.isEmpty(),selectionStart:{lineNumber:s.selectionStartLineNumber,column:s.selectionStartColumn},position:{lineNumber:s.positionLineNumber,column:s.positionColumn}})}return e}restoreState(e,t){const i=[];for(let n=0,s=t.length;n<s;n++){const o=t[n];let r=1,l=1;o.position&&o.position.lineNumber&&(r=o.position.lineNumber),o.position&&o.position.column&&(l=o.position.column);let d=r,c=l;o.selectionStart&&o.selectionStart.lineNumber&&(d=o.selectionStart.lineNumber),o.selectionStart&&o.selectionStart.column&&(c=o.selectionStart.column),i.push({selectionStartLineNumber:d,selectionStartColumn:c,positionLineNumber:r,positionColumn:l})}this.setStates(e,"restoreState",he.NotSet,ie.fromModelSelections(i)),this.revealAll(e,"restoreState",!1,de.Simple,!0,K.Immediate)}onModelContentChanged(e,t){if(t instanceof fp){if(this._isHandling)return;this._isHandling=!0;try{this.setStates(e,"modelChange",he.NotSet,this.getCursorStates())}finally{this._isHandling=!1}}else{const i=t.rawContentChangedEvent;if(this._knownModelVersionId=i.versionId,this._isHandling)return;const n=i.containsEvent(Zi.Flush);if(this._prevEditOperationType=we.Other,n)this._cursors.dispose(),this._cursors=new Rh(this.context),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(e,"model",he.ContentFlush,null,!1);else if(this._hasFocus&&i.resultingSelection&&i.resultingSelection.length>0){const s=ie.fromModelSelections(i.resultingSelection);this.setStates(e,"modelChange",i.isUndoing?he.Undo:i.isRedoing?he.Redo:he.RecoverFromMarkers,s)&&this.revealAll(e,"modelChange",!1,de.Simple,!0,K.Smooth)}else{const s=this._cursors.readSelectionFromMarkers();this.setStates(e,"modelChange",he.RecoverFromMarkers,ie.fromModelSelections(s))}}}getSelection(){return this._cursors.getPrimaryCursor().modelState.selection}getTopMostViewPosition(){return this._cursors.getTopMostViewPosition()}getBottomMostViewPosition(){return this._cursors.getBottomMostViewPosition()}getCursorColumnSelectData(){if(this._columnSelectData)return this._columnSelectData;const e=this._cursors.getPrimaryCursor(),t=e.viewState.selectionStart.getStartPosition(),i=e.viewState.position;return{isReal:!1,fromViewLineNumber:t.lineNumber,fromViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,t),toViewLineNumber:i.lineNumber,toViewVisualColumn:this.context.cursorConfig.visibleColumnFromColumn(this._viewModel,i)}}getSelections(){return this._cursors.getSelections()}getPosition(){return this._cursors.getPrimaryCursor().modelState.position}setSelections(e,t,i,n){this.setStates(e,t,n,ie.fromModelSelections(i))}getPrevEditOperationType(){return this._prevEditOperationType}setPrevEditOperationType(e){this._prevEditOperationType=e}_pushAutoClosedAction(e,t){const i=[],n=[];for(let r=0,l=e.length;r<l;r++)i.push({range:e[r],options:{description:"auto-closed-character",inlineClassName:"auto-closed-character",stickiness:Oe.NeverGrowsWhenTypingAtEdges}}),n.push({range:t[r],options:{description:"auto-closed-enclosing",stickiness:Oe.NeverGrowsWhenTypingAtEdges}});const s=this._model.deltaDecorations([],i),o=this._model.deltaDecorations([],n);this._autoClosedActions.push(new Th(this._model,s,o))}_executeEditOperation(e){if(!e)return;e.shouldPushStackElementBefore&&this._model.pushStackElement();const t=Qb.executeCommands(this._model,this._cursors.getSelections(),e.commands);if(t){this._interpretCommandResult(t);const i=[],n=[];for(let s=0;s<e.commands.length;s++){const o=e.commands[s];o instanceof ec&&o.enclosingRange&&o.closeCharacterRange&&(i.push(o.closeCharacterRange),n.push(o.enclosingRange))}i.length>0&&this._pushAutoClosedAction(i,n),this._prevEditOperationType=e.type}e.shouldPushStackElementAfter&&this._model.pushStackElement()}_interpretCommandResult(e){(!e||e.length===0)&&(e=this._cursors.readSelectionFromMarkers()),this._columnSelectData=null,this._cursors.setSelections(e),this._cursors.normalize()}_emitStateChangedIfNecessary(e,t,i,n,s){const o=So.from(this._model,this);if(o.equals(n))return!1;const r=this._cursors.getSelections(),l=this._cursors.getViewSelections();if(e.emitViewEvent(new Ew(l,r,i)),!n||n.cursorState.length!==o.cursorState.length||o.cursorState.some((d,c)=>!d.modelState.equals(n.cursorState[c].modelState))){const d=n?n.cursorState.map(h=>h.modelState.selection):null,c=n?n.modelVersionId:0;e.emitOutgoingEvent(new da(d,r,c,o.modelVersionId,t||"keyboard",i,s))}return!0}_findAutoClosingPairs(e){if(!e.length)return null;const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];if(!s.text||s.text.indexOf(`
`)>=0)return null;const o=s.text.match(/([)\]}>'"`])([^)\]}>'"`]*)$/);if(!o)return null;const r=o[1],l=this.context.cursorConfig.autoClosingPairs.autoClosingPairsCloseSingleChar.get(r);if(!l||l.length!==1)return null;const d=l[0].open,c=s.text.length-o[2].length-1,h=s.text.lastIndexOf(d,c-1);if(h===-1)return null;t.push([h,c])}return t}executeEdits(e,t,i,n){let s=null;t==="snippet"&&(s=this._findAutoClosingPairs(i)),s&&(i[0]._isTracked=!0);const o=[],r=[],l=this._model.pushEditOperations(this.getSelections(),i,d=>{if(s)for(let h=0,u=s.length;h<u;h++){const[g,f]=s[h],m=d[h],_=m.range.startLineNumber,L=m.range.startColumn-1+g,w=m.range.startColumn-1+f;o.push(new N(_,w+1,_,w+2)),r.push(new N(_,L+1,_,w+2))}const c=n(d);return c&&(this._isHandling=!0),c});l&&(this._isHandling=!1,this.setSelections(e,t,l,he.NotSet)),o.length>0&&this._pushAutoClosedAction(o,r)}_executeEdit(e,t,i,n=he.NotSet){if(this.context.cursorConfig.readOnly)return;const s=So.from(this._model,this);this._cursors.stopTrackingSelections(),this._isHandling=!0;try{this._cursors.ensureValidState(),e()}catch(o){vt(o)}this._isHandling=!1,this._cursors.startTrackingSelections(),this._validateAutoClosedActions(),this._emitStateChangedIfNecessary(t,i,n,s,!1)&&this.revealAll(t,i,!1,de.Simple,!0,K.Smooth)}getAutoClosedCharacters(){return Th.getAllAutoClosedCharacters(this._autoClosedActions)}startComposition(e){this._compositionState=new yo(this._model,this.getSelections())}endComposition(e,t){const i=this._compositionState?this._compositionState.deduceOutcome(this._model,this.getSelections()):null;this._compositionState=null,this._executeEdit(()=>{t==="keyboard"&&this._executeEditOperation(Rn.compositionEndWithInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,i,this.getSelections(),this.getAutoClosedCharacters()))},e,t)}type(e,t,i){this._executeEdit(()=>{if(i==="keyboard"){const n=t.length;let s=0;for(;s<n;){const o=xu(t,s),r=t.substr(s,o);this._executeEditOperation(Rn.typeWithInterceptors(!!this._compositionState,this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),this.getAutoClosedCharacters(),r)),s+=o}}else this._executeEditOperation(Rn.typeWithoutInterceptors(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t))},e,i)}compositionType(e,t,i,n,s,o){if(t.length===0&&i===0&&n===0){if(s!==0){const r=this.getSelections().map(l=>{const d=l.getPosition();return new le(d.lineNumber,d.column+s,d.lineNumber,d.column+s)});this.setSelections(e,o,r,he.NotSet)}return}this._executeEdit(()=>{this._executeEditOperation(Rn.compositionType(this._prevEditOperationType,this.context.cursorConfig,this._model,this.getSelections(),t,i,n,s))},e,o)}paste(e,t,i,n,s){this._executeEdit(()=>{this._executeEditOperation(Rn.paste(this.context.cursorConfig,this._model,this.getSelections(),t,i,n||[]))},e,s,he.Paste)}cut(e,t){this._executeEdit(()=>{this._executeEditOperation(es.cut(this.context.cursorConfig,this._model,this.getSelections()))},e,t)}executeCommand(e,t,i){this._executeEdit(()=>{this._cursors.killSecondaryCursors(),this._executeEditOperation(new bt(we.Other,[t],{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},e,i)}executeCommands(e,t,i){this._executeEdit(()=>{this._executeEditOperation(new bt(we.Other,t,{shouldPushStackElementBefore:!1,shouldPushStackElementAfter:!1}))},e,i)}}class So{static from(e,t){return new So(e.getVersionId(),t.getCursorStates())}constructor(e,t){this.modelVersionId=e,this.cursorState=t}equals(e){if(!e||this.modelVersionId!==e.modelVersionId||this.cursorState.length!==e.cursorState.length)return!1;for(let t=0,i=this.cursorState.length;t<i;t++)if(!this.cursorState[t].equals(e.cursorState[t]))return!1;return!0}}class Th{static getAllAutoClosedCharacters(e){let t=[];for(const i of e)t=t.concat(i.getAutoClosedCharactersRanges());return t}constructor(e,t,i){this._model=e,this._autoClosedCharactersDecorations=t,this._autoClosedEnclosingDecorations=i}dispose(){this._autoClosedCharactersDecorations=this._model.deltaDecorations(this._autoClosedCharactersDecorations,[]),this._autoClosedEnclosingDecorations=this._model.deltaDecorations(this._autoClosedEnclosingDecorations,[])}getAutoClosedCharactersRanges(){const e=[];for(let t=0;t<this._autoClosedCharactersDecorations.length;t++){const i=this._model.getDecorationRange(this._autoClosedCharactersDecorations[t]);i&&e.push(i)}return e}isValid(e){const t=[];for(let i=0;i<this._autoClosedEnclosingDecorations.length;i++){const n=this._model.getDecorationRange(this._autoClosedEnclosingDecorations[i]);if(n&&(t.push(n),n.startLineNumber!==n.endLineNumber))return!1}t.sort(N.compareRangesUsingStarts),e.sort(N.compareRangesUsingStarts);for(let i=0;i<e.length;i++)if(i>=t.length||!t[i].strictContainsRange(e[i]))return!1;return!0}}class Qb{static executeCommands(e,t,i){const n={model:e,selectionsBefore:t,trackedRanges:[],trackedRangesDirection:[]},s=this._innerExecuteCommands(n,i);for(let o=0,r=n.trackedRanges.length;o<r;o++)n.model._setTrackedRange(n.trackedRanges[o],null,Oe.AlwaysGrowsWhenTypingAtEdges);return s}static _innerExecuteCommands(e,t){if(this._arrayIsEmpty(t))return null;const i=this._getEditOperations(e,t);if(i.operations.length===0)return null;const n=i.operations,s=this._getLoserCursorMap(n);if(s.hasOwnProperty("0"))return console.warn("Ignoring commands"),null;const o=[];for(let d=0,c=n.length;d<c;d++)s.hasOwnProperty(n[d].identifier.major.toString())||o.push(n[d]);i.hadTrackedEditOperation&&o.length>0&&(o[0]._isTracked=!0);let r=e.model.pushEditOperations(e.selectionsBefore,o,d=>{const c=[];for(let g=0;g<e.selectionsBefore.length;g++)c[g]=[];for(const g of d)g.identifier&&c[g.identifier.major].push(g);const h=(g,f)=>g.identifier.minor-f.identifier.minor,u=[];for(let g=0;g<e.selectionsBefore.length;g++)c[g].length>0?(c[g].sort(h),u[g]=t[g].computeCursorState(e.model,{getInverseEditOperations:()=>c[g],getTrackedSelection:f=>{const m=parseInt(f,10),_=e.model._getTrackedRange(e.trackedRanges[m]);return e.trackedRangesDirection[m]===Md.LTR?new le(_.startLineNumber,_.startColumn,_.endLineNumber,_.endColumn):new le(_.endLineNumber,_.endColumn,_.startLineNumber,_.startColumn)}})):u[g]=e.selectionsBefore[g];return u});r||(r=e.selectionsBefore);const l=[];for(const d in s)s.hasOwnProperty(d)&&l.push(parseInt(d,10));l.sort((d,c)=>c-d);for(const d of l)r.splice(d,1);return r}static _arrayIsEmpty(e){for(let t=0,i=e.length;t<i;t++)if(e[t])return!1;return!0}static _getEditOperations(e,t){let i=[],n=!1;for(let s=0,o=t.length;s<o;s++){const r=t[s];if(r){const l=this._getEditOperationsFromCommand(e,s,r);i=i.concat(l.operations),n=n||l.hadTrackedEditOperation}}return{operations:i,hadTrackedEditOperation:n}}static _getEditOperationsFromCommand(e,t,i){const n=[];let s=0;const o=(h,u,g=!1)=>{N.isEmpty(h)&&u===""||n.push({identifier:{major:t,minor:s++},range:h,text:u,forceMoveMarkers:g,isAutoWhitespaceEdit:i.insertsAutoWhitespace})};let r=!1;const c={addEditOperation:o,addTrackedEditOperation:(h,u,g)=>{r=!0,o(h,u,g)},trackSelection:(h,u)=>{const g=le.liftSelection(h);let f;if(g.isEmpty())if(typeof u=="boolean")u?f=Oe.GrowsOnlyWhenTypingBefore:f=Oe.GrowsOnlyWhenTypingAfter;else{const L=e.model.getLineMaxColumn(g.startLineNumber);g.startColumn===L?f=Oe.GrowsOnlyWhenTypingBefore:f=Oe.GrowsOnlyWhenTypingAfter}else f=Oe.NeverGrowsWhenTypingAtEdges;const m=e.trackedRanges.length,_=e.model._setTrackedRange(null,g,f);return e.trackedRanges[m]=_,e.trackedRangesDirection[m]=g.getDirection(),m.toString()}};try{i.getEditOperations(e.model,c)}catch(h){return vt(h),{operations:[],hadTrackedEditOperation:!1}}return{operations:n,hadTrackedEditOperation:r}}static _getLoserCursorMap(e){e=e.slice(0),e.sort((i,n)=>-N.compareRangesUsingEnds(i.range,n.range));const t={};for(let i=1;i<e.length;i++){const n=e[i-1],s=e[i];if(N.getStartPosition(n.range).isBefore(N.getEndPosition(s.range))){let o;n.identifier.major>s.identifier.major?o=n.identifier.major:o=s.identifier.major,t[o.toString()]=!0;for(let r=0;r<e.length;r++)e[r].identifier.major===o&&(e.splice(r,1),r<i&&i--,r--);i>0&&i--}}return t}}class Jb{constructor(e,t,i,n){this.text=e,this.lineNumber=t,this.startSelectionOffset=i,this.endSelectionOffset=n}}class yo{static _capture(e,t){const i=[];for(const n of t){if(n.startLineNumber!==n.endLineNumber)return null;const s=n.startLineNumber;i.push(new Jb(e.getLineContent(s),s,n.startColumn-1,n.endColumn-1))}return i}constructor(e,t){this._original=yo._capture(e,t)}deduceOutcome(e,t){if(!this._original)return null;const i=yo._capture(e,t);if(!i||this._original.length!==i.length)return null;const n=[];for(let s=0,o=this._original.length;s<o;s++)n.push(yo._deduceOutcome(this._original[s],i[s]));return n}static _deduceOutcome(e,t){const i=Math.min(e.startSelectionOffset,t.startSelectionOffset,xl(e.text,t.text)),n=Math.min(e.text.length-e.endSelectionOffset,t.text.length-t.endSelectionOffset,Nl(e.text,t.text)),s=e.text.substring(i,e.text.length-n),o=i,r=t.text.length-n,l=t.text.substring(o,r),d=new N(t.lineNumber,o+1,t.lineNumber,r+1);return new DL(s,e.startSelectionOffset-i,e.endSelectionOffset-i,l,t.startSelectionOffset-i,t.endSelectionOffset-i,d)}}class eS{constructor(e,t,i,n,s){this.decorationId=e,this.index=t,this.lineNumber=i,this.specialHeight=n,this.prefixSum=s,this.maximumSpecialHeight=n,this.deleted=!1}}class Mh{constructor(e,t){if(this._decorationIDToCustomLine=new fl,this._orderedCustomLines=[],this._pendingSpecialLinesToInsert=[],this._invalidIndex=0,this._hasPending=!1,this._defaultLineHeight=e,t.length>0){for(const i of t)this.insertOrChangeCustomLineHeight(i.decorationId,i.startLineNumber,i.endLineNumber,i.lineHeight);this.commit()}}set defaultLineHeight(e){this._defaultLineHeight=e}get defaultLineHeight(){return this._defaultLineHeight}removeCustomLineHeight(e){const t=this._decorationIDToCustomLine.get(e);if(t){this._decorationIDToCustomLine.delete(e);for(const i of t)i.deleted=!0,this._invalidIndex=Math.min(this._invalidIndex,i.index);this._hasPending=!0}}insertOrChangeCustomLineHeight(e,t,i,n){this.removeCustomLineHeight(e);for(let s=t;s<=i;s++){const o=new eS(e,-1,s,n,0);this._pendingSpecialLinesToInsert.push(o)}this._hasPending=!0}heightForLineNumber(e){const t=this._binarySearchOverOrderedCustomLinesArray(e);return t>=0?this._orderedCustomLines[t].maximumSpecialHeight:this._defaultLineHeight}getAccumulatedLineHeightsIncludingLineNumber(e){const t=this._binarySearchOverOrderedCustomLinesArray(e);if(t>=0)return this._orderedCustomLines[t].prefixSum+this._orderedCustomLines[t].maximumSpecialHeight;if(t===-1)return this._defaultLineHeight*e;const i=-(t+1),n=this._orderedCustomLines[i-1];return n.prefixSum+n.maximumSpecialHeight+this._defaultLineHeight*(e-n.lineNumber)}onLinesDeleted(e,t){const i=t-e+1,n=this._orderedCustomLines.length,s=this._binarySearchOverOrderedCustomLinesArray(e);let o;if(s>=0){o=s;for(let h=s-1;h>=0&&this._orderedCustomLines[h].lineNumber===e;h--)o--}else o=s===-(n+1)&&s!==-1?n-1:-(s+1);const r=this._binarySearchOverOrderedCustomLinesArray(t);let l;if(r>=0){l=r;for(let h=r+1;h<n&&this._orderedCustomLines[h].lineNumber===t;h++)l++}else l=r===-(n+1)&&r!==-1?n-1:-(r+1);const d=l>o,c=l===o&&this._orderedCustomLines[o]&&this._orderedCustomLines[o].lineNumber>=e&&this._orderedCustomLines[o].lineNumber<=t;if(d||c){let h=0;for(let S=o;S<=l;S++)h=Math.max(h,this._orderedCustomLines[S].maximumSpecialHeight);let u=0;if(o>0){const S=this._orderedCustomLines[o-1];u=S.prefixSum+S.maximumSpecialHeight+this._defaultLineHeight*(e-S.lineNumber-1)}else u=e>0?(e-1)*this._defaultLineHeight:0;const g=this._orderedCustomLines[o],f=this._orderedCustomLines[l],m=this._orderedCustomLines[l+1],_=m&&m.lineNumber===t+1?m.maximumSpecialHeight:this._defaultLineHeight,L=f.prefixSum+f.maximumSpecialHeight-g.prefixSum+this._defaultLineHeight*(t-f.lineNumber)+this._defaultLineHeight*(g.lineNumber-e)+_-h,w=new Set,p=[],C=new fl;let b=0;for(let S=0;S<this._orderedCustomLines.length;S++){const y=this._orderedCustomLines[S];if(S<o)p.push(y),C.add(y.decorationId,y);else if(S>=o&&S<=l){const E=y.decorationId;w.has(E)?b++:(y.index-=b,y.lineNumber=e,y.prefixSum=u,y.maximumSpecialHeight=h,p.push(y),C.add(y.decorationId,y))}else S>l&&(y.index-=b,y.lineNumber-=i,y.prefixSum-=L,p.push(y),C.add(y.decorationId,y));w.add(y.decorationId)}this._orderedCustomLines=p,this._decorationIDToCustomLine=C}else{const h=i*this._defaultLineHeight;for(let u=l;u<this._orderedCustomLines.length;u++){const g=this._orderedCustomLines[u];g.lineNumber-=i,g.prefixSum-=h}}}onLinesInserted(e,t){const i=t-e+1,n=this._binarySearchOverOrderedCustomLinesArray(e);let s;if(n>=0){s=n;for(let c=n-1;c>=0&&this._orderedCustomLines[c].lineNumber===e;c--)s--}else s=-(n+1);const o=[],r=new Set;for(let c=s;c<this._orderedCustomLines.length;c++)this._orderedCustomLines[c].lineNumber===e&&r.add(this._orderedCustomLines[c].decorationId);const l=new Set;for(let c=s-1;c>=0;c--)this._orderedCustomLines[c].lineNumber===e-1&&l.add(this._orderedCustomLines[c].decorationId);const d=Wu(l,r);for(let c=s;c<this._orderedCustomLines.length;c++)this._orderedCustomLines[c].lineNumber+=i,this._orderedCustomLines[c].prefixSum+=this._defaultLineHeight*i;if(d.size>0){for(const c of d){const h=this._decorationIDToCustomLine.get(c);if(h){const u=h.reduce((m,_)=>Math.min(m,_.lineNumber),e),g=h.reduce((m,_)=>Math.max(m,_.lineNumber),e),f=h.reduce((m,_)=>Math.max(m,_.specialHeight),0);o.push({decorationId:c,startLineNumber:u,endLineNumber:g,lineHeight:f})}}for(const c of o)this.insertOrChangeCustomLineHeight(c.decorationId,c.startLineNumber,c.endLineNumber,c.lineHeight);this.commit()}}commit(){if(!this._hasPending)return;for(const s of this._pendingSpecialLinesToInsert){const o=this._binarySearchOverOrderedCustomLinesArray(s.lineNumber),r=o>=0?o:-(o+1);this._orderedCustomLines.splice(r,0,s),this._invalidIndex=Math.min(this._invalidIndex,r)}this._pendingSpecialLinesToInsert=[];const e=new fl,t=[];for(let s=0;s<this._invalidIndex;s++){const o=this._orderedCustomLines[s];t.push(o),e.add(o.decorationId,o)}let i=0,n=this._invalidIndex>0?t[this._invalidIndex-1]:void 0;for(let s=this._invalidIndex;s<this._orderedCustomLines.length;s++){const o=this._orderedCustomLines[s];if(o.deleted){i++;continue}if(o.index=s-i,n&&n.lineNumber===o.lineNumber)o.maximumSpecialHeight=n.maximumSpecialHeight,o.prefixSum=n.prefixSum;else{let r=o.specialHeight;for(let d=s;d<this._orderedCustomLines.length;d++){const c=this._orderedCustomLines[d];if(!c.deleted){if(c.lineNumber!==o.lineNumber)break;r=Math.max(r,c.specialHeight)}}o.maximumSpecialHeight=r;let l;n?l=n.prefixSum+n.maximumSpecialHeight+this._defaultLineHeight*(o.lineNumber-n.lineNumber-1):l=this._defaultLineHeight*(o.lineNumber-1),o.prefixSum=l}n=o,t.push(o),e.add(o.decorationId,o)}this._orderedCustomLines=t,this._decorationIDToCustomLine=e,this._invalidIndex=1/0,this._hasPending=!1}_binarySearchOverOrderedCustomLinesArray(e){return mp(this._orderedCustomLines.length,t=>{const i=this._orderedCustomLines[t];return i.lineNumber===e?0:i.lineNumber<e?-1:1})}}class fl{constructor(){this._map=new Map}add(e,t){const i=this._map.get(e);i?i.push(t):this._map.set(e,[t])}get(e){return this._map.get(e)}delete(e){this._map.delete(e)}}class tS{constructor(){this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[]}insert(e){this._hasPending=!0,this._inserts.push(e)}change(e){this._hasPending=!0,this._changes.push(e)}remove(e){this._hasPending=!0,this._removes.push(e)}commit(e){if(!this._hasPending)return;const t=this._inserts,i=this._changes,n=this._removes;this._hasPending=!1,this._inserts=[],this._changes=[],this._removes=[],e._commitPendingChanges(t,i,n)}}class iS{constructor(e,t,i,n,s){this.id=e,this.afterLineNumber=t,this.ordinal=i,this.height=n,this.minWidth=s,this.prefixSum=0}}let nS=class dd{static{this.INSTANCE_COUNT=0}constructor(e,t,i,n,s){this._instanceId=pp(++dd.INSTANCE_COUNT),this._pendingChanges=new tS,this._lastWhitespaceId=0,this._arr=[],this._prefixSumValidIndex=-1,this._minWidth=-1,this._lineCount=e,this._paddingTop=i,this._paddingBottom=n,this._lineHeightsManager=new Mh(t,s)}static findInsertionIndex(e,t,i){let n=0,s=e.length;for(;n<s;){const o=n+s>>>1;t===e[o].afterLineNumber?i<e[o].ordinal?s=o:n=o+1:t<e[o].afterLineNumber?s=o:n=o+1}return n}setDefaultLineHeight(e){this._lineHeightsManager.defaultLineHeight=e}setPadding(e,t){this._paddingTop=e,this._paddingBottom=t}onFlushed(e,t){this._lineCount=e,this._lineHeightsManager=new Mh(this._lineHeightsManager.defaultLineHeight,t)}changeLineHeights(e){let t=!1;try{e({insertOrChangeCustomLineHeight:(n,s,o,r)=>{t=!0,this._lineHeightsManager.insertOrChangeCustomLineHeight(n,s,o,r)},removeCustomLineHeight:n=>{t=!0,this._lineHeightsManager.removeCustomLineHeight(n)}})}finally{this._lineHeightsManager.commit()}return t}changeWhitespace(e){let t=!1;try{e({insertWhitespace:(n,s,o,r)=>{t=!0,n=n|0,s=s|0,o=o|0,r=r|0;const l=this._instanceId+ ++this._lastWhitespaceId;return this._pendingChanges.insert(new iS(l,n,s,o,r)),l},changeOneWhitespace:(n,s,o)=>{t=!0,s=s|0,o=o|0,this._pendingChanges.change({id:n,newAfterLineNumber:s,newHeight:o})},removeWhitespace:n=>{t=!0,this._pendingChanges.remove({id:n})}})}finally{this._pendingChanges.commit(this)}return t}_commitPendingChanges(e,t,i){if((e.length>0||i.length>0)&&(this._minWidth=-1),e.length+t.length+i.length<=1){for(const l of e)this._insertWhitespace(l);for(const l of t)this._changeOneWhitespace(l.id,l.newAfterLineNumber,l.newHeight);for(const l of i){const d=this._findWhitespaceIndex(l.id);d!==-1&&this._removeWhitespace(d)}return}const n=new Set;for(const l of i)n.add(l.id);const s=new Map;for(const l of t)s.set(l.id,l);const o=l=>{const d=[];for(const c of l)if(!n.has(c.id)){if(s.has(c.id)){const h=s.get(c.id);c.afterLineNumber=h.newAfterLineNumber,c.height=h.newHeight}d.push(c)}return d},r=o(this._arr).concat(o(e));r.sort((l,d)=>l.afterLineNumber===d.afterLineNumber?l.ordinal-d.ordinal:l.afterLineNumber-d.afterLineNumber),this._arr=r,this._prefixSumValidIndex=-1}_insertWhitespace(e){const t=dd.findInsertionIndex(this._arr,e.afterLineNumber,e.ordinal);this._arr.splice(t,0,e),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,t-1)}_findWhitespaceIndex(e){const t=this._arr;for(let i=0,n=t.length;i<n;i++)if(t[i].id===e)return i;return-1}_changeOneWhitespace(e,t,i){const n=this._findWhitespaceIndex(e);if(n!==-1&&(this._arr[n].height!==i&&(this._arr[n].height=i,this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,n-1)),this._arr[n].afterLineNumber!==t)){const s=this._arr[n];this._removeWhitespace(n),s.afterLineNumber=t,this._insertWhitespace(s)}}_removeWhitespace(e){this._arr.splice(e,1),this._prefixSumValidIndex=Math.min(this._prefixSumValidIndex,e-1)}onLinesDeleted(e,t){e=e|0,t=t|0,this._lineCount-=t-e+1;for(let i=0,n=this._arr.length;i<n;i++){const s=this._arr[i].afterLineNumber;e<=s&&s<=t?this._arr[i].afterLineNumber=e-1:s>t&&(this._arr[i].afterLineNumber-=t-e+1)}this._lineHeightsManager.onLinesDeleted(e,t)}onLinesInserted(e,t){e=e|0,t=t|0,this._lineCount+=t-e+1;for(let i=0,n=this._arr.length;i<n;i++){const s=this._arr[i].afterLineNumber;e<=s&&(this._arr[i].afterLineNumber+=t-e+1)}this._lineHeightsManager.onLinesInserted(e,t)}getWhitespacesTotalHeight(){return this._arr.length===0?0:this.getWhitespacesAccumulatedHeight(this._arr.length-1)}getWhitespacesAccumulatedHeight(e){e=e|0;let t=Math.max(0,this._prefixSumValidIndex+1);t===0&&(this._arr[0].prefixSum=this._arr[0].height,t++);for(let i=t;i<=e;i++)this._arr[i].prefixSum=this._arr[i-1].prefixSum+this._arr[i].height;return this._prefixSumValidIndex=Math.max(this._prefixSumValidIndex,e),this._arr[e].prefixSum}getLinesTotalHeight(){const e=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(this._lineCount),t=this.getWhitespacesTotalHeight();return e+t+this._paddingTop+this._paddingBottom}getWhitespaceAccumulatedHeightBeforeLineNumber(e){e=e|0;const t=this._findLastWhitespaceBeforeLineNumber(e);return t===-1?0:this.getWhitespacesAccumulatedHeight(t)}_findLastWhitespaceBeforeLineNumber(e){e=e|0;const t=this._arr;let i=0,n=t.length-1;for(;i<=n;){const o=(n-i|0)/2|0,r=i+o|0;if(t[r].afterLineNumber<e){if(r+1>=t.length||t[r+1].afterLineNumber>=e)return r;i=r+1|0}else n=r-1|0}return-1}_findFirstWhitespaceAfterLineNumber(e){e=e|0;const i=this._findLastWhitespaceBeforeLineNumber(e)+1;return i<this._arr.length?i:-1}getFirstWhitespaceIndexAfterLineNumber(e){return e=e|0,this._findFirstWhitespaceAfterLineNumber(e)}getVerticalOffsetForLineNumber(e,t=!1){e=e|0;let i;e>1?i=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(e-1):i=0;const n=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e-(t?1:0));return i+n+this._paddingTop}getLineHeightForLineNumber(e){return this._lineHeightsManager.heightForLineNumber(e)}getVerticalOffsetAfterLineNumber(e,t=!1){e=e|0;const i=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(e),n=this.getWhitespaceAccumulatedHeightBeforeLineNumber(e+(t?1:0));return i+n+this._paddingTop}hasWhitespace(){return this.getWhitespacesCount()>0}getWhitespaceMinWidth(){if(this._minWidth===-1){let e=0;for(let t=0,i=this._arr.length;t<i;t++)e=Math.max(e,this._arr[t].minWidth);this._minWidth=e}return this._minWidth}isAfterLines(e){const t=this.getLinesTotalHeight();return e>t}isInTopPadding(e){return this._paddingTop===0?!1:e<this._paddingTop}isInBottomPadding(e){if(this._paddingBottom===0)return!1;const t=this.getLinesTotalHeight();return e>=t-this._paddingBottom}getLineNumberAtOrAfterVerticalOffset(e){if(e=e|0,e<0)return 1;const t=this._lineCount|0;let i=1,n=t;for(;i<n;){const s=(i+n)/2|0,o=this.getLineHeightForLineNumber(s),r=this.getVerticalOffsetForLineNumber(s)|0;if(e>=r+o)i=s+1;else{if(e>=r)return s;n=s}}return i>t?t:i}getLinesViewportData(e,t){e=e|0,t=t|0;const i=this.getLineNumberAtOrAfterVerticalOffset(e)|0,n=this.getVerticalOffsetForLineNumber(i)|0;let s=this._lineCount|0,o=this.getFirstWhitespaceIndexAfterLineNumber(i)|0;const r=this.getWhitespacesCount()|0;let l,d;o===-1?(o=r,d=s+1,l=0):(d=this.getAfterLineNumberForWhitespaceIndex(o)|0,l=this.getHeightForWhitespaceIndex(o)|0);let c=n,h=c;const u=5e5;let g=0;n>=u&&(g=Math.floor(n/u)*u,g=Math.floor(g/this._lineHeightsManager.defaultLineHeight)*this._lineHeightsManager.defaultLineHeight,h-=g);const f=[],m=e+(t-e)/2;let _=-1;for(let C=i;C<=s;C++){const b=this.getLineHeightForLineNumber(C);if(_===-1){const S=c,y=c+b;(S<=m&&m<y||S>m)&&(_=C)}for(c+=b,f[C-i]=h,h+=b;d===C;)h+=l,c+=l,o++,o>=r?d=s+1:(d=this.getAfterLineNumberForWhitespaceIndex(o)|0,l=this.getHeightForWhitespaceIndex(o)|0);if(c>=t){s=C;break}}_===-1&&(_=s);const L=this.getVerticalOffsetForLineNumber(s)|0;let w=i,p=s;if(w<p&&n<e&&w++,w<p){const C=this.getLineHeightForLineNumber(s);L+C>t&&p--}return{bigNumbersDelta:g,startLineNumber:i,endLineNumber:s,relativeVerticalOffset:f,centeredLineNumber:_,completelyVisibleStartLineNumber:w,completelyVisibleEndLineNumber:p,lineHeight:this._lineHeightsManager.defaultLineHeight}}getVerticalOffsetForWhitespaceIndex(e){e=e|0;const t=this.getAfterLineNumberForWhitespaceIndex(e);let i;t>=1?i=this._lineHeightsManager.getAccumulatedLineHeightsIncludingLineNumber(t):i=0;let n;return e>0?n=this.getWhitespacesAccumulatedHeight(e-1):n=0,i+n+this._paddingTop}getWhitespaceIndexAtOrAfterVerticallOffset(e){e=e|0;let t=0,i=this.getWhitespacesCount()-1;if(i<0)return-1;const n=this.getVerticalOffsetForWhitespaceIndex(i),s=this.getHeightForWhitespaceIndex(i);if(e>=n+s)return-1;for(;t<i;){const o=Math.floor((t+i)/2),r=this.getVerticalOffsetForWhitespaceIndex(o),l=this.getHeightForWhitespaceIndex(o);if(e>=r+l)t=o+1;else{if(e>=r)return o;i=o}}return t}getWhitespaceAtVerticalOffset(e){e=e|0;const t=this.getWhitespaceIndexAtOrAfterVerticallOffset(e);if(t<0||t>=this.getWhitespacesCount())return null;const i=this.getVerticalOffsetForWhitespaceIndex(t);if(i>e)return null;const n=this.getHeightForWhitespaceIndex(t),s=this.getIdForWhitespaceIndex(t),o=this.getAfterLineNumberForWhitespaceIndex(t);return{id:s,afterLineNumber:o,verticalOffset:i,height:n}}getWhitespaceViewportData(e,t){e=e|0,t=t|0;const i=this.getWhitespaceIndexAtOrAfterVerticallOffset(e),n=this.getWhitespacesCount()-1;if(i<0)return[];const s=[];for(let o=i;o<=n;o++){const r=this.getVerticalOffsetForWhitespaceIndex(o),l=this.getHeightForWhitespaceIndex(o);if(r>=t)break;s.push({id:this.getIdForWhitespaceIndex(o),afterLineNumber:this.getAfterLineNumberForWhitespaceIndex(o),verticalOffset:r,height:l})}return s}getWhitespaces(){return this._arr.slice(0)}getWhitespacesCount(){return this._arr.length}getIdForWhitespaceIndex(e){return e=e|0,this._arr[e].id}getAfterLineNumberForWhitespaceIndex(e){return e=e|0,this._arr[e].afterLineNumber}getHeightForWhitespaceIndex(e){return e=e|0,this._arr[e].height}};const sS=125;class uo{constructor(e,t,i,n){e=e|0,t=t|0,i=i|0,n=n|0,e<0&&(e=0),t<0&&(t=0),i<0&&(i=0),n<0&&(n=0),this.width=e,this.contentWidth=t,this.scrollWidth=Math.max(e,t),this.height=i,this.contentHeight=n,this.scrollHeight=Math.max(i,n)}equals(e){return this.width===e.width&&this.contentWidth===e.contentWidth&&this.height===e.height&&this.contentHeight===e.contentHeight}}class oS extends U{constructor(e,t){super(),this._onDidContentSizeChange=this._register(new Z),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._dimensions=new uo(0,0,0,0),this._scrollable=this._register(new Vu({forceIntegerValues:!0,smoothScrollDuration:e,scheduleAtNextAnimationFrame:t})),this.onDidScroll=this._scrollable.onScroll}getScrollable(){return this._scrollable}setSmoothScrollDuration(e){this._scrollable.setSmoothScrollDuration(e)}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}getScrollDimensions(){return this._dimensions}setScrollDimensions(e){if(this._dimensions.equals(e))return;const t=this._dimensions;this._dimensions=e,this._scrollable.setScrollDimensions({width:e.width,scrollWidth:e.scrollWidth,height:e.height,scrollHeight:e.scrollHeight},!0);const i=t.contentWidth!==e.contentWidth,n=t.contentHeight!==e.contentHeight;(i||n)&&this._onDidContentSizeChange.fire(new cc(t.contentWidth,t.contentHeight,e.contentWidth,e.contentHeight))}getFutureScrollPosition(){return this._scrollable.getFutureScrollPosition()}getCurrentScrollPosition(){return this._scrollable.getCurrentScrollPosition()}setScrollPositionNow(e){this._scrollable.setScrollPositionNow(e)}setScrollPositionSmooth(e){this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}}class rS extends U{constructor(e,t,i,n){super(),this._configuration=e;const s=this._configuration.options,o=s.get(v.layoutInfo),r=s.get(v.padding);this._linesLayout=new nS(t,s.get(v.lineHeight),r.top,r.bottom,i),this._maxLineWidth=0,this._overlayWidgetsMinWidth=0,this._scrollable=this._register(new oS(0,n)),this._configureSmoothScrollDuration(),this._scrollable.setScrollDimensions(new uo(o.contentWidth,0,o.height,0)),this.onDidScroll=this._scrollable.onDidScroll,this.onDidContentSizeChange=this._scrollable.onDidContentSizeChange,this._updateHeight()}dispose(){super.dispose()}getScrollable(){return this._scrollable.getScrollable()}onHeightMaybeChanged(){this._updateHeight()}_configureSmoothScrollDuration(){this._scrollable.setSmoothScrollDuration(this._configuration.options.get(v.smoothScrolling)?sS:0)}onConfigurationChanged(e){const t=this._configuration.options;if(e.hasChanged(v.lineHeight)&&this._linesLayout.setDefaultLineHeight(t.get(v.lineHeight)),e.hasChanged(v.padding)){const i=t.get(v.padding);this._linesLayout.setPadding(i.top,i.bottom)}if(e.hasChanged(v.layoutInfo)){const i=t.get(v.layoutInfo),n=i.contentWidth,s=i.height,o=this._scrollable.getScrollDimensions(),r=o.contentWidth;this._scrollable.setScrollDimensions(new uo(n,o.contentWidth,s,this._getContentHeight(n,s,r)))}else this._updateHeight();e.hasChanged(v.smoothScrolling)&&this._configureSmoothScrollDuration()}onFlushed(e,t){this._linesLayout.onFlushed(e,t)}onLinesDeleted(e,t){this._linesLayout.onLinesDeleted(e,t)}onLinesInserted(e,t){this._linesLayout.onLinesInserted(e,t)}_getHorizontalScrollbarHeight(e,t){const n=this._configuration.options.get(v.scrollbar);return n.horizontal===Tl.Hidden||e>=t?0:n.horizontalScrollbarSize}_getContentHeight(e,t,i){const n=this._configuration.options;let s=this._linesLayout.getLinesTotalHeight();return n.get(v.scrollBeyondLastLine)?s+=Math.max(0,t-n.get(v.lineHeight)-n.get(v.padding).bottom):n.get(v.scrollbar).ignoreHorizontalScrollbarInContentHeight||(s+=this._getHorizontalScrollbarHeight(e,i)),s}_updateHeight(){const e=this._scrollable.getScrollDimensions(),t=e.width,i=e.height,n=e.contentWidth;this._scrollable.setScrollDimensions(new uo(t,e.contentWidth,i,this._getContentHeight(t,i,n)))}getCurrentViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getCurrentScrollPosition();return new sh(t.scrollTop,t.scrollLeft,e.width,e.height)}getFutureViewport(){const e=this._scrollable.getScrollDimensions(),t=this._scrollable.getFutureScrollPosition();return new sh(t.scrollTop,t.scrollLeft,e.width,e.height)}_computeContentWidth(){const e=this._configuration.options,t=this._maxLineWidth,i=e.get(v.wrappingInfo),n=e.get(v.fontInfo),s=e.get(v.layoutInfo);if(i.isViewportWrapping){const o=e.get(v.minimap);return t>s.contentWidth+n.typicalHalfwidthCharacterWidth&&o.enabled&&o.side==="right"?t+s.verticalScrollbarWidth:t}else{const o=e.get(v.scrollBeyondLastColumn)*n.typicalHalfwidthCharacterWidth,r=this._linesLayout.getWhitespaceMinWidth();return Math.max(t+o+s.verticalScrollbarWidth,r,this._overlayWidgetsMinWidth)}}setMaxLineWidth(e){this._maxLineWidth=e,this._updateContentWidth()}setOverlayWidgetsMinWidth(e){this._overlayWidgetsMinWidth=e,this._updateContentWidth()}_updateContentWidth(){const e=this._scrollable.getScrollDimensions();this._scrollable.setScrollDimensions(new uo(e.width,this._computeContentWidth(),e.height,e.contentHeight)),this._updateHeight()}saveState(){const e=this._scrollable.getFutureScrollPosition(),t=e.scrollTop,i=this._linesLayout.getLineNumberAtOrAfterVerticalOffset(t),n=this._linesLayout.getWhitespaceAccumulatedHeightBeforeLineNumber(i);return{scrollTop:t,scrollTopWithoutViewZones:t-n,scrollLeft:e.scrollLeft}}changeWhitespace(e){const t=this._linesLayout.changeWhitespace(e);return t&&this.onHeightMaybeChanged(),t}changeSpecialLineHeights(e){const t=this._linesLayout.changeLineHeights(e);return t&&this.onHeightMaybeChanged(),t}getVerticalOffsetForLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetForLineNumber(e,t)}getVerticalOffsetAfterLineNumber(e,t=!1){return this._linesLayout.getVerticalOffsetAfterLineNumber(e,t)}getLineHeightForLineNumber(e){return this._linesLayout.getLineHeightForLineNumber(e)}isAfterLines(e){return this._linesLayout.isAfterLines(e)}isInTopPadding(e){return this._linesLayout.isInTopPadding(e)}isInBottomPadding(e){return this._linesLayout.isInBottomPadding(e)}getLineNumberAtVerticalOffset(e){return this._linesLayout.getLineNumberAtOrAfterVerticalOffset(e)}getWhitespaceAtVerticalOffset(e){return this._linesLayout.getWhitespaceAtVerticalOffset(e)}getLinesViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getLinesViewportData(e.top,e.top+e.height)}getLinesViewportDataAtScrollTop(e){const t=this._scrollable.getScrollDimensions();return e+t.height>t.scrollHeight&&(e=t.scrollHeight-t.height),e<0&&(e=0),this._linesLayout.getLinesViewportData(e,e+t.height)}getWhitespaceViewportData(){const e=this.getCurrentViewport();return this._linesLayout.getWhitespaceViewportData(e.top,e.top+e.height)}getWhitespaces(){return this._linesLayout.getWhitespaces()}getContentWidth(){return this._scrollable.getScrollDimensions().contentWidth}getScrollWidth(){return this._scrollable.getScrollDimensions().scrollWidth}getContentHeight(){return this._scrollable.getScrollDimensions().contentHeight}getScrollHeight(){return this._scrollable.getScrollDimensions().scrollHeight}getCurrentScrollLeft(){return this._scrollable.getCurrentScrollPosition().scrollLeft}getCurrentScrollTop(){return this._scrollable.getCurrentScrollPosition().scrollTop}validateScrollPosition(e){return this._scrollable.validateScrollPosition(e)}setScrollPosition(e,t){t===K.Immediate?this._scrollable.setScrollPositionNow(e):this._scrollable.setScrollPositionSmooth(e)}hasPendingScrollAnimation(){return this._scrollable.hasPendingScrollAnimation()}deltaScrollNow(e,t){const i=this._scrollable.getCurrentScrollPosition();this._scrollable.setScrollPositionNow({scrollLeft:i.scrollLeft+e,scrollTop:i.scrollTop+t})}}class aS{constructor(e,t,i,n,s){this.editorId=e,this.model=t,this.configuration=i,this._linesCollection=n,this._coordinatesConverter=s,this._decorationsCache=Object.create(null),this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}_clearCachedModelDecorationsResolver(){this._cachedModelDecorationsResolver=null,this._cachedModelDecorationsResolverViewRange=null}dispose(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}reset(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onModelDecorationsChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}onLineMappingChanged(){this._decorationsCache=Object.create(null),this._clearCachedModelDecorationsResolver()}_getOrCreateViewModelDecoration(e){const t=e.id;let i=this._decorationsCache[t];if(!i){const n=e.range,s=e.options;let o;if(s.isWholeLine){const r=this._coordinatesConverter.convertModelPositionToViewPosition(new I(n.startLineNumber,1),Ie.Left,!1,!0),l=this._coordinatesConverter.convertModelPositionToViewPosition(new I(n.endLineNumber,this.model.getLineMaxColumn(n.endLineNumber)),Ie.Right);o=new N(r.lineNumber,r.column,l.lineNumber,l.column)}else o=this._coordinatesConverter.convertModelRangeToViewRange(n,Ie.Right);i=new Cg(o,s),this._decorationsCache[t]=i}return i}getMinimapDecorationsInRange(e){return this._getDecorationsInRange(e,!0,!1).decorations}getDecorationsViewportData(e){let t=this._cachedModelDecorationsResolver!==null;return t=t&&e.equalsRange(this._cachedModelDecorationsResolverViewRange),t||(this._cachedModelDecorationsResolver=this._getDecorationsInRange(e,!1,!1),this._cachedModelDecorationsResolverViewRange=e),this._cachedModelDecorationsResolver}getInlineDecorationsOnLine(e,t=!1,i=!1){const n=new N(e,this._linesCollection.getViewLineMinColumn(e),e,this._linesCollection.getViewLineMaxColumn(e));return this._getDecorationsInRange(n,t,i).inlineDecorations[0]}_getDecorationsInRange(e,t,i){const n=this._linesCollection.getDecorationsInRange(e,this.editorId,jr(this.configuration.options),t,i),s=e.startLineNumber,o=e.endLineNumber,r=[];let l=0;const d=[];for(let c=s;c<=o;c++)d[c-s]=[];for(let c=0,h=n.length;c<h;c++){const u=n[c],g=u.options;if(!lS(this.model,u))continue;const f=this._getOrCreateViewModelDecoration(u),m=f.range;if(r[l++]=f,g.inlineClassName){const _=new _o(m,g.inlineClassName,g.inlineClassNameAffectsLetterSpacing?Be.RegularAffectingLetterSpacing:Be.Regular),L=Math.max(s,m.startLineNumber),w=Math.min(o,m.endLineNumber);for(let p=L;p<=w;p++)d[p-s].push(_)}if(g.beforeContentClassName&&s<=m.startLineNumber&&m.startLineNumber<=o){const _=new _o(new N(m.startLineNumber,m.startColumn,m.startLineNumber,m.startColumn),g.beforeContentClassName,Be.Before);d[m.startLineNumber-s].push(_)}if(g.afterContentClassName&&s<=m.endLineNumber&&m.endLineNumber<=o){const _=new _o(new N(m.endLineNumber,m.endColumn,m.endLineNumber,m.endColumn),g.afterContentClassName,Be.After);d[m.endLineNumber-s].push(_)}}return{decorations:r,inlineDecorations:d}}}function lS(a,e){return!(e.options.hideInCommentTokens&&dS(a,e)||e.options.hideInStringTokens&&cS(a,e))}function dS(a,e){return Kg(a,e.range,t=>t===ki.Comment)}function cS(a,e){return Kg(a,e.range,t=>t===ki.String)}function Kg(a,e,t){for(let i=e.startLineNumber;i<=e.endLineNumber;i++){const n=a.tokenization.getLineTokens(i),s=i===e.startLineNumber,o=i===e.endLineNumber;let r=s?n.findTokenIndexAtOffset(e.startColumn-1):0;for(;r<n.getCount()&&!(o&&n.getStartOffset(r)>e.endColumn-1);){if(!t(n.getStandardTokenType(r)))return!1;r++}}return!0}function ml(a,e){return a===null?e?$a.INSTANCE:Za.INSTANCE:new hS(a,e)}class hS{constructor(e,t){this._projectionData=e,this._isVisible=t}isVisible(){return this._isVisible}setVisible(e){return this._isVisible=e,this}getProjectionData(){return this._projectionData}getViewLineCount(){return this._isVisible?this._projectionData.getOutputLineCount():0}getViewLineContent(e,t,i){this._assertVisible();const n=i>0?this._projectionData.breakOffsets[i-1]:0,s=this._projectionData.breakOffsets[i];let o;if(this._projectionData.injectionOffsets!==null){const r=this._projectionData.injectionOffsets.map((d,c)=>new Ps(0,0,d+1,this._projectionData.injectionOptions[c],0));o=Ps.applyInjectedText(e.getLineContent(t),r).substring(n,s)}else o=e.getValueInRange({startLineNumber:t,startColumn:n+1,endLineNumber:t,endColumn:s+1});return i>0&&(o=Ah(this._projectionData.wrappedTextIndentLength)+o),o}getViewLineLength(e,t,i){return this._assertVisible(),this._projectionData.getLineLength(i)}getViewLineMinColumn(e,t,i){return this._assertVisible(),this._projectionData.getMinOutputOffset(i)+1}getViewLineMaxColumn(e,t,i){return this._assertVisible(),this._projectionData.getMaxOutputOffset(i)+1}getViewLineData(e,t,i){const n=new Array;return this.getViewLinesData(e,t,i,1,0,[!0],n),n[0]}getViewLinesData(e,t,i,n,s,o,r){this._assertVisible();const l=this._projectionData,d=l.injectionOffsets,c=l.injectionOptions;let h=null;if(d){h=[];let g=0,f=0;for(let m=0;m<l.getOutputLineCount();m++){const _=new Array;h[m]=_;const L=m>0?l.breakOffsets[m-1]:0,w=l.breakOffsets[m];for(;f<d.length;){const p=c[f].content.length,C=d[f]+g,b=C+p;if(C>w)break;if(L<b){const S=c[f];if(S.inlineClassName){const y=m>0?l.wrappedTextIndentLength:0,E=y+Math.max(C-L,0),x=y+Math.min(b-L,w-L);E!==x&&_.push(new Vw(E,x,S.inlineClassName,S.inlineClassNameAffectsLetterSpacing))}}if(b<=w)g+=p,f++;else break}}}let u;if(d){const g=[];for(let f=0;f<d.length;f++){const m=d[f],_=c[f].tokens;_?_.forEach((L,w)=>{g.push({offset:m,text:L.substring(c[f].content),tokenMetadata:w.metadata})}):g.push({offset:m,text:c[f].content,tokenMetadata:Jn.defaultTokenMetadata})}u=e.tokenization.getLineTokens(t).withInserted(g)}else u=e.tokenization.getLineTokens(t);for(let g=i;g<i+n;g++){const f=s+g-i;if(!o[f]){r[f]=null;continue}r[f]=this._getViewLineData(u,h?h[g]:null,g)}}_getViewLineData(e,t,i){this._assertVisible();const n=this._projectionData,s=i>0?n.wrappedTextIndentLength:0,o=i>0?n.breakOffsets[i-1]:0,r=n.breakOffsets[i],l=e.sliceAndInflate(o,r,s);let d=l.getLineContent();i>0&&(d=Ah(n.wrappedTextIndentLength)+d);const c=this._projectionData.getMinOutputOffset(i)+1,h=d.length+1,u=i+1<this.getViewLineCount(),g=i===0?0:n.breakOffsetsVisibleColumn[i-1];return new qd(d,u,c,h,g,l,t)}getModelColumnOfViewPosition(e,t){return this._assertVisible(),this._projectionData.translateToInputOffset(e,t-1)+1}getViewPositionOfModelPosition(e,t,i=Ie.None){return this._assertVisible(),this._projectionData.translateToOutputPosition(t-1,i).toPosition(e)}getViewLineNumberOfModelPosition(e,t){this._assertVisible();const i=this._projectionData.translateToOutputPosition(t-1);return e+i.outputLineIndex}normalizePosition(e,t,i){const n=t.lineNumber-e;return this._projectionData.normalizeOutputPosition(e,t.column-1,i).toPosition(n)}getInjectedTextAt(e,t){return this._projectionData.getInjectedText(e,t-1)}_assertVisible(){if(!this._isVisible)throw new Error("Not supported")}}class $a{static{this.INSTANCE=new $a}constructor(){}isVisible(){return!0}setVisible(e){return e?this:Za.INSTANCE}getProjectionData(){return null}getViewLineCount(){return 1}getViewLineContent(e,t,i){return e.getLineContent(t)}getViewLineLength(e,t,i){return e.getLineLength(t)}getViewLineMinColumn(e,t,i){return e.getLineMinColumn(t)}getViewLineMaxColumn(e,t,i){return e.getLineMaxColumn(t)}getViewLineData(e,t,i){const n=e.tokenization.getLineTokens(t),s=n.getLineContent();return new qd(s,!1,1,s.length+1,0,n.inflate(),null)}getViewLinesData(e,t,i,n,s,o,r){if(!o[s]){r[s]=null;return}r[s]=this.getViewLineData(e,t,0)}getModelColumnOfViewPosition(e,t){return t}getViewPositionOfModelPosition(e,t){return new I(e,t)}getViewLineNumberOfModelPosition(e,t){return e}normalizePosition(e,t,i){return t}getInjectedTextAt(e,t){return null}}class Za{static{this.INSTANCE=new Za}constructor(){}isVisible(){return!1}setVisible(e){return e?$a.INSTANCE:this}getProjectionData(){return null}getViewLineCount(){return 0}getViewLineContent(e,t,i){throw new Error("Not supported")}getViewLineLength(e,t,i){throw new Error("Not supported")}getViewLineMinColumn(e,t,i){throw new Error("Not supported")}getViewLineMaxColumn(e,t,i){throw new Error("Not supported")}getViewLineData(e,t,i){throw new Error("Not supported")}getViewLinesData(e,t,i,n,s,o,r){throw new Error("Not supported")}getModelColumnOfViewPosition(e,t){throw new Error("Not supported")}getViewPositionOfModelPosition(e,t){throw new Error("Not supported")}getViewLineNumberOfModelPosition(e,t){throw new Error("Not supported")}normalizePosition(e,t,i){throw new Error("Not supported")}getInjectedTextAt(e,t){throw new Error("Not supported")}}const pl=[""];function Ah(a){if(a>=pl.length)for(let e=1;e<=a;e++)pl[e]=uS(e);return pl[a]}function uS(a){return new Array(a+1).join(" ")}class gS{constructor(e,t,i,n,s,o,r,l,d,c){this._editorId=e,this.model=t,this._validModelVersionId=-1,this._domLineBreaksComputerFactory=i,this._monospaceLineBreaksComputerFactory=n,this.fontInfo=s,this.tabSize=o,this.wrappingStrategy=r,this.wrappingColumn=l,this.wrappingIndent=d,this.wordBreak=c,this._constructLines(!0,null)}dispose(){this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[])}createCoordinatesConverter(){return new mS(this)}_constructLines(e,t){this.modelLineProjections=[],e&&(this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,[]));const i=this.model.getLinesContent(),n=this.model.getInjectedTextDecorations(this._editorId),s=i.length,o=this.createLineBreaksComputer(),r=new As(Ps.fromDecorations(n));for(let m=0;m<s;m++){const _=r.takeWhile(L=>L.lineNumber===m+1);o.addRequest(i[m],_,t?t[m]:null)}const l=o.finalize(),d=[],c=this.hiddenAreasDecorationIds.map(m=>this.model.getDecorationRange(m)).sort(N.compareRangesUsingStarts);let h=1,u=0,g=-1,f=g+1<c.length?u+1:s+2;for(let m=0;m<s;m++){const _=m+1;_===f&&(g++,h=c[g].startLineNumber,u=c[g].endLineNumber,f=g+1<c.length?u+1:s+2);const L=_>=h&&_<=u,w=ml(l[m],!L);d[m]=w.getViewLineCount(),this.modelLineProjections[m]=w}this._validModelVersionId=this.model.getVersionId(),this.projectedModelLineLineCounts=new _p(d)}getHiddenAreas(){return this.hiddenAreasDecorationIds.map(e=>this.model.getDecorationRange(e))}setHiddenAreas(e){const t=e.map(u=>this.model.validateRange(u)),i=fS(t),n=this.hiddenAreasDecorationIds.map(u=>this.model.getDecorationRange(u)).sort(N.compareRangesUsingStarts);if(i.length===n.length){let u=!1;for(let g=0;g<i.length;g++)if(!i[g].equalsRange(n[g])){u=!0;break}if(!u)return!1}const s=i.map(u=>({range:u,options:Pe.EMPTY}));this.hiddenAreasDecorationIds=this.model.deltaDecorations(this.hiddenAreasDecorationIds,s);const o=i;let r=1,l=0,d=-1,c=d+1<o.length?l+1:this.modelLineProjections.length+2,h=!1;for(let u=0;u<this.modelLineProjections.length;u++){const g=u+1;g===c&&(d++,r=o[d].startLineNumber,l=o[d].endLineNumber,c=d+1<o.length?l+1:this.modelLineProjections.length+2);let f=!1;if(g>=r&&g<=l?this.modelLineProjections[u].isVisible()&&(this.modelLineProjections[u]=this.modelLineProjections[u].setVisible(!1),f=!0):(h=!0,this.modelLineProjections[u].isVisible()||(this.modelLineProjections[u]=this.modelLineProjections[u].setVisible(!0),f=!0)),f){const m=this.modelLineProjections[u].getViewLineCount();this.projectedModelLineLineCounts.setValue(u,m)}}return h||this.setHiddenAreas([]),!0}modelPositionIsVisible(e,t){return e<1||e>this.modelLineProjections.length?!1:this.modelLineProjections[e-1].isVisible()}getModelLineViewLineCount(e){return e<1||e>this.modelLineProjections.length?1:this.modelLineProjections[e-1].getViewLineCount()}setTabSize(e){return this.tabSize===e?!1:(this.tabSize=e,this._constructLines(!1,null),!0)}setWrappingSettings(e,t,i,n,s){const o=this.fontInfo.equals(e),r=this.wrappingStrategy===t,l=this.wrappingColumn===i,d=this.wrappingIndent===n,c=this.wordBreak===s;if(o&&r&&l&&d&&c)return!1;const h=o&&r&&!l&&d&&c;this.fontInfo=e,this.wrappingStrategy=t,this.wrappingColumn=i,this.wrappingIndent=n,this.wordBreak=s;let u=null;if(h){u=[];for(let g=0,f=this.modelLineProjections.length;g<f;g++)u[g]=this.modelLineProjections[g].getProjectionData()}return this._constructLines(!1,u),!0}createLineBreaksComputer(){return(this.wrappingStrategy==="advanced"?this._domLineBreaksComputerFactory:this._monospaceLineBreaksComputerFactory).createLineBreaksComputer(this.fontInfo,this.tabSize,this.wrappingColumn,this.wrappingIndent,this.wordBreak)}onModelFlushed(){this._constructLines(!0,null)}onModelLinesDeleted(e,t,i){if(!e||e<=this._validModelVersionId)return null;const n=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,s=this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections.splice(t-1,i-t+1),this.projectedModelLineLineCounts.removeValues(t-1,i-t+1),new Bl(n,s)}onModelLinesInserted(e,t,i,n){if(!e||e<=this._validModelVersionId)return null;const s=t>2&&!this.modelLineProjections[t-2].isVisible(),o=t===1?1:this.projectedModelLineLineCounts.getPrefixSum(t-1)+1;let r=0;const l=[],d=[];for(let c=0,h=n.length;c<h;c++){const u=ml(n[c],!s);l.push(u);const g=u.getViewLineCount();r+=g,d[c]=g}return this.modelLineProjections=this.modelLineProjections.slice(0,t-1).concat(l).concat(this.modelLineProjections.slice(t-1)),this.projectedModelLineLineCounts.insertValues(t-1,d),new zl(o,o+r-1)}onModelLineChanged(e,t,i){if(e!==null&&e<=this._validModelVersionId)return[!1,null,null,null];const n=t-1,s=this.modelLineProjections[n].getViewLineCount(),o=this.modelLineProjections[n].isVisible(),r=ml(i,o);this.modelLineProjections[n]=r;const l=this.modelLineProjections[n].getViewLineCount();let d=!1,c=0,h=-1,u=0,g=-1,f=0,m=-1;s>l?(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,h=c+l-1,f=h+1,m=f+(s-l)-1,d=!0):s<l?(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,h=c+s-1,u=h+1,g=u+(l-s)-1,d=!0):(c=this.projectedModelLineLineCounts.getPrefixSum(t-1)+1,h=c+l-1),this.projectedModelLineLineCounts.setValue(n,l);const _=c<=h?new mg(c,h-c+1):null,L=u<=g?new zl(u,g):null,w=f<=m?new Bl(f,m):null;return[d,_,L,w]}acceptVersionId(e){this._validModelVersionId=e,this.modelLineProjections.length===1&&!this.modelLineProjections[0].isVisible()&&this.setHiddenAreas([])}getViewLineCount(){return this.projectedModelLineLineCounts.getTotalSum()}_toValidViewLineNumber(e){if(e<1)return 1;const t=this.getViewLineCount();return e>t?t:e|0}getActiveIndentGuide(e,t,i){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t),i=this._toValidViewLineNumber(i);const n=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),s=this.convertViewPositionToModelPosition(t,this.getViewLineMinColumn(t)),o=this.convertViewPositionToModelPosition(i,this.getViewLineMinColumn(i)),r=this.model.guides.getActiveIndentGuide(n.lineNumber,s.lineNumber,o.lineNumber),l=this.convertModelPositionToViewPosition(r.startLineNumber,1),d=this.convertModelPositionToViewPosition(r.endLineNumber,this.model.getLineMaxColumn(r.endLineNumber));return{startLineNumber:l.lineNumber,endLineNumber:d.lineNumber,indent:r.indent}}getViewLineInfo(e){e=this._toValidViewLineNumber(e);const t=this.projectedModelLineLineCounts.getIndexOf(e-1),i=t.index,n=t.remainder;return new Oh(i+1,n)}getMinColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getMaxColumnOfViewLine(e){return this.modelLineProjections[e.modelLineNumber-1].getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx)}getModelStartPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],i=t.getViewLineMinColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),n=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,i);return new I(e.modelLineNumber,n)}getModelEndPositionOfViewLine(e){const t=this.modelLineProjections[e.modelLineNumber-1],i=t.getViewLineMaxColumn(this.model,e.modelLineNumber,e.modelLineWrappedLineIdx),n=t.getModelColumnOfViewPosition(e.modelLineWrappedLineIdx,i);return new I(e.modelLineNumber,n)}getViewLineInfosGroupedByModelRanges(e,t){const i=this.getViewLineInfo(e),n=this.getViewLineInfo(t),s=new Array;let o=this.getModelStartPositionOfViewLine(i),r=new Array;for(let l=i.modelLineNumber;l<=n.modelLineNumber;l++){const d=this.modelLineProjections[l-1];if(d.isVisible()){const c=l===i.modelLineNumber?i.modelLineWrappedLineIdx:0,h=l===n.modelLineNumber?n.modelLineWrappedLineIdx+1:d.getViewLineCount();for(let u=c;u<h;u++)r.push(new Oh(l,u))}if(!d.isVisible()&&o){const c=new I(l-1,this.model.getLineMaxColumn(l-1)+1),h=N.fromPositions(o,c);s.push(new Ph(h,r)),r=[],o=null}else d.isVisible()&&!o&&(o=new I(l,1))}if(o){const l=N.fromPositions(o,this.getModelEndPositionOfViewLine(n));s.push(new Ph(l,r))}return s}getViewLinesBracketGuides(e,t,i,n){const s=i?this.convertViewPositionToModelPosition(i.lineNumber,i.column):null,o=[];for(const r of this.getViewLineInfosGroupedByModelRanges(e,t)){const l=r.modelRange.startLineNumber,d=this.model.guides.getLinesBracketGuides(l,r.modelRange.endLineNumber,s,n);for(const c of r.viewLines){const u=d[c.modelLineNumber-l].map(g=>{if(g.forWrappedLinesAfterColumn!==-1&&this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.forWrappedLinesAfterColumn).lineNumber>=c.modelLineWrappedLineIdx||g.forWrappedLinesBeforeOrAtColumn!==-1&&this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.forWrappedLinesBeforeOrAtColumn).lineNumber<c.modelLineWrappedLineIdx)return;if(!g.horizontalLine)return g;let f=-1;if(g.column!==-1){const L=this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.column);if(L.lineNumber===c.modelLineWrappedLineIdx)f=L.column;else if(L.lineNumber<c.modelLineWrappedLineIdx)f=this.getMinColumnOfViewLine(c);else if(L.lineNumber>c.modelLineWrappedLineIdx)return}const m=this.convertModelPositionToViewPosition(c.modelLineNumber,g.horizontalLine.endColumn),_=this.modelLineProjections[c.modelLineNumber-1].getViewPositionOfModelPosition(0,g.horizontalLine.endColumn);return _.lineNumber===c.modelLineWrappedLineIdx?new Il(g.visibleColumn,f,g.className,new kc(g.horizontalLine.top,m.column),-1,-1):_.lineNumber<c.modelLineWrappedLineIdx||g.visibleColumn!==-1?void 0:new Il(g.visibleColumn,f,g.className,new kc(g.horizontalLine.top,this.getMaxColumnOfViewLine(c)),-1,-1)});o.push(u.filter(g=>!!g))}}return o}getViewLinesIndentGuides(e,t){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const i=this.convertViewPositionToModelPosition(e,this.getViewLineMinColumn(e)),n=this.convertViewPositionToModelPosition(t,this.getViewLineMaxColumn(t));let s=[];const o=[],r=[],l=i.lineNumber-1,d=n.lineNumber-1;let c=null;for(let f=l;f<=d;f++){const m=this.modelLineProjections[f];if(m.isVisible()){const _=m.getViewLineNumberOfModelPosition(0,f===l?i.column:1),L=m.getViewLineNumberOfModelPosition(0,this.model.getLineMaxColumn(f+1)),w=L-_+1;let p=An.BlockNone;w>1&&m.getViewLineMinColumn(this.model,f+1,L)===1&&(p=_===0?An.BlockSubsequent:An.BlockAll),o.push(w),r.push(p),c===null&&(c=new I(f+1,0))}else c!==null&&(s=s.concat(this.model.guides.getLinesIndentGuides(c.lineNumber,f)),c=null)}c!==null&&(s=s.concat(this.model.guides.getLinesIndentGuides(c.lineNumber,n.lineNumber)),c=null);const h=t-e+1,u=new Array(h);let g=0;for(let f=0,m=s.length;f<m;f++){let _=s[f];const L=Math.min(h-g,o[f]),w=r[f];let p;w===An.BlockAll?p=0:w===An.BlockSubsequent?p=1:p=L;for(let C=0;C<L;C++)C===p&&(_=0),u[g++]=_}return u}getViewLineContent(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineContent(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineLength(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineLength(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMinColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMinColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineMaxColumn(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineMaxColumn(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLineData(e){const t=this.getViewLineInfo(e);return this.modelLineProjections[t.modelLineNumber-1].getViewLineData(this.model,t.modelLineNumber,t.modelLineWrappedLineIdx)}getViewLinesData(e,t,i){e=this._toValidViewLineNumber(e),t=this._toValidViewLineNumber(t);const n=this.projectedModelLineLineCounts.getIndexOf(e-1);let s=e;const o=n.index,r=n.remainder,l=[];for(let d=o,c=this.model.getLineCount();d<c;d++){const h=this.modelLineProjections[d];if(!h.isVisible())continue;const u=d===o?r:0;let g=h.getViewLineCount()-u,f=!1;if(s+g>t&&(f=!0,g=t-s+1),h.getViewLinesData(this.model,d+1,u,g,s-e,i,l),s+=g,f)break}return l}validateViewPosition(e,t,i){e=this._toValidViewLineNumber(e);const n=this.projectedModelLineLineCounts.getIndexOf(e-1),s=n.index,o=n.remainder,r=this.modelLineProjections[s],l=r.getViewLineMinColumn(this.model,s+1,o),d=r.getViewLineMaxColumn(this.model,s+1,o);t<l&&(t=l),t>d&&(t=d);const c=r.getModelColumnOfViewPosition(o,t);return this.model.validatePosition(new I(s+1,c)).equals(i)?new I(e,t):this.convertModelPositionToViewPosition(i.lineNumber,i.column)}validateViewRange(e,t){const i=this.validateViewPosition(e.startLineNumber,e.startColumn,t.getStartPosition()),n=this.validateViewPosition(e.endLineNumber,e.endColumn,t.getEndPosition());return new N(i.lineNumber,i.column,n.lineNumber,n.column)}convertViewPositionToModelPosition(e,t){const i=this.getViewLineInfo(e),n=this.modelLineProjections[i.modelLineNumber-1].getModelColumnOfViewPosition(i.modelLineWrappedLineIdx,t);return this.model.validatePosition(new I(i.modelLineNumber,n))}convertViewRangeToModelRange(e){const t=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),i=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);return new N(t.lineNumber,t.column,i.lineNumber,i.column)}convertModelPositionToViewPosition(e,t,i=Ie.None,n=!1,s=!1){const o=this.model.validatePosition(new I(e,t)),r=o.lineNumber,l=o.column;let d=r-1,c=!1;if(s)for(;d<this.modelLineProjections.length&&!this.modelLineProjections[d].isVisible();)d++,c=!0;else for(;d>0&&!this.modelLineProjections[d].isVisible();)d--,c=!0;if(d===0&&!this.modelLineProjections[d].isVisible())return new I(n?0:1,1);const h=1+this.projectedModelLineLineCounts.getPrefixSum(d);let u;return c?s?u=this.modelLineProjections[d].getViewPositionOfModelPosition(h,1,i):u=this.modelLineProjections[d].getViewPositionOfModelPosition(h,this.model.getLineMaxColumn(d+1),i):u=this.modelLineProjections[r-1].getViewPositionOfModelPosition(h,l,i),u}convertModelRangeToViewRange(e,t=Ie.Left){if(e.isEmpty()){const i=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,t);return N.fromPositions(i)}else{const i=this.convertModelPositionToViewPosition(e.startLineNumber,e.startColumn,Ie.Right),n=this.convertModelPositionToViewPosition(e.endLineNumber,e.endColumn,Ie.Left);return new N(i.lineNumber,i.column,n.lineNumber,n.column)}}getViewLineNumberOfModelPosition(e,t){let i=e-1;if(this.modelLineProjections[i].isVisible()){const s=1+this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections[i].getViewLineNumberOfModelPosition(s,t)}for(;i>0&&!this.modelLineProjections[i].isVisible();)i--;if(i===0&&!this.modelLineProjections[i].isVisible())return 1;const n=1+this.projectedModelLineLineCounts.getPrefixSum(i);return this.modelLineProjections[i].getViewLineNumberOfModelPosition(n,this.model.getLineMaxColumn(i+1))}getDecorationsInRange(e,t,i,n,s){const o=this.convertViewPositionToModelPosition(e.startLineNumber,e.startColumn),r=this.convertViewPositionToModelPosition(e.endLineNumber,e.endColumn);if(r.lineNumber-o.lineNumber<=e.endLineNumber-e.startLineNumber)return this.model.getDecorationsInRange(new N(o.lineNumber,1,r.lineNumber,r.column),t,i,n,s);let l=[];const d=o.lineNumber-1,c=r.lineNumber-1;let h=null;for(let m=d;m<=c;m++)if(this.modelLineProjections[m].isVisible())h===null&&(h=new I(m+1,m===d?o.column:1));else if(h!==null){const L=this.model.getLineMaxColumn(m);l=l.concat(this.model.getDecorationsInRange(new N(h.lineNumber,h.column,m,L),t,i,n)),h=null}h!==null&&(l=l.concat(this.model.getDecorationsInRange(new N(h.lineNumber,h.column,r.lineNumber,r.column),t,i,n)),h=null),l.sort((m,_)=>{const L=N.compareRangesUsingStarts(m.range,_.range);return L===0?m.id<_.id?-1:m.id>_.id?1:0:L});const u=[];let g=0,f=null;for(const m of l){const _=m.id;f!==_&&(f=_,u[g++]=m)}return u}getInjectedTextAt(e){const t=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[t.modelLineNumber-1].getInjectedTextAt(t.modelLineWrappedLineIdx,e.column)}normalizePosition(e,t){const i=this.getViewLineInfo(e.lineNumber);return this.modelLineProjections[i.modelLineNumber-1].normalizePosition(i.modelLineWrappedLineIdx,e,t)}getLineIndentColumn(e){const t=this.getViewLineInfo(e);return t.modelLineWrappedLineIdx===0?this.model.getLineIndentColumn(t.modelLineNumber):0}}function fS(a){if(a.length===0)return[];const e=a.slice();e.sort(N.compareRangesUsingStarts);const t=[];let i=e[0].startLineNumber,n=e[0].endLineNumber;for(let s=1,o=e.length;s<o;s++){const r=e[s];r.startLineNumber>n+1?(t.push(new N(i,1,n,1)),i=r.startLineNumber,n=r.endLineNumber):r.endLineNumber>n&&(n=r.endLineNumber)}return t.push(new N(i,1,n,1)),t}class Oh{get isWrappedLineContinuation(){return this.modelLineWrappedLineIdx>0}constructor(e,t){this.modelLineNumber=e,this.modelLineWrappedLineIdx=t}}class Ph{constructor(e,t){this.modelRange=e,this.viewLines=t}}class mS{constructor(e){this._lines=e}convertViewPositionToModelPosition(e){return this._lines.convertViewPositionToModelPosition(e.lineNumber,e.column)}convertViewRangeToModelRange(e){return this._lines.convertViewRangeToModelRange(e)}validateViewPosition(e,t){return this._lines.validateViewPosition(e.lineNumber,e.column,t)}validateViewRange(e,t){return this._lines.validateViewRange(e,t)}convertModelPositionToViewPosition(e,t,i,n){return this._lines.convertModelPositionToViewPosition(e.lineNumber,e.column,t,i,n)}convertModelRangeToViewRange(e,t){return this._lines.convertModelRangeToViewRange(e,t)}modelPositionIsVisible(e){return this._lines.modelPositionIsVisible(e.lineNumber,e.column)}getModelLineViewLineCount(e){return this._lines.getModelLineViewLineCount(e)}getViewLineNumberOfModelPosition(e,t){return this._lines.getViewLineNumberOfModelPosition(e,t)}}var An;(function(a){a[a.BlockNone=0]="BlockNone",a[a.BlockSubsequent=1]="BlockSubsequent",a[a.BlockAll=2]="BlockAll"})(An||(An={}));class pS{constructor(e){this.model=e}dispose(){}createCoordinatesConverter(){return new _S(this)}getHiddenAreas(){return[]}setHiddenAreas(e){return!1}setTabSize(e){return!1}setWrappingSettings(e,t,i,n){return!1}createLineBreaksComputer(){const e=[];return{addRequest:(t,i,n)=>{e.push(null)},finalize:()=>e}}onModelFlushed(){}onModelLinesDeleted(e,t,i){return new Bl(t,i)}onModelLinesInserted(e,t,i,n){return new zl(t,i)}onModelLineChanged(e,t,i){return[!1,new mg(t,1),null,null]}acceptVersionId(e){}getViewLineCount(){return this.model.getLineCount()}getActiveIndentGuide(e,t,i){return{startLineNumber:e,endLineNumber:e,indent:0}}getViewLinesBracketGuides(e,t,i){return new Array(t-e+1).fill([])}getViewLinesIndentGuides(e,t){const i=t-e+1,n=new Array(i);for(let s=0;s<i;s++)n[s]=0;return n}getViewLineContent(e){return this.model.getLineContent(e)}getViewLineLength(e){return this.model.getLineLength(e)}getViewLineMinColumn(e){return this.model.getLineMinColumn(e)}getViewLineMaxColumn(e){return this.model.getLineMaxColumn(e)}getViewLineData(e){const t=this.model.tokenization.getLineTokens(e),i=t.getLineContent();return new qd(i,!1,1,i.length+1,0,t.inflate(),null)}getViewLinesData(e,t,i){const n=this.model.getLineCount();e=Math.min(Math.max(1,e),n),t=Math.min(Math.max(1,t),n);const s=[];for(let o=e;o<=t;o++){const r=o-e;s[r]=i[r]?this.getViewLineData(o):null}return s}getDecorationsInRange(e,t,i,n,s){return this.model.getDecorationsInRange(e,t,i,n,s)}normalizePosition(e,t){return this.model.normalizePosition(e,t)}getLineIndentColumn(e){return this.model.getLineIndentColumn(e)}getInjectedTextAt(e){return null}}class _S{constructor(e){this._lines=e}_validPosition(e){return this._lines.model.validatePosition(e)}_validRange(e){return this._lines.model.validateRange(e)}convertViewPositionToModelPosition(e){return this._validPosition(e)}convertViewRangeToModelRange(e){return this._validRange(e)}validateViewPosition(e,t){return this._validPosition(t)}validateViewRange(e,t){return this._validRange(t)}convertModelPositionToViewPosition(e){return this._validPosition(e)}convertModelRangeToViewRange(e){return this._validRange(e)}modelPositionIsVisible(e){const t=this._lines.model.getLineCount();return!(e.lineNumber<1||e.lineNumber>t)}modelRangeIsVisible(e){const t=this._lines.model.getLineCount();return!(e.startLineNumber<1||e.startLineNumber>t||e.endLineNumber<1||e.endLineNumber>t)}getModelLineViewLineCount(e){return 1}getViewLineNumberOfModelPosition(e,t){return e}}const vn=nr.Right;class CS{constructor(e){this.persist=0,this._requiredLanes=1,this.lanes=new Uint8Array(Math.ceil((e+1)*vn/8))}reset(e){const t=Math.ceil((e+1)*vn/8);this.lanes.length<t?this.lanes=new Uint8Array(t):this.lanes.fill(0),this._requiredLanes=1}get requiredLanes(){return this._requiredLanes}push(e,t,i){i&&(this.persist|=1<<e-1);for(let n=t.startLineNumber;n<=t.endLineNumber;n++){const s=vn*n+(e-1);this.lanes[s>>>3]|=1<<s%8,this._requiredLanes=Math.max(this._requiredLanes,this.countAtLine(n))}}getLanesAtLine(e){const t=[];let i=vn*e;for(let n=0;n<vn;n++)(this.persist&1<<n||this.lanes[i>>>3]&1<<i%8)&&t.push(n+1),i++;return t.length?t:[nr.Center]}countAtLine(e){let t=vn*e,i=0;for(let n=0;n<vn;n++)(this.persist&1<<n||this.lanes[t>>>3]&1<<t%8)&&i++,t++;return i}}let wS=class extends U{constructor(e,t,i,n,s,o,r,l,d,c){if(super(),this.languageConfigurationService=r,this._themeService=l,this._attachedView=d,this._transactionalTarget=c,this.hiddenAreasModel=new vS,this.previousHiddenAreas=[],this._editorId=e,this._configuration=t,this.model=i,this._eventDispatcher=new Vb,this.onEvent=this._eventDispatcher.onEvent,this.cursorConfig=new cs(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._updateConfigurationViewLineCount=this._register(new Ei(()=>this._updateConfigurationViewLineCountNow(),0)),this._hasFocus=!1,this._viewportStart=uc.create(this.model),this.glyphLanes=new CS(0),this.model.isTooLargeForTokenization())this._lines=new pS(this.model);else{const h=this._configuration.options,u=h.get(v.fontInfo),g=h.get(v.wrappingStrategy),f=h.get(v.wrappingInfo),m=h.get(v.wrappingIndent),_=h.get(v.wordBreak);this._lines=new gS(this._editorId,this.model,n,s,u,this.model.getOptions().tabSize,g,f.wrappingColumn,m,_)}this.coordinatesConverter=this._lines.createCoordinatesConverter(),this._cursor=this._register(new Yb(i,this,this.coordinatesConverter,this.cursorConfig)),this.viewLayout=this._register(new rS(this._configuration,this.getLineCount(),this._getCustomLineHeights(),o)),this._register(this.viewLayout.onDidScroll(h=>{h.scrollTopChanged&&this._handleVisibleLinesChanged(),h.scrollTopChanged&&this._viewportStart.invalidate(),this._eventDispatcher.emitSingleViewEvent(new Dw(h)),this._eventDispatcher.emitOutgoingEvent(new hc(h.oldScrollWidth,h.oldScrollLeft,h.oldScrollHeight,h.oldScrollTop,h.scrollWidth,h.scrollLeft,h.scrollHeight,h.scrollTop))})),this._register(this.viewLayout.onDidContentSizeChange(h=>{this._eventDispatcher.emitOutgoingEvent(h)})),this._decorations=new aS(this._editorId,this.model,this._configuration,this._lines,this.coordinatesConverter),this._registerModelEvents(),this._register(this._configuration.onDidChangeFast(h=>{try{const u=this._eventDispatcher.beginEmitViewEvents();this._onConfigurationChanged(u,h)}finally{this._eventDispatcher.endEmitViewEvents()}})),this._register(Ga.getInstance().onDidChange(()=>{this._eventDispatcher.emitSingleViewEvent(new Aw)})),this._register(this._themeService.onDidColorThemeChange(h=>{this._invalidateDecorationsColorCache(),this._eventDispatcher.emitSingleViewEvent(new Tw(h))})),this._updateConfigurationViewLineCountNow()}dispose(){super.dispose(),this._decorations.dispose(),this._lines.dispose(),this._viewportStart.dispose(),this._eventDispatcher.dispose()}createLineBreaksComputer(){return this._lines.createLineBreaksComputer()}addViewEventHandler(e){this._eventDispatcher.addViewEventHandler(e)}removeViewEventHandler(e){this._eventDispatcher.removeViewEventHandler(e)}_getCustomLineHeights(){return this.model.getCustomLineHeightsDecorations(this._editorId).map(t=>{const i=t.range.startLineNumber,n=this.coordinatesConverter.convertModelRangeToViewRange(new N(i,1,i,this.model.getLineMaxColumn(i)));return{decorationId:t.id,startLineNumber:n.startLineNumber,endLineNumber:n.endLineNumber,lineHeight:t.options.lineHeight||0}})}_updateConfigurationViewLineCountNow(){this._configuration.setViewLineCount(this._lines.getViewLineCount())}getModelVisibleRanges(){const e=this.viewLayout.getLinesViewportData(),t=new N(e.startLineNumber,this.getLineMinColumn(e.startLineNumber),e.endLineNumber,this.getLineMaxColumn(e.endLineNumber));return this._toModelVisibleRanges(t)}visibleLinesStabilized(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!0)}_handleVisibleLinesChanged(){const e=this.getModelVisibleRanges();this._attachedView.setVisibleLines(e,!1)}setHasFocus(e){this._hasFocus=e,this._cursor.setHasFocus(e),this._eventDispatcher.emitSingleViewEvent(new Iw(e)),this._eventDispatcher.emitOutgoingEvent(new Ka(!e,e))}setHasWidgetFocus(e){this._eventDispatcher.emitOutgoingEvent(new Hb(!e,e))}onCompositionStart(){this._eventDispatcher.emitSingleViewEvent(new yw)}onCompositionEnd(){this._eventDispatcher.emitSingleViewEvent(new xw)}_captureStableViewport(){if(this._viewportStart.isValid&&this.viewLayout.getCurrentScrollTop()>0){const e=new I(this._viewportStart.viewLineNumber,this.getLineMinColumn(this._viewportStart.viewLineNumber)),t=this.coordinatesConverter.convertViewPositionToModelPosition(e);return new Wh(t,this._viewportStart.startLineDelta)}return new Wh(null,0)}_onConfigurationChanged(e,t){const i=this._captureStableViewport(),n=this._configuration.options,s=n.get(v.fontInfo),o=n.get(v.wrappingStrategy),r=n.get(v.wrappingInfo),l=n.get(v.wrappingIndent),d=n.get(v.wordBreak);this._lines.setWrappingSettings(s,o,r.wrappingColumn,l,d)&&(e.emitViewEvent(new _r),e.emitViewEvent(new Cr),e.emitViewEvent(new wn(null)),this._cursor.onLineMappingChanged(e),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights()),this._updateConfigurationViewLineCount.schedule()),t.hasChanged(v.readOnly)&&(this._decorations.reset(),e.emitViewEvent(new wn(null))),t.hasChanged(v.renderValidationDecorations)&&(this._decorations.reset(),e.emitViewEvent(new wn(null))),e.emitViewEvent(new Nw(t)),this.viewLayout.onConfigurationChanged(t),i.recoverViewportStart(this.coordinatesConverter,this.viewLayout),cs.shouldRecreate(t)&&(this.cursorConfig=new cs(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig))}_registerModelEvents(){this._register(this.model.onDidChangeContentOrInjectedText(e=>{try{const i=this._eventDispatcher.beginEmitViewEvents();let n=!1,s=!1;const o=e instanceof Ja?e.rawContentChangedEvent.changes:e.changes,r=e instanceof Ja?e.rawContentChangedEvent.versionId:null,l=this._lines.createLineBreaksComputer();for(const h of o)switch(h.changeType){case Zi.LinesInserted:{for(let u=0;u<h.detail.length;u++){const g=h.detail[u];let f=h.injectedTexts[u];f&&(f=f.filter(m=>!m.ownerId||m.ownerId===this._editorId)),l.addRequest(g,f,null)}break}case Zi.LineChanged:{let u=null;h.injectedText&&(u=h.injectedText.filter(g=>!g.ownerId||g.ownerId===this._editorId)),l.addRequest(h.detail,u,null);break}}const d=l.finalize(),c=new As(d);for(const h of o)switch(h.changeType){case Zi.Flush:{this._lines.onModelFlushed(),i.emitViewEvent(new _r),this._decorations.reset(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights()),n=!0;break}case Zi.LinesDeleted:{const u=this._lines.onModelLinesDeleted(r,h.fromLineNumber,h.toLineNumber);u!==null&&(i.emitViewEvent(u),this.viewLayout.onLinesDeleted(u.fromLineNumber,u.toLineNumber)),n=!0;break}case Zi.LinesInserted:{const u=c.takeCount(h.detail.length),g=this._lines.onModelLinesInserted(r,h.fromLineNumber,h.toLineNumber,u);g!==null&&(i.emitViewEvent(g),this.viewLayout.onLinesInserted(g.fromLineNumber,g.toLineNumber)),n=!0;break}case Zi.LineChanged:{const u=c.dequeue(),[g,f,m,_]=this._lines.onModelLineChanged(r,h.lineNumber,u);s=g,f&&i.emitViewEvent(f),m&&(i.emitViewEvent(m),this.viewLayout.onLinesInserted(m.fromLineNumber,m.toLineNumber)),_&&(i.emitViewEvent(_),this.viewLayout.onLinesDeleted(_.fromLineNumber,_.toLineNumber));break}case Zi.EOLChanged:break}r!==null&&this._lines.acceptVersionId(r),this.viewLayout.onHeightMaybeChanged(),!n&&s&&(i.emitViewEvent(new Cr),i.emitViewEvent(new wn(null)),this._cursor.onLineMappingChanged(i),this._decorations.onLineMappingChanged())}finally{this._eventDispatcher.endEmitViewEvents()}const t=this._viewportStart.isValid;if(this._viewportStart.invalidate(),this._configuration.setModelLineCount(this.model.getLineCount()),this._updateConfigurationViewLineCountNow(),!this._hasFocus&&this.model.getAttachedEditorCount()>=2&&t){const i=this.model._getTrackedRange(this._viewportStart.modelTrackedRange);if(i){const n=this.coordinatesConverter.convertModelPositionToViewPosition(i.getStartPosition()),s=this.viewLayout.getVerticalOffsetForLineNumber(n.lineNumber);this.viewLayout.setScrollPosition({scrollTop:s+this._viewportStart.startLineDelta},K.Immediate)}}try{const i=this._eventDispatcher.beginEmitViewEvents();e instanceof Ja&&i.emitOutgoingEvent(new $b(e.contentChangedEvent)),this._cursor.onModelContentChanged(i,e)}finally{this._eventDispatcher.endEmitViewEvents()}this._handleVisibleLinesChanged()})),this._register(this.model.onDidChangeLineHeight(e=>{const t=e.changes.filter(i=>i.ownerId===this._editorId||i.ownerId===0);if(this.viewLayout.changeSpecialLineHeights(i=>{for(const n of t){const{decorationId:s,lineNumber:o,lineHeight:r}=n,l=this.coordinatesConverter.convertModelRangeToViewRange(new N(o,1,o,this.model.getLineMaxColumn(o)));r!==null?i.insertOrChangeCustomLineHeight(s,l.startLineNumber,l.endLineNumber,r):i.removeCustomLineHeight(s)}}),t.length>0){const i=new Cp(t);this._eventDispatcher.emitOutgoingEvent(new Xb(i))}})),this._register(this.model.onDidChangeTokens(e=>{const t=[];for(let i=0,n=e.ranges.length;i<n;i++){const s=e.ranges[i],o=this.coordinatesConverter.convertModelPositionToViewPosition(new I(s.fromLineNumber,1)).lineNumber,r=this.coordinatesConverter.convertModelPositionToViewPosition(new I(s.toLineNumber,this.model.getLineMaxColumn(s.toLineNumber))).lineNumber;t[i]={fromLineNumber:o,toLineNumber:r}}this._eventDispatcher.emitSingleViewEvent(new Mw(t)),this._eventDispatcher.emitOutgoingEvent(new qb(e))})),this._register(this.model.onDidChangeLanguageConfiguration(e=>{this._eventDispatcher.emitSingleViewEvent(new Rw),this.cursorConfig=new cs(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new Kb(e))})),this._register(this.model.onDidChangeLanguage(e=>{this.cursorConfig=new cs(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new jb(e))})),this._register(this.model.onDidChangeOptions(e=>{if(this._lines.setTabSize(this.model.getOptions().tabSize)){try{const t=this._eventDispatcher.beginEmitViewEvents();t.emitViewEvent(new _r),t.emitViewEvent(new Cr),t.emitViewEvent(new wn(null)),this._cursor.onLineMappingChanged(t),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights())}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule()}this.cursorConfig=new cs(this.model.getLanguageId(),this.model.getOptions(),this._configuration,this.languageConfigurationService),this._cursor.updateConfiguration(this.cursorConfig),this._eventDispatcher.emitOutgoingEvent(new Zb(e))})),this._register(this.model.onDidChangeDecorations(e=>{this._decorations.onModelDecorationsChanged(),this._eventDispatcher.emitSingleViewEvent(new wn(e)),this._eventDispatcher.emitOutgoingEvent(new Gb(e))}))}setHiddenAreas(e,t,i){this.hiddenAreasModel.setHiddenAreas(t,e);const n=this.hiddenAreasModel.getMergedRanges();if(n===this.previousHiddenAreas&&!i)return;this.previousHiddenAreas=n;const s=this._captureStableViewport();let o=!1;try{const r=this._eventDispatcher.beginEmitViewEvents();o=this._lines.setHiddenAreas(n),o&&(r.emitViewEvent(new _r),r.emitViewEvent(new Cr),r.emitViewEvent(new wn(null)),this._cursor.onLineMappingChanged(r),this._decorations.onLineMappingChanged(),this.viewLayout.onFlushed(this.getLineCount(),this._getCustomLineHeights()),this.viewLayout.onHeightMaybeChanged());const l=s.viewportStartModelPosition?.lineNumber;l&&n.some(c=>c.startLineNumber<=l&&l<=c.endLineNumber)||s.recoverViewportStart(this.coordinatesConverter,this.viewLayout)}finally{this._eventDispatcher.endEmitViewEvents()}this._updateConfigurationViewLineCount.schedule(),o&&this._eventDispatcher.emitOutgoingEvent(new zb)}getVisibleRangesPlusViewportAboveBelow(){const e=this._configuration.options.get(v.layoutInfo),t=this._configuration.options.get(v.lineHeight),i=Math.max(20,Math.round(e.height/t)),n=this.viewLayout.getLinesViewportData(),s=Math.max(1,n.completelyVisibleStartLineNumber-i),o=Math.min(this.getLineCount(),n.completelyVisibleEndLineNumber+i);return this._toModelVisibleRanges(new N(s,this.getLineMinColumn(s),o,this.getLineMaxColumn(o)))}getVisibleRanges(){const e=this.getCompletelyVisibleViewRange();return this._toModelVisibleRanges(e)}getHiddenAreas(){return this._lines.getHiddenAreas()}_toModelVisibleRanges(e){const t=this.coordinatesConverter.convertViewRangeToModelRange(e),i=this._lines.getHiddenAreas();if(i.length===0)return[t];const n=[];let s=0,o=t.startLineNumber,r=t.startColumn;const l=t.endLineNumber,d=t.endColumn;for(let c=0,h=i.length;c<h;c++){const u=i[c].startLineNumber,g=i[c].endLineNumber;g<o||u>l||(o<u&&(n[s++]=new N(o,r,u-1,this.model.getLineMaxColumn(u-1))),o=g+1,r=1)}return(o<l||o===l&&r<d)&&(n[s++]=new N(o,r,l,d)),n}getCompletelyVisibleViewRange(){const e=this.viewLayout.getLinesViewportData(),t=e.completelyVisibleStartLineNumber,i=e.completelyVisibleEndLineNumber;return new N(t,this.getLineMinColumn(t),i,this.getLineMaxColumn(i))}getCompletelyVisibleViewRangeAtScrollTop(e){const t=this.viewLayout.getLinesViewportDataAtScrollTop(e),i=t.completelyVisibleStartLineNumber,n=t.completelyVisibleEndLineNumber;return new N(i,this.getLineMinColumn(i),n,this.getLineMaxColumn(n))}saveState(){const e=this.viewLayout.saveState(),t=e.scrollTop,i=this.viewLayout.getLineNumberAtVerticalOffset(t),n=this.coordinatesConverter.convertViewPositionToModelPosition(new I(i,this.getLineMinColumn(i))),s=this.viewLayout.getVerticalOffsetForLineNumber(i)-t;return{scrollLeft:e.scrollLeft,firstPosition:n,firstPositionDeltaTop:s}}reduceRestoreState(e){if(typeof e.firstPosition>"u")return this._reduceRestoreStateCompatibility(e);const t=this.model.validatePosition(e.firstPosition),i=this.coordinatesConverter.convertModelPositionToViewPosition(t),n=this.viewLayout.getVerticalOffsetForLineNumber(i.lineNumber)-e.firstPositionDeltaTop;return{scrollLeft:e.scrollLeft,scrollTop:n}}_reduceRestoreStateCompatibility(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTopWithoutViewZones}}getTabSize(){return this.model.getOptions().tabSize}getLineCount(){return this._lines.getViewLineCount()}setViewport(e,t,i){this._viewportStart.update(this,e)}getActiveIndentGuide(e,t,i){return this._lines.getActiveIndentGuide(e,t,i)}getLinesIndentGuides(e,t){return this._lines.getViewLinesIndentGuides(e,t)}getBracketGuidesInRangeByLine(e,t,i,n){return this._lines.getViewLinesBracketGuides(e,t,i,n)}getLineContent(e){return this._lines.getViewLineContent(e)}getLineLength(e){return this._lines.getViewLineLength(e)}getLineMinColumn(e){return this._lines.getViewLineMinColumn(e)}getLineMaxColumn(e){return this._lines.getViewLineMaxColumn(e)}getLineFirstNonWhitespaceColumn(e){const t=zi(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=Qo(this.getLineContent(e));return t===-1?0:t+2}getMinimapDecorationsInRange(e){return this._decorations.getMinimapDecorationsInRange(e)}getDecorationsInViewport(e){return this._decorations.getDecorationsViewportData(e).decorations}getInjectedTextAt(e){return this._lines.getInjectedTextAt(e)}getViewportViewLineRenderingData(e,t){const n=this._decorations.getDecorationsViewportData(e).inlineDecorations[t-e.startLineNumber];return this._getViewLineRenderingData(t,n)}getViewLineRenderingData(e){const t=this._decorations.getInlineDecorationsOnLine(e);return this._getViewLineRenderingData(e,t)}_getViewLineRenderingData(e,t){const i=this.model.mightContainRTL(),n=this.model.mightContainNonBasicASCII(),s=this.getTabSize(),o=this._lines.getViewLineData(e);return o.inlineDecorations&&(t=[...t,...o.inlineDecorations.map(r=>r.toInlineDecoration(e))]),new Ut(o.minColumn,o.maxColumn,o.content,o.continuesWithWrappedLine,i,n,o.tokens,t,s,o.startVisibleColumn)}getViewLineData(e){return this._lines.getViewLineData(e)}getMinimapLinesRenderingData(e,t,i){const n=this._lines.getViewLinesData(e,t,i);return new Ww(this.getTabSize(),n)}getAllOverviewRulerDecorations(e){const t=this.model.getOverviewRulerDecorations(this._editorId,jr(this._configuration.options)),i=new LS;for(const n of t){const s=n.options,o=s.overviewRuler;if(!o)continue;const r=o.position;if(r===0)continue;const l=o.getColor(e.value),d=this.coordinatesConverter.getViewLineNumberOfModelPosition(n.range.startLineNumber,n.range.startColumn),c=this.coordinatesConverter.getViewLineNumberOfModelPosition(n.range.endLineNumber,n.range.endColumn);i.accept(l,s.zIndex,d,c,r)}return i.asArray}_invalidateDecorationsColorCache(){const e=this.model.getOverviewRulerDecorations();for(const t of e)t.options.overviewRuler?.invalidateCachedColor(),t.options.minimap?.invalidateCachedColor()}getValueInRange(e,t){const i=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueInRange(i,t)}getValueLengthInRange(e,t){const i=this.coordinatesConverter.convertViewRangeToModelRange(e);return this.model.getValueLengthInRange(i,t)}modifyPosition(e,t){const i=this.coordinatesConverter.convertViewPositionToModelPosition(e),n=this.model.modifyPosition(i,t);return this.coordinatesConverter.convertModelPositionToViewPosition(n)}deduceModelPositionRelativeToViewPosition(e,t,i){const n=this.coordinatesConverter.convertViewPositionToModelPosition(e);this.model.getEOL().length===2&&(t<0?t-=i:t+=i);const o=this.model.getOffsetAt(n)+t;return this.model.getPositionAt(o)}getPlainTextToCopy(e,t,i){const n=i?`\r
`:this.model.getEOL();e=e.slice(0),e.sort(N.compareRangesUsingStarts);let s=!1,o=!1;for(const l of e)l.isEmpty()?s=!0:o=!0;if(!o){if(!t)return"";const l=e.map(c=>c.startLineNumber);let d="";for(let c=0;c<l.length;c++)c>0&&l[c-1]===l[c]||(d+=this.model.getLineContent(l[c])+n);return d}if(s&&t){const l=[];let d=0;for(const c of e){const h=c.startLineNumber;c.isEmpty()?h!==d&&l.push(this.model.getLineContent(h)):l.push(this.model.getValueInRange(c,i?Ct.CRLF:Ct.TextDefined)),d=h}return l.length===1?l[0]:l}const r=[];for(const l of e)l.isEmpty()||r.push(this.model.getValueInRange(l,i?Ct.CRLF:Ct.TextDefined));return r.length===1?r[0]:r}getRichTextToCopy(e,t){const i=this.model.getLanguageId();if(i===xa||e.length!==1)return null;let n=e[0];if(n.isEmpty()){if(!t)return null;const c=n.startLineNumber;n=new N(c,this.model.getLineMinColumn(c),c,this.model.getLineMaxColumn(c))}const s=this._configuration.options.get(v.fontInfo),o=this._getColorMap(),l=/[:;\\\/<>]/.test(s.fontFamily)||s.fontFamily===Ir.fontFamily;let d;return l?d=Ir.fontFamily:(d=s.fontFamily,d=d.replace(/"/g,"'"),/[,']/.test(d)||/[+ ]/.test(d)&&(d=`'${d}'`),d=`${d}, ${Ir.fontFamily}`),{mode:i,html:`<div style="color: ${o[Ui.DefaultForeground]};background-color: ${o[Ui.DefaultBackground]};font-family: ${d};font-weight: ${s.fontWeight};font-size: ${s.fontSize}px;line-height: ${s.lineHeight}px;white-space: pre;">`+this._getHTMLToCopy(n,o)+"</div>"}}_getHTMLToCopy(e,t){const i=e.startLineNumber,n=e.startColumn,s=e.endLineNumber,o=e.endColumn,r=this.getTabSize();let l="";for(let d=i;d<=s;d++){const c=this.model.tokenization.getLineTokens(d),h=c.getLineContent(),u=d===i?n-1:0,g=d===s?o-1:h.length;h===""?l+="<br>":l+=wp(h,c.inflate(),t,u,g,r,Ra)}return l}_getColorMap(){const e=Ye.getColorMap(),t=["#000000"];if(e)for(let i=1,n=e.length;i<n;i++)t[i]=_i.Format.CSS.formatHex(e[i]);return t}getPrimaryCursorState(){return this._cursor.getPrimaryCursorState()}getLastAddedCursorIndex(){return this._cursor.getLastAddedCursorIndex()}getCursorStates(){return this._cursor.getCursorStates()}setCursorStates(e,t,i){return this._withViewEventsCollector(n=>this._cursor.setStates(n,e,t,i))}getCursorColumnSelectData(){return this._cursor.getCursorColumnSelectData()}getCursorAutoClosedCharacters(){return this._cursor.getAutoClosedCharacters()}setCursorColumnSelectData(e){this._cursor.setCursorColumnSelectData(e)}getPrevEditOperationType(){return this._cursor.getPrevEditOperationType()}setPrevEditOperationType(e){this._cursor.setPrevEditOperationType(e)}getSelection(){return this._cursor.getSelection()}getSelections(){return this._cursor.getSelections()}getPosition(){return this._cursor.getPrimaryCursorState().modelState.position}setSelections(e,t,i=he.NotSet){this._withViewEventsCollector(n=>this._cursor.setSelections(n,e,t,i))}saveCursorState(){return this._cursor.saveState()}restoreCursorState(e){this._withViewEventsCollector(t=>this._cursor.restoreState(t,e))}_executeCursorEdit(e){if(this._cursor.context.cursorConfig.readOnly){this._eventDispatcher.emitOutgoingEvent(new Ub);return}this._withViewEventsCollector(e)}executeEdits(e,t,i){this._executeCursorEdit(n=>this._cursor.executeEdits(n,e,t,i))}startComposition(){this._executeCursorEdit(e=>this._cursor.startComposition(e))}endComposition(e){this._executeCursorEdit(t=>this._cursor.endComposition(t,e))}type(e,t){this._executeCursorEdit(i=>this._cursor.type(i,e,t))}compositionType(e,t,i,n,s){this._executeCursorEdit(o=>this._cursor.compositionType(o,e,t,i,n,s))}paste(e,t,i,n){this._executeCursorEdit(s=>this._cursor.paste(s,e,t,i,n))}cut(e){this._executeCursorEdit(t=>this._cursor.cut(t,e))}executeCommand(e,t){this._executeCursorEdit(i=>this._cursor.executeCommand(i,e,t))}executeCommands(e,t){this._executeCursorEdit(i=>this._cursor.executeCommands(i,e,t))}revealAllCursors(e,t,i=!1){this._withViewEventsCollector(n=>this._cursor.revealAll(n,e,i,de.Simple,t,K.Smooth))}revealPrimaryCursor(e,t,i=!1){this._withViewEventsCollector(n=>this._cursor.revealPrimary(n,e,i,de.Simple,t,K.Smooth))}revealTopMostCursor(e){const t=this._cursor.getTopMostViewPosition(),i=new N(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(n=>n.emitViewEvent(new po(e,!1,i,null,de.Simple,!0,K.Smooth)))}revealBottomMostCursor(e){const t=this._cursor.getBottomMostViewPosition(),i=new N(t.lineNumber,t.column,t.lineNumber,t.column);this._withViewEventsCollector(n=>n.emitViewEvent(new po(e,!1,i,null,de.Simple,!0,K.Smooth)))}revealRange(e,t,i,n,s){this._withViewEventsCollector(o=>o.emitViewEvent(new po(e,!1,i,null,n,t,s)))}changeWhitespace(e){this.viewLayout.changeWhitespace(e)&&(this._eventDispatcher.emitSingleViewEvent(new Ow),this._eventDispatcher.emitOutgoingEvent(new Bb))}_withViewEventsCollector(e){return this._transactionalTarget.batchChanges(()=>{try{const t=this._eventDispatcher.beginEmitViewEvents();return e(t)}finally{this._eventDispatcher.endEmitViewEvents()}})}batchEvents(e){this._withViewEventsCollector(()=>{e()})}normalizePosition(e,t){return this._lines.normalizePosition(e,t)}getLineIndentColumn(e){return this._lines.getLineIndentColumn(e)}};class uc{static create(e){const t=e._setTrackedRange(null,new N(1,1,1,1),Oe.NeverGrowsWhenTypingAtEdges);return new uc(e,1,!1,t,0)}get viewLineNumber(){return this._viewLineNumber}get isValid(){return this._isValid}get modelTrackedRange(){return this._modelTrackedRange}get startLineDelta(){return this._startLineDelta}constructor(e,t,i,n,s){this._model=e,this._viewLineNumber=t,this._isValid=i,this._modelTrackedRange=n,this._startLineDelta=s}dispose(){this._model._setTrackedRange(this._modelTrackedRange,null,Oe.NeverGrowsWhenTypingAtEdges)}update(e,t){const i=e.coordinatesConverter.convertViewPositionToModelPosition(new I(t,e.getLineMinColumn(t))),n=e.model._setTrackedRange(this._modelTrackedRange,new N(i.lineNumber,i.column,i.lineNumber,i.column),Oe.NeverGrowsWhenTypingAtEdges),s=e.viewLayout.getVerticalOffsetForLineNumber(t),o=e.viewLayout.getCurrentScrollTop();this._viewLineNumber=t,this._isValid=!0,this._modelTrackedRange=n,this._startLineDelta=o-s}invalidate(){this._isValid=!1}}class LS{constructor(){this._asMap=Object.create(null),this.asArray=[]}accept(e,t,i,n,s){const o=this._asMap[e];if(o){const r=o.data,l=r[r.length-3],d=r[r.length-1];if(l===s&&d+1>=i){n>d&&(r[r.length-1]=n);return}r.push(s,i,n)}else{const r=new ko(e,t,[s,i,n]);this._asMap[e]=r,this.asArray.push(r)}}}class vS{constructor(){this.hiddenAreas=new Map,this.shouldRecompute=!1,this.ranges=[]}setHiddenAreas(e,t){const i=this.hiddenAreas.get(e);i&&kh(i,t)||(this.hiddenAreas.set(e,t),this.shouldRecompute=!0)}getMergedRanges(){if(!this.shouldRecompute)return this.ranges;this.shouldRecompute=!1;const e=Array.from(this.hiddenAreas.values()).reduce((t,i)=>bS(t,i),[]);return kh(this.ranges,e)?this.ranges:(this.ranges=e,this.ranges)}}function bS(a,e){const t=[];let i=0,n=0;for(;i<a.length&&n<e.length;){const s=a[i],o=e[n];if(s.endLineNumber<o.startLineNumber-1)t.push(a[i++]);else if(o.endLineNumber<s.startLineNumber-1)t.push(e[n++]);else{const r=Math.min(s.startLineNumber,o.startLineNumber),l=Math.max(s.endLineNumber,o.endLineNumber);t.push(new N(r,1,l,1)),i++,n++}}for(;i<a.length;)t.push(a[i++]);for(;n<e.length;)t.push(e[n++]);return t}function kh(a,e){if(a.length!==e.length)return!1;for(let t=0;t<a.length;t++)if(!a[t].equalsRange(e[t]))return!1;return!0}class Wh{constructor(e,t){this.viewportStartModelPosition=e,this.startLineDelta=t}recoverViewportStart(e,t){if(!this.viewportStartModelPosition)return;const i=e.convertModelPositionToViewPosition(this.viewportStartModelPosition),n=t.getVerticalOffsetForLineNumber(i.lineNumber);t.setScrollPosition({scrollTop:n+this.startLineDelta},K.Immediate)}}var yn;Ee(ew);let ca=class extends U{static{yn=this}static{this.dropIntoEditorDecorationOptions=Pe.register({description:"workbench-dnd-target",className:"dnd-target"})}get isSimpleWidget(){return this._configuration.isSimpleWidget}get contextMenuId(){return this._configuration.contextMenuId}get contextKeyService(){return this._contextKeyService}constructor(e,t,i,n,s,o,r,l,d,c,h,u){super(),this.languageConfigurationService=h,this._deliveryQueue=Lp(),this._contributions=this._register(new Ob),this._onDidDispose=this._register(new Z),this.onDidDispose=this._onDidDispose.event,this._onDidChangeModelContent=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelContent=this._onDidChangeModelContent.event,this._onDidChangeModelLanguage=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguage=this._onDidChangeModelLanguage.event,this._onDidChangeModelLanguageConfiguration=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelLanguageConfiguration=this._onDidChangeModelLanguageConfiguration.event,this._onDidChangeModelOptions=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelOptions=this._onDidChangeModelOptions.event,this._onDidChangeModelDecorations=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelDecorations=this._onDidChangeModelDecorations.event,this._onDidChangeLineHeight=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeLineHeight=this._onDidChangeLineHeight.event,this._onDidChangeModelTokens=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeModelTokens=this._onDidChangeModelTokens.event,this._onDidChangeConfiguration=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeModel=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onWillChangeModel=this._onWillChangeModel.event,this._onDidChangeModel=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeModel=this._onDidChangeModel.event,this._onDidChangeCursorPosition=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorPosition=this._onDidChangeCursorPosition.event,this._onDidChangeCursorSelection=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeCursorSelection=this._onDidChangeCursorSelection.event,this._onDidAttemptReadOnlyEdit=this._register(new dt(this._contributions,this._deliveryQueue)),this.onDidAttemptReadOnlyEdit=this._onDidAttemptReadOnlyEdit.event,this._onDidLayoutChange=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidLayoutChange=this._onDidLayoutChange.event,this._editorTextFocus=this._register(new Vh({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorText=this._editorTextFocus.onDidChangeToTrue,this.onDidBlurEditorText=this._editorTextFocus.onDidChangeToFalse,this._editorWidgetFocus=this._register(new Vh({deliveryQueue:this._deliveryQueue})),this.onDidFocusEditorWidget=this._editorWidgetFocus.onDidChangeToTrue,this.onDidBlurEditorWidget=this._editorWidgetFocus.onDidChangeToFalse,this._onWillType=this._register(new dt(this._contributions,this._deliveryQueue)),this.onWillType=this._onWillType.event,this._onDidType=this._register(new dt(this._contributions,this._deliveryQueue)),this.onDidType=this._onDidType.event,this._onDidCompositionStart=this._register(new dt(this._contributions,this._deliveryQueue)),this.onDidCompositionStart=this._onDidCompositionStart.event,this._onDidCompositionEnd=this._register(new dt(this._contributions,this._deliveryQueue)),this.onDidCompositionEnd=this._onDidCompositionEnd.event,this._onDidPaste=this._register(new dt(this._contributions,this._deliveryQueue)),this.onDidPaste=this._onDidPaste.event,this._onMouseUp=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseUp=this._onMouseUp.event,this._onMouseDown=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseDown=this._onMouseDown.event,this._onMouseDrag=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseDrag=this._onMouseDrag.event,this._onMouseDrop=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseDrop=this._onMouseDrop.event,this._onMouseDropCanceled=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseDropCanceled=this._onMouseDropCanceled.event,this._onDropIntoEditor=this._register(new dt(this._contributions,this._deliveryQueue)),this.onDropIntoEditor=this._onDropIntoEditor.event,this._onContextMenu=this._register(new dt(this._contributions,this._deliveryQueue)),this.onContextMenu=this._onContextMenu.event,this._onMouseMove=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseMove=this._onMouseMove.event,this._onMouseLeave=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseLeave=this._onMouseLeave.event,this._onMouseWheel=this._register(new dt(this._contributions,this._deliveryQueue)),this.onMouseWheel=this._onMouseWheel.event,this._onKeyUp=this._register(new dt(this._contributions,this._deliveryQueue)),this.onKeyUp=this._onKeyUp.event,this._onKeyDown=this._register(new dt(this._contributions,this._deliveryQueue)),this.onKeyDown=this._onKeyDown.event,this._onDidContentSizeChange=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidContentSizeChange=this._onDidContentSizeChange.event,this._onDidScrollChange=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidScrollChange=this._onDidScrollChange.event,this._onDidChangeViewZones=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeViewZones=this._onDidChangeViewZones.event,this._onDidChangeHiddenAreas=this._register(new Z({deliveryQueue:this._deliveryQueue})),this.onDidChangeHiddenAreas=this._onDidChangeHiddenAreas.event,this._updateCounter=0,this._onWillTriggerEditorOperationEvent=this._register(new Z),this.onWillTriggerEditorOperationEvent=this._onWillTriggerEditorOperationEvent.event,this._onBeginUpdate=this._register(new Z),this.onBeginUpdate=this._onBeginUpdate.event,this._onEndUpdate=this._register(new Z),this.onEndUpdate=this._onEndUpdate.event,this._onBeforeExecuteEdit=this._register(new Z),this.onBeforeExecuteEdit=this._onBeforeExecuteEdit.event,this._actions=new Map,this._bannerDomNode=null,this._dropIntoEditorDecorations=this.createDecorationsCollection(),this.inComposition=!1,s.willCreateCodeEditor();const g={...t};if(this._domElement=e,this._overflowWidgetsDomNode=g.overflowWidgetsDomNode,delete g.overflowWidgetsDomNode,this._id=++SS,this._decorationTypeKeysToIds={},this._decorationTypeSubtypes={},this._telemetryData=i.telemetryData,this._configuration=this._register(this._createConfiguration(i.isSimpleWidget||!1,i.contextMenuId??(i.isSimpleWidget?an.SimpleEditorContext:an.EditorContext),i.isStandaloneEditor||!1,g,c)),this._register(this._configuration.onDidChange(_=>{this._onDidChangeConfiguration.fire(_);const L=this._configuration.options;if(_.hasChanged(v.layoutInfo)){const w=L.get(v.layoutInfo);this._onDidLayoutChange.fire(w)}})),this._contextKeyService=this._register(r.createScoped(this._domElement)),i.contextKeyValues)for(const[_,L]of Object.entries(i.contextKeyValues))this._contextKeyService.createKey(_,L);this._notificationService=d,this._codeEditorService=s,this._commandService=o,this._themeService=l,this._register(new xS(this,this._contextKeyService)),this._register(new NS(this,this._contextKeyService,u)),this._instantiationService=this._register(n.createChild(new $s([ot,this._contextKeyService]))),this._modelData=null,this._contentWidgets={},this._overlayWidgets={},this._glyphMarginWidgets={};let f;Array.isArray(i.contributions)?f=i.contributions:f=Tr.getEditorContributions(),this._contributions.initialize(this,f,this._instantiationService);for(const _ of Tr.getEditorActions()){if(this._actions.has(_.id)){vt(new Error(`Cannot have two actions with the same id ${_.id}`));continue}const L=new Gg(_.id,_.label,_.alias,_.metadata,_.precondition??void 0,w=>this._instantiationService.invokeFunction(p=>Promise.resolve(_.runEditorCommand(p,this,w))),this._contextKeyService);this._actions.set(L.id,L)}const m=()=>!this._configuration.options.get(v.readOnly)&&this._configuration.options.get(v.dropIntoEditor).enabled;this._register(new vp(this._domElement,{onDragOver:_=>{if(!m())return;const L=this.getTargetAtClientPoint(_.clientX,_.clientY);L?.position&&this.showDropIndicatorAt(L.position)},onDrop:async _=>{if(!m()||(this.removeDropIndicator(),!_.dataTransfer))return;const L=this.getTargetAtClientPoint(_.clientX,_.clientY);L?.position&&this._onDropIntoEditor.fire({position:L.position,event:_})},onDragLeave:()=>{this.removeDropIndicator()},onDragEnd:()=>{this.removeDropIndicator()}})),this._codeEditorService.addCodeEditor(this)}writeScreenReaderContent(e){this._modelData?.view.writeScreenReaderContent(e)}_createConfiguration(e,t,i,n,s){return new Hl(e,t,i,n,this._domElement,s)}getId(){return this.getEditorType()+":"+this._id}getEditorType(){return kd.ICodeEditor}dispose(){this._codeEditorService.removeCodeEditor(this),this._actions.clear(),this._contentWidgets={},this._overlayWidgets={},this._removeDecorationTypes(),this._postDetachModelCleanup(this._detachModel()),this._onDidDispose.fire(),super.dispose()}invokeWithinContext(e){return this._instantiationService.invokeFunction(e)}updateOptions(e){this._configuration.updateOptions(e||{})}getOptions(){return this._configuration.options}getOption(e){return this._configuration.options.get(e)}getRawOptions(){return this._configuration.getRawOptions()}getOverflowWidgetsDomNode(){return this._overflowWidgetsDomNode}getConfiguredWordAtPosition(e){return this._modelData?me.getWordAtPosition(this._modelData.model,this._configuration.options.get(v.wordSeparators),this._configuration.options.get(v.wordSegmenterLocales),e):null}getValue(e=null){if(!this._modelData)return"";const t=!!(e&&e.preserveBOM);let i=Ct.TextDefined;return e&&e.lineEnding&&e.lineEnding===`
`?i=Ct.LF:e&&e.lineEnding&&e.lineEnding===`\r
`&&(i=Ct.CRLF),this._modelData.model.getValue(i,t)}setValue(e){try{if(this._beginUpdate(),!this._modelData)return;this._modelData.model.setValue(e)}finally{this._endUpdate()}}getModel(){return this._modelData?this._modelData.model:null}setModel(e=null){try{this._beginUpdate();const t=e;if(this._modelData===null&&t===null||this._modelData&&this._modelData.model===t)return;const i={oldModelUrl:this._modelData?.model.uri||null,newModelUrl:t?.uri||null};this._onWillChangeModel.fire(i);const n=this.hasTextFocus(),s=this._detachModel();this._attachModel(t),this.hasModel()?n&&this.focus():(this._editorTextFocus.setValue(!1),this._editorWidgetFocus.setValue(!1)),this._removeDecorationTypes(),this._onDidChangeModel.fire(i),this._postDetachModelCleanup(s),this._contributionsDisposable=this._contributions.onAfterModelAttached()}finally{this._endUpdate()}}_removeDecorationTypes(){if(this._decorationTypeKeysToIds={},this._decorationTypeSubtypes){for(const e in this._decorationTypeSubtypes){const t=this._decorationTypeSubtypes[e];for(const i in t)this._removeDecorationType(e+"-"+i)}this._decorationTypeSubtypes={}}}getVisibleRanges(){return this._modelData?this._modelData.viewModel.getVisibleRanges():[]}getVisibleRangesPlusViewportAboveBelow(){return this._modelData?this._modelData.viewModel.getVisibleRangesPlusViewportAboveBelow():[]}getWhitespaces(){return this._modelData?this._modelData.viewModel.viewLayout.getWhitespaces():[]}static _getVerticalOffsetAfterPosition(e,t,i,n){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetAfterLineNumber(o.lineNumber,n)}getTopForLineNumber(e,t=!1){return this._modelData?yn._getVerticalOffsetForPosition(this._modelData,e,1,t):-1}getTopForPosition(e,t){return this._modelData?yn._getVerticalOffsetForPosition(this._modelData,e,t,!1):-1}static _getVerticalOffsetForPosition(e,t,i,n=!1){const s=e.model.validatePosition({lineNumber:t,column:i}),o=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(s);return e.viewModel.viewLayout.getVerticalOffsetForLineNumber(o.lineNumber,n)}getBottomForLineNumber(e,t=!1){if(!this._modelData)return-1;const i=this._modelData.model.getLineMaxColumn(e);return yn._getVerticalOffsetAfterPosition(this._modelData,e,i,t)}getLineHeightForLineNumber(e){if(!this._modelData)return-1;const t=this._modelData.viewModel.coordinatesConverter.convertModelPositionToViewPosition(new I(e,1));return this._modelData.viewModel.viewLayout.getLineHeightForLineNumber(t.lineNumber)}setHiddenAreas(e,t,i){this._modelData?.viewModel.setHiddenAreas(e.map(n=>N.lift(n)),t,i)}getVisibleColumnFromPosition(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),i=this._modelData.model.getOptions().tabSize;return We.visibleColumnFromColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,i)+1}getStatusbarColumn(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),i=this._modelData.model.getOptions().tabSize;return We.toStatusbarColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,i)}getPosition(){return this._modelData?this._modelData.viewModel.getPosition():null}setPosition(e,t="api"){if(this._modelData){if(!I.isIPosition(e))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,[{selectionStartLineNumber:e.lineNumber,selectionStartColumn:e.column,positionLineNumber:e.lineNumber,positionColumn:e.column}])}}_sendRevealRange(e,t,i,n){if(!this._modelData)return;if(!N.isIRange(e))throw new Error("Invalid arguments");const s=this._modelData.model.validateRange(e),o=this._modelData.viewModel.coordinatesConverter.convertModelRangeToViewRange(s);this._modelData.viewModel.revealRange("api",i,o,t,n)}revealLine(e,t=K.Smooth){this._revealLine(e,de.Simple,t)}revealLineInCenter(e,t=K.Smooth){this._revealLine(e,de.Center,t)}revealLineInCenterIfOutsideViewport(e,t=K.Smooth){this._revealLine(e,de.CenterIfOutsideViewport,t)}revealLineNearTop(e,t=K.Smooth){this._revealLine(e,de.NearTop,t)}_revealLine(e,t,i){if(typeof e!="number")throw new Error("Invalid arguments");this._sendRevealRange(new N(e,1,e,1),t,!1,i)}revealPosition(e,t=K.Smooth){this._revealPosition(e,de.Simple,!0,t)}revealPositionInCenter(e,t=K.Smooth){this._revealPosition(e,de.Center,!0,t)}revealPositionInCenterIfOutsideViewport(e,t=K.Smooth){this._revealPosition(e,de.CenterIfOutsideViewport,!0,t)}revealPositionNearTop(e,t=K.Smooth){this._revealPosition(e,de.NearTop,!0,t)}_revealPosition(e,t,i,n){if(!I.isIPosition(e))throw new Error("Invalid arguments");this._sendRevealRange(new N(e.lineNumber,e.column,e.lineNumber,e.column),t,i,n)}getSelection(){return this._modelData?this._modelData.viewModel.getSelection():null}getSelections(){return this._modelData?this._modelData.viewModel.getSelections():null}setSelection(e,t="api"){const i=le.isISelection(e),n=N.isIRange(e);if(!i&&!n)throw new Error("Invalid arguments");if(i)this._setSelectionImpl(e,t);else if(n){const s={selectionStartLineNumber:e.startLineNumber,selectionStartColumn:e.startColumn,positionLineNumber:e.endLineNumber,positionColumn:e.endColumn};this._setSelectionImpl(s,t)}}_setSelectionImpl(e,t){if(!this._modelData)return;const i=new le(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn);this._modelData.viewModel.setSelections(t,[i])}revealLines(e,t,i=K.Smooth){this._revealLines(e,t,de.Simple,i)}revealLinesInCenter(e,t,i=K.Smooth){this._revealLines(e,t,de.Center,i)}revealLinesInCenterIfOutsideViewport(e,t,i=K.Smooth){this._revealLines(e,t,de.CenterIfOutsideViewport,i)}revealLinesNearTop(e,t,i=K.Smooth){this._revealLines(e,t,de.NearTop,i)}_revealLines(e,t,i,n){if(typeof e!="number"||typeof t!="number")throw new Error("Invalid arguments");this._sendRevealRange(new N(e,1,t,1),i,!1,n)}revealRange(e,t=K.Smooth,i=!1,n=!0){this._revealRange(e,i?de.Center:de.Simple,n,t)}revealRangeInCenter(e,t=K.Smooth){this._revealRange(e,de.Center,!0,t)}revealRangeInCenterIfOutsideViewport(e,t=K.Smooth){this._revealRange(e,de.CenterIfOutsideViewport,!0,t)}revealRangeNearTop(e,t=K.Smooth){this._revealRange(e,de.NearTop,!0,t)}revealRangeNearTopIfOutsideViewport(e,t=K.Smooth){this._revealRange(e,de.NearTopIfOutsideViewport,!0,t)}revealRangeAtTop(e,t=K.Smooth){this._revealRange(e,de.Top,!0,t)}_revealRange(e,t,i,n){if(!N.isIRange(e))throw new Error("Invalid arguments");this._sendRevealRange(N.lift(e),t,i,n)}setSelections(e,t="api",i=he.NotSet){if(this._modelData){if(!e||e.length===0)throw new Error("Invalid arguments");for(let n=0,s=e.length;n<s;n++)if(!le.isISelection(e[n]))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,e,i)}}getContentWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getContentWidth():-1}getScrollWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollWidth():-1}getScrollLeft(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollLeft():-1}getContentHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getContentHeight():-1}getScrollHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollHeight():-1}getScrollTop(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollTop():-1}setScrollLeft(e,t=K.Immediate){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollLeft:e},t)}}setScrollTop(e,t=K.Immediate){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollTop:e},t)}}setScrollPosition(e,t=K.Immediate){this._modelData&&this._modelData.viewModel.viewLayout.setScrollPosition(e,t)}hasPendingScrollAnimation(){return this._modelData?this._modelData.viewModel.viewLayout.hasPendingScrollAnimation():!1}saveViewState(){if(!this._modelData)return null;const e=this._contributions.saveViewState(),t=this._modelData.viewModel.saveCursorState(),i=this._modelData.viewModel.saveState();return{cursorState:t,viewState:i,contributionsState:e}}restoreViewState(e){if(!this._modelData||!this._modelData.hasRealView)return;const t=e;if(t&&t.cursorState&&t.viewState){const i=t.cursorState;Array.isArray(i)?i.length>0&&this._modelData.viewModel.restoreCursorState(i):this._modelData.viewModel.restoreCursorState([i]),this._contributions.restoreViewState(t.contributionsState||{});const n=this._modelData.viewModel.reduceRestoreState(t.viewState);this._modelData.view.restoreState(n)}}handleInitialized(){this._getViewModel()?.visibleLinesStabilized()}onVisible(){this._modelData?.view.refreshFocusState()}onHide(){this._modelData?.view.refreshFocusState()}getContribution(e){return this._contributions.get(e)}getActions(){return Array.from(this._actions.values())}getSupportedActions(){let e=this.getActions();return e=e.filter(t=>t.isSupported()),e}getAction(e){return this._actions.get(e)||null}trigger(e,t,i){i=i||{};try{switch(this._onWillTriggerEditorOperationEvent.fire({source:e,handlerId:t,payload:i}),this._beginUpdate(),t){case qe.CompositionStart:this._startComposition();return;case qe.CompositionEnd:this._endComposition(e);return;case qe.Type:{const s=i;this._type(e,s.text||"");return}case qe.ReplacePreviousChar:{const s=i;this._compositionType(e,s.text||"",s.replaceCharCnt||0,0,0);return}case qe.CompositionType:{const s=i;this._compositionType(e,s.text||"",s.replacePrevCharCnt||0,s.replaceNextCharCnt||0,s.positionDelta||0);return}case qe.Paste:{const s=i;this._paste(e,s.text||"",s.pasteOnNewLine||!1,s.multicursorText||null,s.mode||null,s.clipboardEvent);return}case qe.Cut:this._cut(e);return}const n=this.getAction(t);if(n){Promise.resolve(n.run(i)).then(void 0,vt);return}if(!this._modelData||this._triggerEditorCommand(e,t,i))return;this._triggerCommand(t,i)}finally{this._endUpdate()}}_triggerCommand(e,t){this._commandService.executeCommand(e,t)}_startComposition(){this._modelData&&(this.inComposition=!0,this._modelData.viewModel.startComposition(),this._onDidCompositionStart.fire())}_endComposition(e){this._modelData&&(this.inComposition=!1,this._modelData.viewModel.endComposition(e),this._onDidCompositionEnd.fire())}_type(e,t){!this._modelData||t.length===0||(e==="keyboard"&&this._onWillType.fire(t),this._modelData.viewModel.type(t,e),e==="keyboard"&&this._onDidType.fire(t))}_compositionType(e,t,i,n,s){this._modelData&&this._modelData.viewModel.compositionType(t,i,n,s,e)}_paste(e,t,i,n,s,o){if(!this._modelData)return;const r=this._modelData.viewModel,l=r.getSelection().getStartPosition();r.paste(t,i,n,e);const d=r.getSelection().getStartPosition();e==="keyboard"&&this._onDidPaste.fire({clipboardEvent:o,range:new N(l.lineNumber,l.column,d.lineNumber,d.column),languageId:s})}_cut(e){this._modelData&&this._modelData.viewModel.cut(e)}_triggerEditorCommand(e,t,i){const n=Tr.getEditorCommand(t);return n?(i=i||{},i.source=e,this._instantiationService.invokeFunction(s=>{Promise.resolve(n.runEditorCommand(s,this,i)).then(void 0,vt)}),!0):!1}_getViewModel(){return this._modelData?this._modelData.viewModel:null}pushUndoStop(){return!this._modelData||this._configuration.options.get(v.readOnly)?!1:(this._modelData.model.pushStackElement(),!0)}popUndoStop(){return!this._modelData||this._configuration.options.get(v.readOnly)?!1:(this._modelData.model.popStackElement(),!0)}executeEdits(e,t,i){if(!this._modelData||this._configuration.options.get(v.readOnly))return!1;let n;return i?Array.isArray(i)?n=()=>i:n=i:n=()=>null,this._onBeforeExecuteEdit.fire({source:e??void 0}),this._modelData.viewModel.executeEdits(e,t,n),!0}executeCommand(e,t){this._modelData&&this._modelData.viewModel.executeCommand(t,e)}executeCommands(e,t){this._modelData&&this._modelData.viewModel.executeCommands(t,e)}createDecorationsCollection(e){return new ES(this,e)}changeDecorations(e){return this._modelData?this._modelData.model.changeDecorations(e,this._id):null}getLineDecorations(e){return this._modelData?this._modelData.model.getLineDecorations(e,this._id,jr(this._configuration.options)):null}getDecorationsInRange(e){return this._modelData?this._modelData.model.getDecorationsInRange(e,this._id,jr(this._configuration.options)):null}deltaDecorations(e,t){return this._modelData?e.length===0&&t.length===0?e:this._modelData.model.deltaDecorations(e,t,this._id):[]}removeDecorations(e){!this._modelData||e.length===0||this._modelData.model.changeDecorations(t=>{t.deltaDecorations(e,[])})}setDecorationsByType(e,t,i){const n={},s=this._decorationTypeSubtypes[t]||{};this._decorationTypeSubtypes[t]=n;const o=[];for(const l of i){let d=t;if(l.renderOptions){const h=Fu(l.renderOptions).toString(16);d=t+"-"+h,!s[h]&&!n[h]&&this._registerDecorationType(e,d,l.renderOptions,t),n[h]=!0}const c=this._resolveDecorationOptions(d,!!l.hoverMessage);l.hoverMessage&&(c.hoverMessage=l.hoverMessage),o.push({range:l.range,options:c})}for(const l in s)n[l]||this._removeDecorationType(t+"-"+l);const r=this._decorationTypeKeysToIds[t]||[];return this.changeDecorations(l=>this._decorationTypeKeysToIds[t]=l.deltaDecorations(r,o)),this._decorationTypeKeysToIds[t]||[]}setDecorationsByTypeFast(e,t){const i=this._decorationTypeSubtypes[e]||{};for(const r in i)this._removeDecorationType(e+"-"+r);this._decorationTypeSubtypes[e]={};const n=Pe.createDynamic(this._resolveDecorationOptions(e,!1)),s=new Array(t.length);for(let r=0,l=t.length;r<l;r++)s[r]={range:t[r],options:n};const o=this._decorationTypeKeysToIds[e]||[];this.changeDecorations(r=>this._decorationTypeKeysToIds[e]=r.deltaDecorations(o,s))}removeDecorationsByType(e){const t=this._decorationTypeKeysToIds[e];t&&this.changeDecorations(i=>i.deltaDecorations(t,[])),this._decorationTypeKeysToIds.hasOwnProperty(e)&&delete this._decorationTypeKeysToIds[e],this._decorationTypeSubtypes.hasOwnProperty(e)&&delete this._decorationTypeSubtypes[e]}getLayoutInfo(){return this._configuration.options.get(v.layoutInfo)}createOverviewRuler(e){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.createOverviewRuler(e)}getContainerDomNode(){return this._domElement}getDomNode(){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.domNode.domNode}delegateVerticalScrollbarPointerDown(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateScrollFromMouseWheelEvent(e)}layout(e,t=!1){this._configuration.observeContainer(e),t||this.render()}focus(){!this._modelData||!this._modelData.hasRealView||this._modelData.view.focus()}hasTextFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isFocused()}hasWidgetFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isWidgetFocused()}addContentWidget(e){const t={widget:e,position:e.getPosition()};this._contentWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a content widget with the same id:"+e.getId()),this._contentWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addContentWidget(t)}layoutContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutContentWidget(i)}}removeContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const i=this._contentWidgets[t];delete this._contentWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeContentWidget(i)}}addOverlayWidget(e){const t={widget:e,position:e.getPosition()};this._overlayWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting an overlay widget with the same id."),this._overlayWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addOverlayWidget(t)}layoutOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutOverlayWidget(i)}}removeOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const i=this._overlayWidgets[t];delete this._overlayWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeOverlayWidget(i)}}addGlyphMarginWidget(e){const t={widget:e,position:e.getPosition()};this._glyphMarginWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a glyph margin widget with the same id."),this._glyphMarginWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addGlyphMarginWidget(t)}layoutGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];i.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutGlyphMarginWidget(i)}}removeGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const i=this._glyphMarginWidgets[t];delete this._glyphMarginWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeGlyphMarginWidget(i)}}changeViewZones(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.change(e)}getTargetAtClientPoint(e,t){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.getTargetAtClientPoint(e,t)}getScrolledVisiblePosition(e){if(!this._modelData||!this._modelData.hasRealView)return null;const t=this._modelData.model.validatePosition(e),n=this._configuration.options.get(v.layoutInfo),s=yn._getVerticalOffsetForPosition(this._modelData,t.lineNumber,t.column)-this.getScrollTop(),o=this._modelData.view.getOffsetForColumn(t.lineNumber,t.column)+n.glyphMarginWidth+n.lineNumbersWidth+n.decorationsWidth-this.getScrollLeft(),r=this.getLineHeightForLineNumber(t.lineNumber);return{top:s,left:o,height:r}}getOffsetForColumn(e,t){return!this._modelData||!this._modelData.hasRealView?-1:this._modelData.view.getOffsetForColumn(e,t)}render(e=!1){!this._modelData||!this._modelData.hasRealView||this._modelData.viewModel.batchEvents(()=>{this._modelData.view.render(!0,e)})}setAriaOptions(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.setAriaOptions(e)}applyFontInfo(e){st(e,this._configuration.options.get(v.fontInfo))}setBanner(e,t){this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),this._bannerDomNode=e,this._configuration.setReservedHeight(e?t:0),this._bannerDomNode&&this._domElement.prepend(this._bannerDomNode)}_attachModel(e){if(!e){this._modelData=null;return}const t=[];this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._configuration.setIsDominatedByLongLines(e.isDominatedByLongLines()),this._configuration.setModelLineCount(e.getLineCount());const i=e.onBeforeAttached(),n=new wS(this._id,this._configuration,e,lc.create(Ne(this._domElement)),dc.create(this._configuration.options),r=>Io(Ne(this._domElement),r),this.languageConfigurationService,this._themeService,i,{batchChanges:r=>{try{return this._beginUpdate(),r()}finally{this._endUpdate()}}});t.push(e.onWillDispose(()=>this.setModel(null))),t.push(n.onEvent(r=>{switch(r.kind){case be.ContentSizeChanged:this._onDidContentSizeChange.fire(r);break;case be.FocusChanged:this._editorTextFocus.setValue(r.hasFocus);break;case be.WidgetFocusChanged:this._editorWidgetFocus.setValue(r.hasFocus);break;case be.ScrollChanged:this._onDidScrollChange.fire(r);break;case be.ViewZonesChanged:this._onDidChangeViewZones.fire();break;case be.HiddenAreasChanged:this._onDidChangeHiddenAreas.fire();break;case be.ReadOnlyEditAttempt:this._onDidAttemptReadOnlyEdit.fire();break;case be.CursorStateChanged:{if(r.reachedMaxCursorCount){const h=this.getOption(v.multiCursorLimit),u=O(147,"The number of cursors has been limited to {0}. Consider using [find and replace](https://code.visualstudio.com/docs/editor/codebasics#_find-and-replace) for larger changes or increase the editor multi cursor limit setting.",h);this._notificationService.prompt(Au.Warning,u,[{label:"Find and Replace",run:()=>{this._commandService.executeCommand("editor.action.startFindReplaceAction")}},{label:O(148,"Increase Multi Cursor Limit"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings2",{query:"editor.multiCursorLimit"})}}])}const l=[];for(let h=0,u=r.selections.length;h<u;h++)l[h]=r.selections[h].getPosition();const d={position:l[0],secondaryPositions:l.slice(1),reason:r.reason,source:r.source};this._onDidChangeCursorPosition.fire(d);const c={selection:r.selections[0],secondarySelections:r.selections.slice(1),modelVersionId:r.modelVersionId,oldSelections:r.oldSelections,oldModelVersionId:r.oldModelVersionId,source:r.source,reason:r.reason};this._onDidChangeCursorSelection.fire(c);break}case be.ModelDecorationsChanged:this._onDidChangeModelDecorations.fire(r.event);break;case be.ModelLanguageChanged:this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._onDidChangeModelLanguage.fire(r.event);break;case be.ModelLanguageConfigurationChanged:this._onDidChangeModelLanguageConfiguration.fire(r.event);break;case be.ModelContentChanged:this._onDidChangeModelContent.fire(r.event);break;case be.ModelOptionsChanged:this._onDidChangeModelOptions.fire(r.event);break;case be.ModelTokensChanged:this._onDidChangeModelTokens.fire(r.event);break;case be.ModelLineHeightChanged:this._onDidChangeLineHeight.fire(r.event);break}}));const[s,o]=this._createView(n);if(o){this._domElement.appendChild(s.domNode.domNode);let r=Object.keys(this._contentWidgets);for(let l=0,d=r.length;l<d;l++){const c=r[l];s.addContentWidget(this._contentWidgets[c])}r=Object.keys(this._overlayWidgets);for(let l=0,d=r.length;l<d;l++){const c=r[l];s.addOverlayWidget(this._overlayWidgets[c])}r=Object.keys(this._glyphMarginWidgets);for(let l=0,d=r.length;l<d;l++){const c=r[l];s.addGlyphMarginWidget(this._glyphMarginWidgets[c])}s.render(!1,!0),s.domNode.domNode.setAttribute("data-uri",e.uri.toString())}this._modelData=new yS(e,n,s,o,t,i)}_createView(e){let t;this.isSimpleWidget?t={paste:(s,o,r,l)=>{this._paste("keyboard",s,o,r,l)},type:s=>{this._type("keyboard",s)},compositionType:(s,o,r,l)=>{this._compositionType("keyboard",s,o,r,l)},startComposition:()=>{this._startComposition()},endComposition:()=>{this._endComposition("keyboard")},cut:()=>{this._cut("keyboard")}}:t={paste:(s,o,r,l)=>{const d={text:s,pasteOnNewLine:o,multicursorText:r,mode:l};this._commandService.executeCommand(qe.Paste,d)},type:s=>{const o={text:s};this._commandService.executeCommand(qe.Type,o)},compositionType:(s,o,r,l)=>{if(r||l){const d={text:s,replacePrevCharCnt:o,replaceNextCharCnt:r,positionDelta:l};this._commandService.executeCommand(qe.CompositionType,d)}else{const d={text:s,replaceCharCnt:o};this._commandService.executeCommand(qe.ReplacePreviousChar,d)}},startComposition:()=>{this._commandService.executeCommand(qe.CompositionStart,{})},endComposition:()=>{this._commandService.executeCommand(qe.CompositionEnd,{})},cut:()=>{this._commandService.executeCommand(qe.Cut,{})}};const i=new za(e.coordinatesConverter);return i.onKeyDown=s=>this._onKeyDown.fire(s),i.onKeyUp=s=>this._onKeyUp.fire(s),i.onContextMenu=s=>this._onContextMenu.fire(s),i.onMouseMove=s=>this._onMouseMove.fire(s),i.onMouseLeave=s=>this._onMouseLeave.fire(s),i.onMouseDown=s=>this._onMouseDown.fire(s),i.onMouseUp=s=>this._onMouseUp.fire(s),i.onMouseDrag=s=>this._onMouseDrag.fire(s),i.onMouseDrop=s=>this._onMouseDrop.fire(s),i.onMouseDropCanceled=s=>this._onMouseDropCanceled.fire(s),i.onMouseWheel=s=>this._onMouseWheel.fire(s),[new sd(this._domElement,this.getId(),t,this._configuration,this._themeService.getColorTheme(),e,i,this._overflowWidgetsDomNode,this._instantiationService),!0]}_postDetachModelCleanup(e){e?.removeAllDecorationsWithOwnerId(this._id)}_detachModel(){if(this._contributionsDisposable?.dispose(),this._contributionsDisposable=void 0,!this._modelData)return null;const e=this._modelData.model,t=this._modelData.hasRealView?this._modelData.view.domNode.domNode:null;return this._modelData.dispose(),this._modelData=null,this._domElement.removeAttribute("data-mode-id"),t&&this._domElement.contains(t)&&t.remove(),this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),e}_registerDecorationType(e,t,i,n){this._codeEditorService.registerDecorationType(e,t,i,n,this)}_removeDecorationType(e){this._codeEditorService.removeDecorationType(e)}_resolveDecorationOptions(e,t){return this._codeEditorService.resolveDecorationOptions(e,t)}getTelemetryData(){return this._telemetryData}hasModel(){return this._modelData!==null}showDropIndicatorAt(e){const t=[{range:new N(e.lineNumber,e.column,e.lineNumber,e.column),options:yn.dropIntoEditorDecorationOptions}];this._dropIntoEditorDecorations.set(t),this.revealPosition(e,K.Immediate)}removeDropIndicator(){this._dropIntoEditorDecorations.clear()}setContextValue(e,t){this._contextKeyService.createKey(e,t)}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&this._onBeginUpdate.fire()}_endUpdate(){this._updateCounter--,this._updateCounter===0&&this._onEndUpdate.fire()}};ca=yn=ge([P(3,Me),P(4,zt),P(5,Zs),P(6,ot),P(7,sr),P(8,is),P(9,ji),P(10,mn),P(11,Ce)],ca);let SS=0;class yS{constructor(e,t,i,n,s,o){this.model=e,this.viewModel=t,this.view=i,this.hasRealView=n,this.listenersToRemove=s,this.attachedView=o}dispose(){Po(this.listenersToRemove),this.model.onBeforeDetached(this.attachedView),this.hasRealView&&this.view.dispose(),this.viewModel.dispose()}}var On;(function(a){a[a.NotSet=0]="NotSet",a[a.False=1]="False",a[a.True=2]="True"})(On||(On={}));class Vh extends U{constructor(e){super(),this._emitterOptions=e,this._onDidChangeToTrue=this._register(new Z(this._emitterOptions)),this.onDidChangeToTrue=this._onDidChangeToTrue.event,this._onDidChangeToFalse=this._register(new Z(this._emitterOptions)),this.onDidChangeToFalse=this._onDidChangeToFalse.event,this._value=On.NotSet}setValue(e){const t=e?On.True:On.False;this._value!==t&&(this._value=t,this._value===On.True?this._onDidChangeToTrue.fire():this._value===On.False&&this._onDidChangeToFalse.fire())}}class dt extends Z{constructor(e,t){super({deliveryQueue:t}),this._contributions=e}fire(e){this._contributions.onBeforeInteractionEvent(),super.fire(e)}}class xS extends U{constructor(e,t){super(),this._editor=e,t.createKey("editorId",e.getId()),this._editorSimpleInput=k.editorSimpleInput.bindTo(t),this._editorFocus=k.focus.bindTo(t),this._textInputFocus=k.textInputFocus.bindTo(t),this._editorTextFocus=k.editorTextFocus.bindTo(t),this._tabMovesFocus=k.tabMovesFocus.bindTo(t),this._editorReadonly=k.readOnly.bindTo(t),this._inDiffEditor=k.inDiffEditor.bindTo(t),this._editorColumnSelection=k.columnSelection.bindTo(t),this._hasMultipleSelections=k.hasMultipleSelections.bindTo(t),this._hasNonEmptySelection=k.hasNonEmptySelection.bindTo(t),this._canUndo=k.canUndo.bindTo(t),this._canRedo=k.canRedo.bindTo(t),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromConfig())),this._register(this._editor.onDidChangeCursorSelection(()=>this._updateFromSelection())),this._register(this._editor.onDidFocusEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidFocusEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidChangeModel(()=>this._updateFromModel())),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromModel())),this._register(Qr.onDidChangeTabFocus(i=>this._tabMovesFocus.set(i))),this._updateFromConfig(),this._updateFromSelection(),this._updateFromFocus(),this._updateFromModel(),this._editorSimpleInput.set(this._editor.isSimpleWidget)}_updateFromConfig(){const e=this._editor.getOptions();this._tabMovesFocus.set(Qr.getTabFocusMode()),this._editorReadonly.set(e.get(v.readOnly)),this._inDiffEditor.set(e.get(v.inDiffEditor)),this._editorColumnSelection.set(e.get(v.columnSelection))}_updateFromSelection(){const e=this._editor.getSelections();e?(this._hasMultipleSelections.set(e.length>1),this._hasNonEmptySelection.set(e.some(t=>!t.isEmpty()))):(this._hasMultipleSelections.reset(),this._hasNonEmptySelection.reset())}_updateFromFocus(){this._editorFocus.set(this._editor.hasWidgetFocus()&&!this._editor.isSimpleWidget),this._editorTextFocus.set(this._editor.hasTextFocus()&&!this._editor.isSimpleWidget),this._textInputFocus.set(this._editor.hasTextFocus())}_updateFromModel(){const e=this._editor.getModel();this._canUndo.set(!!(e&&e.canUndo())),this._canRedo.set(!!(e&&e.canRedo()))}}class NS extends U{constructor(e,t,i){super(),this._editor=e,this._contextKeyService=t,this._languageFeaturesService=i,this._langId=k.languageId.bindTo(t),this._hasCompletionItemProvider=k.hasCompletionItemProvider.bindTo(t),this._hasCodeActionsProvider=k.hasCodeActionsProvider.bindTo(t),this._hasCodeLensProvider=k.hasCodeLensProvider.bindTo(t),this._hasDefinitionProvider=k.hasDefinitionProvider.bindTo(t),this._hasDeclarationProvider=k.hasDeclarationProvider.bindTo(t),this._hasImplementationProvider=k.hasImplementationProvider.bindTo(t),this._hasTypeDefinitionProvider=k.hasTypeDefinitionProvider.bindTo(t),this._hasHoverProvider=k.hasHoverProvider.bindTo(t),this._hasDocumentHighlightProvider=k.hasDocumentHighlightProvider.bindTo(t),this._hasDocumentSymbolProvider=k.hasDocumentSymbolProvider.bindTo(t),this._hasReferenceProvider=k.hasReferenceProvider.bindTo(t),this._hasRenameProvider=k.hasRenameProvider.bindTo(t),this._hasSignatureHelpProvider=k.hasSignatureHelpProvider.bindTo(t),this._hasInlayHintsProvider=k.hasInlayHintsProvider.bindTo(t),this._hasDocumentFormattingProvider=k.hasDocumentFormattingProvider.bindTo(t),this._hasDocumentSelectionFormattingProvider=k.hasDocumentSelectionFormattingProvider.bindTo(t),this._hasMultipleDocumentFormattingProvider=k.hasMultipleDocumentFormattingProvider.bindTo(t),this._hasMultipleDocumentSelectionFormattingProvider=k.hasMultipleDocumentSelectionFormattingProvider.bindTo(t),this._isInEmbeddedEditor=k.isInEmbeddedEditor.bindTo(t);const n=()=>this._update();this._register(e.onDidChangeModel(n)),this._register(e.onDidChangeModelLanguage(n)),this._register(i.completionProvider.onDidChange(n)),this._register(i.codeActionProvider.onDidChange(n)),this._register(i.codeLensProvider.onDidChange(n)),this._register(i.definitionProvider.onDidChange(n)),this._register(i.declarationProvider.onDidChange(n)),this._register(i.implementationProvider.onDidChange(n)),this._register(i.typeDefinitionProvider.onDidChange(n)),this._register(i.hoverProvider.onDidChange(n)),this._register(i.documentHighlightProvider.onDidChange(n)),this._register(i.documentSymbolProvider.onDidChange(n)),this._register(i.referenceProvider.onDidChange(n)),this._register(i.renameProvider.onDidChange(n)),this._register(i.documentFormattingEditProvider.onDidChange(n)),this._register(i.documentRangeFormattingEditProvider.onDidChange(n)),this._register(i.signatureHelpProvider.onDidChange(n)),this._register(i.inlayHintsProvider.onDidChange(n)),n()}dispose(){super.dispose()}reset(){this._contextKeyService.bufferChangeEvents(()=>{this._langId.reset(),this._hasCompletionItemProvider.reset(),this._hasCodeActionsProvider.reset(),this._hasCodeLensProvider.reset(),this._hasDefinitionProvider.reset(),this._hasDeclarationProvider.reset(),this._hasImplementationProvider.reset(),this._hasTypeDefinitionProvider.reset(),this._hasHoverProvider.reset(),this._hasDocumentHighlightProvider.reset(),this._hasDocumentSymbolProvider.reset(),this._hasReferenceProvider.reset(),this._hasRenameProvider.reset(),this._hasDocumentFormattingProvider.reset(),this._hasDocumentSelectionFormattingProvider.reset(),this._hasSignatureHelpProvider.reset(),this._isInEmbeddedEditor.reset()})}_update(){const e=this._editor.getModel();if(!e){this.reset();return}this._contextKeyService.bufferChangeEvents(()=>{this._langId.set(e.getLanguageId()),this._hasCompletionItemProvider.set(this._languageFeaturesService.completionProvider.has(e)),this._hasCodeActionsProvider.set(this._languageFeaturesService.codeActionProvider.has(e)),this._hasCodeLensProvider.set(this._languageFeaturesService.codeLensProvider.has(e)),this._hasDefinitionProvider.set(this._languageFeaturesService.definitionProvider.has(e)),this._hasDeclarationProvider.set(this._languageFeaturesService.declarationProvider.has(e)),this._hasImplementationProvider.set(this._languageFeaturesService.implementationProvider.has(e)),this._hasTypeDefinitionProvider.set(this._languageFeaturesService.typeDefinitionProvider.has(e)),this._hasHoverProvider.set(this._languageFeaturesService.hoverProvider.has(e)),this._hasDocumentHighlightProvider.set(this._languageFeaturesService.documentHighlightProvider.has(e)),this._hasDocumentSymbolProvider.set(this._languageFeaturesService.documentSymbolProvider.has(e)),this._hasReferenceProvider.set(this._languageFeaturesService.referenceProvider.has(e)),this._hasRenameProvider.set(this._languageFeaturesService.renameProvider.has(e)),this._hasSignatureHelpProvider.set(this._languageFeaturesService.signatureHelpProvider.has(e)),this._hasInlayHintsProvider.set(this._languageFeaturesService.inlayHintsProvider.has(e)),this._hasDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.has(e)||this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasMultipleDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.all(e).length+this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._hasMultipleDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._isInEmbeddedEditor.set(e.uri.scheme===Wc.walkThroughSnippet||e.uri.scheme===Wc.vscodeChatCodeBlock)})}}class ES{get length(){return this._decorationIds.length}constructor(e,t){this._editor=e,this._decorationIds=[],this._isChangingDecorations=!1,Array.isArray(t)&&t.length>0&&this.set(t)}onDidChange(e,t,i){return this._editor.onDidChangeModelDecorations(n=>{this._isChangingDecorations||e.call(t,n)},i)}getRange(e){return!this._editor.hasModel()||e>=this._decorationIds.length?null:this._editor.getModel().getDecorationRange(this._decorationIds[e])}getRanges(){if(!this._editor.hasModel())return[];const e=this._editor.getModel(),t=[];for(const i of this._decorationIds){const n=e.getDecorationRange(i);n&&t.push(n)}return t}has(e){return this._decorationIds.includes(e.id)}clear(){this._decorationIds.length!==0&&this.set([])}set(e){try{this._isChangingDecorations=!0,this._editor.changeDecorations(t=>{this._decorationIds=t.deltaDecorations(this._decorationIds,e)})}finally{this._isChangingDecorations=!1}return this._decorationIds}append(e){let t=[];try{this._isChangingDecorations=!0,this._editor.changeDecorations(i=>{t=i.deltaDecorations([],e),this._decorationIds=this._decorationIds.concat(t)})}finally{this._isChangingDecorations=!1}return t}}const IS=encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 3' enable-background='new 0 0 6 3' height='3' width='6'><g fill='"),RS=encodeURIComponent("'><polygon points='5.5,0 2.5,3 1.1,3 4.1,0'/><polygon points='4,0 6,2 6,0.6 5.4,0'/><polygon points='0,2 1,3 2.4,3 0,0.6'/></g></svg>");function us(a){return IS+encodeURIComponent(a.toString())+RS}const DS=encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" height="3" width="12"><g fill="'),TS=encodeURIComponent('"><circle cx="1" cy="1" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="9" cy="1" r="1"/></g></svg>');function Fh(a){return DS+encodeURIComponent(a.toString())+TS}Ks((a,e)=>{const t=a.getColor(bp);t&&(e.addRule(`.monaco-editor .${io.EditorErrorDecoration} { background: url("data:image/svg+xml,${us(t)}") repeat-x bottom left; }`),e.addRule(`:root { --monaco-editor-error-decoration: url("data:image/svg+xml,${us(t)}"); }`));const i=a.getColor(Sp);i&&(e.addRule(`.monaco-editor .${io.EditorWarningDecoration} { background: url("data:image/svg+xml,${us(i)}") repeat-x bottom left; }`),e.addRule(`:root { --monaco-editor-warning-decoration: url("data:image/svg+xml,${us(i)}"); }`));const n=a.getColor(yp);n&&(e.addRule(`.monaco-editor .${io.EditorInfoDecoration} { background: url("data:image/svg+xml,${us(n)}") repeat-x bottom left; }`),e.addRule(`:root { --monaco-editor-info-decoration: url("data:image/svg+xml,${us(n)}"); }`));const s=a.getColor(xp);s&&(e.addRule(`.monaco-editor .${io.EditorHintDecoration} { background: url("data:image/svg+xml,${Fh(s)}") no-repeat bottom left; }`),e.addRule(`:root { --monaco-editor-hint-decoration: url("data:image/svg+xml,${Fh(s)}"); }`));const o=a.getColor(Np);o&&(e.addRule(`.monaco-editor.showUnused .${io.EditorUnnecessaryInlineDecoration} { opacity: ${o.rgba.a}; }`),e.addRule(`:root { --monaco-editor-unnecessary-decoration-opacity: ${o.rgba.a}; }`))});class on{static equals(e,t){return e.x===t.x&&e.y===t.y}constructor(e,t){this.x=e,this.y=t}add(e){return new on(this.x+e.x,this.y+e.y)}deltaX(e){return new on(this.x+e,this.y)}deltaY(e){return new on(this.x,this.y+e)}toString(){return`(${this.x},${this.y})`}}function Hn(a){return Pn.get(a)}class Pn extends U{static{this._map=new Map}static get(e){let t=Pn._map.get(e);if(!t){t=new Pn(e),Pn._map.set(e,t);const i=e.onDidDispose(()=>{const n=Pn._map.get(e);n&&(Pn._map.delete(e),n.dispose(),i.dispose())})}return t}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&(this._currentTransaction=new Ep(()=>{}))}_endUpdate(){if(this._updateCounter--,this._updateCounter===0){const e=this._currentTransaction;this._currentTransaction=void 0,e.finish()}}constructor(e){super(),this.editor=e,this._updateCounter=0,this._currentTransaction=void 0,this._model=J(this,this.editor.getModel()),this.model=this._model,this.isReadonly=Re(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(v.readOnly)),this._versionId=el({owner:this,lazy:!0},this.editor.getModel()?.getVersionId()??null),this.versionId=this._versionId,this._selections=el({owner:this,equalsFn:fr(Vc(le.selectionsEqual)),lazy:!0},this.editor.getSelections()??null),this.selections=this._selections,this.positions=Mr({owner:this,equalsFn:fr(Vc(I.equals))},t=>this.selections.read(t)?.map(i=>i.getStartPosition())??null),this.isFocused=Re(this,t=>{const i=this.editor.onDidFocusEditorWidget(t),n=this.editor.onDidBlurEditorWidget(t);return{dispose(){i.dispose(),n.dispose()}}},()=>this.editor.hasWidgetFocus()),this.isTextFocused=Re(this,t=>{const i=this.editor.onDidFocusEditorText(t),n=this.editor.onDidBlurEditorText(t);return{dispose(){i.dispose(),n.dispose()}}},()=>this.editor.hasTextFocus()),this.inComposition=Re(this,t=>{const i=this.editor.onDidCompositionStart(()=>{t(void 0)}),n=this.editor.onDidCompositionEnd(()=>{t(void 0)});return{dispose(){i.dispose(),n.dispose()}}},()=>this.editor.inComposition),this.value=Wd(this,t=>(this.versionId.read(t),this.model.read(t)?.getValue()??""),(t,i)=>{const n=this.model.get();n!==null&&t!==n.getValue()&&n.setValue(t)}),this.valueIsEmpty=z(this,t=>(this.versionId.read(t),this.editor.getModel()?.getValueLength()===0)),this.cursorSelection=Mr({owner:this,equalsFn:fr(le.selectionsEqual)},t=>this.selections.read(t)?.[0]??null),this.cursorPosition=Mr({owner:this,equalsFn:I.equals},t=>this.selections.read(t)?.[0]?.getPosition()??null),this.cursorLineNumber=z(this,t=>this.cursorPosition.read(t)?.lineNumber??null),this.onDidType=Kr(this),this.onDidPaste=Kr(this),this.scrollTop=Re(this.editor.onDidScrollChange,()=>this.editor.getScrollTop()),this.scrollLeft=Re(this.editor.onDidScrollChange,()=>this.editor.getScrollLeft()),this.layoutInfo=Re(this.editor.onDidLayoutChange,()=>this.editor.getLayoutInfo()),this.layoutInfoContentLeft=this.layoutInfo.map(t=>t.contentLeft),this.layoutInfoDecorationsLeft=this.layoutInfo.map(t=>t.decorationsLeft),this.layoutInfoWidth=this.layoutInfo.map(t=>t.width),this.layoutInfoMinimap=this.layoutInfo.map(t=>t.minimap),this.layoutInfoVerticalScrollbarWidth=this.layoutInfo.map(t=>t.verticalScrollbarWidth),this.contentWidth=Re(this.editor.onDidContentSizeChange,()=>this.editor.getContentWidth()),this._widgetCounter=0,this.openedPeekWidgets=J(this,0),this._register(this.editor.onBeginUpdate(()=>this._beginUpdate())),this._register(this.editor.onEndUpdate(()=>this._endUpdate())),this._register(this.editor.onDidChangeModel(()=>{this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidType(t=>{this._beginUpdate();try{this._forceUpdate(),this.onDidType.trigger(this._currentTransaction,t)}finally{this._endUpdate()}})),this._register(this.editor.onDidPaste(t=>{this._beginUpdate();try{this._forceUpdate(),this.onDidPaste.trigger(this._currentTransaction,t)}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeModelContent(t=>{this._beginUpdate();try{this._versionId.set(this.editor.getModel()?.getVersionId()??null,this._currentTransaction,t),this._forceUpdate()}finally{this._endUpdate()}})),this._register(this.editor.onDidChangeCursorSelection(t=>{this._beginUpdate();try{this._selections.set(this.editor.getSelections(),this._currentTransaction,t),this._forceUpdate()}finally{this._endUpdate()}}))}forceUpdate(e){this._beginUpdate();try{return this._forceUpdate(),e?e(this._currentTransaction):void 0}finally{this._endUpdate()}}_forceUpdate(){this._beginUpdate();try{this._model.set(this.editor.getModel(),this._currentTransaction),this._versionId.set(this.editor.getModel()?.getVersionId()??null,this._currentTransaction,void 0),this._selections.set(this.editor.getSelections(),this._currentTransaction,void 0)}finally{this._endUpdate()}}getOption(e){return Re(this,t=>this.editor.onDidChangeConfiguration(i=>{i.hasChanged(e)&&t(void 0)}),()=>this.editor.getOption(e))}setDecorations(e){const t=new Ot,i=this.editor.createDecorationsCollection();return t.add(Vd({owner:this,debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const s=e.read(n);i.set(s)})),t.add({dispose:()=>{i.clear()}}),t}createOverlayWidget(e){const t="observableOverlayWidget"+this._widgetCounter++,i={getDomNode:()=>e.domNode,getPosition:()=>e.position.get(),getId:()=>t,allowEditorOverflow:e.allowEditorOverflow,getMinContentWidthInPx:()=>e.minContentWidthInPx.get()};this.editor.addOverlayWidget(i);const n=ce(s=>{e.position.read(s),e.minContentWidthInPx.read(s),this.editor.layoutOverlayWidget(i)});return ke(()=>{n.dispose(),this.editor.removeOverlayWidget(i)})}createContentWidget(e){const t="observableContentWidget"+this._widgetCounter++,i={getDomNode:()=>e.domNode,getPosition:()=>e.position.get(),getId:()=>t,allowEditorOverflow:e.allowEditorOverflow};this.editor.addContentWidget(i);const n=ce(s=>{e.position.read(s),this.editor.layoutContentWidget(i)});return ke(()=>{n.dispose(),this.editor.removeContentWidget(i)})}observeLineOffsetRange(e,t){const i=this.observePosition(e.map(s=>new I(s.startLineNumber,1)),t),n=this.observePosition(e.map(s=>new I(s.endLineNumberExclusive+1,1)),t);return z(s=>{i.read(s),n.read(s);const o=e.read(s),r=this.model.read(s)?.getLineCount(),l=(typeof r<"u"&&o.startLineNumber>r?this.editor.getBottomForLineNumber(r):this.editor.getTopForLineNumber(o.startLineNumber))-this.scrollTop.read(s),d=o.isEmpty?l:this.editor.getBottomForLineNumber(o.endLineNumberExclusive-1)-this.scrollTop.read(s);return new ii(l,d)})}observePosition(e,t){let i=e.get();const n=el({owner:this,debugName:()=>`topLeftOfPosition${i?.toString()}`,equalsFn:fr(on.equals)},new on(0,0)),s="observablePositionWidget"+this._widgetCounter++,o=document.createElement("div"),r={getDomNode:()=>o,getPosition:()=>i?{preference:[bn.EXACT],position:e.get()}:null,getId:()=>s,allowEditorOverflow:!1,afterRender:(l,d)=>{const c=this._model.get();c&&i&&i.lineNumber>c.getLineCount()?n.set(new on(0,this.editor.getBottomForLineNumber(c.getLineCount())-this.scrollTop.get()),void 0):n.set(d?new on(d.left,d.top):null,void 0)}};return this.editor.addContentWidget(r),t.add(ce(l=>{i=e.read(l),this.editor.layoutContentWidget(r)})),t.add(ke(()=>{this.editor.removeContentWidget(r)})),n}isTargetHovered(e,t){const i=J("isInjectedTextHovered",!1);return t.add(this.editor.onMouseMove(n=>{const s=e(n);i.set(s,void 0)})),t.add(this.editor.onMouseLeave(n=>{i.set(!1,void 0)})),i}}class Hs{static capture(e){if(e.getScrollTop()===0||e.hasPendingScrollAnimation())return new Hs(e.getScrollTop(),e.getContentHeight(),null,0,null);let t=null,i=0;const n=e.getVisibleRanges();if(n.length>0){t=n[0].getStartPosition();const s=e.getTopForPosition(t.lineNumber,t.column);i=e.getScrollTop()-s}return new Hs(e.getScrollTop(),e.getContentHeight(),t,i,e.getPosition())}constructor(e,t,i,n,s){this._initialScrollTop=e,this._initialContentHeight=t,this._visiblePosition=i,this._visiblePositionScrollDelta=n,this._cursorPosition=s}restore(e){if(!(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())&&this._visiblePosition){const t=e.getTopForPosition(this._visiblePosition.lineNumber,this._visiblePosition.column);e.setScrollTop(t+this._visiblePositionScrollDelta)}}restoreRelativeVerticalPositionOfCursor(e){if(this._initialContentHeight===e.getContentHeight()&&this._initialScrollTop===e.getScrollTop())return;const t=e.getPosition();if(!this._cursorPosition||!t)return;const i=e.getTopForLineNumber(t.lineNumber)-e.getTopForLineNumber(this._cursorPosition.lineNumber);e.setScrollTop(e.getScrollTop()+i,K.Immediate)}}const $g=new Hu("cancellableOperation",!1,O(1002,"Whether the editor runs a cancellable operation, e.g. like 'Peek References'"));class ZE{constructor(){this._tokens=new WeakMap}add(e,t){let i=this._tokens.get(e);i||(i=e.invokeWithinContext(s=>{const o=$g.bindTo(s.get(ot)),r=new Pd;return{key:o,tokens:r}}),this._tokens.set(e,i));let n;return i.key.set(!0),n=i.tokens.push(t),()=>{n&&(n(),i.key.set(!i.tokens.isEmpty()),n=void 0)}}cancel(e){const t=this._tokens.get(e);if(!t)return;const i=t.tokens.pop();i&&(i.cancel(),t.key.set(!t.tokens.isEmpty()))}}class MS extends Ta{constructor(e,t){super(t),this.editor=e,this._unregister=e.invokeWithinContext(i=>i.get(cg).add(e,this))}dispose(){this._unregister(),super.dispose()}}q(new class extends Ia{constructor(){super({id:"editor.cancelOperation",kbOpts:{weight:$e.EditorContrib,primary:T.Escape},precondition:$g})}runEditorCommand(a,e){a.get(cg).cancel(e)}});var Bt;(function(a){a[a.Value=1]="Value",a[a.Selection=2]="Selection",a[a.Position=4]="Position",a[a.Scroll=8]="Scroll"})(Bt||(Bt={}));class cd{constructor(e,t){if(this.flags=t,(this.flags&Bt.Value)!==0){const i=e.getModel();this.modelVersionId=i?Ip("{0}#{1}",i.uri.toString(),i.getVersionId()):null}else this.modelVersionId=null;(this.flags&Bt.Position)!==0?this.position=e.getPosition():this.position=null,(this.flags&Bt.Selection)!==0?this.selection=e.getSelection():this.selection=null,(this.flags&Bt.Scroll)!==0?(this.scrollLeft=e.getScrollLeft(),this.scrollTop=e.getScrollTop()):(this.scrollLeft=-1,this.scrollTop=-1)}_equals(e){if(!(e instanceof cd))return!1;const t=e;return!(this.modelVersionId!==t.modelVersionId||this.scrollLeft!==t.scrollLeft||this.scrollTop!==t.scrollTop||!this.position&&t.position||this.position&&!t.position||this.position&&t.position&&!this.position.equals(t.position)||!this.selection&&t.selection||this.selection&&!t.selection||this.selection&&t.selection&&!this.selection.equalsRange(t.selection))}validate(e){return this._equals(new cd(e,this.flags))}}class Zg extends MS{constructor(e,t,i,n){super(e,n),this._listener=new Ot,t&Bt.Position&&this._listener.add(e.onDidChangeCursorPosition(s=>{(!i||!N.containsPosition(i,s.position))&&this.cancel()})),t&Bt.Selection&&this._listener.add(e.onDidChangeCursorSelection(s=>{(!i||!N.containsRange(i,s.selection))&&this.cancel()})),t&Bt.Scroll&&this._listener.add(e.onDidScrollChange(s=>this.cancel())),t&Bt.Value&&(this._listener.add(e.onDidChangeModel(s=>this.cancel())),this._listener.add(e.onDidChangeModelContent(s=>this.cancel())))}dispose(){this._listener.dispose(),super.dispose()}}class qg extends Ta{constructor(e,t){super(t),this._listener=e.onDidChangeContent(()=>this.cancel())}dispose(){this._listener.dispose(),super.dispose()}}function qa(){return Fc&&!!Fc.VSCODE_DEV_DEBUG}function Xg(a){if(qa()){const e=AS();return e.add(a),{dispose(){e.delete(a)}}}else return{dispose(){}}}function AS(){Sr||(Sr=new Set);const a=globalThis;return a.$hotReload_applyNewExports||(a.$hotReload_applyNewExports=e=>{const t={config:{mode:void 0},...e},i=[];for(const n of Sr){const s=n(t);s&&i.push(s)}if(i.length>0)return n=>{let s=!1;for(const o of i)o(n)&&(s=!0);return s}}),Sr}let Sr;qa()&&Xg(({oldExports:a,newSrc:e,config:t})=>{if(t.mode==="patch-prototype")return i=>{for(const n in i){const s=i[n];if(console.log(`[hot-reload] Patching prototype methods of '${n}'`,{exportedItem:s}),typeof s=="function"&&s.prototype){const o=a[n];if(o){for(const r of Object.getOwnPropertyNames(s.prototype)){const l=Object.getOwnPropertyDescriptor(s.prototype,r),d=Object.getOwnPropertyDescriptor(o.prototype,r);l?.value?.toString()!==d?.value?.toString()&&console.log(`[hot-reload] Patching prototype method '${n}.${r}'`),Object.defineProperty(o.prototype,r,l)}i[n]=o}}}return!0}});function Qt(a,e){return OS([a],e),a}function OS(a,e){qa()&&qt("reload",i=>Xg(({oldExports:n})=>{if([...Object.values(n)].some(s=>a.includes(s)))return s=>(i(void 0),!0)})).read(e)}const Hh=new Map;function qE(a){if(!qa())return $r(a);const e=a.name;let t=Hh.get(e);return t?setTimeout(()=>{t.set(a,void 0)},0):(t=J(e,a),Hh.set(e,t)),t}const PS=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(PS);class kS extends U{constructor(e,t,i={orientation:Bu.HORIZONTAL}){super(),this.submenuActionViewItems=[],this.hasSecondaryActions=!1,this._onDidChangeDropdownVisibility=this._register(new Rp),this.onDidChangeDropdownVisibility=this._onDidChangeDropdownVisibility.event,this.disposables=this._register(new Ot),i.hoverDelegate=i.hoverDelegate??this._register(Dp()),this.options=i,this.toggleMenuAction=this._register(new Go(()=>this.toggleMenuActionViewItem?.show(),i.toggleMenuTitle)),this.element=document.createElement("div"),this.element.className="monaco-toolbar",e.appendChild(this.element),this.actionBar=this._register(new Fd(this.element,{orientation:i.orientation,ariaLabel:i.ariaLabel,actionRunner:i.actionRunner,allowContextMenu:i.allowContextMenu,highlightToggledItems:i.highlightToggledItems,hoverDelegate:i.hoverDelegate,actionViewItemProvider:(n,s)=>{if(n.id===Go.ID)return this.toggleMenuActionViewItem=new Hc(n,n.menuActions,t,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:ut.asClassNameArray(i.moreIcon??It.toolBarMore),anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry,isMenu:!0,hoverDelegate:this.options.hoverDelegate}),this.toggleMenuActionViewItem.setActionContext(this.actionBar.context),this.disposables.add(this._onDidChangeDropdownVisibility.add(this.toggleMenuActionViewItem.onDidChangeVisibility)),this.toggleMenuActionViewItem;if(i.actionViewItemProvider){const o=i.actionViewItemProvider(n,s);if(o)return o}if(n instanceof Tp){const o=new Hc(n,n.actions,t,{actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,keybindingProvider:this.options.getKeyBinding,classNames:n.class,anchorAlignmentProvider:this.options.anchorAlignmentProvider,menuAsChild:!!this.options.renderDropdownAsChildElement,skipTelemetry:this.options.skipTelemetry,hoverDelegate:this.options.hoverDelegate});return o.setActionContext(this.actionBar.context),this.submenuActionViewItems.push(o),this.disposables.add(this._onDidChangeDropdownVisibility.add(o.onDidChangeVisibility)),o}}}))}set actionRunner(e){this.actionBar.actionRunner=e}get actionRunner(){return this.actionBar.actionRunner}set context(e){this.actionBar.context=e,this.toggleMenuActionViewItem?.setActionContext(e);for(const t of this.submenuActionViewItems)t.setActionContext(e)}getElement(){return this.element}focus(){this.actionBar.focus()}getItemsWidth(){let e=0;for(let t=0;t<this.actionBar.length();t++)e+=this.actionBar.getWidth(t);return e}getItemAction(e){return this.actionBar.getAction(e)}getItemWidth(e){return this.actionBar.getWidth(e)}getItemsLength(){return this.actionBar.length()}setAriaLabel(e){this.actionBar.setAriaLabel(e)}setActions(e,t){this.clear();const i=e?e.slice(0):[];this.hasSecondaryActions=!!(t&&t.length>0),this.hasSecondaryActions&&t&&(this.toggleMenuAction.menuActions=t.slice(0),i.push(this.toggleMenuAction)),i.forEach(n=>{this.actionBar.push(n,{icon:this.options.icon??!0,label:this.options.label??!1,keybinding:this.getKeybindingLabel(n)})})}isEmpty(){return this.actionBar.isEmpty()}getKeybindingLabel(e){return this.options.getKeyBinding?.(e)?.getLabel()??void 0}clear(){this.submenuActionViewItems=[],this.disposables.clear(),this.actionBar.clear()}dispose(){this.clear(),this.disposables.dispose(),super.dispose()}}class Go extends Ss{static{this.ID="toolbar.toggle.more"}constructor(e,t){t=t||O(31,"More Actions..."),super(Go.ID,t,void 0,!0),this._menuActions=[],this.toggleDropdownMenu=e}async run(){this.toggleDropdownMenu()}get menuActions(){return this._menuActions}set menuActions(e){this._menuActions=e}}var Ds;(function(a){a[a.NoHide=-1]="NoHide",a[a.Ignore=0]="Ignore",a[a.RenderInSecondaryGroup=1]="RenderInSecondaryGroup"})(Ds||(Ds={}));let hd=class extends kS{constructor(e,t,i,n,s,o,r,l){super(e,s,{getKeyBinding:c=>o.lookupKeybinding(c.id)??void 0,...t,allowContextMenu:!0,skipTelemetry:typeof t?.telemetrySource=="string"}),this._options=t,this._menuService=i,this._contextKeyService=n,this._contextMenuService=s,this._keybindingService=o,this._commandService=r,this._sessionDisposables=this._store.add(new Ot);const d=t?.telemetrySource;d&&this._store.add(this.actionBar.onDidRun(c=>l.publicLog2("workbenchActionExecuted",{id:c.action.id,from:d})))}setActions(e,t=[],i){this._sessionDisposables.clear();const n=e.slice(),s=t.slice(),o=[];let r=0;const l=[];let d=!1;if(this._options?.hiddenItemStrategy!==Ds.NoHide)for(let c=0;c<n.length;c++){const h=n[c];!(h instanceof tl)&&!(h instanceof Ar)||h.hideActions&&(o.push(h.hideActions.toggle),h.hideActions.toggle.checked&&r++,h.hideActions.isHidden&&(d=!0,n[c]=void 0,this._options?.hiddenItemStrategy!==Ds.Ignore&&(l[c]=h)))}if(this._options?.overflowBehavior!==void 0){const c=Wu(new Set(this._options.overflowBehavior.exempted),zu.map(n,g=>g?.id)),h=this._options.overflowBehavior.maxItems-c.size;let u=0;for(let g=0;g<n.length;g++){const f=n[g];f&&(u++,!c.has(f.id)&&u>=h&&(n[g]=void 0,l[g]=f))}}Bc(n),Bc(l),super.setActions(n,il.join(l,s)),(o.length>0||n.length>0)&&this._sessionDisposables.add(Y(this.getElement(),"contextmenu",c=>{const h=new Su(Ne(this.getElement()),c),u=this.getItemAction(h.target);if(!u)return;h.preventDefault(),h.stopPropagation();const g=[];if(u instanceof tl&&u.menuKeybinding)g.push(u.menuKeybinding);else if(!(u instanceof Ar||u instanceof Go)){const m=!!this._keybindingService.lookupKeybinding(u.id);g.push(Mp(this._commandService,this._keybindingService,u.id,void 0,m))}if(o.length>0){let m=!1;if(r===1&&this._options?.hiddenItemStrategy===Ds.Ignore){m=!0;for(let _=0;_<o.length;_++)if(o[_].checked){o[_]=Or({id:u.id,label:u.label,checked:!0,enabled:!1,run(){}});break}}if(!m&&(u instanceof tl||u instanceof Ar)){if(!u.hideActions)return;g.push(u.hideActions.hide)}else g.push(Or({id:"label",label:O(1703,"Hide"),enabled:!1,run(){}}))}const f=il.join(g,o);this._options?.resetMenu&&!i&&(i=[this._options.resetMenu]),d&&i&&(f.push(new il),f.push(Or({id:"resetThisMenu",label:O(1704,"Reset Menu"),run:()=>this._menuService.resetHiddenStates(i)}))),f.length!==0&&this._contextMenuService.showContextMenu({getAnchor:()=>h,getActions:()=>f,menuId:this._options?.contextMenu,menuActionOptions:{renderShortTitle:!0,...this._options?.menuOptions},skipTelemetry:typeof this._options?.telemetrySource=="string",contextKeyService:this._contextKeyService})}))}};hd=ge([P(2,Hd),P(3,ot),P(4,Ma),P(5,wi),P(6,Zs),P(7,Aa)],hd);let ha=class extends hd{constructor(e,t,i,n,s,o,r,l,d,c,h){super(e,{resetMenu:t,...i,actionViewItemProvider:(f,m)=>{let _=c.lookUp(t,f instanceof Ar?f.item.submenu.id:f.id);_||(_=i?.actionViewItemProvider);const L=_?.(f,m);return L||Uu(h,f,m)}},n,s,o,r,l,d),this._onDidChangeMenuItems=this._store.add(new Z),this.onDidChangeMenuItems=this._onDidChangeMenuItems.event;const u=this._store.add(n.createMenu(t,s,{emitEventsForSubmenuChanges:!0,eventDebounceDelay:i?.eventDebounceDelay})),g=()=>{const{primary:f,secondary:m}=Ap(u.getActions(i?.menuOptions),i?.toolbarOptions?.primaryGroup,i?.toolbarOptions?.shouldInlineSubmenu,i?.toolbarOptions?.useSeparatorsInPrimaryActions);e.classList.toggle("has-no-actions",f.length===0&&m.length===0),super.setActions(f,m)};this._store.add(u.onDidChange(()=>{g(),this._onDidChangeMenuItems.fire(this)})),this._store.add(c.onDidChange(f=>{f===t&&g()})),g()}setActions(){throw new Fe("This toolbar is populated from a menu.")}};ha=ge([P(3,Hd),P(4,ot),P(5,Ma),P(6,wi),P(7,Zs),P(8,Aa),P(9,zC),P(10,Me)],ha);function WS(a,e,t){return Op({debugName:()=>`Configuration Key "${a}"`},i=>t.onDidChangeConfiguration(n=>{n.affectsConfiguration(a)&&i(n)}),()=>t.getValue(a)??e)}function Mi(a,e,t){const i=a.bindTo(e);return Vd({debugName:()=>`Set Context Key "${a.key}"`},n=>{i.set(t(n))})}let Bh=class extends U{constructor(e,t,i){super(),this.configurationService=e,this.accessibilityService=t,this.telemetryService=i,this.sounds=new Map,this.screenReaderAttached=Re(this,this.accessibilityService.onDidChangeScreenReaderOptimized,()=>this.accessibilityService.isScreenReaderOptimized()),this.sentTelemetry=new Set,this.playingSounds=new Set,this._signalConfigValue=new Br(n=>WS(n.settingsKey,{sound:"off",announcement:"off"},this.configurationService)),this._signalEnabledState=new Br({getCacheKey:Pp},n=>z(s=>{const o=this._signalConfigValue.get(n.signal).read(s);return!!((n.modality==="sound"||n.modality===void 0)&&zh(o.sound,()=>this.screenReaderAttached.read(s),n.userGesture)||(n.modality==="announcement"||n.modality===void 0)&&zh(o.announcement,()=>this.screenReaderAttached.read(s),n.userGesture))}).recomputeInitiallyAndOnChange(this._store))}getEnabledState(e,t,i){return new kp(this._signalEnabledState.get({signal:e,userGesture:t,modality:i}))}async playSignal(e,t={}){const i=t.modality==="announcement"||t.modality===void 0,n=e.announcementMessage;i&&this.isAnnouncementEnabled(e,t.userGesture)&&n&&this.accessibilityService.status(n),(t.modality==="sound"||t.modality===void 0)&&this.isSoundEnabled(e,t.userGesture)&&(this.sendSignalTelemetry(e,t.source),await this.playSound(e.sound.getSound(),t.allowManyInParallel))}async playSignals(e){for(const s of e)this.sendSignalTelemetry("signal"in s?s.signal:s,"source"in s?s.source:void 0);const t=e.map(s=>"signal"in s?s.signal:s),i=t.filter(s=>this.isAnnouncementEnabled(s)).map(s=>s.announcementMessage);i.length&&this.accessibilityService.status(i.join(", "));const n=new Set(t.filter(s=>this.isSoundEnabled(s)).map(s=>s.sound.getSound()));await Promise.all(Array.from(n).map(s=>this.playSound(s,!0)))}sendSignalTelemetry(e,t){const i=this.accessibilityService.isScreenReaderOptimized(),n=e.name+(t?`::${t}`:"")+(i?"{screenReaderOptimized}":"");this.sentTelemetry.has(n)||this.getVolumeInPercent()===0||(this.sentTelemetry.add(n),this.telemetryService.publicLog2("signal.played",{signal:e.name,source:t??"",isScreenReaderOptimized:i}))}getVolumeInPercent(){const e=this.configurationService.getValue("accessibility.signalOptions.volume");return typeof e!="number"?50:Math.max(Math.min(e,100),0)}async playSound(e,t=!1){if(!t&&this.playingSounds.has(e))return;this.playingSounds.add(e);const i=Wp.asBrowserUri(`vs/platform/accessibilitySignal/browser/media/${e.fileName}`).toString(!0);try{const n=this.sounds.get(i);if(n)n.volume=this.getVolumeInPercent()/100,n.currentTime=0,await n.play();else{const s=await VS(i,this.getVolumeInPercent()/100);this.sounds.set(i,s)}}catch(n){n.message.includes("play() can only be initiated by a user gesture")||console.error("Error while playing sound",n)}finally{this.playingSounds.delete(e)}}playSignalLoop(e,t){let i=!0;const n=()=>{i&&this.playSignal(e,{allowManyInParallel:!0}).finally(()=>{setTimeout(()=>{i&&n()},t)})};return n(),ke(()=>i=!1)}isAnnouncementEnabled(e,t){return e.announcementMessage?this._signalEnabledState.get({signal:e,userGesture:!!t,modality:"announcement"}).get():!1}isSoundEnabled(e,t){return this._signalEnabledState.get({signal:e,userGesture:!!t,modality:"sound"}).get()}onSoundEnabledChanged(e){return this.getEnabledState(e,!1).onDidChange}getDelayMs(e,t,i){if(!this.configurationService.getValue("accessibility.signalOptions.debouncePositionChanges"))return 0;let n;return e.name===se.errorAtPosition.name&&i==="positional"?n=this.configurationService.getValue("accessibility.signalOptions.experimental.delays.errorAtPosition"):e.name===se.warningAtPosition.name&&i==="positional"?n=this.configurationService.getValue("accessibility.signalOptions.experimental.delays.warningAtPosition"):n=this.configurationService.getValue("accessibility.signalOptions.experimental.delays.general"),t==="sound"?n.sound:n.announcement}};Bh=ge([P(0,Gi),P(1,ji),P(2,Aa)],Bh);function zh(a,e,t){return a==="on"||a==="always"||a==="auto"&&e()||a==="userGesture"&&t}function VS(a,e){return new Promise((t,i)=>{const n=new Audio(a);n.volume=e,n.addEventListener("ended",()=>{t(n)}),n.addEventListener("error",s=>{i(s.error)}),n.play().catch(s=>{i(s)})})}class j{static register(e){return new j(e.fileName)}static{this.error=j.register({fileName:"error.mp3"})}static{this.warning=j.register({fileName:"warning.mp3"})}static{this.success=j.register({fileName:"success.mp3"})}static{this.foldedArea=j.register({fileName:"foldedAreas.mp3"})}static{this.break=j.register({fileName:"break.mp3"})}static{this.quickFixes=j.register({fileName:"quickFixes.mp3"})}static{this.taskCompleted=j.register({fileName:"taskCompleted.mp3"})}static{this.taskFailed=j.register({fileName:"taskFailed.mp3"})}static{this.terminalBell=j.register({fileName:"terminalBell.mp3"})}static{this.diffLineInserted=j.register({fileName:"diffLineInserted.mp3"})}static{this.diffLineDeleted=j.register({fileName:"diffLineDeleted.mp3"})}static{this.diffLineModified=j.register({fileName:"diffLineModified.mp3"})}static{this.requestSent=j.register({fileName:"requestSent.mp3"})}static{this.responseReceived1=j.register({fileName:"responseReceived1.mp3"})}static{this.responseReceived2=j.register({fileName:"responseReceived2.mp3"})}static{this.responseReceived3=j.register({fileName:"responseReceived3.mp3"})}static{this.responseReceived4=j.register({fileName:"responseReceived4.mp3"})}static{this.clear=j.register({fileName:"clear.mp3"})}static{this.save=j.register({fileName:"save.mp3"})}static{this.format=j.register({fileName:"format.mp3"})}static{this.voiceRecordingStarted=j.register({fileName:"voiceRecordingStarted.mp3"})}static{this.voiceRecordingStopped=j.register({fileName:"voiceRecordingStopped.mp3"})}static{this.progress=j.register({fileName:"progress.mp3"})}static{this.chatEditModifiedFile=j.register({fileName:"chatEditModifiedFile.mp3"})}static{this.editsKept=j.register({fileName:"editsKept.mp3"})}static{this.editsUndone=j.register({fileName:"editsUndone.mp3"})}static{this.nextEditSuggestion=j.register({fileName:"nextEditSuggestion.mp3"})}static{this.terminalCommandSucceeded=j.register({fileName:"terminalCommandSucceeded.mp3"})}constructor(e){this.fileName=e}}class FS{constructor(e){this.randomOneOf=e}getSound(e=!1){if(e||this.randomOneOf.length===1)return this.randomOneOf[0];{const t=Math.floor(Math.random()*this.randomOneOf.length);return this.randomOneOf[t]}}}class se{constructor(e,t,i,n,s,o){this.sound=e,this.name=t,this.legacySoundSettingsKey=i,this.settingsKey=n,this.legacyAnnouncementSettingsKey=s,this.announcementMessage=o}static{this._signals=new Set}static register(e){const t=new FS("randomOneOf"in e.sound?e.sound.randomOneOf:[e.sound]),i=new se(t,e.name,e.legacySoundSettingsKey,e.settingsKey,e.legacyAnnouncementSettingsKey,e.announcementMessage);return se._signals.add(i),i}static get allAccessibilitySignals(){return[...this._signals]}static{this.errorAtPosition=se.register({name:O(1620,"Error at Position"),sound:j.error,announcementMessage:O(1621,"Error"),settingsKey:"accessibility.signals.positionHasError",delaySettingsKey:"accessibility.signalOptions.delays.errorAtPosition"})}static{this.warningAtPosition=se.register({name:O(1622,"Warning at Position"),sound:j.warning,announcementMessage:O(1623,"Warning"),settingsKey:"accessibility.signals.positionHasWarning",delaySettingsKey:"accessibility.signalOptions.delays.warningAtPosition"})}static{this.errorOnLine=se.register({name:O(1624,"Error on Line"),sound:j.error,legacySoundSettingsKey:"audioCues.lineHasError",legacyAnnouncementSettingsKey:"accessibility.alert.error",announcementMessage:O(1625,"Error on Line"),settingsKey:"accessibility.signals.lineHasError"})}static{this.warningOnLine=se.register({name:O(1626,"Warning on Line"),sound:j.warning,legacySoundSettingsKey:"audioCues.lineHasWarning",legacyAnnouncementSettingsKey:"accessibility.alert.warning",announcementMessage:O(1627,"Warning on Line"),settingsKey:"accessibility.signals.lineHasWarning"})}static{this.foldedArea=se.register({name:O(1628,"Folded Area on Line"),sound:j.foldedArea,legacySoundSettingsKey:"audioCues.lineHasFoldedArea",legacyAnnouncementSettingsKey:"accessibility.alert.foldedArea",announcementMessage:O(1629,"Folded"),settingsKey:"accessibility.signals.lineHasFoldedArea"})}static{this.break=se.register({name:O(1630,"Breakpoint on Line"),sound:j.break,legacySoundSettingsKey:"audioCues.lineHasBreakpoint",legacyAnnouncementSettingsKey:"accessibility.alert.breakpoint",announcementMessage:O(1631,"Breakpoint"),settingsKey:"accessibility.signals.lineHasBreakpoint"})}static{this.inlineSuggestion=se.register({name:O(1632,"Inline Suggestion on Line"),sound:j.quickFixes,legacySoundSettingsKey:"audioCues.lineHasInlineSuggestion",settingsKey:"accessibility.signals.lineHasInlineSuggestion"})}static{this.nextEditSuggestion=se.register({name:O(1633,"Next Edit Suggestion on Line"),sound:j.nextEditSuggestion,legacySoundSettingsKey:"audioCues.nextEditSuggestion",settingsKey:"accessibility.signals.nextEditSuggestion",announcementMessage:O(1634,"Next Edit Suggestion")})}static{this.terminalQuickFix=se.register({name:O(1635,"Terminal Quick Fix"),sound:j.quickFixes,legacySoundSettingsKey:"audioCues.terminalQuickFix",legacyAnnouncementSettingsKey:"accessibility.alert.terminalQuickFix",announcementMessage:O(1636,"Quick Fix"),settingsKey:"accessibility.signals.terminalQuickFix"})}static{this.onDebugBreak=se.register({name:O(1637,"Debugger Stopped on Breakpoint"),sound:j.break,legacySoundSettingsKey:"audioCues.onDebugBreak",legacyAnnouncementSettingsKey:"accessibility.alert.onDebugBreak",announcementMessage:O(1638,"Breakpoint"),settingsKey:"accessibility.signals.onDebugBreak"})}static{this.noInlayHints=se.register({name:O(1639,"No Inlay Hints on Line"),sound:j.error,legacySoundSettingsKey:"audioCues.noInlayHints",legacyAnnouncementSettingsKey:"accessibility.alert.noInlayHints",announcementMessage:O(1640,"No Inlay Hints"),settingsKey:"accessibility.signals.noInlayHints"})}static{this.taskCompleted=se.register({name:O(1641,"Task Completed"),sound:j.taskCompleted,legacySoundSettingsKey:"audioCues.taskCompleted",legacyAnnouncementSettingsKey:"accessibility.alert.taskCompleted",announcementMessage:O(1642,"Task Completed"),settingsKey:"accessibility.signals.taskCompleted"})}static{this.taskFailed=se.register({name:O(1643,"Task Failed"),sound:j.taskFailed,legacySoundSettingsKey:"audioCues.taskFailed",legacyAnnouncementSettingsKey:"accessibility.alert.taskFailed",announcementMessage:O(1644,"Task Failed"),settingsKey:"accessibility.signals.taskFailed"})}static{this.terminalCommandFailed=se.register({name:O(1645,"Terminal Command Failed"),sound:j.error,legacySoundSettingsKey:"audioCues.terminalCommandFailed",legacyAnnouncementSettingsKey:"accessibility.alert.terminalCommandFailed",announcementMessage:O(1646,"Command Failed"),settingsKey:"accessibility.signals.terminalCommandFailed"})}static{this.terminalCommandSucceeded=se.register({name:O(1647,"Terminal Command Succeeded"),sound:j.terminalCommandSucceeded,announcementMessage:O(1648,"Command Succeeded"),settingsKey:"accessibility.signals.terminalCommandSucceeded"})}static{this.terminalBell=se.register({name:O(1649,"Terminal Bell"),sound:j.terminalBell,legacySoundSettingsKey:"audioCues.terminalBell",legacyAnnouncementSettingsKey:"accessibility.alert.terminalBell",announcementMessage:O(1650,"Terminal Bell"),settingsKey:"accessibility.signals.terminalBell"})}static{this.notebookCellCompleted=se.register({name:O(1651,"Notebook Cell Completed"),sound:j.taskCompleted,legacySoundSettingsKey:"audioCues.notebookCellCompleted",legacyAnnouncementSettingsKey:"accessibility.alert.notebookCellCompleted",announcementMessage:O(1652,"Notebook Cell Completed"),settingsKey:"accessibility.signals.notebookCellCompleted"})}static{this.notebookCellFailed=se.register({name:O(1653,"Notebook Cell Failed"),sound:j.taskFailed,legacySoundSettingsKey:"audioCues.notebookCellFailed",legacyAnnouncementSettingsKey:"accessibility.alert.notebookCellFailed",announcementMessage:O(1654,"Notebook Cell Failed"),settingsKey:"accessibility.signals.notebookCellFailed"})}static{this.diffLineInserted=se.register({name:O(1655,"Diff Line Inserted"),sound:j.diffLineInserted,legacySoundSettingsKey:"audioCues.diffLineInserted",settingsKey:"accessibility.signals.diffLineInserted"})}static{this.diffLineDeleted=se.register({name:O(1656,"Diff Line Deleted"),sound:j.diffLineDeleted,legacySoundSettingsKey:"audioCues.diffLineDeleted",settingsKey:"accessibility.signals.diffLineDeleted"})}static{this.diffLineModified=se.register({name:O(1657,"Diff Line Modified"),sound:j.diffLineModified,legacySoundSettingsKey:"audioCues.diffLineModified",settingsKey:"accessibility.signals.diffLineModified"})}static{this.chatEditModifiedFile=se.register({name:O(1658,"Chat Edit Modified File"),sound:j.chatEditModifiedFile,announcementMessage:O(1659,"File Modified from Chat Edits"),settingsKey:"accessibility.signals.chatEditModifiedFile"})}static{this.chatRequestSent=se.register({name:O(1660,"Chat Request Sent"),sound:j.requestSent,legacySoundSettingsKey:"audioCues.chatRequestSent",legacyAnnouncementSettingsKey:"accessibility.alert.chatRequestSent",announcementMessage:O(1661,"Chat Request Sent"),settingsKey:"accessibility.signals.chatRequestSent"})}static{this.chatResponseReceived=se.register({name:O(1662,"Chat Response Received"),legacySoundSettingsKey:"audioCues.chatResponseReceived",sound:{randomOneOf:[j.responseReceived1,j.responseReceived2,j.responseReceived3,j.responseReceived4]},settingsKey:"accessibility.signals.chatResponseReceived"})}static{this.codeActionTriggered=se.register({name:O(1663,"Code Action Request Triggered"),sound:j.voiceRecordingStarted,legacySoundSettingsKey:"audioCues.codeActionRequestTriggered",legacyAnnouncementSettingsKey:"accessibility.alert.codeActionRequestTriggered",announcementMessage:O(1664,"Code Action Request Triggered"),settingsKey:"accessibility.signals.codeActionTriggered"})}static{this.codeActionApplied=se.register({name:O(1665,"Code Action Applied"),legacySoundSettingsKey:"audioCues.codeActionApplied",sound:j.voiceRecordingStopped,settingsKey:"accessibility.signals.codeActionApplied"})}static{this.progress=se.register({name:O(1666,"Progress"),sound:j.progress,legacySoundSettingsKey:"audioCues.chatResponsePending",legacyAnnouncementSettingsKey:"accessibility.alert.progress",announcementMessage:O(1667,"Progress"),settingsKey:"accessibility.signals.progress"})}static{this.clear=se.register({name:O(1668,"Clear"),sound:j.clear,legacySoundSettingsKey:"audioCues.clear",legacyAnnouncementSettingsKey:"accessibility.alert.clear",announcementMessage:O(1669,"Clear"),settingsKey:"accessibility.signals.clear"})}static{this.save=se.register({name:O(1670,"Save"),sound:j.save,legacySoundSettingsKey:"audioCues.save",legacyAnnouncementSettingsKey:"accessibility.alert.save",announcementMessage:O(1671,"Save"),settingsKey:"accessibility.signals.save"})}static{this.format=se.register({name:O(1672,"Format"),sound:j.format,legacySoundSettingsKey:"audioCues.format",legacyAnnouncementSettingsKey:"accessibility.alert.format",announcementMessage:O(1673,"Format"),settingsKey:"accessibility.signals.format"})}static{this.voiceRecordingStarted=se.register({name:O(1674,"Voice Recording Started"),sound:j.voiceRecordingStarted,legacySoundSettingsKey:"audioCues.voiceRecordingStarted",settingsKey:"accessibility.signals.voiceRecordingStarted"})}static{this.voiceRecordingStopped=se.register({name:O(1675,"Voice Recording Stopped"),sound:j.voiceRecordingStopped,legacySoundSettingsKey:"audioCues.voiceRecordingStopped",settingsKey:"accessibility.signals.voiceRecordingStopped"})}static{this.editsKept=se.register({name:O(1676,"Edits Kept"),sound:j.editsKept,announcementMessage:O(1677,"Edits Kept"),settingsKey:"accessibility.signals.editsKept"})}static{this.editsUndone=se.register({name:O(1678,"Undo Edits"),sound:j.editsUndone,announcementMessage:O(1679,"Edits Undone"),settingsKey:"accessibility.signals.editsUndone"})}}function HS(a,e,t,i){if(a.length===0)return e;if(e.length===0)return a;const n=[];let s=0,o=0;for(;s<a.length&&o<e.length;){const r=a[s],l=e[o],d=t(r),c=t(l);d<c?(n.push(r),s++):d>c?(n.push(l),o++):(n.push(i(r,l)),s++,o++)}for(;s<a.length;)n.push(a[s]),s++;for(;o<e.length;)n.push(e[o]),o++;return n}function ua(a,e){const t=new Ot,i=a.createDecorationsCollection();return t.add(Vd({debugName:()=>`Apply decorations from ${e.debugName}`},n=>{const s=e.read(n);i.set(s)})),t.add({dispose:()=>{i.clear()}}),t}function go(a,e){return a.appendChild(e),ke(()=>{e.remove()})}function BS(a,e){return a.prepend(e),ke(()=>{e.remove()})}class Yg extends U{get width(){return this._width}get height(){return this._height}get automaticLayout(){return this._automaticLayout}constructor(e,t){super(),this._automaticLayout=!1,this.elementSizeObserver=this._register(new hg(e,t)),this._width=J(this,this.elementSizeObserver.getWidth()),this._height=J(this,this.elementSizeObserver.getHeight()),this._register(this.elementSizeObserver.onDidChange(i=>He(n=>{this._width.set(this.elementSizeObserver.getWidth(),n),this._height.set(this.elementSizeObserver.getHeight(),n)})))}observe(e){this.elementSizeObserver.observe(e)}setAutomaticLayout(e){this._automaticLayout=e,e?this.elementSizeObserver.startObserving():this.elementSizeObserver.stopObserving()}}function Uh(a,e,t){let i=e.get(),n=i,s=i;const o=J("animatedValue",i);let r=-1;const l=300;let d;t.add(Oa({changeTracker:{createChangeSummary:()=>({animate:!1}),handleChange:(h,u)=>(h.didChange(e)&&(u.animate=u.animate||h.change),!0)}},(h,u)=>{d!==void 0&&(a.cancelAnimationFrame(d),d=void 0),n=s,i=e.read(h),r=Date.now()-(u.animate?0:l),c()}));function c(){const h=Date.now()-r;s=Math.floor(zS(h,n,i-n,l)),h<l?d=a.requestAnimationFrame(c):s=i,o.set(s,void 0)}return o}function zS(a,e,t,i){return a===i?e+t:t*(-Math.pow(2,-10*a/i)+1)+e}class gc extends U{constructor(e,t,i){super(),this._register(new fc(e,i)),this._register(fn(i,{height:t.actualHeight,top:t.actualTop}))}}class Ls{get afterLineNumber(){return this._afterLineNumber.get()}constructor(e,t){this._afterLineNumber=e,this.heightInPx=t,this.domNode=document.createElement("div"),this._actualTop=J(this,void 0),this._actualHeight=J(this,void 0),this.actualTop=this._actualTop,this.actualHeight=this._actualHeight,this.showInHiddenAreas=!0,this.onChange=this._afterLineNumber,this.onDomNodeTop=i=>{this._actualTop.set(i,void 0)},this.onComputedHeight=i=>{this._actualHeight.set(i,void 0)}}}class fc{static{this._counter=0}constructor(e,t){this._editor=e,this._domElement=t,this._overlayWidgetId=`managedOverlayWidget-${fc._counter++}`,this._overlayWidget={getId:()=>this._overlayWidgetId,getDomNode:()=>this._domElement,getPosition:()=>null},this._editor.addOverlayWidget(this._overlayWidget)}dispose(){this._editor.removeOverlayWidget(this._overlayWidget)}}function fn(a,e){return ce(t=>{for(let[i,n]of Object.entries(e))n&&typeof n=="object"&&"read"in n&&(n=n.read(t)),typeof n=="number"&&(n=`${n}px`),i=i.replace(/[A-Z]/g,s=>"-"+s.toLowerCase()),a.style[i]=n})}function ga(a,e,t,i){const n=new Ot,s=[];return n.add(Ci((o,r)=>{const l=e.read(o),d=new Map,c=new Map;t&&t(!0),a.changeViewZones(h=>{for(const u of s)h.removeZone(u),i?.delete(u);s.length=0;for(const u of l){const g=h.addZone(u);u.setZoneId&&u.setZoneId(g),s.push(g),i?.add(g),d.set(u,g)}}),t&&t(!1),r.add(Oa({changeTracker:{createChangeSummary(){return{zoneIds:[]}},handleChange(h,u){const g=c.get(h.changedObservable);return g!==void 0&&u.zoneIds.push(g),!0}}},(h,u)=>{for(const g of l)g.onChange&&(c.set(g.onChange,d.get(g)),g.onChange.read(h));t&&t(!0),a.changeViewZones(g=>{for(const f of u.zoneIds)g.layoutZone(f)}),t&&t(!1)}))})),n.add({dispose(){t&&t(!0),a.changeViewZones(o=>{for(const r of s)o.removeZone(r)}),i?.clear(),t&&t(!1)}}),n}class JE extends Ta{dispose(){super.dispose(!0)}}function Gh(a,e){const t=Ml(e,n=>n.original.startLineNumber<=a.lineNumber);if(!t)return N.fromPositions(a);if(t.original.endLineNumberExclusive<=a.lineNumber){const n=a.lineNumber-t.original.endLineNumberExclusive+t.modified.endLineNumberExclusive;return N.fromPositions(new I(n,a.column))}if(!t.innerChanges)return N.fromPositions(new I(t.modified.startLineNumber,1));const i=Ml(t.innerChanges,n=>n.originalRange.getStartPosition().isBeforeOrEqual(a));if(!i){const n=a.lineNumber-t.original.startLineNumber+t.modified.startLineNumber;return N.fromPositions(new I(n,a.column))}if(i.originalRange.containsPosition(a))return i.modifiedRange;{const n=US(i.originalRange.getEndPosition(),a);return N.fromPositions(n.addToPosition(i.modifiedRange.getEndPosition()))}}function US(a,e){return a.lineNumber===e.lineNumber?new Al(0,e.column-a.column):new Al(e.lineNumber-a.lineNumber,e.column-1)}function GS(a,e){let t;return a.filter(i=>{const n=e(i,t);return t=i,n})}class jo{static create(e,t=void 0){return new _l(e,e,t)}static createWithDisposable(e,t,i=void 0){const n=new Ot;return n.add(t),n.add(e),new _l(e,n,i)}static createOfNonDisposable(e,t,i=void 0){return new _l(e,t,i)}}class _l extends jo{constructor(e,t,i){super(),this.object=e,this._disposable=t,this._debugOwner=i,this._refCount=1,this._isDisposed=!1,this._owners=[],i&&this._addOwner(i)}_addOwner(e){e&&this._owners.push(e)}createNewRef(e){return this._refCount++,e&&this._addOwner(e),new jS(this,e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._decreaseRefCount(this._debugOwner))}_decreaseRefCount(e){if(this._refCount--,this._refCount===0&&this._disposable.dispose(),e){const t=this._owners.indexOf(e);t!==-1&&this._owners.splice(t,1)}}}class jS extends jo{constructor(e,t){super(),this._base=e,this._debugOwner=t,this._isDisposed=!1}get object(){return this._base.object}createNewRef(e){return this._base.createNewRef(e)}dispose(){this._isDisposed||(this._isDisposed=!0,this._base._decreaseRefCount(this._debugOwner))}}const KS=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(KS);const $S=Ki("diff-review-insert",It.add,O(161,"Icon for 'Insert' in accessible diff viewer.")),ZS=Ki("diff-review-remove",It.remove,O(162,"Icon for 'Remove' in accessible diff viewer.")),qS=Ki("diff-review-close",It.close,O(163,"Icon for 'Close' in accessible diff viewer."));let Bn=class extends U{static{this._ttPolicy=ir("diffReview",{createHTML:e=>e})}constructor(e,t,i,n,s,o,r,l,d){super(),this._parentNode=e,this._visible=t,this._setVisible=i,this._canClose=n,this._width=s,this._height=o,this._diffs=r,this._models=l,this._instantiationService=d,this._state=qs(this,(c,h)=>{const u=this._visible.read(c);if(this._parentNode.style.visibility=u?"visible":"hidden",!u)return null;const g=h.add(this._instantiationService.createInstance(ud,this._diffs,this._models,this._setVisible,this._canClose)),f=h.add(this._instantiationService.createInstance(gd,this._parentNode,g,this._width,this._height,this._models));return{model:g,view:f}}).recomputeInitiallyAndOnChange(this._store)}next(){He(e=>{const t=this._visible.get();this._setVisible(!0,e),t&&this._state.get().model.nextGroup(e)})}prev(){He(e=>{this._setVisible(!0,e),this._state.get().model.previousGroup(e)})}close(){He(e=>{this._setVisible(!1,e)})}};Bn=ge([P(8,Me)],Bn);let ud=class extends U{constructor(e,t,i,n,s){super(),this._diffs=e,this._models=t,this._setVisible=i,this.canClose=n,this._accessibilitySignalService=s,this._groups=J(this,[]),this._currentGroupIdx=J(this,0),this._currentElementIdx=J(this,0),this.groups=this._groups,this.currentGroup=this._currentGroupIdx.map((o,r)=>this._groups.read(r)[o]),this.currentGroupIndex=this._currentGroupIdx,this.currentElement=this._currentElementIdx.map((o,r)=>this.currentGroup.read(r)?.lines[o]),this._register(ce(o=>{const r=this._diffs.read(o);if(!r){this._groups.set([],void 0);return}const l=XS(r,this._models.getOriginalModel().getLineCount(),this._models.getModifiedModel().getLineCount());He(d=>{const c=this._models.getModifiedPosition();if(c){const h=l.findIndex(u=>c?.lineNumber<u.range.modified.endLineNumberExclusive);h!==-1&&this._currentGroupIdx.set(h,d)}this._groups.set(l,d)})})),this._register(ce(o=>{const r=this.currentElement.read(o);r?.type===Lt.Deleted?this._accessibilitySignalService.playSignal(se.diffLineDeleted,{source:"accessibleDiffViewer.currentElementChanged"}):r?.type===Lt.Added&&this._accessibilitySignalService.playSignal(se.diffLineInserted,{source:"accessibleDiffViewer.currentElementChanged"})})),this._register(ce(o=>{const r=this.currentElement.read(o);if(r&&r.type!==Lt.Header){const l=r.modifiedLineNumber??r.diff.modified.startLineNumber;this._models.modifiedSetSelection(N.fromPositions(new I(l,1)))}}))}_goToGroupDelta(e,t){const i=this.groups.get();!i||i.length<=1||Gu(t,n=>{this._currentGroupIdx.set(ii.ofLength(i.length).clipCyclic(this._currentGroupIdx.get()+e),n),this._currentElementIdx.set(0,n)})}nextGroup(e){this._goToGroupDelta(1,e)}previousGroup(e){this._goToGroupDelta(-1,e)}_goToLineDelta(e){const t=this.currentGroup.get();!t||t.lines.length<=1||He(i=>{this._currentElementIdx.set(ii.ofLength(t.lines.length).clip(this._currentElementIdx.get()+e),i)})}goToNextLine(){this._goToLineDelta(1)}goToPreviousLine(){this._goToLineDelta(-1)}goToLine(e){const t=this.currentGroup.get();if(!t)return;const i=t.lines.indexOf(e);i!==-1&&He(n=>{this._currentElementIdx.set(i,n)})}revealCurrentElementInEditor(){if(!this.canClose.get())return;this._setVisible(!1,void 0);const e=this.currentElement.get();e&&(e.type===Lt.Deleted?this._models.originalReveal(N.fromPositions(new I(e.originalLineNumber,1))):this._models.modifiedReveal(e.type!==Lt.Header?N.fromPositions(new I(e.modifiedLineNumber,1)):void 0))}close(){this.canClose.get()&&(this._setVisible(!1,void 0),this._models.modifiedFocus())}};ud=ge([P(4,or)],ud);const lo=3;function XS(a,e,t){const i=[];for(const n of ju(a,(s,o)=>o.modified.startLineNumber-s.modified.endLineNumberExclusive<2*lo)){const s=[];s.push(new QS);const o=new Ve(Math.max(1,n[0].original.startLineNumber-lo),Math.min(n[n.length-1].original.endLineNumberExclusive+lo,e+1)),r=new Ve(Math.max(1,n[0].modified.startLineNumber-lo),Math.min(n[n.length-1].modified.endLineNumberExclusive+lo,t+1));Fp(n,(c,h)=>{const u=new Ve(c?c.original.endLineNumberExclusive:o.startLineNumber,h?h.original.startLineNumber:o.endLineNumberExclusive),g=new Ve(c?c.modified.endLineNumberExclusive:r.startLineNumber,h?h.modified.startLineNumber:r.endLineNumberExclusive);u.forEach(f=>{s.push(new ty(f,g.startLineNumber+(f-u.startLineNumber)))}),h&&(h.original.forEach(f=>{s.push(new JS(h,f))}),h.modified.forEach(f=>{s.push(new ey(h,f))}))});const l=n[0].modified.join(n[n.length-1].modified),d=n[0].original.join(n[n.length-1].original);i.push(new YS(new mo(l,d),s))}return i}var Lt;(function(a){a[a.Header=0]="Header",a[a.Unchanged=1]="Unchanged",a[a.Deleted=2]="Deleted",a[a.Added=3]="Added"})(Lt||(Lt={}));class YS{constructor(e,t){this.range=e,this.lines=t}}class QS{constructor(){this.type=Lt.Header}}class JS{constructor(e,t){this.diff=e,this.originalLineNumber=t,this.type=Lt.Deleted,this.modifiedLineNumber=void 0}}class ey{constructor(e,t){this.diff=e,this.modifiedLineNumber=t,this.type=Lt.Added,this.originalLineNumber=void 0}}class ty{constructor(e,t){this.originalLineNumber=e,this.modifiedLineNumber=t,this.type=Lt.Unchanged}}let gd=class extends U{constructor(e,t,i,n,s,o){super(),this._element=e,this._model=t,this._width=i,this._height=n,this._models=s,this._languageService=o,this.domNode=this._element,this.domNode.className="monaco-component diff-review monaco-editor-background";const r=document.createElement("div");r.className="diff-review-actions",this._actionBar=this._register(new Fd(r)),this._register(ce(l=>{this._actionBar.clear(),this._model.canClose.read(l)&&this._actionBar.push(Or({id:"diffreview.close",label:O(164,"Close"),class:"close-diff-review "+ut.asClassName(qS),enabled:!0,run:async()=>t.close()}),{label:!1,icon:!0})})),this._content=document.createElement("div"),this._content.className="diff-review-content",this._content.setAttribute("role","code"),this._scrollbar=this._register(new Vp(this._content,{})),ys(this.domNode,this._scrollbar.getDomNode(),r),this._register(ce(l=>{this._height.read(l),this._width.read(l),this._scrollbar.scanDomNode()})),this._register(ke(()=>{ys(this.domNode)})),this._register(fn(this.domNode,{width:this._width,height:this._height})),this._register(fn(this._content,{width:this._width,height:this._height})),this._register(Ci((l,d)=>{this._model.currentGroup.read(l),this._render(d)})),this._register(zn(this.domNode,"keydown",l=>{(l.equals(T.DownArrow)||l.equals(M.CtrlCmd|T.DownArrow)||l.equals(M.Alt|T.DownArrow))&&(l.preventDefault(),this._model.goToNextLine()),(l.equals(T.UpArrow)||l.equals(M.CtrlCmd|T.UpArrow)||l.equals(M.Alt|T.UpArrow))&&(l.preventDefault(),this._model.goToPreviousLine()),(l.equals(T.Escape)||l.equals(M.CtrlCmd|T.Escape)||l.equals(M.Alt|T.Escape)||l.equals(M.Shift|T.Escape))&&(l.preventDefault(),this._model.close()),(l.equals(T.Space)||l.equals(T.Enter))&&(l.preventDefault(),this._model.revealCurrentElementInEditor())}))}_render(e){const t=this._models.getOriginalOptions(),i=this._models.getModifiedOptions(),n=document.createElement("div");n.className="diff-review-table",n.setAttribute("role","list"),n.setAttribute("aria-label",O(165,"Accessible Diff Viewer. Use arrow up and down to navigate.")),st(n,i.get(v.fontInfo)),ys(this._content,n);const s=this._models.getOriginalModel(),o=this._models.getModifiedModel();if(!s||!o)return;const r=s.getOptions(),l=o.getOptions(),d=i.get(v.lineHeight),c=this._model.currentGroup.get();for(const h of c?.lines||[]){if(!c)break;let u;if(h.type===Lt.Header){const f=document.createElement("div");f.className="diff-review-row",f.setAttribute("role","listitem");const m=c.range,_=this._model.currentGroupIndex.get(),L=this._model.groups.get().length,w=S=>S===0?O(166,"no lines changed"):S===1?O(167,"1 line changed"):O(168,"{0} lines changed",S),p=w(m.original.length),C=w(m.modified.length);f.setAttribute("aria-label",O(169,"Difference {0} of {1}: original line {2}, {3}, modified line {4}, {5}",_+1,L,m.original.startLineNumber,p,m.modified.startLineNumber,C));const b=document.createElement("div");b.className="diff-review-cell diff-review-summary",b.appendChild(document.createTextNode(`${_+1}/${L}: @@ -${m.original.startLineNumber},${m.original.length} +${m.modified.startLineNumber},${m.modified.length} @@`)),f.appendChild(b),u=f}else u=this._createRow(h,d,this._width.get(),t,s,r,i,o,l);n.appendChild(u);const g=z(f=>this._model.currentElement.read(f)===h);e.add(ce(f=>{const m=g.read(f);u.tabIndex=m?0:-1,m&&u.focus()})),e.add(Y(u,"focus",()=>{this._model.goToLine(h)}))}this._scrollbar.scanDomNode()}_createRow(e,t,i,n,s,o,r,l,d){const c=n.get(v.layoutInfo),h=c.glyphMarginWidth+c.lineNumbersWidth,u=r.get(v.layoutInfo),g=10+u.glyphMarginWidth+u.lineNumbersWidth;let f="diff-review-row",m="";const _="diff-review-spacer";let L=null;switch(e.type){case Lt.Added:f="diff-review-row line-insert",m=" char-insert",L=$S;break;case Lt.Deleted:f="diff-review-row line-delete",m=" char-delete",L=ZS;break}const w=document.createElement("div");w.style.minWidth=i+"px",w.className=f,w.setAttribute("role","listitem"),w.ariaLevel="";const p=document.createElement("div");p.className="diff-review-cell",p.style.height=`${t}px`,w.appendChild(p);const C=document.createElement("span");C.style.width=h+"px",C.style.minWidth=h+"px",C.className="diff-review-line-number"+m,e.originalLineNumber!==void 0?C.appendChild(document.createTextNode(String(e.originalLineNumber))):C.innerText=" ",p.appendChild(C);const b=document.createElement("span");b.style.width=g+"px",b.style.minWidth=g+"px",b.style.paddingRight="10px",b.className="diff-review-line-number"+m,e.modifiedLineNumber!==void 0?b.appendChild(document.createTextNode(String(e.modifiedLineNumber))):b.innerText=" ",p.appendChild(b);const S=document.createElement("span");if(S.className=_,L){const x=document.createElement("span");x.className=ut.asClassName(L),x.innerText="  ",S.appendChild(x)}else S.innerText="  ";p.appendChild(S);let y;if(e.modifiedLineNumber!==void 0){let x=this._getLineHtml(l,r,d.tabSize,e.modifiedLineNumber,this._languageService.languageIdCodec);Bn._ttPolicy&&(x=Bn._ttPolicy.createHTML(x)),p.insertAdjacentHTML("beforeend",x),y=l.getLineContent(e.modifiedLineNumber)}else{let x=this._getLineHtml(s,n,o.tabSize,e.originalLineNumber,this._languageService.languageIdCodec);Bn._ttPolicy&&(x=Bn._ttPolicy.createHTML(x)),p.insertAdjacentHTML("beforeend",x),y=s.getLineContent(e.originalLineNumber)}y.length===0&&(y=O(170,"blank"));let E="";switch(e.type){case Lt.Unchanged:e.originalLineNumber===e.modifiedLineNumber?E=O(171,"{0} unchanged line {1}",y,e.originalLineNumber):E=O(172,"{0} original line {1} modified line {2}",y,e.originalLineNumber,e.modifiedLineNumber);break;case Lt.Added:E=O(173,"+ {0} modified line {1}",y,e.modifiedLineNumber);break;case Lt.Deleted:E=O(174,"- {0} original line {1}",y,e.originalLineNumber);break}return w.setAttribute("aria-label",E),w}_getLineHtml(e,t,i,n,s){const o=e.getLineContent(n),r=t.get(v.fontInfo),l=Jn.createEmpty(o,s),d=Ut.isBasicASCII(o,e.mightContainNonBasicASCII()),c=Ut.containsRTL(o,d,e.mightContainRTL());return Fa(new Ys(r.isMonospace&&!t.get(v.disableMonospaceOptimizations),r.canUseHalfwidthRightwardsArrow,o,!1,d,c,0,l,[],i,0,r.spaceWidth,r.middotWidth,r.wsmiddotWidth,t.get(v.stopRenderingLineAfter),t.get(v.renderWhitespace),t.get(v.renderControlCharacters),t.get(v.fontLigatures)!==Na.OFF,null)).html}};gd=ge([P(5,At)],gd);class iy{constructor(e){this.editors=e}getOriginalModel(){return this.editors.original.getModel()}getOriginalOptions(){return this.editors.original.getOptions()}originalReveal(e){this.editors.original.revealRange(e),this.editors.original.setSelection(e),this.editors.original.focus()}getModifiedModel(){return this.editors.modified.getModel()}getModifiedOptions(){return this.editors.modified.getOptions()}modifiedReveal(e){e&&(this.editors.modified.revealRange(e),this.editors.modified.setSelection(e)),this.editors.modified.focus()}modifiedSetSelection(e){this.editors.modified.setSelection(e)}modifiedFocus(){this.editors.modified.focus()}getModifiedPosition(){return this.editors.modified.getPosition()??void 0}}$i("diffEditor.move.border","#8b8b8b9c",O(200,"The border color for text that got moved in the diff editor."));$i("diffEditor.moveActive.border","#FFA500",O(201,"The active border color for text that got moved in the diff editor."));$i("diffEditor.unchangedRegionShadow",{dark:"#000000",light:"#737373BF",hcDark:"#000000",hcLight:"#737373BF"},O(202,"The color of the shadow around unchanged region widgets."));const ny=Ki("diff-insert",It.add,O(203,"Line decoration for inserts in the diff editor.")),Qg=Ki("diff-remove",It.remove,O(204,"Line decoration for removals in the diff editor.")),jh=Pe.register({className:"line-insert",description:"line-insert",isWholeLine:!0,linesDecorationsClassName:"insert-sign "+ut.asClassName(ny),marginClassName:"gutter-insert"}),Kh=Pe.register({className:"line-delete",description:"line-delete",isWholeLine:!0,linesDecorationsClassName:"delete-sign "+ut.asClassName(Qg),marginClassName:"gutter-delete"}),$h=Pe.register({className:"line-insert",description:"line-insert",isWholeLine:!0,marginClassName:"gutter-insert"}),Zh=Pe.register({className:"line-delete",description:"line-delete",isWholeLine:!0,marginClassName:"gutter-delete"}),qh=Pe.register({className:"char-insert",description:"char-insert",shouldFillLineOnLineBreak:!0}),sy=Pe.register({className:"char-insert",description:"char-insert",isWholeLine:!0}),oy=Pe.register({className:"char-insert diff-range-empty",description:"char-insert diff-range-empty"}),fd=Pe.register({className:"char-delete",description:"char-delete",shouldFillLineOnLineBreak:!0}),ry=Pe.register({className:"char-delete",description:"char-delete",isWholeLine:!0}),ay=Pe.register({className:"char-delete diff-range-empty",description:"char-delete diff-range-empty"});function ly(a,e,t,i){return e||(e=n=>n!=null),new Promise((n,s)=>{let o=!0,r=!1;const l=a.map(c=>({isFinished:e(c),error:t?t(c):!1,state:c})),d=ce(c=>{const{isFinished:h,error:u,state:g}=l.read(c);(h||u)&&(o?r=!0:d.dispose(),u?s(u===!0?g:u):n(g))});if(i){const c=i.onCancellationRequested(()=>{d.dispose(),c.dispose(),s(new zc)});if(i.isCancellationRequested){d.dispose(),c.dispose(),s(new zc);return}}o=!1,r&&d.dispose()})}let fa=class extends U{setActiveMovedText(e){this._activeMovedText.set(e,void 0)}setHoveredMovedText(e){this._hoveredMovedText.set(e,void 0)}constructor(e,t,i){super(),this.model=e,this._options=t,this._diffProviderFactoryService=i,this._isDiffUpToDate=J(this,!1),this.isDiffUpToDate=this._isDiffUpToDate,this._diff=J(this,void 0),this.diff=this._diff,this._unchangedRegions=J(this,void 0),this.unchangedRegions=z(this,r=>this._options.hideUnchangedRegions.read(r)?this._unchangedRegions.read(r)?.regions??[]:(He(l=>{for(const d of this._unchangedRegions.get()?.regions||[])d.collapseAll(l)}),[])),this.movedTextToCompare=J(this,void 0),this._activeMovedText=J(this,void 0),this._hoveredMovedText=J(this,void 0),this.activeMovedText=z(this,r=>this.movedTextToCompare.read(r)??this._hoveredMovedText.read(r)??this._activeMovedText.read(r)),this._cancellationTokenSource=new Ta,this._diffProvider=z(this,r=>{const l=this._diffProviderFactoryService.createDiffProvider({diffAlgorithm:this._options.diffAlgorithm.read(r)}),d=qt("onDidChange",l.onDidChange);return{diffProvider:l,onChangeSignal:d}}),this._register(ke(()=>this._cancellationTokenSource.cancel()));const n=Kr("contentChangedSignal"),s=this._register(new Ei(()=>n.trigger(void 0),200));this._register(ce(r=>{const l=this._unchangedRegions.read(r);if(!l||l.regions.some(f=>f.isDragged.read(r)))return;const d=l.originalDecorationIds.map(f=>e.original.getDecorationRange(f)).map(f=>f?Ve.fromRangeInclusive(f):void 0),c=l.modifiedDecorationIds.map(f=>e.modified.getDecorationRange(f)).map(f=>f?Ve.fromRangeInclusive(f):void 0),h=l.regions.map((f,m)=>!d[m]||!c[m]?void 0:new rn(d[m].startLineNumber,c[m].startLineNumber,d[m].length,f.visibleLineCountTop.read(r),f.visibleLineCountBottom.read(r))).filter(Os),u=[];let g=!1;for(const f of ju(h,(m,_)=>m.getHiddenModifiedRange(r).endLineNumberExclusive===_.getHiddenModifiedRange(r).startLineNumber))if(f.length>1){g=!0;const m=f.reduce((L,w)=>L+w.lineCount,0),_=new rn(f[0].originalLineNumber,f[0].modifiedLineNumber,m,f[0].visibleLineCountTop.get(),f[f.length-1].visibleLineCountBottom.get());u.push(_)}else u.push(f[0]);if(g){const f=e.original.deltaDecorations(l.originalDecorationIds,u.map(_=>({range:_.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),m=e.modified.deltaDecorations(l.modifiedDecorationIds,u.map(_=>({range:_.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));He(_=>{this._unchangedRegions.set({regions:u,originalDecorationIds:f,modifiedDecorationIds:m},_)})}}));const o=(r,l,d)=>{const c=rn.fromDiffs(r.changes,e.original.getLineCount(),e.modified.getLineCount(),this._options.hideUnchangedRegionsMinimumLineCount.read(d),this._options.hideUnchangedRegionsContextLineCount.read(d));let h;const u=this._unchangedRegions.get();if(u){const _=u.originalDecorationIds.map(C=>e.original.getDecorationRange(C)).map(C=>C?Ve.fromRangeInclusive(C):void 0),L=u.modifiedDecorationIds.map(C=>e.modified.getDecorationRange(C)).map(C=>C?Ve.fromRangeInclusive(C):void 0);let p=GS(u.regions.map((C,b)=>{if(!_[b]||!L[b])return;const S=_[b].length;return new rn(_[b].startLineNumber,L[b].startLineNumber,S,Math.min(C.visibleLineCountTop.get(),S),Math.min(C.visibleLineCountBottom.get(),S-C.visibleLineCountTop.get()))}).filter(Os),(C,b)=>!b||C.modifiedLineNumber>=b.modifiedLineNumber+b.lineCount&&C.originalLineNumber>=b.originalLineNumber+b.lineCount).map(C=>new mo(C.getHiddenOriginalRange(d),C.getHiddenModifiedRange(d)));p=mo.clip(p,Ve.ofLength(1,e.original.getLineCount()),Ve.ofLength(1,e.modified.getLineCount())),h=mo.inverse(p,e.original.getLineCount(),e.modified.getLineCount())}const g=[];if(h)for(const _ of c){const L=h.filter(w=>w.original.intersectsStrict(_.originalUnchangedRange)&&w.modified.intersectsStrict(_.modifiedUnchangedRange));g.push(..._.setVisibleRanges(L,l))}else g.push(...c);const f=e.original.deltaDecorations(u?.originalDecorationIds||[],g.map(_=>({range:_.originalUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}}))),m=e.modified.deltaDecorations(u?.modifiedDecorationIds||[],g.map(_=>({range:_.modifiedUnchangedRange.toInclusiveRange(),options:{description:"unchanged"}})));this._unchangedRegions.set({regions:g,originalDecorationIds:f,modifiedDecorationIds:m},l)};this._register(e.modified.onDidChangeContent(r=>{this._diff.get()&&mr.fromModelContentChanges(r.changes),this._isDiffUpToDate.set(!1,void 0),s.schedule()})),this._register(e.original.onDidChangeContent(r=>{this._diff.get()&&mr.fromModelContentChanges(r.changes),this._isDiffUpToDate.set(!1,void 0),s.schedule()})),this._register(Ci(async(r,l)=>{this._options.hideUnchangedRegionsMinimumLineCount.read(r),this._options.hideUnchangedRegionsContextLineCount.read(r),s.cancel(),n.read(r);const d=this._diffProvider.read(r);d.onChangeSignal.read(r),Qt(Bp,r),Qt(zp,r),this._isDiffUpToDate.set(!1,void 0);let c=[];l.add(e.original.onDidChangeContent(g=>{const f=mr.fromModelContentChanges(g.changes);c=Uc(c,f)}));let h=[];l.add(e.modified.onDidChangeContent(g=>{const f=mr.fromModelContentChanges(g.changes);h=Uc(h,f)}));let u=await d.diffProvider.computeDiff(e.original,e.modified,{ignoreTrimWhitespace:this._options.ignoreTrimWhitespace.read(r),maxComputationTimeMs:this._options.maxComputationTimeMs.read(r),computeMoves:this._options.showMoves.read(r)},this._cancellationTokenSource.token);this._cancellationTokenSource.token.isCancellationRequested||e.original.isDisposed()||e.modified.isDisposed()||(u=dy(u,e.original,e.modified),u=u,u=u,He(g=>{o(u,g),this._lastDiff=u;const f=mc.fromDiffResult(u);this._diff.set(f,g),this._isDiffUpToDate.set(!0,g);const m=this.movedTextToCompare.get();this.movedTextToCompare.set(m?this._lastDiff.moves.find(_=>_.lineRangeMapping.modified.intersect(m.lineRangeMapping.modified)):void 0,g)}))}))}ensureModifiedLineIsVisible(e,t,i){if(this.diff.get()?.mappings.length===0)return;const n=this._unchangedRegions.get()?.regions||[];for(const s of n)if(s.getHiddenModifiedRange(void 0).contains(e)){s.showModifiedLine(e,t,i);return}}ensureOriginalLineIsVisible(e,t,i){if(this.diff.get()?.mappings.length===0)return;const n=this._unchangedRegions.get()?.regions||[];for(const s of n)if(s.getHiddenOriginalRange(void 0).contains(e)){s.showOriginalLine(e,t,i);return}}async waitForDiff(){await ly(this.isDiffUpToDate,e=>e)}serializeState(){return{collapsedRegions:this._unchangedRegions.get()?.regions.map(t=>({range:t.getHiddenModifiedRange(void 0).serialize()}))}}restoreSerializedState(e){const t=e.collapsedRegions?.map(n=>Ve.deserialize(n.range)),i=this._unchangedRegions.get();!i||!t||He(n=>{for(const s of i.regions)for(const o of t)if(s.modifiedUnchangedRange.intersect(o)){s.setHiddenModifiedRange(o,n);break}})}};fa=ge([P(2,JC)],fa);function dy(a,e,t){return{changes:a.changes.map(i=>new Bd(i.original,i.modified,i.innerChanges?i.innerChanges.map(n=>cy(n,e,t)):void 0)),moves:a.moves,identical:a.identical,quitEarly:a.quitEarly}}function cy(a,e,t){let i=a.originalRange,n=a.modifiedRange;return i.startColumn===1&&n.startColumn===1&&(i.endColumn!==1||n.endColumn!==1)&&i.endColumn===e.getLineMaxColumn(i.endLineNumber)&&n.endColumn===t.getLineMaxColumn(n.endLineNumber)&&i.endLineNumber<e.getLineCount()&&n.endLineNumber<t.getLineCount()&&(i=i.setEndPosition(i.endLineNumber+1,1),n=n.setEndPosition(n.endLineNumber+1,1)),new Hp(i,n)}class mc{static fromDiffResult(e){return new mc(e.changes.map(t=>new Jg(t)),e.moves||[],e.identical,e.quitEarly)}constructor(e,t,i,n){this.mappings=e,this.movedTexts=t,this.identical=i,this.quitEarly=n}}class Jg{constructor(e){this.lineRangeMapping=e}}class rn{static fromDiffs(e,t,i,n,s){const o=Bd.inverse(e,t,i),r=[];for(const l of o){let d=l.original.startLineNumber,c=l.modified.startLineNumber,h=l.original.length;const u=d===1&&c===1,g=d+h===t+1&&c+h===i+1;(u||g)&&h>=s+n?(u&&!g&&(h-=s),g&&!u&&(d+=s,c+=s,h-=s),r.push(new rn(d,c,h,0,0))):h>=s*2+n&&(d+=s,c+=s,h-=s*2,r.push(new rn(d,c,h,0,0)))}return r}get originalUnchangedRange(){return Ve.ofLength(this.originalLineNumber,this.lineCount)}get modifiedUnchangedRange(){return Ve.ofLength(this.modifiedLineNumber,this.lineCount)}constructor(e,t,i,n,s){this.originalLineNumber=e,this.modifiedLineNumber=t,this.lineCount=i,this._visibleLineCountTop=J(this,0),this.visibleLineCountTop=this._visibleLineCountTop,this._visibleLineCountBottom=J(this,0),this.visibleLineCountBottom=this._visibleLineCountBottom,this._shouldHideControls=z(this,l=>this.visibleLineCountTop.read(l)+this.visibleLineCountBottom.read(l)===this.lineCount&&!this.isDragged.read(l)),this.isDragged=J(this,void 0);const o=Math.max(Math.min(n,this.lineCount),0),r=Math.max(Math.min(s,this.lineCount-n),0);Gc(n===o),Gc(s===r),this._visibleLineCountTop.set(o,void 0),this._visibleLineCountBottom.set(r,void 0)}setVisibleRanges(e,t){const i=[],n=new zd(e.map(l=>l.modified)).subtractFrom(this.modifiedUnchangedRange);let s=this.originalLineNumber,o=this.modifiedLineNumber;const r=this.modifiedLineNumber+this.lineCount;if(n.ranges.length===0)this.showAll(t),i.push(this);else{let l=0;for(const d of n.ranges){const c=l===n.ranges.length-1;l++;const h=(c?r:d.endLineNumberExclusive)-o,u=new rn(s,o,h,0,0);u.setHiddenModifiedRange(d,t),i.push(u),s=u.originalUnchangedRange.endLineNumberExclusive,o=u.modifiedUnchangedRange.endLineNumberExclusive}}return i}shouldHideControls(e){return this._shouldHideControls.read(e)}getHiddenOriginalRange(e){return Ve.ofLength(this.originalLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}getHiddenModifiedRange(e){return Ve.ofLength(this.modifiedLineNumber+this._visibleLineCountTop.read(e),this.lineCount-this._visibleLineCountTop.read(e)-this._visibleLineCountBottom.read(e))}setHiddenModifiedRange(e,t){const i=e.startLineNumber-this.modifiedLineNumber,n=this.modifiedLineNumber+this.lineCount-e.endLineNumberExclusive;this.setState(i,n,t)}getMaxVisibleLineCountTop(){return this.lineCount-this._visibleLineCountBottom.get()}getMaxVisibleLineCountBottom(){return this.lineCount-this._visibleLineCountTop.get()}showMoreAbove(e=10,t){const i=this.getMaxVisibleLineCountTop();this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+e,i),t)}showMoreBelow(e=10,t){const i=this.lineCount-this._visibleLineCountTop.get();this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+e,i),t)}showAll(e){this._visibleLineCountBottom.set(this.lineCount-this._visibleLineCountTop.get(),e)}showModifiedLine(e,t,i){const n=e+1-(this.modifiedLineNumber+this._visibleLineCountTop.get()),s=this.modifiedLineNumber-this._visibleLineCountBottom.get()+this.lineCount-e;t===ti.FromCloserSide&&n<s||t===ti.FromTop?this._visibleLineCountTop.set(this._visibleLineCountTop.get()+n,i):this._visibleLineCountBottom.set(this._visibleLineCountBottom.get()+s,i)}showOriginalLine(e,t,i){const n=e-this.originalLineNumber,s=this.originalLineNumber+this.lineCount-e;t===ti.FromCloserSide&&n<s||t===ti.FromTop?this._visibleLineCountTop.set(Math.min(this._visibleLineCountTop.get()+s-n,this.getMaxVisibleLineCountTop()),i):this._visibleLineCountBottom.set(Math.min(this._visibleLineCountBottom.get()+n-s,this.getMaxVisibleLineCountBottom()),i)}collapseAll(e){this._visibleLineCountTop.set(0,e),this._visibleLineCountBottom.set(0,e)}setState(e,t,i){e=Math.max(Math.min(e,this.lineCount),0),t=Math.max(Math.min(t,this.lineCount-e),0),this._visibleLineCountTop.set(e,i),this._visibleLineCountBottom.set(t,i)}}var ti;(function(a){a[a.FromCloserSide=0]="FromCloserSide",a[a.FromTop=1]="FromTop",a[a.FromBottom=2]="FromBottom"})(ti||(ti={}));class hy extends U{get visibility(){return this._visibility}set visibility(e){this._visibility!==e&&(this._visibility=e,this._diffActions.style.visibility=e?"visible":"hidden")}constructor(e,t,i,n,s,o,r,l,d){super(),this._getViewZoneId=e,this._marginDomNode=t,this._modifiedEditor=i,this._diff=n,this._editor=s,this._viewLineCounts=o,this._originalTextModel=r,this._contextMenuService=l,this._clipboardService=d,this._visibility=!1,this._marginDomNode.style.zIndex="10",this._diffActions=document.createElement("div"),this._diffActions.className=ut.asClassName(It.lightBulb)+" lightbulb-glyph",this._diffActions.style.position="absolute";const c=this._modifiedEditor.getOption(v.lineHeight);this._diffActions.style.right="0px",this._diffActions.style.visibility="hidden",this._diffActions.style.height=`${c}px`,this._diffActions.style.lineHeight=`${c}px`,this._marginDomNode.appendChild(this._diffActions);let h=0;const u=i.getOption(v.useShadowDOM)&&!Eu,g=(f,m)=>{this._contextMenuService.showContextMenu({domForShadowRoot:u?i.getDomNode()??void 0:void 0,getAnchor:()=>({x:f,y:m}),getActions:()=>{const _=[],L=n.modified.isEmpty;return _.push(new Ss("diff.clipboard.copyDeletedContent",L?n.original.length>1?O(176,"Copy deleted lines"):O(177,"Copy deleted line"):n.original.length>1?O(178,"Copy changed lines"):O(179,"Copy changed line"),void 0,!0,async()=>{const p=this._originalTextModel.getValueInRange(n.original.toExclusiveRange());await this._clipboardService.writeText(p)})),n.original.length>1&&_.push(new Ss("diff.clipboard.copyDeletedLineContent",L?O(180,"Copy deleted line ({0})",n.original.startLineNumber+h):O(181,"Copy changed line ({0})",n.original.startLineNumber+h),void 0,!0,async()=>{let p=this._originalTextModel.getLineContent(n.original.startLineNumber+h);p===""&&(p=this._originalTextModel.getEndOfLineSequence()===Ou.LF?`
`:`\r
`),await this._clipboardService.writeText(p)})),i.getOption(v.readOnly)||_.push(new Ss("diff.inline.revertChange",O(182,"Revert this change"),void 0,!0,async()=>{this._editor.revert(this._diff)})),_},autoSelectFirstItem:!0})};this._register(zn(this._diffActions,"mousedown",f=>{if(!f.leftButton)return;const{top:m,height:_}=Xn(this._diffActions),L=Math.floor(c/3);f.preventDefault(),g(f.posx,m+_+L)})),this._register(i.onMouseMove(f=>{(f.target.type===ee.CONTENT_VIEW_ZONE||f.target.type===ee.GUTTER_VIEW_ZONE)&&f.target.detail.viewZoneId===this._getViewZoneId()?(h=this._updateLightBulbPosition(this._marginDomNode,f.event.browserEvent.y,c),this.visibility=!0):this.visibility=!1})),this._register(i.onMouseDown(f=>{f.event.leftButton&&(f.target.type===ee.CONTENT_VIEW_ZONE||f.target.type===ee.GUTTER_VIEW_ZONE)&&f.target.detail.viewZoneId===this._getViewZoneId()&&(f.event.preventDefault(),h=this._updateLightBulbPosition(this._marginDomNode,f.event.browserEvent.y,c),g(f.event.posx,f.event.posy+c))}))}_updateLightBulbPosition(e,t,i){const{top:n}=Xn(e),s=t-n,o=Math.floor(s/i),r=o*i;if(this._diffActions.style.top=`${r}px`,this._viewLineCounts){let l=0;for(let d=0;d<this._viewLineCounts.length;d++)if(l+=this._viewLineCounts[d],o<l)return d}return o}}const Xh=ir("diffEditorWidget",{createHTML:a=>a});function uy(a,e,t,i,n=!1){st(i,e.fontInfo);const s=t.length>0,o=new Jo(1e4);let r=0,l=0;const d=[];for(let g=0;g<a.lineTokens.length;g++){const f=g+1,m=a.lineTokens[g],_=a.lineBreakData[g],L=ni.filter(t,f,1,Number.MAX_SAFE_INTEGER);if(_){let w=0;for(const p of _.breakOffsets){const C=m.sliceAndInflate(w,p,0);r=Math.max(r,Yh(l,C,ni.extractWrapped(L,w,p),s,a.mightContainNonBasicASCII,a.mightContainRTL,e,o,n)),l++,w=p}d.push(_.breakOffsets.length)}else d.push(1),r=Math.max(r,Yh(l,m,L,s,a.mightContainNonBasicASCII,a.mightContainRTL,e,o,n)),l++}r+=e.scrollBeyondLastColumn;const c=o.build(),h=Xh?Xh.createHTML(c):c;i.innerHTML=h;const u=r*e.typicalHalfwidthCharacterWidth;return{heightInLines:l,minWidthInPx:u,viewLineCounts:d}}class gy{constructor(e,t=e.map(s=>null),i=!0,n=!0){this.lineTokens=e,this.lineBreakData=t,this.mightContainNonBasicASCII=i,this.mightContainRTL=n}}class xo{static fromEditor(e){const t=e.getOptions(),i=t.get(v.fontInfo),n=t.get(v.layoutInfo);return new xo(e.getModel()?.getOptions().tabSize||0,i,t.get(v.disableMonospaceOptimizations),i.typicalHalfwidthCharacterWidth,t.get(v.scrollBeyondLastColumn),t.get(v.lineHeight),n.decorationsWidth,t.get(v.stopRenderingLineAfter),t.get(v.renderWhitespace),t.get(v.renderControlCharacters),t.get(v.fontLigatures))}constructor(e,t,i,n,s,o,r,l,d,c,h,u=!0){this.tabSize=e,this.fontInfo=t,this.disableMonospaceOptimizations=i,this.typicalHalfwidthCharacterWidth=n,this.scrollBeyondLastColumn=s,this.lineHeight=o,this.lineDecorationsWidth=r,this.stopRenderingLineAfter=l,this.renderWhitespace=d,this.renderControlCharacters=c,this.fontLigatures=h,this.setWidth=u}withSetWidth(e){return new xo(this.tabSize,this.fontInfo,this.disableMonospaceOptimizations,this.typicalHalfwidthCharacterWidth,this.scrollBeyondLastColumn,this.lineHeight,this.lineDecorationsWidth,this.stopRenderingLineAfter,this.renderWhitespace,this.renderControlCharacters,this.fontLigatures,e)}withScrollBeyondLastColumn(e){return new xo(this.tabSize,this.fontInfo,this.disableMonospaceOptimizations,this.typicalHalfwidthCharacterWidth,e,this.lineHeight,this.lineDecorationsWidth,this.stopRenderingLineAfter,this.renderWhitespace,this.renderControlCharacters,this.fontLigatures,this.setWidth)}}function Yh(a,e,t,i,n,s,o,r,l){r.appendString('<div class="view-line'),!l&&!i&&r.appendString(" char-delete"),r.appendString('" style="top:'),r.appendString(String(a*o.lineHeight)),o.setWidth?r.appendString('px;width:1000000px;">'):r.appendString('px;">');const d=e.getLineContent(),c=Ut.isBasicASCII(d,n),h=Ut.containsRTL(d,c,s),u=Xd(new Ys(o.fontInfo.isMonospace&&!o.disableMonospaceOptimizations,o.fontInfo.canUseHalfwidthRightwardsArrow,d,!1,c,h,0,e,t,o.tabSize,0,o.fontInfo.spaceWidth,o.fontInfo.middotWidth,o.fontInfo.wsmiddotWidth,o.stopRenderingLineAfter,o.renderWhitespace,o.renderControlCharacters,o.fontLigatures!==Na.OFF,null),r);return r.appendString("</div>"),u.characterMapping.getHorizontalOffset(u.characterMapping.length)}let md=class extends U{constructor(e,t,i,n,s,o,r,l,d,c){super(),this._targetWindow=e,this._editors=t,this._diffModel=i,this._options=n,this._diffEditorWidget=s,this._canIgnoreViewZoneUpdateEvent=o,this._origViewZonesToIgnore=r,this._modViewZonesToIgnore=l,this._clipboardService=d,this._contextMenuService=c,this._originalTopPadding=J(this,0),this._originalScrollOffset=J(this,0),this._originalScrollOffsetAnimated=Uh(this._targetWindow,this._originalScrollOffset,this._store),this._modifiedTopPadding=J(this,0),this._modifiedScrollOffset=J(this,0),this._modifiedScrollOffsetAnimated=Uh(this._targetWindow,this._modifiedScrollOffset,this._store);const h=J("invalidateAlignmentsState",0),u=this._register(new Ei(()=>{h.set(h.get()+1,void 0)},0));this._register(this._editors.original.onDidChangeViewZones(p=>{this._canIgnoreViewZoneUpdateEvent()||u.schedule()})),this._register(this._editors.modified.onDidChangeViewZones(p=>{this._canIgnoreViewZoneUpdateEvent()||u.schedule()})),this._register(this._editors.original.onDidChangeConfiguration(p=>{(p.hasChanged(v.wrappingInfo)||p.hasChanged(v.lineHeight))&&u.schedule()})),this._register(this._editors.modified.onDidChangeConfiguration(p=>{(p.hasChanged(v.wrappingInfo)||p.hasChanged(v.lineHeight))&&u.schedule()}));const g=this._diffModel.map(p=>p?Re(this,p.model.original.onDidChangeTokens,()=>p.model.original.tokenization.backgroundTokenizationState===Up.Completed):void 0).map((p,C)=>p?.read(C)),f=z(p=>{const C=this._diffModel.read(p),b=C?.diff.read(p);if(!C||!b)return null;h.read(p);const y=this._options.renderSideBySide.read(p);return Qh(this._editors.original,this._editors.modified,b.mappings,this._origViewZonesToIgnore,this._modViewZonesToIgnore,y)}),m=z(p=>{const C=this._diffModel.read(p)?.movedTextToCompare.read(p);if(!C)return null;h.read(p);const b=C.changes.map(S=>new Jg(S));return Qh(this._editors.original,this._editors.modified,b,this._origViewZonesToIgnore,this._modViewZonesToIgnore,!0)});function _(){const p=document.createElement("div");return p.className="diagonal-fill",p}const L=this._register(new Ot);this.viewZones=qs(this,(p,C)=>{L.clear();const b=f.read(p)||[],S=[],y=[],E=this._modifiedTopPadding.read(p);E>0&&y.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:E,showInHiddenAreas:!0,suppressMouseDown:!0});const x=this._originalTopPadding.read(p);x>0&&S.push({afterLineNumber:0,domNode:document.createElement("div"),heightInPx:x,showInHiddenAreas:!0,suppressMouseDown:!0});const R=this._options.renderSideBySide.read(p),D=R?void 0:this._editors.modified._getViewModel()?.createLineBreaksComputer();if(D){const F=this._editors.original.getModel();for(const Q of b)if(Q.diff)for(let ve=Q.originalRange.startLineNumber;ve<Q.originalRange.endLineNumberExclusive;ve++){if(ve>F.getLineCount())return{orig:S,mod:y};D?.addRequest(F.getLineContent(ve),null,null)}}const A=D?.finalize()??[];let W=0;const H=this._editors.modified.getOption(v.lineHeight),G=this._diffModel.read(p)?.movedTextToCompare.read(p),oe=this._editors.original.getModel()?.mightContainNonBasicASCII()??!1,X=this._editors.original.getModel()?.mightContainRTL()??!1,te=xo.fromEditor(this._editors.modified);for(const F of b)if(F.diff&&!R&&(!this._options.useTrueInlineDiffRendering.read(p)||!pc(F.diff))){if(!F.originalRange.isEmpty){g.read(p);const ve=document.createElement("div");ve.classList.add("view-lines","line-delete","monaco-mouse-cursor-text");const Pt=this._editors.original.getModel();if(F.originalRange.endLineNumberExclusive-1>Pt.getLineCount())return{orig:S,mod:y};const ai=new gy(F.originalRange.mapToLineArray(Dt=>Pt.tokenization.getLineTokens(Dt)),F.originalRange.mapToLineArray(Dt=>A[W++]),oe,X),li=[];for(const Dt of F.diff.innerChanges||[])li.push(new _o(Dt.originalRange.delta(-(F.diff.original.startLineNumber-1)),fd.className,Be.Regular));const rs=uy(ai,te,li,ve),to=document.createElement("div");if(to.className="inline-deleted-margin-view-zone",st(to,te.fontInfo),this._options.renderIndicators.read(p))for(let Dt=0;Dt<rs.heightInLines;Dt++){const as=document.createElement("div");as.className=`delete-sign ${ut.asClassName(Qg)}`,as.setAttribute("style",`position:absolute;top:${Dt*H}px;width:${te.lineDecorationsWidth}px;height:${H}px;right:0;`),to.appendChild(as)}let yc;L.add(new hy(()=>ku(yc),to,this._editors.modified,F.diff,this._diffEditorWidget,rs.viewLineCounts,this._editors.original.getModel(),this._contextMenuService,this._clipboardService));for(let Dt=0;Dt<rs.viewLineCounts.length;Dt++){const as=rs.viewLineCounts[Dt];as>1&&S.push({afterLineNumber:F.originalRange.startLineNumber+Dt,domNode:_(),heightInPx:(as-1)*H,showInHiddenAreas:!0,suppressMouseDown:!0})}y.push({afterLineNumber:F.modifiedRange.startLineNumber-1,domNode:ve,heightInPx:rs.heightInLines*H,minWidthInPx:rs.minWidthInPx,marginDomNode:to,setZoneId(Dt){yc=Dt},showInHiddenAreas:!0,suppressMouseDown:!0})}const Q=document.createElement("div");Q.className="gutter-delete",S.push({afterLineNumber:F.originalRange.endLineNumberExclusive-1,domNode:_(),heightInPx:F.modifiedHeightInPx,marginDomNode:Q,showInHiddenAreas:!0,suppressMouseDown:!0})}else{const Q=F.modifiedHeightInPx-F.originalHeightInPx;if(Q>0){if(G?.lineRangeMapping.original.delta(-1).deltaLength(2).contains(F.originalRange.endLineNumberExclusive-1))continue;S.push({afterLineNumber:F.originalRange.endLineNumberExclusive-1,domNode:_(),heightInPx:Q,showInHiddenAreas:!0,suppressMouseDown:!0})}else{let ve=function(){const ai=document.createElement("div");return ai.className="arrow-revert-change "+ut.asClassName(It.arrowRight),C.add(Y(ai,"mousedown",li=>li.stopPropagation())),C.add(Y(ai,"click",li=>{li.stopPropagation(),s.revert(F.diff)})),bs("div",{},ai)};if(G?.lineRangeMapping.modified.delta(-1).deltaLength(2).contains(F.modifiedRange.endLineNumberExclusive-1))continue;let Pt;F.diff&&F.diff.modified.isEmpty&&this._options.shouldRenderOldRevertArrows.read(p)&&(Pt=ve()),y.push({afterLineNumber:F.modifiedRange.endLineNumberExclusive-1,domNode:_(),heightInPx:-Q,marginDomNode:Pt,showInHiddenAreas:!0,suppressMouseDown:!0})}}for(const F of m.read(p)??[]){if(!G?.lineRangeMapping.original.intersect(F.originalRange)||!G?.lineRangeMapping.modified.intersect(F.modifiedRange))continue;const Q=F.modifiedHeightInPx-F.originalHeightInPx;Q>0?S.push({afterLineNumber:F.originalRange.endLineNumberExclusive-1,domNode:_(),heightInPx:Q,showInHiddenAreas:!0,suppressMouseDown:!0}):y.push({afterLineNumber:F.modifiedRange.endLineNumberExclusive-1,domNode:_(),heightInPx:-Q,showInHiddenAreas:!0,suppressMouseDown:!0})}return{orig:S,mod:y}});let w=!1;this._register(this._editors.original.onDidScrollChange(p=>{p.scrollLeftChanged&&!w&&(w=!0,this._editors.modified.setScrollLeft(p.scrollLeft),w=!1)})),this._register(this._editors.modified.onDidScrollChange(p=>{p.scrollLeftChanged&&!w&&(w=!0,this._editors.original.setScrollLeft(p.scrollLeft),w=!1)})),this._originalScrollTop=Re(this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=Re(this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._register(ce(p=>{const C=this._originalScrollTop.read(p)-(this._originalScrollOffsetAnimated.get()-this._modifiedScrollOffsetAnimated.read(p))-(this._originalTopPadding.get()-this._modifiedTopPadding.read(p));C!==this._editors.modified.getScrollTop()&&this._editors.modified.setScrollTop(C,K.Immediate)})),this._register(ce(p=>{const C=this._modifiedScrollTop.read(p)-(this._modifiedScrollOffsetAnimated.get()-this._originalScrollOffsetAnimated.read(p))-(this._modifiedTopPadding.get()-this._originalTopPadding.read(p));C!==this._editors.original.getScrollTop()&&this._editors.original.setScrollTop(C,K.Immediate)})),this._register(ce(p=>{const C=this._diffModel.read(p)?.movedTextToCompare.read(p);let b=0;if(C){const S=this._editors.original.getTopForLineNumber(C.lineRangeMapping.original.startLineNumber,!0)-this._originalTopPadding.get();b=this._editors.modified.getTopForLineNumber(C.lineRangeMapping.modified.startLineNumber,!0)-this._modifiedTopPadding.get()-S}b>0?(this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(b,void 0)):b<0?(this._modifiedTopPadding.set(-b,void 0),this._originalTopPadding.set(0,void 0)):setTimeout(()=>{this._modifiedTopPadding.set(0,void 0),this._originalTopPadding.set(0,void 0)},400),this._editors.modified.hasTextFocus()?this._originalScrollOffset.set(this._modifiedScrollOffset.get()-b,void 0,!0):this._modifiedScrollOffset.set(this._originalScrollOffset.get()+b,void 0,!0)}))}};md=ge([P(8,Ku),P(9,Ma)],md);function Qh(a,e,t,i,n,s){const o=new As(Jh(a,i)),r=new As(Jh(e,n)),l=a.getOption(v.lineHeight),d=e.getOption(v.lineHeight),c=[];let h=0,u=0;function g(f,m){for(;;){let _=o.peek(),L=r.peek();if(_&&_.lineNumber>=f&&(_=void 0),L&&L.lineNumber>=m&&(L=void 0),!_&&!L)break;const w=_?_.lineNumber-h:Number.MAX_VALUE,p=L?L.lineNumber-u:Number.MAX_VALUE;w<p?(o.dequeue(),L={lineNumber:_.lineNumber-h+u,heightInPx:0}):w>p?(r.dequeue(),_={lineNumber:L.lineNumber-u+h,heightInPx:0}):(o.dequeue(),r.dequeue()),c.push({originalRange:Ve.ofLength(_.lineNumber,1),modifiedRange:Ve.ofLength(L.lineNumber,1),originalHeightInPx:l+_.heightInPx,modifiedHeightInPx:d+L.heightInPx,diff:void 0})}}for(const f of t){let p=function(C,b,S=!1){if(C<w||b<L)return;if(_)_=!1;else if(!S&&(C===w||b===L))return;const y=new Ve(w,C),E=new Ve(L,b);if(y.isEmpty&&E.isEmpty)return;const x=o.takeWhile(D=>D.lineNumber<C)?.reduce((D,A)=>D+A.heightInPx,0)??0,R=r.takeWhile(D=>D.lineNumber<b)?.reduce((D,A)=>D+A.heightInPx,0)??0;c.push({originalRange:y,modifiedRange:E,originalHeightInPx:y.length*l+x,modifiedHeightInPx:E.length*d+R,diff:f.lineRangeMapping}),w=C,L=b};const m=f.lineRangeMapping;g(m.original.startLineNumber,m.modified.startLineNumber);let _=!0,L=m.modified.startLineNumber,w=m.original.startLineNumber;if(s)for(const C of m.innerChanges||[]){C.originalRange.startColumn>1&&C.modifiedRange.startColumn>1&&p(C.originalRange.startLineNumber,C.modifiedRange.startLineNumber);const b=a.getModel(),S=C.originalRange.endLineNumber<=b.getLineCount()?b.getLineMaxColumn(C.originalRange.endLineNumber):Number.MAX_SAFE_INTEGER;C.originalRange.endColumn<S&&p(C.originalRange.endLineNumber,C.modifiedRange.endLineNumber)}p(m.original.endLineNumberExclusive,m.modified.endLineNumberExclusive,!0),h=m.original.endLineNumberExclusive,u=m.modified.endLineNumberExclusive}return g(Number.MAX_VALUE,Number.MAX_VALUE),c}function Jh(a,e){const t=[],i=[],n=a.getOption(v.wrappingInfo).wrappingColumn!==-1,s=a._getViewModel().coordinatesConverter,o=a.getOption(v.lineHeight);if(n)for(let l=1;l<=a.getModel().getLineCount();l++){const d=s.getModelLineViewLineCount(l);d>1&&i.push({lineNumber:l,heightInPx:o*(d-1)})}for(const l of a.getWhitespaces()){if(e.has(l.id))continue;const d=l.afterLineNumber===0?0:s.convertViewPositionToModelPosition(new I(l.afterLineNumber,1)).lineNumber;t.push({lineNumber:d,heightInPx:l.height})}return HS(t,i,l=>l.lineNumber,(l,d)=>({lineNumber:l.lineNumber,heightInPx:l.heightInPx+d.heightInPx}))}function pc(a){return a.innerChanges?a.innerChanges.every(e=>eu(e.modifiedRange)&&eu(e.originalRange)||e.originalRange.equalsRange(new N(1,1,1,1))):!1}function eu(a){return a.startLineNumber===a.endLineNumber}class qn extends U{static{this.movedCodeBlockPadding=4}constructor(e,t,i,n,s){super(),this._rootElement=e,this._diffModel=t,this._originalEditorLayoutInfo=i,this._modifiedEditorLayoutInfo=n,this._editors=s,this._originalScrollTop=Re(this,this._editors.original.onDidScrollChange,()=>this._editors.original.getScrollTop()),this._modifiedScrollTop=Re(this,this._editors.modified.onDidScrollChange,()=>this._editors.modified.getScrollTop()),this._viewZonesChanged=qt("onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this.width=J(this,0),this._modifiedViewZonesChangedSignal=qt("modified.onDidChangeViewZones",this._editors.modified.onDidChangeViewZones),this._originalViewZonesChangedSignal=qt("original.onDidChangeViewZones",this._editors.original.onDidChangeViewZones),this._state=qs(this,(c,h)=>{this._element.replaceChildren();const u=this._diffModel.read(c),g=u?.diff.read(c)?.movedTexts;if(!g||g.length===0){this.width.set(0,void 0);return}this._viewZonesChanged.read(c);const f=this._originalEditorLayoutInfo.read(c),m=this._modifiedEditorLayoutInfo.read(c);if(!f||!m){this.width.set(0,void 0);return}this._modifiedViewZonesChangedSignal.read(c),this._originalViewZonesChangedSignal.read(c);const _=g.map(y=>{function E(X,te){const F=te.getTopForLineNumber(X.startLineNumber,!0),Q=te.getTopForLineNumber(X.endLineNumberExclusive,!0);return(F+Q)/2}const x=E(y.lineRangeMapping.original,this._editors.original),R=this._originalScrollTop.read(c),D=E(y.lineRangeMapping.modified,this._editors.modified),A=this._modifiedScrollTop.read(c),W=x-R,H=D-A,G=Math.min(x,D),oe=Math.max(x,D);return{range:new ii(G,oe),from:W,to:H,fromWithoutScroll:x,toWithoutScroll:D,move:y}});_.sort(Gp(Gn(y=>y.fromWithoutScroll>y.toWithoutScroll,jp),Gn(y=>y.fromWithoutScroll>y.toWithoutScroll?y.fromWithoutScroll:-y.toWithoutScroll,Gd)));const L=_c.compute(_.map(y=>y.range)),w=10,p=f.verticalScrollbarWidth,C=(L.getTrackCount()-1)*10+w*2,b=p+C+(m.contentLeft-qn.movedCodeBlockPadding);let S=0;for(const y of _){const E=L.getTrack(S),x=p+w+E*10,R=15,D=15,A=b,W=m.glyphMarginWidth+m.lineNumbersWidth,H=18,G=document.createElementNS("http://www.w3.org/2000/svg","rect");G.classList.add("arrow-rectangle"),G.setAttribute("x",`${A-W}`),G.setAttribute("y",`${y.to-H/2}`),G.setAttribute("width",`${W}`),G.setAttribute("height",`${H}`),this._element.appendChild(G);const oe=document.createElementNS("http://www.w3.org/2000/svg","g"),X=document.createElementNS("http://www.w3.org/2000/svg","path");X.setAttribute("d",`M 0 ${y.from} L ${x} ${y.from} L ${x} ${y.to} L ${A-D} ${y.to}`),X.setAttribute("fill","none"),oe.appendChild(X);const te=document.createElementNS("http://www.w3.org/2000/svg","polygon");te.classList.add("arrow"),h.add(ce(F=>{X.classList.toggle("currentMove",y.move===u.activeMovedText.read(F)),te.classList.toggle("currentMove",y.move===u.activeMovedText.read(F))})),te.setAttribute("points",`${A-D},${y.to-R/2} ${A},${y.to} ${A-D},${y.to+R/2}`),oe.appendChild(te),this._element.appendChild(oe),S++}this.width.set(C,void 0)}),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("class","moved-blocks-lines"),this._rootElement.appendChild(this._element),this._register(ke(()=>this._element.remove())),this._register(ce(c=>{const h=this._originalEditorLayoutInfo.read(c),u=this._modifiedEditorLayoutInfo.read(c);!h||!u||(this._element.style.left=`${h.width-h.verticalScrollbarWidth}px`,this._element.style.height=`${h.height}px`,this._element.style.width=`${h.verticalScrollbarWidth+h.contentLeft-qn.movedCodeBlockPadding+this.width.read(c)}px`)})),this._register(Ud(this._state));const o=z(c=>{const u=this._diffModel.read(c)?.diff.read(c);return u?u.movedTexts.map(g=>({move:g,original:new Ls($r(g.lineRangeMapping.original.startLineNumber-1),18),modified:new Ls($r(g.lineRangeMapping.modified.startLineNumber-1),18)})):[]});this._register(ga(this._editors.original,o.map(c=>c.map(h=>h.original)))),this._register(ga(this._editors.modified,o.map(c=>c.map(h=>h.modified)))),this._register(Ci((c,h)=>{const u=o.read(c);for(const g of u)h.add(new tu(this._editors.original,g.original,g.move,"original",this._diffModel.get())),h.add(new tu(this._editors.modified,g.modified,g.move,"modified",this._diffModel.get()))}));const r=qt("original.onDidFocusEditorWidget",c=>this._editors.original.onDidFocusEditorWidget(()=>setTimeout(()=>c(void 0),0))),l=qt("modified.onDidFocusEditorWidget",c=>this._editors.modified.onDidFocusEditorWidget(()=>setTimeout(()=>c(void 0),0)));let d="modified";this._register(Oa({changeTracker:{createChangeSummary:()=>{},handleChange:(c,h)=>(c.didChange(r)&&(d="original"),c.didChange(l)&&(d="modified"),!0)}},c=>{r.read(c),l.read(c);const h=this._diffModel.read(c);if(!h)return;const u=h.diff.read(c);let g;if(u&&d==="original"){const f=this._editors.originalCursor.read(c);f&&(g=u.movedTexts.find(m=>m.lineRangeMapping.original.contains(f.lineNumber)))}if(u&&d==="modified"){const f=this._editors.modifiedCursor.read(c);f&&(g=u.movedTexts.find(m=>m.lineRangeMapping.modified.contains(f.lineNumber)))}g!==h.movedTextToCompare.get()&&h.movedTextToCompare.set(void 0,void 0),h.setActiveMovedText(g)}))}}class _c{static compute(e){const t=[],i=[];for(const n of e){let s=t.findIndex(o=>!o.intersectsStrict(n));s===-1&&(t.length>=6?s=Kp(t,Gn(r=>r.intersectWithRangeLength(n),Gd)):(s=t.length,t.push(new $p))),t[s].addRange(n),i.push(s)}return new _c(t.length,i)}constructor(e,t){this._trackCount=e,this.trackPerLineIdx=t}getTrack(e){return this.trackPerLineIdx[e]}getTrackCount(){return this._trackCount}}class tu extends gc{constructor(e,t,i,n,s){const o=ae("div.diff-hidden-lines-widget");super(e,t,o.root),this._editor=e,this._move=i,this._kind=n,this._diffModel=s,this._nodes=ae("div.diff-moved-code-block",{style:{marginRight:"4px"}},[ae("div.text-content@textContent"),ae("div.action-bar@actionBar")]),o.root.appendChild(this._nodes.root);const r=Re(this._editor.onDidLayoutChange,()=>this._editor.getLayoutInfo());this._register(fn(this._nodes.root,{paddingRight:r.map(u=>u.verticalScrollbarWidth)}));let l;i.changes.length>0?l=this._kind==="original"?O(194,"Code moved with changes to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):O(195,"Code moved with changes from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1):l=this._kind==="original"?O(196,"Code moved to line {0}-{1}",this._move.lineRangeMapping.modified.startLineNumber,this._move.lineRangeMapping.modified.endLineNumberExclusive-1):O(197,"Code moved from line {0}-{1}",this._move.lineRangeMapping.original.startLineNumber,this._move.lineRangeMapping.original.endLineNumberExclusive-1);const d=this._register(new Fd(this._nodes.actionBar,{highlightToggledItems:!0})),c=new Ss("",l,"",!1);d.push(c,{icon:!1,label:!0});const h=new Ss("","Compare",ut.asClassName(It.compareChanges),!0,()=>{this._editor.focus(),this._diffModel.movedTextToCompare.set(this._diffModel.movedTextToCompare.get()===i?void 0:this._move,void 0)});this._register(ce(u=>{const g=this._diffModel.movedTextToCompare.read(u)===i;h.checked=g})),d.push(h,{icon:!1,label:!0})}}class fy extends U{constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._decorations=z(this,s=>{const o=this._diffModel.read(s),r=o?.diff.read(s);if(!r)return null;const l=this._diffModel.read(s).movedTextToCompare.read(s),d=this._options.renderIndicators.read(s),c=this._options.showEmptyDecorations.read(s),h=[],u=[];if(!l)for(const f of r.mappings)if(f.lineRangeMapping.original.isEmpty||h.push({range:f.lineRangeMapping.original.toInclusiveRange(),options:d?Kh:Zh}),f.lineRangeMapping.modified.isEmpty||u.push({range:f.lineRangeMapping.modified.toInclusiveRange(),options:d?jh:$h}),f.lineRangeMapping.modified.isEmpty||f.lineRangeMapping.original.isEmpty)f.lineRangeMapping.original.isEmpty||h.push({range:f.lineRangeMapping.original.toInclusiveRange(),options:ry}),f.lineRangeMapping.modified.isEmpty||u.push({range:f.lineRangeMapping.modified.toInclusiveRange(),options:sy});else{const m=this._options.useTrueInlineDiffRendering.read(s)&&pc(f.lineRangeMapping);for(const _ of f.lineRangeMapping.innerChanges||[])if(f.lineRangeMapping.original.contains(_.originalRange.startLineNumber)&&h.push({range:_.originalRange,options:_.originalRange.isEmpty()&&c?ay:fd}),f.lineRangeMapping.modified.contains(_.modifiedRange.startLineNumber)&&u.push({range:_.modifiedRange,options:_.modifiedRange.isEmpty()&&c&&!m?oy:qh}),m){const L=o.model.original.getValueInRange(_.originalRange);u.push({range:_.modifiedRange,options:{description:"deleted-text",before:{content:L,inlineClassName:"inline-deleted-text"},zIndex:1e5,showIfCollapsed:!0}})}}if(l)for(const f of l.changes){const m=f.original.toInclusiveRange();m&&h.push({range:m,options:d?Kh:Zh});const _=f.modified.toInclusiveRange();_&&u.push({range:_,options:d?jh:$h});for(const L of f.innerChanges||[])h.push({range:L.originalRange,options:fd}),u.push({range:L.modifiedRange,options:qh})}const g=this._diffModel.read(s).activeMovedText.read(s);for(const f of r.movedTexts)h.push({range:f.lineRangeMapping.original.toInclusiveRange(),options:{description:"moved",blockClassName:"movedOriginal"+(f===g?" currentMove":""),blockPadding:[qn.movedCodeBlockPadding,0,qn.movedCodeBlockPadding,qn.movedCodeBlockPadding]}}),u.push({range:f.lineRangeMapping.modified.toInclusiveRange(),options:{description:"moved",blockClassName:"movedModified"+(f===g?" currentMove":""),blockPadding:[4,0,4,4]}});return{originalDecorations:h,modifiedDecorations:u}}),this._register(ua(this._editors.original,this._decorations.map(s=>s?.originalDecorations||[]))),this._register(ua(this._editors.modified,this._decorations.map(s=>s?.modifiedDecorations||[])))}}var ci;let Bs=class extends U{static{ci=this}static{this.ONE_OVERVIEW_WIDTH=15}static{this.ENTIRE_DIFF_OVERVIEW_WIDTH=this.ONE_OVERVIEW_WIDTH*2}constructor(e,t,i,n,s,o,r){super(),this._editors=e,this._rootElement=t,this._diffModel=i,this._rootWidth=n,this._rootHeight=s,this._modifiedEditorLayoutInfo=o,this._themeService=r,this.width=ci.ENTIRE_DIFF_OVERVIEW_WIDTH;const l=Re(this._themeService.onDidColorThemeChange,()=>this._themeService.getColorTheme()),d=z(u=>{const g=l.read(u),f=g.getColor(Zp)||(g.getColor(Xp)||qp).transparent(2),m=g.getColor(Yp)||(g.getColor(Jp)||Qp).transparent(2);return{insertColor:f,removeColor:m}}),c=fe(document.createElement("div"));c.setClassName("diffViewport"),c.setPosition("absolute");const h=ae("div.diffOverview",{style:{position:"absolute",top:"0px",width:ci.ENTIRE_DIFF_OVERVIEW_WIDTH+"px"}}).root;this._register(go(h,c.domNode)),this._register(zn(h,mt.POINTER_DOWN,u=>{this._editors.modified.delegateVerticalScrollbarPointerDown(u)})),this._register(Y(h,mt.MOUSE_WHEEL,u=>{this._editors.modified.delegateScrollFromMouseWheelEvent(u)},{passive:!1})),this._register(go(this._rootElement,h)),this._register(Ci((u,g)=>{const f=this._diffModel.read(u),m=this._editors.original.createOverviewRuler("original diffOverviewRuler");m&&(g.add(m),g.add(go(h,m.getDomNode())));const _=this._editors.modified.createOverviewRuler("modified diffOverviewRuler");if(_&&(g.add(_),g.add(go(h,_.getDomNode()))),!m||!_)return;const L=qt("viewZoneChanged",this._editors.original.onDidChangeViewZones),w=qt("viewZoneChanged",this._editors.modified.onDidChangeViewZones),p=qt("hiddenRangesChanged",this._editors.original.onDidChangeHiddenAreas),C=qt("hiddenRangesChanged",this._editors.modified.onDidChangeHiddenAreas);g.add(ce(b=>{L.read(b),w.read(b),p.read(b),C.read(b);const S=d.read(b),y=f?.diff.read(b)?.mappings;function E(D,A,W){const H=W._getViewModel();return H?D.filter(G=>G.length>0).map(G=>{const oe=H.coordinatesConverter.convertModelPositionToViewPosition(new I(G.startLineNumber,1)),X=H.coordinatesConverter.convertModelPositionToViewPosition(new I(G.endLineNumberExclusive,1)),te=X.lineNumber-oe.lineNumber;return new Vg(oe.lineNumber,X.lineNumber,te,A.toString())}):[]}const x=E((y||[]).map(D=>D.lineRangeMapping.original),S.removeColor,this._editors.original),R=E((y||[]).map(D=>D.lineRangeMapping.modified),S.insertColor,this._editors.modified);m?.setZones(x),_?.setZones(R)})),g.add(ce(b=>{const S=this._rootHeight.read(b),y=this._rootWidth.read(b),E=this._modifiedEditorLayoutInfo.read(b);if(E){const x=ci.ENTIRE_DIFF_OVERVIEW_WIDTH-2*ci.ONE_OVERVIEW_WIDTH;m.setLayout({top:0,height:S,right:x+ci.ONE_OVERVIEW_WIDTH,width:ci.ONE_OVERVIEW_WIDTH}),_.setLayout({top:0,height:S,right:0,width:ci.ONE_OVERVIEW_WIDTH});const R=this._editors.modifiedScrollTop.read(b),D=this._editors.modifiedScrollHeight.read(b),A=this._editors.modified.getOption(v.scrollbar),W=new e_(A.verticalHasArrows?A.arrowSize:0,A.verticalScrollbarSize,0,E.height,D,R);c.setTop(W.getSliderPosition()),c.setHeight(W.getSliderSize())}else c.setTop(0),c.setHeight(0);h.style.height=S+"px",h.style.left=y-ci.ENTIRE_DIFF_OVERVIEW_WIDTH+"px",c.setWidth(ci.ENTIRE_DIFF_OVERVIEW_WIDTH)}))}))}};Bs=ci=ge([P(6,sr)],Bs);let pd=class extends U{get onDidContentSizeChange(){return this._onDidContentSizeChange.event}constructor(e,t,i,n,s,o,r,l){super(),this.originalEditorElement=e,this.modifiedEditorElement=t,this._options=i,this._argCodeEditorWidgetOptions=n,this._createInnerEditor=s,this._contextKeyService=o,this._instantiationService=r,this._keybindingService=l,this.original=this._register(this._createLeftHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.originalEditor||{})),this.modified=this._register(this._createRightHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.modifiedEditor||{})),this._onDidContentSizeChange=this._register(new Z),this.modifiedScrollTop=Re(this,this.modified.onDidScrollChange,()=>this.modified.getScrollTop()),this.modifiedScrollHeight=Re(this,this.modified.onDidScrollChange,()=>this.modified.getScrollHeight()),this.modifiedObs=Hn(this.modified),this.originalObs=Hn(this.original),this.modifiedModel=this.modifiedObs.model,this.modifiedSelections=Re(this,this.modified.onDidChangeCursorSelection,()=>this.modified.getSelections()??[]),this.modifiedCursor=Mr({owner:this,equalsFn:I.equals},d=>this.modifiedSelections.read(d)[0]?.getPosition()??new I(1,1)),this.originalCursor=Re(this,this.original.onDidChangeCursorPosition,()=>this.original.getPosition()??new I(1,1)),this.isOriginalFocused=Hn(this.original).isFocused,this.isModifiedFocused=Hn(this.modified).isFocused,this.isFocused=z(this,d=>this.isOriginalFocused.read(d)||this.isModifiedFocused.read(d)),this._argCodeEditorWidgetOptions=null,this._register(Oa({changeTracker:{createChangeSummary:()=>({}),handleChange:(d,c)=>(d.didChange(i.editorOptions)&&Object.assign(c,d.change.changedOptions),!0)}},(d,c)=>{i.editorOptions.read(d),this._options.renderSideBySide.read(d),this.modified.updateOptions(this._adjustOptionsForRightHandSide(d,c)),this.original.updateOptions(this._adjustOptionsForLeftHandSide(d,c))}))}_createLeftHandSideEditor(e,t){const i=this._adjustOptionsForLeftHandSide(void 0,e),n=this._constructInnerEditor(this._instantiationService,this.originalEditorElement,i,t),s=this._contextKeyService.createKey("isInDiffLeftEditor",n.hasWidgetFocus());return this._register(n.onDidFocusEditorWidget(()=>s.set(!0))),this._register(n.onDidBlurEditorWidget(()=>s.set(!1))),n}_createRightHandSideEditor(e,t){const i=this._adjustOptionsForRightHandSide(void 0,e),n=this._constructInnerEditor(this._instantiationService,this.modifiedEditorElement,i,t),s=this._contextKeyService.createKey("isInDiffRightEditor",n.hasWidgetFocus());return this._register(n.onDidFocusEditorWidget(()=>s.set(!0))),this._register(n.onDidBlurEditorWidget(()=>s.set(!1))),n}_constructInnerEditor(e,t,i,n){const s=this._createInnerEditor(e,t,i,n);return this._register(s.onDidContentSizeChange(o=>{const r=this.original.getContentWidth()+this.modified.getContentWidth()+Bs.ENTIRE_DIFF_OVERVIEW_WIDTH,l=Math.max(this.modified.getContentHeight(),this.original.getContentHeight());this._onDidContentSizeChange.fire({contentHeight:l,contentWidth:r,contentHeightChanged:o.contentHeightChanged,contentWidthChanged:o.contentWidthChanged})})),s}_adjustOptionsForLeftHandSide(e,t){const i=this._adjustOptionsForSubEditor(t);return this._options.renderSideBySide.get()?(i.unicodeHighlight=this._options.editorOptions.get().unicodeHighlight||{},i.wordWrapOverride1=this._options.diffWordWrap.get()):(i.wordWrapOverride1="off",i.wordWrapOverride2="off",i.stickyScroll={enabled:!1},i.unicodeHighlight={nonBasicASCII:!1,ambiguousCharacters:!1,invisibleCharacters:!1}),i.glyphMargin=this._options.renderSideBySide.get(),t.originalAriaLabel&&(i.ariaLabel=t.originalAriaLabel),i.ariaLabel=this._updateAriaLabel(i.ariaLabel),i.readOnly=!this._options.originalEditable.get(),i.dropIntoEditor={enabled:!i.readOnly},i.extraEditorClassName="original-in-monaco-diff-editor",i}_adjustOptionsForRightHandSide(e,t){const i=this._adjustOptionsForSubEditor(t);return t.modifiedAriaLabel&&(i.ariaLabel=t.modifiedAriaLabel),i.ariaLabel=this._updateAriaLabel(i.ariaLabel),i.wordWrapOverride1=this._options.diffWordWrap.get(),i.revealHorizontalRightPadding=Vt.revealHorizontalRightPadding.defaultValue+Bs.ENTIRE_DIFF_OVERVIEW_WIDTH,i.scrollbar.verticalHasArrows=!1,i.extraEditorClassName="modified-in-monaco-diff-editor",i}_adjustOptionsForSubEditor(e){const t={...e,dimension:{height:0,width:0}};return t.inDiffEditor=!0,t.automaticLayout=!1,t.scrollbar={...t.scrollbar||{}},t.folding=!1,t.codeLens=this._options.diffCodeLens.get(),t.fixedOverflowWidgets=!0,t.minimap={...t.minimap||{}},t.minimap.enabled=!1,this._options.hideUnchangedRegions.get()?t.stickyScroll={enabled:!1}:t.stickyScroll=this._options.editorOptions.get().stickyScroll,t}_updateAriaLabel(e){e||(e="");const t=O(175," use {0} to open the accessibility help.",this._keybindingService.lookupKeybinding("editor.action.accessibilityHelp")?.getAriaLabel());return this._options.accessibilityVerbose.get()?e+t:e?e.replaceAll(t,""):""}};pd=ge([P(5,ot),P(6,Me),P(7,wi)],pd);class my{resetSash(){this._sashRatio.set(void 0,void 0)}constructor(e,t){this._options=e,this.dimensions=t,this.sashLeft=Wd(this,i=>{const n=this._sashRatio.read(i)??this._options.splitViewDefaultRatio.read(i);return this._computeSashLeft(n,i)},(i,n)=>{const s=this.dimensions.width.get();this._sashRatio.set(i/s,n)}),this._sashRatio=J(this,void 0)}_computeSashLeft(e,t){const i=this.dimensions.width.read(t),n=Math.floor(this._options.splitViewDefaultRatio.read(t)*i),s=this._options.enableSplitViewResizing.read(t)?Math.floor(e*i):n,o=100;return i<=o*2?n:s<o?o:s>i-o?i-o:s}}class ef extends U{constructor(e,t,i,n,s,o){super(),this._domNode=e,this._dimensions=t,this._enabled=i,this._boundarySashes=n,this.sashLeft=s,this._resetSash=o,this._sash=this._register(new t_(this._domNode,{getVerticalSashTop:r=>0,getVerticalSashLeft:r=>this.sashLeft.get(),getVerticalSashHeight:r=>this._dimensions.height.get()},{orientation:i_.VERTICAL})),this._startSashPosition=void 0,this._register(this._sash.onDidStart(()=>{this._startSashPosition=this.sashLeft.get()})),this._register(this._sash.onDidChange(r=>{this.sashLeft.set(this._startSashPosition+(r.currentX-r.startX),void 0)})),this._register(this._sash.onDidEnd(()=>this._sash.layout())),this._register(this._sash.onDidReset(()=>this._resetSash())),this._register(ce(r=>{const l=this._boundarySashes.read(r);l&&(this._sash.orthogonalEndSash=l.bottom)})),this._register(ce(r=>{const l=this._enabled.read(r);this._sash.state=l?jc.Enabled:jc.Disabled,this.sashLeft.read(r),this._dimensions.height.read(r),this._sash.layout()}))}}class Cc extends U{constructor(){super(...arguments),this._id=++Cc.idCounter,this._onDidDispose=this._register(new Z),this.onDidDispose=this._onDidDispose.event}static{this.idCounter=0}getId(){return this.getEditorType()+":v2:"+this._id}getVisibleColumnFromPosition(e){return this._targetEditor.getVisibleColumnFromPosition(e)}getStatusbarColumn(e){return this._targetEditor.getStatusbarColumn(e)}getPosition(){return this._targetEditor.getPosition()}setPosition(e,t="api"){this._targetEditor.setPosition(e,t)}revealLine(e,t=K.Smooth){this._targetEditor.revealLine(e,t)}revealLineInCenter(e,t=K.Smooth){this._targetEditor.revealLineInCenter(e,t)}revealLineInCenterIfOutsideViewport(e,t=K.Smooth){this._targetEditor.revealLineInCenterIfOutsideViewport(e,t)}revealLineNearTop(e,t=K.Smooth){this._targetEditor.revealLineNearTop(e,t)}revealPosition(e,t=K.Smooth){this._targetEditor.revealPosition(e,t)}revealPositionInCenter(e,t=K.Smooth){this._targetEditor.revealPositionInCenter(e,t)}revealPositionInCenterIfOutsideViewport(e,t=K.Smooth){this._targetEditor.revealPositionInCenterIfOutsideViewport(e,t)}revealPositionNearTop(e,t=K.Smooth){this._targetEditor.revealPositionNearTop(e,t)}getSelection(){return this._targetEditor.getSelection()}getSelections(){return this._targetEditor.getSelections()}setSelection(e,t="api"){this._targetEditor.setSelection(e,t)}setSelections(e,t="api"){this._targetEditor.setSelections(e,t)}revealLines(e,t,i=K.Smooth){this._targetEditor.revealLines(e,t,i)}revealLinesInCenter(e,t,i=K.Smooth){this._targetEditor.revealLinesInCenter(e,t,i)}revealLinesInCenterIfOutsideViewport(e,t,i=K.Smooth){this._targetEditor.revealLinesInCenterIfOutsideViewport(e,t,i)}revealLinesNearTop(e,t,i=K.Smooth){this._targetEditor.revealLinesNearTop(e,t,i)}revealRange(e,t=K.Smooth,i=!1,n=!0){this._targetEditor.revealRange(e,t,i,n)}revealRangeInCenter(e,t=K.Smooth){this._targetEditor.revealRangeInCenter(e,t)}revealRangeInCenterIfOutsideViewport(e,t=K.Smooth){this._targetEditor.revealRangeInCenterIfOutsideViewport(e,t)}revealRangeNearTop(e,t=K.Smooth){this._targetEditor.revealRangeNearTop(e,t)}revealRangeNearTopIfOutsideViewport(e,t=K.Smooth){this._targetEditor.revealRangeNearTopIfOutsideViewport(e,t)}revealRangeAtTop(e,t=K.Smooth){this._targetEditor.revealRangeAtTop(e,t)}getSupportedActions(){return this._targetEditor.getSupportedActions()}focus(){this._targetEditor.focus()}trigger(e,t,i){this._targetEditor.trigger(e,t,i)}createDecorationsCollection(e){return this._targetEditor.createDecorationsCollection(e)}changeDecorations(e){return this._targetEditor.changeDecorations(e)}}let ma=class{get editorOptions(){return this._options}constructor(e,t){this._accessibilityService=t,this._diffEditorWidth=J(this,0),this._screenReaderMode=Re(this,this._accessibilityService.onDidChangeScreenReaderOptimized,()=>this._accessibilityService.isScreenReaderOptimized()),this.couldShowInlineViewBecauseOfSize=z(this,n=>this._options.read(n).renderSideBySide&&this._diffEditorWidth.read(n)<=this._options.read(n).renderSideBySideInlineBreakpoint),this.renderOverviewRuler=z(this,n=>this._options.read(n).renderOverviewRuler),this.renderSideBySide=z(this,n=>this.compactMode.read(n)&&this.shouldRenderInlineViewInSmartMode.read(n)?!1:this._options.read(n).renderSideBySide&&!(this._options.read(n).useInlineViewWhenSpaceIsLimited&&this.couldShowInlineViewBecauseOfSize.read(n)&&!this._screenReaderMode.read(n))),this.readOnly=z(this,n=>this._options.read(n).readOnly),this.shouldRenderOldRevertArrows=z(this,n=>!(!this._options.read(n).renderMarginRevertIcon||!this.renderSideBySide.read(n)||this.readOnly.read(n)||this.shouldRenderGutterMenu.read(n))),this.shouldRenderGutterMenu=z(this,n=>this._options.read(n).renderGutterMenu),this.renderIndicators=z(this,n=>this._options.read(n).renderIndicators),this.enableSplitViewResizing=z(this,n=>this._options.read(n).enableSplitViewResizing),this.splitViewDefaultRatio=z(this,n=>this._options.read(n).splitViewDefaultRatio),this.ignoreTrimWhitespace=z(this,n=>this._options.read(n).ignoreTrimWhitespace),this.maxComputationTimeMs=z(this,n=>this._options.read(n).maxComputationTime),this.showMoves=z(this,n=>this._options.read(n).experimental.showMoves&&this.renderSideBySide.read(n)),this.isInEmbeddedEditor=z(this,n=>this._options.read(n).isInEmbeddedEditor),this.diffWordWrap=z(this,n=>this._options.read(n).diffWordWrap),this.originalEditable=z(this,n=>this._options.read(n).originalEditable),this.diffCodeLens=z(this,n=>this._options.read(n).diffCodeLens),this.accessibilityVerbose=z(this,n=>this._options.read(n).accessibilityVerbose),this.diffAlgorithm=z(this,n=>this._options.read(n).diffAlgorithm),this.showEmptyDecorations=z(this,n=>this._options.read(n).experimental.showEmptyDecorations),this.onlyShowAccessibleDiffViewer=z(this,n=>this._options.read(n).onlyShowAccessibleDiffViewer),this.compactMode=z(this,n=>this._options.read(n).compactMode),this.trueInlineDiffRenderingEnabled=z(this,n=>this._options.read(n).experimental.useTrueInlineView),this.useTrueInlineDiffRendering=z(this,n=>!this.renderSideBySide.read(n)&&this.trueInlineDiffRenderingEnabled.read(n)),this.hideUnchangedRegions=z(this,n=>this._options.read(n).hideUnchangedRegions.enabled),this.hideUnchangedRegionsRevealLineCount=z(this,n=>this._options.read(n).hideUnchangedRegions.revealLineCount),this.hideUnchangedRegionsContextLineCount=z(this,n=>this._options.read(n).hideUnchangedRegions.contextLineCount),this.hideUnchangedRegionsMinimumLineCount=z(this,n=>this._options.read(n).hideUnchangedRegions.minimumLineCount),this._model=J(this,void 0),this.shouldRenderInlineViewInSmartMode=this._model.map(this,n=>n_(this,s=>{const o=n?.diff.read(s);return o?py(o,this.trueInlineDiffRenderingEnabled.read(s)):void 0})).flatten().map(this,n=>!!n),this.inlineViewHideOriginalLineNumbers=this.compactMode;const i={...e,...iu(e,o_)};this._options=J(this,i)}updateOptions(e){const t=iu(e,this._options.get()),i={...this._options.get(),...e,...t};this._options.set(i,void 0,{changedOptions:e})}setWidth(e){this._diffEditorWidth.set(e,void 0)}setModel(e){this._model.set(e,void 0)}};ma=ge([P(1,ji)],ma);function py(a,e){return a.mappings.every(t=>_y(t.lineRangeMapping)||Cy(t.lineRangeMapping)||e&&pc(t.lineRangeMapping))}function _y(a){return a.original.length===0}function Cy(a){return a.modified.length===0}function iu(a,e){return{enableSplitViewResizing:at(a.enableSplitViewResizing,e.enableSplitViewResizing),splitViewDefaultRatio:s_(a.splitViewDefaultRatio,.5,.1,.9),renderSideBySide:at(a.renderSideBySide,e.renderSideBySide),renderMarginRevertIcon:at(a.renderMarginRevertIcon,e.renderMarginRevertIcon),maxComputationTime:ds(a.maxComputationTime,e.maxComputationTime,0,Jt.MAX_SAFE_SMALL_INTEGER),maxFileSize:ds(a.maxFileSize,e.maxFileSize,0,Jt.MAX_SAFE_SMALL_INTEGER),ignoreTrimWhitespace:at(a.ignoreTrimWhitespace,e.ignoreTrimWhitespace),renderIndicators:at(a.renderIndicators,e.renderIndicators),originalEditable:at(a.originalEditable,e.originalEditable),diffCodeLens:at(a.diffCodeLens,e.diffCodeLens),renderOverviewRuler:at(a.renderOverviewRuler,e.renderOverviewRuler),diffWordWrap:Kc(a.diffWordWrap,e.diffWordWrap,["off","on","inherit"]),diffAlgorithm:Kc(a.diffAlgorithm,e.diffAlgorithm,["legacy","advanced"],{smart:"legacy",experimental:"advanced"}),accessibilityVerbose:at(a.accessibilityVerbose,e.accessibilityVerbose),experimental:{showMoves:at(a.experimental?.showMoves,e.experimental.showMoves),showEmptyDecorations:at(a.experimental?.showEmptyDecorations,e.experimental.showEmptyDecorations),useTrueInlineView:at(a.experimental?.useTrueInlineView,e.experimental.useTrueInlineView)},hideUnchangedRegions:{enabled:at(a.hideUnchangedRegions?.enabled??a.experimental?.collapseUnchangedRegions,e.hideUnchangedRegions.enabled),contextLineCount:ds(a.hideUnchangedRegions?.contextLineCount,e.hideUnchangedRegions.contextLineCount,0,Jt.MAX_SAFE_SMALL_INTEGER),minimumLineCount:ds(a.hideUnchangedRegions?.minimumLineCount,e.hideUnchangedRegions.minimumLineCount,0,Jt.MAX_SAFE_SMALL_INTEGER),revealLineCount:ds(a.hideUnchangedRegions?.revealLineCount,e.hideUnchangedRegions.revealLineCount,0,Jt.MAX_SAFE_SMALL_INTEGER)},isInEmbeddedEditor:at(a.isInEmbeddedEditor,e.isInEmbeddedEditor),onlyShowAccessibleDiffViewer:at(a.onlyShowAccessibleDiffViewer,e.onlyShowAccessibleDiffViewer),renderSideBySideInlineBreakpoint:ds(a.renderSideBySideInlineBreakpoint,e.renderSideBySideInlineBreakpoint,0,Jt.MAX_SAFE_SMALL_INTEGER),useInlineViewWhenSpaceIsLimited:at(a.useInlineViewWhenSpaceIsLimited,e.useInlineViewWhenSpaceIsLimited),renderGutterMenu:at(a.renderGutterMenu,e.renderGutterMenu),compactMode:at(a.compactMode,e.compactMode)}}class nu extends r_{constructor(e){super(),this._textModel=e}getValueOfRange(e){return this._textModel.getValueInRange(e)}getLineLength(e){return this._textModel.getLineLength(e)}get length(){const e=this._textModel.getLineCount(),t=this._textModel.getLineLength(e);return new Al(e-1,t)}}class tf extends a_{constructor(e){super(),this._getContext=e}runAction(e,t){const i=this._getContext();return super.runAction(e,i)}}class wy extends U{constructor(e,t,i){super(),this._editor=e,this._domNode=t,this.itemProvider=i,this.scrollTop=Re(this,this._editor.onDidScrollChange,o=>this._editor.getScrollTop()),this.isScrollTopZero=this.scrollTop.map(o=>o===0),this.modelAttached=Re(this,this._editor.onDidChangeModel,o=>this._editor.hasModel()),this.editorOnDidChangeViewZones=qt("onDidChangeViewZones",this._editor.onDidChangeViewZones),this.editorOnDidContentSizeChange=qt("onDidContentSizeChange",this._editor.onDidContentSizeChange),this.domNodeSizeChanged=Kr("domNodeSizeChanged"),this.views=new Map,this._domNode.className="gutter monaco-editor";const n=this._domNode.appendChild(ae("div.scroll-decoration",{role:"presentation",ariaHidden:"true",style:{width:"100%"}}).root),s=new ResizeObserver(()=>{He(o=>{this.domNodeSizeChanged.trigger(o)})});s.observe(this._domNode),this._register(ke(()=>s.disconnect())),this._register(ce(o=>{n.className=this.isScrollTopZero.read(o)?"":"scroll-decoration"})),this._register(ce(o=>this.render(o)))}dispose(){super.dispose(),ys(this._domNode)}render(e){if(!this.modelAttached.read(e))return;this.domNodeSizeChanged.read(e),this.editorOnDidChangeViewZones.read(e),this.editorOnDidContentSizeChange.read(e);const t=this.scrollTop.read(e),i=this._editor.getVisibleRanges(),n=new Set(this.views.keys()),s=ii.ofStartAndLength(0,this._domNode.clientHeight);if(!s.isEmpty)for(const o of i){const r=new Ve(o.startLineNumber,o.endLineNumber+1),l=this.itemProvider.getIntersectingGutterItems(r,e);He(d=>{for(const c of l){if(!c.range.intersect(r))continue;n.delete(c.id);let h=this.views.get(c.id);if(h)h.item.set(c,d);else{const m=document.createElement("div");this._domNode.appendChild(m);const _=J("item",c),L=this.itemProvider.createView(_,m);h=new Ly(_,L,m),this.views.set(c.id,h)}const u=c.range.startLineNumber<=this._editor.getModel().getLineCount()?this._editor.getTopForLineNumber(c.range.startLineNumber,!0)-t:this._editor.getBottomForLineNumber(c.range.startLineNumber-1,!1)-t,f=(c.range.endLineNumberExclusive===1?Math.max(u,this._editor.getTopForLineNumber(c.range.startLineNumber,!1)-t):Math.max(u,this._editor.getBottomForLineNumber(c.range.endLineNumberExclusive-1,!0)-t))-u;h.domNode.style.top=`${u}px`,h.domNode.style.height=`${f}px`,h.gutterItemView.layout(ii.ofStartAndLength(u,f),s)}})}for(const o of n){const r=this.views.get(o);r.gutterItemView.dispose(),r.domNode.remove(),this.views.delete(o)}}}class Ly{constructor(e,t,i){this.item=e,this.gutterItemView=t,this.domNode=i}}const Cl=[],yr=35;let _d=class extends U{constructor(e,t,i,n,s,o,r,l,d){super(),this._diffModel=t,this._editors=i,this._options=n,this._sashLayout=s,this._boundarySashes=o,this._instantiationService=r,this._contextKeyService=l,this._menuService=d,this._menu=this._register(this._menuService.createMenu(an.DiffEditorHunkToolbar,this._contextKeyService)),this._actions=Re(this,this._menu.onDidChange,()=>this._menu.getActions()),this._hasActions=this._actions.map(h=>h.length>0),this._showSash=z(this,h=>this._options.renderSideBySide.read(h)&&this._hasActions.read(h)),this.width=z(this,h=>this._hasActions.read(h)?yr:0),this.elements=ae("div.gutter@gutter",{style:{position:"absolute",height:"100%",width:yr+"px"}},[]),this._currentDiff=z(this,h=>{const u=this._diffModel.read(h);if(!u)return;const g=u.diff.read(h)?.mappings,f=this._editors.modifiedCursor.read(h);if(f)return g?.find(m=>m.lineRangeMapping.modified.contains(f.lineNumber))}),this._selectedDiffs=z(this,h=>{const g=this._diffModel.read(h)?.diff.read(h);if(!g)return Cl;const f=this._editors.modifiedSelections.read(h);if(f.every(w=>w.isEmpty()))return Cl;const m=new zd(f.map(w=>Ve.fromRangeInclusive(w))),L=g.mappings.filter(w=>w.lineRangeMapping.innerChanges&&m.intersects(w.lineRangeMapping.modified)).map(w=>({mapping:w,rangeMappings:w.lineRangeMapping.innerChanges.filter(p=>f.some(C=>N.areIntersecting(p.modifiedRange,C)))}));return L.length===0||L.every(w=>w.rangeMappings.length===0)?Cl:L}),this._register(BS(e,this.elements.root)),this._register(Y(this.elements.root,"click",()=>{this._editors.modified.focus()})),this._register(fn(this.elements.root,{display:this._hasActions.map(h=>h?"block":"none")})),bi(this,h=>this._showSash.read(h)?new ef(e,this._sashLayout.dimensions,this._options.enableSplitViewResizing,this._boundarySashes,Wd(this,g=>this._sashLayout.sashLeft.read(g)-yr,(g,f)=>this._sashLayout.sashLeft.set(g+yr,f)),()=>this._sashLayout.resetSash()):void 0).recomputeInitiallyAndOnChange(this._store);const c=z(this,h=>{const u=this._diffModel.read(h);if(!u)return[];const g=u.diff.read(h);if(!g)return[];const f=this._selectedDiffs.read(h);if(f.length>0){const _=Bd.fromRangeMappings(f.flatMap(L=>L.rangeMappings));return[new su(_,!0,an.DiffEditorSelectionToolbar,void 0,u.model.original.uri,u.model.modified.uri)]}const m=this._currentDiff.read(h);return g.mappings.map(_=>new su(_.lineRangeMapping.withInnerChangesFromLineRanges(),_.lineRangeMapping===m?.lineRangeMapping,an.DiffEditorHunkToolbar,void 0,u.model.original.uri,u.model.modified.uri))});this._register(new wy(this._editors.modified,this.elements.root,{getIntersectingGutterItems:(h,u)=>c.read(u),createView:(h,u)=>this._instantiationService.createInstance(Cd,h,u,this)})),this._register(Y(this.elements.gutter,mt.MOUSE_WHEEL,h=>{this._editors.modified.getOption(v.scrollbar).handleMouseWheel&&this._editors.modified.delegateScrollFromMouseWheelEvent(h)},{passive:!1}))}computeStagedValue(e){const t=e.innerChanges??[],i=new nu(this._editors.modifiedModel.get()),n=new nu(this._editors.original.getModel());return new l_(t.map(r=>r.toTextEdit(i))).apply(n)}layout(e){this.elements.gutter.style.left=e+"px"}};_d=ge([P(6,Me),P(7,ot),P(8,Hd)],_d);class su{constructor(e,t,i,n,s,o){this.mapping=e,this.showAlways=t,this.menuId=i,this.rangeOverride=n,this.originalUri=s,this.modifiedUri=o}get id(){return this.mapping.modified.toString()}get range(){return this.rangeOverride??this.mapping.modified}}let Cd=class extends U{constructor(e,t,i,n){super(),this._item=e,this._elements=ae("div.gutterItem",{style:{height:"20px",width:"34px"}},[ae("div.background@background",{},[]),ae("div.buttons@buttons",{},[])]),this._showAlways=this._item.map(this,o=>o.showAlways),this._menuId=this._item.map(this,o=>o.menuId),this._isSmall=J(this,!1),this._lastItemRange=void 0,this._lastViewRange=void 0;const s=this._register(n.createInstance($u,"element",{instantHover:!0},{position:{hoverPosition:d_.RIGHT}}));this._register(go(t,this._elements.root)),this._register(ce(o=>{const r=this._showAlways.read(o);this._elements.root.classList.toggle("noTransition",!0),this._elements.root.classList.toggle("showAlways",r),setTimeout(()=>{this._elements.root.classList.toggle("noTransition",!1)},0)})),this._register(Ci((o,r)=>{this._elements.buttons.replaceChildren();const l=r.add(n.createInstance(ha,this._elements.buttons,this._menuId.read(o),{orientation:Bu.VERTICAL,hoverDelegate:s,toolbarOptions:{primaryGroup:d=>d.startsWith("primary")},overflowBehavior:{maxItems:this._isSmall.read(o)?1:3},hiddenItemStrategy:Ds.Ignore,actionRunner:r.add(new tf(()=>{const d=this._item.get(),c=d.mapping;return{mapping:c,originalWithModifiedChanges:i.computeStagedValue(c),originalUri:d.originalUri,modifiedUri:d.modifiedUri}})),menuOptions:{shouldForwardArgs:!0}}));r.add(l.onDidChangeMenuItems(()=>{this._lastItemRange&&this.layout(this._lastItemRange,this._lastViewRange)}))}))}layout(e,t){this._lastItemRange=e,this._lastViewRange=t;let i=this._elements.buttons.clientHeight;this._isSmall.set(this._item.get().mapping.original.startLineNumber===1&&e.length<30,void 0),i=this._elements.buttons.clientHeight;const n=e.length/2-i/2,s=i;let o=e.start+n;const r=ii.tryCreate(s,t.endExclusive-s-i),l=ii.tryCreate(e.start+s,e.endExclusive-i-s);l&&r&&l.start<l.endExclusive&&(o=r.clip(o),o=l.clip(o)),this._elements.buttons.style.top=`${o-e.start}px`}};Cd=ge([P(3,Me)],Cd);var Hr;let wd=class extends U{static{Hr=this}static{this._breadcrumbsSourceFactory=J(Hr,()=>({dispose(){},getBreadcrumbItems(e,t){return[]}}))}static setBreadcrumbsSourceFactory(e){this._breadcrumbsSourceFactory.set(e,void 0)}get isUpdatingHiddenAreas(){return this._isUpdatingHiddenAreas}constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._instantiationService=n,this._modifiedOutlineSource=bi(this,l=>{const d=this._editors.modifiedModel.read(l),c=Hr._breadcrumbsSourceFactory.read(l);return!d||!c?void 0:c(d,this._instantiationService)}),this._isUpdatingHiddenAreas=!1,this._register(this._editors.original.onDidChangeCursorPosition(l=>{if(l.reason===he.ContentFlush)return;const d=this._diffModel.get();He(c=>{for(const h of this._editors.original.getSelections()||[])d?.ensureOriginalLineIsVisible(h.getStartPosition().lineNumber,ti.FromCloserSide,c),d?.ensureOriginalLineIsVisible(h.getEndPosition().lineNumber,ti.FromCloserSide,c)})})),this._register(this._editors.modified.onDidChangeCursorPosition(l=>{if(l.reason===he.ContentFlush)return;const d=this._diffModel.get();He(c=>{for(const h of this._editors.modified.getSelections()||[])d?.ensureModifiedLineIsVisible(h.getStartPosition().lineNumber,ti.FromCloserSide,c),d?.ensureModifiedLineIsVisible(h.getEndPosition().lineNumber,ti.FromCloserSide,c)})}));const s=this._diffModel.map((l,d)=>{const c=l?.unchangedRegions.read(d)??[];return c.length===1&&c[0].modifiedLineNumber===1&&c[0].lineCount===this._editors.modifiedModel.read(d)?.getLineCount()?[]:c});this.viewZones=qs(this,(l,d)=>{const c=this._modifiedOutlineSource.read(l);if(!c)return{origViewZones:[],modViewZones:[]};const h=[],u=[],g=this._options.renderSideBySide.read(l),f=this._options.compactMode.read(l),m=s.read(l);for(let _=0;_<m.length;_++){const L=m[_];if(!L.shouldHideControls(l)&&!(f&&(_===0||_===m.length-1)))if(f){{const w=z(this,C=>L.getHiddenOriginalRange(C).startLineNumber-1),p=new Ls(w,12);h.push(p),d.add(new ou(this._editors.original,p,L,!g))}{const w=z(this,C=>L.getHiddenModifiedRange(C).startLineNumber-1),p=new Ls(w,12);u.push(p),d.add(new ou(this._editors.modified,p,L))}}else{{const w=z(this,C=>L.getHiddenOriginalRange(C).startLineNumber-1),p=new Ls(w,24);h.push(p),d.add(new ru(this._editors.original,p,L,L.originalUnchangedRange,!g,c,C=>this._diffModel.get().ensureModifiedLineIsVisible(C,ti.FromBottom,void 0),this._options))}{const w=z(this,C=>L.getHiddenModifiedRange(C).startLineNumber-1),p=new Ls(w,24);u.push(p),d.add(new ru(this._editors.modified,p,L,L.modifiedUnchangedRange,!1,c,C=>this._diffModel.get().ensureModifiedLineIsVisible(C,ti.FromBottom,void 0),this._options))}}}return{origViewZones:h,modViewZones:u}});const o={description:"unchanged lines",className:"diff-unchanged-lines",isWholeLine:!0},r={description:"Fold Unchanged",glyphMarginHoverMessage:new c_(void 0,{isTrusted:!0,supportThemeIcons:!0}).appendMarkdown(O(188,"Fold Unchanged Region")),glyphMarginClassName:"fold-unchanged "+ut.asClassName(It.fold),zIndex:10001};this._register(ua(this._editors.original,z(this,l=>{const d=s.read(l),c=d.map(h=>({range:h.originalUnchangedRange.toInclusiveRange(),options:o}));for(const h of d)h.shouldHideControls(l)&&c.push({range:N.fromPositions(new I(h.originalLineNumber,1)),options:r});return c}))),this._register(ua(this._editors.modified,z(this,l=>{const d=s.read(l),c=d.map(h=>({range:h.modifiedUnchangedRange.toInclusiveRange(),options:o}));for(const h of d)h.shouldHideControls(l)&&c.push({range:Ve.ofLength(h.modifiedLineNumber,1).toInclusiveRange(),options:r});return c}))),this._register(ce(l=>{const d=s.read(l);this._isUpdatingHiddenAreas=!0;try{this._editors.original.setHiddenAreas(d.map(c=>c.getHiddenOriginalRange(l).toInclusiveRange()).filter(Os)),this._editors.modified.setHiddenAreas(d.map(c=>c.getHiddenModifiedRange(l).toInclusiveRange()).filter(Os))}finally{this._isUpdatingHiddenAreas=!1}})),this._register(this._editors.modified.onMouseUp(l=>{if(!l.event.rightButton&&l.target.position&&l.target.element?.className.includes("fold-unchanged")){const d=l.target.position.lineNumber,c=this._diffModel.get();if(!c)return;const h=c.unchangedRegions.get().find(u=>u.modifiedUnchangedRange.includes(d));if(!h)return;h.collapseAll(void 0),l.event.stopPropagation(),l.event.preventDefault()}})),this._register(this._editors.original.onMouseUp(l=>{if(!l.event.rightButton&&l.target.position&&l.target.element?.className.includes("fold-unchanged")){const d=l.target.position.lineNumber,c=this._diffModel.get();if(!c)return;const h=c.unchangedRegions.get().find(u=>u.originalUnchangedRange.includes(d));if(!h)return;h.collapseAll(void 0),l.event.stopPropagation(),l.event.preventDefault()}}))}};wd=Hr=ge([P(3,Me)],wd);class ou extends gc{constructor(e,t,i,n=!1){const s=ae("div.diff-hidden-lines-widget");super(e,t,s.root),this._unchangedRegion=i,this._hide=n,this._nodes=ae("div.diff-hidden-lines-compact",[ae("div.line-left",[]),ae("div.text@text",[]),ae("div.line-right",[])]),s.root.appendChild(this._nodes.root),this._hide&&this._nodes.root.replaceChildren(),this._register(ce(o=>{if(!this._hide){const r=this._unchangedRegion.getHiddenModifiedRange(o).length,l=O(189,"{0} hidden lines",r);this._nodes.text.innerText=l}}))}}class ru extends gc{constructor(e,t,i,n,s,o,r,l){const d=ae("div.diff-hidden-lines-widget");super(e,t,d.root),this._editor=e,this._unchangedRegion=i,this._unchangedRegionRange=n,this._hide=s,this._modifiedOutlineSource=o,this._revealModifiedHiddenLine=r,this._options=l,this._nodes=ae("div.diff-hidden-lines",[ae("div.top@top",{title:O(190,"Click or drag to show more above")}),ae("div.center@content",{style:{display:"flex"}},[ae("div@first",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexShrink:"0"}},[bs("a",{title:O(191,"Show Unchanged Region"),role:"button",onclick:()=>{this._unchangedRegion.showAll(void 0)}},...h_("$(unfold)"))]),ae("div@others",{style:{display:"flex",justifyContent:"center",alignItems:"center"}})]),ae("div.bottom@bottom",{title:O(192,"Click or drag to show more below"),role:"button"})]),d.root.appendChild(this._nodes.root),this._hide?ys(this._nodes.first):this._register(fn(this._nodes.first,{width:Hn(this._editor).layoutInfoContentLeft})),this._register(ce(h=>{const u=this._unchangedRegion.visibleLineCountTop.read(h)+this._unchangedRegion.visibleLineCountBottom.read(h)===this._unchangedRegion.lineCount;this._nodes.bottom.classList.toggle("canMoveTop",!u),this._nodes.bottom.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(h)>0),this._nodes.top.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(h)>0),this._nodes.top.classList.toggle("canMoveBottom",!u);const g=this._unchangedRegion.isDragged.read(h),f=this._editor.getDomNode();f&&(f.classList.toggle("draggingUnchangedRegion",!!g),g==="top"?(f.classList.toggle("canMoveTop",this._unchangedRegion.visibleLineCountTop.read(h)>0),f.classList.toggle("canMoveBottom",!u)):g==="bottom"?(f.classList.toggle("canMoveTop",!u),f.classList.toggle("canMoveBottom",this._unchangedRegion.visibleLineCountBottom.read(h)>0)):(f.classList.toggle("canMoveTop",!1),f.classList.toggle("canMoveBottom",!1)))}));const c=this._editor;this._register(Y(this._nodes.top,"mousedown",h=>{if(h.button!==0)return;this._nodes.top.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),h.preventDefault();const u=h.clientY;let g=!1;const f=this._unchangedRegion.visibleLineCountTop.get();this._unchangedRegion.isDragged.set("top",void 0);const m=Ne(this._nodes.top),_=Y(m,"mousemove",w=>{const C=w.clientY-u;g=g||Math.abs(C)>2;const b=Math.round(C/c.getOption(v.lineHeight)),S=Math.max(0,Math.min(f+b,this._unchangedRegion.getMaxVisibleLineCountTop()));this._unchangedRegion.visibleLineCountTop.set(S,void 0)}),L=Y(m,"mouseup",w=>{g||this._unchangedRegion.showMoreAbove(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0),this._nodes.top.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),this._unchangedRegion.isDragged.set(void 0,void 0),_.dispose(),L.dispose()})})),this._register(Y(this._nodes.bottom,"mousedown",h=>{if(h.button!==0)return;this._nodes.bottom.classList.toggle("dragging",!0),this._nodes.root.classList.toggle("dragging",!0),h.preventDefault();const u=h.clientY;let g=!1;const f=this._unchangedRegion.visibleLineCountBottom.get();this._unchangedRegion.isDragged.set("bottom",void 0);const m=Ne(this._nodes.bottom),_=Y(m,"mousemove",w=>{const C=w.clientY-u;g=g||Math.abs(C)>2;const b=Math.round(C/c.getOption(v.lineHeight)),S=Math.max(0,Math.min(f-b,this._unchangedRegion.getMaxVisibleLineCountBottom())),y=this._unchangedRegionRange.endLineNumberExclusive>c.getModel().getLineCount()?c.getContentHeight():c.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.visibleLineCountBottom.set(S,void 0);const E=this._unchangedRegionRange.endLineNumberExclusive>c.getModel().getLineCount()?c.getContentHeight():c.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);c.setScrollTop(c.getScrollTop()+(E-y))}),L=Y(m,"mouseup",w=>{if(this._unchangedRegion.isDragged.set(void 0,void 0),!g){const p=c.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);this._unchangedRegion.showMoreBelow(this._options.hideUnchangedRegionsRevealLineCount.get(),void 0);const C=c.getTopForLineNumber(this._unchangedRegionRange.endLineNumberExclusive);c.setScrollTop(c.getScrollTop()+(C-p))}this._nodes.bottom.classList.toggle("dragging",!1),this._nodes.root.classList.toggle("dragging",!1),_.dispose(),L.dispose()})})),this._register(ce(h=>{const u=[];if(!this._hide){const g=i.getHiddenModifiedRange(h).length,f=O(189,"{0} hidden lines",g),m=bs("span",{title:O(193,"Double click to unfold")},f);m.addEventListener("dblclick",w=>{w.button===0&&(w.preventDefault(),this._unchangedRegion.showAll(void 0))}),u.push(m);const _=this._unchangedRegion.getHiddenModifiedRange(h),L=this._modifiedOutlineSource.getBreadcrumbItems(_,h);if(L.length>0){u.push(bs("span",void 0,"  |  "));for(let w=0;w<L.length;w++){const p=L[w],C=u_.toIcon(p.kind),b=ae("div.breadcrumb-item",{style:{display:"flex",alignItems:"center"}},[Ol(C)," ",p.name,...w===L.length-1?[]:[Ol(It.chevronRight)]]).root;u.push(b),b.onclick=()=>{this._revealModifiedHiddenLine(p.startLineNumber)}}}}ys(this._nodes.others,...u)}))}}const wl=[];class vy extends U{constructor(e,t,i,n){super(),this._editors=e,this._diffModel=t,this._options=i,this._widget=n,this._selectedDiffs=z(this,s=>{const r=this._diffModel.read(s)?.diff.read(s);if(!r)return wl;const l=this._editors.modifiedSelections.read(s);if(l.every(u=>u.isEmpty()))return wl;const d=new zd(l.map(u=>Ve.fromRangeInclusive(u))),h=r.mappings.filter(u=>u.lineRangeMapping.innerChanges&&d.intersects(u.lineRangeMapping.modified)).map(u=>({mapping:u,rangeMappings:u.lineRangeMapping.innerChanges.filter(g=>l.some(f=>N.areIntersecting(g.modifiedRange,f)))}));return h.length===0||h.every(u=>u.rangeMappings.length===0)?wl:h}),this._register(Ci((s,o)=>{if(!this._options.shouldRenderOldRevertArrows.read(s))return;const r=this._diffModel.read(s),l=r?.diff.read(s);if(!r||!l||r.movedTextToCompare.read(s))return;const d=[],c=this._selectedDiffs.read(s),h=new Set(c.map(u=>u.mapping));if(c.length>0){const u=this._editors.modifiedSelections.read(s),g=o.add(new pa(u[u.length-1].positionLineNumber,this._widget,c.flatMap(f=>f.rangeMappings),!0));this._editors.modified.addGlyphMarginWidget(g),d.push(g)}for(const u of l.mappings)if(!h.has(u)&&!u.lineRangeMapping.modified.isEmpty&&u.lineRangeMapping.innerChanges){const g=o.add(new pa(u.lineRangeMapping.modified.startLineNumber,this._widget,u.lineRangeMapping,!1));this._editors.modified.addGlyphMarginWidget(g),d.push(g)}o.add(ke(()=>{for(const u of d)this._editors.modified.removeGlyphMarginWidget(u)}))}))}}class pa extends U{static{this.counter=0}getId(){return this._id}constructor(e,t,i,n){super(),this._lineNumber=e,this._widget=t,this._diffs=i,this._revertSelection=n,this._id=`revertButton${pa.counter++}`,this._domNode=ae("div.revertButton",{title:this._revertSelection?O(198,"Revert Selected Changes"):O(199,"Revert Change")},[Ol(It.arrowRight)]).root,this._register(Y(this._domNode,mt.MOUSE_DOWN,s=>{s.button!==2&&(s.stopPropagation(),s.preventDefault())})),this._register(Y(this._domNode,mt.MOUSE_UP,s=>{s.stopPropagation(),s.preventDefault()})),this._register(Y(this._domNode,mt.CLICK,s=>{this._diffs instanceof mo?this._widget.revert(this._diffs):this._widget.revertRangeMappings(this._diffs),s.stopPropagation(),s.preventDefault()}))}getDomNode(){return this._domNode}getPosition(){return{lane:nr.Right,range:{startColumn:1,startLineNumber:this._lineNumber,endColumn:1,endLineNumber:this._lineNumber},zIndex:10001}}}const by=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(by);let _a=class extends Cc{static{this.ENTIRE_DIFF_OVERVIEW_WIDTH=Bs.ENTIRE_DIFF_OVERVIEW_WIDTH}get onDidContentSizeChange(){return this._editors.onDidContentSizeChange}get collapseUnchangedRegions(){return this._options.hideUnchangedRegions.get()}constructor(e,t,i,n,s,o,r,l){super(),this._domElement=e,this._parentContextKeyService=n,this._parentInstantiationService=s,this._accessibilitySignalService=r,this._editorProgressService=l,this.elements=ae("div.monaco-diff-editor.side-by-side",{style:{position:"relative",height:"100%"}},[ae("div.editor.original@original",{style:{position:"absolute",height:"100%"}}),ae("div.editor.modified@modified",{style:{position:"absolute",height:"100%"}}),ae("div.accessibleDiffViewer@accessibleDiffViewer",{style:{position:"absolute",height:"100%"}})]),this._diffModelSrc=this._register(Zu(this,void 0)),this._diffModel=z(this,C=>this._diffModelSrc.read(C)?.object),this.onDidChangeModel=mi.fromObservableLight(this._diffModel),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._domElement)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new $s([ot,this._contextKeyService]))),this._boundarySashes=J(this,void 0),this._accessibleDiffViewerShouldBeVisible=J(this,!1),this._accessibleDiffViewerVisible=z(this,C=>this._options.onlyShowAccessibleDiffViewer.read(C)?!0:this._accessibleDiffViewerShouldBeVisible.read(C)),this._movedBlocksLinesPart=J(this,void 0),this._layoutInfo=z(this,C=>{const b=this._rootSizeObserver.width.read(C),S=this._rootSizeObserver.height.read(C);this._rootSizeObserver.automaticLayout?this.elements.root.style.height="100%":this.elements.root.style.height=S+"px";const y=this._sash.read(C),E=this._gutter.read(C),x=E?.width.read(C)??0,R=this._overviewRulerPart.read(C)?.width??0;let D,A,W,H,G;if(!!y){const X=y.sashLeft.read(C),te=this._movedBlocksLinesPart.read(C)?.width.read(C)??0;D=0,A=X-x-te,G=X-x,W=X,H=b-W-R}else{G=0;const X=this._options.inlineViewHideOriginalLineNumbers.read(C);D=x,X?A=0:A=Math.max(5,this._editors.originalObs.layoutInfoDecorationsLeft.read(C)),W=x+A,H=b-W-R}return this.elements.original.style.left=D+"px",this.elements.original.style.width=A+"px",this._editors.original.layout({width:A,height:S},!0),E?.layout(G),this.elements.modified.style.left=W+"px",this.elements.modified.style.width=H+"px",this._editors.modified.layout({width:H,height:S},!0),{modifiedEditor:this._editors.modified.getLayoutInfo(),originalEditor:this._editors.original.getLayoutInfo()}}),this._diffValue=this._diffModel.map((C,b)=>C?.diff.read(b)),this.onDidUpdateDiff=mi.fromObservableLight(this._diffValue),o.willCreateDiffEditor(),this._contextKeyService.createKey("isInDiffEditor",!0),this.elements.root.classList.toggle("standalone",i.isStandaloneEditor||!1),this._domElement.appendChild(this.elements.root),this._register(ke(()=>this.elements.root.remove())),this._rootSizeObserver=this._register(new Yg(this.elements.root,t.dimension)),this._rootSizeObserver.setAutomaticLayout(t.automaticLayout??!1),this._options=this._instantiationService.createInstance(ma,t),this._register(ce(C=>{this._options.setWidth(this._rootSizeObserver.width.read(C))})),this._contextKeyService.createKey(k.isEmbeddedDiffEditor.key,!1),this._register(Mi(k.isEmbeddedDiffEditor,this._contextKeyService,C=>this._options.isInEmbeddedEditor.read(C))),this._register(Mi(k.comparingMovedCode,this._contextKeyService,C=>!!this._diffModel.read(C)?.movedTextToCompare.read(C))),this._register(Mi(k.diffEditorRenderSideBySideInlineBreakpointReached,this._contextKeyService,C=>this._options.couldShowInlineViewBecauseOfSize.read(C))),this._register(Mi(k.diffEditorInlineMode,this._contextKeyService,C=>!this._options.renderSideBySide.read(C))),this._register(Mi(k.hasChanges,this._contextKeyService,C=>(this._diffModel.read(C)?.diff.read(C)?.mappings.length??0)>0)),this._editors=this._register(this._instantiationService.createInstance(pd,this.elements.original,this.elements.modified,this._options,i,(C,b,S,y)=>this._createInnerEditor(C,b,S,y))),this._register(Mi(k.diffEditorOriginalWritable,this._contextKeyService,C=>this._options.originalEditable.read(C))),this._register(Mi(k.diffEditorModifiedWritable,this._contextKeyService,C=>!this._options.readOnly.read(C))),this._register(Mi(k.diffEditorOriginalUri,this._contextKeyService,C=>this._diffModel.read(C)?.model.original.uri.toString()??"")),this._register(Mi(k.diffEditorModifiedUri,this._contextKeyService,C=>this._diffModel.read(C)?.model.modified.uri.toString()??"")),this._overviewRulerPart=bi(this,C=>this._options.renderOverviewRuler.read(C)?this._instantiationService.createInstance(Qt(Bs,C),this._editors,this.elements.root,this._diffModel,this._rootSizeObserver.width,this._rootSizeObserver.height,this._layoutInfo.map(b=>b.modifiedEditor)):void 0).recomputeInitiallyAndOnChange(this._store);const d={height:this._rootSizeObserver.height,width:this._rootSizeObserver.width.map((C,b)=>C-(this._overviewRulerPart.read(b)?.width??0))};this._sashLayout=new my(this._options,d),this._sash=bi(this,C=>{const b=this._options.renderSideBySide.read(C);return this.elements.root.classList.toggle("side-by-side",b),b?new ef(this.elements.root,d,this._options.enableSplitViewResizing,this._boundarySashes,this._sashLayout.sashLeft,()=>this._sashLayout.resetSash()):void 0}).recomputeInitiallyAndOnChange(this._store);const c=bi(this,C=>this._instantiationService.createInstance(Qt(wd,C),this._editors,this._diffModel,this._options)).recomputeInitiallyAndOnChange(this._store);bi(this,C=>this._instantiationService.createInstance(Qt(fy,C),this._editors,this._diffModel,this._options,this)).recomputeInitiallyAndOnChange(this._store);const h=new Set,u=new Set;let g=!1;const f=bi(this,C=>this._instantiationService.createInstance(Qt(md,C),Ne(this._domElement),this._editors,this._diffModel,this._options,this,()=>g||c.get().isUpdatingHiddenAreas,h,u)).recomputeInitiallyAndOnChange(this._store),m=z(this,C=>{const b=f.read(C).viewZones.read(C).orig,S=c.read(C).viewZones.read(C).origViewZones;return b.concat(S)}),_=z(this,C=>{const b=f.read(C).viewZones.read(C).mod,S=c.read(C).viewZones.read(C).modViewZones;return b.concat(S)});this._register(ga(this._editors.original,m,C=>{g=C},h));let L;this._register(ga(this._editors.modified,_,C=>{g=C,g?L=Hs.capture(this._editors.modified):(L?.restore(this._editors.modified),L=void 0)},u)),this._accessibleDiffViewer=bi(this,C=>this._instantiationService.createInstance(Qt(Bn,C),this.elements.accessibleDiffViewer,this._accessibleDiffViewerVisible,(b,S)=>this._accessibleDiffViewerShouldBeVisible.set(b,S),this._options.onlyShowAccessibleDiffViewer.map(b=>!b),this._rootSizeObserver.width,this._rootSizeObserver.height,this._diffModel.map((b,S)=>b?.diff.read(S)?.mappings.map(y=>y.lineRangeMapping)),new iy(this._editors))).recomputeInitiallyAndOnChange(this._store);const w=this._accessibleDiffViewerVisible.map(C=>C?"hidden":"visible");this._register(fn(this.elements.modified,{visibility:w})),this._register(fn(this.elements.original,{visibility:w})),this._createDiffEditorContributions(),o.addDiffEditor(this),this._gutter=bi(this,C=>this._options.shouldRenderGutterMenu.read(C)?this._instantiationService.createInstance(Qt(_d,C),this.elements.root,this._diffModel,this._editors,this._options,this._sashLayout,this._boundarySashes):void 0),this._register(Ud(this._layoutInfo)),bi(this,C=>new(Qt(qn,C))(this.elements.root,this._diffModel,this._layoutInfo.map(b=>b.originalEditor),this._layoutInfo.map(b=>b.modifiedEditor),this._editors)).recomputeInitiallyAndOnChange(this._store,C=>{this._movedBlocksLinesPart.set(C,void 0)}),this._register(mi.runAndSubscribe(this._editors.modified.onDidChangeCursorPosition,C=>this._handleCursorPositionChange(C,!0))),this._register(mi.runAndSubscribe(this._editors.original.onDidChangeCursorPosition,C=>this._handleCursorPositionChange(C,!1)));const p=this._diffModel.map(this,(C,b)=>{if(C)return C.diff.read(b)===void 0&&!C.isDiffUpToDate.read(b)});this._register(Ci((C,b)=>{if(p.read(C)===!0){const S=this._editorProgressService.show(!0,1e3);b.add(ke(()=>S.done()))}})),this._register(Ci((C,b)=>{b.add(new(Qt(vy,C))(this._editors,this._diffModel,this._options,this))})),this._register(Ci((C,b)=>{const S=this._diffModel.read(C);if(S)for(const y of[S.model.original,S.model.modified])b.add(y.onWillDispose(E=>{vt(new Fe("TextModel got disposed before DiffEditorWidget model got reset")),this.setModel(null)}))})),this._register(ce(C=>{this._options.setModel(this._diffModel.read(C))}))}getViewWidth(){return this._rootSizeObserver.width.get()}getContentHeight(){return this._editors.modified.getContentHeight()}_createInnerEditor(e,t,i,n){return e.createInstance(ca,t,i,n)}_createDiffEditorContributions(){const e=Tr.getDiffEditorContributions();for(const t of e)try{this._register(this._instantiationService.createInstance(t.ctor,this))}catch(i){vt(i)}}get _targetEditor(){return this._editors.modified}getEditorType(){return kd.IDiffEditor}onVisible(){this._editors.original.onVisible(),this._editors.modified.onVisible()}onHide(){this._editors.original.onHide(),this._editors.modified.onHide()}layout(e){this._rootSizeObserver.observe(e)}hasTextFocus(){return this._editors.original.hasTextFocus()||this._editors.modified.hasTextFocus()}saveViewState(){const e=this._editors.original.saveViewState(),t=this._editors.modified.saveViewState();return{original:e,modified:t,modelState:this._diffModel.get()?.serializeState()}}restoreViewState(e){if(e&&e.original&&e.modified){const t=e;this._editors.original.restoreViewState(t.original),this._editors.modified.restoreViewState(t.modified),t.modelState&&this._diffModel.get()?.restoreSerializedState(t.modelState)}}handleInitialized(){this._editors.original.handleInitialized(),this._editors.modified.handleInitialized()}createViewModel(e){return this._instantiationService.createInstance(fa,e,this._options)}getModel(){return this._diffModel.get()?.model??null}setModel(e){const t=e?"model"in e?jo.create(e).createNewRef(this):jo.create(this.createViewModel(e),this):null;this.setDiffModel(t)}setDiffModel(e,t){const i=this._diffModel.get();!e&&i&&this._accessibleDiffViewer.get().close(),this._diffModel.get()!==e?.object&&Gu(t,n=>{const s=e?.object;Re.batchEventsGlobally(n,()=>{this._editors.original.setModel(s?s.model.original:null),this._editors.modified.setModel(s?s.model.modified:null)});const o=this._diffModelSrc.get()?.createNewRef(this);this._diffModelSrc.set(e?.createNewRef(this),n),setTimeout(()=>{o?.dispose()},0)})}updateOptions(e){this._options.updateOptions(e)}getDomNode(){return this.elements.root}getContainerDomNode(){return this._domElement}getOriginalEditor(){return this._editors.original}getModifiedEditor(){return this._editors.modified}setBoundarySashes(e){this._boundarySashes.set(e,void 0)}get ignoreTrimWhitespace(){return this._options.ignoreTrimWhitespace.get()}get maxComputationTime(){return this._options.maxComputationTimeMs.get()}get renderSideBySide(){return this._options.renderSideBySide.get()}getLineChanges(){const e=this._diffModel.get()?.diff.get();return e?Sy(e):null}getDiffComputationResult(){const e=this._diffModel.get()?.diff.get();return e?{changes:this.getLineChanges(),changes2:e.mappings.map(t=>t.lineRangeMapping),identical:e.identical,quitEarly:e.quitEarly}:null}revert(e){const t=this._diffModel.get();!t||!t.isDiffUpToDate.get()||this._editors.modified.executeEdits("diffEditor",[{range:e.modified.toExclusiveRange(),text:t.model.original.getValueInRange(e.original.toExclusiveRange())}])}revertRangeMappings(e){const t=this._diffModel.get();if(!t||!t.isDiffUpToDate.get())return;const i=e.map(n=>({range:n.modifiedRange,text:t.model.original.getValueInRange(n.originalRange)}));this._editors.modified.executeEdits("diffEditor",i)}_goTo(e){this._editors.modified.setPosition(new I(e.lineRangeMapping.modified.startLineNumber,1)),this._editors.modified.revealRangeInCenter(e.lineRangeMapping.modified.toExclusiveRange())}goToDiff(e){const t=this._diffModel.get()?.diff.get()?.mappings;if(!t||t.length===0)return;const i=this._editors.modified.getPosition().lineNumber;let n;e==="next"?n=t.find(s=>s.lineRangeMapping.modified.startLineNumber>i)??t[0]:n=Ml(t,s=>s.lineRangeMapping.modified.startLineNumber<i)??t[t.length-1],this._goTo(n),n.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(se.diffLineDeleted,{source:"diffEditor.goToDiff"}):n.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(se.diffLineInserted,{source:"diffEditor.goToDiff"}):n&&this._accessibilitySignalService.playSignal(se.diffLineModified,{source:"diffEditor.goToDiff"})}revealFirstDiff(){const e=this._diffModel.get();e&&this.waitForDiff().then(()=>{const t=e.diff.get()?.mappings;!t||t.length===0||this._goTo(t[0])})}accessibleDiffViewerNext(){this._accessibleDiffViewer.get().next()}accessibleDiffViewerPrev(){this._accessibleDiffViewer.get().prev()}async waitForDiff(){const e=this._diffModel.get();e&&await e.waitForDiff()}mapToOtherSide(){const e=this._editors.modified.hasWidgetFocus(),t=e?this._editors.modified:this._editors.original,i=e?this._editors.original:this._editors.modified;let n;const s=t.getSelection();if(s){const o=this._diffModel.get()?.diff.get()?.mappings.map(r=>e?r.lineRangeMapping.flip():r.lineRangeMapping);if(o){const r=Gh(s.getStartPosition(),o),l=Gh(s.getEndPosition(),o);n=N.plusRange(r,l)}}return{destination:i,destinationSelection:n}}switchSide(){const{destination:e,destinationSelection:t}=this.mapToOtherSide();e.focus(),t&&e.setSelection(t)}exitCompareMove(){const e=this._diffModel.get();e&&e.movedTextToCompare.set(void 0,void 0)}collapseAllUnchangedRegions(){const e=this._diffModel.get()?.unchangedRegions.get();e&&He(t=>{for(const i of e)i.collapseAll(t)})}showAllUnchangedRegions(){const e=this._diffModel.get()?.unchangedRegions.get();e&&He(t=>{for(const i of e)i.showAll(t)})}_handleCursorPositionChange(e,t){if(e?.reason===he.Explicit){const i=this._diffModel.get()?.diff.get()?.mappings.find(n=>t?n.lineRangeMapping.modified.contains(e.position.lineNumber):n.lineRangeMapping.original.contains(e.position.lineNumber));i?.lineRangeMapping.modified.isEmpty?this._accessibilitySignalService.playSignal(se.diffLineDeleted,{source:"diffEditor.cursorPositionChanged"}):i?.lineRangeMapping.original.isEmpty?this._accessibilitySignalService.playSignal(se.diffLineInserted,{source:"diffEditor.cursorPositionChanged"}):i&&this._accessibilitySignalService.playSignal(se.diffLineModified,{source:"diffEditor.cursorPositionChanged"})}}};_a=ge([P(3,ot),P(4,Me),P(5,zt),P(6,or),P(7,qu)],_a);function Sy(a){return a.mappings.map(e=>{const t=e.lineRangeMapping;let i,n,s,o,r=t.innerChanges;return t.original.isEmpty?(i=t.original.startLineNumber-1,n=0,r=void 0):(i=t.original.startLineNumber,n=t.original.endLineNumberExclusive-1),t.modified.isEmpty?(s=t.modified.startLineNumber-1,o=0,r=void 0):(s=t.modified.startLineNumber,o=t.modified.endLineNumberExclusive-1),{originalStartLineNumber:i,originalEndLineNumber:n,modifiedStartLineNumber:s,modifiedEndLineNumber:o,charChanges:r?.map(l=>({originalStartLineNumber:l.originalRange.startLineNumber,originalStartColumn:l.originalRange.startColumn,originalEndLineNumber:l.originalRange.endLineNumber,originalEndColumn:l.originalRange.endColumn,modifiedStartLineNumber:l.modifiedRange.startLineNumber,modifiedStartColumn:l.modifiedRange.startColumn,modifiedEndLineNumber:l.modifiedRange.endLineNumber,modifiedEndColumn:l.modifiedRange.endColumn}))}})}class yy extends U{async waitForDiffs(){for(const e of this.items.get())await e.diffEditorViewModel.waitForDiff()}collapseAll(){He(e=>{for(const t of this.items.get())t.collapsed.set(!0,e)})}expandAll(){He(e=>{for(const t of this.items.get())t.collapsed.set(!1,e)})}get contextKeys(){return this.model.contextKeys}constructor(e,t){super(),this.model=e,this._instantiationService=t,this._documents=g_(this.model,this.model.documents),this._documentsArr=z(this,i=>{const n=this._documents.read(i);return n==="loading"?[]:n}),this.isLoading=z(this,i=>this._documents.read(i)==="loading"),this.items=f_(this,this._documentsArr,(i,n)=>n.add(this._instantiationService.createInstance(Ld,i,this))).recomputeInitiallyAndOnChange(this._store),this.focusedDiffItem=z(this,i=>this.items.read(i).find(n=>n.isFocused.read(i))),this.activeDiffItem=m_(this,(i,n)=>this.focusedDiffItem.read(i)??(n&&this.items.read(i).indexOf(n)!==-1)?n:void 0)}}let Ld=class extends U{get diffEditorViewModel(){return this.diffEditorViewModelRef.object}get originalUri(){return this.documentDiffItem.original?.uri}get modifiedUri(){return this.documentDiffItem.modified?.uri}setIsFocused(e,t){this._isFocusedSource.set(e,t)}get documentDiffItem(){return this.documentDiffItemRef.object}constructor(e,t,i,n){super(),this._editorViewModel=t,this._instantiationService=i,this._modelService=n,this.collapsed=J(this,!1),this.lastTemplateData=J(this,{contentHeight:500,selections:void 0}),this.isActive=z(this,c=>this._editorViewModel.activeDiffItem.read(c)===this),this._isFocusedSource=J(this,$r(!1)),this.isFocused=z(this,c=>this._isFocusedSource.read(c).read(c)),this.isAlive=J(this,!0),this._register(ke(()=>{this.isAlive.set(!1,void 0)})),this.documentDiffItemRef=this._register(e.createNewRef(this));function s(c){return{...c,hideUnchangedRegions:{enabled:!0}}}const o=this._instantiationService.createInstance(ma,s(this.documentDiffItem.options||{}));this.documentDiffItem.onOptionsDidChange&&this._register(this.documentDiffItem.onOptionsDidChange(()=>{o.updateOptions(s(this.documentDiffItem.options||{}))}));const r=new Ot,l=this.documentDiffItem.original??r.add(this._modelService.createModel("",null)),d=this.documentDiffItem.modified??r.add(this._modelService.createModel("",null));r.add(this.documentDiffItemRef.createNewRef(this)),this.diffEditorViewModelRef=this._register(jo.createWithDisposable(this._instantiationService.createInstance(fa,{original:l,modified:d},o),r,this))}getKey(){return JSON.stringify([this.originalUri?.toString(),this.modifiedUri?.toString()])}};Ld=ge([P(2,Me),P(3,Di)],Ld);const xy=$i("editor.foldBackground",{light:$c(Zc,.3),dark:$c(Zc,.3),hcDark:null,hcLight:null},O(1064,"Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations."),!0);$i("editor.foldPlaceholderForeground",{light:"#808080",dark:"#808080",hcDark:null,hcLight:null},O(1065,"Color of the collapsed text after the first line of a folded range."));$i("editorGutter.foldingControlForeground",p_,O(1066,"Color of the folding control in the editor gutter."));const vd=Ki("folding-expanded",It.chevronDown,O(1067,"Icon for expanded ranges in the editor glyph margin.")),bd=Ki("folding-collapsed",It.chevronRight,O(1068,"Icon for collapsed ranges in the editor glyph margin.")),au=Ki("folding-manual-collapsed",bd,O(1069,"Icon for manually collapsed ranges in the editor glyph margin.")),lu=Ki("folding-manual-expanded",vd,O(1070,"Icon for manually expanded ranges in the editor glyph margin.")),Ll={color:__(xy),position:Rr.Inline},gs=O(1071,"Click to expand the range."),xr=O(1072,"Click to collapse the range.");class kt{static{this.COLLAPSED_VISUAL_DECORATION=Pe.register({description:"folding-collapsed-visual-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,afterContentClassName:"inline-folded",isWholeLine:!0,linesDecorationsTooltip:gs,firstLineDecorationClassName:ut.asClassName(bd)})}static{this.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=Pe.register({description:"folding-collapsed-highlighted-visual-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,afterContentClassName:"inline-folded",className:"folded-background",minimap:Ll,isWholeLine:!0,linesDecorationsTooltip:gs,firstLineDecorationClassName:ut.asClassName(bd)})}static{this.MANUALLY_COLLAPSED_VISUAL_DECORATION=Pe.register({description:"folding-manually-collapsed-visual-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,afterContentClassName:"inline-folded",isWholeLine:!0,linesDecorationsTooltip:gs,firstLineDecorationClassName:ut.asClassName(au)})}static{this.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION=Pe.register({description:"folding-manually-collapsed-highlighted-visual-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,afterContentClassName:"inline-folded",className:"folded-background",minimap:Ll,isWholeLine:!0,linesDecorationsTooltip:gs,firstLineDecorationClassName:ut.asClassName(au)})}static{this.NO_CONTROLS_COLLAPSED_RANGE_DECORATION=Pe.register({description:"folding-no-controls-range-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,afterContentClassName:"inline-folded",isWholeLine:!0,linesDecorationsTooltip:gs})}static{this.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION=Pe.register({description:"folding-no-controls-range-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,afterContentClassName:"inline-folded",className:"folded-background",minimap:Ll,isWholeLine:!0,linesDecorationsTooltip:gs})}static{this.EXPANDED_VISUAL_DECORATION=Pe.register({description:"folding-expanded-visual-decoration",stickiness:Oe.NeverGrowsWhenTypingAtEdges,isWholeLine:!0,firstLineDecorationClassName:"alwaysShowFoldIcons "+ut.asClassName(vd),linesDecorationsTooltip:xr})}static{this.EXPANDED_AUTO_HIDE_VISUAL_DECORATION=Pe.register({description:"folding-expanded-auto-hide-visual-decoration",stickiness:Oe.NeverGrowsWhenTypingAtEdges,isWholeLine:!0,firstLineDecorationClassName:ut.asClassName(vd),linesDecorationsTooltip:xr})}static{this.MANUALLY_EXPANDED_VISUAL_DECORATION=Pe.register({description:"folding-manually-expanded-visual-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,isWholeLine:!0,firstLineDecorationClassName:"alwaysShowFoldIcons "+ut.asClassName(lu),linesDecorationsTooltip:xr})}static{this.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION=Pe.register({description:"folding-manually-expanded-auto-hide-visual-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,isWholeLine:!0,firstLineDecorationClassName:ut.asClassName(lu),linesDecorationsTooltip:xr})}static{this.NO_CONTROLS_EXPANDED_RANGE_DECORATION=Pe.register({description:"folding-no-controls-range-decoration",stickiness:Oe.AlwaysGrowsWhenTypingAtEdges,isWholeLine:!0})}static{this.HIDDEN_RANGE_DECORATION=Pe.register({description:"folding-hidden-range-decoration",stickiness:Oe.NeverGrowsWhenTypingAtEdges})}constructor(e){this.editor=e,this.showFoldingControls="mouseover",this.showFoldingHighlights=!0}getDecorationOption(e,t,i){return t?kt.HIDDEN_RANGE_DECORATION:this.showFoldingControls==="never"?e?this.showFoldingHighlights?kt.NO_CONTROLS_COLLAPSED_HIGHLIGHTED_RANGE_DECORATION:kt.NO_CONTROLS_COLLAPSED_RANGE_DECORATION:kt.NO_CONTROLS_EXPANDED_RANGE_DECORATION:e?i?this.showFoldingHighlights?kt.MANUALLY_COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:kt.MANUALLY_COLLAPSED_VISUAL_DECORATION:this.showFoldingHighlights?kt.COLLAPSED_HIGHLIGHTED_VISUAL_DECORATION:kt.COLLAPSED_VISUAL_DECORATION:this.showFoldingControls==="mouseover"?i?kt.MANUALLY_EXPANDED_AUTO_HIDE_VISUAL_DECORATION:kt.EXPANDED_AUTO_HIDE_VISUAL_DECORATION:i?kt.MANUALLY_EXPANDED_VISUAL_DECORATION:kt.EXPANDED_VISUAL_DECORATION}changeDecorations(e){return this.editor.changeDecorations(e)}removeDecorations(e){this.editor.removeDecorations(e)}}const Ny=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Xe;(function(a){a[a.provider=0]="provider",a[a.userDefined=1]="userDefined",a[a.recovered=2]="recovered"})(Xe||(Xe={}));const Ey={[Xe.provider]:" ",[Xe.userDefined]:"u",[Xe.recovered]:"r"},du=65535,gi=16777215,cu=4278190080;class vl{constructor(e){const t=Math.ceil(e/32);this._states=new Uint32Array(t)}get(e){const t=e/32|0,i=e%32;return(this._states[t]&1<<i)!==0}set(e,t){const i=e/32|0,n=e%32,s=this._states[i];t?this._states[i]=s|1<<n:this._states[i]=s&~(1<<n)}}class Ft{constructor(e,t,i){if(e.length!==t.length||e.length>du)throw new Error("invalid startIndexes or endIndexes size");this._startIndexes=e,this._endIndexes=t,this._collapseStates=new vl(e.length),this._userDefinedStates=new vl(e.length),this._recoveredStates=new vl(e.length),this._types=i,this._parentsComputed=!1}ensureParentIndices(){if(!this._parentsComputed){this._parentsComputed=!0;const e=[],t=(i,n)=>{const s=e[e.length-1];return this.getStartLineNumber(s)<=i&&this.getEndLineNumber(s)>=n};for(let i=0,n=this._startIndexes.length;i<n;i++){const s=this._startIndexes[i],o=this._endIndexes[i];if(s>gi||o>gi)throw new Error("startLineNumber or endLineNumber must not exceed "+gi);for(;e.length>0&&!t(s,o);)e.pop();const r=e.length>0?e[e.length-1]:-1;e.push(i),this._startIndexes[i]=s+((r&255)<<24),this._endIndexes[i]=o+((r&65280)<<16)}}}get length(){return this._startIndexes.length}getStartLineNumber(e){return this._startIndexes[e]&gi}getEndLineNumber(e){return this._endIndexes[e]&gi}getType(e){return this._types?this._types[e]:void 0}hasTypes(){return!!this._types}isCollapsed(e){return this._collapseStates.get(e)}setCollapsed(e,t){this._collapseStates.set(e,t)}isUserDefined(e){return this._userDefinedStates.get(e)}setUserDefined(e,t){return this._userDefinedStates.set(e,t)}isRecovered(e){return this._recoveredStates.get(e)}setRecovered(e,t){return this._recoveredStates.set(e,t)}getSource(e){return this.isUserDefined(e)?Xe.userDefined:this.isRecovered(e)?Xe.recovered:Xe.provider}setSource(e,t){t===Xe.userDefined?(this.setUserDefined(e,!0),this.setRecovered(e,!1)):t===Xe.recovered?(this.setUserDefined(e,!1),this.setRecovered(e,!0)):(this.setUserDefined(e,!1),this.setRecovered(e,!1))}setCollapsedAllOfType(e,t){let i=!1;if(this._types)for(let n=0;n<this._types.length;n++)this._types[n]===e&&(this.setCollapsed(n,t),i=!0);return i}toRegion(e){return new Iy(this,e)}getParentIndex(e){this.ensureParentIndices();const t=((this._startIndexes[e]&cu)>>>24)+((this._endIndexes[e]&cu)>>>16);return t===du?-1:t}contains(e,t){return this.getStartLineNumber(e)<=t&&this.getEndLineNumber(e)>=t}findIndex(e){let t=0,i=this._startIndexes.length;if(i===0)return-1;for(;t<i;){const n=Math.floor((t+i)/2);e<this.getStartLineNumber(n)?i=n:t=n+1}return t-1}findRange(e){let t=this.findIndex(e);if(t>=0){if(this.getEndLineNumber(t)>=e)return t;for(t=this.getParentIndex(t);t!==-1;){if(this.contains(t,e))return t;t=this.getParentIndex(t)}}return-1}toString(){const e=[];for(let t=0;t<this.length;t++)e[t]=`[${Ey[this.getSource(t)]}${this.isCollapsed(t)?"+":"-"}] ${this.getStartLineNumber(t)}/${this.getEndLineNumber(t)}`;return e.join(", ")}toFoldRange(e){return{startLineNumber:this._startIndexes[e]&gi,endLineNumber:this._endIndexes[e]&gi,type:this._types?this._types[e]:void 0,isCollapsed:this.isCollapsed(e),source:this.getSource(e)}}static fromFoldRanges(e){const t=e.length,i=new Uint32Array(t),n=new Uint32Array(t);let s=[],o=!1;for(let l=0;l<t;l++){const d=e[l];i[l]=d.startLineNumber,n[l]=d.endLineNumber,s.push(d.type),d.type&&(o=!0)}o||(s=void 0);const r=new Ft(i,n,s);for(let l=0;l<t;l++)e[l].isCollapsed&&r.setCollapsed(l,!0),r.setSource(l,e[l].source);return r}static sanitizeAndMerge(e,t,i,n){i=i??Number.MAX_VALUE;const s=(_,L)=>Array.isArray(_)?w=>w<L?_[w]:void 0:w=>w<L?_.toFoldRange(w):void 0,o=s(e,e.length),r=s(t,t.length);let l=0,d=0,c=o(0),h=r(0);const u=[];let g,f=0;const m=[];for(;c||h;){let _;if(h&&(!c||c.startLineNumber>=h.startLineNumber))c&&c.startLineNumber===h.startLineNumber?(h.source===Xe.userDefined?_=h:(_=c,_.isCollapsed=h.isCollapsed&&(c.endLineNumber===h.endLineNumber||!n?.startsInside(c.startLineNumber+1,c.endLineNumber+1)),_.source=Xe.provider),c=o(++l)):(_=h,h.isCollapsed&&h.source===Xe.provider&&(_.source=Xe.recovered)),h=r(++d);else{let L=d,w=h;for(;;){if(!w||w.startLineNumber>c.endLineNumber){_=c;break}if(w.source===Xe.userDefined&&w.endLineNumber>c.endLineNumber)break;w=r(++L)}c=o(++l)}if(_){for(;g&&g.endLineNumber<_.startLineNumber;)g=u.pop();_.endLineNumber>_.startLineNumber&&_.startLineNumber>f&&_.endLineNumber<=i&&(!g||g.endLineNumber>=_.endLineNumber)&&(m.push(_),f=_.startLineNumber,g&&u.push(g),g=_)}}return m}}class Iy{constructor(e,t){this.ranges=e,this.index=t}get startLineNumber(){return this.ranges.getStartLineNumber(this.index)}get endLineNumber(){return this.ranges.getEndLineNumber(this.index)}get regionIndex(){return this.index}get parentIndex(){return this.ranges.getParentIndex(this.index)}get isCollapsed(){return this.ranges.isCollapsed(this.index)}containedBy(e){return e.startLineNumber<=this.startLineNumber&&e.endLineNumber>=this.endLineNumber}containsLine(e){return this.startLineNumber<=e&&e<=this.endLineNumber}hidesLine(e){return this.startLineNumber<e&&e<=this.endLineNumber}}class Ry{get regions(){return this._regions}get textModel(){return this._textModel}get decorationProvider(){return this._decorationProvider}constructor(e,t){this._updateEventEmitter=new Z,this.onDidChange=this._updateEventEmitter.event,this._textModel=e,this._decorationProvider=t,this._regions=new Ft(new Uint32Array(0),new Uint32Array(0)),this._editorDecorationIds=[]}toggleCollapseState(e){if(!e.length)return;e=e.sort((i,n)=>i.regionIndex-n.regionIndex);const t={};this._decorationProvider.changeDecorations(i=>{let n=0,s=-1,o=-1;const r=l=>{for(;n<l;){const d=this._regions.getEndLineNumber(n),c=this._regions.isCollapsed(n);if(d<=s){const h=this.regions.getSource(n)!==Xe.provider;i.changeDecorationOptions(this._editorDecorationIds[n],this._decorationProvider.getDecorationOption(c,d<=o,h))}c&&d>o&&(o=d),n++}};for(const l of e){const d=l.regionIndex,c=this._editorDecorationIds[d];if(c&&!t[c]){t[c]=!0,r(d);const h=!this._regions.isCollapsed(d);this._regions.setCollapsed(d,h),s=Math.max(s,this._regions.getEndLineNumber(d))}}r(this._regions.length)}),this._updateEventEmitter.fire({model:this,collapseStateChanged:e})}removeManualRanges(e){const t=new Array,i=n=>{for(const s of e)if(!(s.startLineNumber>n.endLineNumber||n.startLineNumber>s.endLineNumber))return!0;return!1};for(let n=0;n<this._regions.length;n++){const s=this._regions.toFoldRange(n);(s.source===Xe.provider||!i(s))&&t.push(s)}this.updatePost(Ft.fromFoldRanges(t))}update(e,t){const i=this._currentFoldedOrManualRanges(t),n=Ft.sanitizeAndMerge(e,i,this._textModel.getLineCount(),t);this.updatePost(Ft.fromFoldRanges(n))}updatePost(e){const t=[];let i=-1;for(let n=0,s=e.length;n<s;n++){const o=e.getStartLineNumber(n),r=e.getEndLineNumber(n),l=e.isCollapsed(n),d=e.getSource(n)!==Xe.provider,c={startLineNumber:o,startColumn:this._textModel.getLineMaxColumn(o),endLineNumber:r,endColumn:this._textModel.getLineMaxColumn(r)+1};t.push({range:c,options:this._decorationProvider.getDecorationOption(l,r<=i,d)}),l&&r>i&&(i=r)}this._decorationProvider.changeDecorations(n=>this._editorDecorationIds=n.deltaDecorations(this._editorDecorationIds,t)),this._regions=e,this._updateEventEmitter.fire({model:this})}_currentFoldedOrManualRanges(e){const t=[];for(let i=0,n=this._regions.length;i<n;i++){let s=this.regions.isCollapsed(i);const o=this.regions.getSource(i);if(s||o!==Xe.provider){const r=this._regions.toFoldRange(i),l=this._textModel.getDecorationRange(this._editorDecorationIds[i]);l&&(s&&e?.startsInside(l.startLineNumber+1,l.endLineNumber)&&(s=!1),t.push({startLineNumber:l.startLineNumber,endLineNumber:l.endLineNumber,type:r.type,isCollapsed:s,source:o}))}}return t}getMemento(){const e=this._currentFoldedOrManualRanges(),t=[],i=this._textModel.getLineCount();for(let n=0,s=e.length;n<s;n++){const o=e[n];if(o.startLineNumber>=o.endLineNumber||o.startLineNumber<1||o.endLineNumber>i)continue;const r=this._getLinesChecksum(o.startLineNumber+1,o.endLineNumber);t.push({startLineNumber:o.startLineNumber,endLineNumber:o.endLineNumber,isCollapsed:o.isCollapsed,source:o.source,checksum:r})}return t.length>0?t:void 0}applyMemento(e){if(!Array.isArray(e))return;const t=[],i=this._textModel.getLineCount();for(const s of e){if(s.startLineNumber>=s.endLineNumber||s.startLineNumber<1||s.endLineNumber>i)continue;const o=this._getLinesChecksum(s.startLineNumber+1,s.endLineNumber);(!s.checksum||o===s.checksum)&&t.push({startLineNumber:s.startLineNumber,endLineNumber:s.endLineNumber,type:void 0,isCollapsed:s.isCollapsed??!0,source:s.source??Xe.provider})}const n=Ft.sanitizeAndMerge(this._regions,t,i);this.updatePost(Ft.fromFoldRanges(n))}_getLinesChecksum(e,t){return Fu(this._textModel.getLineContent(e)+this._textModel.getLineContent(t))%1e6}dispose(){this._decorationProvider.removeDecorations(this._editorDecorationIds)}getAllRegionsAtLine(e,t){const i=[];if(this._regions){let n=this._regions.findRange(e),s=1;for(;n>=0;){const o=this._regions.toRegion(n);(!t||t(o,s))&&i.push(o),s++,n=o.parentIndex}}return i}getRegionAtLine(e){if(this._regions){const t=this._regions.findRange(e);if(t>=0)return this._regions.toRegion(t)}return null}getRegionsInside(e,t){const i=[],n=e?e.regionIndex+1:0,s=e?e.endLineNumber:Number.MAX_VALUE;if(t&&t.length===2){const o=[];for(let r=n,l=this._regions.length;r<l;r++){const d=this._regions.toRegion(r);if(this._regions.getStartLineNumber(r)<s){for(;o.length>0&&!d.containedBy(o[o.length-1]);)o.pop();o.push(d),t(d,o.length)&&i.push(d)}else break}}else for(let o=n,r=this._regions.length;o<r;o++){const l=this._regions.toRegion(o);if(this._regions.getStartLineNumber(o)<s)(!t||t(l))&&i.push(l);else break}return i}}function nf(a,e,t){const i=[];for(const n of t){const s=a.getRegionAtLine(n);if(s){const o=!s.isCollapsed;if(i.push(s),e>1){const r=a.getRegionsInside(s,(l,d)=>l.isCollapsed!==o&&d<e);i.push(...r)}}}a.toggleCollapseState(i)}function Js(a,e,t=Number.MAX_VALUE,i){const n=[];if(i&&i.length>0)for(const s of i){const o=a.getRegionAtLine(s);if(o&&(o.isCollapsed!==e&&n.push(o),t>1)){const r=a.getRegionsInside(o,(l,d)=>l.isCollapsed!==e&&d<t);n.push(...r)}}else{const s=a.getRegionsInside(null,(o,r)=>o.isCollapsed!==e&&r<t);n.push(...s)}a.toggleCollapseState(n)}function sf(a,e,t,i){const n=[];for(const s of i){const o=a.getAllRegionsAtLine(s,(r,l)=>r.isCollapsed!==e&&l<=t);n.push(...o)}a.toggleCollapseState(n)}function Dy(a,e,t){const i=[];for(const n of t){const s=a.getAllRegionsAtLine(n,o=>o.isCollapsed!==e);s.length>0&&i.push(s[0])}a.toggleCollapseState(i)}function Ty(a,e,t,i){const n=(o,r)=>r===e&&o.isCollapsed!==t&&!i.some(l=>o.containsLine(l)),s=a.getRegionsInside(null,n);a.toggleCollapseState(s)}function of(a,e,t){const i=[];for(const o of t){const r=a.getAllRegionsAtLine(o,void 0);r.length>0&&i.push(r[0])}const n=o=>i.every(r=>!r.containedBy(o)&&!o.containedBy(r))&&o.isCollapsed!==e,s=a.getRegionsInside(null,n);a.toggleCollapseState(s)}function wc(a,e,t){const i=a.textModel,n=a.regions,s=[];for(let o=n.length-1;o>=0;o--)if(t!==n.isCollapsed(o)){const r=n.getStartLineNumber(o);e.test(i.getLineContent(r))&&s.push(n.toRegion(o))}a.toggleCollapseState(s)}function Lc(a,e,t){const i=a.regions,n=[];for(let s=i.length-1;s>=0;s--)t!==i.isCollapsed(s)&&e===i.getType(s)&&n.push(i.toRegion(s));a.toggleCollapseState(n)}function My(a,e){let t=null;const i=e.getRegionAtLine(a);if(i!==null&&(t=i.startLineNumber,a===t)){const n=i.parentIndex;n!==-1?t=e.regions.getStartLineNumber(n):t=null}return t}function Ay(a,e){let t=e.getRegionAtLine(a);if(t!==null&&t.startLineNumber===a){if(a!==t.startLineNumber)return t.startLineNumber;{const i=t.parentIndex;let n=0;for(i!==-1&&(n=e.regions.getStartLineNumber(t.parentIndex));t!==null;)if(t.regionIndex>0){if(t=e.regions.toRegion(t.regionIndex-1),t.startLineNumber<=n)return null;if(t.parentIndex===i)return t.startLineNumber}else return null}}else if(e.regions.length>0)for(t=e.regions.toRegion(e.regions.length-1);t!==null;){if(t.startLineNumber<a)return t.startLineNumber;t.regionIndex>0?t=e.regions.toRegion(t.regionIndex-1):t=null}return null}function Oy(a,e){let t=e.getRegionAtLine(a);if(t!==null&&t.startLineNumber===a){const i=t.parentIndex;let n=0;if(i!==-1)n=e.regions.getEndLineNumber(t.parentIndex);else{if(e.regions.length===0)return null;n=e.regions.getEndLineNumber(e.regions.length-1)}for(;t!==null;)if(t.regionIndex<e.regions.length){if(t=e.regions.toRegion(t.regionIndex+1),t.startLineNumber>=n)return null;if(t.parentIndex===i)return t.startLineNumber}else return null}else if(e.regions.length>0)for(t=e.regions.toRegion(0);t!==null;){if(t.startLineNumber>a)return t.startLineNumber;t.regionIndex<e.regions.length?t=e.regions.toRegion(t.regionIndex+1):t=null}return null}class Py{get onDidChange(){return this._updateEventEmitter.event}get hiddenRanges(){return this._hiddenRanges}constructor(e){this._updateEventEmitter=new Z,this._hasLineChanges=!1,this._foldingModel=e,this._foldingModelListener=e.onDidChange(t=>this.updateHiddenRanges()),this._hiddenRanges=[],e.regions.length&&this.updateHiddenRanges()}notifyChangeModelContent(e){this._hiddenRanges.length&&!this._hasLineChanges&&(this._hasLineChanges=e.changes.some(t=>t.range.endLineNumber!==t.range.startLineNumber||C_(t.text)[0]!==0))}updateHiddenRanges(){let e=!1;const t=[];let i=0,n=0,s=Number.MAX_VALUE,o=-1;const r=this._foldingModel.regions;for(;i<r.length;i++){if(!r.isCollapsed(i))continue;const l=r.getStartLineNumber(i)+1,d=r.getEndLineNumber(i);s<=l&&d<=o||(!e&&n<this._hiddenRanges.length&&this._hiddenRanges[n].startLineNumber===l&&this._hiddenRanges[n].endLineNumber===d?(t.push(this._hiddenRanges[n]),n++):(e=!0,t.push(new N(l,1,d,1))),s=l,o=d)}(this._hasLineChanges||e||n<this._hiddenRanges.length)&&this.applyHiddenRanges(t)}applyHiddenRanges(e){this._hiddenRanges=e,this._hasLineChanges=!1,this._updateEventEmitter.fire(e)}hasRanges(){return this._hiddenRanges.length>0}isHidden(e){return hu(this._hiddenRanges,e)!==null}adjustSelections(e){let t=!1;const i=this._foldingModel.textModel;let n=null;const s=o=>((!n||!ky(o,n))&&(n=hu(this._hiddenRanges,o)),n?n.startLineNumber-1:null);for(let o=0,r=e.length;o<r;o++){let l=e[o];const d=s(l.startLineNumber);d&&(l=l.setStartPosition(d,i.getLineMaxColumn(d)),t=!0);const c=s(l.endLineNumber);c&&(l=l.setEndPosition(c,i.getLineMaxColumn(c)),t=!0),e[o]=l}return t}dispose(){this.hiddenRanges.length>0&&(this._hiddenRanges=[],this._updateEventEmitter.fire(this._hiddenRanges)),this._foldingModelListener&&(this._foldingModelListener.dispose(),this._foldingModelListener=null)}}function ky(a,e){return a>=e.startLineNumber&&a<=e.endLineNumber}function hu(a,e){const t=w_(a,i=>e<i.startLineNumber)-1;return t>=0&&a[t].endLineNumber>=e?a[t]:null}const Wy=5e3,Vy="indent";class rf{constructor(e,t,i){this.editorModel=e,this.languageConfigurationService=t,this.foldingRangesLimit=i,this.id=Vy}dispose(){}compute(e){const t=this.languageConfigurationService.getLanguageConfiguration(this.editorModel.getLanguageId()).foldingRules,i=t&&!!t.offSide,n=t&&t.markers;return Promise.resolve(By(this.editorModel,i,n,this.foldingRangesLimit))}}let Fy=class{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,i){if(e>gi||t>gi)return;const n=this._length;this._startIndexes[n]=e,this._endIndexes[n]=t,this._length++,i<1e3&&(this._indentOccurrences[i]=(this._indentOccurrences[i]||0)+1)}toIndentRanges(e){const t=this._foldingRangesLimit.limit;if(this._length<=t){this._foldingRangesLimit.update(this._length,!1);const i=new Uint32Array(this._length),n=new Uint32Array(this._length);for(let s=this._length-1,o=0;s>=0;s--,o++)i[o]=this._startIndexes[s],n[o]=this._endIndexes[s];return new Ft(i,n)}else{this._foldingRangesLimit.update(this._length,t);let i=0,n=this._indentOccurrences.length;for(let l=0;l<this._indentOccurrences.length;l++){const d=this._indentOccurrences[l];if(d){if(d+i>t){n=l;break}i+=d}}const s=e.getOptions().tabSize,o=new Uint32Array(t),r=new Uint32Array(t);for(let l=this._length-1,d=0;l>=0;l--){const c=this._startIndexes[l],h=e.getLineContent(c),u=Xu(h,s);(u<n||u===n&&i++<t)&&(o[d]=c,r[d]=this._endIndexes[l],d++)}return new Ft(o,r)}}};const Hy={limit:Wy,update:()=>{}};function By(a,e,t,i=Hy){const n=a.getOptions().tabSize,s=new Fy(i);let o;t&&(o=new RegExp(`(${t.start.source})|(?:${t.end.source})`));const r=[],l=a.getLineCount()+1;r.push({indent:-1,endAbove:l,line:l});for(let d=a.getLineCount();d>0;d--){const c=a.getLineContent(d),h=Xu(c,n);let u=r[r.length-1];if(h===-1){e&&(u.endAbove=d);continue}let g;if(o&&(g=c.match(o)))if(g[1]){let f=r.length-1;for(;f>0&&r[f].indent!==-2;)f--;if(f>0){r.length=f+1,u=r[f],s.insertFirst(d,u.line,h),u.line=d,u.indent=h,u.endAbove=d;continue}}else{r.push({indent:-2,endAbove:d,line:d});continue}if(u.indent>h){do r.pop(),u=r[r.length-1];while(u.indent>h);const f=u.endAbove-1;f-d>=1&&s.insertFirst(d,f,h)}u.indent===h?u.endAbove=d:r.push({indent:h,endAbove:d,line:d})}return s.toIndentRanges(a)}const zy={},Uy="syntax";class af{constructor(e,t,i,n,s){this.editorModel=e,this.providers=t,this.handleFoldingRangesChange=i,this.foldingRangesLimit=n,this.fallbackRangeProvider=s,this.id=Uy,this.disposables=new Ot,s&&this.disposables.add(s);for(const o of t)typeof o.onDidChange=="function"&&this.disposables.add(o.onDidChange(i))}compute(e){return Gy(this.providers,this.editorModel,e).then(t=>this.editorModel.isDisposed()?null:t?Ky(t,this.foldingRangesLimit):this.fallbackRangeProvider?.compute(e)??null)}dispose(){this.disposables.dispose()}}function Gy(a,e,t){let i=null;const n=a.map((s,o)=>Promise.resolve(s.provideFoldingRanges(e,zy,t)).then(r=>{if(!t.isCancellationRequested&&Array.isArray(r)){Array.isArray(i)||(i=[]);const l=e.getLineCount();for(const d of r)d.start>0&&d.end>d.start&&d.end<=l&&i.push({start:d.start,end:d.end,rank:o,kind:d.kind})}},Pa));return Promise.all(n).then(s=>i)}class jy{constructor(e){this._startIndexes=[],this._endIndexes=[],this._nestingLevels=[],this._nestingLevelCounts=[],this._types=[],this._length=0,this._foldingRangesLimit=e}add(e,t,i,n){if(e>gi||t>gi)return;const s=this._length;this._startIndexes[s]=e,this._endIndexes[s]=t,this._nestingLevels[s]=n,this._types[s]=i,this._length++,n<30&&(this._nestingLevelCounts[n]=(this._nestingLevelCounts[n]||0)+1)}toIndentRanges(){const e=this._foldingRangesLimit.limit;if(this._length<=e){this._foldingRangesLimit.update(this._length,!1);const t=new Uint32Array(this._length),i=new Uint32Array(this._length);for(let n=0;n<this._length;n++)t[n]=this._startIndexes[n],i[n]=this._endIndexes[n];return new Ft(t,i,this._types)}else{this._foldingRangesLimit.update(this._length,e);let t=0,i=this._nestingLevelCounts.length;for(let r=0;r<this._nestingLevelCounts.length;r++){const l=this._nestingLevelCounts[r];if(l){if(l+t>e){i=r;break}t+=l}}const n=new Uint32Array(e),s=new Uint32Array(e),o=[];for(let r=0,l=0;r<this._length;r++){const d=this._nestingLevels[r];(d<i||d===i&&t++<e)&&(n[l]=this._startIndexes[r],s[l]=this._endIndexes[r],o[l]=this._types[r],l++)}return new Ft(n,s,o)}}}function Ky(a,e){const t=a.sort((o,r)=>{let l=o.start-r.start;return l===0&&(l=o.rank-r.rank),l}),i=new jy(e);let n;const s=[];for(const o of t)if(!n)n=o,i.add(o.start,o.end,o.kind&&o.kind.value,s.length);else if(o.start>n.start)if(o.end<=n.end)s.push(n),n=o,i.add(o.start,o.end,o.kind&&o.kind.value,s.length);else{if(o.start>n.end){do n=s.pop();while(n&&o.start>n.end);n&&s.push(n),n=o}i.add(o.start,o.end,o.kind&&o.kind.value,s.length)}return i.toIndentRanges()}var xn;Ee(Ny);const Je=new Hu("foldingEnabled",!1);let zs=class extends U{static{xn=this}static{this.ID="editor.contrib.folding"}static get(e){return e.getContribution(xn.ID)}static getFoldingRangeProviders(e,t){const i=e.foldingRangeProvider.ordered(t);return xn._foldingRangeSelector?.(i,t)??i}static setFoldingRangeProviderSelector(e){return xn._foldingRangeSelector=e,{dispose:()=>{xn._foldingRangeSelector=void 0}}}constructor(e,t,i,n,s,o){super(),this.contextKeyService=t,this.languageConfigurationService=i,this.languageFeaturesService=o,this.localToDispose=this._register(new Ot),this.editor=e,this._foldingLimitReporter=this._register(new $y(e));const r=this.editor.getOptions();this._isEnabled=r.get(v.folding),this._useFoldingProviders=r.get(v.foldingStrategy)!=="indentation",this._unfoldOnClickAfterEndOfLine=r.get(v.unfoldOnClickAfterEndOfLine),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=r.get(v.foldingImportsByDefault),this.updateDebounceInfo=s.for(o.foldingRangeProvider,"Folding",{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new kt(e),this.foldingDecorationProvider.showFoldingControls=r.get(v.showFoldingControls),this.foldingDecorationProvider.showFoldingHighlights=r.get(v.foldingHighlight),this.foldingEnabled=Je.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._register(this.editor.onDidChangeModel(()=>this.onModelChanged())),this._register(this.editor.onDidChangeConfiguration(l=>{if(l.hasChanged(v.folding)&&(this._isEnabled=this.editor.getOptions().get(v.folding),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),l.hasChanged(v.foldingMaximumRegions)&&this.onModelChanged(),l.hasChanged(v.showFoldingControls)||l.hasChanged(v.foldingHighlight)){const d=this.editor.getOptions();this.foldingDecorationProvider.showFoldingControls=d.get(v.showFoldingControls),this.foldingDecorationProvider.showFoldingHighlights=d.get(v.foldingHighlight),this.triggerFoldingModelChanged()}l.hasChanged(v.foldingStrategy)&&(this._useFoldingProviders=this.editor.getOptions().get(v.foldingStrategy)!=="indentation",this.onFoldingStrategyChanged()),l.hasChanged(v.unfoldOnClickAfterEndOfLine)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(v.unfoldOnClickAfterEndOfLine)),l.hasChanged(v.foldingImportsByDefault)&&(this._foldingImportsByDefault=this.editor.getOptions().get(v.foldingImportsByDefault))})),this.onModelChanged()}get limitReporter(){return this._foldingLimitReporter}saveViewState(){const e=this.editor.getModel();if(!e||!this._isEnabled||e.isTooLargeForTokenization())return{};if(this.foldingModel){const t=this.foldingModel.getMemento(),i=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:t,lineCount:e.getLineCount(),provider:i,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(e){const t=this.editor.getModel();if(!(!t||!this._isEnabled||t.isTooLargeForTokenization()||!this.hiddenRangeModel)&&e&&(this._currentModelHasFoldedImports=!!e.foldedImports,e.collapsedRegions&&e.collapsedRegions.length>0&&this.foldingModel)){this._restoringViewState=!0;try{this.foldingModel.applyMemento(e.collapsedRegions)}finally{this._restoringViewState=!1}}}onModelChanged(){this.localToDispose.clear();const e=this.editor.getModel();!this._isEnabled||!e||e.isTooLargeForTokenization()||(this._currentModelHasFoldedImports=!1,this.foldingModel=new Ry(e,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new Py(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange(t=>this.onHiddenRangesChanges(t))),this.updateScheduler=new L_(this.updateDebounceInfo.get(e)),this.cursorChangedScheduler=new Ei(()=>this.revealCursor(),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration(()=>this.onFoldingStrategyChanged())),this.localToDispose.add(this.editor.onDidChangeModelContent(t=>this.onDidChangeModelContent(t))),this.localToDispose.add(this.editor.onDidChangeCursorPosition(()=>this.onCursorPositionChanged())),this.localToDispose.add(this.editor.onMouseDown(t=>this.onEditorMouseDown(t))),this.localToDispose.add(this.editor.onMouseUp(t=>this.onEditorMouseUp(t))),this.localToDispose.add({dispose:()=>{this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),this.updateScheduler?.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,this.rangeProvider?.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){this.rangeProvider?.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(e){if(this.rangeProvider)return this.rangeProvider;const t=new rf(e,this.languageConfigurationService,this._foldingLimitReporter);if(this.rangeProvider=t,this._useFoldingProviders&&this.foldingModel){const i=xn.getFoldingRangeProviders(this.languageFeaturesService,e);i.length>0&&(this.rangeProvider=new af(e,i,()=>this.triggerFoldingModelChanged(),this._foldingLimitReporter,t))}return this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(e){this.hiddenRangeModel?.notifyChangeModelContent(e),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),this.foldingModelPromise=this.updateScheduler.trigger(()=>{const e=this.foldingModel;if(!e)return null;const t=new v_,i=this.getRangeProvider(e.textModel),n=this.foldingRegionPromise=b_(s=>i.compute(s));return n.then(s=>{if(s&&n===this.foldingRegionPromise){let o;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){const d=s.setCollapsedAllOfType(ns.Imports.value,!0);d&&(o=Hs.capture(this.editor),this._currentModelHasFoldedImports=d)}const r=this.editor.getSelections();e.update(s,Zy(r)),o?.restore(this.editor);const l=this.updateDebounceInfo.update(e.textModel,t.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=l)}return e})}).then(void 0,e=>(vt(e),null)))}onHiddenRangesChanges(e){if(this.hiddenRangeModel&&e.length&&!this._restoringViewState){const t=this.editor.getSelections();t&&this.hiddenRangeModel.adjustSelections(t)&&this.editor.setSelections(t)}this.editor.setHiddenAreas(e,this)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){const e=this.getFoldingModel();e&&e.then(t=>{if(t){const i=this.editor.getSelections();if(i&&i.length>0){const n=[];for(const s of i){const o=s.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(o)&&n.push(...t.getAllRegionsAtLine(o,r=>r.isCollapsed&&o>r.startLineNumber))}n.length&&(t.toggleCollapseState(n),this.reveal(i[0].getPosition()))}}}).then(void 0,vt)}onEditorMouseDown(e){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!e.target||!e.target.range||!e.event.leftButton&&!e.event.middleButton)return;const t=e.target.range;let i=!1;switch(e.target.type){case ee.GUTTER_LINE_DECORATIONS:{const n=e.target.detail,s=e.target.element.offsetLeft;if(n.offsetX-s<4)return;i=!0;break}case ee.CONTENT_EMPTY:{if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()&&!e.target.detail.isAfterLines)break;return}case ee.CONTENT_TEXT:{if(this.hiddenRangeModel.hasRanges()){const n=this.editor.getModel();if(n&&t.startColumn===n.getLineMaxColumn(t.startLineNumber))break}return}default:return}this.mouseDownInfo={lineNumber:t.startLineNumber,iconClicked:i}}onEditorMouseUp(e){const t=this.foldingModel;if(!t||!this.mouseDownInfo||!e.target)return;const i=this.mouseDownInfo.lineNumber,n=this.mouseDownInfo.iconClicked,s=e.target.range;if(!s||s.startLineNumber!==i)return;if(n){if(e.target.type!==ee.GUTTER_LINE_DECORATIONS)return}else{const r=this.editor.getModel();if(!r||s.startColumn!==r.getLineMaxColumn(i))return}const o=t.getRegionAtLine(i);if(o&&o.startLineNumber===i){const r=o.isCollapsed;if(n||r){const l=e.event.altKey;let d=[];if(l){const c=u=>!u.containedBy(o)&&!o.containedBy(u),h=t.getRegionsInside(null,c);for(const u of h)u.isCollapsed&&d.push(u);d.length===0&&(d=h)}else{const c=e.event.middleButton||e.event.shiftKey;if(c)for(const h of t.getRegionsInside(o))h.isCollapsed===r&&d.push(h);(r||!c||d.length===0)&&d.push(o)}t.toggleCollapseState(d),this.reveal({lineNumber:i,column:1})}}}reveal(e){this.editor.revealPositionInCenterIfOutsideViewport(e,K.Smooth)}};zs=xn=ge([P(1,ot),P(2,mn),P(3,is),P(4,QC),P(5,Ce)],zs);class $y extends U{constructor(e){super(),this.editor=e,this._onDidChange=this._register(new Z),this.onDidChange=this._onDidChange.event,this._computed=0,this._limited=!1}get limit(){return this.editor.getOptions().get(v.foldingMaximumRegions)}get computed(){return this._computed}get limited(){return this._limited}update(e,t){(e!==this._computed||t!==this._limited)&&(this._computed=e,this._limited=t,this._onDidChange.fire())}}class it extends y_{runEditorCommand(e,t,i){const n=e.get(mn),s=zs.get(t);if(!s)return;const o=s.getFoldingModel();if(o)return this.reportTelemetry(e,t),o.then(r=>{if(r){this.invoke(s,r,t,i,n);const l=t.getSelection();l&&s.reveal(l.getStartPosition())}})}getSelectedLines(e){const t=e.getSelections();return t?t.map(i=>i.startLineNumber):[]}getLineNumbers(e,t){return e&&e.selectionLines?e.selectionLines.map(i=>i+1):this.getSelectedLines(t)}run(e,t){}}function Zy(a){return!a||a.length===0?{startsInside:()=>!1}:{startsInside(e,t){for(const i of a){const n=i.startLineNumber;if(n>=e&&n<=t)return!0}return!1}}}function lf(a){if(!pi(a)){if(!js(a))return!1;const e=a;if(!pi(e.levels)&&!Oo(e.levels)||!pi(e.direction)&&!Qn(e.direction)||!pi(e.selectionLines)&&(!Array.isArray(e.selectionLines)||!e.selectionLines.every(Oo)))return!1}return!0}class qy extends it{constructor(){super({id:"editor.unfold",label:tt(1044,"Unfold"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:M.CtrlCmd|M.Shift|T.BracketRight,mac:{primary:M.CtrlCmd|M.Alt|T.BracketRight},weight:$e.EditorContrib},metadata:{description:"Unfold the content in the editor",args:[{name:"Unfold editor argument",description:`Property-value pairs that can be passed through this argument:
						* 'levels': Number of levels to unfold. If not set, defaults to 1.
						* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.
						* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.
						`,constraint:lf,schema:{type:"object",properties:{levels:{type:"number",default:1},direction:{type:"string",enum:["up","down"],default:"down"},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,i,n){const s=n&&n.levels||1,o=this.getLineNumbers(n,i);n&&n.direction==="up"?sf(t,!1,s,o):Js(t,!1,s,o)}}class Xy extends it{constructor(){super({id:"editor.unfoldRecursively",label:tt(1045,"Unfold Recursively"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.BracketRight),weight:$e.EditorContrib}})}invoke(e,t,i,n){Js(t,!1,Number.MAX_VALUE,this.getSelectedLines(i))}}class Yy extends it{constructor(){super({id:"editor.fold",label:tt(1046,"Fold"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:M.CtrlCmd|M.Shift|T.BracketLeft,mac:{primary:M.CtrlCmd|M.Alt|T.BracketLeft},weight:$e.EditorContrib},metadata:{description:"Fold the content in the editor",args:[{name:"Fold editor argument",description:`Property-value pairs that can be passed through this argument:
							* 'levels': Number of levels to fold.
							* 'direction': If 'up', folds given number of levels up otherwise folds down.
							* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.
							If no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.
						`,constraint:lf,schema:{type:"object",properties:{levels:{type:"number"},direction:{type:"string",enum:["up","down"]},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,i,n){const s=this.getLineNumbers(n,i),o=n&&n.levels,r=n&&n.direction;typeof o!="number"&&typeof r!="string"?Dy(t,!0,s):r==="up"?sf(t,!0,o||1,s):Js(t,!0,o||1,s)}}class Qy extends it{constructor(){super({id:"editor.toggleFold",label:tt(1047,"Toggle Fold"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.KeyL),weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);nf(t,1,n)}}class Jy extends it{constructor(){super({id:"editor.foldRecursively",label:tt(1048,"Fold Recursively"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.BracketLeft),weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);Js(t,!0,Number.MAX_VALUE,n)}}class ex extends it{constructor(){super({id:"editor.toggleFoldRecursively",label:tt(1049,"Toggle Fold Recursively"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|M.Shift|T.KeyL),weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);nf(t,Number.MAX_VALUE,n)}}class tx extends it{constructor(){super({id:"editor.foldAllBlockComments",label:tt(1050,"Fold All Block Comments"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Slash),weight:$e.EditorContrib}})}invoke(e,t,i,n,s){if(t.regions.hasTypes())Lc(t,ns.Comment.value,!0);else{const o=i.getModel();if(!o)return;const r=s.getLanguageConfiguration(o.getLanguageId()).comments;if(r&&r.blockCommentStartToken){const l=new RegExp("^\\s*"+Sl(r.blockCommentStartToken));wc(t,l,!0)}}}}class ix extends it{constructor(){super({id:"editor.foldAllMarkerRegions",label:tt(1051,"Fold All Regions"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Digit8),weight:$e.EditorContrib}})}invoke(e,t,i,n,s){if(t.regions.hasTypes())Lc(t,ns.Region.value,!0);else{const o=i.getModel();if(!o)return;const r=s.getLanguageConfiguration(o.getLanguageId()).foldingRules;if(r&&r.markers&&r.markers.start){const l=new RegExp(r.markers.start);wc(t,l,!0)}}}}class nx extends it{constructor(){super({id:"editor.unfoldAllMarkerRegions",label:tt(1052,"Unfold All Regions"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Digit9),weight:$e.EditorContrib}})}invoke(e,t,i,n,s){if(t.regions.hasTypes())Lc(t,ns.Region.value,!1);else{const o=i.getModel();if(!o)return;const r=s.getLanguageConfiguration(o.getLanguageId()).foldingRules;if(r&&r.markers&&r.markers.start){const l=new RegExp(r.markers.start);wc(t,l,!1)}}}}class sx extends it{constructor(){super({id:"editor.foldAllExcept",label:tt(1053,"Fold All Except Selected"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Minus),weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);of(t,!0,n)}}class ox extends it{constructor(){super({id:"editor.unfoldAllExcept",label:tt(1054,"Unfold All Except Selected"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Equal),weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);of(t,!1,n)}}class rx extends it{constructor(){super({id:"editor.foldAll",label:tt(1055,"Fold All"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Digit0),weight:$e.EditorContrib}})}invoke(e,t,i){Js(t,!0)}}class ax extends it{constructor(){super({id:"editor.unfoldAll",label:tt(1056,"Unfold All"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.KeyJ),weight:$e.EditorContrib}})}invoke(e,t,i){Js(t,!1)}}class Ko extends it{static{this.ID_PREFIX="editor.foldLevel"}static{this.ID=e=>Ko.ID_PREFIX+e}getFoldingLevel(){return parseInt(this.id.substr(Ko.ID_PREFIX.length))}invoke(e,t,i){Ty(t,this.getFoldingLevel(),!0,this.getSelectedLines(i))}}class lx extends it{constructor(){super({id:"editor.gotoParentFold",label:tt(1057,"Go to Parent Fold"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);if(n.length>0){const s=My(n[0],t);s!==null&&i.setSelection({startLineNumber:s,startColumn:1,endLineNumber:s,endColumn:1})}}}class dx extends it{constructor(){super({id:"editor.gotoPreviousFold",label:tt(1058,"Go to Previous Folding Range"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);if(n.length>0){const s=Ay(n[0],t);s!==null&&i.setSelection({startLineNumber:s,startColumn:1,endLineNumber:s,endColumn:1})}}}class cx extends it{constructor(){super({id:"editor.gotoNextFold",label:tt(1059,"Go to Next Folding Range"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,weight:$e.EditorContrib}})}invoke(e,t,i){const n=this.getSelectedLines(i);if(n.length>0){const s=Oy(n[0],t);s!==null&&i.setSelection({startLineNumber:s,startColumn:1,endLineNumber:s,endColumn:1})}}}class hx extends it{constructor(){super({id:"editor.createFoldingRangeFromSelection",label:tt(1060,"Create Folding Range from Selection"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Comma),weight:$e.EditorContrib}})}invoke(e,t,i){const n=[],s=i.getSelections();if(s){for(const o of s){let r=o.endLineNumber;o.endColumn===1&&--r,r>o.startLineNumber&&(n.push({startLineNumber:o.startLineNumber,endLineNumber:r,type:void 0,isCollapsed:!0,source:Xe.userDefined}),i.setSelection({startLineNumber:o.startLineNumber,startColumn:1,endLineNumber:o.startLineNumber,endColumn:1}))}if(n.length>0){n.sort((r,l)=>r.startLineNumber-l.startLineNumber);const o=Ft.sanitizeAndMerge(t.regions,n,i.getModel()?.getLineCount());t.updatePost(Ft.fromFoldRanges(o))}}}}class ux extends it{constructor(){super({id:"editor.removeManualFoldingRanges",label:tt(1061,"Remove Manual Folding Ranges"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Period),weight:$e.EditorContrib}})}invoke(e,t,i){const n=i.getSelections();if(n){const s=[];for(const o of n){const{startLineNumber:r,endLineNumber:l}=o;s.push(l>=r?{startLineNumber:r,endLineNumber:l}:{endLineNumber:l,startLineNumber:r})}t.removeManualRanges(s),e.triggerFoldingModelChanged()}}}class gx extends it{constructor(){super({id:"editor.toggleImportFold",label:tt(1062,"Toggle Import Fold"),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,weight:$e.EditorContrib}})}async invoke(e,t){const i=[],n=t.regions;for(let s=n.length-1;s>=0;s--)n.getType(s)===ns.Imports.value&&i.push(n.toRegion(s));t.toggleCollapseState(i),e.triggerFoldingModelChanged()}}Lu(zs.ID,zs,Kt.Eager);rt(qy);rt(Xy);rt(Yy);rt(Jy);rt(ex);rt(rx);rt(ax);rt(tx);rt(ix);rt(nx);rt(sx);rt(ox);rt(Qy);rt(lx);rt(dx);rt(cx);rt(hx);rt(ux);rt(gx);for(let a=1;a<=7;a++)S_(new Ko({id:Ko.ID(a),label:tt(1063,"Fold Level {0}",a),precondition:Je,kbOpts:{kbExpr:k.editorTextFocus,primary:Gt(M.CtrlCmd|T.KeyK,M.CtrlCmd|T.Digit0+a),weight:$e.EditorContrib}}));pn.registerCommand("_executeFoldingRangeProvider",async function(a,...e){const[t]=e;if(!(t instanceof Xs))throw qc();const i=a.get(Ce),n=a.get(Di).getModel(t);if(!n)throw qc();const s=a.get(Gi);if(!s.getValue("editor.folding",{resource:t}))return[];const o=a.get(mn),r=s.getValue("editor.foldingStrategy",{resource:t}),l={get limit(){return s.getValue("editor.foldingMaximumRegions",{resource:t})},update:(g,f)=>{}},d=new rf(n,o,l);let c=d;if(r!=="indentation"){const g=zs.getFoldingRangeProviders(i,n);g.length&&(c=new af(n,g,()=>{},l,d))}const h=await c.compute(ka.None),u=[];try{if(h)for(let g=0;g<h.length;g++){const f=h.getType(g);u.push({start:h.getStartLineNumber(g),end:h.getEndLineNumber(g),kind:f?ns.fromValue(f):void 0})}return u}finally{c.dispose()}});const fx=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function mx(a,e){return new px(a,e)}class px extends x_{constructor(e,t){super(t.worker,t.keepIdleModels||!1,e),this._foreignModuleHost=t.host||null,this._foreignProxy=this._getProxy().then(i=>new Proxy({},{get(n,s,o){if(typeof s!="string")throw new Error("Not supported");if(s!=="then")return(...r)=>i.$fmr(s,r)}}))}fhr(e,t){if(!this._foreignModuleHost||typeof this._foreignModuleHost[e]!="function")return Promise.reject(new Error("Missing method "+e+" or missing main thread foreign host."));try{return Promise.resolve(this._foreignModuleHost[e].apply(this._foreignModuleHost,t))}catch(i){return Promise.reject(i)}}getProxy(){return this._foreignProxy}withSyncedResources(e){return this.workerWithSyncedResources(e).then(t=>this.getProxy())}}var Us;(function(a){a[a.None=0]="None",a[a.Open=1]="Open",a[a.Close=-1]="Close"})(Us||(Us={}));function _x(a){return Array.isArray(a)}function Cx(a){return!_x(a)}function df(a){return typeof a=="string"}function uu(a){return!df(a)}function kn(a){return!a}function Bi(a,e){return a.ignoreCase&&e?e.toLowerCase():e}function gu(a){return a.replace(/[&<>'"_]/g,"-")}function wx(a,e){console.log(`${a.languageId}: ${e}`)}function Le(a,e){return new Error(`${a.languageId}: ${e}`)}function Qi(a,e,t,i,n){const s=/\$((\$)|(#)|(\d\d?)|[sS](\d\d?)|@(\w+))/g;let o=null;return e.replace(s,function(r,l,d,c,h,u,g,f,m){return kn(d)?kn(c)?!kn(h)&&h<i.length?Bi(a,i[h]):!kn(g)&&a&&typeof a[g]=="string"?a[g]:(o===null&&(o=n.split("."),o.unshift(n)),!kn(u)&&u<o.length?Bi(a,o[u]):""):Bi(a,t):"$"})}function Lx(a,e,t){const i=/\$[sS](\d\d?)/g;let n=null;return e.replace(i,function(s,o){return n===null&&(n=t.split("."),n.unshift(t)),!kn(o)&&o<n.length?Bi(a,n[o]):""})}function Nr(a,e){let t=e;for(;t&&t.length>0;){const i=a.tokenizer[t];if(i)return i;const n=t.lastIndexOf(".");n<0?t=null:t=t.substr(0,n)}return null}function vx(a,e){let t=e;for(;t&&t.length>0;){if(a.stateNames[t])return!0;const n=t.lastIndexOf(".");n<0?t=null:t=t.substr(0,n)}return!1}var Sd;const cf=5;class $o{static{this._INSTANCE=new $o(cf)}static create(e,t){return this._INSTANCE.create(e,t)}constructor(e){this._maxCacheDepth=e,this._entries=Object.create(null)}create(e,t){if(e!==null&&e.depth>=this._maxCacheDepth)return new Ts(e,t);let i=Ts.getStackElementId(e);i.length>0&&(i+="|"),i+=t;let n=this._entries[i];return n||(n=new Ts(e,t),this._entries[i]=n,n)}}class Ts{constructor(e,t){this.parent=e,this.state=t,this.depth=(this.parent?this.parent.depth:0)+1}static getStackElementId(e){let t="";for(;e!==null;)t.length>0&&(t+="|"),t+=e.state,e=e.parent;return t}static _equals(e,t){for(;e!==null&&t!==null;){if(e===t)return!0;if(e.state!==t.state)return!1;e=e.parent,t=t.parent}return e===null&&t===null}equals(e){return Ts._equals(this,e)}push(e){return $o.create(this,e)}pop(){return this.parent}popall(){let e=this;for(;e.parent;)e=e.parent;return e}switchTo(e){return $o.create(this.parent,e)}}class vs{constructor(e,t){this.languageId=e,this.state=t}equals(e){return this.languageId===e.languageId&&this.state.equals(e.state)}clone(){return this.state.clone()===this.state?this:new vs(this.languageId,this.state)}}class Ji{static{this._INSTANCE=new Ji(cf)}static create(e,t){return this._INSTANCE.create(e,t)}constructor(e){this._maxCacheDepth=e,this._entries=Object.create(null)}create(e,t){if(t!==null)return new No(e,t);if(e!==null&&e.depth>=this._maxCacheDepth)return new No(e,t);const i=Ts.getStackElementId(e);let n=this._entries[i];return n||(n=new No(e,null),this._entries[i]=n,n)}}class No{constructor(e,t){this.stack=e,this.embeddedLanguageData=t}clone(){return(this.embeddedLanguageData?this.embeddedLanguageData.clone():null)===this.embeddedLanguageData?this:Ji.create(this.stack,this.embeddedLanguageData)}equals(e){return!(e instanceof No)||!this.stack.equals(e.stack)?!1:this.embeddedLanguageData===null&&e.embeddedLanguageData===null?!0:this.embeddedLanguageData===null||e.embeddedLanguageData===null?!1:this.embeddedLanguageData.equals(e.embeddedLanguageData)}}class bx{constructor(){this._tokens=[],this._languageId=null,this._lastTokenType=null,this._lastTokenLanguage=null}enterLanguage(e){this._languageId=e}emit(e,t){this._lastTokenType===t&&this._lastTokenLanguage===this._languageId||(this._lastTokenType=t,this._lastTokenLanguage=this._languageId,this._tokens.push(new kl(e,t,this._languageId)))}nestedLanguageTokenize(e,t,i,n){const s=i.languageId,o=i.state,r=Ye.get(s);if(!r)return this.enterLanguage(s),this.emit(n,""),o;const l=r.tokenize(e,t,o);if(n!==0)for(const d of l.tokens)this._tokens.push(new kl(d.offset+n,d.type,d.language));else this._tokens=this._tokens.concat(l.tokens);return this._lastTokenType=null,this._lastTokenLanguage=null,this._languageId=null,l.endState}finalize(e){return new Qu(this._tokens,e)}}class Ca{constructor(e,t){this._languageService=e,this._theme=t,this._prependTokens=null,this._tokens=[],this._currentLanguageId=E_.Null,this._lastTokenMetadata=0}enterLanguage(e){this._currentLanguageId=this._languageService.languageIdCodec.encodeLanguageId(e)}emit(e,t){const i=this._theme.match(this._currentLanguageId,t)|Wt.BALANCED_BRACKETS_MASK;this._lastTokenMetadata!==i&&(this._lastTokenMetadata=i,this._tokens.push(e),this._tokens.push(i))}static _merge(e,t,i){const n=e!==null?e.length:0,s=t.length,o=i!==null?i.length:0;if(n===0&&s===0&&o===0)return new Uint32Array(0);if(n===0&&s===0)return i;if(s===0&&o===0)return e;const r=new Uint32Array(n+s+o);e!==null&&r.set(e);for(let l=0;l<s;l++)r[n+l]=t[l];return i!==null&&r.set(i,n+s),r}nestedLanguageTokenize(e,t,i,n){const s=i.languageId,o=i.state,r=Ye.get(s);if(!r)return this.enterLanguage(s),this.emit(n,""),o;const l=r.tokenizeEncoded(e,t,o);if(n!==0)for(let d=0,c=l.tokens.length;d<c;d+=2)l.tokens[d]+=n;return this._prependTokens=Ca._merge(this._prependTokens,this._tokens,l.tokens),this._tokens=[],this._currentLanguageId=0,this._lastTokenMetadata=0,l.endState}finalize(e){return new jd(Ca._merge(this._prependTokens,this._tokens,null),e)}}let Zo=Sd=class extends U{constructor(e,t,i,n,s){super(),this._configurationService=s,this._languageService=e,this._standaloneThemeService=t,this._languageId=i,this._lexer=n,this._embeddedLanguages=Object.create(null),this.embeddedLoaded=Promise.resolve(void 0);let o=!1;this._register(Ye.onDidChange(r=>{if(o)return;let l=!1;for(let d=0,c=r.changedLanguages.length;d<c;d++){const h=r.changedLanguages[d];if(this._embeddedLanguages[h]){l=!0;break}}l&&(o=!0,Ye.handleChange([this._languageId]),o=!1)})),this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}),this._register(this._configurationService.onDidChangeConfiguration(r=>{r.affectsConfiguration("editor.maxTokenizationLineLength")&&(this._maxTokenizationLineLength=this._configurationService.getValue("editor.maxTokenizationLineLength",{overrideIdentifier:this._languageId}))}))}getLoadStatus(){const e=[];for(const t in this._embeddedLanguages){const i=Ye.get(t);if(i){if(i instanceof Sd){const n=i.getLoadStatus();n.loaded===!1&&e.push(n.promise)}continue}Ye.isResolved(t)||e.push(Ye.getOrCreate(t))}return e.length===0?{loaded:!0}:{loaded:!1,promise:Promise.all(e).then(t=>{})}}getInitialState(){const e=$o.create(null,this._lexer.start);return Ji.create(e,null)}tokenize(e,t,i){if(e.length>=this._maxTokenizationLineLength)return Yu(this._languageId,i);const n=new bx,s=this._tokenize(e,t,i,n);return n.finalize(s)}tokenizeEncoded(e,t,i){if(e.length>=this._maxTokenizationLineLength)return N_(this._languageService.languageIdCodec.encodeLanguageId(this._languageId),i);const n=new Ca(this._languageService,this._standaloneThemeService.getColorTheme().tokenTheme),s=this._tokenize(e,t,i,n);return n.finalize(s)}_tokenize(e,t,i,n){return i.embeddedLanguageData?this._nestedTokenize(e,t,i,0,n):this._myTokenize(e,t,i,0,n)}_findLeavingNestedLanguageOffset(e,t){let i=this._lexer.tokenizer[t.stack.state];if(!i&&(i=Nr(this._lexer,t.stack.state),!i))throw Le(this._lexer,"tokenizer state is not defined: "+t.stack.state);let n=-1,s=!1;for(const o of i){if(!uu(o.action)||o.action.nextEmbedded!=="@pop")continue;s=!0;let r=o.resolveRegex(t.stack.state);const l=r.source;if(l.substr(0,4)==="^(?:"&&l.substr(l.length-1,1)===")"){const c=(r.ignoreCase?"i":"")+(r.unicode?"u":"");r=new RegExp(l.substr(4,l.length-5),c)}const d=e.search(r);d===-1||d!==0&&o.matchOnlyAtLineStart||(n===-1||d<n)&&(n=d)}if(!s)throw Le(this._lexer,'no rule containing nextEmbedded: "@pop" in tokenizer embedded state: '+t.stack.state);return n}_nestedTokenize(e,t,i,n,s){const o=this._findLeavingNestedLanguageOffset(e,i);if(o===-1){const d=s.nestedLanguageTokenize(e,t,i.embeddedLanguageData,n);return Ji.create(i.stack,new vs(i.embeddedLanguageData.languageId,d))}const r=e.substring(0,o);r.length>0&&s.nestedLanguageTokenize(r,!1,i.embeddedLanguageData,n);const l=e.substring(o);return this._myTokenize(l,t,i,n+o,s)}_safeRuleName(e){return e?e.name:"(unknown)"}_myTokenize(e,t,i,n,s){s.enterLanguage(this._languageId);const o=e.length,r=t&&this._lexer.includeLF?e+`
`:e,l=r.length;let d=i.embeddedLanguageData,c=i.stack,h=0,u=null,g=!0;for(;g||h<l;){const f=h,m=c.depth,_=u?u.groups.length:0,L=c.state;let w=null,p=null,C=null,b=null,S=null;if(u){w=u.matches;const x=u.groups.shift();p=x.matched,C=x.action,b=u.rule,u.groups.length===0&&(u=null)}else{if(!g&&h>=l)break;g=!1;let x=this._lexer.tokenizer[L];if(!x&&(x=Nr(this._lexer,L),!x))throw Le(this._lexer,"tokenizer state is not defined: "+L);const R=r.substr(h);for(const D of x)if((h===0||!D.matchOnlyAtLineStart)&&(w=R.match(D.resolveRegex(L)),w)){p=w[0],C=D.action;break}}if(w||(w=[""],p=""),C||(h<l&&(w=[r.charAt(h)],p=w[0]),C=this._lexer.defaultToken),p===null)break;for(h+=p.length;Cx(C)&&uu(C)&&C.test;)C=C.test(p,w,L,h===l);let y=null;if(typeof C=="string"||Array.isArray(C))y=C;else if(C.group)y=C.group;else if(C.token!==null&&C.token!==void 0){if(C.tokenSubst?y=Qi(this._lexer,C.token,p,w,L):y=C.token,C.nextEmbedded)if(C.nextEmbedded==="@pop"){if(!d)throw Le(this._lexer,"cannot pop embedded language if not inside one");d=null}else{if(d)throw Le(this._lexer,"cannot enter embedded language from within an embedded language");S=Qi(this._lexer,C.nextEmbedded,p,w,L)}if(C.goBack&&(h=Math.max(0,h-C.goBack)),C.switchTo&&typeof C.switchTo=="string"){let x=Qi(this._lexer,C.switchTo,p,w,L);if(x[0]==="@"&&(x=x.substr(1)),Nr(this._lexer,x))c=c.switchTo(x);else throw Le(this._lexer,"trying to switch to a state '"+x+"' that is undefined in rule: "+this._safeRuleName(b))}else{if(C.transform&&typeof C.transform=="function")throw Le(this._lexer,"action.transform not supported");if(C.next)if(C.next==="@push"){if(c.depth>=this._lexer.maxStack)throw Le(this._lexer,"maximum tokenizer stack size reached: ["+c.state+","+c.parent.state+",...]");c=c.push(L)}else if(C.next==="@pop"){if(c.depth<=1)throw Le(this._lexer,"trying to pop an empty stack in rule: "+this._safeRuleName(b));c=c.pop()}else if(C.next==="@popall")c=c.popall();else{let x=Qi(this._lexer,C.next,p,w,L);if(x[0]==="@"&&(x=x.substr(1)),Nr(this._lexer,x))c=c.push(x);else throw Le(this._lexer,"trying to set a next state '"+x+"' that is undefined in rule: "+this._safeRuleName(b))}}C.log&&typeof C.log=="string"&&wx(this._lexer,this._lexer.languageId+": "+Qi(this._lexer,C.log,p,w,L))}if(y===null)throw Le(this._lexer,"lexer rule has no well-defined action in rule: "+this._safeRuleName(b));const E=x=>{const R=this._languageService.getLanguageIdByLanguageName(x)||this._languageService.getLanguageIdByMimeType(x)||x,D=this._getNestedEmbeddedLanguageData(R);if(h<l){const A=e.substr(h);return this._nestedTokenize(A,t,Ji.create(c,D),n+h,s)}else return Ji.create(c,D)};if(Array.isArray(y)){if(u&&u.groups.length>0)throw Le(this._lexer,"groups cannot be nested: "+this._safeRuleName(b));if(w.length!==y.length+1)throw Le(this._lexer,"matched number of groups does not match the number of actions in rule: "+this._safeRuleName(b));let x=0;for(let R=1;R<w.length;R++)x+=w[R].length;if(x!==p.length)throw Le(this._lexer,"with groups, all characters should be matched in consecutive groups in rule: "+this._safeRuleName(b));u={rule:b,matches:w,groups:[]};for(let R=0;R<y.length;R++)u.groups[R]={action:y[R],matched:w[R+1]};h-=p.length;continue}else{if(y==="@rematch"&&(h-=p.length,p="",w=null,y="",S!==null))return E(S);if(p.length===0){if(l===0||m!==c.depth||L!==c.state||(u?u.groups.length:0)!==_)continue;throw Le(this._lexer,"no progress in tokenizer in rule: "+this._safeRuleName(b))}let x=null;if(df(y)&&y.indexOf("@brackets")===0){const R=y.substr(9),D=Sx(this._lexer,p);if(!D)throw Le(this._lexer,"@brackets token returned but no bracket defined as: "+p);x=gu(D.token+R)}else{const R=y===""?"":y+this._lexer.tokenPostfix;x=gu(R)}f<o&&s.emit(f+n,x)}if(S!==null)return E(S)}return Ji.create(c,d)}_getNestedEmbeddedLanguageData(e){if(!this._languageService.isRegisteredLanguageId(e))return new vs(e,Pl);e!==this._languageId&&(this._languageService.requestBasicLanguageFeatures(e),Ye.getOrCreate(e),this._embeddedLanguages[e]=!0);const t=Ye.get(e);return t?new vs(e,t.getInitialState()):new vs(e,Pl)}};Zo=Sd=ge([P(4,Gi)],Zo);function Sx(a,e){if(!e)return null;e=Bi(a,e);const t=a.brackets;for(const i of t){if(i.open===e)return{token:i.token,bracketType:Us.Open};if(i.close===e)return{token:i.token,bracketType:Us.Close}}return null}const yx=ir("standaloneColorizer",{createHTML:a=>a});class vc{static colorizeElement(e,t,i,n){n=n||{};const s=n.theme||"vs",o=n.mimeType||i.getAttribute("lang")||i.getAttribute("data-lang");if(!o)return console.error("Mode not detected"),Promise.resolve();const r=t.getLanguageIdByMimeType(o)||o;e.setTheme(s);const l=i.firstChild?i.firstChild.nodeValue:"";i.className+=" "+s;const d=c=>{const h=yx?.createHTML(c)??c;i.innerHTML=h};return this.colorize(t,l||"",r,n).then(d,c=>console.error(c))}static async colorize(e,t,i,n){const s=e.languageIdCodec;let o=4;n&&typeof n.tabSize=="number"&&(o=n.tabSize),I_(t)&&(t=t.substr(1));const r=Ad(t);if(!e.isRegisteredLanguageId(i))return fu(r,o,s);const l=await Ye.getOrCreate(i);return l?xx(r,o,l,s):fu(r,o,s)}static colorizeLine(e,t,i,n,s=4){const o=Ut.isBasicASCII(e,t),r=Ut.containsRTL(e,o,i);return Fa(new Ys(!1,!0,e,!1,o,r,0,n,[],s,0,0,0,0,-1,"none",!1,!1,null)).html}static colorizeModelLine(e,t,i=4){const n=e.getLineContent(t);e.tokenization.forceTokenization(t);const o=e.tokenization.getLineTokens(t).inflate();return this.colorizeLine(n,e.mightContainNonBasicASCII(),e.mightContainRTL(),o,i)}}function xx(a,e,t,i){return new Promise((n,s)=>{const o=()=>{const r=Nx(a,e,t,i);if(t instanceof Zo){const l=t.getLoadStatus();if(l.loaded===!1){l.promise.then(o,s);return}}n(r)};o()})}function fu(a,e,t){let i=[];const n=(Dl.None<<Wt.FONT_STYLE_OFFSET|Ui.DefaultForeground<<Wt.FOREGROUND_OFFSET|Ui.DefaultBackground<<Wt.BACKGROUND_OFFSET)>>>0,s=new Uint32Array(2);s[0]=0,s[1]=n;for(let o=0,r=a.length;o<r;o++){const l=a[o];s[0]=l.length;const d=new Jn(s,l,t),c=Ut.isBasicASCII(l,!0),h=Ut.containsRTL(l,c,!0),u=Fa(new Ys(!1,!0,l,!1,c,h,0,d,[],e,0,0,0,0,-1,"none",!1,!1,null));i=i.concat(u.html),i.push("<br/>")}return i.join("")}function Nx(a,e,t,i){let n=[],s=t.getInitialState();for(let o=0,r=a.length;o<r;o++){const l=a[o],d=t.tokenizeEncoded(l,!0,s);Jn.convertToEndOffset(d.tokens,l.length);const c=new Jn(d.tokens,l,i),h=Ut.isBasicASCII(l,!0),u=Ut.containsRTL(l,h,!0),g=Fa(new Ys(!1,!0,l,!1,h,u,0,c.inflate(),[],e,0,0,0,0,-1,"none",!1,!1,null));n=n.concat(g.html),n.push("<br/>"),s=d.endState}return n.join("")}let Ex=0,mu=!1;function Ix(a){if(!a){if(mu)return;mu=!0}A_(a||tr.document.body)}let qo=class extends ca{constructor(e,t,i,n,s,o,r,l,d,c,h,u,g){const f={...t};f.ariaLabel=f.ariaLabel||R_.editorViewAccessibleLabel,super(e,f,{isStandaloneEditor:!0},i,n,s,o,d,c,h,u,g),l instanceof rr?this._standaloneKeybindingService=l:this._standaloneKeybindingService=null,Ix(f.ariaContainerElement),D_((m,_)=>i.createInstance($u,m,{instantHover:_},{})),T_(r)}addCommand(e,t,i){if(!this._standaloneKeybindingService)return console.warn("Cannot add command because the editor is configured with an unrecognized KeybindingService"),null;const n="DYNAMIC_"+ ++Ex,s=Zt.deserialize(i);return this._standaloneKeybindingService.addDynamicKeybinding(n,e,t,s),n}createContextKey(e,t){return this._contextKeyService.createKey(e,t)}addAction(e){if(typeof e.id!="string"||typeof e.label!="string"||typeof e.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),U.None;const t=e.id,i=e.label,n=Zt.and(Zt.equals("editorId",this.getId()),Zt.deserialize(e.precondition)),s=e.keybindings,o=Zt.and(n,Zt.deserialize(e.keybindingContext)),r=e.contextMenuGroupId||null,l=e.contextMenuOrder||0,d=(g,...f)=>Promise.resolve(e.run(this,...f)),c=new Ot,h=this.getId()+":"+t;if(c.add(pn.registerCommand(h,d)),r){const g={command:{id:h,title:i},when:n,group:r,order:l};c.add(eg.appendMenuItem(an.EditorContext,g))}if(Array.isArray(s))for(const g of s)c.add(this._standaloneKeybindingService.addDynamicKeybinding(h,g,d,o));const u=new Gg(h,i,i,void 0,n,(...g)=>Promise.resolve(e.run(this,...g)),this._contextKeyService);return this._actions.set(t,u),c.add(ke(()=>{this._actions.delete(t)})),c}_triggerCommand(e,t){if(this._codeEditorService instanceof M_)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(e,t)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(e,t)}};qo=ge([P(2,Me),P(3,zt),P(4,Zs),P(5,ot),P(6,Ju),P(7,wi),P(8,sr),P(9,is),P(10,ji),P(11,mn),P(12,Ce)],qo);let wa=class extends qo{constructor(e,t,i,n,s,o,r,l,d,c,h,u,g,f,m,_){const L={...t};Zr(h,L,!1);const w=d.registerEditorContainer(e);typeof L.theme=="string"&&d.setTheme(L.theme),typeof L.autoDetectHighContrast<"u"&&d.setAutoDetectHighContrast(!!L.autoDetectHighContrast);const p=L.model;delete L.model,super(e,L,i,n,s,o,r,l,d,c,u,m,_),this._configurationService=h,this._standaloneThemeService=d,this._register(w);let C;if(typeof p>"u"){const b=f.getLanguageIdByMimeType(L.language)||L.language||xa;C=hf(g,f,L.value||"",b,void 0),this._ownsModel=!0}else C=p,this._ownsModel=!1;if(this._attachModel(C),C){const b={oldModelUrl:null,newModelUrl:C.uri};this._onDidChangeModel.fire(b)}}dispose(){super.dispose()}updateOptions(e){Zr(this._configurationService,e,!1),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_postDetachModelCleanup(e){super._postDetachModelCleanup(e),e&&this._ownsModel&&(e.dispose(),this._ownsModel=!1)}};wa=ge([P(2,Me),P(3,zt),P(4,Zs),P(5,ot),P(6,Ju),P(7,wi),P(8,vi),P(9,is),P(10,Gi),P(11,ji),P(12,Di),P(13,At),P(14,mn),P(15,Ce)],wa);let La=class extends _a{constructor(e,t,i,n,s,o,r,l,d,c,h,u){const g={...t};Zr(l,g,!0);const f=o.registerEditorContainer(e);typeof g.theme=="string"&&o.setTheme(g.theme),typeof g.autoDetectHighContrast<"u"&&o.setAutoDetectHighContrast(!!g.autoDetectHighContrast),super(e,g,{isStandaloneEditor:!0},n,i,s,u,c),this._configurationService=l,this._standaloneThemeService=o,this._register(f)}dispose(){super.dispose()}updateOptions(e){Zr(this._configurationService,e,!0),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_createInnerEditor(e,t,i){return e.createInstance(qo,t,i)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(e,t,i){return this.getModifiedEditor().addCommand(e,t,i)}createContextKey(e,t){return this.getModifiedEditor().createContextKey(e,t)}addAction(e){return this.getModifiedEditor().addAction(e)}};La=ge([P(2,Me),P(3,ot),P(4,zt),P(5,vi),P(6,is),P(7,Gi),P(8,Ma),P(9,qu),P(10,Ku),P(11,or)],La);function hf(a,e,t,i,n){if(t=t||"",!i){const s=t.indexOf(`
`);let o=t;return s!==-1&&(o=t.substring(0,s)),pu(a,t,e.createByFilepathOrFirstLine(n||null,o),n)}return pu(a,t,e.createById(i),n)}function pu(a,e,t,i){return a.createModel(e,t,i)}$i("multiDiffEditor.headerBackground",{dark:"#262626",light:"tab.inactiveBackground",hcDark:"tab.inactiveBackground",hcLight:"tab.inactiveBackground"},O(205,"The background color of the diff editor's header"));$i("multiDiffEditor.background",O_,O(206,"The background color of the multi file diff editor"));$i("multiDiffEditor.border",{dark:"sideBarSectionHeader.border",light:"#cccccc",hcDark:"sideBarSectionHeader.border",hcLight:"#cccccc"},O(207,"The border color of the multi file diff editor"));class Rx{constructor(e,t){this.viewModel=e,this.deltaScrollVertical=t}getId(){return this.viewModel}}let va=class extends U{constructor(e,t,i,n,s){super(),this._container=e,this._overflowWidgetsDomNode=t,this._workbenchUIElementFactory=i,this._instantiationService=n,this._viewModel=J(this,void 0),this._collapsed=z(this,l=>this._viewModel.read(l)?.collapsed.read(l)),this._editorContentHeight=J(this,500),this.contentHeight=z(this,l=>(this._collapsed.read(l)?0:this._editorContentHeight.read(l))+this._outerEditorHeight),this._modifiedContentWidth=J(this,0),this._modifiedWidth=J(this,0),this._originalContentWidth=J(this,0),this._originalWidth=J(this,0),this.maxScroll=z(this,l=>{const d=this._modifiedContentWidth.read(l)-this._modifiedWidth.read(l),c=this._originalContentWidth.read(l)-this._originalWidth.read(l);return d>c?{maxScroll:d,width:this._modifiedWidth.read(l)}:{maxScroll:c,width:this._originalWidth.read(l)}}),this._elements=ae("div.multiDiffEntry",[ae("div.header@header",[ae("div.header-content",[ae("div.collapse-button@collapseButton"),ae("div.file-path",[ae("div.title.modified.show-file-icons@primaryPath",[]),ae("div.status.deleted@status",["R"]),ae("div.title.original.show-file-icons@secondaryPath",[])]),ae("div.actions@actions")])]),ae("div.editorParent",[ae("div.editorContainer@editor")])]),this.editor=this._register(this._instantiationService.createInstance(_a,this._elements.editor,{overflowWidgetsDomNode:this._overflowWidgetsDomNode},{})),this.isModifedFocused=Hn(this.editor.getModifiedEditor()).isFocused,this.isOriginalFocused=Hn(this.editor.getOriginalEditor()).isFocused,this.isFocused=z(this,l=>this.isModifedFocused.read(l)||this.isOriginalFocused.read(l)),this._resourceLabel=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.primaryPath)):void 0,this._resourceLabel2=this._workbenchUIElementFactory.createResourceLabel?this._register(this._workbenchUIElementFactory.createResourceLabel(this._elements.secondaryPath)):void 0,this._dataStore=this._register(new Ot),this._headerHeight=40,this._lastScrollTop=-1,this._isSettingScrollTop=!1;const o=new P_(this._elements.collapseButton,{});this._register(ce(l=>{o.element.className="",o.icon=this._collapsed.read(l)?It.chevronRight:It.chevronDown})),this._register(o.onDidClick(()=>{this._viewModel.get()?.collapsed.set(!this._collapsed.get(),void 0)})),this._register(ce(l=>{this._elements.editor.style.display=this._collapsed.read(l)?"none":"block"})),this._register(this.editor.getModifiedEditor().onDidLayoutChange(l=>{const d=this.editor.getModifiedEditor().getLayoutInfo().contentWidth;this._modifiedWidth.set(d,void 0)})),this._register(this.editor.getOriginalEditor().onDidLayoutChange(l=>{const d=this.editor.getOriginalEditor().getLayoutInfo().contentWidth;this._originalWidth.set(d,void 0)})),this._register(this.editor.onDidContentSizeChange(l=>{ho(d=>{this._editorContentHeight.set(l.contentHeight,d),this._modifiedContentWidth.set(this.editor.getModifiedEditor().getContentWidth(),d),this._originalContentWidth.set(this.editor.getOriginalEditor().getContentWidth(),d)})})),this._register(this.editor.getOriginalEditor().onDidScrollChange(l=>{if(this._isSettingScrollTop||!l.scrollTopChanged||!this._data)return;const d=l.scrollTop-this._lastScrollTop;this._data.deltaScrollVertical(d)})),this._register(ce(l=>{const d=this._viewModel.read(l)?.isActive.read(l);this._elements.root.classList.toggle("active",d)})),this._container.appendChild(this._elements.root),this._outerEditorHeight=this._headerHeight,this._contextKeyService=this._register(s.createScoped(this._elements.actions));const r=this._register(this._instantiationService.createChild(new $s([ot,this._contextKeyService])));this._register(r.createInstance(ha,this._elements.actions,an.MultiDiffEditorFileToolbar,{actionRunner:this._register(new tf(()=>this._viewModel.get()?.modifiedUri)),menuOptions:{shouldForwardArgs:!0},toolbarOptions:{primaryGroup:l=>l.startsWith("navigation")},actionViewItemProvider:(l,d)=>Uu(r,l,d)}))}setScrollLeft(e){this._modifiedContentWidth.get()-this._modifiedWidth.get()>this._originalContentWidth.get()-this._originalWidth.get()?this.editor.getModifiedEditor().setScrollLeft(e):this.editor.getOriginalEditor().setScrollLeft(e)}setData(e){this._data=e;function t(n){return{...n,scrollBeyondLastLine:!1,hideUnchangedRegions:{enabled:!0},scrollbar:{vertical:"hidden",horizontal:"hidden",handleMouseWheel:!1,useShadows:!1},renderOverviewRuler:!1,fixedOverflowWidgets:!0,overviewRulerBorder:!1}}if(!e){ho(n=>{this._viewModel.set(void 0,n),this.editor.setDiffModel(null,n),this._dataStore.clear()});return}const i=e.viewModel.documentDiffItem;if(ho(n=>{this._resourceLabel?.setUri(e.viewModel.modifiedUri??e.viewModel.originalUri,{strikethrough:e.viewModel.modifiedUri===void 0});let s=!1,o=!1,r=!1,l="";e.viewModel.modifiedUri&&e.viewModel.originalUri&&e.viewModel.modifiedUri.path!==e.viewModel.originalUri.path?(l="R",s=!0):e.viewModel.modifiedUri?e.viewModel.originalUri||(l="A",r=!0):(l="D",o=!0),this._elements.status.classList.toggle("renamed",s),this._elements.status.classList.toggle("deleted",o),this._elements.status.classList.toggle("added",r),this._elements.status.innerText=l,this._resourceLabel2?.setUri(s?e.viewModel.originalUri:void 0,{strikethrough:!0}),this._dataStore.clear(),this._viewModel.set(e.viewModel,n),this.editor.setDiffModel(e.viewModel.diffEditorViewModelRef,n),this.editor.updateOptions(t(i.options??{}))}),i.onOptionsDidChange&&this._dataStore.add(i.onOptionsDidChange(()=>{this.editor.updateOptions(t(i.options??{}))})),e.viewModel.isAlive.recomputeInitiallyAndOnChange(this._dataStore,n=>{n||this.setData(void 0)}),e.viewModel.documentDiffItem.contextKeys)for(const[n,s]of Object.entries(e.viewModel.documentDiffItem.contextKeys))this._contextKeyService.createKey(n,s)}render(e,t,i,n){this._elements.root.style.visibility="visible",this._elements.root.style.top=`${e.start}px`,this._elements.root.style.height=`${e.length}px`,this._elements.root.style.width=`${t}px`,this._elements.root.style.position="absolute";const s=e.length-this._headerHeight,o=Math.max(0,Math.min(n.start-e.start,s));this._elements.header.style.transform=`translateY(${o}px)`,ho(r=>{this.editor.layout({width:t-2*8-2*1,height:e.length-this._outerEditorHeight})});try{this._isSettingScrollTop=!0,this._lastScrollTop=i,this.editor.getOriginalEditor().setScrollTop(i)}finally{this._isSettingScrollTop=!1}this._elements.header.classList.toggle("shadow",o>0||i>0),this._elements.header.classList.toggle("collapsed",o===s)}hide(){this._elements.root.style.top="-100000px",this._elements.root.style.visibility="hidden"}};va=ge([P(3,Me),P(4,ot)],va);class Dx{constructor(e){this._create=e,this._unused=new Set,this._used=new Set,this._itemData=new Map}getUnusedObj(e){let t;if(this._unused.size===0)t=this._create(e),this._itemData.set(t,e);else{const i=[...this._unused.values()];t=i.find(n=>this._itemData.get(n).getId()===e.getId())??i[0],this._unused.delete(t),this._itemData.set(t,e),t.setData(e)}return this._used.add(t),{object:t,dispose:()=>{this._used.delete(t),this._unused.size>5?t.dispose():this._unused.add(t)}}}dispose(){for(const e of this._used)e.dispose();for(const e of this._unused)e.dispose();this._used.clear(),this._unused.clear()}}const Tx=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Ee(Tx);let yd=class extends U{constructor(e,t,i,n,s,o){super(),this._element=e,this._dimension=t,this._viewModel=i,this._workbenchUIElementFactory=n,this._parentContextKeyService=s,this._parentInstantiationService=o,this._scrollableElements=ae("div.scrollContent",[ae("div@content",{style:{overflow:"hidden"}}),ae("div.monaco-editor@overflowWidgetsDomNode",{})]),this._scrollable=this._register(new Vu({forceIntegerValues:!1,scheduleAtNextAnimationFrame:d=>Io(Ne(this._element),d),smoothScrollDuration:100})),this._scrollableElement=this._register(new Iu(this._scrollableElements.root,{vertical:Tl.Auto,horizontal:Tl.Auto,useShadows:!1},this._scrollable)),this._elements=ae("div.monaco-component.multiDiffEditor",{},[ae("div",{},[this._scrollableElement.getDomNode()]),ae("div.placeholder@placeholder",{},[ae("div")])]),this._sizeObserver=this._register(new Yg(this._element,void 0)),this._objectPool=this._register(new Dx(d=>{const c=this._instantiationService.createInstance(va,this._scrollableElements.content,this._scrollableElements.overflowWidgetsDomNode,this._workbenchUIElementFactory);return c.setData(d),c})),this.scrollTop=Re(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollTop),this.scrollLeft=Re(this,this._scrollableElement.onScroll,()=>this._scrollableElement.getScrollPosition().scrollLeft),this._viewItemsInfo=qs(this,(d,c)=>{const h=this._viewModel.read(d);if(!h)return{items:[],getItem:m=>{throw new Fe}};const u=h.items.read(d),g=new Map;return{items:u.map(m=>{const _=c.add(new Ax(m,this._objectPool,this.scrollLeft,w=>{this._scrollableElement.setScrollPosition({scrollTop:this._scrollableElement.getScrollPosition().scrollTop+w})})),L=this._lastDocStates?.[_.getKey()];return L&&He(w=>{_.setViewState(L,w)}),g.set(m,_),_}),getItem:m=>g.get(m)}}),this._viewItems=this._viewItemsInfo.map(this,d=>d.items),this._spaceBetweenPx=0,this._totalHeight=this._viewItems.map(this,(d,c)=>d.reduce((h,u)=>h+u.contentHeight.read(c)+this._spaceBetweenPx,0)),this.activeControl=z(this,d=>{const c=this._viewModel.read(d)?.activeDiffItem.read(d);return c?this._viewItemsInfo.read(d).getItem(c).template.read(d)?.editor:void 0}),this._contextKeyService=this._register(this._parentContextKeyService.createScoped(this._element)),this._instantiationService=this._register(this._parentInstantiationService.createChild(new $s([ot,this._contextKeyService]))),this._lastDocStates={},this._register(Ci((d,c)=>{const h=this._viewModel.read(d);if(h&&h.contextKeys)for(const[u,g]of Object.entries(h.contextKeys)){const f=this._contextKeyService.createKey(u,void 0);f.set(g),c.add(ke(()=>f.reset()))}}));const r=this._parentContextKeyService.createKey(k.multiDiffEditorAllCollapsed.key,!1);this._register(ce(d=>{const c=this._viewModel.read(d);if(c){const h=c.items.read(d).every(u=>u.collapsed.read(d));r.set(h)}})),this._register(ce(d=>{const c=this._dimension.read(d);this._sizeObserver.observe(c)}));const l=z(d=>{if(this._viewItems.read(d).length>0)return;const h=this._viewModel.read(d);return!h||h.isLoading.read(d)?O(208,"Loading..."):O(209,"No Changed Files")});this._register(ce(d=>{const c=l.read(d);this._elements.placeholder.innerText=c??"",this._elements.placeholder.classList.toggle("visible",!!c)})),this._scrollableElements.content.style.position="relative",this._register(ce(d=>{const c=this._sizeObserver.height.read(d);this._scrollableElements.root.style.height=`${c}px`;const h=this._totalHeight.read(d);this._scrollableElements.content.style.height=`${h}px`;const u=this._sizeObserver.width.read(d);let g=u;const f=this._viewItems.read(d),m=k_(f,Gn(_=>_.maxScroll.read(d).maxScroll,Gd));if(m){const _=m.maxScroll.read(d);g=u+_.maxScroll}this._scrollableElement.setScrollDimensions({width:u,height:c,scrollHeight:h,scrollWidth:g})})),e.replaceChildren(this._elements.root),this._register(ke(()=>{e.replaceChildren()})),this._register(this._register(ce(d=>{ho(c=>{this.render(d)})})))}setScrollState(e){this._scrollableElement.setScrollPosition({scrollLeft:e.left,scrollTop:e.top})}reveal(e,t){const i=this._viewItems.get(),n=i.findIndex(d=>d.viewModel.originalUri?.toString()===e.original?.toString()&&d.viewModel.modifiedUri?.toString()===e.modified?.toString());if(n===-1)throw new Fe("Resource not found in diff editor");const s=i[n];this._viewModel.get().activeDiffItem.setCache(s.viewModel,void 0);let o=0;for(let d=0;d<n;d++)o+=i[d].contentHeight.get()+this._spaceBetweenPx;this._scrollableElement.setScrollPosition({scrollTop:o});const r=s.template.get()?.editor,l="original"in e?r?.getOriginalEditor():r?.getModifiedEditor();l&&t?.range&&(l.revealRangeInCenter(t.range),Mx(l,t.range))}getViewState(){return{scrollState:{top:this.scrollTop.get(),left:this.scrollLeft.get()},docStates:Object.fromEntries(this._viewItems.get().map(e=>[e.getKey(),e.getViewState()]))}}setViewState(e){this.setScrollState(e.scrollState),this._lastDocStates=e.docStates,He(t=>{if(e.docStates)for(const i of this._viewItems.get()){const n=e.docStates[i.getKey()];n&&i.setViewState(n,t)}})}findDocumentDiffItem(e){return this._viewItems.get().find(i=>i.viewModel.diffEditorViewModel.model.modified.uri.toString()===e.toString()||i.viewModel.diffEditorViewModel.model.original.uri.toString()===e.toString())?.viewModel.documentDiffItem}tryGetCodeEditor(e){const t=this._viewItems.get().find(n=>n.viewModel.diffEditorViewModel.model.modified.uri.toString()===e.toString()||n.viewModel.diffEditorViewModel.model.original.uri.toString()===e.toString()),i=t?.template.get()?.editor;if(i)return t.viewModel.diffEditorViewModel.model.modified.uri.toString()===e.toString()?{diffEditor:i,editor:i.getModifiedEditor()}:{diffEditor:i,editor:i.getOriginalEditor()}}render(e){const t=this.scrollTop.read(e);let i=0,n=0,s=0;const o=this._sizeObserver.height.read(e),r=ii.ofStartAndLength(t,o),l=this._sizeObserver.width.read(e);for(const d of this._viewItems.read(e)){const c=d.contentHeight.read(e),h=Math.min(c,o),u=ii.ofStartAndLength(n,h),g=ii.ofStartAndLength(s,c);if(g.isBefore(r))i-=c-h,d.hide();else if(g.isAfter(r))d.hide();else{const f=Math.max(0,Math.min(r.start-g.start,c-h));i-=f;const m=ii.ofStartAndLength(t+i,o);d.render(u,f,l,m)}n+=h+this._spaceBetweenPx,s+=c+this._spaceBetweenPx}this._scrollableElements.content.style.transform=`translateY(${-(t+i)}px)`}};yd=ge([P(4,ot),P(5,Me)],yd);function Mx(a,e){const t=a.getModel(),i=a.createDecorationsCollection([{range:e,options:{description:"symbol-navigate-action-highlight",className:"symbolHighlight"}}]);setTimeout(()=>{a.getModel()===t&&i.clear()},350)}class Ax extends U{constructor(e,t,i,n){super(),this.viewModel=e,this._objectPool=t,this._scrollLeft=i,this._deltaScrollVertical=n,this._templateRef=this._register(Zu(this,void 0)),this.contentHeight=z(this,s=>this._templateRef.read(s)?.object.contentHeight?.read(s)??this.viewModel.lastTemplateData.read(s).contentHeight),this.maxScroll=z(this,s=>this._templateRef.read(s)?.object.maxScroll.read(s)??{maxScroll:0,scrollWidth:0}),this.template=z(this,s=>this._templateRef.read(s)?.object),this._isHidden=J(this,!1),this._isFocused=z(this,s=>this.template.read(s)?.isFocused.read(s)??!1),this.viewModel.setIsFocused(this._isFocused,void 0),this._register(ce(s=>{const o=this._scrollLeft.read(s);this._templateRef.read(s)?.object.setScrollLeft(o)})),this._register(ce(s=>{const o=this._templateRef.read(s);!o||!this._isHidden.read(s)||o.object.isFocused.read(s)||this._clear()}))}dispose(){this._clear(),super.dispose()}toString(){return`VirtualViewItem(${this.viewModel.documentDiffItem.modified?.uri.toString()})`}getKey(){return this.viewModel.getKey()}getViewState(){return He(e=>{this._updateTemplateData(e)}),{collapsed:this.viewModel.collapsed.get(),selections:this.viewModel.lastTemplateData.get().selections}}setViewState(e,t){this.viewModel.collapsed.set(e.collapsed,t),this._updateTemplateData(t);const i=this.viewModel.lastTemplateData.get(),n=e.selections?.map(le.liftSelection);this.viewModel.lastTemplateData.set({...i,selections:n},t);const s=this._templateRef.get();s&&n&&s.object.editor.setSelections(n)}_updateTemplateData(e){const t=this._templateRef.get();t&&this.viewModel.lastTemplateData.set({contentHeight:t.object.contentHeight.get(),selections:t.object.editor.getSelections()??void 0},e)}_clear(){const e=this._templateRef.get();e&&He(t=>{this._updateTemplateData(t),e.object.hide(),this._templateRef.set(void 0,t)})}hide(){this._isHidden.set(!0,void 0)}render(e,t,i,n){this._isHidden.set(!1,void 0);let s=this._templateRef.get();if(!s){s=this._objectPool.getUnusedObj(new Rx(this.viewModel,this._deltaScrollVertical)),this._templateRef.set(s,void 0);const o=this.viewModel.lastTemplateData.get().selections;o&&s.object.editor.setSelections(o)}s.object.render(e,i,t,n)}}let xd=class extends U{constructor(e,t,i){super(),this._element=e,this._workbenchUIElementFactory=t,this._instantiationService=i,this._dimension=J(this,void 0),this._viewModel=J(this,void 0),this._widgetImpl=qs(this,(n,s)=>(Qt(va,n),s.add(this._instantiationService.createInstance(Qt(yd,n),this._element,this._dimension,this._viewModel,this._workbenchUIElementFactory)))),this._activeControl=z(this,n=>this._widgetImpl.read(n).activeControl.read(n)),this.onDidChangeActiveControl=mi.fromObservableLight(this._activeControl),this._register(Ud(this._widgetImpl))}reveal(e,t){this._widgetImpl.get().reveal(e,t)}createViewModel(e){return new yy(e,this._instantiationService)}setViewModel(e){this._viewModel.set(e,void 0)}layout(e){this._dimension.set(e,void 0)}getActiveControl(){return this._activeControl.get()}getViewState(){return this._widgetImpl.get().getViewState()}setViewState(e){this._widgetImpl.get().setViewState(e)}tryGetCodeEditor(e){return this._widgetImpl.get().tryGetCodeEditor(e)}findDocumentDiffItem(e){return this._widgetImpl.get().findDocumentDiffItem(e)}};xd=ge([P(2,Me)],xd);Ee(fx);function Ox(a,e,t){return B.initialize(t||{}).createInstance(wa,a,e)}function Px(a){return B.get(zt).onCodeEditorAdd(t=>{a(t)})}function kx(a){return B.get(zt).onDiffEditorAdd(t=>{a(t)})}function Wx(){return B.get(zt).listCodeEditors()}function Vx(){return B.get(zt).listDiffEditors()}function Fx(a,e,t){return B.initialize(t||{}).createInstance(La,a,e)}function Hx(a,e){const t=B.initialize(e||{});return new xd(a,{},t)}function Bx(a){if(typeof a.id!="string"||typeof a.run!="function")throw new Error("Invalid command descriptor, `id` and `run` are required properties!");return pn.registerCommand(a.id,a.run)}function zx(a){if(typeof a.id!="string"||typeof a.label!="string"||typeof a.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");const e=Zt.deserialize(a.precondition),t=(n,...s)=>Ia.runEditorCommand(n,s,e,(o,r,l)=>Promise.resolve(a.run(r,...l))),i=new Ot;if(i.add(pn.registerCommand(a.id,t)),a.contextMenuGroupId){const n={command:{id:a.id,title:a.label},when:e,group:a.contextMenuGroupId,order:a.contextMenuOrder||0};i.add(eg.appendMenuItem(an.EditorContext,n))}if(Array.isArray(a.keybindings)){const n=B.get(wi);if(!(n instanceof rr))console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService");else{const s=Zt.and(e,Zt.deserialize(a.keybindingContext));i.add(n.addDynamicKeybindings(a.keybindings.map(o=>({keybinding:o,command:a.id,when:s}))))}}return i}function Ux(a){return uf([a])}function uf(a){const e=B.get(wi);return e instanceof rr?e.addDynamicKeybindings(a.map(t=>({keybinding:t.keybinding,command:t.command,commandArgs:t.commandArgs,when:Zt.deserialize(t.when)}))):(console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),U.None)}function Gx(a,e,t){const i=B.get(At),n=i.getLanguageIdByMimeType(e)||e;return hf(B.get(Di),i,a,n,t)}function jx(a,e){const t=B.get(At),i=t.getLanguageIdByMimeType(e)||e||xa;a.setLanguage(t.createById(i))}function Kx(a,e,t){a&&B.get(ar).changeOne(e,a.uri,t)}function $x(a){B.get(ar).changeAll(a,[])}function Zx(a){return B.get(ar).read(a)}function qx(a){return B.get(ar).onMarkerChanged(a)}function Xx(a){return B.get(Di).getModel(a)}function Yx(){return B.get(Di).getModels()}function Qx(a){return B.get(Di).onModelAdded(a)}function Jx(a){return B.get(Di).onModelRemoved(a)}function eN(a){return B.get(Di).onModelLanguageChanged(t=>{a({model:t.model,oldLanguage:t.oldLanguageId})})}function gf(a){return mx(B.get(Di),a)}function tN(a,e){const t=B.get(At),i=B.get(vi);return vc.colorizeElement(i,t,a,e).then(()=>{i.registerEditorContainer(a)})}function iN(a,e,t){const i=B.get(At);return B.get(vi).registerEditorContainer(tr.document.body),vc.colorize(i,a,e,t)}function nN(a,e,t=4){return B.get(vi).registerEditorContainer(tr.document.body),vc.colorizeModelLine(a,e,t)}function sN(a){const e=Ye.get(a);return e||{getInitialState:()=>Pl,tokenize:(t,i,n)=>Yu(a,n)}}function oN(a,e){Ye.getOrCreate(e);const t=sN(e),i=Ad(a),n=[];let s=t.getInitialState();for(let o=0,r=i.length;o<r;o++){const l=i[o],d=t.tokenize(l,!0,s);n[o]=d.tokens,s=d.endState}return n}function rN(a,e){B.get(vi).defineTheme(a,e)}function aN(a){B.get(vi).setTheme(a)}function lN(){Vl.clearAllFontInfos()}function dN(a,e){return pn.registerCommand({id:a,handler:e})}function cN(a){return B.get(hC).registerOpener({async open(t){return typeof t=="string"&&(t=Xs.parse(t)),a.open(t)}})}function hN(a){return B.get(zt).registerCodeEditorOpenHandler(async(t,i,n)=>{if(!i)return null;const s=t.options?.selection;let o;return s&&typeof s.endLineNumber=="number"&&typeof s.endColumn=="number"?o=s:s&&(o={lineNumber:s.startLineNumber,column:s.startColumn}),await a.openCodeEditor(i,t.resource,o)?i:null})}function uN(){return{create:Ox,getEditors:Wx,getDiffEditors:Vx,onDidCreateEditor:Px,onDidCreateDiffEditor:kx,createDiffEditor:Fx,addCommand:Bx,addEditorAction:zx,addKeybindingRule:Ux,addKeybindingRules:uf,createModel:Gx,setModelLanguage:jx,setModelMarkers:Kx,getModelMarkers:Zx,removeAllMarkers:$x,onDidChangeMarkers:qx,getModels:Yx,getModel:Xx,onDidCreateModel:Qx,onWillDisposeModel:Jx,onDidChangeModelLanguage:eN,createWebWorker:gf,colorizeElement:tN,colorize:iN,colorizeModelLine:nN,tokenize:oN,defineTheme:rN,setTheme:aN,remeasureFonts:lN,registerCommand:dN,registerLinkOpener:cN,registerEditorOpener:hN,AccessibilitySupport:cC,ContentWidgetPositionPreference:dC,CursorChangeReason:lC,DefaultEndOfLine:aC,EditorAutoIndentStrategy:rC,EditorOption:oC,EndOfLinePreference:sC,EndOfLineSequence:nC,MinimapPosition:iC,MinimapSectionHeaderStyle:tC,MouseTargetType:eC,OverlayWidgetPositionPreference:J_,OverviewRulerLane:Q_,GlyphMarginLane:Y_,RenderLineNumbersType:X_,RenderMinimap:q_,ScrollbarVisibility:Z_,ScrollType:$_,TextEditorCursorBlinkingStyle:K_,TextEditorCursorStyle:j_,TrackedRangeStickiness:G_,WrappingIndent:U_,InjectedTextCursorStops:z_,PositionAffinity:B_,ShowLightbulbIconMode:H_,ConfigurationChangedEvent:bu,BareFontInfo:en,FontInfo:Pr,TextModelResolvedOptions:F_,FindMatch:V_,ApplyUpdateResult:W_,EditorZoom:Yi,createMultiFileDiffEditor:Hx,EditorType:kd,EditorOptions:Vt}}function gN(a,e){if(!e||!Array.isArray(e))return!1;for(const t of e)if(!a(t))return!1;return!0}function Er(a,e){return typeof a=="boolean"?a:e}function _u(a,e){return typeof a=="string"?a:e}function fN(a){const e={};for(const t of a)e[t]=!0;return e}function Cu(a,e=!1){e&&(a=a.map(function(i){return i.toLowerCase()}));const t=fN(a);return e?function(i){return t[i.toLowerCase()]!==void 0&&t.hasOwnProperty(i.toLowerCase())}:function(i){return t[i]!==void 0&&t.hasOwnProperty(i)}}function Nd(a,e,t){e=e.replace(/@@/g,"");let i=0,n;do n=!1,e=e.replace(/@(\w+)/g,function(o,r){n=!0;let l="";if(typeof a[r]=="string")l=a[r];else if(a[r]&&a[r]instanceof RegExp)l=a[r].source;else throw a[r]===void 0?Le(a,"language definition does not contain attribute '"+r+"', used at: "+e):Le(a,"attribute reference '"+r+"' must be a string, used at: "+e);return kn(l)?"":"(?:"+l+")"}),i++;while(n&&i<5);e=e.replace(/\x01/g,"@");const s=(a.ignoreCase?"i":"")+(a.unicode?"u":"");if(t&&e.match(/\$[sS](\d\d?)/g)){let r=null,l=null;return d=>(l&&r===d||(r=d,l=new RegExp(Lx(a,e,d),s)),l)}return new RegExp(e,s)}function mN(a,e,t,i){if(i<0)return a;if(i<e.length)return e[i];if(i>=100){i=i-100;const n=t.split(".");if(n.unshift(t),i<n.length)return n[i]}return null}function pN(a,e,t,i){let n=-1,s=t,o=t.match(/^\$(([sS]?)(\d\d?)|#)(.*)$/);o&&(o[3]&&(n=parseInt(o[3]),o[2]&&(n=n+100)),s=o[4]);let r="~",l=s;!s||s.length===0?(r="!=",l=""):/^\w*$/.test(l)?r="==":(o=s.match(/^(@|!@|~|!~|==|!=)(.*)$/),o&&(r=o[1],l=o[2]));let d;if((r==="~"||r==="!~")&&/^(\w|\|)*$/.test(l)){const c=Cu(l.split("|"),a.ignoreCase);d=function(h){return r==="~"?c(h):!c(h)}}else if(r==="@"||r==="!@"){const c=a[l];if(!c)throw Le(a,"the @ match target '"+l+"' is not defined, in rule: "+e);if(!gN(function(u){return typeof u=="string"},c))throw Le(a,"the @ match target '"+l+"' must be an array of strings, in rule: "+e);const h=Cu(c,a.ignoreCase);d=function(u){return r==="@"?h(u):!h(u)}}else if(r==="~"||r==="!~")if(l.indexOf("$")<0){const c=Nd(a,"^"+l+"$",!1);d=function(h){return r==="~"?c.test(h):!c.test(h)}}else d=function(c,h,u,g){return Nd(a,"^"+Qi(a,l,h,u,g)+"$",!1).test(c)};else if(l.indexOf("$")<0){const c=Bi(a,l);d=function(h){return r==="=="?h===c:h!==c}}else{const c=Bi(a,l);d=function(h,u,g,f,m){const _=Qi(a,c,u,g,f);return r==="=="?h===_:h!==_}}return n===-1?{name:t,value:i,test:function(c,h,u,g){return d(c,c,h,u,g)}}:{name:t,value:i,test:function(c,h,u,g){const f=mN(c,h,u,n);return d(f||"",c,h,u,g)}}}function Ed(a,e,t){if(t){if(typeof t=="string")return t;if(t.token||t.token===""){if(typeof t.token!="string")throw Le(a,"a 'token' attribute must be of type string, in rule: "+e);{const i={token:t.token};if(t.token.indexOf("$")>=0&&(i.tokenSubst=!0),typeof t.bracket=="string")if(t.bracket==="@open")i.bracket=Us.Open;else if(t.bracket==="@close")i.bracket=Us.Close;else throw Le(a,"a 'bracket' attribute must be either '@open' or '@close', in rule: "+e);if(t.next){if(typeof t.next!="string")throw Le(a,"the next state must be a string value in rule: "+e);{let n=t.next;if(!/^(@pop|@push|@popall)$/.test(n)&&(n[0]==="@"&&(n=n.substr(1)),n.indexOf("$")<0&&!vx(a,Qi(a,n,"",[],""))))throw Le(a,"the next state '"+t.next+"' is not defined in rule: "+e);i.next=n}}return typeof t.goBack=="number"&&(i.goBack=t.goBack),typeof t.switchTo=="string"&&(i.switchTo=t.switchTo),typeof t.log=="string"&&(i.log=t.log),typeof t.nextEmbedded=="string"&&(i.nextEmbedded=t.nextEmbedded,a.usesEmbedded=!0),i}}else if(Array.isArray(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=Ed(a,e,t[n]);return{group:i}}else if(t.cases){const i=[];for(const s in t.cases)if(t.cases.hasOwnProperty(s)){const o=Ed(a,e,t.cases[s]);s==="@default"||s==="@"||s===""?i.push({test:void 0,value:o,name:s}):s==="@eos"?i.push({test:function(r,l,d,c){return c},value:o,name:s}):i.push(pN(a,e,s,o))}const n=a.defaultToken;return{test:function(s,o,r,l){for(const d of i)if(!d.test||d.test(s,o,r,l))return d.value;return n}}}else throw Le(a,"an action must be a string, an object with a 'token' or 'cases' attribute, or an array of actions; in rule: "+e)}else return{token:""}}class _N{constructor(e){this.regex=new RegExp(""),this.action={token:""},this.matchOnlyAtLineStart=!1,this.name="",this.name=e}setRegex(e,t){let i;if(typeof t=="string")i=t;else if(t instanceof RegExp)i=t.source;else throw Le(e,"rules must start with a match string or regular expression: "+this.name);this.matchOnlyAtLineStart=i.length>0&&i[0]==="^",this.name=this.name+": "+i,this.regex=Nd(e,"^(?:"+(this.matchOnlyAtLineStart?i.substr(1):i)+")",!0)}setAction(e,t){this.action=Ed(e,this.name,t)}resolveRegex(e){return this.regex instanceof RegExp?this.regex:this.regex(e)}}function ff(a,e){if(!e||typeof e!="object")throw new Error("Monarch: expecting a language definition object");const t={languageId:a,includeLF:Er(e.includeLF,!1),noThrow:!1,maxStack:100,start:typeof e.start=="string"?e.start:null,ignoreCase:Er(e.ignoreCase,!1),unicode:Er(e.unicode,!1),tokenPostfix:_u(e.tokenPostfix,"."+a),defaultToken:_u(e.defaultToken,"source"),usesEmbedded:!1,stateNames:{},tokenizer:{},brackets:[]},i=e;i.languageId=a,i.includeLF=t.includeLF,i.ignoreCase=t.ignoreCase,i.unicode=t.unicode,i.noThrow=t.noThrow,i.usesEmbedded=t.usesEmbedded,i.stateNames=e.tokenizer,i.defaultToken=t.defaultToken;function n(o,r,l){for(const d of l){let c=d.include;if(c){if(typeof c!="string")throw Le(t,"an 'include' attribute must be a string at: "+o);if(c[0]==="@"&&(c=c.substr(1)),!e.tokenizer[c])throw Le(t,"include target '"+c+"' is not defined at: "+o);n(o+"."+c,r,e.tokenizer[c])}else{const h=new _N(o);if(Array.isArray(d)&&d.length>=1&&d.length<=3)if(h.setRegex(i,d[0]),d.length>=3)if(typeof d[1]=="string")h.setAction(i,{token:d[1],next:d[2]});else if(typeof d[1]=="object"){const u=d[1];u.next=d[2],h.setAction(i,u)}else throw Le(t,"a next state as the last element of a rule can only be given if the action is either an object or a string, at: "+o);else h.setAction(i,d[1]);else{if(!d.regex)throw Le(t,"a rule must either be an array, or an object with a 'regex' or 'include' field at: "+o);d.name&&typeof d.name=="string"&&(h.name=d.name),d.matchOnlyAtStart&&(h.matchOnlyAtLineStart=Er(d.matchOnlyAtLineStart,!1)),h.setRegex(i,d.regex),h.setAction(i,d.action)}r.push(h)}}}if(!e.tokenizer||typeof e.tokenizer!="object")throw Le(t,"a language definition must define the 'tokenizer' attribute as an object");t.tokenizer=[];for(const o in e.tokenizer)if(e.tokenizer.hasOwnProperty(o)){t.start||(t.start=o);const r=e.tokenizer[o];t.tokenizer[o]=new Array,n("tokenizer."+o,t.tokenizer[o],r)}if(t.usesEmbedded=i.usesEmbedded,e.brackets){if(!Array.isArray(e.brackets))throw Le(t,"the 'brackets' attribute must be defined as an array")}else e.brackets=[{open:"{",close:"}",token:"delimiter.curly"},{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"},{open:"<",close:">",token:"delimiter.angle"}];const s=[];for(const o of e.brackets){let r=o;if(r&&Array.isArray(r)&&r.length===3&&(r={token:r[2],open:r[0],close:r[1]}),r.open===r.close)throw Le(t,"open and close brackets in a 'brackets' attribute must be different: "+r.open+`
 hint: use the 'bracket' attribute if matching on equal brackets is required.`);if(typeof r.open=="string"&&typeof r.token=="string"&&typeof r.close=="string")s.push({token:r.token+t.tokenPostfix,open:Bi(t,r.open),close:Bi(t,r.close)});else throw Le(t,"every element in the 'brackets' array must be a '{open,close,token}' object or array")}return t.brackets=s,t.noThrow=!0,t}function CN(a){tg.registerLanguage(a)}function wN(){let a=[];return a=a.concat(tg.getLanguages()),a}function LN(a){return B.get(At).languageIdCodec.encodeLanguageId(a)}function vN(a,e){return B.withServices(()=>{const i=B.get(At).onDidRequestRichLanguageFeatures(n=>{n===a&&(i.dispose(),e())});return i})}function bN(a,e){return B.withServices(()=>{const i=B.get(At).onDidRequestBasicLanguageFeatures(n=>{n===a&&(i.dispose(),e())});return i})}function SN(a,e){if(!B.get(At).isRegisteredLanguageId(a))throw new Error(`Cannot set configuration for unknown language ${a}`);return B.get(mn).register(a,e,100)}class yN{constructor(e,t){this._languageId=e,this._actual=t}dispose(){}getInitialState(){return this._actual.getInitialState()}tokenize(e,t,i){if(typeof this._actual.tokenize=="function")return Xo.adaptTokenize(this._languageId,this._actual,e,i);throw new Error("Not supported!")}tokenizeEncoded(e,t,i){const n=this._actual.tokenizeEncoded(e,i);return new jd(n.tokens,n.endState)}}class Xo{constructor(e,t,i,n){this._languageId=e,this._actual=t,this._languageService=i,this._standaloneThemeService=n}dispose(){}getInitialState(){return this._actual.getInitialState()}static _toClassicTokens(e,t){const i=[];let n=0;for(let s=0,o=e.length;s<o;s++){const r=e[s];let l=r.startIndex;s===0?l=0:l<n&&(l=n),i[s]=new kl(l,r.scopes,t),n=l}return i}static adaptTokenize(e,t,i,n){const s=t.tokenize(i,n),o=Xo._toClassicTokens(s.tokens,e);let r;return s.endState.equals(n)?r=n:r=s.endState,new Qu(o,r)}tokenize(e,t,i){return Xo.adaptTokenize(this._languageId,this._actual,e,i)}_toBinaryTokens(e,t){const i=e.encodeLanguageId(this._languageId),n=this._standaloneThemeService.getColorTheme().tokenTheme,s=[];let o=0,r=0;for(let d=0,c=t.length;d<c;d++){const h=t[d],u=n.match(i,h.scopes)|Wt.BALANCED_BRACKETS_MASK;if(o>0&&s[o-1]===u)continue;let g=h.startIndex;d===0?g=0:g<r&&(g=r),s[o++]=g,s[o++]=u,r=g}const l=new Uint32Array(o);for(let d=0;d<o;d++)l[d]=s[d];return l}tokenizeEncoded(e,t,i){const n=this._actual.tokenize(e,i),s=this._toBinaryTokens(this._languageService.languageIdCodec,n.tokens);let o;return n.endState.equals(i)?o=i:o=n.endState,new jd(s,o)}}function xN(a){return typeof a.getInitialState=="function"}function NN(a){return"tokenizeEncoded"in a}function mf(a){return a&&typeof a.then=="function"}function EN(a){const e=B.get(vi);if(a){const t=[null];for(let i=1,n=a.length;i<n;i++)t[i]=_i.fromHex(a[i]);e.setColorMapOverride(t)}else e.setColorMapOverride(null)}function pf(a,e){return NN(e)?new yN(a,e):new Xo(a,e,B.get(At),B.get(vi))}function bc(a,e){const t=new TC(async()=>{const i=await Promise.resolve(e.create());return i?xN(i)?pf(a,i):new Zo(B.get(At),B.get(vi),a,ff(a,i),B.get(Gi)):null});return Ye.registerFactory(a,t)}function IN(a,e){if(!B.get(At).isRegisteredLanguageId(a))throw new Error(`Cannot set tokens provider for unknown language ${a}`);return mf(e)?bc(a,{create:()=>e}):Ye.register(a,pf(a,e))}function RN(a,e){const t=i=>new Zo(B.get(At),B.get(vi),a,ff(a,i),B.get(Gi));return mf(e)?bc(a,{create:()=>e}):Ye.register(a,t(e))}function DN(a,e){return B.get(Ce).referenceProvider.register(a,e)}function TN(a,e){return B.get(Ce).renameProvider.register(a,e)}function MN(a,e){return B.get(Ce).newSymbolNamesProvider.register(a,e)}function AN(a,e){return B.get(Ce).signatureHelpProvider.register(a,e)}function ON(a,e){return B.get(Ce).hoverProvider.register(a,{provideHover:async(i,n,s,o)=>{const r=i.getWordAtPosition(n);return Promise.resolve(e.provideHover(i,n,s,o)).then(l=>{if(l)return!l.range&&r&&(l.range=new N(n.lineNumber,r.startColumn,n.lineNumber,r.endColumn)),l.range||(l.range=new N(n.lineNumber,n.column,n.lineNumber,n.column)),l})}})}function PN(a,e){return B.get(Ce).documentSymbolProvider.register(a,e)}function kN(a,e){return B.get(Ce).documentHighlightProvider.register(a,e)}function WN(a,e){return B.get(Ce).linkedEditingRangeProvider.register(a,e)}function VN(a,e){return B.get(Ce).definitionProvider.register(a,e)}function FN(a,e){return B.get(Ce).implementationProvider.register(a,e)}function HN(a,e){return B.get(Ce).typeDefinitionProvider.register(a,e)}function BN(a,e){return B.get(Ce).codeLensProvider.register(a,e)}function zN(a,e,t){return B.get(Ce).codeActionProvider.register(a,{providedCodeActionKinds:t?.providedCodeActionKinds,documentation:t?.documentation,provideCodeActions:(n,s,o,r)=>{const d=B.get(ar).read({resource:n.uri}).filter(c=>N.areIntersectingOrTouching(c,s));return e.provideCodeActions(n,s,{markers:d,only:o.only,trigger:o.trigger},r)},resolveCodeAction:e.resolveCodeAction})}function UN(a,e){return B.get(Ce).documentFormattingEditProvider.register(a,e)}function GN(a,e){return B.get(Ce).documentRangeFormattingEditProvider.register(a,e)}function jN(a,e){return B.get(Ce).onTypeFormattingEditProvider.register(a,e)}function KN(a,e){return B.get(Ce).linkProvider.register(a,e)}function $N(a,e){return B.get(Ce).completionProvider.register(a,e)}function ZN(a,e){return B.get(Ce).colorProvider.register(a,e)}function qN(a,e){return B.get(Ce).foldingRangeProvider.register(a,e)}function XN(a,e){return B.get(Ce).declarationProvider.register(a,e)}function YN(a,e){return B.get(Ce).selectionRangeProvider.register(a,e)}function QN(a,e){return B.get(Ce).documentSemanticTokensProvider.register(a,e)}function JN(a,e){return B.get(Ce).documentRangeSemanticTokensProvider.register(a,e)}function eE(a,e){return B.get(Ce).inlineCompletionsProvider.register(a,e)}function tE(a,e){return B.get(Ce).inlineEditProvider.register(a,e)}function iE(a,e){return B.get(Ce).inlayHintsProvider.register(a,e)}function nE(){return{register:CN,getLanguages:wN,onLanguage:vN,onLanguageEncountered:bN,getEncodedLanguageId:LN,setLanguageConfiguration:SN,setColorMap:EN,registerTokensProviderFactory:bc,setTokensProvider:IN,setMonarchTokensProvider:RN,registerReferenceProvider:DN,registerRenameProvider:TN,registerNewSymbolNameProvider:MN,registerCompletionItemProvider:$N,registerSignatureHelpProvider:AN,registerHoverProvider:ON,registerDocumentSymbolProvider:PN,registerDocumentHighlightProvider:kN,registerLinkedEditingRangeProvider:WN,registerDefinitionProvider:VN,registerImplementationProvider:FN,registerTypeDefinitionProvider:HN,registerCodeLensProvider:BN,registerCodeActionProvider:zN,registerDocumentFormattingEditProvider:UN,registerDocumentRangeFormattingEditProvider:GN,registerOnTypeFormattingEditProvider:jN,registerLinkProvider:KN,registerColorProvider:ZN,registerFoldingRangeProvider:qN,registerDeclarationProvider:XN,registerSelectionRangeProvider:YN,registerDocumentSemanticTokensProvider:QN,registerDocumentRangeSemanticTokensProvider:JN,registerInlineCompletionsProvider:eE,registerInlineEditProvider:tE,registerInlayHintsProvider:iE,DocumentHighlightKind:DC,CompletionItemKind:RC,CompletionItemTag:IC,CompletionItemInsertTextRule:EC,SymbolKind:NC,SymbolTag:xC,IndentAction:yC,CompletionTriggerKind:SC,SignatureHelpTriggerKind:bC,InlayHintKind:vC,InlineCompletionTriggerKind:LC,InlineEditTriggerKind:wC,CodeActionTriggerType:CC,NewSymbolNameTag:_C,NewSymbolNameTriggerKind:pC,PartialAcceptTriggerKind:mC,HoverVerbosityAction:fC,InlineCompletionEndOfLifeReasonKind:gC,FoldingRangeKind:ns,SelectedSuggestionInfo:uC}}class Yo{static _handleEolEdits(e,t){let i;const n=[];for(const s of t)typeof s.eol=="number"&&(i=s.eol),s.range&&typeof s.text=="string"&&n.push(s);return typeof i=="number"&&e.hasModel()&&e.getModel().pushEOL(i),n}static _isFullModelReplaceEdit(e,t){if(!e.hasModel())return!1;const i=e.getModel(),n=i.validateRange(t.range);return i.getFullModelRange().equalsRange(n)}static execute(e,t,i){i&&e.pushUndoStop();const n=Hs.capture(e),s=Yo._handleEolEdits(e,t);s.length===1&&Yo._isFullModelReplaceEdit(e,s[0])?e.executeEdits("formatEditsCommand",s.map(o=>Xc.replace(N.lift(o.range),o.text))):e.executeEdits("formatEditsCommand",s.map(o=>Xc.replaceMove(N.lift(o.range),o.text))),i&&e.pushUndoStop(),n.restoreRelativeVerticalPositionOfCursor(e)}}function _f(a,e,t){const i=[],n=new MC,s=a.ordered(t);for(const r of s)i.push(r),r.extensionId&&n.add(r.extensionId);const o=e.ordered(t);for(const r of o){if(r.extensionId){if(n.has(r.extensionId))continue;n.add(r.extensionId)}i.push({displayName:r.displayName,extensionId:r.extensionId,provideDocumentFormattingEdits(l,d,c){return r.provideDocumentRangeFormattingEdits(l,l.getFullModelRange(),d,c)}})}return i}var ba;(function(a){a[a.File=1]="File",a[a.Selection=2]="Selection"})(ba||(ba={}));var Sa;(function(a){a[a.Explicit=1]="Explicit",a[a.Silent=2]="Silent"})(Sa||(Sa={}));class Gs{static{this._selectors=new Pd}static setFormatterSelector(e){return{dispose:Gs._selectors.unshift(e)}}static async select(e,t,i,n){if(e.length===0)return;const s=zu.first(Gs._selectors);if(s)return await s(e,t,i,n)}}async function bI(a,e,t,i,n,s,o){const r=a.get(Me),{documentRangeFormattingEditProvider:l}=a.get(Ce),d=ks(e)?e.getModel():e,c=l.ordered(d),h=await Gs.select(c,d,i,ba.Selection);h&&(n.report(h),await r.invokeFunction(sE,h,e,t,s,o))}async function sE(a,e,t,i,n,s){const o=a.get(lr),r=a.get(er),l=a.get(or);let d,c;ks(t)?(d=t.getModel(),c=new Zg(t,Bt.Value|Bt.Position,void 0,n)):(d=t,c=new qg(t,n));const h=[];let u=0;for(const L of AC(i).sort(N.compareRangesUsingStarts))u>0&&N.areIntersectingOrTouching(h[u-1],L)?h[u-1]=N.fromPositions(h[u-1].getStartPosition(),L.getEndPosition()):u=h.push(L);const g=async L=>{r.trace("[format][provideDocumentRangeFormattingEdits] (request)",e.extensionId?.value,L);const w=await e.provideDocumentRangeFormattingEdits(d,L,d.getFormattingOptions(),c.token)||[];return r.trace("[format][provideDocumentRangeFormattingEdits] (response)",e.extensionId?.value,w),w},f=(L,w)=>{if(!L.length||!w.length)return!1;const p=L.reduce((C,b)=>N.plusRange(C,b.range),L[0].range);if(!w.some(C=>N.intersectRanges(p,C.range)))return!1;for(const C of L)for(const b of w)if(N.intersectRanges(C.range,b.range))return!0;return!1},m=[],_=[];try{if(typeof e.provideDocumentRangesFormattingEdits=="function"){r.trace("[format][provideDocumentRangeFormattingEdits] (request)",e.extensionId?.value,h);const L=await e.provideDocumentRangesFormattingEdits(d,h,d.getFormattingOptions(),c.token)||[];r.trace("[format][provideDocumentRangeFormattingEdits] (response)",e.extensionId?.value,L),_.push(L)}else{for(const L of h){if(c.token.isCancellationRequested)return!0;_.push(await g(L))}for(let L=0;L<h.length;++L)for(let w=L+1;w<h.length;++w){if(c.token.isCancellationRequested)return!0;if(f(_[L],_[w])){const p=N.plusRange(h[L],h[w]),C=await g(p);h.splice(w,1),h.splice(L,1),h.push(p),_.splice(w,1),_.splice(L,1),_.push(C),L=0,w=0}}}for(const L of _){if(c.token.isCancellationRequested)return!0;const w=await o.computeMoreMinimalEdits(d.uri,L);w&&m.push(...w)}}finally{c.dispose()}if(m.length===0)return!1;if(ks(t))Yo.execute(t,m,!0),t.revealPositionInCenterIfOutsideViewport(t.getPosition(),K.Immediate);else{const[{range:L}]=m,w=new le(L.startLineNumber,L.startColumn,L.endLineNumber,L.endColumn);d.pushEditOperations([w],m.map(p=>({text:p.text,range:N.lift(p.range),forceMoveMarkers:!0})),p=>{for(const{range:C}of p)if(N.areIntersectingOrTouching(C,w))return[new le(C.startLineNumber,C.startColumn,C.endLineNumber,C.endColumn)];return null})}return l.playSignal(se.format,{userGesture:s}),!0}async function SI(a,e,t,i,n,s){const o=a.get(Me),r=a.get(Ce),l=ks(e)?e.getModel():e,d=_f(r.documentFormattingEditProvider,r.documentRangeFormattingEditProvider,l),c=await Gs.select(d,l,t,ba.File);c&&(i.report(c),await o.invokeFunction(oE,c,e,t,n,s))}async function oE(a,e,t,i,n,s){const o=a.get(lr),r=a.get(or);let l,d;ks(t)?(l=t.getModel(),d=new Zg(t,Bt.Value|Bt.Position,void 0,n)):(l=t,d=new qg(t,n));let c;try{const h=await e.provideDocumentFormattingEdits(l,l.getFormattingOptions(),d.token);if(c=await o.computeMoreMinimalEdits(l.uri,h),d.token.isCancellationRequested)return!0}finally{d.dispose()}if(!c||c.length===0)return!1;if(ks(t))Yo.execute(t,c,i!==Sa.Silent),i!==Sa.Silent&&t.revealPositionInCenterIfOutsideViewport(t.getPosition(),K.Immediate);else{const[{range:h}]=c,u=new le(h.startLineNumber,h.startColumn,h.endLineNumber,h.endColumn);l.pushEditOperations([u],c.map(g=>({text:g.text,range:N.lift(g.range),forceMoveMarkers:!0})),g=>{for(const{range:f}of g)if(N.areIntersectingOrTouching(f,u))return[new le(f.startLineNumber,f.startColumn,f.endLineNumber,f.endColumn)];return null})}return r.playSignal(se.format,{userGesture:s}),!0}async function rE(a,e,t,i,n,s){const o=e.documentRangeFormattingEditProvider.ordered(t);for(const r of o){const l=await Promise.resolve(r.provideDocumentRangeFormattingEdits(t,i,n,s)).catch(Pa);if(ig(l))return await a.computeMoreMinimalEdits(t.uri,l)}}async function aE(a,e,t,i,n){const s=_f(e.documentFormattingEditProvider,e.documentRangeFormattingEditProvider,t);for(const o of s){const r=await Promise.resolve(o.provideDocumentFormattingEdits(t,i,n)).catch(Pa);if(ig(r))return await a.computeMoreMinimalEdits(t.uri,r)}}function lE(a,e,t,i,n,s,o){const r=e.onTypeFormattingEditProvider.ordered(t);return r.length===0||r[0].autoFormatTriggerCharacters.indexOf(n)<0?Promise.resolve(void 0):Promise.resolve(r[0].provideOnTypeFormattingEdits(t,i,n,s,o)).catch(Pa).then(l=>a.computeMoreMinimalEdits(t.uri,l))}pn.registerCommand("_executeFormatRangeProvider",async function(a,...e){const[t,i,n]=e;xs(Xs.isUri(t)),xs(N.isIRange(i));const s=a.get(Wa),o=a.get(lr),r=a.get(Ce),l=await s.createModelReference(t);try{return rE(o,r,l.object.textEditorModel,N.lift(i),n,ka.None)}finally{l.dispose()}});pn.registerCommand("_executeFormatDocumentProvider",async function(a,...e){const[t,i]=e;xs(Xs.isUri(t));const n=a.get(Wa),s=a.get(lr),o=a.get(Ce),r=await n.createModelReference(t);try{return aE(s,o,r.object.textEditorModel,i,ka.None)}finally{r.dispose()}});pn.registerCommand("_executeFormatOnTypeProvider",async function(a,...e){const[t,i,n,s]=e;xs(Xs.isUri(t)),xs(I.isIPosition(i)),xs(typeof n=="string");const o=a.get(Wa),r=a.get(lr),l=a.get(Ce),d=await o.createModelReference(t);try{return lE(r,l,d.object.textEditorModel,I.lift(i),n,s,ka.None)}finally{d.dispose()}});Vt.wrappingIndent.defaultValue=Un.None;Vt.glyphMargin.defaultValue=!1;Vt.autoIndent.defaultValue=oi.Advanced;Vt.overviewRulerLanes.defaultValue=2;Gs.setFormatterSelector((a,e,t)=>Promise.resolve(a[0]));const yt=OC();yt.editor=uN();yt.languages=nE();yt.CancellationTokenSource;yt.Emitter;yt.KeyCode;yt.KeyMod;yt.Position;yt.Range;yt.Selection;yt.SelectionDirection;yt.MarkerSeverity;yt.MarkerTag;yt.Uri;yt.Token;const eo=yt.editor,Xa=yt.languages,dE=globalThis.MonacoEnvironment;(dE?.globalAPI||typeof globalThis.define=="function"&&globalThis.define.amd)&&(globalThis.monaco=yt);function cE(a,e){return a.invokeFunction(t=>PC.getServiceDependencies(e).sort((i,n)=>i.index-n.index).map(i=>t.get(i.id)))}function Sc(a){const e=a;return class extends e{constructor(...t){super(...t.slice(1),...cE(t[0],a))}}}function Id(a,e){const t=js(a.editor)?Ro(a.editor):Object.create(null);return Object.assign(t,Ro(e)),t}function wu(a,e){const t=Id(a);if(js(a.diffEditor)){const i=Ro(a.diffEditor);i.diffCodeLens=i.codeLens,delete i.codeLens,i.diffWordWrap=i.wordWrap,delete i.wordWrap,Object.assign(t,i)}return t.accessibilityVerbose=a.accessibility?.verbosity?.diffEditor??!1,Object.assign(t,Ro(e)),t}function Cf(a){let e=class extends a{constructor(i,n={},s,o){const{theme:r,autoDetectHighContrast:l,model:d,value:c,language:h,accessibilityHelpUrl:u,ariaContainerElement:g,overflowWidgetsDomNode:f,dimension:m,..._}=n,L=Id(o.getValue(n.model?.uri),_);super(s,i,{...L,overflowWidgetsDomNode:f,dimension:m,theme:r,autoDetectHighContrast:l,model:d,value:c,language:h,accessibilityHelpUrl:u,ariaContainerElement:g}),this.textResourceConfigurationService=o,this.optionsOverrides={},this.lastAppliedEditorOptions=L,this.optionsOverrides=_,this._register(o.onDidChangeConfiguration(C=>{const b=this.getModel()?.uri;b!=null&&C.affectsConfiguration(b,"editor")&&this.updateEditorConfiguration()})),this._register(this.onDidChangeModelLanguage(()=>this.updateEditorConfiguration())),this._register(this.onDidChangeModel(()=>this.updateEditorConfiguration())),this.updateEditorConfiguration();const w=s.createChild(new $s([ot,this._contextKeyService])),p=this._register(w.createInstance(HC));this.onDidChangeModel(C=>{p.set(C.newModelUrl)}),p.set(this.getModel()?.uri)}updateEditorConfiguration(){if(!this.hasModel()||this.textResourceConfigurationService==null)return;const i=this.getModel().uri,n=this.textResourceConfigurationService.getValue(i);if(n==null)return;const s=Id(n,this.optionsOverrides);let o=s;this.lastAppliedEditorOptions!=null&&(o=sg(this.lastAppliedEditorOptions,o)),Object.keys(o).length>0&&(this.lastAppliedEditorOptions=s,super.updateOptions(o))}updateOptions(i){this.optionsOverrides??(this.optionsOverrides={}),Oi.applyUpdate(this.optionsOverrides,i)&&this.updateEditorConfiguration()}};return e=ge([P(2,Me),P(3,ng)],e),e}const hE=Cf(Sc(qo)),uE=Cf(Sc(wa));let Rd=class extends Sc(La){constructor(e,t={},i,n){const{theme:s,autoDetectHighContrast:o,modifiedAriaLabel:r,originalAriaLabel:l,overflowWidgetsDomNode:d,dimension:c,...h}=t,u=wu(n.getValue(void 0),h);super(i,e,{...u,overflowWidgetsDomNode:d,dimension:c,theme:s,autoDetectHighContrast:o,modifiedAriaLabel:r,originalAriaLabel:l}),this.textResourceConfigurationService=n,this.optionsOverrides={},this.lastAppliedEditorOptions=u,this.optionsOverrides=h,this._register(n.onDidChangeConfiguration(g=>{const f=this._targetEditor.getModel()?.uri;f!=null&&(g.affectsConfiguration(f,"editor")||g.affectsConfiguration(f,"diffEditor")||g.affectsConfiguration(f,"accessibility.verbosity.diffEditor"))&&this.updateEditorConfiguration()})),this._register(this._targetEditor.onDidChangeModelLanguage(()=>this.updateEditorConfiguration())),this._register(this.onDidChangeModel(()=>this.updateEditorConfiguration())),this.updateEditorConfiguration()}updateEditorConfiguration(){if(this.getModel()==null||this.textResourceConfigurationService==null)return;const e=this._targetEditor.getModel()?.uri,t=this.textResourceConfigurationService.getValue(e);if(t==null)return;const i=wu(t,this.optionsOverrides);let n=i;this.lastAppliedEditorOptions!=null&&(n=sg(this.lastAppliedEditorOptions,n)),Object.keys(n).length>0&&(this.lastAppliedEditorOptions=i,super.updateOptions(n))}updateOptions(e){this.optionsOverrides??(this.optionsOverrides={}),this.optionsOverrides={...this.optionsOverrides,...e},this.updateEditorConfiguration()}_createInnerEditor(e,t,i){return e.createInstance(hE,t,i)}};Rd=ge([P(2,Me),P(3,ng)],Rd);async function wf(a,e){await(await og(FC)).writeFile(a,kC.fromString(e))}async function gE(a,e){return e!=null&&await wf(a,e),await(await og(Wa)).createModelReference(a)}function fE(a){return a.registerKeybindingProvider!=null}let Dd=class extends rr{constructor(e,t,i,n,s,o,r){super(t,i,n,s,o,r),this.delegate=e,this._register(e.registerKeybindingProvider({provideKeybindings:()=>this.getUserKeybindingItems(),onDidChangeKeybindings:this.onDidUpdateKeybindings}))}_getResolver(){return this.delegate._getResolver()}resolveKeyboardEvent(e){return this.delegate.resolveKeyboardEvent(e)}resolveKeybinding(e){return this.delegate.resolveKeybinding(e)}resolveUserBinding(e){return this.delegate.resolveUserBinding(e)}_dumpDebugInfo(){return this.delegate._dumpDebugInfo()}_dumpDebugInfoJSON(){return this.delegate._dumpDebugInfoJSON()}registerSchemaContribution(e){return this.delegate.registerSchemaContribution(e)}enableKeybindingHoldMode(e){return this.delegate.enableKeybindingHoldMode(e)}};Dd=ge([P(1,ot),P(2,Zs),P(3,Aa),P(4,is),P(5,er),P(6,zt)],Dd);let bl=null;function Lf(a){if(bl==null){const e=new $s;e.set(WC,new Yc(VC,[],!0));const t=a.get(wi);!(t instanceof rr)&&fE(t)&&e.set(wi,new Yc(Dd,[t],!0)),bl=a.get(Me).createChild(e)}return bl}const mE=(a,e,t)=>B.initialize(t??{}).invokeFunction(Lf).createInstance(uE,a,e),pE=(a,e,t)=>B.initialize(t??{}).invokeFunction(Lf).createInstance(Rd,a,e),_E=Xa.onLanguage;Xa.onLanguage=(a,e)=>rg(()=>_E(a,e));const CE=Xa.onLanguage;Xa.onLanguageEncountered=(a,e)=>rg(()=>CE(a,e));eo.create=mE;eo.createDiffEditor=pE;eo.createModelReference=gE;eo.writeFile=wf;let wE=0;function LE(a){const e=a.label||"anonymous"+ ++wE,t=globalThis.MonacoEnvironment;if(t){if(typeof t.getWorker=="function")return t.getWorker("workerMain.js",e);if(typeof t.getWorkerUrl=="function"){const i=t.getWorkerUrl("workerMain.js",e);return new Worker(i,{name:e,type:"module"})}}throw new Error("You must define a function MonacoEnvironment.getWorkerUrl or MonacoEnvironment.getWorker")}function vE(a){return"moduleId"in a}const bE=eo.createWebWorker;function SE(a){if(vE(a)){const e=LE({esmModuleLocation:Xs.parse(a.moduleId),label:a.label}),t=gf({worker:e,host:a.host,keepIdleModels:a.keepIdleModels});return(async()=>(await t.getProxy()).$initialize(a.createData))(),t}else return bE(a)}eo.createWebWorker=SE;export{Qr as $,se as A,rf as B,ca as C,fg as D,Zg as E,zs as F,af as G,Ds as H,QC as I,$y as J,nf as K,Jc as L,ha as M,uy as N,xo as O,Yr as P,gy as Q,jo as R,Hs as S,qg as T,_o as U,un as V,hd as W,eu as X,hh as Y,Is as Z,kS as _,Bt as a,bI as a0,Sa as a1,SI as a2,Gs as a3,ba as a4,_f as a5,oE as a6,sE as a7,pe as a8,Mt as a9,me as aA,ie as aB,ME as aC,wd as aD,JE as aE,qo as aF,Xa as aG,eo as aH,gE as aI,Vl as aJ,en as aK,Fl as aL,WE as aM,wa as aN,Nb as aa,Vs as ab,PL as ac,hL as ad,Yi as ae,lE as af,Yo as ag,si as ah,Uo as ai,Fs as aj,Eg as ak,ts as al,OE as am,PE as an,Wi as ao,lt as ap,Ke as aq,Jd as ar,TE as as,Rn as at,Rg as au,Qt as av,lS as aw,cS as ax,dS as ay,_t as az,JC as b,ZE as c,cg as d,zC as e,ta as f,qE as g,he as h,cd as i,Mi as j,_a as k,yv as l,WS as m,yy as n,Hn as o,qa as p,ni as q,nu as r,Xd as s,Ys as t,Be as u,on as v,ly as w,yg as x,bd as y,vd as z};

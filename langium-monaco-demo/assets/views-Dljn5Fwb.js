const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/layout.contribution.darwin-CNuKAPkw.js","assets/_.contribution-yLVugOC6.js","assets/layout.contribution.linux-CkqTuM6V.js","assets/layout.contribution.win-D72LutgT.js"])))=>i.map(i=>d[i]);
import{fQ as Pe,d7 as C,d8 as X,da as x,fj as W,fm as N,fn as y,jb as J,E as V,q2 as _s,D as R,a5 as E,h7 as B,gM as si,xg as Ne,m5 as Gt,xh as xi,h as O,m3 as $n,t as ae,xi as Uy,d1 as mn,dX as Js,io as Hy,iq as ss,_ as D,o as u,il as mt,d6 as ce,I as F,h4 as me,ik as at,a0 as us,R as H,aZ as Ie,df as G,id as zy,lW as $y,a as Se,hN as hd,js as jy,e0 as Re,lT as jn,bg as ud,l as c,qx as Po,lU as qn,lR as ge,ib as Zs,oR as au,is as du,qu as qy,qv as Yy,qQ as Lc,lw as jt,aJ as qe,d9 as w,cl as Mo,p2 as ke,ci as Y,eL as Nr,et as St,cj as te,fM as dp,fN as cp,uK as pf,a1 as Xs,it as Jy,ii as aa,bo as Ke,he as it,cw as At,p as se,ij as ps,lb as As,jn as Oo,$ as ie,sg as da,d as es,e1 as wt,p$ as gf,m2 as Dn,mf as Vc,cz as ur,xj as Zy,H as ut,ld as Xy,hP as Qy,oD as Ws,cp as ev,bM as Qs,qB as tv,bc as Q,mS as ff,aV as re,pq as Pc,w as gs,dh as Es,fv as cu,qw as iv,kT as sv,mo as No,k1 as ov,ae as lu,xk as nv,bt as Bo,oF as hu,ck as mf,el as rv,c0 as av,xl as dv,cm as eo,cH as I,bw as k,bz as qo,hs as ca,ec as Yo,uQ as Wt,xm as Cs,xn as ot,lx as Is,ly as cv,cV as ro,px as Mc,ih as Ce,aS as Yi,n6 as Oc,jZ as S,cG as ee,n7 as Gs,c$ as ts,xo as lv,xp as hv,fw as oe,ch as wf,fI as tc,xq as ic,bY as lp,fE as Fo,xr as uv,xs as pv,uk as gv,d$ as Ht,xt as fv,un as Br,a2 as fi,uR as T,xu as ii,cU as mv,jK as Te,ap as Hs,m as yf,a6 as vf,cO as bf,ui as wv,q as Le,bq as Jo,aP as Ue,bX as pr,G as to,J as Cf,a3 as xs,X as Nc,xv as hp,ee as _,xw as yv,xx as Sf,um as vv,xy as up,oi as bv,bU as uu,be as io,w5 as Cv,eQ as _f,lQ as Sv,tv as Bc,eM as _v,fF as Fc,xz as Di,cT as Jr,dp as ve,xA as Ev,iD as he,bA as ni,bb as Fi,r as Zo,my as Xo,pv as Iv,j as dt,Y as wn,oZ as pd,S as pe,ie as Qo,ia as _t,Z as Qe,dS as Dv,U,eR as To,oP as Av,qp as Tv,qq as xv,e_ as kv,qn as gd,lS as ji,mc as Rv,mz as pp,qG as gp,fp as ft,lg as Lv,lf as Vv,qL as Pv,eq as fd,er as md,xB as Mv,sk as en,hu as pu,jz as la,xC as Ov,xD as Nv,w0 as fp,w3 as Bv,f3 as gu,xE as fu,xF as Fv,y as Wi,mM as mu,g as j,q7 as Zr,qU as Kv,pL as Ef,n as ki,b as _e,k as os,or as Wv,d5 as Jt,br as ns,pt as Gv,cD as Uv,ad as An,xG as Hv,ao as mp,aQ as wp,cx as gr,aR as yp,ls as zv,lt as $v,bi as wd,gB as wu,nU as If,fr as Df,fs as Af,ez as Xr,wE as jv,lr as So,N as qv,xH as Yv,fB as Tn,x as Tf,z as yn,aU as vp,K as xn,cP as bp,tH as yu,dB as Jv,tI as Zv,ja as Xv,tJ as Cp,i6 as vn,fo as Qv,iN as le,fS as xf,eG as yd,C as Ts,a$ as eb,nr as kf,ix as kn,nZ as tb,n_ as ib,ax as sb,eF as Sp,b2 as ob,hi as nb,aO as wi,r8 as Rf,xI as rb,pu as Lf,xJ as ab,qj as db,xK as cb,p5 as Vf,sm as lb,xL as hb,xM as ub,qz as Yn,o_ as pb,bf as fs,bl as fo,wQ as _p,wR as gb,sn as Pf,uj as Ep,qy as ha,mT as fb,cy as vd,tG as Ip,xN as Dp,tt as Ap,xO as mb,o3 as wb,fR as Mf,xP as Tp,c2 as Of,xf as yb,bB as ao,lC as Rn,kx as Tt,c4 as vb,nY as bb,fJ as ua,q6 as sc,eJ as Nf,xQ as Cb,xR as xp,xS as kp,eu as Sb,ac as ui,xT as _b,xU as Eb,xV as Ib,xW as Kc,xX as Rp,v2 as Db,xY as Bf,xZ as Lp,x_ as Ab,cr as Tb,x$ as xb,y0 as kb,wZ as Rb,y1 as oc,y2 as Lb,ml as Vb,y3 as Pb,wI as Mb,W as pa,an as Ob,rS as Ff,bp as bd,ba as tn,mJ as vu,y4 as Vp,w7 as Nb,ov as rs,dq as Wc,kU as Bb,s as Cd,dm as sn,ot as Fb,T as Kb,bk as Kf,ex as Pt,rR as Wb,bH as Gb,ow as oi,b9 as Wf,y5 as Ub,bu as Hb,ip as zb,aF as Pp,m4 as Mp,b0 as ga,qs as Ji,lX as Ko,pi as bn,l$ as $b,lY as Sd,lV as _d,y6 as jb,ej as qb,m7 as Ed,ou as Gf,m9 as be,dz as yt,dA as vt,ne as Uf,jp as Hf,y7 as zf,fA as $f,rz as Id,bD as co,mi as Ki,fl as Jn,m8 as ue,y8 as bu,y9 as bi,ya as Ci,qi as xt,ma as Yb,yb as Jb,yc as Cu,mB as fr,yd as mr,ts as wr,ye as jf,mb as Zb,yf as Xb,yg as Qb,jJ as qf,yh as Yf,yi as eC,yj as Dd,re as nc,rf as rc,yk as Jf,yl as tC,ym as iC,t9 as sC,ta as oC,p3 as Zf,bj as Ad,cu as nC,yn as rC,r7 as Gc,yo as Op,vy as aC,k2 as Xf,lv as Np,oW as dC,oN as cC,q_ as lC,qW as hC,rc as uC,jk as Qf,yp as pC,r9 as Fr,eO as gC,iW as Uc,yq as fC,a4 as mC,qV as wC,kW as Bp,l6 as em,b8 as on,b1 as yC,oq as Su,bV as vC,cC as Fp,cX as bC,o1 as tm,hn as CC,dr as im,fi as SC,tX as Kp,bT as Ms,yr as _C,hk as Wp,bh as Td,by as sm,oo as EC,uq as IC,ys as DC,yt as un,B as AC,yu as TC,jo as Pi,sX as Gp,yv as xC,jw as so,yw as kC,yx as RC,hY as Ln,i9 as Up,i3 as LC,iZ as ht,iA as Ae,hc as yi,iI as Mi,hO as VC,i2 as zt,gK as _u,iz as Eu,fP as xd,iE as PC,gf as Zi,ha as qi,jv as MC,iB as Hp,aK as OC,eP as NC,iC as BC,rM as Hc,rN as ac,hw as FC,rP as om,lN as Kr,yy as KC,yz as WC,yA as GC,pk as UC,yB as HC,yC as zC,yD as $C,pF as nm,pG as rm,ll as am,yE as fa,le as jC,i0 as zp,i4 as qC,oA as YC,ps as ma,yF as JC,bC as dm,V as cm,nn as ZC,tq as XC,fq as QC,yG as eS,yH as tS,aB as iS,qb as sS,de as oS,bI as nS,kS as rS,pE as aS,uH as dS,mY as cS,yI as lS}from"./monaco-vscode-base-service-override-BYqBQsid.js";import{gC as xe,g_ as q,i0 as hS,i1 as uS,i2 as pS,i3 as Iu,i4 as gS,hg as lm,i5 as fS,i6 as mS,i7 as hm,i8 as wa,i9 as wS,ia as yS,ib as um,gZ as Ye,ic as ya,id as vS,ie as pm,g$ as Wr,ig as xo,ih as gm,ii as bS,ij as CS,ik as fm,il as mm,im as wm,io as ym,ip as vm,iq as bm,ir as SS,hs as _S,hq as ES,is as ks,it as IS,iu as dc,iv as va,iw as Cm,ix as DS,iy as AS,iz as Sm,iA as _m,iB as Em,iC as $p,iD as TS,iE as ko,iF as ys,iG as Os,iH as xS,iI as kS,iJ as zc,iK as RS,iL as LS,iM as VS,iN as PS,iO as MS,iP as OS,iQ as Im,iR as jp,iS as NS,iT as Gr,iU as BS,iV as FS,iW as KS,iX as qp,iY as cc,ho as WS,h9 as Rs,hb as Du,hc as GS,hn as US,iZ as HS,i_ as yr,i$ as Yp,j0 as zS,j1 as Dm,j2 as $S,j3 as Am,j4 as Au,j5 as Tu,j6 as pt,j7 as Tm,j8 as pn,h0 as vr,j9 as jS,ja as Jp,jb as gt,jc as Lt,jd as br,dT as Qr,je as Zp,dO as De,jf as ti,jg as Vt,jh as qS,ji as YS,jj as je,jk as xu,gQ as JS,jl as Mt,hh as Cr,jm as Sr,jn as ZS,jo as XS,jp as QS,jq as lc,jr as e_,js as t_,jt as i_,ju as Xp,jv as ku,jw as s_,jx as o_,jy as Yt,jz as xm,jA as km,jB as lo,h8 as et,jC as n_,jD as Qp,jE as r_,jF as vi,jG as kd,jH as ba,jI as a_,jJ as Rd,jK as Rm,jL as d_,jM as Lm,jN as nt,jO as Vm,jP as Pm,jQ as Mm,jR as Om,jS as Nm,jT as Bm,jU as Fm,jV as Km,jW as Wm,jX as Ca,jY as hc,jZ as Gm,j_ as rt,j$ as uc,k0 as c_,k1 as Um,k2 as Ri,k3 as eg,k4 as Ld,k5 as l_,k6 as h_,k7 as u_,k8 as tg,k9 as p_,ka as He,kb as Ve,kc as is,kd as Us,ke as Et,kf as zs,kg as g_,kh as Sa,ki as Ru,kj as It,kk as f_,kl as m_,km as pc,kn as oo,ko as Hm,kp as Ro,kq as w_,kr as y_,ks as _o,kt as Lu,ku as gc,kv as ig,kw as Ui,kx as Ur,ky as Gi,kz as $c,kA as sg,kB as Vn,kC as zm,kD as $m,kE as v_,kF as b_,kG as jm,kH as C_,kI as og,kJ as qm,kK as _r,kL as Ni,kM as Ym,kN as S_,kO as Jm,kP as jc,gW as __,kQ as ng,kR as E_,kS as I_,kT as D_,kU as A_,kV as T_,kW as x_,kX as k_,kY as Vd,kZ as Er,k_ as rg,k$ as R_,l0 as L_,l1 as ag,l2 as V_,l3 as Zm,l4 as dg,l5 as Xm,l6 as cg,l7 as Qm,l8 as lg,l9 as qc,la as Yc,lb as P_,lc as M_,ld as O_,le as N_,lf as B_,lg as F_,lh as K_,li as W_,lj as G_,lk as U_,ll as ew,lm as tw,ln as H_,lo as z_,lp as $_,lq as j_,lr as q_,ls as Y_,lt as J_,lu as Z_,lv as X_,lw as Q_,lx as eE,ly as tE,lz as iE,lA as sE,lB as oE,lC as nE,lD as rE,lE as aE,lF as dE,lG as cE,lH as lE,lI as hE,lJ as uE,lK as pE,lL as gE,lM as fE,lN as mE,lO as wE,lP as yE,lQ as vE,lR as bE,lS as CE,lT as SE,lU as _E,lV as EE,lW as IE,lX as DE,lY as AE,lZ as TE,l_ as xE,l$ as kE,m0 as RE,m1 as LE,m2 as VE,m3 as PE,m4 as ME,m5 as OE,m6 as NE,m7 as BE,m8 as FE,m9 as KE,ma as WE,mb as GE,mc as UE,md as HE,me as zE,mf as $E,mg as jE,mh as qE,mi as YE,mj as JE,mk as ZE,ml as XE,mm as QE,mn as eI,mo as tI,mp as iI,mq as sI,mr as oI,ms as nI,mt as iw,mu as sw,mv as ow,mw as nw,mx as rw,my as aw,mz as dw,mA as cw,mB as rI,mC as aI,mD as dI,mE as cI,mF as lI,mG as hI,mH as uI,mI as pI,mJ as gI,mK as fI,mL as mI,mM as wI,mN as yI,mO as lw,mP as vI,mQ as hw,mR as uw,mS as pw,mT as Pd,mU as Ir,mV as Md,mW as Dr,mX as bI,mY as gw,mZ as CI,m_ as SI,m$ as _I,n0 as EI,n1 as II,n2 as DI,n3 as AI,n4 as TI,n5 as xI,n6 as kI,n7 as RI,n8 as LI,n9 as nn,na as fw,nb as mw,nc as Vu,nd as Ar,ne as ww,nf as yw,ng as vw,nh as Od,ni as bw,nj as Cw,nk as Sw,nl as _w,nm as VI,nn as PI,no as MI,np as Ew,nq as OI,nr as NI,ns as BI,nt as FI,nu as KI,nv as WI,nw as Iw,nx as GI,ny as UI,nz as HI,nA as zI,nB as Wo,nC as Pu,nD as $I,nE as Dw,nF as Zn,nG as fc,nH as hg,nI as jI,hJ as qI,h$ as ug,gI as Aw,nJ as Nd,nK as pg,nL as gg,nM as YI,nN as JI,nO as Mu,nP as ZI,nQ as Hr,nR as Ns,nS as fg,nT as mg,nU as zr,nV as XI,nW as wg,nX as Tw,nY as Eo,nZ as mc,n_ as QI,n$ as ye,o0 as rn,o1 as Bd,o2 as Ou,o3 as eD,o4 as tD,o5 as xw,o6 as iD,o7 as yg,o8 as Ds,o9 as sD,oa as $r,ob as Pn,oc as oD,hi as vg,hk as nD,hl as rD,od as aD,hm as dD,oe as Jc,of as Zc,og as Xc,oh as cD,oi as Xn,oj as lD,ok as bg,hA as hD,hz as uD,ol as kw,om as pD,on as gD,oo as fD,op as mD,oq as wD,or as yD,os as jr}from"./monaco-vscode-api-CofsR7n8.js";import{aZ as vD,a$ as ze,b0 as M,e as Ls,I as kt,cE as bD,bC as CD,T as Kt,bZ as Ot,bX as Oe,cF as SD,cG as _D,K as Cg,b3 as Rw,aw as we,f as Je,G as go,a5 as Ge,av as Nt,aW as ms,b5 as ea,cH as an,aY as Nu,aX as Bu,h as Zt,cI as ED,cJ as ID,cx as Sg,b2 as DD,c1 as Qc,U as el,E as Fd,k as Fu,cs as wc,cf as AD,aa as _g,a6 as Bt,a7 as Li,cK as Lw,D as Ct,a8 as yc,aA as Eg,ab as TD,a9 as xD,a4 as kD,cp as RD,cL as LD,ag as tl,ac as tt,_ as vc,ai as Ig,cM as VD,L as il,aj as pi,ah as _a,s as PD,ae as ct,bM as ta,cN as MD,i as OD,c as ND,cO as BD,l as Kd,aI as Mn,a2 as FD,b as Vw,al as KD,j as WD,g as gi,cP as GD,cQ as Hi,bI as Dg,bL as sl,p as Pw,y as Cn,aB as dn,ay as Si,c5 as Mw,be as UD,cR as Tr,b9 as Ow,bf as Wd,b1 as Nw,b7 as HD,aC as cn,aD as Bw,aE as xr,bd as Gd,ar as no,as as zD,q as $D,bm as jD,aN as qD,cS as Ku,a1 as YD,ao as JD,bJ as Ag,an as ZD,aM as Tg,aL as Fw,cm as XD}from"./monaco-vscode-configuration-service-override-C_9dpF2l.js";import{f as Kw,T as QD}from"./files.contribution._fileEditorFactory-CIdUKUGS.js";import{W as Wu,H as Ww,l as eA,C as Gw,$ as bc,aL as xg,aM as tA,M as iA,m as ia,F as Uw,e as sA}from"./monaco-vscode-editor-api-CVotD80_.js";import{I as oA}from"./workbenchThemeService.service-B8QZVqmt.js";import{g as nA,w as rA,h as aA}from"./monaco-vscode-extension-api-CARuSqvA.js";const Hw=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Pe(Hw);C(class extends X{constructor(){super({id:"workbench.action.closeSidebar",title:x(3454,"Close Primary Side Bar"),category:xe.View,f1:!0,precondition:vD})}run(a){a.get(ze).setPartHidden(!0,M.SIDEBAR_PART)}});class dA extends X{constructor(){super({id:"workbench.action.focusSideBar",title:x(3455,"Focus into Primary Side Bar"),category:xe.View,f1:!0,keybinding:{weight:W.WorkbenchContrib,when:null,primary:N.CtrlCmd|y.Digit0}})}async run(e){const t=e.get(ze),i=e.get(Ls);t.isVisible(M.SIDEBAR_PART)||t.setPartHidden(!1,M.SIDEBAR_PART),i.getActivePaneComposite(q.Sidebar)?.focus()}}C(dA);const zw=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Pe(zw);const cA={separatorBorder:si.transparent};function Vi(a){return a===J.VERTICAL?J.HORIZONTAL:J.VERTICAL}class lA{constructor(e){this.isLayoutEnabled=e}}function hA(a,e){return e===J.HORIZONTAL?{left:a.start,right:a.end,top:a.orthogonalStart,bottom:a.orthogonalEnd}:{top:a.start,bottom:a.end,left:a.orthogonalStart,right:a.orthogonalEnd}}function uA(a,e){return e===J.HORIZONTAL?{start:a.left,end:a.right,orthogonalStart:a.top,orthogonalEnd:a.bottom}:{start:a.top,end:a.bottom,orthogonalStart:a.left,orthogonalEnd:a.right}}function li(a,e){if(Math.abs(a)>e)throw new Error("Invalid index");return Uy(a,e+1)}class Ee{get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}get absoluteOffset(){return this._absoluteOffset}get absoluteOrthogonalOffset(){return this._absoluteOrthogonalOffset}get styles(){return this._styles}get width(){return this.orientation===J.HORIZONTAL?this.size:this.orthogonalSize}get height(){return this.orientation===J.HORIZONTAL?this.orthogonalSize:this.size}get top(){return this.orientation===J.HORIZONTAL?this._absoluteOffset:this._absoluteOrthogonalOffset}get left(){return this.orientation===J.HORIZONTAL?this._absoluteOrthogonalOffset:this._absoluteOffset}get minimumSize(){return this.children.length===0?0:Math.max(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.minimumOrthogonalSize:0))}get maximumSize(){return Math.min(...this.children.map((e,t)=>this.splitview.isViewVisible(t)?e.maximumOrthogonalSize:Number.POSITIVE_INFINITY))}get priority(){if(this.children.length===0)return xi.Normal;const e=this.children.map(t=>typeof t.priority>"u"?xi.Normal:t.priority);return e.some(t=>t===xi.High)?xi.High:e.some(t=>t===xi.Low)?xi.Low:xi.Normal}get proportionalLayout(){return this.children.length===0?!0:this.children.every(e=>e.proportionalLayout)}get minimumOrthogonalSize(){return this.splitview.minimumSize}get maximumOrthogonalSize(){return this.splitview.maximumSize}get minimumWidth(){return this.orientation===J.HORIZONTAL?this.minimumOrthogonalSize:this.minimumSize}get minimumHeight(){return this.orientation===J.HORIZONTAL?this.minimumSize:this.minimumOrthogonalSize}get maximumWidth(){return this.orientation===J.HORIZONTAL?this.maximumOrthogonalSize:this.maximumSize}get maximumHeight(){return this.orientation===J.HORIZONTAL?this.maximumSize:this.maximumOrthogonalSize}get boundarySashes(){return this._boundarySashes}set boundarySashes(e){if(!(this._boundarySashes.start===e.start&&this._boundarySashes.end===e.end&&this._boundarySashes.orthogonalStart===e.orthogonalStart&&this._boundarySashes.orthogonalEnd===e.orthogonalEnd)){this._boundarySashes=e,this.splitview.orthogonalStartSash=e.orthogonalStart,this.splitview.orthogonalEndSash=e.orthogonalEnd;for(let t=0;t<this.children.length;t++){const i=this.children[t],s=t===0,o=t===this.children.length-1;i.boundarySashes={start:e.orthogonalStart,end:e.orthogonalEnd,orthogonalStart:s?e.start:i.boundarySashes.orthogonalStart,orthogonalEnd:o?e.end:i.boundarySashes.orthogonalEnd}}}}get edgeSnapping(){return this._edgeSnapping}set edgeSnapping(e){if(this._edgeSnapping!==e){this._edgeSnapping=e;for(const t of this.children)t instanceof Ee&&(t.edgeSnapping=e);this.updateSplitviewEdgeSnappingEnablement()}}constructor(e,t,i,s,o=0,n=0,r=!1,d){if(this.orientation=e,this.layoutController=t,this.splitviewProportionalLayout=s,this.children=[],this._absoluteOffset=0,this._absoluteOrthogonalOffset=0,this.absoluteOrthogonalSize=0,this._onDidChange=new E,this.onDidChange=this._onDidChange.event,this._onDidVisibilityChange=new E,this.onDidVisibilityChange=this._onDidVisibilityChange.event,this.childrenVisibilityChangeDisposable=new O,this._onDidScroll=new E,this.onDidScrollDisposable=R.None,this.onDidScroll=this._onDidScroll.event,this.childrenChangeDisposable=R.None,this._onDidSashReset=new E,this.onDidSashReset=this._onDidSashReset.event,this.splitviewSashResetDisposable=R.None,this.childrenSashResetDisposable=R.None,this._boundarySashes={},this._edgeSnapping=!1,this._styles=i,this._size=o,this._orthogonalSize=n,this.element=B(".monaco-grid-branch-node"),!d)this.splitview=new $n(this.element,{orientation:e,styles:i,proportionalLayout:s}),this.splitview.layout(o,{orthogonalSize:n,absoluteOffset:0,absoluteOrthogonalOffset:0,absoluteSize:o,absoluteOrthogonalSize:n});else{const h={views:d.map(f=>({view:f.node,size:f.node.size,visible:f.visible!==!1})),size:this.orthogonalSize},p={proportionalLayout:s,orientation:e,styles:i};this.children=d.map(f=>f.node),this.splitview=new $n(this.element,{...p,descriptor:h}),this.children.forEach((f,g)=>{const m=g===0,v=g===this.children.length;f.boundarySashes={start:this.boundarySashes.orthogonalStart,end:this.boundarySashes.orthogonalEnd,orthogonalStart:m?this.boundarySashes.start:this.splitview.sashes[g-1],orthogonalEnd:v?this.boundarySashes.end:this.splitview.sashes[g]}})}const l=V.map(this.splitview.onDidSashReset,h=>[h]);this.splitviewSashResetDisposable=l(this._onDidSashReset.fire,this._onDidSashReset),this.updateChildrenEvents()}style(e){this._styles=e,this.splitview.style(e);for(const t of this.children)t instanceof Ee&&t.style(e)}layout(e,t,i){if(this.layoutController.isLayoutEnabled){if(typeof i>"u")throw new Error("Invalid state");this._size=i.orthogonalSize,this._orthogonalSize=e,this._absoluteOffset=i.absoluteOffset+t,this._absoluteOrthogonalOffset=i.absoluteOrthogonalOffset,this.absoluteOrthogonalSize=i.absoluteOrthogonalSize,this.splitview.layout(i.orthogonalSize,{orthogonalSize:e,absoluteOffset:this._absoluteOrthogonalOffset,absoluteOrthogonalOffset:this._absoluteOffset,absoluteSize:i.absoluteOrthogonalSize,absoluteOrthogonalSize:i.absoluteSize}),this.updateSplitviewEdgeSnappingEnablement()}}setVisible(e){for(const t of this.children)t.setVisible(e)}addChild(e,t,i,s){i=li(i,this.children.length),this.splitview.addView(e,t,i,s),this.children.splice(i,0,e),this.updateBoundarySashes(),this.onDidChildrenChange()}removeChild(e,t){e=li(e,this.children.length);const i=this.splitview.removeView(e,t);return this.children.splice(e,1),this.updateBoundarySashes(),this.onDidChildrenChange(),i}removeAllChildren(){const e=this.splitview.removeAllViews();return this.children.splice(0,this.children.length),this.updateBoundarySashes(),this.onDidChildrenChange(),e}moveChild(e,t){e=li(e,this.children.length),t=li(t,this.children.length),e!==t&&(e<t&&(t-=1),this.splitview.moveView(e,t),this.children.splice(t,0,this.children.splice(e,1)[0]),this.updateBoundarySashes(),this.onDidChildrenChange())}swapChildren(e,t){e=li(e,this.children.length),t=li(t,this.children.length),e!==t&&(this.splitview.swapViews(e,t),[this.children[e].boundarySashes,this.children[t].boundarySashes]=[this.children[e].boundarySashes,this.children[t].boundarySashes],[this.children[e],this.children[t]]=[this.children[t],this.children[e]],this.onDidChildrenChange())}resizeChild(e,t){e=li(e,this.children.length),this.splitview.resizeView(e,t)}isChildExpanded(e){return this.splitview.isViewExpanded(e)}distributeViewSizes(e=!1){if(this.splitview.distributeViewSizes(),e)for(const t of this.children)t instanceof Ee&&t.distributeViewSizes(!0)}getChildSize(e){return e=li(e,this.children.length),this.splitview.getViewSize(e)}isChildVisible(e){return e=li(e,this.children.length),this.splitview.isViewVisible(e)}setChildVisible(e,t){if(e=li(e,this.children.length),this.splitview.isViewVisible(e)===t)return;const i=this.splitview.contentSize===0;this.splitview.setViewVisible(e,t);const s=this.splitview.contentSize===0;(t&&i||!t&&s)&&this._onDidVisibilityChange.fire(t)}getChildCachedVisibleSize(e){return e=li(e,this.children.length),this.splitview.getViewCachedVisibleSize(e)}updateBoundarySashes(){for(let e=0;e<this.children.length;e++)this.children[e].boundarySashes={start:this.boundarySashes.orthogonalStart,end:this.boundarySashes.orthogonalEnd,orthogonalStart:e===0?this.boundarySashes.start:this.splitview.sashes[e-1],orthogonalEnd:e===this.children.length-1?this.boundarySashes.end:this.splitview.sashes[e]}}onDidChildrenChange(){this.updateChildrenEvents(),this._onDidChange.fire(void 0)}updateChildrenEvents(){const e=V.map(V.any(...this.children.map(s=>s.onDidChange)),()=>{});this.childrenChangeDisposable.dispose(),this.childrenChangeDisposable=e(this._onDidChange.fire,this._onDidChange);const t=V.any(...this.children.map((s,o)=>V.map(s.onDidSashReset,n=>[o,...n])));this.childrenSashResetDisposable.dispose(),this.childrenSashResetDisposable=t(this._onDidSashReset.fire,this._onDidSashReset);const i=V.any(V.signal(this.splitview.onDidScroll),...this.children.map(s=>s.onDidScroll));this.onDidScrollDisposable.dispose(),this.onDidScrollDisposable=i(this._onDidScroll.fire,this._onDidScroll),this.childrenVisibilityChangeDisposable.clear(),this.children.forEach((s,o)=>{s instanceof Ee&&this.childrenVisibilityChangeDisposable.add(s.onDidVisibilityChange(n=>{this.setChildVisible(o,n)}))})}trySet2x2(e){if(this.children.length!==2||e.children.length!==2)return R.None;if(this.getChildSize(0)!==e.getChildSize(0))return R.None;const[t,i]=this.children,[s,o]=e.children;if(!(t instanceof We)||!(i instanceof We))return R.None;if(!(s instanceof We)||!(o instanceof We))return R.None;this.orientation===J.VERTICAL?(i.linkedWidthNode=s.linkedHeightNode=t,t.linkedWidthNode=o.linkedHeightNode=i,o.linkedWidthNode=t.linkedHeightNode=s,s.linkedWidthNode=i.linkedHeightNode=o):(s.linkedWidthNode=i.linkedHeightNode=t,o.linkedWidthNode=t.linkedHeightNode=i,t.linkedWidthNode=o.linkedHeightNode=s,i.linkedWidthNode=s.linkedHeightNode=o);const n=this.splitview.sashes[0],r=e.splitview.sashes[0];return n.linkedSash=r,r.linkedSash=n,this._onDidChange.fire(void 0),e._onDidChange.fire(void 0),ae(()=>{n.linkedSash=r.linkedSash=void 0,t.linkedHeightNode=t.linkedWidthNode=void 0,i.linkedHeightNode=i.linkedWidthNode=void 0,s.linkedHeightNode=s.linkedWidthNode=void 0,o.linkedHeightNode=o.linkedWidthNode=void 0})}updateSplitviewEdgeSnappingEnablement(){this.splitview.startSnappingEnabled=this._edgeSnapping||this._absoluteOrthogonalOffset>0,this.splitview.endSnappingEnabled=this._edgeSnapping||this._absoluteOrthogonalOffset+this._size<this.absoluteOrthogonalSize}dispose(){for(const e of this.children)e.dispose();this._onDidChange.dispose(),this._onDidSashReset.dispose(),this._onDidVisibilityChange.dispose(),this.childrenVisibilityChangeDisposable.dispose(),this.splitviewSashResetDisposable.dispose(),this.childrenSashResetDisposable.dispose(),this.childrenChangeDisposable.dispose(),this.onDidScrollDisposable.dispose(),this.splitview.dispose()}}function pA(a){const[e,t]=V.split(a.onDidChange,mn);return V.any(t,V.map(V.latch(V.map(e,i=>[a.minimumWidth,a.maximumWidth,a.minimumHeight,a.maximumHeight]),Js),i=>{}))}class We{get size(){return this._size}get orthogonalSize(){return this._orthogonalSize}get linkedWidthNode(){return this._linkedWidthNode}set linkedWidthNode(e){this._onDidLinkedWidthNodeChange.input=e?e._onDidViewChange:V.None,this._linkedWidthNode=e,this._onDidSetLinkedNode.fire(void 0)}get linkedHeightNode(){return this._linkedHeightNode}set linkedHeightNode(e){this._onDidLinkedHeightNodeChange.input=e?e._onDidViewChange:V.None,this._linkedHeightNode=e,this._onDidSetLinkedNode.fire(void 0)}constructor(e,t,i,s,o=0){this.view=e,this.orientation=t,this.layoutController=i,this._size=0,this.absoluteOffset=0,this.absoluteOrthogonalOffset=0,this.onDidScroll=V.None,this.onDidSashReset=V.None,this._onDidLinkedWidthNodeChange=new _s,this._linkedWidthNode=void 0,this._onDidLinkedHeightNodeChange=new _s,this._linkedHeightNode=void 0,this._onDidSetLinkedNode=new E,this.disposables=new O,this._boundarySashes={},this.cachedWidth=0,this.cachedHeight=0,this.cachedTop=0,this.cachedLeft=0,this._orthogonalSize=s,this._size=o;const n=pA(e);this._onDidViewChange=V.map(n,r=>r&&(this.orientation===J.VERTICAL?r.width:r.height),this.disposables),this.onDidChange=V.any(this._onDidViewChange,this._onDidSetLinkedNode.event,this._onDidLinkedWidthNodeChange.event,this._onDidLinkedHeightNodeChange.event)}get width(){return this.orientation===J.HORIZONTAL?this.orthogonalSize:this.size}get height(){return this.orientation===J.HORIZONTAL?this.size:this.orthogonalSize}get top(){return this.orientation===J.HORIZONTAL?this.absoluteOffset:this.absoluteOrthogonalOffset}get left(){return this.orientation===J.HORIZONTAL?this.absoluteOrthogonalOffset:this.absoluteOffset}get element(){return this.view.element}get minimumWidth(){return this.linkedWidthNode?Math.max(this.linkedWidthNode.view.minimumWidth,this.view.minimumWidth):this.view.minimumWidth}get maximumWidth(){return this.linkedWidthNode?Math.min(this.linkedWidthNode.view.maximumWidth,this.view.maximumWidth):this.view.maximumWidth}get minimumHeight(){return this.linkedHeightNode?Math.max(this.linkedHeightNode.view.minimumHeight,this.view.minimumHeight):this.view.minimumHeight}get maximumHeight(){return this.linkedHeightNode?Math.min(this.linkedHeightNode.view.maximumHeight,this.view.maximumHeight):this.view.maximumHeight}get minimumSize(){return this.orientation===J.HORIZONTAL?this.minimumHeight:this.minimumWidth}get maximumSize(){return this.orientation===J.HORIZONTAL?this.maximumHeight:this.maximumWidth}get priority(){return this.view.priority}get proportionalLayout(){return this.view.proportionalLayout??!0}get snap(){return this.view.snap}get minimumOrthogonalSize(){return this.orientation===J.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maximumOrthogonalSize(){return this.orientation===J.HORIZONTAL?this.maximumWidth:this.maximumHeight}get boundarySashes(){return this._boundarySashes}set boundarySashes(e){this._boundarySashes=e,this.view.setBoundarySashes?.(hA(e,this.orientation))}layout(e,t,i){if(this.layoutController.isLayoutEnabled){if(typeof i>"u")throw new Error("Invalid state");this._size=e,this._orthogonalSize=i.orthogonalSize,this.absoluteOffset=i.absoluteOffset+t,this.absoluteOrthogonalOffset=i.absoluteOrthogonalOffset,this._layout(this.width,this.height,this.top,this.left)}}_layout(e,t,i,s){this.cachedWidth===e&&this.cachedHeight===t&&this.cachedTop===i&&this.cachedLeft===s||(this.cachedWidth=e,this.cachedHeight=t,this.cachedTop=i,this.cachedLeft=s,this.view.layout(e,t,i,s))}setVisible(e){this.view.setVisible?.(e)}dispose(){this.disposables.dispose()}}function $w(a,e,t){if(a instanceof Ee){const i=new Ee(Vi(a.orientation),a.layoutController,a.styles,a.splitviewProportionalLayout,e,t,a.edgeSnapping);let s=0;for(let o=a.children.length-1;o>=0;o--){const n=a.children[o],r=n instanceof Ee?n.orthogonalSize:n.size;let d=a.size===0?0:Math.round(e*r/a.size);s+=d,o===0&&(d+=e-s),i.addChild($w(n,t,d),d,0,!0)}return a.dispose(),i}else{const i=new We(a.view,Vi(a.orientation),a.layoutController,t);return a.dispose(),i}}class Lo{get root(){return this._root}set root(e){const t=this._root;t&&(t.element.remove(),t.dispose()),this._root=e,this.element.appendChild(e.element),this.onDidSashResetRelay.input=e.onDidSashReset,this._onDidChange.input=V.map(e.onDidChange,()=>{}),this._onDidScroll.input=e.onDidScroll}get width(){return this.root.width}get height(){return this.root.height}get minimumWidth(){return this.root.minimumWidth}get minimumHeight(){return this.root.minimumHeight}get maximumWidth(){return this.root.maximumHeight}get maximumHeight(){return this.root.maximumHeight}get orientation(){return this._root.orientation}get boundarySashes(){return this._boundarySashes}set orientation(e){if(this._root.orientation===e)return;const{size:t,orthogonalSize:i,absoluteOffset:s,absoluteOrthogonalOffset:o}=this._root;this.root=$w(this._root,i,t),this.root.layout(t,0,{orthogonalSize:i,absoluteOffset:o,absoluteOrthogonalOffset:s,absoluteSize:t,absoluteOrthogonalSize:i}),this.boundarySashes=this.boundarySashes}set boundarySashes(e){this._boundarySashes=e,this.root.boundarySashes=uA(e,this.orientation)}set edgeSnapping(e){this.root.edgeSnapping=e}constructor(e={}){this.onDidSashResetRelay=new _s,this._onDidScroll=new _s,this._onDidChange=new _s,this._boundarySashes={},this.disposable2x2=R.None,this.onDidSashReset=this.onDidSashResetRelay.event,this.onDidScroll=this._onDidScroll.event,this.onDidChange=this._onDidChange.event,this.maximizedNode=void 0,this._onDidChangeViewMaximized=new E,this.onDidChangeViewMaximized=this._onDidChangeViewMaximized.event,this.element=B(".monaco-grid-view"),this.styles=e.styles||cA,this.proportionalLayout=typeof e.proportionalLayout<"u"?!!e.proportionalLayout:!0,this.layoutController=new lA(!1),this.root=new Ee(J.VERTICAL,this.layoutController,this.styles,this.proportionalLayout)}style(e){this.styles=e,this.root.style(e)}layout(e,t,i=0,s=0){this.layoutController.isLayoutEnabled=!0;const[o,n,r,d]=this.root.orientation===J.HORIZONTAL?[t,e,i,s]:[e,t,s,i];this.root.layout(o,0,{orthogonalSize:n,absoluteOffset:r,absoluteOrthogonalOffset:d,absoluteSize:o,absoluteOrthogonalSize:n})}addView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView(),this.disposable2x2.dispose(),this.disposable2x2=R.None;const[s,o]=Ne(i),[n,r]=this.getNode(s);if(r instanceof Ee){const d=new We(e,Vi(r.orientation),this.layoutController,r.orthogonalSize);try{r.addChild(d,t,o)}catch(l){throw d.dispose(),l}}else{const[,d]=Ne(n),[,l]=Ne(s);let h=0;const p=d.getChildCachedVisibleSize(l);typeof p=="number"&&(h=Gt.Invisible(p)),d.removeChild(l).dispose();const g=new Ee(r.orientation,r.layoutController,this.styles,this.proportionalLayout,r.size,r.orthogonalSize,d.edgeSnapping);d.addChild(g,r.size,l);const m=new We(r.view,d.orientation,this.layoutController,r.size);g.addChild(m,h,0),typeof t!="number"&&t.type==="split"&&(t=Gt.Split(0));const v=new We(e,d.orientation,this.layoutController,r.size);g.addChild(v,t,o)}this.trySet2x2()}removeView(e,t){this.hasMaximizedView()&&this.exitMaximizedView(),this.disposable2x2.dispose(),this.disposable2x2=R.None;const[i,s]=Ne(e),[o,n]=this.getNode(i);if(!(n instanceof Ee))throw new Error("Invalid location");const r=n.children[s];if(!(r instanceof We))throw new Error("Invalid location");if(n.removeChild(s,t),r.dispose(),n.children.length===0)throw new Error("Invalid grid state");if(n.children.length>1)return this.trySet2x2(),r.view;if(o.length===0){const g=n.children[0];return g instanceof We||(n.removeChild(0),n.dispose(),this.root=g,this.boundarySashes=this.boundarySashes,this.trySet2x2()),r.view}const[,d]=Ne(o),[,l]=Ne(i),h=n.isChildVisible(0),p=n.removeChild(0),f=d.children.map((g,m)=>d.getChildSize(m));if(d.removeChild(l,t),n.dispose(),p instanceof Ee){f.splice(l,1,...p.children.map(m=>m.size));const g=p.removeAllChildren();for(let m=0;m<g.length;m++)d.addChild(g[m],g[m].size,l+m)}else{const g=new We(p.view,Vi(p.orientation),this.layoutController,p.size),m=h?p.orthogonalSize:Gt.Invisible(p.orthogonalSize);d.addChild(g,m,l)}p.dispose();for(let g=0;g<f.length;g++)d.resizeChild(g,f[g]);return this.trySet2x2(),r.view}moveView(e,t,i){this.hasMaximizedView()&&this.exitMaximizedView();const[,s]=this.getNode(e);if(!(s instanceof Ee))throw new Error("Invalid location");s.moveChild(t,i),this.trySet2x2()}swapViews(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,s]=Ne(e),[,o]=this.getNode(i);if(!(o instanceof Ee))throw new Error("Invalid from location");const n=o.getChildSize(s),r=o.children[s];if(!(r instanceof We))throw new Error("Invalid from location");const[d,l]=Ne(t),[,h]=this.getNode(d);if(!(h instanceof Ee))throw new Error("Invalid to location");const p=h.getChildSize(l),f=h.children[l];if(!(f instanceof We))throw new Error("Invalid to location");o===h?o.swapChildren(s,l):(o.removeChild(s),h.removeChild(l),o.addChild(f,n,s),h.addChild(r,p,l)),this.trySet2x2()}resizeView(e,t){this.hasMaximizedView()&&this.exitMaximizedView();const[i,s]=Ne(e),[o,n]=this.getNode(i);if(!(n instanceof Ee))throw new Error("Invalid location");if(!t.width&&!t.height)return;const[r,d]=n.orientation===J.HORIZONTAL?[t.width,t.height]:[t.height,t.width];if(typeof d=="number"&&o.length>0){const[,l]=Ne(o),[,h]=Ne(i);l.resizeChild(h,d)}typeof r=="number"&&n.resizeChild(s,r),this.trySet2x2()}getViewSize(e){if(!e)return{width:this.root.width,height:this.root.height};const[,t]=this.getNode(e);return{width:t.width,height:t.height}}getViewCachedVisibleSize(e){const[t,i]=Ne(e),[,s]=this.getNode(t);if(!(s instanceof Ee))throw new Error("Invalid location");return s.getChildCachedVisibleSize(i)}expandView(e){this.hasMaximizedView()&&this.exitMaximizedView();const[t,i]=this.getNode(e);if(!(i instanceof We))throw new Error("Invalid location");for(let s=0;s<t.length;s++)t[s].resizeChild(e[s],Number.POSITIVE_INFINITY)}isViewExpanded(e){if(this.hasMaximizedView())return!1;const[t,i]=this.getNode(e);if(!(i instanceof We))throw new Error("Invalid location");for(let s=0;s<t.length;s++)if(!t[s].isChildExpanded(e[s]))return!1;return!0}maximizeView(e){const[,t]=this.getNode(e);if(!(t instanceof We))throw new Error("Location is not a LeafNode");if(this.maximizedNode===t)return;this.hasMaximizedView()&&this.exitMaximizedView();function i(s,o){for(let n=0;n<s.children.length;n++){const r=s.children[n];r instanceof We?r!==o&&s.setChildVisible(n,!1):i(r,o)}}i(this.root,t),this.maximizedNode=t,this._onDidChangeViewMaximized.fire(!0)}exitMaximizedView(){if(!this.maximizedNode)return;this.maximizedNode=void 0;function e(t){for(let i=t.children.length-1;i>=0;i--){const s=t.children[i];s instanceof We?t.setChildVisible(i,!0):e(s)}}e(this.root),this._onDidChangeViewMaximized.fire(!1)}hasMaximizedView(){return this.maximizedNode!==void 0}isViewMaximized(e){const[,t]=this.getNode(e);if(!(t instanceof We))throw new Error("Location is not a LeafNode");return t===this.maximizedNode}distributeViewSizes(e){if(this.hasMaximizedView()&&this.exitMaximizedView(),!e){this.root.distributeViewSizes(!0);return}const[,t]=this.getNode(e);if(!(t instanceof Ee))throw new Error("Invalid location");t.distributeViewSizes(),this.trySet2x2()}isViewVisible(e){const[t,i]=Ne(e),[,s]=this.getNode(t);if(!(s instanceof Ee))throw new Error("Invalid from location");return s.isChildVisible(i)}setViewVisible(e,t){if(this.hasMaximizedView()){this.exitMaximizedView();return}const[i,s]=Ne(e),[,o]=this.getNode(i);if(!(o instanceof Ee))throw new Error("Invalid from location");o.setChildVisible(s,t)}getView(e){const t=e?this.getNode(e)[1]:this._root;return this._getViews(t,this.orientation)}static deserialize(e,t,i={}){if(typeof e.orientation!="number")throw new Error("Invalid JSON: 'orientation' property must be a number.");if(typeof e.width!="number")throw new Error("Invalid JSON: 'width' property must be a number.");if(typeof e.height!="number")throw new Error("Invalid JSON: 'height' property must be a number.");if(e.root?.type!=="branch")throw new Error("Invalid JSON: 'root' property must have 'type' value of branch.");const s=e.orientation,o=e.height,n=new Lo(i);return n._deserialize(e.root,s,t,o),n}_deserialize(e,t,i,s){this.root=this._deserializeNode(e,t,i,s)}_deserializeNode(e,t,i,s){let o;if(e.type==="branch"){const r=e.data.map(d=>({node:this._deserializeNode(d,Vi(t),i,e.size),visible:d.visible}));o=new Ee(t,this.layoutController,this.styles,this.proportionalLayout,e.size,s,void 0,r)}else o=new We(i.fromJSON(e.data),t,this.layoutController,s,e.size),e.maximized&&!this.maximizedNode&&(this.maximizedNode=o,this._onDidChangeViewMaximized.fire(!0));return o}_getViews(e,t,i){const s={top:e.top,left:e.left,width:e.width,height:e.height};if(e instanceof We)return{view:e.view,box:s,cachedVisibleSize:i,maximized:this.maximizedNode===e};const o=[];for(let n=0;n<e.children.length;n++){const r=e.children[n],d=e.getChildCachedVisibleSize(n);o.push(this._getViews(r,Vi(t),d))}return{children:o,box:s}}getNode(e,t=this.root,i=[]){if(e.length===0)return[i,t];if(!(t instanceof Ee))throw new Error("Invalid location");const[s,...o]=e;if(s<0||s>=t.children.length)throw new Error("Invalid location");const n=t.children[s];return i.push(t),this.getNode(o,n,i)}trySet2x2(){if(this.disposable2x2.dispose(),this.disposable2x2=R.None,this.root.children.length!==2)return;const[e,t]=this.root.children;!(e instanceof Ee)||!(t instanceof Ee)||(this.disposable2x2=e.trySet2x2(t))}getViewMap(e,t){t||(t=this.root),t instanceof Ee?t.children.forEach(i=>this.getViewMap(e,i)):e.set(t.view,t.element)}dispose(){this.onDidSashResetRelay.dispose(),this.root.dispose(),this.element.remove()}}Pe(zw);var de;(function(a){a[a.Up=0]="Up",a[a.Down=1]="Down",a[a.Left=2]="Left",a[a.Right=3]="Right"})(de||(de={}));function gA(a){switch(a){case de.Up:return de.Down;case de.Down:return de.Up;case de.Left:return de.Right;case de.Right:return de.Left}}function $s(a){return!!a.children}function jw(a,e){if(e.length===0)return a;if(!$s(a))throw new Error("Invalid location");const[t,...i]=e;return jw(a.children[t],i)}function fA(a,e){return!(a.start>=e.end||e.start>=a.end)}function qw(a,e){const t=Gu(e),i=e===de.Up?a.top:e===de.Right?a.left+a.width:e===de.Down?a.top+a.height:a.left,s={start:t===J.HORIZONTAL?a.top:a.left,end:t===J.HORIZONTAL?a.top+a.height:a.left+a.width};return{offset:i,range:s}}function mA(a,e,t){const i=[];function s(o,n,r){if($s(o))for(const d of o.children)s(d,n,r);else{const{offset:d,range:l}=qw(o.box,n);d===r.offset&&fA(l,r.range)&&i.push(o)}}return s(a,e,t),i}function ol(a,e){return e.length%2===0?Vi(a):a}function Gu(a){return a===de.Up||a===de.Down?J.VERTICAL:J.HORIZONTAL}function kg(a,e,t){const i=ol(a,e),s=Gu(t);if(i===s){let[o,n]=Ne(e);return(t===de.Right||t===de.Down)&&(n+=1),[...o,n]}else{const o=t===de.Right||t===de.Down?1:0;return[...e,o]}}function wA(a){const e=a.parentElement;if(!e)throw new Error("Invalid grid element");let t=e.firstElementChild,i=0;for(;t!==a&&t!==e.lastElementChild&&t;)t=t.nextElementSibling,i++;return i}function Yw(a){const e=a.parentElement;if(!e)throw new Error("Invalid grid element");if(/\bmonaco-grid-view\b/.test(e.className))return[];const t=wA(e),i=e.parentElement.parentElement.parentElement.parentElement;return[...Yw(i),t]}var Vo;(function(a){a.Distribute={type:"distribute"},a.Split={type:"split"},a.Auto={type:"auto"};function e(t){return{type:"invisible",cachedVisibleSize:t}}a.Invisible=e})(Vo||(Vo={}));class yA extends R{get orientation(){return this.gridview.orientation}set orientation(e){this.gridview.orientation=e}get width(){return this.gridview.width}get height(){return this.gridview.height}get minimumWidth(){return this.gridview.minimumWidth}get minimumHeight(){return this.gridview.minimumHeight}get maximumWidth(){return this.gridview.maximumWidth}get maximumHeight(){return this.gridview.maximumHeight}get boundarySashes(){return this.gridview.boundarySashes}set boundarySashes(e){this.gridview.boundarySashes=e}set edgeSnapping(e){this.gridview.edgeSnapping=e}get element(){return this.gridview.element}constructor(e,t={}){super(),this.views=new Map,this.didLayout=!1,e instanceof Lo?(this.gridview=e,this.gridview.getViewMap(this.views)):this.gridview=new Lo(t),this._register(this.gridview),this._register(this.gridview.onDidSashReset(this.onDidSashReset,this)),e instanceof Lo||this._addView(e,0,[0]),this.onDidChange=this.gridview.onDidChange,this.onDidScroll=this.gridview.onDidScroll,this.onDidChangeViewMaximized=this.gridview.onDidChangeViewMaximized}style(e){this.gridview.style(e)}layout(e,t,i=0,s=0){this.gridview.layout(e,t,i,s),this.didLayout=!0}addView(e,t,i,s){if(this.views.has(e))throw new Error("Can't add same view twice");const o=Gu(s);this.views.size===1&&this.orientation!==o&&(this.orientation=o);const n=this.getViewLocation(i),r=kg(this.gridview.orientation,n,s);let d;if(typeof t=="number")d=t;else if(t.type==="split"){const[,l]=Ne(n);d=Gt.Split(l)}else if(t.type==="distribute")d=Gt.Distribute;else if(t.type==="auto"){const[,l]=Ne(n);d=Gt.Auto(l)}else d=t;this._addView(e,d,r)}addViewAt(e,t,i){if(this.views.has(e))throw new Error("Can't add same view twice");let s;typeof t=="number"?s=t:t.type==="distribute"?s=Gt.Distribute:s=t,this._addView(e,s,i)}_addView(e,t,i){this.views.set(e,e.element),this.gridview.addView(e,t,i)}removeView(e,t){if(this.views.size===1)throw new Error("Can't remove last view");const i=this.getViewLocation(e);let s;if(t?.type==="distribute")s=Gt.Distribute;else if(t?.type==="auto"){const o=i[i.length-1];s=Gt.Auto(o===0?1:o-1)}this.gridview.removeView(i,s),this.views.delete(e)}moveView(e,t,i,s){const o=this.getViewLocation(e),[n,r]=Ne(o),d=this.getViewLocation(i),l=kg(this.gridview.orientation,d,s),[h,p]=Ne(l);Js(n,h)?this.gridview.moveView(n,r,p):(this.removeView(e,typeof t=="number"?void 0:t),this.addView(e,t,i,s))}moveViewTo(e,t){const i=this.getViewLocation(e),[s,o]=Ne(i),[n,r]=Ne(t);if(Js(s,n))this.gridview.moveView(s,o,r);else{const d=this.getViewSize(e),l=ol(this.gridview.orientation,i),h=this.getViewCachedVisibleSize(e),p=typeof h>"u"?l===J.HORIZONTAL?d.width:d.height:Vo.Invisible(h);this.removeView(e),this.addViewAt(e,p,t)}}swapViews(e,t){const i=this.getViewLocation(e),s=this.getViewLocation(t);return this.gridview.swapViews(i,s)}resizeView(e,t){const i=this.getViewLocation(e);return this.gridview.resizeView(i,t)}isViewExpanded(e){const t=this.getViewLocation(e);return this.gridview.isViewExpanded(t)}isViewMaximized(e){const t=this.getViewLocation(e);return this.gridview.isViewMaximized(t)}hasMaximizedView(){return this.gridview.hasMaximizedView()}getViewSize(e){if(!e)return this.gridview.getViewSize();const t=this.getViewLocation(e);return this.gridview.getViewSize(t)}getViewCachedVisibleSize(e){const t=this.getViewLocation(e);return this.gridview.getViewCachedVisibleSize(t)}maximizeView(e){if(this.views.size<2)throw new Error("At least two views are required to maximize a view");const t=this.getViewLocation(e);this.gridview.maximizeView(t)}exitMaximizedView(){this.gridview.exitMaximizedView()}expandView(e){const t=this.getViewLocation(e);this.gridview.expandView(t)}distributeViewSizes(){this.gridview.distributeViewSizes()}isViewVisible(e){const t=this.getViewLocation(e);return this.gridview.isViewVisible(t)}setViewVisible(e,t){const i=this.getViewLocation(e);this.gridview.setViewVisible(i,t)}getViews(){return this.gridview.getView()}getNeighborViews(e,t,i=!1){if(!this.didLayout)throw new Error("Can't call getNeighborViews before first layout");const s=this.getViewLocation(e),o=this.getViews(),n=jw(o,s);let r=qw(n.box,t);return i&&(t===de.Up&&n.box.top===0?r={offset:o.box.top+o.box.height,range:r.range}:t===de.Right&&n.box.left+n.box.width===o.box.width?r={offset:0,range:r.range}:t===de.Down&&n.box.top+n.box.height===o.box.height?r={offset:0,range:r.range}:t===de.Left&&n.box.left===0&&(r={offset:o.box.left+o.box.width,range:r.range})),mA(o,gA(t),r).map(d=>d.view)}getViewLocation(e){const t=this.views.get(e);if(!t)throw new Error("View not found");return Yw(t)}onDidSashReset(e){const t=o=>{const n=this.gridview.getView(o);if($s(n))return!1;const r=ol(this.orientation,o),d=r===J.HORIZONTAL?n.view.preferredWidth:n.view.preferredHeight;if(typeof d!="number")return!1;const l=r===J.HORIZONTAL?{width:Math.round(d)}:{height:Math.round(d)};return this.gridview.resizeView(o,l),!0};if(t(e))return;const[i,s]=Ne(e);t([...i,s+1])||this.gridview.distributeViewSizes(i)}}class Ss extends yA{constructor(){super(...arguments),this.initialLayoutContext=!0}static serializeNode(e,t){const i=t===J.VERTICAL?e.box.width:e.box.height;if(!$s(e)){const o={type:"leaf",data:e.view.toJSON(),size:i};return typeof e.cachedVisibleSize=="number"?(o.size=e.cachedVisibleSize,o.visible=!1):e.maximized&&(o.maximized=!0),o}const s=e.children.map(o=>Ss.serializeNode(o,Vi(t)));return s.some(o=>o.visible!==!1)?{type:"branch",data:s,size:i}:{type:"branch",data:s,size:i,visible:!1}}static deserialize(e,t,i={}){if(typeof e.orientation!="number")throw new Error("Invalid JSON: 'orientation' property must be a number.");if(typeof e.width!="number")throw new Error("Invalid JSON: 'width' property must be a number.");if(typeof e.height!="number")throw new Error("Invalid JSON: 'height' property must be a number.");const s=Lo.deserialize(e,t,i);return new Ss(s,i)}static from(e,t={}){return Ss.deserialize(ey(e),{fromJSON:i=>i},t)}serialize(){return{root:Ss.serializeNode(this.getViews(),this.orientation),orientation:this.orientation,width:this.width,height:this.height}}layout(e,t,i=0,s=0){super.layout(e,t,i,s),this.initialLayoutContext&&(this.initialLayoutContext=!1,this.gridview.trySet2x2())}}function Jw(a){return!!a.groups}function Zw(a,e){if(!e&&a.groups&&a.groups.length<=1&&(a.groups=void 0),!Jw(a))return;let t=0,i=0;for(const r of a.groups)Zw(r,!1),r.size&&(t+=r.size,i++);const s=i>0?t:1,o=a.groups.length-i,n=s/o;for(const r of a.groups)r.size||(r.size=n)}function Xw(a){return Jw(a)?{type:"branch",data:a.groups.map(e=>Xw(e)),size:a.size}:{type:"leaf",data:a.data,size:a.size}}function Qw(a,e){if(a.type==="branch"){const t=a.data.map(i=>Qw(i,Vi(e)));if(e===J.VERTICAL){const i=a.size||(t.length===0?void 0:Math.max(...t.map(o=>o.width||0))),s=t.length===0?void 0:t.reduce((o,n)=>o+(n.height||0),0);return{width:i,height:s}}else{const i=t.length===0?void 0:t.reduce((o,n)=>o+(n.width||0),0),s=a.size||(t.length===0?void 0:Math.max(...t.map(o=>o.height||0)));return{width:i,height:s}}}else{const t=e===J.VERTICAL?a.size:void 0,i=e===J.VERTICAL?void 0:a.size;return{width:t,height:i}}}function ey(a){Zw(a,!0);const e=Xw(a),{width:t,height:i}=Qw(e,a.orientation);return{root:e,orientation:a.orientation,width:t||1,height:i||1}}const vA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let nl=class extends uS{constructor(e,t,i,s,o,n,r,d){super(e,t,o,i),this.storageService=i,this.instantiationService=s,this.contextMenuService=n,this.extensionService=r,this.contextService=d}create(e){super.create(e),this.viewPaneContainer=this._register(this.createViewPaneContainer(e)),this._register(this.viewPaneContainer.onTitleAreaUpdate(()=>this.updateTitleArea())),this.viewPaneContainer.create(e)}setVisible(e){super.setVisible(e),this.viewPaneContainer?.setVisible(e)}layout(e){this.viewPaneContainer?.layout(e)}setBoundarySashes(e){this.viewPaneContainer?.setBoundarySashes(e)}getOptimalWidth(){return this.viewPaneContainer?.getOptimalWidth()??0}openView(e,t){return this.viewPaneContainer?.openView(e,t)}getViewPaneContainer(){return this.viewPaneContainer}getActionsContext(){return this.getViewPaneContainer()?.getActionsContext()}getContextMenuActions(){return this.viewPaneContainer?.menuActions?.getContextMenuActions()??[]}getMenuIds(){const e=[];return this.viewPaneContainer?.menuActions&&(e.push(this.viewPaneContainer.menuActions.menuId),this.viewPaneContainer.isViewMergedWithContainer()&&e.push(this.viewPaneContainer.panes[0].menuActions.menuId)),e}getActions(){const e=[];if(this.viewPaneContainer?.menuActions&&(e.push(...this.viewPaneContainer.menuActions.getPrimaryActions()),this.viewPaneContainer.isViewMergedWithContainer())){const t=this.viewPaneContainer.panes[0];t.shouldShowFilterInHeader()&&e.push(pS),e.push(...t.menuActions.getPrimaryActions())}return e}getSecondaryActions(){if(!this.viewPaneContainer?.menuActions)return[];const e=this.viewPaneContainer.isViewMergedWithContainer()?this.viewPaneContainer.panes[0].menuActions.getSecondaryActions():[];let t=this.viewPaneContainer.menuActions.getSecondaryActions();const i=t.findIndex(s=>s instanceof Hy&&s.item.submenu===Iu);if(i!==-1){const s=t[i];s.actions.some(({enabled:o})=>o)?t.length===1&&e.length===0?t=s.actions.slice():i!==0&&(t=[s,...t.slice(0,i),...t.slice(i+1)]):t.splice(i,1)}return t.length&&e.length?[...t,new ss,...e]:t.length?t:e}getActionViewItem(e,t){return this.viewPaneContainer?.getActionViewItem(e,t)}getTitle(){return this.viewPaneContainer?.getTitle()??""}focus(){super.focus(),this.viewPaneContainer?.focus()}};nl=D([u(1,mt),u(2,ce),u(3,F),u(4,me),u(5,at),u(6,kt),u(7,us)],nl);class Uu extends hS{static create(e,t,i,s,o,n,r){return new Uu(e,t,i,s,o,n,r)}constructor(e,t,i,s,o,n,r){super(e,t,i,s,o,n),this.iconUrl=r}}const Oi={Viewlets:"workbench.contributions.viewlets",Panels:"workbench.contributions.panels",Auxiliary:"workbench.contributions.auxiliary"};class Hu extends gS{registerPaneComposite(e){super.registerComposite(e)}deregisterPaneComposite(e){super.deregisterComposite(e)}getPaneComposite(e){return this.getComposite(e)}getPaneComposites(){return this.getComposites()}}H.add(Oi.Viewlets,new Hu);H.add(Oi.Panels,new Hu);H.add(Oi.Auxiliary,new Hu);const bA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Pe(bA);class CA extends lm{constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b,A){super(b,A,d,t,s),this.notificationService=e,this.storageService=t,this.contextMenuService=i,this.keybindingService=o,this.hoverService=n,this.instantiationService=r,this.registry=l,this.activeCompositeSettingsKey=h,this.defaultCompositeId=p,this.nameForTelemetry=f,this.compositeCSSClass=g,this.titleForegroundColor=m,this.titleBorderColor=v,this.onDidCompositeOpen=this._register(new E),this.onDidCompositeClose=this._register(new E),this.mapCompositeToCompositeContainer=new Map,this.mapActionsBindingToComposite=new Map,this.instantiatedCompositeItems=new Map,this.actionsListener=this._register(new Ie),this.lastActiveCompositeId=t.get(h,G.WORKSPACE,this.defaultCompositeId),this.toolbarHoverDelegate=this._register(zy())}openComposite(e,t){if(this.activeComposite?.getId()===e)return t&&this.activeComposite.focus(),this.activeComposite;if(this.element)return this.doOpenComposite(e,t)}doOpenComposite(e,t=!1){const i=$y.nextId();this.currentCompositeOpenToken=i,this.activeComposite&&this.hideActiveComposite(),this.updateTitle(e);const s=this.createComposite(e,!0);if(!(this.currentCompositeOpenToken!==i||this.activeComposite&&this.activeComposite.getId()!==s.getId()))return this.activeComposite?.getId()===s.getId()?(t&&s.focus(),this.onDidCompositeOpen.fire({composite:s,focus:t}),s):(this.showComposite(s),t&&s.focus(),s&&this.onDidCompositeOpen.fire({composite:s,focus:t}),s)}createComposite(e,t){const i=this.instantiatedCompositeItems.get(e);if(i)return i.composite;const s=this.registry.getComposite(e);if(s){const o=this,n=new fS(Se(this.progressBar),new class extends mS{constructor(){super(s.id,!!t),this._register(o.onDidCompositeOpen.event(h=>this.onScopeOpened(h.composite.getId()))),this._register(o.onDidCompositeClose.event(h=>this.onScopeClosed(h.getId())))}}),r=this._register(this.instantiationService.createChild(new hd([jy,n]))),d=s.instantiate(r),l=new O;return this.instantiatedCompositeItems.set(e,{composite:d,disposable:l,progress:n}),l.add(d.onTitleAreaUpdate(()=>this.onTitleAreaUpdate(d.getId()),this)),l.add(r),d}throw new Error(`Unable to find composite with id ${e}`)}showComposite(e){this.activeComposite=e;const t=this.activeComposite.getId();t!==this.defaultCompositeId?this.storageService.store(this.activeCompositeSettingsKey,t,G.WORKSPACE,Re.MACHINE):this.storageService.remove(this.activeCompositeSettingsKey,G.WORKSPACE),this.lastActiveCompositeId=this.activeComposite.getId();let i=this.mapCompositeToCompositeContainer.get(e.getId());if(i||(i=B(".composite"),i.classList.add(...this.compositeCSSClass.split(" ")),i.id=e.getId(),e.create(i),e.updateStyles(),this.mapCompositeToCompositeContainer.set(e.getId(),i)),!this.activeComposite||e.getId()!==this.activeComposite.getId())return;this.getContentArea()?.appendChild(i),jn(i);const o=Se(this.toolBar);o.actionRunner=e.getActionRunner();const n=this.registry.getComposite(e.getId());n&&n.name!==e.getTitle()&&this.updateTitle(e.getId(),e.getTitle());let r=this.mapActionsBindingToComposite.get(e.getId());r||(r=this.collectCompositeActions(e),this.mapActionsBindingToComposite.set(e.getId(),r)),r(),this.actionsListener.value=o.actionRunner.onDidRun(d=>{d.error&&!ud(d.error)&&this.notificationService.error(d.error)}),e.setVisible(!0),!(!this.activeComposite||e.getId()!==this.activeComposite.getId())&&(this.contentAreaSize&&e.layout(this.contentAreaSize),this.boundarySashes&&e.setBoundarySashes(this.boundarySashes))}onTitleAreaUpdate(e){const t=this.instantiatedCompositeItems.get(e);if(t&&this.updateTitle(e,t.composite.getTitle()),this.activeComposite?.getId()===e){const i=this.collectCompositeActions(this.activeComposite);this.mapActionsBindingToComposite.set(this.activeComposite.getId(),i),i()}else this.mapActionsBindingToComposite.delete(e)}updateTitle(e,t){const i=this.registry.getComposite(e);if(!i||!this.titleLabel)return;t||(t=i.name);const s=this.keybindingService.lookupKeybinding(e);this.titleLabel.updateTitle(e,t,s?.getLabel()??void 0),Se(this.toolBar).setAriaLabel(c(2875,"{0} actions",t))}collectCompositeActions(e){const t=e?.getMenuIds(),i=e?.getActions().slice(0)||[],s=e?.getSecondaryActions().slice(0)||[],o=Se(this.toolBar);return o.context=this.actionsContextProvider(),()=>o.setActions(Po(i),Po(s),t)}getActiveComposite(){return this.activeComposite}getLastActiveCompositeId(){return this.lastActiveCompositeId}hideActiveComposite(){if(!this.activeComposite)return;const e=this.activeComposite;this.activeComposite=void 0;const t=this.mapCompositeToCompositeContainer.get(e.getId());return e.setVisible(!1),t&&(t.remove(),qn(t)),this.progressBar?.stop().hide(),this.toolBar&&this.collectCompositeActions()(),this.onDidCompositeClose.fire(e),e}createTitleArea(e){const t=ge(e,B(".composite"));t.classList.add("title"),this.titleLabel=this.createTitleLabel(t);const i=ge(t,B(".title-actions"));return this.toolBar=this._register(this.instantiationService.createInstance(Wu,i,{actionViewItemProvider:(s,o)=>this.actionViewItemProvider(s,o),orientation:Zs.HORIZONTAL,getKeyBinding:s=>this.keybindingService.lookupKeybinding(s.id),anchorAlignmentProvider:()=>this.getTitleAreaDropDownAnchorAlignment(),toggleMenuTitle:c(2876,"Views and More Actions..."),telemetrySource:this.nameForTelemetry,hoverDelegate:this.toolbarHoverDelegate})),this.collectCompositeActions()(),t}createTitleLabel(e){const t=ge(e,B(".title-label")),i=ge(t,B("h2"));this.titleLabelElement=i;const s=this._register(this.hoverService.setupManagedHover(au("mouse"),i,"")),o=this;return{updateTitle:(n,r,d)=>{(!this.activeComposite||this.activeComposite.getId()===n)&&(i.innerText=r,s.update(d?c(2877,"{0} ({1})",r,d):r))},updateStyles:()=>{i.style.color=o.titleForegroundColor&&o.getColor(o.titleForegroundColor)||"";const n=o.titleBorderColor?o.getColor(o.titleBorderColor):void 0;e.style.borderBottom=n?`1px solid ${n}`:""}}}createHeaderArea(){return B(".composite")}createFooterArea(){return B(".composite")}updateStyles(){super.updateStyles(),Se(this.titleLabel).updateStyles()}actionViewItemProvider(e,t){return this.activeComposite?this.activeComposite.getActionViewItem(e,t):du(this.instantiationService,e,t)}actionsContextProvider(){return this.activeComposite?this.activeComposite.getActionsContext():null}createContentArea(e){const t=ge(e,B(".content"));return this.progressBar=this._register(new qy(t,Yy)),this.progressBar.hide(),t}getProgressIndicator(e){const t=this.instantiatedCompositeItems.get(e);return t?t.progress:void 0}getTitleAreaDropDownAnchorAlignment(){return Lc.RIGHT}layout(e,t,i,s){super.layout(e,t,i,s),this.contentAreaSize=jt.lift(super.layoutContents(e,t).contentSize),this.activeComposite?.layout(this.contentAreaSize)}setBoundarySashes(e){this.boundarySashes=e,this.activeComposite?.setBoundarySashes(e)}removeComposite(e){if(this.activeComposite?.getId()===e)return!1;this.mapCompositeToCompositeContainer.delete(e),this.mapActionsBindingToComposite.delete(e);const t=this.instantiatedCompositeItems.get(e);return t&&(t.composite.dispose(),qe(t.disposable),this.instantiatedCompositeItems.delete(e)),!0}dispose(){this.mapCompositeToCompositeContainer.clear(),this.mapActionsBindingToComposite.clear(),this.instantiatedCompositeItems.forEach(e=>{e.composite.dispose(),qe(e.disposable)}),this.instantiatedCompositeItems.clear(),super.dispose()}}var rl;Pe(vA);var fe;(function(a){a[a.TOP=0]="TOP",a[a.TITLE=1]="TITLE",a[a.BOTTOM=2]="BOTTOM"})(fe||(fe={}));let Qn=class extends CA{static{rl=this}static{this.MIN_COMPOSITE_BAR_WIDTH=50}get snap(){return this.layoutService.isVisible(this.partId)||!!this.paneCompositeBar.value?.getVisiblePaneCompositeIds().length}get onDidPaneCompositeOpen(){return V.map(this.onDidCompositeOpen.event,e=>e.composite)}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b,A,K,P,L,$){let z=q.Sidebar,Z=Oi.Viewlets,ne=w.SidebarTitle;e===M.PANEL_PART?(z=q.Panel,Z=Oi.Panels,ne=w.PanelTitle):e===M.AUXILIARYBAR_PART&&(z=q.AuxiliaryBar,Z=Oi.Auxiliary,ne=w.AuxiliaryBarTitle),super(h,p,f,g,m,v,b,A,H.as(Z),i,K.getDefaultViewContainer(z)?.id||"",n,r,d,l,e,t),this.partId=e,this.activePaneContextKey=s,this.paneFocusContextKey=o,this.viewDescriptorService=K,this.contextKeyService=P,this.extensionService=L,this.menuService=$,this.onDidPaneCompositeClose=this.onDidCompositeClose.event,this.headerFooterCompositeBarDispoables=this._register(new O),this.paneCompositeBar=this._register(new Ie),this.compositeBarPosition=void 0,this.blockOpening=void 0,this.location=z,this.globalActions=this._register(this.instantiationService.createInstance(hm,ne,void 0,void 0)),this.registerListeners()}registerListeners(){this._register(this.onDidPaneCompositeOpen(e=>this.onDidOpen(e))),this._register(this.onDidPaneCompositeClose(this.onDidClose,this)),this._register(this.globalActions.onDidChange(()=>this.updateGlobalToolbarActions())),this._register(this.registry.onDidDeregister(e=>{const t=this.viewDescriptorService.getViewContainersByLocation(this.location).filter(i=>this.viewDescriptorService.getViewContainerModel(i).activeViewDescriptors.length>0);if(t.length){if(this.getActiveComposite()?.getId()===e.id){const i=this.viewDescriptorService.getDefaultViewContainer(this.location)?.id,s=t.filter(o=>o.id===i)[0]||t[0];this.doOpenPaneComposite(s.id)}}else this.layoutService.setPartHidden(!0,this.partId);this.removeComposite(e.id)})),this._register(this.extensionService.onDidRegisterExtensions(()=>{this.layoutCompositeBar()}))}onDidOpen(e){this.activePaneContextKey.set(e.getId())}onDidClose(e){const t=e.getId();this.activePaneContextKey.get()===t&&this.activePaneContextKey.reset()}showComposite(e){super.showComposite(e),this.layoutCompositeBar(),this.layoutEmptyMessage()}hideActiveComposite(){const e=super.hideActiveComposite();return this.layoutCompositeBar(),this.layoutEmptyMessage(),e}create(e){this.element=e,this.element.classList.add("pane-composite-part"),super.create(e);const t=this.getContentArea();t&&this.createEmptyPaneMessage(t),this.updateCompositeBar();const i=this._register(Mo(e));this._register(i.onDidFocus(()=>this.paneFocusContextKey.set(!0))),this._register(i.onDidBlur(()=>this.paneFocusContextKey.set(!1)))}createEmptyPaneMessage(e){this.emptyPaneMessageElement=B(".empty-pane-message-area");const t=B(".empty-pane-message");t.innerText=c(3409,"Drag a view here to display."),this.emptyPaneMessageElement.appendChild(t),e.appendChild(this.emptyPaneMessageElement);const i=s=>{const o=!this.getActiveComposite()||!s,n=s&&this.theme.getColor(um)?.toString()||"";this.titleContainer&&o&&(this.titleContainer.style.backgroundColor=n),this.headerFooterCompositeBarContainer&&o&&(this.headerFooterCompositeBarContainer.style.backgroundColor=n),this.emptyPaneMessageElement.style.backgroundColor=n};this._register(wa.INSTANCE.registerTarget(this.element,{onDragOver:s=>{if(ke.stop(s.eventData,!0),this.paneCompositeBar.value){const o=this.paneCompositeBar.value.dndHandler.onDragEnter(s.dragAndDropData,void 0,s.eventData);wS(s.eventData.dataTransfer,"move",o)}},onDragEnter:s=>{if(ke.stop(s.eventData,!0),this.paneCompositeBar.value){const o=this.paneCompositeBar.value.dndHandler.onDragEnter(s.dragAndDropData,void 0,s.eventData);i(o)}},onDragLeave:s=>{ke.stop(s.eventData,!0),i(!1)},onDragEnd:s=>{ke.stop(s.eventData,!0),i(!1)},onDrop:s=>{if(ke.stop(s.eventData,!0),i(!1),this.paneCompositeBar.value)this.paneCompositeBar.value.dndHandler.drop(s.dragAndDropData,void 0,s.eventData);else{const o=s.dragAndDropData.getData();if(o.type==="composite"){const n=this.viewDescriptorService.getViewContainerById(o.id);this.viewDescriptorService.moveViewContainerToLocation(n,this.location,void 0,"dnd"),this.openPaneComposite(n.id,!0)}else if(o.type==="view"){const n=this.viewDescriptorService.getViewDescriptorById(o.id);if(n&&n.canMoveView){this.viewDescriptorService.moveViewToLocation(n,this.location,"dnd");const r=this.viewDescriptorService.getViewContainerByViewId(n.id);this.openPaneComposite(r.id,!0).then(d=>{d?.openView(n.id,!0)})}}}}}))}createTitleArea(e){const t=super.createTitleArea(e);this._register(Y(t,te.CONTEXT_MENU,s=>{this.onTitleAreaContextMenu(new Nr(St(t),s))})),this._register(dp.addTarget(t)),this._register(Y(t,cp.Contextmenu,s=>{this.onTitleAreaContextMenu(new Nr(St(t),s))}));const i=t.appendChild(B(".global-actions"));return this.globalToolBar=this._register(this.instantiationService.createInstance(Wu,i,{actionViewItemProvider:(s,o)=>this.actionViewItemProvider(s,o),orientation:Zs.HORIZONTAL,getKeyBinding:s=>this.keybindingService.lookupKeybinding(s.id),anchorAlignmentProvider:()=>this.getTitleAreaDropDownAnchorAlignment(),toggleMenuTitle:c(3410,"More Actions..."),hoverDelegate:this.toolbarHoverDelegate,hiddenItemStrategy:Ww.NoHide})),this.updateGlobalToolbarActions(),t}createTitleLabel(e){this.titleContainer=e;const t=super.createTitleLabel(e);this.titleLabelElement.draggable=!0;const i=()=>({type:"composite",id:this.getActivePaneComposite().getId()});return this._register(wa.INSTANCE.registerDraggable(this.titleLabelElement,i,{})),t}updateCompositeBar(e=!1){const t=this.compositeBarPosition!==void 0,i=this.shouldShowCompositeBar(),s=this.compositeBarPosition,o=i?this.getCompositeBarPosition():void 0;if(!e&&s===o)return;if(t){const r=s===fe.TITLE?this.titleContainer:this.headerFooterCompositeBarContainer;if(!this.paneCompositeBarContainer||!this.paneCompositeBar.value||!r)throw new Error("Composite bar containers should exist when removing the previous composite bar");this.paneCompositeBarContainer.remove(),this.paneCompositeBarContainer=void 0,this.paneCompositeBar.value=void 0,r.classList.remove("has-composite-bar"),s===fe.TOP?this.removeFooterHeaderArea(!0):s===fe.BOTTOM&&this.removeFooterHeaderArea(!1)}let n;switch(o){case fe.TOP:n=this.createHeaderArea();break;case fe.TITLE:n=this.titleContainer;break;case fe.BOTTOM:n=this.createFooterArea();break}if(i){if(this.paneCompositeBarContainer||this.paneCompositeBar.value||!n)throw new Error("Invalid composite bar state when creating the new composite bar");n.classList.add("has-composite-bar"),this.paneCompositeBarContainer=pf(n,B(".composite-bar-container")),this.paneCompositeBar.value=this.createCompositeBar(),this.paneCompositeBar.value.create(this.paneCompositeBarContainer),o===fe.TOP?this.setHeaderArea(n):o===fe.BOTTOM&&this.setFooterArea(n)}this.compositeBarPosition=o,e&&this.layoutCompositeBar()}createHeaderArea(){const e=super.createHeaderArea();return this.createHeaderFooterCompositeBarArea(e)}createFooterArea(){const e=super.createFooterArea();return this.createHeaderFooterCompositeBarArea(e)}createHeaderFooterCompositeBarArea(e){if(this.headerFooterCompositeBarContainer)throw new Error("Header or Footer composite bar already exists");return this.headerFooterCompositeBarContainer=e,this.headerFooterCompositeBarDispoables.add(Y(e,te.CONTEXT_MENU,t=>{this.onCompositeBarAreaContextMenu(new Nr(St(e),t))})),this.headerFooterCompositeBarDispoables.add(dp.addTarget(e)),this.headerFooterCompositeBarDispoables.add(Y(e,cp.Contextmenu,t=>{this.onCompositeBarAreaContextMenu(new Nr(St(e),t))})),e}removeFooterHeaderArea(e){this.headerFooterCompositeBarContainer=void 0,this.headerFooterCompositeBarDispoables.clear(),e?this.removeHeaderArea():this.removeFooterArea()}createCompositeBar(){return this.instantiationService.createInstance(yS,this.getCompositeBarOptions(),this.partId,this)}onTitleAreaUpdate(e){super.onTitleAreaUpdate(e),this.layoutCompositeBar()}async openPaneComposite(e,t){if(typeof e=="string"&&this.getPaneComposite(e))return this.doOpenPaneComposite(e,t);if(await this.extensionService.whenInstalledExtensionsRegistered(),typeof e=="string"&&this.getPaneComposite(e))return this.doOpenPaneComposite(e,t)}async doOpenPaneComposite(e,t){if(this.blockOpening)return this.blockOpening.p;let i;if(!this.layoutService.isVisible(this.partId))try{i=this.blockOpening=new Xs,this.layoutService.setPartHidden(!1,this.partId)}finally{this.blockOpening=void 0}try{const s=this.openComposite(e,t);return i?.complete(s),s}catch(s){throw i?.error(s),s}}getPaneComposite(e){return this.registry.getPaneComposite(e)}getPaneComposites(){return this.registry.getPaneComposites().sort((e,t)=>typeof e.order!="number"?1:typeof t.order!="number"?-1:e.order-t.order)}getPinnedPaneCompositeIds(){return this.paneCompositeBar.value?.getPinnedPaneCompositeIds()??[]}getVisiblePaneCompositeIds(){return this.paneCompositeBar.value?.getVisiblePaneCompositeIds()??[]}getPaneCompositeIds(){return this.paneCompositeBar.value?.getPaneCompositeIds()??[]}getActivePaneComposite(){return this.getActiveComposite()}getLastActivePaneCompositeId(){return this.getLastActiveCompositeId()}hideActivePaneComposite(){this.layoutService.isVisible(this.partId)&&this.layoutService.setPartHidden(!0,this.partId),this.hideActiveComposite()}focusCompositeBar(){this.paneCompositeBar.value?.focus()}layout(e,t,i,s){this.layoutService.isVisible(this.partId)&&(this.contentDimension=new jt(e,t),super.layout(this.contentDimension.width,this.contentDimension.height,i,s),this.layoutCompositeBar(),this.layoutEmptyMessage())}layoutCompositeBar(){if(this.contentDimension&&this.dimension&&this.paneCompositeBar.value){const e=this.compositeBarPosition===fe.TITLE?16:8,t=this.partId===M.PANEL_PART?0:1;let i=this.contentDimension.width-e-t;i=Math.max(rl.MIN_COMPOSITE_BAR_WIDTH,i-this.getToolbarWidth()),this.paneCompositeBar.value.layout(i,this.dimension.height)}}layoutEmptyMessage(){const e=!this.getActiveComposite();this.element.classList.toggle("empty",e),e&&this.titleLabel?.updateTitle("","")}updateGlobalToolbarActions(){const e=this.globalActions.getPrimaryActions(),t=this.globalActions.getSecondaryActions();this.globalToolBar?.setActions(Po(e),Po(t))}getToolbarWidth(){if(!this.toolBar||this.compositeBarPosition!==fe.TITLE||!this.getActivePaneComposite())return 0;const t=this.toolBar.getItemsWidth()+this.toolBar.getItemsLength()*4,i=this.globalToolBar?this.globalToolBar.getItemsWidth()+this.globalToolBar.getItemsLength()*4:0;return t+i+5}onTitleAreaContextMenu(e){if(this.shouldShowCompositeBar()&&this.getCompositeBarPosition()===fe.TITLE)return this.onCompositeBarContextMenu(e);{const t=this.getActivePaneComposite(),i=t?t.getContextMenuActions():[];i.length&&this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>i,getActionViewItem:(s,o)=>this.actionViewItemProvider(s,o),actionRunner:t.getActionRunner(),skipTelemetry:!0})}}onCompositeBarAreaContextMenu(e){return this.onCompositeBarContextMenu(e)}onCompositeBarContextMenu(e){if(this.paneCompositeBar.value){const t=[...this.paneCompositeBar.value.getContextMenuActions()];t.length&&this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>t,skipTelemetry:!0})}}getViewsSubmenuAction(){const e=this.getActivePaneComposite()?.getViewPaneContainer();if(e){const t=new O,i=t.add(this.contextKeyService.createScoped(this.element));i.createKey("viewContainer",e.viewContainer.id);const s=this.menuService.getMenuActions(Iu,i,{shouldForwardArgs:!0,renderShortTitle:!0}),o=Jy(s,()=>!0).primary;return t.dispose(),o.length>1&&o.some(n=>n.enabled)?new aa("views",c(3411,"Views"),o):void 0}}};Qn=rl=D([u(9,Ke),u(10,ce),u(11,at),u(12,ze),u(13,it),u(14,At),u(15,F),u(16,me),u(17,Ye),u(18,se),u(19,kt),u(20,ps)],Qn);var al;Pe(Hw);let dl=class extends Qn{static{al=this}static{this.activeViewletSettingsKey="workbench.sidebar.activeviewletid"}get snap(){return!0}get preferredWidth(){const e=this.getActivePaneComposite();if(!e)return;const t=e.getOptimalWidth();if(typeof t=="number")return Math.max(t,300)}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g){super(M.SIDEBAR_PART,{hasTitle:!0,borderWidth:()=>this.getColor(ya)||this.getColor(As)?1:0},al.activeViewletSettingsKey,bD.bindTo(h),CD.bindTo(h),"sideBar","viewlet",vS,pm,e,t,i,s,o,n,r,d,l,h,p,g),this.configurationService=f,this.minimumWidth=170,this.maximumWidth=Number.POSITIVE_INFINITY,this.minimumHeight=0,this.maximumHeight=Number.POSITIVE_INFINITY,this.priority=xi.Low,this.activityBarPart=this._register(this.instantiationService.createInstance(Wr,this)),this.rememberActivityBarVisiblePosition(),this._register(f.onDidChangeConfiguration(m=>{m.affectsConfiguration(Kt.ACTIVITY_BAR_LOCATION)&&this.onDidChangeActivityBarLocation()})),this.registerActions()}onDidChangeActivityBarLocation(){this.activityBarPart.hide(),this.updateCompositeBar();const e=this.getActiveComposite()?.getId();e&&this.onTitleAreaUpdate(e),this.shouldShowActivityBar()&&this.activityBarPart.show(),this.rememberActivityBarVisiblePosition()}updateStyles(){super.updateStyles();const e=Se(this.getContainer());e.style.backgroundColor=this.getColor(xo)||"",e.style.color=this.getColor(gm)||"";const t=this.getColor(ya)||this.getColor(As),i=this.layoutService.getSideBarPosition()===Ot.LEFT;e.style.borderRightWidth=t&&i?"1px":"",e.style.borderRightStyle=t&&i?"solid":"",e.style.borderRightColor=i&&t||"",e.style.borderLeftWidth=t&&!i?"1px":"",e.style.borderLeftStyle=t&&!i?"solid":"",e.style.borderLeftColor=i?"":t||"",e.style.outlineColor=this.getColor(bS)??""}layout(e,t,i,s){this.layoutService.isVisible(M.SIDEBAR_PART)&&super.layout(e,t,i,s)}getTitleAreaDropDownAnchorAlignment(){return this.layoutService.getSideBarPosition()===Ot.LEFT?Lc.LEFT:Lc.RIGHT}createCompositeBar(){return this.instantiationService.createInstance(CS,this.getCompositeBarOptions(),this.partId,this,!1)}getCompositeBarOptions(){return{partContainerClass:"sidebar",pinnedViewContainersKey:Wr.pinnedViewContainersKey,placeholderViewContainersKey:Wr.placeholderViewContainersKey,viewContainersWorkspaceStateKey:Wr.viewContainersWorkspaceStateKey,icon:!0,orientation:Zs.HORIZONTAL,recomputeSizes:!0,activityHoverOptions:{position:()=>this.getCompositeBarPosition()===fe.BOTTOM?Oo.ABOVE:Oo.BELOW},fillExtraContextMenuActions:e=>{if(this.getCompositeBarPosition()===fe.TITLE){const t=this.getViewsSubmenuAction();t&&(e.push(new ss),e.push(t))}},compositeSize:0,iconSize:16,overflowActionSize:30,colors:e=>({activeBackgroundColor:e.getColor(xo),inactiveBackgroundColor:e.getColor(xo),activeBorderBottomColor:e.getColor(bm),activeForegroundColor:e.getColor(vm),inactiveForegroundColor:e.getColor(ym),badgeBackground:e.getColor(wm),badgeForeground:e.getColor(mm),dragAndDropBorder:e.getColor(fm)}),compact:!0}}shouldShowCompositeBar(){const e=this.configurationService.getValue(Kt.ACTIVITY_BAR_LOCATION);return e===Oe.TOP||e===Oe.BOTTOM}shouldShowActivityBar(){return this.shouldShowCompositeBar()?!1:this.configurationService.getValue(Kt.ACTIVITY_BAR_LOCATION)!==Oe.HIDDEN}getCompositeBarPosition(){switch(this.configurationService.getValue(Kt.ACTIVITY_BAR_LOCATION)){case Oe.TOP:return fe.TOP;case Oe.BOTTOM:return fe.BOTTOM;case Oe.HIDDEN:case Oe.DEFAULT:default:return fe.TITLE}}rememberActivityBarVisiblePosition(){const e=this.configurationService.getValue(Kt.ACTIVITY_BAR_LOCATION);e!==Oe.HIDDEN&&this.storageService.store(Kt.ACTIVITY_BAR_LOCATION,e,G.PROFILE,Re.USER)}getRememberedActivityBarVisiblePosition(){switch(this.storageService.get(Kt.ACTIVITY_BAR_LOCATION,G.PROFILE)){case Oe.TOP:return Oe.TOP;case Oe.BOTTOM:return Oe.BOTTOM;default:return Oe.DEFAULT}}getPinnedPaneCompositeIds(){return this.shouldShowCompositeBar()?super.getPinnedPaneCompositeIds():this.activityBarPart.getPinnedPaneCompositeIds()}getVisiblePaneCompositeIds(){return this.shouldShowCompositeBar()?super.getVisiblePaneCompositeIds():this.activityBarPart.getVisiblePaneCompositeIds()}getPaneCompositeIds(){return this.shouldShowCompositeBar()?super.getPaneCompositeIds():this.activityBarPart.getPaneCompositeIds()}async focusActivityBar(){this.configurationService.getValue(Kt.ACTIVITY_BAR_LOCATION)===Oe.HIDDEN&&(await this.configurationService.updateValue(Kt.ACTIVITY_BAR_LOCATION,this.getRememberedActivityBarVisiblePosition()),this.onDidChangeActivityBarLocation()),this.shouldShowCompositeBar()?this.focusCompositeBar():(this.layoutService.isVisible(M.ACTIVITYBAR_PART)||this.layoutService.setPartHidden(!1,M.ACTIVITYBAR_PART),this.activityBarPart.show(!0))}registerActions(){const e=this;this._register(C(class extends X{constructor(){super({id:SS,title:x(3456,"Toggle Activity Bar Visibility")})}run(){const t=e.configurationService.getValue(Kt.ACTIVITY_BAR_LOCATION)===Oe.HIDDEN?e.getRememberedActivityBarVisiblePosition():Oe.HIDDEN;return e.configurationService.updateValue(Kt.ACTIVITY_BAR_LOCATION,t)}}))}toJSON(){return{type:M.SIDEBAR_PART}}};dl=al=D([u(0,Ke),u(1,ce),u(2,at),u(3,ze),u(4,it),u(5,At),u(6,F),u(7,me),u(8,Ye),u(9,se),u(10,kt),u(11,ie),u(12,ps)],dl);let cl=class extends R{constructor(e,t,i){super(),this.viewId=e,this.viewDescriptorService=t,this.activityService=i,this.activity=void 0,this.activityDisposable=R.None,this._register(V.filter(this.viewDescriptorService.onDidChangeContainer,s=>s.views.some(o=>o.id===e))(()=>this.update())),this._register(V.filter(this.viewDescriptorService.onDidChangeLocation,s=>s.views.some(o=>o.id===e))(()=>this.update()))}setActivity(e){this.activity=e,this.update()}clearActivity(){this.activity=void 0,this.update()}update(){this.activityDisposable.dispose();const e=this.viewDescriptorService.getViewContainerByViewId(this.viewId);e&&this.activity&&(this.activityDisposable=this.activityService.showViewContainerActivity(e.id,this.activity))}dispose(){this.activityDisposable.dispose(),super.dispose()}};cl=D([u(1,Ye),u(2,ks)],cl);let ll=class extends R{constructor(e,t){super(),this.viewDescriptorService=e,this.instantiationService=t,this.viewActivities=new Map,this._onDidChangeActivity=this._register(new E),this.onDidChangeActivity=this._onDidChangeActivity.event,this.viewContainerActivities=new Map,this.globalActivities=new Map}showViewContainerActivity(e,t){const i=this.viewDescriptorService.getViewContainerById(e);if(!i)return R.None;let s=this.viewContainerActivities.get(e);return s||(s=[],this.viewContainerActivities.set(e,s)),s.push(t),this._onDidChangeActivity.fire(i),ae(()=>{s.splice(s.indexOf(t),1),s.length===0&&this.viewContainerActivities.delete(e),this._onDidChangeActivity.fire(i)})}getViewContainerActivities(e){return this.viewDescriptorService.getViewContainerById(e)?this.viewContainerActivities.get(e)??[]:[]}showViewActivity(e,t){let i=this.viewActivities.get(e);i?i.id++:(i={id:1,activity:this.instantiationService.createInstance(cl,e)},this.viewActivities.set(e,i));const s=i.id;i.activity.setActivity(t);const o=i;return ae(()=>{o.id===s&&(o.activity.dispose(),this.viewActivities.delete(e))})}showAccountsActivity(e){return this.showActivity(_S,e)}showGlobalActivity(e){return this.showActivity(ES,e)}getActivity(e){return this.globalActivities.get(e)??[]}showActivity(e,t){let i=this.globalActivities.get(e);return i||(i=[],this.globalActivities.set(e,i)),i.push(t),this._onDidChangeActivity.fire(e),ae(()=>{i.splice(i.indexOf(t),1),i.length===0&&this.globalActivities.delete(e),this._onDidChangeActivity.fire(e)})}};ll=D([u(0,Ye),u(1,F)],ll);var hl;Pe(TS);let ul=class extends Qn{static{hl=this}get preferredHeight(){return this.layoutService.mainContainerDimension.height*.4}get preferredWidth(){const e=this.getActivePaneComposite();if(!e)return;const t=e.getOptimalWidth();if(typeof t=="number")return Math.max(t,300)}static{this.activePanelSettingsKey="workbench.panelpart.activepanelid"}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m){super(M.PANEL_PART,{hasTitle:!0},hl.activePanelSettingsKey,SD.bindTo(h),_D.bindTo(h),"panel","panel",void 0,IS,e,t,i,s,o,n,r,d,l,h,p,g),this.commandService=f,this.configurationService=m,this.minimumWidth=300,this.maximumWidth=Number.POSITIVE_INFINITY,this.minimumHeight=77,this.maximumHeight=Number.POSITIVE_INFINITY,this._register(this.configurationService.onDidChangeConfiguration(v=>{v.affectsConfiguration("workbench.panel.showLabels")&&this.updateCompositeBar(!0)}))}updateStyles(){super.updateStyles();const e=Se(this.getContainer());e.style.backgroundColor=this.getColor(dc)||"";const t=this.getColor(va)||this.getColor(As)||"";e.style.borderLeftColor=t,e.style.borderRightColor=t,e.style.borderBottomColor=t;const i=this.getTitleArea();i&&(i.style.borderTopColor=this.getColor(va)||this.getColor(As)||"")}getCompositeBarOptions(){return{partContainerClass:"panel",pinnedViewContainersKey:"workbench.panel.pinnedPanels",placeholderViewContainersKey:"workbench.panel.placeholderPanels",viewContainersWorkspaceStateKey:"workbench.panel.viewContainersWorkspaceState",icon:this.configurationService.getValue("workbench.panel.showLabels")===!1,orientation:Zs.HORIZONTAL,recomputeSizes:!0,activityHoverOptions:{position:()=>this.layoutService.getPanelPosition()===Ot.BOTTOM&&!this.layoutService.isPanelMaximized()?Oo.ABOVE:Oo.BELOW},fillExtraContextMenuActions:e=>this.fillExtraContextMenuActions(e),compositeSize:0,iconSize:16,compact:!0,overflowActionSize:44,colors:e=>({activeBackgroundColor:e.getColor(dc),inactiveBackgroundColor:e.getColor(dc),activeBorderBottomColor:e.getColor(Em),activeForegroundColor:e.getColor(_m),inactiveForegroundColor:e.getColor(Sm),badgeBackground:e.getColor(AS),badgeForeground:e.getColor(DS),dragAndDropBorder:e.getColor(Cm)})}}fillExtraContextMenuActions(e){if(this.getCompositeBarPosition()===fe.TITLE){const d=this.getViewsSubmenuAction();d&&(e.push(new ss),e.push(d))}const t=this.menuService.getMenuActions(w.PanelPositionMenu,this.contextKeyService,{shouldForwardArgs:!0}),i=this.menuService.getMenuActions(w.PanelAlignmentMenu,this.contextKeyService,{shouldForwardArgs:!0}),s=da(t).secondary,o=da(i).secondary,n=this.configurationService.getValue("workbench.panel.showLabels"),r=es({id:"workbench.action.panel.toggleShowLabels",label:n?c(3449,"Show Icons"):c(3450,"Show Labels"),run:()=>this.configurationService.updateValue("workbench.panel.showLabels",!n)});e.push(new ss,new aa("workbench.action.panel.position",c(3451,"Panel Position"),s),new aa("workbench.action.panel.align",c(3452,"Align Panel"),o),r,es({id:$p.ID,label:c(3453,"Hide Panel"),run:()=>this.commandService.executeCommand($p.ID)}))}layout(e,t,i,s){let o;switch(this.layoutService.getPanelPosition()){case Ot.RIGHT:o=new jt(e-1,t);break;case Ot.TOP:o=new jt(e,t-1);break;default:o=new jt(e,t);break}super.layout(o.width,o.height,i,s)}shouldShowCompositeBar(){return!0}getCompositeBarPosition(){return fe.TITLE}toJSON(){return{type:M.PANEL_PART}}};ul=hl=D([u(0,Ke),u(1,ce),u(2,at),u(3,ze),u(4,it),u(5,At),u(6,F),u(7,me),u(8,Ye),u(9,se),u(10,kt),u(11,wt),u(12,ps),u(13,ie)],ul);const SA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var pl;Pe(SA);function ty(a){return a.getValue("editor.dropIntoEditor.enabled")}function iy(a){return a.shiftKey}let gl=class extends gf{static{pl=this}static{this.OVERLAY_ID="monaco-workbench-editor-drop-overlay"}get disposed(){return!!this._disposed}constructor(e,t,i,s,o,n,r,d){super(t),this.groupView=e,this.configurationService=i,this.instantiationService=s,this.editorService=o,this.editorGroupService=n,this.treeViewsDragAndDropService=r,this.contextService=d,this.editorTransfer=ko.getInstance(),this.groupTransfer=ko.getInstance(),this.treeItemsTransfer=ko.getInstance(),this.cleanupOverlayScheduler=this._register(new ur(()=>this.dispose(),300)),this.enableDropIntoEditor=ty(this.configurationService)&&this.isDropIntoActiveEditorEnabled(),this.create()}create(){const e=this.getOverlayOffsetHeight(),t=this.container=B("div",{id:pl.OVERLAY_ID});t.style.top=`${e}px`,this.groupView.element.appendChild(t),this.groupView.element.classList.add("dragged-over"),this._register(ae(()=>{t.remove(),this.groupView.element.classList.remove("dragged-over")})),this.overlay=B(".editor-group-overlay-indicator"),t.appendChild(this.overlay),this.enableDropIntoEditor&&(this.dropIntoPromptElement=Zy(c(3226,"Hold __{0}__ to drop into editor",ut?"⇧":"Shift"),{}),this.dropIntoPromptElement.classList.add("editor-group-overlay-drop-into-prompt"),this.overlay.appendChild(this.dropIntoPromptElement)),this.registerListeners(t),this.updateStyles()}updateStyles(){const e=Se(this.overlay);e.style.backgroundColor=this.getColor(um)||"";const t=this.getColor(Xy);if(e.style.outlineColor=t||"",e.style.outlineOffset=t?"-2px":"",e.style.outlineStyle=t?"dashed":"",e.style.outlineWidth=t?"2px":"",this.dropIntoPromptElement){this.dropIntoPromptElement.style.backgroundColor=this.getColor(RS)??"",this.dropIntoPromptElement.style.color=this.getColor(LS)??"";const i=this.getColor(VS);i?(this.dropIntoPromptElement.style.borderWidth="1px",this.dropIntoPromptElement.style.borderStyle="solid",this.dropIntoPromptElement.style.borderColor=i):this.dropIntoPromptElement.style.borderWidth="0"}}registerListeners(e){this._register(new Qy(e,{onDragOver:t=>{if(this.enableDropIntoEditor&&iy(t)){this.dispose();return}const i=this.groupTransfer.hasData(Os.prototype),s=this.editorTransfer.hasData(ys.prototype);!s&&!i&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy");let o=!0;if(i)o=this.isCopyOperation(t);else if(s){const r=this.editorTransfer.getData(ys.prototype);Array.isArray(r)&&r.length>0&&(o=this.isCopyOperation(t,r[0].identifier))}if(!o){const r=this.findSourceGroupView();if(r===this.groupView&&(i||s&&r.count<2)){this.hideOverlay();return}}let n=!!this.editorGroupService.partOptions.splitOnDragAndDrop;this.isToggleSplitOperation(t)&&(n=!n),this.positionOverlay(t.offsetX,t.offsetY,i,n),this.cleanupOverlayScheduler.isScheduled()&&this.cleanupOverlayScheduler.cancel()},onDragLeave:t=>this.dispose(),onDragEnd:t=>this.dispose(),onDrop:t=>{ke.stop(t,!0),this.dispose(),this.currentDropOperation&&this.handleDrop(t,this.currentDropOperation.splitDirection)}})),this._register(Y(e,te.MOUSE_OVER,()=>{this.cleanupOverlayScheduler.isScheduled()||this.cleanupOverlayScheduler.schedule()}))}isDropIntoActiveEditorEnabled(){return!!this.groupView.activeEditor?.hasCapability(Cg.CanDropIntoEditor)}findSourceGroupView(){if(this.groupTransfer.hasData(Os.prototype)){const e=this.groupTransfer.getData(Os.prototype);if(Array.isArray(e)&&e.length>0)return this.editorGroupService.getGroup(e[0].identifier)}else if(this.editorTransfer.hasData(ys.prototype)){const e=this.editorTransfer.getData(ys.prototype);if(Array.isArray(e)&&e.length>0)return this.editorGroupService.getGroup(e[0].identifier.groupId)}}async handleDrop(e,t){const i=()=>{let s;return typeof t=="number"?s=this.editorGroupService.addGroup(this.groupView,t):s=this.groupView,s};if(this.groupTransfer.hasData(Os.prototype)){const s=this.groupTransfer.getData(Os.prototype);if(Array.isArray(s)&&s.length>0){const o=this.editorGroupService.getGroup(s[0].identifier);if(o){if(typeof t!="number"&&o===this.groupView)return;let n;if(typeof t=="number")this.isCopyOperation(e)?n=this.editorGroupService.copyGroup(o,this.groupView,t):n=this.editorGroupService.moveGroup(o,this.groupView,t);else{let r;this.isCopyOperation(e)&&(r={mode:Rw.COPY_EDITORS}),this.editorGroupService.mergeGroup(o,this.groupView,r)}n&&this.editorGroupService.activateGroup(n)}this.groupTransfer.clearData(Os.prototype)}}else if(this.editorTransfer.hasData(ys.prototype)){const s=this.editorTransfer.getData(ys.prototype);if(Array.isArray(s)&&s.length>0){const o=s,n=s[0].identifier,r=this.editorGroupService.getGroup(n.groupId);if(r){const d=this.isCopyOperation(e,n);let l;if(this.editorGroupService.partOptions.closeEmptyGroups&&r.count===1&&typeof t=="number"&&!d)l=this.editorGroupService.moveGroup(r,this.groupView,t);else{if(l=i(),r===l)return;const h=PS(this.groupView,o.map(p=>p.identifier.editor));d?r.copyEditors(h,l):r.moveEditors(h,l)}l.focus()}this.editorTransfer.clearData(ys.prototype)}}else if(this.treeItemsTransfer.hasData(Ws.prototype)){const s=this.treeItemsTransfer.getData(Ws.prototype);if(Array.isArray(s)&&s.length>0){const o=[];for(const n of s){const r=await this.treeViewsDragAndDropService.removeDragOperationTransfer(n.identifier);if(r){const d=await MS(r);o.push(...d.map(l=>({...l,options:{...l.options,pinned:!0}})))}}o.length&&this.editorService.openEditors(o,i(),{validateTrust:!0})}this.treeItemsTransfer.clearData(Ws.prototype)}else this.instantiationService.createInstance(OS,{allowWorkspaceOpen:!Qs||ev(this.contextService.getWorkspace())}).handleDrop(e,St(this.groupView.element),()=>i(),o=>o?.focus())}isCopyOperation(e,t){return t?.editor.hasCapability(Cg.Singleton)?!1:e.ctrlKey&&!ut||e.altKey&&ut}isToggleSplitOperation(e){return e.altKey&&!ut||e.shiftKey&&ut}positionOverlay(e,t,i,s){const o=this.editorGroupService.partOptions.openSideBySideDirection==="right",n=this.groupView.element.clientWidth,r=this.groupView.element.clientHeight-this.getOverlayOffsetHeight();let d,l;s?(i?d=o?.3:.1:d=.1,i?l=o?.1:.3:l=.1):(d=0,l=0);const h=n*d,p=r*l,f=n/3,g=r/3;let m;switch(e>h&&e<n-h&&t>p&&t<r-p?m=void 0:o?e<f?m=we.LEFT:e>f*2?m=we.RIGHT:t<r/2?m=we.UP:m=we.DOWN:t<g?m=we.UP:t>g*2?m=we.DOWN:e<n/2?m=we.LEFT:m=we.RIGHT,m){case we.UP:this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"50%"}),this.toggleDropIntoPrompt(!1);break;case we.DOWN:this.doPositionOverlay({top:"50%",left:"0",width:"100%",height:"50%"}),this.toggleDropIntoPrompt(!1);break;case we.LEFT:this.doPositionOverlay({top:"0",left:"0",width:"50%",height:"100%"}),this.toggleDropIntoPrompt(!1);break;case we.RIGHT:this.doPositionOverlay({top:"0",left:"50%",width:"50%",height:"100%"}),this.toggleDropIntoPrompt(!1);break;default:this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"100%"}),this.toggleDropIntoPrompt(!0)}const v=Se(this.overlay);v.style.opacity="1",setTimeout(()=>v.classList.add("overlay-move-transition"),0),this.currentDropOperation={splitDirection:m}}doPositionOverlay(e){const[t,i]=tv(this.container,this.overlay),s=this.getOverlayOffsetHeight();s?t.style.height=`calc(100% - ${s}px)`:t.style.height="100%",i.style.top=e.top,i.style.left=e.left,i.style.width=e.width,i.style.height=e.height}getOverlayOffsetHeight(){return!this.groupView.isEmpty&&this.editorGroupService.partOptions.showTabs==="multiple"?this.groupView.titleHeight.offset:0}hideOverlay(){const e=Se(this.overlay);this.doPositionOverlay({top:"0",left:"0",width:"100%",height:"100%"}),e.style.opacity="0",e.classList.remove("overlay-move-transition"),this.currentDropOperation=void 0}toggleDropIntoPrompt(e){this.dropIntoPromptElement&&(this.dropIntoPromptElement.style.opacity=e?"1":"0")}contains(e){return e===this.container||e===this.overlay}dispose(){super.dispose(),this._disposed=!0}};gl=pl=D([u(1,me),u(2,ie),u(3,F),u(4,Q),u(5,Je),u(6,ff),u(7,us)],gl);let fl=class extends gf{constructor(e,t,i,s,o,n){super(s),this.container=e,this.delegate=t,this.editorGroupService=i,this.configurationService=o,this.instantiationService=n,this.counter=0,this.editorTransfer=ko.getInstance(),this.groupTransfer=ko.getInstance(),this.registerListeners()}get overlay(){if(this._overlay&&!this._overlay.disposed)return this._overlay}registerListeners(){this._register(Y(this.container,te.DRAG_ENTER,e=>this.onDragEnter(e))),this._register(Y(this.container,te.DRAG_LEAVE,()=>this.onDragLeave()));for(const e of[this.container,St(this.container)])this._register(Y(e,te.DRAG_END,()=>this.onDragEnd()))}onDragEnter(e){if(ty(this.configurationService)&&iy(e))return;if(this.counter++,!this.editorTransfer.hasData(ys.prototype)&&!this.groupTransfer.hasData(Os.prototype)&&e.dataTransfer){const i=H.as(xS.DragAndDropContribution).getAll(),s=Array.from(i).map(o=>o.dataFormatKey);if(!kS(e,Dn.FILES,zc.FILES,Dn.RESOURCES,zc.EDITORS,...s)){e.dataTransfer.dropEffect="none";return}}this.updateContainer(!0);const t=e.target;if(t&&(this.overlay&&!this.overlay.contains(t)&&this.disposeOverlay(),!this.overlay)){const i=this.findTargetGroupView(t);i&&(this._overlay=this.instantiationService.createInstance(gl,i))}}onDragLeave(){this.counter--,this.counter===0&&this.updateContainer(!1)}onDragEnd(){this.counter=0,this.updateContainer(!1),this.disposeOverlay()}findTargetGroupView(e){return this.editorGroupService.groups.find(i=>Vc(e,i.element)||this.delegate.containsGroup?.(i))}updateContainer(e){this.container.classList.toggle("dragged-over",e)}dispose(){super.dispose(),this.disposeOverlay()}disposeOverlay(){this.overlay&&(this.overlay.dispose(),this._overlay=void 0)}};fl=D([u(2,Je),u(3,me),u(4,ie),u(5,F)],fl);const gn={targetWidth:900,leftMarginRatio:.1909,rightMarginRatio:.1909},Cc={type:"distribute"};function Rg(a){const e=B(".centered-layout-margin");return e.style.height="100%",a&&(e.style.backgroundColor=a.toString()),{element:e,layout:()=>{},minimumSize:60,maximumSize:Number.POSITIVE_INFINITY,onDidChange:V.None}}function _A(a,e){return{element:a.element,get maximumSize(){return a.maximumWidth},get minimumSize(){return a.minimumWidth},onDidChange:V.map(a.onDidChange,t=>t&&t.width),layout:(t,i,s)=>a.layout(t,e(),s?.top??0,(s?.left??0)+i)}}class EA{constructor(e,t,i={...gn},s=!1){this.container=e,this.view=t,this.state=i,this.centeredLayoutFixedWidth=s,this.lastLayoutPosition={width:0,height:0,left:0,top:0},this.didLayout=!1,this.splitViewDisposables=new O,this._boundarySashes={},this.container.appendChild(this.view.element),this.container.style.overflow="hidden"}get minimumWidth(){return this.splitView?this.splitView.minimumSize:this.view.minimumWidth}get maximumWidth(){return this.splitView?this.splitView.maximumSize:this.view.maximumWidth}get minimumHeight(){return this.view.minimumHeight}get maximumHeight(){return this.view.maximumHeight}get onDidChange(){return this.view.onDidChange}get boundarySashes(){return this._boundarySashes}set boundarySashes(e){this._boundarySashes=e,this.splitView&&(this.splitView.orthogonalStartSash=e.top,this.splitView.orthogonalEndSash=e.bottom)}layout(e,t,i,s){this.lastLayoutPosition={width:e,height:t,top:i,left:s},this.splitView?(this.splitView.layout(e,this.lastLayoutPosition),(!this.didLayout||this.centeredLayoutFixedWidth)&&this.resizeSplitViews()):this.view.layout(e,t,i,s),this.didLayout=!0}resizeSplitViews(){if(this.splitView)if(this.centeredLayoutFixedWidth){const e=Math.min(this.lastLayoutPosition.width,this.state.targetWidth),t=(this.lastLayoutPosition.width-e)/2;this.splitView.resizeView(0,Math.floor(t)),this.splitView.resizeView(1,e),this.splitView.resizeView(2,Math.ceil(t))}else{const e=this.state.leftMarginRatio*this.lastLayoutPosition.width,t=this.state.rightMarginRatio*this.lastLayoutPosition.width,i=this.lastLayoutPosition.width-e-t;this.splitView.resizeView(0,e),this.splitView.resizeView(1,i),this.splitView.resizeView(2,t)}}setFixedWidth(e){this.centeredLayoutFixedWidth=e,this.splitView&&(this.updateState(),this.resizeSplitViews())}updateState(){this.splitView&&(this.state.targetWidth=this.splitView.getViewSize(1),this.state.leftMarginRatio=this.splitView.getViewSize(0)/this.lastLayoutPosition.width,this.state.rightMarginRatio=this.splitView.getViewSize(2)/this.lastLayoutPosition.width)}isActive(){return!!this.splitView}styles(e){this.style=e,this.splitView&&this.emptyViews&&(this.splitView.style(this.style),this.emptyViews[0].element.style.backgroundColor=this.style.background.toString(),this.emptyViews[1].element.style.backgroundColor=this.style.background.toString())}activate(e){if(e!==this.isActive())if(e){this.view.element.remove(),this.splitView=new $n(this.container,{inverseAltBehavior:!0,orientation:J.HORIZONTAL,styles:this.style}),this.splitView.orthogonalStartSash=this.boundarySashes.top,this.splitView.orthogonalEndSash=this.boundarySashes.bottom,this.splitViewDisposables.add(this.splitView.onDidSashChange(()=>{this.splitView&&this.updateState()})),this.splitViewDisposables.add(this.splitView.onDidSashReset(()=>{this.state={...gn},this.resizeSplitViews()})),this.splitView.layout(this.lastLayoutPosition.width,this.lastLayoutPosition);const t=this.style?this.style.background:void 0;this.emptyViews=[Rg(t),Rg(t)],this.splitView.addView(this.emptyViews[0],Cc,0),this.splitView.addView(_A(this.view,()=>this.lastLayoutPosition.height),Cc,1),this.splitView.addView(this.emptyViews[1],Cc,2),this.resizeSplitViews()}else this.splitView?.el.remove(),this.splitViewDisposables.clear(),this.splitView?.dispose(),this.splitView=void 0,this.emptyViews=void 0,this.container.appendChild(this.view.element),this.view.layout(this.lastLayoutPosition.width,this.lastLayoutPosition.height,this.lastLayoutPosition.top,this.lastLayoutPosition.left)}isDefault(e){return this.centeredLayoutFixedWidth?e.targetWidth===gn.targetWidth:e.leftMarginRatio===gn.leftMarginRatio&&e.rightMarginRatio===gn.rightMarginRatio}dispose(){this.splitViewDisposables.dispose(),this.splitView&&(this.splitView.dispose(),this.splitView=void 0)}}var zi;class IA{constructor(){this.element=B(".grid-view-container"),this._onDidChange=new _s,this.onDidChange=this._onDidChange.event}get minimumWidth(){return this.gridWidget?this.gridWidget.minimumWidth:0}get maximumWidth(){return this.gridWidget?this.gridWidget.maximumWidth:Number.POSITIVE_INFINITY}get minimumHeight(){return this.gridWidget?this.gridWidget.minimumHeight:0}get maximumHeight(){return this.gridWidget?this.gridWidget.maximumHeight:Number.POSITIVE_INFINITY}get gridWidget(){return this._gridWidget}set gridWidget(e){this.element.innerText="",e?(this.element.appendChild(e.element),this._onDidChange.input=e.onDidChange):this._onDidChange.input=V.None,this._gridWidget=e}layout(e,t,i,s){this.gridWidget?.layout(e,t,i,s)}dispose(){this._onDidChange.dispose()}}let Ea=class extends lm{static{zi=this}static{this.EDITOR_PART_UI_STATE_STORAGE_KEY="editorpart.state"}static{this.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY="editorpart.centeredview"}constructor(e,t,i,s,o,n,r,d,l,h,p){super(t,{hasTitle:!1},n,d,l),this.editorPartsView=e,this.groupsLabel=i,this.windowId=s,this.instantiationService=o,this.configurationService=r,this.hostService=h,this.contextKeyService=p,this._onDidFocus=this._register(new E),this.onDidFocus=this._onDidFocus.event,this._onDidLayout=this._register(new E),this.onDidLayout=this._onDidLayout.event,this._onDidChangeActiveGroup=this._register(new E),this.onDidChangeActiveGroup=this._onDidChangeActiveGroup.event,this._onDidChangeGroupIndex=this._register(new E),this.onDidChangeGroupIndex=this._onDidChangeGroupIndex.event,this._onDidChangeGroupLabel=this._register(new E),this.onDidChangeGroupLabel=this._onDidChangeGroupLabel.event,this._onDidChangeGroupLocked=this._register(new E),this.onDidChangeGroupLocked=this._onDidChangeGroupLocked.event,this._onDidChangeGroupMaximized=this._register(new E),this.onDidChangeGroupMaximized=this._onDidChangeGroupMaximized.event,this._onDidActivateGroup=this._register(new E),this.onDidActivateGroup=this._onDidActivateGroup.event,this._onDidAddGroup=this._register(new Pc),this.onDidAddGroup=this._onDidAddGroup.event,this._onDidRemoveGroup=this._register(new Pc),this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidMoveGroup=this._register(new E),this.onDidMoveGroup=this._onDidMoveGroup.event,this.onDidSetGridWidget=this._register(new E),this._onDidChangeSizeConstraints=this._register(new _s),this.onDidChangeSizeConstraints=V.any(this.onDidSetGridWidget.event,this._onDidChangeSizeConstraints.event),this._onDidScroll=this._register(new _s),this.onDidScroll=V.any(this.onDidSetGridWidget.event,this._onDidScroll.event),this._onDidChangeEditorPartOptions=this._register(new E),this.onDidChangeEditorPartOptions=this._onDidChangeEditorPartOptions.event,this._onWillDispose=this._register(new E),this.onWillDispose=this._onWillDispose.event,this.workspaceMemento=this.getMemento(G.WORKSPACE,Re.USER),this.profileMemento=this.getMemento(G.PROFILE,Re.MACHINE),this.groupViews=new Map,this.mostRecentActiveGroups=[],this.gridWidgetDisposables=this._register(new O),this.gridWidgetView=this._register(new IA),this.enforcedPartOptions=[],this.top=0,this.left=0,this.sideGroup={openEditor:(f,g)=>{const[m]=this.scopedInstantiationService.invokeFunction(v=>Kw(v,{editor:f,options:g},Im));return m.openEditor(f,g)}},this._isReady=!1,this.whenReadyPromise=new Xs,this.whenReady=this.whenReadyPromise.p,this.whenRestoredPromise=new Xs,this.whenRestored=this.whenRestoredPromise.p,this._willRestoreState=!1,this.priority=xi.High,this._partOptions=jp(this.configurationService,this.themeService),this.registerListeners()}registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationUpdated(e))),this._register(this.themeService.onDidFileIconThemeChange(()=>this.handleChangedPartOptions())),this._register(this.onDidChangeMementoValue(G.WORKSPACE,this._store)(e=>this.onDidChangeMementoState(e)))}onConfigurationUpdated(e){NS(e)&&this.handleChangedPartOptions()}handleChangedPartOptions(){const e=this._partOptions,t=jp(this.configurationService,this.themeService);for(const i of this.enforcedPartOptions)Object.assign(t,i);this._partOptions=t,this._onDidChangeEditorPartOptions.fire({oldPartOptions:e,newPartOptions:t})}get partOptions(){return this._partOptions}enforcePartOptions(e){return this.enforcedPartOptions.push(e),this.handleChangedPartOptions(),ae(()=>{this.enforcedPartOptions.splice(this.enforcedPartOptions.indexOf(e),1),this.handleChangedPartOptions()})}get contentDimension(){return this._contentDimension}get activeGroup(){return this._activeGroup}get groups(){return Array.from(this.groupViews.values())}get count(){return this.groupViews.size}get orientation(){return this.gridWidget&&this.gridWidget.orientation===J.VERTICAL?go.VERTICAL:go.HORIZONTAL}get isReady(){return this._isReady}get hasRestorableState(){return!!this.workspaceMemento[zi.EDITOR_PART_UI_STATE_STORAGE_KEY]}get willRestoreState(){return this._willRestoreState}getGroups(e=Ge.CREATION_TIME){switch(e){case Ge.CREATION_TIME:return this.groups;case Ge.MOST_RECENTLY_ACTIVE:{const t=gs(this.mostRecentActiveGroups.map(i=>this.getGroup(i)));return Es([...t,...this.groups])}case Ge.GRID_APPEARANCE:{const t=[];return this.gridWidget&&this.fillGridNodes(t,this.gridWidget.getViews()),t}}}fillGridNodes(e,t){$s(t)?t.children.forEach(i=>this.fillGridNodes(e,i)):e.push(t.view)}hasGroup(e){return this.groupViews.has(e)}getGroup(e){return this.groupViews.get(e)}findGroup(e,t=this.activeGroup,i){if(typeof e.direction=="number")return this.doFindGroupByDirection(e.direction,t,i);if(typeof e.location=="number")return this.doFindGroupByLocation(e.location,t,i);throw new Error("invalid arguments")}doFindGroupByDirection(e,t,i){const s=this.assertGroupView(t),o=this.gridWidget.getNeighborViews(s,this.toGridViewDirection(e),i);return o.sort((n,r)=>this.mostRecentActiveGroups.indexOf(n.id)-this.mostRecentActiveGroups.indexOf(r.id)),o[0]}doFindGroupByLocation(e,t,i){const s=this.assertGroupView(t),o=this.getGroups(Ge.GRID_APPEARANCE),n=o.indexOf(s);switch(e){case Nt.FIRST:return o[0];case Nt.LAST:return o[o.length-1];case Nt.NEXT:{let r=o[n+1];return!r&&i&&(r=this.doFindGroupByLocation(Nt.FIRST,t)),r}case Nt.PREVIOUS:{let r=o[n-1];return!r&&i&&(r=this.doFindGroupByLocation(Nt.LAST,t)),r}}}activateGroup(e,t){const i=this.assertGroupView(e);return this.doSetGroupActive(i),t||this.hostService.moveTop(St(this.element)),i}restoreGroup(e){const t=this.assertGroupView(e);return this.doRestoreGroup(t),t}getSize(e){const t=this.assertGroupView(e);return this.gridWidget.getViewSize(t)}setSize(e,t){const i=this.assertGroupView(e);this.gridWidget.resizeView(i,t)}arrangeGroups(e,t=this.activeGroup){if(this.count<2||!this.gridWidget)return;const i=this.assertGroupView(t);switch(e){case ms.EVEN:this.gridWidget.distributeViewSizes();break;case ms.MAXIMIZE:if(this.groups.length<2)return;this.gridWidget.maximizeView(i),i.focus();break;case ms.EXPAND:this.gridWidget.expandView(i);break}}toggleMaximizeGroup(e=this.activeGroup){this.hasMaximizedGroup()?this.unmaximizeGroup():this.arrangeGroups(ms.MAXIMIZE,e)}toggleExpandGroup(e=this.activeGroup){this.isGroupExpanded(this.activeGroup)?this.arrangeGroups(ms.EVEN):this.arrangeGroups(ms.EXPAND,e)}unmaximizeGroup(){this.gridWidget.exitMaximizedView(),this._activeGroup.focus()}hasMaximizedGroup(){return this.gridWidget.hasMaximizedView()}isGroupMaximized(e){return this.gridWidget.isViewMaximized(e)}isGroupExpanded(e){return this.gridWidget.isViewExpanded(e)}setGroupOrientation(e){if(!this.gridWidget)return;const t=e===go.HORIZONTAL?J.HORIZONTAL:J.VERTICAL;this.gridWidget.orientation!==t&&(this.gridWidget.orientation=t)}applyLayout(e){const t=this.shouldRestoreFocus(this.container);let i=0;function s(d){for(const l of d)Array.isArray(l.groups)?s(l.groups):i++}s(e.groups);let o=this.getGroups(Ge.GRID_APPEARANCE);if(i<o.length){const d=o[i-1];o.forEach((l,h)=>{h>=i&&this.mergeGroup(l,d)}),o=this.getGroups(Ge.GRID_APPEARANCE)}const n=this.activeGroup,r=ey({orientation:this.toGridViewOrientation(e.orientation,this.isTwoDimensionalGrid()?this.gridWidget.orientation:Vi(this.gridWidget.orientation)),groups:e.groups});this.doApplyGridState(r,n.id,o),t&&this._activeGroup.focus()}getLayout(){const e=this.gridWidget.serialize(),t=e.orientation===J.HORIZONTAL?go.HORIZONTAL:go.VERTICAL,i=this.serializedNodeToGroupLayoutArgument(e.root);return{orientation:t,groups:i.groups}}serializedNodeToGroupLayoutArgument(e){return e.type==="branch"?{size:e.size,groups:e.data.map(t=>this.serializedNodeToGroupLayoutArgument(t))}:{size:e.size}}shouldRestoreFocus(e){return e?cu()===e.ownerDocument.body?!0:iv(e):!1}isTwoDimensionalGrid(){const e=this.gridWidget.getViews();return $s(e)?e.children.some(t=>$s(t)):!1}addGroup(e,t,i){const s=this.assertGroupView(e);let o;if(s.groupsView===this){const n=this.shouldRestoreFocus(s.element),r=this.groupViews.size>1&&this.isGroupExpanded(s);o=this.doCreateGroupView(i),this.gridWidget.addView(o,this.getSplitSizingStyle(),s,this.toGridViewDirection(t)),this.updateContainer(),this._onDidAddGroup.fire(o),this.notifyGroupIndexChange(),r&&this.arrangeGroups(ms.EXPAND,o),n&&s.focus()}else o=s.groupsView.addGroup(s,t,i);return o}getSplitSizingStyle(){switch(this._partOptions.splitSizing){case"distribute":return Vo.Distribute;case"split":return Vo.Split;default:return Vo.Auto}}doCreateGroupView(e,t){let i;e instanceof Gr?i=Gr.createCopy(e,this.editorPartsView,this,this.groupsLabel,this.count,this.scopedInstantiationService,t):BS(e)?i=Gr.createFromSerialized(e,this.editorPartsView,this,this.groupsLabel,this.count,this.scopedInstantiationService,t):i=Gr.createNew(this.editorPartsView,this,this.groupsLabel,this.count,this.scopedInstantiationService,t),this.groupViews.set(i.id,i);const s=new O;return s.add(i.onDidFocus(()=>{this.doSetGroupActive(i),this._onDidFocus.fire()})),s.add(i.onDidModelChange(o=>{switch(o.kind){case ea.GROUP_LOCKED:this._onDidChangeGroupLocked.fire(i);break;case ea.GROUP_INDEX:this._onDidChangeGroupIndex.fire(i);break;case ea.GROUP_LABEL:this._onDidChangeGroupLabel.fire(i);break}})),s.add(i.onDidActiveEditorChange(()=>{this.updateContainer()})),V.once(i.onWillDispose)(()=>{qe(s),this.groupViews.delete(i.id),this.doUpdateMostRecentActive(i)}),i}doSetGroupActive(e){if(this._activeGroup!==e){const t=this._activeGroup;this._activeGroup=e,this.doUpdateMostRecentActive(e,!0),t&&!t.disposed&&t.setActive(!1),e.setActive(!0),this.doRestoreGroup(e),this._onDidChangeActiveGroup.fire(e)}this._onDidActivateGroup.fire(e)}doRestoreGroup(e){if(this.gridWidget)try{this.hasMaximizedGroup()&&!this.isGroupMaximized(e)&&this.unmaximizeGroup();const t=this.gridWidget.getViewSize(e);(t.width===e.minimumWidth||t.height===e.minimumHeight)&&this.arrangeGroups(ms.EXPAND,e)}catch{}}doUpdateMostRecentActive(e,t){const i=this.mostRecentActiveGroups.indexOf(e.id);i!==-1&&this.mostRecentActiveGroups.splice(i,1),t&&this.mostRecentActiveGroups.unshift(e.id)}toGridViewDirection(e){switch(e){case we.UP:return de.Up;case we.DOWN:return de.Down;case we.LEFT:return de.Left;case we.RIGHT:return de.Right}}toGridViewOrientation(e,t){return typeof e=="number"?e===go.HORIZONTAL?J.HORIZONTAL:J.VERTICAL:t}removeGroup(e,t){const i=this.assertGroupView(e);this.count!==1&&(i.isEmpty?this.doRemoveEmptyGroup(i,t):this.doRemoveGroupWithEditors(i))}doRemoveGroupWithEditors(e){const t=this.getGroups(Ge.MOST_RECENTLY_ACTIVE);let i;this._activeGroup===e?i=t[1]:i=t[0],this.mergeGroup(e,i)}doRemoveEmptyGroup(e,t){const i=!t&&this.shouldRestoreFocus(this.container);if(this._activeGroup===e){const o=this.getGroups(Ge.MOST_RECENTLY_ACTIVE)[1];this.doSetGroupActive(o)}this.gridWidget.removeView(e,this.getSplitSizingStyle()),e.dispose(),i&&this._activeGroup.focus(),this.notifyGroupIndexChange(),this.updateContainer(),this._onDidRemoveGroup.fire(e)}moveGroup(e,t,i){const s=this.assertGroupView(e),o=this.assertGroupView(t);if(s.id===o.id)throw new Error("Cannot move group into its own");const n=this.shouldRestoreFocus(s.element);let r;return s.groupsView===o.groupsView?(this.gridWidget.moveView(s,this.getSplitSizingStyle(),o,this.toGridViewDirection(i)),r=s):(r=o.groupsView.addGroup(o,i,s),s.closeAllEditors(),this.removeGroup(s,n)),n&&r.focus(),this._onDidMoveGroup.fire(r),this.notifyGroupIndexChange(),r}copyGroup(e,t,i){const s=this.assertGroupView(e),o=this.assertGroupView(t),n=this.shouldRestoreFocus(s.element),r=this.addGroup(o,i,s);return n&&r.focus(),r}mergeGroup(e,t,i){const s=this.assertGroupView(e),o=this.assertGroupView(t),n=[];let r=i&&typeof i.index=="number"?i.index:o.count;for(const l of s.editors){const h=!s.isActive(l)||this._activeGroup!==s;let p;o.contains(l)&&(o.isSticky(l)||i?.preserveExistingIndex)||(p=r,r++),n.push({editor:l,options:{index:p,inactive:h,preserveFocus:h}})}let d=!0;return i?.mode===Rw.COPY_EDITORS?s.copyEditors(n,o):d=s.moveEditors(n,o),s.isEmpty&&!s.disposed&&this.removeGroup(s,!0),d}mergeAllGroups(e,t){const i=this.assertGroupView(e);let s=!0;for(const o of this.getGroups(Ge.MOST_RECENTLY_ACTIVE)){if(o===i)continue;this.mergeGroup(o,i,t)||(s=!1)}return s}assertGroupView(e){let t;if(typeof e=="number"?t=this.editorPartsView.getGroup(e):t=e,!t)throw new Error("Invalid editor group provided!");return t}createEditorDropTarget(e,t){return sv(No(e)),this.scopedInstantiationService.createInstance(fl,e,t)}get minimumWidth(){return Math.min(this.centeredLayoutWidget.minimumWidth,this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(St(this.container))).width)}get maximumWidth(){return this.centeredLayoutWidget.maximumWidth}get minimumHeight(){return Math.min(this.centeredLayoutWidget.minimumHeight,this.layoutService.getMaximumEditorDimensions(this.layoutService.getContainer(St(this.container))).height)}get maximumHeight(){return this.centeredLayoutWidget.maximumHeight}get snap(){return this.layoutService.getPanelAlignment()==="center"}get onDidChange(){return V.any(this.centeredLayoutWidget.onDidChange,this.onDidSetGridWidget.event)}get gridSeparatorBorder(){return this.theme.getColor(FS)||this.theme.getColor(As)||si.transparent}updateStyles(){const e=Se(this.container);e.style.backgroundColor=this.getColor(ov)||"";const t={separatorBorder:this.gridSeparatorBorder,background:this.theme.getColor(KS)||si.transparent};this.gridWidget.style(t),this.centeredLayoutWidget.styles(t)}createContentArea(e,t){this.element=e,this.container=B(".content"),this.windowId!==re.vscodeWindowId&&this.container.classList.add("auxiliary"),e.appendChild(this.container);const i=this._register(this.contextKeyService.createScoped(this.container));return this.scopedInstantiationService=this._register(this.instantiationService.createChild(new hd([se,i]))),this._willRestoreState=!t||t.restorePreviousState,this.doCreateGridControl(),this.centeredLayoutWidget=this._register(new EA(this.container,this.gridWidgetView,this.profileMemento[zi.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY],this._partOptions.centeredLayoutFixedWidth)),this._register(this.onDidChangeEditorPartOptions(s=>this.centeredLayoutWidget.setFixedWidth(s.newPartOptions.centeredLayoutFixedWidth??!1))),this.setupDragAndDropSupport(e,this.container),this.handleContextKeys(i),this.whenReadyPromise.complete(),this._isReady=!0,lu.settled(this.groups.map(s=>s.whenRestored)).finally(()=>{this.whenRestoredPromise.complete()}),this.container}handleContextKeys(e){an.bindTo(e).set(this.windowId!==re.vscodeWindowId);const i=Nu.bindTo(e),s=Bu.bindTo(e),o=()=>{this.count>1?i.set(!0):i.reset(),this.hasMaximizedGroup()?s.set(!0):s.reset()};o(),this._register(this.onDidAddGroup(()=>o())),this._register(this.onDidRemoveGroup(()=>o())),this._register(this.onDidChangeGroupMaximized(()=>o()))}setupDragAndDropSupport(e,t){this._register(this.createEditorDropTarget(t,Object.create(null)));const i=B(".drop-block-overlay");e.appendChild(i),this._register(nv(i,()=>i.classList.remove("visible"))),this._register(wa.INSTANCE.registerTarget(this.element,{onDragStart:h=>i.classList.add("visible"),onDragEnd:h=>i.classList.remove("visible")}));let s,o,n,r;const d=h=>{!this.layoutService.isVisible(M.PANEL_PART)&&h===this.layoutService.getPanelPosition()?this.layoutService.setPartHidden(!1,M.PANEL_PART):!this.layoutService.isVisible(M.AUXILIARYBAR_PART)&&h===(this.layoutService.getSideBarPosition()===Ot.RIGHT?Ot.LEFT:Ot.RIGHT)&&this.layoutService.setPartHidden(!1,M.AUXILIARYBAR_PART)},l=()=>{s&&(clearTimeout(s),s=void 0),o&&(clearTimeout(o),o=void 0)};this._register(wa.INSTANCE.registerTarget(i,{onDragOver:h=>{ke.stop(h.eventData,!0),h.eventData.dataTransfer&&(h.eventData.dataTransfer.dropEffect="none");const p=i.getBoundingClientRect();let f,g;const m=100;h.eventData.clientX<p.left+m&&(f=Ot.LEFT),h.eventData.clientX>p.right-m&&(f=Ot.RIGHT),h.eventData.clientY>p.bottom-m&&(g=Ot.BOTTOM),h.eventData.clientY<p.top+m&&(g=Ot.TOP),s&&f!==n&&(clearTimeout(s),s=void 0),o&&g!==r&&(clearTimeout(o),o=void 0),!s&&f!==void 0&&(n=f,s=setTimeout(()=>d(f),200)),!o&&g!==void 0&&(r=g,o=setTimeout(()=>d(g),200))},onDragLeave:()=>l(),onDragEnd:()=>l(),onDrop:()=>l()}))}centerLayout(e){this.centeredLayoutWidget.activate(e)}isLayoutCentered(){return this.centeredLayoutWidget?this.centeredLayoutWidget.isActive():!1}doCreateGridControl(){let e=!1;if(this._willRestoreState&&(e=!this.doCreateGridControlWithPreviousState()),!this.gridWidget||e){const t=this.doCreateGroupView();this.doSetGridWidget(new Ss(t)),this.doSetGroupActive(t)}this.updateContainer(),this.notifyGroupIndexChange()}doCreateGridControlWithPreviousState(){const e=this.loadState();if(e?.serializedGrid)try{this.mostRecentActiveGroups=e.mostRecentActiveGroups,this.doCreateGridControlWithState(e.serializedGrid,e.activeGroup)}catch(t){return Bo(new Error(`Error restoring editor grid widget: ${t} (with state: ${JSON.stringify(e)})`)),this.disposeGroups(),!1}return!0}doCreateGridControlWithState(e,t,i,s){let o;i?o=i.slice(0):o=[];const n=[],r=Ss.deserialize(e,{fromJSON:d=>{let l;return o.length>0?l=o.shift():l=this.doCreateGroupView(d,s),n.push(l),l.id===t&&this.doSetGroupActive(l),l}},{styles:{separatorBorder:this.gridSeparatorBorder}});this._activeGroup||this.doSetGroupActive(n[0]),this.mostRecentActiveGroups.some(d=>!this.getGroup(d))&&(this.mostRecentActiveGroups=n.map(d=>d.id)),this.doSetGridWidget(r)}doSetGridWidget(e){let t={};this.gridWidget&&(t=this.gridWidget.boundarySashes,this.gridWidget.dispose()),this.gridWidget=e,this.gridWidget.boundarySashes=t,this.gridWidgetView.gridWidget=e,this._onDidChangeSizeConstraints.input=e.onDidChange,this._onDidScroll.input=e.onDidScroll,this.gridWidgetDisposables.clear(),this.gridWidgetDisposables.add(e.onDidChangeViewMaximized(i=>this._onDidChangeGroupMaximized.fire(i))),this.onDidSetGridWidget.fire(void 0)}updateContainer(){Se(this.container).classList.toggle("empty",this.isEmpty)}notifyGroupIndexChange(){this.getGroups(Ge.GRID_APPEARANCE).forEach((e,t)=>e.notifyIndexChanged(t))}notifyGroupsLabelChange(e){for(const t of this.groups)t.notifyLabelChanged(e)}get isEmpty(){return this.count===1&&this._activeGroup.isEmpty}setBoundarySashes(e){this.gridWidget.boundarySashes=e,this.centeredLayoutWidget.boundarySashes=e}layout(e,t,i,s){this.top=i,this.left=s;const o=super.layoutContents(e,t).contentSize;this.doLayout(jt.lift(o),i,s)}doLayout(e,t=this.top,i=this.left){this._contentDimension=e,this.centeredLayoutWidget.layout(this._contentDimension.width,this._contentDimension.height,t,i),this._onDidLayout.fire(e)}saveState(){if(this.gridWidget&&(this.isEmpty?delete this.workspaceMemento[zi.EDITOR_PART_UI_STATE_STORAGE_KEY]:this.workspaceMemento[zi.EDITOR_PART_UI_STATE_STORAGE_KEY]=this.createState()),this.centeredLayoutWidget){const e=this.centeredLayoutWidget.state;this.centeredLayoutWidget.isDefault(e)?delete this.profileMemento[zi.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY]:this.profileMemento[zi.EDITOR_PART_CENTERED_VIEW_STORAGE_KEY]=e}super.saveState()}loadState(){return this.workspaceMemento[zi.EDITOR_PART_UI_STATE_STORAGE_KEY]}createState(){return{serializedGrid:this.gridWidget.serialize(),activeGroup:this._activeGroup.id,mostRecentActiveGroups:this.mostRecentActiveGroups}}applyState(e,t){return e==="empty"?this.doApplyEmptyState():this.doApplyState(e,t)}async doApplyState(e,t){const i=await this.doPrepareApplyState();this._onDidAddGroup.pause(),this._onDidRemoveGroup.pause(),this.disposeGroups(),this.mostRecentActiveGroups=e.mostRecentActiveGroups;try{this.doApplyGridState(e.serializedGrid,e.activeGroup,void 0,t)}finally{this._onDidRemoveGroup.resume(),this._onDidAddGroup.resume()}await this.activeGroup.openEditors(i.flatMap(s=>s.editors).filter(s=>this.editorPartsView.groups.every(o=>!o.contains(s))).map(s=>({editor:s,options:{pinned:!0,preserveFocus:!0,inactive:!0}})))}async doApplyEmptyState(){await this.doPrepareApplyState(),this.mergeAllGroups(this.activeGroup)}async doPrepareApplyState(){const e=this.getGroups(Ge.MOST_RECENTLY_ACTIVE);for(const t of e)await t.closeAllEditors({excludeConfirming:!0});return e}doApplyGridState(e,t,i,s){this.doCreateGridControlWithState(e,t,i,s),this.doLayout(this._contentDimension),this.updateContainer();for(const o of this.getGroups(Ge.GRID_APPEARANCE))i?.includes(o)||this._onDidAddGroup.fire(o);this.notifyGroupIndexChange()}onDidChangeMementoState(e){if(e.external&&e.scope===G.WORKSPACE){this.reloadMemento(e.scope);const t=this.loadState();t&&this.applyState(t)}}toJSON(){return{type:M.EDITOR_PART}}disposeGroups(){for(const e of this.groups)e.dispose(),this._onDidRemoveGroup.fire(e);this.groupViews.clear(),this.mostRecentActiveGroups=[]}dispose(){this._onWillDispose.fire(),this.disposeGroups(),this.gridWidget?.dispose(),super.dispose()}};Ea=zi=D([u(4,F),u(5,me),u(6,ie),u(7,ce),u(8,ze),u(9,Zt),u(10,se)],Ea);let ml=class extends Ea{constructor(e,t,i,s,o,n,r,d){super(e,M.EDITOR_PART,"",re.vscodeWindowId,t,i,s,o,n,r,d)}};ml=D([u(1,F),u(2,me),u(3,ie),u(4,ce),u(5,ze),u(6,Zt),u(7,se)],ml);const DA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var mo;Pe(DA);let wl=class extends Qn{static{mo=this}static{this.activeViewSettingsKey="workbench.auxiliarybar.activepanelid"}static{this.pinnedViewsKey="workbench.auxiliarybar.pinnedPanels"}static{this.placeholdeViewContainersKey="workbench.auxiliarybar.placeholderPanels"}static{this.viewContainersWorkspaceStateKey="workbench.auxiliarybar.viewContainersWorkspaceState"}get preferredHeight(){return this.layoutService.mainContainerDimension.height*.4}get preferredWidth(){const e=this.getActivePaneComposite();if(!e)return;const t=e.getOptimalWidth();if(typeof t=="number")return Math.max(t,300)}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m){super(M.AUXILIARYBAR_PART,{hasTitle:!0,borderWidth:()=>this.getColor(ya)||this.getColor(As)?1:0},mo.activeViewSettingsKey,ED.bindTo(h),ID.bindTo(h),"auxiliarybar","auxiliarybar",void 0,pm,e,t,i,s,o,n,r,d,l,h,p,g),this.commandService=f,this.configurationService=m,this.minimumWidth=170,this.maximumWidth=Number.POSITIVE_INFINITY,this.minimumHeight=0,this.maximumHeight=Number.POSITIVE_INFINITY,this.priority=xi.Low,this.configuration=this.resolveConfiguration(),this._register(m.onDidChangeConfiguration(v=>{v.affectsConfiguration(Kt.ACTIVITY_BAR_LOCATION)?(this.configuration=this.resolveConfiguration(),this.onDidChangeActivityBarLocation()):v.affectsConfiguration("workbench.secondarySideBar.showLabels")&&(this.configuration=this.resolveConfiguration(),this.updateCompositeBar(!0))}))}resolveConfiguration(){const e=this.configurationService.getValue(Kt.ACTIVITY_BAR_LOCATION),t=e!==Oe.TOP,i=t&&this.configurationService.getValue("workbench.secondarySideBar.showLabels")!==!1;return{position:e,canShowLabels:t,showLabels:i}}onDidChangeActivityBarLocation(){this.updateCompositeBar();const e=this.getActiveComposite()?.getId();e&&this.onTitleAreaUpdate(e)}updateStyles(){super.updateStyles();const e=Se(this.getContainer());e.style.backgroundColor=this.getColor(xo)||"";const t=this.getColor(ya)||this.getColor(As),i=this.layoutService.getSideBarPosition()===Ot.RIGHT;e.style.color=this.getColor(gm)||"",e.style.borderLeftColor=t??"",e.style.borderRightColor=t??"",e.style.borderLeftStyle=t&&!i?"solid":"none",e.style.borderRightStyle=t&&i?"solid":"none",e.style.borderLeftWidth=t&&!i?"1px":"0px",e.style.borderRightWidth=t&&i?"1px":"0px"}getCompositeBarOptions(){const e=this;return{partContainerClass:"auxiliarybar",pinnedViewContainersKey:mo.pinnedViewsKey,placeholderViewContainersKey:mo.placeholdeViewContainersKey,viewContainersWorkspaceStateKey:mo.viewContainersWorkspaceStateKey,icon:!this.configuration.showLabels,orientation:Zs.HORIZONTAL,recomputeSizes:!0,activityHoverOptions:{position:()=>this.getCompositeBarPosition()===fe.BOTTOM?Oo.ABOVE:Oo.BELOW},fillExtraContextMenuActions:t=>this.fillExtraContextMenuActions(t),compositeSize:0,iconSize:16,get overflowActionSize(){return e.getCompositeBarPosition()===fe.TITLE?40:30},colors:t=>({activeBackgroundColor:t.getColor(xo),inactiveBackgroundColor:t.getColor(xo),get activeBorderBottomColor(){return e.getCompositeBarPosition()===fe.TITLE?t.getColor(Em):t.getColor(bm)},get activeForegroundColor(){return e.getCompositeBarPosition()===fe.TITLE?t.getColor(_m):t.getColor(vm)},get inactiveForegroundColor(){return e.getCompositeBarPosition()===fe.TITLE?t.getColor(Sm):t.getColor(ym)},badgeBackground:t.getColor(wm),badgeForeground:t.getColor(mm),get dragAndDropBorder(){return e.getCompositeBarPosition()===fe.TITLE?t.getColor(Cm):t.getColor(fm)}}),compact:!0}}fillExtraContextMenuActions(e){const t=this.layoutService.getSideBarPosition()===Ot.LEFT;if(this.getCompositeBarPosition()===fe.TITLE){const n=this.getViewsSubmenuAction();n&&(e.push(new ss),e.push(n))}const i=this.menuService.getMenuActions(w.ActivityBarPositionMenu,this.contextKeyService,{shouldForwardArgs:!0,renderShortTitle:!0}),s=da(i).secondary,o=es({id:"workbench.action.auxiliarybar.toggleShowLabels",label:this.configuration.showLabels?c(2857,"Show Icons"):c(2858,"Show Labels"),enabled:this.configuration.canShowLabels,run:()=>this.configurationService.updateValue("workbench.secondarySideBar.showLabels",!this.configuration.showLabels)});e.push(new ss,new aa("workbench.action.panel.position",c(2859,"Activity Bar Position"),s),es({id:qp.ID,label:t?c(2860,"Move Secondary Side Bar Left"):c(2861,"Move Secondary Side Bar Right"),run:()=>this.commandService.executeCommand(qp.ID)}),o,es({id:cc.ID,label:c(2862,"Hide Secondary Side Bar"),run:()=>this.commandService.executeCommand(cc.ID)}))}shouldShowCompositeBar(){return this.configuration.position!==Oe.HIDDEN}getCompositeBarPosition(){switch(this.configuration.position){case Oe.TOP:return fe.TOP;case Oe.BOTTOM:return fe.BOTTOM;case Oe.HIDDEN:return fe.TITLE;case Oe.DEFAULT:return fe.TITLE;default:return fe.TITLE}}createHeaderArea(){const e=super.createHeaderArea(),t=B(".auxiliary-bar-global-header"),i=this.headerFooterCompositeBarDispoables.add(this.instantiationService.createInstance(hm,w.AuxiliaryBarHeader,void 0,void 0)),s=this.headerFooterCompositeBarDispoables.add(this.instantiationService.createInstance(Wu,t,{actionViewItemProvider:(o,n)=>this.headerActionViewItemProvider(o,n),orientation:Zs.HORIZONTAL,hiddenItemStrategy:Ww.NoHide,getKeyBinding:o=>this.keybindingService.lookupKeybinding(o.id)}));return s.setActions(Po(i.getPrimaryActions())),this.headerFooterCompositeBarDispoables.add(i.onDidChange(()=>s.setActions(Po(i.getPrimaryActions())))),e.appendChild(t),e}headerActionViewItemProvider(e,t){if(e.id===cc.ID)return this.instantiationService.createInstance(hu,void 0,e,t)}toJSON(){return{type:M.AUXILIARYBAR_PART}}};wl=mo=D([u(0,Ke),u(1,ce),u(2,at),u(3,ze),u(4,it),u(5,At),u(6,F),u(7,me),u(8,Ye),u(9,se),u(10,kt),u(11,wt),u(12,ps),u(13,ie)],wl);var wo,yl;const Ud=rv(new E);C(class extends X{constructor(){super({id:"workbench.action.toggleCompactAuxiliaryWindow",title:x(2881,"Toggle Window Compact Mode"),category:xe.View,f1:!0,precondition:DD})}async run(){Ud.fire({windowId:eo().vscodeWindowId,compact:"toggle"})}});C(class extends X{constructor(){super({id:"workbench.action.enableCompactAuxiliaryWindow",title:c(2882,"Set Compact Mode"),icon:k.screenFull,menu:{id:w.LayoutControlMenu,when:I.and(Qc,el.toNegated()),order:0}})}async run(){Ud.fire({windowId:eo().vscodeWindowId,compact:!0})}});C(class extends X{constructor(){super({id:"workbench.action.disableCompactAuxiliaryWindow",title:c(2883,"Unset Compact Mode"),icon:k.screenNormal,toggled:I.and(Qc,el),menu:{id:w.LayoutControlMenu,when:I.and(Qc,el),order:0}})}async run(){Ud.fire({windowId:eo().vscodeWindowId,compact:!1})}});let vl=class{static{wo=this}static{this.STATUS_BAR_VISIBILITY="workbench.statusBar.visible"}constructor(e,t,i,s,o,n,r,d,l){this.editorPartsView=e,this.instantiationService=t,this.auxiliaryWindowService=i,this.lifecycleService=s,this.configurationService=o,this.statusbarService=n,this.titleService=r,this.editorService=d,this.layoutService=l}async create(e,t){const i=this,s=new O;let o=!!t?.compact;function n(){let L=0;return A&&(L+=b.height),g&&m&&(L+=g.height),L}function r(L){A?jn(b.container):qn(b.container),L&&h.layout()}function d(L){g&&(m?jn(g.container):qn(g.container),L&&h.layout())}function l(L){if(L===o)return;o=L,h.updateOptions({compact:o}),g?.updateOptions({compact:o}),f.updateOptions({compact:o});const $=A;A=!o&&i.configurationService.getValue(wo.STATUS_BAR_VISIBILITY)!==!1,$!==A&&r(!0)}const h=s.add(await this.auxiliaryWindowService.open(t)),p=B(".part.editor",{role:"main"});p.style.position="relative",h.container.appendChild(p);const f=s.add(this.instantiationService.createInstance(bl,h.window.vscodeWindowId,this.editorPartsView,t?.state,e));f.updateOptions({compact:o}),s.add(this.editorPartsView.registerPart(f)),f.create(p);let g,m=!1;if(av&&dv()){g=s.add(this.titleService.createAuxiliaryTitlebarPart(h.container,f)),g.updateOptions({compact:o}),m=Sg(this.configurationService,h.window,void 0);const L=()=>{const $=m;m=Sg(this.configurationService,h.window,void 0),$!==m&&d(!0)};s.add(g.onDidChange(()=>h.layout())),s.add(this.layoutService.onDidChangePartVisibility(()=>L())),s.add(mf($=>{$===h.window.vscodeWindowId&&L()})),d(!1)}else s.add(this.instantiationService.createInstance(WS,h.window,f));const b=s.add(this.statusbarService.createAuxiliaryStatusbarPart(h.container));let A=!o&&this.configurationService.getValue(wo.STATUS_BAR_VISIBILITY)!==!1;s.add(this.configurationService.onDidChangeConfiguration(L=>{L.affectsConfiguration(wo.STATUS_BAR_VISIBILITY)&&(A=!o&&this.configurationService.getValue(wo.STATUS_BAR_VISIBILITY)!==!1,r(!0))})),r(!1);const K=s.add(V.once(f.onWillClose)(()=>h.window.close()));s.add(V.once(h.onUnload)(()=>{s.isDisposed||(K.dispose(),f.close(),s.dispose())})),s.add(V.once(this.lifecycleService.onDidShutdown)(()=>s.dispose())),s.add(h.onBeforeUnload(L=>{for(const $ of f.groups)for(const z of $.editors){const Z=z.canMove($.id,this.editorPartsView.mainPart.activeGroup.id);if(typeof Z=="string"){$.openEditor(z),L.veto(Z);break}}})),s.add(h.onWillLayout(L=>{const $=g?.height??0;g?.layout(L.width,$,0,0);const z=L.height-n();f.layout(L.width,z,$,0),b.layout(L.width,b.height,L.height-b.height,0)})),h.layout(),s.add(Ud.event(L=>{if(L.windowId===h.window.vscodeWindowId){let $;typeof L.compact=="boolean"?$=L.compact:$=!o,l($)}}));const P=s.add(this.instantiationService.createChild(new hd([Rs,this.statusbarService.createScoped(b,s)],[Q,this.editorService.createScoped(f,s)])));return{part:f,instantiationService:P,disposables:s}}};vl=wo=D([u(1,F),u(2,Du),u(3,qo),u(4,ie),u(5,Rs),u(6,GS),u(7,Q),u(8,ze)],vl);let bl=class extends Ea{static{yl=this}static{this.COUNTER=1}constructor(e,t,i,s,o,n,r,d,l,h,p){const f=yl.COUNTER++;super(t,`workbench.parts.auxiliaryEditor.${f}`,s,e,o,n,r,d,l,h,p),this.state=i,this._onWillClose=this._register(new E),this.onWillClose=this._onWillClose.event,this.optionsDisposable=this._register(new Ie)}updateOptions(e){e.compact&&!this.optionsDisposable.value?this.optionsDisposable.value=this.enforcePartOptions({showTabs:"none"}):e.compact||this.optionsDisposable.clear()}removeGroup(e,t){const i=this.assertGroupView(e);this.count===1&&this.activeGroup===i?this.doRemoveLastGroup(t):super.removeGroup(e,t)}doRemoveLastGroup(e){const t=!e&&this.shouldRestoreFocus(this.container),s=this.editorPartsView.getGroups(Ge.MOST_RECENTLY_ACTIVE)[1];s&&(s.groupsView.activateGroup(s),t&&s.focus()),this.doClose(!1)}loadState(){return this.state}saveState(){}close(){return this.doClose(!0)}doClose(e){let t=!0;if(e){for(const i of this.groups)i.closeAllEditors({excludeConfirming:!0});t=this.mergeGroupsToMainPart()}return this._onWillClose.fire(),t}mergeGroupsToMainPart(){if(!this.groups.some(i=>i.count>0))return!0;let e;for(const i of this.editorPartsView.mainPart.getGroups(Ge.MOST_RECENTLY_ACTIVE))if(!i.isLocked){e=i;break}e||(e=this.editorPartsView.mainPart.addGroup(this.editorPartsView.mainPart.activeGroup,this.partOptions.openSideBySideDirection==="right"?we.RIGHT:we.DOWN));const t=this.mergeAllGroups(e,{preserveExistingIndex:!0});return e.focus(),t}};bl=yl=D([u(4,F),u(5,me),u(6,ie),u(7,ce),u(8,ze),u(9,Zt),u(10,se)],bl);var Bs;let Lg=class extends US{static{Bs=this}constructor(e,t,i,s,o){super("workbench.editorParts",i,t),this.instantiationService=e,this.storageService=t,this.auxiliaryWindowService=s,this.contextKeyService=o,this.mapPartToInstantiationService=new Map,this._onDidCreateAuxiliaryEditorPart=this._register(new E),this.onDidCreateAuxiliaryEditorPart=this._onDidCreateAuxiliaryEditorPart.event,this.workspaceMemento=this.getMemento(G.WORKSPACE,Re.USER),this._isReady=!1,this.whenReadyPromise=new Xs,this.whenReady=this.whenReadyPromise.p,this.whenRestoredPromise=new Xs,this.whenRestored=this.whenRestoredPromise.p,this.editorWorkingSets=(()=>{const n=this.storageService.get(Bs.EDITOR_WORKING_SETS_STORAGE_KEY,G.WORKSPACE);return n?JSON.parse(n):[]})(),this._onDidActiveGroupChange=this._register(new E),this.onDidChangeActiveGroup=this._onDidActiveGroupChange.event,this._onDidAddGroup=this._register(new E),this.onDidAddGroup=this._onDidAddGroup.event,this._onDidRemoveGroup=this._register(new E),this.onDidRemoveGroup=this._onDidRemoveGroup.event,this._onDidMoveGroup=this._register(new E),this.onDidMoveGroup=this._onDidMoveGroup.event,this._onDidActivateGroup=this._register(new E),this.onDidActivateGroup=this._onDidActivateGroup.event,this._onDidChangeGroupIndex=this._register(new E),this.onDidChangeGroupIndex=this._onDidChangeGroupIndex.event,this._onDidChangeGroupLocked=this._register(new E),this.onDidChangeGroupLocked=this._onDidChangeGroupLocked.event,this._onDidChangeGroupMaximized=this._register(new E),this.onDidChangeGroupMaximized=this._onDidChangeGroupMaximized.event,this.globalContextKeys=new Map,this.scopedContextKeys=new Map,this.contextKeyProviders=new Map,this.registeredContextKeys=new Map,this.contextKeyProviderDisposables=this._register(new ca),this.mainPart=this._register(this.createMainEditorPart()),this._register(this.registerPart(this.mainPart)),this.mostRecentActiveParts=[this.mainPart],this.restoreParts(),this.registerListeners()}registerListeners(){this._register(this.onDidChangeMementoValue(G.WORKSPACE,this._store)(e=>this.onDidChangeMementoState(e))),this.whenReady.then(()=>this.registerGroupsContextKeyListeners())}createMainEditorPart(){return this.instantiationService.createInstance(ml,this)}getScopedInstantiationService(e){return e===this.mainPart&&(this.mapPartToInstantiationService.has(e.windowId)||this.instantiationService.invokeFunction(t=>{const i=t.get(Q);this.mapPartToInstantiationService.set(e.windowId,this._register(this.instantiationService.createChild(new hd([Q,i.createScoped("main",this._store)]))))})),this.mapPartToInstantiationService.get(e.windowId)??this.instantiationService}async createAuxiliaryEditorPart(e){const{part:t,instantiationService:i,disposables:s}=await this.instantiationService.createInstance(vl,this).create(this.getGroupsLabel(this._parts.size),e);return this.mapPartToInstantiationService.set(t.windowId,i),s.add(ae(()=>this.mapPartToInstantiationService.delete(t.windowId))),this._onDidAddGroup.fire(t.activeGroup),this._onDidCreateAuxiliaryEditorPart.fire(t),t}registerPart(e){const t=this._register(new O);return t.add(super.registerPart(e)),this.registerEditorPartListeners(e,t),t}unregisterPart(e){super.unregisterPart(e),this.parts.forEach((t,i)=>{t!==this.mainPart&&t.notifyGroupsLabelChange(this.getGroupsLabel(i))})}registerEditorPartListeners(e,t){t.add(e.onDidFocus(()=>{this.doUpdateMostRecentActive(e,!0),this._parts.size>1&&this._onDidActiveGroupChange.fire(this.activeGroup)})),t.add(ae(()=>this.doUpdateMostRecentActive(e))),t.add(e.onDidChangeActiveGroup(i=>this._onDidActiveGroupChange.fire(i))),t.add(e.onDidAddGroup(i=>this._onDidAddGroup.fire(i))),t.add(e.onDidRemoveGroup(i=>this._onDidRemoveGroup.fire(i))),t.add(e.onDidMoveGroup(i=>this._onDidMoveGroup.fire(i))),t.add(e.onDidActivateGroup(i=>this._onDidActivateGroup.fire(i))),t.add(e.onDidChangeGroupMaximized(i=>this._onDidChangeGroupMaximized.fire(i))),t.add(e.onDidChangeGroupIndex(i=>this._onDidChangeGroupIndex.fire(i))),t.add(e.onDidChangeGroupLocked(i=>this._onDidChangeGroupLocked.fire(i)))}doUpdateMostRecentActive(e,t){const i=this.mostRecentActiveParts.indexOf(e);i!==-1&&this.mostRecentActiveParts.splice(i,1),t&&this.mostRecentActiveParts.unshift(e)}getGroupsLabel(e){return c(3249,"Window {0}",e+1)}getPart(e){if(this._parts.size>1)if(No(e)){const t=e;return this.getPartByDocument(t.ownerDocument)}else{const t=e;let i;typeof t=="number"?i=t:i=t.id;for(const s of this._parts)if(s.hasGroup(i))return s}return this.mainPart}static{this.EDITOR_PARTS_UI_STATE_STORAGE_KEY="editorparts.state"}get isReady(){return this._isReady}async restoreParts(){if(await this.mainPart.whenReady,this.mainPart.willRestoreState){const t=this.loadState();t&&await this.restoreState(t)}this.mostRecentActiveParts.at(0)?.activeGroup.focus(),this._isReady=!0,this.whenReadyPromise.complete(),await Promise.allSettled(this.parts.map(t=>t.whenRestored)),this.whenRestoredPromise.complete()}loadState(){return this.workspaceMemento[Bs.EDITOR_PARTS_UI_STATE_STORAGE_KEY]}saveState(){const e=this.createState();e.auxiliary.length===0?delete this.workspaceMemento[Bs.EDITOR_PARTS_UI_STATE_STORAGE_KEY]:this.workspaceMemento[Bs.EDITOR_PARTS_UI_STATE_STORAGE_KEY]=e}createState(){return{auxiliary:this.parts.filter(e=>e!==this.mainPart).map(e=>{const t=this.auxiliaryWindowService.getWindow(e.windowId);return{state:e.createState(),...t?.createState()}}),mru:this.mostRecentActiveParts.map(e=>this.parts.indexOf(e))}}async restoreState(e){if(e.auxiliary.length){const t=[];for(const i of e.auxiliary)t.push(this.createAuxiliaryEditorPart(i));await Promise.allSettled(t),e.mru.length===this.parts.length?this.mostRecentActiveParts=e.mru.map(i=>this.parts[i]):this.mostRecentActiveParts=[...this.parts],await Promise.allSettled(this.parts.map(i=>i.whenReady))}}get hasRestorableState(){return this.parts.some(e=>e.hasRestorableState)}onDidChangeMementoState(e){if(e.external&&e.scope===G.WORKSPACE){this.reloadMemento(e.scope);const t=this.loadState();t&&this.applyState(t)}}async applyState(e){for(const t of this.parts){if(t===this.mainPart)continue;for(const s of t.getGroups(Ge.MOST_RECENTLY_ACTIVE))await s.closeAllEditors({excludeConfirming:!0});if(!t.close())return!1}return e!=="empty"&&await this.restoreState(e),!0}static{this.EDITOR_WORKING_SETS_STORAGE_KEY="editor.workingSets"}saveWorkingSet(e){const t={id:Yo(),name:e,main:this.mainPart.createState(),auxiliary:this.createState()};return this.editorWorkingSets.push(t),this.saveWorkingSets(),{id:t.id,name:t.name}}getWorkingSets(){return this.editorWorkingSets.map(e=>({id:e.id,name:e.name}))}deleteWorkingSet(e){const t=this.indexOfWorkingSet(e);typeof t=="number"&&(this.editorWorkingSets.splice(t,1),this.saveWorkingSets())}async applyWorkingSet(e,t){let i;if(e==="empty"?i="empty":i=this.editorWorkingSets[this.indexOfWorkingSet(e)??-1],!i||!await this.applyState(i==="empty"?i:i.auxiliary))return!1;if(await this.mainPart.applyState(i==="empty"?i:i.main,t),!t?.preserveFocus){const o=this.mostRecentActiveParts.at(0);o&&(await o.whenReady,o.activeGroup.focus())}return!0}indexOfWorkingSet(e){for(let t=0;t<this.editorWorkingSets.length;t++)if(this.editorWorkingSets[t].id===e.id)return t}saveWorkingSets(){this.storageService.store(Bs.EDITOR_WORKING_SETS_STORAGE_KEY,JSON.stringify(this.editorWorkingSets),G.WORKSPACE,Re.MACHINE)}get activeGroup(){return this.activePart.activeGroup}get sideGroup(){return this.activePart.sideGroup}get groups(){return this.getGroups()}get count(){return this.groups.length}getGroups(e=Ge.CREATION_TIME){if(this._parts.size>1){let t;switch(e){case Ge.GRID_APPEARANCE:case Ge.CREATION_TIME:t=this.parts;break;case Ge.MOST_RECENTLY_ACTIVE:t=Es([...this.mostRecentActiveParts,...this.parts]);break}return t.map(i=>i.getGroups(e)).flat()}return this.mainPart.getGroups(e)}getGroup(e){if(this._parts.size>1)for(const t of this._parts){const i=t.getGroup(e);if(i)return i}return this.mainPart.getGroup(e)}assertGroupView(e){let t;if(typeof e=="number"?t=this.getGroup(e):t=e,!t)throw new Error("Invalid editor group provided!");return t}activateGroup(e){return this.getPart(e).activateGroup(e)}getSize(e){return this.getPart(e).getSize(e)}setSize(e,t){this.getPart(e).setSize(e,t)}arrangeGroups(e,t=this.activePart.activeGroup){this.getPart(t).arrangeGroups(e,t)}toggleMaximizeGroup(e=this.activePart.activeGroup){this.getPart(e).toggleMaximizeGroup(e)}toggleExpandGroup(e=this.activePart.activeGroup){this.getPart(e).toggleExpandGroup(e)}restoreGroup(e){return this.getPart(e).restoreGroup(e)}applyLayout(e){this.activePart.applyLayout(e)}getLayout(){return this.activePart.getLayout()}get orientation(){return this.activePart.orientation}setGroupOrientation(e){this.activePart.setGroupOrientation(e)}findGroup(e,t=this.activeGroup,i){const s=this.getPart(t);if(this._parts.size>1){const o=this.getGroups(Ge.GRID_APPEARANCE);if(e.location===Nt.FIRST||e.location===Nt.LAST)return e.location===Nt.FIRST?o[0]:o[o.length-1];const n=s.findGroup(e,t,!1);if(n)return n;if(e.location===Nt.NEXT||e.location===Nt.PREVIOUS){const r=this.assertGroupView(t),d=o.indexOf(r);if(e.location===Nt.NEXT){let l=o[d+1];return!l&&i&&(l=o[0]),l}else{let l=o[d-1];return!l&&i&&(l=o[o.length-1]),l}}}return s.findGroup(e,t,i)}addGroup(e,t){return this.getPart(e).addGroup(e,t)}removeGroup(e){this.getPart(e).removeGroup(e)}moveGroup(e,t,i){return this.getPart(e).moveGroup(e,t,i)}mergeGroup(e,t,i){return this.getPart(e).mergeGroup(e,t,i)}mergeAllGroups(e,t){return this.activePart.mergeAllGroups(e,t)}copyGroup(e,t,i){return this.getPart(e).copyGroup(e,t,i)}createEditorDropTarget(e,t){return this.getPart(e).createEditorDropTarget(e,t)}registerGroupsContextKeyListeners(){this._register(this.onDidChangeActiveGroup(()=>this.updateGlobalContextKeys())),this.groups.forEach(e=>this.registerGroupContextKeyProvidersListeners(e)),this._register(this.onDidAddGroup(e=>this.registerGroupContextKeyProvidersListeners(e))),this._register(this.onDidRemoveGroup(e=>{this.scopedContextKeys.delete(e.id),this.registeredContextKeys.delete(e.id),this.contextKeyProviderDisposables.deleteAndDispose(e.id)}))}updateGlobalContextKeys(){const e=this.scopedContextKeys.get(this.activeGroup.id);if(e)for(const[t,i]of this.globalContextKeys){const s=e.get(t);s?i.set(s.get()):i.reset()}}bind(e,t){let i=this.globalContextKeys.get(e.key);i||(i=e.bindTo(this.contextKeyService),this.globalContextKeys.set(e.key,i));let s=this.scopedContextKeys.get(t.id);s||(s=new Map,this.scopedContextKeys.set(t.id,s));let o=s.get(e.key);o||(o=e.bindTo(t.scopedContextKeyService),s.set(e.key,o));const n=this;return{get(){return o.get()},set(r){n.activeGroup===t&&i.set(r),o.set(r)},reset(){n.activeGroup===t&&i.reset(),o.reset()}}}registerContextKeyProvider(e){if(this.contextKeyProviders.has(e.contextKey.key)||this.globalContextKeys.has(e.contextKey.key))throw new Error(`A context key provider for key ${e.contextKey.key} already exists.`);this.contextKeyProviders.set(e.contextKey.key,e);const t=()=>{for(const s of this.groups)this.updateRegisteredContextKey(s,e)};t();const i=e.onDidChange?.(()=>t());return ae(()=>{i?.dispose(),this.globalContextKeys.delete(e.contextKey.key),this.scopedContextKeys.forEach(s=>s.delete(e.contextKey.key)),this.contextKeyProviders.delete(e.contextKey.key),this.registeredContextKeys.forEach(s=>s.delete(e.contextKey.key))})}registerGroupContextKeyProvidersListeners(e){const t=e.onDidActiveEditorChange(()=>{for(const i of this.contextKeyProviders.values())this.updateRegisteredContextKey(e,i)});this.contextKeyProviderDisposables.set(e.id,t)}updateRegisteredContextKey(e,t){let i=this.registeredContextKeys.get(e.id);i||(i=new Map,this.registeredContextKeys.set(e.id,i));let s=i.get(t.contextKey.key);s||(s=this.bind(t.contextKey,e),i.set(t.contextKey.key,s)),s.set(t.getGroupContextKeyValue(e))}get partOptions(){return this.mainPart.partOptions}get onDidChangeEditorPartOptions(){return this.mainPart.onDidChangeEditorPartOptions}};Lg=Bs=D([u(0,F),u(1,ce),u(2,me),u(3,Du),u(4,se)],Lg);class er{static _readModifiers(e){e=e.toLowerCase().trim();let t=!1,i=!1,s=!1,o=!1,n;do n=!1,/^ctrl(\+|\-)/.test(e)&&(t=!0,e=e.substr(5),n=!0),/^shift(\+|\-)/.test(e)&&(i=!0,e=e.substr(6),n=!0),/^alt(\+|\-)/.test(e)&&(s=!0,e=e.substr(4),n=!0),/^meta(\+|\-)/.test(e)&&(o=!0,e=e.substr(5),n=!0),/^win(\+|\-)/.test(e)&&(o=!0,e=e.substr(4),n=!0),/^cmd(\+|\-)/.test(e)&&(o=!0,e=e.substr(4),n=!0);while(n);let r;const d=e.indexOf(" ");return d>0?(r=e.substring(0,d),e=e.substring(d)):(r=e,e=""),{remains:e,ctrl:t,shift:i,alt:s,meta:o,key:r}}static parseChord(e){const t=this._readModifiers(e),i=t.key.match(/^\[([^\]]+)\]$/);if(i){const o=i[1],n=Wt.lowerCaseToEnum(o);return[new Cs(t.ctrl,t.shift,t.alt,t.meta,n),t.remains]}const s=ot.fromUserSettings(t.key);return[new Is(t.ctrl,t.shift,t.alt,t.meta,s),t.remains]}static parseKeybinding(e){if(!e)return null;const t=[];let i;for(;e.length>0;)[i,e]=this.parseChord(e),t.push(i);return t.length>0?new cv(t):null}}const sy=[{key:"commandPalette",id:w.CommandPalette,description:c(11914,"The Command Palette"),supportsSubmenus:!1},{key:"touchBar",id:w.TouchBarContext,description:c(11915,"The touch bar (macOS only)"),supportsSubmenus:!1},{key:"editor/title",id:w.EditorTitle,description:c(11916,"The editor title menu")},{key:"editor/title/run",id:w.EditorTitleRun,description:c(11917,"Run submenu inside the editor title menu")},{key:"editor/context",id:w.EditorContext,description:c(11918,"The editor context menu")},{key:"editor/context/copy",id:w.EditorContextCopy,description:c(11919,"'Copy as' submenu in the editor context menu")},{key:"editor/context/share",id:w.EditorContextShare,description:c(11920,"'Share' submenu in the editor context menu"),proposed:"contribShareMenu"},{key:"explorer/context",id:w.ExplorerContext,description:c(11921,"The file explorer context menu")},{key:"explorer/context/share",id:w.ExplorerContextShare,description:c(11922,"'Share' submenu in the file explorer context menu"),proposed:"contribShareMenu"},{key:"editor/title/context",id:w.EditorTitleContext,description:c(11923,"The editor tabs context menu")},{key:"editor/title/context/share",id:w.EditorTitleContextShare,description:c(11924,"'Share' submenu inside the editor title context menu"),proposed:"contribShareMenu"},{key:"debug/callstack/context",id:w.DebugCallStackContext,description:c(11925,"The debug callstack view context menu")},{key:"debug/variables/context",id:w.DebugVariablesContext,description:c(11926,"The debug variables view context menu")},{key:"debug/toolBar",id:w.DebugToolBar,description:c(11927,"The debug toolbar menu")},{key:"debug/createConfiguration",id:w.DebugCreateConfiguration,proposed:"contribDebugCreateConfiguration",description:c(11928,"The debug create configuration menu")},{key:"notebook/variables/context",id:w.NotebookVariablesContext,description:c(11929,"The notebook variables view context menu")},{key:"menuBar/home",id:w.MenubarHomeMenu,description:c(11930,"The home indicator context menu (web only)"),proposed:"contribMenuBarHome",supportsSubmenus:!1},{key:"menuBar/edit/copy",id:w.MenubarCopy,description:c(11931,"'Copy as' submenu in the top level Edit menu")},{key:"scm/title",id:w.SCMTitle,description:c(11932,"The Source Control title menu")},{key:"scm/sourceControl",id:w.SCMSourceControl,description:c(11933,"The Source Control menu")},{key:"scm/sourceControl/title",id:w.SCMSourceControlTitle,description:c(11934,"The Source Control title menu"),proposed:"contribSourceControlTitleMenu"},{key:"scm/resourceState/context",id:w.SCMResourceContext,description:c(11935,"The Source Control resource state context menu")},{key:"scm/resourceFolder/context",id:w.SCMResourceFolderContext,description:c(11936,"The Source Control resource folder context menu")},{key:"scm/resourceGroup/context",id:w.SCMResourceGroupContext,description:c(11937,"The Source Control resource group context menu")},{key:"scm/change/title",id:w.SCMChangeContext,description:c(11938,"The Source Control inline change menu")},{key:"scm/inputBox",id:w.SCMInputBox,description:c(11939,"The Source Control input box menu"),proposed:"contribSourceControlInputBoxMenu"},{key:"scm/history/title",id:w.SCMHistoryTitle,description:c(11940,"The Source Control History title menu"),proposed:"contribSourceControlHistoryTitleMenu"},{key:"scm/historyItem/context",id:w.SCMHistoryItemContext,description:c(11941,"The Source Control history item context menu"),proposed:"contribSourceControlHistoryItemMenu"},{key:"scm/historyItem/hover",id:w.SCMHistoryItemHover,description:c(11942,"The Source Control history item hover menu"),proposed:"contribSourceControlHistoryItemMenu"},{key:"scm/historyItemRef/context",id:w.SCMHistoryItemRefContext,description:c(11943,"The Source Control history item reference context menu"),proposed:"contribSourceControlHistoryItemMenu"},{key:"statusBar/remoteIndicator",id:w.StatusBarRemoteIndicatorMenu,description:c(11944,"The remote indicator menu in the status bar"),supportsSubmenus:!1},{key:"terminal/context",id:w.TerminalInstanceContext,description:c(11945,"The terminal context menu")},{key:"terminal/title/context",id:w.TerminalTabContext,description:c(11946,"The terminal tabs context menu")},{key:"view/title",id:w.ViewTitle,description:c(11947,"The contributed view title menu")},{key:"viewContainer/title",id:w.ViewContainerTitle,description:c(11948,"The contributed view container title menu"),proposed:"contribViewContainerTitle"},{key:"view/item/context",id:w.ViewItemContext,description:c(11949,"The contributed view item context menu")},{key:"comments/comment/editorActions",id:w.CommentEditorActions,description:c(11950,"The contributed comment editor actions"),proposed:"contribCommentEditorActionsMenu"},{key:"comments/commentThread/title",id:w.CommentThreadTitle,description:c(11951,"The contributed comment thread title menu")},{key:"comments/commentThread/context",id:w.CommentThreadActions,description:c(11952,"The contributed comment thread context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1},{key:"comments/commentThread/additionalActions",id:w.CommentThreadAdditionalActions,description:c(11952,"The contributed comment thread context menu, rendered as buttons below the comment editor"),supportsSubmenus:!0,proposed:"contribCommentThreadAdditionalMenu"},{key:"comments/commentThread/title/context",id:w.CommentThreadTitleContext,description:c(11953,"The contributed comment thread title's peek context menu, rendered as a right click menu on the comment thread's peek title."),proposed:"contribCommentPeekContext"},{key:"comments/comment/title",id:w.CommentTitle,description:c(11954,"The contributed comment title menu")},{key:"comments/comment/context",id:w.CommentActions,description:c(11955,"The contributed comment context menu, rendered as buttons below the comment editor"),supportsSubmenus:!1},{key:"comments/commentThread/comment/context",id:w.CommentThreadCommentContext,description:c(11956,"The contributed comment context menu, rendered as a right click menu on the an individual comment in the comment thread's peek view."),proposed:"contribCommentPeekContext"},{key:"commentsView/commentThread/context",id:w.CommentsViewThreadActions,description:c(11957,"The contributed comment thread context menu in the comments view"),proposed:"contribCommentsViewThreadMenus"},{key:"notebook/toolbar",id:w.NotebookToolbar,description:c(11958,"The contributed notebook toolbar menu")},{key:"notebook/kernelSource",id:w.NotebookKernelSource,description:c(11959,"The contributed notebook kernel sources menu"),proposed:"notebookKernelSource"},{key:"notebook/cell/title",id:w.NotebookCellTitle,description:c(11960,"The contributed notebook cell title menu")},{key:"notebook/cell/execute",id:w.NotebookCellExecute,description:c(11961,"The contributed notebook cell execution menu")},{key:"interactive/toolbar",id:w.InteractiveToolbar,description:c(11962,"The contributed interactive toolbar menu")},{key:"interactive/cell/title",id:w.InteractiveCellTitle,description:c(11963,"The contributed interactive cell title menu")},{key:"issue/reporter",id:w.IssueReporter,description:c(11964,"The contributed issue reporter menu")},{key:"testing/item/context",id:w.TestItem,description:c(11965,"The contributed test item menu")},{key:"testing/item/gutter",id:w.TestItemGutter,description:c(11966,"The menu for a gutter decoration for a test item")},{key:"testing/profiles/context",id:w.TestProfilesContext,description:c(11967,"The menu for configuring testing profiles.")},{key:"testing/item/result",id:w.TestPeekElement,description:c(11968,"The menu for an item in the Test Results view or peek.")},{key:"testing/message/context",id:w.TestMessageContext,description:c(11969,"A prominent button overlaying editor content where the message is displayed")},{key:"testing/message/content",id:w.TestMessageContent,description:c(11970,"Context menu for the message in the results tree")},{key:"extension/context",id:w.ExtensionContext,description:c(11971,"The extension context menu")},{key:"timeline/title",id:w.TimelineTitle,description:c(11972,"The Timeline view title menu")},{key:"timeline/item/context",id:w.TimelineItemContext,description:c(11973,"The Timeline view item context menu")},{key:"ports/item/context",id:w.TunnelContext,description:c(11974,"The Ports view item context menu")},{key:"ports/item/origin/inline",id:w.TunnelOriginInline,description:c(11975,"The Ports view item origin inline menu")},{key:"ports/item/port/inline",id:w.TunnelPortInline,description:c(11976,"The Ports view item port inline menu")},{key:"file/newFile",id:w.NewFile,description:c(11977,"The 'New File...' quick pick, shown on welcome page and File menu."),supportsSubmenus:!1},{key:"webview/context",id:w.WebviewContext,description:c(11978,"The webview context menu")},{key:"file/share",id:w.MenubarShare,description:c(11979,"Share submenu shown in the top level File menu."),proposed:"contribShareMenu"},{key:"editor/inlineCompletions/actions",id:w.InlineCompletionsActions,description:c(11980,"The actions shown when hovering on an inline completion"),supportsSubmenus:!1,proposed:"inlineCompletionsAdditions"},{key:"editor/content",id:w.EditorContent,description:c(11981,"The prominent button in an editor, overlays its content"),proposed:"contribEditorContentMenu"},{key:"editor/lineNumber/context",id:w.EditorLineNumberContext,description:c(11982,"The contributed editor line number context menu")},{key:"mergeEditor/result/title",id:w.MergeInputResultToolbar,description:c(11983,"The result toolbar of the merge editor"),proposed:"contribMergeEditorMenus"},{key:"multiDiffEditor/resource/title",id:w.MultiDiffEditorFileToolbar,description:c(11984,"The resource toolbar in the multi diff editor"),proposed:"contribMultiDiffEditorMenus"},{key:"diffEditor/gutter/hunk",id:w.DiffEditorHunkToolbar,description:c(11985,"The gutter toolbar in the diff editor"),proposed:"contribDiffEditorGutterToolBarMenus"},{key:"diffEditor/gutter/selection",id:w.DiffEditorSelectionToolbar,description:c(11985,"The gutter toolbar in the diff editor"),proposed:"contribDiffEditorGutterToolBarMenus"},{key:"searchPanel/aiResults/commands",id:w.SearchActionMenu,description:c(11986,"The commands that will contribute to the menu rendered as buttons next to the AI search title")},{key:"chat/modelPicker",id:w.ChatModelPicker,description:c(11987,"The chat model picker dropdown menu"),supportsSubmenus:!1,proposed:"chatParticipantPrivate"}];var as;(function(a){function e(g){return typeof g.command=="string"}a.isMenuItem=e;function t(g,m){return typeof g.command!="string"?(m.error(c(11988,"property `{0}` is mandatory and must be of type `string`","command")),!1):g.alt&&typeof g.alt!="string"?(m.error(c(11989,"property `{0}` can be omitted or must be of type `string`","alt")),!1):g.when&&typeof g.when!="string"?(m.error(c(11989,"property `{0}` can be omitted or must be of type `string`","when")),!1):g.group&&typeof g.group!="string"?(m.error(c(11989,"property `{0}` can be omitted or must be of type `string`","group")),!1):!0}a.isValidMenuItem=t;function i(g,m){return typeof g.submenu!="string"?(m.error(c(11988,"property `{0}` is mandatory and must be of type `string`","submenu")),!1):g.when&&typeof g.when!="string"?(m.error(c(11989,"property `{0}` can be omitted or must be of type `string`","when")),!1):g.group&&typeof g.group!="string"?(m.error(c(11989,"property `{0}` can be omitted or must be of type `string`","group")),!1):!0}a.isValidSubmenuItem=i;function s(g,m){if(!Array.isArray(g))return m.error(c(11990,"submenu items must be an array")),!1;for(const v of g)if(e(v)){if(!t(v,m))return!1}else if(!i(v,m))return!1;return!0}a.isValidItems=s;function o(g,m){return typeof g!="object"?(m.error(c(11991,"submenu items must be an object")),!1):typeof g.id!="string"?(m.error(c(11988,"property `{0}` is mandatory and must be of type `string`","id")),!1):typeof g.label!="string"?(m.error(c(11988,"property `{0}` is mandatory and must be of type `string`","label")),!1):!0}a.isValidSubmenu=o;const n={type:"object",required:["command"],properties:{command:{description:c(11992,"Identifier of the command to execute. The command must be declared in the 'commands'-section"),type:"string"},alt:{description:c(11993,"Identifier of an alternative command to execute. The command must be declared in the 'commands'-section"),type:"string"},when:{description:c(11994,"Condition which must be true to show this item"),type:"string"},group:{description:c(11995,"Group into which this item belongs"),type:"string"}}},r={type:"object",required:["submenu"],properties:{submenu:{description:c(11996,"Identifier of the submenu to display in this item."),type:"string"},when:{description:c(11994,"Condition which must be true to show this item"),type:"string"},group:{description:c(11995,"Group into which this item belongs"),type:"string"}}},d={type:"object",required:["id","label"],properties:{id:{description:c(11997,"Identifier of the menu to display as a submenu."),type:"string"},label:{description:c(11998,"The label of the menu item which leads to this submenu."),type:"string"},icon:{description:c(11999,"(Optional) Icon which is used to represent the submenu in the UI. Either a file path, an object with file paths for dark and light themes, or a theme icon references, like `\\$(zap)`"),anyOf:[{type:"string"},{type:"object",properties:{light:{description:c(12e3,"Icon path when a light theme is used"),type:"string"},dark:{description:c(12001,"Icon path when a dark theme is used"),type:"string"}}}]}}};a.menusContribution={description:c(12002,"Contributes menu items to the editor"),type:"object",properties:Mc(sy,g=>g.key,g=>({markdownDescription:g.proposed?c(12003,'Proposed API, requires `enabledApiProposal: ["{0}"]` - {1}',g.proposed,g.description):g.description,type:"array",items:g.supportsSubmenus===!1?n:{oneOf:[n,r]}})),additionalProperties:{description:"Submenu",type:"array",items:{oneOf:[n,r]}}},a.submenusContribution={description:c(12004,"Contributes submenu items to the editor"),type:"array",items:d};function l(g,m){return g?Gs(g.command)?(m.error(c(11988,"property `{0}` is mandatory and must be of type `string`","command")),!1):!p(g.title,m,"title")||g.shortTitle&&!p(g.shortTitle,m,"shortTitle")?!1:g.enablement&&typeof g.enablement!="string"?(m.error(c(11989,"property `{0}` can be omitted or must be of type `string`","precondition")),!1):!(g.category&&!p(g.category,m,"category")||!h(g.icon,m)):(m.error(c(12005,"expected non-empty value.")),!1)}a.isValidCommand=l;function h(g,m){return typeof g>"u"||typeof g=="string"||typeof g.dark=="string"&&typeof g.light=="string"?!0:(m.error(c(12006,"property `icon` can be omitted or must be either a string or a literal like `{dark, light}`")),!1)}function p(g,m,v){return typeof g>"u"?(m.error(c(12007,"property `{0}` is mandatory and must be of type `string` or `object`",v)),!1):typeof g=="string"&&Gs(g)?(m.error(c(11988,"property `{0}` is mandatory and must be of type `string`",v)),!1):typeof g!="string"&&(Gs(g.original)||Gs(g.value))?(m.error(c(12008,"properties `{0}` and `{1}` are mandatory and must be of type `string`",`${v}.value`,`${v}.original`)),!1):!0}const f={type:"object",required:["command","title"],properties:{command:{description:c(12009,"Identifier of the command to execute"),type:"string"},title:{description:c(12010,"Title by which the command is represented in the UI"),type:"string"},shortTitle:{markdownDescription:c(12011,"(Optional) Short title by which the command is represented in the UI. Menus pick either `title` or `shortTitle` depending on the context in which they show commands."),type:"string"},category:{description:c(12012,"(Optional) Category string by which the command is grouped in the UI"),type:"string"},enablement:{description:c(12013,"(Optional) Condition which must be true to enable the command in the UI (menu and keybindings). Does not prevent executing the command by other means, like the `executeCommand`-api."),type:"string"},icon:{description:c(12014,"(Optional) Icon which is used to represent the command in the UI. Either a file path, an object with file paths for dark and light themes, or a theme icon references, like `\\$(zap)`"),anyOf:[{type:"string"},{type:"object",properties:{light:{description:c(12015,"Icon path when a light theme is used"),type:"string"},dark:{description:c(12016,"Icon path when a dark theme is used"),type:"string"}}}]}}};a.commandsContribution={description:c(12017,"Contributes commands to the command palette."),oneOf:[f,{type:"array",items:f}]}})(as||(as={}));const Vg=new O,oy=ro.registerExtensionPoint({extensionPoint:"commands",jsonSchema:as.commandsContribution,activationEventsGenerator:(a,e)=>{for(const t of a)t.command&&e.push(`onCommand:${t.command}`)}});oy.setHandler(a=>{function e(t,i){if(!as.isValidCommand(t,i.collector))return;const{icon:s,enablement:o,category:n,title:r,shortTitle:d,command:l}=t;let h;s&&(typeof s=="string"?h=Ce.fromString(s)??{dark:Yi(i.description.extensionLocation,s),light:Yi(i.description.extensionLocation,s)}:h={dark:Yi(i.description.extensionLocation,s.dark),light:Yi(i.description.extensionLocation,s.light)});const p=S.getCommand(l);p&&(p.source?i.collector.info(c(12018,"Command `{0}` already registered by {1} ({2})",t.command,p.source.title,p.source.id)):i.collector.info(c(12019,"Command `{0}` already registered",t.command))),Vg.add(S.addCommand({id:l,title:r,source:{id:i.description.identifier.value,title:i.description.displayName??i.description.name},shortTitle:d,tooltip:r,category:n,precondition:I.deserialize(o),icon:h}))}Vg.clear();for(const t of a){const{value:i}=t;if(Array.isArray(i))for(const s of i)e(s,t);else e(i,t)}});const On=new Map,ny=ro.registerExtensionPoint({extensionPoint:"submenus",jsonSchema:as.submenusContribution});ny.setHandler(a=>{On.clear();for(const e of a){const{value:t,collector:i}=e;for(const[,s]of Object.entries(t)){if(!as.isValidSubmenu(s,i))continue;if(!s.id){i.warn(c(12020,"`{0}` is not a valid submenu identifier",s.id));continue}if(On.has(s.id)){i.info(c(12021,"The `{0}` submenu was already previously registered.",s.id));continue}if(!s.label){i.warn(c(12022,"`{0}` is not a valid submenu label",s.label));continue}let o;s.icon&&(typeof s.icon=="string"?o=Ce.fromString(s.icon)||{dark:Yi(e.description.extensionLocation,s.icon)}:o={dark:Yi(e.description.extensionLocation,s.icon.dark),light:Yi(e.description.extensionLocation,s.icon.light)});const n={id:w.for(`api:${s.id}`),label:s.label,icon:o};On.set(s.id,n)}}});const AA=new Map(sy.map(a=>[a.key,a])),Pg=new O,Sc=new Map,TA=ro.registerExtensionPoint({extensionPoint:"menus",jsonSchema:as.menusContribution,deps:[ny]});TA.setHandler(a=>{Pg.clear(),Sc.clear();for(const e of a){const{value:t,collector:i}=e;for(const s of Object.entries(t)){if(!as.isValidItems(s[1],i))continue;let o=AA.get(s[0]);if(!o){const n=On.get(s[0]);n&&(o={key:s[0],id:n.id,description:""})}if(o){if(o.proposed&&!Oc(e.description,o.proposed)){i.error(c(12023,`{0} is a proposed menu identifier. It requires 'package.json#enabledApiProposals: ["{1}"]' and is only available when running out of dev or with the following command line switch: --enable-proposed-api {2}`,s[0],o.proposed,e.description.identifier.value));continue}for(const n of s[1]){let r;if(as.isMenuItem(n)){const d=S.getCommand(n.command),l=n.alt&&S.getCommand(n.alt)||void 0;if(!d){i.error(c(12024,"Menu item references a command `{0}` which is not defined in the 'commands' section.",n.command));continue}n.alt&&!l&&i.warn(c(12025,"Menu item references an alt-command `{0}` which is not defined in the 'commands' section.",n.alt)),n.command===n.alt&&i.info(c(12026,"Menu item references the same command as default and alt-command")),r={command:d,alt:l,group:void 0,order:void 0,when:void 0}}else{if(o.supportsSubmenus===!1){i.error(c(12027,"Menu item references a submenu for a menu which doesn't have submenu support."));continue}const d=On.get(n.submenu);if(!d){i.error(c(12028,"Menu item references a submenu `{0}` which is not defined in the 'submenus' section.",n.submenu));continue}let l=Sc.get(o.id.id);if(l||(l=new Set,Sc.set(o.id.id,l)),l.has(d.id.id)){i.warn(c(12029,"The `{0}` submenu was already contributed to the `{1}` menu.",n.submenu,s[0]));continue}l.add(d.id.id),r={submenu:d.id,icon:d.icon,title:d.label,group:void 0,order:void 0,when:void 0}}if(n.group){const d=n.group.lastIndexOf("@");d>0?(r.group=n.group.substr(0,d),r.order=Number(n.group.substr(d+1))||void 0):r.group=n.group}if(o.id===w.ViewContainerTitle&&!n.when?.includes("viewContainer == workbench.view.debug")){i.error(c(12030,"The {0} menu contribution must check {1} in its {2} clause.","`viewContainer/title`","`viewContainer == workbench.view.debug`",'"when"'));continue}r.when=I.deserialize(n.when),Pg.add(S.appendMenuItem(o.id,r))}}}}});let Cl=class extends R{constructor(e){super(),this._keybindingService=e,this.type="table"}shouldRender(e){return!!e.contributes?.commands}render(e){const i=(e.contributes?.commands||[]).map(h=>({id:h.command,title:h.title,keybindings:[],menus:[]})),s=Mc(i,h=>h.id),o=e.contributes?.menus||{},n=Mc(i,h=>h.id);if(o.commandPalette)for(const h of o.commandPalette)delete n[h.command];if(Object.keys(n).length){o.commandPalette||(o.commandPalette=[]);for(const h in n)o.commandPalette.push({command:h})}for(const h in o)for(const p of o[h])if(p.when!=="false"&&p.command){let f=s[p.command];f?f.menus.includes(h)||f.menus.push(h):(f={id:p.command,title:"",keybindings:[],menus:[h]},s[f.id]=f,i.push(f))}if((e.contributes?.keybindings?Array.isArray(e.contributes.keybindings)?e.contributes.keybindings:[e.contributes.keybindings]:[]).forEach(h=>{const p=this.resolveKeybinding(h);if(!p)return;let f=s[h.command];f?f.keybindings.push(p):(f={id:h.command,title:"",keybindings:[p],menus:[]},s[f.id]=f,i.push(f))}),!i.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const d=[c(12031,"ID"),c(12032,"Title"),c(12033,"Keyboard Shortcuts"),c(12034,"Menu Contexts")],l=i.sort((h,p)=>h.id.localeCompare(p.id)).map(h=>[new ts().appendMarkdown(`\`${h.id}\``),typeof h.title=="string"?h.title:h.title.value,h.keybindings,new ts().appendMarkdown(`${h.menus.sort((p,f)=>p.localeCompare(f)).map(p=>`\`${p}\``).join("&nbsp;")}`)]);return{data:{headers:d,rows:l},dispose:()=>{}}}resolveKeybinding(e){let t;switch(lv){case"win32":t=e.win;break;case"linux":t=e.linux;break;case"darwin":t=e.mac;break}return this._keybindingService.resolveUserBinding(t??e.key)[0]}};Cl=D([u(0,it)],Cl);H.as(Fd.ExtensionFeaturesRegistry).registerExtensionFeature({id:"commands",label:c(12035,"Commands"),access:{canToggle:!1},renderer:new ee(Cl)});class ry{static writeKeybindingItem(e,t){if(!t.resolvedKeybinding)return;const i=JSON.stringify(t.resolvedKeybinding.getUserSettingsLabel());e.write(`{ "key": ${xA(i+",",25)} "command": `);const s=t.when?JSON.stringify(t.when.serialize()):"",o=JSON.stringify(t.command);s.length>0?(e.write(`${o},`),e.writeLine(),e.write(`                                     "when": ${s}`)):e.write(`${o}`),t.commandArgs&&(e.write(","),e.writeLine(),e.write(`                                     "args": ${JSON.stringify(t.commandArgs)}`)),e.write(" }")}static readUserKeybindingItem(e){const t="key"in e&&typeof e.key=="string"?er.parseKeybinding(e.key):null,i="when"in e&&typeof e.when=="string"?I.deserialize(e.when):void 0,s="command"in e&&typeof e.command=="string"?e.command:null,o="args"in e&&typeof e.args<"u"?e.args:void 0;return{keybinding:t,command:s,commandArgs:o,when:i,_sourceKey:"key"in e&&typeof e.key=="string"?e.key:void 0}}}function xA(a,e){return a.length<e?a+new Array(e-a.length).join(" "):a}class kA{constructor(){this._lines=[],this._currentLine=""}write(e){this._currentLine+=e}writeLine(e=""){this._lines.push(this._currentLine+e),this._currentLine=""}toString(){return this.writeLine(),this._lines.join(`
`)}}var Sn;function RA(a,e){return a?typeof a.command!="string"?(e.push(c(12411,"property `{0}` is mandatory and must be of type `string`","command")),!1):a.key&&typeof a.key!="string"?(e.push(c(12412,"property `{0}` can be omitted or must be of type `string`","key")),!1):a.when&&typeof a.when!="string"?(e.push(c(12412,"property `{0}` can be omitted or must be of type `string`","when")),!1):a.mac&&typeof a.mac!="string"?(e.push(c(12412,"property `{0}` can be omitted or must be of type `string`","mac")),!1):a.linux&&typeof a.linux!="string"?(e.push(c(12412,"property `{0}` can be omitted or must be of type `string`","linux")),!1):a.win&&typeof a.win!="string"?(e.push(c(12412,"property `{0}` can be omitted or must be of type `string`","win")),!1):!0:(e.push(c(12410,"expected non-empty value.")),!1)}const Mg={type:"object",default:{command:"",key:""},properties:{command:{description:c(12413,"Identifier of the command to run when keybinding is triggered."),type:"string"},args:{description:c(12414,"Arguments to pass to the command to execute.")},key:{description:c(12415,"Key or key sequence (separate keys with plus-sign and sequences with space, e.g. Ctrl+O and Ctrl+L L for a chord)."),type:"string"},mac:{description:c(12416,"Mac specific key or key sequence."),type:"string"},linux:{description:c(12417,"Linux specific key or key sequence."),type:"string"},win:{description:c(12418,"Windows specific key or key sequence."),type:"string"},when:{description:c(12419,"Condition when the key is active."),type:"string"}}},Og=ro.registerExtensionPoint({extensionPoint:"keybindings",deps:[oy],jsonSchema:{description:c(12420,"Contributes keybindings."),oneOf:[Mg,{type:"array",items:Mg}]}}),LA=[T.NumpadDivide,T.NumpadMultiply,T.NumpadSubtract,T.NumpadAdd,T.Numpad1,T.Numpad2,T.Numpad3,T.Numpad4,T.Numpad5,T.Numpad6,T.Numpad7,T.Numpad8,T.Numpad9,T.Numpad0,T.NumpadDecimal],_i=new Map;_i.set(T.Numpad1,y.Digit1);_i.set(T.Numpad2,y.Digit2);_i.set(T.Numpad3,y.Digit3);_i.set(T.Numpad4,y.Digit4);_i.set(T.Numpad5,y.Digit5);_i.set(T.Numpad6,y.Digit6);_i.set(T.Numpad7,y.Digit7);_i.set(T.Numpad8,y.Digit8);_i.set(T.Numpad9,y.Digit9);_i.set(T.Numpad0,y.Digit0);let Sl=Sn=class extends hv{constructor(e,t,i,s,o,n,r,d,l,h,p,f){super(e,t,i,s,h),this.hostService=n,this.keyboardLayoutService=p,this.layoutService=f,this._contributions=[],this.isComposingGlobalContextKey=e.createKey("isComposing",!1),this.kbsJsonSchema=new Nn,this.updateKeybindingsJsonSchema(),this._keyboardMapper=this.keyboardLayoutService.getKeyboardMapper(),this._register(this.keyboardLayoutService.onDidChangeKeyboardLayout(()=>{this._keyboardMapper=this.keyboardLayoutService.getKeyboardMapper(),this.updateResolver()})),this._keybindingHoldMode=null,this._cachedResolver=null,this.userKeybindings=this._register(new VA(o,l,d,h)),this.userKeybindings.initialize().then(()=>{this.userKeybindings.keybindings.length&&this.updateResolver()}),this._register(this.userKeybindings.onDidChange(()=>{h.debug("User keybindings changed"),this.updateResolver()})),Og.setHandler(g=>{const m=[];for(const v of g)this._handleKeybindingsExtensionPointUser(v.description.identifier,v.description.isBuiltin,v.value,v.collector,m);oe.setExtensionKeybindings(m),this.updateResolver()}),this.updateKeybindingsJsonSchema(),this._register(r.onDidRegisterExtensions(()=>this.updateKeybindingsJsonSchema())),this._register(V.runAndSubscribe(wf,({window:g,disposables:m})=>m.add(this._registerKeyListeners(g)),{window:re,disposables:this._store})),this._register(mf(g=>{if(g!==re.vscodeWindowId)return;const m=navigator.keyboard;tc.keyboard!==ic.None&&(lp(re)?m?.lock(["Escape"]):m?.unlock(),this._cachedResolver=null,this._onDidUpdateKeybindings.fire())}))}_registerKeyListeners(e){const t=new O,i=this.layoutService.getContainer(e);return t.add(Y(i,te.KEY_DOWN,s=>{if(this._keybindingHoldMode)return;this.isComposingGlobalContextKey.set(s.isComposing);const o=new Fo(s);this._log(`/ Received  keydown event - ${uv(s)}`),this._log(`| Converted keydown event - ${pv(o)}`),this._dispatch(o,o.target)&&o.preventDefault(),this.isComposingGlobalContextKey.set(!1)})),t.add(Y(i,te.KEY_UP,s=>{this._resetKeybindingHoldMode(),this.isComposingGlobalContextKey.set(s.isComposing);const o=new Fo(s);this._singleModifierDispatch(o,o.target)&&o.preventDefault(),this.isComposingGlobalContextKey.set(!1)})),t}registerSchemaContribution(e){this._contributions.push(e),e.onDidChange&&this._register(e.onDidChange(()=>this.updateKeybindingsJsonSchema())),this.updateKeybindingsJsonSchema()}updateKeybindingsJsonSchema(){this.kbsJsonSchema.updateSchema(this._contributions.flatMap(e=>e.getSchemaAdditions()))}_printKeybinding(e){return gv.toLabel(Ht,e.chords,t=>t instanceof Is?ot.toString(t.keyCode):Wt.toString(t.scanCode))||"[null]"}_printResolvedKeybinding(e){return e.getDispatchChords().map(t=>t||"[null]").join(" ")}_printResolvedKeybindings(e,t,i){const o=`${t.padStart(35," ")} => `;if(i.length===0){e.push(`${o}${"[NO BINDING]".padStart(35," ")}`);return}for(const n of i)e.push(`${o}${this._printResolvedKeybinding(n).padStart(35," ")}`)}_dumpResolveKeybindingDebugInfo(){const e=new Set,t=[];t.push("Default Resolved Keybindings (unique only):");for(const i of oe.getDefaultKeybindings()){if(!i.keybinding)continue;const s=this._printKeybinding(i.keybinding);if(e.has(s))continue;e.add(s);const o=this._keyboardMapper.resolveKeybinding(i.keybinding);this._printResolvedKeybindings(t,s,o)}t.push("User Resolved Keybindings (unique only):");for(const i of this.userKeybindings.keybindings){if(!i.keybinding)continue;const s=i._sourceKey??"Impossible: missing source key, but has keybinding";if(e.has(s))continue;e.add(s);const o=this._keyboardMapper.resolveKeybinding(i.keybinding);this._printResolvedKeybindings(t,s,o)}return t.join(`
`)}_dumpDebugInfo(){const e=JSON.stringify(this.keyboardLayoutService.getCurrentKeyboardLayout(),null,"	"),t=this._keyboardMapper.dumpDebugInfo(),i=this._dumpResolveKeybindingDebugInfo(),s=JSON.stringify(this.keyboardLayoutService.getRawKeyboardMapping(),null,"	");return`Layout info:
${e}

${i}

${t}

Raw mapping:
${s}`}_dumpDebugInfoJSON(){const e={layout:this.keyboardLayoutService.getCurrentKeyboardLayout(),rawMapping:this.keyboardLayoutService.getRawKeyboardMapping()};return JSON.stringify(e,null,"	")}enableKeybindingHoldMode(e){if(this._currentlyDispatchingCommandId!==e)return;this._keybindingHoldMode=new Xs;const t=Mo(St(void 0)),i=t.onDidBlur(()=>this._resetKeybindingHoldMode());return this._keybindingHoldMode.p.finally(()=>{i.dispose(),t.dispose()}),this._log(`+ Enabled hold-mode for ${e}.`),this._keybindingHoldMode.p}_resetKeybindingHoldMode(){this._keybindingHoldMode&&(this._keybindingHoldMode?.complete(),this._keybindingHoldMode=null)}customKeybindingsCount(){return this.userKeybindings.keybindings.length}updateResolver(){this._cachedResolver=null,this._onDidUpdateKeybindings.fire()}getUserKeybindingItems(){return this._resolveUserKeybindingItems(this.userKeybindings.keybindings,!1)}_getResolver(){if(!this._cachedResolver){const e=this._resolveKeybindingItems(oe.getDefaultKeybindings(),!0),t=this.getUserKeybindingItems();this._cachedResolver=new fv(e,t,i=>this._log(i))}return this._cachedResolver}_documentHasFocus(){return this.hostService.hasFocus}_resolveKeybindingItems(e,t){const i=[];let s=0;for(const o of e){const n=o.when||void 0,r=o.keybinding;if(!r)i[s++]=new Br(void 0,o.command,o.commandArgs,n,t,o.extensionId,o.isBuiltinExtension);else{if(this._assertBrowserConflicts(r))continue;const d=this._keyboardMapper.resolveKeybinding(r);for(let l=d.length-1;l>=0;l--){const h=d[l];i[s++]=new Br(h,o.command,o.commandArgs,n,t,o.extensionId,o.isBuiltinExtension)}}}return i}_resolveUserKeybindingItems(e,t){const i=[];let s=0;for(const o of e){const n=o.when||void 0;if(!o.keybinding)i[s++]=new Br(void 0,o.command,o.commandArgs,n,t,null,!1);else{const r=this._keyboardMapper.resolveKeybinding(o.keybinding);for(const d of r)i[s++]=new Br(d,o.command,o.commandArgs,n,t,null,!1)}}return i}_assertBrowserConflicts(e){if(tc.keyboard===ic.Always||tc.keyboard===ic.FullScreen&&lp(re))return!1;for(const t of e.chords){if(!t.metaKey&&!t.altKey&&!t.ctrlKey&&!t.shiftKey)continue;const i=N.CtrlCmd|N.Alt|N.Shift;let s=0;if(t.metaKey&&(s|=N.CtrlCmd),t.shiftKey&&(s|=N.Shift),t.altKey&&(s|=N.Alt),t.ctrlKey&&Ht===fi.Macintosh&&(s|=N.WinCtrl),(s&i)===(N.CtrlCmd|N.Alt)&&(t instanceof Cs&&(t.scanCode===T.ArrowLeft||t.scanCode===T.ArrowRight)||t instanceof Is&&(t.keyCode===y.LeftArrow||t.keyCode===y.RightArrow))||(s&i)===N.CtrlCmd&&(t instanceof Cs&&t.scanCode>=T.Digit1&&t.scanCode<=T.Digit0||t instanceof Is&&t.keyCode>=y.Digit0&&t.keyCode<=y.Digit9))return!0}return!1}resolveKeybinding(e){return this._keyboardMapper.resolveKeybinding(e)}resolveKeyboardEvent(e){return this.keyboardLayoutService.validateCurrentKeyboardMapping(e),this._keyboardMapper.resolveKeyboardEvent(e)}resolveUserBinding(e){const t=er.parseKeybinding(e);return t?this._keyboardMapper.resolveKeybinding(t):[]}_handleKeybindingsExtensionPointUser(e,t,i,s,o){if(Array.isArray(i))for(let n=0,r=i.length;n<r;n++)this._handleKeybinding(e,t,n+1,i[n],s,o);else this._handleKeybinding(e,t,1,i,s,o)}_handleKeybinding(e,t,i,s,o,n){const r=[];if(RA(s,r)){const d=this._asCommandRule(e,t,i++,s);d&&n.push(d)}r.length>0&&o.error(c(12421,"Invalid `contributes.{0}`: {1}",Og.name,r.join(`
`)))}static bindToCurrentPlatform(e,t,i,s){if(Ht===fi.Windows&&s){if(s)return s}else if(Ht===fi.Macintosh){if(t)return t}else if(i)return i;return e}_asCommandRule(e,t,i,s){const{command:o,args:n,when:r,key:d,mac:l,linux:h,win:p}=s,f=Sn.bindToCurrentPlatform(d,l,h,p);if(!f)return;let g;t?g=W.BuiltinExtension+i:g=W.ExternalExtension+i;const m=S.getCommand(o),v=m&&m.precondition;let b;return r&&v?b=I.and(v,I.deserialize(r)):r?b=I.deserialize(r):v&&(b=v),{id:o,args:n,when:b,weight:g,keybinding:er.parseKeybinding(f),extensionId:e.value,isBuiltinExtension:t}}getDefaultKeybindingsContent(){const e=this._getResolver(),t=e.getDefaultKeybindings(),i=e.getDefaultBoundCommands();return Sn._getDefaultKeybindings(t)+`

`+Sn._getAllCommandsAsComment(i)}static _getDefaultKeybindings(e){const t=new kA;t.writeLine("[");const i=e.length-1;return e.forEach((s,o)=>{ry.writeKeybindingItem(t,s),o!==i?t.writeLine(","):t.writeLine()}),t.writeLine("]"),t.toString()}static _getAllCommandsAsComment(e){const i=HS(e).sort().join(`
// - `);return"// "+c(12422,"Here are other available commands: ")+`
// - `+i}mightProducePrintableCharacter(e){if(e.ctrlKey||e.metaKey||e.altKey)return!1;const t=Wt.toEnum(e.code);if(LA.indexOf(t)!==-1)return!!(e.keyCode===ii[t]||ut&&e.keyCode===_i.get(t));if(ii[t]!==-1)return!1;const s=this.keyboardLayoutService.getRawKeyboardMapping();if(!s)return!1;const o=s[e.code];return!(!o||!o.value||/\s/.test(o.value))}};Sl=Sn=D([u(0,se),u(1,wt),u(2,mt),u(3,Ke),u(4,Fu),u(5,Zt),u(6,kt),u(7,Le),u(8,Jo),u(9,Ue),u(10,yr),u(11,pr)],Sl);class VA extends R{get keybindings(){return this._keybindings}constructor(e,t,i,s){super(),this.userDataProfileService=e,this.uriIdentityService=t,this.fileService=i,this._rawKeybindings=[],this._keybindings=[],this.watchDisposables=this._register(new O),this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,this.watch(),this.reloadConfigurationScheduler=this._register(new ur(()=>this.reload().then(o=>{o&&this._onDidChange.fire()}),50)),this._register(V.filter(this.fileService.onDidFilesChange,o=>o.contains(this.userDataProfileService.currentProfile.keybindingsResource))(()=>{s.debug("Keybindings file changed"),this.reloadConfigurationScheduler.schedule()})),this._register(this.fileService.onDidRunOperation(o=>{o.operation===Hs.WRITE&&o.resource.toString()===this.userDataProfileService.currentProfile.keybindingsResource.toString()&&(s.debug("Keybindings file written"),this.reloadConfigurationScheduler.schedule())})),this._register(e.onDidChangeCurrentProfile(o=>{this.uriIdentityService.extUri.isEqual(o.previous.keybindingsResource,o.profile.keybindingsResource)||o.join(this.whenCurrentProfileChanged())}))}async whenCurrentProfileChanged(){this.watch(),this.reloadConfigurationScheduler.schedule()}watch(){this.watchDisposables.clear(),this.watchDisposables.add(this.fileService.watch(yf(this.userDataProfileService.currentProfile.keybindingsResource))),this.watchDisposables.add(this.fileService.watch(this.userDataProfileService.currentProfile.keybindingsResource))}async initialize(){await this.reload()}async reload(){const e=await this.readUserKeybindings();return vf(this._rawKeybindings,e)?!1:(this._rawKeybindings=e,this._keybindings=this._rawKeybindings.map(t=>ry.readUserKeybindingItem(t)),!0)}async readUserKeybindings(){try{const e=await this.fileService.readFile(this.userDataProfileService.currentProfile.keybindingsResource),t=bf(e.value.toString());return Array.isArray(t)?t.filter(i=>i&&typeof i=="object"):[]}catch{return[]}}}class Nn{static{this.schemaId="vscode://schemas/keybindings"}constructor(){this.commandsSchemas=[],this.commandsEnum=[],this.removalCommandsEnum=[],this.commandsEnumDescriptions=[],this.schema={id:Nn.schemaId,type:"array",title:c(12423,"Keybindings configuration"),allowTrailingCommas:!0,allowComments:!0,definitions:{editorGroupsSchema:{type:"array",items:{type:"object",properties:{groups:{$ref:"#/definitions/editorGroupsSchema",default:[{},{}]},size:{type:"number",default:.5}}}},commandNames:{type:"string",enum:this.commandsEnum,enumDescriptions:this.commandsEnumDescriptions,description:c(12424,"Name of the command to execute")},commandType:{anyOf:[{$ref:"#/definitions/commandNames"},{type:"string",enum:this.removalCommandsEnum,enumDescriptions:this.commandsEnumDescriptions,description:c(12425,"Name of the command to remove keyboard shortcut for")},{type:"string"}]},commandsSchemas:{allOf:this.commandsSchemas}},items:{required:["key"],type:"object",defaultSnippets:[{body:{key:"$1",command:"$2",when:"$3"}}],properties:{key:{type:"string",description:c(12426,"Key or key sequence (separated by space)")},command:{anyOf:[{if:{type:"array"},then:{not:{type:"array"},errorMessage:c(12427,`Incorrect type. Expected "{0}". The field 'command' does not support running multiple commands. Use command 'runCommands' to pass it multiple commands to run.`,"string")},else:{$ref:"#/definitions/commandType"}},{$ref:"#/definitions/commandType"}]},when:{type:"string",description:c(12428,"Condition when the key is active.")},args:{description:c(12429,"Arguments to pass to the command to execute.")}},$ref:"#/definitions/commandsSchemas"}},this.schemaRegistry=H.as(mv.JSONContribution),this.schemaRegistry.registerSchema(Nn.schemaId,this.schema)}updateSchema(e){this.commandsSchemas.length=0,this.commandsEnum.length=0,this.removalCommandsEnum.length=0,this.commandsEnumDescriptions.length=0;const t=new Set,i=(n,r)=>{/^_/.test(n)||t.has(n)||(t.add(n),this.commandsEnum.push(n),this.commandsEnumDescriptions.push(wv(r)?r.value:r),this.removalCommandsEnum.push(`-${n}`))},s=Te.getCommands();for(const[n,r]of s){const d=r.metadata;if(i(n,d?.description??S.getCommand(n)?.title),!d||!d.args||d.args.length!==1||!d.args[0].schema)continue;const l=d.args[0].schema,h=typeof d.args[0].isOptional<"u"?!d.args[0].isOptional:Array.isArray(l.required)&&l.required.length>0,p={if:{required:["command"],properties:{command:{const:n}}},then:{required:[].concat(h?["args"]:[]),properties:{args:l}}};this.commandsSchemas.push(p)}const o=S.getCommands();for(const n of o.keys())i(n);this.commandsSchemas.push(...e),this.schemaRegistry.notifySchemaChanged(Nn.schemaId)}}function Ng(a,e){return!a||!e?!1:!!(a.name&&e.name&&a.name===e.name||a.id&&e.id&&a.id===e.id||a.model&&e.model&&a.model===e.model&&a.layout===e.layout)}function Ia(a){if(!a)return{label:"",description:""};if(a.name)return{label:a.text,description:""};if(a.id){const t=a;return t.localizedName?{label:t.localizedName,description:""}:/^com\.apple\.keylayout\./.test(t.id)?{label:t.id.replace(/^com\.apple\.keylayout\./,"").replace(/-/," "),description:""}:/^.*inputmethod\./.test(t.id)?{label:t.id.replace(/^.*inputmethod\./,"").replace(/[-\.]/," "),description:`Input Method (${t.lang})`}:{label:t.lang,description:""}}return{label:a.layout,description:""}}function tr(a){return a.name?a.name:a.id?a.id:a.layout}function PA(a){const e=a,t={};for(const i in e){const s=e[i];if(s.length){const o=s[0],n=s[1],r=s[2],d=s[3],l=Number(s[4]),h=s.length===6?s[5]:void 0;t[i]={value:o,vkey:h,withShift:n,withAltGr:r,withShiftAltGr:d,valueIsDeadKey:(l&1)>0,withShiftIsDeadKey:(l&2)>0,withAltGrIsDeadKey:(l&4)>0,withShiftAltGrIsDeadKey:(l&8)>0}}else t[i]={value:"",valueIsDeadKey:!1,withShift:"",withShiftIsDeadKey:!1,withAltGr:"",withAltGrIsDeadKey:!1,withShiftAltGr:"",withShiftAltGrIsDeadKey:!1}}return t}class Hd{constructor(e,t,i,s){this.layout=e,this.secondaryLayouts=t,this.mapping=PA(i),this.isUserKeyboardLayout=!!s,this.layout.isUserKeyboardLayout=!!s}static createKeyboardLayoutFromDebugInfo(e,t,i){const s=new Hd(e,[],{},!0);return s.mapping=t,s}update(e){this.layout=e.layout,this.secondaryLayouts=e.secondaryLayouts,this.mapping=e.mapping,this.isUserKeyboardLayout=e.isUserKeyboardLayout,this.layout.isUserKeyboardLayout=e.isUserKeyboardLayout}getScore(e){let t=0;for(const i in e){if(to&&(i==="Backslash"||i==="KeyQ")||Cf&&(i==="Backspace"||i==="Escape"))continue;const s=this.mapping[i];s===void 0&&(t-=1);const o=e[i];s&&o&&s.value!==o.value&&(t-=1)}return t}equal(e){return this.isUserKeyboardLayout!==e.isUserKeyboardLayout||tr(this.layout)!==tr(e.layout)?!1:this.fuzzyEqual(e.mapping)}fuzzyEqual(e){for(const t in e){if(to&&(t==="Backslash"||t==="KeyQ"))continue;if(this.mapping[t]===void 0)return!1;const i=this.mapping[t],s=e[t];if(i.value!==s.value)return!1}return!0}}var ir;(function(a){a[a.Code=0]="Code",a[a.KeyCode=1]="KeyCode"})(ir||(ir={}));function MA(a){const e=a.getValue("keyboard"),t=e?.dispatch==="keyCode"?ir.KeyCode:ir.Code,i=!!e?.mapAltGrToCtrlAlt;return{dispatch:t,mapAltGrToCtrlAlt:i}}const OA=H.as(xs.Configuration),NA={id:"keyboard",order:15,type:"object",title:c(1889,"Keyboard"),properties:{"keyboard.dispatch":{scope:Nc.APPLICATION,type:"string",enum:["code","keyCode"],default:"code",markdownDescription:c(1890,"Controls the dispatching logic for key presses to use either `code` (recommended) or `keyCode`."),included:Ht===fi.Macintosh||Ht===fi.Linux},"keyboard.mapAltGrToCtrlAlt":{scope:Nc.APPLICATION,type:"boolean",default:!1,markdownDescription:c(1891,"Controls if the AltGraph+ modifier should be treated as Ctrl+Alt+."),included:Ht===fi.Windows}}};OA.registerConfiguration(NA);class BA{constructor(e){this._actual=e,this._cache=new Map}dumpDebugInfo(){return this._actual.dumpDebugInfo()}resolveKeyboardEvent(e){return this._actual.resolveKeyboardEvent(e)}resolveKeybinding(e){const t=e.getHashCode(),i=this._cache.get(t);if(!i){const s=this._actual.resolveKeybinding(e);return this._cache.set(t,s),s}return i}}class _n extends Sf{constructor(e,t){super(fi.Windows,t),this._mapper=e}_getLabel(e){return e.isDuplicateModifierCase()?"":this._mapper.getUILabelForKeyCode(e.keyCode)}_getUSLabelForKeybinding(e){return e.isDuplicateModifierCase()?"":ot.toString(e.keyCode)}getUSLabel(){return vv.toLabel(this._os,this._chords,e=>this._getUSLabelForKeybinding(e))}_getAriaLabel(e){return e.isDuplicateModifierCase()?"":this._mapper.getAriaLabelForKeyCode(e.keyCode)}_getElectronAccelerator(e){return this._mapper.getElectronAcceleratorForKeyBinding(e)}_getUserSettingsLabel(e){if(e.isDuplicateModifierCase())return"";const t=this._mapper.getUserSettingsLabelForKeyCode(e.keyCode);return t&&t.toLowerCase()}_isWYSIWYG(e){return this.__isWYSIWYG(e.keyCode)}__isWYSIWYG(e){if(e===y.LeftArrow||e===y.UpArrow||e===y.RightArrow||e===y.DownArrow)return!0;const t=this._mapper.getAriaLabelForKeyCode(e),i=this._mapper.getUserSettingsLabelForKeyCode(e);return t===i}_getChordDispatch(e){if(e.isModifierKey())return null;let t="";return e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.metaKey&&(t+="meta+"),t+=ot.toString(e.keyCode),t}_getSingleModifierChordDispatch(e){return e.keyCode===y.Ctrl&&!e.shiftKey&&!e.altKey&&!e.metaKey?"ctrl":e.keyCode===y.Shift&&!e.ctrlKey&&!e.altKey&&!e.metaKey?"shift":e.keyCode===y.Alt&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey?"alt":e.keyCode===y.Meta&&!e.ctrlKey&&!e.shiftKey&&!e.altKey?"meta":null}static getProducedCharCode(e,t){return t?e.ctrlKey&&e.shiftKey&&e.altKey?t.withShiftAltGr:e.ctrlKey&&e.altKey?t.withAltGr:e.shiftKey?t.withShift:t.value:null}static getProducedChar(e,t){const i=this.getProducedCharCode(e,t);return i===null||i.length===0?" --- ":"  "+i+"  "}}class FA{constructor(e,t,i){this._isUSStandard=e,this._mapAltGrToCtrlAlt=i,this._keyCodeToLabel=[],this._scanCodeToKeyCode=[],this._keyCodeToLabel=[],this._keyCodeExists=[],this._keyCodeToLabel[y.Unknown]=ot.toString(y.Unknown);for(let r=T.None;r<T.MAX_VALUE;r++){const d=ii[r];d!==y.DependsOnKbLayout&&(this._scanCodeToKeyCode[r]=d,this._keyCodeToLabel[d]=ot.toString(d),this._keyCodeExists[d]=!0)}const s=[];let o=!1;this._codeInfo=[];for(const r in t)if(t.hasOwnProperty(r)){const d=Wt.toEnum(r);if(d===T.None)continue;const l=t[r],h=ii[d];if(h!==y.DependsOnKbLayout){const A=hp[l.vkey]||y.Unknown;if(A===y.Unknown||h===A||d!==T.NumpadComma)continue}const p=l.value,f=l.withShift,g=l.withAltGr,m=l.withShiftAltGr,v=hp[l.vkey]||y.Unknown,b={scanCode:d,keyCode:v,value:p,withShift:f,withAltGr:g,withShiftAltGr:m};if(this._codeInfo[d]=b,this._scanCodeToKeyCode[d]=v,v===y.Unknown)continue;if(this._keyCodeExists[v]=!0,p.length===0)this._keyCodeToLabel[v]=null;else if(p.length>1)this._keyCodeToLabel[v]=p;else{const A=p.charCodeAt(0);if(A>=_.a&&A<=_.z){const K=_.A+(A-_.a);s[K]=!0,o=!0,this._keyCodeToLabel[v]=String.fromCharCode(_.A+(A-_.a))}else A>=_.A&&A<=_.Z?(s[A]=!0,o=!0,this._keyCodeToLabel[v]=p):this._keyCodeToLabel[v]=p}}const n=(r,d)=>{s[r]||(this._keyCodeToLabel[d]=String.fromCharCode(r))};if(n(_.A,y.KeyA),n(_.B,y.KeyB),n(_.C,y.KeyC),n(_.D,y.KeyD),n(_.E,y.KeyE),n(_.F,y.KeyF),n(_.G,y.KeyG),n(_.H,y.KeyH),n(_.I,y.KeyI),n(_.J,y.KeyJ),n(_.K,y.KeyK),n(_.L,y.KeyL),n(_.M,y.KeyM),n(_.N,y.KeyN),n(_.O,y.KeyO),n(_.P,y.KeyP),n(_.Q,y.KeyQ),n(_.R,y.KeyR),n(_.S,y.KeyS),n(_.T,y.KeyT),n(_.U,y.KeyU),n(_.V,y.KeyV),n(_.W,y.KeyW),n(_.X,y.KeyX),n(_.Y,y.KeyY),n(_.Z,y.KeyZ),!o){const r=(d,l)=>{this._keyCodeToLabel[d]=String.fromCharCode(l)};r(y.Semicolon,_.Semicolon),r(y.Equal,_.Equals),r(y.Comma,_.Comma),r(y.Minus,_.Dash),r(y.Period,_.Period),r(y.Slash,_.Slash),r(y.Backquote,_.BackTick),r(y.BracketLeft,_.OpenSquareBracket),r(y.Backslash,_.Backslash),r(y.BracketRight,_.CloseSquareBracket),r(y.Quote,_.SingleQuote)}}dumpDebugInfo(){const e=[],t=[T.ArrowUp,T.Numpad0];let i=0;e.push("-----------------------------------------------------------------------------------------------------------------------------------------");for(let s=T.None;s<T.MAX_VALUE;s++){if(ii[s]!==y.DependsOnKbLayout&&t.indexOf(s)===-1)continue;i%6===0&&(e.push("|       HW Code combination      |  Key  |    KeyCode combination    |          UI label         |        User settings       | WYSIWYG |"),e.push("-----------------------------------------------------------------------------------------------------------------------------------------")),i++;const o=this._codeInfo[s],n=Wt.toString(s),r=[0,2,5,7];for(const d of r){const l=!!(d&1),h=!!(d&2),p=!!(d&4),f=new Cs(l,h,p,!1,s),g=this._resolveChord(f),m=g?ot.toString(g.keyCode):null,v=g?new _n(this,[g]):null,b=`${l?"Ctrl+":""}${h?"Shift+":""}${p?"Alt+":""}${n}`,A=v?v.getAriaLabel():null,K=A?A.replace(/Control\+/,"Ctrl+"):null,P=v?v.getUserSettingsLabel():null,L=_n.getProducedChar(f,o),$=m?`${l?"Ctrl+":""}${h?"Shift+":""}${p?"Alt+":""}${m}`:null,Z=(v?v.isWYSIWYG():!1)?"       ":"   NO  ";e.push(`| ${this._leftPad(b,30)} | ${L} | ${this._leftPad($,25)} | ${this._leftPad(K,25)} |  ${this._leftPad(P,25)} | ${Z} |`)}e.push("-----------------------------------------------------------------------------------------------------------------------------------------")}return e.join(`
`)}_leftPad(e,t){for(e===null&&(e="null");e.length<t;)e=" "+e;return e}getUILabelForKeyCode(e){return this._getLabelForKeyCode(e)}getAriaLabelForKeyCode(e){return this._getLabelForKeyCode(e)}getUserSettingsLabelForKeyCode(e){return this._isUSStandard?ot.toUserSettingsUS(e):ot.toUserSettingsGeneral(e)}getElectronAcceleratorForKeyBinding(e){return ot.toElectronAccelerator(e.keyCode)}_getLabelForKeyCode(e){return this._keyCodeToLabel[e]||ot.toString(y.Unknown)}resolveKeyboardEvent(e){const t=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,i=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,s=new Is(t,e.shiftKey,i,e.metaKey,e.keyCode);return new _n(this,[s])}_resolveChord(e){if(!e)return null;if(e instanceof Is)return this._keyCodeExists[e.keyCode]?e:null;const t=this._scanCodeToKeyCode[e.scanCode]||y.Unknown;return t===y.Unknown||!this._keyCodeExists[t]?null:new Is(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,t)}resolveKeybinding(e){const t=yv(e.chords.map(i=>this._resolveChord(i)));return t.length>0?[new _n(this,t)]:[]}}const Bn=[];class Bg extends Sf{constructor(e,t,i){super(t,i),this._mapper=e}_getLabel(e){return this._mapper.getUILabelForScanCodeChord(e)}_getAriaLabel(e){return this._mapper.getAriaLabelForScanCodeChord(e)}_getElectronAccelerator(e){return this._mapper.getElectronAcceleratorLabelForScanCodeChord(e)}_getUserSettingsLabel(e){return this._mapper.getUserSettingsLabelForScanCodeChord(e)}_isWYSIWYG(e){if(!e||ii[e.scanCode]!==y.DependsOnKbLayout)return!0;const t=this._mapper.getAriaLabelForScanCodeChord(e),i=this._mapper.getUserSettingsLabelForScanCodeChord(e);return!t&&!i?!0:!t||!i?!1:t.toLowerCase()===i.toLowerCase()}_getChordDispatch(e){return this._mapper.getDispatchStrForScanCodeChord(e)}_getSingleModifierChordDispatch(e){return(e.scanCode===T.ControlLeft||e.scanCode===T.ControlRight)&&!e.shiftKey&&!e.altKey&&!e.metaKey?"ctrl":(e.scanCode===T.AltLeft||e.scanCode===T.AltRight)&&!e.ctrlKey&&!e.shiftKey&&!e.metaKey?"alt":(e.scanCode===T.ShiftLeft||e.scanCode===T.ShiftRight)&&!e.ctrlKey&&!e.altKey&&!e.metaKey?"shift":(e.scanCode===T.MetaLeft||e.scanCode===T.MetaRight)&&!e.ctrlKey&&!e.shiftKey&&!e.altKey?"meta":null}}class Fn{constructor(e,t,i,s){this.ctrlKey=e,this.shiftKey=t,this.altKey=i,this.scanCode=s}toString(){return`${this.ctrlKey?"Ctrl+":""}${this.shiftKey?"Shift+":""}${this.altKey?"Alt+":""}${Wt.toString(this.scanCode)}`}equals(e){return this.ctrlKey===e.ctrlKey&&this.shiftKey===e.shiftKey&&this.altKey===e.altKey&&this.scanCode===e.scanCode}getProducedCharCode(e){return e?this.ctrlKey&&this.shiftKey&&this.altKey?e.withShiftAltGr:this.ctrlKey&&this.altKey?e.withAltGr:this.shiftKey?e.withShift:e.value:""}getProducedChar(e){const t=ei.getCharCode(this.getProducedCharCode(e));return t===0?" --- ":t>=_.U_Combining_Grave_Accent&&t<=_.U_Combining_Latin_Small_Letter_X?"U+"+t.toString(16):"  "+String.fromCharCode(t)+"  "}}class _l{constructor(e,t,i,s){this.ctrlKey=e,this.shiftKey=t,this.altKey=i,this.keyCode=s}toString(){return`${this.ctrlKey?"Ctrl+":""}${this.shiftKey?"Shift+":""}${this.altKey?"Alt+":""}${ot.toString(this.keyCode)}`}}class KA{constructor(){this._scanCodeToKeyCode=[],this._keyCodeToScanCode=[],this._scanCodeToKeyCode=[],this._keyCodeToScanCode=[]}registrationComplete(){this._moveToEnd(T.IntlHash),this._moveToEnd(T.IntlBackslash)}_moveToEnd(e){for(let t=0;t<8;t++){const i=this._scanCodeToKeyCode[(e<<3)+t];if(i)for(let s=0,o=i.length;s<o;s++){const n=this._keyCodeToScanCode[i[s]];if(n.length!==1)for(let r=0,d=n.length;r<d;r++){const l=n[r];if(l>>>3===e){for(let p=r+1;p<d;p++)n[p-1]=n[p];n[d-1]=l}}}}}registerIfUnknown(e,t){if(t.keyCode===y.Unknown)return;const i=this._encodeScanCodeCombo(e),s=this._encodeKeyCodeCombo(t),o=t.keyCode>=y.Digit0&&t.keyCode<=y.Digit9,n=t.keyCode>=y.KeyA&&t.keyCode<=y.KeyZ,r=this._scanCodeToKeyCode[i];if(o||n){if(r){for(let d=0,l=r.length;d<l;d++)if(r[d]===s)return}}else if(r&&r.length!==0)return;this._scanCodeToKeyCode[i]=this._scanCodeToKeyCode[i]||[],this._scanCodeToKeyCode[i].unshift(s),this._keyCodeToScanCode[s]=this._keyCodeToScanCode[s]||[],this._keyCodeToScanCode[s].unshift(i)}lookupKeyCodeCombo(e){const t=this._encodeKeyCodeCombo(e),i=this._keyCodeToScanCode[t];if(!i||i.length===0)return[];const s=[];for(let o=0,n=i.length;o<n;o++){const r=i[o],d=!!(r&1),l=!!(r&2),h=!!(r&4),p=r>>>3;s[o]=new Fn(d,l,h,p)}return s}lookupScanCodeCombo(e){const t=this._encodeScanCodeCombo(e),i=this._scanCodeToKeyCode[t];if(!i||i.length===0)return[];const s=[];for(let o=0,n=i.length;o<n;o++){const r=i[o],d=!!(r&1),l=!!(r&2),h=!!(r&4),p=r>>>3;s[o]=new _l(d,l,h,p)}return s}guessStableKeyCode(e){if(e>=T.Digit1&&e<=T.Digit0)switch(e){case T.Digit1:return y.Digit1;case T.Digit2:return y.Digit2;case T.Digit3:return y.Digit3;case T.Digit4:return y.Digit4;case T.Digit5:return y.Digit5;case T.Digit6:return y.Digit6;case T.Digit7:return y.Digit7;case T.Digit8:return y.Digit8;case T.Digit9:return y.Digit9;case T.Digit0:return y.Digit0}const t=this.lookupScanCodeCombo(new Fn(!1,!1,!1,e)),i=this.lookupScanCodeCombo(new Fn(!1,!0,!1,e));if(t.length===1&&i.length===1){const s=t[0].shiftKey,o=t[0].keyCode,n=i[0].shiftKey,r=i[0].keyCode;if(o===r&&s!==n)return o}return y.DependsOnKbLayout}_encodeScanCodeCombo(e){return this._encode(e.ctrlKey,e.shiftKey,e.altKey,e.scanCode)}_encodeKeyCodeCombo(e){return this._encode(e.ctrlKey,e.shiftKey,e.altKey,e.keyCode)}_encode(e,t,i,s){return((e?1:0)<<0|(t?1:0)<<1|(i?1:0)<<2|s<<3)>>>0}}class ei{constructor(e,t,i,s){this._isUSStandard=e,this._mapAltGrToCtrlAlt=i,this._OS=s,this._scanCodeToLabel=[],this._scanCodeToDispatch=[],this._codeInfo=[],this._scanCodeKeyCodeMapper=new KA,this._scanCodeToLabel=[],this._scanCodeToDispatch=[];const o=(h,p,f,g,m,v,b,A)=>{this._scanCodeKeyCodeMapper.registerIfUnknown(new Fn(!!h,!!p,!!f,g),new _l(!!m,!!v,!!b,A))},n=(h,p,f,g,m)=>{for(let v=h;v<=1;v++)for(let b=p;b<=1;b++)for(let A=f;A<=1;A++)o(v,b,A,g,v,b,A,m)};for(let h=T.None;h<T.MAX_VALUE;h++)this._scanCodeToLabel[h]=null;for(let h=T.None;h<T.MAX_VALUE;h++)this._scanCodeToDispatch[h]=null;for(let h=T.None;h<T.MAX_VALUE;h++){const p=ii[h];p!==y.DependsOnKbLayout&&(n(0,0,0,h,p),this._scanCodeToLabel[h]=ot.toString(p),p===y.Unknown||p===y.Ctrl||p===y.Meta||p===y.Alt||p===y.Shift?this._scanCodeToDispatch[h]=null:this._scanCodeToDispatch[h]=`[${Wt.toString(h)}]`)}const r={};{const h=[];for(const f in t)if(t.hasOwnProperty(f)){const g=Wt.toEnum(f);if(g===T.None||ii[g]!==y.DependsOnKbLayout)continue;const m=t[f],v=ei.getCharCode(m.value);if(v>=_.a&&v<=_.z){const b=_.A+(v-_.a);h[b]=!0}}const p=(f,g,m,v)=>{h[f]||(r[Wt.toString(g)]={value:m,withShift:v,withAltGr:"",withShiftAltGr:""})};p(_.A,T.KeyA,"a","A"),p(_.B,T.KeyB,"b","B"),p(_.C,T.KeyC,"c","C"),p(_.D,T.KeyD,"d","D"),p(_.E,T.KeyE,"e","E"),p(_.F,T.KeyF,"f","F"),p(_.G,T.KeyG,"g","G"),p(_.H,T.KeyH,"h","H"),p(_.I,T.KeyI,"i","I"),p(_.J,T.KeyJ,"j","J"),p(_.K,T.KeyK,"k","K"),p(_.L,T.KeyL,"l","L"),p(_.M,T.KeyM,"m","M"),p(_.N,T.KeyN,"n","N"),p(_.O,T.KeyO,"o","O"),p(_.P,T.KeyP,"p","P"),p(_.Q,T.KeyQ,"q","Q"),p(_.R,T.KeyR,"r","R"),p(_.S,T.KeyS,"s","S"),p(_.T,T.KeyT,"t","T"),p(_.U,T.KeyU,"u","U"),p(_.V,T.KeyV,"v","V"),p(_.W,T.KeyW,"w","W"),p(_.X,T.KeyX,"x","X"),p(_.Y,T.KeyY,"y","Y"),p(_.Z,T.KeyZ,"z","Z")}const d=[];let l=0;for(const h in t)if(t.hasOwnProperty(h)){const p=Wt.toEnum(h);if(p===T.None||ii[p]!==y.DependsOnKbLayout)continue;this._codeInfo[p]=t[h];const f=r[h]||t[h],g=ei.getCharCode(f.value),m=ei.getCharCode(f.withShift),v=ei.getCharCode(f.withAltGr),b=ei.getCharCode(f.withShiftAltGr),A={scanCode:p,value:g,withShift:m,withAltGr:v,withShiftAltGr:b};if(d[l++]=A,this._scanCodeToDispatch[p]=`[${Wt.toString(p)}]`,g>=_.a&&g<=_.z){const K=_.A+(g-_.a);this._scanCodeToLabel[p]=String.fromCharCode(K)}else g>=_.A&&g<=_.Z?this._scanCodeToLabel[p]=String.fromCharCode(g):g?this._scanCodeToLabel[p]=String.fromCharCode(g):this._scanCodeToLabel[p]=null}for(let h=d.length-1;h>=0;h--){const p=d[h],f=p.scanCode,g=p.withShiftAltGr;if(g===p.withAltGr||g===p.withShift||g===p.value)continue;const m=ei._charCodeToKb(g);if(!m)continue;const v=m.shiftKey,b=m.keyCode;v?o(1,1,1,f,0,1,0,b):o(1,1,1,f,0,0,0,b)}for(let h=d.length-1;h>=0;h--){const p=d[h],f=p.scanCode,g=p.withAltGr;if(g===p.withShift||g===p.value)continue;const m=ei._charCodeToKb(g);if(!m)continue;const v=m.shiftKey,b=m.keyCode;v?o(1,0,1,f,0,1,0,b):o(1,0,1,f,0,0,0,b)}for(let h=d.length-1;h>=0;h--){const p=d[h],f=p.scanCode,g=p.withShift;if(g===p.value)continue;const m=ei._charCodeToKb(g);if(!m)continue;const v=m.shiftKey,b=m.keyCode;v?(o(0,1,0,f,0,1,0,b),o(0,1,1,f,0,1,1,b),o(1,1,0,f,1,1,0,b),o(1,1,1,f,1,1,1,b)):(o(0,1,0,f,0,0,0,b),o(0,1,0,f,0,1,0,b),o(0,1,1,f,0,0,1,b),o(0,1,1,f,0,1,1,b),o(1,1,0,f,1,0,0,b),o(1,1,0,f,1,1,0,b),o(1,1,1,f,1,0,1,b),o(1,1,1,f,1,1,1,b))}for(let h=d.length-1;h>=0;h--){const p=d[h],f=p.scanCode,g=ei._charCodeToKb(p.value);if(!g)continue;const m=g.shiftKey,v=g.keyCode;m?(o(0,0,0,f,0,1,0,v),o(0,0,1,f,0,1,1,v),o(1,0,0,f,1,1,0,v),o(1,0,1,f,1,1,1,v)):(o(0,0,0,f,0,0,0,v),o(0,0,1,f,0,0,1,v),o(0,1,0,f,0,1,0,v),o(0,1,1,f,0,1,1,v),o(1,0,0,f,1,0,0,v),o(1,0,1,f,1,0,1,v),o(1,1,0,f,1,1,0,v),o(1,1,1,f,1,1,1,v))}n(0,0,0,T.Digit1,y.Digit1),n(0,0,0,T.Digit2,y.Digit2),n(0,0,0,T.Digit3,y.Digit3),n(0,0,0,T.Digit4,y.Digit4),n(0,0,0,T.Digit5,y.Digit5),n(0,0,0,T.Digit6,y.Digit6),n(0,0,0,T.Digit7,y.Digit7),n(0,0,0,T.Digit8,y.Digit8),n(0,0,0,T.Digit9,y.Digit9),n(0,0,0,T.Digit0,y.Digit0),this._scanCodeKeyCodeMapper.registrationComplete()}dumpDebugInfo(){const e=[],t=[T.ArrowUp,T.Numpad0];let i=0;e.push(`isUSStandard: ${this._isUSStandard}`),e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------");for(let s=T.None;s<T.MAX_VALUE;s++){if(ii[s]!==y.DependsOnKbLayout&&t.indexOf(s)===-1)continue;i%4===0&&(e.push("|       HW Code combination      |  Key  |    KeyCode combination    | Pri |          UI label         |         User settings          |    Electron accelerator   |       Dispatching string       | WYSIWYG |"),e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------")),i++;const o=this._codeInfo[s];for(let n=0;n<8;n++){const r=!!(n&1),d=!!(n&2),l=!!(n&4),h=new Fn(r,d,l,s),p=this.resolveKeyboardEvent({_standardKeyboardEventBrand:!0,ctrlKey:h.ctrlKey,shiftKey:h.shiftKey,altKey:h.altKey,metaKey:!1,altGraphKey:!1,keyCode:y.DependsOnKbLayout,code:Wt.toString(s)}),f=h.toString(),g=h.getProducedChar(o),m=p.getAriaLabel(),v=m?m.replace(/Control\+/,"Ctrl+"):null,b=p.getUserSettingsLabel(),A=p.getElectronAccelerator(),K=p.getDispatchChords()[0],L=(p?p.isWYSIWYG():!1)?"       ":"   NO  ",$=this._scanCodeKeyCodeMapper.lookupScanCodeCombo(h);if($.length===0)e.push(`| ${this._leftPad(f,30)} | ${g} | ${this._leftPad("",25)} | ${this._leftPad("",3)} | ${this._leftPad(v,25)} | ${this._leftPad(b,30)} | ${this._leftPad(A,25)} | ${this._leftPad(K,30)} | ${L} |`);else for(let z=0,Z=$.length;z<Z;z++){const ne=$[z];let Me;const bt=this._scanCodeKeyCodeMapper.lookupKeyCodeCombo(ne);if(bt.length===1)Me="";else{let Ii=-1;for(let $e=0;$e<bt.length;$e++)if(bt[$e].equals(h)){Ii=$e+1;break}Me=String(Ii)}const lt=ne.toString();z===0?e.push(`| ${this._leftPad(f,30)} | ${g} | ${this._leftPad(lt,25)} | ${this._leftPad(Me,3)} | ${this._leftPad(v,25)} | ${this._leftPad(b,30)} | ${this._leftPad(A,25)} | ${this._leftPad(K,30)} | ${L} |`):e.push(`| ${this._leftPad("",30)} |       | ${this._leftPad(lt,25)} | ${this._leftPad(Me,3)} | ${this._leftPad("",25)} | ${this._leftPad("",30)} | ${this._leftPad("",25)} | ${this._leftPad("",30)} |         |`)}}e.push("----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------")}return e.join(`
`)}_leftPad(e,t){for(e===null&&(e="null");e.length<t;)e=" "+e;return e}keyCodeChordToScanCodeChord(e){if(e.keyCode===y.Enter)return[new Cs(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,T.Enter)];const t=this._scanCodeKeyCodeMapper.lookupKeyCodeCombo(new _l(e.ctrlKey,e.shiftKey,e.altKey,e.keyCode)),i=[];for(let s=0,o=t.length;s<o;s++){const n=t[s];i[s]=new Cs(n.ctrlKey,n.shiftKey,n.altKey,e.metaKey,n.scanCode)}return i}getUILabelForScanCodeChord(e){if(!e)return null;if(e.isDuplicateModifierCase())return"";if(this._OS===fi.Macintosh)switch(e.scanCode){case T.ArrowLeft:return"←";case T.ArrowUp:return"↑";case T.ArrowRight:return"→";case T.ArrowDown:return"↓"}return this._scanCodeToLabel[e.scanCode]}getAriaLabelForScanCodeChord(e){return e?e.isDuplicateModifierCase()?"":this._scanCodeToLabel[e.scanCode]:null}getDispatchStrForScanCodeChord(e){const t=this._scanCodeToDispatch[e.scanCode];if(!t)return null;let i="";return e.ctrlKey&&(i+="ctrl+"),e.shiftKey&&(i+="shift+"),e.altKey&&(i+="alt+"),e.metaKey&&(i+="meta+"),i+=t,i}getUserSettingsLabelForScanCodeChord(e){if(!e)return null;if(e.isDuplicateModifierCase())return"";const t=ii[e.scanCode];if(t!==y.DependsOnKbLayout)return ot.toUserSettingsUS(t).toLowerCase();const i=this._scanCodeKeyCodeMapper.guessStableKeyCode(e.scanCode);if(i!==y.DependsOnKbLayout){const s=this.keyCodeChordToScanCodeChord(new Is(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,i));for(let o=0,n=s.length;o<n;o++)if(s[o].scanCode===e.scanCode)return ot.toUserSettingsUS(i).toLowerCase()}return this._scanCodeToDispatch[e.scanCode]}getElectronAcceleratorLabelForScanCodeChord(e){if(!e)return null;const t=ii[e.scanCode];if(t!==y.DependsOnKbLayout)return ot.toElectronAccelerator(t);const i=this._scanCodeKeyCodeMapper.guessStableKeyCode(e.scanCode);return this._OS===fi.Linux&&!this._isUSStandard&&(i===y.Semicolon||i===y.Equal||i===y.Comma||i===y.Minus||i===y.Period||i===y.Slash||i===y.Backquote||i===y.BracketLeft||i===y.Backslash||i===y.BracketRight)?null:i!==y.DependsOnKbLayout?ot.toElectronAccelerator(i):null}_toResolvedKeybinding(e){if(e.length===0)return[];const t=[];return this._generateResolvedKeybindings(e,0,[],t),t}_generateResolvedKeybindings(e,t,i,s){const o=e[t],n=t===e.length-1;for(let r=0,d=o.length;r<d;r++){const l=[...i,o[r]];n?s.push(new Bg(this,this._OS,l)):this._generateResolvedKeybindings(e,t+1,l,s)}}resolveKeyboardEvent(e){let t=Wt.toEnum(e.code);t===T.NumpadEnter&&(t=T.Enter);const i=e.keyCode;if(i===y.LeftArrow||i===y.UpArrow||i===y.RightArrow||i===y.DownArrow||i===y.Delete||i===y.Insert||i===y.Home||i===y.End||i===y.PageDown||i===y.PageUp||i===y.Backspace){const r=up[i];r!==T.DependsOnKbLayout&&(t=r)}else if((t===T.Numpad1||t===T.Numpad2||t===T.Numpad3||t===T.Numpad4||t===T.Numpad5||t===T.Numpad6||t===T.Numpad7||t===T.Numpad8||t===T.Numpad9||t===T.Numpad0||t===T.NumpadDecimal)&&i>=0){const r=up[i];r!==T.DependsOnKbLayout&&(t=r)}const s=e.ctrlKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,o=e.altKey||this._mapAltGrToCtrlAlt&&e.altGraphKey,n=new Cs(s,e.shiftKey,o,e.metaKey,t);return new Bg(this,this._OS,[n])}_resolveChord(e){return e?e instanceof Cs?[e]:this.keyCodeChordToScanCodeChord(e):[]}resolveKeybinding(e){const t=e.chords.map(i=>this._resolveChord(i));return this._toResolvedKeybinding(t)}static _redirectCharCode(e){switch(e){case _.U_IDEOGRAPHIC_FULL_STOP:return _.Period;case _.U_LEFT_CORNER_BRACKET:return _.OpenSquareBracket;case _.U_RIGHT_CORNER_BRACKET:return _.CloseSquareBracket;case _.U_LEFT_BLACK_LENTICULAR_BRACKET:return _.OpenSquareBracket;case _.U_RIGHT_BLACK_LENTICULAR_BRACKET:return _.CloseSquareBracket;case _.U_FULLWIDTH_SEMICOLON:return _.Semicolon;case _.U_FULLWIDTH_COMMA:return _.Comma}return e}static _charCodeToKb(e){return e=this._redirectCharCode(e),e<Bn.length?Bn[e]:null}static getCharCode(e){if(e.length===0)return 0;const t=e.charCodeAt(0);switch(t){case _.U_Combining_Grave_Accent:return _.U_GRAVE_ACCENT;case _.U_Combining_Acute_Accent:return _.U_ACUTE_ACCENT;case _.U_Combining_Circumflex_Accent:return _.U_CIRCUMFLEX;case _.U_Combining_Tilde:return _.U_SMALL_TILDE;case _.U_Combining_Macron:return _.U_MACRON;case _.U_Combining_Overline:return _.U_OVERLINE;case _.U_Combining_Breve:return _.U_BREVE;case _.U_Combining_Dot_Above:return _.U_DOT_ABOVE;case _.U_Combining_Diaeresis:return _.U_DIAERESIS;case _.U_Combining_Ring_Above:return _.U_RING_ABOVE;case _.U_Combining_Double_Acute_Accent:return _.U_DOUBLE_ACUTE_ACCENT}return t}}(function(){function a(e,t,i){for(let s=Bn.length;s<e;s++)Bn[s]=null;Bn[e]={keyCode:t,shiftKey:i}}for(let e=_.A;e<=_.Z;e++)a(e,y.KeyA+(e-_.A),!0);for(let e=_.a;e<=_.z;e++)a(e,y.KeyA+(e-_.a),!1);a(_.Semicolon,y.Semicolon,!1),a(_.Colon,y.Semicolon,!0),a(_.Equals,y.Equal,!1),a(_.Plus,y.Equal,!0),a(_.Comma,y.Comma,!1),a(_.LessThan,y.Comma,!0),a(_.Dash,y.Minus,!1),a(_.Underline,y.Minus,!0),a(_.Period,y.Period,!1),a(_.GreaterThan,y.Period,!0),a(_.Slash,y.Slash,!1),a(_.QuestionMark,y.Slash,!0),a(_.BackTick,y.Backquote,!1),a(_.Tilde,y.Backquote,!0),a(_.OpenSquareBracket,y.BracketLeft,!1),a(_.OpenCurlyBrace,y.BracketLeft,!0),a(_.Backslash,y.Backslash,!1),a(_.Pipe,y.Backslash,!0),a(_.CloseSquareBracket,y.BracketRight,!1),a(_.CloseCurlyBrace,y.BracketRight,!0),a(_.SingleQuote,y.Quote,!1),a(_.DoubleQuote,y.Quote,!0)})();function WA(a){switch(a){case"./keyboardLayouts/layout.contribution.darwin.js":return wc(()=>import("./layout.contribution.darwin-CNuKAPkw.js"),__vite__mapDeps([0,1])).then(e=>e.default??e);case"./keyboardLayouts/layout.contribution.linux.js":return wc(()=>import("./layout.contribution.linux-CkqTuM6V.js"),__vite__mapDeps([2,1])).then(e=>e.default??e);case"./keyboardLayouts/layout.contribution.win.js":return wc(()=>import("./layout.contribution.win-D72LutgT.js"),__vite__mapDeps([3,1])).then(e=>e.default??e);default:return new Promise(function(e,t){(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(t.bind(null,new Error("Unknown variable dynamic import: "+a)))})}}class GA extends R{get activeKeymap(){return this._activeKeymapInfo}get keymapInfos(){return this._keymapInfos}get activeKeyboardLayout(){return this._initialized?this._activeKeymapInfo?.layout??null:null}get activeKeyMapping(){return this._initialized?this._activeKeymapInfo?.mapping??null:null}get keyboardLayouts(){return this._keymapInfos.map(e=>e.layout)}constructor(e){super(),this._configurationService=e,this._onDidChangeKeyboardMapper=new E,this.onDidChangeKeyboardMapper=this._onDidChangeKeyboardMapper.event,this.keyboardLayoutMapAllowed=navigator.keyboard!==void 0,this._keyboardMapper=null,this._initialized=!1,this._keymapInfos=[],this._mru=[],this._activeKeymapInfo=null,navigator.keyboard&&navigator.keyboard.addEventListener&&navigator.keyboard.addEventListener("layoutchange",()=>{this._getBrowserKeyMapping().then(t=>{this.isKeyMappingActive(t)||this.setLayoutFromBrowserAPI()})}),this._register(this._configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration("keyboard")&&(this._keyboardMapper=null,this._onDidChangeKeyboardMapper.fire())}))}registerKeyboardLayout(e){this._keymapInfos.push(e),this._mru=this._keymapInfos}removeKeyboardLayout(e){let t=this._mru.indexOf(e);this._mru.splice(t,1),t=this._keymapInfos.indexOf(e),this._keymapInfos.splice(t,1)}getMatchedKeymapInfo(e){if(!e)return null;const t=this.getUSStandardLayout();if(t){let i=t.getScore(e);if(i===0)return{result:t,score:0};let s=t;for(let o=0;o<this._mru.length;o++){const n=this._mru[o].getScore(e);if(n>i){if(n===0)return{result:this._mru[o],score:0};i=n,s=this._mru[o]}}return{result:s,score:i}}for(let i=0;i<this._mru.length;i++)if(this._mru[i].fuzzyEqual(e))return{result:this._mru[i],score:0};return null}getUSStandardLayout(){const e=this._mru.filter(t=>t.layout.isUSStandard);return e.length?e[0]:null}isKeyMappingActive(e){return this._activeKeymapInfo&&e&&this._activeKeymapInfo.fuzzyEqual(e)}setUSKeyboardLayout(){this._activeKeymapInfo=this.getUSStandardLayout()}setActiveKeyMapping(e){let t=!1;const i=this.getMatchedKeymapInfo(e);if(i&&(this._activeKeymapInfo?e&&i.result.getScore(e)>this._activeKeymapInfo.getScore(e)&&(this._activeKeymapInfo=i.result,t=!0):(this._activeKeymapInfo=i.result,t=!0)),this._activeKeymapInfo||(this._activeKeymapInfo=this.getUSStandardLayout(),t=!0),!this._activeKeymapInfo||!t)return;const s=this._mru.indexOf(this._activeKeymapInfo);this._mru.splice(s,1),this._mru.unshift(this._activeKeymapInfo),this._setKeyboardData(this._activeKeymapInfo)}setActiveKeymapInfo(e){this._activeKeymapInfo=e;const t=this._mru.indexOf(this._activeKeymapInfo);t!==0&&(this._mru.splice(t,1),this._mru.unshift(this._activeKeymapInfo),this._setKeyboardData(this._activeKeymapInfo))}setLayoutFromBrowserAPI(){this._updateKeyboardLayoutAsync(this._initialized)}_updateKeyboardLayoutAsync(e,t){e&&this._getBrowserKeyMapping(t).then(i=>{this.isKeyMappingActive(i)||this.setActiveKeyMapping(i)})}getKeyboardMapper(){const e=MA(this._configurationService);return e.dispatch===ir.KeyCode||!this._initialized||!this._activeKeymapInfo?new Yp(e.mapAltGrToCtrlAlt,Ht):(this._keyboardMapper||(this._keyboardMapper=new BA(ay._createKeyboardMapper(this._activeKeymapInfo,e.mapAltGrToCtrlAlt))),this._keyboardMapper)}validateCurrentKeyboardMapping(e){!this._initialized||this._validateCurrentKeyboardMapping(e)||this._updateKeyboardLayoutAsync(!0,e)}setKeyboardLayout(e){const t=this.keymapInfos.filter(i=>tr(i.layout)===e);t.length>0&&this.setActiveKeymapInfo(t[0])}_setKeyboardData(e){this._initialized=!0,this._keyboardMapper=null,this._onDidChangeKeyboardMapper.fire()}static _createKeyboardMapper(e,t){const i=e.mapping,s=!!e.layout.isUSStandard;return Ht===fi.Windows?new FA(s,i,t):Object.keys(i).length===0?new Yp(t,Ht):new ei(s,i,t,Ht)}_validateCurrentKeyboardMapping(e){if(!this._initialized)return!0;const t=e,i=this._activeKeymapInfo;if(!i||t.browserEvent.key==="Dead"||t.browserEvent.isComposing)return!0;const s=i.mapping[t.code];if(!s)return!1;if(s.value==="")return(e.ctrlKey||e.metaKey)&&setTimeout(()=>{this._getBrowserKeyMapping().then(r=>{this.isKeyMappingActive(r)||this.setLayoutFromBrowserAPI()})},350),!0;const o=t.altKey&&t.shiftKey?s.withShiftAltGr:t.altKey?s.withAltGr:t.shiftKey?s.withShift:s.value,n=t.altKey&&t.shiftKey&&s.withShiftAltGrIsDeadKey||t.altKey&&s.withAltGrIsDeadKey||t.shiftKey&&s.withShiftIsDeadKey||s.valueIsDeadKey;return!(n&&t.browserEvent.key!=="Dead"||!n&&t.browserEvent.key!==o)}async _getBrowserKeyMapping(e){if(this.keyboardLayoutMapAllowed)try{return await navigator.keyboard.getLayoutMap().then(t=>{const i={};for(const s of t)i[s[0]]={value:s[1],withShift:"",withAltGr:"",withShiftAltGr:""};return i})}catch{this.keyboardLayoutMapAllowed=!1}if(e&&!e.shiftKey&&!e.altKey&&!e.metaKey&&!e.metaKey){const t={},i=e;return t[i.browserEvent.code]={value:i.browserEvent.key,withShift:"",withAltGr:"",withShiftAltGr:""},this.getMatchedKeymapInfo(t)?t:null}return null}}class ay extends GA{constructor(e,t,i,s){super(e),WA(`./keyboardLayouts/layout.contribution.${to?"win":ut?"darwin":"linux"}.js`).then(n=>{const r=n.KeyboardLayoutContribution.INSTANCE.layoutInfos;this._keymapInfos.push(...r.map(d=>new Hd(d.layout,d.secondaryLayouts,d.mapping,d.isUserKeyboardLayout))),this._mru=this._keymapInfos,this._initialized=!0,this.setLayoutFromBrowserAPI()})}}class UA extends R{get keyboardLayout(){return this._keyboardLayout}constructor(e,t){super(),this.keyboardLayoutResource=e,this.fileService=t,this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,this._keyboardLayout=null,this.reloadConfigurationScheduler=this._register(new ur(()=>this.reload().then(i=>{i&&this._onDidChange.fire()}),50)),this._register(V.filter(this.fileService.onDidFilesChange,i=>i.contains(this.keyboardLayoutResource))(()=>this.reloadConfigurationScheduler.schedule()))}async initialize(){await this.reload()}async reload(){const e=this._keyboardLayout;try{const t=await this.fileService.readFile(this.keyboardLayoutResource),i=bf(t.value.toString());if(bv(i)==="object"){const s=i.layout,o=i.rawMapping;this._keyboardLayout=Hd.createKeyboardLayoutFromDebugInfo(s,o,!0)}else this._keyboardLayout=null}catch{this._keyboardLayout=null}return e?!vf(e,this._keyboardLayout):!0}}let El=class extends R{constructor(e,t,i,s,o,n){super(),this.configurationService=n,this._onDidChangeKeyboardLayout=new E,this.onDidChangeKeyboardLayout=this._onDidChangeKeyboardLayout.event;const d=n.getValue("keyboard").layout;this._keyboardLayoutMode=d??"autodetect",this._factory=new ay(n,i,s,o),this._register(this._factory.onDidChangeKeyboardMapper(()=>{this._onDidChangeKeyboardLayout.fire()})),d&&d!=="autodetect"&&this._factory.setKeyboardLayout(d),this._register(n.onDidChangeConfiguration(l=>{if(l.affectsConfiguration("keyboard.layout")){const p=n.getValue("keyboard").layout;this._keyboardLayoutMode=p,p==="autodetect"?this._factory.setLayoutFromBrowserAPI():this._factory.setKeyboardLayout(p)}})),this._userKeyboardLayout=new UA(e.keyboardLayoutResource,t),this._userKeyboardLayout.initialize().then(()=>{this._userKeyboardLayout.keyboardLayout&&(this._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout),this.setUserKeyboardLayoutIfMatched())}),this._register(this._userKeyboardLayout.onDidChange(()=>{const l=this._factory.keymapInfos.filter(h=>h.isUserKeyboardLayout);l.length?this._userKeyboardLayout.keyboardLayout?l[0].update(this._userKeyboardLayout.keyboardLayout):this._factory.removeKeyboardLayout(l[0]):this._userKeyboardLayout.keyboardLayout&&this._factory.registerKeyboardLayout(this._userKeyboardLayout.keyboardLayout),this.setUserKeyboardLayoutIfMatched()}))}setUserKeyboardLayoutIfMatched(){const t=this.configurationService.getValue("keyboard").layout;t&&this._userKeyboardLayout.keyboardLayout&&tr(this._userKeyboardLayout.keyboardLayout.layout)===t&&this._factory.activeKeymap&&(this._userKeyboardLayout.keyboardLayout.equal(this._factory.activeKeymap)||this._factory.setActiveKeymapInfo(this._userKeyboardLayout.keyboardLayout))}getKeyboardMapper(){return this._factory.getKeyboardMapper()}getCurrentKeyboardLayout(){return this._factory.activeKeyboardLayout}getAllKeyboardLayouts(){return this._factory.keyboardLayouts}getRawKeyboardMapping(){return this._factory.activeKeyMapping}validateCurrentKeyboardMapping(e){this._keyboardLayoutMode==="autodetect"&&this._factory.validateCurrentKeyboardMapping(e)}};El=D([u(0,uu),u(1,Le),u(2,Ke),u(3,ce),u(4,wt),u(5,ie)],El);const HA=H.as(xs.Configuration),zA={id:"keyboard",order:15,type:"object",title:c(12430,"Keyboard"),properties:{"keyboard.layout":{type:"string",default:"autodetect",description:c(12431,"Control the keyboard layout used in web.")}}};HA.registerConfiguration(zA);let Il=class extends R{constructor(e,t,i){super(),this._instantiationService=e,this._extensionService=t,this._logService=i,this._extensionHostIsReady=!1,this._onWillExecuteCommand=this._register(new E),this.onWillExecuteCommand=this._onWillExecuteCommand.event,this._onDidExecuteCommand=new E,this.onDidExecuteCommand=this._onDidExecuteCommand.event,this._extensionService.whenInstalledExtensionsRegistered().then(s=>this._extensionHostIsReady=s),this._starActivation=null}_activateStar(){return this._starActivation||(this._starActivation=Promise.race([this._extensionService.activateByEvent("*"),io(3e4)])),this._starActivation}async executeCommand(e,...t){this._logService.trace("CommandService#executeCommand",e);const i=`onCommand:${e}`;return Te.getCommand(e)?this._extensionService.activationEventIsDone(i)?this._tryExecuteCommand(e,t):this._extensionHostIsReady?(await this._extensionService.activateByEvent(i),this._tryExecuteCommand(e,t)):(this._extensionService.activateByEvent(i),this._tryExecuteCommand(e,t)):(await Promise.all([this._extensionService.activateByEvent(i),Promise.race([this._activateStar(),V.toPromise(V.filter(Te.onDidRegisterCommand,o=>o===e))])]),this._tryExecuteCommand(e,t))}_tryExecuteCommand(e,t){const i=Te.getCommand(e);if(!i)return Promise.reject(new Error(`command '${e}' not found`));try{this._onWillExecuteCommand.fire({commandId:e,args:t});const s=this._instantiationService.invokeFunction(i.handler,...t);return this._onDidExecuteCommand.fire({commandId:e,args:t}),Promise.resolve(s)}catch(s){return Promise.reject(s)}}};Il=D([u(0,F),u(1,kt),u(2,Ue)],Il);class Io extends X{constructor(){super({id:"workbench.action.toggleKeybindingsLog",title:x(7420,"Toggle Keyboard Shortcuts Troubleshooting"),category:xe.Developer,f1:!0})}run(e){if(e.get(it).toggleLogging()&&e.get(wt).executeCommand(Cv),Io.disposable){Io.disposable.dispose(),Io.disposable=void 0;return}const i=e.get(pr),s=new O,o=i.activeContainer,n=ge(o,B(".focus-troubleshooting-marker"));s.add(ae(()=>n.remove()));const r=_f(void 0,void 0,s);Sv(".focus-troubleshooting-marker",`
			position: fixed;
			pointer-events: none;
			z-index: 100000;
			background-color: rgba(255, 0, 0, 0.2);
			border: 2px solid rgba(255, 0, 0, 0.8);
			border-radius: 2px;
			display: none;
		`,r);const d=s.add(new E);function l(h,p){p.add(p.add(new Fc(h,"keydown",!0)).event(f=>d.fire(f)))}for(const{window:h,disposables:p}of Bc())l(h,p);s.add(wf(({window:h,disposables:p})=>l(h,p))),s.add(i.onDidChangeActiveContainer(()=>{i.activeContainer.appendChild(n)})),s.add(d.event(h=>{const p=h.target;if(p){const f=_v(p);n.style.top=`${f.top}px`,n.style.left=`${f.left}px`,n.style.width=`${f.width}px`,n.style.height=`${f.height}px`,n.style.display="block",setTimeout(()=>{n.style.display="none"},800)}})),Io.disposable=s}}C(Io);class $A{static hasOpenBrace(e){for(;e.scan()!==Di.EOF;)if(e.getToken()===Di.OpenBraceToken)return!0;return!1}static offsetToPosition(e,t){let i=0;const s=e.getEOL().length,o=e.getLineCount();for(let n=1;n<=o;n++){const r=e.getLineLength(n)+s,d=i+r;if(d>t)return new Jr(n,t-i+1);i=d}return new Jr(o,e.getLineMaxColumn(o))}static insertSnippet(e,t){const i=e.getValueLengthInRange(new ve(1,1,t.lineNumber,t.column));let s;(function(g){g[g.INVALID=0]="INVALID",g[g.AFTER_OBJECT=1]="AFTER_OBJECT",g[g.BEFORE_OBJECT=2]="BEFORE_OBJECT"})(s||(s={}));let o=s.INVALID,n=-1,r=s.INVALID;const d=Ev(e.getValue());let l=0,h=0;const p=(g,m)=>{m!==s.INVALID&&l===1&&h===0?(o=m,n=g,r=m):o!==s.INVALID&&(o=s.INVALID,n=d.getTokenOffset())};for(;d.scan()!==Di.EOF;){const g=d.getPosition(),m=d.getToken();let v=!1;switch(m){case Di.OpenBracketToken:v=!0,l++,p(g,s.BEFORE_OBJECT);break;case Di.CloseBracketToken:v=!0,l--,p(g,s.INVALID);break;case Di.CommaToken:v=!0,p(g,s.BEFORE_OBJECT);break;case Di.OpenBraceToken:v=!0,h++,p(g,s.INVALID);break;case Di.CloseBraceToken:v=!0,h--,p(g,s.AFTER_OBJECT);break;case Di.Trivia:case Di.LineBreakTrivia:v=!0}if(g>=i&&(o!==s.INVALID||n!==-1)){let b,A;return o!==s.INVALID?(b=v?g:d.getTokenOffset(),A=o):(b=n,A=r),A===s.AFTER_OBJECT?{position:this.offsetToPosition(e,b),prepend:",",append:""}:(d.setPosition(b),{position:this.offsetToPosition(e,b),prepend:"",append:this.hasOpenBrace(d)?",":""})}}const f=e.getLineCount();return{position:new Jr(f,e.getLineMaxColumn(f)),prepend:`
[`,append:"]"}}}const jA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),qA=he("settings-folder-dropdown",k.triangleDown,c(8630,"Icon for the folder dropdown button in the split JSON Settings editor."));he("settings-more-action",k.gear,c(8631,"Icon for the 'more actions' action in the Settings UI."));he("keybindings-record-keys",k.recordKeys,c(8632,"Icon for the 'record keys' action in the keybinding UI."));he("keybindings-sort",k.sortPrecedence,c(8633,"Icon for the 'sort by precedence' toggle in the keybinding UI."));he("keybindings-edit",k.edit,c(8634,"Icon for the edit action in the keybinding UI."));he("keybindings-add",k.add,c(8635,"Icon for the add action in the keybinding UI."));he("settings-edit",k.edit,c(8636,"Icon for the edit action in the Settings UI."));he("settings-remove",k.close,c(8637,"Icon for the remove action in the Settings UI."));he("settings-discard",k.discard,c(8638,"Icon for the discard action in the Settings UI."));he("preferences-clear-input",k.clearAll,c(8639,"Icon for clear input in the Settings and keybinding UI."));he("preferences-filter",k.filter,c(8640,"Icon for the button that suggests filters for the Settings UI."));he("preferences-open-settings",k.goToFile,c(8641,"Icon for open settings commands."));let Dl=class extends Iv{constructor(e,t,i,s){super(null,e),this.contextService=t,this.contextMenuService=i,this.hoverService=s,this._folderSettingCounts=new Map;const o=this.contextService.getWorkspace();this._folder=o.folders.length===1?o.folders[0]:null,this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.onWorkspaceFoldersChanged()))}get folder(){return this._folder}set folder(e){this._folder=e,this.update()}setCount(e,t){const i=this.contextService.getWorkspaceFolder(e);if(!i)throw new Error("unknown folder");const s=i.uri;this._folderSettingCounts.set(s.toString(),t),this.update()}render(e){this.element=e,this.container=e,this.labelElement=B(".action-title"),this.detailsElement=B(".action-details"),this.dropDownElement=B(".dropdown-icon.hide"+Ce.asCSSSelector(qA)),this.anchorElement=B("a.action-label.folder-settings",{role:"button","aria-haspopup":"true",tabindex:"0"},this.labelElement,this.detailsElement,this.dropDownElement),this.anchorElementHover=this._register(this.hoverService.setupManagedHover(au("mouse"),this.anchorElement,"")),this._register(Y(this.anchorElement,te.MOUSE_DOWN,t=>ke.stop(t))),this._register(Y(this.anchorElement,te.CLICK,t=>this.onClick(t))),this._register(Y(this.container,te.KEY_UP,t=>this.onKeyUp(t))),ge(this.container,this.anchorElement),this.update()}onKeyUp(e){switch(new Fo(e).keyCode){case y.Enter:case y.Space:this.onClick(e);return}}onClick(e){ke.stop(e,!0),!this.folder||this._action.checked?this.showMenu():this._action.run(this._folder)}updateEnabled(){this.update()}updateChecked(){this.update()}onWorkspaceFoldersChanged(){const e=this._folder,t=this.contextService.getWorkspace();e&&(this._folder=t.folders.filter(i=>dt(i.uri,e.uri))[0]||t.folders[0]),this._folder=this._folder?this._folder:t.folders.length===1?t.folders[0]:null,this.update(),this._action.checked&&this._action.run(this._folder)}update(){let e=0;this._folderSettingCounts.forEach(i=>e+=i);const t=this.contextService.getWorkspace();if(this._folder){this.labelElement.textContent=this._folder.name,this.anchorElementHover.update(this._folder.name);const i=this.labelWithCount(this._action.label,e);this.detailsElement.textContent=i,this.dropDownElement.classList.toggle("hide",t.folders.length===1||!this._action.checked)}else{const i=this.labelWithCount(this._action.label,e);this.labelElement.textContent=i,this.detailsElement.textContent="",this.anchorElementHover.update(this._action.label),this.dropDownElement.classList.remove("hide")}this.anchorElement.classList.toggle("checked",this._action.checked),this.container.classList.toggle("disabled",!this._action.enabled)}showMenu(){this.contextMenuService.showContextMenu({getAnchor:()=>this.container,getActions:()=>this.getDropdownMenuActions(),getActionViewItem:()=>{},onHide:()=>{this.anchorElement.blur()}})}getDropdownMenuActions(){const e=[],t=this.contextService.getWorkspace().folders;return this.contextService.getWorkbenchState()===wn.WORKSPACE&&t.length>0&&e.push(...t.map((i,s)=>{const o=this._folderSettingCounts.get(i.uri.toString());return{id:"folderSettingsTarget"+s,label:this.labelWithCount(i.name,o),tooltip:this.labelWithCount(i.name,o),checked:!!this.folder&&dt(this.folder.uri,i.uri),enabled:!0,class:void 0,run:()=>this._action.run(i)}})),e}labelWithCount(e,t){return t&&(e+=` (${t})`),e}};Dl=D([u(1,us),u(2,at),u(3,At)],Dl);let Fg=class extends pd{constructor(e,t,i,s,o,n,r){super(),this.contextService=i,this.instantiationService=s,this.environmentService=o,this.labelService=n,this.languageService=r,this._settingsTarget=null,this._onDidTargetChange=this._register(new E),this.onDidTargetChange=this._onDidTargetChange.event,this.options=t??{},this.create(e),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.onWorkbenchStateChanged())),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.update()))}resetLabels(){const e=this.environmentService.remoteAuthority,t=e&&this.labelService.getHostLabel(pe.vscodeRemote,e);this.userLocalSettings.label=c(8657,"User"),this.userRemoteSettings.label=c(8658,"Remote")+(t?` [${t}]`:""),this.workspaceSettings.label=c(8659,"Workspace"),this.folderSettingsAction.label=c(8660,"Folder")}create(e){const t=ge(e,B(".settings-tabs-widget"));this.settingsSwitcherBar=this._register(new Qo(t,{orientation:Zs.HORIZONTAL,focusOnlyEnabledItems:!0,ariaLabel:c(8661,"Settings Switcher"),ariaRole:"tablist",actionViewItemProvider:(o,n)=>o.id==="folderSettings"?this.folderSettings:void 0})),this.userLocalSettings=new _t("userSettings","",".settings-tab",!0,()=>this.updateTarget(Qe.USER_LOCAL)),this.userLocalSettings.tooltip=c(8657,"User"),this.userRemoteSettings=new _t("userSettingsRemote","",".settings-tab",!0,()=>this.updateTarget(Qe.USER_REMOTE));const i=this.environmentService.remoteAuthority,s=i&&this.labelService.getHostLabel(pe.vscodeRemote,i);this.userRemoteSettings.tooltip=c(8658,"Remote")+(s?` [${s}]`:""),this.workspaceSettings=new _t("workspaceSettings","",".settings-tab",!1,()=>this.updateTarget(Qe.WORKSPACE)),this.folderSettingsAction=new _t("folderSettings","",".settings-tab",!1,async o=>{this.updateTarget(Dv(o)?o.uri:Qe.USER_LOCAL)}),this.folderSettings=this.instantiationService.createInstance(Dl,this.folderSettingsAction),this.resetLabels(),this.update(),this.settingsSwitcherBar.push([this.userLocalSettings,this.userRemoteSettings,this.workspaceSettings,this.folderSettingsAction])}get settingsTarget(){return this._settingsTarget}set settingsTarget(e){this._settingsTarget=e,this.userLocalSettings.checked=Qe.USER_LOCAL===this.settingsTarget,this.userRemoteSettings.checked=Qe.USER_REMOTE===this.settingsTarget,this.workspaceSettings.checked=Qe.WORKSPACE===this.settingsTarget,this.settingsTarget instanceof U?(this.folderSettings.action.checked=!0,this.folderSettings.folder=this.contextService.getWorkspaceFolder(this.settingsTarget)):this.folderSettings.action.checked=!1}setResultCount(e,t){if(e===Qe.WORKSPACE){let i=c(8659,"Workspace");t&&(i+=` (${t})`),this.workspaceSettings.label=i}else if(e===Qe.USER_LOCAL){let i=c(8657,"User");t&&(i+=` (${t})`),this.userLocalSettings.label=i}else e instanceof U&&this.folderSettings.setCount(e,t)}updateLanguageFilterIndicators(e){if(this.resetLabels(),e){const t=this.languageService.getLanguageName(e);if(t){const i=` [${t}]`;this.userLocalSettings.label+=i,this.userRemoteSettings.label+=i,this.workspaceSettings.label+=i,this.folderSettingsAction.label+=i}}}onWorkbenchStateChanged(){this.folderSettings.folder=null,this.update(),this.settingsTarget===Qe.WORKSPACE&&this.contextService.getWorkbenchState()===wn.WORKSPACE&&this.updateTarget(Qe.USER_LOCAL)}updateTarget(e){return this.settingsTarget===e||e instanceof U&&this.settingsTarget instanceof U&&dt(this.settingsTarget,e)||(this.settingsTarget=e,this._onDidTargetChange.fire(this.settingsTarget)),Promise.resolve(void 0)}async update(){this.settingsSwitcherBar.domNode.classList.toggle("empty-workbench",this.contextService.getWorkbenchState()===wn.EMPTY),this.userRemoteSettings.enabled=!!(this.options.enableRemoteSettings&&this.environmentService.remoteAuthority),this.workspaceSettings.enabled=this.contextService.getWorkbenchState()!==wn.EMPTY,this.folderSettings.action.enabled=this.contextService.getWorkbenchState()===wn.WORKSPACE&&this.contextService.getWorkspace().folders.length>0,this.workspaceSettings.tooltip=c(8659,"Workspace")}};Fg=D([u(2,us),u(3,F),u(4,ni),u(5,Fi),u(6,Zo)],Fg);let Al=class extends pd{constructor(e,t,i,s,o,n){super(),this.options=t,this.contextViewService=i,this.instantiationService=s,this.contextKeyService=o,this.keybindingService=n,this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,this._onFocus=this._register(new E),this.onFocus=this._onFocus.event,this.create(e)}create(e){this.domNode=ge(e,B("div.settings-header-widget")),this.createSearchContainer(ge(this.domNode,B("div.settings-search-container"))),this.controlsDiv=ge(this.domNode,B("div.settings-search-controls")),this.options.showResultCount&&(this.countElement=ge(this.controlsDiv,B(".settings-count-widget")),this.countElement.style.backgroundColor=To(Tv),this.countElement.style.color=To(xv),this.countElement.style.border=`1px solid ${To(As)}`),this.inputBox.inputElement.setAttribute("aria-live",this.options.ariaLive||"off"),this.options.ariaLabelledBy&&this.inputBox.inputElement.setAttribute("aria-labelledBy",this.options.ariaLabelledBy);const t=this._register(Mo(this.inputBox.inputElement));this._register(t.onDidFocus(()=>this._onFocus.fire()));const i=this.options.focusKey;i&&(this._register(t.onDidFocus(()=>i.set(!0))),this._register(t.onDidBlur(()=>i.set(!1))))}createSearchContainer(e){this.searchContainer=e;const t=ge(this.searchContainer,B("div.settings-search-input"));this.inputBox=this._register(this.createInputBox(t)),this._register(this.inputBox.onDidChange(i=>this._onDidChange.fire(i)))}createInputBox(e){const t=()=>Dm(this.keybindingService);return new zS(e,this.contextViewService,{...this.options,showHistoryHint:t},this.contextKeyService)}showMessage(e){this.countElement&&e!==this.countElement.textContent&&(this.countElement.textContent=e,this.inputBox.inputElement.setAttribute("aria-label",e),this.inputBox.inputElement.style.paddingRight=this.getControlsWidth()+"px")}layout(e){e.width<400?(this.countElement?.classList.add("hide"),this.inputBox.inputElement.style.paddingRight="0px"):(this.countElement?.classList.remove("hide"),this.inputBox.inputElement.style.paddingRight=this.getControlsWidth()+"px")}getControlsWidth(){return(this.countElement?Av(this.countElement):0)+20}focus(){this.inputBox.focus(),this.getValue()&&this.inputBox.select()}hasFocus(){return this.inputBox.hasFocus()}clear(){this.inputBox.value=""}getValue(){return this.inputBox.value}setValue(e){return this.inputBox.value=e}dispose(){this.options.focusKey?.set(!1),super.dispose()}};Al=D([u(2,Xo),u(3,F),u(4,se),u(5,it)],Al);var yo,Tl;Pe(jA);let xl=class extends Al{constructor(e,t,i,s,o,n){super(e,t,i,s,o,n),this.recordDisposables=this._register(new O),this._onKeybinding=this._register(new E),this.onKeybinding=this._onKeybinding.event,this._onEnter=this._register(new E),this.onEnter=this._onEnter.event,this._onEscape=this._register(new E),this.onEscape=this._onEscape.event,this._onBlur=this._register(new E),this.onBlur=this._onBlur.event,this._register(ae(()=>this.stopRecordingKeys())),this._chords=null,this._inputValue=""}clear(){this._chords=null,super.clear()}startRecordingKeys(){this.recordDisposables.add(Y(this.inputBox.inputElement,te.KEY_DOWN,e=>this._onKeyDown(new Fo(e)))),this.recordDisposables.add(Y(this.inputBox.inputElement,te.BLUR,()=>this._onBlur.fire())),this.recordDisposables.add(Y(this.inputBox.inputElement,te.INPUT,()=>{this.setInputValue(this._inputValue)}))}stopRecordingKeys(){this._chords=null,this.recordDisposables.clear()}setInputValue(e){this._inputValue=e,this.inputBox.value=this._inputValue}_onKeyDown(e){if(e.preventDefault(),e.stopPropagation(),!this.options.recordEnter&&e.equals(y.Enter)){this._onEnter.fire();return}if(e.equals(y.Escape)){this._onEscape.fire();return}this.printKeybinding(e)}printKeybinding(e){const t=this.keybindingService.resolveKeyboardEvent(e),i=`code: ${e.browserEvent.code}, keyCode: ${e.browserEvent.keyCode}, key: ${e.browserEvent.key} => UI: ${t.getAriaLabel()}, user settings: ${t.getUserSettingsLabel()}, dispatch: ${t.getDispatchChords()[0]}`,s=this.options;this._chords||(this._chords=[]),this._chords.length>0&&this._chords[this._chords.length-1].getDispatchChords()[0]===null?this._chords[this._chords.length-1]=t:(this._chords.length===2&&(this._chords=[]),this._chords.push(t));const n=this._chords.map(r=>r.getUserSettingsLabel()||"").join(" ");this.setInputValue(s.quoteRecordedKeys?`"${n}"`:n),this.inputBox.inputElement.title=i,this._onKeybinding.fire(this._chords)}};xl=D([u(2,Xo),u(3,F),u(4,se),u(5,it)],xl);let kl=class extends pd{static{yo=this}static{this.WIDTH=400}static{this.HEIGHT=110}constructor(e,t){super(),this.instantiationService=t,this._keybindingDisposables=this._register(new O),this._chords=null,this._isVisible=!1,this._onHide=this._register(new E),this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,this._onShowExistingKeybindings=this._register(new E),this.onShowExistingKeybidings=this._onShowExistingKeybindings.event,this._domNode=kv(document.createElement("div")),this._domNode.setDisplay("none"),this._domNode.setClassName("defineKeybindingWidget"),this._domNode.setWidth(yo.WIDTH),this._domNode.setHeight(yo.HEIGHT);const i=c(8536,"Press desired key combination and then press ENTER.");ge(this._domNode.domNode,B(".message",void 0,i)),this._domNode.domNode.style.backgroundColor=To(Lv),this._domNode.domNode.style.color=To(Vv),this._domNode.domNode.style.boxShadow=`0 2px 8px ${To(Pv)}`,this._keybindingInputWidget=this._register(this.instantiationService.createInstance(xl,this._domNode.domNode,{ariaLabel:i,history:new Set([]),inputBoxStyles:gd})),this._keybindingInputWidget.startRecordingKeys(),this._register(this._keybindingInputWidget.onKeybinding(s=>this.onKeybinding(s))),this._register(this._keybindingInputWidget.onEnter(()=>this.hide())),this._register(this._keybindingInputWidget.onEscape(()=>this.clearOrHide())),this._register(this._keybindingInputWidget.onBlur(()=>this.onCancel())),this._outputNode=ge(this._domNode.domNode,B(".output")),this._showExistingKeybindingsNode=ge(this._domNode.domNode,B(".existing")),e&&ge(e,this._domNode.domNode)}get domNode(){return this._domNode.domNode}define(){return this._keybindingInputWidget.clear(),lu.withAsyncBody(async e=>{this._isVisible||(this._isVisible=!0,this._domNode.setDisplay("block"),this._chords=null,this._keybindingInputWidget.setInputValue(""),ji(this._outputNode),ji(this._showExistingKeybindingsNode),await io(0),this._keybindingInputWidget.focus());const t=this._onHide.event(()=>{e(this.getUserSettingsLabel()),t.dispose()})})}layout(e){const t=Math.round((e.height-yo.HEIGHT)/2);this._domNode.setTop(t);const i=Math.round((e.width-yo.WIDTH)/2);this._domNode.setLeft(i)}printExisting(e){if(e>0){const t=B("span.existingText"),i=e===1?c(8537,"1 existing command has this keybinding",e):c(8538,"{0} existing commands have this keybinding",e);ge(t,document.createTextNode(i)),Rv(i),this._showExistingKeybindingsNode.appendChild(t),t.onmousedown=s=>{s.preventDefault()},t.onmouseup=s=>{s.preventDefault()},t.onclick=()=>{this._onShowExistingKeybindings.fire(this.getUserSettingsLabel())}}}onKeybinding(e){if(this._keybindingDisposables.clear(),this._chords=e,ji(this._outputNode),ji(this._showExistingKeybindingsNode),this._keybindingDisposables.add(new pp(this._outputNode,Ht,gp)).set(this._chords?.[0]??void 0),this._chords)for(let s=1;s<this._chords.length;s++)this._outputNode.appendChild(document.createTextNode(c(8539,"chord to"))),this._keybindingDisposables.add(new pp(this._outputNode,Ht,gp)).set(this._chords[s]);const i=this.getUserSettingsLabel();i&&this._onDidChange.fire(i)}getUserSettingsLabel(){let e=null;return this._chords&&(e=this._chords.map(t=>t.getUserSettingsLabel()).join(" ")),e}onCancel(){this._chords=null,this.hide()}clearOrHide(){this._chords===null?this.hide():(this._chords=null,this._keybindingInputWidget.clear(),ji(this._outputNode),ji(this._showExistingKeybindingsNode))}hide(){this._domNode.setDisplay("none"),this._isVisible=!1,this._onHide.fire()}};kl=yo=D([u(1,F)],kl);let Rl=class extends R{static{Tl=this}static{this.ID="editor.contrib.defineKeybindingWidget"}constructor(e,t){super(),this._editor=e,this._widget=this._register(t.createInstance(kl,null)),this._editor.addOverlayWidget(this)}getId(){return Tl.ID}getDomNode(){return this._widget.domNode}getPosition(){return{preference:null}}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}start(){this._editor.hasModel()&&this._editor.revealPositionInCenterIfOutsideViewport(this._editor.getPosition(),ft.Smooth);const e=this._editor.getLayoutInfo();return this._widget.layout(new jt(e.width,e.height)),this._widget.define()}};Rl=Tl=D([u(1,F)],Rl);var Ll;const YA=c(8573,"You won't be able to produce this key combination under your current keyboard layout.");let Vl=class extends R{constructor(e,t,i){super(),this._editor=e,this._instantiationService=t,this._userDataProfileService=i,this._keybindingDecorationRenderer=this._register(new Ie),this._defineWidget=this._register(this._instantiationService.createInstance(Rl,this._editor)),this._register(this._editor.onDidChangeModel(s=>this._update())),this._update()}_update(){this._keybindingDecorationRenderer.value=Kg(this._editor,this._userDataProfileService)?this._instantiationService.createInstance(Pl,this._editor):void 0}showDefineKeybindingWidget(){Kg(this._editor,this._userDataProfileService)&&this._defineWidget.start().then(e=>this._onAccepted(e))}_onAccepted(e){if(this._editor.focus(),e&&this._editor.hasModel()){new RegExp(/\\/g).test(e)&&(e=e.slice(0,-1)+"\\\\");let s=["{",'	"key": '+JSON.stringify(e)+",",'	"command": "${1:commandId}",','	"when": "${2:editorTextFocus}"',"}$0"].join(`
`);const o=$A.insertSnippet(this._editor.getModel(),this._editor.getPosition());s=o.prepend+s+o.append,this._editor.setPosition(o.position),Am.get(this._editor)?.insert(s,{overwriteBefore:0,overwriteAfter:0})}}};Vl=D([u(1,F),u(2,Fu)],Vl);let Pl=Ll=class extends R{constructor(e,t){super(),this._editor=e,this._keybindingService=t,this._dec=this._editor.createDecorationsCollection(),this._updateDecorations=this._register(new ur(()=>this._updateDecorationsNow(),500));const i=Se(this._editor.getModel());this._register(i.onDidChangeContent(()=>this._updateDecorations.schedule())),this._register(this._keybindingService.onDidUpdateKeybindings(()=>this._updateDecorations.schedule())),this._register({dispose:()=>{this._dec.clear(),this._updateDecorations.cancel()}}),this._updateDecorations.schedule()}_updateDecorationsNow(){const e=Se(this._editor.getModel()),t=[],i=Mv(e.getValue());if(i&&Array.isArray(i.children))for(let s=0,o=i.children.length;s<o;s++){const n=i.children[s],r=this._getDecorationForEntry(e,n);r!==null&&t.push(r)}this._dec.set(t)}_getDecorationForEntry(e,t){if(!Array.isArray(t.children))return null;for(let i=0,s=t.children.length;i<s;i++){const o=t.children[i];if(o.type!=="property"||!Array.isArray(o.children)||o.children.length!==2||o.children[0].value!=="key")continue;const r=o.children[1];if(r.type!=="string")continue;const d=this._keybindingService.resolveUserBinding(r.value);if(d.length===0)return this._createDecoration(!0,null,null,e,r);const l=d[0];let h=null;if(l instanceof _n&&(h=l.getUSLabel()),!l.isWYSIWYG()){const f=l.getLabel();return typeof f=="string"&&r.value.toLowerCase()===f.toLowerCase()?null:this._createDecoration(!1,l.getLabel(),h,e,r)}if(/abnt_|oem_/.test(r.value))return this._createDecoration(!1,l.getLabel(),h,e,r);const p=l.getUserSettingsLabel();return typeof p=="string"&&!Ll._userSettingsFuzzyEquals(r.value,p)?this._createDecoration(!1,l.getLabel(),h,e,r):null}return null}static _userSettingsFuzzyEquals(e,t){if(e=e.trim().toLowerCase(),t=t.trim().toLowerCase(),e===t)return!0;const i=er.parseKeybinding(e),s=er.parseKeybinding(t);return i===null&&s===null?!0:!i||!s?!1:i.equals(s)}_createDecoration(e,t,i,s,o){let n,r,d;e?(n=new ts().appendText(YA),r="keybindingError",d=la(Ov)):(i&&t!==i?n=new ts(c(8574,"**{0}** for your current keyboard layout (**{1}** for US standard).",t,i)):n=new ts(c(8575,"**{0}** for your current keyboard layout.",t)),r="keybindingInfo",d=la(Nv));const l=s.getPositionAt(o.offset),h=s.getPositionAt(o.offset+o.length);return{range:new ve(l.lineNumber,l.column,h.lineNumber,h.column),options:{description:"keybindings-widget",stickiness:pu.NeverGrowsWhenTypingAtEdges,className:r,hoverMessage:n,overviewRuler:{color:d,position:en.Right}}}}};Pl=Ll=D([u(1,it)],Pl);function Kg(a,e){const t=a.getModel();return t?dt(t.uri,e.currentProfile.keybindingsResource):!1}fd($S,Vl,md.AfterFirstRender);class JA extends X{constructor(){super({id:"runCommands",title:x(5254,"Run Commands"),f1:!1,metadata:{description:c(5255,"Run several commands"),args:[{name:"args",schema:{type:"object",required:["commands"],properties:{commands:{type:"array",description:c(5256,"Commands to run"),items:{anyOf:[{$ref:"vscode://schemas/keybindings#/definitions/commandNames"},{type:"string"},{type:"object",required:["command"],properties:{command:{anyOf:[{$ref:"vscode://schemas/keybindings#/definitions/commandNames"},{type:"string"}]}},$ref:"vscode://schemas/keybindings#/definitions/commandsSchemas"}]}}}}}]}})}async run(e,t){const i=e.get(Ke);if(!this._isCommandArgs(t)){i.error(c(5257,"'runCommands' has received an argument with incorrect type. Please, review the argument passed to the command."));return}if(t.commands.length===0){i.warn(c(5258,"'runCommands' has not received commands to run. Did you forget to pass commands in the 'runCommands' argument?"));return}const s=e.get(wt),o=e.get(Ue);let n=0;try{for(;n<t.commands.length;++n){const r=t.commands[n];o.debug(`runCommands: executing ${n}-th command: ${fp(r)}`),await this._runCommand(s,r),o.debug(`runCommands: executed ${n}-th command`)}}catch(r){o.debug(`runCommands: executing ${n}-th command resulted in an error: ${r instanceof Error?r.message:fp(r)}`),i.error(r)}}_isCommandArgs(e){if(!e||typeof e!="object"||!("commands"in e)||!Array.isArray(e.commands))return!1;for(const t of e.commands)if(typeof t!="string"&&!(typeof t=="object"&&typeof t.command=="string"))return!1;return!0}_runCommand(e,t){let i,s;return typeof t=="string"?i=t:(i=t.command,s=t.args),s===void 0?e.executeCommand(i):Array.isArray(s)?e.executeCommand(i,...s):e.executeCommand(i,s)}}C(JA);U.from({scheme:pe.vscodeUserData,path:"/User/keybindings.json"});let Ml=class extends Sl{constructor(e,t,i,s,o,n,r,d,l,h,p,f,g){super(t,i,s,o,n,r,d,l,h,p,f,g),this.shouldUseGlobalKeybindings=e,this.keybindingProviders=[]}registerKeybindingProvider(e){this.keybindingProviders.push(e),this.updateResolver();const t=new O;return t.add(e.onDidChangeKeybindings(()=>{this.updateResolver()})),t.add(ae(()=>{const i=this.keybindingProviders.indexOf(e);i>=0&&(this.keybindingProviders.splice(i,1),this.updateResolver())})),t}_getResolver(){return super._getResolver()}_dispatch(e,t){return this.shouldUseGlobalKeybindings()?super._dispatch(e,t):!1}getUserKeybindingItems(){return[...super.getUserKeybindingItems(),...this.keybindingProviders.flatMap(e=>e.provideKeybindings())]}};Ml=D([u(1,se),u(2,wt),u(3,mt),u(4,Ke),u(5,Fu),u(6,Zt),u(7,kt),u(8,Le),u(9,Jo),u(10,Ue),u(11,yr),u(12,pr)],Ml);function sL({shouldUseGlobalKeybindings:a=()=>!1}={}){return{...AD(),[it.toString()]:new ee(Ml,[a],!1),[yr.toString()]:new ee(El,[],!0),[wt.toString()]:new ee(Il,[],!0)}}function dy(a){return`${a}.hidden`}let Ol=class extends R{constructor(e,t,i,s){super(),this.viewContainerName=t,this.storageService=i,this._onDidChangeStoredState=this._register(new E),this.onDidChangeStoredState=this._onDidChangeStoredState.event,this.logger=new gu(()=>s.createLogger(Au,{name:Tu,group:fu})),this.globalViewsStateStorageId=dy(e),this.workspaceViewsStateStorageId=e,this._register(this.storageService.onDidChangeValue(G.PROFILE,this.globalViewsStateStorageId,this._store)(()=>this.onDidStorageChange())),this.state=this.initialize()}set(e,t){this.state.set(e,t)}get(e){return this.state.get(e)}updateState(e){this.updateWorkspaceState(e),this.updateGlobalState(e)}updateWorkspaceState(e){const t=this.getStoredWorkspaceState();for(const i of e){const s=this.get(i.id);s&&(t[i.id]={collapsed:!!s.collapsed,isHidden:!s.visibleWorkspace,size:s.size,order:i.workspace&&s?s.order:void 0})}Object.keys(t).length>0?this.storageService.store(this.workspaceViewsStateStorageId,JSON.stringify(t),G.WORKSPACE,Re.MACHINE):this.storageService.remove(this.workspaceViewsStateStorageId,G.WORKSPACE)}updateGlobalState(e){const t=this.getStoredGlobalState();for(const i of e){const s=this.get(i.id);t.set(i.id,{id:i.id,isHidden:s&&i.canToggleVisibility?!s.visibleGlobal:!1,order:!i.workspace&&s?s.order:void 0})}this.setStoredGlobalState(t)}onDidStorageChange(){if(this.globalViewsStatesValue!==this.getStoredGlobalViewsStatesValue()){this._globalViewsStatesValue=void 0;const e=this.getStoredGlobalState(),t=this.getStoredWorkspaceState(),i=[];for(const[s,o]of e){const n=this.get(s);if(n)n.visibleGlobal!==!o.isHidden&&(o.isHidden||this.logger.value.info(`View visibility state changed: ${s} is now visible`,this.viewContainerName),i.push({id:s,visible:!o.isHidden}));else{const r=t[s];this.set(s,{active:!1,visibleGlobal:!o.isHidden,visibleWorkspace:mn(r?.isHidden)?void 0:!r?.isHidden,collapsed:r?.collapsed,order:r?.order,size:r?.size})}}if(i.length){this._onDidChangeStoredState.fire(i);for(const s of i){const o=this.get(s.id);o&&(o.visibleGlobal=s.visible)}}}}initialize(){const e=new Map,t=this.getStoredWorkspaceState();for(const r of Object.keys(t)){const d=t[r];e.set(r,{active:!1,visibleGlobal:void 0,visibleWorkspace:mn(d.isHidden)?void 0:!d.isHidden,collapsed:d.collapsed,order:d.order,size:d.size})}const i=this.storageService.get(this.globalViewsStateStorageId,G.WORKSPACE,"[]"),{state:s}=this.parseStoredGlobalState(i);if(s.size>0){for(const{id:r,isHidden:d}of s.values()){const l=e.get(r);l?mn(l.visibleWorkspace)&&(l.visibleWorkspace=!d):e.set(r,{active:!1,collapsed:void 0,visibleGlobal:void 0,visibleWorkspace:!d})}this.storageService.remove(this.globalViewsStateStorageId,G.WORKSPACE)}const{state:o,hasDuplicates:n}=this.parseStoredGlobalState(this.globalViewsStatesValue);n&&this.setStoredGlobalState(o);for(const{id:r,isHidden:d,order:l}of o.values()){const h=e.get(r);h?(h.visibleGlobal=!d,mn(l)||(h.order=l)):e.set(r,{active:!1,visibleGlobal:!d,order:l,collapsed:void 0,visibleWorkspace:void 0})}return e}getStoredWorkspaceState(){return JSON.parse(this.storageService.get(this.workspaceViewsStateStorageId,G.WORKSPACE,"{}"))}getStoredGlobalState(){return this.parseStoredGlobalState(this.globalViewsStatesValue).state}setStoredGlobalState(e){this.globalViewsStatesValue=JSON.stringify([...e.values()])}parseStoredGlobalState(e){const t=JSON.parse(e);let i=!1;return{state:t.reduce((o,n)=>(typeof n=="string"?(i=i||o.has(n),o.set(n,{id:n,isHidden:!0})):(i=i||o.has(n.id),o.set(n.id,n)),o),new Map),hasDuplicates:i}}get globalViewsStatesValue(){return this._globalViewsStatesValue||(this._globalViewsStatesValue=this.getStoredGlobalViewsStatesValue()),this._globalViewsStatesValue}set globalViewsStatesValue(e){this.globalViewsStatesValue!==e&&(this._globalViewsStatesValue=e,this.setStoredGlobalViewsStatesValue(e))}getStoredGlobalViewsStatesValue(){return this.storageService.get(this.globalViewsStateStorageId,G.PROFILE,"[]")}setStoredGlobalViewsStatesValue(e){this.storageService.store(this.globalViewsStateStorageId,e,G.PROFILE,Re.USER)}};Ol=D([u(2,ce),u(3,mu)],Ol);let Nl=class extends R{get title(){return this._title}get icon(){return this._icon}get keybindingId(){return this._keybindingId}get allViewDescriptors(){return this.viewDescriptorItems.map(e=>e.viewDescriptor)}get activeViewDescriptors(){return this.viewDescriptorItems.filter(e=>e.state.active).map(e=>e.viewDescriptor)}get visibleViewDescriptors(){return this.viewDescriptorItems.filter(e=>this.isViewDescriptorVisible(e)).map(e=>e.viewDescriptor)}constructor(e,t,i,s){super(),this.viewContainer=e,this.contextKeyService=i,this.contextKeys=new Bv,this.viewDescriptorItems=[],this._onDidChangeContainerInfo=this._register(new E),this.onDidChangeContainerInfo=this._onDidChangeContainerInfo.event,this._onDidChangeAllViewDescriptors=this._register(new E),this.onDidChangeAllViewDescriptors=this._onDidChangeAllViewDescriptors.event,this._onDidChangeActiveViewDescriptors=this._register(new E),this.onDidChangeActiveViewDescriptors=this._onDidChangeActiveViewDescriptors.event,this._onDidAddVisibleViewDescriptors=this._register(new E),this.onDidAddVisibleViewDescriptors=this._onDidAddVisibleViewDescriptors.event,this._onDidRemoveVisibleViewDescriptors=this._register(new E),this.onDidRemoveVisibleViewDescriptors=this._onDidRemoveVisibleViewDescriptors.event,this._onDidMoveVisibleViewDescriptors=this._register(new E),this.onDidMoveVisibleViewDescriptors=this._onDidMoveVisibleViewDescriptors.event,this.logger=new gu(()=>s.createLogger(Au,{name:Tu,group:fu})),this._register(V.filter(i.onDidChangeContext,o=>o.affectsSome(this.contextKeys))(()=>this.onDidChangeContext())),this.viewDescriptorsState=this._register(t.createInstance(Ol,e.storageId||`${e.id}.state`,typeof e.title=="string"?e.title:e.title.original)),this._register(this.viewDescriptorsState.onDidChangeStoredState(o=>this.updateVisibility(o))),this.updateContainerInfo()}updateContainerInfo(){const e=this.viewContainer.alwaysUseContainerInfo||this.visibleViewDescriptors.length===0||this.visibleViewDescriptors.some(d=>H.as(pt.ViewsRegistry).getViewContainer(d.id)===this.viewContainer),t=e?typeof this.viewContainer.title=="string"?this.viewContainer.title:this.viewContainer.title.value:this.visibleViewDescriptors[0]?.containerTitle||this.visibleViewDescriptors[0]?.name?.value||"";let i=!1;this._title!==t&&(this._title=t,i=!0);const s=e?this.viewContainer.icon:this.visibleViewDescriptors[0]?.containerIcon||Tm;let o=!1;this.isEqualIcon(s)||(this._icon=s,o=!0);const n=this.viewContainer.openCommandActionDescriptor?.id??this.activeViewDescriptors.find(d=>d.openCommandActionDescriptor)?.openCommandActionDescriptor?.id;let r=!1;this._keybindingId!==n&&(this._keybindingId=n,r=!0),(i||o||r)&&this._onDidChangeContainerInfo.fire({title:i,icon:o,keybindingId:r})}isEqualIcon(e){return U.isUri(e)?U.isUri(this._icon)&&dt(e,this._icon):Ce.isThemeIcon(e)?Ce.isThemeIcon(this._icon)&&Ce.isEqual(e,this._icon):e===this._icon}isVisible(e){const t=this.viewDescriptorItems.find(i=>i.viewDescriptor.id===e);if(!t)throw new Error(`Unknown view ${e}`);return this.isViewDescriptorVisible(t)}setVisible(e,t){this.updateVisibility([{id:e,visible:t}])}updateVisibility(e){const t=gs(e.filter(({visible:o})=>!o).map(({id:o})=>this.findAndIgnoreIfNotFound(o))),i=[];for(const{viewDescriptorItem:o,visibleIndex:n}of t)this.updateViewDescriptorItemVisibility(o,!1)&&i.push({viewDescriptor:o.viewDescriptor,index:n});i.length&&this.broadCastRemovedVisibleViewDescriptors(i);const s=[];for(const{id:o,visible:n}of e){if(!n)continue;const r=this.findAndIgnoreIfNotFound(o);if(!r)continue;const{viewDescriptorItem:d,visibleIndex:l}=r;this.updateViewDescriptorItemVisibility(d,!0)&&s.push({index:l,viewDescriptor:d.viewDescriptor,size:d.state.size,collapsed:!!d.state.collapsed})}s.length&&this.broadCastAddedVisibleViewDescriptors(s)}updateViewDescriptorItemVisibility(e,t){return!e.viewDescriptor.canToggleVisibility||this.isViewDescriptorVisibleWhenActive(e)===t?!1:(e.viewDescriptor.workspace?e.state.visibleWorkspace=t:(e.state.visibleGlobal=t,t&&this.logger.value.info(`Showing view ${e.viewDescriptor.id} in the container ${this.viewContainer.id}`)),this.isViewDescriptorVisible(e)===t)}isCollapsed(e){return!!this.find(e).viewDescriptorItem.state.collapsed}setCollapsed(e,t){const{viewDescriptorItem:i}=this.find(e);i.state.collapsed!==t&&(i.state.collapsed=t),this.viewDescriptorsState.updateState(this.allViewDescriptors)}getSize(e){return this.find(e).viewDescriptorItem.state.size}setSizes(e){for(const{id:t,size:i}of e){const{viewDescriptorItem:s}=this.find(t);s.state.size!==i&&(s.state.size=i)}this.viewDescriptorsState.updateState(this.allViewDescriptors)}move(e,t){const i=this.viewDescriptorItems.findIndex(r=>r.viewDescriptor.id===e),s=this.viewDescriptorItems.findIndex(r=>r.viewDescriptor.id===t),o=this.viewDescriptorItems[i],n=this.viewDescriptorItems[s];Fv(this.viewDescriptorItems,i,s);for(let r=0;r<this.viewDescriptorItems.length;r++)this.viewDescriptorItems[r].state.order=r;this.broadCastMovedViewDescriptors({index:i,viewDescriptor:o.viewDescriptor},{index:s,viewDescriptor:n.viewDescriptor})}add(e){const t=[];for(const o of e){const n=o.viewDescriptor;if(n.when)for(const d of n.when.keys())this.contextKeys.add(d);let r=this.viewDescriptorsState.get(n.id);if(r){if(n.workspace)r.visibleWorkspace=Wi(o.visible)?Wi(r.visibleWorkspace)?!n.hideByDefault:r.visibleWorkspace:o.visible;else{const d=r.visibleGlobal;r.visibleGlobal=Wi(o.visible)?Wi(r.visibleGlobal)?!n.hideByDefault:r.visibleGlobal:o.visible,r.visibleGlobal&&!d&&this.logger.value.info(`Added view ${n.id} in the container ${this.viewContainer.id} and showing it.`,`${d}`,`${n.hideByDefault}`,`${o.visible}`)}r.collapsed=Wi(o.collapsed)?Wi(r.collapsed)?!!n.collapsed:r.collapsed:o.collapsed}else r={active:!1,visibleGlobal:Wi(o.visible)?!n.hideByDefault:o.visible,visibleWorkspace:Wi(o.visible)?!n.hideByDefault:o.visible,collapsed:Wi(o.collapsed)?!!n.collapsed:o.collapsed};this.viewDescriptorsState.set(n.id,r),r.active=this.contextKeyService.contextMatchesRules(n.when),t.push({viewDescriptor:n,state:r})}this.viewDescriptorItems.push(...t),this.viewDescriptorItems.sort(this.compareViewDescriptors.bind(this)),this._onDidChangeAllViewDescriptors.fire({added:t.map(({viewDescriptor:o})=>o),removed:[]});const i=[];for(const o of t)o.state.active&&i.push({viewDescriptorItem:o,visible:this.isViewDescriptorVisible(o)});i.length&&this._onDidChangeActiveViewDescriptors.fire({added:i.map(({viewDescriptorItem:o})=>o.viewDescriptor),removed:[]});const s=[];for(const{viewDescriptorItem:o,visible:n}of i)if(n&&this.isViewDescriptorVisible(o)){const{visibleIndex:r}=this.find(o.viewDescriptor.id);s.push({index:r,viewDescriptor:o.viewDescriptor,size:o.state.size,collapsed:!!o.state.collapsed})}this.broadCastAddedVisibleViewDescriptors(s)}remove(e){const t=[],i=[],s=[],o=[];for(const n of e){if(n.when)for(const d of n.when.keys())this.contextKeys.delete(d);const r=this.viewDescriptorItems.findIndex(d=>d.viewDescriptor.id===n.id);if(r!==-1){t.push(n);const d=this.viewDescriptorItems[r];if(d.state.active&&s.push(d.viewDescriptor),this.isViewDescriptorVisible(d)){const{visibleIndex:l}=this.find(d.viewDescriptor.id);o.push({index:l,viewDescriptor:d.viewDescriptor})}i.push(d)}}i.forEach(n=>this.viewDescriptorItems.splice(this.viewDescriptorItems.indexOf(n),1)),this.broadCastRemovedVisibleViewDescriptors(o),s.length&&this._onDidChangeActiveViewDescriptors.fire({added:[],removed:s}),t.length&&this._onDidChangeAllViewDescriptors.fire({added:[],removed:t})}onDidChangeContext(){const e=[],t=[];for(const o of this.viewDescriptorItems){const n=o.state.active,r=this.contextKeyService.contextMatchesRules(o.viewDescriptor.when);n!==r&&(r?e.push({item:o,visibleWhenActive:this.isViewDescriptorVisibleWhenActive(o)}):t.push(o))}const i=[];for(const o of t)if(this.isViewDescriptorVisible(o)){const{visibleIndex:n}=this.find(o.viewDescriptor.id);i.push({index:n,viewDescriptor:o.viewDescriptor})}t.forEach(o=>o.state.active=!1),e.forEach(({item:o})=>o.state.active=!0),this.broadCastRemovedVisibleViewDescriptors(i),(e.length||t.length)&&this._onDidChangeActiveViewDescriptors.fire({added:e.map(({item:o})=>o.viewDescriptor),removed:t.map(o=>o.viewDescriptor)});const s=[];for(const{item:o,visibleWhenActive:n}of e)if(n&&this.isViewDescriptorVisible(o)){const{visibleIndex:r}=this.find(o.viewDescriptor.id);s.push({index:r,viewDescriptor:o.viewDescriptor,size:o.state.size,collapsed:!!o.state.collapsed})}this.broadCastAddedVisibleViewDescriptors(s)}broadCastAddedVisibleViewDescriptors(e){e.length&&(this._onDidAddVisibleViewDescriptors.fire(e.sort((t,i)=>t.index-i.index)),this.updateState(`Added views:${e.map(t=>t.viewDescriptor.id).join(",")} in ${this.viewContainer.id}`))}broadCastRemovedVisibleViewDescriptors(e){e.length&&(this._onDidRemoveVisibleViewDescriptors.fire(e.sort((t,i)=>i.index-t.index)),this.updateState(`Removed views:${e.map(t=>t.viewDescriptor.id).join(",")} from ${this.viewContainer.id}`))}broadCastMovedViewDescriptors(e,t){this._onDidMoveVisibleViewDescriptors.fire({from:e,to:t}),this.updateState(`Moved view ${e.viewDescriptor.id} to ${t.viewDescriptor.id} in ${this.viewContainer.id}`)}updateState(e){this.logger.value.info(e),this.viewDescriptorsState.updateState(this.allViewDescriptors),this.updateContainerInfo()}isViewDescriptorVisible(e){return e.state.active?this.isViewDescriptorVisibleWhenActive(e):!1}isViewDescriptorVisibleWhenActive(e){return e.viewDescriptor.workspace?!!e.state.visibleWorkspace:!!e.state.visibleGlobal}find(e){const t=this.findAndIgnoreIfNotFound(e);if(t)return t;throw new Error(`view descriptor ${e} not found`)}findAndIgnoreIfNotFound(e){for(let t=0,i=0;t<this.viewDescriptorItems.length;t++){const s=this.viewDescriptorItems[t];if(s.viewDescriptor.id===e)return{index:t,visibleIndex:i,viewDescriptorItem:s};this.isViewDescriptorVisible(s)&&i++}}compareViewDescriptors(e,t){return e.viewDescriptor.id===t.viewDescriptor.id?0:this.getViewOrder(e)-this.getViewOrder(t)||this.getGroupOrderResult(e.viewDescriptor,t.viewDescriptor)}getViewOrder(e){const t=typeof e.state.order=="number"?e.state.order:e.viewDescriptor.order;return typeof t=="number"?t:Number.MAX_VALUE}getGroupOrderResult(e,t){return!e.group||!t.group||e.group===t.group?0:e.group<t.group?-1:1}};Nl=D([u(1,F),u(2,se),u(3,mu)],Nl);var Ai;function Wg(a){return`${a}.state`}let Bl=class extends R{static{Ai=this}static{this.VIEWS_CUSTOMIZATIONS="views.customizations"}static{this.COMMON_CONTAINER_ID_PREFIX="workbench.views.service"}get viewContainers(){return this.viewContainersRegistry.all}constructor(e,t,i,s,o,n){super(),this.instantiationService=e,this.contextKeyService=t,this.storageService=i,this.extensionService=s,this.telemetryService=o,this._onDidChangeContainer=this._register(new E),this.onDidChangeContainer=this._onDidChangeContainer.event,this._onDidChangeLocation=this._register(new E),this.onDidChangeLocation=this._onDidChangeLocation.event,this._onDidChangeContainerLocation=this._register(new E),this.onDidChangeContainerLocation=this._onDidChangeContainerLocation.event,this.viewContainerModels=this._register(new ca),this.viewsVisibilityActionDisposables=this._register(new ca),this.canRegisterViewsVisibilityActions=!1,this._onDidChangeViewContainers=this._register(new E),this.onDidChangeViewContainers=this._onDidChangeViewContainers.event,this.logger=new gu(()=>n.createLogger(Au,{name:Tu,group:fu})),this.activeViewContextKeys=new Map,this.movableViewContextKeys=new Map,this.defaultViewLocationContextKeys=new Map,this.defaultViewContainerLocationContextKeys=new Map,this.viewContainersRegistry=H.as(pt.ViewContainersRegistry),this.viewsRegistry=H.as(pt.ViewsRegistry),this.migrateToViewsCustomizationsStorage(),this.viewContainersCustomLocations=new Map(Object.entries(this.viewCustomizations.viewContainerLocations)),this.viewDescriptorsCustomLocations=new Map(Object.entries(this.viewCustomizations.viewLocations)),this.viewContainerBadgeEnablementStates=new Map(Object.entries(this.viewCustomizations.viewContainerBadgeEnablementStates)),this.viewContainers.forEach(r=>this.onDidRegisterViewContainer(r)),this._register(this.viewsRegistry.onViewsRegistered(r=>this.onDidRegisterViews(r))),this._register(this.viewsRegistry.onViewsDeregistered(({views:r,viewContainer:d})=>this.onDidDeregisterViews(r,d))),this._register(this.viewsRegistry.onDidChangeContainer(({views:r,from:d,to:l})=>this.onDidChangeDefaultContainer(r,d,l))),this._register(this.viewContainersRegistry.onDidRegister(({viewContainer:r})=>{this.onDidRegisterViewContainer(r),this._onDidChangeViewContainers.fire({added:[{container:r,location:this.getViewContainerLocation(r)}],removed:[]})})),this._register(this.viewContainersRegistry.onDidDeregister(({viewContainer:r,viewContainerLocation:d})=>{this.onDidDeregisterViewContainer(r),this._onDidChangeViewContainers.fire({removed:[{container:r,location:d}],added:[]})})),this._register(this.storageService.onDidChangeValue(G.PROFILE,Ai.VIEWS_CUSTOMIZATIONS,this._store)(()=>this.onDidStorageChange())),this.extensionService.whenInstalledExtensionsRegistered().then(()=>this.whenExtensionsRegistered())}migrateToViewsCustomizationsStorage(){if(this.storageService.get(Ai.VIEWS_CUSTOMIZATIONS,G.PROFILE))return;const e=this.storageService.get("views.cachedViewContainerLocations",G.PROFILE),t=this.storageService.get("views.cachedViewPositions",G.PROFILE);if(!e&&!t)return;const i=e?JSON.parse(e):[],s=t?JSON.parse(t):[],o={viewContainerLocations:i.reduce((n,[r,d])=>(n[r]=d,n),{}),viewLocations:s.reduce((n,[r,{containerId:d}])=>(n[r]=d,n),{}),viewContainerBadgeEnablementStates:{}};this.storageService.store(Ai.VIEWS_CUSTOMIZATIONS,JSON.stringify(o),G.PROFILE,Re.USER),this.storageService.remove("views.cachedViewContainerLocations",G.PROFILE),this.storageService.remove("views.cachedViewPositions",G.PROFILE)}registerGroupedViews(e){for(const[t,i]of e.entries()){const s=this.viewContainersRegistry.get(t);if(!s||!this.viewContainerModels.has(s)){if(this.isGeneratedContainerId(t)){const n=this.viewContainersCustomLocations.get(t);n!==void 0&&this.registerGeneratedViewContainer(n,t)}continue}const o=i.filter(n=>this.getViewContainerModel(s).allViewDescriptors.filter(r=>r.id===n.id).length===0);this.addViews(s,o)}}deregisterGroupedViews(e){for(const[t,i]of e.entries()){const s=this.viewContainersRegistry.get(t);!s||!this.viewContainerModels.has(s)||this.removeViews(s,i)}}moveOrphanViewsToDefaultLocation(){for(const[e,t]of this.viewDescriptorsCustomLocations.entries()){if(this.viewContainersRegistry.get(t))continue;const i=this.viewsRegistry.getViewContainer(e),s=this.getViewDescriptorById(e);i&&s&&this.addViews(i,[s])}}whenExtensionsRegistered(){this.moveOrphanViewsToDefaultLocation();for(const e of[...this.viewContainersCustomLocations.keys()])this.cleanUpGeneratedViewContainer(e);this.saveViewCustomizations();for(const[e,t]of this.viewContainerModels)this.registerViewsVisibilityActions(e,t);this.canRegisterViewsVisibilityActions=!0}onDidRegisterViews(e){this.contextKeyService.bufferChangeEvents(()=>{e.forEach(({views:t,viewContainer:i})=>{const s=this.regroupViews(i.id,t);this.registerGroupedViews(s),t.forEach(o=>this.getOrCreateMovableViewContextKey(o).set(!!o.canMoveView))})})}isGeneratedContainerId(e){return e.startsWith(Ai.COMMON_CONTAINER_ID_PREFIX)}onDidDeregisterViews(e,t){const i=this.regroupViews(t.id,e);this.deregisterGroupedViews(i),this.contextKeyService.bufferChangeEvents(()=>{e.forEach(s=>this.getOrCreateMovableViewContextKey(s).set(!1))})}regroupViews(e,t){const i=new Map;for(const s of t){const o=this.viewDescriptorsCustomLocations.get(s.id)??e;let n=i.get(o);n||i.set(o,n=[]),n.push(s)}return i}getViewDescriptorById(e){return this.viewsRegistry.getView(e)}getViewLocationById(e){const t=this.getViewContainerByViewId(e);return t===null?null:this.getViewContainerLocation(t)}getViewContainerByViewId(e){const t=this.viewDescriptorsCustomLocations.get(e);return t?this.viewContainersRegistry.get(t)??null:this.getDefaultContainerById(e)}getViewContainerLocation(e){return this.viewContainersCustomLocations.get(e.id)??this.getDefaultViewContainerLocation(e)}getDefaultViewContainerLocation(e){return this.viewContainersRegistry.getViewContainerLocation(e)}getDefaultContainerById(e){return this.viewsRegistry.getViewContainer(e)??null}getViewContainerModel(e){return this.getOrRegisterViewContainerModel(e)}getViewContainerById(e){return this.viewContainersRegistry.get(e)||null}getViewContainersByLocation(e){return this.viewContainers.filter(t=>this.getViewContainerLocation(t)===e)}getDefaultViewContainer(e){return this.viewContainersRegistry.getDefaultViewContainer(e)}moveViewContainerToLocation(e,t,i,s){this.logger.value.info(`moveViewContainerToLocation: viewContainer:${e.id} location:${t} reason:${s}`),this.moveViewContainerToLocationWithoutSaving(e,t,i),this.saveViewCustomizations()}getViewContainerBadgeEnablementState(e){return this.viewContainerBadgeEnablementStates.get(e)??!0}setViewContainerBadgeEnablementState(e,t){this.viewContainerBadgeEnablementStates.set(e,t),this.saveViewCustomizations()}moveViewToLocation(e,t,i){this.logger.value.info(`moveViewToLocation: view:${e.id} location:${t} reason:${i}`);const s=this.registerGeneratedViewContainer(t);this.moveViewsToContainer([e],s)}moveViewsToContainer(e,t,i,s){if(!e.length)return;this.logger.value.info(`moveViewsToContainer: views:${e.map(r=>r.id).join(",")} viewContainer:${t.id} reason:${s}`);const o=this.getViewContainerByViewId(e[0].id),n=t;o&&n&&o!==n&&(this.moveViewsWithoutSaving(e,o,n,i),this.cleanUpGeneratedViewContainer(o.id),this.saveViewCustomizations(),this.reportMovedViews(e,o,n))}reset(){for(const e of this.viewContainers){const t=this.getViewContainerModel(e);for(const o of t.allViewDescriptors){const n=this.getDefaultContainerById(o.id),r=this.getViewContainerByViewId(o.id);r&&n&&r!==n&&this.moveViewsWithoutSaving([o],r,n)}const i=this.getDefaultViewContainerLocation(e),s=this.getViewContainerLocation(e);i!==null&&s!==i&&this.moveViewContainerToLocationWithoutSaving(e,i),this.cleanUpGeneratedViewContainer(e.id)}this.viewContainersCustomLocations.clear(),this.viewDescriptorsCustomLocations.clear(),this.saveViewCustomizations()}isViewContainerRemovedPermanently(e){return this.isGeneratedContainerId(e)&&!this.viewContainersCustomLocations.has(e)}onDidChangeDefaultContainer(e,t,i){const s=e.filter(o=>!this.viewDescriptorsCustomLocations.has(o.id)||!this.viewContainers.includes(t)&&this.viewDescriptorsCustomLocations.get(o.id)===t.id);s.length&&this.moveViewsWithoutSaving(s,t,i)}reportMovedViews(e,t,i){const s=f=>f.id.startsWith(Ai.COMMON_CONTAINER_ID_PREFIX)?"custom":f.extensionId?"extension":f.id,o=this.getViewContainerLocation(t),n=this.getViewContainerLocation(i),r=e.length,d=s(t),l=s(i),h=o===q.Panel?"panel":"sidebar",p=n===q.Panel?"panel":"sidebar";this.telemetryService.publicLog2("viewDescriptorService.moveViews",{viewCount:r,fromContainer:d,toContainer:l,fromLocation:h,toLocation:p})}moveViewsWithoutSaving(e,t,i,s=pn.Expand){this.removeViews(t,e),this.addViews(i,e,s);const o=this.getViewContainerLocation(t),n=this.getViewContainerLocation(i);o!==n&&this._onDidChangeLocation.fire({views:e,from:o,to:n}),this._onDidChangeContainer.fire({views:e,from:t,to:i})}moveViewContainerToLocationWithoutSaving(e,t,i){const s=this.getViewContainerLocation(e),o=t;if(s!==o){const n=this.isGeneratedContainerId(e.id),r=o===this.getDefaultViewContainerLocation(e);n||!r?this.viewContainersCustomLocations.set(e.id,o):this.viewContainersCustomLocations.delete(e.id),this.getOrCreateDefaultViewContainerLocationContextKey(e).set(n||r),e.requestedIndex=i,this._onDidChangeContainerLocation.fire({viewContainer:e,from:s,to:o});const d=this.getViewsByContainer(e);this._onDidChangeLocation.fire({views:d,from:s,to:o})}}cleanUpGeneratedViewContainer(e){if(!this.isGeneratedContainerId(e))return;const t=this.getViewContainerById(e);t&&this.getViewContainerModel(t)?.allViewDescriptors.length||[...this.viewDescriptorsCustomLocations.values()].includes(e)||(t&&this.viewContainersRegistry.deregisterViewContainer(t),this.viewContainersCustomLocations.delete(e),this.viewContainerBadgeEnablementStates.delete(e),this.storageService.remove(dy(t?.storageId||Wg(e)),G.PROFILE))}registerGeneratedViewContainer(e,t){const i=t||this.generateContainerId(e),s=this.viewContainersRegistry.registerViewContainer({id:i,ctorDescriptor:new ee(vr,[i,{mergeViewWithContainerWhenSingleView:!0}]),title:{value:c(12897,"User View Container"),original:"User View Container"},icon:e===q.Sidebar?Tm:void 0,storageId:Wg(i),hideIfEmpty:!0},e,{doNotRegisterOpenCommand:!0});return this.viewContainersCustomLocations.get(s.id)!==e&&this.viewContainersCustomLocations.set(s.id,e),this.getOrCreateDefaultViewContainerLocationContextKey(s).set(!0),s}onDidStorageChange(){JSON.stringify(this.viewCustomizations)!==this.getStoredViewCustomizationsValue()&&this.onDidViewCustomizationsStorageChange()}onDidViewCustomizationsStorageChange(){this._viewCustomizations=void 0;const e=new Map(Object.entries(this.viewCustomizations.viewContainerLocations)),t=new Map(Object.entries(this.viewCustomizations.viewLocations)),i=[],s=[];for(const[o,n]of e.entries()){const r=this.getViewContainerById(o);r?n!==this.getViewContainerLocation(r)&&i.push([r,n]):this.isGeneratedContainerId(o)&&this.registerGeneratedViewContainer(n,o)}for(const o of this.viewContainers)if(!e.has(o.id)){const n=this.getViewContainerLocation(o),r=this.getDefaultViewContainerLocation(o);n!==r&&i.push([o,r])}for(const[o,n]of t.entries()){const r=this.getViewDescriptorById(o);if(r){const d=this.getViewContainerByViewId(o),l=this.viewContainersRegistry.get(n);d&&l&&l!==d&&s.push({views:[r],from:d,to:l})}}for(const o of this.viewContainers){const n=this.getViewContainerModel(o);for(const r of n.allViewDescriptors)if(!t.has(r.id)){const d=this.getViewContainerByViewId(r.id),l=this.getDefaultContainerById(r.id);d&&l&&d!==l&&s.push({views:[r],from:d,to:l})}}for(const[o,n]of i)this.moveViewContainerToLocationWithoutSaving(o,n);for(const{views:o,from:n,to:r}of s)this.moveViewsWithoutSaving(o,n,r,pn.Default);this.viewContainersCustomLocations=e,this.viewDescriptorsCustomLocations=t}generateContainerId(e){return`${Ai.COMMON_CONTAINER_ID_PREFIX}.${jS(e)}.${Yo()}`}saveViewCustomizations(){const e={viewContainerLocations:{},viewLocations:{},viewContainerBadgeEnablementStates:{}};for(const[t,i]of this.viewContainersCustomLocations){const s=this.getViewContainerById(t);s&&!this.isGeneratedContainerId(t)&&i===this.getDefaultViewContainerLocation(s)||(e.viewContainerLocations[t]=i)}for(const[t,i]of this.viewDescriptorsCustomLocations){const s=this.getViewContainerById(i);s&&this.getDefaultContainerById(t)?.id===s.id||(e.viewLocations[t]=i)}for(const[t,i]of this.viewContainerBadgeEnablementStates)i===!1&&(e.viewContainerBadgeEnablementStates[t]=i);this.viewCustomizations=e}get viewCustomizations(){return this._viewCustomizations||(this._viewCustomizations=JSON.parse(this.getStoredViewCustomizationsValue()),this._viewCustomizations.viewContainerLocations=this._viewCustomizations.viewContainerLocations??{},this._viewCustomizations.viewLocations=this._viewCustomizations.viewLocations??{},this._viewCustomizations.viewContainerBadgeEnablementStates=this._viewCustomizations.viewContainerBadgeEnablementStates??{}),this._viewCustomizations}set viewCustomizations(e){const t=JSON.stringify(e);JSON.stringify(this.viewCustomizations)!==t&&(this._viewCustomizations=e,this.setStoredViewCustomizationsValue(t))}getStoredViewCustomizationsValue(){return this.storageService.get(Ai.VIEWS_CUSTOMIZATIONS,G.PROFILE,"{}")}setStoredViewCustomizationsValue(e){this.storageService.store(Ai.VIEWS_CUSTOMIZATIONS,e,G.PROFILE,Re.USER)}getViewsByContainer(e){const t=this.viewsRegistry.getViews(e).filter(i=>(this.viewDescriptorsCustomLocations.get(i.id)??e.id)===e.id);for(const[i,s]of this.viewDescriptorsCustomLocations.entries()){if(s!==e.id||this.viewsRegistry.getViewContainer(i)===e)continue;const o=this.getViewDescriptorById(i);o&&t.push(o)}return t}onDidRegisterViewContainer(e){const t=this.isGeneratedContainerId(e.id)?!0:this.getViewContainerLocation(e)===this.getDefaultViewContainerLocation(e);this.getOrCreateDefaultViewContainerLocationContextKey(e).set(t),this.getOrRegisterViewContainerModel(e)}getOrRegisterViewContainerModel(e){let t=this.viewContainerModels.get(e)?.viewContainerModel;if(!t){const i=new O;t=i.add(this.instantiationService.createInstance(Nl,e)),this.onDidChangeActiveViews({added:t.activeViewDescriptors,removed:[]}),t.onDidChangeActiveViewDescriptors(n=>this.onDidChangeActiveViews(n),this,i),this.onDidChangeVisibleViews({added:[...t.visibleViewDescriptors],removed:[]}),t.onDidAddVisibleViewDescriptors(n=>this.onDidChangeVisibleViews({added:n.map(({viewDescriptor:r})=>r),removed:[]}),this,i),t.onDidRemoveVisibleViewDescriptors(n=>this.onDidChangeVisibleViews({added:[],removed:n.map(({viewDescriptor:r})=>r)}),this,i),i.add(ae(()=>this.viewsVisibilityActionDisposables.deleteAndDispose(e))),i.add(this.registerResetViewContainerAction(e));const s={viewContainerModel:t,disposables:i,dispose:()=>i.dispose()};this.viewContainerModels.set(e,s),this.onDidRegisterViews([{views:this.viewsRegistry.getViews(e),viewContainer:e}]);const o=this.getViewsByContainer(e).filter(n=>this.getDefaultContainerById(n.id)!==e);o.length&&(this.addViews(e,o),this.contextKeyService.bufferChangeEvents(()=>{o.forEach(n=>this.getOrCreateMovableViewContextKey(n).set(!!n.canMoveView))})),this.canRegisterViewsVisibilityActions&&this.registerViewsVisibilityActions(e,s)}return t}onDidDeregisterViewContainer(e){this.viewContainerModels.deleteAndDispose(e),this.viewsVisibilityActionDisposables.deleteAndDispose(e)}onDidChangeActiveViews({added:e,removed:t}){this.contextKeyService.bufferChangeEvents(()=>{e.forEach(i=>this.getOrCreateActiveViewContextKey(i).set(!0)),t.forEach(i=>this.getOrCreateActiveViewContextKey(i).set(!1))})}onDidChangeVisibleViews({added:e,removed:t}){this.contextKeyService.bufferChangeEvents(()=>{e.forEach(i=>this.getOrCreateVisibleViewContextKey(i).set(!0)),t.forEach(i=>this.getOrCreateVisibleViewContextKey(i).set(!1))})}registerViewsVisibilityActions(e,{viewContainerModel:t,disposables:i}){this.viewsVisibilityActionDisposables.deleteAndDispose(e),this.viewsVisibilityActionDisposables.set(e,this.registerViewsVisibilityActionsForContainer(t)),i.add(V.any(t.onDidChangeActiveViewDescriptors,t.onDidAddVisibleViewDescriptors,t.onDidRemoveVisibleViewDescriptors,t.onDidMoveVisibleViewDescriptors)(s=>{this.viewsVisibilityActionDisposables.deleteAndDispose(e),this.viewsVisibilityActionDisposables.set(e,this.registerViewsVisibilityActionsForContainer(t))}))}registerViewsVisibilityActionsForContainer(e){const t=new O;return e.activeViewDescriptors.forEach((i,s)=>{i.remoteAuthority||(t.add(C(class extends Jp{constructor(){super({id:`${i.id}.toggleVisibility`,viewPaneContainerId:e.viewContainer.id,precondition:i.canToggleVisibility&&(!e.isVisible(i.id)||e.visibleViewDescriptors.length>1)?I.true():I.false(),toggled:I.has(`${i.id}.visible`),title:i.name,metadata:{description:x(12898,"Toggles the visibility of the {0} view if the view container it is located in is visible",i.name.value)},menu:[{id:Iu,when:I.equals("viewContainer",e.viewContainer.id),order:s},{id:w.ViewContainerTitleContext,when:I.equals("viewContainer",e.viewContainer.id),order:s,group:"1_toggleVisibility"},{id:w.ViewTitleContext,when:I.or(...e.visibleViewDescriptors.map(o=>I.equals("view",o.id))),order:s,group:"2_toggleVisibility"}]})}async runInViewPaneContainer(o,n){n.toggleViewVisibility(i.id)}})),t.add(C(class extends Jp{constructor(){super({id:`${i.id}.removeView`,viewPaneContainerId:e.viewContainer.id,title:c(12899,"Hide '{0}'",i.name.value),metadata:{description:x(12900,"Hides the {0} view if it is visible and the view container it is located in is visible",i.name.value)},precondition:i.canToggleVisibility&&(!e.isVisible(i.id)||e.visibleViewDescriptors.length>1)?I.true():I.false(),menu:[{id:w.ViewTitleContext,when:I.and(I.equals("view",i.id),I.has(`${i.id}.visible`)),group:"1_hide",order:1}]})}async runInViewPaneContainer(o,n){n.getView(i.id)?.isVisible()&&n.toggleViewVisibility(i.id)}})))}),t}registerResetViewContainerAction(e){const t=this;return C(class extends X{constructor(){super({id:`${e.id}.resetViewContainerLocation`,title:x(12901,"Reset Location"),menu:[{id:w.ViewContainerTitleContext,group:"1_viewActions",when:I.or(I.and(I.equals("viewContainer",e.id),I.equals(`${e.id}.defaultViewContainerLocation`,!1)))}]})}run(s){t.moveViewContainerToLocation(e,t.getDefaultViewContainerLocation(e),void 0,this.desc.id),s.get(gt).openViewContainer(e.id,!0)}})}addViews(e,t,i=pn.Default){this.contextKeyService.bufferChangeEvents(()=>{t.forEach(s=>{const o=this.getDefaultContainerById(s.id)===e;this.getOrCreateDefaultViewLocationContextKey(s).set(o),o?this.viewDescriptorsCustomLocations.delete(s.id):this.viewDescriptorsCustomLocations.set(s.id,e.id)})}),this.getViewContainerModel(e).add(t.map(s=>({viewDescriptor:s,collapsed:i===pn.Default?void 0:!1,visible:i===pn.Default?void 0:!0})))}removeViews(e,t){this.contextKeyService.bufferChangeEvents(()=>{t.forEach(i=>{this.viewDescriptorsCustomLocations.get(i.id)===e.id&&this.viewDescriptorsCustomLocations.delete(i.id),this.getOrCreateDefaultViewLocationContextKey(i).set(!1)})}),this.getViewContainerModel(e).remove(t)}getOrCreateActiveViewContextKey(e){const t=`${e.id}.active`;let i=this.activeViewContextKeys.get(t);return i||(i=new j(t,!1).bindTo(this.contextKeyService),this.activeViewContextKeys.set(t,i)),i}getOrCreateVisibleViewContextKey(e){const t=`${e.id}.visible`;let i=this.activeViewContextKeys.get(t);return i||(i=new j(t,!1).bindTo(this.contextKeyService),this.activeViewContextKeys.set(t,i)),i}getOrCreateMovableViewContextKey(e){const t=`${e.id}.canMove`;let i=this.movableViewContextKeys.get(t);return i||(i=new j(t,!1).bindTo(this.contextKeyService),this.movableViewContextKeys.set(t,i)),i}getOrCreateDefaultViewLocationContextKey(e){const t=`${e.id}.defaultViewLocation`;let i=this.defaultViewLocationContextKeys.get(t);return i||(i=new j(t,!1).bindTo(this.contextKeyService),this.defaultViewLocationContextKeys.set(t,i)),i}getOrCreateDefaultViewContainerLocationContextKey(e){const t=`${e.id}.defaultViewContainerLocation`;let i=this.defaultViewContainerLocationContextKeys.get(t);return i||(i=new j(t,!1).bindTo(this.contextKeyService),this.defaultViewContainerLocationContextKeys.set(t,i)),i}};Bl=Ai=D([u(0,F),u(1,se),u(2,ce),u(3,kt),u(4,mt),u(5,mu)],Bl);var $i;let Fl=class extends R{static{$i=this}static{this.configureDefaultID="promptOpenWith.configureDefault"}static{this.cacheStorageID="editorOverrideService.cache"}static{this.conflictingDefaultsStorageID="editorOverrideService.conflictingDefaults"}constructor(e,t,i,s,o,n,r,d){super(),this.editorGroupService=e,this.instantiationService=t,this.configurationService=i,this.quickInputService=s,this.notificationService=o,this.storageService=n,this.extensionService=r,this.logService=d,this._onDidChangeEditorRegistrations=this._register(new Pc),this.onDidChangeEditorRegistrations=this._onDidChangeEditorRegistrations.event,this._editors=new Map,this._flattenedEditors=new Map,this._shouldReFlattenEditors=!0,this.cache=new Set(JSON.parse(this.storageService.get($i.cacheStorageID,G.PROFILE,JSON.stringify([])))),this.storageService.remove($i.cacheStorageID,G.PROFILE),this._register(this.storageService.onWillSaveState(()=>{this.cacheEditors()})),this._register(this.extensionService.onDidRegisterExtensions(()=>{this.cache=void 0}))}resolveUntypedInputAndGroup(e,t){const i=e,s=this.instantiationService.invokeFunction(Kw,i,t);if(s instanceof Promise)return s.then(([o,n])=>[i,o,n]);{const[o,n]=s;return[i,o,n]}}async resolveEditor(e,t){if(this._flattenedEditors=this._flattenEditorsMap(),_g(e))return this.doResolveSideBySideEditor(e,t);let i;const s=this.resolveUntypedInputAndGroup(e,t);if(s instanceof Promise?i=await s:i=s,!i)return Lt.NONE;const[o,n,r]=i;r&&(o.options={...o.options,activation:r});let d=Bt.getCanonicalUri(o,{supportSideBySide:Li.PRIMARY});if(this.cache&&d&&this.resourceMatchesCache(d)&&await this.extensionService.whenInstalledExtensionsRegistered(),d===void 0)d=U.from({scheme:pe.untitled});else if(d.scheme===void 0||d===null)return Lt.NONE;if(o.options?.override===Zr.PICK){const f=await this.doPickEditor(o);if(!f)return Lt.ABORT;o.options=f}let{editor:l,conflictingDefault:h}=this.getEditor(d,o.options?.override);if(!l&&(o.options?.override||Lw(e)))return Lt.NONE;if(!l){const f=this.getEditor(d,Ct.id);if(l=f?.editor,h=f?.conflictingDefault,!l)return Lt.NONE}if(yc(o)&&o.options?.override===void 0){let f=Bt.getCanonicalUri(o,{supportSideBySide:Li.SECONDARY});f||(f=U.from({scheme:pe.untitled}));const{editor:g}=this.getEditor(f,void 0);if(!g||l.editorInfo.id!==g.editorInfo.id){const{editor:m,conflictingDefault:v}=this.getEditor(d,Ct.id);l=m,h=v}if(!l)return Lt.NONE}if(o.options={override:l.editorInfo.id,...o.options},l.editorFactoryObject.createDiffEditorInput===void 0&&yc(o))return Lt.NONE;const p=await this.doResolveEditor(o,n,l);return h&&p&&await this.doHandleConflictingDefaults(d,l.editorInfo.label,o,p.editor,n),p?(p.editor.editorId!==l.editorInfo.id&&this.logService.warn(`Editor ID Mismatch: ${p.editor.editorId} !== ${l.editorInfo.id}. This will cause bugs. Please ensure editorInput.editorId matches the registered id`),{...p,group:n}):Lt.ABORT}async doResolveSideBySideEditor(e,t){const i=await this.resolveEditor(e.primary,t);if(!Eg(i))return Lt.NONE;const s=await this.resolveEditor(e.secondary,i.group??t);return Eg(s)?{group:i.group??s.group,editor:this.instantiationService.createInstance(br,e.label,e.description,s.editor,i.editor),options:e.options}:Lt.NONE}bufferChangeEvents(e){this._onDidChangeEditorRegistrations.pause();try{e()}finally{this._onDidChangeEditorRegistrations.resume()}}registerEditor(e,t,i,s){let o=this._editors.get(e);o===void 0&&(o=new Map,this._editors.set(e,o));let n=o.get(t.id);n===void 0&&(n=[]);const r=Kv(n,{globPattern:e,editorInfo:t,options:i,editorFactoryObject:s});return o.set(t.id,n),this._shouldReFlattenEditors=!0,this._onDidChangeEditorRegistrations.fire(),ae(()=>{r(),n&&n.length===0&&o?.delete(t.id),this._shouldReFlattenEditors=!0,this._onDidChangeEditorRegistrations.fire()})}getAssociationsForResource(e){let i=this.getAllUserAssociations().filter(o=>o.filenamePattern&&Qr(o.filenamePattern,e));i=i.sort((o,n)=>(n.filenamePattern?.length??0)-(o.filenamePattern?.length??0));const s=this._registeredEditors;return i.filter(o=>s.find(n=>n.editorInfo.id===o.viewType))}getAllUserAssociations(){const e=this.configurationService.inspect(Zp)||{},t=e.defaultValue??{},i=e.workspaceValue??{},s=e.userValue??{},o={...i};for(const[r,d]of Object.entries({...t,...s}))o[r]===void 0&&(o[r]=d);const n=[];for(const[r,d]of Object.entries(o)){const l={filenamePattern:r,viewType:d};n.push(l)}return n}_flattenEditorsMap(){if(!this._shouldReFlattenEditors)return this._flattenedEditors;this._shouldReFlattenEditors=!1;const e=new Map;for(const[t,i]of this._editors){const s=[];for(const o of i.values()){let n;for(const r of o)n||(n={editorInfo:r.editorInfo,globPattern:r.globPattern,options:{},editorFactoryObject:{}}),n.options={...n.options,...r.options},n.editorFactoryObject={...n.editorFactoryObject,...r.editorFactoryObject};n&&s.push(n)}e.set(t,s)}return e}get _registeredEditors(){return Array.from(this._flattenedEditors.values()).flat()}updateUserAssociations(e,t){const i={viewType:t,filenamePattern:e},s=this.getAllUserAssociations(),o=Object.create(null);for(const n of[...s,i])n.filenamePattern&&(o[n.filenamePattern]=n.viewType);this.configurationService.updateValue(Zp,o)}findMatchingEditors(e){const t=this.getAssociationsForResource(e),i=[];for(const[s,o]of this._flattenedEditors)for(const n of o)(t.find(d=>d.viewType===n.editorInfo.id)&&n.editorInfo.priority!==De.exclusive||Qr(s,e))&&i.push(n);return i.sort((s,o)=>ti(o.editorInfo.priority)===ti(s.editorInfo.priority)&&typeof o.globPattern=="string"&&typeof s.globPattern=="string"?o.globPattern.length-s.globPattern.length:ti(o.editorInfo.priority)-ti(s.editorInfo.priority))}getEditors(e){if(this._flattenedEditors=this._flattenEditorsMap(),U.isUri(e)){const t=this.findMatchingEditors(e);return t.find(i=>i.editorInfo.priority===De.exclusive)?[]:t.map(i=>i.editorInfo)}return Es(this._registeredEditors.map(t=>t.editorInfo),t=>t.id)}getEditor(e,t){const i=(h,p)=>h.find(f=>f.options&&f.options.canSupportResource!==void 0?f.editorInfo.id===p&&f.options.canSupportResource(e):f.editorInfo.id===p);if(t&&t!==Zr.EXCLUSIVE_ONLY){const h=this._registeredEditors;return{editor:i(h,t),conflictingDefault:!1}}const s=this.findMatchingEditors(e),o=this.getAssociationsForResource(e),n=t===Zr.EXCLUSIVE_ONLY?De.exclusive:De.builtin;let r=s.filter(h=>ti(h.editorInfo.priority)>=ti(n)&&h.editorInfo.id!==Ct.id);if(r.length===0)return{editor:o[0]&&n!==De.exclusive?i(s,o[0].viewType):void 0,conflictingDefault:!1};const d=r[0].editorInfo.priority===De.exclusive?r[0].editorInfo.id:o[0]?.viewType||r[0].editorInfo.id;let l=!1;return r=r.filter(h=>h.editorInfo.priority!==De.exclusive),o.length===0&&r.length>1&&(l=!0),{editor:i(s,d),conflictingDefault:l}}async doResolveEditor(e,t,i){let s=e.options;const o=Bt.getCanonicalUri(e,{supportSideBySide:Li.PRIMARY});if(s&&typeof s.activation>"u"&&(s={...s,activation:s.preserveFocus?Ef.RESTORE:void 0}),TD(e)){if(!i.editorFactoryObject.createMergeEditorInput)return;const l=await i.editorFactoryObject.createMergeEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(yc(e)){if(!i.editorFactoryObject.createDiffEditorInput)return;const l=await i.editorFactoryObject.createDiffEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(xD(e)){if(!i.editorFactoryObject.createMultiDiffEditorInput)return;const l=await i.editorFactoryObject.createMultiDiffEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(_g(e))throw new Error("Untyped side by side editor input not supported here.");if(kD(e)){if(!i.editorFactoryObject.createUntitledEditorInput)return;const l=await i.editorFactoryObject.createUntitledEditorInput(e,t);return{editor:l.editor,options:l.options??s}}if(o===void 0)throw new Error("Undefined resource on non untitled editor input.");if(typeof i.options?.singlePerResource=="function"?i.options.singlePerResource():i.options?.singlePerResource){const l=this.findExistingEditorsForResource(o,i.editorInfo.id);if(l.length){const h=await this.moveExistingEditorForResource(l,t);return h?{editor:h,options:s}:void 0}}if(!i.editorFactoryObject.createEditorInput)return;const r=await i.editorFactoryObject.createEditorInput(e,t);return s=r.options??s,{editor:r.editor,options:s}}async moveExistingEditorForResource(e,t){const i=e[0];for(const{editor:s,group:o}of e)if(s!==i.editor&&!await o.closeEditor(s))return;if(!(t.id!==i.group.id&&!i.group.moveEditor(i.editor,t)))return i.editor}findExistingEditorsForResource(e,t){const i=[],s=Es([...this.editorGroupService.groups]);for(const o of s)for(const n of o.editors)dt(n.resource,e)&&n.editorId===t&&i.push({editor:n,group:o});return i}async doHandleConflictingDefaults(e,t,i,s,o){const n=this.findMatchingEditors(e),r=JSON.parse(this.storageService.get($i.conflictingDefaultsStorageID,G.PROFILE,"{}")),d=`*${ki(e)}`,l=()=>{r[d]=[],n.forEach(f=>r[d].push(f.editorInfo.id)),this.storageService.store($i.conflictingDefaultsStorageID,JSON.stringify(r),G.PROFILE,Re.MACHINE)};if(r[d]&&r[d].find(f=>f===s.editorId))return;const p=this.notificationService.prompt(_e.Warning,c(12182,"There are multiple default editors available for the resource."),[{label:c(12183,"Configure Default"),run:async()=>{const f=await this.doPickEditor(i,!0);if(!f)return;i.options=f;const g=await this.resolveEditor(i,o);g===Lt.ABORT||g===Lt.NONE||o.replaceEditors([{editor:s,replacement:g.editor,options:g.options??f}])}},{label:c(12184,"Keep {0}",t),run:l}]).onDidClose(()=>{l(),p.dispose()})}mapEditorsToQuickPickEntry(e,t){const i=this.editorGroupService.activeGroup.findEditors(e).at(0);let s=e.scheme===pe.untitled?this._registeredEditors.filter(p=>p.editorInfo.priority!==De.exclusive):this.findMatchingEditors(e);s=Es(s,p=>p.editorInfo.id);const o=this.getAssociationsForResource(e)[0]?.viewType;s=s.sort((p,f)=>p.editorInfo.id===Ct.id?-1:f.editorInfo.id===Ct.id?1:ti(f.editorInfo.priority)-ti(p.editorInfo.priority));const n=[],r=c(12185,"Active"),d=c(12186,"Default"),l=c(12187,"Active and Default");let h=o;if(!h&&s.length>2&&s[1]?.editorInfo.priority!==De.option&&(h=s[1]?.editorInfo.id),h||(h=Ct.id),s.forEach(p=>{const f=i?.editorId??Ct.id,g=i?p.editorInfo.id===f:!1,m=p.editorInfo.id===h,v={id:p.editorInfo.id,label:p.editorInfo.label,description:g&&m?l:g?r:m?d:void 0,detail:p.editorInfo.detail??p.editorInfo.priority};n.push(v)}),!t&&ki(e)!==""){const p={type:"separator"};n.push(p);const f={id:$i.configureDefaultID,label:c(12188,"Configure default editor for '{0}'...",`*${ki(e)}`)};n.push(f)}return n}async doPickEditor(e,t){let i=Bt.getOriginalUri(e,{supportSideBySide:Li.PRIMARY});i===void 0&&(i=U.from({scheme:pe.untitled}));const s=this.mapEditorsToQuickPickEntry(i,t),o=new O,n=o.add(this.quickInputService.createQuickPick({useSeparators:!0})),r=t?c(12189,"Select new default editor for '{0}'",`*${ki(i)}`):c(12190,"Select editor for '{0}'",os(i));n.placeholder=r,n.canAcceptInBackground=!0,n.items=s;const d=n.items.find(h=>h.type==="item");d&&(n.selectedItems=[d]);const l=await new Promise(h=>{o.add(n.onDidAccept(p=>{let f;n.selectedItems.length===1&&(f={item:n.selectedItems[0],keyMods:n.keyMods,openInBackground:p.inBackground}),i&&t&&f?.item.id&&this.updateUserAssociations(`*${ki(i)}`,f.item.id),h(f)})),o.add(n.onDidHide(()=>{o.dispose(),h(void 0)})),o.add(n.onDidTriggerItemButton(p=>{h({item:p.item,openInBackground:!1}),i&&p.item&&p.item.id&&this.updateUserAssociations(`*${ki(i)}`,p.item.id)})),n.show()});if(n.dispose(),l)return l.item.id===$i.configureDefaultID?this.doPickEditor(e,!0):{...e.options,override:l.item.id,preserveFocus:l.openInBackground||e.options?.preserveFocus}}cacheEditors(){const e=new Set;for(const[i,s]of this._flattenedEditors)s.find(n=>n.editorInfo.priority!==De.option&&n.editorInfo.id!==Ct.id)&&(Wv(i)?e.add(`${i.pattern}`):e.add(i));const t=this.getAllUserAssociations();for(const i of t)i.filenamePattern&&e.add(i.filenamePattern);this.storageService.store($i.cacheStorageID,JSON.stringify(Array.from(e)),G.PROFILE,Re.MACHINE)}resourceMatchesCache(e){if(!this.cache)return!1;for(const t of this.cache)if(Qr(t,e))return!0;return!1}};Fl=$i=D([u(0,Je),u(1,F),u(2,ie),u(3,Jt),u(4,Ke),u(5,ce),u(6,kt),u(7,Ue)],Fl);var Kl;let Wl=class extends R{static{Kl=this}static{this.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX=/Untitled-\d+/}constructor(e,t){super(),this.instantiationService=e,this.configurationService=t,this._onDidSave=this._register(new E),this.onDidSave=this._onDidSave.event,this._onDidChangeDirty=this._register(new E),this.onDidChangeDirty=this._onDidChangeDirty.event,this._onDidChangeEncoding=this._register(new E),this.onDidChangeEncoding=this._onDidChangeEncoding.event,this._onDidCreate=this._register(new E),this.onDidCreate=this._onDidCreate.event,this._onWillDispose=this._register(new E),this.onWillDispose=this._onWillDispose.event,this._onDidChangeLabel=this._register(new E),this.onDidChangeLabel=this._onDidChangeLabel.event,this.mapResourceToModel=new ns}get(e){return this.mapResourceToModel.get(e)}getValue(e){return this.get(e)?.textEditorModel?.getValue()}async resolve(e){const t=this.doCreateOrGet(e);return await t.resolve(),t}create(e){return this.doCreateOrGet(e)}doCreateOrGet(e=Object.create(null)){const t=this.massageOptions(e);return t.untitledResource&&this.mapResourceToModel.has(t.untitledResource)?this.mapResourceToModel.get(t.untitledResource):this.doCreate(t)}massageOptions(e){const t=Object.create(null);if(e.associatedResource?(t.untitledResource=U.from({scheme:pe.untitled,authority:e.associatedResource.authority,fragment:e.associatedResource.fragment,path:e.associatedResource.path,query:e.associatedResource.query}),t.associatedResource=e.associatedResource):e.untitledResource?.scheme===pe.untitled&&(t.untitledResource=e.untitledResource),e.languageId)t.languageId=e.languageId;else if(!t.associatedResource){const i=this.configurationService.getValue();i.files?.defaultLanguage&&(t.languageId=i.files.defaultLanguage)}return t.encoding=e.encoding,t.initialValue=e.initialValue,t}doCreate(e){let t=e.untitledResource;if(!t){let s=1;do t=U.from({scheme:pe.untitled,path:`Untitled-${s}`}),s++;while(this.mapResourceToModel.has(t))}const i=this._register(this.instantiationService.createInstance(RD,t,!!e.associatedResource,e.initialValue,e.languageId,e.encoding));return this.registerModel(i),i}registerModel(e){const t=new O;t.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire(e))),t.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire(e))),t.add(e.onDidChangeEncoding(()=>this._onDidChangeEncoding.fire(e))),t.add(e.onWillDispose(()=>this._onWillDispose.fire(e))),V.once(e.onWillDispose)(()=>{this.mapResourceToModel.delete(e.resource),t.dispose()}),this.mapResourceToModel.set(e.resource,e),this._onDidCreate.fire(e),e.isDirty()&&this._onDidChangeDirty.fire(e)}isUntitledWithAssociatedResource(e){return e.scheme===pe.untitled&&e.path.length>1&&!Kl.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX.test(e.path)}canDispose(e){return e.isDisposed()?!0:this.doCanDispose(e)}async doCanDispose(e){return e.isDirty()?(await V.toPromise(e.onDidChangeDirty),this.canDispose(e)):!0}notifyDidSave(e,t){this._onDidSave.fire({source:e,target:t})}};Wl=Kl=D([u(0,F),u(1,ie)],Wl);var Ti,Gl;let Da=class extends R{static{Ti=this}static{this.MOUSE_NAVIGATION_SETTING="workbench.editor.mouseBackForwardToNavigate"}static{this.NAVIGATION_SCOPE_SETTING="workbench.editor.navigationScope"}constructor(e,t,i,s,o,n,r,d,l,h,p){super(),this.editorService=e,this.editorGroupService=t,this.contextService=i,this.storageService=s,this.configurationService=o,this.fileService=n,this.workspacesService=r,this.instantiationService=d,this.layoutService=l,this.contextKeyService=h,this.logService=p,this.activeEditorListeners=this._register(new O),this.lastActiveEditor=void 0,this._onDidChangeEditorNavigationStack=this._register(new E),this.onDidChangeEditorNavigationStack=this._onDidChangeEditorNavigationStack.event,this.defaultScopedEditorNavigationStack=void 0,this.editorGroupScopedNavigationStacks=new Map,this.editorScopedNavigationStacks=new Map,this.editorNavigationScope=Vt.DEFAULT,this.recentlyUsedEditorsStack=void 0,this.recentlyUsedEditorsStackIndex=0,this.recentlyUsedEditorsInGroupStack=void 0,this.recentlyUsedEditorsInGroupStackIndex=0,this.navigatingInRecentlyUsedEditorsStack=!1,this.navigatingInRecentlyUsedEditorsInGroupStack=!1,this.recentlyClosedEditors=[],this.ignoreEditorCloseEvent=!1,this.history=void 0,this.editorHistoryListeners=new Map,this.resourceExcludeMatcher=this._register(new Gv(re,()=>{const f=this._register(this.instantiationService.createInstance(LD,g=>qS(g?this.configurationService.getValue({resource:g}):this.configurationService.getValue())||Object.create(null),g=>g.affectsConfiguration(Uv)||g.affectsConfiguration(YS)));return this._register(f.onExpressionChange(()=>this.removeExcludedFromHistory())),f})),this.editorHelper=this.instantiationService.createInstance(Aa),this.canNavigateBackContextKey=new j("canNavigateBack",!1,c(12399,"Whether it is possible to navigate back in editor history")).bindTo(this.contextKeyService),this.canNavigateForwardContextKey=new j("canNavigateForward",!1,c(12400,"Whether it is possible to navigate forward in editor history")).bindTo(this.contextKeyService),this.canNavigateBackInNavigationsContextKey=new j("canNavigateBackInNavigationLocations",!1,c(12401,"Whether it is possible to navigate back in editor navigation locations history")).bindTo(this.contextKeyService),this.canNavigateForwardInNavigationsContextKey=new j("canNavigateForwardInNavigationLocations",!1,c(12402,"Whether it is possible to navigate forward in editor navigation locations history")).bindTo(this.contextKeyService),this.canNavigateToLastNavigationLocationContextKey=new j("canNavigateToLastNavigationLocation",!1,c(12403,"Whether it is possible to navigate to the last editor navigation location")).bindTo(this.contextKeyService),this.canNavigateBackInEditsContextKey=new j("canNavigateBackInEditLocations",!1,c(12404,"Whether it is possible to navigate back in editor edit locations history")).bindTo(this.contextKeyService),this.canNavigateForwardInEditsContextKey=new j("canNavigateForwardInEditLocations",!1,c(12405,"Whether it is possible to navigate forward in editor edit locations history")).bindTo(this.contextKeyService),this.canNavigateToLastEditLocationContextKey=new j("canNavigateToLastEditLocation",!1,c(12406,"Whether it is possible to navigate to the last editor edit location")).bindTo(this.contextKeyService),this.canReopenClosedEditorContextKey=new j("canReopenClosedEditor",!1,c(12407,"Whether it is possible to reopen the last closed editor")).bindTo(this.contextKeyService),this.registerListeners(),this.editorService.activeEditorPane&&this.onDidActiveEditorChange()}registerListeners(){this.registerMouseNavigationListener(),this._register(this.editorService.onDidActiveEditorChange(()=>this.onDidActiveEditorChange())),this._register(this.editorService.onDidOpenEditorFail(e=>this.remove(e.editor))),this._register(this.editorService.onDidCloseEditor(e=>this.onDidCloseEditor(e))),this._register(this.editorService.onDidMostRecentlyActiveEditorsChange(()=>this.handleEditorEventInRecentEditorsStack())),this._register(this.editorGroupService.onDidRemoveGroup(e=>this.onDidRemoveGroup(e))),this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e))),this._register(this.fileService.onDidRunOperation(e=>this.onDidFilesChange(e))),this._register(this.storageService.onWillSaveState(()=>this.saveState())),this.registerEditorNavigationScopeChangeListener(),this._register(this.onDidChangeEditorNavigationStack(()=>this.updateContextKeys())),this._register(this.editorGroupService.onDidChangeActiveGroup(()=>this.updateContextKeys()))}onDidCloseEditor(e){this.handleEditorCloseEventInHistory(e),this.handleEditorCloseEventInReopen(e)}registerMouseNavigationListener(){const e=this._register(new O),t=()=>{e.clear(),this.configurationService.getValue(Ti.MOUSE_NAVIGATION_SETTING)&&this._register(V.runAndSubscribe(this.layoutService.onDidAddContainer,({container:i,disposables:s})=>{const o=s.add(new O);o.add(Y(i,te.MOUSE_DOWN,n=>this.onMouseDownOrUp(n,!0))),o.add(Y(i,te.MOUSE_UP,n=>this.onMouseDownOrUp(n,!1))),e.add(o)},{container:this.layoutService.mainContainer,disposables:this._store}))};this._register(this.configurationService.onDidChangeConfiguration(i=>{i.affectsConfiguration(Ti.MOUSE_NAVIGATION_SETTING)&&t()})),t()}onMouseDownOrUp(e,t){switch(e.button){case 3:ke.stop(e),t&&this.goBack();break;case 4:ke.stop(e),t&&this.goForward();break}}onDidRemoveGroup(e){this.handleEditorGroupRemoveInNavigationStacks(e)}onDidActiveEditorChange(){const e=this.editorGroupService.activeGroup,t=e.activeEditorPane;if(!(this.lastActiveEditor&&this.editorHelper.matchesEditorIdentifier(this.lastActiveEditor,t))){if(this.lastActiveEditor=t?.input?{editor:t.input,groupId:t.group.id}:void 0,this.activeEditorListeners.clear(),!t?.group.isTransient(t.input))this.handleActiveEditorChange(e,t);else{this.logService.trace(`[History]: ignoring transient editor change until becoming non-transient (editor: ${t.input?.resource?.toString()}})`);const i=e.onDidModelChange(s=>{s.kind===ea.EDITOR_TRANSIENT&&s.editor===t.input&&!t.group.isTransient(t.input)&&(i.dispose(),this.handleActiveEditorChange(e,t))});this.activeEditorListeners.add(i)}tl(t)&&this.activeEditorListeners.add(t.onDidChangeSelection(i=>{t.group.isTransient(t.input)?this.logService.trace(`[History]: ignoring transient editor selection change (editor: ${t.input?.resource?.toString()}})`):this.handleActiveEditorSelectionChangeEvent(e,t,i)})),this.updateContextKeys()}}onDidFilesChange(e){e instanceof An?e.gotDeleted()&&this.remove(e):e.isOperation(Hs.DELETE)?this.remove(e):e.isOperation(Hs.MOVE)&&e.target.isFile&&this.move(e)}handleActiveEditorChange(e,t){this.handleActiveEditorChangeInHistory(t),this.handleActiveEditorChangeInNavigationStacks(e,t)}handleActiveEditorSelectionChangeEvent(e,t,i){this.handleActiveEditorSelectionChangeInNavigationStacks(e,t,i)}move(e){this.moveInHistory(e),this.moveInEditorNavigationStacks(e)}remove(e){this.removeFromHistory(e),this.removeFromEditorNavigationStacks(e),this.removeFromRecentlyClosedEditors(e),this.removeFromRecentlyOpened(e)}removeFromRecentlyOpened(e){let t;tt(e)?t=Bt.getOriginalUri(e):e instanceof An||(t=e.resource),t&&this.workspacesService.removeRecentlyOpened([t])}clear(){this.clearRecentlyOpened(),this.clearEditorNavigationStacks(),this.recentlyClosedEditors=[],this.updateContextKeys()}updateContextKeys(){this.contextKeyService.bufferChangeEvents(()=>{const e=this.getStack();this.canNavigateBackContextKey.set(e.canGoBack(je.NONE)),this.canNavigateForwardContextKey.set(e.canGoForward(je.NONE)),this.canNavigateBackInNavigationsContextKey.set(e.canGoBack(je.NAVIGATION)),this.canNavigateForwardInNavigationsContextKey.set(e.canGoForward(je.NAVIGATION)),this.canNavigateToLastNavigationLocationContextKey.set(e.canGoLast(je.NAVIGATION)),this.canNavigateBackInEditsContextKey.set(e.canGoBack(je.EDITS)),this.canNavigateForwardInEditsContextKey.set(e.canGoForward(je.EDITS)),this.canNavigateToLastEditLocationContextKey.set(e.canGoLast(je.EDITS)),this.canReopenClosedEditorContextKey.set(this.recentlyClosedEditors.length>0)})}registerEditorNavigationScopeChangeListener(){const e=()=>{this.disposeEditorNavigationStacks();const t=this.configurationService.getValue(Ti.NAVIGATION_SCOPE_SETTING);t==="editorGroup"?this.editorNavigationScope=Vt.EDITOR_GROUP:t==="editor"?this.editorNavigationScope=Vt.EDITOR:this.editorNavigationScope=Vt.DEFAULT};this._register(this.configurationService.onDidChangeConfiguration(t=>{t.affectsConfiguration(Ti.NAVIGATION_SCOPE_SETTING)&&e()})),e()}getStack(e=this.editorGroupService.activeGroup,t=e.activeEditor){switch(this.editorNavigationScope){case Vt.EDITOR:{if(!t)return new ZA;let i=this.editorScopedNavigationStacks.get(e.id);i||(i=new Map,this.editorScopedNavigationStacks.set(e.id,i));let s=i.get(t)?.stack;if(!s){const o=new O;s=o.add(this.instantiationService.createInstance(Kn,Vt.EDITOR)),o.add(s.onDidChange(()=>this._onDidChangeEditorNavigationStack.fire())),i.set(t,{stack:s,disposable:o})}return s}case Vt.EDITOR_GROUP:{let i=this.editorGroupScopedNavigationStacks.get(e.id)?.stack;if(!i){const s=new O;i=s.add(this.instantiationService.createInstance(Kn,Vt.EDITOR_GROUP)),s.add(i.onDidChange(()=>this._onDidChangeEditorNavigationStack.fire())),this.editorGroupScopedNavigationStacks.set(e.id,{stack:i,disposable:s})}return i}case Vt.DEFAULT:return this.defaultScopedEditorNavigationStack||(this.defaultScopedEditorNavigationStack=this._register(this.instantiationService.createInstance(Kn,Vt.DEFAULT)),this._register(this.defaultScopedEditorNavigationStack.onDidChange(()=>this._onDidChangeEditorNavigationStack.fire()))),this.defaultScopedEditorNavigationStack}}goForward(e){return this.getStack().goForward(e)}goBack(e){return this.getStack().goBack(e)}goPrevious(e){return this.getStack().goPrevious(e)}goLast(e){return this.getStack().goLast(e)}handleActiveEditorChangeInNavigationStacks(e,t){this.getStack(e,t?.input).handleActiveEditorChange(t)}handleActiveEditorSelectionChangeInNavigationStacks(e,t,i){this.getStack(e,t.input).handleActiveEditorSelectionChange(t,i)}handleEditorCloseEventInHistory(e){const t=this.editorScopedNavigationStacks.get(e.groupId);if(t){const i=t.get(e.editor);i&&(i.disposable.dispose(),t.delete(e.editor)),t.size===0&&this.editorScopedNavigationStacks.delete(e.groupId)}}handleEditorGroupRemoveInNavigationStacks(e){this.defaultScopedEditorNavigationStack?.remove(e.id);const t=this.editorGroupScopedNavigationStacks.get(e.id);t&&(t.disposable.dispose(),this.editorGroupScopedNavigationStacks.delete(e.id))}clearEditorNavigationStacks(){this.withEachEditorNavigationStack(e=>e.clear())}removeFromEditorNavigationStacks(e){this.withEachEditorNavigationStack(t=>t.remove(e))}moveInEditorNavigationStacks(e){this.withEachEditorNavigationStack(t=>t.move(e))}withEachEditorNavigationStack(e){this.defaultScopedEditorNavigationStack&&e(this.defaultScopedEditorNavigationStack);for(const[,t]of this.editorGroupScopedNavigationStacks)e(t.stack);for(const[,t]of this.editorScopedNavigationStacks)for(const[,i]of t)e(i.stack)}disposeEditorNavigationStacks(){this.defaultScopedEditorNavigationStack?.dispose(),this.defaultScopedEditorNavigationStack=void 0;for(const[,e]of this.editorGroupScopedNavigationStacks)e.disposable.dispose();this.editorGroupScopedNavigationStacks.clear();for(const[,e]of this.editorScopedNavigationStacks)for(const[,t]of e)t.disposable.dispose();this.editorScopedNavigationStacks.clear()}openNextRecentlyUsedEditor(e){const[t,i]=this.ensureRecentlyUsedStack(s=>s-1,e);return this.doNavigateInRecentlyUsedEditorsStack(t[i],e)}openPreviouslyUsedEditor(e){const[t,i]=this.ensureRecentlyUsedStack(s=>s+1,e);return this.doNavigateInRecentlyUsedEditorsStack(t[i],e)}async doNavigateInRecentlyUsedEditorsStack(e,t){if(e){const i=typeof t!="number"||!this.editorGroupService.getGroup(t);i?this.navigatingInRecentlyUsedEditorsStack=!0:this.navigatingInRecentlyUsedEditorsInGroupStack=!0;const s=this.editorGroupService.getGroup(e.groupId)??this.editorGroupService.activeGroup;try{await s.openEditor(e.editor)}finally{i?this.navigatingInRecentlyUsedEditorsStack=!1:this.navigatingInRecentlyUsedEditorsInGroupStack=!1}}}ensureRecentlyUsedStack(e,t){let i,s;const o=typeof t=="number"?this.editorGroupService.getGroup(t):void 0;o?(i=this.recentlyUsedEditorsInGroupStack||o.getEditors(vc.MOST_RECENTLY_ACTIVE).map(r=>({groupId:o.id,editor:r})),s=this.recentlyUsedEditorsInGroupStackIndex):(i=this.recentlyUsedEditorsStack||this.editorService.getEditors(vc.MOST_RECENTLY_ACTIVE),s=this.recentlyUsedEditorsStackIndex);let n=e(s);return n<0?n=0:n>i.length-1&&(n=i.length-1),o?(this.recentlyUsedEditorsInGroupStack=i,this.recentlyUsedEditorsInGroupStackIndex=n):(this.recentlyUsedEditorsStack=i,this.recentlyUsedEditorsStackIndex=n),[i,n]}handleEditorEventInRecentEditorsStack(){this.navigatingInRecentlyUsedEditorsStack||(this.recentlyUsedEditorsStack=void 0,this.recentlyUsedEditorsStackIndex=0),this.navigatingInRecentlyUsedEditorsInGroupStack||(this.recentlyUsedEditorsInGroupStack=void 0,this.recentlyUsedEditorsInGroupStackIndex=0)}static{this.MAX_RECENTLY_CLOSED_EDITORS=20}handleEditorCloseEventInReopen(e){if(this.ignoreEditorCloseEvent)return;const{editor:t,context:i}=e;if(i===Ig.REPLACE||i===Ig.MOVE)return;const s=t.toUntyped();if(!s)return;const o=[],n=Bt.getOriginalUri(t,{supportSideBySide:Li.BOTH});U.isUri(n)?o.push(n):n&&o.push(...gs([n.primary,n.secondary])),this.removeFromRecentlyClosedEditors(t),this.recentlyClosedEditors.push({editorId:t.editorId,editor:s,resource:Bt.getOriginalUri(t),associatedResources:o,index:e.index,sticky:e.sticky}),this.recentlyClosedEditors.length>Ti.MAX_RECENTLY_CLOSED_EDITORS&&this.recentlyClosedEditors.shift(),this.canReopenClosedEditorContextKey.set(!0)}async reopenLastClosedEditor(){const e=this.recentlyClosedEditors.pop();let t;return e&&(t=this.doReopenLastClosedEditor(e)),this.canReopenClosedEditorContextKey.set(this.recentlyClosedEditors.length>0),t}async doReopenLastClosedEditor(e){const t={pinned:!0,sticky:e.sticky,index:e.index,ignoreError:!0};(e.sticky&&!this.editorGroupService.activeGroup.isSticky(e.index)||!e.sticky&&this.editorGroupService.activeGroup.isSticky(e.index))&&(t.index=void 0);let i;if(!this.editorGroupService.activeGroup.contains(e.editor)){this.ignoreEditorCloseEvent=!0;try{i=await this.editorService.openEditor({...e.editor,options:{...e.editor.options,...t}})}finally{this.ignoreEditorCloseEvent=!1}}i||(Hv(this.recentlyClosedEditors,e),this.reopenLastClosedEditor())}removeFromRecentlyClosedEditors(e){this.recentlyClosedEditors=this.recentlyClosedEditors.filter(t=>tt(e)&&t.editorId!==e.editorId?!0:!(t.resource&&this.editorHelper.matchesFile(t.resource,e)||t.associatedResources.some(i=>this.editorHelper.matchesFile(i,e)))),this.canReopenClosedEditorContextKey.set(this.recentlyClosedEditors.length>0)}static{this.MAX_HISTORY_ITEMS=200}static{this.HISTORY_STORAGE_KEY="history.entries"}handleActiveEditorChangeInHistory(e){const t=e?.input;!t||t.isDisposed()||!this.includeInHistory(t)||(this.removeFromHistory(t),this.addToHistory(t))}addToHistory(e,t=!0){this.ensureHistoryLoaded(this.history);const i=this.editorHelper.preferResourceEditorInput(e);i&&(t?this.history.unshift(i):this.history.push(i),this.history.length>Ti.MAX_HISTORY_ITEMS&&this.editorHelper.clearOnEditorDispose(this.history.pop(),this.editorHistoryListeners),tt(e)&&this.editorHelper.onEditorDispose(e,()=>this.updateHistoryOnEditorDispose(i),this.editorHistoryListeners))}updateHistoryOnEditorDispose(e){if(tt(e))if(!VD(e))this.removeFromHistory(e);else{const t=[],i=e.primary.matches(e.secondary)?[e.primary]:[e.primary,e.secondary];for(const s of i){const o=this.editorHelper.preferResourceEditorInput(s);il(o)&&this.includeInHistory(o)&&t.push(o)}this.replaceInHistory(e,...t)}else this.includeInHistory(e)||this.removeFromHistory(e)}includeInHistory(e){return tt(e)?!0:!this.resourceExcludeMatcher.value.matches(e.resource)}removeExcludedFromHistory(){this.ensureHistoryLoaded(this.history),this.history=this.history.filter(e=>{const t=this.includeInHistory(e);return t||this.editorHelper.clearOnEditorDispose(e,this.editorHistoryListeners),t})}moveInHistory(e){e.isOperation(Hs.MOVE)&&this.removeFromHistory(e)&&this.addToHistory({resource:e.target.resource})}removeFromHistory(e){let t=!1;return this.ensureHistoryLoaded(this.history),this.history=this.history.filter(i=>{const s=this.editorHelper.matchesEditor(e,i);return s&&(this.editorHelper.clearOnEditorDispose(e,this.editorHistoryListeners),t=!0),!s}),t}replaceInHistory(e,...t){this.ensureHistoryLoaded(this.history);let i=!1;const s=[];for(const o of this.history)this.editorHelper.matchesEditor(e,o)?(this.editorHelper.clearOnEditorDispose(e,this.editorHistoryListeners),i||(s.push(...t),i=!0)):t.some(n=>this.editorHelper.matchesEditor(n,o))||s.push(o);i||s.push(...t),this.history=s}clearRecentlyOpened(){this.history=[];for(const[,e]of this.editorHistoryListeners)qe(e);this.editorHistoryListeners.clear()}getHistory(){return this.ensureHistoryLoaded(this.history),this.history}ensureHistoryLoaded(e){this.history||(this.history=[],this.editorGroupService.isReady?this.loadHistory():(async()=>(await this.editorGroupService.whenReady,this.loadHistory()))())}loadHistory(){this.history=[];const e=this.loadHistoryFromStorage(),t=[...this.editorService.getEditors(vc.MOST_RECENTLY_ACTIVE)].reverse(),i=new Set;for(const{editor:s}of t)if(this.includeInHistory(s)){if(s.resource){const o=`${s.resource.toString()}/${s.editorId}`;if(i.has(o))continue;i.add(o)}this.addToHistory(s)}for(const s of e){const o=`${s.resource.toString()}/${s.options?.override}`;!i.has(o)&&this.includeInHistory(s)&&(i.add(o),this.addToHistory(s,!1))}}loadHistoryFromStorage(){const e=[],t=this.storageService.get(Ti.HISTORY_STORAGE_KEY,G.WORKSPACE);if(t)try{const i=JSON.parse(t);for(const s of i)if(!(!s.editor||!s.editor.resource))try{e.push({...s.editor,resource:typeof s.editor.resource=="string"?U.parse(s.editor.resource):U.from(s.editor.resource)})}catch(o){Bo(o)}}catch(i){Bo(i)}return e}saveState(){if(!this.history)return;const e=[];for(const t of this.history)tt(t)||!il(t)||e.push({editor:{...t,resource:t.resource.toString()}});this.storageService.store(Ti.HISTORY_STORAGE_KEY,JSON.stringify(e),G.WORKSPACE,Re.MACHINE)}getLastActiveWorkspaceRoot(e,t){const i=this.contextService.getWorkspace().folders;if(i.length!==0){if(i.length===1){const s=i[0].uri;return(!e||s.scheme===e)&&(!t||s.authority===t)?s:void 0}for(const s of this.getHistory()){if(tt(s)||e&&s.resource.scheme!==e||t&&s.resource.authority!==t)continue;const o=this.contextService.getWorkspaceFolder(s.resource);if(o)return o.uri}for(const s of i){const o=s.uri;if((!e||o.scheme===e)&&(!t||o.authority===t))return o}}}getLastActiveFile(e,t){for(const i of this.getHistory()){let s;if(tt(i)?s=Bt.getOriginalUri(i,{filterByScheme:e}):s=i.resource,s&&s.scheme===e&&(!t||s.authority===t))return s}}dispose(){super.dispose();for(const[,e]of this.editorGroupScopedNavigationStacks)e.disposable.dispose();for(const[,e]of this.editorScopedNavigationStacks)for(const[,t]of e)t.disposable.dispose();for(const[,e]of this.editorHistoryListeners)e.dispose()}};Da=Ti=D([u(0,Q),u(1,Je),u(2,us),u(3,ce),u(4,ie),u(5,Le),u(6,PD),u(7,F),u(8,ze),u(9,se),u(10,Ue)],Da);zv(xu,Da,$v.Eager);class Gg{constructor(e,t,i){this.editorIdentifier=e,this.selection=t,this.reason=i}justifiesNewNavigationEntry(e){if(this.editorIdentifier.groupId!==e.editorIdentifier.groupId||!this.editorIdentifier.editor.matches(e.editorIdentifier.editor)||!this.selection||!e.selection)return!0;const t=this.selection.compare(e.selection);return t===_a.SIMILAR&&(e.reason===pi.NAVIGATION||e.reason===pi.JUMP)?!0:t===_a.DIFFERENT}}let Kn=class extends R{constructor(e,t){super(),this.scope=e,this.instantiationService=t,this.selectionsStack=this._register(this.instantiationService.createInstance(Wn,je.NONE,this.scope)),this.editsStack=this._register(this.instantiationService.createInstance(Wn,je.EDITS,this.scope)),this.navigationsStack=this._register(this.instantiationService.createInstance(Wn,je.NAVIGATION,this.scope)),this.stacks=[this.selectionsStack,this.editsStack,this.navigationsStack],this.onDidChange=V.any(this.selectionsStack.onDidChange,this.editsStack.onDidChange,this.navigationsStack.onDidChange)}canGoForward(e){return this.getStack(e).canGoForward()}goForward(e){return this.getStack(e).goForward()}canGoBack(e){return this.getStack(e).canGoBack()}goBack(e){return this.getStack(e).goBack()}goPrevious(e){return this.getStack(e).goPrevious()}canGoLast(e){return this.getStack(e).canGoLast()}goLast(e){return this.getStack(e).goLast()}getStack(e=je.NONE){switch(e){case je.NONE:return this.selectionsStack;case je.EDITS:return this.editsStack;case je.NAVIGATION:return this.navigationsStack}}handleActiveEditorChange(e){this.selectionsStack.notifyNavigation(e)}handleActiveEditorSelectionChange(e,t){const i=this.selectionsStack.current;this.selectionsStack.notifyNavigation(e,t),t.reason===pi.EDIT?this.editsStack.notifyNavigation(e,t):(t.reason===pi.NAVIGATION||t.reason===pi.JUMP)&&!this.selectionsStack.isNavigating()&&(t.reason===pi.JUMP&&!this.navigationsStack.isNavigating()&&i&&this.navigationsStack.addOrReplace(i.groupId,i.editor,i.selection),this.navigationsStack.notifyNavigation(e,t))}clear(){for(const e of this.stacks)e.clear()}remove(e){for(const t of this.stacks)t.remove(e)}move(e){for(const t of this.stacks)t.move(e)}};Kn=D([u(1,F)],Kn);class ZA{constructor(){this.onDidChange=V.None}canGoForward(){return!1}async goForward(){}canGoBack(){return!1}async goBack(){}async goPrevious(){}canGoLast(){return!1}async goLast(){}handleActiveEditorChange(){}handleActiveEditorSelectionChange(){}clear(){}remove(){}move(){}dispose(){}}let Wn=class extends R{static{Gl=this}static{this.MAX_STACK_SIZE=50}get current(){return this.stack[this.index]}set current(e){e&&(this.stack[this.index]=e)}constructor(e,t,i,s,o,n){super(),this.filter=e,this.scope=t,this.editorService=s,this.editorGroupService=o,this.logService=n,this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,this.mapEditorToDisposable=new Map,this.mapGroupToDisposable=new Map,this.stack=[],this.index=-1,this.previousIndex=-1,this.navigating=!1,this.currentSelectionState=void 0,this.editorHelper=i.createInstance(Aa),this.registerListeners()}registerListeners(){this._register(this.onDidChange(()=>this.traceStack())),this._register(this.logService.onDidChangeLogLevel(()=>this.traceStack()))}traceStack(){if(this.logService.getLevel()!==yp.Trace)return;const e=[];for(const t of this.stack)typeof t.selection?.log=="function"?e.push(`- group: ${t.groupId}, editor: ${t.editor.resource?.toString()}, selection: ${t.selection.log()}`):e.push(`- group: ${t.groupId}, editor: ${t.editor.resource?.toString()}, selection: <none>`);e.length===0?this.trace(`index: ${this.index}, navigating: ${this.isNavigating()}: <empty>`):this.trace(`index: ${this.index}, navigating: ${this.isNavigating()}
${e.join(`
`)}
			`)}trace(e,t=null,i){if(this.logService.getLevel()!==yp.Trace)return;let s;switch(this.filter){case je.NONE:s="global";break;case je.EDITS:s="edits";break;case je.NAVIGATION:s="navigation";break}let o;switch(this.scope){case Vt.DEFAULT:o="default";break;case Vt.EDITOR_GROUP:o="editorGroup";break;case Vt.EDITOR:o="editor";break}t!==null?this.logService.trace(`[History stack ${s}-${o}]: ${e} (editor: ${t?.resource?.toString()}, event: ${this.traceEvent(i)})`):this.logService.trace(`[History stack ${s}-${o}]: ${e}`)}traceEvent(e){if(!e)return"<none>";switch(e.reason){case pi.EDIT:return"edit";case pi.NAVIGATION:return"navigation";case pi.JUMP:return"jump";case pi.PROGRAMMATIC:return"programmatic";case pi.USER:return"user"}}registerGroupListeners(e){if(!this.mapGroupToDisposable.has(e)){const t=this.editorGroupService.getGroup(e);t&&this.mapGroupToDisposable.set(e,t.onWillMoveEditor(i=>this.onWillMoveEditor(i)))}}onWillMoveEditor(e){if(this.trace("onWillMoveEditor()",e.editor),this.scope!==Vt.EDITOR_GROUP)for(const t of this.stack)t.groupId===e.groupId&&this.editorHelper.matchesEditor(e.editor,t.editor)&&(t.groupId=e.target)}notifyNavigation(e,t){this.trace("notifyNavigation()",e?.input,t);const i=tl(e),s=e?.input&&!e.input.isDisposed();this.navigating?(this.trace("notifyNavigation() ignoring (navigating)",e?.input,t),i&&s?(this.trace("notifyNavigation() updating current selection state",e?.input,t),this.currentSelectionState=new Gg({groupId:e.group.id,editor:e.input},e.getSelection(),t?.reason)):(this.trace("notifyNavigation() dropping current selection state",e?.input,t),this.currentSelectionState=void 0)):(this.trace("notifyNavigation() not ignoring",e?.input,t),i&&s?this.onSelectionAwareEditorNavigation(e.group.id,e.input,e.getSelection(),t):(this.currentSelectionState=void 0,s&&this.onNonSelectionAwareEditorNavigation(e.group.id,e.input)))}onSelectionAwareEditorNavigation(e,t,i,s){if(this.current?.groupId===e&&!i&&this.editorHelper.matchesEditor(this.current.editor,t))return;this.trace("onSelectionAwareEditorNavigation()",t,s);const o=new Gg({groupId:e,editor:t},i,s?.reason);!this.currentSelectionState||this.currentSelectionState.justifiesNewNavigationEntry(o)?this.doAdd(e,t,o.selection):this.doReplace(e,t,o.selection),this.currentSelectionState=o}onNonSelectionAwareEditorNavigation(e,t){this.current?.groupId===e&&this.editorHelper.matchesEditor(this.current.editor,t)||(this.trace("onNonSelectionAwareEditorNavigation()",t),this.doAdd(e,t))}doAdd(e,t,i){this.navigating||this.addOrReplace(e,t,i)}doReplace(e,t,i){this.navigating||this.addOrReplace(e,t,i,!0)}addOrReplace(e,t,i,s){this.registerGroupListeners(e);let o=!1;this.current&&(s||this.shouldReplaceStackEntry(this.current,{groupId:e,editor:t,selection:i}))&&(o=!0);const n=this.editorHelper.preferResourceEditorInput(t);if(!n)return;o?this.trace("replace()",n):this.trace("add()",n);const r={groupId:e,editor:n,selection:i},d=[];if(o)this.current&&d.push(this.current),this.current=r;else{if(this.stack.length>this.index+1){for(let l=this.index+1;l<this.stack.length;l++)d.push(this.stack[l]);this.stack=this.stack.slice(0,this.index+1)}this.stack.splice(this.index+1,0,r),this.stack.length>Gl.MAX_STACK_SIZE?(d.push(this.stack.shift()),this.previousIndex>=0&&this.previousIndex--):this.setIndex(this.index+1,!0)}for(const l of d)this.editorHelper.clearOnEditorDispose(l.editor,this.mapEditorToDisposable);tt(n)&&this.editorHelper.onEditorDispose(n,()=>this.remove(n),this.mapEditorToDisposable),this._onDidChange.fire()}shouldReplaceStackEntry(e,t){return e.groupId!==t.groupId||!this.editorHelper.matchesEditor(e.editor,t.editor)?!1:e.selection?t.selection?e.selection.compare(t.selection)===_a.IDENTICAL:!1:!0}move(e){if(e.isOperation(Hs.MOVE))for(const t of this.stack)this.editorHelper.matchesEditor(e,t.editor)&&(t.editor={resource:e.target.resource})}remove(e){const t=this.stack.length;this.stack=this.stack.filter(i=>{const s=typeof e=="number"?i.groupId===e:this.editorHelper.matchesEditor(e,i.editor);return s&&this.editorHelper.clearOnEditorDispose(i.editor,this.mapEditorToDisposable),!s}),t!==this.stack.length&&(this.flatten(),this.index=this.stack.length-1,this.previousIndex=-1,typeof e=="number"&&(this.mapGroupToDisposable.get(e)?.dispose(),this.mapGroupToDisposable.delete(e)),this._onDidChange.fire())}flatten(){const e=[];let t;for(const i of this.stack)t&&this.shouldReplaceStackEntry(i,t)||(t=i,e.push(i));this.stack=e}clear(){this.index=-1,this.previousIndex=-1,this.stack.splice(0);for(const[,e]of this.mapEditorToDisposable)qe(e);this.mapEditorToDisposable.clear();for(const[,e]of this.mapGroupToDisposable)qe(e);this.mapGroupToDisposable.clear()}dispose(){super.dispose(),this.clear()}canGoForward(){return this.stack.length>this.index+1}async goForward(){if(!await this.maybeGoCurrent()&&this.canGoForward())return this.setIndex(this.index+1),this.navigate()}canGoBack(){return this.index>0}async goBack(){if(!await this.maybeGoCurrent()&&this.canGoBack())return this.setIndex(this.index-1),this.navigate()}async goPrevious(){if(!await this.maybeGoCurrent())return this.previousIndex===-1?this.goBack():(this.setIndex(this.previousIndex),this.navigate())}canGoLast(){return this.stack.length>0}async goLast(){if(this.canGoLast())return this.setIndex(this.stack.length-1),this.navigate()}async maybeGoCurrent(){return this.filter===je.NONE||this.isCurrentSelectionActive()?!1:(await this.navigate(),!0)}isCurrentSelectionActive(){if(!this.current?.selection)return!1;const e=this.editorService.activeEditorPane;if(!tl(e)||e.group.id!==this.current.groupId||!e.input||!this.editorHelper.matchesEditor(e.input,this.current.editor))return!1;const t=e.getSelection();return t?t.compare(this.current.selection)===_a.IDENTICAL:!1}setIndex(e,t){this.previousIndex=this.index,this.index=e,t||this._onDidChange.fire()}async navigate(){this.navigating=!0;try{this.current&&await this.doNavigate(this.current)}finally{this.navigating=!1}}doNavigate(e){let t=Object.create(null);return e.selection&&(t=e.selection.restore(t)),tt(e.editor)?this.editorService.openEditor(e.editor,t,e.groupId):this.editorService.openEditor({...e.editor,options:{...e.editor.options,...t}},e.groupId)}isNavigating(){return this.navigating}};Wn=Gl=D([u(2,F),u(3,Q),u(4,Je),u(5,Ue)],Wn);let Aa=class{constructor(e,t,i,s){this.uriIdentityService=e,this.lifecycleService=t,this.fileService=i,this.pathService=s}preferResourceEditorInput(e){const t=Bt.getOriginalUri(e);if(t?.scheme===pe.file||t?.scheme===pe.vscodeRemote||t?.scheme===pe.vscodeUserData||t?.scheme===this.pathService.defaultUriScheme){if(tt(e)){const s=e.toUntyped();if(il(s))return s}return e}else return tt(e)?e:void 0}matchesEditor(e,t){return e instanceof An||e instanceof mp?tt(t)?!1:e instanceof An?e.contains(t.resource,wp.DELETED):this.matchesFile(t.resource,e):tt(e)?tt(t)?e.matches(t):this.matchesFile(t.resource,e):tt(t)?this.matchesFile(e.resource,t):e&&t&&this.uriIdentityService.extUri.isEqual(e.resource,t.resource)}matchesFile(e,t){if(t instanceof An)return t.contains(e,wp.DELETED);if(t instanceof mp)return this.uriIdentityService.extUri.isEqualOrParent(e,t.resource);if(tt(t)){const i=t.resource;return!i||this.lifecycleService.phase>=gr.Restored&&!this.fileService.hasProvider(i)?!1:this.uriIdentityService.extUri.isEqual(i,e)}return this.uriIdentityService.extUri.isEqual(t?.resource,e)}matchesEditorIdentifier(e,t){return!t?.group||e.groupId!==t.group.id?!1:t.input?e.editor.matches(t.input):!1}onEditorDispose(e,t,i){const s=V.once(e.onWillDispose)(()=>t());let o=i.get(e);o||(o=new O,i.set(e,o)),o.add(s)}clearOnEditorDispose(e,t){if(!tt(e))return;const i=t.get(e);i&&(qe(i),t.delete(e))}};Aa=D([u(0,Jo),u(1,qo),u(2,Le),u(3,wd)],Aa);const XA=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),QA=new j("activeCustomEditorId","",{type:"string",description:c(5403,"The viewType of the currently active custom editor.")}),eT=new j("focusedCustomEditorIsEditable",!1);var Ta;(function(a){a.default="default",a.builtin="builtin",a.option="option"})(Ta||(Ta={}));class Ug{constructor(e){this.id=e.id,this.displayName=e.displayName,this.providerDisplayName=e.providerDisplayName,this.priority=e.priority,this.selector=e.selector}matches(e){return this.selector.some(t=>t.filenamePattern&&Qr(t.filenamePattern,e))}}class _c{constructor(e){this.allEditors=Es(e,t=>t.id)}get length(){return this.allEditors.length}get defaultEditor(){return this.allEditors.find(e=>{switch(e.priority){case De.default:case De.builtin:return this.allEditors.every(t=>t===e||tT(t,e));default:return!1}})}get bestAvailableEditor(){return Array.from(this.allEditors).sort((t,i)=>ti(t.priority)-ti(i.priority))[0]}}function tT(a,e){return ti(a.priority)<ti(e.priority)}class iT{constructor(e){this._references=new Map,this._uriIdentityService=e}async getAllModels(e){const t=`${e.toString()}@@@`,i=[];for(const[s,o]of this._references)s.startsWith(t)&&o.model&&i.push(await o.model);return i}async get(e,t){const i=this.key(e,t);return this._references.get(i)?.model}tryRetain(e,t){const i=this.key(e,t),s=this._references.get(i);if(s)return s.counter++,s.model.then(o=>({object:o,dispose:wu(()=>{--s.counter<=0&&(s.model.then(n=>n.dispose()),this._references.delete(i))})}))}add(e,t,i){const s=this.key(e,t);if(this._references.get(s))throw new Error("Model already exists");return this._references.set(s,{viewType:t,model:i,counter:0}),this.tryRetain(e,t)}disposeAllModelsForView(e){for(const[t,i]of this._references)i.viewType===e&&(i.model.then(s=>s.dispose()),this._references.delete(t))}key(e,t){return e=this._uriIdentityService.asCanonicalUri(e),`${e.toString()}@@@${t}`}}const hi=Object.freeze({viewType:"viewType",displayName:"displayName",selector:"selector",priority:"priority"}),sT={description:c(5405,"Contributed custom editors."),type:"array",defaultSnippets:[{body:[{[hi.viewType]:"$1",[hi.displayName]:"$2",[hi.selector]:[{filenamePattern:"$3"}]}]}],items:{type:"object",required:[hi.viewType,hi.displayName,hi.selector],properties:{[hi.viewType]:{type:"string",markdownDescription:c(5406,"Identifier for the custom editor. This must be unique across all custom editors, so we recommend including your extension id as part of `viewType`. The `viewType` is used when registering custom editors with `vscode.registerCustomEditorProvider` and in the `onCustomEditor:${id}` [activation event](https://code.visualstudio.com/api/references/activation-events).")},[hi.displayName]:{type:"string",description:c(5407,"Human readable name of the custom editor. This is displayed to users when selecting which editor to use.")},[hi.selector]:{type:"array",description:c(5408,"Set of globs that the custom editor is enabled for."),items:{type:"object",defaultSnippets:[{body:{filenamePattern:"$1"}}],properties:{filenamePattern:{type:"string",description:c(5409,"Glob that the custom editor is enabled for.")}}}},[hi.priority]:{type:"string",markdownDeprecationMessage:c(5410,"Controls if the custom editor is enabled automatically when the user opens a file. This may be overridden by users using the `workbench.editorAssociations` setting."),enum:[Ta.default,Ta.option],markdownEnumDescriptions:[c(5411,"The editor is automatically used when the user opens a resource, provided that no other default custom editors are registered for that resource."),c(5412,"The editor is not automatically used when the user opens a resource, but a user can switch to the editor using the `Reopen With` command.")],default:"default"}}}},oT=ro.registerExtensionPoint({extensionPoint:"customEditors",deps:[JS],jsonSchema:sT,activationEventsGenerator:(a,e)=>{for(const t of a){const i=t[hi.viewType];i&&e.push(`onCustomEditor:${i}`)}}});class nT extends R{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.customEditors}render(e){const t=e.contributes?.customEditors||[];if(!t.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const i=[c(5413,"View Type"),c(5414,"Priority"),c(5415,"Filename Pattern")],s=t.map(o=>[o.viewType,o.priority??"",gs(o.selector.map(n=>n.filenamePattern)).join(", ")]);return{data:{headers:i,rows:s},dispose:()=>{}}}}H.as(Fd.ExtensionFeaturesRegistry).registerExtensionFeature({id:"customEditors",label:c(5416,"Custom Editors"),access:{canToggle:!1},renderer:new ee(nT)});class Gn extends R{static{this.CUSTOM_EDITORS_STORAGE_ID="customEditors"}static{this.CUSTOM_EDITORS_ENTRY_ID="editors"}constructor(e){super(),this._editors=new Map,this._onChange=this._register(new E),this.onChange=this._onChange.event,this._memento=new If(Gn.CUSTOM_EDITORS_STORAGE_ID,e);const t=this._memento.getMemento(G.PROFILE,Re.MACHINE);for(const i of t[Gn.CUSTOM_EDITORS_ENTRY_ID]||[])this.add(new Ug(i));oT.setHandler(i=>{this.update(i)})}update(e){this._editors.clear();for(const i of e)for(const s of i.value)this.add(new Ug({id:s.viewType,displayName:s.displayName,providerDisplayName:i.description.isBuiltin?c(5402,"Built-in"):i.description.displayName||i.description.identifier.value,selector:s.selector||[],priority:rT(s,i.description)}));const t=this._memento.getMemento(G.PROFILE,Re.MACHINE);t[Gn.CUSTOM_EDITORS_ENTRY_ID]=Array.from(this._editors.values()),this._memento.saveMemento(),this._onChange.fire()}[Symbol.iterator](){return this._editors.values()}get(e){return this._editors.get(e)}getContributedEditors(e){return Array.from(this._editors.values()).filter(t=>t.matches(e))}add(e){if(this._editors.has(e.id)){console.error(`Custom editor with id '${e.id}' already registered`);return}this._editors.set(e.id,e)}}function rT(a,e){switch(a.priority){case De.default:case De.option:return a.priority;case De.builtin:return e.isBuiltin?De.builtin:De.default;default:return De.default}}Pe(XA);let Ul=class extends R{constructor(e,t,i,s,o,n,r){super(),this.editorService=i,this.editorGroupService=s,this.instantiationService=o,this.uriIdentityService=n,this.editorResolverService=r,this._untitledCounter=0,this._editorResolverDisposables=this._register(new O),this._editorCapabilities=new Map,this._onDidChangeEditorTypes=this._register(new E),this.onDidChangeEditorTypes=this._onDidChangeEditorTypes.event,this._fileEditorFactory=H.as(ct.EditorFactory).getFileEditorFactory(),this._models=new iT(this.uriIdentityService),this._contributedEditors=this._register(new Gn(t)),this.editorResolverService.bufferChangeEvents(this.registerContributionPoints.bind(this)),this._register(this._contributedEditors.onChange(()=>{this.editorResolverService.bufferChangeEvents(this.registerContributionPoints.bind(this)),this._onDidChangeEditorTypes.fire()}));const d={contextKey:QA,getGroupContextKeyValue:p=>this.getActiveCustomEditorId(p),onDidChange:this.onDidChangeEditorTypes},l={contextKey:eT,getGroupContextKeyValue:p=>this.getCustomEditorIsEditable(p),onDidChange:this.onDidChangeEditorTypes};this._register(this.editorGroupService.registerContextKeyProvider(d)),this._register(this.editorGroupService.registerContextKeyProvider(l)),this._register(e.onDidRunOperation(p=>{p.isOperation(Hs.MOVE)&&this.handleMovedFileInOpenedFileEditors(p.resource,this.uriIdentityService.asCanonicalUri(p.target.resource))}));const h=105;this._register(Df.addImplementation(h,"custom-editor",()=>this.withActiveCustomEditor(p=>p.undo()))),this._register(Af.addImplementation(h,"custom-editor",()=>this.withActiveCustomEditor(p=>p.redo())))}getEditorTypes(){return[...this._contributedEditors]}withActiveCustomEditor(e){const t=this.editorService.activeEditor;if(t instanceof Mt){const i=e(t);return i||!0}return!1}registerContributionPoints(){this._editorResolverDisposables.clear();for(const e of this._contributedEditors)for(const t of e.selector)t.filenamePattern&&this._editorResolverDisposables.add(this.editorResolverService.registerEditor(t.filenamePattern,{id:e.id,label:e.displayName,detail:e.providerDisplayName,priority:e.priority},{singlePerResource:()=>!(this.getCustomEditorCapabilities(e.id)?.supportsMultipleEditorsPerDocument??!1)},{createEditorInput:({resource:i},s)=>({editor:Mt.create(this.instantiationService,i,e.id,s.id)}),createUntitledEditorInput:({resource:i},s)=>({editor:Mt.create(this.instantiationService,i??U.from({scheme:pe.untitled,authority:`Untitled-${this._untitledCounter++}`}),e.id,s.id)}),createDiffEditorInput:(i,s)=>({editor:this.createDiffEditorInput(i,e.id,s)})}))}createDiffEditorInput(e,t,i){const s=Mt.create(this.instantiationService,Se(e.modified.resource),t,i.id,{customClasses:"modified"}),o=Mt.create(this.instantiationService,Se(e.original.resource),t,i.id,{customClasses:"original"});return this.instantiationService.createInstance(Cr,e.label,e.description,o,s,!0)}get models(){return this._models}getCustomEditor(e){return this._contributedEditors.get(e)}getContributedCustomEditors(e){return new _c(this._contributedEditors.getContributedEditors(e))}getUserConfiguredCustomEditors(e){const t=this.editorResolverService.getAssociationsForResource(e);return new _c(gs(t.map(i=>this._contributedEditors.get(i.viewType))))}getAllCustomEditors(e){return new _c([...this.getUserConfiguredCustomEditors(e).allEditors,...this.getContributedCustomEditors(e).allEditors])}registerCustomEditorCapabilities(e,t){if(this._editorCapabilities.has(e))throw new Error(`Capabilities for ${e} already set`);return this._editorCapabilities.set(e,t),ae(()=>{this._editorCapabilities.delete(e)})}getCustomEditorCapabilities(e){return this._editorCapabilities.get(e)}getActiveCustomEditorId(e){const t=e.activeEditorPane;return t?.input?.resource&&t?.input instanceof Mt?t.input.viewType:""}getCustomEditorIsEditable(e){const t=e.activeEditorPane;return t?.input?.resource?t?.input instanceof Mt:!1}async handleMovedFileInOpenedFileEditors(e,t){if(ki(e).toLowerCase()===ki(t).toLowerCase())return;const i=this.getAllCustomEditors(t);if(!i.allEditors.some(o=>o.priority!==De.option))return;const s=new Map;for(const o of this.editorGroupService.groups)for(const n of o.editors)if(this._fileEditorFactory.isFileEditor(n)&&!(n instanceof Mt)&&dt(n.resource,t)){let r=s.get(o.id);r||(r=[],s.set(o.id,r)),r.push(n)}if(s.size)for(const[o,n]of s)this.editorService.replaceEditors(n.map(r=>{let d;if(i.defaultEditor){const l=i.defaultEditor.id;d=Mt.create(this.instantiationService,t,l,o)}else d={resource:t,options:{override:Ct.id}};return{editor:r,replacement:d,options:{preserveFocus:!0}}}),o)}};Ul=D([u(0,Le),u(1,ce),u(2,Q),u(3,Je),u(4,F),u(5,Jo),u(6,Sr)],Ul);let Hl=class extends R{constructor(e,t){super(),this._themeService=e,this._configurationService=t,this._cachedWebViewThemeData=void 0,this._onThemeDataChanged=this._register(new E),this.onThemeDataChanged=this._onThemeDataChanged.event,this._register(this._themeService.onDidColorThemeChange(()=>{this._reset()}));const i=["editor.fontFamily","editor.fontWeight","editor.fontSize","accessibility.underlineLinks"];this._register(this._configurationService.onDidChangeConfiguration(s=>{i.some(o=>s.affectsConfiguration(o))&&this._reset()}))}getTheme(){return this._themeService.getColorTheme()}getWebviewThemeData(){if(!this._cachedWebViewThemeData){const e=this._configurationService.getValue("editor"),t=e.fontFamily||Xr.fontFamily,i=e.fontWeight||Xr.fontWeight,s=e.fontSize||Xr.fontSize,o=this._configurationService.getValue("accessibility.underlineLinks"),n=this._themeService.getColorTheme(),r=jv().getColors().reduce((h,p)=>{const f=n.getColor(p.id);return f&&(h["vscode-"+p.id.replace(".","-")]=f.toString()),h},{}),d={"vscode-font-family":eA,"vscode-font-weight":"normal","vscode-font-size":"13px","vscode-editor-font-family":t,"vscode-editor-font-weight":i,"vscode-editor-font-size":s+"px","text-link-decoration":o?"underline":"none",...r},l=sr.fromTheme(n);this._cachedWebViewThemeData={styles:d,activeTheme:l,themeLabel:n.label,themeId:n.settingsId}}return this._cachedWebViewThemeData}_reset(){this._cachedWebViewThemeData=void 0,this._onThemeDataChanged.fire()}};Hl=D([u(0,oA),u(1,ie)],Hl);var sr;(function(a){a.light="vscode-light",a.dark="vscode-dark",a.highContrast="vscode-high-contrast",a.highContrastLight="vscode-high-contrast-light"})(sr||(sr={}));(function(a){function e(t){switch(t.type){case So.LIGHT:return a.light;case So.DARK:return a.dark;case So.HIGH_CONTRAST_DARK:return a.highContrast;case So.HIGH_CONTRAST_LIGHT:return a.highContrastLight}}a.fromTheme=e})(sr||(sr={}));class aT{constructor(e,t,i){this._getExtensionLocation=e,this._getMappings=t,this.tunnelService=i,this._tunnels=new Map}async getRedirect(e,t){const i=U.parse(t),s=ZS(i);if(s){for(const o of this._getMappings())if(o.webviewPort===s.port){const n=this._getExtensionLocation();if(n&&n.scheme===pe.vscodeRemote){const r=e&&await this.getOrCreateTunnel(e,o.extensionHostPort);if(r)return r.tunnelLocalPort===o.webviewPort?void 0:encodeURI(i.with({authority:`127.0.0.1:${r.tunnelLocalPort}`}).toString(!0))}if(o.webviewPort!==o.extensionHostPort)return encodeURI(i.with({authority:`${s.address}:${o.extensionHostPort}`}).toString(!0))}}}async dispose(){for(const e of this._tunnels.values())await e.dispose();this._tunnels.clear()}async getOrCreateTunnel(e,t){const i=this._tunnels.get(t);if(i)return i;const s=await this.tunnelService.openTunnel({getAddress:async()=>e},void 0,t);let o;return typeof s=="string"&&(o=void 0),o&&this._tunnels.set(t,o),o}}const dT=new Map([[".svg","image/svg+xml"],[".txt",Tn.text],[".css","text/css"],[".js","application/javascript"],[".cjs","application/javascript"],[".mjs","application/javascript"],[".json","application/json"],[".html","text/html"],[".htm","text/html"],[".xhtml","application/xhtml+xml"],[".oft","font/otf"],[".xml","application/xml"],[".wasm","application/wasm"]]);function cT(a){const e=qv(a.fsPath).toLowerCase();return dT.get(e)||Yv(a.fsPath)||Tn.unknown}var Xi;(function(a){let e;(function(s){s[s.Success=0]="Success",s[s.Failed=1]="Failed",s[s.AccessDenied=2]="AccessDenied",s[s.NotModified=3]="NotModified"})(e=a.Type||(a.Type={}));class t{constructor(o,n,r,d){this.stream=o,this.etag=n,this.mtime=r,this.mimeType=d,this.type=e.Success}}a.StreamSuccess=t,a.Failed={type:e.Failed},a.AccessDenied={type:e.AccessDenied};class i{constructor(o,n){this.mimeType=o,this.mtime=n,this.type=e.NotModified}}a.NotModified=i})(Xi||(Xi={}));async function lT(a,e,t,i,s){i.debug(`loadLocalResource - begin. requestUri=${a}`);const o=hT(a,e.roots);if(i.debug(`loadLocalResource - found resource to load. requestUri=${a}, resourceToLoad=${o}`),!o)return Xi.AccessDenied;const n=cT(a);try{const r=await t.readFileStream(o,{etag:e.ifNoneMatch},s);return new Xi.StreamSuccess(r.value,r.etag,r.mtime,n)}catch(r){return r instanceof Tf&&r.fileOperationResult===yn.FILE_NOT_MODIFIED_SINCE?new Xi.NotModified(n,r.options?.mtime):(i.debug(`loadLocalResource - Error using fileReader. requestUri=${a}`),console.log(r),Xi.Failed)}}function hT(a,e){for(const t of e)if(uT(t,a))return pT(a)}function uT(a,e){if(a.scheme!==e.scheme)return!1;let t=vp(e.fsPath),i=vp(a.fsPath+(a.fsPath.endsWith(xn)?"":xn));return bp(a.fsPath)&&bp(e.fsPath)&&(i=i.toLowerCase(),t=t.toLowerCase()),t.startsWith(i)}function pT(a){return a.scheme===pe.vscodeRemote?U.from({scheme:pe.vscodeRemote,authority:a.authority,path:"/vscode-resource",query:JSON.stringify({requestResourcePath:a.path})}):a}const gT=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Pe(gT);const fT=c(5144,"Find"),mT=c(5145,"Find"),wT=c(5146,"Previous Match"),yT=c(5147,"Next Match"),vT=c(5148,"Close"),qr=310,bT=73;class CT extends pd{constructor(e,t,i,s,o){super(),this._keybindingService=o,this._isVisible=!1,this._foundMatch=!1,this._width=0,this.state=this._register(new XS),this._matchesLimit=e.matchesLimit??Number.MAX_SAFE_INTEGER,this._findInput=this._register(new QS(null,t,{label:fT,placeholder:mT,validation:d=>{if(d.length===0||!this._findInput.getRegex())return null;try{return new RegExp(d),null}catch(l){return this._foundMatch=!1,this.updateButtons(this._foundMatch),{content:l.message}}},showCommonFindToggles:e.showCommonFindToggles,appendCaseSensitiveLabel:e.appendCaseSensitiveActionId?this._getKeybinding(e.appendCaseSensitiveActionId):void 0,appendRegexLabel:e.appendRegexActionId?this._getKeybinding(e.appendRegexActionId):void 0,appendWholeWordsLabel:e.appendWholeWordsActionId?this._getKeybinding(e.appendWholeWordsActionId):void 0,showHistoryHint:()=>Dm(o),inputBoxStyles:gd,toggleStyles:yu},i)),this._updateHistoryDelayer=this._register(new Jv(500)),this._register(this._findInput.onInput(async d=>{(!e.checkImeCompletionState||!this._findInput.isImeSessionInProgress)&&(this._foundMatch=this._onInputChanged(),e.showResultCount&&await this.updateResultCount(),this.updateButtons(this._foundMatch),this.focusFindBox(),this._delayedUpdateHistory())})),this._findInput.setRegex(!!this.state.isRegex),this._findInput.setCaseSensitive(!!this.state.matchCase),this._findInput.setWholeWords(!!this.state.wholeWord),this._register(this._findInput.onDidOptionChange(()=>{this.state.change({isRegex:this._findInput.getRegex(),wholeWord:this._findInput.getWholeWords(),matchCase:this._findInput.getCaseSensitive()},!0)})),this._register(this.state.onFindReplaceStateChange(()=>{this._findInput.setRegex(this.state.isRegex),this._findInput.setWholeWords(this.state.wholeWord),this._findInput.setCaseSensitive(this.state.matchCase),this.findFirst()})),this.prevBtn=this._register(new lc({label:wT+(e.previousMatchActionId?this._getKeybinding(e.previousMatchActionId):""),icon:e_,onTrigger:()=>{this.find(!0)}},s)),this.nextBtn=this._register(new lc({label:yT+(e.nextMatchActionId?this._getKeybinding(e.nextMatchActionId):""),icon:t_,onTrigger:()=>{this.find(!1)}},s));const n=this._register(new lc({label:vT+(e.closeWidgetActionId?this._getKeybinding(e.closeWidgetActionId):""),icon:Zv,onTrigger:()=>{this.hide()}},s));this._innerDomNode=document.createElement("div"),this._innerDomNode.classList.add("simple-find-part"),this._innerDomNode.appendChild(this._findInput.domNode),this._innerDomNode.appendChild(this.prevBtn.domNode),this._innerDomNode.appendChild(this.nextBtn.domNode),this._innerDomNode.appendChild(n.domNode),this._domNode=document.createElement("div"),this._domNode.classList.add("simple-find-part-wrapper"),this._domNode.appendChild(this._innerDomNode),this.onkeyup(this._innerDomNode,d=>{if(d.equals(y.Escape)){this.hide(),d.preventDefault();return}}),this._focusTracker=this._register(Mo(this._innerDomNode)),this._register(this._focusTracker.onDidFocus(this._onFocusTrackerFocus.bind(this))),this._register(this._focusTracker.onDidBlur(this._onFocusTrackerBlur.bind(this))),this._findInputFocusTracker=this._register(Mo(this._findInput.domNode)),this._register(this._findInputFocusTracker.onDidFocus(this._onFindInputFocusTrackerFocus.bind(this))),this._register(this._findInputFocusTracker.onDidBlur(this._onFindInputFocusTrackerBlur.bind(this))),this._register(Y(this._innerDomNode,"click",d=>{d.stopPropagation()})),e?.showResultCount&&(this._domNode.classList.add("result-count"),this._matchesCount=document.createElement("div"),this._matchesCount.className="matchesCount",this._findInput.domNode.insertAdjacentElement("afterend",this._matchesCount),this._register(this._findInput.onDidChange(async()=>{await this.updateResultCount()})),this._register(this._findInput.onDidOptionChange(async()=>{this._foundMatch=this._onInputChanged(),await this.updateResultCount(),this.focusFindBox(),this._delayedUpdateHistory()})));let r=e?.initialWidth;if(r&&(r=r<qr?qr:r,this._domNode.style.width=`${r}px`),e?.enableSash){const d=r??qr;let l=d;const h=this._register(new Xv(this._innerDomNode,this,{orientation:J.VERTICAL,size:1}));this._register(h.onDidStart(()=>{l=parseFloat(Cp(this._domNode).width)})),this._register(h.onDidChange(p=>{const f=l+p.startX-p.currentX;f<d||(this._domNode.style.width=`${f}px`)})),this._register(h.onDidReset(p=>{parseFloat(Cp(this._domNode).width)===d?this._domNode.style.width="100%":this._domNode.style.width=`${d}px`}))}}getVerticalSashLeft(e){return 0}get inputValue(){return this._findInput.getValue()}get focusTracker(){return this._focusTracker}_getKeybinding(e){const t=this._keybindingService?.lookupKeybinding(e);return t?` (${t.getLabel()})`:""}dispose(){super.dispose(),this._domNode?.remove()}isVisible(){return this._isVisible}getDomNode(){return this._domNode}getFindInputDomNode(){return this._findInput.domNode}reveal(e,t=!0){if(e&&this._findInput.setValue(e),this._isVisible){this._findInput.select();return}this._isVisible=!0,this.updateResultCount(),this.layout(),setTimeout(()=>{this._innerDomNode.classList.toggle("suppress-transition",!t),this._innerDomNode.classList.add("visible","visible-transition"),this._innerDomNode.setAttribute("aria-hidden","false"),this._findInput.select(),t||setTimeout(()=>{this._innerDomNode.classList.remove("suppress-transition")},0)},0)}show(e){e&&!this._isVisible&&this._findInput.setValue(e),this._isVisible=!0,this.layout(),setTimeout(()=>{this._innerDomNode.classList.add("visible","visible-transition"),this._innerDomNode.setAttribute("aria-hidden","false")},0)}hide(e=!0){this._isVisible&&(this._innerDomNode.classList.toggle("suppress-transition",!e),this._innerDomNode.classList.remove("visible-transition"),this._innerDomNode.setAttribute("aria-hidden","true"),setTimeout(()=>{this._isVisible=!1,this.updateButtons(this._foundMatch),this._innerDomNode.classList.remove("visible","suppress-transition")},e?200:0))}layout(e=this._width){if(this._width=e,!!this._isVisible&&this._matchesCount){let t=!1;qr+bT+28>=e&&(t=!0),this._innerDomNode.classList.toggle("reduced-find-widget",t)}}_delayedUpdateHistory(){this._updateHistoryDelayer.trigger(this._updateHistory.bind(this))}_updateHistory(){this._findInput.inputBox.addToHistory()}_getRegexValue(){return this._findInput.getRegex()}_getWholeWordValue(){return this._findInput.getWholeWords()}_getCaseSensitiveValue(){return this._findInput.getCaseSensitive()}updateButtons(e){const t=this.inputValue.length>0;this.prevBtn.setEnabled(this._isVisible&&t&&e),this.nextBtn.setEnabled(this._isVisible&&t&&e)}focusFindBox(){this.nextBtn.focus(),this._findInput.inputBox.focus()}async updateResultCount(){if(!this._matchesCount){this.updateButtons(this._foundMatch);return}const e=await this._getResultCount();this._matchesCount.innerText="";const t=this.inputValue.length>0&&e?.resultCount===0;this._matchesCount.classList.toggle("no-results",t);let i="";if(e?.resultCount){let s=String(e.resultCount);e.resultCount>=this._matchesLimit&&(s+="+");let o=String(e.resultIndex+1);o==="0"&&(o="?"),i=vn(i_,o,s)}else i=Xp;Qv(this._announceSearchResults(i,this.inputValue)),this._matchesCount.appendChild(document.createTextNode(i)),this._foundMatch=!!e&&e.resultCount>0,this.updateButtons(this._foundMatch)}changeState(e){this.state.change(e,!1)}_announceSearchResults(e,t){return t?e===Xp?t===""?c(5150,"{0} found",e):c(5151,"{0} found for '{1}'",e,t):c(5152,"{0} found for '{1}'",e,t):c(5149,"Enter search input")}}const ST=le("simpleFindWidget.sashBorder",{dark:"#454545",light:"#C8C8C8",hcDark:"#6FC3DF",hcLight:"#0F4A85"},c(5153,"Border color of the sash border."));xf((a,e)=>{const t=a.getColor(ST);e.addRule(`.monaco-workbench .simple-find-part .monaco-sash { background-color: ${t}; border-color: ${t} }`)});let zl=class extends CT{async _getResultCount(e){}constructor(e,t,i,s,o){super({showCommonFindToggles:!1,checkImeCompletionState:e.checkImeCompletionState,enableSash:!0},t,i,s,o),this._delegate=e,this._findWidgetFocused=ku.bindTo(i),this._register(e.hasFindResult(n=>{this.updateButtons(n),this.focusFindBox()})),this._register(e.onDidStopFind(()=>{this.updateButtons(!1)}))}find(e){const t=this.inputValue;t&&this._delegate.find(t,e)}hide(e=!0){super.hide(e),this._delegate.stopFind(!0),this._delegate.focus()}_onInputChanged(){const e=this.inputValue;return e?this._delegate.updateFind(e):this._delegate.stopFind(!1),!1}_onFocusTrackerFocus(){this._findWidgetFocused.set(!0)}_onFocusTrackerBlur(){this._findWidgetFocused.reset()}_onFindInputFocusTrackerFocus(){}_onFindInputFocusTrackerBlur(){}findFirst(){}};zl=D([u(1,Xo),u(2,se),u(3,At),u(4,it)],zl);var Ks;(function(a){let e;(function(i){i[i.Initializing=0]="Initializing",i[i.Ready=1]="Ready"})(e=a.Type||(a.Type={}));class t{constructor(s){this.pendingMessages=s,this.type=e.Initializing}}a.Initializing=t,a.Ready={type:e.Ready}})(Ks||(Ks={}));const _T="webviewId";let $l=class extends R{get window(){return typeof this._windowId=="number"?yd(this._windowId)?.window:void 0}get platform(){return"browser"}get element(){return this._element}get isFocused(){return!(!this._focused||!this.window||this.window.document.activeElement&&this.window.document.activeElement!==this.element)}constructor(e,t,i,s,o,n,r,d,l,h,p,f){super(),this.webviewThemeDataProvider=t,this._environmentService=n,this._fileService=r,this._logService=d,this._remoteAuthorityResolverService=l,this._tunnelService=h,this._accessibilityService=f,this.id=Yo(),this._windowId=void 0,this._expectedServiceWorkerVersion=4,this._state=new Ks.Initializing([]),this._resourceLoadingCts=this._register(new Ts),this._focusDelayer=this._register(new eb(50)),this._onDidHtmlChange=this._register(new E),this.onDidHtmlChange=this._onDidHtmlChange.event,this._messageHandlers=new Map,this.checkImeCompletionState=!0,this._disposed=!1,this._onMissingCsp=this._register(new E),this.onMissingCsp=this._onMissingCsp.event,this._onDidClickLink=this._register(new E),this.onDidClickLink=this._onDidClickLink.event,this._onDidReload=this._register(new E),this.onDidReload=this._onDidReload.event,this._onMessage=this._register(new E),this.onMessage=this._onMessage.event,this._onDidScroll=this._register(new E),this.onDidScroll=this._onDidScroll.event,this._onDidWheel=this._register(new E),this.onDidWheel=this._onDidWheel.event,this._onDidUpdateState=this._register(new E),this.onDidUpdateState=this._onDidUpdateState.event,this._onDidFocus=this._register(new E),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new E),this.onDidBlur=this._onDidBlur.event,this._onFatalError=this._register(new E),this.onFatalError=this._onFatalError.event,this._onDidDispose=this._register(new E),this.onDidDispose=this._onDidDispose.event,this._hasAlertedAboutMissingCsp=!1,this._hasFindResult=this._register(new E),this.hasFindResult=this._hasFindResult.event,this._onDidStopFind=this._register(new E),this.onDidStopFind=this._onDidStopFind.event,this.providedViewType=e.providedViewType,this.origin=e.origin??this.id,this._options=e.options,this.extension=e.extension,this._content={html:"",title:e.title,options:e.contentOptions,state:void 0},this._portMappingManager=this._register(new aT(()=>this.extension?.location,()=>this._content.options.portMapping||[],this._tunnelService)),this._element=this._createElement(e.options,e.contentOptions),this._register(this.on("no-csp-found",()=>{this.handleNoCspFound()})),this._register(this.on("did-click-link",({uri:g})=>{this._onDidClickLink.fire(g)})),this._register(this.on("onmessage",({message:g,transfer:m})=>{this._onMessage.fire({message:g,transfer:m})})),this._register(this.on("did-scroll",({scrollYPercentage:g})=>{this._onDidScroll.fire({scrollYPercentage:g})})),this._register(this.on("do-reload",()=>{this.reload()})),this._register(this.on("do-update-state",g=>{this.state=g,this._onDidUpdateState.fire(g)})),this._register(this.on("did-focus",()=>{this.handleFocusChange(!0)})),this._register(this.on("did-blur",()=>{this.handleFocusChange(!1)})),this._register(this.on("did-scroll-wheel",g=>{this._onDidWheel.fire(g)})),this._register(this.on("did-find",({didFind:g})=>{this._hasFindResult.fire(g)})),this._register(this.on("fatal-error",g=>{o.error(c(11474,"Error loading webview: {0}",g.message)),this._onFatalError.fire({message:g.message})})),this._register(this.on("did-keydown",g=>{this.handleKeyEvent("keydown",g)})),this._register(this.on("did-keyup",g=>{this.handleKeyEvent("keyup",g)})),this._register(this.on("did-context-menu",g=>{if(!this.element||!this._contextKeyService)return;const m=this.element.getBoundingClientRect(),v=this._contextKeyService.createOverlay([...Object.entries(g.context),[_T,this.providedViewType]]);s.showContextMenu({menuId:w.WebviewContext,menuActionOptions:{shouldForwardArgs:!0},contextKeyService:v,getActionsContext:()=>({...g.context,webview:this.providedViewType}),getAnchor:()=>({x:m.x+g.clientX,y:m.y+g.clientY})}),this._send("set-context-menu-visible",{visible:!0})})),this._register(this.on("load-resource",async g=>{try{const m=nA(g.authority),v=U.from({scheme:g.scheme,authority:m,path:decodeURIComponent(g.path),query:g.query?decodeURIComponent(g.query):g.query});this.loadResource(g.id,v,g.ifNoneMatch)}catch{this._send("did-load-resource",{id:g.id,status:404,path:g.path})}})),this._register(this.on("load-localhost",g=>{this.localLocalhost(g.id,g.origin)})),this._register(V.runAndSubscribe(t.onThemeDataChanged,()=>this.style())),this._register(f.onDidChangeReducedMotion(()=>this.style())),this._register(f.onDidChangeScreenReaderOptimized(()=>this.style())),this._register(s.onDidHideContextMenu(()=>this._send("set-context-menu-visible",{visible:!1}))),this._confirmBeforeClose=i.getValue("window.confirmBeforeClose"),this._register(i.onDidChangeConfiguration(g=>{g.affectsConfiguration("window.confirmBeforeClose")&&(this._confirmBeforeClose=i.getValue("window.confirmBeforeClose"),this._send("set-confirm-before-close",this._confirmBeforeClose))})),this._register(this.on("drag-start",()=>{this._startBlockingIframeDragEvents()})),this._register(this.on("drag",g=>{this.handleDragEvent("drag",g)})),e.options.enableFindWidget&&(this._webviewFindWidget=this._register(p.createInstance(zl,this)))}dispose(){if(this._disposed=!0,this.element?.remove(),this._element=void 0,this._messagePort=void 0,this._state.type===Ks.Type.Initializing){for(const e of this._state.pendingMessages)e.resolve(!1);this._state.pendingMessages=[]}this._onDidDispose.fire(),this._resourceLoadingCts.dispose(!0),super.dispose()}setContextKeyService(e){this._contextKeyService=e}postMessage(e,t){return this._send("message",{message:e,transfer:t})}async _send(e,t,i=[]){if(this._state.type===Ks.Type.Initializing){const{promise:s,resolve:o}=kf();return this._state.pendingMessages.push({channel:e,data:t,transferable:i,resolve:o}),s}else return this.doPostMessage(e,t,i)}_createElement(e,t){const i=document.createElement("iframe");i.name=this.id,i.className=`webview ${e.customClasses||""}`,i.sandbox.add("allow-scripts","allow-same-origin","allow-forms","allow-pointer-lock","allow-downloads");const s=["cross-origin-isolated","autoplay"];return Sp||s.push("clipboard-read","clipboard-write"),i.setAttribute("allow",s.join("; ")),i.style.border="none",i.style.width="100%",i.style.height="100%",i.focus=()=>{this._doFocus()},i}_initElement(e,t,i,s){const o={id:this.id,parentId:s.vscodeWindowId.toString(),origin:this.origin,swVersion:String(this._expectedServiceWorkerVersion),extensionId:t?.id.value??"",platform:this.platform,"vscode-resource-base-authority":rA,parentOrigin:s.origin};this._options.disableServiceWorker&&(o.disableServiceWorker="true"),this._environmentService.remoteAuthority&&(o.remoteAuthority=this._environmentService.remoteAuthority),i.purpose&&(o.purpose=i.purpose),o.serviceWorkerUri=kn.asBrowserUri("vs/workbench/contrib/webview/browser/pre/service-worker.js").toString(!0),o.fakeHtmlUri=kn.asBrowserUri("vs/workbench/contrib/webview/browser/pre/fake.html").toString(!0),tb.addSearchParam(o,!0,!0);const n=new URLSearchParams(o).toString(),r=Sp?"index-no-csp.html":"index.html",d=kn.asBrowserUri(`vs/workbench/contrib/webview/browser/pre/${r}`);this.element.setAttribute("src",`${d.toString(!0)}?${n}`)}mountTo(e,t){if(this.element){this._windowId=t.vscodeWindowId,this._encodedWebviewOriginPromise=ib(t.origin,this.origin).then(i=>this._encodedWebviewOrigin=i),this._encodedWebviewOriginPromise.then(i=>{this._disposed||this._initElement(i,this.extension,this._options,t)}),this._registerMessageHandler(t),this._webviewFindWidget&&e.appendChild(this._webviewFindWidget.getDomNode());for(const i of[te.MOUSE_DOWN,te.MOUSE_MOVE,te.DROP])this._register(Y(e,i,()=>{this._stopBlockingIframeDragEvents()}));for(const i of[e,t])this._register(Y(i,te.DRAG_END,()=>{this._stopBlockingIframeDragEvents()}));e.id=this.id,e.appendChild(this.element)}}_registerMessageHandler(e){const t=this._register(Y(e,"message",i=>{if(!(!this._encodedWebviewOrigin||i?.data?.target!==this.id)&&i.data.channel==="webview-ready"){if(this._messagePort)return;this._logService.debug(`Webview(${this.id}): webview ready`),this._messagePort=i.ports[0],this._messagePort.onmessage=s=>{const o=this._messageHandlers.get(s.data.channel);if(!o){console.log(`No handlers found for '${s.data.channel}'`);return}o?.forEach(n=>n(s.data.data,s))},this.element?.classList.add("ready"),this._state.type===Ks.Type.Initializing&&this._state.pendingMessages.forEach(({channel:s,data:o,resolve:n})=>n(this.doPostMessage(s,o))),this._state=Ks.Ready,t.dispose()}}))}_startBlockingIframeDragEvents(){this.element&&(this.element.style.pointerEvents="none")}_stopBlockingIframeDragEvents(){this.element&&(this.element.style.pointerEvents="auto")}webviewContentEndpoint(e){const t=this._environmentService.webviewExternalEndpoint;if(!t)throw new Error("'webviewExternalEndpoint' has not been configured. Webviews will not work!");const i=t.replace("{{uuid}}",e);return i[i.length-1]==="/"?i.slice(0,i.length-1):i}doPostMessage(e,t,i=[]){return this.element&&this._messagePort?(this._messagePort.postMessage({channel:e,args:t},i),!0):!1}on(e,t){let i=this._messageHandlers.get(e);return i||(i=new Set,this._messageHandlers.set(e,i)),i.add(t),ae(()=>{this._messageHandlers.get(e)?.delete(t)})}handleNoCspFound(){this._hasAlertedAboutMissingCsp||(this._hasAlertedAboutMissingCsp=!0,this.extension?.id&&this._environmentService.isExtensionDevelopment&&this._onMissingCsp.fire(this.extension.id))}reload(){this.doUpdateContent(this._content);const e=this._register(this.on("did-load",()=>{this._onDidReload.fire(),e.dispose()}))}setHtml(e){this.doUpdateContent({...this._content,html:e}),this._onDidHtmlChange.fire(e)}setTitle(e){this._content={...this._content,title:e},this._send("set-title",e)}set contentOptions(e){if(this._logService.debug(`Webview(${this.id}): will update content options`),s_(e,this._content.options)){this._logService.debug(`Webview(${this.id}): skipping content options update`);return}this.doUpdateContent({...this._content,options:e})}set localResourcesRoot(e){this._content={...this._content,options:{...this._content.options,localResourceRoots:e}}}set state(e){this._content={...this._content,state:e}}set initialScrollProgress(e){this._send("initial-scroll-position",e)}doUpdateContent(e){this._logService.debug(`Webview(${this.id}): will update content`),this._content=e;const t=!!this._content.options.allowScripts;this._send("content",{contents:this._content.html,title:this._content.title,options:{allowMultipleAPIAcquire:!!this._content.options.allowMultipleAPIAcquire,allowScripts:t,allowForms:this._content.options.allowForms??t},state:this._content.state,cspSource:aA,confirmBeforeClose:this._confirmBeforeClose})}style(){let{styles:e,activeTheme:t,themeLabel:i,themeId:s}=this.webviewThemeDataProvider.getWebviewThemeData();this._options.transformCssVariables&&(e=this._options.transformCssVariables(e));const o=this._accessibilityService.isMotionReduced(),n=this._accessibilityService.isScreenReaderOptimized();this._send("styles",{styles:e,activeTheme:t,themeId:s,themeLabel:i,reduceMotion:o,screenReader:n})}handleFocusChange(e){this._focused=e,e?this._onDidFocus.fire():this._onDidBlur.fire()}handleKeyEvent(e,t){const i=new KeyboardEvent(e,t);Object.defineProperty(i,"target",{get:()=>this.element}),this.window?.dispatchEvent(i)}handleDragEvent(e,t){const i=new DragEvent(e,t);Object.defineProperty(i,"target",{get:()=>this.element}),this.window?.dispatchEvent(i)}windowDidDragStart(){this._startBlockingIframeDragEvents()}windowDidDragEnd(){this._stopBlockingIframeDragEvents()}selectAll(){this.execCommand("selectAll")}copy(){this.execCommand("copy")}paste(){this.execCommand("paste")}cut(){this.execCommand("cut")}undo(){this.execCommand("undo")}redo(){this.execCommand("redo")}execCommand(e){this.element&&this._send("execCommand",e)}async loadResource(e,t,i){try{const s=await lT(t,{ifNoneMatch:i,roots:this._content.options.localResourceRoots||[]},this._fileService,this._logService,this._resourceLoadingCts.token);switch(s.type){case Xi.Type.Success:{const o=await this.streamToBuffer(s.stream);return this._send("did-load-resource",{id:e,status:200,path:t.path,mime:s.mimeType,data:o,etag:s.etag,mtime:s.mtime},[o])}case Xi.Type.NotModified:return this._send("did-load-resource",{id:e,status:304,path:t.path,mime:s.mimeType,mtime:s.mtime});case Xi.Type.AccessDenied:return this._send("did-load-resource",{id:e,status:401,path:t.path})}}catch{}return this._send("did-load-resource",{id:e,status:404,path:t.path})}async streamToBuffer(e){return(await sb(e)).buffer.buffer}async localLocalhost(e,t){const i=this._environmentService.remoteAuthority,s=i?await this._remoteAuthorityResolverService.resolveAuthority(i):void 0,o=s?await this._portMappingManager.getRedirect(s.authority,t):void 0;return this._send("did-load-localhost",{id:e,origin:t,location:o})}focus(){this._doFocus(),this.handleFocusChange(!0)}_doFocus(){if(this.element){try{this.element.contentWindow?.focus()}catch{}this._focusDelayer.trigger(async()=>{!this.isFocused||!this.element||this.window?.document.activeElement&&this.window.document.activeElement!==this.element&&this.window.document.activeElement?.tagName!=="BODY"||(this.window?.document.body?.focus(),this._send("focus",void 0))})}}find(e,t){this.element&&this._send("find",{value:e,previous:t})}updateFind(e){!e||!this.element||this._send("find",{value:e})}stopFind(e){this.element&&(this._send("find-stop",{clearSelection:!e}),this._onDidStopFind.fire())}showFind(e=!0){this._webviewFindWidget?.reveal(void 0,e)}hideFind(e=!0){this._webviewFindWidget?.hide(e)}runFindAction(e){this._webviewFindWidget?.find(e)}};$l=D([u(2,ie),u(3,at),u(4,Ke),u(5,ni),u(6,Le),u(7,Ue),u(8,o_),u(9,Yt),u(10,F),u(11,ob)],$l);let jl=class extends R{get window(){return yd(this._windowId,!0).window}constructor(e,t,i,s){super(),this._layoutService=t,this._webviewService=i,this._baseContextKeyService=s,this._isFirstLoad=!0,this._firstLoadPendingMessages=new Set,this._webview=this._register(new Ie),this._webviewEvents=this._register(new O),this._html="",this._initialScrollProgress=0,this._state=void 0,this._owner=void 0,this._windowId=void 0,this._scopedContextKeyService=this._register(new Ie),this._shouldShowFindWidgetOnRestore=!1,this._isDisposed=!1,this._onDidDispose=this._register(new E),this.onDidDispose=this._onDidDispose.event,this._onDidFocus=this._register(new E),this.onDidFocus=this._onDidFocus.event,this._onDidBlur=this._register(new E),this.onDidBlur=this._onDidBlur.event,this._onDidClickLink=this._register(new E),this.onDidClickLink=this._onDidClickLink.event,this._onDidReload=this._register(new E),this.onDidReload=this._onDidReload.event,this._onDidScroll=this._register(new E),this.onDidScroll=this._onDidScroll.event,this._onDidUpdateState=this._register(new E),this.onDidUpdateState=this._onDidUpdateState.event,this._onMessage=this._register(new E),this.onMessage=this._onMessage.event,this._onMissingCsp=this._register(new E),this.onMissingCsp=this._onMissingCsp.event,this._onDidWheel=this._register(new E),this.onDidWheel=this._onDidWheel.event,this._onFatalError=this._register(new E),this.onFatalError=this._onFatalError.event,this.providedViewType=e.providedViewType,this.origin=e.origin??Yo(),this._title=e.title,this._extension=e.extension,this._options=e.options,this._contentOptions=e.contentOptions}get isFocused(){return!!this._webview.value?.isFocused}dispose(){this._isDisposed=!0,this._container?.domNode.remove(),this._container=void 0;for(const e of this._firstLoadPendingMessages)e.resolve(!1);this._firstLoadPendingMessages.clear(),this._onDidDispose.fire(),super.dispose()}get container(){if(this._isDisposed)throw new Error("OverlayWebview has been disposed");if(!this._container){const e=document.createElement("div");e.style.position="absolute",e.style.overflow="hidden",this._container=new nb(e),this._container.setVisibility("hidden"),this._layoutService.getContainer(this.window).appendChild(e)}return this._container.domNode}claim(e,t,i){if(this._isDisposed)return;const s=this._owner;if(this._windowId!==t.vscodeWindowId&&(this.release(s),this._webview.clear(),this._webviewEvents.clear(),this._container?.domNode.remove(),this._container=void 0),this._owner=e,this._windowId=t.vscodeWindowId,this._show(t),s!==e){const o=i||this._baseContextKeyService;this._scopedContextKeyService.clear(),this._scopedContextKeyService.value=o.createScoped(this.container);const n=this._findWidgetVisible?.get();this._findWidgetVisible?.reset(),this._findWidgetVisible=xm.bindTo(o),this._findWidgetVisible.set(!!n),this._findWidgetEnabled?.reset(),this._findWidgetEnabled=km.bindTo(o),this._findWidgetEnabled.set(!!this.options.enableFindWidget),this._webview.value?.setContextKeyService(this._scopedContextKeyService.value)}}release(e){this._owner===e&&(this._scopedContextKeyService.clear(),this._owner=void 0,this._container&&this._container.setVisibility("hidden"),this._options.retainContextWhenHidden?(this._shouldShowFindWidgetOnRestore=!!this._findWidgetVisible?.get(),this.hideFind(!1)):(this._webview.clear(),this._webviewEvents.clear()))}layoutWebviewOverElement(e,t,i){if(!this._container||!this._container.domNode.parentElement)return;const s=this._layoutService.whenContainerStylesLoaded(this.window);s?s.then(()=>this.doLayoutWebviewOverElement(e,t,i)):this.doLayoutWebviewOverElement(e,t,i)}doLayoutWebviewOverElement(e,t,i){if(!this._container||!this._container.domNode.parentElement)return;const s=e.getBoundingClientRect(),o=this._container.domNode.parentElement.getBoundingClientRect(),n=(o.height-this._container.domNode.parentElement.clientHeight)/2,r=(o.width-this._container.domNode.parentElement.clientWidth)/2;if(this._container.setTop(s.top-o.top-n),this._container.setLeft(s.left-o.left-r),this._container.setWidth(t?t.width:s.width),this._container.setHeight(t?t.height:s.height),i){const{top:d,left:l,right:h,bottom:p}=ET(s,i);this._container.domNode.style.clipPath=`polygon(${l}px ${d}px, ${h}px ${d}px, ${h}px ${p}px, ${l}px ${p}px)`}}_show(e){if(this._isDisposed)throw new Error("OverlayWebview is disposed");if(!this._webview.value){const t=this._webviewService.createWebviewElement({providedViewType:this.providedViewType,origin:this.origin,title:this._title,options:this._options,contentOptions:this._contentOptions,extension:this.extension});this._webview.value=t,t.state=this._state,this._scopedContextKeyService.value&&this._webview.value.setContextKeyService(this._scopedContextKeyService.value),this._html&&t.setHtml(this._html),this._options.tryRestoreScrollPosition&&(t.initialScrollProgress=this._initialScrollProgress),this._findWidgetEnabled?.set(!!this.options.enableFindWidget),t.mountTo(this.container,e),this._webviewEvents.clear(),this._webviewEvents.add(t.onDidFocus(()=>{this._onDidFocus.fire()})),this._webviewEvents.add(t.onDidBlur(()=>{this._onDidBlur.fire()})),this._webviewEvents.add(t.onDidClickLink(i=>{this._onDidClickLink.fire(i)})),this._webviewEvents.add(t.onMessage(i=>{this._onMessage.fire(i)})),this._webviewEvents.add(t.onMissingCsp(i=>{this._onMissingCsp.fire(i)})),this._webviewEvents.add(t.onDidWheel(i=>{this._onDidWheel.fire(i)})),this._webviewEvents.add(t.onDidReload(()=>{this._onDidReload.fire()})),this._webviewEvents.add(t.onFatalError(i=>{this._onFatalError.fire(i)})),this._webviewEvents.add(t.onDidScroll(i=>{this._initialScrollProgress=i.scrollYPercentage,this._onDidScroll.fire(i)})),this._webviewEvents.add(t.onDidUpdateState(i=>{this._state=i,this._onDidUpdateState.fire(i)})),this._isFirstLoad&&this._firstLoadPendingMessages.forEach(async i=>{i.resolve(await t.postMessage(i.message,i.transfer))}),this._isFirstLoad=!1,this._firstLoadPendingMessages.clear()}this.options.retainContextWhenHidden&&this._shouldShowFindWidgetOnRestore&&(this.showFind(!1),this._shouldShowFindWidgetOnRestore=!1),this._container?.setVisibility("visible")}setHtml(e){this._html=e,this._withWebview(t=>t.setHtml(e))}setTitle(e){this._title=e,this._withWebview(t=>t.setTitle(e))}get initialScrollProgress(){return this._initialScrollProgress}set initialScrollProgress(e){this._initialScrollProgress=e,this._withWebview(t=>t.initialScrollProgress=e)}get state(){return this._state}set state(e){this._state=e,this._withWebview(t=>t.state=e)}get extension(){return this._extension}set extension(e){this._extension=e,this._withWebview(t=>t.extension=e)}get options(){return this._options}set options(e){this._options={customClasses:this._options.customClasses,...e}}get contentOptions(){return this._contentOptions}set contentOptions(e){this._contentOptions=e,this._withWebview(t=>t.contentOptions=e)}set localResourcesRoot(e){this._withWebview(t=>t.localResourcesRoot=e)}async postMessage(e,t){if(this._webview.value)return this._webview.value.postMessage(e,t);if(this._isFirstLoad){let i;const s=new Promise(o=>i=o);return this._firstLoadPendingMessages.add({message:e,transfer:t,resolve:i}),s}return!1}focus(){this._webview.value?.focus()}reload(){this._webview.value?.reload()}selectAll(){this._webview.value?.selectAll()}copy(){this._webview.value?.copy()}paste(){this._webview.value?.paste()}cut(){this._webview.value?.cut()}undo(){this._webview.value?.undo()}redo(){this._webview.value?.redo()}showFind(e=!0){this._webview.value&&(this._webview.value.showFind(e),this._findWidgetVisible?.set(!0))}hideFind(e=!0){this._findWidgetVisible?.reset(),this._webview.value?.hideFind(e)}runFindAction(e){this._webview.value?.runFindAction(e)}_withWebview(e){this._webview.value&&e(this._webview.value)}windowDidDragStart(){this._webview.value?.windowDidDragStart()}windowDidDragEnd(){this._webview.value?.windowDidDragEnd()}setContextKeyService(e){this._webview.value?.setContextKeyService(e)}};jl=D([u(1,ze),u(2,lo),u(3,se)],jl);function ET(a,e){const t=e.getBoundingClientRect(),i=Math.max(t.top-a.top,0),s=Math.max(a.width-(a.right-t.right),0),o=Math.max(a.height-(a.bottom-t.bottom),0),n=Math.max(t.left-a.left,0);return{top:i,right:s,bottom:o,left:n}}let ql=class extends R{constructor(e){super(),this._instantiationService=e,this._webviews=new Set,this._onDidChangeActiveWebview=this._register(new E),this.onDidChangeActiveWebview=this._onDidChangeActiveWebview.event,this._webviewThemeDataProvider=this._instantiationService.createInstance(Hl)}get activeWebview(){return this._activeWebview}_updateActiveWebview(e){e!==this._activeWebview&&(this._activeWebview=e,this._onDidChangeActiveWebview.fire(e))}get webviews(){return this._webviews.values()}createWebviewElement(e){const t=this._instantiationService.createInstance($l,e,this._webviewThemeDataProvider);return this.registerNewWebview(t),t}createWebviewOverlay(e){const t=this._instantiationService.createInstance(jl,e);return this.registerNewWebview(t),t}registerNewWebview(e){this._webviews.add(e);const t=new O;t.add(e.onDidFocus(()=>{this._updateActiveWebview(e)}));const i=()=>{this._activeWebview===e&&this._updateActiveWebview(void 0)};t.add(e.onDidBlur(i)),t.add(e.onDidDispose(()=>{i(),t.dispose(),this._webviews.delete(e)}))}};ql=D([u(0,F)],ql);class IT extends R{constructor(){super(...arguments),this._resolvers=new Map,this._awaitingRevival=new Map,this._onNewResolverRegistered=this._register(new E),this.onNewResolverRegistered=this._onNewResolverRegistered.event}register(e,t){if(this._resolvers.has(e))throw new Error(`View resolver already registered for ${e}`);this._resolvers.set(e,t),this._onNewResolverRegistered.fire({viewType:e});const i=this._awaitingRevival.get(e);return i&&t.resolve(i.webview,wi.None).then(()=>{this._awaitingRevival.delete(e),i.resolve()}),ae(()=>{this._resolvers.delete(e)})}resolve(e,t,i){const s=this._resolvers.get(e);if(!s){if(this._awaitingRevival.has(e))throw new Error("View already awaiting revival");const{promise:o,resolve:n}=kf();return this._awaitingRevival.set(e,{webview:t,resolve:n}),o}return s.resolve(t,i)}}const DT=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),AT=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Pe(AT);class TT extends R{constructor(e,t,i,s){super(),this.container=e,this.message=t,this.options=s,this.modalElement=this.container.appendChild(B(".monaco-dialog-modal-block.dimmed")),this.shadowElement=this.modalElement.appendChild(B(".dialog-shadow")),this.element=this.shadowElement.appendChild(B(".monaco-dialog-box")),this.element.setAttribute("role","dialog"),this.element.tabIndex=-1,qn(this.element),this.buttonStyles=s.buttonStyles,Array.isArray(i)&&i.length>0?this.buttons=i:this.options.disableDefaultAction?this.buttons=[]:this.buttons=[c(3,"OK")];const o=this.element.appendChild(B(".dialog-buttons-row"));this.buttonsContainer=o.appendChild(B(".dialog-buttons"));const n=this.element.appendChild(B(".dialog-message-row"));if(this.iconElement=n.appendChild(B("#monaco-dialog-icon.dialog-icon")),this.iconElement.setAttribute("aria-label",this.getIconAriaLabel()),this.messageContainer=n.appendChild(B(".dialog-message-container")),this.options.detail||this.options.renderBody){const l=this.messageContainer.appendChild(B(".dialog-message")).appendChild(B("#monaco-dialog-message-text.dialog-message-text"));l.innerText=this.message}if(this.messageDetailElement=this.messageContainer.appendChild(B("#monaco-dialog-message-detail.dialog-message-detail")),this.options.detail||!this.options.renderBody?this.messageDetailElement.innerText=this.options.detail?this.options.detail:t:this.messageDetailElement.style.display="none",this.options.renderBody){const d=this.messageContainer.appendChild(B("#monaco-dialog-message-body.dialog-message-body"));this.options.renderBody(d);for(const l of this.messageContainer.querySelectorAll("a"))l.tabIndex=0}if(this.options.inputs?this.inputs=this.options.inputs.map(d=>{const l=this.messageContainer.appendChild(B(".dialog-message-input")),h=this._register(new Rf(l,void 0,{placeholder:d.placeholder,type:d.type??"text",inputBoxStyles:s.inputBoxStyles}));return d.value&&(h.value=d.value),h}):this.inputs=[],this.options.checkboxLabel){const d=this.messageContainer.appendChild(B(".dialog-checkbox-row")),l=this.checkbox=this._register(new rb(this.options.checkboxLabel,!!this.options.checkboxChecked,s.checkboxStyles));d.appendChild(l.domNode);const h=d.appendChild(B(".dialog-checkbox-message"));h.innerText=this.options.checkboxLabel,this._register(Y(h,te.CLICK,()=>l.checked=!l.checked))}const r=this.element.appendChild(B(".dialog-toolbar-row"));this.toolbarContainer=r.appendChild(B(".dialog-toolbar")),this.applyStyles()}getIconAriaLabel(){let e=c(4,"Info");switch(this.options.type){case"error":e=c(5,"Error");break;case"warning":e=c(6,"Warning");break;case"pending":e=c(7,"In Progress");break}return e}updateMessage(e){this.messageDetailElement.innerText=e}async show(){return this.focusToReturn=this.container.ownerDocument.activeElement,new Promise(e=>{ji(this.buttonsContainer);const t=()=>{e({button:this.options.cancelId||0,checkboxChecked:this.checkbox?this.checkbox.checked:void 0})};this._register(ae(t));const i=this.buttonBar=this._register(new Lf(this.buttonsContainer)),s=this.rearrangeButtons(this.buttons,this.options.cancelId),o=d=>{e({button:s[d].index,checkboxChecked:this.checkbox?this.checkbox.checked:void 0,values:this.inputs.length>0?this.inputs.map(l=>l.value):void 0})};s.forEach((d,l)=>{const h=s[l].index===0;let p;if(h&&this.options?.primaryButtonDropdown){const f=ab(this.options.primaryButtonDropdown.actions)?this.options.primaryButtonDropdown.actions.getActions():this.options.primaryButtonDropdown.actions;p=this._register(i.addButtonWithDropdown({...this.options.primaryButtonDropdown,...this.buttonStyles,dropdownLayer:2600,actions:f.map(g=>es({...g,run:async()=>{await g.run(),o(l)}}))}))}else this.options.buttonDetails?p=this._register(i.addButtonWithDescription({secondary:!h,...this.buttonStyles})):p=this._register(i.addButton({secondary:!h,...this.buttonStyles}));p.label=db(s[l].label,!0),p instanceof cb&&(p.description=this.options.buttonDetails[s[l].index]),this._register(p.onDidClick(f=>{f&&ke.stop(f),o(l)}))});const n=St(this.container);this._register(Y(n,"keydown",d=>{const l=new Fo(d);if(l.equals(N.Alt)&&l.preventDefault(),l.equals(y.Enter)){this.inputs.some(p=>p.hasFocus())&&(ke.stop(d),e({button:s.find(p=>p.index!==this.options.cancelId)?.index??0,checkboxChecked:this.checkbox?this.checkbox.checked:void 0,values:this.inputs.length>0?this.inputs.map(p=>p.value):void 0}));return}if(ut&&l.equals(N.CtrlCmd|y.KeyD)){ke.stop(d);const p=s.find(f=>f.index===1&&f.index!==this.options.cancelId);p&&e({button:p.index,checkboxChecked:this.checkbox?this.checkbox.checked:void 0,values:this.inputs.length>0?this.inputs.map(f=>f.value):void 0});return}if(l.equals(y.Space))return;let h=!1;if(l.equals(y.Tab)||l.equals(y.RightArrow)||l.equals(N.Shift|y.Tab)||l.equals(y.LeftArrow)){const p=[];let f=-1;if(this.messageContainer){const g=this.messageContainer.querySelectorAll("a");for(const m of g)p.push(m),Vf(m)&&(f=p.length-1)}for(const g of this.inputs)p.push(g),g.hasFocus()&&(f=p.length-1);if(this.checkbox&&(p.push(this.checkbox),this.checkbox.hasFocus()&&(f=p.length-1)),this.buttonBar)for(const g of this.buttonBar.buttons)g instanceof lb?(p.push(g.primaryButton),g.primaryButton.hasFocus()&&(f=p.length-1),p.push(g.dropdownButton),g.dropdownButton.hasFocus()&&(f=p.length-1)):(p.push(g),g.hasFocus()&&(f=p.length-1));if(l.equals(y.Tab)||l.equals(y.RightArrow)){const g=(f+1)%p.length;p[g].focus()}else{f===-1&&(f=p.length);let g=f-1;g===-1&&(g=p.length-1),p[g].focus()}h=!0}h?ke.stop(d,!0):this.options.keyEventProcessor&&this.options.keyEventProcessor(l)},!0)),this._register(Y(n,"keyup",d=>{ke.stop(d,!0);const l=new Fo(d);!this.options.disableCloseAction&&l.equals(y.Escape)&&t()},!0)),this._register(Y(this.element,"focusout",d=>{d.relatedTarget&&this.element&&(Vc(d.relatedTarget,this.element)||(this.focusToReturn=d.relatedTarget,d.target&&(d.target.focus(),ke.stop(d,!0))))},!1));const r="codicon-modifier-spin";if(this.iconElement.classList.remove(...Ce.asClassNameArray(k.dialogError),...Ce.asClassNameArray(k.dialogWarning),...Ce.asClassNameArray(k.dialogInfo),...Ce.asClassNameArray(k.loading),r),this.options.icon)this.iconElement.classList.add(...Ce.asClassNameArray(this.options.icon));else switch(this.options.type){case"error":this.iconElement.classList.add(...Ce.asClassNameArray(k.dialogError));break;case"warning":this.iconElement.classList.add(...Ce.asClassNameArray(k.dialogWarning));break;case"pending":this.iconElement.classList.add(...Ce.asClassNameArray(k.loading),r);break;case"none":this.iconElement.classList.add("no-codicon");break;case"info":case"question":default:this.iconElement.classList.add(...Ce.asClassNameArray(k.dialogInfo));break}if(!this.options.disableCloseAction){const d=this._register(new Qo(this.toolbarContainer,{})),l=this._register(new _t("dialog.close",c(8,"Close Dialog"),Ce.asClassName(k.dialogClose),!0,async()=>{e({button:this.options.cancelId||0,checkboxChecked:this.checkbox?this.checkbox.checked:void 0})}));d.push(l,{icon:!0,label:!1})}this.applyStyles(),this.element.setAttribute("aria-modal","true"),this.element.setAttribute("aria-labelledby","monaco-dialog-icon monaco-dialog-message-text"),this.element.setAttribute("aria-describedby","monaco-dialog-icon monaco-dialog-message-text monaco-dialog-message-detail monaco-dialog-message-body"),jn(this.element),this.inputs.length>0?(this.inputs[0].focus(),this.inputs[0].select()):s.forEach((d,l)=>{d.index===0&&i.buttons[l].focus()})})}applyStyles(){const e=this.options.dialogStyles,t=e.dialogForeground,i=e.dialogBackground,s=e.dialogShadow?`0 0px 8px ${e.dialogShadow}`:"",o=e.dialogBorder?`1px solid ${e.dialogBorder}`:"",n=e.textLinkForeground;if(this.shadowElement.style.boxShadow=s,this.element.style.color=t??"",this.element.style.backgroundColor=i??"",this.element.style.border=o,n)for(const d of this.messageContainer.getElementsByTagName("a"))d.style.color=n;let r;switch(this.options.type){case"none":break;case"error":r=e.errorIconForeground;break;case"warning":r=e.warningIconForeground;break;default:r=e.infoIconForeground;break}r&&(this.iconElement.style.color=r)}dispose(){super.dispose(),this.modalElement&&(this.modalElement.remove(),this.modalElement=void 0),this.focusToReturn&&Vc(this.focusToReturn,this.container.ownerDocument.body)&&(this.focusToReturn.focus(),this.focusToReturn=void 0)}rearrangeButtons(e,t){const i=e.map((s,o)=>({label:s,index:o}));if(e.length<2)return i;if(ut||Cf){if(typeof t=="number"&&i[t]){const s=i.splice(t,1)[0];i.splice(1,0,s)}i.reverse()}else if(to&&typeof t=="number"&&i[t]){const s=i.splice(t,1)[0];i.push(s)}return i}}const xT=["workbench.action.quit","workbench.action.reloadWindow","copy","cut","editor.action.selectAll","editor.action.clipboardCopyAction","editor.action.clipboardCutAction","editor.action.clipboardPasteAction"];function kT(a,e,t,i=xT){return{keyEventProcessor:s=>{const o=e.softDispatch(s,t.activeContainer);o.kind===pb.KbFound&&o.commandId&&(i.includes(o.commandId)||ke.stop(s,!0))},buttonStyles:Yn,checkboxStyles:ub,inputBoxStyles:gd,dialogStyles:hb,...a}}Pe(DT);let Yl=class extends R{constructor(e,t,i,s,o,n,r,d,l){super(),this.activityService=e,this.paneCompositeService=t,this.viewDescriptorService=i,this.viewsService=s,this.notificationService=o,this.statusbarService=n,this.layoutService=r,this.keybindingService=d,this.userActivityService=l,this.windowProgressStack=[],this.windowProgressStatusEntry=void 0}async withProgress(e,t,i){const{location:s}=e,o=async r=>{const d=this.userActivityService.markActive({whenHeldFor:15e3});try{return await t(r)}finally{d.dispose()}},n=r=>{const d=this.viewDescriptorService.getViewContainerById(r);if(d){const l=this.viewDescriptorService.getViewContainerLocation(d);if(l!==null)return this.withPaneCompositeProgress(r,l,o,{...e,location:r})}if(this.viewDescriptorService.getViewDescriptorById(r)!==null)return this.withViewProgress(r,o,{...e,location:r});throw new Error(`Bad progress location: ${r}`)};if(typeof s=="string")return n(s);switch(s){case fs.Notification:{let r=e.priority;return r!==fo.URGENT&&(this.notificationService.getFilter()===_p.ERROR?r=fo.SILENT:gb(e.source)&&this.notificationService.getFilter(e.source)===_p.ERROR&&(r=fo.SILENT)),this.withNotificationProgress({...e,location:s,priority:r},o,i)}case fs.Window:{const r=e.type;return e.command?this.withWindowProgress({...e,location:s,type:r},o):this.withNotificationProgress({delay:150,...e,priority:fo.SILENT,location:fs.Notification,type:r},o,i)}case fs.Explorer:return this.withPaneCompositeProgress("workbench.view.explorer",q.Sidebar,o,{...e,location:s});case fs.Scm:return n("workbench.scm");case fs.Extensions:return this.withPaneCompositeProgress("workbench.view.extensions",q.Sidebar,o,{...e,location:s});case fs.Dialog:return this.withDialogProgress(e,o,i);default:throw new Error(`Bad progress location: ${s}`)}}withWindowProgress(e,t){const i=[e,new Pf(()=>this.updateWindowProgress())],s=t(i[1]);let o=setTimeout(()=>{o=void 0,this.windowProgressStack.unshift(i),this.updateWindowProgress(),Promise.all([io(150),s]).finally(()=>{const n=this.windowProgressStack.indexOf(i);this.windowProgressStack.splice(n,1),this.updateWindowProgress()})},150);return s.finally(()=>clearTimeout(o))}updateWindowProgress(e=0){if(e<this.windowProgressStack.length){const[t,i]=this.windowProgressStack[e],s=t.title,o=i.value&&i.value.message,n=t.command;let r,d;const l=t.source&&typeof t.source!="string"?t.source.label:t.source;if(s&&o)r=c(12530,"{0}: {1}",s,o),d=l?c(12531,"[{0}] {1}: {2}",l,s,o):r;else if(s)r=s,d=l?c(12532,"[{0}]: {1}",l,s):r;else if(o)r=o,d=l?c(12532,"[{0}]: {1}",l,o):r;else{this.updateWindowProgress(e+1);return}const h={name:c(12533,"Progress Message"),text:r,showProgress:t.type||!0,ariaLabel:r,tooltip:Ep(d).trim(),command:n};this.windowProgressStatusEntry?this.windowProgressStatusEntry.update(h):this.windowProgressStatusEntry=this.statusbarService.addEntry(h,"status.progress",et.LEFT,-Number.MAX_VALUE)}else this.windowProgressStatusEntry?.dispose(),this.windowProgressStatusEntry=void 0}withNotificationProgress(e,t,i){const s=new class extends R{get step(){return this._step}get done(){return this._done}constructor(){super(),this._onDidReport=this._register(new E),this.onDidReport=this._onDidReport.event,this._onWillDispose=this._register(new E),this.onWillDispose=this._onWillDispose.event,this._step=void 0,this._done=!1,this.promise=t(this),this.promise.finally(()=>{this.dispose()})}report(g){this._step=g,this._onDidReport.fire(g)}cancel(g){i?.(g),this.dispose()}dispose(){this._done=!0,this._onWillDispose.fire(),super.dispose()}},o=()=>{const g=new Xs;return this.withWindowProgress({location:fs.Window,title:e.title?ha(e.title).toString():void 0,command:"notifications.showList",type:e.type},m=>{function v(A){A.message&&m.report({message:ha(A.message).toString()})}s.step&&v(s.step);const b=s.onDidReport(A=>v(A));return g.p.finally(()=>b.dispose()),V.once(s.onWillDispose)(()=>g.complete()),g.p}),ae(()=>g.complete())},n=(g,m,v)=>{const b=new O,A=e.primaryActions?Array.from(e.primaryActions):[],K=e.secondaryActions?Array.from(e.secondaryActions):[];if(e.buttons&&e.buttons.forEach((z,Z)=>{const ne=new class extends _t{constructor(){super(`progress.button.${z}`,z,void 0,!0)}async run(){s.cancel(Z)}};b.add(ne),A.push(ne)}),e.cancellable){const z=new class extends _t{constructor(){super("progress.cancel",typeof e.cancellable=="string"?e.cancellable:c(12534,"Cancel"),void 0,!0)}async run(){s.cancel()}};b.add(z),A.push(z)}const P=this.notificationService.notify({severity:_e.Info,message:Ep(g),source:e.source,actions:{primary:A,secondary:K},progress:typeof v=="number"&&v>=0?{total:100,worked:v}:{infinite:!0},priority:m});let L;const $=z=>{qe(L),!z&&!s.done&&(L=o())};return b.add(P.onDidChangeVisibility($)),m===fo.SILENT&&$(!1),V.once(P.onDidClose)(()=>{b.dispose(),qe(L)}),P},r=(g,m)=>{typeof m=="number"&&m>=0?(g.progress.total(100),g.progress.worked(m)):g.progress.infinite()};let d,l,h;const p=g=>{g?.message&&e.title?h=`${e.title}: ${g.message}`:h=e.title||g?.message,!d&&h&&(typeof e.delay=="number"&&e.delay>0?typeof l!="number"&&(l=setTimeout(()=>d=n(h,e.priority,g?.increment),e.delay)):d=n(h,e.priority,g?.increment)),d&&(h&&d.updateMessage(h),typeof g?.increment=="number"&&r(d,g.increment))};p(s.step);const f=s.onDidReport(g=>p(g));return V.once(s.onWillDispose)(()=>f.dispose()),(async()=>{try{typeof e.delay=="number"&&e.delay>0?await s.promise:await Promise.all([io(800),s.promise])}finally{clearTimeout(l),d?.close()}})(),s.promise}withPaneCompositeProgress(e,t,i,s){const o=this.paneCompositeService.getProgressIndicator(e,t),n=o?this.withCompositeProgress(o,i,s):i({report:()=>{}});return t===q.Sidebar&&this.showOnActivityBar(e,s,n),n}withViewProgress(e,t,i){const s=this.viewsService.getViewProgressIndicator(e),o=s?this.withCompositeProgress(s,t,i):t({report:()=>{}}),n=this.viewDescriptorService.getViewContainerByViewId(e)?.id;return n===void 0||this.showOnActivityBar(n,i,o),o}showOnActivityBar(e,t,i){let s,o=setTimeout(()=>{o=void 0;const n=this.activityService.showViewContainerActivity(e,{badge:new n_(()=>"")}),r=Date.now(),d=300;s={dispose(){const l=Date.now()-r;l<d?setTimeout(()=>n.dispose(),d-l):n.dispose()}}},t.delay||300);i.finally(()=>{clearTimeout(o),qe(s)})}withCompositeProgress(e,t,i){let s;function o(r){let d,l;return typeof r<"u"&&(typeof r=="number"?d=r:typeof r.increment=="number"&&(d=r.total??100,l=r.increment)),typeof d=="number"?(s||(s=e.show(d,i.delay),n.catch(()=>{}).finally(()=>s?.done())),typeof l=="number"&&s.worked(l)):(s?.done(),e.showWhile(n,i.delay)),s}const n=t({report:r=>{o(r)}});return o(i.total),n}withDialogProgress(e,t,i){const s=new O;let o,n=!1;const r=g=>{const m=e.buttons||[];return e.sticky||m.push(e.cancellable?typeof e.cancellable=="boolean"?c(12534,"Cancel"):e.cancellable:c(12535,"Dismiss")),o=new TT(this.layoutService.activeContainer,g,m,kT({type:"pending",detail:e.detail,cancelId:m.length-1,disableCloseAction:e.sticky,disableDefaultAction:e.sticky},this.keybindingService,this.layoutService)),s.add(o),o.show().then(v=>{n||i?.(v.button),qe(o)}),o};let d=e.delay??0,l;const h=s.add(new ur(()=>{d=0,l&&!o?o=r(l):l&&o.updateMessage(l)},0)),p=function(g){l=g,h.isScheduled()||h.schedule(d)},f=t({report:g=>{p(g.message)}});return f.finally(()=>{n=!0,qe(s)}),e.title&&p(e.title),f}};Yl=D([u(0,ks),u(1,Ls),u(2,Ye),u(3,gt),u(4,Ke),u(5,Rs),u(6,pr),u(7,it),u(8,fb)],Yl);let Jl=class extends R{constructor(e){super(),this.paneCompositeParts=new Map;const t=e.createInstance(ul),i=e.createInstance(dl),s=e.createInstance(wl);this.paneCompositeParts.set(q.Panel,t),this.paneCompositeParts.set(q.Sidebar,i),this.paneCompositeParts.set(q.AuxiliaryBar,s);const o=this._register(new O);this.onDidPaneCompositeOpen=V.any(...Qp.map(n=>V.map(this.paneCompositeParts.get(n).onDidPaneCompositeOpen,r=>({composite:r,viewContainerLocation:n}),o))),this.onDidPaneCompositeClose=V.any(...Qp.map(n=>V.map(this.paneCompositeParts.get(n).onDidPaneCompositeClose,r=>({composite:r,viewContainerLocation:n}),o)))}openPaneComposite(e,t,i){return this.getPartByLocation(t).openPaneComposite(e,i)}getActivePaneComposite(e){return this.getPartByLocation(e).getActivePaneComposite()}getPaneComposite(e,t){return this.getPartByLocation(t).getPaneComposite(e)}getPaneComposites(e){return this.getPartByLocation(e).getPaneComposites()}getPinnedPaneCompositeIds(e){return this.getPartByLocation(e).getPinnedPaneCompositeIds()}getVisiblePaneCompositeIds(e){return this.getPartByLocation(e).getVisiblePaneCompositeIds()}getPaneCompositeIds(e){return this.getPartByLocation(e).getPaneCompositeIds()}getProgressIndicator(e,t){return this.getPartByLocation(t).getProgressIndicator(e)}hideActivePaneComposite(e){this.getPartByLocation(e).hideActivePaneComposite()}getLastActivePaneCompositeId(e){return this.getPartByLocation(e).getLastActivePaneCompositeId()}getPartByLocation(e){return Se(this.paneCompositeParts.get(e))}};Jl=D([u(0,F)],Jl);async function RT(a){const e=navigator.usb;if(!e)return;const t=await e.requestDevice({filters:a?.filters??[]});if(t)return{deviceClass:t.deviceClass,deviceProtocol:t.deviceProtocol,deviceSubclass:t.deviceSubclass,deviceVersionMajor:t.deviceVersionMajor,deviceVersionMinor:t.deviceVersionMinor,deviceVersionSubminor:t.deviceVersionSubminor,manufacturerName:t.manufacturerName,productId:t.productId,productName:t.productName,serialNumber:t.serialNumber,usbVersionMajor:t.usbVersionMajor,usbVersionMinor:t.usbVersionMinor,usbVersionSubminor:t.usbVersionSubminor,vendorId:t.vendorId}}async function LT(a){const e=navigator.serial;if(!e)return;const t=await e.requestPort({filters:a?.filters??[]});if(!t)return;const i=t.getInfo();return{usbVendorId:i.usbVendorId,usbProductId:i.usbProductId}}async function VT(a){const e=navigator.hid;if(!e)return;const t=await e.requestDevice({filters:a?.filters??[]});if(!t.length)return;const i=t[0];return{opened:i.opened,vendorId:i.vendorId,productId:i.productId,productName:i.productName,collections:i.collections}}const PT=c(1893,"open"),MT=c(1894,"close"),OT=c(1895,"find");var Ec={open:PT,close:MT,find:OT};let Zl=class{constructor(e,t,i,s){this.fileService=e,this.environmentService=t,this.lifecycleService=i,this.logService=s}async getLogs(){return r_(this.fileService,this.environmentService)}async whenWorkbenchRestored(){this.logService.info("[driver] Waiting for restored lifecycle phase..."),await this.lifecycleService.when(gr.Restored),this.logService.info("[driver] Restored lifecycle phase reached. Waiting for contributions..."),await H.as(vd.Workbench).whenRestored,this.logService.info("[driver] Workbench contributions created.")}async setValue(e,t){const i=re.document.querySelector(e);if(!i)return Promise.reject(new Error(`Element not found: ${e}`));const s=i;s.value=t;const o=new Event("input",{bubbles:!0,cancelable:!0});s.dispatchEvent(o)}async isActiveElement(e){if(re.document.querySelector(e)!==re.document.activeElement){const i=[];let s=re.document.activeElement;for(;s;){const o=s.tagName,n=s.id?`#${s.id}`:"",r=gs(s.className.split(/\s+/g).map(d=>d.trim())).map(d=>`.${d}`).join("");i.unshift(`${o}${n}${r}`),s=s.parentElement}throw new Error(`Active element not found. Current active element is '${i.join(" > ")}'. Looking for ${e}`)}return!0}async getElements(e,t){const i=re.document.querySelectorAll(e),s=[];for(let o=0;o<i.length;o++){const n=i.item(o);s.push(this.serializeElement(n,t))}return s}serializeElement(e,t){const i=Object.create(null);for(let r=0;r<e.attributes.length;r++){const d=e.attributes.item(r);d&&(i[d.name]=d.value)}const s=[];if(t)for(let r=0;r<e.children.length;r++){const d=e.children.item(r);d&&s.push(this.serializeElement(d,!0))}const{left:o,top:n}=Ip(e);return{tagName:e.tagName,className:e.className,textContent:e.textContent||"",attributes:i,children:s,left:o,top:n}}async getElementXY(e,t,i){const s=typeof t=="number"&&typeof i=="number"?{x:t,y:i}:void 0;return this._getElementXY(e,s)}async typeInEditor(e,t){const i=re.document.querySelector(e);if(!i)throw new Error(`Editor not found: ${e}`);if(Dp(i)){const s=i.editContext;if(!s)throw new Error(`Edit context not found: ${e}`);const o=s.selectionStart,n=s.selectionEnd,r=new TextUpdateEvent("textupdate",{updateRangeStart:o,updateRangeEnd:n,text:t,selectionStart:o+t.length,selectionEnd:o+t.length,compositionStart:0,compositionEnd:0});s.dispatchEvent(r)}else if(Ap(i)){const s=i.selectionStart,o=s+t.length,n=i.value,r=n.substr(0,s)+t+n.substr(s);i.value=r,i.setSelectionRange(o,o);const d=new Event("input",{bubbles:!0,cancelable:!0});i.dispatchEvent(d)}}async getEditorSelection(e){const t=re.document.querySelector(e);if(!t)throw new Error(`Editor not found: ${e}`);if(Dp(t)){const i=t.editContext;if(!i)throw new Error(`Edit context not found: ${e}`);return{selectionStart:i.selectionStart,selectionEnd:i.selectionEnd}}else{if(Ap(t))return{selectionStart:t.selectionStart,selectionEnd:t.selectionEnd};throw new Error(`Unknown type of element: ${e}`)}}async getTerminalBuffer(e){const t=re.document.querySelector(e);if(!t)throw new Error(`Terminal not found: ${e}`);const i=t.xterm;if(!i)throw new Error(`Xterm not found: ${e}`);const s=[];for(let o=0;o<i.buffer.active.length;o++)s.push(i.buffer.active.getLine(o).translateToString(!0));return s}async writeInTerminal(e,t){const i=re.document.querySelector(e);if(!i)throw new Error(`Element not found: ${e}`);const s=i.xterm;if(!s)throw new Error(`Xterm not found: ${e}`);s.input(t)}getLocaleInfo(){return Promise.resolve({language:wb,locale:mb})}getLocalizedStrings(){return Promise.resolve({open:Ec.open,close:Ec.close,find:Ec.find})}async _getElementXY(e,t){const i=re.document.querySelector(e);if(!i)return Promise.reject(new Error(`Element not found: ${e}`));const{left:s,top:o}=Ip(i),{width:n,height:r}=Mf(i);let d,l;return t?(d=s+t.x,l=o+t.y):(d=s+n/2,l=o+r/2),d=Math.round(d),l=Math.round(l),{x:d,y:l}}};Zl=D([u(0,Le),u(1,uu),u(2,qo),u(3,Ue)],Zl);function NT(a){Object.assign(re,{driver:a.createInstance(Zl)})}var Fs;let xa=class extends R{static{Fs=this}static{this.TIMEOUT_HANDLES=Number.MIN_SAFE_INTEGER}static{this.TIMEOUT_DISPOSABLES=new Map}constructor(e,t={getWindowsCount:Tp,getWindows:Bc},i,s){super(),this.hostService=i,this.environmentService=s,this.enableWindowFocusOnElementFocus(e),this.enableMultiWindowAwareTimeout(e,t),this.registerFullScreenListeners(e.vscodeWindowId)}enableWindowFocusOnElementFocus(e){const t=e.HTMLElement.prototype.focus,i=this;e.HTMLElement.prototype.focus=function(s){i.onElementFocus(St(this)),t.apply(this,[s])}}onElementFocus(e){const t=eo();t!==e&&t.document.hasFocus()&&(e.focus(),!this.environmentService.extensionTestsLocationURI&&!e.document.hasFocus()&&this.hostService.focus(e))}enableMultiWindowAwareTimeout(e,t={getWindowsCount:Tp,getWindows:Bc}){const i=e.setTimeout;Object.defineProperty(e,"vscodeOriginalSetTimeout",{get:()=>i});const s=e.clearTimeout;Object.defineProperty(e,"vscodeOriginalClearTimeout",{get:()=>s}),e.setTimeout=function(o,n=0,...r){if(t.getWindowsCount()===1||typeof o=="string"||n===0)return i.apply(this,[o,n,...r]);const d=new Set,l=Fs.TIMEOUT_HANDLES++;Fs.TIMEOUT_DISPOSABLES.set(l,d);const h=wu(o,()=>{qe(d),Fs.TIMEOUT_DISPOSABLES.delete(l)});for(const{window:p,disposables:f}of t.getWindows()){if(Of(p)&&p.document.visibilityState==="hidden")continue;let g=!1;const m=p.vscodeOriginalSetTimeout.apply(this,[(...b)=>{g||h(...b)},n,...r]),v=ae(()=>{g=!0,p.vscodeOriginalClearTimeout(m),d.delete(v)});f.add(v),d.add(v)}return l},e.clearTimeout=function(o){const n=typeof o=="number"?Fs.TIMEOUT_DISPOSABLES.get(o):void 0;n?(qe(n),Fs.TIMEOUT_DISPOSABLES.delete(o)):s.apply(this,[o])}}registerFullScreenListeners(e){this._register(this.hostService.onDidChangeFullScreen(({windowId:t,fullscreen:i})=>{if(t===e){const s=yd(e);s&&yb(i,s.window)}}))}static async confirmOnShutdown(e,t){const i=e.get(ao),s=e.get(ie),o=t===Rn.QUIT?ut?c(3526,"Are you sure you want to quit?"):c(3527,"Are you sure you want to exit?"):c(3528,"Are you sure you want to close the window?"),n=t===Rn.QUIT?ut?c(3529,"&&Quit"):c(3530,"&&Exit"):c(3531,"&&Close Window"),r=await i.confirm({message:o,primaryButton:n,checkbox:{label:c(3532,"Do not ask me again")}});return r.confirmed&&r.checkboxChecked&&await s.updateValue("window.confirmBeforeClose","never"),r.confirmed}};xa=Fs=D([u(2,Zt),u(3,ni)],xa);let Hg=class extends xa{constructor(e,t,i,s,o,n,r,d,l){super(re,void 0,l,n),this.openerService=e,this.lifecycleService=t,this.dialogService=i,this.labelService=s,this.productService=o,this.browserEnvironmentService=n,this.layoutService=r,this.instantiationService=d,this.registerListeners(),this.create()}registerListeners(){this._register(this.lifecycleService.onWillShutdown(()=>this.onWillShutdown()));const e=ua&&re.visualViewport?re.visualViewport:re;this._register(Y(e,te.RESIZE,()=>{this.layoutService.layout(),ua&&re.scrollTo(0,0)})),this._register(Y(this.layoutService.mainContainer,te.WHEEL,t=>t.preventDefault(),{passive:!1})),this._register(Y(this.layoutService.mainContainer,te.CONTEXT_MENU,t=>ke.stop(t,!0))),this._register(Y(this.layoutService.mainContainer,te.DROP,t=>ke.stop(t,!0)))}onWillShutdown(){V.toPromise(V.any(V.once(new Fc(re.document.body,te.KEY_DOWN,!0).event),V.once(new Fc(re.document.body,te.MOUSE_DOWN,!0).event))).then(async()=>{await io(3e3),await this.dialogService.prompt({type:_e.Error,message:c(3533,"An unexpected error occurred that requires a reload of this page."),detail:c(3534,"The workbench was unexpectedly disposed while running."),buttons:[{label:c(3535,"&&Reload"),run:()=>re.location.reload()}]})})}create(){this.setupOpenHandlers(),this.registerLabelFormatters(),this.registerCommands(),this.setupDriver()}setupDriver(){this.environmentService.enableSmokeTestDriver&&NT(this.instantiationService)}setupOpenHandlers(){this.openerService.setDefaultExternalOpener({openExternal:async e=>{let t=!1;if(this.browserEnvironmentService.options?.openerAllowedExternalUrlPrefixes){for(const i of this.browserEnvironmentService.options.openerAllowedExternalUrlPrefixes)if(e.startsWith(i)){t=!0;break}}if(sc(e,pe.http)||sc(e,pe.https))Nf?Cb(e,!t)||await this.dialogService.prompt({type:_e.Warning,message:c(3536,"The browser interrupted the opening of a new tab or window. Press 'Open' to open it anyway."),detail:e,buttons:[{label:c(3537,"&&Open"),run:()=>t?xp(e):kp(e)},{label:c(3538,"&&Learn More"),run:()=>this.openerService.open(U.parse("https://aka.ms/allow-vscode-popup"))}],cancelButton:!0}):t?xp(e):kp(e);else{const i=()=>{this.lifecycleService.withExpectedShutdown({disableShutdownHandling:!0},()=>re.location.href=e)};i();const s=async()=>{const{downloadUrl:o}=this.productService;let n;const r=[{label:c(3539,"&&Try Again"),run:()=>i()}];o!==void 0?(n=c(3540,`We launched {0} on your computer.

If {1} did not launch, try again or install it below.`,this.productService.nameLong,this.productService.nameLong),r.push({label:c(3541,"&&Install"),run:async()=>{await this.openerService.open(U.parse(o)),s()}})):n=c(3542,`We launched {0} on your computer.

If {1} did not launch, try again below.`,this.productService.nameLong,this.productService.nameLong),await this.hostService.withExpectedShutdown(()=>this.dialogService.prompt({type:_e.Info,message:c(3543,"All done. You can close this tab now."),detail:n,buttons:r,cancelButton:!0}))};sc(e,this.productService.urlProtocol)&&await s()}return!0}})}registerLabelFormatters(){this._register(this.labelService.registerFormatter({scheme:pe.vscodeUserData,priority:!0,formatting:{label:"(Settings) ${path}",separator:"/"}}))}registerCommands(){Te.registerCommand("workbench.experimental.requestUsbDevice",async(e,t)=>RT(t)),Te.registerCommand("workbench.experimental.requestSerialPort",async(e,t)=>LT(t)),Te.registerCommand("workbench.experimental.requestHidDevice",async(e,t)=>VT(t))}};Hg=D([u(0,Tt),u(1,qo),u(2,ao),u(3,Fi),u(4,vb),u(5,bb),u(6,ze),u(7,F),u(8,Zt)],Hg);var Xl,ka;(function(a){a[a.Maximized=0]="Maximized",a[a.Normal=1]="Normal",a[a.Fullscreen=2]="Fullscreen"})(ka||(ka={}));const BT=new jt(Kc.width,Kc.height);let Ql=class extends xa{constructor(e,t,i,s,o,n){super(e,void 0,o,n),this.window=e,this.container=t,this.configurationService=s,this._onWillLayout=this._register(new E),this.onWillLayout=this._onWillLayout.event,this._onDidLayout=this._register(new E),this.onDidLayout=this._onDidLayout.event,this._onBeforeUnload=this._register(new E),this.onBeforeUnload=this._onBeforeUnload.event,this._onUnload=this._register(new E),this.onUnload=this._onUnload.event,this._onWillDispose=this._register(new E),this.onWillDispose=this._onWillDispose.event,this.compact=!1,this.whenStylesHaveLoaded=i.wait().then(()=>{}),this.registerListeners()}updateOptions(e){this.compact=e.compact}registerListeners(){this._register(Y(this.window,te.BEFORE_UNLOAD,e=>this.handleBeforeUnload(e))),this._register(Y(this.window,te.UNLOAD,()=>this.handleUnload())),this._register(Y(this.window,"unhandledrejection",e=>{Bo(e.reason),e.preventDefault()})),this._register(Y(this.window,te.RESIZE,()=>this.layout())),this._register(Y(this.container,te.SCROLL,()=>this.container.scrollTop=0)),Qs?(this._register(Y(this.container,te.DROP,e=>ke.stop(e,!0))),this._register(Y(this.container,te.WHEEL,e=>e.preventDefault(),{passive:!1})),this._register(Y(this.container,te.CONTEXT_MENU,e=>ke.stop(e,!0)))):(this._register(Y(this.window.document.body,te.DRAG_OVER,e=>ke.stop(e))),this._register(Y(this.window.document.body,te.DROP,e=>ke.stop(e))))}handleBeforeUnload(e){let t;if(this._onBeforeUnload.fire({veto(o){o&&(t=o)}}),t){this.handleVetoBeforeClose(e,t);return}const i=this.configurationService.getValue("window.confirmBeforeClose");(i==="always"||i==="keyboardOnly"&&Vb.getInstance().isModifierPressed)&&this.confirmBeforeClose(e)}handleVetoBeforeClose(e,t){this.preventUnload(e)}preventUnload(e){e.preventDefault(),e.returnValue=c(12051,"Changes that you made may not be saved. Please check press 'Cancel' and try again.")}confirmBeforeClose(e){this.preventUnload(e)}handleUnload(){this._onUnload.fire()}layout(){const e=Mf(this.window.document.body,BT,this.container);this._onWillLayout.fire(e),this._onDidLayout.fire(e)}createState(){return{bounds:{x:this.window.screenX,y:this.window.screenY,width:this.window.outerWidth,height:this.window.outerHeight},zoomLevel:Pb(this.window),compact:this.compact}}dispose(){this._store.isDisposed||(this._onWillDispose.fire(),super.dispose())}};Ql=D([u(3,ie),u(4,Zt),u(5,ni)],Ql);let eh=class extends R{static{Xl=this}static{this.WINDOW_IDS=Sb(re)+1}constructor(e,t,i,s,o,n){super(),this.layoutService=e,this.dialogService=t,this.configurationService=i,this.telemetryService=s,this.hostService=o,this.environmentService=n,this._onDidOpenAuxiliaryWindow=this._register(new E),this.onDidOpenAuxiliaryWindow=this._onDidOpenAuxiliaryWindow.event,this.windows=new Map}async open(e){ui("code/auxiliaryWindow/willOpen");const t=await this.openWindow(e);if(!t)throw new Error(c(12052,"Unable to open a new window."));const i=await this.resolveWindowId(t);_b(t,i);const s=new O,{container:o,stylesLoaded:n}=this.createContainer(t,s,e),r=this.createAuxiliaryWindow(t,o,n);r.updateOptions({compact:e?.compact??!1});const d=new O;this.windows.set(t.vscodeWindowId,r),d.add(ae(()=>this.windows.delete(t.vscodeWindowId)));const l=new O;return V.once(r.onWillDispose)(()=>{t.close(),s.dispose(),d.dispose(),l.dispose()}),d.add(Eb(t)),this._onDidOpenAuxiliaryWindow.fire({window:r,disposables:l}),ui("code/auxiliaryWindow/didOpen"),this.telemetryService.publicLog2("auxiliaryWindowOpen",{bounds:!!e?.bounds}),r}createAuxiliaryWindow(e,t,i){return new Ql(e,t,i,this.configurationService,this.hostService,this.environmentService)}async openWindow(e){const t=eo(),i={x:t.screenX,y:t.screenY,width:t.outerWidth,height:t.outerHeight},s=e?.compact?Ib:Kc,o=Math.max(e?.bounds?.width??s.width,Rp.WIDTH),n=Math.max(e?.bounds?.height??s.height,Rp.HEIGHT);let r={x:e?.bounds?.x??Math.max(i.x+i.width/2-o/2,0),y:e?.bounds?.y??Math.max(i.y+i.height/2-n/2,0),width:o,height:n};!e?.bounds&&r.x===i.x&&r.y===i.y&&(r={...r,x:r.x+30,y:r.y+30});const d=gs(["popup=yes",`left=${r.x}`,`top=${r.y}`,`width=${r.width}`,`height=${r.height}`,e?.nativeTitlebar?"window-native-titlebar=yes":void 0,e?.disableFullscreen?"window-disable-fullscreen=yes":void 0,e?.alwaysOnTop?"window-always-on-top=yes":void 0,e?.mode===ka.Maximized?"window-maximized=yes":void 0,e?.mode===ka.Fullscreen?"window-fullscreen=yes":void 0]),l=re.open(Db?"":"about:blank",void 0,d.join(","));return!l&&Qs?(await this.dialogService.prompt({type:_e.Warning,message:c(12053,"The browser interrupted the opening of a new window. Press 'Retry' to try again."),detail:c(12054,"To avoid this problem in the future, please ensure to allow popups for this website."),buttons:[{label:c(12055,"&&Retry"),run:()=>this.openWindow(e)}],cancelButton:!0})).result:l?.window}async resolveWindowId(e){return Xl.WINDOW_IDS++}createContainer(e,t,i){this.applyMeta(e);const{stylesLoaded:s}=this.applyCSS(e,t),o=this.applyHTML(e,t);return{stylesLoaded:s,container:o}}applyMeta(e){for(const i of['meta[charset="utf-8"]','meta[http-equiv="Content-Security-Policy"]','meta[name="viewport"]','meta[name="theme-color"]']){const s=re.document.querySelector(i);if(s){const o=Bf(e.document.head);if(Lp(s,o),i==='meta[http-equiv="Content-Security-Policy"]'){const n=o.getAttribute("content");n&&o.setAttribute("content",n.replace(/(script-src[^\;]*)/,"script-src 'none'"))}}}const t=re.document.querySelector('link[rel="icon"]');if(t){const i=Ab(e.document.head);Lp(t,i)}}applyCSS(e,t){ui("code/auxiliaryWindow/willApplyCSS"),e.document.adoptedStyleSheets=[...e.document.adoptedStyleSheets,...(Mb??re.document).adoptedStyleSheets.map(l=>{const h=new e.CSSStyleSheet;for(const p of l.cssRules)h.insertRule(p.cssText);return h})];const i=new Map,s=new Tb;s.wait().then(()=>ui("code/auxiliaryWindow/didLoadCSSStyles"));const o=t.add(new O);let n=0;function r(){--n===0&&(o.dispose(),s.open())}function d(l){if(Lb(l))return;const h=e.document.head.appendChild(l.cloneNode(!0));l.tagName.toLowerCase()==="link"&&(n++,o.add(Y(h,"load",r)),o.add(Y(h,"error",r))),i.set(l,h)}n++;try{for(const l of re.document.head.querySelectorAll('link[rel="stylesheet"], style'))d(l)}finally{r()}return t.add(xb(e)),t.add(kb.observe(re.document.head,t,{childList:!0,subtree:!0})(l=>{for(const h of l)if(!(h.type!=="childList"||h.target.nodeName.toLowerCase()==="title"||h.target.nodeName.toLowerCase()==="script"||h.target.nodeName.toLowerCase()==="meta")){for(const p of h.addedNodes)if(No(p)&&(p.tagName.toLowerCase()==="style"||p.tagName.toLowerCase()==="link"))d(p);else if(p.nodeType===Node.TEXT_NODE&&p.parentNode){const f=i.get(p.parentNode);f&&(f.textContent=p.textContent)}for(const p of h.removedNodes){const f=i.get(p);f&&(f.parentNode?.removeChild(f),i.delete(p))}}})),ui("code/auxiliaryWindow/didApplyCSS"),{stylesLoaded:s}}applyHTML(e,t){ui("code/auxiliaryWindow/willApplyHTML");const i=B("div",{role:"application"});return Rb(i,0,0,0,0,"relative"),i.style.display="flex",i.style.height="100%",i.style.flexDirection="column",e.document.body.append(i),t.add(oc(re.document.documentElement,e.document.documentElement)),t.add(oc(re.document.body,e.document.body)),t.add(oc(this.layoutService.mainContainer,i,["class"])),ui("code/auxiliaryWindow/didApplyHTML"),i}getWindow(e){return this.windows.get(e)}};eh=Xl=D([u(0,ze),u(1,ao),u(2,ie),u(3,mt),u(4,Zt),u(5,ni)],eh);let th=class extends vr{constructor(e,t,i,s,o,n,r,d,l,h,p,f,g){super(e,{mergeViewWithContainerWhenSingleView:!1},r,i,s,l,o,h,d,n,p,f,g),this.constantViewDescriptors=new Map,this.allViews=new Map,this._register(t(m=>{this.filterValue=m,this.onFilterChanged(m)})),this._register(this.viewContainerModel.onDidChangeActiveViewDescriptors(()=>{this.updateAllViews(this.viewContainerModel.activeViewDescriptors)}))}updateAllViews(e){e.forEach(t=>{const i=this.getFilterOn(t);i&&(this.allViews.has(i)||this.allViews.set(i,new Map),this.allViews.get(i).set(t.id,t),this.filterValue&&!this.filterValue.includes(i)&&this.panes.find(s=>s.id===t.id)&&this.viewContainerModel.setVisible(t.id,!1))})}addConstantViewDescriptors(e){e.forEach(t=>this.constantViewDescriptors.set(t.id,t))}onFilterChanged(e){this.allViews.size===0&&this.updateAllViews(this.viewContainerModel.activeViewDescriptors),this.getViewsNotForTarget(e).forEach(t=>this.viewContainerModel.setVisible(t.id,!1)),this.getViewsForTarget(e).forEach(t=>this.viewContainerModel.setVisible(t.id,!0))}getViewsForTarget(e){const t=[];for(let i=0;i<e.length;i++)this.allViews.has(e[i])&&t.push(...Array.from(this.allViews.get(e[i]).values()));return t}getViewsNotForTarget(e){const t=this.allViews.keys();let i=t.next(),s=[];for(;!i.done;){let o=!1;e.forEach(n=>{i.value===n&&(o=!0)}),o||(s=s.concat(this.getViewsForTarget([i.value]))),i=t.next()}return s}onDidAddViewDescriptors(e){const t=super.onDidAddViewDescriptors(e);for(let i=0;i<e.length;i++)this.constantViewDescriptors.has(e[i].viewDescriptor.id)&&t[i].setExpanded(!1);return this.allViews.size===0&&this.updateAllViews(this.viewContainerModel.activeViewDescriptors),t}openView(e,t){const i=super.openView(e,t);if(i){const s=Array.from(this.allViews.entries()).find(o=>o[1].has(e));s&&!this.filterValue?.includes(s[0])&&this.setFilter(s[1].get(e))}return i}};th=D([u(2,ie),u(3,ze),u(4,mt),u(5,ce),u(6,F),u(7,me),u(8,at),u(9,kt),u(10,us),u(11,Ye),u(12,Ue)],th);let ih=class extends R{constructor(e,t,i,s,o){super(),this.viewDescriptorService=e,this.paneCompositeService=t,this.contextKeyService=i,this.layoutService=s,this.editorService=o,this._onDidChangeViewVisibility=this._register(new E),this.onDidChangeViewVisibility=this._onDidChangeViewVisibility.event,this._onDidChangeViewContainerVisibility=this._register(new E),this.onDidChangeViewContainerVisibility=this._onDidChangeViewContainerVisibility.event,this._onDidChangeFocusedView=this._register(new E),this.onDidChangeFocusedView=this._onDidChangeFocusedView.event,this.viewContainerDisposables=this._register(new ca),this.viewDisposable=new Map,this.enabledViewContainersContextKeys=new Map,this.visibleViewContextKeys=new Map,this.viewPaneContainers=new Map,this._register(ae(()=>{this.viewDisposable.forEach(n=>n.dispose()),this.viewDisposable.clear()})),this.viewDescriptorService.viewContainers.forEach(n=>this.onDidRegisterViewContainer(n,this.viewDescriptorService.getViewContainerLocation(n))),this._register(this.viewDescriptorService.onDidChangeViewContainers(({added:n,removed:r})=>this.onDidChangeContainers(n,r))),this._register(this.viewDescriptorService.onDidChangeContainerLocation(({viewContainer:n,from:r,to:d})=>this.onDidChangeContainerLocation(n,r,d))),this._register(this.paneCompositeService.onDidPaneCompositeOpen(n=>this._onDidChangeViewContainerVisibility.fire({id:n.composite.getId(),visible:!0,location:n.viewContainerLocation}))),this._register(this.paneCompositeService.onDidPaneCompositeClose(n=>this._onDidChangeViewContainerVisibility.fire({id:n.composite.getId(),visible:!1,location:n.viewContainerLocation}))),this.focusedViewContextKey=ta.bindTo(i)}onViewsAdded(e){for(const t of e)this.onViewsVisibilityChanged(t,t.isBodyVisible())}onViewsVisibilityChanged(e,t){this.getOrCreateActiveViewContextKey(e).set(t),this._onDidChangeViewVisibility.fire({id:e.id,visible:t})}onViewsRemoved(e){for(const t of e)this.onViewsVisibilityChanged(t,!1)}getOrCreateActiveViewContextKey(e){const t=MD(e.id);let i=this.visibleViewContextKeys.get(t);return i||(i=new j(t,!1).bindTo(this.contextKeyService),this.visibleViewContextKeys.set(t,i)),i}onDidChangeContainers(e,t){for(const{container:i,location:s}of t)this.onDidDeregisterViewContainer(i,s);for(const{container:i,location:s}of e)this.onDidRegisterViewContainer(i,s)}onDidRegisterViewContainer(e,t){this.registerPaneComposite(e,t);const i=new O,s=this.viewDescriptorService.getViewContainerModel(e);this.onViewDescriptorsAdded(s.allViewDescriptors,e),i.add(s.onDidChangeAllViewDescriptors(({added:o,removed:n})=>{this.onViewDescriptorsAdded(o,e),this.onViewDescriptorsRemoved(n)})),this.updateViewContainerEnablementContextKey(e),i.add(s.onDidChangeActiveViewDescriptors(()=>this.updateViewContainerEnablementContextKey(e))),i.add(this.registerOpenViewContainerAction(e)),this.viewContainerDisposables.set(e.id,i)}onDidDeregisterViewContainer(e,t){this.deregisterPaneComposite(e,t),this.viewContainerDisposables.deleteAndDispose(e.id)}onDidChangeContainerLocation(e,t,i){this.deregisterPaneComposite(e,t),this.registerPaneComposite(e,i),this.layoutService.isVisible(Dc(i))&&this.viewDescriptorService.getViewContainersByLocation(i).filter(s=>this.isViewContainerActive(s.id)).length===1&&this.openViewContainer(e.id)}onViewDescriptorsAdded(e,t){if(this.viewDescriptorService.getViewContainerLocation(t)!==null)for(const s of e){const o=new O;o.add(this.registerOpenViewAction(s)),o.add(this.registerFocusViewAction(s,t.title)),o.add(this.registerResetViewLocationAction(s)),this.viewDisposable.set(s,o)}}onViewDescriptorsRemoved(e){for(const t of e){const i=this.viewDisposable.get(t);i&&(i.dispose(),this.viewDisposable.delete(t))}}updateViewContainerEnablementContextKey(e){let t=this.enabledViewContainersContextKeys.get(e.id);t||(t=this.contextKeyService.createKey(Ic(e.id),!1),this.enabledViewContainersContextKeys.set(e.id,t)),t.set(!(e.hideIfEmpty&&this.viewDescriptorService.getViewContainerModel(e).activeViewDescriptors.length===0))}async openComposite(e,t,i){return this.paneCompositeService.openPaneComposite(e,t,i)}getComposite(e,t){return this.paneCompositeService.getPaneComposite(e,t)}isViewContainerVisible(e){const t=this.viewDescriptorService.getViewContainerById(e);if(!t)return!1;const i=this.viewDescriptorService.getViewContainerLocation(t);return i===null?!1:this.paneCompositeService.getActivePaneComposite(i)?.getId()===e}isViewContainerActive(e){const t=this.viewDescriptorService.getViewContainerById(e);return t?t.hideIfEmpty?this.viewDescriptorService.getViewContainerModel(t).activeViewDescriptors.length>0:!0:!1}getVisibleViewContainer(e){const t=this.paneCompositeService.getActivePaneComposite(e)?.getId();return t?this.viewDescriptorService.getViewContainerById(t):null}getActiveViewPaneContainerWithId(e){const t=this.viewDescriptorService.getViewContainerById(e);return t?this.getActiveViewPaneContainer(t):null}async openViewContainer(e,t){const i=this.viewDescriptorService.getViewContainerById(e);if(i){const s=this.viewDescriptorService.getViewContainerLocation(i);if(s!==null)return await this.paneCompositeService.openPaneComposite(e,s,t)||null}return null}async closeViewContainer(e){const t=this.viewDescriptorService.getViewContainerById(e);if(t){const i=this.viewDescriptorService.getViewContainerLocation(t),s=i!==null&&this.paneCompositeService.getActivePaneComposite(i);if(i!==null)return s?this.layoutService.setPartHidden(!0,Dc(i)):void 0}}isViewVisible(e){return this.getActiveViewWithId(e)?.isBodyVisible()||!1}getActiveViewWithId(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(t){const i=this.getActiveViewPaneContainer(t);if(i)return i.getView(e)}return null}getViewWithId(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(t){const i=this.viewPaneContainers.get(t.id);if(i)return i.getView(e)}return null}getFocusedView(){const e=this.contextKeyService.getContextKeyValue(ta.key)??"";return this.viewDescriptorService.getViewDescriptorById(e.toString())}getFocusedViewName(){const e=this.editorService.activeTextEditorControl?.hasTextFocus()?c(12902,"Text Editor"):void 0;return this.getFocusedView()?.name?.value??e??""}async openView(e,t){const i=this.viewDescriptorService.getViewContainerByViewId(e);if(!i||!this.viewDescriptorService.getViewContainerModel(i).activeViewDescriptors.some(n=>n.id===e))return null;const s=this.viewDescriptorService.getViewContainerLocation(i),o=this.getComposite(i.id,s);if(o){const n=await this.openComposite(o.id,s);if(n&&n.openView)return n.openView(e,t)||null;t&&n?.focus()}return null}closeView(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(t){const i=this.getActiveViewPaneContainer(t);if(i){const s=i.getView(e);if(s)if(i.views.length===1){const o=this.viewDescriptorService.getViewContainerLocation(t);o===q.Sidebar?this.layoutService.setPartHidden(!0,M.SIDEBAR_PART):(o===q.Panel||o===q.AuxiliaryBar)&&this.paneCompositeService.hideActivePaneComposite(o),this.focusedViewContextKey.get()===e&&this.focusedViewContextKey.reset()}else s.setExpanded(!1)}}}getActiveViewPaneContainer(e){const t=this.viewDescriptorService.getViewContainerLocation(e);if(t===null)return null;const i=this.paneCompositeService.getActivePaneComposite(t);return i?.getId()===e.id&&i.getViewPaneContainer()||null}getViewProgressIndicator(e){const t=this.viewDescriptorService.getViewContainerByViewId(e);if(!t)return;const i=this.viewPaneContainers.get(t.id);if(!i)return;const s=i.getView(e);if(s)return i.isViewMergedWithContainer()?this.getViewContainerProgressIndicator(t):s.getProgressIndicator()}getViewContainerProgressIndicator(e){const t=this.viewDescriptorService.getViewContainerLocation(e);if(t!==null)return this.paneCompositeService.getProgressIndicator(e.id,t)}registerOpenViewContainerAction(e){const t=new O;if(e.openCommandActionDescriptor){const{id:i,mnemonicTitle:s,keybindings:o,order:n}=e.openCommandActionDescriptor??{id:e.id},r=e.openCommandActionDescriptor.title??e.title,d=this;if(t.add(C(class extends X{constructor(){super({id:i,get title(){const h=d.viewDescriptorService.getViewContainerLocation(e),p=typeof r=="string"?r:r.value,f=typeof r=="string"?r:r.original;return h===q.Sidebar?{value:c(12903,"Show {0}",p),original:`Show ${f}`}:{value:c(12904,"Toggle {0}",p),original:`Toggle ${f}`}},category:xe.View,precondition:I.has(Ic(e.id)),keybinding:o?{...o,weight:W.WorkbenchContrib}:void 0,f1:!0})}async run(h){const p=h.get(Je),f=h.get(Ye),g=h.get(ze),m=h.get(gt),v=f.getViewContainerLocation(e);switch(v){case q.AuxiliaryBar:case q.Sidebar:{const b=v===q.Sidebar?M.SIDEBAR_PART:M.AUXILIARYBAR_PART;!m.isViewContainerVisible(e.id)||!g.hasFocus(b)?await m.openViewContainer(e.id,!0):p.activeGroup.focus();break}case q.Panel:!m.isViewContainerVisible(e.id)||!g.hasFocus(M.PANEL_PART)?await m.openViewContainer(e.id,!0):m.closeViewContainer(e.id);break}}})),s){const l=this.viewDescriptorService.getDefaultViewContainerLocation(e);t.add(S.appendMenuItem(w.MenubarViewMenu,{command:{id:i,title:s},group:l===q.Sidebar?"3_sidebar":l===q.AuxiliaryBar?"4_auxbar":"5_panel",when:I.has(Ic(e.id)),order:n??Number.MAX_VALUE}))}}return t}registerOpenViewAction(e){const t=new O,i=e.openCommandActionDescriptor?.title??e.name,s=e.openCommandActionDescriptor?.id??`${e.id}.open`,o=this;if(t.add(C(class extends X{constructor(){super({id:s,get title(){const r=o.viewDescriptorService.getViewLocationById(e.id),d=typeof i=="string"?i:i.value,l=typeof i=="string"?i:i.original;return r===q.Sidebar?{value:c(12903,"Show {0}",d),original:`Show ${l}`}:{value:c(12904,"Toggle {0}",d),original:`Toggle ${l}`}},category:xe.View,precondition:I.has(`${e.id}.active`),keybinding:e.openCommandActionDescriptor?.keybindings?{...e.openCommandActionDescriptor.keybindings,weight:W.WorkbenchContrib}:void 0,f1:e.openCommandActionDescriptor?!0:void 0,metadata:{description:c(12905,"Opens view {0}",e.name.value),args:[{name:"options",schema:{type:"object",properties:{preserveFocus:{type:"boolean",default:!1,description:c(12906,"Whether to preserve the existing focus when opening the view.")}}}}]}})}async run(r,d){const l=r.get(Je),h=r.get(Ye),p=r.get(ze),f=r.get(gt),g=r.get(se);if(ta.getValue(g)===e.id&&!d?.preserveFocus){const v=h.getViewLocationById(e.id);h.getViewLocationById(e.id)===q.Sidebar?l.activeGroup.focus():v!==null&&p.setPartHidden(!0,Dc(v))}else f.openView(e.id,!d?.preserveFocus)}})),e.openCommandActionDescriptor?.mnemonicTitle){const n=this.viewDescriptorService.getDefaultContainerById(e.id);if(n){const r=this.viewDescriptorService.getDefaultViewContainerLocation(n);t.add(S.appendMenuItem(w.MenubarViewMenu,{command:{id:s,title:e.openCommandActionDescriptor.mnemonicTitle},group:r===q.Sidebar?"3_sidebar":r===q.AuxiliaryBar?"4_auxbar":"5_panel",when:I.has(`${e.id}.active`),order:e.openCommandActionDescriptor.order??Number.MAX_VALUE}))}}return t}registerFocusViewAction(e,t){return C(class extends X{constructor(){const s=x(12907,"Focus on {0} View",e.name.value);super({id:e.focusCommand?e.focusCommand.id:`${e.id}.focus`,title:s,category:t,menu:[{id:w.CommandPalette,when:e.when}],keybinding:{when:I.has(`${e.id}.active`),weight:W.WorkbenchContrib,primary:e.focusCommand?.keybindings?.primary,secondary:e.focusCommand?.keybindings?.secondary,linux:e.focusCommand?.keybindings?.linux,mac:e.focusCommand?.keybindings?.mac,win:e.focusCommand?.keybindings?.win},metadata:{description:s.value,args:[{name:"focusOptions",description:"Focus Options",schema:{type:"object",properties:{preserveFocus:{type:"boolean",default:!1}}}}]}})}run(s,o){s.get(gt).openView(e.id,!o?.preserveFocus)}})}registerResetViewLocationAction(e){return C(class extends X{constructor(){super({id:`${e.id}.resetViewLocation`,title:x(12908,"Reset Location"),menu:[{id:w.ViewTitleContext,when:I.or(I.and(I.equals("view",e.id),I.equals(`${e.id}.defaultViewLocation`,!1))),group:"1_hide",order:2}]})}run(i){const s=i.get(Ye),o=s.getDefaultContainerById(e.id),n=s.getViewContainerModel(o);if(o.hideIfEmpty&&n.visibleViewDescriptors.length===0){const r=s.getDefaultViewContainerLocation(o);s.moveViewContainerToLocation(o,r,void 0,this.desc.id)}s.moveViewsToContainer([e],o,void 0,this.desc.id),i.get(gt).openView(e.id,!0)}})}registerPaneComposite(e,t){const i=this;let s=class extends nl{constructor(n,r,d,l,h,p,f){super(e.id,n,d,l,h,p,f,r)}createViewPaneContainer(n){const r=this._register(new O),d=i.createViewPaneContainer(n,e,t,r,this.instantiationService);return d instanceof th||r.add(V.any(d.onDidAddViews,d.onDidRemoveViews,d.onTitleAreaUpdate)(()=>{this.updateTitleArea()})),d}};s=D([u(0,mt),u(1,us),u(2,ce),u(3,F),u(4,me),u(5,at),u(6,kt)],s),H.as(zg(t)).registerPaneComposite(Uu.create(s,e.id,typeof e.title=="string"?e.title:e.title.value,pa(e.icon)?e.icon:void 0,e.order,e.requestedIndex,e.icon instanceof U?e.icon:void 0))}deregisterPaneComposite(e,t){H.as(zg(t)).deregisterPaneComposite(e.id)}createViewPaneContainer(e,t,i,s,o){const n=o.createInstance(t.ctorDescriptor.ctor,...t.ctorDescriptor.staticArguments||[]);return this.viewPaneContainers.set(n.getId(),n),s.add(ae(()=>this.viewPaneContainers.delete(n.getId()))),s.add(n.onDidAddViews(r=>this.onViewsAdded(r))),s.add(n.onDidChangeViewVisibility(r=>this.onViewsVisibilityChanged(r,r.isBodyVisible()))),s.add(n.onDidRemoveViews(r=>this.onViewsRemoved(r))),s.add(n.onDidFocusView(r=>{this.focusedViewContextKey.get()!==r.id&&(this.focusedViewContextKey.set(r.id),this._onDidChangeFocusedView.fire())})),s.add(n.onDidBlurView(r=>{this.focusedViewContextKey.get()===r.id&&(this.focusedViewContextKey.reset(),this._onDidChangeFocusedView.fire())})),n}};ih=D([u(0,Ye),u(1,Ls),u(2,se),u(3,ze),u(4,Q)],ih);function Ic(a){return`viewContainer.${a}.enabled`}function zg(a){switch(a){case q.AuxiliaryBar:return Oi.Auxiliary;case q.Panel:return Oi.Panels;case q.Sidebar:default:return Oi.Viewlets}}function Dc(a){switch(a){case q.AuxiliaryBar:return M.AUXILIARYBAR_PART;case q.Panel:return M.PANEL_PART;case q.Sidebar:default:return M.SIDEBAR_PART}}class FT{constructor(){this.onWillInstantiateEditorPane=vi.onWillInstantiateEditorPane}didInstantiateEditorPane(e){return vi.didInstantiateEditorPane(e)}}class KT{constructor(){this._providers=new Map,this._onDidChange=new E,this.onDidChange=this._onDidChange.event}dispose(){this._onDidChange.dispose()}register(e,t,i,s){const o=this._makeKey(e,t);if(this._providers.has(o))throw new Error(`A provider for the command ${t} and menu ${e} is already registered.`);this._providers.set(o,i);const n=s?.(()=>{this._onDidChange.fire(e)});return ae(()=>{n?.dispose(),this._providers.delete(o)})}lookUp(e,t){return this._providers.get(this._makeKey(e,t))}_makeKey(e,t){return`${e.id}/${t instanceof w?t.id:t}`}}var sh;class or{constructor(){this.uris=[]}async perform(){return this}toString(){return"(noop)"}}class cy{constructor(e,t,i){this.newUri=e,this.oldUri=t,this.options=i,this.type="rename"}}let oh=sh=class{constructor(e,t,i,s){this._edits=e,this._undoRedoInfo=t,this._workingCopyFileService=i,this._fileService=s}get uris(){return this._edits.flatMap(e=>[e.newUri,e.oldUri])}async perform(e){const t=[],i=[];for(const s of this._edits)s.options.overwrite===void 0&&s.options.ignoreIfExists&&await this._fileService.exists(s.newUri)||(t.push({file:{source:s.oldUri,target:s.newUri},overwrite:s.options.overwrite}),i.push(new cy(s.oldUri,s.newUri,s.options)));return t.length===0?new or:(await this._workingCopyFileService.move(t,e,this._undoRedoInfo),new sh(i,{isUndoing:!0},this._workingCopyFileService,this._fileService))}toString(){return`(rename ${this._edits.map(e=>`${e.oldUri} to ${e.newUri}`).join(", ")})`}};oh=sh=D([u(2,bd),u(3,Le)],oh);class WT{constructor(e,t,i){this.newUri=e,this.oldUri=t,this.options=i,this.type="copy"}}let nh=class{constructor(e,t,i,s,o){this._edits=e,this._undoRedoInfo=t,this._workingCopyFileService=i,this._fileService=s,this._instaService=o}get uris(){return this._edits.flatMap(e=>[e.newUri,e.oldUri])}async perform(e){const t=[];for(const o of this._edits)o.options.overwrite===void 0&&o.options.ignoreIfExists&&await this._fileService.exists(o.newUri)||t.push({file:{source:o.oldUri,target:o.newUri},overwrite:o.options.overwrite});if(t.length===0)return new or;const i=await this._workingCopyFileService.copy(t,e,this._undoRedoInfo),s=[];for(let o=0;o<i.length;o++){const n=i[o],r=this._edits[o];s.push(new zu(n.resource,{recursive:!0,folder:this._edits[o].options.folder||n.isDirectory,...r.options},!1))}return this._instaService.createInstance(nr,s,{isUndoing:!0})}toString(){return`(copy ${this._edits.map(e=>`${e.oldUri} to ${e.newUri}`).join(", ")})`}};nh=D([u(2,bd),u(3,Le),u(4,F)],nh);class ly{constructor(e,t,i){this.newUri=e,this.options=t,this.contents=i,this.type="create"}}let Ra=class{constructor(e,t,i,s,o,n){this._edits=e,this._undoRedoInfo=t,this._fileService=i,this._workingCopyFileService=s,this._instaService=o,this._textFileService=n}get uris(){return this._edits.map(e=>e.newUri)}async perform(e){const t=[],i=[],s=[];for(const o of this._edits)if(o.newUri.scheme!==pe.untitled&&!(o.options.overwrite===void 0&&o.options.ignoreIfExists&&await this._fileService.exists(o.newUri))){if(o.options.folder)t.push({resource:o.newUri});else{const n=typeof o.contents<"u"?o.contents:await this._textFileService.getEncodedReadable(o.newUri);i.push({resource:o.newUri,contents:n,overwrite:o.options.overwrite})}s.push(new zu(o.newUri,o.options,!o.options.folder&&!o.contents))}return t.length===0&&i.length===0?new or:(await this._workingCopyFileService.createFolder(t,e,this._undoRedoInfo),await this._workingCopyFileService.create(i,e,this._undoRedoInfo),this._instaService.createInstance(nr,s,{isUndoing:!0}))}toString(){return`(create ${this._edits.map(e=>e.options.folder?`folder ${e.newUri}`:`file ${e.newUri} with ${e.contents?.byteLength||0} bytes`).join(", ")})`}};Ra=D([u(2,Le),u(3,bd),u(4,F),u(5,tn)],Ra);class zu{constructor(e,t,i){this.oldUri=e,this.options=t,this.undoesCreate=i,this.type="delete"}}let nr=class{constructor(e,t,i,s,o,n,r){this._edits=e,this._undoRedoInfo=t,this._workingCopyFileService=i,this._fileService=s,this._configurationService=o,this._instaService=n,this._logService=r}get uris(){return this._edits.map(e=>e.oldUri)}async perform(e){const t=[],i=[];for(const s of this._edits){let o;try{o=await this._fileService.resolve(s.oldUri,{resolveMetadata:!0})}catch{if(!s.options.ignoreIfNotExists)throw new Error(`${s.oldUri} does not exist and can not be deleted`);continue}t.push({resource:s.oldUri,recursive:s.options.recursive,useTrash:!s.options.skipTrashBin&&this._fileService.hasCapability(s.oldUri,Ob.Trash)&&this._configurationService.getValue("files.enableTrash")});let n,r=!1;if(!s.undoesCreate&&!s.options.folder&&(r=typeof s.options.maxSize=="number"&&o.size>s.options.maxSize,!r))try{n=await this._fileService.readFile(s.oldUri)}catch(d){this._logService.error(d)}r||i.push(new ly(s.oldUri,s.options,n?.value))}return t.length===0?new or:(await this._workingCopyFileService.delete(t,e,this._undoRedoInfo),i.length===0?new or:this._instaService.createInstance(Ra,i,{isUndoing:!0}))}toString(){return`(delete ${this._edits.map(e=>e.oldUri).join(", ")})`}};nr=D([u(2,bd),u(3,Le),u(4,ie),u(5,F),u(6,Ue)],nr);class GT{constructor(e,t,i,s){this.label=e,this.code=t,this.operations=i,this.confirmBeforeUndo=s,this.type=Ff.Workspace,this.resources=i.flatMap(o=>o.uris)}async undo(){await this._reverse()}async redo(){await this._reverse()}async _reverse(){for(let e=0;e<this.operations.length;e++){const i=await this.operations[e].perform(wi.None);this.operations[e]=i}}toString(){return this.operations.map(e=>String(e)).join(", ")}}let rh=class{constructor(e,t,i,s,o,n,r,d,l,h){this._label=e,this._code=t,this._undoRedoGroup=i,this._undoRedoSource=s,this._confirmBeforeUndo=o,this._progress=n,this._token=r,this._edits=d,this._instaService=l,this._undoRedoService=h}async apply(){const e=[],t={undoRedoGroupId:this._undoRedoGroup.id},i=[];for(const n of this._edits)n.newResource&&n.oldResource&&!n.options?.copy?i.push(new cy(n.newResource,n.oldResource,n.options??{})):n.newResource&&n.oldResource&&n.options?.copy?i.push(new WT(n.newResource,n.oldResource,n.options??{})):!n.newResource&&n.oldResource?i.push(new zu(n.oldResource,n.options??{},!1)):n.newResource&&!n.oldResource&&i.push(new ly(n.newResource,n.options??{},await n.options.contents));if(i.length===0)return[];const s=[];s[0]=[i[0]];for(let n=1;n<i.length;n++){const r=i[n],d=s.at(-1);d?.[0].type===r.type?d.push(r):s.push([r])}for(const n of s){if(this._token.isCancellationRequested)break;let r;switch(n[0].type){case"rename":r=this._instaService.createInstance(oh,n,t);break;case"copy":r=this._instaService.createInstance(nh,n,t);break;case"delete":r=this._instaService.createInstance(nr,n,t);break;case"create":r=this._instaService.createInstance(Ra,n,t);break}if(r){const d=await r.perform(this._token);e.push(d)}this._progress.report(void 0)}const o=new GT(this._label,this._code,e,this._confirmBeforeUndo);return this._undoRedoService.pushElement(o,this._undoRedoGroup,this._undoRedoSource),o.resources}};rh=D([u(8,F),u(9,vu)],rh);class hy{constructor(e){this._modelReference=e,this.model=this._modelReference.object.textEditorModel,this._edits=[]}dispose(){this._modelReference.dispose()}isNoOp(){return!(this._edits.length>0||this._newEol!==void 0&&this._newEol!==this.model.getEndOfLineSequence())}addEdit(e){this._expectedModelVersionId=e.versionId;const{textEdit:t}=e;if(typeof t.eol=="number"&&(this._newEol=t.eol),!t.range&&!t.text||ve.isEmpty(t.range)&&!t.text)return;let i;t.range?i=ve.lift(t.range):i=this.model.getFullModelRange(),this._edits.push({...Wc.replaceMove(i,t.text),insertAsSnippet:t.insertAsSnippet,keepWhitespace:t.keepWhitespace})}validate(){return typeof this._expectedModelVersionId>"u"||this.model.getVersionId()===this._expectedModelVersionId?{canApply:!0}:{canApply:!1,reason:this.model.uri}}getBeforeCursorState(){return null}apply(){this._edits.length>0&&(this._edits=this._edits.map(this._transformSnippetStringToInsertText,this).sort((e,t)=>ve.compareRangesUsingStarts(e.range,t.range)),this.model.pushEditOperations(null,this._edits,()=>null)),this._newEol!==void 0&&this.model.pushEOL(this._newEol)}_transformSnippetStringToInsertText(e){if(!e.insertAsSnippet||!e.text)return e;const t=kd.asInsertText(e.text);return{...e,insertAsSnippet:!1,text:t}}}class UT extends hy{constructor(e,t){super(e),this._editor=t}getBeforeCursorState(){return this._canUseEditor()?this._editor.getSelections():null}apply(){if(!this._canUseEditor()){super.apply();return}if(this._edits.length>0){const e=Am.get(this._editor);if(e&&this._edits.some(t=>t.insertAsSnippet)){const t=[];for(const i of this._edits)i.range&&i.text!==null&&t.push({range:ve.lift(i.range),template:i.insertAsSnippet?i.text:kd.escape(i.text),keepWhitespace:i.keepWhitespace});e.apply(t,{undoStopBefore:!1,undoStopAfter:!1})}else this._edits=this._edits.map(this._transformSnippetStringToInsertText,this).sort((t,i)=>ve.compareRangesUsingStarts(t.range,i.range)),this._editor.executeEdits("",this._edits)}this._newEol!==void 0&&this._editor.hasModel()&&this._editor.getModel().pushEOL(this._newEol)}_canUseEditor(){return this._editor?.getModel()?.uri.toString()===this.model.uri.toString()}}let ah=class{constructor(e,t,i,s,o,n,r,d,l,h,p,f){this._label=e,this._code=t,this._editor=i,this._undoRedoGroup=s,this._undoRedoSource=o,this._progress=n,this._token=r,this._editorWorker=l,this._modelService=h,this._textModelResolverService=p,this._undoRedoService=f,this._edits=new ns;for(const g of d){let m=this._edits.get(g.resource);m||(m=[],this._edits.set(g.resource,m)),m.push(g)}}_validateBeforePrepare(){for(const e of this._edits.values())for(const t of e)if(typeof t.versionId=="number"){const i=this._modelService.getModel(t.resource);if(i&&i.getVersionId()!==t.versionId)throw new Error(`${i.uri.toString()} has changed in the meantime`)}}async _createEditsTasks(){const e=[],t=[];for(const[i,s]of this._edits){const o=this._textModelResolverService.createModelReference(i).then(async n=>{let r,d=!1;if(this._editor?.getModel()?.uri.toString()===n.object.textEditorModel.uri.toString()?(r=new UT(n,this._editor),d=!0):r=new hy(n),e.push(r),!d){s.forEach(r.addEdit,r);return}const l=async(f,g)=>{const m=s.slice(f,g),v=await this._editorWorker.computeMoreMinimalEdits(n.object.textEditorModel.uri,m.map(b=>b.textEdit),!1);v?v.forEach(b=>r.addEdit(new rs(n.object.textEditorModel.uri,b,void 0,void 0))):m.forEach(r.addEdit,r)};let h=0,p=0;for(;p<s.length;p++)(s[p].textEdit.insertAsSnippet||s[p].metadata)&&(await l(h,p),r.addEdit(s[p]),h=p+1);await l(h,p)});t.push(o)}return await Promise.all(t),e}_validateTasks(e){for(const t of e){const i=t.validate();if(!i.canApply)return i}return{canApply:!0}}async apply(){this._validateBeforePrepare();const e=await this._createEditsTasks();try{if(this._token.isCancellationRequested)return[];const t=[],i=this._validateTasks(e);if(!i.canApply)throw new Error(`${i.reason.toString()} has changed in the meantime`);if(e.length===1){const s=e[0];if(!s.isNoOp()){const o=new Vp(this._label,this._code,s.model,s.getBeforeCursorState());this._undoRedoService.pushElement(o,this._undoRedoGroup,this._undoRedoSource),s.apply(),o.close(),t.push(s.model.uri)}this._progress.report(void 0)}else{const s=new Nb(this._label,this._code,e.map(o=>new Vp(this._label,this._code,o.model,o.getBeforeCursorState())));this._undoRedoService.pushElement(s,this._undoRedoGroup,this._undoRedoSource);for(const o of e)o.apply(),this._progress.report(void 0),t.push(o.model.uri);s.close()}return t}finally{qe(e)}}};ah=D([u(8,Bb),u(9,Cd),u(10,sn),u(11,vu)],ah);class js extends Fb{static is(e){return e instanceof js?!0:Kb(e)&&!!(e.undo&&e.redo)}static lift(e){return e instanceof js?e:new js(e.resource,e.undo,e.redo,e.metadata)}constructor(e,t,i,s){super(s),this.resource=e,this.undo=t,this.redo=i}}let dh=class{constructor(e,t,i,s,o,n){this._undoRedoGroup=e,this._undoRedoSource=t,this._progress=i,this._token=s,this._edits=o,this._undoRedoService=n}async apply(){const e=[];for(const t of this._edits){if(this._token.isCancellationRequested)break;await t.redo(),this._undoRedoService.pushElement({type:Ff.Resource,resource:t.resource,label:t.metadata?.label||"Custom Edit",code:"paste",undo:t.undo,redo:t.redo},this._undoRedoGroup,this._undoRedoSource),this._progress.report(void 0),e.push(t.resource)}return e}};dh=D([u(5,vu)],dh);function HT(a){return a.map(e=>{if(rs.is(e))return rs.lift(e);if(oi.is(e))return oi.lift(e);if(ba.is(e))return ba.lift(e);if(js.is(e))return js.lift(e);throw new Error("Unsupported edit")})}let ch=class{constructor(e,t,i,s,o,n,r,d,l,h,p){this._label=e,this._code=t,this._editor=i,this._progress=s,this._token=o,this._edits=n,this._undoRedoGroup=r,this._undoRedoSource=d,this._confirmBeforeUndo=l,this._instaService=h,this._logService=p}ariaMessage(){const e=new ns,t=new ns;let i=0;for(const s of this._edits)s instanceof rs?(i+=1,t.set(s.resource,!0)):s instanceof oi&&e.set(s.oldResource??s.newResource,!0);return this._edits.length===0?c(4231,"Made no edits"):e.size===0?i>1&&t.size>1?c(4232,"Made {0} text edits in {1} files",i,t.size):c(4233,"Made {0} text edits in one file",i):c(4234,"Made {0} text edits in {1} files, also created or deleted {2} files",i,t.size,e.size)}async perform(){if(this._edits.length===0)return[];const e=[1];for(let n=1;n<this._edits.length;n++)Object.getPrototypeOf(this._edits[n-1])===Object.getPrototypeOf(this._edits[n])?e[e.length-1]++:e.push(1);const t=this._edits.length>1?0:void 0;this._progress.report({increment:t,total:100});const i={report:n=>this._progress.report({increment:100/this._edits.length})},s=[];let o=0;for(const n of e){if(this._token.isCancellationRequested)break;const r=this._edits.slice(o,o+n);r[0]instanceof oi?s.push(await this._performFileEdits(r,this._undoRedoGroup,this._undoRedoSource,this._confirmBeforeUndo,i)):r[0]instanceof rs?s.push(await this._performTextEdits(r,this._undoRedoGroup,this._undoRedoSource,i)):r[0]instanceof ba?s.push(await this._performCellEdits(r,this._undoRedoGroup,this._undoRedoSource,i)):r[0]instanceof js?s.push(await this._performOpaqueEdits(r,this._undoRedoGroup,this._undoRedoSource,i)):console.log("UNKNOWN EDIT"),o=o+n}return s.flat()}async _performFileEdits(e,t,i,s,o){return this._logService.debug("_performFileEdits",JSON.stringify(e)),await this._instaService.createInstance(rh,this._label||c(4235,"Workspace Edit"),this._code||"undoredo.workspaceEdit",t,i,s,o,this._token,e).apply()}async _performTextEdits(e,t,i,s){return this._logService.debug("_performTextEdits",JSON.stringify(e)),await this._instaService.createInstance(ah,this._label||c(4235,"Workspace Edit"),this._code||"undoredo.workspaceEdit",this._editor,t,i,s,this._token,e).apply()}async _performCellEdits(e,t,i,s){return this._logService.debug("_performCellEdits",JSON.stringify(e)),await this._instaService.createInstance(a_,t,i,s,this._token,e).apply()}async _performOpaqueEdits(e,t,i,s){return this._logService.debug("_performOpaqueEdits",JSON.stringify(e)),await this._instaService.createInstance(dh,t,i,s,this._token,e).apply()}};ch=D([u(9,F),u(10,Ue)],ch);let lh=class{constructor(e,t,i,s,o,n,r){this._instaService=e,this._logService=t,this._editorService=i,this._lifecycleService=s,this._dialogService=o,this._workingCopyService=n,this._configService=r,this._activeUndoRedoGroups=new Kf}setPreviewHandler(e){return this._previewHandler=e,ae(()=>{this._previewHandler===e&&(this._previewHandler=void 0)})}hasPreviewHandler(){return!!this._previewHandler}async apply(e,t){let i=HT(Array.isArray(e)?e:e.edits);if(i.length===0)return{ariaSummary:c(4236,"Made no edits"),isApplied:!1};this._previewHandler&&(t?.showPreview||i.some(h=>h.metadata?.needsConfirmation))&&(i=await this._previewHandler(i,t));let s=t?.editor;if(!s){const h=this._editorService.activeTextEditorControl;OD(h)?s=h:ND(h)&&(s=h.getModifiedEditor())}s&&s.getOption(Pt.readOnly)&&(s=void 0);let o,n=()=>{};if(typeof t?.undoRedoGroupId=="number"){for(const h of this._activeUndoRedoGroups)if(h.id===t.undoRedoGroupId){o=h;break}}o||(o=new Wb,n=this._activeUndoRedoGroups.push(o));const r=t?.quotableLabel||t?.label,d=this._instaService.createInstance(ch,r,t?.code,s,t?.progress??Pf.None,t?.token??wi.None,i,o,t?.undoRedoSource,!!t?.confirmBeforeUndo);let l;try{l=this._lifecycleService.onBeforeShutdown(p=>p.veto(this._shouldVeto(r,p.reason),"veto.blukEditService"));const h=await d.perform();return t?.respectAutoSaveConfig&&this._configService.getValue(uy)===!0&&h.length>1&&await this._saveAll(h),{ariaSummary:d.ariaMessage(),isApplied:i.length>0}}catch(h){throw this._logService.error(h),h}finally{l?.dispose(),n()}}async _saveAll(e){const t=new Gb(e),i=this._workingCopyService.dirtyWorkingCopies.map(async o=>{t.has(o.resource)&&await o.save()}),s=await Promise.allSettled(i);for(const o of s)o.status==="rejected"&&this._logService.warn(o.reason)}async _shouldVeto(e,t){let i,s;switch(t){case Rn.CLOSE:i=c(4237,"Are you sure you want to close the window?"),s=c(4238,"&&Close Window");break;case Rn.LOAD:i=c(4239,"Are you sure you want to change the workspace?"),s=c(4240,"Change &&Workspace");break;case Rn.RELOAD:i=c(4241,"Are you sure you want to reload the window?"),s=c(4242,"&&Reload Window");break;default:i=c(4243,"Are you sure you want to quit?"),s=c(4244,"&&Quit");break}return!(await this._dialogService.confirm({message:i,detail:c(4245,"'{0}' is in progress.",e||c(4246,"File operation")),primaryButton:s})).confirmed}};lh=D([u(0,F),u(1,Ue),u(2,Q),u(3,qo),u(4,ao),u(5,Wf),u(6,ie)],lh);const uy="files.refactoring.autoSave";H.as(xs.Configuration).registerConfiguration({id:"files",properties:{[uy]:{description:c(4247,"Controls if files that were part of a refactoring are saved automatically"),default:!0,type:"boolean"}}});const zT=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));let hh=class{constructor(e,t,i,s){this._conflicts=new ns,this._disposables=new O,this._onDidConflict=new E,this.onDidConflict=this._onDidConflict.event;const o=new ns;for(const r of e)if(r instanceof rs){if(o.set(r.resource,!0),typeof r.versionId=="number"){const d=i.getModel(r.resource);d&&d.getVersionId()!==r.versionId&&(this._conflicts.set(r.resource,!0),this._onDidConflict.fire(this))}}else r instanceof oi?r.newResource?o.set(r.newResource,!0):r.oldResource&&o.set(r.oldResource,!0):r instanceof ba?o.set(r.resource,!0):s.warn("UNKNOWN edit type",r);this._disposables.add(t.onDidFilesChange(r=>{for(const d of o.keys())if(!i.getModel(d)&&r.contains(d)){this._conflicts.set(d,!0),this._onDidConflict.fire(this);break}}));const n=r=>{o.has(r.uri)&&(this._conflicts.set(r.uri,!0),this._onDidConflict.fire(this))};for(const r of i.getModels())this._disposables.add(r.onDidChangeContent(()=>n(r)))}dispose(){this._disposables.dispose(),this._onDidConflict.dispose()}list(){return[...this._conflicts.keys()]}hasConflicts(){return this._conflicts.size>0}};hh=D([u(1,Le),u(2,Cd),u(3,Ue)],hh);var uh,En;class $T{constructor(){this._states=new WeakMap,this._checkedCount=0,this._onDidChange=new E,this.onDidChange=this._onDidChange.event}dispose(){this._onDidChange.dispose()}get checkedCount(){return this._checkedCount}isChecked(e){return this._states.get(e)??!1}updateChecked(e,t){const i=this._states.get(e);i!==t&&(i===void 0?t&&(this._checkedCount+=1):t?this._checkedCount+=1:this._checkedCount-=1,this._states.set(e,t),this._onDidChange.fire(e))}}class jT{constructor(e,t){this.parent=e,this.textEdit=t}}var Be;(function(a){a[a.TextEdit=1]="TextEdit",a[a.Create=2]="Create",a[a.Delete=4]="Delete",a[a.Rename=8]="Rename"})(Be||(Be={}));class qT{constructor(e,t){this.uri=e,this.parent=t,this.type=0,this.textEdits=[],this.originalEdits=new Map}addEdit(e,t,i){this.type|=t,this.originalEdits.set(e,i),i instanceof rs?this.textEdits.push(new jT(this,i)):t===Be.Rename&&(this.newUri=i.newResource)}needsConfirmation(){for(const[,e]of this.originalEdits)if(!this.parent.checked.isChecked(e))return!0;return!1}}class La{static{this._defaultMetadata=Object.freeze({label:c(4264,"Other"),icon:k.symbolFile,needsConfirmation:!1})}static keyOf(e){return e?.label||"<default>"}constructor(e=La._defaultMetadata){this.metadata=e,this.operationByResource=new Map}get fileOperations(){return this.operationByResource.values()}}let Va=uh=class{static async create(e,t){return await e.get(F).createInstance(uh,t)._init()}constructor(e,t,i){this._bulkEdit=e,this._fileService=t,this.checked=new $T,this.fileOperations=[],this.categories=[],this.conflicts=i.createInstance(hh,e)}dispose(){this.checked.dispose(),this.conflicts.dispose()}async _init(){const e=new Map,t=new Map,i=new ns;for(let s=0;s<this._bulkEdit.length;s++){const o=this._bulkEdit[s];let n,r;if(this.checked.updateChecked(o,!o.metadata?.needsConfirmation),o instanceof rs)r=Be.TextEdit,n=o.resource;else if(o instanceof oi)if(o.newResource&&o.oldResource){if(r=Be.Rename,n=o.oldResource,o.options?.overwrite===void 0&&o.options?.ignoreIfExists&&await this._fileService.exists(n))continue;i.set(o.newResource,n)}else if(o.oldResource){if(r=Be.Delete,n=o.oldResource,o.options?.ignoreIfNotExists&&!await this._fileService.exists(n))continue}else if(o.newResource){if(r=Be.Create,n=o.newResource,o.options?.overwrite===void 0&&o.options?.ignoreIfExists&&await this._fileService.exists(n))continue}else continue;else continue;const d=(p,f)=>{let g=Pp.getComparisonKey(p,!0),m=f.get(g);!m&&i.has(p)&&(p=i.get(p),g=Pp.getComparisonKey(p,!0),m=f.get(g)),m||(m=new qT(p,this),f.set(g,m)),m.addEdit(s,r,o)};d(n,e);const l=La.keyOf(o.metadata);let h=t.get(l);h||(h=new La(o.metadata),t.set(l,h)),d(n,h.operationByResource)}e.forEach(s=>this.fileOperations.push(s)),t.forEach(s=>this.categories.push(s));for(const s of this.fileOperations)if(s.type!==Be.TextEdit){let o=!0;for(const n of s.originalEdits.values())n instanceof oi&&(o=o&&this.checked.isChecked(n));if(!o)for(const n of s.originalEdits.values())this.checked.updateChecked(n,o)}return this.categories.sort((s,o)=>s.metadata.needsConfirmation===o.metadata.needsConfirmation?s.metadata.label.localeCompare(o.metadata.label):s.metadata.needsConfirmation?-1:1),this}getWorkspaceEdit(){const e=[];let t=!0;for(let i=0;i<this._bulkEdit.length;i++){const s=this._bulkEdit[i];if(this.checked.isChecked(s)){e[i]=s;continue}t=!1}return t?this._bulkEdit:(zb(e),e)}async getFileEditOperation(e){const t=await e.options.contents;if(t)return Wc.replaceMove(ve.lift({startLineNumber:0,startColumn:0,endLineNumber:Number.MAX_VALUE,endColumn:0}),t.toString())}async getFileEdits(e){for(const t of this.fileOperations)if(t.uri.toString()===e.toString()){const i=[];let s=!1;for(const o of t.originalEdits.values())o instanceof oi?i.push(this.getFileEditOperation(o)):o instanceof rs?this.checked.isChecked(o)&&i.push(Promise.resolve(Wc.replaceMove(ve.lift(o.textEdit.range),o.textEdit.insertAsSnippet?kd.asInsertText(o.textEdit.text):o.textEdit.text))):this.checked.isChecked(o)||(s=!0);return s?[]:(await Promise.all(i)).filter(o=>o!==void 0).sort((o,n)=>ve.compareRangesUsingStarts(o.range,n.range))}return[]}getUriOfEdit(e){for(const t of this.fileOperations)for(const i of t.originalEdits.values())if(i===e)return t.uri;throw new Error("invalid edit")}};Va=uh=D([u(1,Le),u(2,F)],Va);let Pa=class{static{En=this}static{this.Schema="vscode-bulkeditpreview-editor"}static{this.emptyPreview=U.from({scheme:this.Schema,fragment:"empty"})}static fromPreviewUri(e){return U.parse(e.query)}constructor(e,t,i,s){this._operations=e,this._languageService=t,this._modelService=i,this._textModelResolverService=s,this._disposables=new O,this._modelPreviewEdits=new Map,this._instanceId=Yo(),this._disposables.add(this._textModelResolverService.registerTextModelContentProvider(En.Schema,this)),this._ready=this._init()}dispose(){this._disposables.dispose()}asPreviewUri(e){return U.from({scheme:En.Schema,authority:this._instanceId,path:e.path,query:e.toString()})}async _init(){for(const e of this._operations.fileOperations)await this._applyTextEditsToPreviewModel(e.uri);this._disposables.add(V.debounce(this._operations.checked.onDidChange,(e,t)=>t,Ub)(e=>{const t=this._operations.getUriOfEdit(e);this._applyTextEditsToPreviewModel(t)}))}async _applyTextEditsToPreviewModel(e){const t=await this._getOrCreatePreviewModel(e),i=this._modelPreviewEdits.get(t.id);i&&t.applyEdits(i);const s=await this._operations.getFileEdits(e),o=t.applyEdits(s,!0);this._modelPreviewEdits.set(t.id,o)}async _getOrCreatePreviewModel(e){const t=this.asPreviewUri(e);let i=this._modelService.getModel(t);if(!i){try{const s=await this._textModelResolverService.createModelReference(e),o=s.object.textEditorModel;i=this._modelService.createModel(Hb(o.createSnapshot()),this._languageService.createById(o.getLanguageId()),t),s.dispose()}catch{i=this._modelService.createModel("",this._languageService.createByFilepathOrFirstLine(t),t)}queueMicrotask(async()=>{this._disposables.add(await this._textModelResolverService.createModelReference(i.uri))})}return i}async provideTextContent(e){return e.toString()===En.emptyPreview.toString()?this._modelService.createModel("",null,e):(await this._ready,this._modelService.getModel(e))}};Pa=En=D([u(1,Zo),u(2,Cd),u(3,sn)],Pa);var ph,gh,fh;class Ut{constructor(e,t){this.parent=e,this.category=t}isChecked(){const e=this.parent;let t=!0;for(const i of this.category.fileOperations)for(const s of i.originalEdits.values())t=t&&e.checked.isChecked(s);return t}setChecked(e){const t=this.parent;for(const i of this.category.fileOperations)for(const s of i.originalEdits.values())t.checked.updateChecked(s,e)}}class $t{constructor(e,t){this.parent=e,this.edit=t}isChecked(){const e=this.parent instanceof Ut?this.parent.parent:this.parent;let t=!0;this.edit.type===Be.TextEdit&&(t=!this.edit.textEdits.every(i=>!e.checked.isChecked(i.textEdit)));for(const i of this.edit.originalEdits.values())i instanceof oi&&(t=t&&e.checked.isChecked(i));if(this.parent instanceof Ut&&this.edit.type===Be.TextEdit){for(const i of e.categories)for(const s of i.fileOperations)if(s.uri.toString()===this.edit.uri.toString())for(const o of s.originalEdits.values())o instanceof oi&&(t=t&&e.checked.isChecked(o))}return t}setChecked(e){const t=this.parent instanceof Ut?this.parent.parent:this.parent;for(const i of this.edit.originalEdits.values())t.checked.updateChecked(i,e);if(this.parent instanceof Ut&&this.edit.type!==Be.TextEdit){for(const i of t.categories)for(const s of i.fileOperations)if(s.uri.toString()===this.edit.uri.toString())for(const o of s.originalEdits.values())t.checked.updateChecked(o,e)}}isDisabled(){if(this.parent instanceof Ut&&this.edit.type===Be.TextEdit){const e=this.parent.parent;let t=!0;for(const i of e.categories)for(const s of i.fileOperations)if(s.uri.toString()===this.edit.uri.toString())for(const o of s.originalEdits.values())o instanceof oi&&(t=t&&e.checked.isChecked(o));return!t}return!1}}class ds{constructor(e,t,i,s,o,n,r){this.parent=e,this.idx=t,this.edit=i,this.prefix=s,this.selecting=o,this.inserting=n,this.suffix=r}isChecked(){let e=this.parent.parent;return e instanceof Ut&&(e=e.parent),e.checked.isChecked(this.edit.textEdit)}setChecked(e){let t=this.parent.parent;if(t instanceof Ut&&(t=t.parent),t.checked.updateChecked(this.edit.textEdit,e),e)for(const i of this.parent.edit.originalEdits.values())i instanceof oi&&t.checked.updateChecked(i,e)}isDisabled(){return this.parent.isDisabled()}}let mh=class{constructor(e,t){this._textModelService=e,this._instantiationService=t,this.groupByFile=!0}hasChildren(e){return e instanceof $t?e.edit.textEdits.length>0:!(e instanceof ds)}async getChildren(e){if(e instanceof Va)return this.groupByFile?e.fileOperations.map(t=>new $t(e,t)):e.categories.map(t=>new Ut(e,t));if(e instanceof Ut)return Array.from(e.category.fileOperations,t=>new $t(e,t));if(e instanceof $t&&e.edit.textEdits.length>0){let t,i;try{const o=await this._textModelService.createModelReference(e.edit.uri);t=o.object.textEditorModel,i=o}catch{t=this._instantiationService.createInstance(Mp,"",ga,Mp.DEFAULT_CREATION_OPTIONS,null),i=t}const s=e.edit.textEdits.map((o,n)=>{const r=t.validateRange(o.textEdit.textEdit.range),d=t.tokenization.getLineTokens(r.startLineNumber);let l=23;for(let f=d.findTokenIndexAtOffset(r.startColumn-1)-1;l<50&&f>=0;f--)l=r.startColumn-d.getStartOffset(f);const h=t.tokenization.getLineTokens(r.endLineNumber);let p=0;for(let f=h.findTokenIndexAtOffset(r.endColumn-1);p<50&&f<h.getCount();f++)p+=h.getEndOffset(f)-h.getStartOffset(f);return new ds(e,n,o,t.getValueInRange(new ve(r.startLineNumber,r.startColumn-l,r.startLineNumber,r.startColumn)),t.getValueInRange(r),o.textEdit.textEdit.insertAsSnippet?kd.asInsertText(o.textEdit.textEdit.text):o.textEdit.textEdit.text,t.getValueInRange(new ve(r.endLineNumber,r.endColumn,r.endLineNumber,r.endColumn+p)))});return i.dispose(),s}return[]}};mh=D([u(0,sn),u(1,F)],mh);class YT{compare(e,t){return e instanceof $t&&t instanceof $t?py(e.edit,t.edit):e instanceof ds&&t instanceof ds?ve.compareRangesUsingStarts(e.edit.textEdit.textEdit.range,t.edit.textEdit.textEdit.range):0}}function py(a,e){return _d(a.uri.toString(),e.uri.toString())}let wh=class{constructor(e){this._labelService=e}getWidgetAriaLabel(){return c(4265,"Bulk Edit")}getRole(e){return"checkbox"}getAriaLabel(e){if(e instanceof $t){if(e.edit.textEdits.length>0)return e.edit.type&Be.Rename&&e.edit.newUri?c(4266,"Renaming {0} to {1}, also making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:!0}),this._labelService.getUriLabel(e.edit.newUri,{relative:!0})):e.edit.type&Be.Create?c(4267,"Creating {0}, also making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:!0})):e.edit.type&Be.Delete?c(4268,"Deleting {0}, also making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:!0})):c(4269,"{0}, making text edits",this._labelService.getUriLabel(e.edit.uri,{relative:!0}));if(e.edit.type&Be.Rename&&e.edit.newUri)return c(4270,"Renaming {0} to {1}",this._labelService.getUriLabel(e.edit.uri,{relative:!0}),this._labelService.getUriLabel(e.edit.newUri,{relative:!0}));if(e.edit.type&Be.Create)return c(4271,"Creating {0}",this._labelService.getUriLabel(e.edit.uri,{relative:!0}));if(e.edit.type&Be.Delete)return c(4272,"Deleting {0}",this._labelService.getUriLabel(e.edit.uri,{relative:!0}))}if(e instanceof ds){if(e.selecting.length>0&&e.inserting.length>0)return c(4273,"line {0}, replacing {1} with {2}",e.edit.textEdit.textEdit.range.startLineNumber,e.selecting,e.inserting);if(e.selecting.length>0&&e.inserting.length===0)return c(4274,"line {0}, removing {1}",e.edit.textEdit.textEdit.range.startLineNumber,e.selecting);if(e.selecting.length===0&&e.inserting.length>0)return c(4275,"line {0}, inserting {1}",e.edit.textEdit.textEdit.range.startLineNumber,e.selecting)}return null}};wh=D([u(0,Fi)],wh);class JT{getId(e){return e instanceof $t?e.edit.uri+(e.parent instanceof Ut?JSON.stringify(e.parent.category.metadata):""):e instanceof ds?e.parent.edit.uri.toString()+e.idx:JSON.stringify(e.category.metadata)}}class ZT{constructor(e){e.classList.add("category"),this.icon=document.createElement("div"),e.appendChild(this.icon),this.label=new Sd(e)}}let Ma=class{static{ph=this}static{this.id="CategoryElementRenderer"}constructor(e){this._themeService=e,this.templateId=ph.id}renderTemplate(e){return new ZT(e)}renderElement(e,t,i){i.icon.style.setProperty("--background-dark",null),i.icon.style.setProperty("--background-light",null),i.icon.style.color="";const{metadata:s}=e.element.category;if(Ce.isThemeIcon(s.iconPath)){const o=Ce.asClassName(s.iconPath);i.icon.className=o?`theme-icon ${o}`:"",i.icon.style.color=s.iconPath.color?this._themeService.getColorTheme().getColor(s.iconPath.color.id)?.toString()??"":""}else U.isUri(s.iconPath)?(i.icon.className="uri-icon",i.icon.style.setProperty("--background-dark",Ji(s.iconPath)),i.icon.style.setProperty("--background-light",Ji(s.iconPath))):s.iconPath&&(i.icon.className="uri-icon",i.icon.style.setProperty("--background-dark",Ji(s.iconPath.dark)),i.icon.style.setProperty("--background-light",Ji(s.iconPath.light)));i.label.setLabel(s.label,s.description,{descriptionMatches:Ko(e.filterData)})}disposeTemplate(e){e.label.dispose()}};Ma=ph=D([u(0,me)],Ma);let yh=class{constructor(e,t,i){this._labelService=i,this._disposables=new O,this._localDisposables=new O,this._checkbox=document.createElement("input"),this._checkbox.className="edit-checkbox",this._checkbox.type="checkbox",this._checkbox.setAttribute("role","checkbox"),e.appendChild(this._checkbox),this._label=t.create(e,{supportHighlights:!0}),this._details=document.createElement("span"),this._details.className="details",e.appendChild(this._details)}dispose(){this._localDisposables.dispose(),this._disposables.dispose(),this._label.dispose()}set(e,t){if(this._localDisposables.clear(),this._checkbox.checked=e.isChecked(),this._checkbox.disabled=e.isDisabled(),this._localDisposables.add(Y(this._checkbox,"change",()=>{e.setChecked(this._checkbox.checked)})),e.edit.type&Be.Rename&&e.edit.newUri)this._label.setResource({resource:e.edit.uri,name:c(4276,"{0} → {1}",this._labelService.getUriLabel(e.edit.uri,{relative:!0}),this._labelService.getUriLabel(e.edit.newUri,{relative:!0}))},{fileDecorations:{colors:!0,badges:!1}}),this._details.innerText=c(4277,"(renaming)");else{const i={matches:Ko(t),fileKind:bn.FILE,fileDecorations:{colors:!0,badges:!1},extraClasses:[]};e.edit.type&Be.Create?this._details.innerText=c(4278,"(creating)"):e.edit.type&Be.Delete?(this._details.innerText=c(4279,"(deleting)"),i.extraClasses.push("delete")):this._details.innerText="",this._label.setFile(e.edit.uri,i)}}};yh=D([u(2,Fi)],yh);let Oa=class{static{gh=this}static{this.id="FileElementRenderer"}constructor(e,t){this._resourceLabels=e,this._labelService=t,this.templateId=gh.id}renderTemplate(e){return new yh(e,this._resourceLabels,this._labelService)}renderElement(e,t,i){i.set(e.element,e.filterData)}disposeTemplate(e){e.dispose()}};Oa=gh=D([u(1,Fi)],Oa);let vh=class{constructor(e,t){this._themeService=t,this._disposables=new O,this._localDisposables=new O,e.classList.add("textedit"),this._checkbox=document.createElement("input"),this._checkbox.className="edit-checkbox",this._checkbox.type="checkbox",this._checkbox.setAttribute("role","checkbox"),e.appendChild(this._checkbox),this._icon=document.createElement("div"),e.appendChild(this._icon),this._label=this._disposables.add(new $b(e))}dispose(){this._localDisposables.dispose(),this._disposables.dispose()}set(e){this._localDisposables.clear(),this._localDisposables.add(Y(this._checkbox,"change",d=>{e.setChecked(this._checkbox.checked),d.preventDefault()})),e.parent.isChecked()?(this._checkbox.checked=e.isChecked(),this._checkbox.disabled=e.isDisabled()):(this._checkbox.checked=e.isChecked(),this._checkbox.disabled=e.isDisabled());let t="";t+=e.prefix,t+=e.selecting,t+=e.inserting,t+=e.suffix;const i={start:e.prefix.length,end:e.prefix.length+e.selecting.length,extraClasses:["remove"]},s={start:i.end,end:i.end+e.inserting.length,extraClasses:["insert"]};let o;const{metadata:n}=e.edit.textEdit;n&&n.description?o=c(4280,"{0} - {1}",n.label,n.description):n&&(o=n.label);const r=n?.iconPath;if(!r)this._icon.style.display="none";else if(this._icon.style.display="block",this._icon.style.setProperty("--background-dark",null),this._icon.style.setProperty("--background-light",null),Ce.isThemeIcon(r)){const d=Ce.asClassName(r);this._icon.className=d?`theme-icon ${d}`:"",this._icon.style.color=r.color?this._themeService.getColorTheme().getColor(r.color.id)?.toString()??"":""}else U.isUri(r)?(this._icon.className="uri-icon",this._icon.style.setProperty("--background-dark",Ji(r)),this._icon.style.setProperty("--background-light",Ji(r))):(this._icon.className="uri-icon",this._icon.style.setProperty("--background-dark",Ji(r.dark)),this._icon.style.setProperty("--background-light",Ji(r.light)));this._label.set(t,[i,s],o,!0),this._icon.title=o||""}};vh=D([u(1,me)],vh);let Na=class{static{fh=this}static{this.id="TextEditElementRenderer"}constructor(e){this._themeService=e,this.templateId=fh.id}renderTemplate(e){return new vh(e,this._themeService)}renderElement({element:e},t,i){i.set(e)}disposeTemplate(e){}};Na=fh=D([u(0,me)],Na);class XT{getHeight(){return 23}getTemplateId(e){return e instanceof $t?Oa.id:e instanceof ds?Na.id:Ma.id}}class QT{getKeyboardNavigationLabel(e){if(e instanceof $t)return os(e.edit.uri);if(e instanceof Ut)return e.category.metadata.label}}var vs;Pe(zT);var Un;(function(a){a.Data="data",a.Message="message"})(Un||(Un={}));let Fe=class extends Rd{static{vs=this}static{this.ID="refactorPreview"}static{this.Schema="vscode-bulkeditpreview-multieditor"}static{this.ctxHasCategories=new j("refactorPreview.hasCategories",!1)}static{this.ctxGroupByFile=new j("refactorPreview.groupByFile",!0)}static{this.ctxHasCheckedChanges=new j("refactorPreview.hasCheckedChanges",!0)}static{this._memGroupByFile=`${this.ID}.groupByFile`}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b){super({...e,titleMenuId:w.BulkEditTitle},p,f,g,l,h,t,m,v,b),this._instaService=t,this._editorService=i,this._labelService=s,this._textModelService=o,this._dialogService=n,this._contextMenuService=r,this._storageService=d,this._treeViewStates=new Map,this._disposables=new O,this._sessionDisposables=new O,this._computeResourceDiffEditorInputs=new jb(async A=>{const K=new qb(async z=>{const Z=z.uri,ne=this._currentProvider.asPreviewUri(Z);if(z.type&Be.Delete)return{original:{resource:U.revive(ne)},modified:{resource:void 0},goToFileResource:z.uri};{let Me;try{(await this._textModelService.createModelReference(Z)).dispose(),Me=Z}catch{Me=Pa.emptyPreview}return{original:{resource:U.revive(Me)},modified:{resource:U.revive(ne)},goToFileResource:Me}}}),P=A.slice().sort(py),L=[];for(const z of P)L.push(await K.get(z));return{resources:L,getResourceDiffEditorInputIdOfOperation:async z=>{const Z=await K.get(z);return{original:Z.original.resource,modified:Z.modified.resource}}}}),this.element.classList.add("bulk-edit-panel","show-file-icons"),this._ctxHasCategories=vs.ctxHasCategories.bindTo(l),this._ctxGroupByFile=vs.ctxGroupByFile.bindTo(l),this._ctxHasCheckedChanges=vs.ctxHasCheckedChanges.bindTo(l)}dispose(){this._tree.dispose(),this._disposables.dispose(),super.dispose()}renderBody(e){super.renderBody(e);const t=this._instaService.createInstance(Rm,{onDidChangeVisibility:this.onDidChangeBodyVisibility});this._disposables.add(t);const i=document.createElement("div");i.className="content",e.appendChild(i);const s=document.createElement("div");i.appendChild(s),this._treeDataSource=this._instaService.createInstance(mh),this._treeDataSource.groupByFile=this._storageService.getBoolean(vs._memGroupByFile,G.PROFILE,!0),this._ctxGroupByFile.set(this._treeDataSource.groupByFile),this._tree=this._instaService.createInstance(Ed,this.id,s,new XT,[this._instaService.createInstance(Na),this._instaService.createInstance(Oa,t),this._instaService.createInstance(Ma)],this._treeDataSource,{accessibilityProvider:this._instaService.createInstance(wh),identityProvider:new JT,expandOnlyOnTwistieClick:!0,multipleSelectionSupport:!1,keyboardNavigationLabelProvider:new QT,sorter:new YT,selectionNavigation:!0}),this._disposables.add(this._tree.onContextMenu(this._onContextMenu,this)),this._disposables.add(this._tree.onDidOpen(l=>this._openElementInMultiDiffEditor(l)));const o=document.createElement("div");o.className="buttons",i.appendChild(o);const n=new Lf(o);this._disposables.add(n);const r=n.addButton({supportIcons:!0,...Yn});r.label=c(4259,"Apply"),r.onDidClick(()=>this.accept(),this,this._disposables);const d=n.addButton({...Yn,secondary:!0});d.label=c(4260,"Discard"),d.onDidClick(()=>this.discard(),this,this._disposables),this._message=document.createElement("span"),this._message.className="message",this._message.innerText=c(4261,"Invoke a code action, like rename, to see a preview of its changes here."),e.appendChild(this._message),this._setState(Un.Message)}layoutBody(e,t){super.layoutBody(e,t);const i=e-50;this._tree.getHTMLElement().parentElement.style.height=`${i}px`,this._tree.layout(i,t)}_setState(e){this.element.dataset.state=e}async setInput(e,t){this._setState(Un.Data),this._sessionDisposables.clear(),this._treeViewStates.clear(),this._currentResolve&&(this._currentResolve(void 0),this._currentResolve=void 0);const i=await this._instaService.invokeFunction(Va.create,e);this._currentProvider=this._instaService.createInstance(Pa,i),this._sessionDisposables.add(this._currentProvider),this._sessionDisposables.add(i);const s=i.categories.length>1;return this._ctxHasCategories.set(s),this._treeDataSource.groupByFile=!s||this._treeDataSource.groupByFile,this._ctxHasCheckedChanges.set(i.checked.checkedCount>0),this._currentInput=i,new Promise(o=>{t.onCancellationRequested(()=>o(void 0)),this._currentResolve=o,this._setTreeInput(i),this._sessionDisposables.add(i.checked.onDidChange(()=>{this._tree.updateChildren(),this._ctxHasCheckedChanges.set(i.checked.checkedCount>0)}))})}hasInput(){return!!this._currentInput}async _setTreeInput(e){const t=this._treeViewStates.get(this._treeDataSource.groupByFile);if(await this._tree.setInput(e,t),this._tree.domFocus(),t)return;const i=[...this._tree.getNode(e).children].slice(0,10);for(;i.length>0;){const{element:s}=i.shift();s instanceof $t&&await this._tree.expand(s,!0),s instanceof Ut&&(await this._tree.expand(s,!0),i.push(...this._tree.getNode(s).children))}}accept(){const e=this._currentInput?.conflicts.list();if(!e||e.length===0){this._done(!0);return}let t;e.length===1?t=c(4262,"Cannot apply refactoring because '{0}' has changed in the meantime.",this._labelService.getUriLabel(e[0],{relative:!0})):t=c(4263,"Cannot apply refactoring because {0} other files have changed in the meantime.",e.length),this._dialogService.warn(t).finally(()=>this._done(!1))}discard(){this._done(!1)}_done(e){this._currentResolve?.(e?this._currentInput?.getWorkspaceEdit():void 0),this._currentInput=void 0,this._setState(Un.Message),this._sessionDisposables.clear()}toggleChecked(){const[e]=this._tree.getFocus();((e instanceof $t||e instanceof ds)&&!e.isDisabled()||e instanceof Ut)&&e.setChecked(!e.isChecked())}groupByFile(){this._treeDataSource.groupByFile||this.toggleGrouping()}groupByType(){this._treeDataSource.groupByFile&&this.toggleGrouping()}toggleGrouping(){const e=this._tree.getInput();if(e){const t=this._tree.getViewState();this._treeViewStates.set(this._treeDataSource.groupByFile,t),this._treeDataSource.groupByFile=!this._treeDataSource.groupByFile,this._setTreeInput(e),this._storageService.store(vs._memGroupByFile,this._treeDataSource.groupByFile,G.PROFILE,Re.USER),this._ctxGroupByFile.set(this._treeDataSource.groupByFile)}}async _openElementInMultiDiffEditor(e){const t=this._currentInput?.fileOperations;if(!t)return;let i,s;if(e.element instanceof ds)s=e.element.parent,i=e.element.edit.textEdit.textEdit.range;else if(e.element instanceof $t)s=e.element,i=e.element.edit.textEdits[0]?.textEdit.textEdit.range;else return;const o=await this._computeResourceDiffEditorInputs.get(t),n=await o.getResourceDiffEditorInputIdOfOperation(s.edit),r={...e.editorOptions,viewState:{revealData:{resource:n,range:i}}},d=U.from({scheme:vs.Schema}),l="Refactor Preview";this._editorService.openEditor({multiDiffSource:d,label:l,options:r,isTransient:!0,description:l,resources:o.resources},e.sideBySide?Im:d_)}_onContextMenu(e){this._contextMenuService.showContextMenu({menuId:w.BulkEditContext,contextKeyService:this.contextKeyService,getAnchor:()=>e.anchor})}};Fe=vs=D([u(1,F),u(2,Q),u(3,Fi),u(4,sn),u(5,ao),u(6,at),u(7,ce),u(8,se),u(9,Ye),u(10,it),u(11,at),u(12,ie),u(13,Tt),u(14,me),u(15,At)],Fe);var bh;async function ho(a){const e=await a.openView(Fe.ID,!0);if(e instanceof Fe)return e}let Ch=class{constructor(e,t){this._paneCompositeService=e,this._editorGroupsService=t,this._activePanel=e.getActivePaneComposite(q.Panel)?.getId()}async restore(e,t){if(e&&(typeof this._activePanel=="string"?await this._paneCompositeService.openPaneComposite(this._activePanel,q.Panel):this._paneCompositeService.hideActivePaneComposite(q.Panel)),t)for(const i of this._editorGroupsService.groups){const s=[];for(const o of i.editors)Bt.getCanonicalUri(o,{supportSideBySide:Li.PRIMARY})?.scheme===Fe.Schema&&s.push(o);s.length&&i.closeEditors(s,{preserveFocus:!0})}}};Ch=D([u(0,Ls),u(1,Je)],Ch);class $g{constructor(e,t=new Ts){this.uxState=e,this.cts=t}}let ri=class{static{bh=this}static{this.ID="workbench.contrib.bulkEditPreview"}static{this.ctxEnabled=new j("refactorPreview.enabled",!1)}constructor(e,t,i,s,o,n){this._paneCompositeService=e,this._viewsService=t,this._editorGroupsService=i,this._dialogService=s,o.setPreviewHandler(r=>this._previewEdit(r)),this._ctxEnabled=bh.ctxEnabled.bindTo(n)}async _previewEdit(e){this._ctxEnabled.set(!0);const t=this._activeSession?.uxState??new Ch(this._paneCompositeService,this._editorGroupsService),i=await ho(this._viewsService);if(!i)return this._ctxEnabled.set(!1),e;if(i.hasInput()){const{confirmed:o}=await this._dialogService.confirm({type:_e.Info,message:c(4248,"Another refactoring is being previewed."),detail:c(4249,"Press 'Continue' to discard the previous refactoring and continue with the current refactoring."),primaryButton:c(4250,"&&Continue")});if(!o)return[]}let s;this._activeSession?(await this._activeSession.uxState.restore(!1,!0),this._activeSession.cts.dispose(!0),s=new $g(t)):s=new $g(t),this._activeSession=s;try{return await i.setInput(e,s.cts.token)??[]}finally{this._activeSession===s&&(await this._activeSession.uxState.restore(!0,!0),this._activeSession.cts.dispose(),this._ctxEnabled.set(!1),this._activeSession=void 0)}}};ri=bh=D([u(0,Ls),u(1,gt),u(2,Je),u(3,ao),u(4,Gf),u(5,se)],ri);C(class extends X{constructor(){super({id:"refactorPreview.apply",title:x(4251,"Apply Refactoring"),category:x(4252,"Refactor Preview"),icon:k.check,precondition:I.and(ri.ctxEnabled,Fe.ctxHasCheckedChanges),menu:[{id:w.BulkEditContext,order:1}],keybinding:{weight:W.EditorContrib-10,when:I.and(ri.ctxEnabled,ta.isEqualTo(Fe.ID)),primary:N.CtrlCmd+y.Enter}})}async run(e){const t=e.get(gt);(await ho(t))?.accept()}});C(class extends X{constructor(){super({id:"refactorPreview.discard",title:x(4253,"Discard Refactoring"),category:x(4252,"Refactor Preview"),icon:k.clearAll,precondition:ri.ctxEnabled,menu:[{id:w.BulkEditContext,order:2}]})}async run(e){const t=e.get(gt);(await ho(t))?.discard()}});C(class extends X{constructor(){super({id:"refactorPreview.toggleCheckedState",title:x(4254,"Toggle Change"),category:x(4252,"Refactor Preview"),precondition:ri.ctxEnabled,keybinding:{weight:W.WorkbenchContrib,when:be,primary:y.Space},menu:{id:w.BulkEditContext,group:"navigation"}})}async run(e){const t=e.get(gt);(await ho(t))?.toggleChecked()}});C(class extends X{constructor(){super({id:"refactorPreview.groupByFile",title:x(4255,"Group Changes By File"),category:x(4252,"Refactor Preview"),icon:k.ungroupByRefType,precondition:I.and(Fe.ctxHasCategories,Fe.ctxGroupByFile.negate(),ri.ctxEnabled),menu:[{id:w.BulkEditTitle,when:I.and(Fe.ctxHasCategories,Fe.ctxGroupByFile.negate()),group:"navigation",order:3}]})}async run(e){const t=e.get(gt);(await ho(t))?.groupByFile()}});C(class extends X{constructor(){super({id:"refactorPreview.groupByType",title:x(4256,"Group Changes By Type"),category:x(4252,"Refactor Preview"),icon:k.groupByRefType,precondition:I.and(Fe.ctxHasCategories,Fe.ctxGroupByFile,ri.ctxEnabled),menu:[{id:w.BulkEditTitle,when:I.and(Fe.ctxHasCategories,Fe.ctxGroupByFile),group:"navigation",order:3}]})}async run(e){const t=e.get(gt);(await ho(t))?.groupByType()}});C(class extends X{constructor(){super({id:"refactorPreview.toggleGrouping",title:x(4256,"Group Changes By Type"),category:x(4252,"Refactor Preview"),icon:k.listTree,toggled:Fe.ctxGroupByFile.negate(),precondition:I.and(Fe.ctxHasCategories,ri.ctxEnabled),menu:[{id:w.BulkEditContext,order:3}]})}async run(e){const t=e.get(gt);(await ho(t))?.toggleGrouping()}});yt(ri.ID,ri,vt.BlockRestore);const gy=he("refactor-preview-view-icon",k.lightbulb,c(4257,"View icon of the refactor preview view.")),ex=H.as(pt.ViewContainersRegistry).registerViewContainer({id:Fe.ID,title:x(4258,"Refactor Preview"),hideIfEmpty:!0,ctorDescriptor:new ee(vr,[Fe.ID,{mergeViewWithContainerWhenSingleView:!0}]),icon:gy,storageId:Fe.ID},q.Panel);H.as(pt.ViewsRegistry).registerViews([{id:Fe.ID,name:x(4258,"Refactor Preview"),when:ri.ctxEnabled,ctorDescriptor:new ee(Fe),containerIcon:gy}],ex);function tx(){return{[Gf.toString()]:new ee(lh,[],!0)}}const ix=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class sa{constructor(e,t,i,s){this.item=e,this.locations=t,this.model=i,this.parent=s}static compare(e,t){let i=_d(e.item.uri.toString(),t.item.uri.toString());return i===0&&(i=ve.compareRangesUsingStarts(e.item.range,t.item.range)),i}}let sx=class{constructor(e){this.getDirection=e}hasChildren(){return!0}async getChildren(e){if(e instanceof Lm)return e.roots.map(s=>new sa(s,void 0,e,void 0));const{model:t,item:i}=e;return this.getDirection()===nt.CallsFrom?(await t.resolveOutgoingCalls(i,wi.None)).map(s=>new sa(s.to,s.fromRanges.map(o=>({range:o,uri:i.uri})),t,e)):(await t.resolveIncomingCalls(i,wi.None)).map(s=>new sa(s.from,s.fromRanges.map(o=>({range:o,uri:s.from.uri})),t,e))}},ox=class{compare(e,t){return sa.compare(e,t)}},nx=class{constructor(e){this.getDirection=e}getId(e){let t=this.getDirection()+JSON.stringify(e.item.uri)+JSON.stringify(e.item.range);return e.parent&&(t+=this.getId(e.parent)),t}};class rx{constructor(e,t){this.icon=e,this.label=t}}class zd{constructor(){this.templateId=zd.id}static{this.id="CallRenderer"}renderTemplate(e){e.classList.add("callhierarchy-element");const t=document.createElement("div");e.appendChild(t);const i=new Sd(e,{supportHighlights:!0});return new rx(t,i)}renderElement(e,t,i){const{element:s,filterData:o}=e,n=s.item.tags?.includes(Uf.Deprecated);i.icon.className="",i.icon.classList.add("inline",...Ce.asClassNameArray(Hf.toIcon(s.item.kind))),i.label.setLabel(s.item.name,s.item.detail,{labelEscapeNewLines:!0,matches:Ko(o),strikethrough:n})}disposeTemplate(e){e.label.dispose()}}let ax=class{getHeight(e){return 22}getTemplateId(e){return zd.id}},dx=class{constructor(e){this.getDirection=e}getWidgetAriaLabel(){return c(4298,"Call Hierarchy")}getAriaLabel(e){return this.getDirection()===nt.CallsFrom?c(4299,"calls from {0}",e.item.name):c(4300,"callers of {0}",e.item.name)}};var Sh;Pe(ix);var Hn;(function(a){a.Loading="loading",a.Message="message",a.Data="data"})(Hn||(Hn={}));let jg=class{static store(e,t){t.store("callHierarchyPeekLayout",JSON.stringify(e),G.PROFILE,Re.MACHINE)}static retrieve(e){const t=e.get("callHierarchyPeekLayout",G.PROFILE,"{}"),i={ratio:.7,height:17};try{return{...i,...JSON.parse(t)}}catch{return i}}constructor(e,t){this.ratio=e,this.height=t}};class cx extends Ed{}let Go=class extends Vm{static{Sh=this}static{this.TitleMenu=new w("callhierarchy/title")}constructor(e,t,i,s,o,n,r,d,l,h,p){super(e,{showFrame:!0,showArrow:!0,isResizeable:!0,isAccessible:!0},p),this._where=t,this._direction=i,this._peekViewService=o,this._editorService=n,this._textModelService=r,this._storageService=d,this._menuService=l,this._contextKeyService=h,this._instantiationService=p,this._treeViewStates=new Map,this._previewDisposable=new O,this.create(),this._peekViewService.addExclusiveWidget(e,this),this._applyTheme(s.getColorTheme()),this._disposables.add(s.onDidColorThemeChange(this._applyTheme,this)),this._disposables.add(this._previewDisposable)}dispose(){jg.store(this._layoutInfo,this._storageService),this._splitView.dispose(),this._tree.dispose(),this._editor.dispose(),super.dispose()}get direction(){return this._direction}_applyTheme(e){const t=e.getColor(Pm)||si.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Nm)||si.transparent,primaryHeadingColor:e.getColor(Om),secondaryHeadingColor:e.getColor(Mm)})}_fillHead(e){super._fillHead(e,!0);const t=this._menuService.createMenu(Sh.TitleMenu,this._contextKeyService),i=()=>{const s=Id(t.getActions());this._actionbarWidget.clear(),this._actionbarWidget.push(s,{label:!1,icon:!0})};this._disposables.add(t),this._disposables.add(t.onDidChange(i)),i()}_fillBody(e){this._layoutInfo=jg.retrieve(this._storageService),this._dim=new jt(0,0),this._parent=e,e.classList.add("call-hierarchy");const t=document.createElement("div");t.classList.add("message"),e.appendChild(t),this._message=t,this._message.tabIndex=0;const i=document.createElement("div");i.classList.add("results"),e.appendChild(i),this._splitView=new $n(i,{orientation:J.HORIZONTAL});const s=document.createElement("div");s.classList.add("editor"),i.appendChild(s);const o={scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!1},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}};this._editor=this._instantiationService.createInstance(Bm,s,o,{},this.editor);const n=document.createElement("div");n.classList.add("tree"),i.appendChild(n);const r={sorter:new ox,accessibilityProvider:new dx(()=>this._direction),identityProvider:new nx(()=>this._direction),expandOnlyOnTwistieClick:!0,overrideStyles:{listBackground:Fm}};this._tree=this._instantiationService.createInstance(cx,"CallHierarchyPeek",n,new ax,[this._instantiationService.createInstance(zd)],this._instantiationService.createInstance(sx,()=>this._direction),r),this._splitView.addView({onDidChange:V.None,element:s,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:d=>{this._dim.height&&this._editor.layout({height:this._dim.height,width:d})}},Gt.Distribute),this._splitView.addView({onDidChange:V.None,element:n,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:d=>{this._dim.height&&this._tree.layout(this._dim.height,d)}},Gt.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this._layoutInfo.ratio=this._splitView.getViewSize(0)/this._dim.width)})),this._disposables.add(this._tree.onDidChangeFocus(this._updatePreview,this)),this._disposables.add(this._editor.onMouseDown(d=>{const{event:l,target:h}=d;if(l.detail!==2)return;const[p]=this._tree.getFocus();p&&(this.dispose(),this._editorService.openEditor({resource:p.item.uri,options:{selection:h.range}}))})),this._disposables.add(this._tree.onMouseDblClick(d=>{d.target!==zf.Twistie&&d.element&&(this.dispose(),this._editorService.openEditor({resource:d.element.item.uri,options:{selection:d.element.item.selectionRange,pinned:!0}}))})),this._disposables.add(this._tree.onDidChangeSelection(d=>{const[l]=d.elements;l&&$f(d.browserEvent)&&(this.dispose(),this._editorService.openEditor({resource:l.item.uri,options:{selection:l.item.selectionRange,pinned:!0}}))}))}async _updatePreview(){const[e]=this._tree.getFocus();if(!e)return;this._previewDisposable.clear();const t={description:"call-hierarchy-decoration",stickiness:pu.NeverGrowsWhenTypingAtEdges,className:"call-decoration",overviewRuler:{color:la(Wm),position:en.Center}};let i;this._direction===nt.CallsFrom?i=e.parent?e.parent.item.uri:e.model.root.uri:i=e.item.uri;const s=await this._textModelService.createModelReference(i);this._editor.setModel(s.object.textEditorModel);const o=[];let n,r=e.locations;r||(r=[{uri:e.item.uri,range:e.item.selectionRange}]);for(const l of r)l.uri.toString()===i.toString()&&(o.push({range:l.range,options:t}),n=n?ve.plusRange(l.range,n):l.range);if(n){this._editor.revealRangeInCenter(n,ft.Immediate);const l=this._editor.createDecorationsCollection(o);this._previewDisposable.add(ae(()=>l.clear()))}this._previewDisposable.add(s);const d=this._direction===nt.CallsFrom?c(4293,"Calls from '{0}'",e.model.root.name):c(4294,"Callers of '{0}'",e.model.root.name);this.setTitle(d)}showLoading(){this._parent.dataset.state=Hn.Loading,this.setTitle(c(4295,"Loading...")),this._show()}showMessage(e){this._parent.dataset.state=Hn.Message,this.setTitle(""),this.setMetaTitle(""),this._message.innerText=e,this._show(),this._message.focus()}async showModel(e){this._show();const t=this._treeViewStates.get(this._direction);await this._tree.setInput(e,t);const i=this._tree.getNode(e).children[0];await this._tree.expand(i.element),i.children.length===0?this.showMessage(this._direction===nt.CallsFrom?c(4296,"No calls from '{0}'",e.root.name):c(4297,"No callers of '{0}'",e.root.name)):(this._parent.dataset.state=Hn.Data,(!t||this._tree.getFocus().length===0)&&this._tree.setFocus([i.children[0].element]),this._tree.domFocus(),this._updatePreview())}getModel(){return this._tree.getInput()}getFocused(){return this._tree.getFocus()[0]}async updateDirection(e){const t=this._tree.getInput();t&&e!==this._direction&&(this._treeViewStates.set(this._direction,this._tree.getViewState()),this._direction=e,await this.showModel(t))}_show(){this._isShowing||(this.editor.revealLineInCenterIfOutsideViewport(this._where.lineNumber,ft.Smooth),super.show(ve.fromPositions(this._where),this._layoutInfo.height))}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){(this._dim.height!==e||this._dim.width!==t)&&(super._doLayoutBody(e,t),this._dim=new jt(t,e),this._layoutInfo.height=this._viewZone?this._viewZone.heightInLines:this._layoutInfo.height,this._splitView.layout(t),this._splitView.resizeView(0,t*this._layoutInfo.ratio))}};Go=Sh=D([u(3,me),u(4,Km),u(5,Q),u(6,sn),u(7,ce),u(8,ps),u(9,se),u(10,F)],Go);var vo;const _h=new j("editorHasCallHierarchyProvider",!1,c(4281,"Whether a call hierarchy provider is available")),kr=new j("callHierarchyVisible",!1,c(4282,"Whether call hierarchy peek is currently showing")),rr=new j("callHierarchyDirection",void 0,{type:"string",description:c(4283,"Whether call hierarchy shows incoming or outgoing calls")});function lx(a){return a===nt.CallsFrom||a===nt.CallsTo?a:nt.CallsTo}let cs=class{static{vo=this}static{this.Id="callHierarchy"}static get(e){return e.getContribution(vo.Id)}static{this._StorageDirection="callHierarchy/defaultDirection"}constructor(e,t,i,s,o){this._editor=e,this._contextKeyService=t,this._storageService=i,this._editorService=s,this._instantiationService=o,this._dispoables=new O,this._sessionDisposables=new O,this._ctxIsVisible=kr.bindTo(this._contextKeyService),this._ctxHasProvider=_h.bindTo(this._contextKeyService),this._ctxDirection=rr.bindTo(this._contextKeyService),this._dispoables.add(V.any(e.onDidChangeModel,e.onDidChangeModelLanguage,hc.onDidChange)(()=>{this._ctxHasProvider.set(e.hasModel()&&hc.has(e.getModel()))})),this._dispoables.add(this._sessionDisposables)}dispose(){this._ctxHasProvider.reset(),this._ctxIsVisible.reset(),this._dispoables.dispose()}async startCallHierarchyFromEditor(){if(this._sessionDisposables.clear(),!this._editor.hasModel())return;const e=this._editor.getModel(),t=this._editor.getPosition();if(!hc.has(e))return;const i=new Ts,s=Lm.create(e,t,i.token),o=lx(this._storageService.get(vo._StorageDirection,G.PROFILE,nt.CallsTo));this._showCallHierarchyWidget(t,o,s,i)}async startCallHierarchyFromCallHierarchy(){if(!this._widget)return;const e=this._widget.getModel(),t=this._widget.getFocused();if(!t||!e)return;const i=await this._editorService.openCodeEditor({resource:t.item.uri},this._editor);if(!i)return;const s=e.fork(t.item);this._sessionDisposables.clear(),vo.get(i)?._showCallHierarchyWidget(ve.lift(s.root.selectionRange).getStartPosition(),this._widget.direction,Promise.resolve(s),new Ts)}_showCallHierarchyWidget(e,t,i,s){this._ctxIsVisible.set(!0),this._ctxDirection.set(t),V.any(this._editor.onDidChangeModel,this._editor.onDidChangeModelLanguage)(this.endCallHierarchy,this,this._sessionDisposables),this._widget=this._instantiationService.createInstance(Go,this._editor,e,t),this._widget.showLoading(),this._sessionDisposables.add(this._widget.onDidClose(()=>{this.endCallHierarchy(),this._storageService.store(vo._StorageDirection,this._widget.direction,G.PROFILE,Re.USER)})),this._sessionDisposables.add({dispose(){s.dispose(!0)}}),this._sessionDisposables.add(this._widget),i.then(o=>{s.token.isCancellationRequested||(o?(this._sessionDisposables.add(o),this._widget.showModel(o)):this._widget.showMessage(c(4284,"No results")))}).catch(o=>{if(ud(o)){this.endCallHierarchy();return}this._widget.showMessage(c(4285,"Failed to show call hierarchy"))})}showOutgoingCalls(){this._widget?.updateDirection(nt.CallsFrom),this._ctxDirection.set(nt.CallsFrom)}showIncomingCalls(){this._widget?.updateDirection(nt.CallsTo),this._ctxDirection.set(nt.CallsTo)}endCallHierarchy(){this._sessionDisposables.clear(),this._ctxIsVisible.set(!1),this._editor.focus()}};cs=vo=D([u(1,se),u(2,ce),u(3,co),u(4,F)],cs);fd(cs.Id,cs,md.Eager);C(class extends Ki{constructor(){super({id:"editor.showCallHierarchy",title:x(4286,"Peek Call Hierarchy"),menu:{id:w.EditorContextPeek,group:"navigation",order:1e3,when:I.and(_h,Ca.notInPeekEditor,Jn.isInEmbeddedEditor.toNegated())},keybinding:{when:Jn.editorTextFocus,weight:W.WorkbenchContrib,primary:N.Shift+N.Alt+y.KeyH},precondition:I.and(_h,Ca.notInPeekEditor),f1:!0})}async runEditorCommand(e,t){return cs.get(t)?.startCallHierarchyFromEditor()}});C(class extends Ki{constructor(){super({id:"editor.showIncomingCalls",title:x(4287,"Show Incoming Calls"),icon:he("callhierarchy-incoming",k.callIncoming,c(4288,"Icon for incoming calls in the call hierarchy view.")),precondition:I.and(kr,rr.isEqualTo(nt.CallsFrom)),keybinding:{weight:W.WorkbenchContrib,primary:N.Shift+N.Alt+y.KeyH},menu:{id:Go.TitleMenu,when:rr.isEqualTo(nt.CallsFrom),order:1}})}runEditorCommand(a,e){return cs.get(e)?.showIncomingCalls()}});C(class extends Ki{constructor(){super({id:"editor.showOutgoingCalls",title:x(4289,"Show Outgoing Calls"),icon:he("callhierarchy-outgoing",k.callOutgoing,c(4290,"Icon for outgoing calls in the call hierarchy view.")),precondition:I.and(kr,rr.isEqualTo(nt.CallsTo)),keybinding:{weight:W.WorkbenchContrib,primary:N.Shift+N.Alt+y.KeyH},menu:{id:Go.TitleMenu,when:rr.isEqualTo(nt.CallsTo),order:1}})}runEditorCommand(a,e){return cs.get(e)?.showOutgoingCalls()}});C(class extends Ki{constructor(){super({id:"editor.refocusCallHierarchy",title:x(4291,"Refocus Call Hierarchy"),precondition:kr,keybinding:{weight:W.WorkbenchContrib,primary:N.Shift+y.Enter}})}async runEditorCommand(a,e){return cs.get(e)?.startCallHierarchyFromCallHierarchy()}});C(class extends Ki{constructor(){super({id:"editor.closeCallHierarchy",title:c(4292,"Close"),icon:k.close,precondition:kr,keybinding:{weight:W.WorkbenchContrib+10,primary:y.Escape,when:I.not("config.editor.stablePeek")},menu:{id:Go.TitleMenu,order:1e3}})}runEditorCommand(a,e){return cs.get(e)?.endCallHierarchy()}});const hx=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class oa{constructor(e,t,i){this.item=e,this.model=t,this.parent=i}static compare(e,t){let i=_d(e.item.uri.toString(),t.item.uri.toString());return i===0&&(i=ve.compareRangesUsingStarts(e.item.range,t.item.range)),i}}class ux{constructor(e){this.getDirection=e}hasChildren(){return!0}async getChildren(e){if(e instanceof Gm)return e.roots.map(s=>new oa(s,e,void 0));const{model:t,item:i}=e;return this.getDirection()===rt.Supertypes?(await t.provideSupertypes(i,wi.None)).map(s=>new oa(s,t,e)):(await t.provideSubtypes(i,wi.None)).map(s=>new oa(s,t,e))}}class px{compare(e,t){return oa.compare(e,t)}}class gx{constructor(e){this.getDirection=e}getId(e){let t=this.getDirection()+JSON.stringify(e.item.uri)+JSON.stringify(e.item.range);return e.parent&&(t+=this.getId(e.parent)),t}}class fx{constructor(e,t){this.icon=e,this.label=t}}class $d{constructor(){this.templateId=$d.id}static{this.id="TypeRenderer"}renderTemplate(e){e.classList.add("typehierarchy-element");const t=document.createElement("div");e.appendChild(t);const i=new Sd(e,{supportHighlights:!0});return new fx(t,i)}renderElement(e,t,i){const{element:s,filterData:o}=e,n=s.item.tags?.includes(Uf.Deprecated);i.icon.classList.add("inline",...Ce.asClassNameArray(Hf.toIcon(s.item.kind))),i.label.setLabel(s.item.name,s.item.detail,{labelEscapeNewLines:!0,matches:Ko(o),strikethrough:n})}disposeTemplate(e){e.label.dispose()}}class mx{getHeight(e){return 22}getTemplateId(e){return $d.id}}class wx{constructor(e){this.getDirection=e}getWidgetAriaLabel(){return c(11173,"Type Hierarchy")}getAriaLabel(e){return this.getDirection()===rt.Supertypes?c(11174,"supertypes of {0}",e.item.name):c(11175,"subtypes of {0}",e.item.name)}}var Eh;Pe(hx);var zn;(function(a){a.Loading="loading",a.Message="message",a.Data="data"})(zn||(zn={}));class qg{static store(e,t){t.store("typeHierarchyPeekLayout",JSON.stringify(e),G.PROFILE,Re.MACHINE)}static retrieve(e){const t=e.get("typeHierarchyPeekLayout",G.PROFILE,"{}"),i={ratio:.7,height:17};try{return{...i,...JSON.parse(t)}}catch{return i}}constructor(e,t){this.ratio=e,this.height=t}}class yx extends Ed{}let Uo=class extends Vm{static{Eh=this}static{this.TitleMenu=new w("typehierarchy/title")}constructor(e,t,i,s,o,n,r,d,l,h,p){super(e,{showFrame:!0,showArrow:!0,isResizeable:!0,isAccessible:!0},p),this._where=t,this._direction=i,this._peekViewService=o,this._editorService=n,this._textModelService=r,this._storageService=d,this._menuService=l,this._contextKeyService=h,this._instantiationService=p,this._treeViewStates=new Map,this._previewDisposable=new O,this.create(),this._peekViewService.addExclusiveWidget(e,this),this._applyTheme(s.getColorTheme()),this._disposables.add(s.onDidColorThemeChange(this._applyTheme,this)),this._disposables.add(this._previewDisposable)}dispose(){qg.store(this._layoutInfo,this._storageService),this._splitView.dispose(),this._tree.dispose(),this._editor.dispose(),super.dispose()}get direction(){return this._direction}_applyTheme(e){const t=e.getColor(Pm)||si.transparent;this.style({arrowColor:t,frameColor:t,headerBackgroundColor:e.getColor(Nm)||si.transparent,primaryHeadingColor:e.getColor(Om),secondaryHeadingColor:e.getColor(Mm)})}_fillHead(e){super._fillHead(e,!0);const t=this._menuService.createMenu(Eh.TitleMenu,this._contextKeyService),i=()=>{const s=Id(t.getActions());this._actionbarWidget.clear(),this._actionbarWidget.push(s,{label:!1,icon:!0})};this._disposables.add(t),this._disposables.add(t.onDidChange(i)),i()}_fillBody(e){this._layoutInfo=qg.retrieve(this._storageService),this._dim=new jt(0,0),this._parent=e,e.classList.add("type-hierarchy");const t=document.createElement("div");t.classList.add("message"),e.appendChild(t),this._message=t,this._message.tabIndex=0;const i=document.createElement("div");i.classList.add("results"),e.appendChild(i),this._splitView=new $n(i,{orientation:J.HORIZONTAL});const s=document.createElement("div");s.classList.add("editor"),i.appendChild(s);const o={scrollBeyondLastLine:!1,scrollbar:{verticalScrollbarSize:14,horizontal:"auto",useShadows:!0,verticalHasArrows:!1,horizontalHasArrows:!1,alwaysConsumeMouseWheel:!1},overviewRulerLanes:2,fixedOverflowWidgets:!0,minimap:{enabled:!1}};this._editor=this._instantiationService.createInstance(Bm,s,o,{},this.editor);const n=document.createElement("div");n.classList.add("tree"),i.appendChild(n);const r={sorter:new px,accessibilityProvider:new wx(()=>this._direction),identityProvider:new gx(()=>this._direction),expandOnlyOnTwistieClick:!0,overrideStyles:{listBackground:Fm}};this._tree=this._instantiationService.createInstance(yx,"TypeHierarchyPeek",n,new mx,[this._instantiationService.createInstance($d)],this._instantiationService.createInstance(ux,()=>this._direction),r),this._splitView.addView({onDidChange:V.None,element:s,minimumSize:200,maximumSize:Number.MAX_VALUE,layout:d=>{this._dim.height&&this._editor.layout({height:this._dim.height,width:d})}},Gt.Distribute),this._splitView.addView({onDidChange:V.None,element:n,minimumSize:100,maximumSize:Number.MAX_VALUE,layout:d=>{this._dim.height&&this._tree.layout(this._dim.height,d)}},Gt.Distribute),this._disposables.add(this._splitView.onDidSashChange(()=>{this._dim.width&&(this._layoutInfo.ratio=this._splitView.getViewSize(0)/this._dim.width)})),this._disposables.add(this._tree.onDidChangeFocus(this._updatePreview,this)),this._disposables.add(this._editor.onMouseDown(d=>{const{event:l,target:h}=d;if(l.detail!==2)return;const[p]=this._tree.getFocus();p&&(this.dispose(),this._editorService.openEditor({resource:p.item.uri,options:{selection:h.range}}))})),this._disposables.add(this._tree.onMouseDblClick(d=>{d.target!==zf.Twistie&&d.element&&(this.dispose(),this._editorService.openEditor({resource:d.element.item.uri,options:{selection:d.element.item.selectionRange,pinned:!0}}))})),this._disposables.add(this._tree.onDidChangeSelection(d=>{const[l]=d.elements;l&&$f(d.browserEvent)&&(this.dispose(),this._editorService.openEditor({resource:l.item.uri,options:{selection:l.item.selectionRange,pinned:!0}}))}))}async _updatePreview(){const[e]=this._tree.getFocus();if(!e)return;this._previewDisposable.clear();const t={description:"type-hierarchy-decoration",stickiness:pu.NeverGrowsWhenTypingAtEdges,className:"type-decoration",overviewRuler:{color:la(Wm),position:en.Center}};let i;this._direction===rt.Supertypes?i=e.parent?e.parent.item.uri:e.model.root.uri:i=e.item.uri;const s=await this._textModelService.createModelReference(i);this._editor.setModel(s.object.textEditorModel);const o=[];let n;const r={uri:e.item.uri,range:e.item.selectionRange};if(r.uri.toString()===i.toString()&&(o.push({range:r.range,options:t}),n=n?ve.plusRange(r.range,n):r.range),n){this._editor.revealRangeInCenter(n,ft.Immediate);const l=this._editor.createDecorationsCollection(o);this._previewDisposable.add(ae(()=>l.clear()))}this._previewDisposable.add(s);const d=this._direction===rt.Supertypes?c(11168,"Supertypes of '{0}'",e.model.root.name):c(11169,"Subtypes of '{0}'",e.model.root.name);this.setTitle(d)}showLoading(){this._parent.dataset.state=zn.Loading,this.setTitle(c(11170,"Loading...")),this._show()}showMessage(e){this._parent.dataset.state=zn.Message,this.setTitle(""),this.setMetaTitle(""),this._message.innerText=e,this._show(),this._message.focus()}async showModel(e){this._show();const t=this._treeViewStates.get(this._direction);await this._tree.setInput(e,t);const i=this._tree.getNode(e).children[0];await this._tree.expand(i.element),i.children.length===0?this.showMessage(this._direction===rt.Supertypes?c(11171,"No supertypes of '{0}'",e.root.name):c(11172,"No subtypes of '{0}'",e.root.name)):(this._parent.dataset.state=zn.Data,(!t||this._tree.getFocus().length===0)&&this._tree.setFocus([i.children[0].element]),this._tree.domFocus(),this._updatePreview())}getModel(){return this._tree.getInput()}getFocused(){return this._tree.getFocus()[0]}async updateDirection(e){const t=this._tree.getInput();t&&e!==this._direction&&(this._treeViewStates.set(this._direction,this._tree.getViewState()),this._direction=e,await this.showModel(t))}_show(){this._isShowing||(this.editor.revealLineInCenterIfOutsideViewport(this._where.lineNumber,ft.Smooth),super.show(ve.fromPositions(this._where),this._layoutInfo.height))}_onWidth(e){this._dim&&this._doLayoutBody(this._dim.height,e)}_doLayoutBody(e,t){(this._dim.height!==e||this._dim.width!==t)&&(super._doLayoutBody(e,t),this._dim=new jt(t,e),this._layoutInfo.height=this._viewZone?this._viewZone.heightInLines:this._layoutInfo.height,this._splitView.layout(t),this._splitView.resizeView(0,t*this._layoutInfo.ratio))}};Uo=Eh=D([u(3,me),u(4,Km),u(5,Q),u(6,sn),u(7,ce),u(8,ps),u(9,se),u(10,F)],Uo);var bo;const Ih=new j("editorHasTypeHierarchyProvider",!1,c(11158,"Whether a type hierarchy provider is available")),Rr=new j("typeHierarchyVisible",!1,c(11159,"Whether type hierarchy peek is currently showing")),ar=new j("typeHierarchyDirection",void 0,{type:"string",description:c(11160,"whether type hierarchy shows super types or subtypes")});function vx(a){return a===rt.Subtypes||a===rt.Supertypes?a:rt.Subtypes}let ls=class{static{bo=this}static{this.Id="typeHierarchy"}static get(e){return e.getContribution(bo.Id)}static{this._storageDirectionKey="typeHierarchy/defaultDirection"}constructor(e,t,i,s,o){this._editor=e,this._contextKeyService=t,this._storageService=i,this._editorService=s,this._instantiationService=o,this._disposables=new O,this._sessionDisposables=new O,this._ctxHasProvider=Ih.bindTo(this._contextKeyService),this._ctxIsVisible=Rr.bindTo(this._contextKeyService),this._ctxDirection=ar.bindTo(this._contextKeyService),this._disposables.add(V.any(e.onDidChangeModel,e.onDidChangeModelLanguage,uc.onDidChange)(()=>{this._ctxHasProvider.set(e.hasModel()&&uc.has(e.getModel()))})),this._disposables.add(this._sessionDisposables)}dispose(){this._disposables.dispose()}async startTypeHierarchyFromEditor(){if(this._sessionDisposables.clear(),!this._editor.hasModel())return;const e=this._editor.getModel(),t=this._editor.getPosition();if(!uc.has(e))return;const i=new Ts,s=Gm.create(e,t,i.token),o=vx(this._storageService.get(bo._storageDirectionKey,G.PROFILE,rt.Subtypes));this._showTypeHierarchyWidget(t,o,s,i)}_showTypeHierarchyWidget(e,t,i,s){this._ctxIsVisible.set(!0),this._ctxDirection.set(t),V.any(this._editor.onDidChangeModel,this._editor.onDidChangeModelLanguage)(this.endTypeHierarchy,this,this._sessionDisposables),this._widget=this._instantiationService.createInstance(Uo,this._editor,e,t),this._widget.showLoading(),this._sessionDisposables.add(this._widget.onDidClose(()=>{this.endTypeHierarchy(),this._storageService.store(bo._storageDirectionKey,this._widget.direction,G.PROFILE,Re.USER)})),this._sessionDisposables.add({dispose(){s.dispose(!0)}}),this._sessionDisposables.add(this._widget),i.then(o=>{s.token.isCancellationRequested||(o?(this._sessionDisposables.add(o),this._widget.showModel(o)):this._widget.showMessage(c(11161,"No results")))}).catch(o=>{if(ud(o)){this.endTypeHierarchy();return}this._widget.showMessage(c(11162,"Failed to show type hierarchy"))})}async startTypeHierarchyFromTypeHierarchy(){if(!this._widget)return;const e=this._widget.getModel(),t=this._widget.getFocused();if(!t||!e)return;const i=await this._editorService.openCodeEditor({resource:t.item.uri},this._editor);if(!i)return;const s=e.fork(t.item);this._sessionDisposables.clear(),bo.get(i)?._showTypeHierarchyWidget(ve.lift(s.root.selectionRange).getStartPosition(),this._widget.direction,Promise.resolve(s),new Ts)}showSupertypes(){this._widget?.updateDirection(rt.Supertypes),this._ctxDirection.set(rt.Supertypes)}showSubtypes(){this._widget?.updateDirection(rt.Subtypes),this._ctxDirection.set(rt.Subtypes)}endTypeHierarchy(){this._sessionDisposables.clear(),this._ctxIsVisible.set(!1),this._editor.focus()}};ls=bo=D([u(1,se),u(2,ce),u(3,co),u(4,F)],ls);fd(ls.Id,ls,md.Eager);C(class extends Ki{constructor(){super({id:"editor.showTypeHierarchy",title:x(11163,"Peek Type Hierarchy"),menu:{id:w.EditorContextPeek,group:"navigation",order:1e3,when:I.and(Ih,Ca.notInPeekEditor)},precondition:I.and(Ih,Ca.notInPeekEditor),f1:!0})}async runEditorCommand(e,t){return ls.get(t)?.startTypeHierarchyFromEditor()}});C(class extends Ki{constructor(){super({id:"editor.showSupertypes",title:x(11164,"Show Supertypes"),icon:k.typeHierarchySuper,precondition:I.and(Rr,ar.isEqualTo(rt.Subtypes)),keybinding:{weight:W.WorkbenchContrib,primary:N.Shift+N.Alt+y.KeyH},menu:{id:Uo.TitleMenu,when:ar.isEqualTo(rt.Subtypes),order:1}})}runEditorCommand(a,e){return ls.get(e)?.showSupertypes()}});C(class extends Ki{constructor(){super({id:"editor.showSubtypes",title:x(11165,"Show Subtypes"),icon:k.typeHierarchySub,precondition:I.and(Rr,ar.isEqualTo(rt.Supertypes)),keybinding:{weight:W.WorkbenchContrib,primary:N.Shift+N.Alt+y.KeyH},menu:{id:Uo.TitleMenu,when:ar.isEqualTo(rt.Supertypes),order:1}})}runEditorCommand(a,e){return ls.get(e)?.showSubtypes()}});C(class extends Ki{constructor(){super({id:"editor.refocusTypeHierarchy",title:x(11166,"Refocus Type Hierarchy"),precondition:Rr,keybinding:{weight:W.WorkbenchContrib,primary:N.Shift+y.Enter}})}async runEditorCommand(a,e){return ls.get(e)?.startTypeHierarchyFromTypeHierarchy()}});C(class extends Ki{constructor(){super({id:"editor.closeTypeHierarchy",title:c(11167,"Close"),icon:k.close,precondition:Rr,keybinding:{weight:W.WorkbenchContrib+10,primary:y.Escape,when:I.not("config.editor.stablePeek")},menu:{id:Uo.TitleMenu,order:1e3}})}runEditorCommand(a,e){return ls.get(e)?.endTypeHierarchy()}});function $u(a){const e=a?.getHTMLElement();e&&!Vf(e)&&a?.domFocus()}async function bx(a,e){if(!Yf.getValue(a.contextKeyService))return e(a);const t=a.getFocus(),i=a.getSelection();await e(a);const s=a.getFocus();if(i.length>1||!Js(t,i)||Js(t,s))return;const o=new KeyboardEvent("keydown");a.setSelection(s,o)}async function Ft(a,e){if(!a)return;await bx(a,e);const t=a.getFocus();t.length&&a.reveal(t[0]),a.setAnchor(t[0]),$u(a)}oe.registerCommandAndKeybindingRule({id:"list.focusDown",weight:W.WorkbenchContrib,when:be,primary:y.DownArrow,mac:{primary:y.DownArrow,secondary:[N.WinCtrl|y.KeyN]},handler:(a,e)=>{Ft(a.get(ue).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown");await t.focusNext(typeof e=="number"?e:1,!1,i)})}});oe.registerCommandAndKeybindingRule({id:"list.focusUp",weight:W.WorkbenchContrib,when:be,primary:y.UpArrow,mac:{primary:y.UpArrow,secondary:[N.WinCtrl|y.KeyP]},handler:(a,e)=>{Ft(a.get(ue).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown");await t.focusPrevious(typeof e=="number"?e:1,!1,i)})}});oe.registerCommandAndKeybindingRule({id:"list.focusAnyDown",weight:W.WorkbenchContrib,when:be,primary:N.Alt|y.DownArrow,mac:{primary:N.Alt|y.DownArrow,secondary:[N.WinCtrl|N.Alt|y.KeyN]},handler:(a,e)=>{Ft(a.get(ue).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown",{altKey:!0});await t.focusNext(typeof e=="number"?e:1,!1,i)})}});oe.registerCommandAndKeybindingRule({id:"list.focusAnyUp",weight:W.WorkbenchContrib,when:be,primary:N.Alt|y.UpArrow,mac:{primary:N.Alt|y.UpArrow,secondary:[N.WinCtrl|N.Alt|y.KeyP]},handler:(a,e)=>{Ft(a.get(ue).lastFocusedList,async t=>{const i=new KeyboardEvent("keydown",{altKey:!0});await t.focusPrevious(typeof e=="number"?e:1,!1,i)})}});oe.registerCommandAndKeybindingRule({id:"list.focusPageDown",weight:W.WorkbenchContrib,when:be,primary:y.PageDown,handler:a=>{Ft(a.get(ue).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusNextPage(t)})}});oe.registerCommandAndKeybindingRule({id:"list.focusPageUp",weight:W.WorkbenchContrib,when:be,primary:y.PageUp,handler:a=>{Ft(a.get(ue).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusPreviousPage(t)})}});oe.registerCommandAndKeybindingRule({id:"list.focusFirst",weight:W.WorkbenchContrib,when:be,primary:y.Home,handler:a=>{Ft(a.get(ue).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusFirst(t)})}});oe.registerCommandAndKeybindingRule({id:"list.focusLast",weight:W.WorkbenchContrib,when:be,primary:y.End,handler:a=>{Ft(a.get(ue).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown");await e.focusLast(t)})}});oe.registerCommandAndKeybindingRule({id:"list.focusAnyFirst",weight:W.WorkbenchContrib,when:be,primary:N.Alt|y.Home,handler:a=>{Ft(a.get(ue).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown",{altKey:!0});await e.focusFirst(t)})}});oe.registerCommandAndKeybindingRule({id:"list.focusAnyLast",weight:W.WorkbenchContrib,when:be,primary:N.Alt|y.End,handler:a=>{Ft(a.get(ue).lastFocusedList,async e=>{const t=new KeyboardEvent("keydown",{altKey:!0});await e.focusLast(t)})}});function fy(a,e){if(a instanceof fr||a instanceof mr||a instanceof wr){const t=a,i=t.getFocus()?t.getFocus()[0]:void 0,s=t.getSelection();s&&typeof i=="number"&&s.indexOf(i)>=0?t.setSelection(s.filter(o=>o!==e)):typeof i=="number"&&t.setSelection(s.concat(i))}else if(a instanceof bi||a instanceof Ci||a instanceof xt){const t=a,i=t.getFocus()?t.getFocus()[0]:void 0;if(e===i)return;const s=t.getSelection(),o=new KeyboardEvent("keydown",{shiftKey:!0});s&&s.indexOf(i)>=0?t.setSelection(s.filter(n=>n!==e),o):t.setSelection(s.concat(i),o)}}function ju(a,e){const t=a.getStickyScrollFocus();if(t.length===0)throw new Error("StickyScroll has no focus");if(t.length>1)throw new Error("StickyScroll can only have a single focused item");a.reveal(t[0]),a.getHTMLElement().focus(),a.setFocus(t),e?.(t[0])}oe.registerCommandAndKeybindingRule({id:"list.expandSelectionDown",weight:W.WorkbenchContrib,when:I.and(be,bu),primary:N.Shift|y.DownArrow,handler:(a,e)=>{const t=a.get(ue).lastFocusedList;if(!t)return;const i=t.getFocus()?t.getFocus()[0]:void 0,s=new KeyboardEvent("keydown");t.focusNext(typeof e=="number"?e:1,!1,s),fy(t,i);const o=t.getFocus();o.length&&t.reveal(o[0]),$u(t)}});oe.registerCommandAndKeybindingRule({id:"list.expandSelectionUp",weight:W.WorkbenchContrib,when:I.and(be,bu),primary:N.Shift|y.UpArrow,handler:(a,e)=>{const t=a.get(ue).lastFocusedList;if(!t)return;const i=t.getFocus()?t.getFocus()[0]:void 0,s=new KeyboardEvent("keydown");t.focusPrevious(typeof e=="number"?e:1,!1,s),fy(t,i);const o=t.getFocus();o.length&&t.reveal(o[0]),$u(t)}});oe.registerCommandAndKeybindingRule({id:"list.collapse",weight:W.WorkbenchContrib,when:I.and(be,I.or(Yb,Jb)),primary:y.LeftArrow,mac:{primary:y.LeftArrow,secondary:[N.CtrlCmd|y.UpArrow]},handler:a=>{const e=a.get(ue).lastFocusedList;if(!e||!(e instanceof bi||e instanceof Ci||e instanceof xt))return;const t=e,i=t.getFocus();if(i.length===0)return;const s=i[0];if(!t.collapse(s)){const o=t.getParentElement(s);o&&Ft(e,n=>{const r=new KeyboardEvent("keydown");n.setFocus([o],r)})}}});oe.registerCommandAndKeybindingRule({id:"list.stickyScroll.collapse",weight:W.WorkbenchContrib+50,when:Cu,primary:y.LeftArrow,mac:{primary:y.LeftArrow,secondary:[N.CtrlCmd|y.UpArrow]},handler:a=>{const e=a.get(ue).lastFocusedList;!e||!(e instanceof bi||e instanceof Ci||e instanceof xt)||ju(e,t=>e.collapse(t))}});oe.registerCommandAndKeybindingRule({id:"list.collapseAll",weight:W.WorkbenchContrib,when:be,primary:N.CtrlCmd|y.LeftArrow,mac:{primary:N.CtrlCmd|y.LeftArrow,secondary:[N.CtrlCmd|N.Shift|y.UpArrow]},handler:a=>{const e=a.get(ue).lastFocusedList;e&&!(e instanceof fr||e instanceof mr||e instanceof wr)&&e.collapseAll()}});oe.registerCommandAndKeybindingRule({id:"list.collapseAllToFocus",weight:W.WorkbenchContrib,when:be,handler:a=>{const e=a.get(ue).lastFocusedList,t=jf("keydown",!0);if(e instanceof bi||e instanceof Ci||e instanceof xt){const i=e,s=i.getFocus();s.length>0&&i.collapse(s[0],!0),i.setSelection(s,t),i.setAnchor(s[0])}}});oe.registerCommandAndKeybindingRule({id:"list.focusParent",weight:W.WorkbenchContrib,when:be,handler:a=>{const e=a.get(ue).lastFocusedList;if(!e||!(e instanceof bi||e instanceof Ci||e instanceof xt))return;const t=e,i=t.getFocus();if(i.length===0)return;const s=i[0],o=t.getParentElement(s);o&&Ft(e,n=>{const r=new KeyboardEvent("keydown");n.setFocus([o],r)})}});oe.registerCommandAndKeybindingRule({id:"list.expand",weight:W.WorkbenchContrib,when:I.and(be,I.or(Zb,Xb)),primary:y.RightArrow,handler:a=>{const e=a.get(ue).lastFocusedList;if(e){if(e instanceof bi||e instanceof Ci){const t=e.getFocus();if(t.length===0)return;const i=t[0];if(!e.expand(i)){const s=e.getFirstElementChild(i);s&&e.getNode(s).visible&&Ft(e,n=>{const r=new KeyboardEvent("keydown");n.setFocus([s],r)})}}else if(e instanceof xt){const t=e.getFocus();if(t.length===0)return;const i=t[0];e.expand(i).then(s=>{if(i&&!s){const o=e.getFirstElementChild(i);o&&e.getNode(o).visible&&Ft(e,r=>{const d=new KeyboardEvent("keydown");r.setFocus([o],d)})}})}}}});function qu(a,e){const t=a.get(ue).lastFocusedList,i=jf("keydown",e);if(t instanceof fr||t instanceof mr||t instanceof wr){const s=t;s.setAnchor(s.getFocus()[0]),s.setSelection(s.getFocus(),i)}else if(t instanceof bi||t instanceof Ci||t instanceof xt){const s=t,o=s.getFocus();if(o.length>0){let n=!0;(s.expandOnlyOnTwistieClick===!0||typeof s.expandOnlyOnTwistieClick!="boolean"&&s.expandOnlyOnTwistieClick(o[0]))&&(n=!1),n&&s.toggleCollapsed(o[0])}s.setAnchor(o[0]),s.setSelection(o,i)}}oe.registerCommandAndKeybindingRule({id:"list.select",weight:W.WorkbenchContrib,when:be,primary:y.Enter,mac:{primary:y.Enter,secondary:[N.CtrlCmd|y.DownArrow]},handler:a=>{qu(a,!1)}});oe.registerCommandAndKeybindingRule({id:"list.stickyScrollselect",weight:W.WorkbenchContrib+50,when:Cu,primary:y.Enter,mac:{primary:y.Enter,secondary:[N.CtrlCmd|y.DownArrow]},handler:a=>{const e=a.get(ue).lastFocusedList;!e||!(e instanceof bi||e instanceof Ci||e instanceof xt)||ju(e,t=>e.setSelection([t]))}});oe.registerCommandAndKeybindingRule({id:"list.selectAndPreserveFocus",weight:W.WorkbenchContrib,when:be,handler:a=>{qu(a,!0)}});oe.registerCommandAndKeybindingRule({id:"list.selectAll",weight:W.WorkbenchContrib,when:I.and(be,bu),primary:N.CtrlCmd|y.KeyA,handler:a=>{const e=a.get(ue).lastFocusedList;if(e instanceof fr||e instanceof mr||e instanceof wr){const t=e,i=new KeyboardEvent("keydown");t.setSelection(Qb(t.length),i)}else if(e instanceof bi||e instanceof Ci||e instanceof xt){const t=e,i=t.getFocus(),s=t.getSelection();let o;i.length>0&&(s.length===0||!s.includes(i[0]))&&(o=i[0]),!o&&s.length>0&&(o=s[0]);let n;o?n=t.getParentElement(o):n=void 0;const r=[],d=h=>{for(const p of h.children)p.visible&&(r.push(p.element),p.collapsed||d(p))};d(t.getNode(n)),n&&s.length===r.length&&r.unshift(n);const l=new KeyboardEvent("keydown");t.setSelection(r,l)}}});oe.registerCommandAndKeybindingRule({id:"list.toggleSelection",weight:W.WorkbenchContrib,when:be,primary:N.CtrlCmd|N.Shift|y.Enter,handler:a=>{const e=a.get(ue).lastFocusedList;if(!e)return;const t=e.getFocus();if(t.length===0)return;const i=e.getSelection(),s=i.indexOf(t[0]);s>-1?e.setSelection([...i.slice(0,s),...i.slice(s+1)]):e.setSelection([...i,t[0]])}});oe.registerCommandAndKeybindingRule({id:"list.showHover",weight:W.WorkbenchContrib,primary:qf(N.CtrlCmd|y.KeyK,N.CtrlCmd|y.KeyI),when:be,handler:async(a,...e)=>{const i=a.get(ue).lastFocusedList;if(!i)return;const s=i.getFocus();if(!s||s.length===0)return;const d=i.getHTMLElement().querySelector(".monaco-scrollable-element")?.querySelector(".monaco-list-rows")?.querySelector(".focused");if(!d)return;const l=Cx(d);l&&a.get(At).showManagedHover(l)}});function Cx(a){if(a.matches('[custom-hover="true"]'))return a;const e=a.querySelector('[custom-hover="true"]:not([tabindex]):not(.action-item)');if(e)return e}oe.registerCommandAndKeybindingRule({id:"list.toggleExpand",weight:W.WorkbenchContrib,when:be,primary:y.Space,handler:a=>{const e=a.get(ue).lastFocusedList;if(e instanceof bi||e instanceof Ci||e instanceof xt){const t=e,i=t.getFocus();if(i.length>0&&t.isCollapsible(i[0])){t.toggleCollapsed(i[0]);return}}qu(a,!0)}});oe.registerCommandAndKeybindingRule({id:"list.stickyScrolltoggleExpand",weight:W.WorkbenchContrib+50,when:Cu,primary:y.Space,handler:a=>{const e=a.get(ue).lastFocusedList;!e||!(e instanceof bi||e instanceof Ci||e instanceof xt)||ju(e)}});oe.registerCommandAndKeybindingRule({id:"list.clear",weight:W.WorkbenchContrib,when:I.and(be,eC),primary:y.Escape,handler:a=>{const e=a.get(ue).lastFocusedList;if(!e)return;const t=e.getSelection(),i=new KeyboardEvent("keydown");if(t.length>1)if(Yf.getValue(e.contextKeyService)){const o=e.getFocus();e.setSelection([o[0]],i)}else e.setSelection([],i);else e.setSelection([],i),e.setFocus([],i);e.setAnchor(void 0)}});Te.registerCommand({id:"list.triggerTypeNavigation",handler:a=>{a.get(ue).lastFocusedList?.triggerTypeNavigation()}});Te.registerCommand({id:"list.toggleFindMode",handler:a=>{const e=a.get(ue).lastFocusedList;if(e instanceof Dd||e instanceof xt){const t=e;t.findMode=t.findMode===nc.Filter?nc.Highlight:nc.Filter}}});Te.registerCommand({id:"list.toggleFindMatchType",handler:a=>{const e=a.get(ue).lastFocusedList;if(e instanceof Dd||e instanceof xt){const t=e;t.findMatchType=t.findMatchType===rc.Contiguous?rc.Fuzzy:rc.Contiguous}}});Te.registerCommandAlias("list.toggleKeyboardNavigation","list.triggerTypeNavigation");Te.registerCommandAlias("list.toggleFilterOnType","list.toggleFindMode");oe.registerCommandAndKeybindingRule({id:"list.find",weight:W.WorkbenchContrib,when:I.and(Jf,tC),primary:N.CtrlCmd|N.Alt|y.KeyF,secondary:[y.F3],handler:a=>{const e=a.get(ue).lastFocusedList;e instanceof fr||e instanceof mr||e instanceof wr||(e instanceof Dd||e instanceof xt)&&e.openFind()}});oe.registerCommandAndKeybindingRule({id:"list.closeFind",weight:W.WorkbenchContrib,when:I.and(Jf,iC),primary:y.Escape,handler:a=>{const e=a.get(ue).lastFocusedList;(e instanceof Dd||e instanceof xt)&&e.closeFind()}});oe.registerCommandAndKeybindingRule({id:"list.scrollUp",weight:W.WorkbenchContrib,when:I.and(be,sC?.negate()),primary:N.CtrlCmd|y.UpArrow,handler:a=>{const e=a.get(ue).lastFocusedList;e&&(e.scrollTop-=10)}});oe.registerCommandAndKeybindingRule({id:"list.scrollDown",weight:W.WorkbenchContrib,when:I.and(be,oC?.negate()),primary:N.CtrlCmd|y.DownArrow,handler:a=>{const e=a.get(ue).lastFocusedList;e&&(e.scrollTop+=10)}});oe.registerCommandAndKeybindingRule({id:"list.scrollLeft",weight:W.WorkbenchContrib,when:be,handler:a=>{const e=a.get(ue).lastFocusedList;e&&(e.scrollLeft-=10)}});oe.registerCommandAndKeybindingRule({id:"list.scrollRight",weight:W.WorkbenchContrib,when:be,handler:a=>{const e=a.get(ue).lastFocusedList;e&&(e.scrollLeft+=10)}});C(class extends X{constructor(){super({id:"tree.toggleStickyScroll",title:{...x(2747,"Toggle Tree Sticky Scroll"),mnemonicTitle:c(2748,"&&Toggle Tree Sticky Scroll")},category:"View",metadata:{description:c(2749,"Toggles Sticky Scroll widget at the top of tree structures such as the File Explorer and Debug variables View.")},f1:!0})}run(e){const t=e.get(ie),i=!t.getValue("workbench.tree.enableStickyScroll");t.updateValue("workbench.tree.enableStickyScroll",i)}});const Sx=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class _x extends _t{constructor(e,t){super("vs.tree.collapse",c(42,"Collapse All"),"collapse-all",t),this.viewer=e}async run(){this.viewer.collapseAll(),this.viewer.setSelection([]),this.viewer.setFocus([])}}class Ex extends R{constructor(){super(...arguments),this._onDidChangeCheckboxState=this._register(new E),this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event}setCheckboxState(e){this._onDidChangeCheckboxState.fire([e])}}class jd extends R{static{this.checkboxClass="custom-view-tree-node-item-checkbox"}constructor(e,t,i,s){super(),this.checkboxStateHandler=t,this.hoverDelegate=i,this.hoverService=s,this.checkboxContainer=e}render(e){e.checkbox&&(this.toggle?(this.toggle.checked=e.checkbox.isChecked,this.toggle.setIcon(this.toggle.checked?k.check:void 0)):this.createCheckbox(e))}createCheckbox(e){e.checkbox&&(this.toggle=new Zf({isChecked:e.checkbox.isChecked,title:"",icon:e.checkbox.isChecked?k.check:void 0,...yu}),this.setHover(e.checkbox),this.setAccessibilityInformation(e.checkbox),this.toggle.domNode.classList.add(jd.checkboxClass),this.toggle.domNode.tabIndex=1,ge(this.checkboxContainer,this.toggle.domNode),this.registerListener(e))}registerListener(e){this.toggle&&(this._register({dispose:()=>this.removeCheckbox()}),this._register(this.toggle),this._register(this.toggle.onChange(()=>{this.setCheckbox(e)})))}setHover(e){this.toggle&&(this.hover?this.hover.update(e.tooltip):this.hover=this._register(this.hoverService.setupManagedHover(this.hoverDelegate,this.toggle.domNode,this.checkboxHoverContent(e))))}setCheckbox(e){this.toggle&&e.checkbox&&(e.checkbox.isChecked=this.toggle.checked,this.toggle.setIcon(this.toggle.checked?k.check:void 0),this.setHover(e.checkbox),this.setAccessibilityInformation(e.checkbox),this.checkboxStateHandler.setCheckboxState(e))}checkboxHoverContent(e){return e.tooltip?e.tooltip:e.isChecked?c(3505,"Checked"):c(3506,"Unchecked")}setAccessibilityInformation(e){this.toggle&&e.accessibilityInformation&&(this.toggle.domNode.ariaLabel=e.accessibilityInformation.label,e.accessibilityInformation.role&&(this.toggle.domNode.role=e.accessibilityInformation.role))}removeCheckbox(){const e=this.checkboxContainer.children;for(const t of e)t.remove()}}var Dh;Pe(Sx);let Ah=class extends Rd{constructor(e,t,i,s,o,n,r,d,l,h,p,f){super({...e,titleMenuId:w.ViewTitle,donotForwardArgs:!1},t,i,s,o,n,r,d,l,p,f);const{treeView:g}=H.as(pt.ViewsRegistry).getView(e.id);this.treeView=g,this._register(this.treeView.onDidChangeActions(()=>this.updateActions(),this)),this._register(this.treeView.onDidChangeTitle(m=>this.updateTitle(m))),this._register(this.treeView.onDidChangeDescription(m=>this.updateTitleDescription(m))),this._register(ae(()=>{this._container&&this.treeView.container&&this._container===this.treeView.container&&this.treeView.setVisibility(!1)})),this._register(this.onDidChangeBodyVisibility(()=>this.updateTreeVisibility())),this._register(this.treeView.onDidChangeWelcomeState(()=>this._onDidChangeViewWelcomeState.fire())),e.title!==this.treeView.title&&this.updateTitle(this.treeView.title),e.titleDescription!==this.treeView.description&&this.updateTitleDescription(this.treeView.description),this._actionRunner=this._register(new yy(h,()=>this.treeView.getSelection())),this.updateTreeVisibility()}focus(){super.focus(),this.treeView.focus()}renderBody(e){this._container=e,super.renderBody(e),this.renderTreeView(e)}shouldShowWelcome(){return(this.treeView.dataProvider===void 0||!!this.treeView.dataProvider.isTreeEmpty)&&(this.treeView.message===void 0||this.treeView.message==="")}layoutBody(e,t){super.layoutBody(e,t),this.layoutTreeView(e,t)}getOptimalWidth(){return this.treeView.getOptimalWidth()}renderTreeView(e){this.treeView.show(e)}layoutTreeView(e,t){this.treeView.layout(e,t)}updateTreeVisibility(){this.treeView.setVisibility(this.isBodyVisible())}getActionRunner(){return this._actionRunner}getActionsContext(){return{$treeViewId:this.id,$focusedTreeItem:!0,$selectedTreeItems:!0}}};Ah=D([u(1,it),u(2,at),u(3,ie),u(4,se),u(5,Ye),u(6,F),u(7,Tt),u(8,me),u(9,Ke),u(10,At),u(11,c_)],Ah);class Ac{constructor(){this.label={label:"root"},this.handle="0",this.parentHandle=void 0,this.collapsibleState=Ri.Expanded,this.children=void 0}}function my(a){const e=Te.getCommand(a);if(e){const t=S.getCommand(e.id);return t&&t.precondition}}function wy(a,e){const t=a.originalId?a.originalId:a.id,i=my(t);return i?e.contextMatchesRules(i):!0}function Yg(a){return!!a&&typeof a!="string"&&"element"in a&&"disposables"in a}const Ix=c(3507,"There is no data provider registered that can provide view data."),Dx=new j("customTreeView",!1);class Ax extends Ed{}let Th=class extends R{constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b){super(),this.id=e,this._title=t,this.themeService=i,this.instantiationService=s,this.commandService=o,this.configurationService=n,this.progressService=r,this.contextMenuService=d,this.keybindingService=l,this.notificationService=h,this.viewDescriptorService=p,this.hoverService=f,this.contextKeyService=g,this.activityService=m,this.logService=v,this.openerService=b,this.isVisible=!1,this._hasIconForParentNode=!1,this._hasIconForLeafNode=!1,this.focused=!1,this._canSelectMany=!1,this._manuallyManageCheckboxes=!1,this.elementsToRefresh=[],this.lastSelection=[],this._onDidExpandItem=this._register(new E),this.onDidExpandItem=this._onDidExpandItem.event,this._onDidCollapseItem=this._register(new E),this.onDidCollapseItem=this._onDidCollapseItem.event,this._onDidChangeSelectionAndFocus=this._register(new E),this.onDidChangeSelectionAndFocus=this._onDidChangeSelectionAndFocus.event,this._onDidChangeVisibility=this._register(new E),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._onDidChangeActions=this._register(new E),this.onDidChangeActions=this._onDidChangeActions.event,this._onDidChangeWelcomeState=this._register(new E),this.onDidChangeWelcomeState=this._onDidChangeWelcomeState.event,this._onDidChangeTitle=this._register(new E),this.onDidChangeTitle=this._onDidChangeTitle.event,this._onDidChangeDescription=this._register(new E),this.onDidChangeDescription=this._onDidChangeDescription.event,this._onDidChangeCheckboxState=this._register(new E),this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event,this._onDidCompleteRefresh=this._register(new E),this._isInitialized=!1,this._activity=this._register(new Ie),this.activated=!1,this.treeDisposables=this._register(new O),this._height=0,this._width=0,this.refreshing=!1,this.root=new Ac,this.lastActive=this.root}initialize(){this._isInitialized||(this._isInitialized=!0,this.contextKeyService.bufferChangeEvents(()=>{this.initializeShowCollapseAllAction(),this.initializeCollapseAllToggle(),this.initializeShowRefreshAction()}),this.treeViewDnd=this.instantiationService.createInstance(Lh,this.id),this._dragAndDropController&&(this.treeViewDnd.controller=this._dragAndDropController),this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("explorer.decorations")&&this.doRefresh([this.root])})),this._register(this.viewDescriptorService.onDidChangeLocation(({views:e,from:t,to:i})=>{e.some(s=>s.id===this.id)&&this.tree?.updateOptions({overrideStyles:eg(this.viewLocation).listOverrideStyles})})),this.registerActions(),this.create())}get viewContainer(){return this.viewDescriptorService.getViewContainerByViewId(this.id)}get viewLocation(){return this.viewDescriptorService.getViewLocationById(this.id)}get dragAndDropController(){return this._dragAndDropController}set dragAndDropController(e){this._dragAndDropController=e,this.treeViewDnd&&(this.treeViewDnd.controller=e)}get dataProvider(){return this._dataProvider}set dataProvider(e){if(e){this.visible&&this.activate();const t=this;this._dataProvider=new class{constructor(){this._isEmpty=!0,this._onDidChangeEmpty=new E,this.onDidChangeEmpty=this._onDidChangeEmpty.event}get isTreeEmpty(){return this._isEmpty}async getChildren(i){return(await this.getChildrenBatch(i?[i]:void 0))?.[0]}updateEmptyState(i,s){if(i.length===1&&i[0]instanceof Ac){const o=this._isEmpty;this._isEmpty=s.length===0||s[0].length===0,o!==this._isEmpty&&this._onDidChangeEmpty.fire()}}findCheckboxesUpdated(i,s){if(s.length===0)return[];const o=[];for(let n=0;n<i.length;n++){const r=i[n],d=s[n];for(const l of d)l.parent=r,!t.manuallyManageCheckboxes&&r?.checkbox?.isChecked===!0&&l.checkbox?.isChecked===!1&&(l.checkbox.isChecked=!0,o.push(l))}return o}async getChildrenBatch(i){let s,o=[];if(i&&i.every(n=>!!n.children))s=i.map(n=>n.children);else{i=i??[t.root];const n=await(i.length===1&&i[0]instanceof Ac?xh(e,void 0):xh(e,i));for(let r=0;r<i.length;r++){const d=i[r];d.children=n?n[r]:void 0}s=n??[],o=this.findCheckboxesUpdated(i,s)}return this.updateEmptyState(i,s),o.length>0&&t._onDidChangeCheckboxState.fire(o),s}},this._dataProvider.onDidChangeEmpty&&this._register(this._dataProvider.onDidChangeEmpty(()=>{this.updateCollapseAllToggle(),this._onDidChangeWelcomeState.fire()})),this.updateMessage(),this.refresh()}else this._dataProvider=void 0,this.treeDisposables.clear(),this.activated=!1,this.updateMessage();this._onDidChangeWelcomeState.fire()}get message(){return this._message}set message(e){this._message=e,this.updateMessage(),this._onDidChangeWelcomeState.fire()}get title(){return this._title}set title(e){this._title=e,this.tree&&(this.tree.ariaLabel=this._title),this._onDidChangeTitle.fire(this._title)}get description(){return this._description}set description(e){this._description=e,this._onDidChangeDescription.fire(this._description)}get badge(){return this._badge}set badge(e){if(!(this._badge?.value===e?.value&&this._badge?.tooltip===e?.tooltip))if(this._badge=e,e){const t={badge:new Ld(e.value,()=>e.tooltip),priority:50};this._activity.value=this.activityService.showViewActivity(this.id,t)}else this._activity.clear()}get canSelectMany(){return this._canSelectMany}set canSelectMany(e){const t=this._canSelectMany;this._canSelectMany=e,this._canSelectMany!==t&&this.tree?.updateOptions({multipleSelectionSupport:this.canSelectMany})}get manuallyManageCheckboxes(){return this._manuallyManageCheckboxes}set manuallyManageCheckboxes(e){this._manuallyManageCheckboxes=e}get hasIconForParentNode(){return this._hasIconForParentNode}get hasIconForLeafNode(){return this._hasIconForLeafNode}get visible(){return this.isVisible}initializeShowCollapseAllAction(e=!1){return this.collapseAllContext||(this.collapseAllContextKey=new j(`treeView.${this.id}.enableCollapseAll`,e,c(3508,"Whether the tree view with id {0} enables collapse all.",this.id)),this.collapseAllContext=this.collapseAllContextKey.bindTo(this.contextKeyService)),!0}get showCollapseAllAction(){return this.initializeShowCollapseAllAction(),!!this.collapseAllContext?.get()}set showCollapseAllAction(e){this.initializeShowCollapseAllAction(e),this.collapseAllContext?.set(e)}initializeShowRefreshAction(e=!1){this.refreshContext||(this.refreshContextKey=new j(`treeView.${this.id}.enableRefresh`,e,c(3509,"Whether the tree view with id {0} enables refresh.",this.id)),this.refreshContext=this.refreshContextKey.bindTo(this.contextKeyService))}get showRefreshAction(){return this.initializeShowRefreshAction(),!!this.refreshContext?.get()}set showRefreshAction(e){this.initializeShowRefreshAction(e),this.refreshContext?.set(e)}registerActions(){const e=this;this._register(C(class extends X{constructor(){super({id:`workbench.actions.treeView.${e.id}.refresh`,title:c(3510,"Refresh"),menu:{id:w.ViewTitle,when:I.and(I.equals("view",e.id),e.refreshContextKey),group:"navigation",order:Number.MAX_SAFE_INTEGER-1},icon:k.refresh})}async run(){return e.refresh()}})),this._register(C(class extends X{constructor(){super({id:`workbench.actions.treeView.${e.id}.collapseAll`,title:c(3511,"Collapse All"),menu:{id:w.ViewTitle,when:I.and(I.equals("view",e.id),e.collapseAllContextKey),group:"navigation",order:Number.MAX_SAFE_INTEGER},precondition:e.collapseAllToggleContextKey,icon:k.collapseAll})}async run(){if(e.tree)return new _x(e.tree,!0).run()}}))}setVisibility(e){this.initialize(),e=!!e,this.isVisible!==e&&(this.isVisible=e,this.tree&&(this.isVisible?jn(this.tree.getHTMLElement()):qn(this.tree.getHTMLElement()),this.isVisible&&this.elementsToRefresh.length&&this.dataProvider&&(this.doRefresh(this.elementsToRefresh),this.elementsToRefresh=[])),aC(()=>{this.dataProvider&&this._onDidChangeVisibility.fire(this.isVisible)}),this.visible&&this.activate())}focus(e=!0,t){if(this.tree&&this.root.children&&this.root.children.length>0){const i=t??this.tree.getSelection()[0];i&&e&&this.tree.reveal(i,.5),this.tree.domFocus()}else this.tree&&this.treeContainer&&!this.treeContainer.classList.contains("hide")?this.tree.domFocus():this.domNode.focus()}show(e){this._container=e,ge(e,this.domNode)}create(){this.domNode=B(".tree-explorer-viewlet-tree-view"),this.messageElement=ge(this.domNode,B(".message")),this.updateMessage(),this.treeContainer=ge(this.domNode,B(".customview-tree")),this.treeContainer.classList.add("file-icon-themable-tree","show-file-icons");const e=this._register(Mo(this.domNode));this._register(e.onDidFocus(()=>this.focused=!0)),this._register(e.onDidBlur(()=>this.focused=!1))}createTree(){this.treeDisposables.clear();const e=du.bind(void 0,this.instantiationService),t=this.treeDisposables.add(this.instantiationService.createInstance(kh,this.id));this.treeLabels=this.treeDisposables.add(this.instantiationService.createInstance(Rm,this));const i=this.instantiationService.createInstance(kx,this,h=>this.progressService.withProgress({location:this.id},()=>h)),s=this.treeDisposables.add(new Rx(this.themeService)),o=this.treeDisposables.add(new Ex),n=this.treeDisposables.add(this.instantiationService.createInstance(dr,this.id,t,this.treeLabels,e,s,o,()=>this.manuallyManageCheckboxes));this.treeDisposables.add(n.onDidChangeCheckboxState(h=>this._onDidChangeCheckboxState.fire(h)));const r=this._title;this.tree=this.treeDisposables.add(this.instantiationService.createInstance(Ax,this.id,this.treeContainer,new xx,[n],i,{identityProvider:new Tx,accessibilityProvider:{getAriaLabel(h){if(h.accessibilityInformation)return h.accessibilityInformation.label;if(pa(h.tooltip))return h.tooltip;{if(h.resourceUri&&!h.label)return null;let p="";return h.label&&(p+=h.label.label+" "),h.description&&(p+=h.description),p}},getRole(h){return h.accessibilityInformation?.role??"treeitem"},getWidgetAriaLabel(){return r}},keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:h=>h.label?h.label.label:h.resourceUri?os(U.revive(h.resourceUri)):void 0},expandOnlyOnTwistieClick:h=>!!h.command||!!h.checkbox||this.configurationService.getValue("workbench.tree.expandMode")==="doubleClick",collapseByDefault:h=>h.collapsibleState!==Ri.Expanded,multipleSelectionSupport:this.canSelectMany,dnd:this.treeViewDnd,overrideStyles:eg(this.viewLocation).listOverrideStyles})),this.treeDisposables.add(n.onDidChangeMenuContext(h=>h.forEach(p=>this.tree?.rerender(p)))),this.treeDisposables.add(this.tree),t.setContextKeyService(this.tree.contextKeyService),s.tree=this.tree;const d=this.treeDisposables.add(new yy(this.notificationService,()=>this.tree.getSelection()));n.actionRunner=d,this.tree.contextKeyService.createKey(this.id,!0),Dx.bindTo(this.tree.contextKeyService).set(!0),this.treeDisposables.add(this.tree.onContextMenu(h=>this.onContextMenu(t,h,d))),this.treeDisposables.add(this.tree.onDidChangeSelection(h=>{this.lastSelection=h.elements,this.lastActive=this.tree?.getFocus()[0]??this.lastActive,this._onDidChangeSelectionAndFocus.fire({selection:this.lastSelection,focus:this.lastActive})})),this.treeDisposables.add(this.tree.onDidChangeFocus(h=>{h.elements.length&&h.elements[0]!==this.lastActive&&(this.lastActive=h.elements[0],this.lastSelection=this.tree?.getSelection()??this.lastSelection,this._onDidChangeSelectionAndFocus.fire({selection:this.lastSelection,focus:this.lastActive}))})),this.treeDisposables.add(this.tree.onDidChangeCollapseState(h=>{if(!h.node.element)return;const p=Array.isArray(h.node.element.element)?h.node.element.element[0]:h.node.element.element;h.node.collapsed?this._onDidCollapseItem.fire(p):this._onDidExpandItem.fire(p)})),this.tree.setInput(this.root).then(()=>this.updateContentAreas()),this.treeDisposables.add(this.tree.onDidOpen(async h=>{if(!h.browserEvent||h.browserEvent.target&&h.browserEvent.target.classList.contains(jd.checkboxClass))return;const p=this.tree.getSelection(),f=await this.resolveCommand(p.length===1?p[0]:void 0);if(f&&wy(f,this.contextKeyService)){let g=f.arguments||[];(f.id===l_||f.id===h_)&&(g=[...g,h]);try{await this.commandService.executeCommand(f.id,...g)}catch(m){this.notificationService.error(m)}}})),this.treeDisposables.add(t.onDidChange(h=>{this.tree?.hasNode(h)&&this.tree?.rerender(h)}))}async resolveCommand(e){let t=e?.command;return e&&!t&&e instanceof Um&&e.hasResolve&&(await e.resolve(wi.None),t=e.command),t}onContextMenu(e,t,i){this.hoverService.hideHover();const s=t.element;if(s===null)return;const o=t.browserEvent;o.preventDefault(),o.stopPropagation(),this.tree.setFocus([s]);let n=this.canSelectMany?this.getSelection():[];n.find(d=>d.handle===s.handle)||(n=[s]);const r=e.getResourceContextActions(n);r.length&&this.contextMenuService.showContextMenu({getAnchor:()=>t.anchor,getActions:()=>r,getActionViewItem:d=>{const l=this.keybindingService.lookupKeybinding(d.id);if(l)return new hu(d,d,{label:!0,keybinding:l.getLabel()})},onHide:d=>{d&&this.tree.domFocus()},getActionsContext:()=>({$treeViewId:this.id,$treeItemHandle:s.handle}),actionRunner:i})}updateMessage(){this._message?this.showMessage(this._message):this.dataProvider?this.hideMessage():this.showMessage(Ix),this.updateContentAreas()}processMessage(e,t){const i=e.value.split(`
`),s=[];let o=!1;for(const r of i){const d=ha(r);if(d.nodes.length===1&&typeof d.nodes[0]!="string"){const l=d.nodes[0],h=document.createElement("div");h.classList.add("button-container");const p=new Xf(h,{title:l.title,secondary:o,supportIcons:!0,...Yn});p.label=l.label,p.onDidClick(g=>{this.openerService.open(l.href,{allowCommands:!0})},null,t);const f=U.parse(l.href);if(f.scheme===pe.command){const g=my(f.path);g&&(p.enabled=this.contextKeyService.contextMatchesRules(g),t.add(this.contextKeyService.onDidChangeContext(m=>{m.affectsSome(new Set(g.keys()))&&(p.enabled=this.contextKeyService.contextMatchesRules(g))})))}t.add(p),o=!0,s.push(h)}else{o=!1;const l=this.markdownRenderer.render(new ts(r,{isTrusted:e.isTrusted,supportThemeIcons:e.supportThemeIcons,supportHtml:e.supportHtml}));s.push(l.element),t.add(l)}}const n=document.createElement("div");n.classList.add("rendered-message");for(const r of s)No(r)?n.appendChild(r):n.appendChild(r.element);return n}showMessage(e){if(Yg(this._messageValue)&&this._messageValue.disposables.dispose(),Np(e)&&!this.markdownRenderer&&(this.markdownRenderer=this.instantiationService.createInstance(dC,{})),Np(e)){const t=new O,i=this.processMessage(e,t);this._messageValue={element:i,disposables:t}}else this._messageValue=e;this.messageElement&&(this.messageElement.classList.remove("hide"),this.resetMessageElement(),typeof this._messageValue=="string"&&!Gs(this._messageValue)?this.messageElement.textContent=this._messageValue:Yg(this._messageValue)&&this.messageElement.appendChild(this._messageValue.element),this.layout(this._height,this._width))}hideMessage(){this.resetMessageElement(),this.messageElement?.classList.add("hide"),this.layout(this._height,this._width)}resetMessageElement(){this.messageElement&&ji(this.messageElement)}layout(e,t){if(e&&t&&this.messageElement&&this.treeContainer){this._height=e,this._width=t;const i=e-cC(this.messageElement);this.treeContainer.style.height=i+"px",this.tree?.layout(i,t)}}getOptimalWidth(){if(this.tree){const e=this.tree.getHTMLElement(),t=[].slice.call(e.querySelectorAll(".outline-item-label > a"));return lC(e,t)}return 0}updateCheckboxes(e){return vy(e)}async refresh(e,t){if(this.dataProvider&&this.tree){this.refreshing&&await V.toPromise(this._onDidCompleteRefresh.event),e||(e=[this.root],this.elementsToRefresh=[]);for(const i of e)i.children=void 0;if(this.isVisible){const i=this.updateCheckboxes(t??[]);return this.doRefresh(e.concat(i))}else if(this.elementsToRefresh.length){const i=new Set;this.elementsToRefresh.forEach(s=>i.add(s.handle));for(const s of e)i.has(s.handle)||this.elementsToRefresh.push(s)}else this.elementsToRefresh.push(...e)}}async expand(e){const t=this.tree;if(t)try{e=Array.isArray(e)?e:[e];for(const i of e)await t.expand(i,!1)}catch{}}isCollapsed(e){return!!this.tree?.isCollapsed(e)}setSelection(e){this.tree?.setSelection(e)}getSelection(){return this.tree?.getSelection()??[]}setFocus(e){this.tree&&(e?(this.focus(!0,e),this.tree.setFocus([e])):this.tree.getFocus().length===0&&this.tree.setFocus([]))}async reveal(e){if(this.tree)return this.tree.reveal(e)}async doRefresh(e){const t=this.tree;if(t&&this.visible){this.refreshing=!0;const i=t.getSelection();try{await Promise.all(e.map(o=>t.updateChildren(o,!0,!0)))}catch(o){this.logService.error(o)}const s=t.getSelection();(i.length!==s.length||i.some((o,n)=>o.handle!==s[n].handle))&&(this.lastSelection=s,this._onDidChangeSelectionAndFocus.fire({selection:this.lastSelection,focus:this.lastActive})),this.refreshing=!1,this._onDidCompleteRefresh.fire(),this.updateContentAreas(),this.focused&&this.focus(!1),this.updateCollapseAllToggle()}}initializeCollapseAllToggle(){this.collapseAllToggleContext||(this.collapseAllToggleContextKey=new j(`treeView.${this.id}.toggleCollapseAll`,!1,c(3512,"Whether collapse all is toggled for the tree view with id {0}.",this.id)),this.collapseAllToggleContext=this.collapseAllToggleContextKey.bindTo(this.contextKeyService))}updateCollapseAllToggle(){this.showCollapseAllAction&&(this.initializeCollapseAllToggle(),this.collapseAllToggleContext?.set(!!this.root.children&&this.root.children.length>0&&this.root.children.some(e=>e.collapsibleState!==Ri.None)))}updateContentAreas(){const e=!this.root.children||this.root.children.length===0;this._messageValue&&e&&!this.refreshing&&this.treeContainer?(this.dragAndDropController||this.treeContainer.classList.add("hide"),this.domNode.setAttribute("tabindex","0")):this.treeContainer&&(this.treeContainer.classList.remove("hide"),this.domNode===cu()&&this.focus(),this.domNode.removeAttribute("tabindex"))}get container(){return this._container}};Th=D([u(2,me),u(3,F),u(4,wt),u(5,ie),u(6,Ad),u(7,at),u(8,it),u(9,Ke),u(10,Ye),u(11,At),u(12,se),u(13,ks),u(14,Ue),u(15,Tt)],Th);class Tx{getId(e){return e.handle}}class xx{getHeight(e){return dr.ITEM_HEIGHT}getTemplateId(e){return dr.TREE_TEMPLATE_ID}}async function xh(a,e){return a.getChildrenBatch?a.getChildrenBatch(e):e?Promise.all(e.map(t=>a.getChildren(t).then(i=>i??[]))):[await a.getChildren()].filter(t=>t!==void 0)}class kx{constructor(e,t){this.treeView=e,this.withProgress=t}hasChildren(e){return!!this.treeView.dataProvider&&e.collapsibleState!==Ri.None}async getChildren(e){const t=this.treeView.dataProvider;if(!t)return[];this.batch===void 0?(this.batch=[e],this.batchPromise=void 0):this.batch.push(e);const i=this.batch.length-1;return new Promise((s,o)=>{setTimeout(async()=>{const n=this.batch;this.batch=void 0,this.batchPromise||(this.batchPromise=this.withProgress(xh(t,n)));try{const r=await this.batchPromise;s(r&&i<r.length?r[i]:[])}catch(r){r.message.startsWith("Bad progress location:")||o(r)}},0)})}}let dr=class extends R{static{Dh=this}static{this.ITEM_HEIGHT=22}static{this.TREE_TEMPLATE_ID="treeExplorer"}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g){super(),this.treeViewId=e,this.menus=t,this.labels=i,this.actionViewItemProvider=s,this.aligner=o,this.checkboxStateHandler=n,this.manuallyManageCheckboxes=r,this.themeService=d,this.configurationService=l,this.labelService=h,this.contextKeyService=p,this.hoverService=f,this._onDidChangeCheckboxState=this._register(new E),this.onDidChangeCheckboxState=this._onDidChangeCheckboxState.event,this._onDidChangeMenuContext=this._register(new E),this.onDidChangeMenuContext=this._onDidChangeMenuContext.event,this._hasCheckbox=!1,this._renderedElements=new Map,this._hoverDelegate=this._register(g.createInstance(nC,"mouse",void 0,{})),this._register(this.themeService.onDidFileIconThemeChange(()=>this.rerender())),this._register(this.themeService.onDidColorThemeChange(()=>this.rerender())),this._register(n.onDidChangeCheckboxState(m=>{this.updateCheckboxes(m)})),this._register(this.contextKeyService.onDidChangeContext(m=>this.onDidChangeContext(m)))}get templateId(){return Dh.TREE_TEMPLATE_ID}set actionRunner(e){this._actionRunner=e}renderTemplate(e){e.classList.add("custom-view-tree-node-item");const t=ge(e,B("")),i=this.labels.create(e,{supportHighlights:!0,hoverDelegate:this._hoverDelegate}),s=pf(i.element,B(".custom-view-tree-node-item-icon")),o=ge(i.element,B(".actions")),n=new Qo(o,{actionViewItemProvider:this.actionViewItemProvider});return{resourceLabel:i,icon:s,checkboxContainer:t,actionBar:n,container:e}}getHover(e,t,i){return!(i instanceof Um)||!i.hasResolve?t&&!i.tooltip?void 0:i.tooltip===void 0?e:pa(i.tooltip)?i.tooltip!==""?i.tooltip:void 0:{markdown:i.tooltip,markdownNotSupportedFallback:t?void 0:rC(i.tooltip)}:{markdown:typeof i.tooltip=="string"?i.tooltip:s=>new Promise(o=>{i.resolve(s).then(()=>o(i.tooltip))}),markdownNotSupportedFallback:t?void 0:e??""}}renderElement(e,t,i){const s=e.element,o=s.resourceUri?U.revive(s.resourceUri):null,n=s.label?s.label:o?{label:os(o)}:void 0,r=pa(s.description)?s.description:o&&s.description===!0?this.labelService.getUriLabel(yf(o),{relative:!0}):void 0,d=n?n.label:void 0,l=n&&n.highlights&&d?n.highlights.map(([b,A])=>{if(b<0&&(b=d.length+b),A<0&&(A=d.length+A),b>=d.length||A>d.length)return{start:0,end:0};if(b>A){const K=b;b=A,A=K}return{start:b,end:A}}):void 0,h=this.themeService.getColorTheme().type===So.LIGHT?s.icon:s.iconDark,p=h?U.revive(h):void 0,f=this.getHover(d,o,s);i.actionBar.clear(),i.icon.style.color="";let g=!0;if(s.command&&(g=wy(s.command,this.contextKeyService)),this.renderCheckbox(s,i),o){const b=this.configurationService.getValue("explorer.decorations"),A=o||U.parse("missing:_icon_resource");i.resourceLabel.setResource({name:d,description:r,resource:A},{fileKind:this.getFileKind(s),title:f,hideIcon:this.shouldHideResourceLabelIcon(p,s.themeIcon),fileDecorations:b,extraClasses:["custom-view-tree-node-item-resourceLabel"],matches:l||Ko(e.filterData),strikethrough:n?.strikethrough,disabledCommand:!g,labelEscapeNewLines:!0,forceLabel:!!s.label})}else i.resourceLabel.setResource({name:d,description:r},{title:f,hideIcon:!0,extraClasses:["custom-view-tree-node-item-resourceLabel"],matches:l||Ko(e.filterData),strikethrough:n?.strikethrough,disabledCommand:!g,labelEscapeNewLines:!0});if(p)i.icon.className="custom-view-tree-node-item-icon",i.icon.style.backgroundImage=Ji(p);else{let b;this.shouldShowThemeIcon(!!o,s.themeIcon)&&(b=Ce.asClassName(s.themeIcon),s.themeIcon.color&&(i.icon.style.color=this.themeService.getColorTheme().getColor(s.themeIcon.color.id)?.toString()??"")),i.icon.className=b?`custom-view-tree-node-item-icon ${b}`:"",i.icon.style.backgroundImage=""}g||(i.icon.className=i.icon.className+" disabled",i.container.parentElement&&(i.container.parentElement.className=i.container.parentElement.className+" disabled")),i.actionBar.context={$treeViewId:this.treeViewId,$treeItemHandle:s.handle};const m=this.menus.getResourceActions([s]);i.actionBar.push(m,{icon:!0,label:!1}),this._actionRunner&&(i.actionBar.actionRunner=this._actionRunner),this.setAlignment(i.container,s);const v=this._renderedElements.get(e.element.handle)??[];this._renderedElements.set(e.element.handle,[...v,{original:e,rendered:i}])}rerender(){const e=new Set(this._renderedElements.keys());for(const t of e){const i=this._renderedElements.get(t)??[];for(const s of i)this.disposeElement(s.original,0,s.rendered),this.renderElement(s.original,0,s.rendered)}}renderCheckbox(e,t){if(e.checkbox){if(this._hasCheckbox||(this._hasCheckbox=!0,this.rerender()),!t.checkbox){const i=new jd(t.checkboxContainer,this.checkboxStateHandler,this._hoverDelegate,this.hoverService);t.checkbox=i}t.checkbox.render(e)}else t.checkbox&&(t.checkbox.dispose(),t.checkbox=void 0)}setAlignment(e,t){e.parentElement.classList.toggle("align-icon-with-twisty",!this._hasCheckbox&&this.aligner.alignIconWithTwisty(t))}shouldHideResourceLabelIcon(e,t){return!!e||!!t&&!this.isFileKindThemeIcon(t)}shouldShowThemeIcon(e,t){return t?!(e&&this.isFileKindThemeIcon(t)):!1}isFolderThemeIcon(e){return e?.id===Gc.id}isFileKindThemeIcon(e){return e?e.id===Op.id||this.isFolderThemeIcon(e):!1}getFileKind(e){if(e.themeIcon)switch(e.themeIcon.id){case Op.id:return bn.FILE;case Gc.id:return bn.FOLDER}return e.collapsibleState===Ri.Collapsed||e.collapsibleState===Ri.Expanded?bn.FOLDER:bn.FILE}onDidChangeContext(e){const t=[];for(const[i,s]of this._renderedElements)for(const o of s)(e.affectsSome(this.menus.getElementOverlayContexts(o.original.element))||e.affectsSome(this.menus.getEntireMenuContexts()))&&t.push(o.original.element);t.length&&this._onDidChangeMenuContext.fire(t)}updateCheckboxes(e){let t=[];this.manuallyManageCheckboxes()?t=e:t=vy(e),t.forEach(i=>{const s=this._renderedElements.get(i.handle);s&&s.forEach(o=>o.rendered.checkbox?.render(i))}),this._onDidChangeCheckboxState.fire(t)}disposeElement(e,t,i){const s=this._renderedElements.get(e.element.handle)??[],o=s.findIndex(n=>i===n.rendered);s.length===1?this._renderedElements.delete(e.element.handle):s.length>0&&s.splice(o,1),i.checkbox?.dispose(),i.checkbox=void 0}disposeTemplate(e){e.resourceLabel.dispose(),e.actionBar.dispose()}};dr=Dh=D([u(7,me),u(8,ie),u(9,Fi),u(10,se),u(11,At),u(12,F)],dr);class Rx extends R{constructor(e){super(),this.themeService=e}set tree(e){this._tree=e}alignIconWithTwisty(e){if(e.collapsibleState!==Ri.None||!this.hasIcon(e))return!1;if(this._tree){const t=this._tree.getParentElement(e)||this._tree.getInput();return this.hasIcon(t)?!!t.children&&t.children.some(i=>i.collapsibleState!==Ri.None&&!this.hasIcon(i)):!!t.children&&t.children.every(i=>i.collapsibleState===Ri.None||!this.hasIcon(i))}else return!1}hasIcon(e){if(this.themeService.getColorTheme().type===So.LIGHT?e.icon:e.iconDark)return!0;if(e.resourceUri||e.themeIcon){const i=this.themeService.getFileIconTheme();return(e.themeIcon?e.themeIcon.id===Gc.id:e.collapsibleState!==Ri.None)?i.hasFileIcons&&i.hasFolderIcons:i.hasFileIcons}return!1}}class yy extends Qf{constructor(e,t){super(),this.getSelectedResources=t,this._register(this.onDidRun(i=>{i.error&&!ud(i.error)&&e.error(c(3513,"Error running command {1}: {0}. This is likely caused by the extension that contributes {1}.",i.error.message,i.action.id))}))}async runAction(e,t){const i=this.getSelectedResources();let s,o=!1;i.length>1&&(s=i.map(n=>((n.handle===t.$treeItemHandle||t.$selectedTreeItems)&&(o=!0),{$treeViewId:t.$treeViewId,$treeItemHandle:n.handle}))),!o&&s&&(s=void 0),await e.run(t,s)}}let kh=class{constructor(e,t){this.id=e,this.menuService=t,this._onDidChange=new E,this.onDidChange=this._onDidChange.event}getResourceActions(e){return this.getActions(this.getMenuId(),e).primary}getResourceContextActions(e){return this.getActions(this.getMenuId(),e).secondary}setContextKeyService(e){this.contextKeyService=e}filterNonUniversalActions(e,t){const i=new Set(t.map(s=>s.id));for(const s of e){const o=s.keys();for(const n of o)i.has(n)||s.delete(n)}}buildMenu(e){const t=[];for(const i of e)i.size>0&&(t.length&&t.push(new ss),t.push(...i.values()));return t}createGroups(e){const t=[];let i=new Map;for(const s of e)s instanceof ss?(t.push(i),i=new Map):i.set(s.id,s);return t.push(i),t}getElementOverlayContexts(e){return new Map([["view",this.id],["viewItem",e.contextValue]])}getEntireMenuContexts(){return this.menuService.getMenuContexts(this.getMenuId())}getMenuId(){return w.ViewItemContext}getActions(e,t){if(!this.contextKeyService)return{primary:[],secondary:[]};let i=[],s=[];for(let o=0;o<t.length;o++){const n=t[o],r=this.contextKeyService.createOverlay(this.getElementOverlayContexts(n)),d=this.menuService.getMenuActions(e,r,{shouldForwardArgs:!0}),l=da(d,"inline");o===0?(i=this.createGroups(l.primary),s=this.createGroups(l.secondary)):(this.filterNonUniversalActions(i,l.primary),this.filterNonUniversalActions(s,l.secondary))}return{primary:this.buildMenu(i),secondary:this.buildMenu(s)}}dispose(){this.contextKeyService=void 0}};kh=D([u(1,ps)],kh);let Rh=class extends Th{constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b,A,K,P){super(e,t,s,o,n,r,d,l,h,p,f,m,g,b,K,P),this.extensionId=i,this.extensionService=v,this.telemetryService=A}activate(){this.activated||(this.telemetryService.publicLog2("Extension:ViewActivate",{extensionId:new hC(this.extensionId),id:this.id}),this.createTree(),this.progressService.withProgress({location:this.id},()=>this.extensionService.activateByEvent(`onView:${this.id}`)).then(()=>io(2e3)).then(()=>{this.updateMessage()}),this.activated=!0)}};Rh=D([u(3,me),u(4,F),u(5,wt),u(6,ie),u(7,Ad),u(8,at),u(9,it),u(10,Ke),u(11,Ye),u(12,se),u(13,At),u(14,kt),u(15,ks),u(16,mt),u(17,Ue),u(18,Tt)],Rh);let Lh=class{constructor(e,t,i,s,o){this.treeId=e,this.labelService=t,this.instantiationService=i,this.treeViewsDragAndDropService=s,this.logService=o,this.treeItemsTransfer=ko.getInstance(),this.treeMimeType=`application/vnd.code.tree.${e.toLowerCase()}`}set controller(e){this.dndController=e}handleDragAndLog(e,t,i,s){return e.handleDrag(t,i,s).then(o=>{if(o){const n=[];for(const r of o)r[0]!==this.treeMimeType&&e.dragMimeTypes.findIndex(d=>d===r[0])<0&&n.push(r[0]);n.length&&this.logService.warn(`Drag and drop controller for tree ${this.treeId} adds the following data transfer types but does not declare them in dragMimeTypes: ${n.join(", ")}`)}return o})}addExtensionProvidedTransferTypes(e,t){if(!e.dataTransfer||!this.dndController)return;const i=Yo();this.dragCancellationToken=new Ts,this.treeViewsDragAndDropService.addDragOperationTransfer(i,this.handleDragAndLog(this.dndController,t,i,this.dragCancellationToken.token)),this.treeItemsTransfer.setData([new Ws(i)],Ws.prototype),e.dataTransfer.clearData(Tn.text),this.dndController.dragMimeTypes.find(s=>s===Tn.uriList)&&e.dataTransfer?.setData(Dn.RESOURCES,""),this.dndController.dragMimeTypes.forEach(s=>{e.dataTransfer?.setData(s,"")})}addResourceInfoToTransfer(e,t){if(t.length&&e.dataTransfer){this.instantiationService.invokeFunction(s=>u_(s,t,e));const i=t.filter(s=>s.scheme===pe.file).map(s=>s.fsPath);i.length&&e.dataTransfer.setData(zc.FILES,JSON.stringify(i))}}onDragStart(e,t){if(t.dataTransfer){const i=e.getData(),s=[],o={id:this.treeId,itemHandles:[]};i.forEach(n=>{o.itemHandles.push(n.handle),n.resourceUri&&s.push(U.revive(n.resourceUri))}),this.addResourceInfoToTransfer(t,s),this.addExtensionProvidedTransferTypes(t,o.itemHandles),t.dataTransfer.setData(this.treeMimeType,JSON.stringify(o))}}debugLog(e){e.size?this.logService.debug(`TreeView dragged mime types: ${Array.from(e).join(", ")}`):this.logService.debug("TreeView dragged with no supported mime types.")}onDragOver(e,t,i,s,o){const n=tg(o.dataTransfer),r=new Set(Array.from(n,h=>h[0]));if(o.dataTransfer){for(const h of o.dataTransfer.items)if(h.kind==="file"||h.type===Dn.RESOURCES.toLowerCase()){r.add(Tn.uriList);break}}this.debugLog(r);const d=this.dndController;return!d||!o.dataTransfer||d.dropMimeTypes.length===0?!1:Array.from(r).some((h,p)=>h===this.treeMimeType?!0:d.dropMimeTypes.indexOf(h)>=0)?{accept:!0,bubble:uC.Down,autoExpand:!0}:!1}getDragURI(e){return this.dndController?e.resourceUri?U.revive(e.resourceUri).toString():e.handle:null}getDragLabel(e){if(!this.dndController)return;if(e.length>1)return String(e.length);const t=e[0];return t.label?t.label.label:t.resourceUri?this.labelService.getUriLabel(U.revive(t.resourceUri)):void 0}async drop(e,t,i,s,o){const n=this.dndController;if(!o.dataTransfer||!n)return;let r,d;this.treeItemsTransfer.hasData(Ws.prototype)&&(d=this.treeItemsTransfer.getData(Ws.prototype)[0].identifier);const l=tg(o.dataTransfer,!0),h=new p_;for(const[f,g]of l)if((f===this.treeMimeType||n.dropMimeTypes.includes(f)||g.asFile()&&n.dropMimeTypes.includes(Dn.FILES.toLowerCase()))&&(h.append(f,g),f===this.treeMimeType))try{r=JSON.parse(await g.asString())}catch{}const p=await this.treeViewsDragAndDropService.removeDragOperationTransfer(d);if(p)for(const[f,g]of p)h.append(f,g);return n.handleDrop(h,t,wi.None,d,r?.id,r?.itemHandles)}onDragEnd(e){e.dataTransfer?.dropEffect==="none"&&this.dragCancellationToken?.cancel()}dispose(){}};Lh=D([u(1,Fi),u(2,F),u(3,ff),u(4,Ue)],Lh);function vy(a){const e=[];for(const t of a)if(t.checkbox!==void 0){const i=n=>{for(const r of n.children??[])r.checkbox!==void 0&&n.checkbox!==void 0&&r.checkbox.isChecked!==n.checkbox.isChecked&&(r.checkbox.isChecked=n.checkbox.isChecked,e.push(r),i(r))};i(t);const s=new Set,o=n=>{if(n.parent&&n.parent.checkbox!==void 0&&n.parent.children){if(s.has(n.parent))return;s.add(n.parent);let r=!1,d=!1;for(const l of n.parent.children){if(r&&d)break;l.checkbox!==void 0&&(l.checkbox.isChecked?d=!0:r=!0)}d&&!r&&n.parent.checkbox.isChecked!==!0?(n.parent.checkbox.isChecked=!0,e.push(n.parent),o(n.parent)):r&&n.parent.checkbox.isChecked!==!1&&(n.parent.checkbox.isChecked=!1,e.push(n.parent),o(n.parent))}};o(t)}return a.concat(e)}const Lx=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));he("remote-explorer-get-started",k.star,c(8927,"Getting started icon in the remote explorer view."));he("remote-explorer-documentation",k.book,c(8928,"Documentation icon in the remote explorer view."));he("remote-explorer-feedback",k.twitter,c(8929,"Feedback icon in the remote explorer view."));he("remote-explorer-review-issues",k.issues,c(8930,"Review issue icon in the remote explorer view."));he("remote-explorer-report-issues",k.comment,c(8931,"Report issue icon in the remote explorer view."));he("remote-explorer-view-icon",k.remoteExplorer,c(8932,"View icon of the remote explorer view."));const by=he("ports-view-icon",k.plug,c(8933,"View icon of the remote ports view."));he("ports-view-icon",k.plug,c(8934,"Icon representing a remote port."));const Cy=he("private-ports-view-icon",k.lock,c(8935,"Icon representing a private remote port.")),Vx=he("ports-forward-icon",k.plus,c(8936,"Icon for the forward action.")),Px=he("ports-stop-forward-icon",k.x,c(8937,"Icon for the stop forwarding action.")),Mx=he("ports-open-browser-icon",k.globe,c(8938,"Icon for the open browser action.")),Ox=he("ports-open-preview-icon",k.openPreview,c(8939,"Icon for the open preview action.")),Nx=he("ports-copy-address-icon",k.clippy,c(8940,"Icon for the copy local address action.")),Sy=he("ports-label-icon",k.tag,c(8941,"Icon for the label port action.")),Bx=he("ports-forwarded-without-process-icon",k.circleOutline,c(8942,"Icon for forwarded ports that don't have a running process.")),Fx=he("ports-forwarded-with-process-icon",k.circleFilled,c(8943,"Icon for forwarded ports that do have a running process."));var Vh;Pe(Lx);const Kx=new j("openPreviewEnabled",!1);class Wx{constructor(e){this.remoteExplorerService=e,this.headerRowHeight=22}getHeight(e){return e.tunnelType===Ve.Add&&!this.remoteExplorerService.getEditableData(void 0)?30:22}}let Ph=class{constructor(e,t){this.remoteExplorerService=e,this.tunnelService=t,this._candidates=new Map,this.input={label:c(8973,"Add Port"),icon:void 0,tunnelType:Ve.Add,hasRunningProcess:!1,remoteHost:"",remotePort:0,processDescription:"",tooltipPostfix:"",iconTooltip:"",portTooltip:"",processTooltip:"",originTooltip:"",privacyTooltip:"",source:{source:Ru.User,description:""},protocol:is.Http,privacy:{id:Sa.Private,themeIcon:Cy.id,label:c(8974,"Private")},strip:()=>{}},this.model=e.tunnelModel,this.onForwardedPortsChanged=V.any(this.model.onForwardPort,this.model.onClosePort,this.model.onPortName,this.model.onCandidatesChanged)}get all(){const e=[];return this._candidates=new Map,this.model.candidates.forEach(t=>{this._candidates.set(Et(t.host,t.port),t)}),(this.model.forwarded.size>0||this.remoteExplorerService.getEditableData(void 0))&&e.push(...this.forwarded),this.model.detected.size>0&&e.push(...this.detected),e.push(this.input),e}addProcessInfoFromCandidate(e){const t=Et(e.remoteHost,e.remotePort);this._candidates.has(t)&&(e.processDescription=this._candidates.get(t).detail)}get forwarded(){return Array.from(this.model.forwarded.values()).map(t=>{const i=Ze.createFromTunnel(this.remoteExplorerService,this.tunnelService,t);return this.addProcessInfoFromCandidate(i),i}).sort((t,i)=>t.remotePort===i.remotePort?t.remoteHost<i.remoteHost?-1:1:t.remotePort<i.remotePort?-1:1)}get detected(){return Array.from(this.model.detected.values()).map(e=>{const t=Ze.createFromTunnel(this.remoteExplorerService,this.tunnelService,e,Ve.Detected,!1);return this.addProcessInfoFromCandidate(t),t})}isEmpty(){return this.detected.length===0&&(this.forwarded.length===0||this.forwarded.length===1&&this.forwarded[0].tunnelType===Ve.Add&&!this.remoteExplorerService.getEditableData(void 0))}};Ph=D([u(0,He),u(1,Yt)],Ph);function Lr(a){return{label:"",tunnel:a,editId:It.None,tooltip:""}}class Gx{constructor(){this.label="",this.tooltip="",this.weight=1,this.minimumWidth=40,this.maximumWidth=40,this.templateId="actionbar"}project(e){if(e.tunnelType===Ve.Add)return Lr(e);const t=e.processDescription?Fx:Bx;let i="";return e instanceof Ze&&(i=`${e.iconTooltip} ${e.tooltipPostfix}`),{label:"",icon:t,tunnel:e,editId:It.None,tooltip:i}}}class Ux{constructor(){this.label=c(8975,"Port"),this.tooltip=c(8976,"The label and remote port number of the forwarded port."),this.weight=1,this.templateId="actionbar"}project(e){const t=e.tunnelType===Ve.Add,i=e.label;let s="";return e instanceof Ze&&!t?s=`${e.portTooltip} ${e.tooltipPostfix}`:s=i,{label:i,tunnel:e,menuId:w.TunnelPortInline,editId:e.tunnelType===Ve.Add?It.New:It.Label,tooltip:s}}}class Yu{constructor(){this.label=c(8977,"Forwarded Address"),this.tooltip=c(8978,"The address that the forwarded port is available at."),this.weight=1,this.templateId="actionbar"}project(e){if(e.tunnelType===Ve.Add)return Lr(e);const t=e.localAddress??"";let i=t;return e instanceof Ze&&(i=e.tooltipPostfix),{label:t,menuId:w.TunnelLocalAddressInline,tunnel:e,editId:It.LocalPort,tooltip:i,markdownTooltip:t?Yu.getHoverText(t):void 0}}static getHoverText(e){return function(t){const i=t.getValue("editor");let s="";i.multiCursorModifier==="ctrlCmd"?ut?s=c(8979,"option + click"):s=c(8980,"alt + click"):ut?s=c(8981,"cmd + click"):s=c(8982,"ctrl + click");const o=new ts("",!0),n=e.startsWith("http")?e:`http://${e}`;return o.appendLink(n,"Follow link").appendMarkdown(` (${s})`)}}}class Hx{constructor(){this.label=c(8983,"Running Process"),this.tooltip=c(8984,"The command line of the process that is using the port."),this.weight=2,this.templateId="actionbar"}project(e){return e.tunnelType===Ve.Add?Lr(e):{label:e.processDescription??"",tunnel:e,editId:It.None,tooltip:e instanceof Ze?e.processTooltip:""}}}class zx{constructor(){this.label=c(8985,"Origin"),this.tooltip=c(8986,"The source that a forwarded port originates from. Can be an extension, user forwarded, statically forwarded, or automatically forwarded."),this.weight=1,this.templateId="actionbar"}project(e){if(e.tunnelType===Ve.Add)return Lr(e);const t=e.source.description,i=`${e instanceof Ze?e.originTooltip:""}. ${e instanceof Ze?e.tooltipPostfix:""}`;return{label:t,menuId:w.TunnelOriginInline,tunnel:e,editId:It.None,tooltip:i}}}class $x{constructor(){this.label=c(8987,"Visibility"),this.tooltip=c(8988,"The availability of the forwarded port."),this.weight=1,this.templateId="actionbar"}project(e){if(e.tunnelType===Ve.Add)return Lr(e);const t=e.privacy?.label;let i="";return e instanceof Ze&&(i=`${e.privacy.label} ${e.tooltipPostfix}`),{label:t,tunnel:e,icon:{id:e.privacy.themeIcon},editId:It.None,tooltip:i}}}let Mh=class extends R{constructor(e,t,i,s,o,n,r){super(),this.instantiationService=e,this.contextKeyService=t,this.menuService=i,this.contextViewService=s,this.remoteExplorerService=o,this.commandService=n,this.configurationService=r,this.templateId="actionbar",this._hoverDelegate=au("mouse")}set actionRunner(e){this._actionRunner=e}renderTemplate(e){const t=ge(e,B(".ports-view-actionbar-cell")),i=ge(t,B(".ports-view-actionbar-cell-icon")),s=new Sd(t,{supportHighlights:!0,hoverDelegate:this._hoverDelegate}),o=ge(t,B(".actions")),n=new Qo(o,{actionViewItemProvider:du.bind(void 0,this.instantiationService),hoverDelegate:this._hoverDelegate});return{label:s,icon:i,actionBar:n,container:t,elementDisposable:R.None}}renderElement(e,t,i){i.actionBar.clear(),i.icon.className="ports-view-actionbar-cell-icon",i.icon.style.display="none",i.label.setLabel(""),i.label.element.style.display="none",i.container.style.height="22px",i.button&&(i.button.element.style.display="none",i.button.dispose()),i.container.style.paddingLeft="0px",i.elementDisposable.dispose();let s;e.editId===It.New&&(s=this.remoteExplorerService.getEditableData(void 0))?this.renderInputBox(i.container,s):(s=this.remoteExplorerService.getEditableData(e.tunnel,e.editId),s?this.renderInputBox(i.container,s):e.tunnel.tunnelType===Ve.Add&&e.menuId===w.TunnelPortInline?this.renderButton(e,i):this.renderActionBarItem(e,i))}renderButton(e,t){t.container.style.paddingLeft="7px",t.container.style.height="28px",t.button=this._register(new Xf(t.container,Yn)),t.button.label=e.label,t.button.element.title=e.tooltip,this._register(t.button.onDidClick(()=>{this.commandService.executeCommand(Xe.INLINE_ID)}))}tunnelContext(e){let t;return e instanceof Ze&&(t=e.strip()),t||(t={tunnelType:e.tunnelType,remoteHost:e.remoteHost,remotePort:e.remotePort,localAddress:e.localAddress,protocol:e.protocol,localUri:e.localUri,localPort:e.localPort,name:e.name,closeable:e.closeable,source:e.source,privacy:e.privacy,processDescription:e.processDescription,label:e.label}),t}renderActionBarItem(e,t){t.label.element.style.display="flex",t.label.setLabel(e.label,void 0,{title:e.markdownTooltip?{markdown:e.markdownTooltip(this.configurationService),markdownNotSupportedFallback:e.tooltip}:e.tooltip,extraClasses:e.menuId===w.TunnelLocalAddressInline?["ports-view-actionbar-cell-localaddress"]:void 0}),t.actionBar.context=this.tunnelContext(e.tunnel),t.container.style.paddingLeft="10px";const i=[["view",Us],[Vr.key,e.tunnel.tunnelType],[Pr.key,e.tunnel.closeable],[Oh.key,e.tunnel.privacy.id],[qd.key,e.tunnel.protocol]],s=this.contextKeyService.createOverlay(i),o=new O;if(t.elementDisposable=o,e.menuId){const n=o.add(this.menuService.createMenu(e.menuId,s));let r=Id(n.getActions({shouldForwardArgs:!0}));if(r){const d=r.filter(l=>l.id.toLowerCase().indexOf("label")>=0);d.length>1&&(d.sort((l,h)=>l.label.length-h.label.length),d.pop(),r=r.filter(l=>d.indexOf(l)<0)),t.actionBar.push(r,{icon:!0,label:!1}),this._actionRunner&&(t.actionBar.actionRunner=this._actionRunner)}}e.icon&&(t.icon.className=`ports-view-actionbar-cell-icon ${Ce.asClassName(e.icon)}`,t.icon.title=e.tooltip,t.icon.style.display="inline")}renderInputBox(e,t){this.inputDone&&(this.inputDone(!1,!1),this.inputDone=void 0),e.style.paddingLeft="5px";const i=t.startingValue||"",s=new Rf(e,this.contextViewService,{ariaLabel:c(8989,"Press Enter to confirm or Escape to cancel."),validationOptions:{validation:r=>{const d=t.validationMessage(r);return d?{content:d.content,formatContent:!0,type:d.severity===_e.Error?Fr.ERROR:Fr.INFO}:null}},placeholder:t.placeholder||"",inputBoxStyles:gd});s.value=i,s.focus(),s.select({start:0,end:t.startingValue?t.startingValue.length:0});const o=wu(async(r,d)=>{qe(n),this.inputDone&&(this.inputDone=void 0),s.element.style.display="none";const l=s.value;if(d)return t.onFinish(l,r)});this.inputDone=o;const n=[s,gC(s.inputElement,te.KEY_DOWN,async r=>{if(r.equals(y.Enter))return r.stopPropagation(),s.validate()!==Fr.ERROR?o(!0,!0):o(!1,!0);if(r.equals(y.Escape))return r.preventDefault(),r.stopPropagation(),o(!1,!0)}),Y(s.inputElement,te.BLUR,()=>o(s.validate()!==Fr.ERROR,!0))];return ae(()=>{o(!1,!1)})}disposeElement(e,t,i,s){i.elementDisposable.dispose()}disposeTemplate(e){e.label.dispose(),e.actionBar.dispose(),e.elementDisposable.dispose(),e.button?.dispose()}};Mh=D([u(0,F),u(1,se),u(2,ps),u(3,Xo),u(4,He),u(5,wt),u(6,ie)],Mh);class Ze{static createFromTunnel(e,t,i,s=Ve.Forwarded,o){return new Ze(s,i.remoteHost,i.remotePort,i.source,!!i.hasRunningProcess,i.protocol,i.localUri,i.localAddress,i.localPort,o===void 0?i.closeable:o,i.name,i.runningProcess,i.pid,i.privacy,e,t)}strip(){return new Ze(this.tunnelType,this.remoteHost,this.remotePort,this.source,this.hasRunningProcess,this.protocol,this.localUri,this.localAddress,this.localPort,this.closeable,this.name,this.runningProcess,this.pid,this._privacy)}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b){this.tunnelType=e,this.remoteHost=t,this.remotePort=i,this.source=s,this.hasRunningProcess=o,this.protocol=n,this.localUri=r,this.localAddress=d,this.localPort=l,this.closeable=h,this.name=p,this.runningProcess=f,this.pid=g,this._privacy=m,this.remoteExplorerService=v,this.tunnelService=b}get label(){if(this.tunnelType===Ve.Add&&this.name)return this.name;const e=f_(this.remoteHost)||m_(this.remoteHost)?`${this.remotePort}`:`${this.remoteHost}:${this.remotePort}`;return this.name?`${this.name} (${e})`:e}set processDescription(e){this.runningProcess=e}get processDescription(){let e="";return this.runningProcess?(this.pid&&this.remoteExplorerService?.namedProcesses.has(this.pid)?e=this.remoteExplorerService.namedProcesses.get(this.pid):e=this.runningProcess.replace(/\0/g," ").trim(),this.pid&&(e+=` (${this.pid})`)):this.hasRunningProcess&&(e=c(8990,"Process information unavailable")),e}get tooltipPostfix(){let e;return this.localAddress?e=c(8991,"Remote port {0}:{1} forwarded to local address {2}. ",this.remoteHost,this.remotePort,this.localAddress):e=c(8992,"Remote port {0}:{1} not forwarded. ",this.remoteHost,this.remotePort),e}get iconTooltip(){return this.tunnelType===Ve.Add?this.label:`${this.processDescription?c(8993,"Port has running process."):c(8994,"No running process.")}`}get portTooltip(){return this.tunnelType===Ve.Add?"":`${this.name?c(8995,"Port labeled {0}. ",this.name):""}`}get processTooltip(){return this.processDescription??""}get originTooltip(){return this.source.description}get privacy(){return this.tunnelService?.privacyOptions?this.tunnelService?.privacyOptions.find(e=>e.id===this._privacy)??{id:"",themeIcon:k.question.id,label:c(8996,"Unknown")}:{id:Sa.Private,themeIcon:Cy.id,label:c(8974,"Private")}}}const Vr=new j("tunnelType",Ve.Add,!0),Pr=new j("tunnelCloseable",!1,!0),Oh=new j("tunnelPrivacy",void 0,!0),_y=new j("tunnelPrivacyEnabled",!1,!0),qd=new j("tunnelProtocol",is.Http,!0),Yd=new j("tunnelViewFocus",!1,c(8997,"Whether the Ports view has focus.")),Mr="tunnelViewSelection",jx=new j(Mr,void 0,!0),Ey="tunnelViewMultiSelection",Iy=new j(Ey,void 0,!0),Dy=new j("portChangable",!1,!0),Ay=new j("protocolChangable",!0,!0);let qs=class extends Rd{static{Vh=this}static{this.ID=Us}static{this.TITLE=x(8998,"Ports")}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b,A){super(t,i,s,n,o,d,r,l,g,v),this.viewModel=e,this.quickInputService=h,this.commandService=p,this.menuService=f,this.remoteExplorerService=m,this.tunnelService=b,this.contextViewService=A,this.tableDisposables=this._register(new O),this.isEditing=!1,this.titleActions=[],this.lastFocus=[],this.height=0,this.width=0,this.tunnelTypeContext=Vr.bindTo(o),this.tunnelCloseableContext=Pr.bindTo(o),this.tunnelPrivacyContext=Oh.bindTo(o),this.tunnelPrivacyEnabledContext=_y.bindTo(o),this.tunnelPrivacyEnabledContext.set(b.canChangePrivacy),this.protocolChangableContextKey=Ay.bindTo(o),this.protocolChangableContextKey.set(b.canChangeProtocol),this.tunnelProtocolContext=qd.bindTo(o),this.tunnelViewFocusContext=Yd.bindTo(o),this.tunnelViewSelectionContext=jx.bindTo(o),this.tunnelViewMultiSelectionContext=Iy.bindTo(o),this.portChangableContextKey=Dy.bindTo(o);const K=this.contextKeyService.createOverlay([["view",Vh.ID]]),P=this._register(this.menuService.createMenu(w.TunnelTitle,K)),L=()=>{this.titleActions=Id(P.getActions()),this.updateActions()};this._register(P.onDidChange(L)),L(),this._register(ae(()=>{this.titleActions=[]})),this.registerPrivacyActions(),this._register(V.once(this.tunnelService.onAddedTunnelProvider)(()=>{let $=!1;this.tunnelPrivacyEnabledContext.get()===!1&&(this.tunnelPrivacyEnabledContext.set(b.canChangePrivacy),$=!0),this.protocolChangableContextKey.get()===!0&&(this.protocolChangableContextKey.set(b.canChangeProtocol),$=!0),$&&(L(),this.registerPrivacyActions(),this.createTable(),this.table?.layout(this.height,this.width))}))}registerPrivacyActions(){for(const e of this.tunnelService.privacyOptions){const t=`remote.tunnel.privacy${e.id}`;Te.registerCommand(t,Nh.handler(e.id)),S.appendMenuItem(w.TunnelPrivacy,{order:0,command:{id:t,title:e.label,toggled:Oh.isEqualTo(e.id)}})}}get portCount(){return this.remoteExplorerService.tunnelModel.forwarded.size+this.remoteExplorerService.tunnelModel.detected.size}createTable(){if(!this.panelContainer)return;this.tableDisposables.clear(),ji(this.panelContainer);const e=ge(this.panelContainer,B(".customview-tree"));e.classList.add("ports-view"),e.classList.add("file-icon-themable-tree","show-file-icons");const t=new Mh(this.instantiationService,this.contextKeyService,this.menuService,this.contextViewService,this.remoteExplorerService,this.commandService,this.configurationService),i=[new Gx,new Ux,new Yu,new Hx];this.tunnelService.canChangePrivacy&&i.push(new $x),i.push(new zx),this.table=this.instantiationService.createInstance(pC,"RemoteTunnels",e,new Wx(this.remoteExplorerService),i,[t],{keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:r=>r.label},multipleSelectionSupport:!0,accessibilityProvider:{getAriaLabel:r=>r instanceof Ze?`${r.tooltipPostfix} ${r.portTooltip} ${r.iconTooltip} ${r.processTooltip} ${r.originTooltip} ${this.tunnelService.canChangePrivacy?r.privacy.label:""}`:r.label,getWidgetAriaLabel:()=>c(8999,"Tunnel View")},openOnSingleClick:!0});const s=this.tableDisposables.add(new Qf);t.actionRunner=s,this.tableDisposables.add(this.table),this.tableDisposables.add(this.table.onContextMenu(r=>this.onContextMenu(r,s))),this.tableDisposables.add(this.table.onMouseDblClick(r=>this.onMouseDblClick(r))),this.tableDisposables.add(this.table.onDidChangeFocus(r=>this.onFocusChanged(r))),this.tableDisposables.add(this.table.onDidChangeSelection(r=>this.onSelectionChanged(r))),this.tableDisposables.add(this.table.onDidFocus(()=>this.tunnelViewFocusContext.set(!0))),this.tableDisposables.add(this.table.onDidBlur(()=>this.tunnelViewFocusContext.set(!1)));const o=()=>this.table?.splice(0,Number.POSITIVE_INFINITY,this.viewModel.all);o();let n=this.portCount;this.tableDisposables.add(V.debounce(this.viewModel.onForwardedPortsChanged,(r,d)=>d,50)(()=>{const r=this.portCount;(n===0||r===0)&&n!==r&&this._onDidChangeViewWelcomeState.fire(),n=r,o()})),this.tableDisposables.add(this.table.onMouseClick(r=>{if(this.hasOpenLinkModifier(r.browserEvent)&&this.table){const d=this.table.getSelectedElements();(d.length===0||d.length===1&&d[0]===r.element)&&this.commandService.executeCommand(qt.ID,r.element)}})),this.tableDisposables.add(this.table.onDidOpen(r=>{!r.element||r.element.tunnelType!==Ve.Forwarded||r.browserEvent?.type==="dblclick"&&this.commandService.executeCommand(hs.ID)})),this.tableDisposables.add(this.remoteExplorerService.onDidChangeEditable(r=>{this.isEditing=!!this.remoteExplorerService.getEditableData(r?.tunnel,r?.editId),this._onDidChangeViewWelcomeState.fire(),this.isEditing||e.classList.remove("highlight"),o(),this.isEditing?(e.classList.add("highlight"),r||this.table?.reveal(this.table.indexOf(this.viewModel.input))):(r&&r.tunnel.tunnelType!==Ve.Add&&this.table?.setFocus(this.lastFocus),this.focus())}))}renderBody(e){super.renderBody(e),this.panelContainer=ge(e,B(".tree-explorer-viewlet-tree-view")),this.createTable()}shouldShowWelcome(){return this.viewModel.isEmpty()&&!this.isEditing}focus(){super.focus(),this.table?.domFocus()}onFocusChanged(e){e.indexes.length>0&&e.elements.length>0&&(this.lastFocus=[...e.indexes]);const t=e.elements,i=t&&t.length?t[0]:void 0;i?(this.tunnelViewSelectionContext.set(Et(i.remoteHost,i.remotePort)),this.tunnelTypeContext.set(i.tunnelType),this.tunnelCloseableContext.set(!!i.closeable),this.tunnelPrivacyContext.set(i.privacy.id),this.tunnelProtocolContext.set(i.protocol===is.Https?is.Https:is.Https),this.portChangableContextKey.set(!!i.localPort)):(this.tunnelTypeContext.reset(),this.tunnelViewSelectionContext.reset(),this.tunnelCloseableContext.reset(),this.tunnelPrivacyContext.reset(),this.tunnelProtocolContext.reset(),this.portChangableContextKey.reset())}hasOpenLinkModifier(e){const t=this.configurationService.getValue("editor");let i=!1;return t.multiCursorModifier==="ctrlCmd"?i=e.altKey:ut?i=e.metaKey:i=e.ctrlKey,i}onSelectionChanged(e){const t=e.elements;t.length>1?this.tunnelViewMultiSelectionContext.set(t.map(i=>Et(i.remoteHost,i.remotePort))):this.tunnelViewMultiSelectionContext.set(void 0)}onContextMenu(e,t){if(e.element!==void 0&&!(e.element instanceof Ze))return;e.browserEvent.preventDefault(),e.browserEvent.stopPropagation();const i=e.element;i?(this.table?.setFocus([this.table.indexOf(i)]),this.tunnelTypeContext.set(i.tunnelType),this.tunnelCloseableContext.set(!!i.closeable),this.tunnelPrivacyContext.set(i.privacy.id),this.tunnelProtocolContext.set(i.protocol),this.portChangableContextKey.set(!!i.localPort)):(this.tunnelTypeContext.set(Ve.Add),this.tunnelCloseableContext.set(!1),this.tunnelPrivacyContext.set(void 0),this.tunnelProtocolContext.set(void 0),this.portChangableContextKey.set(!1)),this.contextMenuService.showContextMenu({menuId:w.TunnelContext,menuActionOptions:{shouldForwardArgs:!0},contextKeyService:this.table?.contextKeyService,getAnchor:()=>e.anchor,getActionViewItem:s=>{const o=this.keybindingService.lookupKeybinding(s.id);if(o)return new hu(s,s,{label:!0,keybinding:o.getLabel()})},onHide:s=>{s&&this.table?.domFocus()},getActionsContext:()=>i?.strip(),actionRunner:t})}onMouseDblClick(e){e.element||this.commandService.executeCommand(Xe.INLINE_ID)}layoutBody(e,t){this.height=e,this.width=t,super.layoutBody(e,t),this.table?.layout(e,t)}};qs=Vh=D([u(2,it),u(3,at),u(4,se),u(5,ie),u(6,F),u(7,Ye),u(8,Tt),u(9,Jt),u(10,wt),u(11,ps),u(12,me),u(13,He),u(14,At),u(15,Yt),u(16,Xo)],qs);class qx{constructor(e,t){this.id=qs.ID,this.name=qs.TITLE,this.canToggleVisibility=!0,this.hideByDefault=!1,this.group="details@0",this.order=-500,this.canMoveView=!0,this.containerIcon=by,this.ctorDescriptor=new ee(qs,[e]),this.remoteAuthority=t.remoteAuthority?t.remoteAuthority.split("+")[0]:void 0}}function Vs(a){return a&&a.tunnelType&&a.remoteHost&&a.source}var hs;(function(a){a.ID="remote.tunnel.label",a.LABEL=c(9e3,"Set Port Label"),a.COMMAND_ID_KEYWORD="label";function e(){return async(t,i)=>{const s=t.get(He);let o;if(Vs(i))o=i;else{const n=t.get(se).getContextKeyValue(Mr),r=n?s.tunnelModel.forwarded.get(n):void 0;if(r){const d=t.get(Yt);o=Ze.createFromTunnel(s,d,r)}}if(o){const n=o;return new Promise(r=>{const d=n.name?n.name:`${n.remotePort}`;s.setEditable(n,It.Label,{onFinish:async(l,h)=>{l=l.trim(),s.setEditable(n,It.Label,null);const p=h&&l!==d;p&&await s.tunnelModel.name(n.remoteHost,n.remotePort,l),r(p?{port:n.remotePort,label:l}:void 0)},validationMessage:()=>null,placeholder:c(9001,"Port label"),startingValue:d})})}}}a.handler=e})(hs||(hs={}));const Yx=c(9002,"Forwarded port should be a number or a host:port."),Ju=65536,Ty=c(9003,"Port number must be ≥ 0 and < {0}.",Ju),xy=c(9004,"May Require Sudo"),Jx=c(9005,"Port is already forwarded");var Xe;(function(a){a.INLINE_ID="remote.tunnel.forwardInline",a.COMMANDPALETTE_ID="remote.tunnel.forwardCommandPalette",a.LABEL=x(9006,"Forward a Port"),a.TREEITEM_LABEL=c(9007,"Forward Port");const e=c(9008,"Port number or address (eg. 3000 or 10.10.10.10:2000).");function t(n,r,d,l){const h=pc(d);if(h){if(h.port>=Ju)return{content:Ty,severity:_e.Error};if(l&&r.isPortPrivileged(h.port))return{content:xy,severity:_e.Info};if(Ro(n.tunnelModel.forwarded,h.host,h.port))return{content:Jx,severity:_e.Error}}else return{content:Yx,severity:_e.Error};return null}function i(n,r,d,l){r?typeof r=="string"&&n.warn(c(9010,"Unable to forward {0}:{1}. {2}",d,l,r)):n.warn(c(9009,"Unable to forward {0}:{1}. The host may not be available or that remote port may already be forwarded",d,l))}function s(){return async(n,r)=>{const d=n.get(He),l=n.get(Ke),h=n.get(Yt);d.setEditable(void 0,It.New,{onFinish:async(p,f)=>{d.setEditable(void 0,It.New,null);let g;f&&(g=pc(p))&&d.forward({remote:{host:g.host,port:g.port},elevateIfNeeded:!0}).then(m=>i(l,m,g.host,g.port))},validationMessage:p=>t(d,h,p,h.canElevate),placeholder:e})}}a.inlineHandler=s;function o(){return async(n,r)=>{const d=n.get(He),l=n.get(Ke),h=n.get(gt),p=n.get(Jt),f=n.get(Yt);await h.openView(qs.ID,!0);const g=await p.input({prompt:e,validateInput:v=>Promise.resolve(t(d,f,v,f.canElevate))});let m;g&&(m=pc(g))&&d.forward({remote:{host:m.host,port:m.port},elevateIfNeeded:!0}).then(v=>i(l,v,m.host,m.port))}}a.commandPaletteHandler=o})(Xe||(Xe={}));function ky(a,e,t){const i=a.map(s=>{const o=Ze.createFromTunnel(e,t,s);return{label:o.label,description:o.processDescription,tunnel:o}});return i.length===0&&i.push({label:c(9011,"No ports currently forwarded. Try running the {0} command",Xe.LABEL.value)}),i}var ai;(function(a){a.INLINE_ID="remote.tunnel.closeInline",a.COMMANDPALETTE_ID="remote.tunnel.closeCommandPalette",a.LABEL=x(9012,"Stop Forwarding Port");function e(){return async(i,s)=>{const o=i.get(se),n=i.get(He);let r=[];const d=o.getContextKeyValue(Ey);if(d)d.forEach(l=>{const h=n.tunnelModel.forwarded.get(l);h&&r?.push(h)});else if(Vs(s))r=[s];else{const l=o.getContextKeyValue(Mr),h=l?n.tunnelModel.forwarded.get(l):void 0;h&&(r=[h])}if(!(!r||r.length===0))return Promise.all(r.map(l=>n.close({host:l.remoteHost,port:l.remotePort},oo.User)))}}a.inlineHandler=e;function t(){return async i=>{const s=i.get(Jt),o=i.get(He),n=i.get(Yt),r=i.get(wt),d=ky(Array.from(o.tunnelModel.forwarded.values()).filter(h=>h.closeable),o,n),l=await s.pick(d,{placeHolder:c(9013,"Choose a port to stop forwarding")});l&&l.tunnel?await o.close({host:l.tunnel.remoteHost,port:l.tunnel.remotePort},oo.User):l&&await r.executeCommand(Xe.COMMANDPALETTE_ID)}}a.commandPaletteHandler=t})(ai||(ai={}));var qt;(function(a){a.ID="remote.tunnel.open",a.LABEL=c(9014,"Open in Browser");function e(){return async(i,s)=>{let o;if(Vs(s)?o=Et(s.remoteHost,s.remotePort):s.tunnelRemoteHost&&s.tunnelRemotePort&&(o=Et(s.tunnelRemoteHost,s.tunnelRemotePort)),o){const n=i.get(He).tunnelModel,r=i.get(Tt);return t(n,r,o)}}}a.handler=e;function t(i,s,o){const n=i.forwarded.get(o)||i.detected.get(o);return n?s.open(n.localUri,{allowContributedOpeners:!1}):Promise.resolve()}a.run=t})(qt||(qt={}));var mi;(function(a){a.ID="remote.tunnel.openPreview",a.LABEL=c(9015,"Preview in Editor");function e(){return async(i,s)=>{let o;if(Vs(s)?o=Et(s.remoteHost,s.remotePort):s.tunnelRemoteHost&&s.tunnelRemotePort&&(o=Et(s.tunnelRemoteHost,s.tunnelRemotePort)),o){const n=i.get(He).tunnelModel,r=i.get(Tt),d=i.get(Hm);return t(n,r,d,o)}}}a.handler=e;async function t(i,s,o,n){const r=i.forwarded.get(n)||i.detected.get(n);if(r){const d=r.remoteHost.includes(":")?`[${r.remoteHost}]`:r.remoteHost,l=U.parse(`http://${d}:${r.remotePort}`),h=await o.getOpener(r.localUri,{sourceUri:l},wi.None);return h?h.openExternalUri(r.localUri,{sourceUri:l},wi.None):s.open(r.localUri)}return Promise.resolve()}a.run=t})(mi||(mi={}));var Ho;(function(a){a.ID="remote.tunnel.openCommandPalette",a.LABEL=c(9016,"Open Port in Browser");function e(){return async(t,i)=>{const s=t.get(He),o=t.get(Yt),n=s.tunnelModel,r=t.get(Jt),d=t.get(Tt),l=t.get(wt),h=[...n.forwarded,...n.detected].map(f=>{const g=Ze.createFromTunnel(s,o,f[1]);return{label:g.label,description:g.processDescription,tunnel:g}});h.length===0?h.push({label:c(9017,"No ports currently forwarded. Open the Ports view to get started.")}):h.push({label:c(9018,"Open the Ports view...")});const p=await r.pick(h,{placeHolder:c(9019,"Choose the port to open")});if(p&&p.tunnel)return qt.run(n,d,Et(p.tunnel.remoteHost,p.tunnel.remotePort));if(p)return l.executeCommand(`${Us}.focus`)}}a.handler=e})(Ho||(Ho={}));var di;(function(a){a.INLINE_ID="remote.tunnel.copyAddressInline",a.COMMANDPALETTE_ID="remote.tunnel.copyAddressCommandPalette",a.INLINE_LABEL=c(9020,"Copy Local Address"),a.COMMANDPALETTE_LABEL=c(9021,"Copy Forwarded Port Address");async function e(s,o,n){const r=s.tunnelModel.address(n.remoteHost,n.remotePort);r&&await o.writeText(r.toString())}function t(){return async(s,o)=>{const n=s.get(He);let r;if(Vs(o))r=o;else{const d=s.get(se).getContextKeyValue(Mr);r=d?n.tunnelModel.forwarded.get(d):void 0}if(r)return e(n,s.get(Uc),r)}}a.inlineHandler=t;function i(){return async(s,o)=>{const n=s.get(Jt),r=s.get(He),d=s.get(Yt),l=s.get(wt),h=s.get(Uc),p=Array.from(r.tunnelModel.forwarded.values()).concat(Array.from(r.tunnelModel.detected.values())),f=await n.pick(ky(p,r,d),{placeHolder:c(9022,"Choose a forwarded port")});f&&f.tunnel?await e(r,h,f.tunnel):f&&await l.executeCommand(Xe.COMMANDPALETTE_ID)}}a.commandPaletteHandler=i})(di||(di={}));var zo;(function(a){a.ID="remote.tunnel.changeLocalPort",a.LABEL=c(9023,"Change Local Address Port");function e(i,s,o){if(s.match(/^[0-9]+$/)){if(Number(s)>=Ju)return{content:Ty,severity:_e.Error};if(o&&i.isPortPrivileged(Number(s)))return{content:xy,severity:_e.Info}}else return{content:c(9024,"Local port should be a number."),severity:_e.Error};return null}function t(){return async(i,s)=>{const o=i.get(He),n=i.get(Ke),r=i.get(Yt);let d;if(Vs(s))d=s;else{const l=i.get(se).getContextKeyValue(Mr),h=l?o.tunnelModel.forwarded.get(l):void 0;if(h){const p=i.get(Yt);d=Ze.createFromTunnel(o,p,h)}}if(d){const l=d;o.setEditable(l,It.LocalPort,{onFinish:async(h,p)=>{if(o.setEditable(l,It.LocalPort,null),p){await o.close({host:l.remoteHost,port:l.remotePort},oo.Other);const f=Number(h),g=await o.forward({remote:{host:l.remoteHost,port:l.remotePort},local:f,name:l.name,elevateIfNeeded:!0,source:l.source});g&&typeof g!="string"&&g.tunnelLocalPort!==f&&n.warn(c(9025,"The local port {0} is not available. Port number {1} has been used instead",h,g.tunnelLocalPort??g.localAddress))}},validationMessage:h=>e(r,h,r.canElevate),placeholder:c(9026,"New local port")})}}}a.handler=t})(zo||(zo={}));var Nh;(function(a){function e(t){return async(i,s)=>{if(Vs(s)){const o=i.get(He);return await o.close({host:s.remoteHost,port:s.remotePort},oo.Other),o.forward({remote:{host:s.remoteHost,port:s.remotePort},local:s.localPort,name:s.name,elevateIfNeeded:!0,privacy:t,source:s.source})}}}a.handler=e})(Nh||(Nh={}));var Bi;(function(a){a.ID_HTTP="remote.tunnel.setProtocolHttp",a.ID_HTTPS="remote.tunnel.setProtocolHttps",a.LABEL_HTTP=c(9027,"HTTP"),a.LABEL_HTTPS=c(9028,"HTTPS");async function e(s,o,n,r){if(Vs(s)){const d={protocol:o},l=r.remoteAuthority?Qe.USER_REMOTE:Qe.USER_LOCAL;return n.tunnelModel.configPortsAttributes.addAttributes(s.remotePort,d,l)}}function t(){return async(s,o)=>e(o,is.Http,s.get(He),s.get(ni))}a.handlerHttp=t;function i(){return async(s,o)=>e(o,is.Https,s.get(He),s.get(ni))}a.handlerHttps=i})(Bi||(Bi={}));const Zu=10,uo=Vr.isEqualTo(Ve.Forwarded),po=I.or(uo,Vr.isEqualTo(Ve.Detected)),Ps=Iy.isEqualTo(void 0);oe.registerCommandAndKeybindingRule({id:hs.ID,weight:W.WorkbenchContrib+Zu,when:I.and(Yd,uo,Ps),primary:y.F2,mac:{primary:y.Enter},handler:hs.handler()});Te.registerCommand(Xe.INLINE_ID,Xe.inlineHandler());Te.registerCommand(Xe.COMMANDPALETTE_ID,Xe.commandPaletteHandler());oe.registerCommandAndKeybindingRule({id:ai.INLINE_ID,weight:W.WorkbenchContrib+Zu,when:I.and(Pr,Yd),primary:y.Delete,mac:{primary:N.CtrlCmd|y.Backspace,secondary:[y.Delete]},handler:ai.inlineHandler()});Te.registerCommand(ai.COMMANDPALETTE_ID,ai.commandPaletteHandler());Te.registerCommand(qt.ID,qt.handler());Te.registerCommand(mi.ID,mi.handler());Te.registerCommand(Ho.ID,Ho.handler());oe.registerCommandAndKeybindingRule({id:di.INLINE_ID,weight:W.WorkbenchContrib+Zu,when:I.and(Yd,po,Ps),primary:N.CtrlCmd|y.KeyC,handler:di.inlineHandler()});Te.registerCommand(di.COMMANDPALETTE_ID,di.commandPaletteHandler());Te.registerCommand(zo.ID,zo.handler());Te.registerCommand(Bi.ID_HTTP,Bi.handlerHttp());Te.registerCommand(Bi.ID_HTTPS,Bi.handlerHttps());S.appendMenuItem(w.CommandPalette,{command:{id:ai.COMMANDPALETTE_ID,title:ai.LABEL},when:zs});S.appendMenuItem(w.CommandPalette,{command:{id:Xe.COMMANDPALETTE_ID,title:Xe.LABEL},when:zs});S.appendMenuItem(w.CommandPalette,{command:{id:di.COMMANDPALETTE_ID,title:di.COMMANDPALETTE_LABEL},when:zs});S.appendMenuItem(w.CommandPalette,{command:{id:Ho.ID,title:Ho.LABEL},when:zs});S.appendMenuItem(w.TunnelContext,{group:"._open",order:0,command:{id:qt.ID,title:qt.LABEL},when:I.and(po,Ps)});S.appendMenuItem(w.TunnelContext,{group:"._open",order:1,command:{id:mi.ID,title:mi.LABEL},when:I.and(po,Ps)});S.appendMenuItem(w.TunnelContext,{group:"0_manage",order:1,command:{id:hs.ID,title:hs.LABEL,icon:Sy},when:I.and(uo,Ps)});S.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:0,command:{id:di.INLINE_ID,title:di.INLINE_LABEL},when:I.and(po,Ps)});S.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:1,command:{id:zo.ID,title:zo.LABEL},when:I.and(uo,Dy,Ps)});S.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:2,submenu:w.TunnelPrivacy,title:c(9029,"Port Visibility"),when:I.and(uo,_y)});S.appendMenuItem(w.TunnelContext,{group:"2_localaddress",order:3,submenu:w.TunnelProtocol,title:c(9030,"Change Port Protocol"),when:I.and(uo,Ps,Ay)});S.appendMenuItem(w.TunnelContext,{group:"3_forward",order:0,command:{id:ai.INLINE_ID,title:ai.LABEL},when:Pr});S.appendMenuItem(w.TunnelContext,{group:"3_forward",order:1,command:{id:Xe.INLINE_ID,title:Xe.LABEL}});S.appendMenuItem(w.TunnelProtocol,{order:0,command:{id:Bi.ID_HTTP,title:Bi.LABEL_HTTP,toggled:qd.isEqualTo(is.Http)}});S.appendMenuItem(w.TunnelProtocol,{order:1,command:{id:Bi.ID_HTTPS,title:Bi.LABEL_HTTPS,toggled:qd.isEqualTo(is.Https)}});S.appendMenuItem(w.TunnelPortInline,{group:"0_manage",order:0,command:{id:Xe.INLINE_ID,title:Xe.TREEITEM_LABEL,icon:Vx},when:Vr.isEqualTo(Ve.Candidate)});S.appendMenuItem(w.TunnelPortInline,{group:"0_manage",order:4,command:{id:hs.ID,title:hs.LABEL,icon:Sy},when:uo});S.appendMenuItem(w.TunnelPortInline,{group:"0_manage",order:5,command:{id:ai.INLINE_ID,title:ai.LABEL,icon:Px},when:Pr});S.appendMenuItem(w.TunnelLocalAddressInline,{order:-1,command:{id:di.INLINE_ID,title:di.INLINE_LABEL,icon:Nx},when:po});S.appendMenuItem(w.TunnelLocalAddressInline,{order:0,command:{id:qt.ID,title:qt.LABEL,icon:Mx},when:po});S.appendMenuItem(w.TunnelLocalAddressInline,{order:1,command:{id:mi.ID,title:mi.LABEL,icon:Ox},when:po});le("ports.iconRunningProcessForeground",g_,c(9031,"The color of the icon for a port that has an associated running process."));class Do extends R{static{this.localUrlRegex=/\b\w{0,20}(?::\/\/)?(?:localhost|127\.0\.0\.1|0\.0\.0\.0|:\d{2,5})[\w\-\.\~:\/\?\#[\]\@!\$&\(\)\*\+\,\;\=]*/gim}static{this.extractPortRegex=/(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d{1,5})/}static{this.localPythonServerRegex=/HTTP\son\s(127\.0\.0\.1|0\.0\.0\.0)\sport\s(\d+)/}static{this.excludeTerminals=["Dev Containers"]}constructor(e,t){super(),this._onDidMatchLocalUrl=new E,this.onDidMatchLocalUrl=this._onDidMatchLocalUrl.event,this.listeners=new Map,this.replPositions=new Map,e.instances.forEach(i=>{this.registerTerminalInstance(i)}),this._register(e.onDidCreateInstance(i=>{this.registerTerminalInstance(i)})),this._register(e.onDidDisposeInstance(i=>{this.listeners.get(i)?.dispose(),this.listeners.delete(i)})),this._register(t.onDidNewSession(i=>{(!i.parentSession||i.parentSession&&i.hasSeparateRepl())&&this.listeners.set(i.getId(),i.onDidChangeReplElements(()=>{this.processNewReplElements(i)}))})),this._register(t.onDidEndSession(({session:i})=>{this.listeners.has(i.getId())&&(this.listeners.get(i.getId())?.dispose(),this.listeners.delete(i.getId()))}))}registerTerminalInstance(e){Do.excludeTerminals.includes(e.title)||this.listeners.set(e,e.onData(t=>{this.processData(t)}))}processNewReplElements(e){const t=this.replPositions.get(e.getId()),i=e.getReplElements();if(this.replPositions.set(e.getId(),{position:i.length-1,tail:i[i.length-1]}),!t&&i.length>0)i.forEach(s=>this.processData(s.toString()));else if(t&&i.length-1!==t.position)for(let s=i.length-1;s>=0;s--){const o=i[s];if(o===t.tail)break;this.processData(o.toString())}}dispose(){super.dispose();const e=this.listeners.values();for(const t of e)t.dispose()}processData(e){e=fC(e);const t=e.match(Do.localUrlRegex)||[];if(t&&t.length>0)t.forEach(i=>{let s;try{s=new URL(i)}catch{}if(s){const o=i.match(Do.extractPortRegex),n=parseFloat(s.port?s.port:o?o[2]:"NaN");if(!isNaN(n)&&Number.isInteger(n)&&n>0&&n<=65535){let r=s.hostname;if(r!=="0.0.0.0"&&r!=="127.0.0.1"&&(r="localhost"),n!==9229&&e.startsWith("Debugger listening on"))return;this._onDidMatchLocalUrl.fire({port:n,host:r})}}});else{const i=e.match(Do.localPythonServerRegex);i&&i.length===3&&this._onDidMatchLocalUrl.fire({host:i[1],port:Number(i[2])})}}}const Tc="workbench.view.remote";let Jg=class extends R{constructor(e,t,i,s,o,n){super(),this.contextKeyService=e,this.environmentService=t,this.remoteExplorerService=i,this.tunnelService=s,this.activityService=o,this.statusbarService=n,this.contextKeyListener=this._register(new Ie),this.activityBadge=this._register(new Ie),this.hasPortsInSession=!1,this._register(H.as(pt.ViewsRegistry).registerViewWelcomeContent(Us,{content:this.environmentService.remoteAuthority?c(8911,`No forwarded ports. Forward a port to access your running services locally.
[Forward a Port]({0})`,`command:${Xe.INLINE_ID}`):c(8912,`No forwarded ports. Forward a port to access your locally running services over the internet.
[Forward a Port]({0})`,`command:${Xe.INLINE_ID}`)})),this.enableBadgeAndStatusBar(),this.enableForwardedPortsFeatures(),this.environmentService.remoteAuthority||this._register(V.once(this.tunnelService.onTunnelOpened)(()=>{this.hasPortsInSession=!0}))}async getViewContainer(){return H.as(pt.ViewContainersRegistry).registerViewContainer({id:gc,title:x(8913,"Ports"),icon:by,ctorDescriptor:new ee(vr,[gc,{mergeViewWithContainerWhenSingleView:!0}]),storageId:gc,hideIfEmpty:!0,order:5},q.Panel)}async enableForwardedPortsFeatures(){this.contextKeyListener.clear();const e=!!ig.getValue(this.contextKeyService),t=!!zs.getValue(this.contextKeyService);if(e||t){t||this.contextKeyService.createKey(zs.key,!0);const i=await this.getViewContainer(),s=new qx(new Ph(this.remoteExplorerService,this.tunnelService),this.environmentService),o=H.as(pt.ViewsRegistry);i&&(this.remoteExplorerService.enablePortsFeatures(!e),o.registerViews([s],i))}else this.contextKeyListener.value=this.contextKeyService.onDidChangeContext(i=>{i.affectsSome(new Set([...ig.keys(),...zs.keys()]))&&this.enableForwardedPortsFeatures()})}enableBadgeAndStatusBar(){const e=H.as(pt.ViewsRegistry).onViewsRegistered(t=>{t.find(i=>i.views.find(s=>s.id===Us))&&(this._register(V.debounce(this.remoteExplorerService.tunnelModel.onForwardPort,(i,s)=>s,50)(()=>{this.updateActivityBadge(),this.updateStatusBar()})),this._register(V.debounce(this.remoteExplorerService.tunnelModel.onClosePort,(i,s)=>s,50)(()=>{this.updateActivityBadge(),this.updateStatusBar()})),this.updateActivityBadge(),this.updateStatusBar(),e.dispose())})}async updateActivityBadge(){this.remoteExplorerService.tunnelModel.forwarded.size>0?this.activityBadge.value=this.activityService.showViewActivity(Us,{badge:new Ld(this.remoteExplorerService.tunnelModel.forwarded.size,e=>e===1?c(8914,"1 forwarded port"):c(8915,"{0} forwarded ports",e))}):this.activityBadge.clear()}updateStatusBar(){!this.environmentService.remoteAuthority&&!this.hasPortsInSession||(this.entryAccessor?this.entryAccessor.update(this.entry):this._register(this.entryAccessor=this.statusbarService.addEntry(this.entry,"status.forwardedPorts",et.LEFT,40)))}get entry(){let e;const t=this.remoteExplorerService.tunnelModel.forwarded.size+this.remoteExplorerService.tunnelModel.detected.size,i=`${t}`;if(t===0)e=c(8916,"No Ports Forwarded");else{const s=Array.from(this.remoteExplorerService.tunnelModel.forwarded.values());s.push(...Array.from(this.remoteExplorerService.tunnelModel.detected.values())),e=c(8917,"Forwarded Ports: {0}",s.map(o=>o.remotePort).join(", "))}return{name:c(8918,"Forwarded Ports"),text:`$(radio-tower) ${i}`,ariaLabel:e,tooltip:e,command:`${Us}.focus`}}};Jg=D([u(0,se),u(1,ni),u(2,He),u(3,Yt),u(4,ks),u(5,Rs)],Jg);let Zg=class{constructor(e,t){this.remoteExplorerService=e,this.logService=t,this.remoteExplorerService.tunnelModel.environmentTunnelsSet?this.restore():V.once(this.remoteExplorerService.tunnelModel.onEnvironmentTunnelsSet)(async()=>{await this.restore()})}async restore(){return this.logService.trace("ForwardedPorts: Doing first restore."),this.remoteExplorerService.restore()}};Zg=D([u(0,He),u(1,Ue)],Zg);let Xg=class extends R{constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v){super(),this.terminalService=e,this.notificationService=t,this.openerService=i,this.externalOpenerService=s,this.remoteExplorerService=o,this.contextKeyService=r,this.configurationService=d,this.debugService=l,this.tunnelService=p,this.hostService=f,this.logService=g,this.storageService=m,this.preferencesService=v,n.remoteAuthority&&(d.whenRemoteConfigurationLoaded().then(()=>h.getEnvironment()).then(b=>{this.setup(b),this._register(d.onDidChangeConfiguration(A=>{A.affectsConfiguration(Ui)?this.setup(b):A.affectsConfiguration(Ur)&&!this.portListener&&this.listenForPorts()}))}),this.storageService.getBoolean("processPortForwardingFallback",G.WORKSPACE,!0)||this.configurationService.updateValue(Ur,0,Qe.WORKSPACE))}getPortAutoFallbackNumber(){const e=this.configurationService.inspect(Ur);if(e.value!==void 0&&(e.value===0||e.value!==e.defaultValue))return e.value;const t=this.configurationService.inspect(Ui);return t.applicationValue===Gi||t.userValue===Gi||t.userLocalValue===Gi||t.userRemoteValue===Gi||t.workspaceFolderValue===Gi||t.workspaceValue===Gi?0:e.value??20}listenForPorts(){let e=this.getPortAutoFallbackNumber();if(e===0){this.portListener?.dispose();return}this.procForwarder&&!this.portListener&&this.configurationService.getValue(Ui)===Gi?this.portListener=this._register(this.remoteExplorerService.tunnelModel.onForwardPort(async()=>{if(e=this.getPortAutoFallbackNumber(),e===0){this.portListener?.dispose();return}Array.from(this.remoteExplorerService.tunnelModel.forwarded.values()).filter(t=>t.source.source===Ru.Auto).length>e&&(await this.configurationService.updateValue(Ui,$c),this.notificationService.notify({message:c(8919,"Over 20 ports have been automatically forwarded. The `process` based automatic port forwarding has been switched to `hybrid` in settings. Some ports may no longer be detected."),severity:_e.Warning,actions:{primary:[new _t("switchBack",c(8920,"Undo"),void 0,!0,async()=>{await this.configurationService.updateValue(Ui,Gi),await this.configurationService.updateValue(Ur,0,Qe.WORKSPACE),this.portListener?.dispose(),this.portListener=void 0}),new _t("showPortSourceSetting",c(8921,"Show Setting"),void 0,!0,async()=>{await this.preferencesService.openSettings({query:"remote.autoForwardPortsSource"})})]}}))})):(this.portListener?.dispose(),this.portListener=void 0)}setup(e){const t=this.procForwarder?.forwarded,i=this.outputForwarder||this.procForwarder;if(this.procForwarder?.dispose(),this.procForwarder=void 0,this.outputForwarder?.dispose(),this.outputForwarder=void 0,e?.os!==fi.Linux)this.configurationService.inspect(Ui).default?.value!==sg&&H.as(xs.Configuration).registerDefaultConfigurations([{overrides:{"remote.autoForwardPortsSource":sg}}]),this.outputForwarder=this._register(new Qg(this.terminalService,this.notificationService,this.openerService,this.externalOpenerService,this.remoteExplorerService,this.configurationService,this.debugService,this.tunnelService,this.hostService,this.logService,this.contextKeyService,()=>!1));else{const s=()=>this.configurationService.getValue(Ui)===Gi;s()?this.procForwarder=this._register(new ef(!1,t,!i,this.configurationService,this.remoteExplorerService,this.notificationService,this.openerService,this.externalOpenerService,this.tunnelService,this.hostService,this.logService,this.contextKeyService)):this.configurationService.getValue(Ui)===$c&&(this.procForwarder=this._register(new ef(!0,t,!i,this.configurationService,this.remoteExplorerService,this.notificationService,this.openerService,this.externalOpenerService,this.tunnelService,this.hostService,this.logService,this.contextKeyService))),this.outputForwarder=this._register(new Qg(this.terminalService,this.notificationService,this.openerService,this.externalOpenerService,this.remoteExplorerService,this.configurationService,this.debugService,this.tunnelService,this.hostService,this.logService,this.contextKeyService,s))}this.listenForPorts()}};Xg=D([u(0,w_),u(1,Ke),u(2,Tt),u(3,Hm),u(4,He),u(5,ni),u(6,se),u(7,BD),u(8,y_),u(9,mC),u(10,Yt),u(11,Zt),u(12,Ue),u(13,ce),u(14,Kd)],Xg);class Jd extends R{static{this.NOTIFY_COOL_DOWN=5e3}constructor(e,t,i,s,o,n,r,d){super(),this.notificationService=e,this.remoteExplorerService=t,this.openerService=i,this.externalOpenerService=s,this.tunnelService=o,this.hostService=n,this.logService=r,this.contextKeyService=d,this.alreadyOpenedOnce=new Set,this.lastNotifyTime=new Date,this.lastNotifyTime.setFullYear(this.lastNotifyTime.getFullYear()-1)}async doAction(e){this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Starting action for ${e[0]?.tunnelRemotePort}`),this.doActionTunnels=e;const t=await this.portNumberHeuristicDelay();if(this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Heuristic chose ${t?.tunnelRemotePort}`),t){const s=(await this.remoteExplorerService.tunnelModel.getAttributes([{port:t.tunnelRemotePort,host:t.tunnelRemoteHost}]))?.get(t.tunnelRemotePort)?.onAutoForward;switch(this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) onAutoForward action is ${s}`),s){case _o.OpenBrowserOnce:{if(this.alreadyOpenedOnce.has(t.localAddress))break;this.alreadyOpenedOnce.add(t.localAddress)}case _o.OpenBrowser:{const o=Et(t.tunnelRemoteHost,t.tunnelRemotePort);await qt.run(this.remoteExplorerService.tunnelModel,this.openerService,o);break}case _o.OpenPreview:{const o=Et(t.tunnelRemoteHost,t.tunnelRemotePort);await mi.run(this.remoteExplorerService.tunnelModel,this.openerService,this.externalOpenerService,o);break}case _o.Silent:break;default:{const o=new Date().getTime()-this.lastNotifyTime.getTime();this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) time elapsed since last notification ${o} ms`),o>Jd.NOTIFY_COOL_DOWN&&await this.showNotification(t)}}}}hide(e){this.doActionTunnels&&(this.doActionTunnels=this.doActionTunnels.filter(t=>!e.includes(t.tunnelRemotePort))),this.lastShownPort&&e.indexOf(this.lastShownPort)>=0&&this.lastNotification?.close()}async portNumberHeuristicDelay(){if(this.logService.trace("ForwardedPorts: (OnAutoForwardedAction) Starting heuristic delay"),!this.doActionTunnels||this.doActionTunnels.length===0)return;this.doActionTunnels=this.doActionTunnels.sort((t,i)=>t.tunnelRemotePort-i.tunnelRemotePort);const e=this.doActionTunnels.shift();return e.tunnelRemotePort%1e3===0?(this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Heuristic chose tunnel because % 1000: ${e.tunnelRemotePort}`),this.newerTunnel=e,e):e.tunnelRemotePort<1e4&&e.tunnelRemotePort!==9229?(this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Heuristic chose tunnel because < 10000: ${e.tunnelRemotePort}`),this.newerTunnel=e,e):(this.logService.trace(`ForwardedPorts: (OnAutoForwardedAction) Waiting for "better" tunnel than ${e.tunnelRemotePort}`),this.newerTunnel=void 0,new Promise(t=>{setTimeout(()=>{this.newerTunnel?t(void 0):this.doActionTunnels?.includes(e)?t(e):t(void 0)},3e3)}))}async basicMessage(e){const i=(await this.remoteExplorerService.tunnelModel.getAttributes([{host:e.tunnelRemoteHost,port:e.tunnelRemotePort}],!1))?.get(e.tunnelRemotePort)?.label;return c(8922,"Your application{0} running on port {1} is available.  ",i?` (${i})`:"",e.tunnelRemotePort)}linkMessage(){return c(8923,"[See all forwarded ports]({0})",`command:${qs.ID}.focus`)}async showNotification(e){if(!await this.hostService.hadLastFocus())return;this.lastNotification?.close();let t=await this.basicMessage(e);const i=[this.openBrowserChoice(e)];(!Qs||Kx.getValue(this.contextKeyService))&&i.push(this.openPreviewChoice(e)),e.tunnelLocalPort!==e.tunnelRemotePort&&this.tunnelService.canElevate&&this.tunnelService.isPortPrivileged(e.tunnelRemotePort)&&(t+=c(8924,"You'll need to run as superuser to use port {0} locally.  ",e.tunnelRemotePort),i.unshift(this.elevateChoice(e))),e.privacy===Sa.Private&&Qs&&this.tunnelService.canChangePrivacy&&i.push(this.makePublicChoice(e)),t+=this.linkMessage(),this.lastNotification=this.notificationService.prompt(_e.Info,t,i,{neverShowAgain:{id:"remote.tunnelsView.autoForwardNeverShow",isSecondary:!0}}),this.lastShownPort=e.tunnelRemotePort,this.lastNotifyTime=new Date,this.lastNotification.onDidClose(()=>{this.lastNotification=void 0,this.lastShownPort=void 0})}makePublicChoice(e){return{label:c(8925,"Make Public"),run:async()=>{const t=Ro(this.remoteExplorerService.tunnelModel.forwarded,e.tunnelRemoteHost,e.tunnelRemotePort);return await this.remoteExplorerService.close({host:e.tunnelRemoteHost,port:e.tunnelRemotePort},oo.Other),this.remoteExplorerService.forward({remote:{host:e.tunnelRemoteHost,port:e.tunnelRemotePort},local:e.tunnelLocalPort,name:t?.name,elevateIfNeeded:!0,privacy:Sa.Public,source:t?.source})}}}openBrowserChoice(e){const t=Et(e.tunnelRemoteHost,e.tunnelRemotePort);return{label:qt.LABEL,run:()=>qt.run(this.remoteExplorerService.tunnelModel,this.openerService,t)}}openPreviewChoice(e){const t=Et(e.tunnelRemoteHost,e.tunnelRemotePort);return{label:mi.LABEL,run:()=>mi.run(this.remoteExplorerService.tunnelModel,this.openerService,this.externalOpenerService,t)}}elevateChoice(e){return{label:c(8926,"Use Port {0} as Sudo...",e.tunnelRemotePort),run:async()=>{await this.remoteExplorerService.close({host:e.tunnelRemoteHost,port:e.tunnelRemotePort},oo.Other);const t=await this.remoteExplorerService.forward({remote:{host:e.tunnelRemoteHost,port:e.tunnelRemotePort},local:e.tunnelRemotePort,elevateIfNeeded:!0,source:Lu});!t||typeof t=="string"||(this.lastNotification?.close(),this.lastShownPort=t.tunnelRemotePort,this.lastNotification=this.notificationService.prompt(_e.Info,await this.basicMessage(t)+this.linkMessage(),[this.openBrowserChoice(t),this.openPreviewChoice(e)],{neverShowAgain:{id:"remote.tunnelsView.autoForwardNeverShow",isSecondary:!0}}),this.lastNotification.onDidClose(()=>{this.lastNotification=void 0,this.lastShownPort=void 0}))}}}}class Qg extends R{constructor(e,t,i,s,o,n,r,d,l,h,p,f){super(),this.terminalService=e,this.notificationService=t,this.openerService=i,this.externalOpenerService=s,this.remoteExplorerService=o,this.configurationService=n,this.debugService=r,this.tunnelService=d,this.hostService=l,this.logService=h,this.contextKeyService=p,this.privilegedOnly=f,this.notifier=new Jd(t,o,i,s,d,l,h,p),this._register(n.onDidChangeConfiguration(g=>{g.affectsConfiguration(Vn)&&this.tryStartStopUrlFinder()})),this.portsFeatures=this._register(this.remoteExplorerService.onEnabledPortsFeatures(()=>{this.tryStartStopUrlFinder()})),this.tryStartStopUrlFinder(),n.getValue(Ui)===$c&&this._register(this.tunnelService.onTunnelClosed(g=>this.notifier.hide([g.port])))}tryStartStopUrlFinder(){this.configurationService.getValue(Vn)?this.startUrlFinder():this.stopUrlFinder()}startUrlFinder(){!this.urlFinder&&this.remoteExplorerService.portsFeaturesEnabled!==zm.AdditionalFeatures||(this.portsFeatures?.dispose(),this.urlFinder=this._register(new Do(this.terminalService,this.debugService)),this._register(this.urlFinder.onDidMatchLocalUrl(async e=>{if(Ro(this.remoteExplorerService.tunnelModel.detected,e.host,e.port))return;const t=(await this.remoteExplorerService.tunnelModel.getAttributes([e]))?.get(e.port);if(t?.onAutoForward===_o.Ignore||this.privilegedOnly()&&!this.tunnelService.isPortPrivileged(e.port))return;const i=await this.remoteExplorerService.forward({remote:e,source:Lu},t??null);i&&typeof i!="string"&&this.notifier.doAction([i])})))}stopUrlFinder(){this.urlFinder&&(this.urlFinder.dispose(),this.urlFinder=void 0)}}class ef extends R{constructor(e,t,i,s,o,n,r,d,l,h,p,f){super(),this.unforwardOnly=e,this.alreadyAutoForwarded=t,this.needsInitialCandidates=i,this.configurationService=s,this.remoteExplorerService=o,this.notificationService=n,this.openerService=r,this.externalOpenerService=d,this.tunnelService=l,this.hostService=h,this.logService=p,this.contextKeyService=f,this.autoForwarded=new Set,this.notifiedOnly=new Set,this.initialCandidates=new Set,this.notifier=new Jd(n,o,r,d,l,h,p,f),t?.forEach(g=>this.autoForwarded.add(g)),this.initialize()}get forwarded(){return this.autoForwarded}async initialize(){this.remoteExplorerService.tunnelModel.environmentTunnelsSet||await new Promise(e=>this.remoteExplorerService.tunnelModel.onEnvironmentTunnelsSet(()=>e())),this._register(this.configurationService.onDidChangeConfiguration(async e=>{e.affectsConfiguration(Vn)&&await this.startStopCandidateListener()})),this.portsFeatures=this._register(this.remoteExplorerService.onEnabledPortsFeatures(async()=>{await this.startStopCandidateListener()})),this.startStopCandidateListener()}async startStopCandidateListener(){this.configurationService.getValue(Vn)?await this.startCandidateListener():this.stopCandidateListener()}stopCandidateListener(){this.candidateListener&&(this.candidateListener.dispose(),this.candidateListener=void 0)}async startCandidateListener(){this.candidateListener||this.remoteExplorerService.portsFeaturesEnabled!==zm.AdditionalFeatures||(this.portsFeatures?.dispose(),await this.setInitialCandidates(),this.configurationService.getValue(Vn)&&(this.candidateListener=this._register(this.remoteExplorerService.tunnelModel.onCandidatesChanged(this.handleCandidateUpdate,this))))}async setInitialCandidates(){if(!this.needsInitialCandidates){this.logService.debug("ForwardedPorts: (ProcForwarding) Not setting initial candidates");return}let e=this.remoteExplorerService.tunnelModel.candidatesOrUndefined;e||(await new Promise(t=>this.remoteExplorerService.tunnelModel.onCandidatesChanged(()=>t())),e=this.remoteExplorerService.tunnelModel.candidates);for(const t of e)this.initialCandidates.add(Et(t.host,t.port));this.logService.debug(`ForwardedPorts: (ProcForwarding) Initial candidates set to ${e.map(t=>t.port).join(", ")}`)}async forwardCandidates(){let e;const t=[];this.logService.trace(`ForwardedPorts: (ProcForwarding) Attempting to forward ${this.remoteExplorerService.tunnelModel.candidates.length} candidates`);for(const i of this.remoteExplorerService.tunnelModel.candidates){if(!i.detail){this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} missing detail`);continue}e||(e=await this.remoteExplorerService.tunnelModel.getAttributes(this.remoteExplorerService.tunnelModel.candidates));const s=e?.get(i.port),o=Et(i.host,i.port);if(this.initialCandidates.has(o)&&s?.onAutoForward===void 0||this.notifiedOnly.has(o)||this.autoForwarded.has(o))continue;const n=Ro(this.remoteExplorerService.tunnelModel.forwarded,i.host,i.port);if(Ro(this.remoteExplorerService.tunnelModel.detected,i.host,i.port))continue;if(s?.onAutoForward===_o.Ignore){this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} is ignored`);continue}const r=await this.remoteExplorerService.forward({remote:i,source:Lu},s??null);!n&&r?(this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} has been forwarded`),this.autoForwarded.add(o)):r&&(this.logService.trace(`ForwardedPorts: (ProcForwarding) Port ${i.port} has been notified`),this.notifiedOnly.add(o)),r&&typeof r!="string"&&t.push(r)}if(this.logService.trace(`ForwardedPorts: (ProcForwarding) Forwarded ${t.length} candidates`),t.length!==0)return t}async handleCandidateUpdate(e){const t=[];let i;if(this.unforwardOnly){i=new Map;for(const o of this.remoteExplorerService.tunnelModel.forwarded.entries())o[1].source.source===Ru.Auto&&i.set(o[0],o[1])}else i=new Map(this.autoForwarded.entries());for(const o of e){const n=o[0];let r=o[1];const d=Ro(i,r.host,r.port);d?(typeof d=="string"?this.autoForwarded.delete(n):r={host:d.remoteHost,port:d.remotePort},await this.remoteExplorerService.close(r,oo.AutoForwardEnd),t.push(r.port)):this.notifiedOnly.has(n)?(this.notifiedOnly.delete(n),t.push(r.port)):this.initialCandidates.has(n)&&this.initialCandidates.delete(n)}if(this.unforwardOnly)return;t.length>0&&await this.notifier.hide(t);const s=await this.forwardCandidates();s&&await this.notifier.doAction(s)}}const tf="workbench.view.scm";var sf;(function(a){a[a.Error=0]="Error",a[a.Warning=1]="Warning",a[a.Information=2]="Information"})(sf||(sf={}));var of;(function(a){a[a.HistoryPrevious=0]="HistoryPrevious",a[a.HistoryNext=1]="HistoryNext"})(of||(of={}));var nf;(function(a){a.DiscoveryTime="discoveryTime",a.Name="name",a.Path="path"})(nf||(nf={}));var Bh;const xc={webviewState:"webviewState"};let Fh=class extends Rd{static{Bh=this}static getOriginStore(e){return this._originStore??=new v_("webviewViews.origins",e),this._originStore}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b,A){super({...e,titleMenuId:w.ViewTitle,showActions:b_.WhenExpanded},n,s,t,i,h,o,r,l,d),this.activityService=p,this.extensionService=f,this.progressService=g,this.storageService=m,this.viewService=v,this.webviewService=b,this.webviewViewService=A,this._webview=this._register(new Ie),this._webviewDisposables=this._register(new O),this._activated=!1,this.activity=this._register(new Ie),this._onDidChangeVisibility=this._register(new E),this.onDidChangeVisibility=this._onDidChangeVisibility.event,this._onDispose=this._register(new E),this.onDispose=this._onDispose.event,this.extensionId=e.fromExtensionId,this.defaultTitle=this.title,this.memento=new If(`webviewView.${this.id}`,m),this.viewState=this.memento.getMemento(G.WORKSPACE,Re.MACHINE),this._register(this.onDidChangeBodyVisibility(()=>this.updateTreeVisibility())),this._register(this.webviewViewService.onNewResolverRegistered(K=>{K.viewType===this.id&&this.updateTreeVisibility()})),this.updateTreeVisibility()}dispose(){this._onDispose.fire(),clearTimeout(this._repositionTimeout),super.dispose()}focus(){super.focus(),this._webview.value?.focus()}renderBody(e){super.renderBody(e),this._container=e,this._rootContainer=void 0,this._resizeObserver||(this._resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.layoutWebview()},0)}),this._register(ae(()=>{this._resizeObserver.disconnect()})),this._resizeObserver.observe(e))}saveState(){this._webview.value&&(this.viewState[xc.webviewState]=this._webview.value.state),this.memento.saveMemento(),super.saveState()}layoutBody(e,t){super.layoutBody(e,t),this.layoutWebview(new jt(t,e))}updateTreeVisibility(){this.isBodyVisible()?(this.activate(),this._webview.value?.claim(this,St(this.element),void 0)):this._webview.value?.release(this)}activate(){if(this._activated)return;this._activated=!0;const e=this.extensionId?Bh.getOriginStore(this.storageService).getOrigin(this.id,this.extensionId):void 0,t=this.webviewService.createWebviewOverlay({origin:e,providedViewType:this.id,title:this.title,options:{purpose:jm.WebviewView},contentOptions:{},extension:this.extensionId?{id:this.extensionId}:void 0});t.state=this.viewState[xc.webviewState],this._webview.value=t,this._container&&this.layoutWebview(),this._webviewDisposables.add(ae(()=>{this._webview.value?.release(this)})),this._webviewDisposables.add(t.onDidUpdateState(()=>{this.viewState[xc.webviewState]=t.state}));for(const s of[te.DRAG,te.DRAG_END,te.DRAG_ENTER,te.DRAG_LEAVE,te.DRAG_START])this._webviewDisposables.add(Y(this._webview.value.container,s,o=>{o.preventDefault(),o.stopImmediatePropagation(),this.dropTargetElement.dispatchEvent(new DragEvent(o.type,o))}));this._webviewDisposables.add(new C_(St(this.element),()=>this._webview.value));const i=this._webviewDisposables.add(new Ts);this.withProgress(async()=>{await this.extensionService.activateByEvent(`onView:${this.id}`);const s=this,o={webview:t,onDidChangeVisibility:this.onDidChangeBodyVisibility,onDispose:this.onDispose,get title(){return s.setTitle},set title(n){s.updateTitle(n)},get description(){return s.titleDescription},set description(n){s.updateTitleDescription(n)},get badge(){return s.badge},set badge(n){s.updateBadge(n)},dispose:()=>{this._activated=!1,this._webview.clear(),this._webviewDisposables.clear()},show:n=>{this.viewService.openView(this.id,!n)}};await this.webviewViewService.resolve(this.id,o,i.token)})}updateTitle(e){this.setTitle=e,super.updateTitle(typeof e=="string"?e:this.defaultTitle)}updateBadge(e){if(!(this.badge?.value===e?.value&&this.badge?.tooltip===e?.tooltip)&&(this.badge=e,e)){const t={badge:new Ld(e.value,()=>e.tooltip),priority:150};this.activity.value=this.activityService.showViewActivity(this.id,t)}}async withProgress(e){return this.progressService.withProgress({location:this.id,delay:500},e)}onDidScrollRoot(){this.layoutWebview()}doLayoutWebview(e){const t=this._webview.value;!this._container||!t||((!this._rootContainer||!this._rootContainer.isConnected)&&(this._rootContainer=this.findRootContainer(this._container)),t.layoutWebviewOverElement(this._container,e,this._rootContainer))}layoutWebview(e){this.doLayoutWebview(e),clearTimeout(this._repositionTimeout),this._repositionTimeout=setTimeout(()=>this.doLayoutWebview(e),200)}findRootContainer(e){return wC(e,"monaco-scrollable-element")??void 0}};Fh=Bh=D([u(1,ie),u(2,se),u(3,at),u(4,F),u(5,it),u(6,Tt),u(7,At),u(8,me),u(9,Ye),u(10,ks),u(11,kt),u(12,Ad),u(13,ce),u(14,gt),u(15,lo),u(16,$m)],Fh);const rf={type:"object",properties:{id:{description:c(2459,"Unique id used to identify the container in which views can be contributed using 'views' contribution point"),type:"string",pattern:"^[a-zA-Z0-9_-]+$"},title:{description:c(2460,"Human readable string used to render the container"),type:"string"},icon:{description:c(2461,"Path to the container icon. Icons are 24x24 centered on a 50x40 block and have a fill color of 'rgb(215, 218, 224)' or '#d7dae0'. It is recommended that icons be in SVG, though any image file type is accepted."),type:"string"}},required:["id","title","icon"]},Zx={description:c(2462,"Contributes views containers to the editor"),type:"object",properties:{activitybar:{description:c(2463,"Contribute views containers to Activity Bar"),type:"array",items:rf},panel:{description:c(2464,"Contribute views containers to Panel"),type:"array",items:rf}},additionalProperties:!1};var bs;(function(a){a.Tree="tree",a.Webview="webview"})(bs||(bs={}));var Ao;(function(a){a.Visible="visible",a.Hidden="hidden",a.Collapsed="collapsed"})(Ao||(Ao={}));const fn={type:"object",required:["id","name","icon"],defaultSnippets:[{body:{id:"${1:id}",name:"${2:name}",icon:"${3:icon}"}}],properties:{type:{markdownDescription:c(2465,"Type of the view. This can either be `tree` for a tree view based view or `webview` for a webview based view. The default is `tree`."),type:"string",enum:["tree","webview"],markdownEnumDescriptions:[c(2466,"The view is backed by a `TreeView` created by `createTreeView`."),c(2467,"The view is backed by a `WebviewView` registered by `registerWebviewViewProvider`.")]},id:{markdownDescription:c(2468,"Identifier of the view. This should be unique across all views. It is recommended to include your extension id as part of the view id. Use this to register a data provider through `vscode.window.registerTreeDataProviderForView` API. Also to trigger activating your extension by registering `onView:${id}` event to `activationEvents`."),type:"string"},name:{description:c(2469,"The human-readable name of the view. Will be shown"),type:"string"},when:{description:c(2470,"Condition which must be true to show this view"),type:"string"},icon:{description:c(2471,"Path to the view icon. View icons are displayed when the name of the view cannot be shown. It is recommended that icons be in SVG, though any image file type is accepted."),type:"string"},contextualTitle:{description:c(2472,"Human-readable context for when the view is moved out of its original location. By default, the view's container name will be used."),type:"string"},visibility:{description:c(2473,"Initial state of the view when the extension is first installed. Once the user has changed the view state by collapsing, moving, or hiding the view, the initial state will not be used again."),type:"string",enum:["visible","hidden","collapsed"],default:"visible",enumDescriptions:[c(2474,"The default initial state for the view. In most containers the view will be expanded, however; some built-in containers (explorer, scm, and debug) show all contributed views collapsed regardless of the `visibility`."),c(2475,"The view will not be shown in the view container, but will be discoverable through the views menu and other view entry points and can be un-hidden by the user."),c(2476,"The view will show in the view container, but will be collapsed.")]},initialSize:{type:"number",description:c(2477,"The initial size of the view. The size will behave like the css 'flex' property, and will set the initial size when the view is first shown. In the side bar, this is the height of the view. This value is only respected when the same extension owns both the view and the view container.")},accessibilityHelpContent:{type:"string",markdownDescription:c(2478,"When the accessibility help dialog is invoked in this view, this content will be presented to the user as a markdown string. Keybindings will be resolved when provided in the format of <keybinding:commandId>. If there is no keybinding, that will be indicated and this command will be included in a quickpick for easy configuration.")}}},Xx={type:"object",required:["id","name"],properties:{id:{description:c(2468,"Identifier of the view. This should be unique across all views. It is recommended to include your extension id as part of the view id. Use this to register a data provider through `vscode.window.registerTreeDataProviderForView` API. Also to trigger activating your extension by registering `onView:${id}` event to `activationEvents`."),type:"string"},name:{description:c(2469,"The human-readable name of the view. Will be shown"),type:"string"},when:{description:c(2470,"Condition which must be true to show this view"),type:"string"},group:{description:c(2479,"Nested group in the viewlet"),type:"string"},remoteName:{description:c(2480,"The name of the remote type associated with this view"),type:["string","array"],items:{type:"string"}}}},Qx={description:c(2481,"Contributes views to the editor"),type:"object",properties:{explorer:{description:c(2482,"Contributes views to Explorer container in the Activity bar"),type:"array",items:fn,default:[]},debug:{description:c(2483,"Contributes views to Debug container in the Activity bar"),type:"array",items:fn,default:[]},scm:{description:c(2484,"Contributes views to SCM container in the Activity bar"),type:"array",items:fn,default:[]},test:{description:c(2485,"Contributes views to Test container in the Activity bar"),type:"array",items:fn,default:[]},remote:{description:c(2486,"Contributes views to Remote container in the Activity bar. To contribute to this container, enableProposedApi needs to be turned on"),type:"array",items:Xx,default:[]}},additionalProperties:{description:c(2487,"Contributes views to contributed views container"),type:"array",items:fn,default:[]}},Ry=ro.registerExtensionPoint({extensionPoint:"viewsContainers",jsonSchema:Zx}),ek=ro.registerExtensionPoint({extensionPoint:"views",deps:[Ry],jsonSchema:Qx,activationEventsGenerator:(a,e)=>{for(const t of a)for(const i of Object.values(t))for(const s of i)s.id&&e.push(`onView:${s.id}`)}}),tk=7;let Ba=class{static{this.ID="workbench.contrib.viewsExtensionHandler"}constructor(e,t){this.instantiationService=e,this.logService=t,this.viewContainersRegistry=H.as(pt.ViewContainersRegistry),this.viewsRegistry=H.as(pt.ViewsRegistry),this.handleAndRegisterCustomViewContainers(),this.handleAndRegisterCustomViews()}handleAndRegisterCustomViewContainers(){Ry.setHandler((e,{added:t,removed:i})=>{i.length&&this.removeCustomViewContainers(i),t.length&&this.addCustomViewContainers(t,this.viewContainersRegistry.all)})}addCustomViewContainers(e,t){const i=H.as(pt.ViewContainersRegistry);let s=tk+i.all.filter(n=>!!n.extensionId&&i.getViewContainerLocation(n)===q.Sidebar).length,o=5+i.all.filter(n=>!!n.extensionId&&i.getViewContainerLocation(n)===q.Panel).length+1;for(const{value:n,collector:r,description:d}of e)Object.entries(n).forEach(([l,h])=>{if(this.isValidViewsContainer(h,r))switch(l){case"activitybar":s=this.registerCustomViewContainers(h,d,s,t,q.Sidebar);break;case"panel":o=this.registerCustomViewContainers(h,d,o,t,q.Panel);break}})}removeCustomViewContainers(e){const t=H.as(pt.ViewContainersRegistry),i=e.reduce((s,o)=>(s.add(o.description.identifier),s),new Bp);for(const s of t.all)if(s.extensionId&&i.has(s.extensionId)){const o=this.viewsRegistry.getViews(s);o.length&&this.viewsRegistry.moveViews(o,this.getDefaultViewContainer()),this.deregisterCustomViewContainer(s)}}isValidViewsContainer(e,t){if(!Array.isArray(e))return t.error(c(2488,"views containers must be an array")),!1;for(const i of e){if(typeof i.id!="string"&&Gs(i.id))return t.error(c(2489,"property `{0}` is mandatory and must be of type `string` with non-empty value. Only alphanumeric characters, '_', and '-' are allowed.","id")),!1;if(!/^[a-z0-9_-]+$/i.test(i.id))return t.error(c(2489,"property `{0}` is mandatory and must be of type `string` with non-empty value. Only alphanumeric characters, '_', and '-' are allowed.","id")),!1;if(typeof i.title!="string")return t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","title")),!1;if(typeof i.icon!="string")return t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","icon")),!1;if(Gs(i.title))return t.warn(c(2491,"property `{0}` is mandatory and must be of type `string` with non-empty value","title")),!0}return!0}registerCustomViewContainers(e,t,i,s,o){return e.forEach(n=>{const d=Ce.fromString(n.icon)||Yi(t.extensionLocation,n.icon),l=`workbench.view.extension.${n.id}`,h=n.title||l,p=this.registerCustomViewContainer(l,h,d,i++,t.identifier,o);if(s.length){const f=[];for(const g of s)p!==g&&f.push(...this.viewsRegistry.getViews(g).filter(m=>m.originalContainerId===n.id));f.length&&this.viewsRegistry.moveViews(f,p)}}),i}registerCustomViewContainer(e,t,i,s,o,n){let r=this.viewContainersRegistry.get(e);return r||(r=this.viewContainersRegistry.registerViewContainer({id:e,title:{value:t,original:t},extensionId:o,ctorDescriptor:new ee(vr,[e,{mergeViewWithContainerWhenSingleView:!0}]),hideIfEmpty:!0,order:s,icon:i},n)),r}deregisterCustomViewContainer(e){this.viewContainersRegistry.deregisterViewContainer(e),H.as(Oi.Viewlets).deregisterPaneComposite(e.id)}handleAndRegisterCustomViews(){ek.setHandler((e,{added:t,removed:i})=>{i.length&&this.removeViews(i),t.length&&this.addViews(t)})}addViews(e){const t=new Set,i=[];for(const s of e){const{value:o,collector:n}=s;Object.entries(o).forEach(([r,d])=>{if(!this.isValidViewDescriptors(d,n))return;if(r==="remote"&&!Oc(s.description,"contribViewsRemote")){n.warn(c(2492,`View container '{0}' requires 'enabledApiProposals: ["contribViewsRemote"]' to be added to 'Remote'.`,r));return}const l=this.getViewContainer(r);l||n.warn(c(2493,"View container '{0}' does not exist and all views registered to it will be added to 'Explorer'.",r));const h=l||this.getDefaultViewContainer(),p=[];for(let f=0;f<d.length;f++){const g=d[f];if(t.has(g.id)){n.error(c(2494,"Cannot register multiple views with same id `{0}`",g.id));continue}if(this.viewsRegistry.getView(g.id)!==null){n.error(c(2495,"A view with id `{0}` is already registered.",g.id));continue}const m=em.equals(s.description.identifier,h.extensionId)?f+1:h.viewOrderDelegate?h.viewOrderDelegate.getOrder(g.group):void 0;let v;typeof g.icon=="string"&&(v=Ce.fromString(g.icon)||Yi(s.description.extensionLocation,g.icon));const b=this.convertInitialVisibility(g.visibility),A=this.getViewType(g.type);if(!A){n.error(c(2496,"Unknown view type `{0}`.",g.type));continue}let K;typeof g.initialSize=="number"&&(h.extensionId?.value===s.description.identifier.value?K=g.initialSize:this.logService.warn(`${s.description.identifier.value} tried to set the view size of ${g.id} but it was ignored because the view container does not belong to it.`));let P;Oc(s.description,"contribAccessibilityHelpContent")&&g.accessibilityHelpContent&&(P=new ts(g.accessibilityHelpContent));const L={type:A,ctorDescriptor:A===bs.Tree?new ee(Ah):new ee(Fh),id:g.id,name:{value:g.name,original:g.name},when:I.deserialize(g.when),containerIcon:v||l?.icon,containerTitle:g.contextualTitle||l&&(typeof l.title=="string"?l.title:l.title.value),canToggleVisibility:!0,canMoveView:l?.id!==Tc,treeView:A===bs.Tree?this.instantiationService.createInstance(Rh,g.id,g.name,s.description.identifier.value):void 0,collapsed:this.showCollapsed(h)||b===Ao.Collapsed,order:m,extensionId:s.description.identifier,originalContainerId:r,group:g.group,remoteAuthority:g.remoteName||g.remoteAuthority,virtualWorkspace:g.virtualWorkspace,hideByDefault:b===Ao.Hidden,workspace:l?.id===Tc?!0:void 0,weight:K,accessibilityHelpContent:P};t.add(L.id),p.push(L)}i.push({viewContainer:h,views:p})})}this.viewsRegistry.registerViews2(i)}getViewType(e){if(e===bs.Webview)return bs.Webview;if(!e||e===bs.Tree)return bs.Tree}getDefaultViewContainer(){return this.viewContainersRegistry.get(Mn)}removeViews(e){const t=e.reduce((i,s)=>(i.add(s.description.identifier),i),new Bp);for(const i of this.viewContainersRegistry.all){const s=this.viewsRegistry.getViews(i).filter(o=>o.extensionId&&t.has(o.extensionId));if(s.length){this.viewsRegistry.deregisterViews(s,i);for(const o of s){const n=o;n.treeView&&n.treeView.dispose()}}}}convertInitialVisibility(e){if(Object.values(Ao).includes(e))return e}isValidViewDescriptors(e,t){if(!Array.isArray(e))return t.error(c(2497,"views must be an array")),!1;for(const i of e){if(typeof i.id!="string")return t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","id")),!1;if(typeof i.name!="string")return t.error(c(2490,"property `{0}` is mandatory and must be of type `string`","name")),!1;if(i.when&&typeof i.when!="string")return t.error(c(2498,"property `{0}` can be omitted or must be of type `string`","when")),!1;if(i.icon&&typeof i.icon!="string")return t.error(c(2498,"property `{0}` can be omitted or must be of type `string`","icon")),!1;if(i.contextualTitle&&typeof i.contextualTitle!="string")return t.error(c(2498,"property `{0}` can be omitted or must be of type `string`","contextualTitle")),!1;if(i.visibility&&!this.convertInitialVisibility(i.visibility))return t.error(c(2499,"property `{0}` can be omitted or must be one of {1}","visibility",Object.values(Ao).join(", "))),!1}return!0}getViewContainer(e){switch(e){case"explorer":return this.viewContainersRegistry.get(Mn);case"debug":return this.viewContainersRegistry.get(og);case"scm":return this.viewContainersRegistry.get(tf);case"remote":return this.viewContainersRegistry.get(Tc);default:return this.viewContainersRegistry.get(`workbench.view.extension.${e}`)}}showCollapsed(e){switch(e.id){case Mn:case tf:case og:return!0}return!1}};Ba=D([u(0,F),u(1,Ue)],Ba);class ik extends R{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.viewsContainers}render(e){const t=e.contributes?.viewsContainers||{},i=Object.keys(t).reduce((n,r)=>{const d=t[r];return n.push(...d.map(l=>({...l,location:r}))),n},[]);if(!i.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const s=[c(2500,"ID"),c(2501,"Title"),c(2502,"Where")],o=i.sort((n,r)=>n.id.localeCompare(r.id)).map(n=>[n.id,n.title,n.location]);return{data:{headers:s,rows:o},dispose:()=>{}}}}class sk extends R{constructor(){super(...arguments),this.type="table"}shouldRender(e){return!!e.contributes?.views}render(e){const t=e.contributes?.views||{},i=Object.keys(t).reduce((n,r)=>{const d=t[r];return n.push(...d.map(l=>({...l,location:r}))),n},[]);if(!i.length)return{data:{headers:[],rows:[]},dispose:()=>{}};const s=[c(2503,"ID"),c(2504,"Name"),c(2502,"Where")],o=i.sort((n,r)=>n.id.localeCompare(r.id)).map(n=>[n.id,n.name,n.location]);return{data:{headers:s,rows:o},dispose:()=>{}}}}H.as(Fd.ExtensionFeaturesRegistry).registerExtensionFeature({id:"viewsContainers",label:c(2505,"View Containers"),access:{canToggle:!1},renderer:new ee(ik)});H.as(Fd.ExtensionFeaturesRegistry).registerExtensionFeature({id:"views",label:c(2506,"Views"),access:{canToggle:!1},renderer:new ee(sk)});yt(Ba.ID,Ba,vt.BlockStartup);class Ly extends qm{constructor(){super(...arguments),this.editorControl=void 0}get scopedContextKeyService(){return this.editorControl?.invokeWithinContext(e=>e.get(se))}getTitle(){return this.input?this.input.getName():c(3325,"Text Editor")}createEditorControl(e,t){this.editorControl=this._register(this.instantiationService.createInstance(Gw,e,t,this.getCodeEditorWidgetOptions()))}getCodeEditorWidgetOptions(){return Object.create(null)}updateEditorControlOptions(e){this.editorControl?.updateOptions(e)}getMainControl(){return this.editorControl}getControl(){return this.editorControl}computeEditorViewState(e){if(!this.editorControl)return;const t=this.editorControl.getModel();if(!t)return;const i=t.uri;if(i&&dt(i,e))return this.editorControl.saveViewState()??void 0}setOptions(e){super.setOptions(e),e&&_r(e,Se(this.editorControl),ft.Smooth)}focus(){super.focus(),this.editorControl?.focus()}hasFocus(){return this.editorControl?.hasTextFocus()||super.hasFocus()}setEditorVisible(e){super.setEditorVisible(e),e?this.editorControl?.onVisible():this.editorControl?.onHide()}layout(e){this.editorControl?.layout(e)}}var Kh;let Wh=class extends Ly{constructor(e,t,i,s,o,n,r,d,l,h){super(e,t,i,s,o,n,r,l,d,h)}async setInput(e,t,i,s){await super.setInput(e,t,i,s);const o=await e.resolve();if(s.isCancellationRequested)return;if(!(o instanceof FD))throw new Error("Unable to open file as text");const n=Se(this.editorControl),r=o.textEditorModel;if(n.setModel(r),!Vw(t?.viewState)){const d=this.loadEditorViewState(e,i);d&&(t?.selection&&(d.cursorState=[]),n.restoreViewState(d))}t&&_r(t,n,ft.Immediate),n.updateOptions(this.getReadonlyConfiguration(o.isReadonly()))}revealLastLine(){const e=this.editorControl;if(!e)return;const t=e.getModel();if(t){const i=t.getLineCount();e.revealPosition({lineNumber:i,column:t.getLineMaxColumn(i)},ft.Smooth)}}clearInput(){super.clearInput(),this.editorControl?.setModel(null)}tracksEditorViewState(e){return e instanceof Ni||e instanceof Ym}};Wh=D([u(2,mt),u(3,F),u(4,ce),u(5,on),u(6,me),u(7,Je),u(8,Q),u(9,Le)],Wh);let Fa=class extends Wh{static{Kh=this}static{this.ID="workbench.editors.textResourceEditor"}constructor(e,t,i,s,o,n,r,d,l,h,p){super(Kh.ID,e,t,i,s,o,n,d,r,p),this.modelService=l,this.languageService=h}createEditorControl(e,t){super.createEditorControl(e,t);const i=this.editorControl;i&&this._register(i.onDidPaste(s=>this.onDidEditorPaste(s,i)))}onDidEditorPaste(e,t){if(this.input instanceof Ni&&this.input.hasLanguageSetExplicitly||e.range.startLineNumber!==1||e.range.startColumn!==1||t.getOption(Pt.readOnly))return;const i=t.getModel();if(!i||!(i.getLineCount()===e.range.endLineNumber&&i.getLineMaxColumn(e.range.endLineNumber)===e.range.endColumn)||i.getLanguageId()!==ga)return;let n;if(e.languageId)n={id:e.languageId,source:"event"};else{const r=this.languageService.guessLanguageIdByFilepathOrFirstLine(i.uri,i.getLineContent(1).substr(0,yC.FIRST_LINE_DETECTION_LENGTH_LIMIT))??void 0;r&&(n={id:r,source:"guess"})}if(n&&n.id!==ga){this.input instanceof Ni&&n.source==="event"?this.input.setLanguageId(n.id):i.setLanguage(this.languageService.createById(n.id));const r=this.modelService.getCreationOptions(i.getLanguageId(),i.uri,i.isForSimpleWidget);i.detectIndentation(r.insertSpaces,r.tabSize)}}};Fa=Kh=D([u(1,mt),u(2,F),u(3,ce),u(4,on),u(5,me),u(6,Q),u(7,Je),u(8,Cd),u(9,Zo),u(10,Le)],Fa);let Qi=class extends S_{constructor(e,t,i,s,o,n){super(e,t,s,o,n),this.callbacks=i,this._onDidChangeMetadata=this._register(new E),this.onDidChangeMetadata=this._onDidChangeMetadata.event,this._onDidOpenInPlace=this._register(new E),this.onDidOpenInPlace=this._onDidOpenInPlace.event}getTitle(){return this.input?this.input.getName():c(2885,"Binary Viewer")}async getContents(e,t){const i=await e.resolve();if(!(i instanceof Jm))throw new Error("Unable to open file as binary");const s=i.getSize();return this.handleMetadataChanged(typeof s=="number"?Su.formatSize(s):""),{icon:"$(warning)",label:c(2886,"The file is not displayed in the text editor because it is either binary or uses an unsupported text encoding."),actions:[{label:c(2887,"Open Anyway"),run:async()=>{await this.callbacks.openInternal(e,t),this._onDidOpenInPlace.fire()}}]}}handleMetadataChanged(e){this.metadata=e,this._onDidChangeMetadata.fire()}getMetadata(){return this.metadata}};Qi=D([u(5,ce)],Qi);let Ys=class extends jc{static{this.ID=KD}constructor(e,t,i,s,o,n,r,d,l){super(e,t,i,s,o,n,r,d,l)}getMetadata(){const e=this.getPrimaryEditorPane(),t=this.getSecondaryEditorPane();if(e instanceof Qi&&t instanceof Qi)return c(2884,"{0} ↔ {1}",t.getMetadata(),e.getMetadata())}};Ys=D([u(1,mt),u(2,F),u(3,me),u(4,ce),u(5,ie),u(6,on),u(7,Q),u(8,Je)],Ys);const ok=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Gh;Pe(ok);class nk{constructor(e,t){this.primary=e,this.secondary=t}getEncoding(){return this.primary.getEncoding()}async setEncoding(e,t){await lu.settled([this.primary,this.secondary].map(i=>i.setEncoding(e,t)))}}class rk{constructor(e,t){this.primary=e,this.secondary=t}setLanguageId(e,t){[this.primary,this.secondary].forEach(i=>i.setLanguageId(e,t))}}function cr(a){if(a instanceof Ni)return a;if(a instanceof br){const t=cr(a.primary),i=cr(a.secondary);return t&&i?new nk(t,i):t}const e=a;return _C(e.setEncoding,e.getEncoding)?e:null}function Ka(a){if(a instanceof Ni)return a;if(a instanceof br){const t=Ka(a.primary),i=Ka(a.secondary);return t&&i?new rk(t,i):t}const e=a;return typeof e.setLanguageId=="function"?e:null}class ak{constructor(){this.indentation=!1,this.selectionStatus=!1,this.languageId=!1,this.languageStatus=!1,this.encoding=!1,this.EOL=!1,this.tabFocusMode=!1,this.inputMode=!1,this.columnSelectionMode=!1,this.metadata=!1}combine(e){this.indentation=this.indentation||e.indentation,this.selectionStatus=this.selectionStatus||e.selectionStatus,this.languageId=this.languageId||e.languageId,this.languageStatus=this.languageStatus||e.languageStatus,this.encoding=this.encoding||e.encoding,this.EOL=this.EOL||e.EOL,this.tabFocusMode=this.tabFocusMode||e.tabFocusMode,this.inputMode=this.inputMode||e.inputMode,this.columnSelectionMode=this.columnSelectionMode||e.columnSelectionMode,this.metadata=this.metadata||e.metadata}hasChanges(){return this.indentation||this.selectionStatus||this.languageId||this.languageStatus||this.encoding||this.EOL||this.tabFocusMode||this.inputMode||this.columnSelectionMode||this.metadata}}class dk{get selectionStatus(){return this._selectionStatus}get languageId(){return this._languageId}get encoding(){return this._encoding}get EOL(){return this._EOL}get indentation(){return this._indentation}get tabFocusMode(){return this._tabFocusMode}get inputMode(){return this._inputMode}get columnSelectionMode(){return this._columnSelectionMode}get metadata(){return this._metadata}update(e){const t=new ak;switch(e.type){case"selectionStatus":this._selectionStatus!==e.selectionStatus&&(this._selectionStatus=e.selectionStatus,t.selectionStatus=!0);break;case"indentation":this._indentation!==e.indentation&&(this._indentation=e.indentation,t.indentation=!0);break;case"languageId":this._languageId!==e.languageId&&(this._languageId=e.languageId,t.languageId=!0);break;case"encoding":this._encoding!==e.encoding&&(this._encoding=e.encoding,t.encoding=!0);break;case"EOL":this._EOL!==e.EOL&&(this._EOL=e.EOL,t.EOL=!0);break;case"tabFocusMode":this._tabFocusMode!==e.tabFocusMode&&(this._tabFocusMode=e.tabFocusMode,t.tabFocusMode=!0);break;case"inputMode":this._inputMode!==e.inputMode&&(this._inputMode=e.inputMode,t.inputMode=!0);break;case"columnSelectionMode":this._columnSelectionMode!==e.columnSelectionMode&&(this._columnSelectionMode=e.columnSelectionMode,t.columnSelectionMode=!0);break;case"metadata":this._metadata!==e.metadata&&(this._metadata=e.metadata,t.metadata=!0);break}return t}}let Uh=class extends R{constructor(e){super(),this.configurationService=e,this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,this.registerListeners();const t=e.getValue("editor.tabFocusMode")===!0;bc.setTabFocusMode(t)}registerListeners(){this._register(bc.onDidChangeTabFocus(e=>this._onDidChange.fire(e))),this._register(this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration("editor.tabFocusMode")){const t=this.configurationService.getValue("editor.tabFocusMode")===!0;bc.setTabFocusMode(t),this._onDidChange.fire(t)}}))}};Uh=D([u(0,ie)],Uh);class ck extends R{constructor(){super(),this._onDidChange=this._register(new E),this.onDidChange=this._onDidChange.event,xg.setInputMode("insert"),this._register(xg.onDidChangeInputMode(e=>this._onDidChange.fire(e)))}}const lk=c(3264,"Ln {0}, Col {1} ({2} selected)"),hk=c(3265,"Ln {0}, Col {1}"),uk=c(3266,"{0} selections ({1} characters selected)"),pk=c(3267,"{0} selections"),Vy=c(3268,"LF"),Py=c(3269,"CRLF");let Hh=class extends R{constructor(e,t,i,s,o,n,r,d){super(),this.targetWindowId=e,this.editorService=t,this.quickInputService=i,this.languageService=s,this.textFileService=o,this.statusbarService=n,this.configurationService=d,this.tabFocusModeElement=this._register(new Ie),this.inputModeElement=this._register(new Ie),this.columnSelectionModeElement=this._register(new Ie),this.indentationElement=this._register(new Ie),this.selectionElement=this._register(new Ie),this.encodingElement=this._register(new Ie),this.eolElement=this._register(new Ie),this.languageElement=this._register(new Ie),this.metadataElement=this._register(new Ie),this.state=new dk,this.toRender=void 0,this.activeEditorListeners=this._register(new O),this.delayedRender=this._register(new Ie),this.currentMarkerStatus=this._register(r.createInstance(zh)),this.tabFocusMode=this._register(r.createInstance(Uh)),this.inputMode=this._register(r.createInstance(ck)),this.registerCommands(),this.registerListeners()}registerListeners(){this._register(this.editorService.onDidActiveEditorChange(()=>this.updateStatusBar())),this._register(this.textFileService.untitled.onDidChangeEncoding(e=>this.onResourceEncodingChange(e.resource))),this._register(this.textFileService.files.onDidChangeEncoding(e=>this.onResourceEncodingChange(e.resource))),this._register(V.runAndSubscribe(this.tabFocusMode.onDidChange,e=>{e!==void 0?this.onTabFocusModeChange(e):this.onTabFocusModeChange(this.configurationService.getValue("editor.tabFocusMode"))})),this._register(V.runAndSubscribe(this.inputMode.onDidChange,e=>this.onInputModeChange(e??"insert")))}registerCommands(){this._register(Te.registerCommand({id:`changeEditorIndentation${this.targetWindowId}`,handler:()=>this.showIndentationPicker()}))}async showIndentationPicker(){const e=gi(this.editorService.activeTextEditorControl);if(!e)return this.quickInputService.pick([{label:c(3270,"No text editor active at this time")}]);if(this.editorService.activeEditor?.isReadonly())return this.quickInputService.pick([{label:c(3271,"The active code editor is read-only.")}]);const t=[Se(e.getAction(E_.ID)),Se(e.getAction(I_.ID)),Se(e.getAction(D_.ID)),Se(e.getAction(A_.ID)),Se(e.getAction(T_.ID)),Se(e.getAction(x_.ID)),Se(e.getAction(k_.ID))].map(s=>({id:s.id,label:s.label,detail:tm.isDefaultVariant()||s.label===s.alias?void 0:s.alias,run:()=>{e.focus(),s.run()}}));return t.splice(3,0,{type:"separator",label:c(3272,"convert file")}),t.unshift({type:"separator",label:c(3273,"change view")}),(await this.quickInputService.pick(t,{placeHolder:c(3274,"Select Action"),matchOnDetail:!0}))?.run()}updateTabFocusModeElement(e){if(e){if(!this.tabFocusModeElement.value){const t=c(3275,"Tab Moves Focus");this.tabFocusModeElement.value=this.statusbarService.addEntry({name:c(3276,"Accessibility Mode"),text:t,ariaLabel:t,tooltip:c(3277,"Disable Accessibility Mode"),command:"editor.action.toggleTabFocusMode",kind:"prominent"},"status.editor.tabFocusMode",et.RIGHT,100.7)}}else this.tabFocusModeElement.clear()}updateInputModeElement(e){if(e==="overtype"){if(!this.inputModeElement.value){const t=c(3278,"OVR"),i=c(3279,"Enable Insert Mode");this.inputModeElement.value=this.statusbarService.addEntry({name:i,text:t,ariaLabel:t,tooltip:i,command:"editor.action.toggleOvertypeInsertMode",kind:"prominent"},"status.editor.inputMode",et.RIGHT,100.6)}}else this.inputModeElement.clear()}updateColumnSelectionModeElement(e){if(e){if(!this.columnSelectionModeElement.value){const t=c(3280,"Column Selection");this.columnSelectionModeElement.value=this.statusbarService.addEntry({name:c(3281,"Column Selection Mode"),text:t,ariaLabel:t,tooltip:c(3282,"Disable Column Selection Mode"),command:"editor.action.toggleColumnSelection",kind:"prominent"},"status.editor.columnSelectionMode",et.RIGHT,100.8)}}else this.columnSelectionModeElement.clear()}updateSelectionElement(e){if(!e){this.selectionElement.clear();return}if(gi(this.editorService.activeTextEditorControl)?.getModel()?.uri?.scheme===pe.vscodeNotebookCell){this.selectionElement.clear();return}const i={name:c(3283,"Editor Selection"),text:e,ariaLabel:e,tooltip:c(3284,"Go to Line/Column"),command:"workbench.action.gotoLine"};this.updateElement(this.selectionElement,i,"status.editor.selection",et.RIGHT,100.5)}updateIndentationElement(e){if(!e){this.indentationElement.clear();return}if(gi(this.editorService.activeTextEditorControl)?.getModel()?.uri?.scheme===pe.vscodeNotebookCell){this.indentationElement.clear();return}const i={name:c(3285,"Editor Indentation"),text:e,ariaLabel:e,tooltip:c(3286,"Select Indentation"),command:`changeEditorIndentation${this.targetWindowId}`};this.updateElement(this.indentationElement,i,"status.editor.indentation",et.RIGHT,100.4)}updateEncodingElement(e){if(!e){this.encodingElement.clear();return}const t={name:c(3287,"Editor Encoding"),text:e,ariaLabel:e,tooltip:c(3288,"Select Encoding"),command:"workbench.action.editor.changeEncoding"};this.updateElement(this.encodingElement,t,"status.editor.encoding",et.RIGHT,100.3)}updateEOLElement(e){if(!e){this.eolElement.clear();return}const t={name:c(3289,"Editor End of Line"),text:e,ariaLabel:e,tooltip:c(3290,"Select End of Line Sequence"),command:"workbench.action.editor.changeEOL"};this.updateElement(this.eolElement,t,"status.editor.eol",et.RIGHT,100.2)}updateLanguageIdElement(e){if(!e){this.languageElement.clear();return}const t={name:c(3291,"Editor Language"),text:e,ariaLabel:e,tooltip:c(3292,"Select Language Mode"),command:"workbench.action.editor.changeLanguageMode"};this.updateElement(this.languageElement,t,"status.editor.mode",et.RIGHT,100.1)}updateMetadataElement(e){if(!e){this.metadataElement.clear();return}const t={name:c(3293,"File Information"),text:e,ariaLabel:e,tooltip:c(3294,"File Information")};this.updateElement(this.metadataElement,t,"status.editor.info",et.RIGHT,100)}updateElement(e,t,i,s,o){e.value?e.value.update(t):e.value=this.statusbarService.addEntry(t,i,s,o)}updateState(e){const t=this.state.update(e);t.hasChanges()&&(this.toRender?this.toRender.combine(t):(this.toRender=t,this.delayedRender.value=CC(yd(this.targetWindowId,!0).window,()=>{this.delayedRender.clear();const i=this.toRender;this.toRender=void 0,i&&this.doRenderNow()})))}doRenderNow(){this.updateTabFocusModeElement(!!this.state.tabFocusMode),this.updateInputModeElement(this.state.inputMode),this.updateColumnSelectionModeElement(!!this.state.columnSelectionMode),this.updateIndentationElement(this.state.indentation),this.updateSelectionElement(this.state.selectionStatus),this.updateEncodingElement(this.state.encoding),this.updateEOLElement(this.state.EOL?this.state.EOL===`\r
`?Py:Vy:void 0),this.updateLanguageIdElement(this.state.languageId),this.updateMetadataElement(this.state.metadata)}getSelectionLabel(e){if(!(!e||!e.selections)){if(e.selections.length===1)return e.charactersSelected?vn(lk,e.selections[0].positionLineNumber,e.selections[0].positionColumn,e.charactersSelected):vn(hk,e.selections[0].positionLineNumber,e.selections[0].positionColumn);if(e.charactersSelected)return vn(uk,e.selections.length,e.charactersSelected);if(e.selections.length>0)return vn(pk,e.selections.length)}}updateStatusBar(){const e=this.editorService.activeEditor,t=this.editorService.activeEditorPane,i=t?gi(t.getControl())??void 0:void 0;if(this.onColumnSelectionModeChange(i),this.onSelectionChange(i),this.onLanguageChange(i,e),this.onEOLChange(i),this.onEncodingChange(t,i),this.onIndentationChange(i),this.onMetadataChange(t),this.currentMarkerStatus.update(i),this.activeEditorListeners.clear(),t&&this.activeEditorListeners.add(t.onDidChangeControl(()=>{this.updateStatusBar()})),i)this.activeEditorListeners.add(i.onDidChangeConfiguration(s=>{s.hasChanged(Pt.columnSelection)&&this.onColumnSelectionModeChange(i)})),this.activeEditorListeners.add(V.defer(i.onDidChangeCursorPosition)(()=>{this.onSelectionChange(i),this.currentMarkerStatus.update(i)})),this.activeEditorListeners.add(i.onDidChangeModelLanguage(()=>{this.onLanguageChange(i,e)})),this.activeEditorListeners.add(V.accumulate(i.onDidChangeModelContent)(s=>{this.onEOLChange(i),this.currentMarkerStatus.update(i);const o=i.getSelections();if(o){for(const n of s)for(const r of n.changes)if(o.some(d=>ve.areIntersecting(d,r.range))){this.onSelectionChange(i);break}}})),this.activeEditorListeners.add(i.onDidChangeModelOptions(()=>{this.onIndentationChange(i)}));else if(t instanceof Qi||t instanceof Ys){const s=[];if(t instanceof Ys){const o=t.getPrimaryEditorPane();o instanceof Qi&&s.push(o);const n=t.getSecondaryEditorPane();n instanceof Qi&&s.push(n)}else s.push(t);for(const o of s)this.activeEditorListeners.add(o.onDidChangeMetadata(()=>{this.onMetadataChange(t)})),this.activeEditorListeners.add(o.onDidOpenInPlace(()=>{this.updateStatusBar()}))}}onLanguageChange(e,t){const i={type:"languageId",languageId:void 0};if(e&&t&&Ka(t)){const s=e.getModel();if(s){const o=s.getLanguageId();i.languageId=this.languageService.getLanguageName(o)??void 0}}this.updateState(i)}onIndentationChange(e){const t={type:"indentation",indentation:void 0};if(e){const i=e.getModel();if(i){const s=i.getOptions();t.indentation=s.insertSpaces?s.tabSize===s.indentSize?c(3295,"Spaces: {0}",s.indentSize):c(3296,"Spaces: {0} (Tab Size: {1})",s.indentSize,s.tabSize):c(3297,"Tab Size: {0}",s.tabSize)}}this.updateState(t)}onMetadataChange(e){const t={type:"metadata",metadata:void 0};(e instanceof Qi||e instanceof Ys)&&(t.metadata=e.getMetadata()),this.updateState(t)}onColumnSelectionModeChange(e){const t={type:"columnSelectionMode",columnSelectionMode:!1};e?.getOption(Pt.columnSelection)&&(t.columnSelectionMode=!0),this.updateState(t)}onSelectionChange(e){const t=Object.create(null);if(e){t.selections=e.getSelections()||[],t.charactersSelected=0;const i=e.getModel();if(i)for(const s of t.selections)typeof t.charactersSelected!="number"&&(t.charactersSelected=0),t.charactersSelected+=i.getCharacterCountInRange(s);if(t.selections.length===1){const s=e.getPosition(),o=new im(t.selections[0].selectionStartLineNumber,t.selections[0].selectionStartColumn,t.selections[0].positionLineNumber,s?e.getStatusbarColumn(s):t.selections[0].positionColumn);t.selections[0]=o}}this.updateState({type:"selectionStatus",selectionStatus:this.getSelectionLabel(t)})}onEOLChange(e){const t={type:"EOL",EOL:void 0};if(e&&!e.getOption(Pt.readOnly)){const i=e.getModel();i&&(t.EOL=i.getEOL())}this.updateState(t)}onEncodingChange(e,t){if(e&&!this.isActiveEditor(e))return;const i={type:"encoding",encoding:void 0};if(e&&t?.hasModel()){const s=e.input?cr(e.input):null;if(s){const o=s.getEncoding(),n=typeof o=="string"?Hi[o]:void 0;n?i.encoding=n.labelShort:i.encoding=o}}this.updateState(i)}onResourceEncodingChange(e){const t=this.editorService.activeEditorPane;if(t){const i=Bt.getCanonicalUri(t.input,{supportSideBySide:Li.PRIMARY});if(i&&dt(i,e)){const s=gi(t.getControl())??void 0;return this.onEncodingChange(t,s)}}}onTabFocusModeChange(e){const t={type:"tabFocusMode",tabFocusMode:e};this.updateState(t)}onInputModeChange(e){const t={type:"inputMode",inputMode:e};this.updateState(t)}isActiveEditor(e){const t=this.editorService.activeEditorPane;return!!t&&t===e}};Hh=D([u(1,Q),u(2,Jt),u(3,Zo),u(4,tn),u(5,Rs),u(6,F),u(7,ie)],Hh);let Wa=class extends R{static{this.ID="workbench.contrib.editorStatus"}constructor(e){super(),this.editorGroupService=e;for(const t of e.parts)this.createEditorStatus(t);this._register(e.onDidCreateAuxiliaryEditorPart(t=>this.createEditorStatus(t)))}createEditorStatus(e){const t=new O;V.once(e.onWillDispose)(()=>t.dispose());const i=this.editorGroupService.getScopedInstantiationService(e);t.add(i.createInstance(Hh,e.windowId))}};Wa=D([u(0,Je)],Wa);let zh=class extends R{constructor(e,t,i){super(),this.statusbarService=e,this.markerService=t,this.configurationService=i,this.editor=void 0,this.markers=[],this.currentMarker=null,this.statusBarEntryAccessor=this._register(new Ie),this._register(t.onMarkerChanged(s=>this.onMarkerChanged(s))),this._register(V.filter(i.onDidChangeConfiguration,s=>s.affectsConfiguration("problems.showCurrentInStatus"))(()=>this.updateStatus()))}update(e){this.editor=e,this.updateMarkers(),this.updateStatus()}updateStatus(){const e=this.currentMarker;if(this.currentMarker=this.getMarker(),this.hasToUpdateStatus(e,this.currentMarker))if(this.currentMarker){const t=SC(this.currentMarker.message)[0],i=`${this.getType(this.currentMarker)} ${t}`;this.statusBarEntryAccessor.value?this.statusBarEntryAccessor.value.update({name:c(3298,"Current Problem"),text:i,ariaLabel:i}):this.statusBarEntryAccessor.value=this.statusbarService.addEntry({name:c(3298,"Current Problem"),text:i,ariaLabel:i},"statusbar.currentProblem",et.LEFT)}else this.statusBarEntryAccessor.clear()}hasToUpdateStatus(e,t){return!t||!e?!0:Kp.makeKey(e)!==Kp.makeKey(t)}getType(e){switch(e.severity){case Ms.Error:return"$(error)";case Ms.Warning:return"$(warning)";case Ms.Info:return"$(info)"}return""}getMarker(){if(!this.configurationService.getValue("problems.showCurrentInStatus")||!this.editor||!this.editor.getModel())return null;const t=this.editor.getPosition();return t&&this.markers.find(i=>ve.containsPosition(i,t))||null}onMarkerChanged(e){if(!this.editor)return;const t=this.editor.getModel();t&&(t&&!e.some(i=>dt(t.uri,i))||this.updateMarkers())}updateMarkers(){if(!this.editor)return;const e=this.editor.getModel();e&&(e?(this.markers=this.markerService.read({resource:e.uri,severities:Ms.Error|Ms.Warning|Ms.Info}),this.markers.sort(this.compareMarker)):this.markers=[],this.updateStatus())}compareMarker(e,t){let i=_d(e.resource.toString(),t.resource.toString());return i===0&&(i=Ms.compare(e.severity,t.severity)),i===0&&(i=ve.compareRangesUsingStarts(e,t)),i}};zh=D([u(0,Rs),u(1,vC),u(2,ie)],zh);let $h=class extends _t{static{Gh=this}static{this.ID="workbench.action.showLanguageExtensions"}constructor(e,t,i){super(Gh.ID,c(3299,"Search Marketplace Extensions for '{0}'...",e)),this.fileExtension=e,this.commandService=t,this.enabled=i.isEnabled()}async run(){await this.commandService.executeCommand("workbench.extensions.action.showExtensionsForLanguage",this.fileExtension)}};$h=Gh=D([u(1,wt),u(2,__)],$h);class Ga extends X{static{this.ID="workbench.action.editor.changeLanguageMode"}constructor(){super({id:Ga.ID,title:x(3300,"Change Language Mode"),f1:!0,keybinding:{weight:W.WorkbenchContrib,primary:qf(N.CtrlCmd|y.KeyK,y.KeyM)},precondition:I.not("notebookEditorFocused"),metadata:{description:c(3301,"Change the language mode of the active text editor."),args:[{name:c(3302,"The name of the language mode to change to."),constraint:e=>typeof e=="string"}]}})}async run(e,t){const i=e.get(Jt),s=e.get(Q),o=e.get(Zo),n=e.get(WD),r=e.get(tn),d=e.get(Kd),l=e.get(F),h=e.get(ie),p=e.get(mt),f=gi(s.activeTextEditorControl);if(!f){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}const g=f.getModel(),m=Bt.getOriginalUri(s.activeEditor,{supportSideBySide:Li.PRIMARY});let v,b;g&&(b=g.getLanguageId(),v=o.getLanguageName(b)??void 0);let A=!!m;m?.scheme===pe.untitled&&!r.untitled.get(m)?.hasAssociatedFilePath&&(A=!1);const P=o.getSortedRegisteredLanguageNames().map(({languageName:bt,languageId:lt})=>{const Ii=o.getExtensions(lt).join(" ");let $e;return v===bt?$e=c(3303,"({0}) - Configured Language",lt):$e=c(3304,"({0})",lt),{label:bt,meta:Ii,iconClasses:ng(lt),description:$e}});P.unshift({type:"separator",label:c(3305,"languages (identifier)")});let L,$,z;if(A&&m){const bt=ki(m)||os(m);z=l.createInstance($h,bt),z.enabled&&P.unshift(z),$={label:c(3306,"Configure '{0}' language based settings...",v)},P.unshift($),L={label:c(3307,"Configure File Association for '{0}'...",bt)},P.unshift(L)}const Z={label:c(3308,"Auto Detect")};P.unshift(Z);const ne=typeof t=="string"?{label:t}:await i.pick(P,{placeHolder:c(3309,"Select Language Mode"),matchOnDescription:!0});if(!ne)return;if(ne===z){z.run();return}if(ne===L){m&&this.configureFileAssociation(m,o,i,h);return}if(ne===$){d.openUserSettings({jsonEditor:!0,revealSetting:{key:`[${b??null}]`,edit:!0}});return}const Me=s.activeEditor;if(Me){const bt=Ka(Me);if(bt){let lt,Ii;if(ne===Z){if(g){const $e=Bt.getOriginalUri(Me,{supportSideBySide:Li.PRIMARY});if($e){let Xt=o.guessLanguageIdByFilepathOrFirstLine($e,g.getLineContent(1))??void 0;(!Xt||Xt==="unknown")&&(Ii=await n.detectLanguage($e),Xt=Ii),Xt&&(lt=o.createById(Xt))}}}else{const $e=o.getLanguageIdByLanguageName(ne.label);lt=o.createById($e),m&&n.detectLanguage(m).then(Xt=>{const st=o.getLanguageIdByLanguageName(ne.label)||"unknown";if(Xt===b&&b!==st){const Gy=h.getValue("workbench.editor.preferHistoryBasedLanguageDetection")?"history":"classic";p.publicLog2(GD,{currentLanguageId:v??"unknown",nextLanguageId:ne.label,lineCount:g?.getLineCount()??-1,modelPreference:Gy})}})}if(typeof lt<"u"&&(bt.setLanguageId(lt.languageId,Ga.ID),m?.scheme===pe.untitled)){const $e=h.getValue("workbench.editor.preferHistoryBasedLanguageDetection")?"history":"classic";p.publicLog2("setUntitledDocumentLanguage",{to:lt.languageId,from:b??"none",modelPreference:$e})}}f.focus()}}configureFileAssociation(e,t,i,s){const o=ki(e),n=os(e),r=t.guessLanguageIdByFilepathOrFirstLine(U.file(n)),l=t.getSortedRegisteredLanguageNames().map(({languageName:h,languageId:p})=>({id:p,label:h,iconClasses:ng(p),description:p===r?c(3310,"Current Association"):void 0}));setTimeout(async()=>{const h=await i.pick(l,{placeHolder:c(3311,"Select Language Mode to Associate with '{0}'",o||n)});if(h){const p=s.inspect(Fp);let f;o&&n[0]!=="."?f=`*${o}`:f=n;let g=Qe.USER;p.workspaceValue&&p.workspaceValue[f]&&(g=Qe.WORKSPACE);const m=bC(g===Qe.WORKSPACE?p.workspaceValue:p.userValue)||Object.create(null);m[f]=h.id,s.updateValue(Fp,m,g)}},50)}}class gk extends X{constructor(){super({id:"workbench.action.editor.changeEOL",title:x(3312,"Change End of Line Sequence"),f1:!0})}async run(e){const t=e.get(Q),i=e.get(Jt),s=gi(t.activeTextEditorControl);if(!s){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}if(t.activeEditor?.isReadonly()){await i.pick([{label:c(3271,"The active code editor is read-only.")}]);return}let o=s.getModel();const n=[{label:Vy,eol:Wp.LF},{label:Py,eol:Wp.CRLF}],r=o?.getEOL()===`
`?0:1,d=await i.pick(n,{placeHolder:c(3313,"Select End of Line Sequence"),activeItem:n[r]});if(d){const l=gi(t.activeTextEditorControl);l?.hasModel()&&!t.activeEditor?.isReadonly()&&(o=l.getModel(),o.pushStackElement(),o.pushEOL(d.eol),o.pushStackElement())}s.focus()}}class fk extends X{constructor(){super({id:"workbench.action.editor.changeEncoding",title:x(3314,"Change File Encoding"),f1:!0})}async run(e){const t=e.get(Q),i=e.get(Jt),s=e.get(Le),o=e.get(tn),n=e.get(on),r=gi(t.activeTextEditorControl);if(!r){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}const d=t.activeEditorPane;if(!d){await i.pick([{label:c(3270,"No text editor active at this time")}]);return}const l=cr(d.input);if(!l){await i.pick([{label:c(3315,"No file active at this time")}]);return}const h={label:c(3316,"Save with Encoding")},p={label:c(3317,"Reopen with Encoding")};if(!tm.isDefaultVariant()){const Z="Save with Encoding";Z!==h.label&&(h.detail=Z);const ne="Reopen with Encoding";ne!==p.label&&(p.detail=ne)}let f;if(l instanceof Ni?f=h:d.input.isReadonly()?f=p:f=await i.pick([p,h],{placeHolder:c(3274,"Select Action"),matchOnDetail:!0}),!f)return;await io(50);const g=Bt.getOriginalUri(d.input,{supportSideBySide:Li.PRIMARY});if(!g||!s.hasProvider(g)&&g.scheme!==pe.untitled)return;let m;s.hasProvider(g)&&(m=(await o.readStream(g,{autoGuessEncoding:!0,candidateGuessEncodings:n.getValue(g,"files.candidateGuessEncodings")})).encoding);const v=f===p,b=n.getValue(g,"files.encoding");let A,K;const P=Object.keys(Hi).sort((Z,ne)=>Z===b?-1:ne===b?1:Hi[Z].order-Hi[ne].order).filter(Z=>Z===m&&m!==b?!1:!v||!Hi[Z].encodeOnly).map((Z,ne)=>(Z===l.getEncoding()?A=ne:Hi[Z].alias===l.getEncoding()&&(K=ne),{id:Z,label:Hi[Z].labelLong,description:Z})),L=P.slice();m&&b!==m&&Hi[m]&&(P.unshift({type:"separator"}),P.unshift({id:m,label:Hi[m].labelLong,description:c(3318,"Guessed from content")}));const $=await i.pick(P,{placeHolder:v?c(3319,"Select File Encoding to Reopen File"):c(3320,"Select File Encoding to Save with"),activeItem:L[typeof A=="number"?A:typeof K=="number"?K:-1]});if(!$||!t.activeEditorPane)return;const z=cr(t.activeEditorPane.input);typeof $.id<"u"&&z&&await z.setEncoding($.id,v?Dg.Decode:Dg.Encode),r.focus()}}let jh=class{constructor(e,t,i){this.filesConfigurationService=e,this.environmentService=t,this.pathService=i}canSerialize(e){return this.filesConfigurationService.isHotExitEnabled&&!e.isDisposed()}serialize(e){if(!this.canSerialize(e))return;const t=e;let i=t.resource;t.hasAssociatedFilePath&&(i=sm(i,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme));let s;const o=t.getLanguageId();(o!==ga||t.hasLanguageSetExplicitly)&&(s=o);const n={resourceJSON:i.toJSON(),modeId:s,encoding:t.getEncoding()};return JSON.stringify(n)}deserialize(e,t){return e.invokeFunction(i=>{const s=JSON.parse(t),o=U.revive(s.resourceJSON),n=s.modeId,r=s.encoding;return i.get(Er).createTextEditor({resource:o,languageId:n,encoding:r,forceUntitled:!0})})}};jh=D([u(0,Td),u(1,ni),u(2,wd)],jh);let Ua=class extends R{static{this.ID="workbench.contrib.untitledTextEditorWorkingCopyEditorHandler"}constructor(e,t,i,s,o){super(),this.environmentService=t,this.pathService=i,this.textEditorService=s,this.untitledTextEditorService=o,this._register(e.registerHandler(this))}handles(e){return e.resource.scheme===pe.untitled&&e.typeId===sl}isOpen(e,t){return this.handles(e)?t instanceof Ni&&dt(e.resource,t.resource):!1}createEditor(e){let t;return this.untitledTextEditorService.isUntitledWithAssociatedResource(e.resource)?t=sm(e.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):t=e.resource,this.textEditorService.createTextEditor({resource:t,forceUntitled:!0})}};Ua=D([u(0,Vd),u(1,ni),u(2,wd),u(3,Er),u(4,Pw)],Ua);var Co;let Ha=class extends R{static{Co=this}static{this.ID="workbench.contrib.dynamicEditorConfigurations"}static{this.AUTO_LOCK_DEFAULT_ENABLED=new Set(["terminalEditor","mainThreadWebview-simpleBrowser.view","mainThreadWebview-browserPreview","workbench.editor.chatSession"])}static{this.AUTO_LOCK_EXTRA_EDITORS=[{id:"workbench.input.interactive",label:c(3218,"Interactive Window"),priority:De.builtin},{id:"mainThreadWebview-markdown.preview",label:c(3219,"Markdown Preview"),priority:De.builtin},{id:"mainThreadWebview-simpleBrowser.view",label:c(3220,"Simple Browser"),priority:De.builtin},{id:"mainThreadWebview-browserPreview",label:c(3221,"Live Preview"),priority:De.builtin}]}static{this.AUTO_LOCK_REMOVE_EDITORS=new Set(["vscode-interactive-input","interactive","vscode.markdown.preview.editor"])}constructor(e,t,i){super(),this.editorResolverService=e,this.environmentService=i,this.configurationRegistry=H.as(xs.Configuration),(async()=>(await t.whenInstalledExtensionsRegistered(),this.updateDynamicEditorConfigurations(),this.registerListeners()))()}registerListeners(){this._register(V.debounce(this.editorResolverService.onDidChangeEditorRegistrations,(e,t)=>t)(()=>this.updateDynamicEditorConfigurations()))}updateDynamicEditorConfigurations(){const e=[...this.editorResolverService.getEditors(),...Co.AUTO_LOCK_EXTRA_EDITORS].filter(l=>!Co.AUTO_LOCK_REMOVE_EDITORS.has(l.id)),t=this.editorResolverService.getEditors().filter(l=>l.priority!==De.exclusive).map(l=>l.id),i=Object.create(null);for(const l of e)i[l.id]={type:"boolean",default:Co.AUTO_LOCK_DEFAULT_ENABLED.has(l.id),description:l.label};const s=Object.create(null);for(const l of e)s[l.id]=Co.AUTO_LOCK_DEFAULT_ENABLED.has(l.id);const o=this.autoLockConfigurationNode;this.autoLockConfigurationNode={...Cn,properties:{"workbench.editor.autoLockGroups":{type:"object",description:c(3222,"If an editor matching one of the listed types is opened as the first in an editor group and more than one group is open, the group is automatically locked. Locked groups will only be used for opening editors when explicitly chosen by a user gesture (for example drag and drop), but not by default. Consequently, the active editor in a locked group is less likely to be replaced accidentally with a different editor."),properties:i,default:s,additionalProperties:!1}}};const n=this.defaultBinaryEditorConfigurationNode;this.defaultBinaryEditorConfigurationNode={...Cn,properties:{"workbench.editor.defaultBinaryEditor":{type:"string",default:"",enum:[...t,""],description:c(3223,"The default editor for files detected as binary. If undefined, the user will be presented with a picker.")}}};const r=this.editorAssociationsConfigurationNode;this.editorAssociationsConfigurationNode={...Cn,properties:{"workbench.editorAssociations":{type:"object",markdownDescription:c(3224,'Configure [glob patterns](https://aka.ms/vscode-glob-patterns) to editors (for example `"*.hex": "hexEditor.hexedit"`). These have precedence over the default behavior.'),patternProperties:{".*":{type:"string",enum:t}}}}};const d=this.editorLargeFileConfirmationConfigurationNode;this.editorLargeFileConfirmationConfigurationNode={...Cn,properties:{"workbench.editorLargeFileConfirmation":{type:"number",default:EC(this.environmentService.remoteAuthority)/Su.MB,minimum:1,scope:Nc.RESOURCE,markdownDescription:c(3225,"Controls the minimum size of a file in MB before asking for confirmation when opening in the editor. Note that this setting may not apply to all editor types and environments.")}}},this.configurationRegistry.updateConfigurations({add:[this.autoLockConfigurationNode,this.defaultBinaryEditorConfigurationNode,this.editorAssociationsConfigurationNode,this.editorLargeFileConfirmationConfigurationNode],remove:gs([o,n,r,d])})}};Ha=Co=D([u(0,Sr),u(1,kt),u(2,ni)],Ha);H.as(ct.EditorPane).registerEditorPane(vi.create(Fa,Fa.ID,c(2946,"Text Editor")),[new ee(Ni),new ee(Ym)]);H.as(ct.EditorPane).registerEditorPane(vi.create(rg,rg.ID,c(2947,"Text Diff Editor")),[new ee(Cr)]);H.as(ct.EditorPane).registerEditorPane(vi.create(Ys,Ys.ID,c(2948,"Binary Diff Editor")),[new ee(Cr)]);H.as(ct.EditorPane).registerEditorPane(vi.create(jc,jc.ID,c(2949,"Side by Side Editor")),[new ee(br)]);H.as(ct.EditorFactory).registerEditorSerializer(Ni.ID,jh);H.as(ct.EditorFactory).registerEditorSerializer(br.ID,R_);H.as(ct.EditorFactory).registerEditorSerializer(Cr.ID,L_);yt(Wa.ID,Wa,vt.BlockRestore);yt(Ua.ID,Ua,vt.BlockRestore);yt(Ha.ID,Ha,vt.BlockRestore);fd(ag.ID,ag,md.AfterFirstRender);const Xu=H.as(IC.Quickaccess),Zd="inEditorsPicker",My=I.and(V_,I.has(Zd));Xu.registerQuickAccessProvider({ctor:dg,prefix:dg.PREFIX,contextKey:Zd,placeholder:c(2950,"Type the name of an editor to open it."),helpEntries:[{description:c(2951,"Show Editors in Active Group by Most Recently Used"),commandId:Zm.ID}]});Xu.registerQuickAccessProvider({ctor:cg,prefix:cg.PREFIX,contextKey:Zd,placeholder:c(2950,"Type the name of an editor to open it."),helpEntries:[{description:c(2952,"Show All Opened Editors By Appearance"),commandId:Xm.ID}]});Xu.registerQuickAccessProvider({ctor:lg,prefix:lg.PREFIX,contextKey:Zd,placeholder:c(2950,"Type the name of an editor to open it."),helpEntries:[{description:c(2953,"Show All Opened Editors By Most Recently Used"),commandId:Qm.ID}]});C(Ga);C(gk);C(fk);C(qc);C(Yc);C(P_);C(M_);C(O_);C(N_);C(B_);C(F_);C(K_);C(W_);C(G_);C(U_);C(ew);C(tw);C(Xm);C(Qm);C(Zm);C(H_);C(z_);C($_);C(j_);C(q_);C(Y_);C(J_);C(Z_);C(X_);C(Q_);C(eE);C(tE);C(iE);C(sE);C(oE);C(nE);C(rE);C(aE);C(dE);C(cE);C(lE);C(hE);C(uE);C(pE);C(gE);C(fE);C(mE);C(wE);C(yE);C(vE);C(bE);C(CE);C(SE);C(_E);C(EE);C(IE);C(DE);C(AE);C(TE);C(xE);C(kE);C(RE);C(LE);C(VE);C(PE);C(ME);C(OE);C(NE);C(BE);C(FE);C(KE);C(WE);C(GE);C(UE);C(HE);C(zE);C($E);C(jE);C(qE);C(YE);C(JE);C(ZE);C(XE);C(QE);C(eI);C(tI);C(iI);C(sI);C(oI);C(nI);C(iw);C(sw);C(ow);C(nw);C(rw);C(aw);C(dw);C(cw);C(rI);C(aI);C(dI);C(cI);C(lI);C(hI);C(uI);C(pI);C(gI);C(fI);C(mI);C(wI);C(yI);const af="workbench.action.quickOpenNavigateNextInEditorPicker";oe.registerCommandAndKeybindingRule({id:af,weight:W.WorkbenchContrib+50,handler:lw(af,!0),when:My,primary:N.CtrlCmd|y.Tab,mac:{primary:N.WinCtrl|y.Tab}});const df="workbench.action.quickOpenNavigatePreviousInEditorPicker";oe.registerCommandAndKeybindingRule({id:df,weight:W.WorkbenchContrib+50,handler:lw(df,!1),when:My,primary:N.CtrlCmd|N.Shift|y.Tab,mac:{primary:N.WinCtrl|N.Shift|y.Tab}});vI();ut&&(S.appendMenuItem(w.TouchBarContext,{command:{id:Yc.ID,title:Yc.LABEL,icon:{dark:kn.asFileUri("vs/workbench/browser/parts/editor/media/back-tb.png")}},group:"navigation",order:0}),S.appendMenuItem(w.TouchBarContext,{command:{id:qc.ID,title:qc.LABEL,icon:{dark:kn.asFileUri("vs/workbench/browser/parts/editor/media/forward-tb.png")}},group:"navigation",order:1}));S.appendMenuItem(w.EmptyEditorGroup,{command:{id:hw,title:c(2954,"Lock Group"),icon:k.unlock},group:"navigation",order:10,when:I.and(an,dn.toNegated())});S.appendMenuItem(w.EmptyEditorGroup,{command:{id:uw,title:c(2955,"Unlock Group"),icon:k.lock,toggled:I.true()},group:"navigation",order:10,when:dn});S.appendMenuItem(w.EmptyEditorGroup,{command:{id:pw,title:c(2956,"Close Group"),icon:k.close},group:"navigation",order:20,when:I.or(an,Nu)});S.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:Pd,title:c(2957,"Split Up")},group:"2_split",order:10});S.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:Ir,title:c(2958,"Split Down")},group:"2_split",order:20});S.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:Md,title:c(2959,"Split Left")},group:"2_split",order:30});S.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:Dr,title:c(2960,"Split Right")},group:"2_split",order:40});S.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:bI,title:c(2961,"New Window")},group:"3_window",order:10});S.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:gw,title:c(2962,"Lock Group"),toggled:dn},group:"4_lock",order:10,when:an.toNegated()});S.appendMenuItem(w.EmptyEditorGroupContext,{command:{id:pw,title:c(2963,"Close")},group:"5_close",order:10,when:Si});S.appendMenuItem(w.EditorTabsBarContext,{command:{id:Pd,title:c(2957,"Split Up")},group:"2_split",order:10});S.appendMenuItem(w.EditorTabsBarContext,{command:{id:Ir,title:c(2958,"Split Down")},group:"2_split",order:20});S.appendMenuItem(w.EditorTabsBarContext,{command:{id:Md,title:c(2959,"Split Left")},group:"2_split",order:30});S.appendMenuItem(w.EditorTabsBarContext,{command:{id:Dr,title:c(2960,"Split Right")},group:"2_split",order:40});S.appendMenuItem(w.EditorTabsBarContext,{command:{id:CI,title:c(2964,"Move into New Window")},group:"3_window",order:10});S.appendMenuItem(w.EditorTabsBarContext,{command:{id:SI,title:c(2965,"Copy into New Window")},group:"3_window",order:20});S.appendMenuItem(w.EditorTabsBarContext,{submenu:w.EditorTabsBarShowTabsSubmenu,title:c(2966,"Tab Bar"),group:"4_config",order:10,when:Mw.negate()});S.appendMenuItem(w.EditorTabsBarShowTabsSubmenu,{command:{id:_I.ID,title:c(2967,"Multiple Tabs"),toggled:I.equals("config.workbench.editor.showTabs","multiple")},group:"1_config",order:10});S.appendMenuItem(w.EditorTabsBarShowTabsSubmenu,{command:{id:EI.ID,title:c(2968,"Single Tab"),toggled:I.equals("config.workbench.editor.showTabs","single")},group:"1_config",order:20});S.appendMenuItem(w.EditorTabsBarShowTabsSubmenu,{command:{id:II.ID,title:c(2969,"Hidden"),toggled:I.equals("config.workbench.editor.showTabs","none")},group:"1_config",order:30});S.appendMenuItem(w.EditorTabsBarContext,{submenu:w.EditorTabsBarShowTabsZenModeSubmenu,title:c(2966,"Tab Bar"),group:"4_config",order:10,when:Mw});S.appendMenuItem(w.EditorTabsBarShowTabsZenModeSubmenu,{command:{id:DI.ID,title:c(2967,"Multiple Tabs"),toggled:I.equals("config.zenMode.showTabs","multiple")},group:"1_config",order:10});S.appendMenuItem(w.EditorTabsBarShowTabsZenModeSubmenu,{command:{id:AI.ID,title:c(2968,"Single Tab"),toggled:I.equals("config.zenMode.showTabs","single")},group:"1_config",order:20});S.appendMenuItem(w.EditorTabsBarShowTabsZenModeSubmenu,{command:{id:TI.ID,title:c(2969,"Hidden"),toggled:I.equals("config.zenMode.showTabs","none")},group:"1_config",order:30});S.appendMenuItem(w.EditorTabsBarContext,{submenu:w.EditorActionsPositionSubmenu,title:c(2970,"Editor Actions Position"),group:"4_config",order:20});S.appendMenuItem(w.EditorActionsPositionSubmenu,{command:{id:xI.ID,title:c(2966,"Tab Bar"),toggled:I.equals("config.workbench.editor.editorActionsLocation","default")},group:"1_config",order:10,when:I.equals("config.workbench.editor.showTabs","none").negate()});S.appendMenuItem(w.EditorActionsPositionSubmenu,{command:{id:kI.ID,title:c(2971,"Title Bar"),toggled:I.or(I.equals("config.workbench.editor.editorActionsLocation","titleBar"),I.and(I.equals("config.workbench.editor.showTabs","none"),I.equals("config.workbench.editor.editorActionsLocation","default")))},group:"1_config",order:20});S.appendMenuItem(w.EditorActionsPositionSubmenu,{command:{id:RI.ID,title:c(2972,"Hidden"),toggled:I.equals("config.workbench.editor.editorActionsLocation","hidden")},group:"1_config",order:30});S.appendMenuItem(w.EditorTabsBarContext,{command:{id:LI.ID,title:c(2973,"Configure Tabs")},group:"9_configure",order:10});S.appendMenuItem(w.EditorTitleContext,{command:{id:nn,title:c(2963,"Close")},group:"1_close",order:10});S.appendMenuItem(w.EditorTitleContext,{command:{id:fw,title:c(2974,"Close Others"),precondition:UD.notEqualsTo("1")},group:"1_close",order:20});S.appendMenuItem(w.EditorTitleContext,{command:{id:mw,title:c(2975,"Close to the Right"),precondition:I.and(Ow.toNegated(),Wd.negate())},group:"1_close",order:30,when:Tr});S.appendMenuItem(w.EditorTitleContext,{command:{id:Vu,title:c(2976,"Close Saved")},group:"1_close",order:40});S.appendMenuItem(w.EditorTitleContext,{command:{id:Ar,title:c(2977,"Close All")},group:"1_close",order:50});S.appendMenuItem(w.EditorTitleContext,{command:{id:ww,title:c(2978,"Reopen Editor With...")},group:"1_open",order:10,when:Nw});S.appendMenuItem(w.EditorTitleContext,{command:{id:yw,title:c(2979,"Keep Open"),precondition:HD.toNegated()},group:"3_preview",order:10,when:I.has("config.workbench.editor.enablePreview")});S.appendMenuItem(w.EditorTitleContext,{command:{id:vw,title:c(2980,"Pin")},group:"3_preview",order:20,when:cn.toNegated()});S.appendMenuItem(w.EditorTitleContext,{command:{id:Od,title:c(2981,"Unpin")},group:"3_preview",order:20,when:cn});S.appendMenuItem(w.EditorTitleContext,{command:{id:Pd,title:c(2957,"Split Up")},group:"5_split",order:10});S.appendMenuItem(w.EditorTitleContext,{command:{id:Ir,title:c(2958,"Split Down")},group:"5_split",order:20});S.appendMenuItem(w.EditorTitleContext,{command:{id:Md,title:c(2959,"Split Left")},group:"5_split",order:30});S.appendMenuItem(w.EditorTitleContext,{command:{id:Dr,title:c(2960,"Split Right")},group:"5_split",order:40});S.appendMenuItem(w.EditorTitleContext,{command:{id:bw,title:c(2982,"Split in Group"),precondition:Wd.negate()},group:"6_split_in_group",order:10,when:Bw});S.appendMenuItem(w.EditorTitleContext,{command:{id:Cw,title:c(2983,"Join in Group"),precondition:Wd.negate()},group:"6_split_in_group",order:10,when:xr});S.appendMenuItem(w.EditorTitleContext,{command:{id:Sw,title:c(2984,"Move into New Window")},group:"7_new_window",order:10});S.appendMenuItem(w.EditorTitleContext,{command:{id:_w,title:c(2985,"Copy into New Window")},group:"7_new_window",order:20});S.appendMenuItem(w.EditorTitleContext,{submenu:w.EditorTitleContextShare,title:c(2986,"Share"),group:"11_share",order:-1,when:Wd.negate()});S.appendMenuItem(w.EditorTitle,{command:{id:VI,title:c(2987,"Inline View"),toggled:I.equals("config.diffEditor.renderSideBySide",!1)},group:"1_diff",order:10,when:I.has("isInDiffEditor")});S.appendMenuItem(w.EditorTitle,{command:{id:PI,title:c(2988,"Show Opened Editors")},group:"3_open",order:10});S.appendMenuItem(w.EditorTitle,{command:{id:Ar,title:c(2977,"Close All")},group:"5_close",order:10});S.appendMenuItem(w.EditorTitle,{command:{id:Vu,title:c(2976,"Close Saved")},group:"5_close",order:20});S.appendMenuItem(w.EditorTitle,{command:{id:MI,title:c(2989,"Enable Preview Editors"),toggled:I.has("config.workbench.editor.enablePreview")},group:"7_settings",order:10});S.appendMenuItem(w.EditorTitle,{command:{id:Ew,title:c(2990,"Maximize Group")},group:"8_group_operations",order:5,when:I.and(Bu.negate(),Nu)});S.appendMenuItem(w.EditorTitle,{command:{id:Ew,title:c(2991,"Unmaximize Group")},group:"8_group_operations",order:5,when:Bu});S.appendMenuItem(w.EditorTitle,{command:{id:gw,title:c(2992,"Lock Group"),toggled:dn},group:"8_group_operations",order:10,when:an.toNegated()});S.appendMenuItem(w.EditorTitle,{command:{id:OI.ID,title:c(2993,"Configure Editors")},group:"9_configure",order:10});function ci(a,e,t,i,s){const o={command:{id:a.id,title:a.title,icon:a.icon,toggled:a.toggled,precondition:s},group:"navigation",when:e,order:t};i&&(o.alt={id:i.id,title:i.title,icon:i.icon}),S.appendMenuItem(w.EditorTitle,o)}const Qu=1e5,ln=1e6;ci({id:Iw,title:c(2994,"Split Editor Right"),icon:k.splitHorizontal},I.not("splitEditorsVertically"),Qu,{id:Ir,title:c(2995,"Split Editor Down"),icon:k.splitVertical});ci({id:Iw,title:c(2995,"Split Editor Down"),icon:k.splitVertical},I.has("splitEditorsVertically"),Qu,{id:Dr,title:c(2994,"Split Editor Right"),icon:k.splitHorizontal});ci({id:GI,title:c(2996,"Toggle Layout"),icon:k.editorLayout},xr,Qu-1);ci({id:nn,title:c(2963,"Close"),icon:k.close},I.and(Tr.toNegated(),Gd.toNegated(),cn.toNegated()),ln,{id:Ar,title:c(2977,"Close All"),icon:k.closeAll});ci({id:nn,title:c(2963,"Close"),icon:k.closeDirty},I.and(Tr.toNegated(),Gd,cn.toNegated()),ln,{id:Ar,title:c(2977,"Close All"),icon:k.closeAll});ci({id:Od,title:c(2981,"Unpin"),icon:k.pinned},I.and(Tr.toNegated(),Gd.toNegated(),cn),ln,{id:nn,title:c(2963,"Close"),icon:k.close});ci({id:Od,title:c(2981,"Unpin"),icon:k.pinnedDirty},I.and(Tr.toNegated(),Gd,cn),ln,{id:nn,title:c(2963,"Close"),icon:k.close});ci({id:hw,title:c(2997,"Lock Group"),icon:k.unlock},I.and(an,dn.toNegated()),ln-1);ci({id:uw,title:c(2998,"Unlock Group"),icon:k.lock,toggled:I.true()},dn,ln-1);const mk=he("diff-editor-previous-change",k.arrowUp,c(2999,"Icon for the previous change action in the diff editor."));ci({id:UI,title:c(3e3,"Previous Change"),icon:mk},no,10,void 0,Jn.hasChanges);const wk=he("diff-editor-next-change",k.arrowDown,c(3001,"Icon for the next change action in the diff editor."));ci({id:HI,title:c(3002,"Next Change"),icon:wk},no,11,void 0,Jn.hasChanges);ci({id:zI,title:c(3003,"Swap Left and Right Side"),icon:k.arrowSwap},I.and(no,zD),15,void 0,void 0);const yk=he("diff-editor-toggle-whitespace",k.whitespace,c(3004,"Icon for the toggle whitespace action in the diff editor."));S.appendMenuItem(w.EditorTitle,{command:{id:NI,title:c(3005,"Show Leading/Trailing Whitespace Differences"),icon:yk,precondition:no,toggled:I.equals("config.diffEditor.ignoreTrimWhitespace",!1)},group:"navigation",when:no,order:20});S.appendMenuItem(w.CommandPalette,{command:{id:yw,title:x(3006,"Keep Editor"),category:xe.View},when:I.has("config.workbench.editor.enablePreview")});S.appendMenuItem(w.CommandPalette,{command:{id:vw,title:x(3007,"Pin Editor"),category:xe.View}});S.appendMenuItem(w.CommandPalette,{command:{id:Od,title:x(3008,"Unpin Editor"),category:xe.View}});S.appendMenuItem(w.CommandPalette,{command:{id:nn,title:x(3009,"Close Editor"),category:xe.View}});S.appendMenuItem(w.CommandPalette,{command:{id:BI,title:x(3010,"Close Pinned Editor"),category:xe.View}});S.appendMenuItem(w.CommandPalette,{command:{id:Ar,title:x(3011,"Close All Editors in Group"),category:xe.View}});S.appendMenuItem(w.CommandPalette,{command:{id:Vu,title:x(3012,"Close Saved Editors in Group"),category:xe.View}});S.appendMenuItem(w.CommandPalette,{command:{id:fw,title:x(3013,"Close Other Editors in Group"),category:xe.View}});S.appendMenuItem(w.CommandPalette,{command:{id:mw,title:x(3014,"Close Editors to the Right in Group"),category:xe.View},when:Ow.toNegated()});S.appendMenuItem(w.CommandPalette,{command:{id:FI,title:x(3015,"Close Editor Group"),category:xe.View},when:Si});S.appendMenuItem(w.CommandPalette,{command:{id:ww,title:x(2978,"Reopen Editor With..."),category:xe.View},when:Nw});S.appendMenuItem(w.MenubarRecentMenu,{group:"1_editor",command:{id:ew.ID,title:c(3016,"&&Reopen Closed Editor"),precondition:I.has("canReopenClosedEditor")},order:1});S.appendMenuItem(w.MenubarRecentMenu,{group:"z_clear",command:{id:tw.ID,title:c(3017,"&&Clear Recently Opened...")},order:1});S.appendMenuItem(w.MenubarFileMenu,{title:c(3018,"Share"),submenu:w.MenubarShare,group:"45_share",order:1});S.appendMenuItem(w.MenubarViewMenu,{group:"2_appearance",title:c(3019,"Editor &&Layout"),submenu:w.MenubarLayoutMenu,order:2});S.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:Pd,title:{...x(3020,"Split Up"),mnemonicTitle:c(3021,"Split &&Up")}},order:1});S.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:Ir,title:{...x(3022,"Split Down"),mnemonicTitle:c(3023,"Split &&Down")}},order:2});S.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:Md,title:{...x(3024,"Split Left"),mnemonicTitle:c(3025,"Split &&Left")}},order:3});S.appendMenuItem(w.MenubarLayoutMenu,{group:"1_split",command:{id:Dr,title:{...x(3026,"Split Right"),mnemonicTitle:c(3027,"Split &&Right")}},order:4});S.appendMenuItem(w.MenubarLayoutMenu,{group:"2_split_in_group",command:{id:bw,title:{...x(3028,"Split in Group"),mnemonicTitle:c(3029,"Split in &&Group")}},when:Bw,order:1});S.appendMenuItem(w.MenubarLayoutMenu,{group:"2_split_in_group",command:{id:Cw,title:{...x(3030,"Join in Group"),mnemonicTitle:c(3031,"Join in &&Group")}},when:xr,order:1});S.appendMenuItem(w.MenubarLayoutMenu,{group:"3_new_window",command:{id:Sw,title:{...x(3032,"Move Editor into New Window"),mnemonicTitle:c(3033,"&&Move Editor into New Window")}},order:1});S.appendMenuItem(w.MenubarLayoutMenu,{group:"3_new_window",command:{id:_w,title:{...x(3034,"Copy Editor into New Window"),mnemonicTitle:c(3035,"&&Copy Editor into New Window")}},order:2});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:iw.ID,title:{...x(3036,"Single"),mnemonicTitle:c(3037,"&&Single")}},order:1});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:sw.ID,title:{...x(3038,"Two Columns"),mnemonicTitle:c(3039,"&&Two Columns")}},order:3});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:ow.ID,title:{...x(3040,"Three Columns"),mnemonicTitle:c(3041,"T&&hree Columns")}},order:4});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:nw.ID,title:{...x(3042,"Two Rows"),mnemonicTitle:c(3043,"T&&wo Rows")}},order:5});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:rw.ID,title:{...x(3044,"Three Rows"),mnemonicTitle:c(3045,"Three &&Rows")}},order:6});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:aw.ID,title:{...x(3046,"Grid (2x2)"),mnemonicTitle:c(3047,"&&Grid (2x2)")}},order:7});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:dw.ID,title:{...x(3048,"Two Rows Right"),mnemonicTitle:c(3049,"Two R&&ows Right")}},order:8});S.appendMenuItem(w.MenubarLayoutMenu,{group:"4_layouts",command:{id:cw.ID,title:{...x(3050,"Two Columns Bottom"),mnemonicTitle:c(3051,"Two &&Columns Bottom")}},order:9});S.appendMenuItem(w.MenubarGoMenu,{group:"1_history_nav",command:{id:"workbench.action.navigateToLastEditLocation",title:c(3052,"&&Last Edit Location"),precondition:I.has("canNavigateToLastEditLocation")},order:3});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"1_sideBySide",command:{id:KI,title:c(3053,"&&First Side in Editor")},when:I.or(xr,no),order:1});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"1_sideBySide",command:{id:WI,title:c(3054,"&&Second Side in Editor")},when:I.or(xr,no),order:2});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"2_any",command:{id:"workbench.action.nextEditor",title:c(3055,"&&Next Editor")},order:1});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"2_any",command:{id:"workbench.action.previousEditor",title:c(3056,"&&Previous Editor")},order:2});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"3_any_used",command:{id:"workbench.action.openNextRecentlyUsedEditor",title:c(3057,"&&Next Used Editor")},order:1});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"3_any_used",command:{id:"workbench.action.openPreviousRecentlyUsedEditor",title:c(3058,"&&Previous Used Editor")},order:2});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"4_group",command:{id:"workbench.action.nextEditorInGroup",title:c(3059,"&&Next Editor in Group")},order:1});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"4_group",command:{id:"workbench.action.previousEditorInGroup",title:c(3060,"&&Previous Editor in Group")},order:2});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"5_group_used",command:{id:"workbench.action.openNextRecentlyUsedEditorInGroup",title:c(3061,"&&Next Used Editor in Group")},order:1});S.appendMenuItem(w.MenubarSwitchEditorMenu,{group:"5_group_used",command:{id:"workbench.action.openPreviousRecentlyUsedEditorInGroup",title:c(3062,"&&Previous Used Editor in Group")},order:2});S.appendMenuItem(w.MenubarGoMenu,{group:"2_editor_nav",title:c(3063,"Switch &&Editor"),submenu:w.MenubarSwitchEditorMenu,order:1});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusFirstEditorGroup",title:c(3064,"Group &&1")},order:1});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusSecondEditorGroup",title:c(3065,"Group &&2")},order:2});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusThirdEditorGroup",title:c(3066,"Group &&3"),precondition:Si},order:3});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusFourthEditorGroup",title:c(3067,"Group &&4"),precondition:Si},order:4});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"1_focus_index",command:{id:"workbench.action.focusFifthEditorGroup",title:c(3068,"Group &&5"),precondition:Si},order:5});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"2_next_prev",command:{id:"workbench.action.focusNextGroup",title:c(3069,"&&Next Group"),precondition:Si},order:1});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"2_next_prev",command:{id:"workbench.action.focusPreviousGroup",title:c(3070,"&&Previous Group"),precondition:Si},order:2});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusLeftGroup",title:c(3071,"Group &&Left"),precondition:Si},order:1});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusRightGroup",title:c(3072,"Group &&Right"),precondition:Si},order:2});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusAboveGroup",title:c(3073,"Group &&Above"),precondition:Si},order:3});S.appendMenuItem(w.MenubarSwitchGroupMenu,{group:"3_directional",command:{id:"workbench.action.focusBelowGroup",title:c(3074,"Group &&Below"),precondition:Si},order:4});S.appendMenuItem(w.MenubarGoMenu,{group:"2_editor_nav",title:c(3075,"Switch &&Group"),submenu:w.MenubarSwitchGroupMenu,order:2});DC(tA);let lr=class{static{this.ID=Wo.typeId}constructor(e){this._webviewWorkbenchService=e}canSerialize(e){return this._webviewWorkbenchService.shouldPersist(e)}serialize(e){if(!this.canSerialize(e))return;const t=this.toJson(e);try{return JSON.stringify(t)}catch{return}}deserialize(e,t){const i=this.fromJson(JSON.parse(t));return this._webviewWorkbenchService.openRevivedWebview({webviewInitInfo:{providedViewType:i.providedId,origin:i.origin,title:i.title,options:i.webviewOptions,contentOptions:i.contentOptions,extension:i.extension},viewType:i.viewType,title:i.title,iconPath:i.iconPath,state:i.state,group:i.group})}fromJson(e){return{...e,extension:Oy(e.extensionId,e.extensionLocation),iconPath:vk(e.iconPath),state:bk(e.state),webviewOptions:e.options,contentOptions:Ny(e.options)}}toJson(e){return{origin:e.webview.origin,viewType:e.viewType,providedId:e.providedId,title:e.getName(),options:{...e.webview.options,...e.webview.contentOptions},extensionLocation:e.extension?.location,extensionId:e.extension?.id.value,state:e.webview.state,iconPath:e.iconPath?{light:e.iconPath.light,dark:e.iconPath.dark}:void 0,group:e.group}}};lr=D([u(0,Pu)],lr);function Oy(a,e){if(!a)return;const t=za(e);if(t)return{id:new em(a),location:t}}function vk(a){if(!a)return;const e=za(a.light),t=za(a.dark);return e&&t?{light:e,dark:t}:void 0}function za(a){if(a)try{return typeof a=="string"?U.parse(a):U.from(a)}catch{return}}function bk(a){return typeof a=="string"?a:void 0}function Ny(a){return{...a,localResourceRoots:a.localResourceRoots?.map(e=>za(e))}}let $a=class extends lr{static{this.ID=Mt.typeId}constructor(e,t,i){super(e),this._instantiationService=t,this._webviewService=i}serialize(e){const t=e.isDirty(),i={...this.toJson(e),editorResource:e.resource.toJSON(),dirty:t,backupId:t?e.backupId:void 0};try{return JSON.stringify(i)}catch{return}}fromJson(e){return{...super.fromJson(e),editorResource:U.from(e.editorResource),dirty:e.dirty}}deserialize(e,t){const i=this.fromJson(JSON.parse(t)),s=By(this._webviewService,i),o=this._instantiationService.createInstance(Mt,{resource:i.editorResource,viewType:i.viewType},s,{startsDirty:i.dirty,backupId:i.backupId});return typeof i.group=="number"&&o.updateGroup(i.group),o}};$a=D([u(0,Pu),u(1,F),u(2,lo)],$a);function By(a,e){const t=a.createWebviewOverlay({providedViewType:e.viewType,origin:e.origin,title:void 0,options:{purpose:jm.CustomEditor,enableFindWidget:e.webviewOptions.enableFindWidget,retainContextWhenHidden:e.webviewOptions.retainContextWhenHidden},contentOptions:e.contentOptions,extension:e.extension});return t.state=e.state,t}let ja=class extends R{static{this.ID="workbench.contrib.complexCustomWorkingCopyEditorHandler"}constructor(e,t,i,s,o){super(),this._instantiationService=e,this._workingCopyBackupService=i,this._webviewService=s,this._register(t.registerHandler(this))}handles(e){return e.resource.scheme===pe.vscodeCustomEditor}isOpen(e,t){if(!this.handles(e))return!1;if(e.resource.authority==="jupyter-notebook-ipynb"&&t instanceof $I)try{const i=JSON.parse(e.resource.query),s=U.from(i);return dt(s,t.resource)}catch{return!1}if(!(t instanceof Mt)||e.resource.authority!==t.viewType.replace(/[^a-z0-9\-_]/gi,"-").toLowerCase())return!1;try{const i=JSON.parse(e.resource.query),s=U.from(i);return dt(s,t.resource)}catch{return!1}}async createEditor(e){const t=await this._workingCopyBackupService.resolve(e);if(!t?.meta)throw new Error(`No backup found for custom editor: ${e.resource}`);const i=t.meta,s=Oy(i.extension?.id,i.extension?.location),o=By(this._webviewService,{viewType:i.viewType,origin:i.webview.origin,webviewOptions:i.webview.options,contentOptions:Ny(i.webview.options),state:i.webview.state,extension:s}),n=this._instantiationService.createInstance(Mt,{resource:U.revive(i.editorResource),viewType:i.viewType},o,{backupId:i.backupId});return n.updateGroup(0),n}};ja=D([u(0,F),u(1,Vd),u(2,$D),u(3,lo),u(4,Dw)],ja);H.as(ct.EditorPane).registerEditorPane(vi.create(Zn,Zn.ID,"Webview Editor"),[new ee(Mt)]);H.as(ct.EditorFactory).registerEditorSerializer($a.ID,$a);yt(ja.ID,ja,vt.BlockStartup);const Xd=I.and(I.equals("activeEditor",Zn.ID),Jn.focus.toNegated());class qa extends X{static{this.ID="editor.action.webvieweditor.showFind"}static{this.LABEL=c(11475,"Show find")}constructor(){super({id:qa.ID,title:qa.LABEL,keybinding:{when:I.and(Xd,km),primary:N.CtrlCmd|y.KeyF,weight:W.EditorContrib}})}run(e){Qd(e)?.showFind()}}class Ya extends X{static{this.ID="editor.action.webvieweditor.hideFind"}static{this.LABEL=c(11476,"Stop find")}constructor(){super({id:Ya.ID,title:Ya.LABEL,keybinding:{when:I.and(Xd,xm),primary:y.Escape,weight:W.EditorContrib}})}run(e){Qd(e)?.hideFind()}}class Ja extends X{static{this.ID="editor.action.webvieweditor.findNext"}static{this.LABEL=c(11477,"Find next")}constructor(){super({id:Ja.ID,title:Ja.LABEL,keybinding:{when:I.and(Xd,ku),primary:y.Enter,weight:W.EditorContrib}})}run(e){Qd(e)?.runFindAction(!1)}}class Za extends X{static{this.ID="editor.action.webvieweditor.findPrevious"}static{this.LABEL=c(11478,"Find previous")}constructor(){super({id:Za.ID,title:Za.LABEL,keybinding:{when:I.and(Xd,ku),primary:N.Shift|y.Enter,weight:W.EditorContrib}})}run(e){Qd(e)?.runFindAction(!0)}}class Xa extends X{static{this.ID="workbench.action.webview.reloadWebviewAction"}static{this.LABEL=x(11479,"Reload Webviews")}constructor(){super({id:Xa.ID,title:Xa.LABEL,category:xe.Developer,menu:[{id:w.CommandPalette}]})}async run(e){const t=e.get(lo);for(const i of t.webviews)i.reload()}}function Qd(a){const t=a.get(Q).activeEditor;return t instanceof Wo?t.webview:void 0}H.as(ct.EditorPane).registerEditorPane(vi.create(Zn,Zn.ID,c(11481,"webview editor")),[new ee(Wo)]);let Qa=class extends R{static{this.ID="workbench.contrib.webviewPanel"}constructor(e,t){super(),this.editorGroupService=t,this._register(e.onWillOpenEditor(i=>{const s=t.getGroup(i.groupId);s&&this.onEditorOpening(i.editor,s)}))}onEditorOpening(e,t){if(!(e instanceof Wo)||e.typeId!==Wo.typeId||t.contains(e))return;let i;const s=this.editorGroupService.groups;for(const o of s)if(o.contains(e)){i=o;break}i&&i.closeEditor(e)}};Qa=D([u(0,Q),u(1,Je)],Qa);yt(Qa.ID,Qa,vt.BlockStartup);H.as(ct.EditorFactory).registerEditorSerializer(lr.ID,lr);C(qa);C(Ya);C(Ja);C(Za);C(Xa);let cf=class extends R{constructor(e,t,i,s,o){super(),this.configurationService=t,this.logService=i,this.preferencesService=s,this.quickInputService=o,this._providers=new Kf,this._register(e.registerExternalOpener(this))}registerExternalOpenerProvider(e){return{dispose:this._providers.push(e)}}async getOpeners(e,t,i,s){const o=await this.getAllOpenersForUri(e);if(o.size===0)return[];if(i.preferredOpenerId){if(i.preferredOpenerId===fc)return[];const l=o.get(i.preferredOpenerId);if(l)return[l]}const n=this.getConfiguredOpenerForUri(o,e);if(n)return n===fc?[]:[n];const r=[];if(await Promise.all(Array.from(o.values()).map(async l=>{let h;try{h=await l.canOpen(i.sourceUri,s)}catch(p){this.logService.error(p);return}switch(h){case un.Option:case un.Default:case un.Preferred:r.push({opener:l,priority:h});break}})),r.length===0)return[];const d=r.filter(l=>l.priority===un.Preferred).at(0);return d?[d.opener]:!t&&r.every(l=>l.priority===un.Option)?[]:r.map(l=>l.opener)}async openExternal(e,t,i){const s=typeof e=="string"?U.parse(e):e,o=await this.getOpeners(s,!1,t,i);return o.length===0?!1:o.length===1?o[0].openExternalUri(s,t,i):this.showOpenerPrompt(o,s,t,i)}async getOpener(e,t,i){const s=await this.getOpeners(e,!0,t,i);if(s.length>=1)return s[0]}async getAllOpenersForUri(e){const t=new Map;return await Promise.all(AC.map(this._providers,async i=>{for await(const s of i.getOpeners(e))t.set(s.id,s)})),t}getConfiguredOpenerForUri(e,t){const i=this.configurationService.getValue(hg)||{};for(const[s,o]of Object.entries(i))if(TC(t,s)){if(o===fc)return"default";const n=e.get(o);if(n)return n}}async showOpenerPrompt(e,t,i,s){const o=e.map(r=>({label:r.label,opener:r}));o.push({label:Qs?c(6808,"Open in new browser window"):c(6809,"Open in default browser"),opener:void 0},{type:"separator"},{label:c(6810,"Configure default opener..."),opener:"configureDefault"});const n=await this.quickInputService.pick(o,{placeHolder:c(6811,"How would you like to open: {0}",t.toString())});return n?typeof n.opener>"u"?!1:n.opener==="configureDefault"?(await this.preferencesService.openUserSettings({jsonEditor:!0,revealSetting:{key:hg,edit:!0}}),!0):n.opener.openExternalUri(t,i,s):!0}};cf=D([u(0,Tt),u(1,ie),u(2,Ue),u(3,Kd),u(4,Jt)],cf);H.as(xs.Configuration).registerConfiguration(jI);const Ck=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var Qt;Pe(Ck);class lf{constructor(e,t){this.combined=e,this.dedicated=t}isEqual(e){return Js(this.combined,e.combined)&&Js(this.dedicated,e.dedicated)}}let qh=class{constructor(e,t){this._storageService=e,this._key=t}get value(){return this._storageService.getNumber(this._key,G.PROFILE,0)}increment(){const e=this.value+1;return this._storageService.store(this._key,e,G.PROFILE,Re.MACHINE),e}};qh=D([u(0,ce)],qh);let ed=class extends R{static{this.Id="status.languageStatus"}constructor(e){super(),this.editorGroupService=e;for(const t of e.parts)this.createLanguageStatus(t);this._register(e.onDidCreateAuxiliaryEditorPart(t=>this.createLanguageStatus(t)))}createLanguageStatus(e){const t=new O;V.once(e.onWillDispose)(()=>t.dispose());const i=this.editorGroupService.getScopedInstantiationService(e);t.add(i.createInstance(Yh))}};ed=D([u(0,Je)],ed);let Yh=class{static{Qt=this}static{this._id="status.languageStatus"}static{this._keyDedicatedItems="languageStatus.dedicated"}constructor(e,t,i,s,o,n){this._languageStatusService=e,this._statusBarService=t,this._editorService=i,this._hoverService=s,this._openerService=o,this._storageService=n,this._disposables=new O,this._dedicated=new Set,this._dedicatedEntries=new Map,this._renderDisposables=new O,this._combinedEntryTooltip=document.createElement("div"),n.onDidChangeValue(G.PROFILE,Qt._keyDedicatedItems,this._disposables)(this._handleStorageChange,this,this._disposables),this._restoreState(),this._interactionCounter=new qh(n,"languageStatus.interactCount"),e.onDidChange(this._update,this,this._disposables),i.onDidActiveEditorChange(this._update,this,this._disposables),this._update(),t.onDidChangeEntryVisibility(r=>{!r.visible&&this._dedicated.has(r.id)&&(this._dedicated.delete(r.id),this._update(),this._storeState())},void 0,this._disposables)}dispose(){this._disposables.dispose(),this._combinedEntry?.dispose(),qe(this._dedicatedEntries.values()),this._renderDisposables.dispose()}_handleStorageChange(){this._restoreState(),this._update()}_restoreState(){const e=this._storageService.get(Qt._keyDedicatedItems,G.PROFILE,"[]");try{const t=JSON.parse(e);this._dedicated=new Set(t)}catch{this._dedicated.clear()}}_storeState(){if(this._dedicated.size===0)this._storageService.remove(Qt._keyDedicatedItems,G.PROFILE);else{const e=JSON.stringify(Array.from(this._dedicated.keys()));this._storageService.store(Qt._keyDedicatedItems,e,G.PROFILE,Re.USER)}}_createViewModel(e){if(!e?.hasModel())return new lf([],[]);const t=this._languageStatusService.getLanguageStatus(e.getModel()),i=[],s=[];for(const o of t)this._dedicated.has(o.id)&&s.push(o),i.push(o);return new lf(i,s)}_update(){const e=gi(this._editorService.activeTextEditorControl),t=this._createViewModel(e);if(this._model?.isEqual(t))return;if(this._renderDisposables.clear(),this._model=t,e?.onDidChangeModelLanguage(this._update,this,this._renderDisposables),t.combined.length===0)this._combinedEntry?.dispose(),this._combinedEntry=void 0;else{const[s]=t.combined,o=s.severity>=_e.Warning,n=Qt._severityToComboCodicon(s.severity);let r=!1;const d=[];for(const m of t.combined){const v=t.dedicated.includes(m);this._renderStatus(this._combinedEntryTooltip,m,o,v,this._renderDisposables),d.push(Qt._accessibilityInformation(m).label),r=r||!v&&m.busy}const l={name:c(7426,"Editor Language Status"),ariaLabel:c(7427,"Editor Language Status: {0}",d.join(", next: ")),tooltip:this._combinedEntryTooltip,command:qI,text:r?"$(loading~spin)":n};this._combinedEntry?this._combinedEntry.update(l):this._combinedEntry=this._statusBarService.addEntry(l,Qt._id,et.RIGHT,{location:{id:"status.editor.mode",priority:100.1},alignment:et.LEFT,compact:!0});const h=this._interactionCounter.value>=3,p=St(e?.getContainerDomNode()),f=p.document.querySelector(".monaco-workbench .statusbar DIV#status\\.languageStatus A>SPAN.codicon"),g=p.document.querySelector(".monaco-workbench .statusbar DIV#status\\.languageStatus");if(No(f)&&g){const m="wiggle",v="flash";r?(f.classList.remove(m),g.classList.remove(v)):(f.classList.toggle(m,o||!h),this._renderDisposables.add(Y(f,"animationend",b=>f.classList.remove(m))),g.classList.toggle(v,o),this._renderDisposables.add(Y(g,"animationend",b=>g.classList.remove(v))))}if(!h){const m=p.document.querySelector(".monaco-workbench .context-view");if(No(m)){const v=new MutationObserver(()=>{p.document.contains(this._combinedEntryTooltip)&&(this._interactionCounter.increment(),v.disconnect())});v.observe(m,{childList:!0,subtree:!0}),this._renderDisposables.add(ae(()=>v.disconnect()))}}}const i=new Map;for(const s of t.dedicated){const o=Qt._asStatusbarEntry(s);let n=this._dedicatedEntries.get(s.id);n?(n.update(o),this._dedicatedEntries.delete(s.id)):n=this._statusBarService.addEntry(o,s.id,et.RIGHT,{location:{id:"status.editor.mode",priority:100.1},alignment:et.RIGHT}),i.set(s.id,n)}qe(this._dedicatedEntries.values()),this._dedicatedEntries=i}_renderStatus(e,t,i,s,o){const n=document.createElement("div");n.classList.add("hover-language-status"),e.appendChild(n),o.add(ae(()=>n.remove()));const r=document.createElement("div");r.classList.add("severity",`sev${t.severity}`),r.classList.toggle("show",i);const d=Qt._severityToSingleCodicon(t.severity);ge(r,...Pi(d)),n.appendChild(r);const l=document.createElement("div");l.classList.add("element"),n.appendChild(l);const h=document.createElement("div");h.classList.add("left"),l.appendChild(h);const p=typeof t.label=="string"?t.label:t.label.value;ge(h,...Pi(hf(p,t.busy))),this._renderTextPlus(h,t.detail,o);const f=document.createElement("div");f.classList.add("right"),l.appendChild(f);const{command:g}=t;g&&o.add(new ug(f,{label:g.title,title:g.tooltip,href:U.from({scheme:"command",path:g.id,query:g.arguments&&JSON.stringify(g.arguments)}).toString()},{hoverDelegate:Gp},this._hoverService,this._openerService));const m=new Qo(f,{hoverDelegate:Gp}),v=s?c(7428,"Remove from Status Bar"):c(7429,"Add to Status Bar");m.setAriaLabel(v),o.add(m);let b;return s?b=new _t("unpin",v,Ce.asClassName(k.pinned),!0,()=>{this._dedicated.delete(t.id),this._statusBarService.updateEntryVisibility(t.id,!1),this._update(),this._storeState()}):b=new _t("pin",v,Ce.asClassName(k.pin),!0,()=>{this._dedicated.add(t.id),this._statusBarService.updateEntryVisibility(t.id,!0),this._update(),this._storeState()}),m.push(b,{icon:!0,label:!1}),o.add(b),n}static _severityToComboCodicon(e){switch(e){case _e.Error:return"$(bracket-error)";case _e.Warning:return"$(bracket-dot)";default:return"$(bracket)"}}static _severityToSingleCodicon(e){switch(e){case _e.Error:return"$(error)";case _e.Warning:return"$(info)";default:return"$(check)"}}_renderTextPlus(e,t,i){let s=!1;for(const o of ha(t).nodes)if(s||(ge(e,B("span.separator")),s=!0),typeof o=="string"){const n=Pi(o);ge(e,...n)}else i.add(new ug(e,o,void 0,this._hoverService,this._openerService))}static _accessibilityInformation(e){if(e.accessibilityInfo)return e.accessibilityInfo;const t=typeof e.label=="string"?e.label:e.label.value;return e.detail?{label:c(7430,"{0}, {1}",t,e.detail)}:{label:c(7431,"{0}",t)}}static _asStatusbarEntry(e){let t;e.severity===_e.Warning?t="warning":e.severity===_e.Error&&(t="error");const i=typeof e.label=="string"?e.label:e.label.shortValue;return{name:c(7432,"{0} (Language Status)",e.name),text:hf(i,e.busy),ariaLabel:Qt._accessibilityInformation(e).label,role:e.accessibilityInfo?.role,tooltip:e.command?.tooltip||new ts(e.detail,{isTrusted:!0,supportThemeIcons:!0}),kind:t,command:e.command}}};Yh=Qt=D([u(0,Aw),u(1,Rs),u(2,Q),u(3,At),u(4,Tt),u(5,ce)],Yh);class Sk extends X{constructor(){super({id:"editor.inlayHints.Reset",title:x(7433,"Reset Language Status Interaction Counter"),category:xe.View,f1:!0})}run(e){e.get(ce).remove("languageStatus.interactCount",G.PROFILE)}}function hf(a,e){return xC([a!==""&&a,e&&"$(loading~spin)"],"  ")}yt(ed.Id,ed,vt.AfterRestored);C(Sk);const _k=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));le("mergeEditor.change.background","#9bb95533",c(7843,"The background color for changes."));le("mergeEditor.change.word.background",{dark:"#9ccc2c33",light:"#9ccc2c66",hcDark:"#9ccc2c33",hcLight:"#9ccc2c66"},c(7844,"The background color for word changes."));le("mergeEditor.changeBase.background",{dark:"#4B1818FF",light:"#FFCCCCFF",hcDark:"#4B1818FF",hcLight:"#FFCCCCFF"},c(7845,"The background color for changes in base."));le("mergeEditor.changeBase.word.background",{dark:"#6F1313FF",light:"#FFA3A3FF",hcDark:"#6F1313FF",hcLight:"#FFA3A3FF"},c(7846,"The background color for word changes in base."));le("mergeEditor.conflict.unhandledUnfocused.border",{dark:"#ffa6007a",light:"#ffa600FF",hcDark:"#ffa6007a",hcLight:"#ffa6007a"},c(7847,"The border color of unhandled unfocused conflicts."));le("mergeEditor.conflict.unhandledFocused.border","#ffa600",c(7848,"The border color of unhandled focused conflicts."));le("mergeEditor.conflict.handledUnfocused.border","#86868649",c(7849,"The border color of handled unfocused conflicts."));le("mergeEditor.conflict.handledFocused.border","#c1c1c1cc",c(7850,"The border color of handled focused conflicts."));const $o=le("mergeEditor.conflict.handled.minimapOverViewRuler","#adaca8ee",c(7851,"The foreground color for changes in input 1.")),jo=le("mergeEditor.conflict.unhandled.minimapOverViewRuler","#fcba03FF",c(7852,"The foreground color for changes in input 1."));le("mergeEditor.conflictingLines.background","#ffea0047",c(7853,'The background of the "Conflicting Lines" text.'));const Fy=.4;le("mergeEditor.conflict.input1.background",so(kC,Fy),c(7854,"The background color of decorations in input 1."));le("mergeEditor.conflict.input2.background",so(RC,Fy),c(7855,"The background color of decorations in input 2."));class ep extends R{constructor(e,t,i){super(),this._editor=e,this._domNode=t,this.itemProvider=i,this.scrollTop=Ln(this,this._editor.onDidScrollChange,n=>this._editor.getScrollTop()),this.isScrollTopZero=this.scrollTop.map(n=>n===0),this.modelAttached=Ln(this,this._editor.onDidChangeModel,n=>this._editor.hasModel()),this.editorOnDidChangeViewZones=Up("onDidChangeViewZones",this._editor.onDidChangeViewZones),this.editorOnDidContentSizeChange=Up("onDidContentSizeChange",this._editor.onDidContentSizeChange),this.domNodeSizeChanged=LC("domNodeSizeChanged"),this.views=new Map,this._domNode.className="gutter monaco-editor";const s=this._domNode.appendChild(ht("div.scroll-decoration",{role:"presentation",ariaHidden:"true",style:{width:"100%"}}).root),o=new ResizeObserver(()=>{Ae(n=>{this.domNodeSizeChanged.trigger(n)})});o.observe(this._domNode),this._register(ae(()=>o.disconnect())),this._register(yi(n=>{s.className=this.isScrollTopZero.read(n)?"":"scroll-decoration"})),this._register(yi(n=>this.render(n)))}dispose(){super.dispose(),Mi(this._domNode)}render(e){if(!this.modelAttached.read(e))return;this.domNodeSizeChanged.read(e),this.editorOnDidChangeViewZones.read(e),this.editorOnDidContentSizeChange.read(e);const t=this.scrollTop.read(e),i=this._editor.getVisibleRanges(),s=new Set(this.views.keys());if(i.length>0){const o=i[0],n=new Nd(o.startLineNumber,o.endLineNumber-o.startLineNumber).deltaEnd(1),r=this.itemProvider.getIntersectingGutterItems(n,e);for(const d of r){if(!d.range.touches(n))continue;s.delete(d.id);let l=this.views.get(d.id);if(l)l.gutterItemView.update(d);else{const g=document.createElement("div");this._domNode.appendChild(g);const m=this.itemProvider.createView(d,g);l=new Ek(m,g),this.views.set(d.id,l)}const h=d.range.startLineNumber<=this._editor.getModel().getLineCount()?this._editor.getTopForLineNumber(d.range.startLineNumber,!0)-t:this._editor.getBottomForLineNumber(d.range.startLineNumber-1,!1)-t,f=this._editor.getBottomForLineNumber(d.range.endLineNumberExclusive-1,!0)-t-h;l.domNode.style.top=`${h}px`,l.domNode.style.height=`${f}px`,l.gutterItemView.layout(h,f,0,this._domNode.clientHeight)}}for(const o of s){const n=this.views.get(o);n.gutterItemView.dispose(),n.domNode.remove(),this.views.delete(o)}}}class Ek{constructor(e,t){this.gutterItemView=e,this.domNode=t}}class tp extends R{updateOptions(e){this.editor.updateOptions(e)}constructor(e,t,i){super(),this.instantiationService=e,this.viewModel=t,this.configurationService=i,this.model=this.viewModel.map(s=>s?.model),this.htmlElements=ht("div.code-view",[ht("div.header@header",[ht("span.title@title"),ht("span.description@description"),ht("span.detail@detail"),ht("span.toolbar@toolbar")]),ht("div.container",[ht("div.gutter@gutterDiv"),ht("div@editor")])]),this._onDidViewChange=new E,this.view={element:this.htmlElements.root,minimumWidth:gg.width,maximumWidth:pg.width,minimumHeight:gg.height,maximumHeight:pg.height,onDidChange:this._onDidViewChange.event,layout:(s,o,n,r)=>{YI(this.htmlElements.root,{width:s,height:o,top:n,left:r}),this.editor.layout({width:s-this.htmlElements.gutterDiv.clientWidth,height:o-this.htmlElements.header.clientHeight})}},this.checkboxesVisible=ia("mergeEditor.showCheckboxes",!1,this.configurationService),this.showDeletionMarkers=ia("mergeEditor.showDeletionMarkers",!0,this.configurationService),this.useSimplifiedDecorations=ia("mergeEditor.useSimplifiedDecorations",!1,this.configurationService),this.editor=this.instantiationService.createInstance(Gw,this.htmlElements.editor,{},{contributions:this.getEditorContributions()}),this.isFocused=Ln(this,V.any(this.editor.onDidBlurEditorWidget,this.editor.onDidFocusEditorWidget),()=>this.editor.hasWidgetFocus()),this.cursorPosition=Ln(this,this.editor.onDidChangeCursorPosition,()=>this.editor.getPosition()),this.selection=Ln(this,this.editor.onDidChangeCursorSelection,()=>this.editor.getSelections()),this.cursorLineNumber=this.cursorPosition.map(s=>s?.lineNumber)}getEditorContributions(){return VC.getEditorContributions().filter(e=>e.id!==Uw.ID&&e.id!==JI.ID)}}function ip(a,e){const t=zt(i=>{const s=a.viewModel.read(i);if(!s)return[];const o=s.selectionInBase.read(i);return!o||o.sourceEditor===a?[]:o.rangesInBase.map(n=>e(n,s))});return yi(i=>{const s=t.read(i);s.length!==0&&a.editor.setSelections(s.map(o=>new im(o.startLineNumber,o.startColumn,o.endLineNumber,o.endColumn)))})}let hr=class extends R{constructor(e,t,i){super();const s=i.createInstance(iA,t,e,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:o=>o==="primary"}});this._store.add(s)}};hr=D([u(2,F)],hr);let Jh=class extends tp{constructor(e,t,i){super(t,e,i),this.decorations=zt(this,s=>{const o=this.viewModel.read(s);if(!o)return[];const n=o.model,r=n.base,d=o.activeModifiedBaseRange.read(s),l=o.showNonConflictingChanges.read(s),h=this.showDeletionMarkers.read(s),p=[];for(const f of n.modifiedBaseRanges.read(s)){const g=f.baseRange;if(!g)continue;const m=n.isHandled(f).read(s);if(!f.isConflicting&&m&&!l)continue;const v=["merge-editor-block"];let b=[0,0,0,0];m&&v.push("handled"),f===d&&(v.push("focused"),b=[0,2,0,2]),v.push("base");const A=o.baseShowDiffAgainst.read(s);if(A)for(const K of f.getInputDiffs(A)){const P=K.inputRange.toInclusiveRange();P&&p.push({range:P,options:{className:"merge-editor-diff base",description:"Merge Editor",isWholeLine:!0}});for(const L of K.rangeMappings)(h||!L.inputRange.isEmpty())&&p.push({range:L.inputRange,options:{className:L.inputRange.isEmpty()?"merge-editor-diff-empty-word base":"merge-editor-diff-word base",description:"Merge Editor",showIfCollapsed:!0}})}p.push({range:g.toInclusiveRangeOrEmpty(),options:{showIfCollapsed:!0,blockClassName:v.join(" "),blockPadding:b,blockIsAfterEnd:g.startLineNumber>r.getLineCount(),description:"Merge Editor",minimap:{position:_u.Gutter,color:{id:m?$o:jo}},overviewRuler:f.isConflicting?{position:en.Center,color:{id:m?$o:jo}}:void 0}})}return p}),this._register(ip(this,(s,o)=>s)),this._register(t.createInstance(hr,w.MergeBaseToolbar,this.htmlElements.title)),this._register(Eu((s,o)=>{this.checkboxesVisible.read(s)&&o.add(new ep(this.editor,this.htmlElements.gutterDiv,{getIntersectingGutterItems:(n,r)=>[],createView:(n,r)=>{throw new xd}}))})),this._register(yi(s=>{const o=this.viewModel.read(s);if(!o)return;this.editor.setModel(o.model.base),Mi(this.htmlElements.title,...Pi(c(7874,"Base")));const n=o.baseShowDiffAgainst.read(s);let r;if(n){const d=c(7875,"Comparing with {0}",n===1?o.model.input1.title:o.model.input2.title),l=c(7876,"Differences are highlighted with a background color.");r=ht("span",{title:l},[d]).root}Mi(this.htmlElements.description,...r?[r]:[])})),this._register(Mu(this.editor,this.decorations))}};Jh=D([u(1,F),u(2,ie)],Jh);class Ik extends R{get model(){return this.viewModel.get()?.model}get lockResultWithInputs(){return this.layout.get().kind==="columns"}get lockBaseWithInputs(){return this.layout.get().kind==="mixed"&&!this.layout.get().showBaseAtTop}constructor(e,t,i,s,o,n){super(),this.viewModel=e,this.input1View=t,this.input2View=i,this.baseView=s,this.inputResultView=o,this.layout=n,this.reentrancyBarrier=new ZI,this._isSyncing=!0;const r=PC((d,l)=>{const h=this.baseView.read(d),p=[this.input1View,this.input2View,this.inputResultView,h].filter(Zi),f=(g,m,v)=>{this.reentrancyBarrier.runExclusivelyOrSkip(()=>{if(m){const b=g.editor.getScrollLeft();for(const A of p)A!==g&&A.editor.setScrollLeft(b,ft.Immediate)}if(v){const b=g.editor.getScrollTop();for(const A of p)if(A!==g)if(this._shouldLock(g,A))A.editor.setScrollTop(b,ft.Immediate);else{const K=this._getMapping(g,A);K&&this._synchronizeScrolling(g.editor,A.editor,K)}}})};for(const g of p)l.add(g.editor.onDidScrollChange(m=>{this._isSyncing&&f(g,m.scrollLeftChanged,m.scrollTopChanged)}));return{update:()=>{f(this.inputResultView,!0,!0)}}}).recomputeInitiallyAndOnChange(this._store);this.updateScrolling=()=>{r.get().update()}}stopSync(){this._isSyncing=!1}startSync(){this._isSyncing=!0}_shouldLock(e,t){const i=s=>s===this.input1View||s===this.input2View;return i(e)&&t===this.inputResultView||i(t)&&e===this.inputResultView?this.lockResultWithInputs:i(e)&&t===this.baseView.get()||i(t)&&e===this.baseView.get()?this.lockBaseWithInputs:!!(i(e)&&i(t))}_getMapping(e,t){if(e===this.input1View){if(t===this.input2View)return;if(t===this.inputResultView)return this.model?.input1ResultMapping.get();if(t===this.baseView.get()){const i=this.model?.baseInput1Diffs.get();return i?new Hr(i,-1).reverse():void 0}}else if(e===this.input2View){if(t===this.input1View)return;if(t===this.inputResultView)return this.model?.input2ResultMapping.get();if(t===this.baseView.get()){const i=this.model?.baseInput2Diffs.get();return i?new Hr(i,-1).reverse():void 0}}else if(e===this.inputResultView){if(t===this.input1View)return this.model?.resultInput1Mapping.get();if(t===this.input2View)return this.model?.resultInput2Mapping.get();if(t===this.baseView.get()){const i=this.model?.resultBaseMapping.get();return i||void 0}}else if(e===this.baseView.get()){if(t===this.input1View){const i=this.model?.baseInput1Diffs.get();return i?new Hr(i,-1):void 0}else if(t===this.input2View){const i=this.model?.baseInput2Diffs.get();return i?new Hr(i,-1):void 0}else if(t===this.inputResultView){const i=this.model?.baseResultMapping.get();return i||void 0}}throw new xd}_synchronizeScrolling(e,t,i){if(!i)return;const s=e.getVisibleRanges();if(s.length===0)return;const o=s[0].startLineNumber-1,n=i.project(o),r=n.inputRange,d=n.outputRange,l=t.getTopForLineNumber(d.startLineNumber),h=t.getTopForLineNumber(d.endLineNumberExclusive),p=e.getTopForLineNumber(r.startLineNumber),f=e.getTopForLineNumber(r.endLineNumberExclusive),g=Math.min((e.getScrollTop()-p)/(f-p),1),m=l+(h-l)*g;t.setScrollTop(m,ft.Immediate)}}let Zh=class extends R{constructor(e,t,i,s,o,n,r,d){super(),this.model=e,this.inputCodeEditorView1=t,this.inputCodeEditorView2=i,this.resultCodeEditorView=s,this.baseCodeEditorView=o,this.showNonConflictingChanges=n,this.configurationService=r,this.notificationService=d,this.manuallySetActiveModifiedBaseRange=qi(this,{range:void 0,counter:0}),this.attachedHistory=this._register(new Dk(this.model.resultTextModel)),this.shouldUseAppendInsteadOfAccept=ia("mergeEditor.shouldUseAppendInsteadOfAccept",!1,this.configurationService),this.counter=0,this.lastFocusedEditor=MC(this,(l,h)=>{const f=[this.inputCodeEditorView1,this.inputCodeEditorView2,this.resultCodeEditorView,this.baseCodeEditorView.read(l)].find(g=>g&&g.isFocused.read(l));return f?{view:f,counter:this.counter++}:h||{view:void 0,counter:this.counter++}}),this.baseShowDiffAgainst=zt(this,l=>{const h=this.lastFocusedEditor.read(l);if(h.view===this.inputCodeEditorView1)return 1;if(h.view===this.inputCodeEditorView2)return 2}),this.focusedEditorType=zt(this,l=>{const h=this.lastFocusedEditor.read(l);if(h.view){if(h.view===this.inputCodeEditorView1)return"input1";if(h.view===this.inputCodeEditorView2)return"input2";if(h.view===this.resultCodeEditorView)return"result";if(h.view===this.baseCodeEditorView.read(l))return"base"}}),this.selectionInBase=zt(this,l=>{const h=this.lastFocusedEditor.read(l).view;return h?{rangesInBase:(h.selection.read(l)||[]).map(g=>h===this.inputCodeEditorView1?this.model.translateInputRangeToBase(1,g):h===this.inputCodeEditorView2?this.model.translateInputRangeToBase(2,g):h===this.resultCodeEditorView?this.model.translateResultRangeToBase(g):(h===this.baseCodeEditorView.read(l),g)),sourceEditor:h}:void 0}),this.activeModifiedBaseRange=zt(this,l=>{const h=this.lastFocusedEditor.read(l),p=this.manuallySetActiveModifiedBaseRange.read(l);if(p.counter>h.counter)return p.range;if(!h.view)return;const f=h.view.cursorLineNumber.read(l);return f?this.model.modifiedBaseRanges.read(l).find(m=>{const v=this.getRangeOfModifiedBaseRange(h.view,m,l);return v.isEmpty?v.startLineNumber===f:v.contains(f)}):void 0}),this._register(s.editor.onDidChangeModelContent(l=>{if(this.model.isApplyingEditInResult||l.isRedoing||l.isUndoing)return;const h=[];for(const f of l.changes){const g=this.model.translateResultRangeToBase(ve.lift(f.range)),m=this.model.findModifiedBaseRangesInRange(new Nd(g.startLineNumber,g.endLineNumber-g.startLineNumber));m.length===1&&(this.model.isHandled(m[0]).get()||h.push(m[0]))}if(h.length===0)return;const p={model:this.model,redo(){Ae(f=>{for(const g of h)this.model.setHandled(g,!0,f)})},undo(){Ae(f=>{for(const g of h)this.model.setHandled(g,!1,f)})}};this.attachedHistory.pushAttachedHistoryElement(p),p.redo()}))}getRangeOfModifiedBaseRange(e,t,i){if(e===this.resultCodeEditorView)return this.model.getLineRangeInResult(t.baseRange,i);if(e===this.baseCodeEditorView.get())return t.baseRange;{const s=e===this.inputCodeEditorView1?1:2;return t.getInputRange(s)}}setActiveModifiedBaseRange(e,t){this.manuallySetActiveModifiedBaseRange.set({range:e,counter:this.counter++},t)}setState(e,t,i,s){this.manuallySetActiveModifiedBaseRange.set({range:e,counter:this.counter++},i),this.model.setState(e,t,s,i),this.lastFocusedEditor.clearCache(i)}goToConflict(e){let t=this.lastFocusedEditor.get().view;t||(t=this.resultCodeEditorView);const i=t.editor.getPosition()?.lineNumber;if(i===void 0)return;const s=e(t,i);if(s){const o=this.getRangeOfModifiedBaseRange(t,s,void 0);t.editor.focus();let n=o.startLineNumber,r=o.endLineNumberExclusive;o.startLineNumber>t.editor.getModel().getLineCount()&&(Ae(d=>{this.setActiveModifiedBaseRange(s,d)}),n=r=t.editor.getModel().getLineCount()),t.editor.setPosition({lineNumber:n,column:t.editor.getModel().getLineFirstNonWhitespaceColumn(n)}),t.editor.revealLinesNearTop(n,r,ft.Smooth)}}goToNextModifiedBaseRange(e){this.goToConflict((t,i)=>this.model.modifiedBaseRanges.get().find(s=>e(s)&&this.getRangeOfModifiedBaseRange(t,s,void 0).startLineNumber>i)||this.model.modifiedBaseRanges.get().find(s=>e(s)))}goToPreviousModifiedBaseRange(e){this.goToConflict((t,i)=>Hp(this.model.modifiedBaseRanges.get(),s=>e(s)&&this.getRangeOfModifiedBaseRange(t,s,void 0).endLineNumberExclusive<i)||Hp(this.model.modifiedBaseRanges.get(),s=>e(s)))}toggleActiveConflict(e){const t=this.activeModifiedBaseRange.get();if(!t){this.notificationService.error(c(7893,"There is currently no conflict focused that can be toggled."));return}Ae(i=>{this.setState(t,this.model.getState(t).get().toggle(e),i,e)})}acceptAll(e){Ae(t=>{for(const i of this.model.modifiedBaseRanges.get())this.setState(i,this.model.getState(i).get().withInputValue(e,!0),t,e)})}};Zh=D([u(6,ie),u(7,Ke)],Zh);class Dk extends R{constructor(e){super(),this.model=e,this.attachedHistory=[],this.previousAltId=this.model.getAlternativeVersionId(),this._register(e.onDidChangeContent(t=>{const i=e.getAlternativeVersionId();if(t.isRedoing)for(const s of this.attachedHistory)this.previousAltId<s.altId&&s.altId<=i&&s.element.redo();else if(t.isUndoing)for(let s=this.attachedHistory.length-1;s>=0;s--){const o=this.attachedHistory[s];i<o.altId&&o.altId<=this.previousAltId&&o.element.undo()}else for(;this.attachedHistory.length>0&&this.attachedHistory[this.attachedHistory.length-1].altId>this.previousAltId;)this.attachedHistory.pop();this.previousAltId=i}))}pushAttachedHistoryElement(e){this.attachedHistory.push({altId:this.model.getAlternativeVersionId(),element:e})}}class sp extends R{static{this.counter=0}constructor(e,t,i,s,o){super(),this.editor=e,this.overlayWidgetId=`fixedZoneWidget-${sp.counter++}`,this.widgetDomNode=ht("div.fixed-zone-widget").root,this.overlayWidget={getId:()=>this.overlayWidgetId,getDomNode:()=>this.widgetDomNode,getPosition:()=>null},this.viewZoneId=t.addZone({domNode:document.createElement("div"),afterLineNumber:i,heightInPx:s,ordinal:50001,onComputedHeight:n=>{this.widgetDomNode.style.height=`${n}px`},onDomNodeTop:n=>{this.widgetDomNode.style.top=`${n}px`}}),o.push(this.viewZoneId),this._register(V.runAndSubscribe(this.editor.onDidLayoutChange,()=>{this.widgetDomNode.style.left=this.editor.getLayoutInfo().contentLeft+"px"})),this.editor.addOverlayWidget(this.overlayWidget),this._register({dispose:()=>{this.editor.removeOverlayWidget(this.overlayWidget)}})}}class kc extends R{constructor(e){super(),this._editor=e,this._register(this._editor.onDidChangeConfiguration(t=>{(t.hasChanged(Pt.fontInfo)||t.hasChanged(Pt.codeLensFontSize)||t.hasChanged(Pt.codeLensFontFamily))&&this._updateLensStyle()})),this._styleClassName="_conflictActionsFactory_"+OC(this._editor.getId()).toString(16),this._styleElement=_f(NC(this._editor.getContainerDomNode())?this._editor.getContainerDomNode():void 0,void 0,this._store),this._updateLensStyle()}_updateLensStyle(){const{codeLensHeight:e,fontSize:t}=this._getLayoutInfo(),i=this._editor.getOption(Pt.codeLensFontFamily),s=this._editor.getOption(Pt.fontInfo),o=`--codelens-font-family${this._styleClassName}`,n=`--codelens-font-features${this._styleClassName}`;let r=`
		.${this._styleClassName} { line-height: ${e}px; font-size: ${t}px; padding-right: ${Math.round(t*.5)}px; font-feature-settings: var(${n}) }
		.monaco-workbench .${this._styleClassName} span.codicon { line-height: ${e}px; font-size: ${t}px; }
		`;i&&(r+=`${this._styleClassName} { font-family: var(${o}), ${Xr.fontFamily}}`),this._styleElement.textContent=r,this._editor.getContainerDomNode().style?.setProperty(o,i??"inherit"),this._editor.getContainerDomNode().style?.setProperty(n,s.fontFeatureSettings)}_getLayoutInfo(){const e=Math.max(1.3,this._editor.getOption(Pt.lineHeight)/this._editor.getOption(Pt.fontSize));let t=this._editor.getOption(Pt.codeLensFontSize);return(!t||t<5)&&(t=this._editor.getOption(Pt.fontSize)*.9|0),{fontSize:t,codeLensHeight:t*e|0}}createWidget(e,t,i,s){const o=this._getLayoutInfo();return new Tk(this._editor,e,t,o.codeLensHeight+2,this._styleClassName,i,s)}}class Ak{constructor(e,t){this.viewModel=e,this.modifiedBaseRange=t,this.itemsInput1=this.getItemsInput(1),this.itemsInput2=this.getItemsInput(2),this.resultItems=zt(this,i=>{const s=this.viewModel,o=this.modifiedBaseRange,n=s.model.getState(o).read(i),r=s.model,d=[];if(n.kind===Ns.unrecognized)d.push({text:c(7856,"Manual Resolution"),tooltip:c(7857,"This conflict has been resolved manually.")});else if(n.kind===Ns.base)d.push({text:c(7858,"No Changes Accepted"),tooltip:c(7859,"The current resolution of this conflict equals the common ancestor of both the right and left changes.")});else{const h=[];n.includesInput1&&h.push(r.input1.title),n.includesInput2&&h.push(r.input2.title),n.kind===Ns.both&&n.firstInput===2&&h.reverse(),d.push({text:`${h.join(" + ")}`})}const l=[];return n.includesInput1&&l.push(ws(c(7860,"Remove {0}",r.input1.title),async()=>{Ae(h=>{r.setState(o,n.withInputValue(1,!1),!0,h),r.telemetry.reportRemoveInvoked(1,n.includesInput(2))})},c(7861,"Remove {0} from the result document.",r.input1.title))),n.includesInput2&&l.push(ws(c(7860,"Remove {0}",r.input2.title),async()=>{Ae(h=>{r.setState(o,n.withInputValue(2,!1),!0,h),r.telemetry.reportRemoveInvoked(2,n.includesInput(1))})},c(7861,"Remove {0} from the result document.",r.input2.title))),n.kind===Ns.both&&n.firstInput===2&&l.reverse(),d.push(...l),n.kind===Ns.unrecognized&&d.push(ws(c(7862,"Reset to base"),async()=>{Ae(h=>{r.setState(o,fg.base,!0,h),r.telemetry.reportResetToBaseInvoked()})},c(7863,"Reset this conflict to the common ancestor of both the right and left changes."))),d}),this.isEmpty=zt(this,i=>this.itemsInput1.read(i).length+this.itemsInput2.read(i).length+this.resultItems.read(i).length===0),this.inputIsEmpty=zt(this,i=>this.itemsInput1.read(i).length+this.itemsInput2.read(i).length===0)}getItemsInput(e){return zt(t=>{const i=this.viewModel,s=this.modifiedBaseRange;if(!i.model.hasBaseRange(s))return[];const o=i.model.getState(s).read(t),n=i.model.isHandled(s).read(t),r=i.model,d=[],l=e===1?i.model.input1:i.model.input2,h=i.showNonConflictingChanges.read(t);if(!s.isConflicting&&n&&!h)return[];const p=e===1?2:1;if(o.kind!==Ns.unrecognized&&!o.isInputIncluded(e)){if(!o.isInputIncluded(p)||!this.viewModel.shouldUseAppendInsteadOfAccept.read(t)){if(d.push(ws(c(7864,"Accept {0}",l.title),async()=>{Ae(f=>{r.setState(s,o.withInputValue(e,!0,!1),e,f),r.telemetry.reportAcceptInvoked(e,o.includesInput(p))})},c(7865,"Accept {0} in the result document.",l.title))),s.canBeCombined){const f=s.isOrderRelevant?c(7866,"Accept Combination ({0} First)",l.title):c(7867,"Accept Combination");d.push(ws(f,async()=>{Ae(g=>{r.setState(s,fg.base.withInputValue(e,!0).withInputValue(p,!0,!0),!0,g),r.telemetry.reportSmartCombinationInvoked(o.includesInput(p))})},c(7868,"Accept an automatic combination of both sides in the result document.")))}}else d.push(ws(c(7869,"Append {0}",l.title),async()=>{Ae(f=>{r.setState(s,o.withInputValue(e,!0,!1),e,f),r.telemetry.reportAcceptInvoked(e,o.includesInput(p))})},c(7870,"Append {0} to the result document.",l.title))),s.canBeCombined&&d.push(ws(c(7871,"Accept Combination",l.title),async()=>{Ae(f=>{r.setState(s,o.withInputValue(e,!0,!0),e,f),r.telemetry.reportSmartCombinationInvoked(o.includesInput(p))})},c(7868,"Accept an automatic combination of both sides in the result document.")));r.isInputHandled(s,e).read(t)||d.push(ws(c(7872,"Ignore"),async()=>{Ae(f=>{r.setInputHandled(s,e,!0,f)})},c(7873,"Don't take this side of the conflict.")))}return d})}}function ws(a,e,t){return{text:a,action:e,tooltip:t}}class Tk extends sp{constructor(e,t,i,s,o,n,r){super(e,t,i,s,r),this._domNode=ht("div.merge-editor-conflict-actions").root,this.widgetDomNode.appendChild(this._domNode),this._domNode.classList.add(o),this._register(yi(d=>{const l=n.read(d);this.setState(l)}))}setState(e){const t=[];let i=!0;for(const s of e){i?i=!1:t.push(B("span",void 0," | "));const o=Pi(s.text);s.action?t.push(B("a",{title:s.tooltip,role:"button",onclick:()=>s.action()},...o)):t.push(B("span",{title:s.tooltip},...o))}Mi(this._domNode,...t)}}function xk(a){const e=uf(a.input1Diffs.flatMap(r=>r.rangeMappings),a.baseRange.toRange(),a.input1Range.toRange()),t=uf(a.input2Diffs.flatMap(r=>r.rangeMappings),a.baseRange.toRange(),a.input2Range.toRange()),i=kk(e,t);let s=[];s.push([a.input1Range.startLineNumber-1,a.baseRange.startLineNumber-1,a.input2Range.startLineNumber-1]);function o(r){return r.every(d=>d!==void 0)}for(const r of i){const d=[r.output1Pos?.lineNumber,r.inputPos.lineNumber,r.output2Pos?.lineNumber],l=o(d);let h=!0;if(l){const p=!s.some(f=>o(f)&&f.some((g,m)=>g!==void 0&&g===d[m]));p&&(s=s.filter(f=>!f.some((g,m)=>g!==void 0&&g===d[m]))),h=p}else h=!s.some(f=>f.some((g,m)=>g!==void 0&&g===d[m]));h?s.push(d):r.length.isGreaterThan(new BC(1,0))&&s.push([r.output1Pos?r.output1Pos.lineNumber+1:void 0,r.inputPos.lineNumber+1,r.output2Pos?r.output2Pos.lineNumber+1:void 0])}const n=[a.input1Range.endLineNumberExclusive,a.baseRange.endLineNumberExclusive,a.input2Range.endLineNumberExclusive];return s=s.filter(r=>r.every((d,l)=>d!==n[l])),s.push(n),Hc(()=>ac(s.map(r=>r[0]).filter(Zi),(r,d)=>r<d)&&ac(s.map(r=>r[1]).filter(Zi),(r,d)=>r<=d)&&ac(s.map(r=>r[2]).filter(Zi),(r,d)=>r<d)&&s.every(r=>r.filter(Zi).length>=2)),s}function uf(a,e,t){const i=[];let s=e.getStartPosition(),o=t.getStartPosition();for(const r of a){const d=new mg(ve.fromPositions(s,r.inputRange.getStartPosition()),ve.fromPositions(o,r.outputRange.getStartPosition()));Hc(()=>zr(d.inputRange).equals(zr(d.outputRange))),d.inputRange.isEmpty()||i.push(d),s=r.inputRange.getEndPosition(),o=r.outputRange.getEndPosition()}const n=new mg(ve.fromPositions(s,e.getEndPosition()),ve.fromPositions(o,t.getEndPosition()));return Hc(()=>zr(n.inputRange).equals(zr(n.outputRange))),n.inputRange.isEmpty()||i.push(n),i}function kk(a,e){const t=[],i=[];for(const[n,r]of[[0,a],[1,e]])for(const d of r)i.push({input:n,start:!0,inputPos:d.inputRange.getStartPosition(),outputPos:d.outputRange.getStartPosition()}),i.push({input:n,start:!1,inputPos:d.inputRange.getEndPosition(),outputPos:d.outputRange.getEndPosition()});i.sort(FC(n=>n.inputPos,Jr.compare));const s=[void 0,void 0];let o;for(const n of i){if(o&&s.some(r=>!!r)){const r=XI(o,n.inputPos);r.isZero()||(t.push({inputPos:o,length:r,output1Pos:s[0],output2Pos:s[1]}),s[0]&&(s[0]=wg(s[0],r)),s[1]&&(s[1]=wg(s[1],r)))}s[n.input]=n.start?n.outputPos:void 0,o=n.inputPos}return t}class Rk{constructor(e,t,i){this.input1Editor=e,this.input2Editor=t,this.resultEditor=i,this.conflictActionsFactoryInput1=new kc(this.input1Editor),this.conflictActionsFactoryInput2=new kc(this.input2Editor),this.conflictActionsFactoryResult=new kc(this.resultEditor)}computeViewZones(e,t,i){let s=0,o=0,n=0,r=0;const d=[],l=[],h=[],p=[],f=t.model,g=f.baseResultDiffs.read(e),m=Tw(f.modifiedBaseRanges.read(e),g,(P,L)=>P.baseRange.touches(L.inputRange)?om.neitherLessOrGreaterThan:Nd.compareByStart(P.baseRange,L.inputRange)),v=i.codeLensesVisible,b=i.showNonConflictingChanges;let A,K;for(const P of m){if(v&&P.left&&(P.left.isConflicting||b||!f.isHandled(P.left).read(e))){const z=new Ak(t,P.left);(i.shouldAlignResult||!z.inputIsEmpty.read(e))&&(d.push(new Rc(this.conflictActionsFactoryInput1,P.left.input1Range.startLineNumber-1,z.itemsInput1)),l.push(new Rc(this.conflictActionsFactoryInput2,P.left.input2Range.startLineNumber-1,z.itemsInput2)),i.shouldAlignBase&&h.push(new Vk(P.left.baseRange.startLineNumber-1,16)));const Z=P.left.baseRange.startLineNumber+(K?.resultingDeltaFromOriginalToModified??0)-1;p.push(new Rc(this.conflictActionsFactoryResult,Z,z.resultItems))}const L=P.rights.at(-1);L&&(K=L);let $;P.left?($=xk(P.left).map(z=>({input1Line:z[0],baseLine:z[1],input2Line:z[2],resultLine:void 0})),A=P.left,$[$.length-1].resultLine=P.left.baseRange.endLineNumberExclusive+(K?K.resultingDeltaFromOriginalToModified:0)):$=[{baseLine:L.inputRange.endLineNumberExclusive,input1Line:L.inputRange.endLineNumberExclusive+(A?A.input1Range.endLineNumberExclusive-A.baseRange.endLineNumberExclusive:0),input2Line:L.inputRange.endLineNumberExclusive+(A?A.input2Range.endLineNumberExclusive-A.baseRange.endLineNumberExclusive:0),resultLine:L.outputRange.endLineNumberExclusive}];for(const{input1Line:z,baseLine:Z,input2Line:ne,resultLine:Me}of $){if(!i.shouldAlignBase&&(z===void 0||ne===void 0))continue;const bt=z!==void 0?z+s:-1,lt=ne!==void 0?ne+o:-1,Ii=Z+n,$e=Me!==void 0?Me+r:-1,Xt=Math.max(i.shouldAlignBase?Ii:0,bt,lt,i.shouldAlignResult?$e:0);if(z!==void 0){const st=Xt-bt;st>0&&(d.push(new Yr(z-1,st)),s+=st)}if(ne!==void 0){const st=Xt-lt;st>0&&(l.push(new Yr(ne-1,st)),o+=st)}if(i.shouldAlignBase){const st=Xt-Ii;st>0&&(h.push(new Yr(Z-1,st)),n+=st)}if(i.shouldAlignResult&&Me!==void 0){const st=Xt-$e;st>0&&(p.push(new Yr(Me-1,st)),r+=st)}}}return new Lk(d,l,h,p)}}class Lk{constructor(e,t,i,s){this.input1ViewZones=e,this.input2ViewZones=t,this.baseViewZones=i,this.resultViewZones=s}}class op{}class Yr extends op{constructor(e,t){super(),this.afterLineNumber=e,this.heightInLines=t}create(e,t,i){t.push(e.addZone({afterLineNumber:this.afterLineNumber,heightInLines:this.heightInLines,domNode:B("div.diagonal-fill")}))}}class Vk extends op{constructor(e,t){super(),this.afterLineNumber=e,this.heightPx=t}create(e,t,i){t.push(e.addZone({afterLineNumber:this.afterLineNumber,heightInPx:this.heightPx,domNode:B("div.conflict-actions-placeholder")}))}}class Rc extends op{constructor(e,t,i){super(),this.conflictActionsFactory=e,this.lineNumber=t,this.items=i}create(e,t,i){i.add(this.conflictActionsFactory.createWidget(e,this.lineNumber,this.items,t))}}const Pk=le("settings.headerForeground",{light:"#444444",dark:"#e7e7e7",hcDark:"#ffffff",hcLight:"#292929"},c(8829,"The foreground color for a section header or active title."));le("settings.settingsHeaderHoverForeground",so(Pk,.7),c(8830,"The foreground color for a section header or hovered title."));le("settings.modifiedItemIndicator",{light:new si(new Kr(102,175,224)),dark:new si(new Kr(12,125,157)),hcDark:new si(new Kr(0,73,122)),hcLight:new si(new Kr(102,175,224))},c(8831,"The color of the modified setting indicator."));le("settings.headerBorder",va,c(8832,"The color of the header container border."));const Mk=le("settings.sashBorder",va,c(8833,"The color of the Settings editor splitview sash border."));le("settings.dropdownBackground",KC,c(8834,"Settings editor dropdown background."));le("settings.dropdownForeground",WC,c(8835,"Settings editor dropdown foreground."));le("settings.dropdownBorder",GC,c(8836,"Settings editor dropdown border."));le("settings.dropdownListBorder",UC,c(8837,"Settings editor dropdown list border. This surrounds the options and separates the options from the description."));le("settings.checkboxBackground",HC,c(8838,"Settings editor checkbox background."));le("settings.checkboxForeground",zC,c(8839,"Settings editor checkbox foreground."));le("settings.checkboxBorder",$C,c(8840,"Settings editor checkbox border."));le("settings.textInputBackground",nm,c(8841,"Settings editor text input box background."));le("settings.textInputForeground",rm,c(8842,"Settings editor text input box foreground."));le("settings.textInputBorder",am,c(8843,"Settings editor text input box border."));le("settings.numberInputBackground",nm,c(8844,"Settings editor number input box background."));le("settings.numberInputForeground",rm,c(8845,"Settings editor number input box foreground."));le("settings.numberInputBorder",am,c(8846,"Settings editor number input box border."));le("settings.focusedRowBackground",{dark:so(fa,.6),light:so(fa,.6),hcDark:null,hcLight:null},c(8847,"The background color of a settings row when focused."));le("settings.rowHoverBackground",{dark:so(fa,.3),light:so(fa,.3),hcDark:null,hcLight:null},c(8848,"The background color of a settings row when hovered."));le("settings.focusedRowBorder",jC,c(8849,"The color of the row's top and bottom border when the row is focused."));let td=class extends tp{constructor(e,t,i,s,o){super(i,t,o),this.inputNumber=e,this.otherInputNumber=this.inputNumber===1?2:1,this.modifiedBaseRangeGutterItemInfos=zp({debugName:`input${this.inputNumber}.modifiedBaseRangeGutterItemInfos`},n=>{const r=this.viewModel.read(n);if(!r)return[];const d=r.model,l=this.inputNumber,h=r.showNonConflictingChanges.read(n);return d.modifiedBaseRanges.read(n).filter(p=>p.getInputDiffs(this.inputNumber).length>0&&(h||p.isConflicting||!d.isHandled(p).read(n))).map((p,f)=>new Ok(f.toString(),p,l,r))}),this.decorations=zp({debugName:`input${this.inputNumber}.decorations`},n=>{const r=this.viewModel.read(n);if(!r)return[];const d=r.model,l=(this.inputNumber===1?d.input1:d.input2).textModel,h=r.activeModifiedBaseRange.read(n),p=new Array,f=r.showNonConflictingChanges.read(n),g=this.showDeletionMarkers.read(n),v=!(r.baseCodeEditorView.read(n)!==void 0&&r.baseShowDiffAgainst.read(n)===this.inputNumber)&&this.useSimplifiedDecorations.read(n);for(const b of d.modifiedBaseRanges.read(n)){const A=b.getInputRange(this.inputNumber);if(!A)continue;const K=["merge-editor-block"];let P=[0,0,0,0];const L=d.isInputHandled(b,this.inputNumber).read(n);L&&K.push("handled"),b===h&&(K.push("focused"),P=[0,2,0,2]),b.isConflicting&&K.push("conflicting");const $=this.inputNumber===1?"input i1":"input i2";if(K.push($),!(!b.isConflicting&&!f&&L)&&(v&&!L&&K.push("use-simplified-decorations"),p.push({range:A.toInclusiveRangeOrEmpty(),options:{showIfCollapsed:!0,blockClassName:K.join(" "),blockPadding:P,blockIsAfterEnd:A.startLineNumber>l.getLineCount(),description:"Merge Editor",minimap:{position:_u.Gutter,color:{id:L?$o:jo}},overviewRuler:b.isConflicting?{position:en.Center,color:{id:L?$o:jo}}:void 0}}),!v&&(b.isConflicting||!d.isHandled(b).read(n)))){const z=b.getInputDiffs(this.inputNumber);for(const Z of z){const ne=Z.outputRange.toInclusiveRange();if(ne&&p.push({range:ne,options:{className:`merge-editor-diff ${$}`,description:"Merge Editor",isWholeLine:!0}}),Z.rangeMappings)for(const Me of Z.rangeMappings)(g||!Me.outputRange.isEmpty())&&p.push({range:Me.outputRange,options:{className:Me.outputRange.isEmpty()?`merge-editor-diff-empty-word ${$}`:`merge-editor-diff-word ${$}`,description:"Merge Editor",showIfCollapsed:!0}})}}}return p}),this.htmlElements.root.classList.add("input"),this._register(new ep(this.editor,this.htmlElements.gutterDiv,{getIntersectingGutterItems:(n,r)=>this.checkboxesVisible.read(r)?this.modifiedBaseRangeGutterItemInfos.read(r):[],createView:(n,r)=>new Nk(n,r,s)})),this._register(ip(this,(n,r)=>r.model.translateBaseRangeToInput(this.inputNumber,n))),this._register(i.createInstance(hr,e===1?w.MergeInput1Toolbar:w.MergeInput2Toolbar,this.htmlElements.toolbar)),this._register(qC({debugName:`input${this.inputNumber}: update labels & text model`},n=>{const r=this.viewModel.read(n);if(!r)return;this.editor.setModel(this.inputNumber===1?r.model.input1.textModel:r.model.input2.textModel);const d=this.inputNumber===1?r.model.input1.title||c(7877,"Input 1"):r.model.input2.title||c(7878,"Input 2"),l=this.inputNumber===1?r.model.input1.description:r.model.input2.description,h=this.inputNumber===1?r.model.input1.detail:r.model.input2.detail;Mi(this.htmlElements.title,...Pi(d)),Mi(this.htmlElements.description,...l?Pi(l):[]),Mi(this.htmlElements.detail,...h?Pi(h):[])})),this._register(Mu(this.editor,this.decorations))}};td=D([u(2,F),u(3,at),u(4,ie)],td);class Ok{constructor(e,t,i,s){this.id=e,this.baseRange=t,this.inputNumber=i,this.viewModel=s,this.model=this.viewModel.model,this.range=this.baseRange.getInputRange(this.inputNumber),this.enabled=this.model.isUpToDate,this.toggleState=zt(this,o=>{const n=this.model.getState(this.baseRange).read(o).getInput(this.inputNumber);return n===Eo.second&&!this.baseRange.isOrderRelevant?Eo.first:n}),this.state=zt(this,o=>{const n=this.viewModel.activeModifiedBaseRange.read(o);return this.model.hasBaseRange(this.baseRange)?{handled:this.model.isHandled(this.baseRange).read(o),focused:this.baseRange===n}:{handled:!1,focused:!1}})}setState(e,t){this.viewModel.setState(this.baseRange,this.model.getState(this.baseRange).get().withInputValue(this.inputNumber,e),t,this.inputNumber)}toggleBothSides(){Ae(e=>{const t=this.model.getState(this.baseRange).get();this.model.setState(this.baseRange,t.toggle(this.inputNumber).toggle(this.inputNumber===1?2:1),!0,e)})}getContextMenuActions(){const e=this.model.getState(this.baseRange).get(),t=this.model.isHandled(this.baseRange).get(),i=n=>{Ae(r=>this.viewModel.setState(this.baseRange,n,r,this.inputNumber))};function s(n,r,d,l){const h=new _t(n,r,void 0,!0,()=>{i(d)});return h.checked=l,h}const o=e.includesInput1&&e.includesInput2;return[this.baseRange.input1Diffs.length>0?s("mergeEditor.acceptInput1",c(7879,"Accept {0}",this.model.input1.title),e.toggle(1),e.includesInput1):void 0,this.baseRange.input2Diffs.length>0?s("mergeEditor.acceptInput2",c(7879,"Accept {0}",this.model.input2.title),e.toggle(2),e.includesInput2):void 0,this.baseRange.isConflicting?mc(s("mergeEditor.acceptBoth",c(7880,"Accept Both"),e.withInputValue(1,!o).withInputValue(2,!o),o),{enabled:this.baseRange.canBeCombined}):void 0,new ss,this.baseRange.isConflicting?mc(s("mergeEditor.swap",c(7881,"Swap"),e.swap(),!1),{enabled:!e.kind&&(!o||this.baseRange.isOrderRelevant)}):void 0,mc(new _t("mergeEditor.markAsHandled",c(7882,"Mark as Handled"),void 0,!0,()=>{Ae(n=>{this.model.setHandled(this.baseRange,!t,n)})}),{checked:t})].filter(Zi)}}class Nk extends R{constructor(e,t,i){super(),this.isMultiLine=qi(this,!1),this.item=qi(this,e);const s=new Zf({isChecked:!1,title:"",icon:k.check,...yu});s.domNode.classList.add("accept-conflict-group"),this._register(Y(s.domNode,te.MOUSE_DOWN,o=>{const n=this.item.get();n&&(o.button===2?(o.stopPropagation(),o.preventDefault(),i.showContextMenu({getAnchor:()=>s.domNode,getActions:()=>n.getContextMenuActions()})):o.button===1&&(o.stopPropagation(),o.preventDefault(),n.toggleBothSides()))})),this._register(yi(o=>{const n=this.item.read(o),r=n.toggleState.read(o),l={[Eo.excluded]:{icon:void 0,checked:!1,title:c(7883,"Accept")},[Eo.unrecognized]:{icon:k.circleFilled,checked:!1,title:c(7884,"Accept (result is dirty)")},[Eo.first]:{icon:k.check,checked:!0,title:c(7885,"Undo accept")},[Eo.second]:{icon:k.checkAll,checked:!0,title:c(7886,"Undo accept (currently second)")}}[r];s.setIcon(l.icon),s.checked=l.checked,s.setTitle(l.title),n.enabled.read(o)?s.enable():s.disable()})),this._register(yi(o=>{const n=this.item.read(o).state.read(o),r=["merge-accept-gutter-marker",n.handled&&"handled",n.focused&&"focused",this.isMultiLine.read(o)?"multi-line":"single-line"];t.className=r.filter(d=>typeof d=="string").join(" ")})),this._register(s.onChange(()=>{Ae(o=>{this.item.get().setState(s.checked,o)})})),t.appendChild(ht("div.background",[YC]).root),t.appendChild(this.checkboxDiv=ht("div.checkbox",[ht("div.checkbox-background",[s.domNode])]).root)}layout(e,t,i,s){const o=this.checkboxDiv.clientHeight,n=t/2-o/2,r=o;let d=e+n;const l=[r,i+s-r-o],h=[e+r,e+t-o-r];h[0]<h[1]&&(d=ma(d,l[0],l[1]),d=ma(d,h[0],h[1])),this.checkboxDiv.style.top=`${d-e}px`,Ae(p=>{this.isMultiLine.set(t>30,p)})}update(e){Ae(t=>{this.item.set(e,t)})}}let Xh=class extends tp{constructor(e,t,i,s){super(t,e,s),this._labelService=i,this.decorations=zt(this,n=>{const r=this.viewModel.read(n);if(!r)return[];const d=r.model,l=d.resultTextModel,h=new Array,p=Tw(d.modifiedBaseRanges.read(n),d.baseResultDiffs.read(n),(m,v)=>m.baseRange.touches(v.inputRange)?om.neitherLessOrGreaterThan:Nd.compareByStart(m.baseRange,v.inputRange)),f=r.activeModifiedBaseRange.read(n),g=r.showNonConflictingChanges.read(n);for(const m of p){const v=m.left;if(v){const b=["merge-editor-block"];let A=[0,0,0,0];const K=d.isHandled(v).read(n);if(K&&b.push("handled"),v===f&&(b.push("focused"),A=[0,2,0,2]),v.isConflicting&&b.push("conflicting"),b.push("result"),!v.isConflicting&&!g&&K)continue;const P=d.getLineRangeInResult(v.baseRange,n);h.push({range:P.toInclusiveRangeOrEmpty(),options:{showIfCollapsed:!0,blockClassName:b.join(" "),blockPadding:A,blockIsAfterEnd:P.startLineNumber>l.getLineCount(),description:"Result Diff",minimap:{position:_u.Gutter,color:{id:K?$o:jo}},overviewRuler:v.isConflicting?{position:en.Center,color:{id:K?$o:jo}}:void 0}})}if(!v||v.isConflicting)for(const b of m.rights){const A=b.outputRange.toInclusiveRange();if(A&&h.push({range:A,options:{className:"merge-editor-diff result",description:"Merge Editor",isWholeLine:!0}}),b.rangeMappings)for(const K of b.rangeMappings)h.push({range:K.outputRange,options:{className:"merge-editor-diff-word result",description:"Merge Editor"}})}}return h}),this.editor.invokeWithinContext(n=>{const r=n.get(se),d=QI.bindTo(r);d.set(!0),this._register(ae(()=>d.reset()))}),this.htmlElements.gutterDiv.style.width="5px",this.htmlElements.root.classList.add("result"),this._register(Eu((n,r)=>{this.checkboxesVisible.read(n)&&r.add(new ep(this.editor,this.htmlElements.gutterDiv,{getIntersectingGutterItems:(d,l)=>[],createView:(d,l)=>{throw new xd}}))})),this._register(yi(n=>{const r=this.viewModel.read(n);r&&(this.editor.setModel(r.model.resultTextModel),Mi(this.htmlElements.title,...Pi(c(7887,"Result"))),Mi(this.htmlElements.description,...Pi(this._labelService.getUriLabel(r.model.resultTextModel.uri,{relative:!0}))))}));const o=this._register(new Qo(this.htmlElements.detail));this._register(yi(n=>{const r=this.viewModel.read(n);if(!r)return;const d=r.model;if(!d)return;const l=d.unhandledConflictsCount.read(n),h=l===1?c(7888,"{0} Conflict Remaining",l):c(7889,"{0} Conflicts Remaining ",l);o.clear(),o.push({class:void 0,enabled:l>0,id:"nextConflict",label:h,run(){r.model.telemetry.reportConflictCounterClicked(),r.goToNextModifiedBaseRange(p=>!d.isHandled(p).get())},tooltip:l>0?c(7890,"Go to next conflict"):c(7891,"All conflicts handled, the merge can be completed now.")})})),this._register(Mu(this.editor,this.decorations)),this._register(ip(this,(n,r)=>r.model.translateBaseRangeToResult(n))),this._register(t.createInstance(hr,w.MergeInputResultToolbar,this.htmlElements.toolbar))}};Xh=D([u(1,F),u(2,Fi),u(3,ie)],Xh);var Qh,na;Pe(_k);let Dt=class extends qm{static{Qh=this}static{this.ID="mergeEditor"}get viewModel(){return this._viewModel}get inputModel(){return this._inputModel}get model(){return this.inputModel.get()?.model}constructor(e,t,i,s,o,n,r,d,l,h,p){super(Qh.ID,e,s,t,o,r,n,d,l,h),this.contextKeyService=i,this._codeEditorService=p,this._sessionDisposables=new O,this._viewModel=qi(this,void 0),this._grid=this._register(new Ie),this.input1View=this._register(this.instantiationService.createInstance(td,1,this._viewModel)),this.baseView=qi(this,void 0),this.baseViewOptions=qi(this,void 0),this.input2View=this._register(this.instantiationService.createInstance(td,2,this._viewModel)),this.inputResultView=this._register(this.instantiationService.createInstance(Xh,this._viewModel)),this._layoutMode=this.instantiationService.createInstance(eu),this._layoutModeObs=qi(this,this._layoutMode.value),this._ctxIsMergeEditor=ye.bindTo(this.contextKeyService),this._ctxUsesColumnLayout=rn.bindTo(this.contextKeyService),this._ctxShowBase=Bd.bindTo(this.contextKeyService),this._ctxShowBaseAtTop=Ou.bindTo(this.contextKeyService),this._ctxResultUri=eD.bindTo(this.contextKeyService),this._ctxBaseUri=tD.bindTo(this.contextKeyService),this._ctxShowNonConflictingChanges=xw.bindTo(this.contextKeyService),this._inputModel=qi(this,void 0),this.viewZoneComputer=new Rk(this.input1View.editor,this.input2View.editor,this.inputResultView.editor),this.scrollSynchronizer=this._register(new Ik(this._viewModel,this.input1View,this.input2View,this.baseView,this.inputResultView,this._layoutModeObs)),this._onDidChangeSizeConstraints=new E,this.onDidChangeSizeConstraints=this._onDidChangeSizeConstraints.event,this.baseViewDisposables=this._register(new O),this.showNonConflictingChangesStore=this.instantiationService.createInstance(iD,"mergeEditor/showNonConflictingChanges"),this.showNonConflictingChanges=qi(this,this.showNonConflictingChangesStore.get()??!1)}dispose(){this._sessionDisposables.dispose(),this._ctxIsMergeEditor.reset(),this._ctxUsesColumnLayout.reset(),this._ctxShowNonConflictingChanges.reset(),super.dispose()}get minimumWidth(){return this._layoutMode.value.kind==="mixed"?this.input1View.view.minimumWidth+this.input2View.view.minimumWidth:this.input1View.view.minimumWidth+this.input2View.view.minimumWidth+this.inputResultView.view.minimumWidth}getTitle(){return this.input?this.input.getName():c(7892,"Text Merge Editor")}createEditorControl(e,t){this.rootHtmlElement=e,e.classList.add("merge-editor"),this.applyLayout(this._layoutMode.value),this.applyOptions(t)}updateEditorControlOptions(e){this.applyOptions(e)}applyOptions(e){const t=yg(e,{minimap:{enabled:!1},glyphMargin:!1,lineNumbersMinChars:2}),i=yg(t,{readOnly:!0,readOnlyMessage:void 0});this.input1View.updateOptions(i),this.input2View.updateOptions(i),this.baseViewOptions.set({...this.input2View.editor.getRawOptions()},void 0),this.inputResultView.updateOptions(t)}getMainControl(){return this.inputResultView.editor}layout(e){this._grid.value?.layout(e.width,e.height)}async setInput(e,t,i,s){if(!(e instanceof Ds))throw new xd("ONLY MergeEditorInput is supported");await super.setInput(e,t,i,s),this._sessionDisposables.clear(),Ae(f=>{this._viewModel.set(void 0,f),this._inputModel.set(void 0,f)});const o=await e.resolve(),n=o.model,r=this.instantiationService.createInstance(Zh,n,this.input1View,this.input2View,this.inputResultView,this.baseView,this.showNonConflictingChanges);n.telemetry.reportMergeEditorOpened({combinableConflictCount:n.combinableConflictCount,conflictCount:n.conflictCount,baseTop:this._layoutModeObs.get().showBaseAtTop,baseVisible:this._layoutModeObs.get().showBase,isColumnView:this._layoutModeObs.get().kind==="columns"}),Ae(f=>{this._viewModel.set(r,f),this._inputModel.set(o,f)}),this._sessionDisposables.add(r),this._sessionDisposables.add(yi(f=>{const g=r.focusedEditorType.read(f);e instanceof Ds&&e.updateFocusedEditor(g||"result")})),this._ctxResultUri.set(o.resultUri.toString()),this._ctxBaseUri.set(n.base.uri.toString()),this._sessionDisposables.add(ae(()=>{this._ctxBaseUri.reset(),this._ctxResultUri.reset()}));const d=new O;this._sessionDisposables.add(d),this._sessionDisposables.add(Eu(f=>{const g=this.baseView.read(f),m=this.inputResultView.editor.getScrollTop();this.scrollSynchronizer.stopSync(),d.clear(),this.inputResultView.editor.changeViewZones(v=>{const b=this._layoutModeObs.read(f),A=b.kind==="columns",K=b.kind==="mixed"&&!b.showBaseAtTop;this.input1View.editor.changeViewZones(P=>{this.input2View.editor.changeViewZones(L=>{g?g.editor.changeViewZones($=>{d.add(this.setViewZones(f,r,this.input1View.editor,P,this.input2View.editor,L,g.editor,$,K,this.inputResultView.editor,v,A))}):d.add(this.setViewZones(f,r,this.input1View.editor,P,this.input2View.editor,L,void 0,void 0,!1,this.inputResultView.editor,v,A))})})}),this.inputResultView.editor.setScrollTop(m,ft.Smooth),this.scrollSynchronizer.startSync(),this.scrollSynchronizer.updateScrolling()}));const l=this.loadEditorViewState(e,i);l?this._applyViewState(l):this._sessionDisposables.add(JC(n.onInitialized,()=>{const f=n.modifiedBaseRanges.get().find(g=>g.isConflicting);f&&(this.input1View.editor.revealLineInCenter(f.input1Range.startLineNumber),Ae(g=>{r.setActiveModifiedBaseRange(f,g)}))}));const h=f=>{const g=sD(f,this._codeEditorService);$r(n.input2.textModel,g,this._codeEditorService),$r(n.input1.textModel,g,this._codeEditorService),$r(n.resultTextModel,g,this._codeEditorService);const m=this.baseView.get()?.editor.getModel();m&&$r(m,g,this._codeEditorService)};this._sessionDisposables.add(this._codeEditorService.onDidChangeTransientModelProperty(f=>{h(f)})),h(this.inputResultView.editor.getModel());const p=this;this._sessionDisposables.add(new class{constructor(){this._disposable=new O;for(const f of this.baseInput1Input2())this._disposable.add(f.onDidChangeContent(()=>this._checkBaseInput1Input2AllEmpty()))}dispose(){this._disposable.dispose()}*baseInput1Input2(){yield n.base,yield n.input1.textModel,yield n.input2.textModel}_checkBaseInput1Input2AllEmpty(){for(const f of this.baseInput1Input2())if(f.getValueLength()>0)return;p.editorService.replaceEditors([{editor:e,replacement:{resource:e.result,options:{preserveFocus:!0}},forceReplaceDirty:!0}],p.group)}})}setViewZones(e,t,i,s,o,n,r,d,l,h,p,f){const g=[],m=[],v=[],b=[],A=this.viewZoneComputer.computeViewZones(e,t,{codeLensesVisible:!0,showNonConflictingChanges:this.showNonConflictingChanges.read(e),shouldAlignBase:l,shouldAlignResult:f}),K=new O;if(d)for(const P of A.baseViewZones)P.create(d,v,K);for(const P of A.resultViewZones)P.create(p,b,K);for(const P of A.input1ViewZones)P.create(s,g,K);for(const P of A.input2ViewZones)P.create(n,m,K);return K.add({dispose:()=>{i.changeViewZones(P=>{for(const L of g)P.removeZone(L)}),o.changeViewZones(P=>{for(const L of m)P.removeZone(L)}),r?.changeViewZones(P=>{for(const L of v)P.removeZone(L)}),h.changeViewZones(P=>{for(const L of b)P.removeZone(L)})}}),K}setOptions(e){super.setOptions(e),e&&_r(e,this.inputResultView.editor,ft.Smooth)}clearInput(){super.clearInput(),this._sessionDisposables.clear();for(const{editor:e}of[this.input1View,this.input2View,this.inputResultView])e.setModel(null)}focus(){super.focus(),(this.getControl()??this.inputResultView.editor).focus()}hasFocus(){for(const{editor:e}of[this.input1View,this.input2View,this.inputResultView])if(e.hasTextFocus())return!0;return super.hasFocus()}setEditorVisible(e){super.setEditorVisible(e);for(const{editor:t}of[this.input1View,this.input2View,this.inputResultView])e?t.onVisible():t.onHide();this._ctxIsMergeEditor.set(e)}getControl(){return this.inputResultView.editor}get scopedContextKeyService(){return this.getControl()?.invokeWithinContext(t=>t.get(se))}toggleBase(){this.setLayout({...this._layoutMode.value,showBase:!this._layoutMode.value.showBase})}toggleShowBaseTop(){const e=this._layoutMode.value.showBase&&this._layoutMode.value.showBaseAtTop;this.setLayout({...this._layoutMode.value,showBaseAtTop:!0,showBase:!e})}toggleShowBaseCenter(){const e=this._layoutMode.value.showBase&&!this._layoutMode.value.showBaseAtTop;this.setLayout({...this._layoutMode.value,showBaseAtTop:!1,showBase:!e})}setLayoutKind(e){this.setLayout({...this._layoutMode.value,kind:e})}setLayout(e){const t=this._layoutMode.value;JSON.stringify(t)!==JSON.stringify(e)&&(this.model?.telemetry.reportLayoutChange({baseTop:e.showBaseAtTop,baseVisible:e.showBase,isColumnView:e.kind==="columns"}),this.applyLayout(e))}applyLayout(e){Ae(t=>{if(e.showBase&&!this.baseView.get()){this.baseViewDisposables.clear();const i=this.baseViewDisposables.add(this.instantiationService.createInstance(Jh,this.viewModel));this.baseViewDisposables.add(yi(s=>{const o=this.baseViewOptions.read(s);o&&i.updateOptions(o)})),this.baseView.set(i,t)}else!e.showBase&&this.baseView.get()&&(this.baseView.set(void 0,t),this.baseViewDisposables.clear());e.kind==="mixed"?this.setGrid([e.showBaseAtTop&&e.showBase?{size:38,data:this.baseView.get().view}:void 0,{size:38,groups:[{data:this.input1View.view},!e.showBaseAtTop&&e.showBase?{data:this.baseView.get().view}:void 0,{data:this.input2View.view}].filter(Zi)},{size:62,data:this.inputResultView.view}].filter(Zi)):e.kind==="columns"&&this.setGrid([e.showBase?{size:40,data:this.baseView.get().view}:void 0,{size:60,groups:[{data:this.input1View.view},{data:this.inputResultView.view},{data:this.input2View.view}]}].filter(Zi)),this._layoutMode.value=e,this._ctxUsesColumnLayout.set(e.kind),this._ctxShowBase.set(e.showBase),this._ctxShowBaseAtTop.set(e.showBaseAtTop),this._onDidChangeSizeConstraints.fire(),this._layoutModeObs.set(e,t)})}setGrid(e){let t=-1,i=-1;this._grid.value&&(t=this._grid.value.width,i=this._grid.value.height),this._grid.value=Ss.from({orientation:J.VERTICAL,size:100,groups:e},{styles:{separatorBorder:this.theme.getColor(Mk)??si.transparent},proportionalLayout:!0}),Mi(this.rootHtmlElement,this._grid.value.element),t!==-1&&this._grid.value.layout(t,i)}_applyViewState(e){e&&(this.inputResultView.editor.restoreViewState(e),e.input1State&&this.input1View.editor.restoreViewState(e.input1State),e.input2State&&this.input2View.editor.restoreViewState(e.input2State),e.focusIndex>=0&&[this.input1View.editor,this.input2View.editor,this.inputResultView.editor][e.focusIndex].focus())}computeEditorViewState(e){if(!dt(this.inputModel.get()?.resultUri,e))return;const t=this.inputResultView.editor.saveViewState();if(!t)return;const i=this.input1View.editor.saveViewState()??void 0,s=this.input2View.editor.saveViewState()??void 0,o=[this.input1View.editor,this.input2View.editor,this.inputResultView.editor].findIndex(n=>n.hasWidgetFocus());return{...t,input1State:i,input2State:s,focusIndex:o}}tracksEditorViewState(e){return e instanceof Ds}toggleShowNonConflictingChanges(){this.showNonConflictingChanges.set(!this.showNonConflictingChanges.get(),void 0),this.showNonConflictingChangesStore.set(this.showNonConflictingChanges.get()),this._ctxShowNonConflictingChanges.set(this.showNonConflictingChanges.get())}};Dt=Qh=D([u(1,F),u(2,se),u(3,mt),u(4,ce),u(5,me),u(6,on),u(7,Q),u(8,Je),u(9,Le),u(10,co)],Dt);let eu=class{static{na=this}static{this._key="mergeEditor/layout"}constructor(e){this._storageService=e,this._value={kind:"mixed",showBase:!1,showBaseAtTop:!0};const t=e.get(na._key,G.PROFILE,"mixed");if(t==="mixed"||t==="columns")this._value={kind:t,showBase:!1,showBaseAtTop:!0};else if(t)try{this._value=JSON.parse(t)}catch(i){Bo(i)}}get value(){return this._value}set value(e){this._value!==e&&(this._value=e,this._storageService.store(na._key,JSON.stringify(this._value),G.PROFILE,Re.USER))}};eu=na=D([u(0,ce)],eu);let tu=class extends R{constructor(e,t){super(),this._editorService=e,this._store.add(t.registerCodeEditorOpenHandler(this.openCodeEditorFromMergeEditor.bind(this)))}async openCodeEditorFromMergeEditor(e,t,i){const s=this._editorService.activeEditorPane;if(!i&&e.options&&s instanceof Dt&&s.getControl()&&s.input instanceof Ds&&dt(e.resource,s.input.result)){const o=s.getControl();return _r(e.options,o,ft.Smooth),o}return null}};tu=D([u(0,Q),u(1,co)],tu);let id=class extends R{static{this.ID="workbench.contrib.mergeEditorResolver"}constructor(e,t){super();const i=s=>({editor:t.createInstance(Ds,s.base.resource,{uri:s.input1.resource,title:s.input1.label??os(s.input1.resource),description:s.input1.description??"",detail:s.input1.detail},{uri:s.input2.resource,title:s.input2.label??os(s.input2.resource),description:s.input2.description??"",detail:s.input2.detail},s.result.resource)});this._register(e.registerEditor("*",{id:Ct.id,label:Ct.displayName,detail:Ct.providerDisplayName,priority:De.builtin},{},{createMergeEditorInput:i}))}};id=D([u(0,Sr),u(1,F)],id);class Ei extends X{constructor(e){super(e)}run(e){const{activeEditorPane:t}=e.get(Q);if(t instanceof Dt){const i=t.viewModel.get();if(!i)return;this.runWithViewModel(i,e)}}}class np extends X{constructor(e){super(e)}run(e,...t){const{activeEditorPane:i}=e.get(Q);if(i instanceof Dt){const s=i.viewModel.get();return s?this.runWithMergeEditor({viewModel:s,inputModel:i.inputModel.get(),input:i.input,editorIdentifier:{editor:i.input,groupId:i.group.id}},e,...t):void 0}}}class Bk extends X{constructor(){super({id:"_open.mergeEditor",title:x(7763,"Open Merge Editor")})}run(e,...t){const i=iu.validate(t[0]),s={base:{resource:i.base},input1:{resource:i.input1.uri,label:i.input1.title,description:i.input1.description,detail:i.input1.detail},input2:{resource:i.input2.uri,label:i.input2.title,description:i.input2.description,detail:i.input2.detail},result:{resource:i.output},options:{preserveFocus:!0}};e.get(Q).openEditor(s)}}var iu;(function(a){function e(o){if(!o||typeof o!="object")throw new TypeError("invalid argument");const n=o,r=i(n.base),d=i(n.output),l=t(n.input1),h=t(n.input2);return{base:r,input1:l,input2:h,output:d}}a.validate=e;function t(o){if(typeof o=="string")return new Pn(U.parse(o,!0),void 0,void 0,void 0);if(!o||typeof o!="object")throw new TypeError("invalid argument");if(s(o))return new Pn(U.revive(o),void 0,void 0,void 0);const n=o,r=n.title,d=i(n.uri),l=n.detail,h=n.description;return new Pn(d,r,l,h)}function i(o){if(typeof o=="string")return U.parse(o,!0);if(o&&typeof o=="object")return U.revive(o);throw new TypeError("invalid argument")}function s(o){if(!o||typeof o!="object")return!1;const n=o;return typeof n.scheme=="string"&&typeof n.authority=="string"&&typeof n.path=="string"&&typeof n.query=="string"&&typeof n.fragment=="string"}})(iu||(iu={}));class Fk extends X{constructor(){super({id:"merge.mixedLayout",title:x(7764,"Mixed Layout"),toggled:rn.isEqualTo("mixed"),menu:[{id:w.EditorTitle,when:ye,group:"1_merge",order:9}],precondition:ye})}run(e){const{activeEditorPane:t}=e.get(Q);t instanceof Dt&&t.setLayoutKind("mixed")}}class Kk extends X{constructor(){super({id:"merge.columnLayout",title:x(7765,"Column Layout"),toggled:rn.isEqualTo("columns"),menu:[{id:w.EditorTitle,when:ye,group:"1_merge",order:10}],precondition:ye})}run(e){const{activeEditorPane:t}=e.get(Q);t instanceof Dt&&t.setLayoutKind("columns")}}class Wk extends X{constructor(){super({id:"merge.showNonConflictingChanges",title:x(7766,"Show Non-Conflicting Changes"),toggled:xw.isEqualTo(!0),menu:[{id:w.EditorTitle,when:ye,group:"3_merge",order:9}],precondition:ye})}run(e){const{activeEditorPane:t}=e.get(Q);t instanceof Dt&&t.toggleShowNonConflictingChanges()}}class Gk extends X{constructor(){super({id:"merge.showBase",title:x(7767,"Show Base"),toggled:Bd.isEqualTo(!0),menu:[{id:w.EditorTitle,when:I.and(ye,rn.isEqualTo("columns")),group:"2_merge",order:9}]})}run(e){const{activeEditorPane:t}=e.get(Q);t instanceof Dt&&t.toggleBase()}}class Uk extends X{constructor(){super({id:"merge.showBaseTop",title:x(7768,"Show Base Top"),toggled:I.and(Bd,Ou),menu:[{id:w.EditorTitle,when:I.and(ye,rn.isEqualTo("mixed")),group:"2_merge",order:10}]})}run(e){const{activeEditorPane:t}=e.get(Q);t instanceof Dt&&t.toggleShowBaseTop()}}class Hk extends X{constructor(){super({id:"merge.showBaseCenter",title:x(7769,"Show Base Center"),toggled:I.and(Bd,Ou.negate()),menu:[{id:w.EditorTitle,when:I.and(ye,rn.isEqualTo("mixed")),group:"2_merge",order:11}]})}run(e){const{activeEditorPane:t}=e.get(Q);t instanceof Dt&&t.toggleShowBaseCenter()}}const Rt=x(7770,"Merge Editor");class zk extends Ei{constructor(){super({id:"merge.openResult",icon:k.goToFile,title:x(7771,"Open File"),category:Rt,menu:[{id:w.EditorTitle,when:ye,group:"navigation",order:1}],precondition:ye})}runWithViewModel(e,t){t.get(Q).openEditor({resource:e.model.resultTextModel.uri})}}class $k extends Ei{constructor(){super({id:"merge.goToNextUnhandledConflict",category:Rt,title:x(7772,"Go to Next Unhandled Conflict"),icon:k.arrowDown,menu:[{id:w.EditorTitle,when:ye,group:"navigation",order:3}],f1:!0,precondition:ye})}runWithViewModel(e){e.model.telemetry.reportNavigationToNextConflict(),e.goToNextModifiedBaseRange(t=>!e.model.isHandled(t).get())}}class jk extends Ei{constructor(){super({id:"merge.goToPreviousUnhandledConflict",category:Rt,title:x(7773,"Go to Previous Unhandled Conflict"),icon:k.arrowUp,menu:[{id:w.EditorTitle,when:ye,group:"navigation",order:2}],f1:!0,precondition:ye})}runWithViewModel(e){e.model.telemetry.reportNavigationToPreviousConflict(),e.goToPreviousModifiedBaseRange(t=>!e.model.isHandled(t).get())}}class qk extends Ei{constructor(){super({id:"merge.toggleActiveConflictInput1",category:Rt,title:x(7774,"Toggle Current Conflict from Left"),f1:!0,precondition:ye})}runWithViewModel(e){e.toggleActiveConflict(1)}}class Yk extends Ei{constructor(){super({id:"merge.toggleActiveConflictInput2",category:Rt,title:x(7775,"Toggle Current Conflict from Right"),f1:!0,precondition:ye})}runWithViewModel(e){e.toggleActiveConflict(2)}}class Jk extends Ei{constructor(){super({id:"mergeEditor.compareInput1WithBase",category:Rt,title:x(7776,"Compare Input 1 With Base"),shortTitle:c(7777,"Compare With Base"),f1:!0,precondition:ye,menu:{id:w.MergeInput1Toolbar,group:"primary"},icon:k.compareChanges})}runWithViewModel(e,t){const i=t.get(Q);Ky(e,i,1)}}class Zk extends Ei{constructor(){super({id:"mergeEditor.compareInput2WithBase",category:Rt,title:x(7778,"Compare Input 2 With Base"),shortTitle:c(7777,"Compare With Base"),f1:!0,precondition:ye,menu:{id:w.MergeInput2Toolbar,group:"primary"},icon:k.compareChanges})}runWithViewModel(e,t){const i=t.get(Q);Ky(e,i,2)}}async function Ky(a,e,t){e.openEditor(e.activeEditor,{pinned:!0});const s=a.model.base,o=t===1?a.inputCodeEditorView1.editor:a.inputCodeEditorView2.editor,n=o.getPosition().lineNumber;await e.openEditor({original:{resource:s.uri},modified:{resource:o.getModel().uri},options:{selection:{startLineNumber:n,startColumn:1},revealIfOpened:!0,revealIfVisible:!0}})}class Xk extends Ei{constructor(){super({id:"merge.openBaseEditor",category:Rt,title:x(7779,"Open Base File"),f1:!0,precondition:ye})}runWithViewModel(e,t){t.get(Tt).open(e.model.base.uri)}}class Qk extends Ei{constructor(){super({id:"merge.acceptAllInput1",category:Rt,title:x(7780,"Accept All Incoming Changes from Left"),f1:!0,precondition:ye,menu:{id:w.MergeInput1Toolbar,group:"primary"},icon:k.checkAll})}runWithViewModel(e){e.acceptAll(1)}}class eR extends Ei{constructor(){super({id:"merge.acceptAllInput2",category:Rt,title:x(7781,"Accept All Current Changes from Right"),f1:!0,precondition:ye,menu:{id:w.MergeInput2Toolbar,group:"primary"},icon:k.checkAll})}runWithViewModel(e){e.acceptAll(2)}}class tR extends Ei{constructor(){super({id:"mergeEditor.resetResultToBaseAndAutoMerge",category:Rt,title:x(7782,"Reset Result"),shortTitle:c(7783,"Reset"),f1:!0,precondition:ye,menu:{id:w.MergeInputResultToolbar,group:"primary"},icon:k.discard})}runWithViewModel(e,t){e.model.reset()}}class iR extends X{constructor(){super({id:"mergeEditor.resetCloseWithConflictsChoice",category:Rt,title:x(7784,"Reset Choice for 'Close with Conflicts'"),f1:!0})}run(e){e.get(ce).remove(oD,G.PROFILE)}}class sR extends np{constructor(){super({id:"mergeEditor.acceptAllCombination",category:Rt,title:x(7785,"Accept All Combination"),f1:!0})}runWithMergeEditor(e,t,...i){const{viewModel:s}=e,o=s.model.modifiedBaseRanges.get(),n=s.model;return Ae(r=>{for(const d of o){const l=n.getState(d).get();l.kind!==Ns.unrecognized&&!l.isInputIncluded(1)&&(!l.isInputIncluded(2)||!s.shouldUseAppendInsteadOfAccept.get())&&d.canBeCombined&&(n.setState(d,l.withInputValue(1,!0).withInputValue(2,!0,!0),!0,r),n.telemetry.reportSmartCombinationInvoked(l.includesInput(2)))}}),{success:!0}}}class oR extends np{constructor(){super({id:"mergeEditor.acceptMerge",category:Rt,title:x(7786,"Complete Merge"),f1:!0,precondition:ye,keybinding:[{primary:N.CtrlCmd|y.Enter,weight:W.EditorContrib,when:ye}]})}async runWithMergeEditor({inputModel:e,editorIdentifier:t,viewModel:i},s){const o=s.get(ao),n=s.get(Q);if(i.model.unhandledConflictsCount.get()>0){const{confirmed:r}=await o.confirm({message:c(7787,"Do you want to complete the merge of {0}?",os(e.resultUri)),detail:c(7788,"The file contains unhandled conflicts."),primaryButton:c(7789,"&&Complete with Conflicts")});if(!r)return{successful:!1}}return await e.accept(),await n.closeEditor(t),{successful:!0}}}class nR extends np{constructor(){super({id:"mergeEditor.toggleBetweenInputs",category:Rt,title:x(7790,"Toggle Between Merge Editor Inputs"),f1:!0,precondition:ye,keybinding:[{primary:N.CtrlCmd|N.Shift|y.KeyT,weight:W.WorkbenchContrib+10,when:ye}]})}runWithMergeEditor({viewModel:e},t){e.inputCodeEditorView1.editor.hasWidgetFocus()?e.inputCodeEditorView2.editor.focus():e.inputCodeEditorView1.editor.focus()}}const rp=x(7791,"Merge Editor (Dev)");class rR extends X{constructor(){super({id:"merge.dev.copyContentsJson",category:rp,title:x(7792,"Copy Merge Editor State as JSON"),icon:k.layoutCentered,f1:!0,precondition:ye})}run(e){const{activeEditorPane:t}=e.get(Q),i=e.get(Uc),s=e.get(Ke);if(!(t instanceof Dt)){s.info({name:c(7793,"Merge Editor"),message:c(7794,"No active merge editor")});return}const o=t.model;if(!o)return;const n={languageId:o.resultTextModel.getLanguageId(),base:o.base.getValue(),input1:o.input1.textModel.getValue(),input2:o.input2.textModel.getValue(),result:o.resultTextModel.getValue(),initialResult:o.getInitialResultValue()},r=JSON.stringify(n,void 0,4);i.writeText(r),s.info({name:c(7793,"Merge Editor"),message:c(7795,"Successfully copied merge editor state")})}}class aR extends X{constructor(){super({id:"merge.dev.saveContentsToFolder",category:rp,title:x(7796,"Save Merge Editor State to Folder"),icon:k.layoutCentered,f1:!0,precondition:ye})}async run(e){const{activeEditorPane:t}=e.get(Q),i=e.get(Ke),s=e.get(dm),o=e.get(Le),n=e.get(Zo);if(!(t instanceof Dt)){i.info({name:c(7793,"Merge Editor"),message:c(7794,"No active merge editor")});return}const r=t.model;if(!r)return;const d=await s.showOpenDialog({canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:c(7797,"Select folder to save to")});if(!d)return;const l=d[0],h=n.getExtensions(r.resultTextModel.getLanguageId())[0]||"";async function p(f,g){await o.writeFile(U.joinPath(l,f+h),cm.fromString(g),{})}await Promise.all([p("base",r.base.getValue()),p("input1",r.input1.textModel.getValue()),p("input2",r.input2.textModel.getValue()),p("result",r.resultTextModel.getValue()),p("initialResult",r.getInitialResultValue())]),i.info({name:c(7793,"Merge Editor"),message:c(7798,"Successfully saved merge editor state to folder")})}}class dR extends X{constructor(){super({id:"merge.dev.loadContentsFromFolder",category:rp,title:x(7799,"Load Merge Editor State from Folder"),icon:k.layoutCentered,f1:!0})}async run(e,t){const i=e.get(dm),s=e.get(Q),o=e.get(Le),n=e.get(Jt);t||(t={});let r;if(t.folderUri)r=t.folderUri;else{const b=await i.showOpenDialog({canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:c(7797,"Select folder to save to")});if(!b)return;r=b[0]}const d=await o.resolve(r);function l(b){return d.children.find(A=>A.name.startsWith(b))?.resource}const h=await cR(n,t.resultState),p=l("base"),f=l("input1"),g=l("input2"),m=l(h?"initialResult":"result"),v={base:{resource:p},input1:{resource:f,label:"Input 1",description:"Input 1",detail:"(from file)"},input2:{resource:g,label:"Input 2",description:"Input 2",detail:"(from file)"},result:{resource:m}};s.openEditor(v)}}async function cR(a,e){return e?e==="initial":(await a.pick([{label:"result",result:!1},{label:"initial result",result:!0}],{canPickMany:!1}))?.result}class lR{canSerialize(){return!0}serialize(e){return JSON.stringify(this.toJSON(e))}toJSON(e){return{base:e.base,input1:e.input1,input2:e.input2,result:e.result}}deserialize(e,t){try{const i=ZC(t);return e.createInstance(Ds,i.base,new Pn(i.input1.uri,i.input1.title,i.input1.detail,i.input1.description),new Pn(i.input2.uri,i.input2.title,i.input2.detail,i.input2.description),i.result)}catch(i){Bo(i);return}}}class hR{constructor(){this.name="mergeEditor",this.type=vg.Help,this.priority=125,this.when=XC.create("isMergeEditor",!0)}getProvider(e){const t=e.get(co),i=t.getActiveCodeEditor()||t.getFocusedCodeEditor();if(!i)return;const s=[c(7803,"You are in a merge editor."),c(7804,"Navigate between merge conflicts using the commands Go to Next Unhandled Conflict{0} and Go to Previous Unhandled Conflict{1}.","<keybinding:merge.goToNextUnhandledConflict>","<keybinding:merge.goToPreviousUnhandledConflict>"),c(7805,"Run the command Merge Editor: Accept All Incoming Changes from the Left{0} and Merge Editor: Accept All Current Changes from the Right{1}","<keybinding:merge.acceptAllInput1>","<keybinding:merge.acceptAllInput2>"),c(7806,"Complete the Merge{0}.","<keybinding:mergeEditor.acceptMerge>"),c(7807,"Toggle between merge editor inputs, incoming and current changes {0}.","<keybinding:mergeEditor.toggleBetweenInputs>")];return new nD(rD.MergeEditor,{type:vg.Help},()=>s.join(`
`),()=>i.focus(),aD.MergeEditor)}}H.as(ct.EditorPane).registerEditorPane(vi.create(Dt,Dt.ID,c(7800,"Merge Editor")),[new ee(Ds)]);H.as(ct.EditorFactory).registerEditorSerializer(Ds.ID,lR);H.as(xs.Configuration).registerConfiguration({properties:{"mergeEditor.diffAlgorithm":{type:"string",enum:["legacy","advanced"],default:"advanced",markdownEnumDescriptions:[c(7801,"Uses the legacy diffing algorithm."),c(7802,"Uses the advanced diffing algorithm.")]},"mergeEditor.showDeletionMarkers":{type:"boolean",default:!0,description:"Controls if deletions in base or one of the inputs should be indicated by a vertical bar."}}});C(zk);C(Fk);C(Kk);C(Bk);C(Xk);C(Wk);C(Gk);C(Uk);C(Hk);C($k);C(jk);C(qk);C(Yk);C(Jk);C(Zk);C(Qk);C(eR);C(tR);C(oR);C(iR);C(sR);C(nR);C(rR);C(aR);C(dR);H.as(vd.Workbench).registerWorkbenchContribution(tu,gr.Restored);yt(id.ID,id,vt.BlockStartup);dD.register(new hR);const uR=100;function hn(a,e){a?.addImplementation(uR,"webview",t=>{const s=t.get(lo).activeWebview;if(s?.isFocused)return e(s),!0;if(cu()?.classList.contains("action-menu-item")){const o=t.get(Q);if(o.activeEditor instanceof Wo)return e(o.activeEditor.webview),!0}return!1})}hn(Df,a=>a.undo());hn(Af,a=>a.redo());hn(QC,a=>a.selectAll());hn(Zc,a=>a.copy());hn(Xc,a=>a.paste());hn(Jc,a=>a.cut());const ap="preventDefaultContextMenuItems";Jc&&S.appendMenuItem(w.WebviewContext,{command:{id:Jc.id,title:c(11471,"Cut")},group:"5_cutcopypaste",order:1,when:I.not(ap)});Zc&&S.appendMenuItem(w.WebviewContext,{command:{id:Zc.id,title:c(11472,"Copy")},group:"5_cutcopypaste",order:2,when:I.not(ap)});Xc&&S.appendMenuItem(w.WebviewContext,{command:{id:Xc.id,title:c(11473,"Paste")},group:"5_cutcopypaste",order:3,when:I.not(ap)});const pR="workbench.action.openSettings",gR=c(7434,"Configure");let su=class extends R{constructor(e,t){super();const s=[new fR,new mR].map(r=>new wR(t,r));s.forEach(r=>this._register(r));let o;const n=()=>{const r=e.activeTextEditorControl;if(r===o)return;o=r;const d=gi(r);s.forEach(l=>l.onActiveEditorChanged(d))};this._register(e.onDidActiveEditorChange(n)),n()}};su=D([u(0,Q),u(1,Aw)],su);class fR{constructor(){this.id="decoratorsLimitInfo",this.name=c(7435,"Color Decorator Status"),this.label=c(7436,"Color decorators"),this.source=c(7437,"Color Decorators"),this.settingsId="editor.colorDecoratorsLimit"}getLimitReporter(e){return cD.get(e)?.limitReporter}}class mR{constructor(){this.id="foldingLimitInfo",this.name=c(7438,"Folding Status"),this.label=c(7439,"Folding ranges"),this.source=c(7440,"Folding"),this.settingsId="editor.foldingMaximumRegions"}getLimitReporter(e){return Uw.get(e)?.limitReporter}}class wR{constructor(e,t){this.languageStatusService=e,this.accessor=t}onActiveEditorChanged(e){this._indicatorChangeListener&&(this._indicatorChangeListener.dispose(),this._indicatorChangeListener=void 0);let t;return e&&(t=this.accessor.getLimitReporter(e)),this.updateStatusItem(t),t?(this._indicatorChangeListener=t.onDidChange(i=>{this.updateStatusItem(t)}),!0):!1}updateStatusItem(e){if(this._limitStatusItem&&(this._limitStatusItem.dispose(),this._limitStatusItem=void 0),e&&e.limited!==!1){const t={id:this.accessor.id,selector:"*",name:this.accessor.name,severity:_e.Warning,label:this.accessor.label,detail:c(7441,"only {0} shown for performance reasons",e.limited),command:{id:pR,arguments:[this.accessor.settingsId],title:gR},accessibilityInfo:void 0,source:this.accessor.source,busy:!1};this._limitStatusItem=this.languageStatusService.addStatus(t)}}dispose(){this._limitStatusItem=void 0,this._indicatorChangeListener=void 0}}H.as(vd.Workbench).registerWorkbenchContribution(su,gr.Restored);let ou=class{constructor(e,t){this.configurationService=e,this.layoutService=t,this.disposables=new O,V.filter(e.onDidChangeConfiguration,o=>o.affectsConfiguration("workbench.sash.size"))(this.onDidChangeSize,this,this.disposables),this.onDidChangeSize(),V.filter(e.onDidChangeConfiguration,o=>o.affectsConfiguration("workbench.sash.hoverDelay"))(this.onDidChangeHoverDelay,this,this.disposables),this.onDidChangeHoverDelay()}onDidChangeSize(){const e=this.configurationService.getValue("workbench.sash.size"),t=ma(e,4,20),i=ma(e,1,8);this.layoutService.mainContainer.style.setProperty("--vscode-sash-size",t+"px"),this.layoutService.mainContainer.style.setProperty("--vscode-sash-hover-size",i+"px"),eS(t)}onDidChangeHoverDelay(){tS(this.configurationService.getValue("workbench.sash.hoverDelay"))}dispose(){this.disposables.dispose()}};ou=D([u(0,ie),u(1,pr)],ou);H.as(vd.Workbench).registerWorkbenchContribution(ou,gr.Restored);H.as(xs.Configuration).registerConfiguration({...Cn,properties:{"workbench.sash.size":{type:"number",default:ua?20:4,minimum:1,maximum:20,description:c(9069,"Controls the feedback area size in pixels of the dragging area in between views/editors. Set it to a larger value if you feel it's hard to resize views using the mouse.")},"workbench.sash.hoverDelay":{type:"number",default:300,minimum:0,maximum:2e3,description:c(9070,"Controls the hover feedback delay in milliseconds of the dragging area in between views/editors.")}}});new j("inSettingsEditor",!1);new j("inSettingsJSONEditor",!1);new j("inSettingsSearch",!1);new j("settingsTocRowFocus",!1);new j("settingRowFocus",!1);new j("inKeybindings",!1);new j("inKeybindingsSearch",!1);new j("keybindingFocus",!1);new j("whenFocus",!1);const ra="workbench.action.openKeyboardLayoutPicker";c(8822,"Preview setting: this setting controls a new feature that is still under refinement yet ready to use. Feedback is welcome.");c(8823,"Experimental setting: this setting controls a new feature that is actively being developed and may be unstable. It is subject to change or removal.");const yR=new Set;["css","html","scss","less","json","js","ts","ie","id","php","scm"].forEach(a=>yR.add(a));const Or=new Map;Or.set("power shell","PowerShell");Or.set("powershell","PowerShell");Or.set("javascript","JavaScript");Or.set("typescript","TypeScript");Or.set("github","GitHub");let sd=class extends R{static{this.ID="workbench.contrib.keyboardLayoutPicker"}constructor(e,t){super(),this.keyboardLayoutService=e,this.statusbarService=t,this.pickerElement=this._register(new Ie);const i=c(8576,"Keyboard Layout"),s=this.keyboardLayoutService.getCurrentKeyboardLayout();if(s){const o=Ia(s),n=c(8577,"Layout: {0}",o.label);this.pickerElement.value=this.statusbarService.addEntry({name:i,text:n,ariaLabel:n,command:ra},"status.workbench.keyboardLayout",et.RIGHT)}this._register(this.keyboardLayoutService.onDidChangeKeyboardLayout(()=>{const o=this.keyboardLayoutService.getCurrentKeyboardLayout(),n=Ia(o);if(this.pickerElement.value){const r=c(8577,"Layout: {0}",n.label);this.pickerElement.value.update({name:i,text:r,ariaLabel:r,command:ra})}else{const r=c(8577,"Layout: {0}",n.label);this.pickerElement.value=this.statusbarService.addEntry({name:i,text:r,ariaLabel:r,command:ra},"status.workbench.keyboardLayout",et.RIGHT)}}))}};sd=D([u(0,yr),u(1,Rs)],sd);yt(sd.ID,sd,vt.BlockStartup);const vR=[`// ${c(8578,"Defines the keyboard layout used in VS Code in the browser environment.")}`,`// ${c(8579,'Open VS Code and run "Developer: Inspect Key Mappings (JSON)" from Command Palette.')}`,"","// Once you have the keyboard layout info, please paste it below.",`
`].join(`
`);C(class extends X{constructor(){super({id:ra,title:x(8580,"Change Keyboard Layout"),f1:!0})}async run(a){const e=a.get(yr),t=a.get(Jt),i=a.get(ie),s=a.get(uu),o=a.get(Q),n=a.get(Le),r=e.getAllKeyboardLayouts(),d=e.getCurrentKeyboardLayout(),h=i.getValue("keyboard.layout")==="autodetect",p=r.map(v=>{const b=!h&&Ng(d,v),A=Ia(v);return{layout:v,label:[A.label,v&&v.isUserKeyboardLayout?"(User configured layout)":""].join(" "),id:v.text||v.lang||v.layout,description:A.description+(b?" (Current layout)":""),picked:!h&&Ng(d,v)}}).sort((v,b)=>v.label<b.label?-1:v.label>b.label?1:0);if(p.length>0){const v=ut?"Mac":to?"Win":"Linux";p.unshift({type:"separator",label:c(8581,"Keyboard Layouts ({0})",v)})}const f={label:c(8582,"Configure Keyboard Layout")};p.unshift(f);const g={label:c(8583,"Auto Detect"),description:h?`Current: ${Ia(d).label}`:void 0,picked:h?!0:void 0};p.unshift(g);const m=await t.pick(p,{placeHolder:c(8584,"Select Keyboard Layout"),matchOnDescription:!0});if(m){if(m===g){i.updateValue("keyboard.layout","autodetect");return}if(m===f){const v=s.keyboardLayoutResource;return await n.stat(v).then(void 0,()=>n.createFile(v,cm.fromString(vR))).then(b=>{if(b)return o.openEditor({resource:b.resource,languageId:"jsonc",options:{pinned:!0}})},b=>{throw new Error(c(8585,"Unable to create '{0}' ({1}).",v.toString(),b))}),Promise.resolve()}i.updateValue("keyboard.layout",tr(m.layout))}}});let od=class extends R{static{this.ID="workbench.contrib.dirtyFilesIndicator"}constructor(e,t,i){super(),this.activityService=e,this.workingCopyService=t,this.filesConfigurationService=i,this.badgeHandle=this._register(new Ie),this.lastKnownDirtyCount=0,this.updateActivityBadge(),this.registerListeners()}registerListeners(){this._register(this.workingCopyService.onDidChangeDirty(e=>this.onWorkingCopyDidChangeDirty(e)))}onWorkingCopyDidChangeDirty(e){const t=e.isDirty();t&&!(e.capabilities&jD.Untitled)&&this.filesConfigurationService.hasShortAutoSaveDelay(e.resource)||(t||this.lastKnownDirtyCount>0)&&this.updateActivityBadge()}updateActivityBadge(){const e=this.lastKnownDirtyCount=this.workingCopyService.dirtyCount;e>0?this.badgeHandle.value=this.activityService.showViewContainerActivity(Mn,{badge:new Ld(e,t=>t===1?c(7178,"1 unsaved file"):c(7179,"{0} unsaved files",e))}):this.badgeHandle.clear()}};od=D([u(0,ks),u(1,Wf),u(2,Td)],od);var nu;let nd=class extends Qi{static{nu=this}static{this.ID=qD}constructor(e,t,i,s,o){super(nu.ID,e,{openInternal:(n,r)=>this.openInternal(n,r)},t,i,o),this.editorResolverService=s}async openInternal(e,t){if(e instanceof Xn&&this.group.activeEditor){const i=this.group.activeEditor,s=i?.toUntyped();if(!s)return;let o=await this.editorResolverService.resolveEditor({...s,options:{...t,override:Zr.PICK}},this.group);if(o===Lt.NONE)o=void 0;else if(o===Lt.ABORT)return;if(Lw(o))for(const n of o.editor instanceof Cr?[o.editor.original,o.editor.modified]:[o.editor])n instanceof Xn&&(n.setForceOpenAsText(),n.setPreferredLanguageId(Ku));await this.group.replaceEditors([{editor:i,replacement:o?.editor??e,options:{...o?.options??t}}])}}getTitle(){return this.input?this.input.getName():c(6812,"Binary File Viewer")}};nd=nu=D([u(1,mt),u(2,me),u(3,Sr),u(4,ce)],nd);class bR{canSerialize(e){return!0}serialize(e){const t=e,i=t.resource,s=t.preferredResource,o={resourceJSON:i.toJSON(),preferredResourceJSON:dt(i,s)?void 0:s,name:t.getPreferredName(),description:t.getPreferredDescription(),encoding:t.getEncoding(),modeId:t.getPreferredLanguageId()};return JSON.stringify(o)}deserialize(e,t){return e.invokeFunction(i=>{const s=JSON.parse(t),o=U.revive(s.resourceJSON),n=U.revive(s.preferredResourceJSON),r=s.name,d=s.description,l=s.encoding,h=s.modeId,p=i.get(Er).createTextEditor({resource:o,label:r,description:d,encoding:l,languageId:h,forceFile:!0});return n&&p.setPreferredResource(n),p})}}let rd=class extends R{static{this.ID="workbench.contrib.fileEditorWorkingCopyEditorHandler"}constructor(e,t,i){super(),this.textEditorService=t,this.fileService=i,this._register(e.registerHandler(this))}handles(e){return e.typeId===sl&&this.fileService.canHandleResource(e.resource)}handlesSync(e){return e.typeId===sl&&this.fileService.hasProvider(e.resource)}isOpen(e,t){return this.handlesSync(e)?dt(e.resource,t.resource):!1}createEditor(e){return this.textEditorService.createTextEditor({resource:e.resource,forceFile:!0})}};rd=D([u(0,Vd),u(1,Er),u(2,Le)],rd);var ru;let ad=class extends Ly{static{ru=this}static{this.ID=YD}constructor(e,t,i,s,o,n,r,d,l,h,p,f,g,m,v,b,A,K,P){super(ru.ID,e,t,o,r,d,h,l,p,i),this.paneCompositeService=s,this.contextService=n,this.textFileService=f,this.explorerService=g,this.uriIdentityService=m,this.pathService=v,this.configurationService=b,this.preferencesService=A,this.hostService=K,this.filesConfigurationService=P,this._register(this.fileService.onDidFilesChange(L=>this.onDidFilesChange(L))),this._register(this.fileService.onDidRunOperation(L=>this.onDidRunOperation(L)))}onDidFilesChange(e){for(const t of e.rawDeleted)this.clearEditorViewState(t)}onDidRunOperation(e){e.operation===Hs.MOVE&&e.target&&this.moveEditorViewState(e.resource,e.target.resource,this.uriIdentityService.extUri)}getTitle(){return this.input?this.input.getName():c(6813,"Text File Editor")}get input(){return this._input}async setInput(e,t,i,s){ui("code/willSetInputToTextFileEditor"),await super.setInput(e,t,i,s);try{const o=await e.resolve(t);if(s.isCancellationRequested)return;if(o instanceof Jm)return this.openAsBinary(e,t);const n=o,r=Se(this.editorControl);if(r.setModel(n.textEditorModel),!Vw(t?.viewState)){const d=this.loadEditorViewState(e,i);d&&(t?.selection&&(d.cursorState=[]),r.restoreViewState(d))}t&&_r(t,r,ft.Immediate),r.updateOptions(this.getReadonlyConfiguration(n.isReadonly())),r.handleInitialized&&r.handleInitialized()}catch(o){await this.handleSetInputError(o,e,t)}ui("code/didSetInputToTextFileEditor")}async handleSetInputError(e,t,i){if(e.textFileOperationResult===JD.FILE_IS_BINARY)return this.openAsBinary(t,i);if(e.fileOperationResult===yn.FILE_IS_DIRECTORY){const s=[];throw s.push(es({id:"workbench.files.action.openFolder",label:c(6814,"Open Folder"),run:async()=>this.hostService.openWindow([{folderUri:t.resource}],{forceNewWindow:!0})})),this.contextService.isInsideWorkspace(t.preferredResource)&&s.push(es({id:"workbench.files.action.reveal",label:c(6815,"Reveal Folder"),run:async()=>(await this.paneCompositeService.openPaneComposite(Mn,q.Sidebar,!0),this.explorerService.select(t.preferredResource,!0))})),Ag(c(6816,"The file is not displayed in the text editor because it is a directory."),s,{forceMessage:!0})}if(e.fileOperationResult===yn.FILE_TOO_LARGE){let s;throw e instanceof iS?s=c(6817,"The file is not displayed in the text editor because it is very large ({0}).",Su.formatSize(e.size)):s=c(6818,"The file is not displayed in the text editor because it is very large."),ZD(this.group,t,i,s,this.preferencesService)}throw e.fileOperationResult===yn.FILE_NOT_FOUND&&!this.filesConfigurationService.isReadonly(t.preferredResource)&&await this.pathService.hasValidBasename(t.preferredResource)?Ag(new Tf(c(6819,"The editor could not be opened because the file was not found."),yn.FILE_NOT_FOUND),[es({id:"workbench.files.action.createMissingFile",label:c(6820,"Create File"),run:async()=>(await this.textFileService.create([{resource:t.preferredResource}]),this.editorService.openEditor({resource:t.preferredResource,options:{pinned:!0}}))})],{allowDialog:!0}):e}openAsBinary(e,t){const i=this.configurationService.getValue("workbench.editor.defaultBinaryEditor"),s={...t,activation:Ef.PRESERVE};i&&i!==""&&i!==Ct.id?this.doOpenAsBinaryInDifferentEditor(this.group,i,e,s):this.doOpenAsBinaryInSameEditor(this.group,i,e,s)}doOpenAsBinaryInDifferentEditor(e,t,i,s){this.editorService.replaceEditors([{editor:i,replacement:{resource:i.resource,options:{...s,override:t}}}],e)}doOpenAsBinaryInSameEditor(e,t,i,s){t===Ct.id?(i.setForceOpenAsText(),i.setPreferredLanguageId(Ku),s={...s,forceReload:!0}):i.setForceOpenAsBinary(),e.openEditor(i,s)}clearInput(){super.clearInput(),this.editorControl?.setModel(null)}createEditorControl(e,t){ui("code/willCreateTextFileEditorControl"),super.createEditorControl(e,t),ui("code/didCreateTextFileEditorControl")}tracksEditorViewState(e){return e instanceof Xn}tracksDisposedEditorViewState(){return!0}};ad=ru=D([u(1,mt),u(2,Le),u(3,Ls),u(4,F),u(5,us),u(6,ce),u(7,on),u(8,Q),u(9,me),u(10,Je),u(11,tn),u(12,lD),u(13,Jo),u(14,wd),u(15,ie),u(16,Kd),u(17,Zt),u(18,Td)],ad);let dd=class extends R{static{this.ID="workbench.contrib.textFileEditorTracker"}constructor(e,t,i,s,o,n,r){super(),this.editorService=e,this.textFileService=t,this.lifecycleService=i,this.hostService=s,this.codeEditorService=o,this.filesConfigurationService=n,this.workingCopyEditorService=r,this.ensureDirtyFilesAreOpenedWorker=this._register(new sS(d=>this.ensureDirtyTextFilesAreOpened(d),this.getDirtyTextFileTrackerDelay())),this.registerListeners()}registerListeners(){this._register(this.textFileService.files.onDidChangeDirty(e=>this.ensureDirtyFilesAreOpenedWorker.work(e.resource))),this._register(this.textFileService.files.onDidSaveError(e=>this.ensureDirtyFilesAreOpenedWorker.work(e.resource))),this._register(this.textFileService.untitled.onDidChangeDirty(e=>this.ensureDirtyFilesAreOpenedWorker.work(e.resource))),this._register(this.hostService.onDidChangeFocus(e=>e?this.reloadVisibleTextFileEditors():void 0)),this._register(this.lifecycleService.onDidShutdown(()=>this.dispose()))}getDirtyTextFileTrackerDelay(){return 800}ensureDirtyTextFilesAreOpened(e){this.doEnsureDirtyTextFilesAreOpened(Es(e.filter(t=>{if(!this.textFileService.isDirty(t))return!1;const i=this.textFileService.files.get(t);if(i?.hasState(Tg.PENDING_SAVE)||t.scheme!==pe.untitled&&!i?.hasState(Tg.ERROR)&&this.filesConfigurationService.hasShortAutoSaveDelay(t)||this.editorService.isOpened({resource:t,typeId:t.scheme===pe.untitled?Ni.ID:Fw,editorId:Ct.id}))return!1;const s=i??this.textFileService.untitled.get(t);return!(s&&this.workingCopyEditorService.findEditor(s))}),t=>t.toString()))}doEnsureDirtyTextFilesAreOpened(e){e.length&&this.editorService.openEditors(e.map(t=>({resource:t,options:{inactive:!0,pinned:!0,preserveFocus:!0}})))}reloadVisibleTextFileEditors(){Es(gs(this.codeEditorService.listCodeEditors().map(e=>{const t=e.getModel()?.uri;if(!t)return;const i=this.textFileService.files.get(t);if(!(!i||i.isDirty()||!i.isResolved()))return i})),e=>e.resource.toString()).forEach(e=>this.textFileService.files.resolve(e.resource,{reload:{async:!0}}))}};dd=D([u(0,Q),u(1,tn),u(2,qo),u(3,Zt),u(4,co),u(5,Td),u(6,Vd)],dd);let cd=class extends R{static{this.ID="workbench.contrib.workspaceWatcher"}constructor(e,t,i,s,o,n,r,d){super(),this.fileService=e,this.configurationService=t,this.contextService=i,this.notificationService=s,this.openerService=o,this.uriIdentityService=n,this.hostService=r,this.telemetryService=d,this.watchedWorkspaces=new ns(l=>this.uriIdentityService.extUri.getComparisonKey(l)),this.registerListeners(),this.refresh()}registerListeners(){this._register(this.contextService.onDidChangeWorkspaceFolders(e=>this.onDidChangeWorkspaceFolders(e))),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.onDidChangeWorkbenchState())),this._register(this.configurationService.onDidChangeConfiguration(e=>this.onDidChangeConfiguration(e))),this._register(this.fileService.onDidWatchError(e=>this.onDidWatchError(e)))}onDidChangeWorkspaceFolders(e){for(const t of e.removed)this.unwatchWorkspace(t);for(const t of e.added)this.watchWorkspace(t)}onDidChangeWorkbenchState(){this.refresh()}onDidChangeConfiguration(e){(e.affectsConfiguration("files.watcherExclude")||e.affectsConfiguration("files.watcherInclude"))&&this.refresh()}onDidWatchError(e){const t=e.toString();let i;t.indexOf("ENOSPC")>=0?(i="ENOSPC",this.notificationService.prompt(_e.Warning,c(7174,"Unable to watch for file changes. Please follow the instructions link to resolve this issue."),[{label:c(7175,"Instructions"),run:()=>this.openerService.open(U.parse("https://go.microsoft.com/fwlink/?linkid=867693"))}],{sticky:!0,neverShowAgain:{id:"ignoreEnospcError",isSecondary:!0,scope:oS.WORKSPACE}})):t.indexOf("EUNKNOWN")>=0?(i="EUNKNOWN",this.notificationService.prompt(_e.Warning,c(7176,"File changes watcher stopped unexpectedly. A reload of the window may enable the watcher again unless the workspace cannot be watched for file changes."),[{label:c(7177,"Reload"),run:()=>this.hostService.reload()}],{sticky:!0,priority:fo.SILENT})):t.indexOf("ETERM")>=0&&(i="ETERM"),i&&this.telemetryService.publicLog2("fileWatcherError",{reason:i})}watchWorkspace(e){const t=[],i=this.configurationService.getValue({resource:e.uri});if(i.files?.watcherExclude)for(const n in i.files.watcherExclude)n&&i.files.watcherExclude[n]===!0&&t.push(n);const s=new ns(n=>this.uriIdentityService.extUri.getComparisonKey(n));if(s.set(e.uri,e.uri),i.files?.watcherInclude){for(const n of i.files.watcherInclude)if(n)if(nS(n)){const r=U.file(n).with({scheme:e.uri.scheme});this.uriIdentityService.extUri.isEqualOrParent(r,e.uri)&&s.set(r,r)}else{const r=e.toResource(n);s.set(r,r)}}const o=new O;for(const[,n]of s)o.add(this.fileService.watch(n,{recursive:!0,excludes:t}));this.watchedWorkspaces.set(e.uri,o)}unwatchWorkspace(e){this.watchedWorkspaces.has(e.uri)&&(qe(this.watchedWorkspaces.get(e.uri)),this.watchedWorkspaces.delete(e.uri))}refresh(){this.unwatchWorkspaces();for(const e of this.contextService.getWorkspace().folders)this.watchWorkspace(e)}unwatchWorkspaces(){for(const[,e]of this.watchedWorkspaces)e.dispose();this.watchedWorkspaces.clear()}dispose(){super.dispose(),this.unwatchWorkspaces()}};cd=D([u(0,Le),u(1,ie),u(2,us),u(3,Ke),u(4,Tt),u(5,Jo),u(6,Zt),u(7,mt)],cd);let ld=class{static{this.ID="workbench.contrib.fileUriLabel"}constructor(e){e.registerFormatter({scheme:pe.file,formatting:{label:"${authority}${path}",separator:xn,tildify:!to,normalizeDriveLetter:to,authorityPrefix:xn+xn,workspaceSuffix:""}})}};ld=D([u(0,Fi)],ld);H.as(ct.EditorPane).registerEditorPane(vi.create(ad,ad.ID,c(7080,"Text File Editor")),[new ee(Xn)]);H.as(ct.EditorPane).registerEditorPane(vi.create(nd,nd.ID,c(7081,"Binary File Editor")),[new ee(Xn)]);H.as(ct.EditorFactory).registerEditorSerializer(Fw,bR);yt(rd.ID,rd,vt.BlockRestore);yt(dd.ID,dd,vt.BlockStartup);yt(bg.ID,bg,vt.BlockStartup);yt(ld.ID,ld,vt.BlockStartup);yt(cd.ID,cd,vt.AfterRestored);yt(od.ID,od,vt.BlockStartup);rS.registerLanguage({id:Ku,aliases:["Binary"],mimetypes:["text/x-code-binary"]});class ec extends X{constructor(e,t){super(e),this.direction=t}run(e){const t=e.get(ze),i=e.get(Je),s=e.get(Ls),o=t.hasFocus(M.EDITOR_PART),n=t.hasFocus(M.PANEL_PART),r=t.hasFocus(M.SIDEBAR_PART),d=t.hasFocus(M.AUXILIARYBAR_PART);let l;if(o){if(this.navigateAcrossEditorGroup(this.toGroupDirection(this.direction),i))return;l=t.getVisibleNeighborPart(M.EDITOR_PART,this.direction)}n&&(l=t.getVisibleNeighborPart(M.PANEL_PART,this.direction)),r&&(l=t.getVisibleNeighborPart(M.SIDEBAR_PART,this.direction)),d&&(l=l=t.getVisibleNeighborPart(M.AUXILIARYBAR_PART,this.direction)),l===M.EDITOR_PART?this.navigateBackToEditorGroup(this.toGroupDirection(this.direction),i)||this.navigateToEditorGroup(this.direction===de.Right?Nt.FIRST:Nt.LAST,i):l===M.SIDEBAR_PART?this.navigateToSidebar(t,s):l===M.PANEL_PART?this.navigateToPanel(t,s):l===M.AUXILIARYBAR_PART&&this.navigateToAuxiliaryBar(t,s)}async navigateToPanel(e,t){if(!e.isVisible(M.PANEL_PART))return!1;const i=t.getActivePaneComposite(q.Panel);if(!i)return!1;const s=i.getId(),o=await t.openPaneComposite(s,q.Panel,!0);return o||!1}async navigateToSidebar(e,t){if(!e.isVisible(M.SIDEBAR_PART))return!1;const i=t.getActivePaneComposite(q.Sidebar);if(!i)return!1;const s=i.getId();return!!await t.openPaneComposite(s,q.Sidebar,!0)}async navigateToAuxiliaryBar(e,t){if(!e.isVisible(M.AUXILIARYBAR_PART))return!1;const i=t.getActivePaneComposite(q.AuxiliaryBar);if(!i)return!1;const s=i.getId(),o=await t.openPaneComposite(s,q.AuxiliaryBar,!0);return o||!1}navigateAcrossEditorGroup(e,t){return this.doNavigateToEditorGroup({direction:e},t)}navigateToEditorGroup(e,t){return this.doNavigateToEditorGroup({location:e},t)}navigateBackToEditorGroup(e,t){if(!t.activeGroup)return!1;const i=this.toOppositeDirection(e);return t.findGroup({direction:i},t.activeGroup)?!1:(t.activeGroup.focus(),!0)}toGroupDirection(e){switch(e){case de.Down:return we.DOWN;case de.Left:return we.LEFT;case de.Right:return we.RIGHT;case de.Up:return we.UP}}toOppositeDirection(e){switch(e){case we.UP:return we.DOWN;case we.RIGHT:return we.LEFT;case we.LEFT:return we.RIGHT;case we.DOWN:return we.UP}}doNavigateToEditorGroup(e,t){const i=t.findGroup(e,t.activeGroup);return i?(i.focus(),!0):!1}}C(class extends ec{constructor(){super({id:"workbench.action.navigateLeft",title:x(2750,"Navigate to the View on the Left"),category:xe.View,f1:!0},de.Left)}});C(class extends ec{constructor(){super({id:"workbench.action.navigateRight",title:x(2751,"Navigate to the View on the Right"),category:xe.View,f1:!0},de.Right)}});C(class extends ec{constructor(){super({id:"workbench.action.navigateUp",title:x(2752,"Navigate to the View Above"),category:xe.View,f1:!0},de.Up)}});C(class extends ec{constructor(){super({id:"workbench.action.navigateDown",title:x(2753,"Navigate to the View Below"),category:xe.View,f1:!0},de.Down)}});class Wy extends X{constructor(e,t){super(e),this.focusNext=t}run(e){const t=e.get(ze),i=e.get(Q);this.focusNextOrPreviousPart(t,i,this.focusNext)}findVisibleNeighbour(e,t,i){const s=eo(),o=Of(s);let n;if(o)switch(t){case M.EDITOR_PART:n=M.STATUSBAR_PART;break;default:n=M.EDITOR_PART}else switch(t){case M.EDITOR_PART:n=i?M.PANEL_PART:M.SIDEBAR_PART;break;case M.PANEL_PART:n=i?M.AUXILIARYBAR_PART:M.EDITOR_PART;break;case M.AUXILIARYBAR_PART:n=i?M.STATUSBAR_PART:M.PANEL_PART;break;case M.STATUSBAR_PART:n=i?M.ACTIVITYBAR_PART:M.AUXILIARYBAR_PART;break;case M.ACTIVITYBAR_PART:n=i?M.SIDEBAR_PART:M.STATUSBAR_PART;break;case M.SIDEBAR_PART:n=i?M.EDITOR_PART:M.ACTIVITYBAR_PART;break;default:n=M.EDITOR_PART}return e.isVisible(n,s)||n===M.EDITOR_PART?n:this.findVisibleNeighbour(e,n,i)}focusNextOrPreviousPart(e,t,i){let s;t.activeEditorPane?.hasFocus()||e.hasFocus(M.EDITOR_PART)?s=M.EDITOR_PART:e.hasFocus(M.ACTIVITYBAR_PART)?s=M.ACTIVITYBAR_PART:e.hasFocus(M.STATUSBAR_PART)?s=M.STATUSBAR_PART:e.hasFocus(M.SIDEBAR_PART)?s=M.SIDEBAR_PART:e.hasFocus(M.AUXILIARYBAR_PART)?s=M.AUXILIARYBAR_PART:e.hasFocus(M.PANEL_PART)&&(s=M.PANEL_PART),e.focusPart(s?this.findVisibleNeighbour(e,s,i):M.EDITOR_PART,eo())}}C(class extends Wy{constructor(){super({id:"workbench.action.focusNextPart",title:x(2754,"Focus Next Part"),category:xe.View,f1:!0,keybinding:{primary:y.F6,weight:W.WorkbenchContrib}},!0)}});C(class extends Wy{constructor(){super({id:"workbench.action.focusPreviousPart",title:x(2755,"Focus Previous Part"),category:xe.View,f1:!0,keybinding:{primary:N.Shift|y.F6,weight:W.WorkbenchContrib}},!1)}});const CR=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));Pe(CR);xf((a,e)=>{const t=hD(a);e.addRule(`.monaco-workbench-part { background-color: ${t}; }`);const i=a.getColor(aS);if(i&&e.addRule(`.monaco-workbench-part ::selection { background-color: ${i}; }`),Qs){const s=a.getColor(uD);if(s){const o="monaco-workbench-meta-theme-color";let n=re.document.getElementById(o);n||(n=Bf(),n.name="theme-color",n.id=o),n.content=s.toString()}}Nf&&e.addRule(`
			.monaco-workbench-part.web {
				touch-action: none;
			}
			.monaco-workbench-part .monaco-editor .view-lines {
				user-select: text;
				-webkit-user-select: text;
			}
		`),ua&&dS()&&e.addRule(`.monaco-workbench-part { background-color: ${t}; }`)});var SR={"vs/workbench/contrib/debug/browser/media/continue-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIxSURBVHgB7dlNbtNAGMbxZyaUBSuOYHOBYlYskEhPwscFoKsqIBRHCCKyKNADQLkAR0jCiqBIhH6wAim+AWyAVKlnmDdKJUNTimT7nVm8v13SStGjfyauG0AIIYQQQgghBKPu5HGzO0kjBEahYjRUN3QbFk33MHMvkW6tP3iDQFQ6eDFW68GpF1HYzfN5p5WkGTzTYGAtbmu9Nni29/QWPGMZvBS56bu9/SevfZ5tzsELvmvXO1jZoTGms+Inka/atRduJY9SY3SMxSf2n5a1+5y1Wd7SraSVba0/jM+oHXPWZj3DIdRm/9DyXZt98Alftb0NJlT7ornEWtvrYLKZbOL61RtU+woYansfTDbUBtWectQOYvCJ/6nd0GtvUUJQg8l5tS1wGSUEN5gM7ABHmMXuvvomKnYBAaGhB18PMN4f3dfatN1b+FRNdwP/DSUEM3j7cFt9+DSKVMO8cg+bK37F7Tcvf5m8gxK8D6aqH/feq+P86N4ZVd2xRebO8x33x8o7lOT1DO982YGrGh9r23f1nq/4QFpWnV+rYizxUpiqjj+P1eznD5aqReyDqerIVdXnnNWZO6tpkn5HxdgGF6s2mKsWsQz2XbWo9sG9w96/qpJp3VWL6h1sVWTNvA/PVYvqLhy5kxmteJ6q3nVVh2DGfR2mqi+W19UhPOC8LHmrWlRpYQNNZ3H619PeqxbV8HVpN9LI29CK/iWThVCVBQ1PJ2mpm3UhhBBCCCFEOH4DIKF0k8sm4ZEAAAAASUVORK5CYII=",import.meta.url).href,"vs/workbench/contrib/debug/browser/media/pause-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADASURBVHgB7dmxDcIwEEbh3xGLMAIbgFiADWADKmqoEUPAJFY2YAOyBRUxR2GLjkgxzeV9VWLlFD+3lgAAAAAAmJ6gyg4x7ZW0KT8Iup5X4fZr7hiTntI2Je3ymj23l3U4qaKZKrNNLuwUl/n91asdMvc5+b7X3A6ozIZGD1XWaGII9o5g7wj2jmDvCPaOYO8I9o5g7wj2jmDvCPaO4NpGXG0k/UH1mwfbZmeVMb9acDdsrHwbv5bvAgAAAAAAo70BgzIgmYCKG/cAAAAASUVORK5CYII=",import.meta.url).href,"vs/workbench/contrib/debug/browser/media/restart-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAASRSURBVHgB7ZlPTxtHGMafGUNsStWEQ6QcTauemha76r1GvZf0CzQ410iBcgiCNGVpipE5ADnkWuMec4hoP4BNbtzstBwqVWq2UlUhBTUoqgv2emf6jg1lcW1iZsdWkeYnGbyz9s48nnnn/TOAxWKxWCwWi8VisXQBQx9ZKS0lfCAR4bjsCzHSbOUuINwq/LKTdPbRY7QEOyXnShS4cnxdBfY7DXa59CDFI5EpJmVKBr7TYTRbkGxDiNrTuaTjogcMQIMoItOc84Xj65jEBv1LBz/TEMp5jt7GISVkNw+WSNEf+t6gXPkps+jXa3nTwjkMs1xajmd/XCqS2CKUWD2YFNIh4YVM6cENGMSoYCWWc1FszlQHpCzThG+cvOQW2VUn2x2NcP6EZnsBhtBa0u1QGxJIbDs7VaKkZPkqvM12tp57nsPu/u8pDjYJzm623FazvUCicff9+UWERGvTIvt0gjbc3Gwayzfe8lFXCJGeS97fQhcUZRHb5e04h++0ES4h2Mxscn4dITCzpJtLOH66jW0eCC/ZrVjFOBvHXHLOHXrzrUlfyJmW2wxcrjZWUgiMb1pNZH42Mf+Zrl+98+4dXB4cWRMCt1puMcnxLULQC8HugahPIyS3r99GDG/kyCRa7TaRfZa5CU3M2HAAmpW0ipyCbWGiqJWdFSbqXoGxk52fBl26O3bvQ2hgfIY5R0754OAr+roI6wyuDl+lTV58HWwjT5BQgQ006JENmyM9mkZkMEpujTzBCYxxTEADLcEx+Mo1lNEnYtGYpFj8h2AbB/8YGmgJ/oLs8ZLwxo9+dbeLVyiuVa+hDrYVbFPLGhr0NT3URUoH62WM1Pjgn8FmIby3z5tc/O9tWMGYo9a1kVz5Qgg2yYURLKpdZdSv5UIIfrzzGIdS/meT0ikOXAjBu9FdymNlKtjGNN2ikXxY5bMvKy8bO/7M9Rkzay9A5a8KIz4NuhQB8RQahJphtdRUrEvJ+3jNr6x54nBVtZlE/ZhAPRWMpaE8lcAmNAgl2PV+SUjhFSheLlCyOkXDmKa2pEN+0xR7r/5g9PzWlNClPLv/MzwIz2USY8G2Rr5KQQIMkH2WZQJMZWXxYBdkwQ40CR1pZUrfTEc4Wzv1UIYNJi/d+uiDihzXHFv25yxD1ae8V+Zabv06O3bvHWgSepeeT365TjF1MdhG15OCeU+2yxh9tPMI50HVtVZ3MoxVxVQbsSqc/AQhMBJLH5VnC/R2tOWWS10ssshAfhjD8sV7L+B0mHG1Oe292mO+qMd5RK5REtya/tFSFouzY/dDVS6NJQ/NMi0KNKqRNr2oI5T8gah9PzQ0tM+rVJCNNbv2pY+BQx816acox71Bad/nbUq9RsQ2h2KQM2Y6SJmM3KVacyMZIHtP0CDiZ5w7GRPb6A+GaYiGv3BUVw7zfBXAHNe1tVxQO3qWDy+XliapvvUVmi7lPP1IdfRCx6kPqfj30PQRas8LANnGYRibYJxNBJZtsN9/Q1F1JMMZ2/xbeN/16qy47wfidF4SF6fKM/w52ehv/ToQt1gsFovFYrFYLJau+AfCNPXR3BjmUgAAAABJRU5ErkJggg==",import.meta.url).href,"vs/workbench/contrib/debug/browser/media/run-with-debugging-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAUfSURBVHgB7ZpNTxtHGMefmbWTktICh1x66bqXXqpit5ccKmHovSVfoGCukUqJUlEaqixKE0Qb4RQpxwL9Amn6BWJzKlKl2Ea5VJXqvfVYU1xsx96ZPI+9gxdjwtpmd1G0Pwn2bWZ3/vOft2cAICQkJCQkJCQkJCTkQrKau5tczRk6XBAYeAQJ5Rq/AxKSeGnip4zF8W9/gYDxRPBa7u40cP7riY8x2Las+spSwjAhIDh4gAA+2u2+lDDLeTSzVrg/AwHhieAz0FH69g9797aC6NtBCG4SlNv+CGYyK4RY6fJE99tt3xxeSnxnCMFj0Byxj2O7/dQPt31t0kuJJXNx/HbsFLdjfrgdSB8O0u3ABq2g3A5MsOJa/BNy+z3wye3ABU+ySXK7eElc8cXtwAUrFhILvrh9YQQTfrjtkWCeBSGug5AUHZnQI27c1nj0MfRBBDyARmBoFfQJXVOoCD1CbiPFdC4dq0LZ4BxDTQcSYBT6wJcmjfNuFvogIzNQhWoM4+oJOCcGdlgF+kxCnGodA+ySZCyLFjwZJODf+GsD/tjbnde4MLAJn3ATv/Mv9MFADtPggU0tQ7saqok1j1JO0+Dy4979NPQIubqaW41VKgcZCeJht6ZL9w9F/VPoA1c7HlSIncLO2PDQcOnW+7fko+ePoCz20yjsK1UGJIuvM/FUZ4wl1btpl+PqW++kUrEUPPjzAasflt+9FgdzkhknvvGs8DuzGPsStxCMLkLxFpg4eqewi+xAn7gSTDXOuXiKhc/yy5fn6oe1Gc5hy35cxELMOfspptcpPTSnESy+EJPRK0M7olbbxOaZFKI+hds8RZV+/fk6e1Gv6UwTm/YeWCeYTfxUFdaKkTBKMACu+jBj4mc86DQdYKHJNV09swtvOtPTKI2ip1B0UxT1ccxnUv7WdZTeN0Xn5HqjWpvHtHe69NVzcdWJK8FS8jkU3XSMCs1Uu8DA/u3oVZOaeBfMg0Ypi2mTdh9XFIVVn1MXtcNaPMIh3fWz5+SqE1eCHY4dNdMWDP6rl1Kn5eMatDxqU+xsEVpUyzPLKjn67Lm76qSnbdrmFESjcp9QX+6ck1v99/8043wePHLVSY/zMNcdFxLcY1es1DsfvFndl3UtksXTz7xy1Ykrwbi8ax6rcHh0DxUsWEIUzsorgcU1ztKd76L1MvHPxwxG8lZ2X1gfeeWqE1eCaS1LR860cWUsiXWzZMRuAMpgrkU+r1pl3X5kNH+15mPPhSpcCW4v3HtpxV3AFRi+a9q+MiAA3PZhp9JB/h41YI0NjivBOJVQXIoL7wj+kazVHyMaG4Ee4Uxe//rD5d8gQFwFDzRv0s8laGyre5aUk4Y0XpmP1secs1l13bAaZw5yXtNjtDRCg0uezhjwGTwbOy0lVcZufhcXKWyilR7yb4yOmBAwrgXTdFLjFQNP4/at0SEt+nitsMYyHU5vFbeoWsY4BQPQWndj543XyxWD4twgcTUA0Vr5wNo3GEi1zSIdeU1aLvKhIVNjGjZ1C0TlBa3I1qFdOe30gt0cjo6kb3xwA4LAlcNla3/mmFghb+JRhXcYCkb/hlrjWaNS26QjiqU1txJblCBXQI3QXK7T+yAgXDZpkbRPpBAwt5hYfog7ilM4r9K/NaipJo6R0Sw4XEUy5P4348srlK+d9uh9vuN6Tl0rfL8lBNtZStzePnaf/p+DsS9ol8OOeEyUmhdSbnSuxFZz93AzXU4sji+nICQkJCQkJCTkdecljQujDnl0mKoAAAAASUVORK5CYII=",import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stepinto-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJRSURBVHgB7ZpNbtNAFMf/zzYCdnACcoQKLlCzYAviAvQIoFLEroUVUoXoCZpwBLYg6nKDcoLkBsmCL6luH/Ocpoqjtnbdea9S+n5SFI89mpmfx56PlwCO4ziO4ziODgRj1gtenU9/zGkfhmQwJmEUC6dMb3qCG4YLLzsuvOy48LLjwldl/Vt9JdWVzYLxuohT1jxRhd8U/CJJUWx85z6uwFbB9A/oE2NPykREoglLw5gxqBKEta7SIvsX2D1mrElJocx+TOkowi8LvhcauFM72UF6Qfa0pJD+JHUgAlGEd3KaUImcgUntwiWkz5FFKHNMhMdSByIQ7ZHefkIHXaWbZLdzOkAkog5aXaQtZadNUWDjK69whiIUXn/vZFCjulhCGFjJCmqb73OlG9CUFVSjDZeV1pYV1MMrbaUtZAWTeFKTtJWsYLJ5mBu9x4vXLGUF04jhSU/vzXpapi9LWcE8Lv224F5ZoifHWYbRh5xGcJxomD7Ssqmn26FOnqY5RbWu3MrtmmFWU1gz4xeQ0xGehoHqgZzjBD/CNPHlDjB8ZyRtUovI/glfYTO/ecZlmZZe3QU+W0irz8MNssJ9iWr8LrEKA9SFQ2yqd4HsDKIUu/KOa6MuXB7jWcusPYte1l9aElZaZ02mCxJN1IXD49w6FhWCAWMoo9/DjP22WcNo/RPKqAsfpZXwsCFbWJFgYLGuVheuwqslnp+1NTxBhuZhCryHAWb74YzwMBzKH1p49qluQujZQ8Ijq13TtW0Pw+9Gk8NbGMUKsDuO4ziO4zjXzX/ncxVIRDwWzgAAAABJRU5ErkJggg==",import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stepout-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJSSURBVHgB7ZpRbtNAEIb/cYIAqQ/tCQg3qOACOEi8Aj1BOQIPEbw14amoIHECKBcA8cpDDTeAEyQ3oA9AK9XpdsbxSlGUNk60M62i+aRIlr3S5vPYuzvjBRzHcRzHcRwdCMa8KkKnBDpy3AZGb3MawRBT4V4RtkNAwZ1u1qeOUSI/eEK/YEQGI+bICpsc5qPe97ANI0wifInsNH840l2LSKsLN5CNmEirCi8hG1GXVhNeQTaiKq0yaF0mG4DPs23nnNvSHMiSC18l+65Lu7PtNwgvLKWTCi8rK/RzCpbSyYRXkY1YSqeLcMDXWdnzgMEi2Ugtvcs3bTBzSaS/IBHphEs8D7JUrBHZ94+pjyVgaWxk6E9LBxm1CTtIRDJhmUaI18UivYpsZFpaZIl4isrTTVFJBy2RLgn3V5WNROk24UFKWcE8PewdceymOOiS6X8wy5ZuCi687rjwuuPC604b9gRcI+bCYYwuHEcN03XsXhFAt7nP+i0OLQQ6mSQLVpj11GfZv0BOYzzldOGenAsZfvI08e0OMBwYSZv0IrL/UeW4e3MuS8778i6Xdyyk1efhBbLCFl/79K/EIxigLnzKn0avkI0QtfBR3nFt1IXLczxr2LRjEWX9pSWhcYmVssmHck3UhflxPm7aNiOuUCqjH+GAH02b8mj9G8qoC49blfBwQTNekeBw32C/h7rwh5xkH8dOVVCfjwzNwxbwBgaY5MNSr5YaMx8WmAhWv/qrwuEZ4eG+0W4e87r0a9m2VKJDPJid3cKoegIcx3Ecx3GcNeAC4UEBaURTA6MAAAAASUVORK5CYII=",import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stepover-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMnSURBVHgB7ZldTttAFIXPOA5Sfx5YgmEDzQ6agPpcdgB0BVQ09JHQp7a0aruBClZA+9qWOKygdAONl5BKhf4AuT0DQXKCG8cTzwik+SQLezzGc3zv3Dt3Ang8Ho/H4/F4PB4TFG4IrVjQA6J029uGSlAQp4LXYokqqUEHQO8ESDjwXt6zT2NRfUE/1SQnCvNFRYewiBY4AyyLoC5ATQlmR/tUeTTbkkDQUQE+vmyoD7CIFcHrsdQDwSYuhJ6T40oRO6zww6xo8Uphh9bffW7gsnkEKBG6XcQBxxQb87IOMyIKb50J2huxLKNkSrOwtioHuUdLzuZ0TVLn0Zh+cxS+s7Ev9/4GeMbrHyiBUgRrS+jBZd2jS/d47x3DTecsxOFogGp+khoqqPH0Id166crzCo+rnBp/FBarmJ6po/TGF1mSAHsZt/RcbDEI7WICdNr5TYuf0p05qCxXPuRRS10bRempBOs5Szf+esWNadGTAK1J0s0omxR+dIqGquA9xru8keCpghbzYjwqlm1b24tqzUSsZquhcDdEHCgsYHi+l4Kx4Oa+rGDEAlrs60XVwpS0KPoW0NWidQxAiZgHLcU8O0xiIjZryagZqJSqwhanyBuUhJHgdQYqjAyS1mjAgGN+uhlODRk/XzMJT8+fSQo8YubSnLdD6YOD7bywsCrKIQnD4nPcTHCA+0P/RGXnYIt0K5zfJkvPwoJZEOioHKXbaOFvcIexWE3hPNyMuTJi7k23bS+oG1NXFw5aun7lUm/18lpJuWnD4/F4xuE8uupq6PKlevtHFwsucfY2LfQX39fXWz/9wcIlwAEXAh0WCuJKuJO3nNe4YI0rmTVuImdYvROi40J0qZt4/2Mgto3sAiFisd9m0V+HA6x/Um3dY0EX+dVQ9zZ3MGxb2bqFjy62a6MJukY/HVjZumDpTyxCsQqbtK8x1gUXcFAZHFaxH7S4H22lryFO0hJ/fvnOP3M53bosM+dhGSdpiXn2Eca7q+hcDAc4EfzqgepQkN5n1ukpLVyfd3mvwT4HcIDztfSTz1LHZTTmnNUfAx6Px+PxeDwej8dz3fgHnygaDf8DyT4AAAAASUVORK5CYII=",import.meta.url).href,"vs/workbench/contrib/debug/browser/media/stop-tb.png":new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADLSURBVHgB7dkxDoJAEEbhf4ml3gFvwpGsNFSWxEqPxEmMdzDRRHRXSGjsZIEQhvclhJaXHZodCQAAAAD+4BThXuwyeWWaUqJyk19KdbRSjDrWJe6oCQUfmlepjhItzOKC40b6122dn7ca2bM4uI9eXj0x0tYRbB3B1hFsHcHWEWwdwdYRbB3B1hFsHcHWEWzdEBfxepz2UUu5LqrwdklQb0MEp95XV41sqFEc5IRrqWZirv9waJ/O4k64Xka3+9mphOYbBAAAAABj+QJmPCRPyVBXxgAAAABJRU5ErkJggg==",import.meta.url).href};kw(SR);let In;kw({"vs/workbench/contrib/webview/browser/pre/service-worker.js":()=>jr(new URL("/assets/service-worker-DsB6cQ40.js",import.meta.url).href,In),"vs/workbench/contrib/webview/browser/pre/index.html":()=>jr(new URL("/assets/index-Cg3XqiaZ.html",import.meta.url).href,In),"vs/workbench/contrib/webview/browser/pre/index-no-csp.html":()=>jr(new URL("/assets/index-no-csp-DMfG5HRS.html",import.meta.url).href,In),"vs/workbench/contrib/webview/browser/pre/fake.html":()=>jr(new URL("/assets/fake-DXkbmQ09.html",import.meta.url).href,In)});XD(async a=>{a.get(xu)});function bP(a){return a!=null&&(In=a),{...tx(),[gt.toString()]:new ee(ih,[],!1),[Ye.toString()]:new ee(Bl,[],!0),[ks.toString()]:new ee(ll,[],!0),[Ls.toString()]:new ee(Jl,[],!0),[co.toString()]:new ee(yD,[],!0),[Er.toString()]:new ee(QD,[],!1),[Sr.toString()]:new ee(Fl,[],!1),[mD.toString()]:new ee(wD,[],!0),[Xo.toString()]:new ee(lS,[],!0),[Pw.toString()]:new ee(Wl,[],!0),[xu.toString()]:new ee(Da,[],!1),[Dw.toString()]:new ee(Ul,[],!0),[lo.toString()]:new ee(ql,[],!0),[$m.toString()]:new ee(IT,[],!0),[Pu.toString()]:new ee(fD,[],!0),[Ad.toString()]:new ee(Yl,[],!0),[Du.toString()]:new ee(eh,[],!0),[cS.toString()]:new ee(FT,[],!0),[pD.toString()]:new ee(gD,[],!0),[sA.toString()]:new ee(KT,[],!0)}}H.as(pt.ViewContainersRegistry);H.as(pt.ViewsRegistry);export{wl as A,Hg as B,de as D,Lg as E,ul as P,dl as S,bP as a,ll as b,Ss as c,Vo as d,sL as g};
